<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Analog Clocks - Timezone Tools - CCAB</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600;700&family=Nunito:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --sage: #8A9A5B;
            --moss: #606C38;
            --earth: #DDA15E;
            --cream: #FEFAE0;
            --terracotta: #BC6C25;
            --dark-moss: #3d4423;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #FEFAE0 0%, #F4F1DE 50%, #EDE8D5 100%);
            color: var(--moss);
            line-height: 1.7;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Organic morphing shapes */
        .organic-shape {
            position: fixed;
            border-radius: 63% 37% 54% 46% / 55% 48% 52% 45%;
            opacity: 0.08;
            animation: morph 30s infinite ease-in-out;
            z-index: 0;
            pointer-events: none;
        }

        .shape-1 {
            width: 600px;
            height: 600px;
            background: var(--sage);
            top: -150px;
            left: -150px;
        }

        .shape-2 {
            width: 400px;
            height: 400px;
            background: var(--earth);
            bottom: -100px;
            right: -100px;
            animation-delay: -10s;
        }

        @keyframes morph {
            0%, 100% {
                border-radius: 63% 37% 54% 46% / 55% 48% 52% 45%;
                transform: rotate(0deg) scale(1);
            }
            25% {
                border-radius: 40% 60% 70% 30% / 40% 40% 60% 60%;
                transform: rotate(90deg) scale(1.05);
            }
            50% {
                border-radius: 50% 50% 33% 67% / 55% 27% 73% 45%;
                transform: rotate(180deg) scale(1);
            }
            75% {
                border-radius: 70% 30% 50% 50% / 30% 65% 35% 70%;
                transform: rotate(270deg) scale(0.95);
            }
        }

        /* Back Link */
        .organic-back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 18px;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(138, 154, 91, 0.3);
            border-radius: 30px;
            text-decoration: none;
            color: var(--moss);
            font-weight: 600;
            font-size: 0.9rem;
            z-index: 1000;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(96, 108, 56, 0.1);
        }

        .organic-back-link:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateX(-5px);
            box-shadow: 0 6px 20px rgba(96, 108, 56, 0.15);
        }

        .back-arrow {
            font-size: 1.1rem;
            transition: transform 0.3s ease;
        }

        .organic-back-link:hover .back-arrow {
            transform: translateX(-3px);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 4rem 2rem 2rem;
        }

        h1 {
            font-family: 'Lora', serif;
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 700;
            color: var(--moss);
            margin-bottom: 0.5rem;
        }

        .subtitle {
            font-size: 1.1rem;
            color: var(--terracotta);
            font-weight: 400;
        }

        /* Date Selector */
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.6);
            padding: 0.75rem 1.25rem;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(138, 154, 91, 0.2);
        }

        .control-group label {
            font-weight: 600;
            color: var(--moss);
            font-size: 0.9rem;
        }

        input[type="date"] {
            padding: 0.5rem 1rem;
            border: 2px solid rgba(138, 154, 91, 0.3);
            border-radius: 10px;
            font-family: 'Nunito', sans-serif;
            font-size: 0.95rem;
            background: white;
            color: var(--dark-moss);
            cursor: pointer;
            transition: border-color 0.3s ease;
        }

        input[type="date"]:hover,
        input[type="date"]:focus {
            border-color: var(--sage);
            outline: none;
        }

        .btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 10px;
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--moss);
            color: white;
        }

        .btn-primary:hover {
            background: var(--dark-moss);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.8);
            color: var(--moss);
            border: 2px solid rgba(138, 154, 91, 0.3);
        }

        .btn-secondary:hover {
            background: white;
            border-color: var(--sage);
        }

        /* Clocks Container */
        .clocks-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 1.5rem;
            flex-wrap: wrap;
            padding: 2rem 0;
        }

        .clock-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: rgba(255, 255, 255, 0.6);
            padding: 1.5rem;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(138, 154, 91, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .clock-wrapper:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(96, 108, 56, 0.15);
        }

        .clock-canvas {
            display: block;
        }

        .city-name {
            font-family: 'Lora', serif;
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--moss);
            margin-top: 1rem;
            text-align: center;
        }

        .time-info {
            font-size: 1.1rem;
            color: var(--dark-moss);
            margin-top: 0.25rem;
            font-weight: 500;
        }

        .utc-offset {
            font-size: 0.9rem;
            color: var(--terracotta);
            margin-top: 0.5rem;
            font-weight: 600;
        }

        .dst-status {
            font-size: 0.8rem;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            margin-top: 0.5rem;
            font-weight: 600;
        }

        .dst-active {
            background: rgba(138, 154, 91, 0.2);
            color: var(--moss);
        }

        .dst-inactive {
            background: rgba(188, 108, 37, 0.15);
            color: var(--terracotta);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .clocks-container {
                gap: 1rem;
            }
            .clock-wrapper {
                padding: 1rem;
            }
        }

        @media (max-width: 768px) {
            .clocks-container {
                flex-direction: column;
                align-items: center;
            }
            .controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Organic background shapes -->
    <div class="organic-shape shape-1"></div>
    <div class="organic-shape shape-2"></div>

    <!-- Back Navigation -->
    <a href="index.html" class="organic-back-link">
        <span class="back-arrow">&#8592;</span>
        <span class="back-text">Gallery</span>
    </a>

    <div class="container">
        <header class="header">
            <h1>World Analog Clocks</h1>
            <p class="subtitle">Real-time clocks showing time across 5 cities with DST awareness</p>
        </header>

        <div class="controls">
            <div class="control-group">
                <label for="date-selector">Simulate Date:</label>
                <input type="date" id="date-selector">
            </div>
            <button class="btn btn-primary" onclick="applySimulatedDate()">Apply</button>
            <button class="btn btn-secondary" onclick="resetToNow()">Reset to Now</button>
        </div>

        <div class="clocks-container" id="clocks-container">
            <!-- Clocks will be dynamically generated -->
        </div>
    </div>

    <script>
        // City configurations with DST rules
        const cities = [
            {
                name: 'Miami',
                baseOffset: -5, // UTC-5 (EST)
                dstOffset: -4,  // UTC-4 (EDT)
                hasDST: true,
                // US DST: Second Sunday in March to First Sunday in November
                getDSTRange: (year) => {
                    const marchStart = new Date(year, 2, 1);
                    const marchSecondSunday = new Date(year, 2, 8 + (7 - marchStart.getDay()) % 7);

                    const novStart = new Date(year, 10, 1);
                    const novFirstSunday = new Date(year, 10, 1 + (7 - novStart.getDay()) % 7);

                    return { start: marchSecondSunday, end: novFirstSunday };
                }
            },
            {
                name: 'London',
                baseOffset: 0,  // UTC+0 (GMT)
                dstOffset: 1,   // UTC+1 (BST)
                hasDST: true,
                // UK DST: Last Sunday in March to Last Sunday in October
                getDSTRange: (year) => {
                    const marchEnd = new Date(year, 3, 0);
                    const marchLastSunday = new Date(year, 2, marchEnd.getDate() - (marchEnd.getDay()));

                    const octEnd = new Date(year, 10, 0);
                    const octLastSunday = new Date(year, 9, octEnd.getDate() - (octEnd.getDay()));

                    return { start: marchLastSunday, end: octLastSunday };
                }
            },
            {
                name: 'Malta',
                baseOffset: 1,  // UTC+1 (CET)
                dstOffset: 2,   // UTC+2 (CEST)
                hasDST: true,
                // EU DST: Last Sunday in March to Last Sunday in October
                getDSTRange: (year) => {
                    const marchEnd = new Date(year, 3, 0);
                    const marchLastSunday = new Date(year, 2, marchEnd.getDate() - (marchEnd.getDay()));

                    const octEnd = new Date(year, 10, 0);
                    const octLastSunday = new Date(year, 9, octEnd.getDate() - (octEnd.getDay()));

                    return { start: marchLastSunday, end: octLastSunday };
                }
            },
            {
                name: 'Moscow',
                baseOffset: 3,  // UTC+3 (MSK)
                dstOffset: 3,   // No DST
                hasDST: false,
                getDSTRange: () => null
            },
            {
                name: 'Dubai',
                baseOffset: 4,  // UTC+4 (GST)
                dstOffset: 4,   // No DST
                hasDST: false,
                getDSTRange: () => null
            }
        ];

        // State
        let simulatedDate = null;
        const clockSize = 160;
        const dpr = window.devicePixelRatio || 1;

        // Check if DST is active for a city on a given date
        function isDSTActive(city, date) {
            if (!city.hasDST) return false;

            const year = date.getFullYear();
            const range = city.getDSTRange(year);
            if (!range) return false;

            // Set times to midnight for comparison
            const checkDate = new Date(date.getFullYear(), date.getMonth(), date.getDate());
            const start = new Date(range.start.getFullYear(), range.start.getMonth(), range.start.getDate());
            const end = new Date(range.end.getFullYear(), range.end.getMonth(), range.end.getDate());

            return checkDate >= start && checkDate < end;
        }

        // Get current offset for a city
        function getCurrentOffset(city, date) {
            return isDSTActive(city, date) ? city.dstOffset : city.baseOffset;
        }

        // Format offset string
        function formatOffset(offset) {
            const sign = offset >= 0 ? '+' : '';
            return `UTC${sign}${offset}`;
        }

        // Get time for a city
        function getCityTime(city, baseTime) {
            const offset = getCurrentOffset(city, baseTime);
            const utc = baseTime.getTime() + baseTime.getTimezoneOffset() * 60000;
            return new Date(utc + offset * 3600000);
        }

        // Create clock canvas
        function createClockCanvas() {
            const canvas = document.createElement('canvas');
            canvas.className = 'clock-canvas';
            canvas.width = clockSize * dpr;
            canvas.height = clockSize * dpr;
            canvas.style.width = clockSize + 'px';
            canvas.style.height = clockSize + 'px';
            return canvas;
        }

        // Draw analog clock
        function drawClock(canvas, time, city) {
            const ctx = canvas.getContext('2d');
            const size = clockSize * dpr;
            const center = size / 2;
            const radius = (size / 2) - 10 * dpr;

            // Clear canvas
            ctx.clearRect(0, 0, size, size);

            // Clock face background
            const gradient = ctx.createRadialGradient(center, center, 0, center, center, radius);
            gradient.addColorStop(0, '#FFFFFF');
            gradient.addColorStop(1, '#F4F1DE');

            ctx.beginPath();
            ctx.arc(center, center, radius, 0, Math.PI * 2);
            ctx.fillStyle = gradient;
            ctx.fill();

            // Clock border
            ctx.beginPath();
            ctx.arc(center, center, radius, 0, Math.PI * 2);
            ctx.strokeStyle = '#606C38';
            ctx.lineWidth = 3 * dpr;
            ctx.stroke();

            // Hour markers
            for (let i = 0; i < 12; i++) {
                const angle = (i * 30 - 90) * Math.PI / 180;
                const isMainHour = i % 3 === 0;
                const innerRadius = radius - (isMainHour ? 20 * dpr : 12 * dpr);
                const outerRadius = radius - 5 * dpr;

                ctx.beginPath();
                ctx.moveTo(
                    center + Math.cos(angle) * innerRadius,
                    center + Math.sin(angle) * innerRadius
                );
                ctx.lineTo(
                    center + Math.cos(angle) * outerRadius,
                    center + Math.sin(angle) * outerRadius
                );
                ctx.strokeStyle = isMainHour ? '#606C38' : '#8A9A5B';
                ctx.lineWidth = (isMainHour ? 3 : 2) * dpr;
                ctx.stroke();
            }

            // Minute markers
            for (let i = 0; i < 60; i++) {
                if (i % 5 !== 0) {
                    const angle = (i * 6 - 90) * Math.PI / 180;
                    const innerRadius = radius - 8 * dpr;
                    const outerRadius = radius - 4 * dpr;

                    ctx.beginPath();
                    ctx.moveTo(
                        center + Math.cos(angle) * innerRadius,
                        center + Math.sin(angle) * innerRadius
                    );
                    ctx.lineTo(
                        center + Math.cos(angle) * outerRadius,
                        center + Math.sin(angle) * outerRadius
                    );
                    ctx.strokeStyle = '#C4C4B0';
                    ctx.lineWidth = 1 * dpr;
                    ctx.stroke();
                }
            }

            const hours = time.getHours();
            const minutes = time.getMinutes();
            const seconds = time.getSeconds();
            const milliseconds = time.getMilliseconds();

            // Smooth second calculation
            const smoothSeconds = seconds + milliseconds / 1000;
            const smoothMinutes = minutes + smoothSeconds / 60;
            const smoothHours = hours + smoothMinutes / 60;

            // Hour hand
            const hourAngle = (smoothHours * 30 - 90) * Math.PI / 180;
            const hourLength = radius * 0.5;
            ctx.beginPath();
            ctx.moveTo(center, center);
            ctx.lineTo(
                center + Math.cos(hourAngle) * hourLength,
                center + Math.sin(hourAngle) * hourLength
            );
            ctx.strokeStyle = '#3d4423';
            ctx.lineWidth = 5 * dpr;
            ctx.lineCap = 'round';
            ctx.stroke();

            // Minute hand
            const minuteAngle = (smoothMinutes * 6 - 90) * Math.PI / 180;
            const minuteLength = radius * 0.7;
            ctx.beginPath();
            ctx.moveTo(center, center);
            ctx.lineTo(
                center + Math.cos(minuteAngle) * minuteLength,
                center + Math.sin(minuteAngle) * minuteLength
            );
            ctx.strokeStyle = '#606C38';
            ctx.lineWidth = 3 * dpr;
            ctx.lineCap = 'round';
            ctx.stroke();

            // Second hand (smooth)
            const secondAngle = (smoothSeconds * 6 - 90) * Math.PI / 180;
            const secondLength = radius * 0.8;
            ctx.beginPath();
            ctx.moveTo(center, center);
            ctx.lineTo(
                center + Math.cos(secondAngle) * secondLength,
                center + Math.sin(secondAngle) * secondLength
            );
            ctx.strokeStyle = '#BC6C25';
            ctx.lineWidth = 1.5 * dpr;
            ctx.lineCap = 'round';
            ctx.stroke();

            // Center dot
            ctx.beginPath();
            ctx.arc(center, center, 6 * dpr, 0, Math.PI * 2);
            ctx.fillStyle = '#BC6C25';
            ctx.fill();

            ctx.beginPath();
            ctx.arc(center, center, 3 * dpr, 0, Math.PI * 2);
            ctx.fillStyle = '#FEFAE0';
            ctx.fill();
        }

        // Format time string
        function formatTime(date) {
            return date.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            });
        }

        // Initialize clocks
        function initClocks() {
            const container = document.getElementById('clocks-container');
            container.innerHTML = '';

            cities.forEach((city, index) => {
                const wrapper = document.createElement('div');
                wrapper.className = 'clock-wrapper';
                wrapper.id = `clock-${index}`;

                const canvas = createClockCanvas();
                canvas.id = `canvas-${index}`;

                const cityName = document.createElement('div');
                cityName.className = 'city-name';
                cityName.textContent = city.name;

                const timeInfo = document.createElement('div');
                timeInfo.className = 'time-info';
                timeInfo.id = `time-${index}`;

                const utcOffset = document.createElement('div');
                utcOffset.className = 'utc-offset';
                utcOffset.id = `offset-${index}`;

                const dstStatus = document.createElement('div');
                dstStatus.className = 'dst-status';
                dstStatus.id = `dst-${index}`;

                wrapper.appendChild(canvas);
                wrapper.appendChild(cityName);
                wrapper.appendChild(timeInfo);
                wrapper.appendChild(utcOffset);
                wrapper.appendChild(dstStatus);
                container.appendChild(wrapper);
            });
        }

        // Update all clocks
        function updateClocks() {
            const now = new Date();
            const baseTime = simulatedDate
                ? new Date(simulatedDate.getFullYear(), simulatedDate.getMonth(), simulatedDate.getDate(),
                           now.getHours(), now.getMinutes(), now.getSeconds(), now.getMilliseconds())
                : now;

            cities.forEach((city, index) => {
                const cityTime = getCityTime(city, baseTime);
                const canvas = document.getElementById(`canvas-${index}`);
                const timeEl = document.getElementById(`time-${index}`);
                const offsetEl = document.getElementById(`offset-${index}`);
                const dstEl = document.getElementById(`dst-${index}`);

                drawClock(canvas, cityTime, city);
                timeEl.textContent = formatTime(cityTime);

                const offset = getCurrentOffset(city, baseTime);
                offsetEl.textContent = formatOffset(offset);

                if (city.hasDST) {
                    const dstActive = isDSTActive(city, baseTime);
                    dstEl.textContent = dstActive ? 'DST Active' : 'Standard Time';
                    dstEl.className = `dst-status ${dstActive ? 'dst-active' : 'dst-inactive'}`;
                } else {
                    dstEl.textContent = 'No DST';
                    dstEl.className = 'dst-status dst-inactive';
                }
            });
        }

        // Apply simulated date
        function applySimulatedDate() {
            const dateInput = document.getElementById('date-selector');
            if (dateInput.value) {
                const parts = dateInput.value.split('-');
                simulatedDate = new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, parseInt(parts[2]));
            }
        }

        // Reset to current date/time
        function resetToNow() {
            simulatedDate = null;
            document.getElementById('date-selector').value = '';
        }

        // Initialize
        document.getElementById('date-selector').valueAsDate = new Date();
        initClocks();

        // Animation loop
        function animate() {
            updateClocks();
            requestAnimationFrame(animate);
        }
        // Expose for enhance.js keyboard shortcuts
        window.reset = function() {
            document.getElementById('date-selector').valueAsDate = new Date();
            initClocks();
        };

        animate();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
