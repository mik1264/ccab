<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hour-by-Hour Matrix Grid - Timezone Tools</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600;700&family=Nunito:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --sage: #8A9A5B;
            --moss: #606C38;
            --earth: #DDA15E;
            --cream: #FEFAE0;
            --terracotta: #BC6C25;
            --dark-moss: #3d4423;
            --working: #4ade80;
            --working-bg: rgba(74, 222, 128, 0.2);
            --transition: #fbbf24;
            --transition-bg: rgba(251, 191, 36, 0.2);
            --night: #f87171;
            --night-bg: rgba(248, 113, 113, 0.15);
            --overlap-highlight: rgba(74, 222, 128, 0.35);
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #FEFAE0 0%, #F4F1DE 50%, #EDE8D5 100%);
            color: var(--moss);
            line-height: 1.6;
            min-height: 100vh;
            padding: 1rem;
        }

        .organic-shape {
            position: fixed;
            border-radius: 63% 37% 54% 46% / 55% 48% 52% 45%;
            opacity: 0.08;
            animation: morph 30s infinite ease-in-out;
            z-index: 0;
            pointer-events: none;
        }

        .shape-1 {
            width: 500px;
            height: 500px;
            background: var(--sage);
            top: -100px;
            left: -100px;
        }

        .shape-2 {
            width: 350px;
            height: 350px;
            background: var(--earth);
            bottom: -50px;
            right: -50px;
            animation-delay: -10s;
        }

        @keyframes morph {
            0%, 100% {
                border-radius: 63% 37% 54% 46% / 55% 48% 52% 45%;
                transform: rotate(0deg) scale(1);
            }
            25% {
                border-radius: 40% 60% 70% 30% / 40% 40% 60% 60%;
                transform: rotate(90deg) scale(1.05);
            }
            50% {
                border-radius: 50% 50% 33% 67% / 55% 27% 73% 45%;
                transform: rotate(180deg) scale(1);
            }
            75% {
                border-radius: 70% 30% 50% 50% / 30% 65% 35% 70%;
                transform: rotate(270deg) scale(0.95);
            }
        }

        .organic-back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 10000;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--terracotta);
            text-decoration: none;
            font-weight: 600;
            padding: 0.5rem 1rem;
            background: rgba(254, 250, 224, 0.95);
            border-radius: 20px;
            border: 2px solid rgba(138, 154, 91, 0.3);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(96, 108, 56, 0.15);
        }

        .organic-back-link:hover {
            background: rgba(254, 250, 224, 1);
            transform: translateX(-5px);
            border-color: var(--earth);
            box-shadow: 0 6px 20px rgba(96, 108, 56, 0.25);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            padding: 3rem 1rem 1.5rem;
            margin-bottom: 1rem;
        }

        h1 {
            font-family: 'Lora', serif;
            font-size: clamp(1.8rem, 4vw, 2.5rem);
            font-weight: 700;
            color: var(--moss);
            margin-bottom: 0.5rem;
        }

        .subtitle {
            font-size: 1rem;
            color: var(--terracotta);
            font-weight: 500;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
            align-items: center;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 2px solid rgba(138, 154, 91, 0.2);
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .control-group label {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--dark-moss);
        }

        select, input[type="date"] {
            padding: 0.5rem 1rem;
            border: 2px solid rgba(138, 154, 91, 0.3);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.9);
            font-family: 'Nunito', sans-serif;
            font-size: 0.9rem;
            color: var(--dark-moss);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        select:hover, input[type="date"]:hover {
            border-color: var(--earth);
        }

        select:focus, input[type="date"]:focus {
            outline: none;
            border-color: var(--sage);
            box-shadow: 0 0 0 3px rgba(138, 154, 91, 0.2);
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 1rem;
            font-size: 0.85rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .legend-color.working { background: var(--working-bg); border-color: var(--working); }
        .legend-color.transition { background: var(--transition-bg); border-color: var(--transition); }
        .legend-color.night { background: var(--night-bg); border-color: var(--night); }
        .legend-color.overlap { background: var(--overlap-highlight); border-color: var(--working); }

        .matrix-wrapper {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 2px solid rgba(138, 154, 91, 0.2);
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(96, 108, 56, 0.1);
        }

        .matrix-scroll {
            overflow-x: auto;
            padding: 1rem;
        }

        .matrix {
            border-collapse: collapse;
            width: 100%;
            min-width: 900px;
        }

        .matrix th, .matrix td {
            padding: 0.5rem 0.3rem;
            text-align: center;
            border: 1px solid rgba(138, 154, 91, 0.15);
            font-size: 0.85rem;
            transition: all 0.2s ease;
        }

        .matrix th {
            background: rgba(138, 154, 91, 0.15);
            font-weight: 700;
            color: var(--dark-moss);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .matrix th.hour-header {
            font-family: 'Lora', serif;
            font-size: 0.8rem;
            min-width: 50px;
        }

        .matrix th.city-header {
            text-align: left;
            padding-left: 1rem;
            min-width: 120px;
            position: sticky;
            left: 0;
            background: rgba(138, 154, 91, 0.2);
            z-index: 20;
        }

        .matrix td.city-name {
            text-align: left;
            padding-left: 1rem;
            font-weight: 600;
            color: var(--dark-moss);
            position: sticky;
            left: 0;
            background: rgba(255, 255, 255, 0.95);
            z-index: 5;
            border-right: 2px solid rgba(138, 154, 91, 0.3);
        }

        .matrix td.time-cell {
            font-family: 'Nunito', sans-serif;
            font-weight: 500;
            min-width: 50px;
        }

        .matrix td.working {
            background: var(--working-bg);
            color: #166534;
        }

        .matrix td.transition {
            background: var(--transition-bg);
            color: #92400e;
        }

        .matrix td.night {
            background: var(--night-bg);
            color: #991b1b;
        }

        .matrix td.current-hour {
            box-shadow: inset 0 0 0 2px var(--terracotta);
        }

        .matrix th.current-hour {
            background: rgba(188, 108, 37, 0.3);
            color: var(--terracotta);
        }

        .matrix th.overlap-col,
        .matrix td.overlap-col {
            background: var(--overlap-highlight) !important;
        }

        .matrix td.overlap-col.working {
            background: rgba(74, 222, 128, 0.45) !important;
        }

        .matrix tr:hover td:not(.city-name) {
            filter: brightness(0.95);
        }

        .overlap-info {
            text-align: center;
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(74, 222, 128, 0.15);
            border-radius: 12px;
            border: 2px solid rgba(74, 222, 128, 0.3);
        }

        .overlap-info strong {
            color: var(--dark-moss);
        }

        .overlap-hours {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
            margin-top: 0.5rem;
        }

        .overlap-hour {
            background: var(--working);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .city-offset {
            font-size: 0.75rem;
            color: var(--terracotta);
            font-weight: normal;
        }

        .footer {
            text-align: center;
            padding: 1.5rem;
            margin-top: 1.5rem;
            color: var(--moss);
            opacity: 0.7;
            font-size: 0.85rem;
        }

        @media (max-width: 768px) {
            .header {
                padding: 4rem 1rem 1rem;
            }

            .controls {
                flex-direction: column;
            }

            .control-group {
                width: 100%;
                justify-content: space-between;
            }

            select, input[type="date"] {
                flex: 1;
            }

            .matrix th, .matrix td {
                padding: 0.4rem 0.2rem;
                font-size: 0.75rem;
            }

            .matrix th.hour-header {
                min-width: 40px;
            }

            .matrix td.city-name {
                min-width: 80px;
                font-size: 0.7rem;
            }
        }
    </style>
</head>
<body>
    <div class="organic-shape shape-1"></div>
    <div class="organic-shape shape-2"></div>

    <a href="index.html" class="organic-back-link">
        <span class="back-arrow">‚Üê</span>
        <span class="back-text">Timezone Tools</span>
    </a>

    <div class="container">
        <header class="header">
            <h1>Hour-by-Hour Matrix Grid</h1>
            <p class="subtitle">Visualize working hours across time zones</p>
        </header>

        <div class="controls">
            <div class="control-group">
                <label for="reference-tz">Reference Timezone:</label>
                <select id="reference-tz">
                    <option value="UTC">UTC</option>
                    <option value="Miami">Miami</option>
                    <option value="London">London</option>
                    <option value="Malta">Malta</option>
                    <option value="Moscow">Moscow</option>
                    <option value="Dubai">Dubai</option>
                </select>
            </div>
            <div class="control-group">
                <label for="date-picker">Date:</label>
                <input type="date" id="date-picker">
            </div>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color working"></div>
                <span>Working (9AM-6PM)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color transition"></div>
                <span>Early/Late (7-9AM, 6-8PM)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color night"></div>
                <span>Night</span>
            </div>
            <div class="legend-item">
                <div class="legend-color overlap"></div>
                <span>All Working</span>
            </div>
        </div>

        <div class="matrix-wrapper">
            <div class="matrix-scroll">
                <table class="matrix" id="matrix-table">
                    <!-- Generated by JavaScript -->
                </table>
            </div>
            <div class="overlap-info" id="overlap-info">
                <!-- Generated by JavaScript -->
            </div>
        </div>

        <footer class="footer">
            <p>Part of CCAB - Creative Code and Algorithmic Beauty</p>
        </footer>
    </div>

    <script>
        // City timezone data with DST handling
        const cities = [
            { name: 'Miami', winterOffset: -5, summerOffset: -4, dstStart: { month: 3, week: 2 }, dstEnd: { month: 11, week: 1 } },
            { name: 'London', winterOffset: 0, summerOffset: 1, dstStart: { month: 3, lastSunday: true }, dstEnd: { month: 10, lastSunday: true } },
            { name: 'Malta', winterOffset: 1, summerOffset: 2, dstStart: { month: 3, lastSunday: true }, dstEnd: { month: 10, lastSunday: true } },
            { name: 'Moscow', winterOffset: 3, summerOffset: 3, dstStart: null, dstEnd: null },
            { name: 'Dubai', winterOffset: 4, summerOffset: 4, dstStart: null, dstEnd: null }
        ];

        // Get the nth Sunday of a month
        function getNthSunday(year, month, n) {
            const firstDay = new Date(year, month - 1, 1);
            const firstSunday = 1 + (7 - firstDay.getDay()) % 7;
            return new Date(year, month - 1, firstSunday + (n - 1) * 7);
        }

        // Get the last Sunday of a month
        function getLastSunday(year, month) {
            const lastDay = new Date(year, month, 0);
            const dayOfWeek = lastDay.getDay();
            return new Date(year, month - 1, lastDay.getDate() - dayOfWeek);
        }

        // Check if a date is in DST for a city
        function isDST(city, date) {
            if (!city.dstStart || !city.dstEnd) return false;

            const year = date.getFullYear();
            let dstStartDate, dstEndDate;

            if (city.dstStart.lastSunday) {
                dstStartDate = getLastSunday(year, city.dstStart.month);
            } else {
                dstStartDate = getNthSunday(year, city.dstStart.month, city.dstStart.week);
            }

            if (city.dstEnd.lastSunday) {
                dstEndDate = getLastSunday(year, city.dstEnd.month);
            } else {
                dstEndDate = getNthSunday(year, city.dstEnd.month, city.dstEnd.week);
            }

            return date >= dstStartDate && date < dstEndDate;
        }

        // Get UTC offset for a city on a specific date
        function getOffset(city, date) {
            return isDST(city, date) ? city.summerOffset : city.winterOffset;
        }

        // Get reference timezone offset
        function getReferenceOffset(referenceTz, date) {
            if (referenceTz === 'UTC') return 0;
            const city = cities.find(c => c.name === referenceTz);
            return city ? getOffset(city, date) : 0;
        }

        // Classify hour type for a local time
        function getHourType(localHour) {
            if (localHour >= 9 && localHour < 18) return 'working';
            if ((localHour >= 7 && localHour < 9) || (localHour >= 18 && localHour < 20)) return 'transition';
            return 'night';
        }

        // Format hour for display
        function formatHour(hour) {
            const h = ((hour % 24) + 24) % 24;
            const suffix = h < 12 ? 'a' : 'p';
            const displayHour = h === 0 ? 12 : (h > 12 ? h - 12 : h);
            return `${displayHour}${suffix}`;
        }

        // Format hour for header (reference timezone)
        function formatHeaderHour(hour) {
            const h = ((hour % 24) + 24) % 24;
            return `${h.toString().padStart(2, '0')}:00`;
        }

        // Get current hour in reference timezone
        function getCurrentHourInReference(referenceTz, date) {
            const now = new Date();
            const refOffset = getReferenceOffset(referenceTz, date);
            const utcHour = now.getUTCHours();
            return (utcHour + refOffset + 24) % 24;
        }

        // Build and render the matrix
        function renderMatrix() {
            const referenceTz = document.getElementById('reference-tz').value;
            const dateInput = document.getElementById('date-picker').value;
            const selectedDate = dateInput ? new Date(dateInput) : new Date();

            const refOffset = getReferenceOffset(referenceTz, selectedDate);
            const currentHour = getCurrentHourInReference(referenceTz, selectedDate);

            const table = document.getElementById('matrix-table');
            let html = '<thead><tr><th class="city-header">City</th>';

            // Header row with hours in reference timezone
            for (let h = 0; h < 24; h++) {
                const isCurrentHour = h === currentHour;
                html += `<th class="hour-header${isCurrentHour ? ' current-hour' : ''}">${formatHeaderHour(h)}</th>`;
            }
            html += '</tr></thead><tbody>';

            // Track working hours for overlap detection
            const workingHoursPerColumn = Array(24).fill(0);

            // Rows for each city
            cities.forEach(city => {
                const cityOffset = getOffset(city, selectedDate);
                const offsetDiff = cityOffset - refOffset;
                const offsetStr = cityOffset >= 0 ? `+${cityOffset}` : `${cityOffset}`;

                html += `<tr><td class="city-name">${city.name} <span class="city-offset">UTC${offsetStr}</span></td>`;

                for (let refHour = 0; refHour < 24; refHour++) {
                    const localHour = (refHour + offsetDiff + 24) % 24;
                    const hourType = getHourType(localHour);
                    const isCurrentHour = refHour === currentHour;

                    if (hourType === 'working') {
                        workingHoursPerColumn[refHour]++;
                    }

                    html += `<td class="time-cell ${hourType}${isCurrentHour ? ' current-hour' : ''}" data-ref-hour="${refHour}">${formatHour(localHour)}</td>`;
                }
                html += '</tr>';
            });

            html += '</tbody>';
            table.innerHTML = html;

            // Find overlap columns (all cities working)
            const overlapHours = [];
            for (let h = 0; h < 24; h++) {
                if (workingHoursPerColumn[h] === cities.length) {
                    overlapHours.push(h);
                    // Mark header
                    const headers = table.querySelectorAll('th.hour-header');
                    if (headers[h]) headers[h].classList.add('overlap-col');
                    // Mark cells
                    table.querySelectorAll(`td[data-ref-hour="${h}"]`).forEach(cell => {
                        cell.classList.add('overlap-col');
                    });
                }
            }

            // Update overlap info
            const overlapInfo = document.getElementById('overlap-info');
            if (overlapHours.length > 0) {
                const hoursHtml = overlapHours.map(h =>
                    `<span class="overlap-hour">${formatHeaderHour(h)} ${referenceTz}</span>`
                ).join('');
                overlapInfo.innerHTML = `<strong>All cities have working hours (9AM-6PM) during:</strong><div class="overlap-hours">${hoursHtml}</div>`;
                overlapInfo.style.display = 'block';
            } else {
                overlapInfo.innerHTML = '<strong>No hours where all cities have standard working hours (9AM-6PM)</strong>';
                overlapInfo.style.display = 'block';
            }
        }

        // Initialize
        function init() {
            // Set default date to today
            const today = new Date();
            const dateStr = today.toISOString().split('T')[0];
            document.getElementById('date-picker').value = dateStr;

            // Event listeners
            document.getElementById('reference-tz').addEventListener('change', renderMatrix);
            document.getElementById('date-picker').addEventListener('change', renderMatrix);

            // Initial render
            renderMatrix();

            // Update every minute for current hour highlighting
            setInterval(renderMatrix, 60000);
        }

        init();
    </script>
</body>
</html>
