<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Genetic Drift vs Selection</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 100%);
            font-family: 'Segoe UI', Arial, sans-serif;
            color: white;
        }
        .container {
            display: flex;
            height: 100vh;
        }
        .canvas-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 15px;
            padding: 20px;
        }
        .title {
            color: #ffd93d;
            font-size: 18px;
            margin: 0;
        }
        canvas {
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
        }
        .controls {
            width: 350px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.6);
            overflow-y: auto;
        }
        h2 { margin: 0 0 10px 0; color: #00d9ff; }
        h3 { margin: 15px 0 8px 0; color: #ff6b9d; font-size: 14px; }
        .slider-group { margin: 10px 0; }
        .slider-group label { display: block; margin-bottom: 5px; font-size: 12px; }
        input[type="range"] { width: 100%; }
        .comparison {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        .comparison-box {
            flex: 1;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            text-align: center;
        }
        .comparison-box.drift { border-left: 3px solid #ff6b6b; }
        .comparison-box.selection { border-left: 3px solid #4ecdc4; }
        .stat { margin: 5px 0; font-size: 13px; }
        .description {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            border-radius: 8px;
            font-size: 12px;
            line-height: 1.5;
            margin-top: 15px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            background: #00d9ff;
            color: #0f0f23;
            font-weight: bold;
        }
        button:hover { background: #00c4e6; }
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            font-size: 12px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <a href="../index.html" class="organic-back-link" style="position: fixed; top: 20px; right: 20px; z-index: 1000; display: flex; align-items: center; gap: 8px; padding: 10px 16px; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); border-radius: 30px; text-decoration: none; color: #606C38; font-family: 'Nunito', sans-serif; font-weight: 600; box-shadow: 0 2px 10px rgba(0,0,0,0.1); transition: all 0.3s ease;">
        <span class="back-arrow">‚Üê</span>
        <span class="back-text">Gallery</span>
    </a>
    <div class="container">
        <div class="canvas-area">
            <p class="title">üé≤ Genetic Drift (Random Sampling)</p>
            <canvas id="driftCanvas"></canvas>
            <p class="title">üéØ Natural Selection (Fitness-Based)</p>
            <canvas id="selectionCanvas"></canvas>
            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background: #ff6b6b;"></div> Allele A</div>
                <div class="legend-item"><div class="legend-color" style="background: #4ecdc4;"></div> Allele a</div>
            </div>
        </div>
        <div class="controls">
            <h2>‚öîÔ∏è Drift vs Selection</h2>
            <p style="font-size: 12px; opacity: 0.8;">Compare random genetic drift with natural selection</p>

            <h3>Population Parameters</h3>
            <div class="slider-group">
                <label>Population Size: <span id="popSizeVal">50</span></label>
                <input type="range" id="popSize" min="10" max="200" step="10" value="50">
            </div>
            <div class="slider-group">
                <label>Initial A Frequency: <span id="initFreqVal">0.5</span></label>
                <input type="range" id="initFreq" min="0.1" max="0.9" step="0.1" value="0.5">
            </div>

            <h3>Selection Strength</h3>
            <div class="slider-group">
                <label>Fitness advantage of A: <span id="selectionVal">10%</span></label>
                <input type="range" id="selectionStrength" min="0" max="50" step="5" value="10">
            </div>

            <h3>Replicates</h3>
            <div class="slider-group">
                <label>Number of populations: <span id="replicatesVal">10</span></label>
                <input type="range" id="replicates" min="1" max="20" step="1" value="10">
            </div>

            <button onclick="resetSimulation()">Reset All</button>
            <button onclick="togglePause()">Pause/Play</button>

            <div class="comparison">
                <div class="comparison-box drift">
                    <strong>Drift</strong>
                    <div class="stat">Fixations: <span id="driftFixations">0</span></div>
                    <div class="stat">Losses: <span id="driftLosses">0</span></div>
                    <div class="stat">Mean p: <span id="driftMean">0.5</span></div>
                </div>
                <div class="comparison-box selection">
                    <strong>Selection</strong>
                    <div class="stat">Fixations: <span id="selFixations">0</span></div>
                    <div class="stat">Losses: <span id="selLosses">0</span></div>
                    <div class="stat">Mean p: <span id="selMean">0.5</span></div>
                </div>
            </div>

            <div class="stat">Generation: <span id="generation">0</span></div>

            <div class="description">
                <strong>Genetic Drift:</strong> Random sampling causes allele frequencies to fluctuate. In small populations, alleles can be lost or fixed purely by chance.<br><br>
                <strong>Natural Selection:</strong> Alleles with fitness advantages tend to increase in frequency over time. Selection is more predictable but drift still affects small populations.<br><br>
                <strong>Key insight:</strong> In small populations, drift can overpower weak selection. Selection dominates in large populations or with strong fitness differences.
            </div>
        </div>
    </div>

    <script>
        const driftCanvas = document.getElementById('driftCanvas');
        const driftCtx = driftCanvas.getContext('2d');
        const selCanvas = document.getElementById('selectionCanvas');
        const selCtx = selCanvas.getContext('2d');

        driftCanvas.width = 700;
        driftCanvas.height = 200;
        selCanvas.width = 700;
        selCanvas.height = 200;

        let popSize = 50;
        let initFreq = 0.5;
        let selectionStrength = 0.1;
        let numReplicates = 10;
        let generation = 0;
        let paused = false;

        let driftPopulations = [];
        let selectionPopulations = [];
        const maxGenerations = 300;

        function initPopulations() {
            driftPopulations = [];
            selectionPopulations = [];

            for (let i = 0; i < numReplicates; i++) {
                driftPopulations.push({
                    history: [initFreq],
                    current: initFreq,
                    fixed: false,
                    color: `hsl(${(i / numReplicates) * 60 + 10}, 70%, 60%)`
                });

                selectionPopulations.push({
                    history: [initFreq],
                    current: initFreq,
                    fixed: false,
                    color: `hsl(${(i / numReplicates) * 60 + 160}, 70%, 60%)`
                });
            }

            generation = 0;
        }

        function simulateGeneration() {
            if (paused) return;
            if (generation >= maxGenerations) return;

            // Simulate drift populations (pure random sampling)
            driftPopulations.forEach(pop => {
                if (pop.fixed) {
                    pop.history.push(pop.current);
                    return;
                }

                // Binomial sampling
                let aCount = 0;
                for (let i = 0; i < popSize * 2; i++) {
                    if (Math.random() < pop.current) aCount++;
                }
                pop.current = aCount / (popSize * 2);

                // Check for fixation/loss
                if (pop.current >= 0.999 || pop.current <= 0.001) {
                    pop.current = pop.current >= 0.5 ? 1 : 0;
                    pop.fixed = true;
                }

                pop.history.push(pop.current);
            });

            // Simulate selection populations
            selectionPopulations.forEach(pop => {
                if (pop.fixed) {
                    pop.history.push(pop.current);
                    return;
                }

                const p = pop.current;
                const q = 1 - p;

                // Fitness values: A has advantage
                const wAA = 1 + selectionStrength;
                const wAa = 1 + selectionStrength / 2;
                const waa = 1;

                // Mean fitness
                const wBar = p * p * wAA + 2 * p * q * wAa + q * q * waa;

                // Change in allele frequency due to selection
                const pNext = (p * p * wAA + p * q * wAa) / wBar;

                // Add drift on top of selection
                let aCount = 0;
                for (let i = 0; i < popSize * 2; i++) {
                    if (Math.random() < pNext) aCount++;
                }
                pop.current = aCount / (popSize * 2);

                if (pop.current >= 0.999 || pop.current <= 0.001) {
                    pop.current = pop.current >= 0.5 ? 1 : 0;
                    pop.fixed = true;
                }

                pop.history.push(pop.current);
            });

            generation++;
            updateStats();
        }

        function updateStats() {
            document.getElementById('generation').textContent = generation;

            // Drift stats
            const driftFixed = driftPopulations.filter(p => p.fixed && p.current === 1).length;
            const driftLost = driftPopulations.filter(p => p.fixed && p.current === 0).length;
            const driftMean = driftPopulations.reduce((sum, p) => sum + p.current, 0) / numReplicates;

            document.getElementById('driftFixations').textContent = driftFixed;
            document.getElementById('driftLosses').textContent = driftLost;
            document.getElementById('driftMean').textContent = driftMean.toFixed(3);

            // Selection stats
            const selFixed = selectionPopulations.filter(p => p.fixed && p.current === 1).length;
            const selLost = selectionPopulations.filter(p => p.fixed && p.current === 0).length;
            const selMean = selectionPopulations.reduce((sum, p) => sum + p.current, 0) / numReplicates;

            document.getElementById('selFixations').textContent = selFixed;
            document.getElementById('selLosses').textContent = selLost;
            document.getElementById('selMean').textContent = selMean.toFixed(3);
        }

        function drawCanvas(ctx, populations, title) {
            ctx.fillStyle = 'rgba(15, 15, 35, 0.3)';
            ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);

            // Draw 0.5 line
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(0, ctx.canvas.height / 2);
            ctx.lineTo(ctx.canvas.width, ctx.canvas.height / 2);
            ctx.stroke();
            ctx.setLineDash([]);

            // Draw population trajectories
            populations.forEach(pop => {
                ctx.strokeStyle = pop.color;
                ctx.lineWidth = pop.fixed ? 1 : 2;
                ctx.globalAlpha = pop.fixed ? 0.5 : 1;
                ctx.beginPath();

                const startIdx = Math.max(0, pop.history.length - maxGenerations);
                for (let i = startIdx; i < pop.history.length; i++) {
                    const x = ((i - startIdx) / maxGenerations) * ctx.canvas.width;
                    const y = ctx.canvas.height - pop.history[i] * ctx.canvas.height;

                    if (i === startIdx) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.stroke();
                ctx.globalAlpha = 1;
            });

            // Draw mean line
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.beginPath();

            for (let i = 0; i < Math.min(generation + 1, maxGenerations); i++) {
                const mean = populations.reduce((sum, p) =>
                    sum + (p.history[i] || p.current), 0) / numReplicates;
                const x = (i / maxGenerations) * ctx.canvas.width;
                const y = ctx.canvas.height - mean * ctx.canvas.height;

                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
        }

        function resetSimulation() {
            popSize = parseInt(document.getElementById('popSize').value);
            initFreq = parseFloat(document.getElementById('initFreq').value);
            selectionStrength = parseInt(document.getElementById('selectionStrength').value) / 100;
            numReplicates = parseInt(document.getElementById('replicates').value);
            initPopulations();
        }

        function togglePause() {
            paused = !paused;
        }

        // Event listeners
        document.getElementById('popSize').oninput = function() {
            document.getElementById('popSizeVal').textContent = this.value;
        };

        document.getElementById('initFreq').oninput = function() {
            document.getElementById('initFreqVal').textContent = this.value;
        };

        document.getElementById('selectionStrength').oninput = function() {
            document.getElementById('selectionVal').textContent = this.value + '%';
        };

        document.getElementById('replicates').oninput = function() {
            document.getElementById('replicatesVal').textContent = this.value;
        };

        initPopulations();

        function animate() {
            drawCanvas(driftCtx, driftPopulations, 'Genetic Drift');
            drawCanvas(selCtx, selectionPopulations, 'Natural Selection');

            simulateGeneration();

            requestAnimationFrame(animate);
        }

        animate();
    </script>
</body>
</html>
