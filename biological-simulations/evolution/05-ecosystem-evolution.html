<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ecosystem Evolution</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: linear-gradient(180deg, #87CEEB 0%, #98D8C8 50%, #6A9C89 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: Arial, sans-serif;
        }
        canvas {
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        .info {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 8px;
            text-shadow: 1px 1px 2px black;
        }
    </style>
</head>
<body>
    <a href="../index.html" class="organic-back-link" style="position: fixed; top: 20px; right: 20px; z-index: 1000; display: flex; align-items: center; gap: 8px; padding: 10px 16px; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); border-radius: 30px; text-decoration: none; color: #606C38; font-family: 'Nunito', sans-serif; font-weight: 600; box-shadow: 0 2px 10px rgba(0,0,0,0.1); transition: all 0.3s ease;">
        <span class="back-arrow">‚Üê</span>
        <span class="back-text">Gallery</span>
    </a>
    <div class="info">
        <h3>Ecosystem Evolution</h3>
        <p>üåø Plants ‚Üí üê∞ Herbivores ‚Üí ü¶ä Carnivores</p>
        <div id="stats"></div>
    </div>
    <canvas id="canvas"></canvas>
    <script src="../../assets/js/demo-utils.js"></script>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 1200;
        canvas.height = 800;

        // Initialize demo utilities
        const fps = new FPSCounter({ position: 'top-right' });
        const errorMgr = new ErrorManager();
        setupGlobalErrorHandler((msg, details) => errorMgr.show(msg, details));
        fps.start();

        class Plant {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.size = 5;
                this.energy = 20;
            }

            grow() {
                if (this.size < 10) this.size += 0.05;
            }

            draw() {
                ctx.fillStyle = '#27ae60';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        class Herbivore {
            constructor(x, y, speed) {
                this.x = x;
                this.y = y;
                this.speed = speed || (Math.random() * 1.5 + 0.5);
                this.angle = Math.random() * Math.PI * 2;
                this.energy = 50;
                this.size = 8;
            }

            update(plants) {
                this.angle += (Math.random() - 0.5) * 0.5;
                this.x += Math.cos(this.angle) * this.speed;
                this.y += Math.sin(this.angle) * this.speed;

                if (this.x > canvas.width) this.x = 0;
                else if (this.x < 0) this.x = canvas.width;
                if (this.y > canvas.height) this.y = 0;
                else if (this.y < 0) this.y = canvas.height;

                this.energy -= 0.1;

                // Eat plants
                for (let i = plants.length - 1; i >= 0; i--) {
                    const dx = this.x - plants[i].x;
                    const dy = this.y - plants[i].y;
                    if (Math.sqrt(dx*dx + dy*dy) < this.size + plants[i].size) {
                        this.energy += 15;
                        plants.splice(i, 1);
                        break;
                    }
                }
            }

            draw() {
                ctx.fillStyle = '#3498db';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }

            reproduce() {
                if (this.energy > 80 && Math.random() < 0.005) {
                    this.energy -= 30;
                    return new Herbivore(this.x, this.y, this.speed + (Math.random() - 0.5) * 0.3);
                }
                return null;
            }
        }

        class Carnivore {
            constructor(x, y, speed) {
                this.x = x;
                this.y = y;
                this.speed = speed || (Math.random() * 2 + 1);
                this.angle = Math.random() * Math.PI * 2;
                this.energy = 100;
                this.size = 12;
            }

            update(herbivores) {
                // Hunt nearest herbivore
                let closest = null;
                let minDist = Infinity;

                for (let herb of herbivores) {
                    const dx = herb.x - this.x;
                    const dy = herb.y - this.y;
                    const dist = Math.sqrt(dx*dx + dy*dy);
                    if (dist < minDist && dist < 200) {
                        closest = herb;
                        minDist = dist;
                    }
                }

                if (closest) {
                    this.angle = Math.atan2(closest.y - this.y, closest.x - this.x);
                }

                this.x += Math.cos(this.angle) * this.speed;
                this.y += Math.sin(this.angle) * this.speed;

                if (this.x > canvas.width) this.x = 0;
                else if (this.x < 0) this.x = canvas.width;
                if (this.y > canvas.height) this.y = 0;
                else if (this.y < 0) this.y = canvas.height;

                this.energy -= 0.15;

                // Eat herbivores
                for (let i = herbivores.length - 1; i >= 0; i--) {
                    const dx = this.x - herbivores[i].x;
                    const dy = this.y - herbivores[i].y;
                    if (Math.sqrt(dx*dx + dy*dy) < this.size + herbivores[i].size) {
                        this.energy += 40;
                        herbivores.splice(i, 1);
                        break;
                    }
                }
            }

            draw() {
                ctx.fillStyle = '#e74c3c';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }

            reproduce() {
                if (this.energy > 150 && Math.random() < 0.003) {
                    this.energy -= 50;
                    return new Carnivore(this.x, this.y, this.speed + (Math.random() - 0.5) * 0.4);
                }
                return null;
            }
        }

        const plants = [];
        const herbivores = [];
        const carnivores = [];

        for (let i = 0; i < 80; i++) {
            plants.push(new Plant(Math.random() * canvas.width, Math.random() * canvas.height));
        }
        for (let i = 0; i < 15; i++) {
            herbivores.push(new Herbivore(Math.random() * canvas.width, Math.random() * canvas.height));
        }
        for (let i = 0; i < 5; i++) {
            carnivores.push(new Carnivore(Math.random() * canvas.width, Math.random() * canvas.height));
        }

        function animate() {
            fps.update();
            ctx.fillStyle = 'rgba(152, 216, 200, 0.3)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Add new plants
            if (Math.random() < 0.2 && plants.length < 150) {
                plants.push(new Plant(Math.random() * canvas.width, Math.random() * canvas.height));
            }

            // Update plants
            plants.forEach(p => {
                p.grow();
                p.draw();
            });

            // Update herbivores
            for (let i = herbivores.length - 1; i >= 0; i--) {
                herbivores[i].update(plants);
                herbivores[i].draw();

                if (herbivores[i].energy <= 0) {
                    herbivores.splice(i, 1);
                } else {
                    const baby = herbivores[i].reproduce();
                    if (baby) herbivores.push(baby);
                }
            }

            // Update carnivores
            for (let i = carnivores.length - 1; i >= 0; i--) {
                carnivores[i].update(herbivores);
                carnivores[i].draw();

                if (carnivores[i].energy <= 0) {
                    carnivores.splice(i, 1);
                } else {
                    const baby = carnivores[i].reproduce();
                    if (baby) carnivores.push(baby);
                }
            }

            document.getElementById('stats').innerHTML = `
                üåø Plants: ${plants.length}<br>
                üê∞ Herbivores: ${herbivores.length}<br>
                ü¶ä Carnivores: ${carnivores.length}
            `;

            requestAnimationFrame(animate);
        }

        animate();
    </script>
</body>
</html>
