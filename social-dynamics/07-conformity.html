<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conformity & Rebellion | Social Dynamics</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #2d1a4a 100%);
            color: #e0e0e0;
            min-height: 100vh;
            overflow: hidden;
        }
        #canvas { display: block; }
        .controls {
            position: fixed;
            top: 20px; right: 20px;
            background: rgba(0,0,0,0.85);
            padding: 20px; border-radius: 15px;
            min-width: 280px;
            border: 1px solid rgba(150, 100, 255, 0.3);
        }
        h1 { color: #a78bfa; font-size: 1.3em; margin-bottom: 15px; }
        .control-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; color: #aaa; font-size: 0.9em; }
        input[type="range"], select { width: 100%; }
        .value { float: right; color: #a78bfa; }
        button {
            width: 100%; padding: 10px; margin: 5px 0;
            border: none; border-radius: 8px;
            background: #a78bfa; color: #1a1a2e;
            font-weight: bold; cursor: pointer;
        }
        button:hover { background: #c4b5fd; }
        .stats { margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); }
        .stat-row { display: flex; justify-content: space-between; padding: 5px 0; font-size: 0.9em; }
        .stat-label { color: #888; }
        .stat-value { color: #a78bfa; font-weight: bold; }
        .info { font-size: 0.8em; color: #666; margin-top: 15px; line-height: 1.5; }
        a.back-link {
            position: fixed; top: 20px; left: 20px;
            color: #a78bfa; text-decoration: none;
            background: rgba(0,0,0,0.8); padding: 10px 20px;
            border-radius: 25px; font-size: 0.9em;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <a href="index.html" class="back-link">‚Üê Back to Social Dynamics</a>

    <div class="controls">
        <h1>Conformity & Rebellion</h1>
        <p style="font-size:0.85em; color:#888; margin-bottom:15px;">Asch conformity experiment</p>

        <div class="control-group">
            <label>Population: <span class="value" id="popValue">100</span></label>
            <input type="range" id="population" min="50" max="300" step="10" value="100">
        </div>

        <div class="control-group">
            <label>Conformity Pressure: <span class="value" id="pressureValue">0.3</span></label>
            <input type="range" id="pressure" min="0" max="0.8" step="0.05" value="0.3">
        </div>

        <div class="control-group">
            <label>Rebel Threshold: <span class="value" id="rebelValue">0.7</span></label>
            <input type="range" id="rebel" min="0.3" max="1" step="0.05" value="0.7">
        </div>

        <div class="control-group">
            <label>Information Visibility: <span class="value" id="visibilityValue">1.0</span></label>
            <input type="range" id="visibility" min="0.2" max="1" step="0.1" value="1.0">
        </div>

        <button id="runBtn">Start Simulation</button>
        <button id="resetBtn" style="background:#444;color:#fff">Reset</button>
        <button id="shockBtn" style="background:#ef4444">Social Shock</button>

        <div class="stats">
            <div class="stat-row">
                <span class="stat-label">Time Step</span>
                <span class="stat-value" id="timeStep">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label" style="color:#3b82f6">Conformists</span>
                <span class="stat-value" style="color:#3b82f6" id="conformists">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label" style="color:#ef4444">Rebels</span>
                <span class="stat-value" style="color:#ef4444" id="rebels">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Majority Opinion</span>
                <span class="stat-value" id="majority">0</span>
            </div>
        </div>

        <div class="info">
            <strong>Conformity:</strong> Tendency to match attitudes/behaviors with group.<br>
            <strong>Rebellion:</strong> Opposing majority when pressure becomes extreme.
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            initPopulation();
        }
        resize();
        window.onresize = resize;

        let agents = [];
        let nPopulation = 100;
        let conformityPressure = 0.3;
        let rebelThreshold = 0.7;
        let visibility = 1.0;
        let running = false;
        let timeStep = 0;
        let history = [];

        function initPopulation() {
            agents = [];
            history = [];
            timeStep = 0;
            running = false;

            const pw = canvas.width - 400;
            const ph = canvas.height;

            for (let i = 0; i < nPopulation; i++) {
                agents.push({
                    x: 100 + Math.random() * (pw - 200),
                    y: 100 + Math.random() * (ph - 200),
                    vx: (Math.random() - 0.5) * 2,
                    vy: (Math.random() - 0.5) * 2,
                    opinion: Math.random() < 0.5 ? 0 : 1, // Binary opinion
                    independence: Math.random(), // How resistant to conformity
                    isRebel: false
                });
            }

            updateStats();
        }

        function getMajorityOpinion() {
            let count0 = 0, count1 = 0;
            for (const a of agents) {
                if (a.opinion === 0) count0++;
                else count1++;
            }
            return count1 > count0 ? 1 : 0;
        }

        function getLocalMajority(agent) {
            let count0 = 0, count1 = 0;
            const visibleRange = 150 * visibility;

            for (const other of agents) {
                if (other === agent) continue;
                const dx = other.x - agent.x;
                const dy = other.y - agent.y;
                const dist = Math.sqrt(dx * dx + dy * dy);

                if (dist < visibleRange) {
                    if (other.opinion === 0) count0++;
                    else count1++;
                }
            }

            if (count0 + count1 === 0) return agent.opinion;
            return count1 > count0 ? 1 : 0;
        }

        function getLocalPressure(agent) {
            let sameCount = 0, totalCount = 0;
            const visibleRange = 150 * visibility;

            for (const other of agents) {
                if (other === agent) continue;
                const dx = other.x - agent.x;
                const dy = other.y - agent.y;
                const dist = Math.sqrt(dx * dx + dy * dy);

                if (dist < visibleRange) {
                    totalCount++;
                    if (other.opinion === agent.opinion) sameCount++;
                }
            }

            if (totalCount === 0) return 0.5;
            return sameCount / totalCount;
        }

        function update() {
            if (!running) return;

            const pw = canvas.width - 400;
            const ph = canvas.height;

            for (const agent of agents) {
                const localMajority = getLocalMajority(agent);
                const localPressure = getLocalPressure(agent);

                // Conformity vs Independence decision
                if (agent.opinion !== localMajority) {
                    // Facing pressure to conform
                    const pressureToConform = conformityPressure * (1 - localPressure);

                    if (pressureToConform > rebelThreshold && agent.independence > 0.5) {
                        // Rebel! Stay with minority opinion
                        agent.isRebel = true;
                    } else if (Math.random() < pressureToConform * (1 - agent.independence)) {
                        // Conform to majority
                        agent.opinion = localMajority;
                        agent.isRebel = false;
                    }
                } else {
                    agent.isRebel = false;
                }

                // Movement - similar opinions attract
                let attractX = 0, attractY = 0;
                let repelX = 0, repelY = 0;

                for (const other of agents) {
                    if (other === agent) continue;
                    const dx = other.x - agent.x;
                    const dy = other.y - agent.y;
                    const dist = Math.sqrt(dx * dx + dy * dy) + 1;

                    if (dist < 30) {
                        // Repel when too close
                        repelX -= dx / dist * 0.5;
                        repelY -= dy / dist * 0.5;
                    } else if (dist < 150) {
                        if (other.opinion === agent.opinion) {
                            // Attract to same opinion
                            attractX += dx / dist * 0.1;
                            attractY += dy / dist * 0.1;
                        } else {
                            // Repel from different opinion
                            repelX -= dx / dist * 0.05;
                            repelY -= dy / dist * 0.05;
                        }
                    }
                }

                agent.vx += attractX + repelX + (Math.random() - 0.5) * 0.3;
                agent.vy += attractY + repelY + (Math.random() - 0.5) * 0.3;

                // Damping
                agent.vx *= 0.95;
                agent.vy *= 0.95;

                // Speed limit
                const speed = Math.sqrt(agent.vx * agent.vx + agent.vy * agent.vy);
                if (speed > 3) {
                    agent.vx *= 3 / speed;
                    agent.vy *= 3 / speed;
                }

                agent.x += agent.vx;
                agent.y += agent.vy;

                // Bounds
                agent.x = Math.max(50, Math.min(pw - 50, agent.x));
                agent.y = Math.max(50, Math.min(ph - 50, agent.y));
            }

            timeStep++;
            updateStats();
        }

        function updateStats() {
            let conformists = 0, rebels = 0;
            for (const a of agents) {
                if (a.isRebel) rebels++;
                else conformists++;
            }

            document.getElementById('timeStep').textContent = timeStep;
            document.getElementById('conformists').textContent = conformists;
            document.getElementById('rebels').textContent = rebels;
            document.getElementById('majority').textContent = getMajorityOpinion() === 1 ? 'Blue' : 'Orange';

            const count0 = agents.filter(a => a.opinion === 0).length;
            const count1 = agents.filter(a => a.opinion === 1).length;
            history.push({ blue: count1, orange: count0, rebels });
            if (history.length > 300) history.shift();
        }

        function socialShock() {
            // Randomly flip some opinions
            for (const agent of agents) {
                if (Math.random() < 0.3) {
                    agent.opinion = 1 - agent.opinion;
                }
            }
        }

        function drawHistory() {
            const graphX = 50;
            const graphY = canvas.height - 180;
            const graphW = canvas.width - 450;
            const graphH = 150;

            ctx.fillStyle = 'rgba(0,0,0,0.4)';
            ctx.fillRect(graphX - 10, graphY - 30, graphW + 20, graphH + 50);

            ctx.fillStyle = '#fff';
            ctx.font = '14px sans-serif';
            ctx.fillText('Opinion Distribution Over Time', graphX, graphY - 10);

            if (history.length < 2) return;

            // Blue opinion
            ctx.beginPath();
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 2;
            for (let i = 0; i < history.length; i++) {
                const x = graphX + (i / (history.length - 1)) * graphW;
                const y = graphY + graphH - (history[i].blue / nPopulation) * graphH;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();

            // Orange opinion
            ctx.beginPath();
            ctx.strokeStyle = '#f59e0b';
            ctx.lineWidth = 2;
            for (let i = 0; i < history.length; i++) {
                const x = graphX + (i / (history.length - 1)) * graphW;
                const y = graphY + graphH - (history[i].orange / nPopulation) * graphH;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();

            // Rebels
            ctx.beginPath();
            ctx.strokeStyle = '#ef4444';
            ctx.lineWidth = 1;
            ctx.setLineDash([4, 4]);
            for (let i = 0; i < history.length; i++) {
                const x = graphX + (i / (history.length - 1)) * graphW;
                const y = graphY + graphH - (history[i].rebels / nPopulation) * graphH;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
            ctx.setLineDash([]);
        }

        function draw() {
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            update();

            // Draw agents
            for (const agent of agents) {
                ctx.beginPath();
                ctx.arc(agent.x, agent.y, agent.isRebel ? 10 : 7, 0, Math.PI * 2);
                ctx.fillStyle = agent.opinion === 1 ? '#3b82f6' : '#f59e0b';
                ctx.fill();

                if (agent.isRebel) {
                    ctx.strokeStyle = '#ef4444';
                    ctx.lineWidth = 3;
                    ctx.stroke();
                }

                // Independence indicator
                ctx.beginPath();
                ctx.arc(agent.x, agent.y, 3, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(255,255,255,${agent.independence})`;
                ctx.fill();
            }

            drawHistory();

            // Legend
            ctx.fillStyle = '#3b82f6';
            ctx.fillRect(canvas.width - 340, canvas.height - 100, 15, 15);
            ctx.fillStyle = '#f59e0b';
            ctx.fillRect(canvas.width - 340, canvas.height - 75, 15, 15);
            ctx.fillStyle = '#fff';
            ctx.font = '12px sans-serif';
            ctx.fillText('Opinion A (Blue)', canvas.width - 320, canvas.height - 88);
            ctx.fillText('Opinion B (Orange)', canvas.width - 320, canvas.height - 63);

            // Title
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 18px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('Conformity & Rebellion Dynamics', 50, 30);

            requestAnimationFrame(draw);
        }

        // Event listeners
        document.getElementById('population').oninput = (e) => {
            nPopulation = parseInt(e.target.value);
            document.getElementById('popValue').textContent = nPopulation;
        };

        document.getElementById('pressure').oninput = (e) => {
            conformityPressure = parseFloat(e.target.value);
            document.getElementById('pressureValue').textContent = conformityPressure.toFixed(2);
        };

        document.getElementById('rebel').oninput = (e) => {
            rebelThreshold = parseFloat(e.target.value);
            document.getElementById('rebelValue').textContent = rebelThreshold.toFixed(2);
        };

        document.getElementById('visibility').oninput = (e) => {
            visibility = parseFloat(e.target.value);
            document.getElementById('visibilityValue').textContent = visibility.toFixed(1);
        };

        document.getElementById('runBtn').onclick = () => {
            running = !running;
            document.getElementById('runBtn').textContent = running ? 'Pause' : 'Start Simulation';
        };

        document.getElementById('resetBtn').onclick = initPopulation;
        document.getElementById('shockBtn').onclick = socialShock;

        // Initialize
        initPopulation();
        draw();
    </script>
</body>
</html>
