<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hohmann Transfer Orbit</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #0a0a1a;
            font-family: Arial, sans-serif;
        }
        canvas {
            display: block;
        }
        .info {
            position: absolute;
            top: 20px;
            left: 20px;
            color: #00ff88;
            background: rgba(0, 0, 0, 0.9);
            padding: 15px;
            border-radius: 10px;
            max-width: 350px;
        }
    </style>
</head>
<body>
    <div class="info">
        <h2>Hohmann Transfer Orbit</h2>
        <p>Most fuel-efficient way to transfer between circular orbits</p>
        <p><strong>Δv₁:</strong> Burn at periapsis</p>
        <p><strong>Δv₂:</strong> Burn at apoapsis</p>
    </div>
    <canvas id="canvas"></canvas>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;

        const r1 = 120; // Inner orbit radius
        const r2 = 280; // Outer orbit radius
        const transferA = (r1 + r2) / 2; // Semi-major axis of transfer orbit
        const transferE = (r2 - r1) / (r2 + r1); // Eccentricity

        let spacecraft = {
            angle: 0,
            radius: r1,
            phase: 'inner', // inner, transfer1, transfer2, outer
            trail: []
        };

        function drawOrbit(radius, color, label) {
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.stroke();
            ctx.setLineDash([]);

            // Label
            ctx.fillStyle = color;
            ctx.font = '14px Arial';
            ctx.fillText(label, centerX + radius + 10, centerY);
        }

        function drawTransferOrbit() {
            ctx.save();
            ctx.translate(centerX, centerY);

            ctx.beginPath();
            ctx.ellipse(
                transferA - r1,
                0,
                transferA,
                transferA * Math.sqrt(1 - transferE * transferE),
                0, 0, Math.PI * 2
            );
            ctx.strokeStyle = '#FFaa00';
            ctx.lineWidth = 2;
            ctx.setLineDash([10, 5]);
            ctx.stroke();
            ctx.setLineDash([]);

            ctx.restore();
        }

        function drawCentralBody() {
            const gradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, 30);
            gradient.addColorStop(0, '#FFF');
            gradient.addColorStop(0.3, '#88CCFF');
            gradient.addColorStop(1, '#4488FF');

            ctx.beginPath();
            ctx.arc(centerX, centerY, 30, 0, Math.PI * 2);
            ctx.fillStyle = gradient;
            ctx.fill();

            ctx.strokeStyle = '#FFF';
            ctx.lineWidth = 2;
            ctx.stroke();
        }

        function drawSpacecraft(x, y, angle, burning) {
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(angle);

            // Spacecraft body
            ctx.fillStyle = '#CCC';
            ctx.fillRect(-8, -6, 16, 12);

            // Solar panels
            ctx.fillStyle = '#4488FF';
            ctx.fillRect(-15, -3, 5, 6);
            ctx.fillRect(10, -3, 5, 6);

            // Antenna
            ctx.strokeStyle = '#FFF';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(0, -6);
            ctx.lineTo(0, -12);
            ctx.stroke();

            // Engine burn effect
            if (burning) {
                ctx.fillStyle = '#FF6600';
                for (let i = 0; i < 5; i++) {
                    ctx.beginPath();
                    ctx.arc(-12 - i * 3, 0, 3 - i * 0.5, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            ctx.restore();
        }

        let time = 0;
        let burnPhase = 0; // 0: coast, 1: burn1, 2: coast, 3: burn2

        function updateSpacecraft() {
            const speed = 0.02;

            spacecraft.trail.push({x: spacecraft.x, y: spacecraft.y});
            if (spacecraft.trail.length > 200) {
                spacecraft.trail.shift();
            }

            if (spacecraft.phase === 'inner') {
                spacecraft.angle += speed;
                spacecraft.x = centerX + r1 * Math.cos(spacecraft.angle);
                spacecraft.y = centerY + r1 * Math.sin(spacecraft.angle);

                // Start transfer at angle 0
                if (spacecraft.angle > Math.PI * 2) {
                    spacecraft.angle = 0;
                    spacecraft.phase = 'transfer';
                    spacecraft.transferAngle = 0;
                    burnPhase = 1;
                }
            } else if (spacecraft.phase === 'transfer') {
                spacecraft.transferAngle += speed * 0.5;

                // Elliptical orbit calculation
                const r = (transferA * (1 - transferE * transferE)) /
                          (1 + transferE * Math.cos(spacecraft.transferAngle));

                spacecraft.x = centerX + r * Math.cos(spacecraft.transferAngle);
                spacecraft.y = centerY + r * Math.sin(spacecraft.transferAngle);

                if (spacecraft.transferAngle < 0.1) {
                    burnPhase = 1;
                } else if (spacecraft.transferAngle > Math.PI - 0.1 && spacecraft.transferAngle < Math.PI + 0.1) {
                    burnPhase = 3;
                } else {
                    burnPhase = 0;
                }

                if (spacecraft.transferAngle > Math.PI) {
                    spacecraft.phase = 'outer';
                    spacecraft.angle = Math.PI;
                }
            } else if (spacecraft.phase === 'outer') {
                spacecraft.angle += speed * 0.7;
                spacecraft.x = centerX + r2 * Math.cos(spacecraft.angle);
                spacecraft.y = centerY + r2 * Math.sin(spacecraft.angle);
                burnPhase = 0;

                // Reset after one orbit
                if (spacecraft.angle > Math.PI * 3) {
                    spacecraft.phase = 'inner';
                    spacecraft.angle = 0;
                    spacecraft.trail = [];
                }
            }
        }

        function draw() {
            ctx.fillStyle = 'rgba(10, 10, 26, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            drawOrbit(r1, '#00FF88', 'Inner Orbit');
            drawOrbit(r2, '#FF6B9D', 'Outer Orbit');
            drawTransferOrbit();
            drawCentralBody();

            // Draw trail
            ctx.beginPath();
            spacecraft.trail.forEach((point, i) => {
                if (i === 0) {
                    ctx.moveTo(point.x, point.y);
                } else {
                    ctx.lineTo(point.x, point.y);
                }
            });
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
            ctx.lineWidth = 2;
            ctx.stroke();

            updateSpacecraft();

            const velocityAngle = Math.atan2(
                spacecraft.y - centerY,
                spacecraft.x - centerX
            ) + Math.PI / 2;

            drawSpacecraft(
                spacecraft.x,
                spacecraft.y,
                velocityAngle,
                burnPhase === 1 || burnPhase === 3
            );

            // Draw burn markers
            if (burnPhase === 1) {
                ctx.fillStyle = '#FF6600';
                ctx.font = 'bold 16px Arial';
                ctx.fillText('Δv₁: Periapsis Burn', 20, canvas.height - 20);
            } else if (burnPhase === 3) {
                ctx.fillStyle = '#FF6600';
                ctx.font = 'bold 16px Arial';
                ctx.fillText('Δv₂: Apoapsis Burn', 20, canvas.height - 20);
            }

            time += 0.01;
        }

        function animate() {
            draw();
            requestAnimationFrame(animate);
        }

        spacecraft.x = centerX + r1;
        spacecraft.y = centerY;

        animate();

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    </script>
</body>
</html>