<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jupiter Disappears - Satellite Escape Simulation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            overflow: hidden;
            font-family: 'Segoe UI', Arial, sans-serif;
        }

        canvas {
            display: block;
        }

        .controls {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 100;
        }

        .btn {
            padding: 12px 28px;
            border: none;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.6);
        }

        .btn-danger:disabled {
            background: #555;
            box-shadow: none;
            cursor: not-allowed;
        }

        .btn-reset {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
        }

        .btn-reset:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.6);
        }

        .info-panel {
            position: fixed;
            top: 80px;
            left: 20px;
            background: rgba(0, 20, 40, 0.85);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 12px;
            color: #fff;
            max-width: 320px;
            border: 1px solid rgba(100, 200, 255, 0.2);
            z-index: 100;
        }

        .info-panel h2 {
            color: #64ffda;
            font-size: 18px;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .info-panel p {
            font-size: 13px;
            line-height: 1.6;
            color: #b8c5d6;
            margin-bottom: 10px;
        }

        .status {
            margin-top: 15px;
            padding: 10px;
            background: rgba(100, 255, 218, 0.1);
            border-radius: 8px;
            border-left: 3px solid #64ffda;
        }

        .status-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #64ffda;
            margin-bottom: 5px;
        }

        .status-value {
            font-size: 16px;
            font-weight: 600;
            color: #fff;
        }

        .legend {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 20, 40, 0.85);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 12px;
            color: #fff;
            border: 1px solid rgba(100, 200, 255, 0.2);
            z-index: 100;
        }

        .legend h3 {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #64ffda;
            margin-bottom: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            margin-bottom: 6px;
            color: #b8c5d6;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .time-display {
            position: fixed;
            top: 80px;
            right: 20px;
            background: rgba(0, 20, 40, 0.85);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            border-radius: 12px;
            color: #fff;
            border: 1px solid rgba(100, 200, 255, 0.2);
            text-align: right;
            z-index: 100;
        }

        .time-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #64ffda;
        }

        .time-value {
            font-size: 24px;
            font-weight: 300;
            font-family: 'Courier New', monospace;
        }

        .zoom-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 100;
        }

        .zoom-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            background: rgba(0, 20, 40, 0.85);
            color: #64ffda;
            font-size: 20px;
            cursor: pointer;
            border: 1px solid rgba(100, 200, 255, 0.2);
            transition: all 0.2s;
        }

        .zoom-btn:hover {
            background: rgba(100, 255, 218, 0.2);
        }

        .view-toggle {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 5px;
            background: rgba(0, 20, 40, 0.85);
            padding: 5px;
            border-radius: 25px;
            border: 1px solid rgba(100, 200, 255, 0.2);
            z-index: 100;
        }

        .view-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            background: transparent;
            color: #b8c5d6;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .view-btn.active {
            background: rgba(100, 255, 218, 0.2);
            color: #64ffda;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 8px 16px;
            background: rgba(0, 20, 40, 0.85);
            color: #64ffda;
            text-decoration: none;
            border-radius: 20px;
            font-size: 13px;
            z-index: 101;
            transition: all 0.3s ease;
            border: 1px solid rgba(100, 200, 255, 0.2);
        }

        .back-link:hover {
            background: rgba(100, 255, 218, 0.2);
        }
    </style>
</head>
<body>
    <a href="../../index.html" class="back-link">← Back to Gallery</a>

    <div class="controls">
        <button id="removeJupiter" class="btn btn-danger">Remove Jupiter</button>
        <button id="reset" class="btn btn-reset">Reset Simulation</button>
    </div>

    <div class="info-panel">
        <h2>Jupiter Disappears</h2>
        <p>This simulation shows what would happen to Jupiter's moons if the planet suddenly vanished. Without Jupiter's gravity, each moon continues on a tangent to its former orbit.</p>
        <p>The moons' velocities become their escape trajectories - some fall toward the Sun, others escape into the outer solar system.</p>
        <div class="status">
            <div class="status-label">Jupiter Status</div>
            <div id="jupiterStatus" class="status-value">Orbiting</div>
        </div>
    </div>

    <div class="time-display">
        <div class="time-label">Simulation Time</div>
        <div id="timeValue" class="time-value">0 days</div>
    </div>

    <div class="legend">
        <h3>Jupiter's Moons</h3>
        <div class="legend-item"><span class="legend-color" style="background: #ffcc66"></span> Io</div>
        <div class="legend-item"><span class="legend-color" style="background: #b8a87a"></span> Europa</div>
        <div class="legend-item"><span class="legend-color" style="background: #8b8682"></span> Ganymede</div>
        <div class="legend-item"><span class="legend-color" style="background: #6b5b4f"></span> Callisto</div>
        <div class="legend-item"><span class="legend-color" style="background: #ff6b6b"></span> Inner Moons</div>
        <div class="legend-item"><span class="legend-color" style="background: #9b59b6"></span> Outer Moons</div>
    </div>

    <div class="view-toggle">
        <button class="view-btn active" data-view="jupiter">Jupiter View</button>
        <button class="view-btn" data-view="solar">Solar System View</button>
    </div>

    <div class="zoom-controls">
        <button class="zoom-btn" id="zoomIn">+</button>
        <button class="zoom-btn" id="zoomOut">−</button>
    </div>

    <canvas id="canvas"></canvas>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let width, height, centerX, centerY;
        let jupiterExists = true;
        let simulationTime = 0;
        let currentView = 'jupiter';
        let zoomLevel = 1;
        let targetZoom = 1;
        let viewOffset = { x: 0, y: 0 };
        let targetOffset = { x: 0, y: 0 };

        // Stars background
        const stars = [];
        for (let i = 0; i < 500; i++) {
            stars.push({
                x: Math.random(),
                y: Math.random(),
                size: Math.random() * 1.5 + 0.5,
                brightness: Math.random() * 0.5 + 0.5
            });
        }

        // Physical constants (scaled for visualization)
        const G = 6.674e-11;
        const AU = 149597870700; // meters
        const DAY = 86400; // seconds
        const SCALE_JUPITER = 2e-9; // pixels per meter for Jupiter view
        const SCALE_SOLAR = 2e-12; // pixels per meter for Solar system view

        // Jupiter orbital parameters
        const jupiterSemiMajor = 5.2 * AU;
        const jupiterPeriod = 4332.59 * DAY;
        const jupiterMass = 1.898e27;
        const sunMass = 1.989e30;

        // Jupiter position (starts at specific point in orbit)
        let jupiterAngle = 0;
        let jupiterPos = { x: jupiterSemiMajor, y: 0 };

        // Moon data (distance in km, period in days, color, size)
        const moonsData = [
            // Inner moons
            { name: 'Metis', distance: 128000e3, period: 0.295, color: '#ff6b6b', size: 3, type: 'inner' },
            { name: 'Adrastea', distance: 129000e3, period: 0.298, color: '#ff8c8c', size: 2.5, type: 'inner' },
            { name: 'Amalthea', distance: 181400e3, period: 0.498, color: '#ff7b7b', size: 4, type: 'inner' },
            { name: 'Thebe', distance: 221900e3, period: 0.675, color: '#ff9b9b', size: 3, type: 'inner' },
            // Galilean moons
            { name: 'Io', distance: 421800e3, period: 1.769, color: '#ffcc66', size: 8, type: 'galilean' },
            { name: 'Europa', distance: 671100e3, period: 3.551, color: '#b8a87a', size: 7, type: 'galilean' },
            { name: 'Ganymede', distance: 1070400e3, period: 7.155, color: '#8b8682', size: 10, type: 'galilean' },
            { name: 'Callisto', distance: 1882700e3, period: 16.689, color: '#6b5b4f', size: 9, type: 'galilean' },
            // Outer irregular moons (selected)
            { name: 'Himalia', distance: 11460000e3, period: 250.56, color: '#9b59b6', size: 4, type: 'outer' },
            { name: 'Pasiphae', distance: 23624000e3, period: -743.63, color: '#8e44ad', size: 3.5, type: 'outer' },
            { name: 'Callirrhoe', distance: 24100000e3, period: -758.77, color: '#a569bd', size: 3, type: 'outer' }
        ];

        // Initialize moons with positions and velocities
        let moons = [];

        function initMoons() {
            moons = moonsData.map(data => {
                const angle = Math.random() * Math.PI * 2;
                const orbitalVelocity = 2 * Math.PI * data.distance / (Math.abs(data.period) * DAY);
                const direction = data.period > 0 ? 1 : -1;

                return {
                    ...data,
                    angle: angle,
                    // Position relative to Jupiter
                    relX: Math.cos(angle) * data.distance,
                    relY: Math.sin(angle) * data.distance,
                    // Velocity relative to Jupiter (perpendicular to radius)
                    relVx: -Math.sin(angle) * orbitalVelocity * direction,
                    relVy: Math.cos(angle) * orbitalVelocity * direction,
                    // Absolute position and velocity
                    x: 0,
                    y: 0,
                    vx: 0,
                    vy: 0,
                    trail: [],
                    escaped: false
                };
            });
            updateAbsolutePositions();
        }

        function updateAbsolutePositions() {
            // Jupiter's velocity (circular orbit approximation)
            const jupiterOrbitalV = 2 * Math.PI * jupiterSemiMajor / jupiterPeriod;
            const jupiterVx = -Math.sin(jupiterAngle) * jupiterOrbitalV;
            const jupiterVy = Math.cos(jupiterAngle) * jupiterOrbitalV;

            moons.forEach(moon => {
                moon.x = jupiterPos.x + moon.relX;
                moon.y = jupiterPos.y + moon.relY;
                moon.vx = jupiterVx + moon.relVx;
                moon.vy = jupiterVy + moon.relVy;
            });
        }

        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
            centerX = width / 2;
            centerY = height / 2;
        }

        function drawStars() {
            stars.forEach(star => {
                ctx.fillStyle = `rgba(255, 255, 255, ${star.brightness})`;
                ctx.beginPath();
                ctx.arc(star.x * width, star.y * height, star.size, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function getScale() {
            return (currentView === 'jupiter' ? SCALE_JUPITER : SCALE_SOLAR) * zoomLevel;
        }

        function worldToScreen(x, y) {
            const scale = getScale();
            const offsetX = currentView === 'jupiter' ? jupiterPos.x : 0;
            const offsetY = currentView === 'jupiter' ? jupiterPos.y : 0;

            return {
                x: centerX + (x - offsetX) * scale + viewOffset.x,
                y: centerY + (y - offsetY) * scale + viewOffset.y
            };
        }

        function drawSun() {
            const pos = worldToScreen(0, 0);
            const radius = currentView === 'solar' ? 20 : 5;

            // Glow
            const gradient = ctx.createRadialGradient(pos.x, pos.y, 0, pos.x, pos.y, radius * 3);
            gradient.addColorStop(0, 'rgba(255, 200, 50, 0.8)');
            gradient.addColorStop(0.3, 'rgba(255, 150, 0, 0.4)');
            gradient.addColorStop(1, 'rgba(255, 100, 0, 0)');

            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(pos.x, pos.y, radius * 3, 0, Math.PI * 2);
            ctx.fill();

            // Sun body
            ctx.fillStyle = '#ffdd44';
            ctx.beginPath();
            ctx.arc(pos.x, pos.y, radius, 0, Math.PI * 2);
            ctx.fill();

            // Label
            if (currentView === 'solar') {
                ctx.fillStyle = '#fff';
                ctx.font = '12px Segoe UI';
                ctx.fillText('Sun', pos.x + radius + 8, pos.y + 4);
            }
        }

        function drawInnerPlanets() {
            if (currentView !== 'solar') return;

            const planets = [
                { name: 'Mercury', distance: 0.387 * AU, color: '#b5b5b5', size: 4 },
                { name: 'Venus', distance: 0.723 * AU, color: '#e6c47f', size: 6 },
                { name: 'Earth', distance: 1.0 * AU, color: '#6b93d6', size: 6 },
                { name: 'Mars', distance: 1.524 * AU, color: '#c1440e', size: 5 }
            ];

            planets.forEach(planet => {
                // Orbit
                const orbitRadius = planet.distance * getScale();
                const sunPos = worldToScreen(0, 0);

                ctx.strokeStyle = 'rgba(100, 150, 200, 0.15)';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.arc(sunPos.x, sunPos.y, orbitRadius, 0, Math.PI * 2);
                ctx.stroke();

                // Planet position (simplified circular orbit)
                const angle = simulationTime * 0.0001 * (1 / Math.sqrt(planet.distance / AU));
                const px = Math.cos(angle) * planet.distance;
                const py = Math.sin(angle) * planet.distance;
                const pos = worldToScreen(px, py);

                // Planet
                ctx.fillStyle = planet.color;
                ctx.beginPath();
                ctx.arc(pos.x, pos.y, planet.size, 0, Math.PI * 2);
                ctx.fill();

                // Label
                ctx.fillStyle = '#aaa';
                ctx.font = '11px Segoe UI';
                ctx.fillText(planet.name, pos.x + planet.size + 5, pos.y + 4);
            });
        }

        function drawJupiterOrbit() {
            if (currentView !== 'solar') return;

            const orbitRadius = jupiterSemiMajor * getScale();
            const sunPos = worldToScreen(0, 0);

            ctx.strokeStyle = 'rgba(200, 150, 100, 0.2)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.arc(sunPos.x, sunPos.y, orbitRadius, 0, Math.PI * 2);
            ctx.stroke();
        }

        function drawJupiter() {
            if (!jupiterExists) return;

            const pos = worldToScreen(jupiterPos.x, jupiterPos.y);
            const radius = currentView === 'jupiter' ? 35 : 12;

            // Glow
            const gradient = ctx.createRadialGradient(pos.x, pos.y, radius * 0.5, pos.x, pos.y, radius * 2);
            gradient.addColorStop(0, 'rgba(210, 180, 140, 0.4)');
            gradient.addColorStop(1, 'rgba(210, 180, 140, 0)');
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(pos.x, pos.y, radius * 2, 0, Math.PI * 2);
            ctx.fill();

            // Jupiter body with bands
            const bodyGradient = ctx.createLinearGradient(pos.x, pos.y - radius, pos.x, pos.y + radius);
            bodyGradient.addColorStop(0, '#d4b896');
            bodyGradient.addColorStop(0.2, '#c9a882');
            bodyGradient.addColorStop(0.35, '#e8d4b8');
            bodyGradient.addColorStop(0.5, '#c4956a');
            bodyGradient.addColorStop(0.65, '#d9c4a8');
            bodyGradient.addColorStop(0.8, '#bf9060');
            bodyGradient.addColorStop(1, '#d4b896');

            ctx.fillStyle = bodyGradient;
            ctx.beginPath();
            ctx.arc(pos.x, pos.y, radius, 0, Math.PI * 2);
            ctx.fill();

            // Great Red Spot (if in Jupiter view)
            if (currentView === 'jupiter') {
                ctx.fillStyle = 'rgba(200, 100, 80, 0.6)';
                ctx.beginPath();
                ctx.ellipse(pos.x + radius * 0.3, pos.y + radius * 0.2, 8, 5, 0, 0, Math.PI * 2);
                ctx.fill();
            }

            // Label
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 13px Segoe UI';
            ctx.fillText('Jupiter', pos.x + radius + 10, pos.y + 4);
        }

        function drawMoonOrbit(moon) {
            if (!jupiterExists) return;
            if (currentView === 'solar' && moon.type !== 'galilean') return;

            const jPos = worldToScreen(jupiterPos.x, jupiterPos.y);
            const orbitRadius = moon.distance * getScale();

            if (orbitRadius > 5 && orbitRadius < 5000) {
                ctx.strokeStyle = `${moon.color}33`;
                ctx.lineWidth = 1;
                ctx.setLineDash([3, 3]);
                ctx.beginPath();
                ctx.arc(jPos.x, jPos.y, orbitRadius, 0, Math.PI * 2);
                ctx.stroke();
                ctx.setLineDash([]);
            }
        }

        function drawMoon(moon) {
            const pos = worldToScreen(moon.x, moon.y);

            // Check if on screen
            if (pos.x < -100 || pos.x > width + 100 || pos.y < -100 || pos.y > height + 100) {
                return;
            }

            // Draw trail
            if (moon.trail.length > 1) {
                ctx.strokeStyle = moon.color;
                ctx.lineWidth = 1.5;
                ctx.beginPath();

                for (let i = 0; i < moon.trail.length; i++) {
                    const tPos = worldToScreen(moon.trail[i].x, moon.trail[i].y);
                    const alpha = i / moon.trail.length;

                    if (i === 0) {
                        ctx.moveTo(tPos.x, tPos.y);
                    } else {
                        ctx.lineTo(tPos.x, tPos.y);
                    }
                }

                ctx.globalAlpha = 0.6;
                ctx.stroke();
                ctx.globalAlpha = 1;
            }

            // Moon glow
            const gradient = ctx.createRadialGradient(pos.x, pos.y, 0, pos.x, pos.y, moon.size * 2);
            gradient.addColorStop(0, moon.color + '80');
            gradient.addColorStop(1, moon.color + '00');
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(pos.x, pos.y, moon.size * 2, 0, Math.PI * 2);
            ctx.fill();

            // Moon body
            ctx.fillStyle = moon.color;
            ctx.beginPath();
            ctx.arc(pos.x, pos.y, moon.size, 0, Math.PI * 2);
            ctx.fill();

            // Label
            const showLabel = currentView === 'jupiter' || moon.type === 'galilean';
            if (showLabel) {
                ctx.fillStyle = '#fff';
                ctx.font = '11px Segoe UI';
                ctx.fillText(moon.name, pos.x + moon.size + 5, pos.y + 3);
            }
        }

        function updatePhysics(dt) {
            // Time scaling (1 second = ~10 days for Jupiter view, ~100 days for solar)
            const timeScale = currentView === 'jupiter' ? 10 * DAY : 100 * DAY;
            const simDt = dt * timeScale;
            simulationTime += simDt;

            // Update Jupiter position
            const jupiterAngularV = 2 * Math.PI / jupiterPeriod;
            jupiterAngle += jupiterAngularV * simDt;
            jupiterPos.x = Math.cos(jupiterAngle) * jupiterSemiMajor;
            jupiterPos.y = Math.sin(jupiterAngle) * jupiterSemiMajor;

            if (jupiterExists) {
                // Moons orbit Jupiter
                moons.forEach(moon => {
                    const angularV = 2 * Math.PI / (Math.abs(moon.period) * DAY);
                    const direction = moon.period > 0 ? 1 : -1;
                    moon.angle += angularV * simDt * direction;

                    moon.relX = Math.cos(moon.angle) * moon.distance;
                    moon.relY = Math.sin(moon.angle) * moon.distance;

                    const v = 2 * Math.PI * moon.distance / (Math.abs(moon.period) * DAY);
                    moon.relVx = -Math.sin(moon.angle) * v * direction;
                    moon.relVy = Math.cos(moon.angle) * v * direction;
                });
                updateAbsolutePositions();
            } else {
                // Moons follow gravitational paths (Sun only)
                moons.forEach(moon => {
                    // Gravitational acceleration from Sun
                    const dx = -moon.x;
                    const dy = -moon.y;
                    const r = Math.sqrt(dx * dx + dy * dy);
                    const a = G * sunMass / (r * r);
                    const ax = a * dx / r;
                    const ay = a * dy / r;

                    // Update velocity
                    moon.vx += ax * simDt;
                    moon.vy += ay * simDt;

                    // Update position
                    moon.x += moon.vx * simDt;
                    moon.y += moon.vy * simDt;

                    // Add to trail
                    const trailInterval = currentView === 'jupiter' ? 5 : 20;
                    if (moon.trail.length === 0 ||
                        Math.sqrt(Math.pow(moon.x - moon.trail[moon.trail.length-1].x, 2) +
                                  Math.pow(moon.y - moon.trail[moon.trail.length-1].y, 2)) > 1e9) {
                        moon.trail.push({ x: moon.x, y: moon.y });
                        if (moon.trail.length > 500) moon.trail.shift();
                    }
                });
            }
        }

        function removeJupiter() {
            if (!jupiterExists) return;

            jupiterExists = false;
            document.getElementById('jupiterStatus').textContent = 'REMOVED!';
            document.getElementById('jupiterStatus').style.color = '#ff6b6b';
            document.getElementById('removeJupiter').disabled = true;

            // Record position when Jupiter disappears for trail
            moons.forEach(moon => {
                moon.trail = [{ x: moon.x, y: moon.y }];
            });
        }

        function reset() {
            jupiterExists = true;
            simulationTime = 0;
            jupiterAngle = 0;
            jupiterPos = { x: jupiterSemiMajor, y: 0 };
            document.getElementById('jupiterStatus').textContent = 'Orbiting';
            document.getElementById('jupiterStatus').style.color = '#64ffda';
            document.getElementById('removeJupiter').disabled = false;
            initMoons();
        }

        function formatTime(seconds) {
            const days = Math.floor(seconds / DAY);
            if (days < 365) {
                return `${days} days`;
            } else {
                const years = (days / 365.25).toFixed(1);
                return `${years} years`;
            }
        }

        let lastTime = 0;
        function animate(time) {
            const dt = Math.min((time - lastTime) / 1000, 0.1);
            lastTime = time;

            // Smooth zoom and pan
            zoomLevel += (targetZoom - zoomLevel) * 0.1;
            viewOffset.x += (targetOffset.x - viewOffset.x) * 0.1;
            viewOffset.y += (targetOffset.y - viewOffset.y) * 0.1;

            updatePhysics(dt);

            // Clear and draw
            ctx.fillStyle = '#000810';
            ctx.fillRect(0, 0, width, height);

            drawStars();
            drawJupiterOrbit();
            drawInnerPlanets();
            drawSun();

            // Draw moon orbits
            moons.forEach(moon => drawMoonOrbit(moon));

            // Draw Jupiter
            drawJupiter();

            // Draw moons
            moons.forEach(moon => drawMoon(moon));

            // Update time display
            document.getElementById('timeValue').textContent = formatTime(simulationTime);

            requestAnimationFrame(animate);
        }

        // Event listeners
        document.getElementById('removeJupiter').addEventListener('click', removeJupiter);
        document.getElementById('reset').addEventListener('click', reset);

        document.querySelectorAll('.view-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentView = btn.dataset.view;
                targetZoom = 1;
                targetOffset = { x: 0, y: 0 };
            });
        });

        document.getElementById('zoomIn').addEventListener('click', () => {
            targetZoom = Math.min(targetZoom * 1.5, 10);
        });

        document.getElementById('zoomOut').addEventListener('click', () => {
            targetZoom = Math.max(targetZoom / 1.5, 0.1);
        });

        // Mouse wheel zoom
        canvas.addEventListener('wheel', (e) => {
            e.preventDefault();
            if (e.deltaY < 0) {
                targetZoom = Math.min(targetZoom * 1.2, 10);
            } else {
                targetZoom = Math.max(targetZoom / 1.2, 0.1);
            }
        });

        // Drag to pan
        let isDragging = false;
        let dragStart = { x: 0, y: 0 };

        canvas.addEventListener('mousedown', (e) => {
            isDragging = true;
            dragStart = { x: e.clientX - viewOffset.x, y: e.clientY - viewOffset.y };
        });

        canvas.addEventListener('mousemove', (e) => {
            if (isDragging) {
                targetOffset.x = e.clientX - dragStart.x;
                targetOffset.y = e.clientY - dragStart.y;
                viewOffset.x = targetOffset.x;
                viewOffset.y = targetOffset.y;
            }
        });

        canvas.addEventListener('mouseup', () => isDragging = false);
        canvas.addEventListener('mouseleave', () => isDragging = false);

        // Initialize
        window.addEventListener('resize', resize);
        resize();
        initMoons();
        animate(0);
    </script>
</body>
</html>
