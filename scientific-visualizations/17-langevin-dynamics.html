<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Langevin Dynamics - CCAB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #e8e8e8;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        header { text-align: center; padding: 20px; margin-bottom: 20px; }
        h1 {
            font-size: 2.2rem;
            background: linear-gradient(90deg, #ff6b6b, #feca57);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        .subtitle { color: #888; font-size: 1rem; }
        .back-link {
            position: absolute; top: 20px; left: 20px;
            color: #ff6b6b; text-decoration: none; font-weight: 500;
        }
        .back-link:hover { transform: translateX(-5px); }
        .main-content { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .canvas-container {
            background: rgba(255,255,255,0.05);
            border-radius: 16px; padding: 20px;
        }
        .canvas-container h3 { color: #ff6b6b; font-size: 1rem; margin-bottom: 10px; }
        canvas { display: block; margin: 0 auto; background: #0a0a1a; border-radius: 8px; }
        .controls-row {
            grid-column: span 2;
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        .panel {
            background: rgba(255,255,255,0.05);
            border-radius: 12px; padding: 15px;
        }
        .panel h3 {
            color: #ff6b6b; font-size: 1rem; margin-bottom: 10px;
            border-bottom: 1px solid rgba(255,107,107,0.3); padding-bottom: 5px;
        }
        .control-group { margin-bottom: 12px; }
        .control-group label { display: block; color: #ff6b6b; font-size: 0.85rem; margin-bottom: 5px; }
        .control-row { display: flex; align-items: center; gap: 10px; }
        input[type="range"] {
            flex: 1; height: 6px; -webkit-appearance: none;
            background: rgba(255,107,107,0.2); border-radius: 3px;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; width: 16px; height: 16px;
            background: #ff6b6b; border-radius: 50%; cursor: pointer;
        }
        .value-display { min-width: 50px; text-align: right; color: #888; font-family: monospace; }
        button {
            padding: 10px 15px; background: rgba(255,107,107,0.2);
            border: 1px solid rgba(255,107,107,0.5); border-radius: 6px;
            color: #ff6b6b; cursor: pointer; font-size: 0.85rem;
            width: 100%; margin-bottom: 8px; transition: all 0.3s;
        }
        button:hover { background: rgba(255,107,107,0.3); }
        .stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }
        .stat { background: rgba(0,0,0,0.2); padding: 10px; border-radius: 6px; text-align: center; }
        .stat-value { font-size: 1.1rem; color: #ff6b6b; font-weight: bold; }
        .stat-label { font-size: 0.7rem; color: #888; }
        .info-text { font-size: 0.85rem; color: #aaa; line-height: 1.6; }
        @media (max-width: 900px) {
            .main-content { grid-template-columns: 1fr; }
            .controls-row { grid-column: span 1; }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Gallery</a>
    <div class="container">
        <header>
            <h1>Langevin Dynamics</h1>
            <p class="subtitle">Brownian motion in a double-well potential</p>
        </header>
        <div class="main-content">
            <div class="canvas-container">
                <h3>Potential Energy & Particle</h3>
                <canvas id="potential" width="500" height="350"></canvas>
            </div>
            <div class="canvas-container">
                <h3>Position Time Series & Histogram</h3>
                <canvas id="timeseries" width="500" height="350"></canvas>
            </div>
            <div class="controls-row">
                <div class="panel">
                    <h3>Temperature</h3>
                    <div class="control-group">
                        <label>kT (thermal energy)</label>
                        <div class="control-row">
                            <input type="range" id="temperature" min="0.1" max="3" step="0.1" value="0.5">
                            <span class="value-display" id="temp-val">0.5</span>
                        </div>
                    </div>
                    <p class="info-text">Higher temperature → more frequent barrier crossings</p>
                </div>
                <div class="panel">
                    <h3>Potential Parameters</h3>
                    <div class="control-group">
                        <label>Barrier Height (a)</label>
                        <div class="control-row">
                            <input type="range" id="barrier" min="0.5" max="3" step="0.1" value="1">
                            <span class="value-display" id="barrier-val">1.0</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label>Well Separation (b)</label>
                        <div class="control-row">
                            <input type="range" id="separation" min="0.5" max="2" step="0.1" value="1">
                            <span class="value-display" id="sep-val">1.0</span>
                        </div>
                    </div>
                </div>
                <div class="panel">
                    <h3>Dynamics</h3>
                    <div class="control-group">
                        <label>Friction (γ)</label>
                        <div class="control-row">
                            <input type="range" id="friction" min="0.5" max="5" step="0.1" value="2">
                            <span class="value-display" id="friction-val">2.0</span>
                        </div>
                    </div>
                    <button onclick="toggleSimulation()">Start/Stop</button>
                    <button onclick="resetParticle()">Reset Particle</button>
                </div>
                <div class="panel">
                    <h3>Statistics</h3>
                    <div class="stats">
                        <div class="stat">
                            <div class="stat-value" id="position">0.00</div>
                            <div class="stat-label">Position x</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="energy">0.00</div>
                            <div class="stat-label">Potential U(x)</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="crossings">0</div>
                            <div class="stat-label">Barrier Crossings</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="time">0.0</div>
                            <div class="stat-label">Time</div>
                        </div>
                    </div>
                </div>
                <div class="panel">
                    <h3>About</h3>
                    <p class="info-text">
                        The Langevin equation describes a particle subject to friction and random thermal kicks.
                        In a double-well potential, the particle can hop between minima at a rate governed by the
                        Arrhenius law: rate ∝ exp(-ΔU/kT).
                    </p>
                </div>
            </div>
        </div>
    </div>
    <script>
        const potCanvas = document.getElementById('potential');
        const potCtx = potCanvas.getContext('2d');
        const tsCanvas = document.getElementById('timeseries');
        const tsCtx = tsCanvas.getContext('2d');

        let kT = 0.5, a = 1, b = 1, gamma = 2;
        let x = -1, v = 0;
        let running = false;
        let time = 0;
        let crossings = 0;
        let lastWell = -1;
        const dt = 0.01;
        const history = [];
        const maxHistory = 500;
        const histogram = new Array(50).fill(0);

        // Double-well potential: U(x) = a*(x^2 - b^2)^2
        function potential(x) {
            const term = x * x - b * b;
            return a * term * term;
        }

        function force(x) {
            return -4 * a * x * (x * x - b * b);
        }

        function step() {
            const F = force(x);
            const noise = Math.sqrt(2 * gamma * kT * dt) * (Math.random() * 2 - 1) * Math.sqrt(3);
            v += (F - gamma * v) * dt + noise;
            x += v * dt;
            time += dt;

            // Detect well crossing
            const currentWell = x > 0 ? 1 : -1;
            if (lastWell !== 0 && currentWell !== lastWell) {
                crossings++;
            }
            lastWell = currentWell;

            // Update histogram
            const bin = Math.floor((x + 3) / 6 * histogram.length);
            if (bin >= 0 && bin < histogram.length) {
                histogram[bin]++;
            }

            history.push(x);
            if (history.length > maxHistory) history.shift();
        }

        function drawPotential() {
            const w = potCanvas.width, h = potCanvas.height;
            const padding = 40;
            potCtx.clearRect(0, 0, w, h);

            // Draw potential curve
            potCtx.strokeStyle = '#ff6b6b';
            potCtx.lineWidth = 2;
            potCtx.beginPath();
            for (let px = padding; px < w - padding; px++) {
                const xVal = (px - padding) / (w - 2 * padding) * 6 - 3;
                const U = potential(xVal);
                const py = h - padding - (U / 5) * (h - 2 * padding);
                if (px === padding) potCtx.moveTo(px, Math.max(padding, py));
                else potCtx.lineTo(px, Math.max(padding, py));
            }
            potCtx.stroke();

            // Draw particle
            const particleX = padding + (x + 3) / 6 * (w - 2 * padding);
            const particleY = h - padding - (potential(x) / 5) * (h - 2 * padding);

            // Particle glow
            const grad = potCtx.createRadialGradient(particleX, particleY, 0, particleX, particleY, 20);
            grad.addColorStop(0, 'rgba(254, 202, 87, 0.8)');
            grad.addColorStop(1, 'rgba(254, 202, 87, 0)');
            potCtx.fillStyle = grad;
            potCtx.beginPath();
            potCtx.arc(particleX, particleY, 20, 0, Math.PI * 2);
            potCtx.fill();

            // Particle
            potCtx.fillStyle = '#feca57';
            potCtx.beginPath();
            potCtx.arc(particleX, Math.max(padding + 10, particleY), 10, 0, Math.PI * 2);
            potCtx.fill();

            // Axes
            potCtx.strokeStyle = 'rgba(255,255,255,0.3)';
            potCtx.lineWidth = 1;
            potCtx.beginPath();
            potCtx.moveTo(padding, h - padding);
            potCtx.lineTo(w - padding, h - padding);
            potCtx.moveTo(w / 2, padding);
            potCtx.lineTo(w / 2, h - padding);
            potCtx.stroke();

            // Labels
            potCtx.fillStyle = '#888';
            potCtx.font = '12px sans-serif';
            potCtx.textAlign = 'center';
            potCtx.fillText('x', w / 2, h - 10);
            potCtx.fillText('U(x)', w - 20, padding + 20);
        }

        function drawTimeSeries() {
            const w = tsCanvas.width, h = tsCanvas.height;
            const padding = 40;
            const histHeight = 80;
            tsCtx.clearRect(0, 0, w, h);

            // Time series
            if (history.length > 1) {
                tsCtx.strokeStyle = '#feca57';
                tsCtx.lineWidth = 1.5;
                tsCtx.beginPath();
                for (let i = 0; i < history.length; i++) {
                    const px = padding + (i / maxHistory) * (w - 2 * padding);
                    const py = padding + (1.5 - history[i] / 2) * (h - 2 * padding - histHeight);
                    if (i === 0) tsCtx.moveTo(px, py);
                    else tsCtx.lineTo(px, py);
                }
                tsCtx.stroke();
            }

            // Zero line
            tsCtx.strokeStyle = 'rgba(255,255,255,0.2)';
            tsCtx.setLineDash([5, 5]);
            const zeroY = padding + 1.5 * (h - 2 * padding - histHeight) / 3;
            tsCtx.beginPath();
            tsCtx.moveTo(padding, zeroY);
            tsCtx.lineTo(w - padding, zeroY);
            tsCtx.stroke();
            tsCtx.setLineDash([]);

            // Histogram
            const maxCount = Math.max(...histogram, 1);
            tsCtx.fillStyle = 'rgba(255, 107, 107, 0.5)';
            const barWidth = (w - 2 * padding) / histogram.length;
            for (let i = 0; i < histogram.length; i++) {
                const barHeight = (histogram[i] / maxCount) * histHeight;
                tsCtx.fillRect(
                    padding + i * barWidth,
                    h - padding - barHeight,
                    barWidth - 1,
                    barHeight
                );
            }

            // Boltzmann distribution overlay
            tsCtx.strokeStyle = '#ff6b6b';
            tsCtx.lineWidth = 2;
            tsCtx.beginPath();
            let maxBoltz = 0;
            const boltzValues = [];
            for (let i = 0; i < histogram.length; i++) {
                const xVal = (i / histogram.length) * 6 - 3;
                const boltz = Math.exp(-potential(xVal) / kT);
                boltzValues.push(boltz);
                maxBoltz = Math.max(maxBoltz, boltz);
            }
            for (let i = 0; i < histogram.length; i++) {
                const px = padding + (i + 0.5) * barWidth;
                const py = h - padding - (boltzValues[i] / maxBoltz) * histHeight;
                if (i === 0) tsCtx.moveTo(px, py);
                else tsCtx.lineTo(px, py);
            }
            tsCtx.stroke();

            // Labels
            tsCtx.fillStyle = '#888';
            tsCtx.font = '11px sans-serif';
            tsCtx.fillText('Time →', w / 2, padding - 10);
            tsCtx.fillText('Position Distribution', w / 2, h - 5);
        }

        function updateStats() {
            document.getElementById('position').textContent = x.toFixed(2);
            document.getElementById('energy').textContent = potential(x).toFixed(2);
            document.getElementById('crossings').textContent = crossings;
            document.getElementById('time').textContent = time.toFixed(1);
        }

        function simulate() {
            if (!running) return;
            for (let i = 0; i < 5; i++) step();
            drawPotential();
            drawTimeSeries();
            updateStats();
            requestAnimationFrame(simulate);
        }

        function toggleSimulation() {
            running = !running;
            if (running) simulate();
        }

        function resetParticle() {
            x = -b;
            v = 0;
            time = 0;
            crossings = 0;
            lastWell = -1;
            history.length = 0;
            histogram.fill(0);
            drawPotential();
            drawTimeSeries();
            updateStats();
        }

        // Event listeners
        document.getElementById('temperature').addEventListener('input', e => {
            kT = parseFloat(e.target.value);
            document.getElementById('temp-val').textContent = kT.toFixed(1);
        });
        document.getElementById('barrier').addEventListener('input', e => {
            a = parseFloat(e.target.value);
            document.getElementById('barrier-val').textContent = a.toFixed(1);
            if (!running) drawPotential();
        });
        document.getElementById('separation').addEventListener('input', e => {
            b = parseFloat(e.target.value);
            document.getElementById('sep-val').textContent = b.toFixed(1);
            if (!running) drawPotential();
        });
        document.getElementById('friction').addEventListener('input', e => {
            gamma = parseFloat(e.target.value);
            document.getElementById('friction-val').textContent = gamma.toFixed(1);
        });

        // Initialize
        resetParticle();
    </script>
</body>
</html>
