<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rossby Wave Dispersion - Scientific Visualizations</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0d1b2a 0%, #1b3a4b 100%);
            min-height: 100vh;
            color: #e0e0e0;
            overflow-x: hidden;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #4fc3f7;
            text-decoration: none;
            font-size: 14px;
            opacity: 0.8;
            z-index: 100;
            background: rgba(0,0,0,0.3);
            padding: 8px 16px;
            border-radius: 20px;
            transition: all 0.3s;
        }

        .back-link:hover {
            opacity: 1;
            background: rgba(0,0,0,0.5);
        }

        header {
            text-align: center;
            padding: 60px 20px 20px;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #4fc3f7, #29b6f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: #81d4fa;
            font-size: 1rem;
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .panel {
            background: rgba(0,0,0,0.3);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(79, 195, 247, 0.2);
        }

        .main-panel {
            flex: 1;
            min-width: 550px;
        }

        .side-panel {
            width: 350px;
        }

        .panel-title {
            font-size: 1rem;
            color: #4fc3f7;
            margin-bottom: 15px;
            text-align: center;
        }

        canvas {
            display: block;
            margin: 0 auto;
            border-radius: 8px;
        }

        .controls {
            width: 320px;
        }

        .control-group {
            margin-bottom: 18px;
        }

        .control-group label {
            display: block;
            font-size: 0.85rem;
            color: #90caf9;
            margin-bottom: 8px;
        }

        .control-group input[type="range"] {
            width: 100%;
            height: 6px;
            background: rgba(79, 195, 247, 0.2);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }

        .control-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #4fc3f7;
            border-radius: 50%;
            cursor: pointer;
        }

        .stats {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            margin-bottom: 6px;
        }

        .stat-label {
            color: #90caf9;
        }

        .stat-value {
            color: #4fc3f7;
            font-weight: 600;
        }

        .stat-value.westward {
            color: #ff7043;
        }

        .stat-value.eastward {
            color: #66bb6a;
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
            font-size: 0.85rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }

        .info-panel {
            background: rgba(0,0,0,0.3);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(79, 195, 247, 0.2);
            max-width: 1360px;
            margin: 20px auto;
        }

        .info-panel h3 {
            color: #4fc3f7;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .info-panel p {
            font-size: 0.9rem;
            line-height: 1.6;
            color: #b0bec5;
            margin-bottom: 10px;
        }

        .equation {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            background: rgba(79, 195, 247, 0.1);
            padding: 10px 15px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            color: #e0e0e0;
        }

        .toggle-btn {
            background: rgba(79, 195, 247, 0.2);
            border: 1px solid rgba(79, 195, 247, 0.4);
            color: #4fc3f7;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
            margin-right: 10px;
        }

        .toggle-btn.active {
            background: rgba(79, 195, 247, 0.4);
            border-color: #4fc3f7;
        }

        .toggle-btn:hover {
            background: rgba(79, 195, 247, 0.3);
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                align-items: center;
            }

            .main-panel, .side-panel, .controls {
                width: 100%;
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Gallery</a>

    <header>
        <h1>Rossby Wave Dispersion</h1>
        <p class="subtitle">Planetary waves on the beta plane</p>
    </header>

    <div class="container">
        <div class="panel main-panel">
            <h3 class="panel-title">Wave Pattern (Beta Plane)</h3>
            <canvas id="waveCanvas" width="550" height="400"></canvas>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #ff7043;"></div>
                    <span>Phase velocity (c<sub>p</sub>)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #66bb6a;"></div>
                    <span>Group velocity (c<sub>g</sub>)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #ffb74d;"></div>
                    <span>Wave crests</span>
                </div>
            </div>
        </div>

        <div class="panel side-panel">
            <h3 class="panel-title">Dispersion Relation</h3>
            <canvas id="dispersionCanvas" width="300" height="280"></canvas>
            <div style="margin-top: 15px;">
                <button class="toggle-btn active" id="showOmegaBtn">ω(k)</button>
                <button class="toggle-btn" id="showCpBtn">c<sub>p</sub>(k)</button>
                <button class="toggle-btn" id="showCgBtn">c<sub>g</sub>(k)</button>
            </div>
        </div>

        <div class="panel controls">
            <div class="control-group">
                <label>Zonal wavenumber k: <span id="kVal">2</span> × 10⁻⁶ m⁻¹</label>
                <input type="range" id="kSlider" min="0.5" max="10" value="2" step="0.1">
            </div>

            <div class="control-group">
                <label>Meridional wavenumber l: <span id="lVal">1</span> × 10⁻⁶ m⁻¹</label>
                <input type="range" id="lSlider" min="0" max="8" value="1" step="0.1">
            </div>

            <div class="control-group">
                <label>Beta parameter β: <span id="betaVal">2.0</span> × 10⁻¹¹ m⁻¹s⁻¹</label>
                <input type="range" id="betaSlider" min="1" max="3" value="2" step="0.1">
            </div>

            <div class="control-group">
                <label>Deformation radius L<sub>D</sub>: <span id="LdVal">50</span> km</label>
                <input type="range" id="LdSlider" min="10" max="200" value="50" step="5">
            </div>

            <div class="stats">
                <div class="stat-row">
                    <span class="stat-label">Frequency ω:</span>
                    <span class="stat-value" id="omega">-</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Period T:</span>
                    <span class="stat-value" id="period">-</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Phase velocity c<sub>px</sub>:</span>
                    <span class="stat-value westward" id="cpx">-</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Group velocity c<sub>gx</sub>:</span>
                    <span class="stat-value" id="cgx">-</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Wavelength λ:</span>
                    <span class="stat-value" id="wavelength">-</span>
                </div>
            </div>
        </div>
    </div>

    <div class="info-panel">
        <h3>Rossby Waves (Planetary Waves)</h3>
        <p>
            Rossby waves are large-scale oscillations in the atmosphere and ocean caused by the
            variation of the Coriolis force with latitude (the β-effect). On a <strong>beta plane</strong>,
            where f = f₀ + βy, these waves propagate information about changes in vorticity across
            planetary scales.
        </p>
        <div class="equation">
            Dispersion: ω = −βk / (k² + l² + 1/L<sub>D</sub>²) &nbsp;|&nbsp;
            Phase velocity: c<sub>px</sub> = ω/k = −β / (k² + l² + 1/L<sub>D</sub>²)
        </div>
        <p>
            <strong>Key insight:</strong> Phase velocity is always westward, but group velocity
            (energy propagation) can be eastward for short waves (large k). This explains why
            weather systems and ocean eddies tend to propagate westward, while the energy from
            localized disturbances can spread in both directions.
        </p>
    </div>

    <script>
        const waveCanvas = document.getElementById('waveCanvas');
        const waveCtx = waveCanvas.getContext('2d');
        const dispCanvas = document.getElementById('dispersionCanvas');
        const dispCtx = dispCanvas.getContext('2d');

        // Parameters (in CGS-like scaled units for visualization)
        let k = 2e-6;   // zonal wavenumber (m^-1)
        let l = 1e-6;   // meridional wavenumber (m^-1)
        let beta = 2e-11; // beta parameter (m^-1 s^-1)
        let Ld = 50e3;  // Rossby deformation radius (m)

        let time = 0;
        let dispMode = 'omega'; // 'omega', 'cp', 'cg'

        // Controls
        document.getElementById('kSlider').addEventListener('input', (e) => {
            k = parseFloat(e.target.value) * 1e-6;
            document.getElementById('kVal').textContent = e.target.value;
            update();
        });

        document.getElementById('lSlider').addEventListener('input', (e) => {
            l = parseFloat(e.target.value) * 1e-6;
            document.getElementById('lVal').textContent = e.target.value;
            update();
        });

        document.getElementById('betaSlider').addEventListener('input', (e) => {
            beta = parseFloat(e.target.value) * 1e-11;
            document.getElementById('betaVal').textContent = e.target.value;
            update();
        });

        document.getElementById('LdSlider').addEventListener('input', (e) => {
            Ld = parseFloat(e.target.value) * 1e3;
            document.getElementById('LdVal').textContent = e.target.value;
            update();
        });

        document.getElementById('showOmegaBtn').addEventListener('click', () => {
            dispMode = 'omega';
            document.getElementById('showOmegaBtn').classList.add('active');
            document.getElementById('showCpBtn').classList.remove('active');
            document.getElementById('showCgBtn').classList.remove('active');
            drawDispersion();
        });

        document.getElementById('showCpBtn').addEventListener('click', () => {
            dispMode = 'cp';
            document.getElementById('showCpBtn').classList.add('active');
            document.getElementById('showOmegaBtn').classList.remove('active');
            document.getElementById('showCgBtn').classList.remove('active');
            drawDispersion();
        });

        document.getElementById('showCgBtn').addEventListener('click', () => {
            dispMode = 'cg';
            document.getElementById('showCgBtn').classList.add('active');
            document.getElementById('showOmegaBtn').classList.remove('active');
            document.getElementById('showCpBtn').classList.remove('active');
            drawDispersion();
        });

        function dispersionRelation(kVal, lVal) {
            const k2l2 = kVal * kVal + lVal * lVal;
            const invLd2 = 1 / (Ld * Ld);
            const denom = k2l2 + invLd2;
            return -beta * kVal / denom;
        }

        function phaseVelocityX(kVal, lVal) {
            const omega = dispersionRelation(kVal, lVal);
            return omega / kVal;
        }

        function groupVelocityX(kVal, lVal) {
            // d(omega)/dk = beta * (k^2 - l^2 - 1/Ld^2) / (k^2 + l^2 + 1/Ld^2)^2
            const k2 = kVal * kVal;
            const l2 = lVal * lVal;
            const invLd2 = 1 / (Ld * Ld);
            const denom = k2 + l2 + invLd2;
            return beta * (k2 - l2 - invLd2) / (denom * denom);
        }

        function groupVelocityY(kVal, lVal) {
            // d(omega)/dl = beta * 2*k*l / (k^2 + l^2 + 1/Ld^2)^2
            const k2 = kVal * kVal;
            const l2 = lVal * lVal;
            const invLd2 = 1 / (Ld * Ld);
            const denom = k2 + l2 + invLd2;
            return beta * 2 * kVal * lVal / (denom * denom);
        }

        function update() {
            const omega = dispersionRelation(k, l);
            const cpx = phaseVelocityX(k, l);
            const cgx = groupVelocityX(k, l);

            const period = 2 * Math.PI / Math.abs(omega);
            const wavelength = 2 * Math.PI / Math.sqrt(k * k + l * l);

            // Update stats
            document.getElementById('omega').textContent = (omega * 1e6).toFixed(3) + ' × 10⁻⁶ s⁻¹';
            document.getElementById('period').textContent = (period / 86400).toFixed(1) + ' days';

            const cpxKmDay = cpx * 86400 / 1000;
            document.getElementById('cpx').textContent = cpxKmDay.toFixed(2) + ' km/day';
            document.getElementById('cpx').className = 'stat-value ' + (cpxKmDay < 0 ? 'westward' : 'eastward');

            const cgxKmDay = cgx * 86400 / 1000;
            document.getElementById('cgx').textContent = cgxKmDay.toFixed(2) + ' km/day';
            document.getElementById('cgx').className = 'stat-value ' + (cgxKmDay < 0 ? 'westward' : 'eastward');

            document.getElementById('wavelength').textContent = (wavelength / 1000).toFixed(0) + ' km';

            drawDispersion();
        }

        function drawWave() {
            const ctx = waveCtx;
            const W = waveCanvas.width;
            const H = waveCanvas.height;

            // Clear
            ctx.fillStyle = '#0d1b2a';
            ctx.fillRect(0, 0, W, H);

            // Draw coordinate grid
            ctx.strokeStyle = 'rgba(79, 195, 247, 0.15)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 10; i++) {
                const x = 50 + i * (W - 100) / 10;
                const y = 30 + i * (H - 80) / 10;
                ctx.beginPath();
                ctx.moveTo(x, 30);
                ctx.lineTo(x, H - 50);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(50, y);
                ctx.lineTo(W - 50, y);
                ctx.stroke();
            }

            // Draw wave field
            const omega = dispersionRelation(k, l);
            const scale = 1e6; // Scale wavenumbers for visualization

            for (let px = 50; px < W - 50; px += 3) {
                for (let py = 30; py < H - 50; py += 3) {
                    const x = (px - 50) / (W - 100); // 0 to 1
                    const y = (py - 30) / (H - 80); // 0 to 1

                    // Convert to physical coords (arbitrary scale)
                    const physX = x * 2 * Math.PI / (k * scale);
                    const physY = y * 2 * Math.PI / (l * scale || 1);

                    // Wave function
                    const phase = k * physX * scale + l * physY * scale - omega * time * 1e4;
                    const val = Math.cos(phase);

                    // Color based on value
                    const intensity = (val + 1) / 2;
                    const r = Math.floor(13 + intensity * 60);
                    const g = Math.floor(27 + intensity * 80);
                    const b = Math.floor(42 + intensity * 100);

                    ctx.fillStyle = `rgb(${r}, ${g}, ${b})`;
                    ctx.fillRect(px, py, 3, 3);
                }
            }

            // Draw wave crests
            ctx.strokeStyle = 'rgba(255, 183, 77, 0.6)';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);

            const numCrests = 5;
            for (let n = -numCrests; n <= numCrests; n++) {
                ctx.beginPath();
                for (let px = 50; px < W - 50; px += 5) {
                    const x = (px - 50) / (W - 100);
                    const physX = x * 2 * Math.PI / (k * scale);

                    // Find y where phase = 2*pi*n
                    // k*x + l*y - omega*t = 2*pi*n
                    // y = (2*pi*n - k*x + omega*t) / l
                    if (Math.abs(l) > 1e-9) {
                        const physY = (2 * Math.PI * n - k * physX * scale + omega * time * 1e4) / (l * scale);
                        const py = 30 + (physY * l * scale / (2 * Math.PI)) * (H - 80);

                        if (py > 30 && py < H - 50) {
                            if (px === 50) {
                                ctx.moveTo(px, py);
                            } else {
                                ctx.lineTo(px, py);
                            }
                        }
                    }
                }
                ctx.stroke();
            }
            ctx.setLineDash([]);

            // Draw velocity vectors
            const cx = W / 2;
            const cy = H / 2;
            const velScale = 2e6; // Scale for visualization

            const cpx = phaseVelocityX(k, l);
            const cgx = groupVelocityX(k, l);
            const cgy = groupVelocityY(k, l);

            // Phase velocity (always westward)
            ctx.strokeStyle = '#ff7043';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(cx, cy);
            const cpEndX = cx + cpx * velScale;
            ctx.lineTo(cpEndX, cy);
            ctx.stroke();

            // Arrow head for phase velocity
            if (Math.abs(cpx) > 1e-10) {
                const sign = cpx < 0 ? -1 : 1;
                ctx.beginPath();
                ctx.moveTo(cpEndX, cy);
                ctx.lineTo(cpEndX - sign * 12, cy - 6);
                ctx.lineTo(cpEndX - sign * 12, cy + 6);
                ctx.closePath();
                ctx.fillStyle = '#ff7043';
                ctx.fill();
            }

            // Group velocity
            ctx.strokeStyle = '#66bb6a';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(cx, cy);
            const cgEndX = cx + cgx * velScale;
            const cgEndY = cy - cgy * velScale; // y inverted
            ctx.lineTo(cgEndX, cgEndY);
            ctx.stroke();

            // Arrow head for group velocity
            const cgMag = Math.sqrt(cgx * cgx + cgy * cgy);
            if (cgMag > 1e-10) {
                const dx = cgEndX - cx;
                const dy = cgEndY - cy;
                const len = Math.sqrt(dx * dx + dy * dy);
                const ux = dx / len;
                const uy = dy / len;
                ctx.beginPath();
                ctx.moveTo(cgEndX, cgEndY);
                ctx.lineTo(cgEndX - ux * 12 - uy * 6, cgEndY - uy * 12 + ux * 6);
                ctx.lineTo(cgEndX - ux * 12 + uy * 6, cgEndY - uy * 12 - ux * 6);
                ctx.closePath();
                ctx.fillStyle = '#66bb6a';
                ctx.fill();
            }

            // Labels
            ctx.fillStyle = '#90caf9';
            ctx.font = '11px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('East →', W - 30, H / 2 + 4);
            ctx.fillText('← West', 30, H / 2 + 4);
            ctx.fillText('North ↑', W / 2, 20);
            ctx.fillText('South ↓', W / 2, H - 35);

            // Velocity labels
            ctx.fillStyle = '#ff7043';
            ctx.fillText('c_p', cpEndX + (cpx < 0 ? -20 : 20), cy - 10);
            ctx.fillStyle = '#66bb6a';
            ctx.fillText('c_g', cgEndX + 15, cgEndY);
        }

        function drawDispersion() {
            const ctx = dispCtx;
            const W = dispCanvas.width;
            const H = dispCanvas.height;

            ctx.fillStyle = '#0d1b2a';
            ctx.fillRect(0, 0, W, H);

            // Axes
            const margin = 50;
            const plotW = W - margin - 30;
            const plotH = H - margin - 30;

            ctx.strokeStyle = 'rgba(144, 202, 249, 0.5)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(margin, 20);
            ctx.lineTo(margin, H - margin);
            ctx.lineTo(W - 20, H - margin);
            ctx.stroke();

            // Labels
            ctx.fillStyle = '#90caf9';
            ctx.font = '11px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('k (×10⁻⁶ m⁻¹)', W / 2, H - 10);
            ctx.save();
            ctx.translate(15, H / 2);
            ctx.rotate(-Math.PI / 2);

            let yLabel = 'ω (×10⁻⁶ s⁻¹)';
            if (dispMode === 'cp') yLabel = 'c_p (km/day)';
            if (dispMode === 'cg') yLabel = 'c_g (km/day)';
            ctx.fillText(yLabel, 0, 0);
            ctx.restore();

            // Compute values for different k
            const kMin = 0.5e-6;
            const kMax = 10e-6;
            const points = [];
            let yMin = 0, yMax = 0;

            for (let i = 0; i <= 100; i++) {
                const kVal = kMin + (kMax - kMin) * i / 100;
                let yVal;

                if (dispMode === 'omega') {
                    yVal = dispersionRelation(kVal, l) * 1e6;
                } else if (dispMode === 'cp') {
                    yVal = phaseVelocityX(kVal, l) * 86400 / 1000;
                } else {
                    yVal = groupVelocityX(kVal, l) * 86400 / 1000;
                }

                points.push({ k: kVal, y: yVal });
                if (yVal < yMin) yMin = yVal;
                if (yVal > yMax) yMax = yVal;
            }

            // Expand y range slightly
            const yRange = yMax - yMin || 1;
            yMin -= yRange * 0.1;
            yMax += yRange * 0.1;

            // Draw zero line if in range
            if (yMin < 0 && yMax > 0) {
                const zeroY = H - margin - (-yMin / (yMax - yMin)) * plotH;
                ctx.strokeStyle = 'rgba(144, 202, 249, 0.3)';
                ctx.setLineDash([3, 3]);
                ctx.beginPath();
                ctx.moveTo(margin, zeroY);
                ctx.lineTo(W - 20, zeroY);
                ctx.stroke();
                ctx.setLineDash([]);

                ctx.fillStyle = '#90caf9';
                ctx.textAlign = 'right';
                ctx.fillText('0', margin - 5, zeroY + 4);
            }

            // Draw curve
            ctx.strokeStyle = dispMode === 'omega' ? '#4fc3f7' :
                              dispMode === 'cp' ? '#ff7043' : '#66bb6a';
            ctx.lineWidth = 2;
            ctx.beginPath();

            points.forEach((pt, i) => {
                const x = margin + ((pt.k - kMin) / (kMax - kMin)) * plotW;
                const y = H - margin - ((pt.y - yMin) / (yMax - yMin)) * plotH;

                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();

            // Mark current k value
            const currentX = margin + ((k - kMin) / (kMax - kMin)) * plotW;
            let currentY;
            if (dispMode === 'omega') {
                currentY = dispersionRelation(k, l) * 1e6;
            } else if (dispMode === 'cp') {
                currentY = phaseVelocityX(k, l) * 86400 / 1000;
            } else {
                currentY = groupVelocityX(k, l) * 86400 / 1000;
            }
            const currentYPx = H - margin - ((currentY - yMin) / (yMax - yMin)) * plotH;

            ctx.beginPath();
            ctx.arc(currentX, currentYPx, 6, 0, Math.PI * 2);
            ctx.fillStyle = '#fff';
            ctx.fill();
            ctx.strokeStyle = dispMode === 'omega' ? '#4fc3f7' :
                              dispMode === 'cp' ? '#ff7043' : '#66bb6a';
            ctx.lineWidth = 2;
            ctx.stroke();

            // X-axis ticks
            ctx.fillStyle = '#90caf9';
            ctx.textAlign = 'center';
            for (let i = 0; i <= 5; i++) {
                const kVal = kMin + (kMax - kMin) * i / 5;
                const x = margin + i * plotW / 5;
                ctx.fillText((kVal * 1e6).toFixed(1), x, H - margin + 15);
            }
        }

        function animate() {
            time += 0.016;
            drawWave();
            requestAnimationFrame(animate);
        }

        update();
        animate();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
