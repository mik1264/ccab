<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fabry-Pérot Interferometer - Scientific Visualizations</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
            overflow-x: hidden;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #ffd54f;
            text-decoration: none;
            font-size: 14px;
            opacity: 0.8;
            z-index: 100;
            background: rgba(0,0,0,0.3);
            padding: 8px 16px;
            border-radius: 20px;
            transition: all 0.3s;
        }

        .back-link:hover {
            opacity: 1;
            background: rgba(0,0,0,0.5);
        }

        header {
            text-align: center;
            padding: 60px 20px 20px;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #ffd54f, #ffb74d);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: #fff59d;
            font-size: 1rem;
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .panel {
            background: rgba(0,0,0,0.3);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(255, 213, 79, 0.2);
        }

        .main-panel {
            flex: 1;
            min-width: 550px;
        }

        .side-panel {
            width: 350px;
        }

        .panel-title {
            font-size: 1rem;
            color: #ffd54f;
            margin-bottom: 15px;
            text-align: center;
        }

        canvas {
            display: block;
            margin: 0 auto;
            border-radius: 8px;
        }

        .controls {
            width: 320px;
        }

        .control-group {
            margin-bottom: 18px;
        }

        .control-group label {
            display: block;
            font-size: 0.85rem;
            color: #fff59d;
            margin-bottom: 8px;
        }

        .control-group input[type="range"] {
            width: 100%;
            height: 6px;
            background: rgba(255, 213, 79, 0.2);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }

        .control-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #ffd54f;
            border-radius: 50%;
            cursor: pointer;
        }

        .stats {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            margin-bottom: 6px;
        }

        .stat-label {
            color: #fff59d;
        }

        .stat-value {
            color: #ffd54f;
            font-weight: 600;
        }

        .info-panel {
            background: rgba(0,0,0,0.3);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(255, 213, 79, 0.2);
            max-width: 1360px;
            margin: 20px auto;
        }

        .info-panel h3 {
            color: #ffd54f;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .info-panel p {
            font-size: 0.9rem;
            line-height: 1.6;
            color: #b0bec5;
        }

        .equation {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            background: rgba(255, 213, 79, 0.1);
            padding: 10px 15px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            color: #e0e0e0;
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                align-items: center;
            }

            .main-panel, .side-panel, .controls {
                width: 100%;
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Gallery</a>

    <header>
        <h1>Fabry-Pérot Interferometer</h1>
        <p class="subtitle">Multiple-beam interference and transmission resonances</p>
    </header>

    <div class="container">
        <div class="panel main-panel">
            <h3 class="panel-title">Etalon Schematic & Beam Paths</h3>
            <canvas id="mainCanvas" width="550" height="350"></canvas>
        </div>

        <div class="panel side-panel">
            <h3 class="panel-title">Transmission Spectrum</h3>
            <canvas id="spectrumCanvas" width="320" height="220"></canvas>
            <div style="margin-top: 15px;">
                <h3 class="panel-title">Ring Pattern</h3>
                <canvas id="ringCanvas" width="180" height="180"></canvas>
            </div>
        </div>

        <div class="panel controls">
            <div class="control-group">
                <label>Mirror Reflectivity R: <span id="rVal">0.90</span></label>
                <input type="range" id="rSlider" min="0.1" max="0.99" value="0.9" step="0.01">
            </div>

            <div class="control-group">
                <label>Cavity Length d: <span id="dVal">10</span> mm</label>
                <input type="range" id="dSlider" min="1" max="50" value="10" step="0.5">
            </div>

            <div class="control-group">
                <label>Central Wavelength λ: <span id="lambdaVal">600</span> nm</label>
                <input type="range" id="lambdaSlider" min="400" max="700" value="600" step="1">
            </div>

            <div class="control-group">
                <label>Spectral Range: <span id="rangeVal">1.0</span> nm</label>
                <input type="range" id="rangeSlider" min="0.1" max="5" value="1" step="0.1">
            </div>

            <div class="stats">
                <div class="stat-row">
                    <span class="stat-label">Finesse (ℱ):</span>
                    <span class="stat-value" id="finesse">-</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">FSR (Δλ):</span>
                    <span class="stat-value" id="fsr">-</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">FWHM (δλ):</span>
                    <span class="stat-value" id="fwhm">-</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Peak transmission:</span>
                    <span class="stat-value" id="peakT">-</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Resolving power:</span>
                    <span class="stat-value" id="resolving">-</span>
                </div>
            </div>
        </div>
    </div>

    <div class="info-panel">
        <h3>The Fabry-Pérot Interferometer</h3>
        <p>
            Invented by Charles Fabry and Alfred Pérot in 1899, this device consists of two parallel,
            partially-reflecting mirrors (an etalon). Light bouncing between the mirrors creates
            multiple-beam interference, producing sharp transmission peaks at resonant wavelengths.
            The <strong>finesse</strong> (sharpness of peaks) increases dramatically with mirror
            reflectivity.
        </p>
        <div class="equation">
            Transmission: T = 1 / [1 + (2ℱ/π)² sin²(δ/2)] &nbsp;where δ = 4πnd/λ
        </div>
        <p>
            <strong>Finesse:</strong> ℱ = π√R/(1-R) determines peak sharpness. At R=0.9, ℱ≈30.
            At R=0.99, ℱ≈300. The <strong>Free Spectral Range</strong> (FSR) is the wavelength spacing
            between peaks: Δλ = λ²/(2nd). Fabry-Pérot interferometers are used in spectroscopy, lasers,
            and telecommunications for wavelength filtering and measurement.
        </p>
    </div>

    <script>
        const mainCanvas = document.getElementById('mainCanvas');
        const mainCtx = mainCanvas.getContext('2d');
        const spectrumCanvas = document.getElementById('spectrumCanvas');
        const spectrumCtx = spectrumCanvas.getContext('2d');
        const ringCanvas = document.getElementById('ringCanvas');
        const ringCtx = ringCanvas.getContext('2d');

        // Parameters
        let R = 0.9;           // Mirror reflectivity
        let d = 10e-3;         // Cavity length (m)
        let lambda = 600e-9;   // Wavelength (m)
        let spectralRange = 1e-9; // View range (m)
        const n = 1;           // Refractive index of cavity

        let time = 0;

        // Controls
        document.getElementById('rSlider').addEventListener('input', (e) => {
            R = parseFloat(e.target.value);
            document.getElementById('rVal').textContent = R.toFixed(2);
            update();
        });

        document.getElementById('dSlider').addEventListener('input', (e) => {
            d = parseFloat(e.target.value) * 1e-3;
            document.getElementById('dVal').textContent = e.target.value;
            update();
        });

        document.getElementById('lambdaSlider').addEventListener('input', (e) => {
            lambda = parseFloat(e.target.value) * 1e-9;
            document.getElementById('lambdaVal').textContent = e.target.value;
            update();
        });

        document.getElementById('rangeSlider').addEventListener('input', (e) => {
            spectralRange = parseFloat(e.target.value) * 1e-9;
            document.getElementById('rangeVal').textContent = e.target.value;
            update();
        });

        function finesse() {
            return Math.PI * Math.sqrt(R) / (1 - R);
        }

        function fsr() {
            // Free spectral range: Δλ = λ²/(2nd)
            return lambda * lambda / (2 * n * d);
        }

        function transmission(wavelength) {
            // Airy function
            const delta = 4 * Math.PI * n * d / wavelength;
            const F = finesse();
            const coeff = (2 * F / Math.PI) ** 2;
            return 1 / (1 + coeff * Math.pow(Math.sin(delta / 2), 2));
        }

        function update() {
            const F = finesse();
            const FSR = fsr();
            const FWHM = FSR / F;
            const peakT = 1 / (1 + (1 - R) ** 2 / (4 * R)); // Simplified for ideal case

            document.getElementById('finesse').textContent = F.toFixed(1);
            document.getElementById('fsr').textContent = (FSR * 1e12).toFixed(3) + ' pm';
            document.getElementById('fwhm').textContent = (FWHM * 1e12).toFixed(3) + ' pm';
            document.getElementById('peakT').textContent = (peakT * 100).toFixed(1) + '%';

            // Resolving power: λ/δλ = mF where m is order
            const m = Math.round(2 * n * d / lambda);
            const resolvingPower = m * F;
            document.getElementById('resolving').textContent = resolvingPower.toExponential(2);

            drawSpectrum();
            drawRings();
        }

        function drawMain() {
            const ctx = mainCtx;
            const W = mainCanvas.width;
            const H = mainCanvas.height;

            // Clear
            ctx.fillStyle = '#0a0a1a';
            ctx.fillRect(0, 0, W, H);

            const mirrorX1 = 150;
            const mirrorX2 = 400;
            const mirrorH = 200;
            const centerY = H / 2;

            // Draw mirrors
            ctx.fillStyle = 'rgba(255, 213, 79, 0.3)';
            ctx.fillRect(mirrorX1 - 5, centerY - mirrorH / 2, 10, mirrorH);
            ctx.fillRect(mirrorX2 - 5, centerY - mirrorH / 2, 10, mirrorH);

            ctx.strokeStyle = '#ffd54f';
            ctx.lineWidth = 2;
            ctx.strokeRect(mirrorX1 - 5, centerY - mirrorH / 2, 10, mirrorH);
            ctx.strokeRect(mirrorX2 - 5, centerY - mirrorH / 2, 10, mirrorH);

            // Labels
            ctx.fillStyle = '#fff59d';
            ctx.font = '11px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Mirror 1', mirrorX1, centerY + mirrorH / 2 + 20);
            ctx.fillText('R = ' + R.toFixed(2), mirrorX1, centerY + mirrorH / 2 + 35);
            ctx.fillText('Mirror 2', mirrorX2, centerY + mirrorH / 2 + 20);
            ctx.fillText('R = ' + R.toFixed(2), mirrorX2, centerY + mirrorH / 2 + 35);

            // Cavity length label
            ctx.strokeStyle = 'rgba(255, 213, 79, 0.5)';
            ctx.setLineDash([3, 3]);
            ctx.beginPath();
            ctx.moveTo(mirrorX1, centerY - mirrorH / 2 - 20);
            ctx.lineTo(mirrorX2, centerY - mirrorH / 2 - 20);
            ctx.stroke();
            ctx.setLineDash([]);

            ctx.fillText('d = ' + (d * 1000).toFixed(1) + ' mm', (mirrorX1 + mirrorX2) / 2, centerY - mirrorH / 2 - 30);

            // Draw beam path with multiple reflections
            const inputY = centerY;
            const beamAngle = 0.02;

            // Incoming beam
            ctx.strokeStyle = '#ff7043';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(30, inputY);
            ctx.lineTo(mirrorX1 - 5, inputY);
            ctx.stroke();

            // Multiple bounces inside cavity
            const numBounces = 8;
            let intensity = 1;

            for (let i = 0; i < numBounces; i++) {
                const t = Math.sqrt(1 - R); // Transmission amplitude
                const r = Math.sqrt(R);     // Reflection amplitude

                intensity *= r * r; // Each bounce loses some intensity

                const alpha = Math.max(0.1, intensity);
                const y1 = inputY + i * 3;
                const y2 = inputY + (i + 1) * 3;

                // Forward beam in cavity
                ctx.strokeStyle = `rgba(255, 213, 79, ${alpha})`;
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(mirrorX1 + 5, y1);
                ctx.lineTo(mirrorX2 - 5, y1);
                ctx.stroke();

                // Backward beam
                if (i < numBounces - 1) {
                    ctx.beginPath();
                    ctx.moveTo(mirrorX2 - 5, y1);
                    ctx.lineTo(mirrorX1 + 5, y2);
                    ctx.stroke();
                }

                // Transmitted beams
                ctx.strokeStyle = `rgba(76, 175, 80, ${alpha * 0.8})`;
                ctx.beginPath();
                ctx.moveTo(mirrorX2 + 5, y1);
                ctx.lineTo(W - 30, y1 + (i + 1) * 2);
                ctx.stroke();
            }

            // Transmitted light label
            ctx.fillStyle = '#4caf50';
            ctx.textAlign = 'left';
            ctx.fillText('Transmitted', W - 80, centerY - 50);

            // Reflected light
            ctx.strokeStyle = 'rgba(255, 82, 82, 0.6)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(mirrorX1 - 5, inputY + 5);
            ctx.lineTo(30, inputY + 40);
            ctx.stroke();

            ctx.fillStyle = '#ff5252';
            ctx.textAlign = 'left';
            ctx.fillText('Reflected', 35, inputY + 55);

            // Input label
            ctx.fillStyle = '#ff7043';
            ctx.textAlign = 'center';
            ctx.fillText('Input Light', 80, inputY - 20);

            // Phase accumulation indicator
            const phaseText = 'δ = 4πnd/λ';
            ctx.fillStyle = '#fff59d';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(phaseText, (mirrorX1 + mirrorX2) / 2, centerY + 60);
        }

        function drawSpectrum() {
            const ctx = spectrumCtx;
            const W = spectrumCanvas.width;
            const H = spectrumCanvas.height;

            ctx.fillStyle = '#0a0a1a';
            ctx.fillRect(0, 0, W, H);

            const margin = { left: 50, right: 20, top: 30, bottom: 40 };
            const plotW = W - margin.left - margin.right;
            const plotH = H - margin.top - margin.bottom;

            // Axes
            ctx.strokeStyle = 'rgba(255, 213, 79, 0.5)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(margin.left, margin.top);
            ctx.lineTo(margin.left, H - margin.bottom);
            ctx.lineTo(W - margin.right, H - margin.bottom);
            ctx.stroke();

            // Labels
            ctx.fillStyle = '#fff59d';
            ctx.font = '10px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Wavelength (nm)', W / 2, H - 8);

            ctx.save();
            ctx.translate(12, H / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('Transmission', 0, 0);
            ctx.restore();

            // Plot transmission curve
            ctx.beginPath();

            const lambdaMin = lambda - spectralRange / 2;
            const lambdaMax = lambda + spectralRange / 2;

            for (let i = 0; i <= 300; i++) {
                const wl = lambdaMin + (lambdaMax - lambdaMin) * i / 300;
                const T = transmission(wl);

                const x = margin.left + (i / 300) * plotW;
                const y = H - margin.bottom - T * plotH;

                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }

            ctx.strokeStyle = '#ffd54f';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Fill under curve
            ctx.lineTo(margin.left + plotW, H - margin.bottom);
            ctx.lineTo(margin.left, H - margin.bottom);
            ctx.closePath();
            ctx.fillStyle = 'rgba(255, 213, 79, 0.1)';
            ctx.fill();

            // X-axis labels
            ctx.fillStyle = '#fff59d';
            ctx.font = '9px sans-serif';
            ctx.textAlign = 'center';
            for (let i = 0; i <= 4; i++) {
                const wl = lambdaMin + (lambdaMax - lambdaMin) * i / 4;
                const x = margin.left + (i / 4) * plotW;
                ctx.fillText((wl * 1e9).toFixed(2), x, H - margin.bottom + 15);
            }

            // Y-axis labels
            ctx.textAlign = 'right';
            ctx.fillText('0', margin.left - 5, H - margin.bottom);
            ctx.fillText('1', margin.left - 5, margin.top + 5);

            // Mark FSR
            const FSR = fsr();
            const fsrPixels = (FSR / spectralRange) * plotW;

            if (fsrPixels > 30 && fsrPixels < plotW) {
                ctx.strokeStyle = 'rgba(76, 175, 80, 0.5)';
                ctx.setLineDash([3, 3]);
                const fsrX = margin.left + plotW / 2;
                ctx.beginPath();
                ctx.moveTo(fsrX, margin.top);
                ctx.lineTo(fsrX, H - margin.bottom);
                ctx.moveTo(fsrX - fsrPixels / 2, margin.top);
                ctx.lineTo(fsrX - fsrPixels / 2, H - margin.bottom);
                ctx.stroke();
                ctx.setLineDash([]);

                ctx.fillStyle = '#4caf50';
                ctx.textAlign = 'center';
                ctx.fillText('FSR', fsrX - fsrPixels / 4, margin.top + 15);
            }
        }

        function drawRings() {
            const ctx = ringCtx;
            const W = ringCanvas.width;
            const H = ringCanvas.height;
            const cx = W / 2;
            const cy = H / 2;
            const maxR = 80;

            ctx.fillStyle = '#0a0a1a';
            ctx.fillRect(0, 0, W, H);

            // Draw interference rings
            // Rings appear at angles where constructive interference occurs
            const F = finesse();
            const m0 = Math.floor(2 * n * d / lambda);

            for (let r = 0; r <= maxR; r++) {
                const theta = (r / maxR) * 0.05; // Small angle approximation
                const cosTheta = Math.cos(theta);
                const delta = 4 * Math.PI * n * d * cosTheta / lambda;
                const T = 1 / (1 + (2 * F / Math.PI) ** 2 * Math.sin(delta / 2) ** 2);

                // Color based on wavelength
                const hue = 60 - ((lambda - 400e-9) / 300e-9) * 30;
                const lightness = 20 + T * 60;

                ctx.strokeStyle = `hsl(${hue}, 80%, ${lightness}%)`;
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.arc(cx, cy, r, 0, Math.PI * 2);
                ctx.stroke();
            }

            // Add glow to bright rings
            ctx.globalCompositeOperation = 'lighter';
            ctx.filter = 'blur(2px)';

            for (let r = 0; r <= maxR; r += 2) {
                const theta = (r / maxR) * 0.05;
                const cosTheta = Math.cos(theta);
                const delta = 4 * Math.PI * n * d * cosTheta / lambda;
                const T = 1 / (1 + (2 * F / Math.PI) ** 2 * Math.sin(delta / 2) ** 2);

                if (T > 0.5) {
                    ctx.strokeStyle = `rgba(255, 213, 79, ${T * 0.3})`;
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(cx, cy, r, 0, Math.PI * 2);
                    ctx.stroke();
                }
            }

            ctx.filter = 'none';
            ctx.globalCompositeOperation = 'source-over';

            // Center label
            ctx.fillStyle = '#fff59d';
            ctx.font = '9px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Center (θ=0)', cx, H - 5);
        }

        function animate() {
            time += 0.016;
            drawMain();
            requestAnimationFrame(animate);
        }

        update();
        animate();
    </script>
</body>
</html>
