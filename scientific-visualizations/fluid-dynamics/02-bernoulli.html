<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bernoulli's Principle</title>
    <style>
        body { margin: 0; overflow: hidden; background: #0a0a1a; font-family: Arial; }
        canvas { display: block; }
        .info { position: absolute; top: 20px; left: 20px; color: #88ff88; background: rgba(0,0,0,0.9); padding: 15px; border-radius: 10px; }
    </style>
</head>
<body>
    <div class="info">
        <h2>Bernoulli's Principle</h2>
        <p>P + ½ρv² + ρgh = constant</p>
        <p>Higher velocity → Lower pressure</p>
        <p>Fluid flow through constriction</p>
    </div>
    <canvas id="canvas"></canvas>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        class FluidParticle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.vx = 3;
                this.vy = (Math.random() - 0.5) * 0.5;
                this.trail = [];
            }

            update() {
                // Determine pipe width at current x
                const pipeTop = getPipeY(this.x, true);
                const pipeBottom = getPipeY(this.x, false);
                const pipeWidth = pipeBottom - pipeTop;

                // Bernoulli: narrow section = faster flow
                const normalWidth = 200;
                const speedFactor = normalWidth / pipeWidth;
                this.vx = 3 * speedFactor;

                this.x += this.vx;
                this.y += this.vy;

                // Bounce off walls
                if (this.y < pipeTop + 5) {
                    this.y = pipeTop + 5;
                    this.vy = Math.abs(this.vy);
                }
                if (this.y > pipeBottom - 5) {
                    this.y = pipeBottom - 5;
                    this.vy = -Math.abs(this.vy);
                }

                // Reset if off screen
                if (this.x > canvas.width) {
                    this.x = 50;
                    this.y = canvas.height / 2 + (Math.random() - 0.5) * 150;
                    this.trail = [];
                }

                this.trail.push({x: this.x, y: this.y, speed: this.vx});
                if (this.trail.length > 40) this.trail.shift();
            }

            draw() {
                // Trail
                if (this.trail.length > 1) {
                    ctx.beginPath();
                    this.trail.forEach((p, i) => {
                        if (i === 0) ctx.moveTo(p.x, p.y);
                        else ctx.lineTo(p.x, p.y);
                    });

                    const speed = this.vx;
                    const hue = 180 - (speed - 3) * 30;
                    ctx.strokeStyle = `hsla(${hue}, 100%, 60%, 0.6)`;
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }

                // Particle
                ctx.beginPath();
                ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);
                ctx.fillStyle = '#fff';
                ctx.fill();
            }
        }

        function getPipeY(x, isTop) {
            const centerY = canvas.height / 2;
            const normalHalfWidth = 100;
            const constrictionStart = canvas.width * 0.4;
            const constrictionEnd = canvas.width * 0.6;
            const constrictionHalfWidth = 40;

            let halfWidth = normalHalfWidth;

            if (x >= constrictionStart && x <= constrictionEnd) {
                const t = (x - constrictionStart) / (constrictionEnd - constrictionStart);
                const sinT = Math.sin(t * Math.PI);
                halfWidth = normalHalfWidth - (normalHalfWidth - constrictionHalfWidth) * sinT;
            }

            return isTop ? centerY - halfWidth : centerY + halfWidth;
        }

        const particles = Array.from({length: 200}, (_, i) =>
            new FluidParticle(i * 3, canvas.height / 2 + (Math.random() - 0.5) * 150)
        );

        function drawPipe() {
            ctx.strokeStyle = '#444';
            ctx.lineWidth = 8;

            // Top wall
            ctx.beginPath();
            for (let x = 0; x <= canvas.width; x += 5) {
                const y = getPipeY(x, true);
                if (x === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();

            // Bottom wall
            ctx.beginPath();
            for (let x = 0; x <= canvas.width; x += 5) {
                const y = getPipeY(x, false);
                if (x === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();

            // Pressure indicators
            const positions = [
                {x: canvas.width * 0.2, label: 'Low velocity\nHigh pressure'},
                {x: canvas.width * 0.5, label: 'High velocity\nLow pressure'},
                {x: canvas.width * 0.8, label: 'Low velocity\nHigh pressure'}
            ];

            positions.forEach(pos => {
                const top = getPipeY(pos.x, true);
                const bottom = getPipeY(pos.x, false);
                const width = bottom - top;

                ctx.fillStyle = `rgba(255, 100, 100, ${0.3 * (200 / width)})`;
                ctx.fillRect(pos.x - 20, top, 40, width);

                ctx.fillStyle = '#fff';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                const lines = pos.label.split('\n');
                lines.forEach((line, i) => {
                    ctx.fillText(line, pos.x, top - 30 - i * 15);
                });
            });
        }

        function draw() {
            ctx.fillStyle = 'rgba(10, 10, 26, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            drawPipe();

            particles.forEach(p => {
                p.update();
                p.draw();
            });
        }

        function animate() {
            draw();
            requestAnimationFrame(animate);
        }

        animate();
    </script>
    <script src="../../assets/js/enhance.js" defer></script>
</body>
</html>