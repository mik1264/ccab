<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hurricane Dynamics & Coriolis Force</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background: linear-gradient(135deg, #0a1628 0%, #1a2a48 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        #container {
            position: relative;
        }
        canvas {
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            box-shadow: 0 0 60px rgba(100, 180, 255, 0.3);
        }
        .back-link {
            position: fixed;
            top: 15px;
            left: 15px;
            color: #88ddff;
            text-decoration: none;
            font-size: 14px;
            opacity: 0.8;
            z-index: 100;
        }
        .back-link:hover {
            opacity: 1;
        }
        .info {
            position: absolute;
            top: 20px;
            right: -280px;
            color: white;
            background: rgba(0, 0, 0, 0.85);
            padding: 15px 20px;
            border-radius: 10px;
            font-size: 13px;
            line-height: 1.6;
            width: 260px;
            backdrop-filter: blur(10px);
        }
        .info h3 {
            color: #88ddff;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .info p {
            margin: 8px 0;
        }
        .info .formula {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            color: #ffdd88;
            margin: 10px 0;
            font-size: 14px;
        }
        .controls {
            position: absolute;
            bottom: -80px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .control-group {
            background: rgba(0, 0, 0, 0.85);
            padding: 10px 15px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .control-group label {
            color: #88ddff;
            font-size: 11px;
            font-weight: 500;
            min-width: 60px;
        }
        .control-group input[type="range"] {
            width: 80px;
            accent-color: #88ddff;
        }
        .control-group .value {
            color: #fff;
            font-size: 11px;
            min-width: 35px;
            text-align: right;
        }
        .hemisphere-toggle {
            display: flex;
            gap: 5px;
        }
        .hemisphere-toggle button {
            background: rgba(100, 100, 100, 0.5);
            border: 1px solid #888;
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 11px;
        }
        .hemisphere-toggle button.active {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            border-color: #64b5f6;
        }
        .status {
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.85);
            padding: 10px 20px;
            border-radius: 8px;
            color: white;
            font-size: 12px;
            text-align: center;
        }
        .status span {
            color: #88ddff;
        }
    </style>
</head>
<body>
    <a href="../index.html" class="back-link">← Back</a>
    <div id="container">
        <div class="status">
            Hemisphere: <span id="hemiDisplay">Northern</span> |
            Rotation: <span id="rotDisplay">Counter-clockwise</span> |
            Coriolis: <span id="corDisplay">Right deflection</span>
        </div>
        <canvas id="canvas"></canvas>
        <div class="info">
            <h3>Coriolis Effect on Hurricanes</h3>
            <p>The Coriolis force deflects moving air due to Earth's rotation.</p>
            <div class="formula">F = -2m(Ω × v)</div>
            <p><strong>Northern Hemisphere:</strong> Deflection to the right → counter-clockwise rotation</p>
            <p><strong>Southern Hemisphere:</strong> Deflection to the left → clockwise rotation</p>
            <p>Hurricanes cannot form within 5° of the equator (Coriolis ≈ 0).</p>
        </div>
        <div class="controls">
            <div class="control-group">
                <label>Coriolis</label>
                <input type="range" id="coriolis" min="0" max="1" step="0.05" value="0.5">
                <span class="value" id="corVal">0.50</span>
            </div>
            <div class="control-group">
                <label>Pressure</label>
                <input type="range" id="pressure" min="0.1" max="1" step="0.05" value="0.5">
                <span class="value" id="presVal">0.50</span>
            </div>
            <div class="control-group">
                <label>Wind Speed</label>
                <input type="range" id="windSpeed" min="0.5" max="3" step="0.1" value="1.5">
                <span class="value" id="windVal">1.5</span>
            </div>
            <div class="control-group hemisphere-toggle">
                <button id="northBtn" class="active">North</button>
                <button id="southBtn">South</button>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        const size = 600;
        canvas.width = size;
        canvas.height = size;

        const centerX = size / 2;
        const centerY = size / 2;

        // Parameters
        let coriolisStrength = 0.5;
        let pressureGradient = 0.5;
        let windSpeed = 1.5;
        let hemisphere = 1; // 1 = North (CCW), -1 = South (CW)
        let time = 0;

        // Air parcels (particles)
        const particles = [];
        const numParticels = 300;

        function initParticles() {
            particles.length = 0;
            for (let i = 0; i < numParticels; i++) {
                const angle = Math.random() * Math.PI * 2;
                const r = 80 + Math.random() * 180;
                particles.push({
                    x: centerX + Math.cos(angle) * r,
                    y: centerY + Math.sin(angle) * r,
                    vx: 0,
                    vy: 0,
                    trail: [],
                    age: Math.random() * 100
                });
            }
        }
        initParticles();

        // Spiral rain bands
        const rainBands = [];
        const numBands = 5;
        for (let i = 0; i < numBands; i++) {
            rainBands.push({
                baseAngle: (i / numBands) * Math.PI * 2,
                width: 15 + Math.random() * 10
            });
        }

        // UI Elements
        document.getElementById('coriolis').addEventListener('input', (e) => {
            coriolisStrength = parseFloat(e.target.value);
            document.getElementById('corVal').textContent = coriolisStrength.toFixed(2);
        });

        document.getElementById('pressure').addEventListener('input', (e) => {
            pressureGradient = parseFloat(e.target.value);
            document.getElementById('presVal').textContent = pressureGradient.toFixed(2);
        });

        document.getElementById('windSpeed').addEventListener('input', (e) => {
            windSpeed = parseFloat(e.target.value);
            document.getElementById('windVal').textContent = windSpeed.toFixed(1);
        });

        document.getElementById('northBtn').addEventListener('click', () => {
            hemisphere = 1;
            document.getElementById('northBtn').classList.add('active');
            document.getElementById('southBtn').classList.remove('active');
            updateDisplays();
        });

        document.getElementById('southBtn').addEventListener('click', () => {
            hemisphere = -1;
            document.getElementById('southBtn').classList.add('active');
            document.getElementById('northBtn').classList.remove('active');
            updateDisplays();
        });

        function updateDisplays() {
            document.getElementById('hemiDisplay').textContent = hemisphere === 1 ? 'Northern' : 'Southern';
            document.getElementById('rotDisplay').textContent = hemisphere === 1 ? 'Counter-clockwise' : 'Clockwise';
            document.getElementById('corDisplay').textContent = hemisphere === 1 ? 'Right deflection' : 'Left deflection';
        }

        function simulate() {
            for (const p of particles) {
                // Calculate distance from center (low pressure)
                const dx = p.x - centerX;
                const dy = p.y - centerY;
                const dist = Math.sqrt(dx * dx + dy * dy);

                if (dist < 10) dist = 10; // Prevent singularity

                // Pressure gradient force (toward center)
                const pressureForceX = -dx / dist * pressureGradient * 0.3;
                const pressureForceY = -dy / dist * pressureGradient * 0.3;

                // Apply pressure gradient
                p.vx += pressureForceX;
                p.vy += pressureForceY;

                // Coriolis force: F = -2 * Omega cross V
                // In 2D: deflects velocity perpendicular to motion
                // Northern: deflect right (perpendicular CCW from velocity)
                // Southern: deflect left (perpendicular CW from velocity)
                const coriolisX = hemisphere * coriolisStrength * p.vy * 0.1;
                const coriolisY = -hemisphere * coriolisStrength * p.vx * 0.1;

                p.vx += coriolisX;
                p.vy += coriolisY;

                // Friction/damping
                p.vx *= 0.98;
                p.vy *= 0.98;

                // Update position
                p.x += p.vx * windSpeed;
                p.y += p.vy * windSpeed;

                // Store trail
                p.trail.push({ x: p.x, y: p.y });
                if (p.trail.length > 20) p.trail.shift();

                // Respawn if too far or too close to center
                if (dist > size / 2 - 20 || dist < 25) {
                    const angle = Math.random() * Math.PI * 2;
                    const r = 100 + Math.random() * 150;
                    p.x = centerX + Math.cos(angle) * r;
                    p.y = centerY + Math.sin(angle) * r;
                    p.vx = 0;
                    p.vy = 0;
                    p.trail = [];
                }

                p.age += 0.1;
            }
        }

        function draw() {
            // Background - Earth view from space
            const bgGrad = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, size / 2);
            bgGrad.addColorStop(0, '#2a5a8a');
            bgGrad.addColorStop(0.7, '#1a3a5a');
            bgGrad.addColorStop(1, '#0a1628');
            ctx.fillStyle = bgGrad;
            ctx.fillRect(0, 0, size, size);

            // Ocean color underneath
            ctx.beginPath();
            ctx.arc(centerX, centerY, size / 2 - 5, 0, Math.PI * 2);
            const oceanGrad = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, size / 2);
            oceanGrad.addColorStop(0, '#1a4a7a');
            oceanGrad.addColorStop(1, '#0a2a4a');
            ctx.fillStyle = oceanGrad;
            ctx.fill();

            // Draw spiral rain bands (clouds)
            const rotDir = -hemisphere;
            for (const band of rainBands) {
                ctx.beginPath();
                for (let r = 30; r < size / 2 - 50; r += 5) {
                    const spiralAngle = band.baseAngle + (r / 50) * rotDir + time * 0.02 * rotDir;
                    const x = centerX + Math.cos(spiralAngle) * r;
                    const y = centerY + Math.sin(spiralAngle) * r;

                    const cloudAlpha = 0.3 + 0.3 * Math.sin(r / 30 + time * 0.1);
                    ctx.beginPath();
                    ctx.arc(x, y, band.width * (1 - r / (size / 2)), 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(255, 255, 255, ${cloudAlpha * 0.3})`;
                    ctx.fill();
                }
            }

            // Draw eye wall
            ctx.beginPath();
            ctx.arc(centerX, centerY, 35, 0, Math.PI * 2);
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
            ctx.lineWidth = 8;
            ctx.stroke();

            // Draw clear eye
            ctx.beginPath();
            ctx.arc(centerX, centerY, 25, 0, Math.PI * 2);
            ctx.fillStyle = '#1a5a9a';
            ctx.fill();

            // Draw particle trails
            for (const p of particles) {
                if (p.trail.length < 2) continue;

                ctx.beginPath();
                for (let i = 0; i < p.trail.length; i++) {
                    const alpha = i / p.trail.length;
                    if (i === 0) {
                        ctx.moveTo(p.trail[i].x, p.trail[i].y);
                    } else {
                        ctx.lineTo(p.trail[i].x, p.trail[i].y);
                    }
                }
                ctx.strokeStyle = `rgba(200, 230, 255, 0.4)`;
                ctx.lineWidth = 1.5;
                ctx.stroke();

                // Draw particle head
                ctx.beginPath();
                ctx.arc(p.x, p.y, 2, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.fill();
            }

            // Draw rotation direction arrow
            const arrowRadius = size / 2 - 40;
            const arrowAngle = time * 0.05 * rotDir;
            const arrowX = centerX + Math.cos(arrowAngle) * arrowRadius;
            const arrowY = centerY + Math.sin(arrowAngle) * arrowRadius;

            ctx.beginPath();
            ctx.arc(centerX, centerY, arrowRadius, arrowAngle - 0.3, arrowAngle, rotDir === 1);
            ctx.strokeStyle = '#ffdd88';
            ctx.lineWidth = 3;
            ctx.stroke();

            // Arrow head
            const tipAngle = arrowAngle + rotDir * 0.1;
            const tipX = centerX + Math.cos(tipAngle) * arrowRadius;
            const tipY = centerY + Math.sin(tipAngle) * arrowRadius;

            ctx.beginPath();
            ctx.moveTo(tipX, tipY);
            ctx.lineTo(tipX + Math.cos(tipAngle + rotDir * 2.5) * 15,
                       tipY + Math.sin(tipAngle + rotDir * 2.5) * 15);
            ctx.lineTo(tipX + Math.cos(tipAngle + rotDir * 0.8) * 10,
                       tipY + Math.sin(tipAngle + rotDir * 0.8) * 10);
            ctx.closePath();
            ctx.fillStyle = '#ffdd88';
            ctx.fill();

            // Label
            ctx.fillStyle = '#ffdd88';
            ctx.font = '14px Segoe UI';
            ctx.textAlign = 'center';
            ctx.fillText(hemisphere === 1 ? 'CCW Rotation' : 'CW Rotation', centerX, size - 15);

            // Pressure labels
            ctx.fillStyle = '#88ddff';
            ctx.font = '12px Segoe UI';
            ctx.fillText('LOW', centerX, centerY + 5);
            ctx.fillText('HIGH', centerX, 25);

            time += 1;
        }

        function animate() {
            simulate();
            draw();
            requestAnimationFrame(animate);
        }

        // Expose for enhance.js
        window.reset = function() { time = 0; initParticles(); };

        animate();
    </script>
    <script src="../../assets/js/enhance.js" defer></script>
</body>
</html>
