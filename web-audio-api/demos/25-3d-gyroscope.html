<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Audio Gyroscope</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        canvas { display: block; }
        .controls { position: absolute; top: 20px; left: 20px; color: white; background: rgba(0,0,0,0.7); padding: 15px; border-radius: 10px; }
        button { background: #00BCD4; color: white; border: none; padding: 10px 20px; margin: 5px; cursor: pointer; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="controls">
        <h2>Audio Gyroscope</h2>
        <input type="file" id="audioFile" accept="audio/*"><br>
        <button id="playBtn">Play</button><button id="pauseBtn">Pause</button>
    </div>
    <canvas id="canvas"></canvas>
    <script>
        const canvas = document.getElementById('canvas'); const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        let audioContext, analyser, dataArray, bufferLength, source, audio, rotX = 0, rotY = 0, rotZ = 0;

        document.getElementById('audioFile').addEventListener('change', e => {
            if (e.target.files[0]) initAudio(URL.createObjectURL(e.target.files[0]));
        });
        document.getElementById('playBtn').addEventListener('click', () => {
            if (audio) { audio.play(); if (!audioContext) setupAudioContext(); visualize(); }
        });
        document.getElementById('pauseBtn').addEventListener('click', () => { if (audio) audio.pause(); });

        function initAudio(url) {
            if (audio) audio.pause();
            audio = new Audio(url); audio.loop = true;
            if (!audioContext) setupAudioContext();
            else {
                if (source) source.disconnect();
                source = audioContext.createMediaElementSource(audio);
                source.connect(analyser); analyser.connect(audioContext.destination);
            }
        }

        function setupAudioContext() {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioContext.createAnalyser(); analyser.fftSize = 256;
            bufferLength = analyser.frequencyBinCount; dataArray = new Uint8Array(bufferLength);
            if (audio) {
                source = audioContext.createMediaElementSource(audio);
                source.connect(analyser); analyser.connect(audioContext.destination);
            }
        }

        function visualize() {
            requestAnimationFrame(visualize);
            analyser.getByteFrequencyData(dataArray);
            ctx.fillStyle = 'rgba(0,0,0,0.1)'; ctx.fillRect(0, 0, canvas.width, canvas.height);

            const avg = dataArray.reduce((a,b) => a+b) / bufferLength;
            rotX += 0.01; rotY += 0.015; rotZ += 0.008;

            const cx = canvas.width / 2, cy = canvas.height / 2;
            const rings = 3;

            for (let ring = 0; ring < rings; ring++) {
                const radius = 100 + ring * 50 + avg * 0.5;
                const segments = 64;

                ctx.strokeStyle = `hsl(${ring * 120}, 100%, 50%)`;
                ctx.lineWidth = 2;
                ctx.beginPath();

                for (let i = 0; i <= segments; i++) {
                    const angle = (i / segments) * Math.PI * 2;
                    let x = Math.cos(angle) * radius;
                    let y = Math.sin(angle) * radius;
                    let z = 0;

                    // Rotate based on ring
                    if (ring === 0) {
                        const t = x; x = x * Math.cos(rotX) - z * Math.sin(rotX); z = t * Math.sin(rotX) + z * Math.cos(rotX);
                    } else if (ring === 1) {
                        const t = y; y = y * Math.cos(rotY) - z * Math.sin(rotY); z = t * Math.sin(rotY) + z * Math.cos(rotY);
                    } else {
                        const t = x; x = x * Math.cos(rotZ) - y * Math.sin(rotZ); y = t * Math.sin(rotZ) + y * Math.cos(rotZ);
                    }

                    const scale = 300 / (300 + z);
                    const sx = cx + x * scale;
                    const sy = cy + y * scale;

                    if (i === 0) ctx.moveTo(sx, sy);
                    else ctx.lineTo(sx, sy);
                }
                ctx.closePath();
                ctx.stroke();
            }
        }

        window.addEventListener('load', () => {
            setupAudioContext();
            const osc = audioContext.createOscillator(), gain = audioContext.createGain();
            osc.connect(gain); gain.connect(analyser); analyser.connect(audioContext.destination);
            osc.frequency.value = 440; gain.gain.value = 0.1; osc.start();
            visualize();
        });
    </script>
    <script src="../../assets/js/enhance.js" defer></script>
</body>
</html>
