<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Multi-Band Beat Detection</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        canvas { display: block; }
        .controls { position: absolute; top: 20px; left: 20px; color: white; background: rgba(0,0,0,0.7); padding: 15px; border-radius: 10px; }
        button { background: #9C27B0; color: white; border: none; padding: 10px 20px; margin: 5px; cursor: pointer; border-radius: 5px; }
        .band-labels { position: absolute; right: 20px; top: 20px; color: white; font-family: monospace; background: rgba(0,0,0,0.7); padding: 15px; border-radius: 10px; }
        .band { margin: 5px 0; }
        .band-indicator { display: inline-block; width: 100px; height: 20px; background: #333; margin-left: 10px; position: relative; }
        .band-indicator.active { background: linear-gradient(90deg, #ff0, #f00); }
    </style>
</head>
<body>
    <div class="controls">
        <h2>Multi-Band Beat Detection</h2>
        <input type="file" id="audioFile" accept="audio/*"><br>
        <button id="playBtn">Play</button><button id="pauseBtn">Pause</button>
    </div>
    <div class="band-labels">
        <div class="band">Bass: <span class="band-indicator" id="bass"></span></div>
        <div class="band">Low-Mid: <span class="band-indicator" id="lowmid"></span></div>
        <div class="band">Mid: <span class="band-indicator" id="mid"></span></div>
        <div class="band">High: <span class="band-indicator" id="high"></span></div>
    </div>
    <canvas id="canvas"></canvas>
    <script>
        const canvas = document.getElementById('canvas'); const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        let audioContext, analyser, dataArray, bufferLength, source, audio;

        const bands = {
            bass: { range: [0, 10], threshold: 180, lastBeat: 0, elem: document.getElementById('bass') },
            lowmid: { range: [10, 30], threshold: 170, lastBeat: 0, elem: document.getElementById('lowmid') },
            mid: { range: [30, 60], threshold: 160, lastBeat: 0, elem: document.getElementById('mid') },
            high: { range: [60, 100], threshold: 150, lastBeat: 0, elem: document.getElementById('high') }
        };

        document.getElementById('audioFile').addEventListener('change', e => {
            if (e.target.files[0]) initAudio(URL.createObjectURL(e.target.files[0]));
        });
        document.getElementById('playBtn').addEventListener('click', () => {
            if (audio) { audio.play(); if (!audioContext) setupAudioContext(); visualize(); }
        });
        document.getElementById('pauseBtn').addEventListener('click', () => { if (audio) audio.pause(); });

        function initAudio(url) {
            if (audio) audio.pause();
            audio = new Audio(url); audio.loop = true;
            if (!audioContext) setupAudioContext();
            else {
                if (source) source.disconnect();
                source = audioContext.createMediaElementSource(audio);
                source.connect(analyser); analyser.connect(audioContext.destination);
            }
        }

        function setupAudioContext() {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioContext.createAnalyser(); analyser.fftSize = 512;
            bufferLength = analyser.frequencyBinCount; dataArray = new Uint8Array(bufferLength);
            if (audio) {
                source = audioContext.createMediaElementSource(audio);
                source.connect(analyser); analyser.connect(audioContext.destination);
            }
        }

        function detectBandBeat(band) {
            let sum = 0;
            for (let i = band.range[0]; i < band.range[1]; i++) {
                sum += dataArray[i];
            }
            const avg = sum / (band.range[1] - band.range[0]);

            if (avg > band.threshold && Date.now() - band.lastBeat > 200) {
                band.lastBeat = Date.now();
                band.elem.classList.add('active');
                setTimeout(() => band.elem.classList.remove('active'), 100);
                return true;
            }
            return false;
        }

        function visualize() {
            requestAnimationFrame(visualize);
            analyser.getByteFrequencyData(dataArray);

            ctx.fillStyle = 'rgba(0,0,0,0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const colors = ['#FF0000', '#00FF00', '#0000FF', '#FFFF00'];
            let i = 0;

            for (const key in bands) {
                const band = bands[key];
                const isBeat = detectBandBeat(band);

                if (isBeat) {
                    const cx = canvas.width / 2, cy = canvas.height / 2;
                    const radius = 50 + i * 80;

                    ctx.strokeStyle = colors[i];
                    ctx.lineWidth = 10;
                    ctx.beginPath();
                    ctx.arc(cx, cy, radius, 0, Math.PI * 2);
                    ctx.stroke();
                }
                i++;
            }
        }

        window.addEventListener('load', () => {
            setupAudioContext();
            const osc = audioContext.createOscillator(), gain = audioContext.createGain();
            osc.connect(gain); gain.connect(analyser); analyser.connect(audioContext.destination);
            osc.frequency.value = 100; gain.gain.value = 0.1; osc.start();
            visualize();
        });
    </script>
</body>
</html>
