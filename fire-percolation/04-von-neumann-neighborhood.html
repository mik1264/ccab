<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Von Neumann Neighborhood - Fire Percolation</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
            min-height: 100vh;
        }
        h1 {
            margin: 0 0 10px 0;
            font-size: 2em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .description {
            text-align: center;
            max-width: 900px;
            margin-bottom: 20px;
            line-height: 1.6;
            opacity: 0.9;
        }
        .controls {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
            backdrop-filter: blur(10px);
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            align-items: center;
        }
        label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        select, input[type="range"] {
            padding: 5px 10px;
            border-radius: 5px;
            border: none;
            background: rgba(255,255,255,0.2);
            color: white;
        }
        button {
            background: #16a085;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.3s;
        }
        button:hover {
            background: #1abc9c;
        }
        .main-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .canvas-container {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        canvas {
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 5px;
            background: black;
        }
        .legend {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            max-width: 300px;
        }
        .legend-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .legend-color {
            width: 30px;
            height: 30px;
            margin-right: 10px;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 3px;
        }
        .neighborhood-demo {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
        }
        .neighborhood-title {
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }
        .grid-demo {
            display: grid;
            grid-template-columns: repeat(3, 40px);
            gap: 2px;
            justify-content: center;
        }
        .cell-demo {
            width: 40px;
            height: 40px;
            border: 1px solid rgba(255,255,255,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border-radius: 3px;
        }
        .center-cell {
            background: #ff0000;
        }
        .neighbor-cell {
            background: #ffaa00;
        }
        .diagonal-cell {
            background: #333;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <h1>Von Neumann Neighborhood Visualization</h1>
    <div class="description">
        Fire spreads only to the 4 cardinal neighbors (North, South, East, West) - this is the Von Neumann
        neighborhood. Compare with Moore neighborhood (8 neighbors including diagonals) to see how topology
        affects percolation. Von Neumann requires higher density (~59%) than Moore (~41%) for percolation.
    </div>

    <div class="controls">
        <div class="control-group">
            <label>Neighborhood Type:</label>
            <select id="neighborhoodType">
                <option value="von-neumann">Von Neumann (4 neighbors)</option>
                <option value="moore">Moore (8 neighbors)</option>
            </select>
        </div>
        <div class="control-group">
            <label>Density: <span id="densityValue">59</span>%</label>
            <input type="range" id="density" min="30" max="90" value="59">
        </div>
        <div class="control-group">
            <label>Cell Size: <span id="sizeValue">6</span>px</label>
            <input type="range" id="cellSize" min="2" max="10" value="6">
        </div>
        <button id="runBtn">Start Fire</button>
        <button id="resetBtn">Reset</button>
    </div>

    <div class="main-container">
        <div class="canvas-container">
            <canvas id="canvas"></canvas>
        </div>

        <div class="legend">
            <div class="legend-title">Spread Patterns</div>

            <div class="legend-item">
                <div class="legend-color" style="background: #00ff00;"></div>
                <div>Tree (unburned)</div>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ff0000;"></div>
                <div>Active Fire</div>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ff6600;"></div>
                <div>Ember (fading)</div>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #000;"></div>
                <div>Empty/Burned</div>
            </div>

            <div class="neighborhood-demo">
                <div class="neighborhood-title" id="demoTitle">Von Neumann (4 neighbors)</div>
                <div class="grid-demo">
                    <div class="cell-demo diagonal-cell" id="nw">‚úó</div>
                    <div class="cell-demo neighbor-cell" id="n">‚Üë</div>
                    <div class="cell-demo diagonal-cell" id="ne">‚úó</div>
                    <div class="cell-demo neighbor-cell" id="w">‚Üê</div>
                    <div class="cell-demo center-cell">üî•</div>
                    <div class="cell-demo neighbor-cell" id="e">‚Üí</div>
                    <div class="cell-demo diagonal-cell" id="sw">‚úó</div>
                    <div class="cell-demo neighbor-cell" id="s">‚Üì</div>
                    <div class="cell-demo diagonal-cell" id="se">‚úó</div>
                </div>
            </div>

            <div style="margin-top: 15px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 5px; font-size: 0.9em;">
                <strong>Critical Thresholds:</strong><br>
                Von Neumann: ~59%<br>
                Moore: ~41%
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        const neighborhoodSelect = document.getElementById('neighborhoodType');
        const densitySlider = document.getElementById('density');
        const densityValue = document.getElementById('densityValue');
        const sizeSlider = document.getElementById('cellSize');
        const sizeValue = document.getElementById('sizeValue');

        let gridSize = 120;
        let cellSize = 6;
        let density = 0.59;
        let neighborhoodType = 'von-neumann';
        let running = false;

        let grid = [];
        let fires = [];

        function initCanvas() {
            canvas.width = gridSize * cellSize;
            canvas.height = gridSize * cellSize;
        }

        function initGrid() {
            grid = Array(gridSize).fill(0).map(() => Array(gridSize).fill(0));
            fires = [];
            running = false;

            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    if (Math.random() < density) {
                        grid[y][x] = 1;
                    }
                }
            }

            draw();
        }

        function startFire() {
            if (running) return;

            for (let y = 0; y < gridSize; y++) {
                if (grid[y][0] === 1) {
                    grid[y][0] = 2;
                    fires.push({x: 0, y});
                }
            }

            running = true;
        }

        function getNeighbors(x, y) {
            const neighbors = [
                {x, y: y - 1},     // North
                {x, y: y + 1},     // South
                {x: x - 1, y},     // West
                {x: x + 1, y}      // East
            ];

            if (neighborhoodType === 'moore') {
                neighbors.push(
                    {x: x - 1, y: y - 1},  // NW
                    {x: x + 1, y: y - 1},  // NE
                    {x: x - 1, y: y + 1},  // SW
                    {x: x + 1, y: y + 1}   // SE
                );
            }

            return neighbors;
        }

        function update() {
            if (!running || fires.length === 0) {
                if (running && fires.length === 0) {
                    running = false;
                }
                return;
            }

            const newFires = [];

            for (const {x, y} of fires) {
                const neighbors = getNeighbors(x, y);

                for (const n of neighbors) {
                    if (n.x >= 0 && n.x < gridSize && n.y >= 0 && n.y < gridSize) {
                        if (grid[n.y][n.x] === 1) {
                            grid[n.y][n.x] = 2;
                            newFires.push(n);
                        }
                    }
                }

                grid[y][x] = 3;
            }

            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    if (grid[y][x] >= 3 && grid[y][x] < 15) {
                        grid[y][x]++;
                    } else if (grid[y][x] >= 15) {
                        grid[y][x] = 0;
                    }
                }
            }

            fires = newFires;
        }

        function draw() {
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    const state = grid[y][x];

                    if (state === 1) {
                        ctx.fillStyle = '#00ff00';
                    } else if (state === 2) {
                        ctx.fillStyle = '#ff0000';
                    } else if (state >= 3) {
                        const fade = (state - 3) / 12;
                        const r = Math.floor(255 * (1 - fade));
                        const g = Math.floor(100 * (1 - fade));
                        ctx.fillStyle = `rgb(${r}, ${g}, 0)`;
                    } else {
                        continue;
                    }

                    ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
                }
            }
        }

        function updateNeighborhoodDemo() {
            if (neighborhoodType === 'von-neumann') {
                document.getElementById('demoTitle').textContent = 'Von Neumann (4 neighbors)';
                document.getElementById('nw').className = 'cell-demo diagonal-cell';
                document.getElementById('ne').className = 'cell-demo diagonal-cell';
                document.getElementById('sw').className = 'cell-demo diagonal-cell';
                document.getElementById('se').className = 'cell-demo diagonal-cell';
                document.getElementById('nw').textContent = '‚úó';
                document.getElementById('ne').textContent = '‚úó';
                document.getElementById('sw').textContent = '‚úó';
                document.getElementById('se').textContent = '‚úó';
            } else {
                document.getElementById('demoTitle').textContent = 'Moore (8 neighbors)';
                document.getElementById('nw').className = 'cell-demo neighbor-cell';
                document.getElementById('ne').className = 'cell-demo neighbor-cell';
                document.getElementById('sw').className = 'cell-demo neighbor-cell';
                document.getElementById('se').className = 'cell-demo neighbor-cell';
                document.getElementById('nw').textContent = '‚Üñ';
                document.getElementById('ne').textContent = '‚Üó';
                document.getElementById('sw').textContent = '‚Üô';
                document.getElementById('se').textContent = '‚Üò';
            }
        }

        let frameCount = 0;
        function animate() {
            frameCount++;

            if (frameCount % 3 === 0) {
                update();
                draw();
            }

            requestAnimationFrame(animate);
        }

        neighborhoodSelect.addEventListener('change', (e) => {
            neighborhoodType = e.target.value;
            updateNeighborhoodDemo();
            initGrid();
        });

        densitySlider.addEventListener('input', (e) => {
            densityValue.textContent = e.target.value;
            density = e.target.value / 100;
        });

        sizeSlider.addEventListener('input', (e) => {
            sizeValue.textContent = e.target.value;
            cellSize = parseInt(e.target.value);
            initCanvas();
            draw();
        });

        document.getElementById('runBtn').addEventListener('click', startFire);
        document.getElementById('resetBtn').addEventListener('click', initGrid);

        initCanvas();
        initGrid();
        updateNeighborhoodDemo();
        animate();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
