<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Burn Front Wave Propagation - Fire Percolation</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: linear-gradient(135deg, #2b5876 0%, #4e4376 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
            min-height: 100vh;
        }
        h1 {
            margin: 0 0 10px 0;
            font-size: 2em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .description {
            text-align: center;
            max-width: 900px;
            margin-bottom: 20px;
            line-height: 1.6;
            opacity: 0.9;
        }
        .controls {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
            backdrop-filter: blur(10px);
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        input[type="range"] {
            width: 150px;
        }
        select {
            padding: 5px 10px;
            border-radius: 5px;
            border: none;
            background: rgba(255,255,255,0.2);
            color: white;
        }
        button {
            background: #8e44ad;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.3s;
        }
        button:hover {
            background: #9b59b6;
        }
        .main-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .canvas-panel {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        canvas {
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 5px;
            background: black;
        }
        .stats-panel {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            max-width: 300px;
        }
        .stat-group {
            margin-bottom: 20px;
        }
        .stat-title {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.3);
            padding-bottom: 5px;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
        }
        .wave-colors {
            margin-top: 15px;
        }
        .color-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }
        .color-sample {
            width: 40px;
            height: 20px;
            margin-right: 10px;
            border: 1px solid rgba(255,255,255,0.5);
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <h1>Burn Front Wave Propagation</h1>
    <div class="description">
        Visualize how fire spreads as expanding wave fronts from the ignition edge. Each "generation" of fire
        is colored differently, creating a rainbow pattern that shows the temporal progression. Watch how
        wave fronts fragment and merge as they encounter gaps and clusters in the forest.
    </div>

    <div class="controls">
        <div class="control-group">
            <label>Forest Density: <span id="densityValue">65</span>%</label>
            <input type="range" id="density" min="40" max="85" value="65">
        </div>
        <div class="control-group">
            <label>Color Mode:</label>
            <select id="colorMode">
                <option value="generation">Generation (Rainbow)</option>
                <option value="distance">Distance from Edge</option>
                <option value="temperature">Temperature (Heat)</option>
            </select>
        </div>
        <div class="control-group">
            <label>Speed: <span id="speedValue">5</span></label>
            <input type="range" id="speed" min="1" max="15" value="5">
        </div>
        <button id="startBtn">Start Fire</button>
        <button id="resetBtn">Reset</button>
        <button id="pauseBtn">Pause</button>
    </div>

    <div class="main-container">
        <div class="canvas-panel">
            <canvas id="canvas"></canvas>
        </div>

        <div class="stats-panel">
            <div class="stat-group">
                <div class="stat-title">Wave Front Stats</div>
                <div class="stat-row">
                    <span>Current Tick:</span>
                    <span id="tick">0</span>
                </div>
                <div class="stat-row">
                    <span>Active Fires:</span>
                    <span id="activeFires">0</span>
                </div>
                <div class="stat-row">
                    <span>Max Generation:</span>
                    <span id="maxGen">0</span>
                </div>
                <div class="stat-row">
                    <span>Wave Width:</span>
                    <span id="waveWidth">0</span>
                </div>
            </div>

            <div class="stat-group">
                <div class="stat-title">Burn Statistics</div>
                <div class="stat-row">
                    <span>Trees Burned:</span>
                    <span id="burned">0</span>
                </div>
                <div class="stat-row">
                    <span>Total Trees:</span>
                    <span id="total">0</span>
                </div>
                <div class="stat-row">
                    <span>Burn %:</span>
                    <span id="percent">0%</span>
                </div>
                <div class="stat-row">
                    <span>Reached Edge:</span>
                    <span id="reached">No</span>
                </div>
            </div>

            <div class="wave-colors">
                <strong>Color Legend:</strong>
                <div class="color-item">
                    <div class="color-sample" style="background: #00ff00;"></div>
                    <span>Unburned Trees</span>
                </div>
                <div class="color-item">
                    <div class="color-sample" style="background: linear-gradient(90deg, red, orange, yellow);"></div>
                    <span>Wave Fronts</span>
                </div>
                <div class="color-item">
                    <div class="color-sample" style="background: #333;"></div>
                    <span>Burned Out</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        const gridSize = 150;
        const cellSize = 4;
        canvas.width = gridSize * cellSize;
        canvas.height = gridSize * cellSize;

        let density = 0.65;
        let speed = 5;
        let colorMode = 'generation';
        let running = false;
        let paused = false;

        let grid = []; // 0 = empty, 1 = tree, 2+ = generation burned
        let fires = [];
        let totalTrees = 0;
        let burnedTrees = 0;
        let tickCount = 0;
        let maxGeneration = 0;
        let reachedEdge = false;

        function initGrid() {
            grid = Array(gridSize).fill(0).map(() => Array(gridSize).fill(0));
            fires = [];
            totalTrees = 0;
            burnedTrees = 0;
            tickCount = 0;
            maxGeneration = 0;
            reachedEdge = false;
            running = false;
            paused = false;

            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    if (Math.random() < density) {
                        grid[y][x] = 1;
                        totalTrees++;
                    }
                }
            }

            updateStats();
            draw();
        }

        function startFire() {
            if (running) return;

            // Ignite left edge
            for (let y = 0; y < gridSize; y++) {
                if (grid[y][0] === 1) {
                    grid[y][0] = 2; // Generation 0
                    fires.push({x: 0, y: y, generation: 0});
                    burnedTrees++;
                }
            }

            running = true;
            paused = false;
        }

        function update() {
            if (!running || paused || fires.length === 0) {
                if (running && fires.length === 0) {
                    running = false;
                }
                return;
            }

            const newFires = [];
            const currentGeneration = tickCount + 1;

            for (const fire of fires) {
                const {x, y} = fire;

                const neighbors = [
                    {x, y: y - 1},
                    {x, y: y + 1},
                    {x: x - 1, y},
                    {x: x + 1, y}
                ];

                for (const n of neighbors) {
                    if (n.x >= 0 && n.x < gridSize && n.y >= 0 && n.y < gridSize) {
                        if (grid[n.y][n.x] === 1) {
                            grid[n.y][n.x] = currentGeneration + 2;
                            newFires.push({x: n.x, y: n.y, generation: currentGeneration});
                            burnedTrees++;
                            maxGeneration = Math.max(maxGeneration, currentGeneration);

                            if (n.x === gridSize - 1) {
                                reachedEdge = true;
                            }
                        }
                    }
                }
            }

            fires = newFires;
            tickCount++;
            updateStats();
        }

        function getColor(state) {
            if (state === 1) return '#00ff00'; // Tree

            if (colorMode === 'generation') {
                const hue = ((state - 2) * 15) % 360;
                return `hsl(${hue}, 100%, 50%)`;
            } else if (colorMode === 'distance') {
                const intensity = Math.min(255, (state - 2) * 10);
                return `rgb(${intensity}, ${intensity * 0.5}, 0)`;
            } else if (colorMode === 'temperature') {
                const temp = Math.min(1, (state - 2) / 20);
                const r = 255;
                const g = Math.floor(255 * (1 - temp));
                const b = 0;
                return `rgb(${r}, ${g}, ${b})`;
            }
        }

        function draw() {
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    const state = grid[y][x];

                    if (state >= 1) {
                        ctx.fillStyle = getColor(state);
                        ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
                    }
                }
            }

            // Highlight active fires
            ctx.fillStyle = 'white';
            for (const {x, y} of fires) {
                ctx.fillRect(
                    x * cellSize + cellSize / 4,
                    y * cellSize + cellSize / 4,
                    cellSize / 2,
                    cellSize / 2
                );
            }
        }

        function updateStats() {
            document.getElementById('tick').textContent = tickCount;
            document.getElementById('activeFires').textContent = fires.length;
            document.getElementById('maxGen').textContent = maxGeneration;

            // Wave width = number of unique x positions in active fires
            const xPositions = new Set(fires.map(f => f.x));
            document.getElementById('waveWidth').textContent = xPositions.size;

            document.getElementById('burned').textContent = burnedTrees;
            document.getElementById('total').textContent = totalTrees;
            const percent = totalTrees > 0 ? ((burnedTrees / totalTrees) * 100).toFixed(1) : 0;
            document.getElementById('percent').textContent = percent + '%';
            document.getElementById('reached').textContent = reachedEdge ? 'Yes' : 'No';
        }

        let frameCount = 0;
        function animate() {
            frameCount++;

            if (frameCount % Math.floor(16 - speed) === 0) {
                update();
                draw();
            }

            requestAnimationFrame(animate);
        }

        document.getElementById('density').addEventListener('input', (e) => {
            document.getElementById('densityValue').textContent = e.target.value;
            density = e.target.value / 100;
        });

        document.getElementById('speed').addEventListener('input', (e) => {
            document.getElementById('speedValue').textContent = e.target.value;
            speed = parseInt(e.target.value);
        });

        document.getElementById('colorMode').addEventListener('change', (e) => {
            colorMode = e.target.value;
            draw();
        });

        document.getElementById('startBtn').addEventListener('click', startFire);
        document.getElementById('resetBtn').addEventListener('click', initGrid);
        document.getElementById('pauseBtn').addEventListener('click', () => {
            paused = !paused;
            document.getElementById('pauseBtn').textContent = paused ? 'Resume' : 'Pause';
        });

        initGrid();
        animate();
    </script>
</body>
</html>
