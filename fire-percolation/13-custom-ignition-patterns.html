<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Ignition Patterns - Fire Percolation</title>
    <style>
        body {
            margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center;
            background: linear-gradient(135deg, #ff6e7f 0%, #bfe9ff 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: #333; min-height: 100vh;
        }
        h1 {margin: 0 0 10px 0; font-size: 2em; text-shadow: 2px 2px 4px rgba(0,0,0,0.1); color: white;}
        .description {text-align: center; max-width: 900px; margin-bottom: 20px; line-height: 1.6; color: white;}
        .controls {
            background: rgba(255,255,255,0.3); padding: 20px; border-radius: 10px; margin-bottom: 20px;
            display: flex; gap: 20px; align-items: center; backdrop-filter: blur(10px); flex-wrap: wrap; justify-content: center;
        }
        button {background: #e74c3c; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;}
        button:hover {background: #c0392b;}
        .tool-btn {background: #3498db;}
        .tool-btn:hover {background: #2980b9;}
        .tool-btn.active {background: #27ae60;}
        canvas {border: 3px solid rgba(255,255,255,0.5); border-radius: 5px; background: black; cursor: crosshair;}
        .panel {background: rgba(255,255,255,0.3); padding: 20px; border-radius: 10px; backdrop-filter: blur(10px);}
    </style>
</head>
<body>
    <h1>Custom Ignition Patterns</h1>
    <div class="description">
        Draw your own ignition patterns! Click and drag to paint ignition points. Explore how different
        ignition shapes (lines, circles, random clusters) affect fire spread patterns and percolation success.
    </div>

    <div class="controls">
        <div>
            <label style="color: white;">Density: <span id="densityVal">65</span>%</label><br>
            <input type="range" id="density" min="40" max="90" value="65" style="width: 150px;">
        </div>
        <button class="tool-btn" id="drawTool">Draw Mode</button>
        <button class="tool-btn" id="eraseTool">Erase Mode</button>
        <button id="clearIgnition">Clear Ignition</button>
        <button id="startBtn">Start Fire</button>
        <button id="resetBtn">Reset Forest</button>
    </div>

    <div style="display: flex; gap: 20px; flex-wrap: wrap; justify-content: center;">
        <div class="panel">
            <canvas id="canvas"></canvas>
        </div>
        <div class="panel" style="max-width: 300px;">
            <h3 style="margin-top: 0;">Instructions</h3>
            <p>1. Click "Draw Mode"</p>
            <p>2. Click/drag on forest to set ignition points (red)</p>
            <p>3. Click "Start Fire" to ignite</p>
            <h3>Preset Patterns:</h3>
            <button id="presetLine" style="width: 100%; margin: 5px 0;">Line (Left Edge)</button>
            <button id="presetCenter" style="width: 100%; margin: 5px 0;">Center Point</button>
            <button id="presetCircle" style="width: 100%; margin: 5px 0;">Circle</button>
            <button id="presetRandom" style="width: 100%; margin: 5px 0;">Random (10 points)</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const gridSize = 150, cellSize = 4;
        canvas.width = canvas.height = gridSize * cellSize;

        let density = 0.65;
        let grid = [];
        let ignitionPoints = new Set();
        let fires = [];
        let running = false;
        let drawMode = false;
        let eraseMode = false;
        let mouseDown = false;

        function init() {
            grid = Array(gridSize).fill(0).map(() => Array(gridSize).fill(0));
            fires = [];
            running = false;
            ignitionPoints.clear();

            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    if (Math.random() < density) grid[y][x] = 1;
                }
            }
            draw();
        }

        function draw() {
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    const state = grid[y][x];
                    const key = `${x},${y}`;

                    if (ignitionPoints.has(key) && !running) {
                        ctx.fillStyle = '#ff00ff';
                    } else if (state === 1) {
                        ctx.fillStyle = '#00ff00';
                    } else if (state === 2) {
                        ctx.fillStyle = '#ff0000';
                    } else if (state >= 3) {
                        const fade = (state - 3) / 12;
                        const intensity = Math.floor(255 * (1 - fade));
                        ctx.fillStyle = `rgb(${intensity}, ${intensity * 0.3}, 0)`;
                    } else {
                        continue;
                    }

                    ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
                }
            }
        }

        function startFire() {
            if (running || ignitionPoints.size === 0) return;

            fires = [];
            ignitionPoints.forEach(key => {
                const [x, y] = key.split(',').map(Number);
                if (grid[y][x] === 1) {
                    grid[y][x] = 2;
                    fires.push({x, y});
                }
            });

            running = true;
        }

        function update() {
            if (!running || fires.length === 0) {
                if (running && fires.length === 0) running = false;
                return;
            }

            const newFires = [];
            for (const {x, y} of fires) {
                [[x,y-1],[x,y+1],[x-1,y],[x+1,y]].forEach(([nx, ny]) => {
                    if (nx >= 0 && nx < gridSize && ny >= 0 && ny < gridSize && grid[ny][nx] === 1) {
                        grid[ny][nx] = 2;
                        newFires.push({x: nx, y: ny});
                    }
                });
                grid[y][x] = 3;
            }

            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    if (grid[y][x] >= 3 && grid[y][x] < 15) grid[y][x]++;
                    else if (grid[y][x] >= 15) grid[y][x] = 0;
                }
            }

            fires = newFires;
        }

        canvas.addEventListener('mousedown', (e) => {
            if (!drawMode && !eraseMode || running) return;
            mouseDown = true;
            handleClick(e);
        });

        canvas.addEventListener('mousemove', (e) => {
            if (!mouseDown) return;
            handleClick(e);
        });

        canvas.addEventListener('mouseup', () => {
            mouseDown = false;
        });

        function handleClick(e) {
            const rect = canvas.getBoundingClientRect();
            const x = Math.floor((e.clientX - rect.left) / cellSize);
            const y = Math.floor((e.clientY - rect.top) / cellSize);

            if (x >= 0 && x < gridSize && y >= 0 && y < gridSize) {
                const key = `${x},${y}`;
                if (drawMode && grid[y][x] === 1) {
                    ignitionPoints.add(key);
                    draw();
                } else if (eraseMode) {
                    ignitionPoints.delete(key);
                    draw();
                }
            }
        }

        document.getElementById('drawTool').addEventListener('click', () => {
            drawMode = true;
            eraseMode = false;
            document.getElementById('drawTool').classList.add('active');
            document.getElementById('eraseTool').classList.remove('active');
        });

        document.getElementById('eraseTool').addEventListener('click', () => {
            eraseMode = true;
            drawMode = false;
            document.getElementById('eraseTool').classList.add('active');
            document.getElementById('drawTool').classList.remove('active');
        });

        document.getElementById('clearIgnition').addEventListener('click', () => {
            ignitionPoints.clear();
            draw();
        });

        document.getElementById('presetLine').addEventListener('click', () => {
            ignitionPoints.clear();
            for (let y = 0; y < gridSize; y++) {
                if (grid[y][0] === 1) ignitionPoints.add(`0,${y}`);
            }
            draw();
        });

        document.getElementById('presetCenter').addEventListener('click', () => {
            ignitionPoints.clear();
            const cx = Math.floor(gridSize / 2), cy = Math.floor(gridSize / 2);
            ignitionPoints.add(`${cx},${cy}`);
            draw();
        });

        document.getElementById('presetCircle').addEventListener('click', () => {
            ignitionPoints.clear();
            const cx = Math.floor(gridSize / 2), cy = Math.floor(gridSize / 2), r = 20;
            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    const dist = Math.sqrt((x - cx) ** 2 + (y - cy) ** 2);
                    if (dist < r && grid[y][x] === 1) {
                        ignitionPoints.add(`${x},${y}`);
                    }
                }
            }
            draw();
        });

        document.getElementById('presetRandom').addEventListener('click', () => {
            ignitionPoints.clear();
            for (let i = 0; i < 10; i++) {
                const x = Math.floor(Math.random() * gridSize);
                const y = Math.floor(Math.random() * gridSize);
                if (grid[y][x] === 1) ignitionPoints.add(`${x},${y}`);
            }
            draw();
        });

        document.getElementById('density').addEventListener('input', (e) => {
            document.getElementById('densityVal').textContent = e.target.value;
            density = e.target.value / 100;
        });

        document.getElementById('startBtn').addEventListener('click', startFire);
        document.getElementById('resetBtn').addEventListener('click', init);

        let frameCount = 0;
        function animate() {
            if (frameCount++ % 3 === 0) {
                update();
                draw();
            }
            requestAnimationFrame(animate);
        }

        init();
        animate();
    </script>
</body>
</html>
