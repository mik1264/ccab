<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Parameter Explorer - Fire Percolation</title>
    <style>
        body {
            margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: white; min-height: 100vh;
        }
        h1 {margin: 0 0 10px 0; font-size: 2em; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);}
        .description {text-align: center; max-width: 900px; margin-bottom: 20px; line-height: 1.6; opacity: 0.9;}
        .control-panel {
            background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; margin-bottom: 20px;
            backdrop-filter: blur(10px); display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;
        }
        .control {display: flex; flex-direction: column; gap: 5px;}
        label {font-size: 0.9em; opacity: 0.9;}
        input[type="range"] {width: 100%;}
        select {padding: 5px; border-radius: 5px; border: none; background: rgba(255,255,255,0.2); color: white;}
        button {background: #e74c3c; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;}
        button:hover {background: #c0392b;}
        canvas {border: 2px solid rgba(255,255,255,0.3); border-radius: 5px; background: black;}
        .panel {background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; backdrop-filter: blur(10px);}
        .stats {display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 15px;}
        .stat {background: rgba(0,0,0,0.3); padding: 10px; border-radius: 5px; text-align: center;}
    </style>
</head>
<body>
    <h1>Interactive Parameter Explorer</h1>
    <div class="description">
        Comprehensive interactive tool to explore all fire percolation parameters: forest density, grid size,
        neighborhood type, ignition pattern, and visualization options. Experiment freely!
    </div>

    <div class="control-panel">
        <div class="control">
            <label>Density: <span id="densityVal">59</span>%</label>
            <input type="range" id="density" min="0" max="100" value="59">
        </div>
        <div class="control">
            <label>Grid Size: <span id="gridVal">100</span></label>
            <input type="range" id="gridSize" min="50" max="200" value="100">
        </div>
        <div class="control">
            <label>Neighborhood:</label>
            <select id="neighborhood">
                <option value="von-neumann">Von Neumann (4)</option>
                <option value="moore">Moore (8)</option>
            </select>
        </div>
        <div class="control">
            <label>Ignition:</label>
            <select id="ignition">
                <option value="left">Left Edge</option>
                <option value="center">Center Point</option>
                <option value="random">Random Points</option>
                <option value="bottom">Bottom Edge</option>
            </select>
        </div>
        <div class="control">
            <label>Speed: <span id="speedVal">5</span></label>
            <input type="range" id="speed" min="1" max="20" value="5">
        </div>
        <div class="control">
            <label>Show Embers:</label>
            <select id="embers">
                <option value="yes">Yes</option>
                <option value="no">No</option>
            </select>
        </div>
    </div>

    <button id="runBtn" style="margin-bottom: 20px;">Start Fire</button>
    <button id="resetBtn" style="margin-bottom: 20px;">Reset Forest</button>

    <div class="panel">
        <canvas id="canvas"></canvas>
        <div class="stats">
            <div class="stat"><div style="opacity: 0.7;">Ticks</div><strong id="ticks">0</strong></div>
            <div class="stat"><div style="opacity: 0.7;">Burned</div><strong id="burned">0</strong></div>
            <div class="stat"><div style="opacity: 0.7;">Active Fires</div><strong id="active">0</strong></div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let gridSize = 100, cellSize, density = 0.59, speed = 5;
        let neighborhood = 'von-neumann', ignitionType = 'left', showEmbers = true;
        let grid = [], fires = [], ticks = 0, burned = 0, running = false;

        function init() {
            cellSize = Math.min(600, window.innerWidth - 100) / gridSize;
            canvas.width = canvas.height = gridSize * cellSize;
            grid = Array(gridSize).fill(0).map(() => Array(gridSize).fill(0));
            fires = []; ticks = 0; burned = 0; running = false;

            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    if (Math.random() < density) grid[y][x] = 1;
                }
            }
            updateStats(); draw();
        }

        function startFire() {
            if (running) return;
            fires = [];

            if (ignitionType === 'left') {
                for (let y = 0; y < gridSize; y++) {
                    if (grid[y][0] === 1) {
                        grid[y][0] = 2; fires.push({x: 0, y}); burned++;
                    }
                }
            } else if (ignitionType === 'center') {
                const cx = Math.floor(gridSize / 2), cy = Math.floor(gridSize / 2);
                if (grid[cy][cx] === 1) {
                    grid[cy][cx] = 2; fires.push({x: cx, y: cy}); burned++;
                }
            } else if (ignitionType === 'random') {
                for (let i = 0; i < 5; i++) {
                    const x = Math.floor(Math.random() * gridSize);
                    const y = Math.floor(Math.random() * gridSize);
                    if (grid[y][x] === 1) {
                        grid[y][x] = 2; fires.push({x, y}); burned++;
                    }
                }
            } else if (ignitionType === 'bottom') {
                for (let x = 0; x < gridSize; x++) {
                    if (grid[gridSize-1][x] === 1) {
                        grid[gridSize-1][x] = 2; fires.push({x, y: gridSize-1}); burned++;
                    }
                }
            }

            running = true;
        }

        function update() {
            if (!running || fires.length === 0) return;

            const newFires = [];
            for (const {x, y} of fires) {
                const neighbors = neighborhood === 'von-neumann' ?
                    [[x,y-1],[x,y+1],[x-1,y],[x+1,y]] :
                    [[x,y-1],[x,y+1],[x-1,y],[x+1,y],[x-1,y-1],[x+1,y-1],[x-1,y+1],[x+1,y+1]];

                neighbors.forEach(([nx, ny]) => {
                    if (nx >= 0 && nx < gridSize && ny >= 0 && ny < gridSize && grid[ny][nx] === 1) {
                        grid[ny][nx] = 2; newFires.push({x: nx, y: ny}); burned++;
                    }
                });

                grid[y][x] = showEmbers ? 3 : 0;
            }

            if (showEmbers) {
                for (let y = 0; y < gridSize; y++) {
                    for (let x = 0; x < gridSize; x++) {
                        if (grid[y][x] >= 3 && grid[y][x] < 15) grid[y][x]++;
                        else if (grid[y][x] >= 15) grid[y][x] = 0;
                    }
                }
            }

            fires = newFires; ticks++; updateStats();
        }

        function draw() {
            ctx.fillStyle = 'black'; ctx.fillRect(0, 0, canvas.width, canvas.height);

            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    const state = grid[y][x];
                    if (state === 1) ctx.fillStyle = '#00ff00';
                    else if (state === 2) ctx.fillStyle = '#ff0000';
                    else if (state >= 3) {
                        const fade = (state - 3) / 12;
                        const intensity = Math.floor(255 * (1 - fade));
                        ctx.fillStyle = `rgb(${intensity}, ${intensity * 0.3}, 0)`;
                    } else continue;

                    ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
                }
            }
        }

        function updateStats() {
            document.getElementById('ticks').textContent = ticks;
            document.getElementById('burned').textContent = burned;
            document.getElementById('active').textContent = fires.length;
        }

        let frameCount = 0;
        function animate() {
            if (frameCount++ % Math.floor(21 - speed) === 0) {
                update(); draw();
            }
            requestAnimationFrame(animate);
        }

        ['density', 'gridSize', 'speed'].forEach(id => {
            document.getElementById(id).addEventListener('input', (e) => {
                const val = e.target.value;
                document.getElementById(id + 'Val').textContent = val;
                if (id === 'density') density = val / 100;
                else if (id === 'gridSize') {gridSize = parseInt(val); init();}
                else speed = parseInt(val);
            });
        });

        document.getElementById('neighborhood').addEventListener('change', (e) => neighborhood = e.target.value);
        document.getElementById('ignition').addEventListener('change', (e) => ignitionType = e.target.value);
        document.getElementById('embers').addEventListener('change', (e) => showEmbers = e.target.value === 'yes');
        document.getElementById('runBtn').addEventListener('click', startFire);
        document.getElementById('resetBtn').addEventListener('click', init);

        init(); animate();
    </script>
</body>
</html>
