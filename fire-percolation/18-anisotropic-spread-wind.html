<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anisotropic Spread (Wind Effects) - Fire Percolation</title>
    <style>
        body {
            margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center;
            background: linear-gradient(135deg, #12c2e9 0%, #c471ed 50%, #f64f59 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: white; min-height: 100vh;
        }
        h1 {margin: 0 0 10px 0; font-size: 2em; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);}
        .description {text-align: center; max-width: 900px; margin-bottom: 20px; line-height: 1.6; opacity: 0.9;}
        .controls {
            background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; margin-bottom: 20px;
            display: flex; gap: 15px; align-items: center; backdrop-filter: blur(10px); flex-wrap: wrap; justify-content: center;
        }
        button {background: #e67e22; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;}
        button:hover {background: #d35400;}
        canvas {border: 2px solid rgba(255,255,255,0.3); border-radius: 5px; background: black;}
        .panel {background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; backdrop-filter: blur(10px);}
        .wind-indicator {
            font-size: 3em; margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Anisotropic Spread - Wind Effects</h1>
    <div class="description">
        Introduce directional bias to fire spread simulating wind! Fire spreads faster in wind direction
        (higher probability), slower against wind. Watch how wind creates elongated burn patterns and
        affects percolation thresholds. Wind breaks symmetry of Von Neumann neighborhood.
    </div>

    <div class="controls">
        <div>
            <label>Density: <span id="densityVal">60</span>%</label><br>
            <input type="range" id="density" min="40" max="80" value="60" style="width: 150px;">
        </div>
        <div>
            <label>Wind Direction:</label><br>
            <select id="windDir">
                <option value="E">East →</option>
                <option value="W">West ←</option>
                <option value="N">North ↑</option>
                <option value="S">South ↓</option>
                <option value="NE">Northeast ↗</option>
                <option value="SE">Southeast ↘</option>
            </select>
        </div>
        <div>
            <label>Wind Strength: <span id="windVal">70</span>%</label><br>
            <input type="range" id="windStrength" min="0" max="100" value="70" style="width: 150px;">
        </div>
        <button id="startBtn">Start Fire</button>
        <button id="resetBtn">Reset</button>
    </div>

    <div style="display: flex; gap: 20px; flex-wrap: wrap; justify-content: center;">
        <div class="panel">
            <canvas id="canvas"></canvas>
        </div>
        <div class="panel" style="max-width: 250px; text-align: center;">
            <h3 style="margin-top: 0;">Wind</h3>
            <div class="wind-indicator" id="windIcon">→</div>
            <div id="windDesc">East Wind</div>
            <div style="margin-top: 20px; text-align: left;">
                <div style="padding: 8px; margin: 5px 0; background: rgba(0,0,0,0.3); border-radius: 5px;">
                    <strong>Ticks:</strong> <span id="ticks">0</span>
                </div>
                <div style="padding: 8px; margin: 5px 0; background: rgba(0,0,0,0.3); border-radius: 5px;">
                    <strong>Burned:</strong> <span id="burned">0</span>
                </div>
                <div style="padding: 8px; margin: 5px 0; background: rgba(0,0,0,0.3); border-radius: 5px;">
                    <strong>Active Fires:</strong> <span id="active">0</span>
                </div>
            </div>
            <div style="margin-top: 15px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 5px; font-size: 0.9em; text-align: left;">
                Wind affects spread probability:<br>
                • Downwind: 100%<br>
                • Sidewind: ~70%<br>
                • Upwind: ~30%
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const gridSize = 150, cellSize = 4;
        canvas.width = canvas.height = gridSize * cellSize;

        let density = 0.60, windDir = 'E', windStrength = 0.70;
        let grid = [], fires = [], ticks = 0, burned = 0, running = false;

        const windIcons = {
            E: '→', W: '←', N: '↑', S: '↓', NE: '↗', SE: '↘'
        };

        const windDescs = {
            E: 'East Wind', W: 'West Wind', N: 'North Wind',
            S: 'South Wind', NE: 'Northeast Wind', SE: 'Southeast Wind'
        };

        function init() {
            grid = Array(gridSize).fill(0).map(() => Array(gridSize).fill(0));
            fires = [];
            ticks = 0;
            burned = 0;
            running = false;

            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    if (Math.random() < density) grid[y][x] = 1;
                }
            }

            updateStats();
            draw();
        }

        function getSpreadProbability(dx, dy) {
            // Determine if direction aligns with wind
            let alignment = 0;

            if (windDir === 'E' && dx > 0) alignment = 1;
            else if (windDir === 'W' && dx < 0) alignment = 1;
            else if (windDir === 'N' && dy < 0) alignment = 1;
            else if (windDir === 'S' && dy > 0) alignment = 1;
            else if (windDir === 'NE' && dx > 0 && dy < 0) alignment = 1;
            else if (windDir === 'SE' && dx > 0 && dy > 0) alignment = 1;
            else if (windDir === 'E' && dx < 0) alignment = -1;
            else if (windDir === 'W' && dx > 0) alignment = -1;
            else if (windDir === 'N' && dy > 0) alignment = -1;
            else if (windDir === 'S' && dy < 0) alignment = -1;
            else if (windDir === 'NE' && (dx < 0 || dy > 0)) alignment = -0.5;
            else if (windDir === 'SE' && (dx < 0 || dy < 0)) alignment = -0.5;

            // Calculate probability
            if (alignment === 1) return 1.0; // Downwind
            else if (alignment === -1) return Math.max(0.3, 1 - windStrength); // Upwind
            else if (alignment === -0.5) return Math.max(0.5, 1 - windStrength * 0.5); // Diagonal upwind
            else return Math.max(0.7, 1 - windStrength * 0.3); // Sidewind
        }

        function startFire() {
            if (running) return;

            for (let y = 0; y < gridSize; y++) {
                if (grid[y][0] === 1) {
                    grid[y][0] = 2;
                    fires.push({x: 0, y});
                    burned++;
                }
            }

            running = true;
        }

        function update() {
            if (!running || fires.length === 0) {
                if (running && fires.length === 0) running = false;
                return;
            }

            const newFires = [];
            for (const {x, y} of fires) {
                const neighbors = [
                    {x, y: y-1, dx: 0, dy: -1},
                    {x, y: y+1, dx: 0, dy: 1},
                    {x: x-1, y, dx: -1, dy: 0},
                    {x: x+1, y, dx: 1, dy: 0}
                ];

                neighbors.forEach(n => {
                    if (n.x >= 0 && n.x < gridSize && n.y >= 0 && n.y < gridSize && grid[n.y][n.x] === 1) {
                        const prob = getSpreadProbability(n.dx, n.dy);
                        if (Math.random() < prob) {
                            grid[n.y][n.x] = 2;
                            newFires.push({x: n.x, y: n.y});
                            burned++;
                        }
                    }
                });

                grid[y][x] = 3;
            }

            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    if (grid[y][x] >= 3 && grid[y][x] < 15) grid[y][x]++;
                    else if (grid[y][x] >= 15) grid[y][x] = 0;
                }
            }

            fires = newFires;
            ticks++;
            updateStats();
        }

        function draw() {
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    const state = grid[y][x];

                    if (state === 1) ctx.fillStyle = '#00ff00';
                    else if (state === 2) ctx.fillStyle = '#ff0000';
                    else if (state >= 3) {
                        const fade = (state - 3) / 12;
                        const intensity = Math.floor(255 * (1 - fade));
                        ctx.fillStyle = `rgb(${intensity}, ${intensity * 0.3}, 0)`;
                    } else continue;

                    ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
                }
            }
        }

        function updateStats() {
            document.getElementById('ticks').textContent = ticks;
            document.getElementById('burned').textContent = burned;
            document.getElementById('active').textContent = fires.length;
        }

        document.getElementById('density').addEventListener('input', (e) => {
            document.getElementById('densityVal').textContent = e.target.value;
            density = e.target.value / 100;
        });

        document.getElementById('windStrength').addEventListener('input', (e) => {
            document.getElementById('windVal').textContent = e.target.value;
            windStrength = e.target.value / 100;
        });

        document.getElementById('windDir').addEventListener('change', (e) => {
            windDir = e.target.value;
            document.getElementById('windIcon').textContent = windIcons[windDir];
            document.getElementById('windDesc').textContent = windDescs[windDir];
        });

        document.getElementById('startBtn').addEventListener('click', startFire);
        document.getElementById('resetBtn').addEventListener('click', init);

        let frameCount = 0;
        function animate() {
            if (frameCount++ % 3 === 0) {
                update();
                draw();
            }
            requestAnimationFrame(animate);
        }

        init();
        animate();
    </script>
</body>
</html>
