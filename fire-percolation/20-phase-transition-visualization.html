<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase Transition Visualization - Fire Percolation</title>
    <style>
        body {
            margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: white; min-height: 100vh;
        }
        h1 {margin: 0 0 10px 0; font-size: 2.2em; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);}
        .description {text-align: center; max-width: 900px; margin-bottom: 20px; line-height: 1.6; opacity: 0.95; font-size: 1.1em;}
        .controls {
            background: rgba(255,255,255,0.15); padding: 25px; border-radius: 15px; margin-bottom: 20px;
            display: flex; gap: 20px; align-items: center; backdrop-filter: blur(15px); box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; border: none; padding: 14px 28px; border-radius: 8px; cursor: pointer;
            font-size: 1.05em; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        button:disabled {background: #7f8c8d; cursor: not-allowed; transform: none;}
        .main-container {
            display: flex; gap: 25px; flex-wrap: wrap; justify-content: center; max-width: 1400px;
        }
        .panel {
            background: rgba(255,255,255,0.15); padding: 25px; border-radius: 15px;
            backdrop-filter: blur(15px); box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }
        canvas {border: 3px solid rgba(255,255,255,0.4); border-radius: 8px;}
        .phase-indicator {
            font-size: 1.8em; font-weight: bold; text-align: center; padding: 15px;
            margin: 15px 0; border-radius: 10px; background: rgba(0,0,0,0.3);
        }
        .subcritical {background: linear-gradient(135deg, #e74c3c, #c0392b);}
        .critical {background: linear-gradient(135deg, #f39c12, #e67e22);}
        .supercritical {background: linear-gradient(135deg, #2ecc71, #27ae60);}
        .stats-grid {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 15px;
        }
        .stat-box {
            background: rgba(0,0,0,0.3); padding: 12px; border-radius: 8px; text-align: center;
        }
        .stat-label {opacity: 0.85; font-size: 0.9em; margin-bottom: 5px;}
        .stat-value {font-size: 1.5em; font-weight: bold;}
        .theory-box {
            margin-top: 20px; padding: 15px; background: rgba(0,0,0,0.25);
            border-radius: 8px; font-size: 0.95em; line-height: 1.6;
        }
    </style>
</head>
<body>
    <h1>ðŸ”¥ Phase Transition Visualization ðŸ”¥</h1>
    <div class="description">
        <strong>The Grand Finale:</strong> Interactive exploration of the percolation phase transition!
        Drag the density slider to move through subcritical â†’ critical â†’ supercritical regimes.
        Watch the forest transform from isolated clusters to spanning connectivity. This is complex systems
        at their most beautiful - order emerging from randomness.
    </div>

    <div class="controls">
        <div style="flex: 1; max-width: 400px;">
            <label style="font-size: 1.1em; font-weight: bold;">
                Forest Density: <span id="densityVal">59</span>%
            </label>
            <input type="range" id="density" min="30" max="90" value="59"
                   style="width: 100%; height: 8px; margin-top: 10px;">
            <div style="display: flex; justify-content: space-between; font-size: 0.85em; margin-top: 5px; opacity: 0.8;">
                <span>30% (Sparse)</span>
                <span>59% (Critical)</span>
                <span>90% (Dense)</span>
            </div>
        </div>
        <button id="burnBtn">ðŸ”¥ Burn Forest</button>
        <button id="newForestBtn">ðŸŒ² New Forest</button>
    </div>

    <div class="main-container">
        <div class="panel" style="flex: 1; min-width: 600px;">
            <canvas id="canvas"></canvas>
        </div>

        <div class="panel" style="flex: 0 0 320px;">
            <div class="phase-indicator" id="phaseIndicator">CRITICAL PHASE</div>

            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-label">Density</div>
                    <div class="stat-value" id="densityStat">59%</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Total Trees</div>
                    <div class="stat-value" id="totalTrees">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Trees Burned</div>
                    <div class="stat-value" id="burned">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Burn %</div>
                    <div class="stat-value" id="burnPercent">0%</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Ticks</div>
                    <div class="stat-value" id="ticks">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Crossed Edge</div>
                    <div class="stat-value" id="crossed">No</div>
                </div>
            </div>

            <div class="theory-box">
                <strong>Phase Transition Theory:</strong><br><br>

                <strong>Subcritical (p &lt; 0.59):</strong><br>
                Small isolated clusters. Fire cannot span forest. Order parameter Pâˆž = 0.<br><br>

                <strong>Critical (p = 0.59):</strong><br>
                Fractal spanning clusters emerge. Power-law distributions. Pâˆž transitions from 0 â†’ 1.<br><br>

                <strong>Supercritical (p &gt; 0.59):</strong><br>
                Giant spanning cluster dominates. Fire reliably crosses. Pâˆž â†’ 1.<br><br>

                <em>Critical exponents: Î² â‰ˆ 5/36, Î½ â‰ˆ 4/3, Î³ â‰ˆ 43/18</em>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const gridSize = 150;
        const cellSize = 4;
        canvas.width = canvas.height = gridSize * cellSize;

        let density = 0.59;
        let grid = [];
        let fires = [];
        let totalTrees = 0;
        let burnedTrees = 0;
        let ticks = 0;
        let reachedEdge = false;
        let running = false;

        function getPhase() {
            if (density < 0.55) return {name: 'SUBCRITICAL', class: 'subcritical'};
            if (density > 0.63) return {name: 'SUPERCRITICAL', class: 'supercritical'};
            return {name: 'CRITICAL PHASE', class: 'critical'};
        }

        function updatePhaseIndicator() {
            const phase = getPhase();
            const indicator = document.getElementById('phaseIndicator');
            indicator.textContent = phase.name;
            indicator.className = 'phase-indicator ' + phase.class;
        }

        function generateForest() {
            grid = Array(gridSize).fill(0).map(() => Array(gridSize).fill(0));
            fires = [];
            totalTrees = 0;
            burnedTrees = 0;
            ticks = 0;
            reachedEdge = false;
            running = false;

            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    if (Math.random() < density) {
                        grid[y][x] = 1;
                        totalTrees++;
                    }
                }
            }

            updateStats();
            draw();
        }

        function burnForest() {
            if (running) return;

            fires = [];
            for (let y = 0; y < gridSize; y++) {
                if (grid[y][0] === 1) {
                    grid[y][0] = 2;
                    fires.push({x: 0, y});
                    burnedTrees++;
                }
            }

            running = true;
        }

        function update() {
            if (!running || fires.length === 0) {
                if (running && fires.length === 0) running = false;
                return;
            }

            const newFires = [];

            for (const {x, y} of fires) {
                [[x,y-1],[x,y+1],[x-1,y],[x+1,y]].forEach(([nx, ny]) => {
                    if (nx >= 0 && nx < gridSize && ny >= 0 && ny < gridSize && grid[ny][nx] === 1) {
                        grid[ny][nx] = 2;
                        newFires.push({x: nx, y: ny});
                        burnedTrees++;
                        if (nx === gridSize - 1) reachedEdge = true;
                    }
                });

                grid[y][x] = 3;
            }

            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    if (grid[y][x] >= 3 && grid[y][x] < 15) grid[y][x]++;
                    else if (grid[y][x] >= 15) grid[y][x] = 0;
                }
            }

            fires = newFires;
            ticks++;
            updateStats();
        }

        function draw() {
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    const state = grid[y][x];

                    if (state === 1) {
                        ctx.fillStyle = '#00ff00';
                    } else if (state === 2) {
                        ctx.fillStyle = '#ff0000';
                    } else if (state >= 3) {
                        const fade = (state - 3) / 12;
                        const intensity = Math.floor(255 * (1 - fade));
                        ctx.fillStyle = `rgb(${intensity}, ${intensity * 0.3}, 0)`;
                    } else {
                        continue;
                    }

                    ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
                }
            }
        }

        function updateStats() {
            document.getElementById('densityStat').textContent = (density * 100).toFixed(0) + '%';
            document.getElementById('totalTrees').textContent = totalTrees;
            document.getElementById('burned').textContent = burnedTrees;
            const burnPercent = totalTrees > 0 ? ((burnedTrees / totalTrees) * 100).toFixed(1) : 0;
            document.getElementById('burnPercent').textContent = burnPercent + '%';
            document.getElementById('ticks').textContent = ticks;
            const crossedEl = document.getElementById('crossed');
            crossedEl.textContent = reachedEdge ? 'Yes âœ“' : 'No âœ—';
            crossedEl.style.color = reachedEdge ? '#2ecc71' : '#e74c3c';
        }

        document.getElementById('density').addEventListener('input', (e) => {
            document.getElementById('densityVal').textContent = e.target.value;
            density = e.target.value / 100;
            updatePhaseIndicator();
            generateForest();
        });

        document.getElementById('burnBtn').addEventListener('click', burnForest);
        document.getElementById('newForestBtn').addEventListener('click', generateForest);

        let frameCount = 0;
        function animate() {
            if (frameCount++ % 3 === 0) {
                update();
                draw();
            }
            requestAnimationFrame(animate);
        }

        generateForest();
        updatePhaseIndicator();
        animate();
    </script>
</body>
</html>
