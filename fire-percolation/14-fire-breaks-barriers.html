<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fire Breaks and Barriers - Fire Percolation</title>
    <style>
        body {
            margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center;
            background: linear-gradient(135deg, #134E5E 0%, #71B280 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: white; min-height: 100vh;
        }
        h1 {margin: 0 0 10px 0; font-size: 2em; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);}
        .description {text-align: center; max-width: 900px; margin-bottom: 20px; line-height: 1.6; opacity: 0.9;}
        .controls {
            background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; margin-bottom: 20px;
            display: flex; gap: 15px; align-items: center; backdrop-filter: blur(10px); flex-wrap: wrap; justify-content: center;
        }
        button {background: #27ae60; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;}
        button:hover {background: #2ecc71;}
        canvas {border: 2px solid rgba(255,255,255,0.3); border-radius: 5px; background: black; cursor: pointer;}
        .panel {background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; backdrop-filter: blur(10px);}
        .stat {padding: 8px; margin: 5px 0; background: rgba(0,0,0,0.3); border-radius: 5px; display: flex; justify-content: space-between;}
    </style>
</head>
<body>
    <h1>Fire Breaks and Barriers</h1>
    <div class="description">
        Add firebreak barriers to forest! Click to draw vertical or horizontal barriers that block fire spread.
        Strategically placed barriers can prevent percolation even at high densities. Experiment with barrier
        width, position, and gaps to understand containment strategies.
    </div>

    <div class="controls">
        <div>
            <label>Density: <span id="densityVal">70</span>%</label><br>
            <input type="range" id="density" min="50" max="90" value="70" style="width: 150px;">
        </div>
        <div>
            <label>Barrier Width: <span id="widthVal">2</span>px</label><br>
            <input type="range" id="barrierWidth" min="1" max="10" value="2" style="width: 150px;">
        </div>
        <button id="presetVertical">Vertical Barrier</button>
        <button id="presetHorizontal">Horizontal Barrier</button>
        <button id="presetGrid">Grid Pattern</button>
        <button id="clearBarriers">Clear Barriers</button>
        <button id="startBtn">Start Fire</button>
        <button id="resetBtn">Reset</button>
    </div>

    <div style="display: flex; gap: 20px; flex-wrap: wrap; justify-content: center;">
        <div class="panel">
            <canvas id="canvas"></canvas>
        </div>
        <div class="panel" style="max-width: 250px;">
            <h3 style="margin-top: 0;">Statistics</h3>
            <div class="stat"><span>Barrier Cells:</span><strong id="barrierCount">0</strong></div>
            <div class="stat"><span>Trees:</span><strong id="trees">0</strong></div>
            <div class="stat"><span>Burned:</span><strong id="burned">0</strong></div>
            <div class="stat"><span>Reached Edge:</span><strong id="reached">No</strong></div>
            <div style="margin-top: 15px; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 5px; font-size: 0.9em;">
                <strong>Legend:</strong><br>
                ðŸŸ¢ Tree<br>
                ðŸ”´ Fire<br>
                â¬› Barrier<br>
                ðŸŸ  Ember
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const gridSize = 150, cellSize = 4;
        canvas.width = canvas.height = gridSize * cellSize;

        let density = 0.70, barrierWidth = 2;
        let grid = []; // 0=empty, 1=tree, 2=fire, 3+=ember, -1=barrier
        let fires = [];
        let running = false;
        let totalTrees = 0, burnedTrees = 0, reachedEdge = false;

        function init() {
            grid = Array(gridSize).fill(0).map(() => Array(gridSize).fill(0));
            fires = [];
            running = false;
            totalTrees = 0;
            burnedTrees = 0;
            reachedEdge = false;

            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    if (Math.random() < density) {
                        grid[y][x] = 1;
                        totalTrees++;
                    }
                }
            }

            updateStats();
            draw();
        }

        function draw() {
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    const state = grid[y][x];

                    if (state === -1) {
                        ctx.fillStyle = '#555';
                    } else if (state === 1) {
                        ctx.fillStyle = '#00ff00';
                    } else if (state === 2) {
                        ctx.fillStyle = '#ff0000';
                    } else if (state >= 3) {
                        const fade = (state - 3) / 12;
                        const intensity = Math.floor(255 * (1 - fade));
                        ctx.fillStyle = `rgb(${intensity}, ${intensity * 0.3}, 0)`;
                    } else {
                        continue;
                    }

                    ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
                }
            }
        }

        function addBarrier(x1, y1, x2, y2, width) {
            const dx = Math.sign(x2 - x1);
            const dy = Math.sign(y2 - y1);

            let x = x1, y = y1;
            while (true) {
                for (let w = -Math.floor(width/2); w <= Math.floor(width/2); w++) {
                    if (dx !== 0) {
                        const ny = y + w;
                        if (ny >= 0 && ny < gridSize && x >= 0 && x < gridSize) {
                            if (grid[ny][x] === 1) totalTrees--;
                            grid[ny][x] = -1;
                        }
                    } else {
                        const nx = x + w;
                        if (nx >= 0 && nx < gridSize && y >= 0 && y < gridSize) {
                            if (grid[y][nx] === 1) totalTrees--;
                            grid[y][nx] = -1;
                        }
                    }
                }

                if (x === x2 && y === y2) break;
                x += dx;
                y += dy;
            }

            updateStats();
            draw();
        }

        function startFire() {
            if (running) return;
            fires = [];
            burnedTrees = 0;
            reachedEdge = false;

            for (let y = 0; y < gridSize; y++) {
                if (grid[y][0] === 1) {
                    grid[y][0] = 2;
                    fires.push({x: 0, y});
                    burnedTrees++;
                }
            }

            running = true;
        }

        function update() {
            if (!running || fires.length === 0) {
                if (running && fires.length === 0) running = false;
                return;
            }

            const newFires = [];
            for (const {x, y} of fires) {
                [[x,y-1],[x,y+1],[x-1,y],[x+1,y]].forEach(([nx, ny]) => {
                    if (nx >= 0 && nx < gridSize && ny >= 0 && ny < gridSize) {
                        if (grid[ny][nx] === 1) {
                            grid[ny][nx] = 2;
                            newFires.push({x: nx, y: ny});
                            burnedTrees++;
                            if (nx === gridSize - 1) reachedEdge = true;
                        }
                    }
                });
                grid[y][x] = 3;
            }

            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    if (grid[y][x] >= 3 && grid[y][x] < 15) grid[y][x]++;
                    else if (grid[y][x] >= 15) grid[y][x] = 0;
                }
            }

            fires = newFires;
            updateStats();
        }

        function updateStats() {
            const barrierCount = grid.flat().filter(c => c === -1).length;
            document.getElementById('barrierCount').textContent = barrierCount;
            document.getElementById('trees').textContent = totalTrees;
            document.getElementById('burned').textContent = burnedTrees;
            document.getElementById('reached').textContent = reachedEdge ? 'Yes' : 'No';
        }

        document.getElementById('density').addEventListener('input', (e) => {
            document.getElementById('densityVal').textContent = e.target.value;
            density = e.target.value / 100;
        });

        document.getElementById('barrierWidth').addEventListener('input', (e) => {
            document.getElementById('widthVal').textContent = e.target.value;
            barrierWidth = parseInt(e.target.value);
        });

        document.getElementById('presetVertical').addEventListener('click', () => {
            init();
            const x = Math.floor(gridSize / 2);
            addBarrier(x, 0, x, gridSize - 1, barrierWidth);
        });

        document.getElementById('presetHorizontal').addEventListener('click', () => {
            init();
            const y = Math.floor(gridSize / 2);
            addBarrier(0, y, gridSize - 1, y, barrierWidth);
        });

        document.getElementById('presetGrid').addEventListener('click', () => {
            init();
            const spacing = 30;
            for (let i = spacing; i < gridSize; i += spacing) {
                addBarrier(i, 0, i, gridSize - 1, barrierWidth);
            }
        });

        document.getElementById('clearBarriers').addEventListener('click', () => {
            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    if (grid[y][x] === -1) grid[y][x] = 0;
                }
            }
            updateStats();
            draw();
        });

        document.getElementById('startBtn').addEventListener('click', startFire);
        document.getElementById('resetBtn').addEventListener('click', init);

        let frameCount = 0;
        function animate() {
            if (frameCount++ % 3 === 0) {
                update();
                draw();
            }
            requestAnimationFrame(animate);
        }

        init();
        animate();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
