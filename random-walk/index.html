<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Walk & Brownian Motion - CCAB</title>
    <link rel="stylesheet" href="../assets/css/navigation.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Spectral:ital,wght@0,400;0,600;1,400&family=Space+Mono:wght@400;700&display=swap');

        :root {
            --bg-primary: #0a0e1a;
            --bg-secondary: #111827;
            --text-primary: #e0e0ff;
            --text-secondary: #a0a0c0;
            --text-accent: #fbbf24;
            --theme-color: #667eea;

            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;

            --font-display: 'Orbitron', sans-serif;
            --font-heading: 'Spectral', serif;
            --font-mono: 'Space Mono', monospace;
            --font-body: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;

            --header-height: 64px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            background: linear-gradient(135deg, var(--bg-primary) 0%, #0f172a 50%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            padding: 20px;
            padding-top: calc(var(--header-height) + 20px);
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        h1 {
            font-family: var(--font-display);
            text-align: center;
            margin-bottom: 10px;
            font-size: clamp(2rem, 5vw, 3rem);
            background: linear-gradient(135deg, var(--theme-color) 0%, var(--text-accent) 50%, var(--theme-color) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 30px;
            font-size: 1.1em;
            font-family: var(--font-heading);
            font-style: italic;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .tab {
            padding: 12px 24px;
            background: rgba(224, 224, 255, 0.1);
            border: 2px solid rgba(224, 224, 255, 0.2);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
            color: var(--text-primary);
        }

        .tab:hover {
            background: rgba(224, 224, 255, 0.2);
            transform: translateY(-2px);
        }

        .tab.active {
            background: linear-gradient(135deg, var(--theme-color) 0%, var(--text-accent) 100%);
            border-color: var(--theme-color);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .view {
            display: none;
            background: var(--bg-secondary);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .view.active {
            display: block;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
            justify-content: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        label {
            font-size: 0.9em;
            color: var(--text-secondary);
            font-family: var(--font-mono);
        }

        input[type="range"] {
            width: 150px;
        }

        input[type="number"] {
            width: 80px;
            padding: 8px;
            background: rgba(224, 224, 255, 0.1);
            border: 1px solid rgba(224, 224, 255, 0.2);
            border-radius: 5px;
            color: var(--text-primary);
            font-size: 1em;
        }

        button {
            padding: 10px 20px;
            background: linear-gradient(135deg, var(--theme-color) 0%, var(--text-accent) 100%);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .canvas-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        canvas {
            display: block;
            background: #000;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .stats-panel {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--theme-color);
            font-family: var(--font-mono);
        }

        .stat-label {
            font-size: 0.85em;
            color: var(--text-secondary);
        }

        .info-box {
            background: rgba(102, 126, 234, 0.1);
            border-left: 4px solid var(--theme-color);
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .info-box h3 {
            margin-bottom: 10px;
            color: var(--theme-color);
            font-family: var(--font-display);
        }

        .info-box ul {
            margin-left: 20px;
            line-height: 1.8;
        }

        .info-box p {
            line-height: 1.6;
            margin: 10px 0;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }

            .tabs {
                font-size: 0.9em;
            }

            .tab {
                padding: 8px 16px;
            }

            canvas {
                max-width: 100%;
                height: auto;
            }
        }
    
        /* Organic Nature Back Link */
        .organic-back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 10000;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: #BC6C25;
            text-decoration: none;
            font-family: 'Nunito', -apple-system, BlinkMacSystemFont, sans-serif;
            font-weight: 600;
            padding: 0.5rem 1rem;
            background: rgba(254, 250, 224, 0.95);
            border-radius: 20px;
            border: 2px solid rgba(138, 154, 91, 0.3);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(96, 108, 56, 0.15);
        }
        .organic-back-link:hover {
            background: rgba(254, 250, 224, 1);
            transform: translateX(-5px);
            border-color: #DDA15E;
            box-shadow: 0 6px 20px rgba(96, 108, 56, 0.25);
        }

    </style>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>

    <a href="../index.html" class="organic-back-link">← Back to Gallery</a>

    <!-- Navigation Header -->
    <nav class="ccab-nav">
        <div class="nav-container">
            <a href="../index.html" class="nav-home">
                <span class="nav-logo">CCAB</span>
                <span class="nav-tagline">Claude Code and Algorithmic Beauty</span>
            </a>
            <div class="nav-breadcrumb">
                <a href="../index.html">Gallery</a>
                <span class="separator">/</span>
                <span class="current">Random Walk</span>
            </div>
        </div>
    </nav>

    <div class="container">
        <h1>Random Walk & Brownian Motion</h1>
        <p class="subtitle">From Simple Diffusion to Gaussian Emergence and Levy Flights</p>

        <div class="tabs">
            <div class="tab active" data-view="walk1d">1D Walk</div>
            <div class="tab" data-view="walk2d">2D Walk</div>
            <div class="tab" data-view="many">Many Walkers</div>
            <div class="tab" data-view="levy">Levy Flight</div>
        </div>

        <!-- 1D Walk View -->
        <div class="view active" id="walk1d">
            <div class="info-box">
                <h3>One-Dimensional Random Walk</h3>
                <p>A walker on a number line takes random steps left or right. Over time:</p>
                <ul>
                    <li><strong>Mean displacement:</strong> Zero (no net drift without bias)</li>
                    <li><strong>Root mean square displacement:</strong> √(n) where n = number of steps</li>
                    <li><strong>Central Limit Theorem:</strong> Position becomes Gaussian distributed</li>
                </ul>
                <p>With bias (drift), the walker has a preferred direction, modeling phenomena like diffusion with an external force.</p>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label>Step Size: <span id="step1dVal">2</span></label>
                    <input type="range" id="step1d" min="1" max="10" value="2">
                </div>
                <div class="control-group">
                    <label>Bias: <span id="bias1dVal">0.00</span></label>
                    <input type="range" id="bias1d" min="-1" max="1" step="0.05" value="0">
                </div>
                <div class="control-group">
                    <label>Speed: <span id="speed1dVal">5</span></label>
                    <input type="range" id="speed1d" min="1" max="20" value="5">
                </div>
                <button onclick="reset1D()">Reset</button>
                <button onclick="toggle1D()">Start</button>
            </div>

            <div class="canvas-container">
                <canvas id="canvas1d" width="800" height="400"></canvas>
                <canvas id="chart1d" width="400" height="400"></canvas>
            </div>

            <div class="stats-panel">
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="pos1d">0</div>
                        <div class="stat-label">Current Position</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="steps1d">0</div>
                        <div class="stat-label">Total Steps</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="rms1d">0.0</div>
                        <div class="stat-label">RMS Displacement</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="theory1d">0.0</div>
                        <div class="stat-label">Theoretical √n</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2D Walk View -->
        <div class="view" id="walk2d">
            <div class="info-box">
                <h3>Two-Dimensional Random Walk</h3>
                <p>The walker moves on a 2D plane, taking random steps in any direction. This models:</p>
                <ul>
                    <li><strong>Brownian motion:</strong> Pollen grains in water (Einstein, 1905)</li>
                    <li><strong>Stock prices:</strong> Random walk hypothesis in finance</li>
                    <li><strong>Animal foraging:</strong> Search patterns in ecology</li>
                </ul>
                <p>The trail shows the walker's path. Mean squared displacement (MSD) grows linearly with time: MSD ∝ t</p>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label>Step Size: <span id="step2dVal">3</span></label>
                    <input type="range" id="step2d" min="1" max="15" value="3">
                </div>
                <div class="control-group">
                    <label>Bias X: <span id="biasX2dVal">0.00</span></label>
                    <input type="range" id="biasX2d" min="-1" max="1" step="0.05" value="0">
                </div>
                <div class="control-group">
                    <label>Bias Y: <span id="biasY2dVal">0.00</span></label>
                    <input type="range" id="biasY2d" min="-1" max="1" step="0.05" value="0">
                </div>
                <div class="control-group">
                    <label>Trail Length: <span id="trail2dVal">500</span></label>
                    <input type="range" id="trail2d" min="50" max="2000" value="500">
                </div>
                <div class="control-group">
                    <label>Speed: <span id="speed2dVal">10</span></label>
                    <input type="range" id="speed2d" min="1" max="30" value="10">
                </div>
                <button onclick="reset2D()">Reset</button>
                <button onclick="toggle2D()">Start</button>
            </div>

            <div class="canvas-container">
                <canvas id="canvas2d" width="600" height="600"></canvas>
                <canvas id="chart2d" width="400" height="600"></canvas>
            </div>

            <div class="stats-panel">
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="pos2d">0, 0</div>
                        <div class="stat-label">Position (x, y)</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="dist2d">0.0</div>
                        <div class="stat-label">Distance from Origin</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="steps2d">0</div>
                        <div class="stat-label">Total Steps</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="msd2d">0.0</div>
                        <div class="stat-label">Mean Squared Displacement</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Many Walkers View -->
        <div class="view" id="many">
            <div class="info-box">
                <h3>Ensemble of Random Walkers - Gaussian Emergence</h3>
                <p>Starting from a single point, 200 walkers spread out. Watch the distribution evolve:</p>
                <ul>
                    <li><strong>Central Limit Theorem:</strong> Individual steps add up to Gaussian distribution</li>
                    <li><strong>Diffusion equation:</strong> Probability density satisfies ∂P/∂t = D∇²P</li>
                    <li><strong>Linear MSD growth:</strong> Signature of normal diffusion</li>
                </ul>
                <p>The histogram shows the spatial distribution converging to a bell curve. This is how heat spreads!</p>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label>Walkers: <span id="numWalkersVal">200</span></label>
                    <input type="range" id="numWalkers" min="50" max="500" step="50" value="200">
                </div>
                <div class="control-group">
                    <label>Step Size: <span id="stepManyVal">2</span></label>
                    <input type="range" id="stepMany" min="1" max="5" value="2">
                </div>
                <div class="control-group">
                    <label>Speed: <span id="speedManyVal">5</span></label>
                    <input type="range" id="speedMany" min="1" max="20" value="5">
                </div>
                <button onclick="resetMany()">Reset</button>
                <button onclick="toggleMany()">Start</button>
            </div>

            <div class="canvas-container">
                <canvas id="canvasMany" width="600" height="600"></canvas>
                <canvas id="histMany" width="400" height="300"></canvas>
                <canvas id="msdChart" width="400" height="300"></canvas>
            </div>

            <div class="stats-panel">
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="meanPos">0.0</div>
                        <div class="stat-label">Mean Position</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="variance">0.0</div>
                        <div class="stat-label">Variance</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="stepsMany">0</div>
                        <div class="stat-label">Steps</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="diffCoeff">0.00</div>
                        <div class="stat-label">Diffusion Coefficient</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Levy Flight View -->
        <div class="view" id="levy">
            <div class="info-box">
                <h3>Levy Flight - Heavy-Tailed Jumps</h3>
                <p>Unlike Brownian motion, Levy flights have occasional large jumps following a power-law distribution:</p>
                <ul>
                    <li><strong>Step size distribution:</strong> P(l) ∝ l^(-α) where α ≈ 1.5-2</li>
                    <li><strong>Superdiffusion:</strong> MSD grows faster than linear (MSD ∝ t^β, β > 1)</li>
                    <li><strong>Found in nature:</strong> Foraging patterns of albatrosses, human mobility, market fluctuations</li>
                </ul>
                <p>Small steps are common, but rare large jumps dramatically change the walker's position. This is an optimal search strategy!</p>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label>Alpha: <span id="alphaVal">1.5</span></label>
                    <input type="range" id="alpha" min="1" max="3" step="0.1" value="1.5">
                </div>
                <div class="control-group">
                    <label>Min Step: <span id="minStepVal">1</span></label>
                    <input type="range" id="minStep" min="0.5" max="5" step="0.5" value="1">
                </div>
                <div class="control-group">
                    <label>Trail: <span id="trailLevyVal">500</span></label>
                    <input type="range" id="trailLevy" min="50" max="1000" value="500">
                </div>
                <div class="control-group">
                    <label>Speed: <span id="speedLevyVal">5</span></label>
                    <input type="range" id="speedLevy" min="1" max="20" value="5">
                </div>
                <button onclick="resetLevy()">Reset</button>
                <button onclick="toggleLevy()">Start</button>
            </div>

            <div class="canvas-container">
                <canvas id="canvasLevy" width="800" height="600"></canvas>
                <canvas id="chartLevy" width="400" height="300"></canvas>
            </div>

            <div class="stats-panel">
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="posLevy">0, 0</div>
                        <div class="stat-label">Position</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="distLevy">0.0</div>
                        <div class="stat-label">Distance from Origin</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="stepsLevy">0</div>
                        <div class="stat-label">Steps</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="maxJump">0.0</div>
                        <div class="stat-label">Max Jump Size</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== TAB SYSTEM =====
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(tab.dataset.view).classList.add('active');
            });
        });

        // ===== UTILITY FUNCTIONS =====
        function randomRange(min, max) {
            return Math.random() * (max - min) + min;
        }

        function levyStep(alpha, minStep) {
            // Generate step from power-law distribution
            const u = Math.random();
            const step = minStep / Math.pow(u, 1 / alpha);
            return Math.min(step, 100); // Cap maximum step
        }

        // ===== 1D RANDOM WALK =====
        let walker1D = { pos: 0, history: [] };
        let running1D = false;
        let interval1D = null;

        function setupControls1D() {
            document.getElementById('step1d').addEventListener('input', e => {
                document.getElementById('step1dVal').textContent = e.target.value;
            });
            document.getElementById('bias1d').addEventListener('input', e => {
                document.getElementById('bias1dVal').textContent = parseFloat(e.target.value).toFixed(2);
            });
            document.getElementById('speed1d').addEventListener('input', e => {
                document.getElementById('speed1dVal').textContent = e.target.value;
            });
        }

        function reset1D() {
            if (interval1D) clearInterval(interval1D);
            running1D = false;
            walker1D = { pos: 0, history: [0] };
            draw1D();
        }

        function toggle1D() {
            running1D = !running1D;
            event.target.textContent = running1D ? 'Stop' : 'Start';

            if (running1D) {
                const speed = parseInt(document.getElementById('speed1d').value);
                interval1D = setInterval(step1D, 1000 / speed);
            } else {
                clearInterval(interval1D);
            }
        }

        function step1D() {
            const stepSize = parseInt(document.getElementById('step1d').value);
            const bias = parseFloat(document.getElementById('bias1d').value);

            const direction = Math.random() < (0.5 + bias / 2) ? 1 : -1;
            walker1D.pos += direction * stepSize;
            walker1D.history.push(walker1D.pos);

            if (walker1D.history.length > 500) walker1D.history.shift();

            draw1D();
        }

        function draw1D() {
            const canvas = document.getElementById('canvas1d');
            const ctx = canvas.getContext('2d');
            const chart = document.getElementById('chart1d');
            const ctxChart = chart.getContext('2d');

            // Main canvas - number line
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const centerY = canvas.height / 2;
            const centerX = canvas.width / 2;
            const scale = 1;

            // Draw number line
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(canvas.width, centerY);
            ctx.stroke();

            // Draw tick marks
            ctx.strokeStyle = '#444';
            ctx.lineWidth = 1;
            for (let i = -400; i <= 400; i += 20) {
                const x = centerX + i * scale;
                ctx.beginPath();
                ctx.moveTo(x, centerY - 5);
                ctx.lineTo(x, centerY + 5);
                ctx.stroke();
            }

            // Draw walker
            const walkerX = centerX + walker1D.pos * scale;
            ctx.fillStyle = '#667eea';
            ctx.beginPath();
            ctx.arc(walkerX, centerY, 10, 0, Math.PI * 2);
            ctx.fill();

            // Draw position history
            if (walker1D.history.length > 1) {
                const yStart = 50;
                const yScale = 2;

                ctx.strokeStyle = '#fbbf24';
                ctx.lineWidth = 2;
                ctx.beginPath();
                for (let i = 0; i < walker1D.history.length; i++) {
                    const x = (i / walker1D.history.length) * canvas.width;
                    const y = yStart + walker1D.history[i] * yScale;
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.stroke();
            }

            // Chart canvas - position vs time
            ctxChart.fillStyle = '#000';
            ctxChart.fillRect(0, 0, chart.width, chart.height);

            if (walker1D.history.length > 1) {
                const maxPos = Math.max(...walker1D.history.map(Math.abs));
                const yScale = maxPos > 0 ? (chart.height / 2 - 20) / maxPos : 1;

                // Draw position line
                ctxChart.strokeStyle = '#667eea';
                ctxChart.lineWidth = 2;
                ctxChart.beginPath();
                for (let i = 0; i < walker1D.history.length; i++) {
                    const x = (i / walker1D.history.length) * chart.width;
                    const y = chart.height / 2 - walker1D.history[i] * yScale;
                    if (i === 0) ctxChart.moveTo(x, y);
                    else ctxChart.lineTo(x, y);
                }
                ctxChart.stroke();

                // Draw center line
                ctxChart.strokeStyle = '#333';
                ctxChart.lineWidth = 1;
                ctxChart.beginPath();
                ctxChart.moveTo(0, chart.height / 2);
                ctxChart.lineTo(chart.width, chart.height / 2);
                ctxChart.stroke();
            }

            // Update stats
            document.getElementById('pos1d').textContent = walker1D.pos;
            document.getElementById('steps1d').textContent = walker1D.history.length - 1;

            const positions = walker1D.history;
            const meanSq = positions.reduce((sum, p) => sum + p * p, 0) / positions.length;
            const rms = Math.sqrt(meanSq);
            const theoretical = Math.sqrt(walker1D.history.length - 1);

            document.getElementById('rms1d').textContent = rms.toFixed(1);
            document.getElementById('theory1d').textContent = theoretical.toFixed(1);
        }

        // ===== 2D RANDOM WALK =====
        let walker2D = { x: 0, y: 0, trail: [], distances: [] };
        let running2D = false;
        let interval2D = null;

        function setupControls2D() {
            document.getElementById('step2d').addEventListener('input', e => {
                document.getElementById('step2dVal').textContent = e.target.value;
            });
            document.getElementById('biasX2d').addEventListener('input', e => {
                document.getElementById('biasX2dVal').textContent = parseFloat(e.target.value).toFixed(2);
            });
            document.getElementById('biasY2d').addEventListener('input', e => {
                document.getElementById('biasY2dVal').textContent = parseFloat(e.target.value).toFixed(2);
            });
            document.getElementById('trail2d').addEventListener('input', e => {
                document.getElementById('trail2dVal').textContent = e.target.value;
            });
            document.getElementById('speed2d').addEventListener('input', e => {
                document.getElementById('speed2dVal').textContent = e.target.value;
            });
        }

        function reset2D() {
            if (interval2D) clearInterval(interval2D);
            running2D = false;
            walker2D = { x: 0, y: 0, trail: [{x: 0, y: 0}], distances: [0] };
            draw2D();
        }

        function toggle2D() {
            running2D = !running2D;
            event.target.textContent = running2D ? 'Stop' : 'Start';

            if (running2D) {
                const speed = parseInt(document.getElementById('speed2d').value);
                interval2D = setInterval(step2D, 1000 / speed);
            } else {
                clearInterval(interval2D);
            }
        }

        function step2D() {
            const stepSize = parseInt(document.getElementById('step2d').value);
            const biasX = parseFloat(document.getElementById('biasX2d').value);
            const biasY = parseFloat(document.getElementById('biasY2d').value);
            const trailLength = parseInt(document.getElementById('trail2d').value);

            const angle = Math.random() * 2 * Math.PI;
            walker2D.x += Math.cos(angle) * stepSize + biasX * stepSize;
            walker2D.y += Math.sin(angle) * stepSize + biasY * stepSize;

            walker2D.trail.push({ x: walker2D.x, y: walker2D.y });
            if (walker2D.trail.length > trailLength) walker2D.trail.shift();

            const dist = Math.sqrt(walker2D.x * walker2D.x + walker2D.y * walker2D.y);
            walker2D.distances.push(dist * dist); // Store squared distance for MSD

            draw2D();
        }

        function draw2D() {
            const canvas = document.getElementById('canvas2d');
            const ctx = canvas.getContext('2d');
            const chart = document.getElementById('chart2d');
            const ctxChart = chart.getContext('2d');

            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;

            // Main canvas
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw grid
            ctx.strokeStyle = '#222';
            ctx.lineWidth = 1;
            for (let i = 0; i < canvas.width; i += 50) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, canvas.height);
                ctx.stroke();
            }
            for (let i = 0; i < canvas.height; i += 50) {
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(canvas.width, i);
                ctx.stroke();
            }

            // Draw origin
            ctx.strokeStyle = '#fbbf24';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(centerX, centerY, 5, 0, Math.PI * 2);
            ctx.stroke();

            // Draw trail
            if (walker2D.trail.length > 1) {
                for (let i = 1; i < walker2D.trail.length; i++) {
                    const alpha = i / walker2D.trail.length;
                    const hue = (i / walker2D.trail.length) * 240;

                    const prev = walker2D.trail[i - 1];
                    const curr = walker2D.trail[i];

                    ctx.strokeStyle = `hsla(${hue}, 80%, 60%, ${alpha})`;
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(centerX + prev.x, centerY + prev.y);
                    ctx.lineTo(centerX + curr.x, centerY + curr.y);
                    ctx.stroke();
                }
            }

            // Draw walker
            ctx.fillStyle = '#667eea';
            ctx.beginPath();
            ctx.arc(centerX + walker2D.x, centerY + walker2D.y, 8, 0, Math.PI * 2);
            ctx.fill();

            // Chart - MSD vs time
            ctxChart.fillStyle = '#000';
            ctxChart.fillRect(0, 0, chart.width, chart.height);

            if (walker2D.distances.length > 1) {
                const maxMSD = Math.max(...walker2D.distances);
                const yScale = maxMSD > 0 ? (chart.height - 40) / maxMSD : 1;

                // Draw MSD line
                ctxChart.strokeStyle = '#667eea';
                ctxChart.lineWidth = 2;
                ctxChart.beginPath();
                for (let i = 0; i < walker2D.distances.length; i++) {
                    const x = (i / walker2D.distances.length) * chart.width;
                    const y = chart.height - 20 - walker2D.distances[i] * yScale;
                    if (i === 0) ctxChart.moveTo(x, y);
                    else ctxChart.lineTo(x, y);
                }
                ctxChart.stroke();

                // Draw theoretical linear line
                ctxChart.strokeStyle = '#fbbf24';
                ctxChart.lineWidth = 1;
                ctxChart.setLineDash([5, 5]);
                ctxChart.beginPath();
                ctxChart.moveTo(0, chart.height - 20);
                const endY = chart.height - 20 - (walker2D.distances.length - 1) * yScale * 0.5;
                ctxChart.lineTo(chart.width, endY);
                ctxChart.stroke();
                ctxChart.setLineDash([]);

                // Labels
                ctxChart.fillStyle = '#fbbf24';
                ctxChart.font = '12px monospace';
                ctxChart.fillText('MSD vs Time', 10, 20);
                ctxChart.fillStyle = '#667eea';
                ctxChart.fillText('Actual', 10, 35);
                ctxChart.fillStyle = '#fbbf24';
                ctxChart.fillText('Linear (theory)', 10, 50);
            }

            // Update stats
            document.getElementById('pos2d').textContent = `${walker2D.x.toFixed(0)}, ${walker2D.y.toFixed(0)}`;
            const dist = Math.sqrt(walker2D.x * walker2D.x + walker2D.y * walker2D.y);
            document.getElementById('dist2d').textContent = dist.toFixed(1);
            document.getElementById('steps2d').textContent = walker2D.trail.length - 1;

            const msd = walker2D.distances.length > 0 ?
                walker2D.distances[walker2D.distances.length - 1] : 0;
            document.getElementById('msd2d').textContent = msd.toFixed(1);
        }

        // ===== MANY WALKERS =====
        let walkers = [];
        let runningMany = false;
        let intervalMany = null;
        let msdHistory = [];

        function setupControlsMany() {
            document.getElementById('numWalkers').addEventListener('input', e => {
                document.getElementById('numWalkersVal').textContent = e.target.value;
            });
            document.getElementById('stepMany').addEventListener('input', e => {
                document.getElementById('stepManyVal').textContent = e.target.value;
            });
            document.getElementById('speedMany').addEventListener('input', e => {
                document.getElementById('speedManyVal').textContent = e.target.value;
            });
        }

        function resetMany() {
            if (intervalMany) clearInterval(intervalMany);
            runningMany = false;

            const numWalkers = parseInt(document.getElementById('numWalkers').value);
            walkers = [];
            for (let i = 0; i < numWalkers; i++) {
                walkers.push({ x: 0, y: 0 });
            }
            msdHistory = [0];

            drawMany();
        }

        function toggleMany() {
            runningMany = !runningMany;
            event.target.textContent = runningMany ? 'Stop' : 'Start';

            if (runningMany) {
                const speed = parseInt(document.getElementById('speedMany').value);
                intervalMany = setInterval(stepMany, 1000 / speed);
            } else {
                clearInterval(intervalMany);
            }
        }

        function stepMany() {
            const stepSize = parseInt(document.getElementById('stepMany').value);

            let sumSqDist = 0;
            walkers.forEach(w => {
                const angle = Math.random() * 2 * Math.PI;
                w.x += Math.cos(angle) * stepSize;
                w.y += Math.sin(angle) * stepSize;
                sumSqDist += w.x * w.x + w.y * w.y;
            });

            msdHistory.push(sumSqDist / walkers.length);
            if (msdHistory.length > 500) msdHistory.shift();

            drawMany();
        }

        function drawMany() {
            const canvas = document.getElementById('canvasMany');
            const ctx = canvas.getContext('2d');
            const hist = document.getElementById('histMany');
            const ctxHist = hist.getContext('2d');
            const msdChart = document.getElementById('msdChart');
            const ctxMSD = msdChart.getContext('2d');

            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;

            // Main canvas
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw origin
            ctx.strokeStyle = '#fbbf24';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(centerX, centerY, 8, 0, Math.PI * 2);
            ctx.stroke();

            // Draw walkers
            walkers.forEach(w => {
                ctx.fillStyle = 'rgba(102, 126, 234, 0.5)';
                ctx.beginPath();
                ctx.arc(centerX + w.x, centerY + w.y, 3, 0, Math.PI * 2);
                ctx.fill();
            });

            // Histogram of distances
            ctxHist.fillStyle = '#000';
            ctxHist.fillRect(0, 0, hist.width, hist.height);

            const distances = walkers.map(w => Math.sqrt(w.x * w.x + w.y * w.y));
            const maxDist = Math.max(...distances, 1);
            const bins = 30;
            const binWidth = maxDist / bins;
            const histogram = new Array(bins).fill(0);

            distances.forEach(d => {
                const bin = Math.min(Math.floor(d / binWidth), bins - 1);
                histogram[bin]++;
            });

            const maxCount = Math.max(...histogram, 1);
            const barWidth = hist.width / bins;

            histogram.forEach((count, i) => {
                const height = (count / maxCount) * (hist.height - 40);
                const hue = (i / bins) * 240;

                ctxHist.fillStyle = `hsl(${hue}, 80%, 60%)`;
                ctxHist.fillRect(i * barWidth, hist.height - height - 20, barWidth - 1, height);
            });

            // Draw Gaussian overlay
            ctxHist.strokeStyle = '#fbbf24';
            ctxHist.lineWidth = 2;
            ctxHist.beginPath();
            const mean = distances.reduce((a, b) => a + b, 0) / distances.length;
            const variance = distances.reduce((sum, d) => sum + (d - mean) ** 2, 0) / distances.length;
            const sigma = Math.sqrt(variance);

            for (let i = 0; i < bins; i++) {
                const x = (i + 0.5) * binWidth;
                const gaussian = Math.exp(-0.5 * ((x - mean) / sigma) ** 2) / (sigma * Math.sqrt(2 * Math.PI));
                const y = hist.height - 20 - (gaussian * walkers.length * binWidth / maxCount) * (hist.height - 40);

                if (i === 0) ctxHist.moveTo(i * barWidth, y);
                else ctxHist.lineTo(i * barWidth, y);
            }
            ctxHist.stroke();

            ctxHist.fillStyle = '#fbbf24';
            ctxHist.font = '12px monospace';
            ctxHist.fillText('Distribution (Gaussian)', 5, 15);

            // MSD chart
            ctxMSD.fillStyle = '#000';
            ctxMSD.fillRect(0, 0, msdChart.width, msdChart.height);

            if (msdHistory.length > 1) {
                const maxMSD = Math.max(...msdHistory, 1);
                const yScale = (msdChart.height - 40) / maxMSD;

                // Draw MSD
                ctxMSD.strokeStyle = '#667eea';
                ctxMSD.lineWidth = 2;
                ctxMSD.beginPath();
                for (let i = 0; i < msdHistory.length; i++) {
                    const x = (i / msdHistory.length) * msdChart.width;
                    const y = msdChart.height - 20 - msdHistory[i] * yScale;
                    if (i === 0) ctxMSD.moveTo(x, y);
                    else ctxMSD.lineTo(x, y);
                }
                ctxMSD.stroke();

                // Linear fit line
                const n = msdHistory.length;
                if (n > 2) {
                    const slope = msdHistory[n - 1] / n;

                    ctxMSD.strokeStyle = '#fbbf24';
                    ctxMSD.lineWidth = 1;
                    ctxMSD.setLineDash([5, 5]);
                    ctxMSD.beginPath();
                    ctxMSD.moveTo(0, msdChart.height - 20);
                    ctxMSD.lineTo(msdChart.width, msdChart.height - 20 - slope * n * yScale);
                    ctxMSD.stroke();
                    ctxMSD.setLineDash([]);
                }

                ctxMSD.fillStyle = '#667eea';
                ctxMSD.font = '12px monospace';
                ctxMSD.fillText('MSD vs Time', 5, 15);
                ctxMSD.fillStyle = '#fbbf24';
                ctxMSD.fillText('Linear fit', 5, 30);
            }

            // Update stats
            const meanX = walkers.reduce((sum, w) => sum + w.x, 0) / walkers.length;
            const meanY = walkers.reduce((sum, w) => sum + w.y, 0) / walkers.length;
            const meanPos = Math.sqrt(meanX * meanX + meanY * meanY);

            const varianceX = walkers.reduce((sum, w) => sum + (w.x - meanX) ** 2, 0) / walkers.length;
            const varianceY = walkers.reduce((sum, w) => sum + (w.y - meanY) ** 2, 0) / walkers.length;
            const totalVariance = varianceX + varianceY;

            document.getElementById('meanPos').textContent = meanPos.toFixed(1);
            document.getElementById('variance').textContent = totalVariance.toFixed(1);
            document.getElementById('stepsMany').textContent = msdHistory.length - 1;

            // Diffusion coefficient: MSD = 4Dt (for 2D)
            const steps = msdHistory.length - 1;
            const msd = msdHistory[msdHistory.length - 1];
            const diffCoeff = steps > 0 ? msd / (4 * steps) : 0;
            document.getElementById('diffCoeff').textContent = diffCoeff.toFixed(2);
        }

        // ===== LEVY FLIGHT =====
        let walkerLevy = { x: 0, y: 0, trail: [], maxJump: 0 };
        let runningLevy = false;
        let intervalLevy = null;
        let stepSizes = [];

        function setupControlsLevy() {
            document.getElementById('alpha').addEventListener('input', e => {
                document.getElementById('alphaVal').textContent = parseFloat(e.target.value).toFixed(1);
            });
            document.getElementById('minStep').addEventListener('input', e => {
                document.getElementById('minStepVal').textContent = parseFloat(e.target.value).toFixed(1);
            });
            document.getElementById('trailLevy').addEventListener('input', e => {
                document.getElementById('trailLevyVal').textContent = e.target.value;
            });
            document.getElementById('speedLevy').addEventListener('input', e => {
                document.getElementById('speedLevyVal').textContent = e.target.value;
            });
        }

        function resetLevy() {
            if (intervalLevy) clearInterval(intervalLevy);
            runningLevy = false;
            walkerLevy = { x: 0, y: 0, trail: [{x: 0, y: 0}], maxJump: 0 };
            stepSizes = [];
            drawLevy();
        }

        function toggleLevy() {
            runningLevy = !runningLevy;
            event.target.textContent = runningLevy ? 'Stop' : 'Start';

            if (runningLevy) {
                const speed = parseInt(document.getElementById('speedLevy').value);
                intervalLevy = setInterval(stepLevy, 1000 / speed);
            } else {
                clearInterval(intervalLevy);
            }
        }

        function stepLevy() {
            const alpha = parseFloat(document.getElementById('alpha').value);
            const minStep = parseFloat(document.getElementById('minStep').value);
            const trailLength = parseInt(document.getElementById('trailLevy').value);

            const stepSize = levyStep(alpha, minStep);
            const angle = Math.random() * 2 * Math.PI;

            walkerLevy.x += Math.cos(angle) * stepSize;
            walkerLevy.y += Math.sin(angle) * stepSize;
            walkerLevy.maxJump = Math.max(walkerLevy.maxJump, stepSize);

            walkerLevy.trail.push({ x: walkerLevy.x, y: walkerLevy.y });
            if (walkerLevy.trail.length > trailLength) walkerLevy.trail.shift();

            stepSizes.push(stepSize);
            if (stepSizes.length > 200) stepSizes.shift();

            drawLevy();
        }

        function drawLevy() {
            const canvas = document.getElementById('canvasLevy');
            const ctx = canvas.getContext('2d');
            const chart = document.getElementById('chartLevy');
            const ctxChart = chart.getContext('2d');

            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;

            // Main canvas
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Auto-scale view
            let minX = 0, maxX = 0, minY = 0, maxY = 0;
            walkerLevy.trail.forEach(p => {
                minX = Math.min(minX, p.x);
                maxX = Math.max(maxX, p.x);
                minY = Math.min(minY, p.y);
                maxY = Math.max(maxY, p.y);
            });

            const rangeX = maxX - minX || 100;
            const rangeY = maxY - minY || 100;
            const scale = Math.min((canvas.width - 100) / rangeX, (canvas.height - 100) / rangeY, 1);
            const offsetX = -(minX + maxX) / 2;
            const offsetY = -(minY + maxY) / 2;

            // Draw origin
            ctx.strokeStyle = '#fbbf24';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(centerX + offsetX * scale, centerY + offsetY * scale, 8, 0, Math.PI * 2);
            ctx.stroke();

            // Draw trail with color-coded step sizes
            if (walkerLevy.trail.length > 1) {
                for (let i = 1; i < walkerLevy.trail.length; i++) {
                    const prev = walkerLevy.trail[i - 1];
                    const curr = walkerLevy.trail[i];

                    const dx = curr.x - prev.x;
                    const dy = curr.y - prev.y;
                    const stepDist = Math.sqrt(dx * dx + dy * dy);

                    // Color by step size: small = blue, large = red
                    const hue = Math.max(0, 240 - stepDist * 10);
                    const alpha = 0.6;

                    ctx.strokeStyle = `hsla(${hue}, 80%, 60%, ${alpha})`;
                    ctx.lineWidth = Math.min(3, 1 + stepDist / 10);
                    ctx.beginPath();
                    ctx.moveTo(centerX + (prev.x + offsetX) * scale, centerY + (prev.y + offsetY) * scale);
                    ctx.lineTo(centerX + (curr.x + offsetX) * scale, centerY + (curr.y + offsetY) * scale);
                    ctx.stroke();
                }
            }

            // Draw walker
            ctx.fillStyle = '#667eea';
            ctx.beginPath();
            ctx.arc(centerX + (walkerLevy.x + offsetX) * scale, centerY + (walkerLevy.y + offsetY) * scale, 8, 0, Math.PI * 2);
            ctx.fill();

            // Chart - step size distribution
            ctxChart.fillStyle = '#000';
            ctxChart.fillRect(0, 0, chart.width, chart.height);

            if (stepSizes.length > 0) {
                const bins = 40;
                const maxStep = Math.max(...stepSizes);
                const binWidth = maxStep / bins;
                const histogram = new Array(bins).fill(0);

                stepSizes.forEach(s => {
                    const bin = Math.min(Math.floor(s / binWidth), bins - 1);
                    histogram[bin]++;
                });

                const maxCount = Math.max(...histogram, 1);
                const barWidth = chart.width / bins;

                histogram.forEach((count, i) => {
                    const height = (count / maxCount) * (chart.height - 40);
                    const hue = 240 - (i / bins) * 240;

                    ctxChart.fillStyle = `hsl(${hue}, 80%, 60%)`;
                    ctxChart.fillRect(i * barWidth, chart.height - height - 20, barWidth - 1, height);
                });

                ctxChart.fillStyle = '#fbbf24';
                ctxChart.font = '12px monospace';
                ctxChart.fillText('Step Size Distribution', 5, 15);
                ctxChart.fillText('(Power-law)', 5, 30);
            }

            // Update stats
            document.getElementById('posLevy').textContent = `${walkerLevy.x.toFixed(0)}, ${walkerLevy.y.toFixed(0)}`;
            const dist = Math.sqrt(walkerLevy.x * walkerLevy.x + walkerLevy.y * walkerLevy.y);
            document.getElementById('distLevy').textContent = dist.toFixed(1);
            document.getElementById('stepsLevy').textContent = walkerLevy.trail.length - 1;
            document.getElementById('maxJump').textContent = walkerLevy.maxJump.toFixed(1);
        }

        // ===== INITIALIZATION =====
        function init() {
            setupControls1D();
            setupControls2D();
            setupControlsMany();
            setupControlsLevy();

            reset1D();
            reset2D();
            resetMany();
            resetLevy();
        }

        window.addEventListener('load', init);
    </script>
    <script src="../assets/js/navigation.js"></script>
</body>
</html>
