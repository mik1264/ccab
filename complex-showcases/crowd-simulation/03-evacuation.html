<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>Crowd - Emergency Evacuation</title>
<style>body{margin:0;overflow:hidden;background:#1a0000;display:flex;justify-content:center;align-items:center;height:100vh}canvas{border:2px solid#333}.info{position:absolute;top:20px;left:20px;color:white;background:rgba(0,0,0,0.8);padding:15px;border-radius:8px;font-family:Arial}</style></head>
<body><div class="info">Simulating panic evacuation<br>Escaped: <span id="count">0</span></div><canvas id="c"></canvas><script>
const c=document.getElementById('c'),ctx=c.getContext('2d');c.width=800;c.height=600;
const exits=[{x:c.width-10,y:c.height/2,w:20,h:100}];let escaped=0;
class Person{constructor(x,y){this.x=x;this.y=y;this.vx=0;this.vy=0;this.panic=0.5+Math.random()*0.5;this.speed=1+this.panic*2;this.escaped=false}
update(people){if(this.escaped)return;
let exitX=exits[0].x,exitY=exits[0].y+exits[0].h/2;let desiredX=exitX-this.x,desiredY=exitY-this.y;const dist=Math.sqrt(desiredX**2+desiredY**2);
if(dist<20){this.escaped=true;escaped++;document.getElementById('count').textContent=escaped;return}
desiredX/=dist;desiredY/=dist;
for(const p of people){if(p===this||p.escaped)continue;const dx=this.x-p.x,dy=this.y-p.y,d=Math.sqrt(dx**2+dy**2);if(d<15){const avoidX=dx/d,avoidY=dy/d,strength=(15-d)/15*this.panic;desiredX+=avoidX*strength;desiredY+=avoidY*strength}}
const mag=Math.sqrt(desiredX**2+desiredY**2);if(mag>0){desiredX=desiredX/mag*this.speed;desiredY=desiredY/mag*this.speed}
this.vx+=(desiredX-this.vx)*0.2;this.vy+=(desiredY-this.vy)*0.2;this.x+=this.vx;this.y+=this.vy}
draw(){if(this.escaped)return;const stress=Math.min(this.panic+Math.random()*0.3,1);ctx.fillStyle=`rgb(${255*stress},${100*(1-stress)},50)`;ctx.beginPath();ctx.arc(this.x,this.y,6,0,Math.PI*2);ctx.fill()}}
const people=[];for(let i=0;i<100;i++)people.push(new Person(50+Math.random()*(c.width-100),50+Math.random()*(c.height-100)));
function animate(){ctx.fillStyle='rgba(26,0,0,0.3)';ctx.fillRect(0,0,c.width,c.height);
ctx.fillStyle='#2a2a2a';ctx.fillRect(0,0,c.width,20);ctx.fillRect(0,c.height-20,c.width,20);ctx.fillRect(0,0,20,c.height);
ctx.fillStyle='#00ff00';for(const ex of exits)ctx.fillRect(ex.x-ex.w/2,ex.y,ex.w,ex.h);
for(const p of people){p.update(people);p.draw()}
ctx.fillStyle='rgba(255,50,50,0.3)';for(let i=0;i<10;i++){const x=Math.random()*c.width,y=Math.random()*c.height,size=20+Math.random()*30;ctx.beginPath();ctx.arc(x,y,size,0,Math.PI*2);ctx.fill()}
requestAnimationFrame(animate)}
animate();
</script></body></html>
