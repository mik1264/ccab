<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebGL Fluid Simulation - Interactive</title>
    <link rel="stylesheet" href="style.css">

<style>
.organic-back-link{position:fixed;top:20px;left:20px;z-index:10000;display:inline-flex;align-items:center;gap:0.5rem;color:#BC6C25;text-decoration:none;font-family:'Nunito',-apple-system,BlinkMacSystemFont,sans-serif;font-weight:600;padding:0.5rem 1rem;background:rgba(254,250,224,0.95);border-radius:20px;border:2px solid rgba(138,154,91,0.3);transition:all 0.3s ease;box-shadow:0 4px 15px rgba(96,108,56,0.15)}
.organic-back-link:hover{background:rgba(254,250,224,1);transform:translateX(-5px);border-color:#DDA15E;box-shadow:0 6px 20px rgba(96,108,56,0.25)}
</style>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600&display=swap" rel="stylesheet">
</head>
<body><a href="../../index.html" class="organic-back-link">‚Üê Gallery</a>
    <canvas id="fluidCanvas"></canvas>
    
    <div class="controls">
        <h2>Fluid Simulation</h2>
        <p class="description">Click and drag to create beautiful fluid flows</p>
        
        <div class="control-group">
            <label for="densityDissipation">Dye Fade:</label>
            <input type="range" id="densityDissipation" min="0.90" max="0.999" step="0.001" value="0.98">
            <span id="densityValue">0.98</span>
        </div>
        
        <div class="control-group">
            <label for="velocityDissipation">Velocity Fade:</label>
            <input type="range" id="velocityDissipation" min="0.90" max="0.999" step="0.001" value="0.99">
            <span id="velocityValue">0.99</span>
        </div>
        
        <div class="control-group">
            <label for="pressureIterations">Pressure Quality:</label>
            <input type="range" id="pressureIterations" min="5" max="50" step="1" value="20">
            <span id="pressureValue">20</span>
        </div>
        
        <div class="control-group">
            <label for="splatRadius">Brush Size:</label>
            <input type="range" id="splatRadius" min="0.001" max="0.02" step="0.001" value="0.005">
            <span id="splatRadiusValue">0.005</span>
        </div>
        
        <div class="control-group">
            <label for="brightness">Brightness:</label>
            <input type="range" id="brightness" min="0.5" max="3.0" step="0.1" value="1.5">
            <span id="brightnessValue">1.5</span>
        </div>

        <div class="control-group">
            <label for="simResolution">Sim Resolution:</label>
            <select id="simResolution">
                <option value="64">Low (64)</option>
                <option value="128" selected>Medium (128)</option>
                <option value="256">High (256)</option>
                <option value="512">Ultra (512)</option>
            </select>
        </div>

        <div class="control-group">
            <label for="dyeResolution">Dye Resolution:</label>
            <select id="dyeResolution">
                <option value="256">Low (256)</option>
                <option value="512" selected>Medium (512)</option>
                <option value="1024">High (1024)</option>
            </select>
        </div>
        
        <button id="clearBtn">Clear Canvas</button>
        
        <div class="info">
            <p><strong>Controls:</strong></p>
            <ul>
                <li>Mouse/Touch: Draw fluid</li>
                <li>Each stroke uses random colors</li>
                <li>Adjust sliders for different effects</li>
            </ul>
        </div>
    </div>

    <script type="module">
        import { FluidSimulation } from './fluid.js';

        const canvas = document.getElementById('fluidCanvas');
        const simulation = new FluidSimulation(canvas);

        // Setup controls
        const controls = {
            densityDissipation: document.getElementById('densityDissipation'),
            velocityDissipation: document.getElementById('velocityDissipation'),
            pressureIterations: document.getElementById('pressureIterations'),
            splatRadius: document.getElementById('splatRadius'),
            brightness: document.getElementById('brightness'),
            simResolution: document.getElementById('simResolution'),
            dyeResolution: document.getElementById('dyeResolution'),
            clearBtn: document.getElementById('clearBtn')
        };

        // Update display values
        controls.densityDissipation.addEventListener('input', e => {
            document.getElementById('densityValue').textContent = e.target.value;
            simulation.updateConfig('densityDissipation', parseFloat(e.target.value));
        });

        controls.velocityDissipation.addEventListener('input', e => {
            document.getElementById('velocityValue').textContent = e.target.value;
            simulation.updateConfig('velocityDissipation', parseFloat(e.target.value));
        });

        controls.pressureIterations.addEventListener('input', e => {
            document.getElementById('pressureValue').textContent = e.target.value;
            simulation.updateConfig('pressureIterations', parseInt(e.target.value));
        });

        controls.splatRadius.addEventListener('input', e => {
            document.getElementById('splatRadiusValue').textContent = e.target.value;
            simulation.updateConfig('splatRadius', parseFloat(e.target.value));
        });

        controls.brightness.addEventListener('input', e => {
            document.getElementById('brightnessValue').textContent = e.target.value;
            simulation.updateConfig('brightness', parseFloat(e.target.value));
        });

        controls.simResolution.addEventListener('change', e => {
            simulation.updateConfig('simResolution', parseInt(e.target.value));
        });

        controls.dyeResolution.addEventListener('change', e => {
            simulation.updateConfig('dyeResolution', parseInt(e.target.value));
        });

        controls.clearBtn.addEventListener('click', () => {
            simulation.initFramebuffers();
        });

        // Add ambient motion on load for visual interest
        setTimeout(() => {
            const createSplat = () => {
                const x = Math.random();
                const y = Math.random();
                const dx = (Math.random() - 0.5) * 20;
                const dy = (Math.random() - 0.5) * 20;
                const color = [Math.random(), Math.random(), Math.random()];
                simulation.splat(x, y, dx, dy, color);
            };
            
            // Initial splats
            for (let i = 0; i < 5; i++) {
                setTimeout(createSplat, i * 200);
            }
        }, 100);
    </script>
</body>
</html>
