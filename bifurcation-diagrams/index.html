<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bifurcation Diagrams - Logistic Map & Chaos - CCAB</title>
    <meta name="description" content="Interactive bifurcation diagram visualization showing the route to chaos through period-doubling. Explore the Feigenbaum constant and fractal self-similarity.">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a1a;
            min-height: 100vh;
            color: #e8e6e1;
            overflow: hidden;
        }
        #container { display: flex; height: 100vh; }
        #canvas-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
        }
        canvas {
            border-radius: 4px;
            cursor: crosshair;
        }
        #controls {
            width: 300px;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            overflow-y: auto;
            border-left: 1px solid #333;
        }
        h2 {
            color: #ff6b6b;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 1px solid #ff6b6b;
            padding-bottom: 10px;
        }
        h3 {
            color: #feca57;
            margin: 15px 0 10px;
            font-size: 0.95em;
        }
        .control-group { margin-bottom: 12px; }
        label {
            display: block;
            margin-bottom: 5px;
            color: #aaa;
            font-size: 0.85em;
        }
        input[type="range"] {
            width: 100%;
            margin: 5px 0;
            accent-color: #ff6b6b;
        }
        .value {
            color: #ff6b6b;
            font-weight: bold;
            float: right;
        }
        select {
            width: 100%;
            padding: 8px;
            background: #222;
            border: 1px solid #444;
            color: #fff;
            border-radius: 4px;
        }
        button {
            width: 48%;
            padding: 10px;
            margin: 5px 1%;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }
        .zoom-btn { background: #ff6b6b; color: #000; }
        .zoom-btn:hover { background: #ff8787; }
        .reset-btn { background: #54a0ff; color: #000; }
        .reset-btn:hover { background: #74b9ff; }
        .stats-panel {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid #ff6b6b;
            border-radius: 5px;
            padding: 10px;
            margin-top: 15px;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 0.8em;
        }
        .stat-label { color: #888; }
        .stat-value { color: #ff6b6b; font-weight: bold; }
        .info-box {
            background: rgba(255, 107, 107, 0.1);
            border-left: 3px solid #ff6b6b;
            padding: 10px;
            margin-top: 15px;
            font-size: 0.75em;
            line-height: 1.5;
        }
        .back-link {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #ff6b6b;
            text-decoration: none;
            font-size: 0.9em;
            z-index: 100;
            background: rgba(0,0,0,0.7);
            padding: 8px 12px;
            border-radius: 5px;
        }
        .back-link:hover { color: #ff8787; }
        #crosshair {
            position: absolute;
            pointer-events: none;
            color: #feca57;
            font-size: 11px;
            background: rgba(0,0,0,0.8);
            padding: 4px 8px;
            border-radius: 3px;
            white-space: nowrap;
        }
        .preset-btn {
            width: 31%;
            padding: 8px;
            margin: 2px 1%;
            font-size: 0.7em;
            background: #333;
            color: #aaa;
        }
        .preset-btn:hover {
            background: #ff6b6b;
            color: #000;
        }
        #selection-box {
            position: absolute;
            border: 2px dashed #feca57;
            background: rgba(254, 202, 87, 0.1);
            pointer-events: none;
        }
    </style>
</head>
<body>
    <a href="../index.html" class="back-link">‚Üê Back to Gallery</a>
    <div id="container">
        <div id="canvas-container">
            <canvas id="canvas"></canvas>
            <div id="crosshair" style="display:none;"></div>
            <div id="selection-box" style="display:none;"></div>
        </div>
        <div id="controls">
            <h2>üìà Bifurcation Diagrams</h2>

            <h3>Map Type</h3>
            <div class="control-group">
                <select id="map-type">
                    <option value="logistic">Logistic Map: x ‚Üí rx(1-x)</option>
                    <option value="sine">Sine Map: x ‚Üí r¬∑sin(œÄx)</option>
                    <option value="tent">Tent Map</option>
                    <option value="gauss">Gauss Map: x ‚Üí e^(-Œ±x¬≤) + Œ≤</option>
                </select>
            </div>

            <h3>View Range</h3>
            <div class="control-group">
                <label>r min: <span class="value" id="rmin-val">2.5</span></label>
                <input type="range" id="rmin" min="0" max="3.9" step="0.01" value="2.5">
            </div>
            <div class="control-group">
                <label>r max: <span class="value" id="rmax-val">4.0</span></label>
                <input type="range" id="rmax" min="0.1" max="4" step="0.01" value="4">
            </div>

            <h3>Zoom Presets</h3>
            <div style="margin-bottom: 10px;">
                <button class="preset-btn" onclick="preset('full')">Full View</button>
                <button class="preset-btn" onclick="preset('onset')">Onset</button>
                <button class="preset-btn" onclick="preset('chaos')">Chaos</button>
            </div>
            <div>
                <button class="preset-btn" onclick="preset('window3')">3-Window</button>
                <button class="preset-btn" onclick="preset('deep')">Deep Zoom</button>
                <button class="preset-btn" onclick="preset('feigen')">Feigenbaum</button>
            </div>

            <h3>Quality</h3>
            <div class="control-group">
                <label>Iterations: <span class="value" id="iter-val">200</span></label>
                <input type="range" id="iterations" min="50" max="500" step="10" value="200">
            </div>
            <div class="control-group">
                <label>Skip transient: <span class="value" id="skip-val">100</span></label>
                <input type="range" id="skip" min="10" max="300" step="10" value="100">
            </div>
            <div class="control-group">
                <label>Points per r: <span class="value" id="samples-val">100</span></label>
                <input type="range" id="samples" min="10" max="300" step="10" value="100">
            </div>

            <h3>Color Mode</h3>
            <div class="control-group">
                <select id="color-mode">
                    <option value="density">Density (visits)</option>
                    <option value="iteration">Iteration number</option>
                    <option value="gradient">r gradient</option>
                    <option value="white">White points</option>
                </select>
            </div>

            <div style="margin: 15px 0;">
                <button class="zoom-btn" onclick="render()">Render</button>
                <button class="reset-btn" onclick="reset()">Reset</button>
            </div>

            <div class="stats-panel">
                <div class="stat-row">
                    <span class="stat-label">r range:</span>
                    <span class="stat-value" id="range-stat">2.5 - 4.0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">x at cursor:</span>
                    <span class="stat-value" id="x-stat">--</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">r at cursor:</span>
                    <span class="stat-value" id="r-stat">--</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Feigenbaum Œ¥:</span>
                    <span class="stat-value">4.66920...</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Period:</span>
                    <span class="stat-value" id="period-stat">--</span>
                </div>
            </div>

            <div class="info-box">
                <strong>Logistic Map:</strong> x<sub>n+1</sub> = r¬∑x<sub>n</sub>(1 - x<sub>n</sub>)<br><br>
                <strong>Period Doubling:</strong><br>
                ‚Ä¢ r < 3: stable fixed point<br>
                ‚Ä¢ r ‚âà 3: period-2 cycle<br>
                ‚Ä¢ r ‚âà 3.449: period-4 cycle<br>
                ‚Ä¢ r ‚âà 3.544: period-8 cycle<br>
                ‚Ä¢ r ‚âà 3.5699...: onset of chaos<br><br>
                <strong>Drag to zoom</strong> into any region!
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const crosshair = document.getElementById('crosshair');
        const selectionBox = document.getElementById('selection-box');

        let rMin = 2.5, rMax = 4.0;
        let xMin = 0, xMax = 1;
        let iterations = 200;
        let skipTransient = 100;
        let samplesPerR = 100;
        let colorMode = 'density';
        let mapType = 'logistic';

        let densityMap = null;
        let maxDensity = 0;

        // Selection for zoom
        let selecting = false;
        let selStart = {x: 0, y: 0};
        let selEnd = {x: 0, y: 0};

        function resize() {
            const container = document.getElementById('canvas-container');
            canvas.width = Math.min(container.clientWidth - 40, 1200);
            canvas.height = Math.min(container.clientHeight - 40, 800);
        }

        function mapFunction(x, r) {
            switch (mapType) {
                case 'logistic':
                    return r * x * (1 - x);
                case 'sine':
                    return r * Math.sin(Math.PI * x);
                case 'tent':
                    return r * (x < 0.5 ? x : 1 - x);
                case 'gauss':
                    return Math.exp(-6 * x * x) + r - 1;
                default:
                    return r * x * (1 - x);
            }
        }

        function render() {
            ctx.fillStyle = '#0a0a1a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Initialize density map
            densityMap = new Float32Array(canvas.width * canvas.height);
            maxDensity = 0;

            const rStep = (rMax - rMin) / canvas.width;

            // For each column (r value)
            for (let px = 0; px < canvas.width; px++) {
                const r = rMin + px * rStep;

                // Multiple initial conditions for better sampling
                for (let s = 0; s < samplesPerR; s++) {
                    let x = Math.random();

                    // Skip transient
                    for (let i = 0; i < skipTransient; i++) {
                        x = mapFunction(x, r);
                        if (x < 0 || x > 1 || isNaN(x)) break;
                    }

                    // Plot attractor
                    for (let i = 0; i < iterations - skipTransient; i++) {
                        x = mapFunction(x, r);

                        if (x >= xMin && x <= xMax && !isNaN(x)) {
                            const py = Math.floor((1 - (x - xMin) / (xMax - xMin)) * canvas.height);
                            if (py >= 0 && py < canvas.height) {
                                const idx = py * canvas.width + px;
                                densityMap[idx]++;
                                if (densityMap[idx] > maxDensity) maxDensity = densityMap[idx];
                            }
                        }

                        if (x < 0 || x > 1 || isNaN(x)) break;
                    }
                }
            }

            // Render density map
            const imageData = ctx.createImageData(canvas.width, canvas.height);

            for (let i = 0; i < densityMap.length; i++) {
                const d = densityMap[i];
                if (d > 0) {
                    let r, g, b;
                    const px = i % canvas.width;
                    const py = Math.floor(i / canvas.width);

                    switch (colorMode) {
                        case 'density':
                            const logDensity = Math.log(d + 1) / Math.log(maxDensity + 1);
                            r = Math.floor(255 * Math.pow(logDensity, 0.5));
                            g = Math.floor(180 * logDensity);
                            b = Math.floor(255 * (1 - logDensity * 0.3));
                            break;
                        case 'iteration':
                            const hue = (d % 360);
                            const rgb = hslToRgb(hue / 360, 0.8, 0.5);
                            r = rgb[0]; g = rgb[1]; b = rgb[2];
                            break;
                        case 'gradient':
                            const t = px / canvas.width;
                            r = Math.floor(255 * (1 - t) + 107 * t);
                            g = Math.floor(100 * (1 - t) + 180 * t);
                            b = Math.floor(255 * t);
                            break;
                        case 'white':
                        default:
                            r = g = b = 255;
                    }

                    const idx = i * 4;
                    imageData.data[idx] = r;
                    imageData.data[idx + 1] = g;
                    imageData.data[idx + 2] = b;
                    imageData.data[idx + 3] = 255;
                }
            }

            ctx.putImageData(imageData, 0, 0);

            // Draw axes labels
            ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
            ctx.font = '12px monospace';

            // r axis
            ctx.fillText(`r = ${rMin.toFixed(4)}`, 5, canvas.height - 5);
            ctx.textAlign = 'right';
            ctx.fillText(`r = ${rMax.toFixed(4)}`, canvas.width - 5, canvas.height - 5);

            // x axis
            ctx.textAlign = 'left';
            ctx.fillText(`x = ${xMax.toFixed(2)}`, 5, 15);
            ctx.fillText(`x = ${xMin.toFixed(2)}`, 5, canvas.height - 20);

            document.getElementById('range-stat').textContent = `${rMin.toFixed(3)} - ${rMax.toFixed(3)}`;
        }

        function hslToRgb(h, s, l) {
            let r, g, b;
            if (s === 0) {
                r = g = b = l;
            } else {
                const hue2rgb = (p, q, t) => {
                    if (t < 0) t += 1;
                    if (t > 1) t -= 1;
                    if (t < 1/6) return p + (q - p) * 6 * t;
                    if (t < 1/2) return q;
                    if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
                    return p;
                };
                const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                const p = 2 * l - q;
                r = hue2rgb(p, q, h + 1/3);
                g = hue2rgb(p, q, h);
                b = hue2rgb(p, q, h - 1/3);
            }
            return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];
        }

        function preset(name) {
            xMin = 0; xMax = 1;
            switch (name) {
                case 'full':
                    rMin = 0; rMax = 4;
                    break;
                case 'onset':
                    rMin = 2.8; rMax = 3.6;
                    break;
                case 'chaos':
                    rMin = 3.5; rMax = 4;
                    break;
                case 'window3':
                    rMin = 3.82; rMax = 3.86;
                    break;
                case 'deep':
                    rMin = 3.847; rMax = 3.857;
                    break;
                case 'feigen':
                    rMin = 3.56; rMax = 3.58;
                    break;
            }

            document.getElementById('rmin').value = rMin;
            document.getElementById('rmax').value = rMax;
            document.getElementById('rmin-val').textContent = rMin.toFixed(2);
            document.getElementById('rmax-val').textContent = rMax.toFixed(2);

            render();
        }

        function reset() {
            rMin = 2.5; rMax = 4;
            xMin = 0; xMax = 1;

            document.getElementById('rmin').value = rMin;
            document.getElementById('rmax').value = rMax;
            document.getElementById('rmin-val').textContent = rMin.toFixed(2);
            document.getElementById('rmax-val').textContent = rMax.toFixed(2);

            render();
        }

        window.preset = preset;
        window.reset = reset;
        window.render = render;

        // Mouse interaction
        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            const r = rMin + (x / canvas.width) * (rMax - rMin);
            const xVal = xMax - (y / canvas.height) * (xMax - xMin);

            crosshair.style.display = 'block';
            crosshair.style.left = (e.clientX + 15) + 'px';
            crosshair.style.top = (e.clientY + 15) + 'px';
            crosshair.textContent = `r=${r.toFixed(5)}, x=${xVal.toFixed(5)}`;

            document.getElementById('r-stat').textContent = r.toFixed(5);
            document.getElementById('x-stat').textContent = xVal.toFixed(5);

            // Estimate period at this r value
            const period = estimatePeriod(r);
            document.getElementById('period-stat').textContent = period > 64 ? 'chaos' : period;

            if (selecting) {
                selEnd = {x: e.clientX, y: e.clientY};
                updateSelectionBox();
            }
        });

        canvas.addEventListener('mouseleave', () => {
            crosshair.style.display = 'none';
        });

        canvas.addEventListener('mousedown', (e) => {
            selecting = true;
            const rect = canvas.getBoundingClientRect();
            selStart = {x: e.clientX, y: e.clientY, cx: e.clientX - rect.left, cy: e.clientY - rect.top};
            selEnd = selStart;
        });

        canvas.addEventListener('mouseup', (e) => {
            if (selecting) {
                selecting = false;
                selectionBox.style.display = 'none';

                const rect = canvas.getBoundingClientRect();
                const x1 = selStart.cx;
                const y1 = selStart.cy;
                const x2 = e.clientX - rect.left;
                const y2 = e.clientY - rect.top;

                // Only zoom if selection is meaningful
                if (Math.abs(x2 - x1) > 10 && Math.abs(y2 - y1) > 10) {
                    const newRMin = rMin + (Math.min(x1, x2) / canvas.width) * (rMax - rMin);
                    const newRMax = rMin + (Math.max(x1, x2) / canvas.width) * (rMax - rMin);
                    const newXMax = xMax - (Math.min(y1, y2) / canvas.height) * (xMax - xMin);
                    const newXMin = xMax - (Math.max(y1, y2) / canvas.height) * (xMax - xMin);

                    rMin = newRMin;
                    rMax = newRMax;
                    xMin = newXMin;
                    xMax = newXMax;

                    document.getElementById('rmin').value = rMin;
                    document.getElementById('rmax').value = rMax;
                    document.getElementById('rmin-val').textContent = rMin.toFixed(3);
                    document.getElementById('rmax-val').textContent = rMax.toFixed(3);

                    render();
                }
            }
        });

        function updateSelectionBox() {
            const left = Math.min(selStart.x, selEnd.x);
            const top = Math.min(selStart.y, selEnd.y);
            const width = Math.abs(selEnd.x - selStart.x);
            const height = Math.abs(selEnd.y - selStart.y);

            selectionBox.style.display = 'block';
            selectionBox.style.left = left + 'px';
            selectionBox.style.top = top + 'px';
            selectionBox.style.width = width + 'px';
            selectionBox.style.height = height + 'px';
        }

        function estimatePeriod(r) {
            let x = 0.5;
            const values = [];

            // Skip transient
            for (let i = 0; i < 500; i++) {
                x = mapFunction(x, r);
            }

            // Collect values
            for (let i = 0; i < 128; i++) {
                x = mapFunction(x, r);
                values.push(x);
            }

            // Find period
            for (let period = 1; period <= 64; period++) {
                let match = true;
                for (let i = 0; i < 32 && match; i++) {
                    if (Math.abs(values[i] - values[i + period]) > 0.0001) {
                        match = false;
                    }
                }
                if (match) return period;
            }

            return Infinity;
        }

        // Setup controls
        function setupControls() {
            document.getElementById('rmin').addEventListener('input', (e) => {
                rMin = parseFloat(e.target.value);
                document.getElementById('rmin-val').textContent = rMin.toFixed(2);
            });
            document.getElementById('rmax').addEventListener('input', (e) => {
                rMax = parseFloat(e.target.value);
                document.getElementById('rmax-val').textContent = rMax.toFixed(2);
            });
            document.getElementById('iterations').addEventListener('input', (e) => {
                iterations = parseInt(e.target.value);
                document.getElementById('iter-val').textContent = iterations;
            });
            document.getElementById('skip').addEventListener('input', (e) => {
                skipTransient = parseInt(e.target.value);
                document.getElementById('skip-val').textContent = skipTransient;
            });
            document.getElementById('samples').addEventListener('input', (e) => {
                samplesPerR = parseInt(e.target.value);
                document.getElementById('samples-val').textContent = samplesPerR;
            });
            document.getElementById('color-mode').addEventListener('change', (e) => {
                colorMode = e.target.value;
                render();
            });
            document.getElementById('map-type').addEventListener('change', (e) => {
                mapType = e.target.value;
                render();
            });
        }

        window.addEventListener('resize', () => { resize(); render(); });

        setupControls();
        resize();
        render();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
