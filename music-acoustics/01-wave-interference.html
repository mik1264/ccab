<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wave Interference | Music Acoustics</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            overflow: hidden;
        }
        #canvas { display: block; }
        .controls {
            position: fixed;
            top: 20px; right: 20px;
            background: rgba(0,0,0,0.85);
            padding: 20px; border-radius: 15px;
            min-width: 280px;
            border: 1px solid rgba(251, 146, 60, 0.3);
        }
        h1 { color: #fb923c; font-size: 1.3em; margin-bottom: 15px; }
        .control-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; color: #aaa; font-size: 0.9em; }
        input[type="range"], select { width: 100%; }
        .value { float: right; color: #fb923c; }
        button {
            width: 100%; padding: 10px; margin: 5px 0;
            border: none; border-radius: 8px;
            background: #fb923c; color: white;
            font-weight: bold; cursor: pointer;
        }
        button:hover { background: #fdba74; }
        .stats { margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); }
        .stat-row { display: flex; justify-content: space-between; padding: 5px 0; font-size: 0.9em; }
        .stat-label { color: #888; }
        .stat-value { color: #fb923c; font-weight: bold; }
        .info { font-size: 0.8em; color: #666; margin-top: 15px; line-height: 1.5; }
        a.back-link {
            position: fixed; top: 20px; left: 20px;
            color: #fb923c; text-decoration: none;
            background: rgba(0,0,0,0.8); padding: 10px 20px;
            border-radius: 25px; font-size: 0.9em;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <a href="index.html" class="back-link">← Back to Music Acoustics</a>

    <div class="controls">
        <h1>Wave Interference</h1>
        <p style="font-size:0.85em; color:#888; margin-bottom:15px;">Superposition of sound waves</p>

        <div class="control-group">
            <label>Wave 1 Frequency: <span class="value" id="freq1Value">440</span> Hz</label>
            <input type="range" id="freq1" min="220" max="880" step="1" value="440">
        </div>

        <div class="control-group">
            <label>Wave 2 Frequency: <span class="value" id="freq2Value">445</span> Hz</label>
            <input type="range" id="freq2" min="220" max="880" step="1" value="445">
        </div>

        <div class="control-group">
            <label>Wave 1 Amplitude: <span class="value" id="amp1Value">1.0</span></label>
            <input type="range" id="amp1" min="0" max="1" step="0.1" value="1.0">
        </div>

        <div class="control-group">
            <label>Wave 2 Amplitude: <span class="value" id="amp2Value">1.0</span></label>
            <input type="range" id="amp2" min="0" max="1" step="0.1" value="1.0">
        </div>

        <div class="control-group">
            <label>Phase Difference: <span class="value" id="phaseValue">0</span>°</label>
            <input type="range" id="phase" min="0" max="360" step="5" value="0">
        </div>

        <button id="playBtn">Play Sound</button>
        <button id="resetBtn" style="background:#444">Reset</button>

        <div class="stats">
            <div class="stat-row">
                <span class="stat-label">Beat Frequency</span>
                <span class="stat-value" id="beatFreq">5 Hz</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Interference</span>
                <span class="stat-value" id="interference">Beats</span>
            </div>
        </div>

        <div class="info">
            <strong>Constructive:</strong> Waves in phase add up.<br>
            <strong>Destructive:</strong> Waves out of phase cancel.<br>
            <strong>Beats:</strong> Close frequencies create pulsing.
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resize();
        window.onresize = resize;

        let freq1 = 440;
        let freq2 = 445;
        let amp1 = 1.0;
        let amp2 = 1.0;
        let phaseDiff = 0;
        let time = 0;
        let audioCtx = null;
        let osc1 = null, osc2 = null;
        let isPlaying = false;

        function updateStats() {
            const beatFreq = Math.abs(freq2 - freq1);
            document.getElementById('beatFreq').textContent = beatFreq + ' Hz';

            if (beatFreq === 0 && phaseDiff === 0) {
                document.getElementById('interference').textContent = 'Constructive';
            } else if (beatFreq === 0 && phaseDiff === 180) {
                document.getElementById('interference').textContent = 'Destructive';
            } else if (beatFreq > 0 && beatFreq < 20) {
                document.getElementById('interference').textContent = 'Beats';
            } else {
                document.getElementById('interference').textContent = 'Mixed';
            }
        }

        function draw() {
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const centerX = canvas.width / 2 - 100;
            const graphWidth = canvas.width - 400;
            const waveHeight = 80;

            time += 0.02;

            ctx.fillStyle = '#fff';
            ctx.font = 'bold 24px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Wave Interference', centerX, 40);

            // Wave 1
            const wave1Y = 150;
            ctx.fillStyle = '#888';
            ctx.font = '14px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText(`Wave 1: ${freq1} Hz`, 50, wave1Y - 50);

            ctx.beginPath();
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 2;
            for (let x = 0; x < graphWidth; x++) {
                const t = x / graphWidth * 4 * Math.PI;
                const y = wave1Y + amp1 * waveHeight * Math.sin(t * freq1 / 100 + time * freq1 / 50);
                if (x === 0) ctx.moveTo(50 + x, y);
                else ctx.lineTo(50 + x, y);
            }
            ctx.stroke();

            // Wave 2
            const wave2Y = 300;
            ctx.fillStyle = '#888';
            ctx.fillText(`Wave 2: ${freq2} Hz`, 50, wave2Y - 50);

            ctx.beginPath();
            ctx.strokeStyle = '#22c55e';
            ctx.lineWidth = 2;
            const phaseRad = phaseDiff * Math.PI / 180;
            for (let x = 0; x < graphWidth; x++) {
                const t = x / graphWidth * 4 * Math.PI;
                const y = wave2Y + amp2 * waveHeight * Math.sin(t * freq2 / 100 + time * freq2 / 50 + phaseRad);
                if (x === 0) ctx.moveTo(50 + x, y);
                else ctx.lineTo(50 + x, y);
            }
            ctx.stroke();

            // Sum wave
            const sumY = 480;
            ctx.fillStyle = '#888';
            ctx.fillText('Superposition (Sum)', 50, sumY - 50);

            ctx.beginPath();
            ctx.strokeStyle = '#fb923c';
            ctx.lineWidth = 3;
            for (let x = 0; x < graphWidth; x++) {
                const t = x / graphWidth * 4 * Math.PI;
                const y1 = amp1 * Math.sin(t * freq1 / 100 + time * freq1 / 50);
                const y2 = amp2 * Math.sin(t * freq2 / 100 + time * freq2 / 50 + phaseRad);
                const y = sumY + (y1 + y2) * waveHeight / 2;
                if (x === 0) ctx.moveTo(50 + x, y);
                else ctx.lineTo(50 + x, y);
            }
            ctx.stroke();

            // Draw beat envelope if frequencies are close
            const beatFreq = Math.abs(freq2 - freq1);
            if (beatFreq > 0 && beatFreq < 50) {
                ctx.beginPath();
                ctx.strokeStyle = 'rgba(251, 146, 60, 0.4)';
                ctx.lineWidth = 1;
                ctx.setLineDash([5, 5]);
                for (let x = 0; x < graphWidth; x++) {
                    const t = x / graphWidth * 4 * Math.PI;
                    const envelope = Math.abs(2 * Math.cos(t * beatFreq / 200 + time * beatFreq / 100));
                    const y = sumY - envelope * waveHeight / 2;
                    if (x === 0) ctx.moveTo(50 + x, y);
                    else ctx.lineTo(50 + x, y);
                }
                ctx.stroke();

                ctx.beginPath();
                for (let x = 0; x < graphWidth; x++) {
                    const t = x / graphWidth * 4 * Math.PI;
                    const envelope = Math.abs(2 * Math.cos(t * beatFreq / 200 + time * beatFreq / 100));
                    const y = sumY + envelope * waveHeight / 2;
                    if (x === 0) ctx.moveTo(50 + x, y);
                    else ctx.lineTo(50 + x, y);
                }
                ctx.stroke();
                ctx.setLineDash([]);
            }

            // Draw phase diagram
            const phaseX = 100;
            const phaseY = canvas.height - 120;
            const phaseRadius = 50;

            ctx.fillStyle = 'rgba(0,0,0,0.3)';
            ctx.beginPath();
            ctx.arc(phaseX, phaseY, phaseRadius + 10, 0, Math.PI * 2);
            ctx.fill();

            ctx.strokeStyle = '#666';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.arc(phaseX, phaseY, phaseRadius, 0, Math.PI * 2);
            ctx.stroke();

            // Wave 1 phasor
            const angle1 = time * freq1 / 50;
            ctx.beginPath();
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 3;
            ctx.moveTo(phaseX, phaseY);
            ctx.lineTo(phaseX + amp1 * phaseRadius * Math.cos(angle1), phaseY - amp1 * phaseRadius * Math.sin(angle1));
            ctx.stroke();

            // Wave 2 phasor
            const angle2 = time * freq2 / 50 + phaseRad;
            ctx.beginPath();
            ctx.strokeStyle = '#22c55e';
            ctx.moveTo(phaseX, phaseY);
            ctx.lineTo(phaseX + amp2 * phaseRadius * Math.cos(angle2), phaseY - amp2 * phaseRadius * Math.sin(angle2));
            ctx.stroke();

            ctx.fillStyle = '#888';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Phasors', phaseX, phaseY + phaseRadius + 25);

            // Legend
            const legendX = 250;
            const legendY = canvas.height - 130;

            ctx.fillStyle = '#3b82f6';
            ctx.fillRect(legendX, legendY, 15, 3);
            ctx.fillStyle = '#888';
            ctx.textAlign = 'left';
            ctx.fillText('Wave 1', legendX + 25, legendY + 5);

            ctx.fillStyle = '#22c55e';
            ctx.fillRect(legendX, legendY + 20, 15, 3);
            ctx.fillStyle = '#888';
            ctx.fillText('Wave 2', legendX + 25, legendY + 25);

            ctx.fillStyle = '#fb923c';
            ctx.fillRect(legendX, legendY + 40, 15, 3);
            ctx.fillStyle = '#888';
            ctx.fillText('Sum', legendX + 25, legendY + 45);

            updateStats();
            requestAnimationFrame(draw);
        }

        function playSound() {
            if (isPlaying) {
                osc1.stop();
                osc2.stop();
                isPlaying = false;
                document.getElementById('playBtn').textContent = 'Play Sound';
                return;
            }

            audioCtx = new (window.AudioContext || window.webkitAudioContext)();

            osc1 = audioCtx.createOscillator();
            osc2 = audioCtx.createOscillator();
            const gain1 = audioCtx.createGain();
            const gain2 = audioCtx.createGain();

            osc1.frequency.value = freq1;
            osc2.frequency.value = freq2;
            gain1.gain.value = amp1 * 0.2;
            gain2.gain.value = amp2 * 0.2;

            osc1.connect(gain1);
            osc2.connect(gain2);
            gain1.connect(audioCtx.destination);
            gain2.connect(audioCtx.destination);

            osc1.start();
            osc2.start();

            isPlaying = true;
            document.getElementById('playBtn').textContent = 'Stop Sound';
        }

        // Event listeners
        document.getElementById('freq1').oninput = (e) => {
            freq1 = parseInt(e.target.value);
            document.getElementById('freq1Value').textContent = freq1;
            if (osc1) osc1.frequency.value = freq1;
        };

        document.getElementById('freq2').oninput = (e) => {
            freq2 = parseInt(e.target.value);
            document.getElementById('freq2Value').textContent = freq2;
            if (osc2) osc2.frequency.value = freq2;
        };

        document.getElementById('amp1').oninput = (e) => {
            amp1 = parseFloat(e.target.value);
            document.getElementById('amp1Value').textContent = amp1.toFixed(1);
        };

        document.getElementById('amp2').oninput = (e) => {
            amp2 = parseFloat(e.target.value);
            document.getElementById('amp2Value').textContent = amp2.toFixed(1);
        };

        document.getElementById('phase').oninput = (e) => {
            phaseDiff = parseInt(e.target.value);
            document.getElementById('phaseValue').textContent = phaseDiff;
        };

        document.getElementById('playBtn').onclick = playSound;

        document.getElementById('resetBtn').onclick = () => {
            freq1 = 440; freq2 = 445;
            amp1 = 1.0; amp2 = 1.0;
            phaseDiff = 0;
            document.getElementById('freq1').value = freq1;
            document.getElementById('freq2').value = freq2;
            document.getElementById('amp1').value = amp1;
            document.getElementById('amp2').value = amp2;
            document.getElementById('phase').value = phaseDiff;
            document.getElementById('freq1Value').textContent = freq1;
            document.getElementById('freq2Value').textContent = freq2;
            document.getElementById('amp1Value').textContent = amp1;
            document.getElementById('amp2Value').textContent = amp2;
            document.getElementById('phaseValue').textContent = phaseDiff;
        };

        draw();
    </script>
</body>
</html>
