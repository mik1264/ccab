<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Birefringence - Optical Phenomena</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #0a0e1a;
            color: #e0e0e0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }
        canvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
        }
        .back-link {
            position: fixed;
            top: 15px;
            left: 15px;
            color: #8af;
            text-decoration: none;
            font-size: 14px;
            z-index: 100;
            background: rgba(20,20,40,0.85);
            padding: 6px 14px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }
        .back-link:hover { color: #bdf; }
        #controls {
            position: fixed;
            top: 15px;
            right: 15px;
            background: rgba(20,20,40,0.85);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 16px;
            z-index: 100;
            width: 270px;
            border: 1px solid rgba(100,140,255,0.15);
        }
        #controls h3 {
            color: #8af;
            margin-bottom: 10px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .control-group {
            margin-bottom: 10px;
        }
        .control-group label {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            margin-bottom: 3px;
            color: #aaa;
        }
        .control-group label span { color: #8af; }
        input[type="range"] {
            width: 100%;
            height: 4px;
            -webkit-appearance: none;
            background: rgba(100,140,255,0.2);
            border-radius: 2px;
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #8af;
            cursor: pointer;
        }
        #info {
            position: fixed;
            bottom: 15px;
            left: 15px;
            background: rgba(20,20,40,0.85);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 14px 18px;
            z-index: 100;
            max-width: 380px;
            border: 1px solid rgba(100,140,255,0.15);
            font-size: 12px;
            line-height: 1.6;
            color: #bbb;
        }
        #info h4 { color: #8af; margin-bottom: 6px; font-size: 13px; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">&#8592; Optical Phenomena</a>
    <canvas id="canvas"></canvas>
    <div id="controls">
        <h3>Birefringence</h3>
        <div class="control-group">
            <label>Crystal Rotation <span id="rotVal">0&#176;</span></label>
            <input type="range" id="rotSlider" min="0" max="360" value="0" step="1">
        </div>
        <div class="control-group">
            <label>Crystal Thickness <span id="thickVal">1.0</span></label>
            <input type="range" id="thickSlider" min="0.3" max="3" value="1" step="0.1">
        </div>
        <div class="control-group">
            <label>n<sub>o</sub> (ordinary) <span id="noVal">1.658</span></label>
            <input type="range" id="noSlider" min="1.3" max="2" value="1.658" step="0.001">
        </div>
        <div class="control-group">
            <label>n<sub>e</sub> (extraordinary) <span id="neVal">1.486</span></label>
            <input type="range" id="neSlider" min="1.3" max="2" value="1.486" step="0.001">
        </div>
        <div style="margin-top:8px;font-size:11px;color:#888;">
            <div>Birefringence (&Delta;n): <span id="dnVal" style="color:#8af;">0.172</span></div>
            <div>Separation: <span id="sepVal" style="color:#8af;">8.6 px</span></div>
        </div>
    </div>
    <div id="info">
        <h4>Double Refraction</h4>
        <p>In birefringent crystals like calcite, light splits into two rays: the <strong style="color:#6cf;">ordinary ray</strong> (follows Snell's law) and the <strong style="color:#f86;">extraordinary ray</strong> (doesn't!).</p>
        <p style="margin-top:5px;">The two rays are orthogonally polarized. Rotating the crystal rotates the extraordinary image while the ordinary stays fixed. LCD displays use birefringent liquid crystals to control light.</p>
    </div>
    <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    let W, H;
    function resize() {
        W = canvas.width = window.innerWidth;
        H = canvas.height = window.innerHeight;
    }
    resize();
    window.addEventListener('resize', resize);

    let crystalRot = 0;
    let thickness = 1;
    let nO = 1.658;
    let nE = 1.486;
    let time = 0;

    const rotSlider = document.getElementById('rotSlider');
    const thickSlider = document.getElementById('thickSlider');
    const noSlider = document.getElementById('noSlider');
    const neSlider = document.getElementById('neSlider');

    rotSlider.oninput = () => { crystalRot = +rotSlider.value; document.getElementById('rotVal').innerHTML = crystalRot + '&#176;'; };
    thickSlider.oninput = () => { thickness = +thickSlider.value; document.getElementById('thickVal').textContent = thickness.toFixed(1); updateDn(); };
    noSlider.oninput = () => { nO = +noSlider.value; document.getElementById('noVal').textContent = nO.toFixed(3); updateDn(); };
    neSlider.oninput = () => { nE = +neSlider.value; document.getElementById('neVal').textContent = nE.toFixed(3); updateDn(); };

    function updateDn() {
        const dn = Math.abs(nO - nE);
        document.getElementById('dnVal').textContent = dn.toFixed(3);
        const sep = (dn * thickness * 50).toFixed(1);
        document.getElementById('sepVal').textContent = sep + ' px';
    }
    updateDn();

    const textLines = ['CALCITE', 'CRYSTAL', 'OPTICS'];

    function drawBackground() {
        ctx.fillStyle = '#12162a';
        ctx.fillRect(0, 0, W, H);
        ctx.strokeStyle = 'rgba(100,140,255,0.04)';
        ctx.lineWidth = 1;
        for (let i = 0; i < W; i += 40) {
            ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, H); ctx.stroke();
        }
        for (let i = 0; i < H; i += 40) {
            ctx.beginPath(); ctx.moveTo(0, i); ctx.lineTo(W, i); ctx.stroke();
        }
    }

    function drawText(cx, cy, offsetX, offsetY, color, alpha) {
        ctx.save();
        ctx.globalAlpha = alpha;
        ctx.fillStyle = color;
        ctx.font = 'bold 28px sans-serif';
        ctx.textAlign = 'center';
        for (let i = 0; i < textLines.length; i++) {
            ctx.fillText(textLines[i], cx + offsetX, cy + offsetY + i * 36 - 20);
        }
        ctx.restore();
    }

    function drawCrystal(cx, cy, w, h, rot, t) {
        ctx.save();
        ctx.translate(cx, cy);
        ctx.rotate(rot * Math.PI / 180);
        const shimmer = Math.sin(t * 1.5) * 0.03 + 0.12;
        ctx.fillStyle = `rgba(180,200,240,${shimmer})`;
        ctx.strokeStyle = 'rgba(140,180,255,0.4)';
        ctx.lineWidth = 2;
        const hw = w / 2, hh = h / 2;
        const skew = thickness * 10;
        ctx.beginPath();
        ctx.moveTo(-hw, -hh);
        ctx.lineTo(hw, -hh);
        ctx.lineTo(hw + skew, hh);
        ctx.lineTo(-hw + skew, hh);
        ctx.closePath();
        ctx.fill();
        ctx.stroke();
        ctx.strokeStyle = 'rgba(140,180,255,0.15)';
        ctx.lineWidth = 0.5;
        for (let i = -4; i <= 4; i++) {
            ctx.beginPath();
            ctx.moveTo(-hw + i * 20, -hh);
            ctx.lineTo(-hw + i * 20 + skew, hh);
            ctx.stroke();
        }
        ctx.fillStyle = 'rgba(140,180,255,0.6)';
        ctx.font = '10px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('Calcite Crystal', 0, -hh - 10);
        const axisLen = Math.min(hw, hh) * 0.6;
        ctx.strokeStyle = '#6cf';
        ctx.lineWidth = 1.5;
        ctx.setLineDash([3, 3]);
        ctx.beginPath();
        ctx.moveTo(-axisLen, 0);
        ctx.lineTo(axisLen, 0);
        ctx.stroke();
        ctx.fillStyle = '#6cf';
        ctx.font = '9px sans-serif';
        ctx.fillText('fast axis', axisLen + 20, 4);
        ctx.strokeStyle = '#f86';
        ctx.beginPath();
        ctx.moveTo(0, -axisLen);
        ctx.lineTo(0, axisLen);
        ctx.stroke();
        ctx.fillStyle = '#f86';
        ctx.fillText('slow axis', 4, axisLen + 14);
        ctx.setLineDash([]);
        ctx.restore();
    }

    function drawRayDiagram(cx, cy) {
        const startY = cy - 180;
        const crystalTop = cy - 80;
        const crystalBot = cy + 80;
        const endY = cy + 180;
        const dn = Math.abs(nO - nE);
        const separation = dn * thickness * 50;
        const rotRad = crystalRot * Math.PI / 180;
        const eOffX = Math.sin(rotRad) * separation;
        const eOffY = -Math.cos(rotRad) * separation * 0.3;
        ctx.strokeStyle = '#fff';
        ctx.lineWidth = 2;
        ctx.globalAlpha = 0.7;
        ctx.beginPath();
        ctx.moveTo(cx, startY);
        ctx.lineTo(cx, crystalTop);
        ctx.stroke();
        ctx.strokeStyle = '#6cf';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(cx, crystalTop);
        ctx.lineTo(cx, crystalBot);
        ctx.lineTo(cx, endY);
        ctx.stroke();
        ctx.strokeStyle = '#f86';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(cx, crystalTop);
        ctx.lineTo(cx + eOffX, crystalBot);
        ctx.lineTo(cx + eOffX, endY);
        ctx.stroke();
        ctx.globalAlpha = 1;
        ctx.fillStyle = '#fff';
        ctx.font = '10px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('Incident light', cx, startY - 8);
        ctx.fillStyle = '#6cf';
        ctx.fillText('O-ray (n=' + nO.toFixed(2) + ')', cx - 50, endY + 16);
        ctx.fillStyle = '#f86';
        ctx.fillText('E-ray (n=' + nE.toFixed(2) + ')', cx + eOffX + 50, endY + 16);
        const polY = endY + 30;
        drawPolArrows(cx, polY, 90, '#6cf', 'O: vertical pol');
        drawPolArrows(cx + eOffX, polY + 20, 0, '#f86', 'E: horizontal pol');
    }

    function drawPolArrows(x, y, angle, color, label) {
        const rad = angle * Math.PI / 180;
        const len = 10;
        ctx.strokeStyle = color;
        ctx.lineWidth = 1.5;
        ctx.beginPath();
        ctx.moveTo(x - Math.cos(rad) * len, y - Math.sin(rad) * len);
        ctx.lineTo(x + Math.cos(rad) * len, y + Math.sin(rad) * len);
        ctx.stroke();
        ctx.fillStyle = color;
        ctx.font = '9px sans-serif';
        ctx.textAlign = 'left';
        ctx.fillText(label, x + 15, y + 4);
    }

    function drawDoubleImage(cx, cy) {
        const dn = Math.abs(nO - nE);
        const separation = dn * thickness * 50;
        const rotRad = crystalRot * Math.PI / 180;
        const eOffX = Math.sin(rotRad) * separation;
        const eOffY = -Math.cos(rotRad) * separation;
        drawText(cx, cy, 0, 0, 'rgba(100,200,255,0.7)', 0.7);
        drawText(cx, cy, eOffX, eOffY, 'rgba(255,140,100,0.6)', 0.6);
    }

    function animate(ts) {
        time = ts * 0.001;
        ctx.clearRect(0, 0, W, H);
        drawBackground();

        const leftPanel = W * 0.35;
        const rightPanel = W * 0.7;
        const cy = H * 0.48;

        drawDoubleImage(leftPanel, cy);
        drawCrystal(leftPanel, cy, 200 * thickness, 160, crystalRot, time);

        ctx.fillStyle = '#aaa';
        ctx.font = '12px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('View through crystal', leftPanel, H * 0.12);

        drawRayDiagram(rightPanel, cy);
        ctx.fillText('Ray diagram', rightPanel, H * 0.12);

        requestAnimationFrame(animate);
    }

    window.reset = function() {
        crystalRot = 0;
        thickness = 1;
        nO = 1.658;
        nE = 1.486;
        rotSlider.value = 0;
        thickSlider.value = 1;
        noSlider.value = 1.658;
        neSlider.value = 1.486;
        document.getElementById('rotVal').innerHTML = '0&#176;';
        document.getElementById('thickVal').textContent = '1.0';
        document.getElementById('noVal').textContent = '1.658';
        document.getElementById('neVal').textContent = '1.486';
        updateDn();
    };

    requestAnimationFrame(animate);
    </script>
    <script src="../assets/js/enhance.js"></script>
</body>
</html>
