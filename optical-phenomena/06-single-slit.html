<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Single Slit Diffraction - Optical Phenomena</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0a0e1a; color: #e0e0e0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden; }
        canvas { display: block; }
        .back-link {
            position: fixed; top: 15px; left: 15px; color: #8ab4f8; text-decoration: none;
            font-size: 14px; z-index: 1000; opacity: 0.8; transition: opacity 0.3s;
        }
        .back-link:hover { opacity: 1; }
        .controls {
            position: fixed; top: 15px; right: 15px; z-index: 1000;
            background: rgba(20,20,40,0.85); backdrop-filter: blur(10px);
            border: 1px solid rgba(100,140,255,0.2); border-radius: 12px;
            padding: 16px; min-width: 240px;
        }
        .controls h3 { color: #8ab4f8; font-size: 14px; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1px; }
        .control-group { margin-bottom: 10px; }
        .control-group label { display: block; font-size: 12px; color: #aaa; margin-bottom: 4px; }
        .control-group input[type="range"] { width: 100%; accent-color: #8ab4f8; }
        .control-group .value { float: right; color: #8ab4f8; font-size: 12px; font-family: monospace; }
        .info-panel {
            position: fixed; bottom: 15px; left: 15px; z-index: 1000;
            background: rgba(20,20,40,0.85); backdrop-filter: blur(10px);
            border: 1px solid rgba(100,140,255,0.2); border-radius: 12px;
            padding: 16px; max-width: 380px;
        }
        .info-panel h3 { color: #8ab4f8; font-size: 14px; margin-bottom: 8px; }
        .info-panel p { font-size: 12px; color: #bbb; line-height: 1.5; margin-bottom: 6px; }
        .formula { font-family: monospace; color: #f0c060; font-size: 13px; padding: 6px 0; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">&larr; Back to Optical Phenomena</a>

    <div class="controls">
        <h3>Single Slit Diffraction</h3>
        <div class="control-group">
            <label>Wavelength <span class="value" id="wlVal">550 nm</span></label>
            <input type="range" id="wavelength" min="380" max="780" value="550" step="5">
        </div>
        <div class="control-group">
            <label>Slit Width <span class="value" id="swVal">5.0 &mu;m</span></label>
            <input type="range" id="slitWidth" min="1" max="20" value="5" step="0.5">
        </div>
        <div class="control-group">
            <label>Screen Distance <span class="value" id="sdVal">1.0 m</span></label>
            <input type="range" id="screenDist" min="0.2" max="3" value="1" step="0.1">
        </div>
    </div>

    <div class="info-panel">
        <h3>Fraunhofer Single-Slit Diffraction</h3>
        <p>A plane wave passes through a narrow slit, spreading out via diffraction. Narrower slits produce wider diffraction patterns -- counterintuitively, smaller openings spread light more!</p>
        <div class="formula">I(&theta;) = I&#8320; &middot; [sin(&alpha;)/&alpha;]&sup2;</div>
        <div class="formula">&alpha; = &pi;a&middot;sin(&theta;)/&lambda;</div>
        <p>Where a = slit width, &lambda; = wavelength. Central maximum is twice as wide as side lobes.</p>
    </div>

    <canvas id="canvas"></canvas>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let W, H;
        let time = 0;
        let animId;

        const slWavelength = document.getElementById('wavelength');
        const slSlitWidth = document.getElementById('slitWidth');
        const slScreenDist = document.getElementById('screenDist');
        const wlVal = document.getElementById('wlVal');
        const swVal = document.getElementById('swVal');
        const sdVal = document.getElementById('sdVal');

        function resize() {
            W = canvas.width = window.innerWidth;
            H = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        function wavelengthToRGB(nm) {
            let r = 0, g = 0, b = 0;
            if (nm >= 380 && nm < 440) { r = -(nm - 440) / (440 - 380); b = 1; }
            else if (nm >= 440 && nm < 490) { g = (nm - 440) / (490 - 440); b = 1; }
            else if (nm >= 490 && nm < 510) { g = 1; b = -(nm - 510) / (510 - 490); }
            else if (nm >= 510 && nm < 580) { r = (nm - 510) / (580 - 510); g = 1; }
            else if (nm >= 580 && nm < 645) { r = 1; g = -(nm - 645) / (645 - 580); }
            else if (nm >= 645 && nm <= 780) { r = 1; }
            let factor = 1;
            if (nm >= 380 && nm < 420) factor = 0.3 + 0.7 * (nm - 380) / (420 - 380);
            else if (nm > 700) factor = 0.3 + 0.7 * (780 - nm) / (780 - 700);
            return [r * factor, g * factor, b * factor];
        }

        function sinc(x) {
            if (Math.abs(x) < 1e-10) return 1;
            return Math.sin(x) / x;
        }

        function draw() {
            const lambda = parseFloat(slWavelength.value);
            const a = parseFloat(slSlitWidth.value);
            const D = parseFloat(slScreenDist.value);

            wlVal.textContent = lambda + ' nm';
            swVal.textContent = a.toFixed(1) + ' \u00b5m';
            sdVal.textContent = D.toFixed(1) + ' m';

            ctx.fillStyle = '#0a0e1a';
            ctx.fillRect(0, 0, W, H);

            const [rr, gg, bb] = wavelengthToRGB(lambda);
            const wallX = W * 0.3;
            const screenX = W * 0.75;
            const slitCenterY = H / 2;
            const slitPixelHalf = Math.max(2, a * 3);

            // Draw barrier wall
            ctx.fillStyle = '#1a1e2e';
            ctx.fillRect(wallX - 8, 0, 16, slitCenterY - slitPixelHalf);
            ctx.fillRect(wallX - 8, slitCenterY + slitPixelHalf, 16, H - slitCenterY - slitPixelHalf);

            // Draw slit opening highlight
            ctx.fillStyle = `rgba(${Math.round(rr*255)},${Math.round(gg*255)},${Math.round(bb*255)},0.3)`;
            ctx.fillRect(wallX - 8, slitCenterY - slitPixelHalf, 16, slitPixelHalf * 2);

            // Animate incoming plane waves (left side)
            const waveSpeed = 0.05;
            const wavePeriod = lambda / 15;
            for (let x = 0; x < wallX - 8; x += 2) {
                const phase = (x - time * waveSpeed * 500) / wavePeriod;
                const intensity = (Math.sin(phase) * 0.5 + 0.5) * 0.4;
                ctx.fillStyle = `rgba(${Math.round(rr*255)},${Math.round(gg*255)},${Math.round(bb*255)},${intensity})`;
                ctx.fillRect(x, 0, 2, H);
            }

            // Draw diffraction pattern: spreading waves from slit
            const numRays = 200;
            for (let i = 0; i < numRays; i++) {
                const angle = (i / numRays - 0.5) * Math.PI * 0.8;
                const sinTheta = Math.sin(angle);
                const alpha = Math.PI * a * sinTheta / (lambda * 0.001);
                const I = sinc(alpha) * sinc(alpha);

                if (I < 0.005) continue;

                const dx = Math.cos(angle);
                const dy = Math.sin(angle);

                ctx.beginPath();
                ctx.moveTo(wallX + 8, slitCenterY);

                const endX = wallX + 8 + dx * (screenX - wallX);
                const endY = slitCenterY + dy * (screenX - wallX);

                ctx.lineTo(endX, endY);
                ctx.strokeStyle = `rgba(${Math.round(rr*255)},${Math.round(gg*255)},${Math.round(bb*255)},${I * 0.15})`;
                ctx.lineWidth = 1;
                ctx.stroke();
            }

            // Draw spherical wavefronts from the slit
            const maxR = screenX - wallX;
            for (let r = 0; r < maxR; r += wavePeriod) {
                const rAdj = r + (time * waveSpeed * 500) % wavePeriod;
                if (rAdj > maxR) continue;
                const intensity = Math.max(0, 0.15 * (1 - rAdj / maxR));
                ctx.beginPath();
                ctx.arc(wallX + 8, slitCenterY, rAdj, -Math.PI * 0.4, Math.PI * 0.4);
                ctx.strokeStyle = `rgba(${Math.round(rr*255)},${Math.round(gg*255)},${Math.round(bb*255)},${intensity})`;
                ctx.lineWidth = 1.5;
                ctx.stroke();
            }

            // Draw screen
            ctx.fillStyle = '#0d1020';
            ctx.fillRect(screenX, 0, W - screenX, H);

            // Draw diffraction pattern on screen
            const screenHeight = H;
            for (let py = 0; py < screenHeight; py++) {
                const y = (py - slitCenterY);
                const thetaApprox = y / (D * 1000);
                const alpha2 = Math.PI * a * thetaApprox / (lambda * 0.001);
                const I = sinc(alpha2) * sinc(alpha2);

                const bright = Math.pow(I, 0.5);
                const r2 = Math.round(rr * bright * 255);
                const g2 = Math.round(gg * bright * 255);
                const b2 = Math.round(bb * bright * 255);

                ctx.fillStyle = `rgb(${r2},${g2},${b2})`;
                ctx.fillRect(screenX, py, 30, 1);
            }

            // Draw intensity graph on right side
            const graphX = screenX + 50;
            const graphW = W - graphX - 20;
            const graphH = H - 60;

            ctx.strokeStyle = 'rgba(100,140,255,0.3)';
            ctx.lineWidth = 1;
            ctx.setLineDash([3, 3]);
            ctx.beginPath();
            ctx.moveTo(graphX, 30);
            ctx.lineTo(graphX, 30 + graphH);
            ctx.lineTo(graphX + graphW, 30 + graphH);
            ctx.stroke();
            ctx.setLineDash([]);

            ctx.fillStyle = '#888';
            ctx.font = '11px monospace';
            ctx.fillText('Intensity', graphX + 2, 25);
            ctx.fillText('Position', graphX + graphW - 40, 30 + graphH + 15);

            // Plot intensity curve
            ctx.beginPath();
            let first = true;
            for (let py = 0; py < graphH; py++) {
                const y = ((py / graphH) - 0.5) * screenHeight;
                const thetaApprox = y / (D * 1000);
                const alpha2 = Math.PI * a * thetaApprox / (lambda * 0.001);
                const I = sinc(alpha2) * sinc(alpha2);

                const px = graphX + I * graphW * 0.9;
                const plotY = 30 + py;

                if (first) { ctx.moveTo(px, plotY); first = false; }
                else ctx.lineTo(px, plotY);
            }
            ctx.strokeStyle = `rgba(${Math.round(rr*255)},${Math.round(gg*255)},${Math.round(bb*255)},0.9)`;
            ctx.lineWidth = 2;
            ctx.stroke();

            // Fill under curve
            ctx.lineTo(graphX, 30 + graphH);
            ctx.lineTo(graphX, 30);
            ctx.closePath();
            ctx.fillStyle = `rgba(${Math.round(rr*255)},${Math.round(gg*255)},${Math.round(bb*255)},0.1)`;
            ctx.fill();

            // Labels
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 16px Segoe UI, sans-serif';
            ctx.fillText('Single Slit Diffraction', W / 2 - 100, H - 15);

            time += 0.016;
            animId = requestAnimationFrame(draw);
        }

        window.reset = function() {
            time = 0;
            slWavelength.value = 550;
            slSlitWidth.value = 5;
            slScreenDist.value = 1;
        };

        draw();
    </script>
    <script src="../assets/js/enhance.js"></script>
</body>
</html>
