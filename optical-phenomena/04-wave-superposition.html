<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wave Superposition - Optical Phenomena</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #0a0e1a;
            color: #e0e0e0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }
        canvas { display: block; position: absolute; top: 0; left: 0; }
        .back-link {
            position: fixed; top: 15px; left: 15px; color: #8af;
            text-decoration: none; font-size: 14px; z-index: 100;
            background: rgba(20,20,40,0.85); padding: 6px 14px;
            border-radius: 8px; backdrop-filter: blur(10px);
        }
        .back-link:hover { color: #bdf; }
        #controls {
            position: fixed; top: 15px; right: 15px;
            background: rgba(20,20,40,0.85); backdrop-filter: blur(10px);
            border-radius: 12px; padding: 16px; z-index: 100;
            width: 280px; border: 1px solid rgba(100,140,255,0.15);
            max-height: calc(100vh - 30px); overflow-y: auto;
        }
        #controls h3 { color: #8af; margin-bottom: 10px; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }
        .wave-panel {
            background: rgba(100,140,255,0.05);
            border: 1px solid rgba(100,140,255,0.1);
            border-radius: 8px; padding: 10px; margin-bottom: 8px;
        }
        .wave-panel h4 { color: #adf; font-size: 12px; margin-bottom: 6px; }
        .control-group { margin-bottom: 6px; }
        .control-group label { display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 2px; color: #999; }
        .control-group label span { color: #8af; }
        input[type="range"] {
            width: 100%; height: 3px; -webkit-appearance: none;
            background: rgba(100,140,255,0.2); border-radius: 2px; outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; width: 12px; height: 12px;
            border-radius: 50%; background: #8af; cursor: pointer;
        }
        .presets { margin-bottom: 10px; }
        .presets h4 { color: #8af; font-size: 12px; margin-bottom: 6px; }
        .preset-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; }
        .preset-btn {
            padding: 5px 4px; border: 1px solid rgba(100,140,255,0.3);
            background: rgba(100,140,255,0.1); color: #8af; border-radius: 6px;
            font-size: 10px; cursor: pointer; transition: 0.2s; text-align: center;
        }
        .preset-btn:hover { background: rgba(100,140,255,0.25); }
        .color-dot {
            display: inline-block; width: 8px; height: 8px;
            border-radius: 50%; margin-right: 4px; vertical-align: middle;
        }
        #info {
            position: fixed; bottom: 15px; left: 15px;
            background: rgba(20,20,40,0.85); backdrop-filter: blur(10px);
            border-radius: 12px; padding: 14px 18px; z-index: 100;
            max-width: 420px; border: 1px solid rgba(100,140,255,0.15);
            font-size: 12px; line-height: 1.6;
        }
        #info h4 { color: #8af; margin-bottom: 6px; font-size: 13px; }
        #info p { color: #bbb; }
        #controls::-webkit-scrollbar { width: 4px; }
        #controls::-webkit-scrollbar-thumb { background: rgba(100,140,255,0.3); border-radius: 2px; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">&larr; Back to Gallery</a>
    <canvas id="canvas"></canvas>

    <div id="controls">
        <h3>Wave Superposition</h3>

        <div class="presets">
            <h4>Presets</h4>
            <div class="preset-grid">
                <button class="preset-btn" data-preset="beats">Beats</button>
                <button class="preset-btn" data-preset="standing">Standing Wave</button>
                <button class="preset-btn" data-preset="square">Square Wave</button>
                <button class="preset-btn" data-preset="triangle">Triangle Wave</button>
                <button class="preset-btn" data-preset="sawtooth">Sawtooth</button>
                <button class="preset-btn" data-preset="harmonics">Harmonics</button>
            </div>
        </div>

        <div id="wavePanels"></div>
    </div>

    <div id="info">
        <h4>Wave Superposition Principle</h4>
        <p>When two or more waves overlap, the resulting displacement is the sum of individual
        displacements. Close frequencies create "beats" (pulsing amplitude). Equal frequencies
        traveling in opposite directions form standing waves. Adding harmonics with the right
        amplitudes can synthesize any waveform -- this is the basis of Fourier synthesis.</p>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let W, H, time = 0, animId;

        function resize() {
            W = canvas.width = window.innerWidth;
            H = canvas.height = window.innerHeight;
        }
        resize();
        window.addEventListener('resize', resize);

        const waveColors = ['#ff6b6b', '#4ecdc4', '#ffe66d', '#a29bfe', '#fd79a8'];
        const sumColor = '#ffffff';

        let waves = [
            { freq: 3, amp: 0.8, phase: 0, dir: 1, active: true },
            { freq: 3.3, amp: 0.8, phase: 0, dir: 1, active: true },
            { freq: 0, amp: 0, phase: 0, dir: 1, active: false },
            { freq: 0, amp: 0, phase: 0, dir: 1, active: false },
            { freq: 0, amp: 0, phase: 0, dir: 1, active: false }
        ];

        const wavePanelsDiv = document.getElementById('wavePanels');

        function buildPanels() {
            wavePanelsDiv.innerHTML = '';
            waves.forEach((w, i) => {
                const panel = document.createElement('div');
                panel.className = 'wave-panel';
                panel.innerHTML = `
                    <h4><span class="color-dot" style="background:${waveColors[i]}"></span>Wave ${i + 1}
                        <label style="float:right;font-size:10px;color:#888">
                            <input type="checkbox" class="wave-active" data-idx="${i}" ${w.active ? 'checked' : ''}> On
                        </label>
                    </h4>
                    <div class="control-group">
                        <label>Frequency <span class="freq-val" data-idx="${i}">${w.freq.toFixed(1)}</span></label>
                        <input type="range" class="freq-slider" data-idx="${i}" min="0.1" max="20" value="${w.freq}" step="0.1">
                    </div>
                    <div class="control-group">
                        <label>Amplitude <span class="amp-val" data-idx="${i}">${w.amp.toFixed(2)}</span></label>
                        <input type="range" class="amp-slider" data-idx="${i}" min="0" max="1" value="${w.amp}" step="0.01">
                    </div>
                    <div class="control-group">
                        <label>Phase <span class="phase-val" data-idx="${i}">${w.phase.toFixed(1)}&deg;</span></label>
                        <input type="range" class="phase-slider" data-idx="${i}" min="0" max="360" value="${w.phase}" step="1">
                    </div>
                    <div class="control-group">
                        <label>Direction <span class="dir-val" data-idx="${i}">${w.dir > 0 ? '&rarr;' : '&larr;'}</span></label>
                        <input type="range" class="dir-slider" data-idx="${i}" min="0" max="1" value="${w.dir > 0 ? 1 : 0}" step="1">
                    </div>
                `;
                wavePanelsDiv.appendChild(panel);
            });

            // Attach listeners
            document.querySelectorAll('.freq-slider').forEach(el => {
                el.addEventListener('input', e => {
                    const i = +e.target.dataset.idx;
                    waves[i].freq = +e.target.value;
                    document.querySelector(`.freq-val[data-idx="${i}"]`).textContent = waves[i].freq.toFixed(1);
                });
            });
            document.querySelectorAll('.amp-slider').forEach(el => {
                el.addEventListener('input', e => {
                    const i = +e.target.dataset.idx;
                    waves[i].amp = +e.target.value;
                    document.querySelector(`.amp-val[data-idx="${i}"]`).textContent = waves[i].amp.toFixed(2);
                });
            });
            document.querySelectorAll('.phase-slider').forEach(el => {
                el.addEventListener('input', e => {
                    const i = +e.target.dataset.idx;
                    waves[i].phase = +e.target.value;
                    document.querySelector(`.phase-val[data-idx="${i}"]`).textContent = Math.round(waves[i].phase) + '\u00B0';
                });
            });
            document.querySelectorAll('.dir-slider').forEach(el => {
                el.addEventListener('input', e => {
                    const i = +e.target.dataset.idx;
                    waves[i].dir = +e.target.value === 1 ? 1 : -1;
                    document.querySelector(`.dir-val[data-idx="${i}"]`).innerHTML = waves[i].dir > 0 ? '&rarr;' : '&larr;';
                });
            });
            document.querySelectorAll('.wave-active').forEach(el => {
                el.addEventListener('change', e => {
                    const i = +e.target.dataset.idx;
                    waves[i].active = e.target.checked;
                });
            });
        }

        buildPanels();

        // Presets
        const presets = {
            beats: () => {
                waves[0] = { freq: 5, amp: 0.7, phase: 0, dir: 1, active: true };
                waves[1] = { freq: 5.5, amp: 0.7, phase: 0, dir: 1, active: true };
                waves[2] = { freq: 0, amp: 0, phase: 0, dir: 1, active: false };
                waves[3] = { freq: 0, amp: 0, phase: 0, dir: 1, active: false };
                waves[4] = { freq: 0, amp: 0, phase: 0, dir: 1, active: false };
            },
            standing: () => {
                waves[0] = { freq: 4, amp: 0.8, phase: 0, dir: 1, active: true };
                waves[1] = { freq: 4, amp: 0.8, phase: 0, dir: -1, active: true };
                waves[2] = { freq: 0, amp: 0, phase: 0, dir: 1, active: false };
                waves[3] = { freq: 0, amp: 0, phase: 0, dir: 1, active: false };
                waves[4] = { freq: 0, amp: 0, phase: 0, dir: 1, active: false };
            },
            square: () => {
                // Square wave: fundamental + odd harmonics (1, 3, 5, 7, 9)
                const f = 2;
                waves[0] = { freq: f, amp: 0.8, phase: 0, dir: 1, active: true };
                waves[1] = { freq: f*3, amp: 0.8/3, phase: 0, dir: 1, active: true };
                waves[2] = { freq: f*5, amp: 0.8/5, phase: 0, dir: 1, active: true };
                waves[3] = { freq: f*7, amp: 0.8/7, phase: 0, dir: 1, active: true };
                waves[4] = { freq: f*9, amp: 0.8/9, phase: 0, dir: 1, active: true };
            },
            triangle: () => {
                const f = 2;
                waves[0] = { freq: f, amp: 0.8, phase: 0, dir: 1, active: true };
                waves[1] = { freq: f*3, amp: 0.8/9, phase: 180, dir: 1, active: true };
                waves[2] = { freq: f*5, amp: 0.8/25, phase: 0, dir: 1, active: true };
                waves[3] = { freq: f*7, amp: 0.8/49, phase: 180, dir: 1, active: true };
                waves[4] = { freq: f*9, amp: 0.8/81, phase: 0, dir: 1, active: true };
            },
            sawtooth: () => {
                const f = 2;
                waves[0] = { freq: f, amp: 0.6, phase: 0, dir: 1, active: true };
                waves[1] = { freq: f*2, amp: 0.3, phase: 180, dir: 1, active: true };
                waves[2] = { freq: f*3, amp: 0.2, phase: 0, dir: 1, active: true };
                waves[3] = { freq: f*4, amp: 0.15, phase: 180, dir: 1, active: true };
                waves[4] = { freq: f*5, amp: 0.12, phase: 0, dir: 1, active: true };
            },
            harmonics: () => {
                const f = 2;
                waves[0] = { freq: f, amp: 0.6, phase: 0, dir: 1, active: true };
                waves[1] = { freq: f*2, amp: 0.4, phase: 0, dir: 1, active: true };
                waves[2] = { freq: f*3, amp: 0.25, phase: 0, dir: 1, active: true };
                waves[3] = { freq: f*4, amp: 0.15, phase: 0, dir: 1, active: true };
                waves[4] = { freq: f*5, amp: 0.1, phase: 0, dir: 1, active: true };
            }
        };

        document.querySelectorAll('.preset-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const p = btn.dataset.preset;
                if (presets[p]) {
                    presets[p]();
                    buildPanels();
                }
            });
        });

        function waveValue(wave, x, t) {
            if (!wave.active) return 0;
            const phaseRad = wave.phase * Math.PI / 180;
            return wave.amp * Math.sin(2 * Math.PI * wave.freq * (x * wave.dir - t) + phaseRad);
        }

        function draw() {
            ctx.fillStyle = '#0a0e1a';
            ctx.fillRect(0, 0, W, H);

            const activeWaves = waves.filter(w => w.active);
            const numActive = activeWaves.length;
            const margin = 60;
            const plotW = W - margin * 2 - 300; // account for controls panel
            const effectivePlotW = Math.max(plotW, 200);

            // Layout: individual waves in top section, sum wave below
            const totalSlots = numActive + 1; // individual + sum
            const slotH = Math.min(150, (H - 80) / totalSlots);

            // Draw grid lines
            ctx.strokeStyle = 'rgba(100,140,255,0.06)';
            ctx.lineWidth = 1;

            // Draw each individual wave
            let slotIdx = 0;
            for (let wi = 0; wi < waves.length; wi++) {
                if (!waves[wi].active) continue;
                const cy = 50 + slotIdx * slotH + slotH / 2;
                const amp = slotH * 0.35;

                // Zero line
                ctx.strokeStyle = 'rgba(255,255,255,0.08)';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(margin, cy);
                ctx.lineTo(margin + effectivePlotW, cy);
                ctx.stroke();

                // Wave
                ctx.strokeStyle = waveColors[wi];
                ctx.lineWidth = 2;
                ctx.globalAlpha = 0.7;
                ctx.beginPath();
                for (let px = 0; px <= effectivePlotW; px++) {
                    const x = px / effectivePlotW * 4; // 4 "units" of space
                    const y = waveValue(waves[wi], x, time * 0.5);
                    const screenY = cy - y * amp / waves[wi].amp * (waves[wi].amp > 0 ? 1 : 0);
                    if (px === 0) ctx.moveTo(margin + px, screenY);
                    else ctx.lineTo(margin + px, screenY);
                }
                ctx.stroke();
                ctx.globalAlpha = 1;

                // Label
                ctx.fillStyle = waveColors[wi];
                ctx.font = '11px sans-serif';
                ctx.fillText(`Wave ${wi + 1}: f=${waves[wi].freq.toFixed(1)} A=${waves[wi].amp.toFixed(2)}`, margin, cy - amp - 8);

                slotIdx++;
            }

            // Sum wave (larger, at bottom)
            if (numActive > 0) {
                const sumCy = 50 + slotIdx * slotH + slotH / 2;
                const sumAmp = slotH * 0.4;

                // Zero line
                ctx.strokeStyle = 'rgba(255,255,255,0.1)';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(margin, sumCy);
                ctx.lineTo(margin + effectivePlotW, sumCy);
                ctx.stroke();

                // Filled area under sum wave
                ctx.beginPath();
                ctx.moveTo(margin, sumCy);
                for (let px = 0; px <= effectivePlotW; px++) {
                    const x = px / effectivePlotW * 4;
                    let sum = 0;
                    for (let wi = 0; wi < waves.length; wi++) {
                        sum += waveValue(waves[wi], x, time * 0.5);
                    }
                    const screenY = sumCy - sum * sumAmp;
                    ctx.lineTo(margin + px, screenY);
                }
                ctx.lineTo(margin + effectivePlotW, sumCy);
                ctx.closePath();
                const grad = ctx.createLinearGradient(0, sumCy - sumAmp, 0, sumCy + sumAmp);
                grad.addColorStop(0, 'rgba(100,180,255,0.15)');
                grad.addColorStop(0.5, 'rgba(100,180,255,0.02)');
                grad.addColorStop(1, 'rgba(100,180,255,0.15)');
                ctx.fillStyle = grad;
                ctx.fill();

                // Sum wave line
                ctx.strokeStyle = sumColor;
                ctx.lineWidth = 2.5;
                ctx.beginPath();
                for (let px = 0; px <= effectivePlotW; px++) {
                    const x = px / effectivePlotW * 4;
                    let sum = 0;
                    for (let wi = 0; wi < waves.length; wi++) {
                        sum += waveValue(waves[wi], x, time * 0.5);
                    }
                    const screenY = sumCy - sum * sumAmp;
                    if (px === 0) ctx.moveTo(margin + px, screenY);
                    else ctx.lineTo(margin + px, screenY);
                }
                ctx.stroke();

                // Label
                ctx.fillStyle = sumColor;
                ctx.font = 'bold 12px sans-serif';
                ctx.fillText('Sum (Superposition)', margin, sumCy - sumAmp - 10);
            }

            time += 0.016;
        }

        function animate() {
            draw();
            animId = requestAnimationFrame(animate);
        }

        window.reset = function() {
            time = 0;
            presets.beats();
            buildPanels();
        };

        animate();
    </script>
    <script src="../assets/js/enhance.js"></script>
</body>
</html>
