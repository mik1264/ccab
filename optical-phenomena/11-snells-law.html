<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snell's Law Explorer</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; color: #e0e0e0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden; }
canvas { display: block; }
#controls {
    position: fixed; top: 15px; right: 15px; width: 280px;
    background: rgba(20,20,40,0.85); backdrop-filter: blur(10px);
    border-radius: 12px; padding: 18px; z-index: 10;
    border: 1px solid rgba(100,140,255,0.2);
}
#controls h3 { color: #7eb8ff; margin-bottom: 12px; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }
.control-row { margin-bottom: 10px; }
.control-row label { display: block; font-size: 12px; color: #8ab4f8; margin-bottom: 3px; }
.control-row input[type="range"] { width: 100%; accent-color: #5b8def; }
.control-row .value { float: right; color: #ffd475; font-size: 12px; font-weight: bold; }
.presets { display: flex; gap: 5px; flex-wrap: wrap; margin-top: 4px; }
.preset-btn {
    background: rgba(80,120,200,0.25); border: 1px solid rgba(100,140,255,0.3);
    color: #8ab4f8; padding: 3px 8px; border-radius: 6px; cursor: pointer; font-size: 11px;
}
.preset-btn:hover { background: rgba(80,120,200,0.45); }
#info {
    position: fixed; bottom: 15px; left: 15px; width: 320px;
    background: rgba(20,20,40,0.85); backdrop-filter: blur(10px);
    border-radius: 12px; padding: 18px; z-index: 10;
    border: 1px solid rgba(100,140,255,0.2); font-size: 13px; line-height: 1.5;
}
#info h3 { color: #7eb8ff; margin-bottom: 8px; font-size: 14px; }
.equation { color: #ffd475; font-family: 'Georgia', serif; font-style: italic; text-align: center; margin: 8px 0; font-size: 15px; }
#readout {
    position: fixed; top: 15px; left: 15px; width: 260px;
    background: rgba(20,20,40,0.85); backdrop-filter: blur(10px);
    border-radius: 12px; padding: 18px; z-index: 10;
    border: 1px solid rgba(100,140,255,0.2); font-size: 13px;
}
#readout h3 { color: #7eb8ff; margin-bottom: 8px; font-size: 14px; }
.readout-row { display: flex; justify-content: space-between; margin-bottom: 4px; }
.readout-label { color: #8ab4f8; }
.readout-value { color: #ffd475; font-weight: bold; }
.tir-warning { color: #ff6b6b; font-weight: bold; text-align: center; margin-top: 8px; display: none; }
a.back { position: fixed; top: 15px; left: 50%; transform: translateX(-50%); color: #7eb8ff; text-decoration: none; z-index: 20; font-size: 13px; }
a.back:hover { color: #ffd475; }
</style>
</head>
<body>
<a href="index.html" class="back">&larr; Back to Gallery</a>
<canvas id="c"></canvas>

<div id="readout">
    <h3>Measurements</h3>
    <div class="readout-row"><span class="readout-label">Incident angle (theta_1):</span><span class="readout-value" id="rAngle1">45.0°</span></div>
    <div class="readout-row"><span class="readout-label">Refracted angle (theta_2):</span><span class="readout-value" id="rAngle2">28.1°</span></div>
    <div class="readout-row"><span class="readout-label">Reflected angle:</span><span class="readout-value" id="rAngleR">45.0°</span></div>
    <div class="readout-row"><span class="readout-label">Critical angle:</span><span class="readout-value" id="rCritical">N/A</span></div>
    <div class="tir-warning" id="tirWarning">TOTAL INTERNAL REFLECTION</div>
</div>

<div id="controls">
    <h3>Controls</h3>
    <div class="control-row">
        <label>n1 (upper medium): <span class="value" id="vN1">1.00</span></label>
        <input type="range" id="sN1" min="1.0" max="2.5" step="0.01" value="1.0">
        <div class="presets">
            <button class="preset-btn" onclick="setN1(1.0)">Air</button>
            <button class="preset-btn" onclick="setN1(1.33)">Water</button>
            <button class="preset-btn" onclick="setN1(1.5)">Glass</button>
            <button class="preset-btn" onclick="setN1(2.42)">Diamond</button>
        </div>
    </div>
    <div class="control-row">
        <label>n2 (lower medium): <span class="value" id="vN2">1.50</span></label>
        <input type="range" id="sN2" min="1.0" max="2.5" step="0.01" value="1.5">
        <div class="presets">
            <button class="preset-btn" onclick="setN2(1.0)">Air</button>
            <button class="preset-btn" onclick="setN2(1.33)">Water</button>
            <button class="preset-btn" onclick="setN2(1.5)">Glass</button>
            <button class="preset-btn" onclick="setN2(2.42)">Diamond</button>
        </div>
    </div>
    <p style="font-size:11px; color:#667; margin-top:10px;">Drag on the canvas to change the incident angle</p>
</div>

<div id="info">
    <h3>Snell's Law</h3>
    <div class="equation">n₁ sin(θ₁) = n₂ sin(θ₂)</div>
    <p>When light crosses the boundary between two media with different refractive indices, it bends. The angle of refraction depends on the ratio of the indices.</p>
    <p style="margin-top:6px;">When light travels from a denser to less dense medium (n₁ > n₂), there exists a <strong style="color:#ff6b6b;">critical angle</strong> beyond which all light is reflected — total internal reflection.</p>
</div>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let W, H, midY;

let n1 = 1.0, n2 = 1.5;
let incidentAngle = Math.PI / 4;
let dragging = false;
let animTime = 0;
let paused = false;

function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
    midY = H / 2;
}
resize();
window.addEventListener('resize', resize);

const sN1 = document.getElementById('sN1');
const sN2 = document.getElementById('sN2');
const vN1 = document.getElementById('vN1');
const vN2 = document.getElementById('vN2');

function setN1(v) { n1 = v; sN1.value = v; vN1.textContent = v.toFixed(2); }
function setN2(v) { n2 = v; sN2.value = v; vN2.textContent = v.toFixed(2); }
window.setN1 = setN1;
window.setN2 = setN2;

sN1.addEventListener('input', () => { n1 = parseFloat(sN1.value); vN1.textContent = n1.toFixed(2); });
sN2.addEventListener('input', () => { n2 = parseFloat(sN2.value); vN2.textContent = n2.toFixed(2); });

canvas.addEventListener('mousedown', (e) => { dragging = true; updateAngle(e); });
canvas.addEventListener('mousemove', (e) => { if (dragging) updateAngle(e); });
canvas.addEventListener('mouseup', () => { dragging = false; });
canvas.addEventListener('touchstart', (e) => { dragging = true; updateAngle(e.touches[0]); e.preventDefault(); });
canvas.addEventListener('touchmove', (e) => { if (dragging) updateAngle(e.touches[0]); e.preventDefault(); });
canvas.addEventListener('touchend', () => { dragging = false; });

function updateAngle(e) {
    const cx = W / 2;
    const dx = e.clientX - cx;
    const dy = e.clientY - midY;
    if (dy < 0) {
        incidentAngle = Math.atan2(Math.abs(dx), Math.abs(dy));
        incidentAngle = Math.max(0.01, Math.min(incidentAngle, Math.PI / 2 - 0.01));
    }
}

function getCriticalAngle() {
    if (n1 <= n2) return null;
    const ratio = n2 / n1;
    if (ratio >= 1) return null;
    return Math.asin(ratio);
}

function getRefractedAngle(theta1) {
    const sinTheta2 = (n1 / n2) * Math.sin(theta1);
    if (Math.abs(sinTheta2) > 1) return null;
    return Math.asin(sinTheta2);
}

function fresnel(theta1, theta2) {
    if (theta2 === null) return 1.0;
    const c1 = Math.cos(theta1), c2 = Math.cos(theta2);
    const rs = Math.pow((n1 * c1 - n2 * c2) / (n1 * c1 + n2 * c2), 2);
    const rp = Math.pow((n1 * c2 - n2 * c1) / (n1 * c2 + n2 * c1), 2);
    return (rs + rp) / 2;
}

function drawMedium() {
    const grad1 = ctx.createLinearGradient(0, 0, 0, midY);
    const alpha1 = Math.min(0.4, (n1 - 1) * 0.25 + 0.05);
    grad1.addColorStop(0, `rgba(80,140,255,${alpha1 * 0.3})`);
    grad1.addColorStop(1, `rgba(80,140,255,${alpha1})`);
    ctx.fillStyle = grad1;
    ctx.fillRect(0, 0, W, midY);

    const grad2 = ctx.createLinearGradient(0, midY, 0, H);
    const alpha2 = Math.min(0.4, (n2 - 1) * 0.25 + 0.05);
    grad2.addColorStop(0, `rgba(60,180,140,${alpha2})`);
    grad2.addColorStop(1, `rgba(60,180,140,${alpha2 * 0.3})`);
    ctx.fillStyle = grad2;
    ctx.fillRect(0, midY, W, H - midY);

    ctx.strokeStyle = 'rgba(255,255,255,0.3)';
    ctx.lineWidth = 2;
    ctx.setLineDash([8, 8]);
    ctx.beginPath();
    ctx.moveTo(0, midY);
    ctx.lineTo(W, midY);
    ctx.stroke();
    ctx.setLineDash([]);

    ctx.fillStyle = 'rgba(80,140,255,0.7)';
    ctx.font = '13px Segoe UI';
    ctx.fillText(`n₁ = ${n1.toFixed(2)}`, W / 2 + 50, midY - 15);
    ctx.fillStyle = 'rgba(60,180,140,0.9)';
    ctx.fillText(`n₂ = ${n2.toFixed(2)}`, W / 2 + 50, midY + 25);
}

function drawNormal() {
    ctx.strokeStyle = 'rgba(255,255,255,0.15)';
    ctx.lineWidth = 1;
    ctx.setLineDash([4, 6]);
    ctx.beginPath();
    ctx.moveTo(W / 2, midY - 200);
    ctx.lineTo(W / 2, midY + 200);
    ctx.stroke();
    ctx.setLineDash([]);

    ctx.fillStyle = 'rgba(255,255,255,0.3)';
    ctx.font = '11px Segoe UI';
    ctx.fillText('normal', W / 2 + 5, midY - 190);
}

function drawArc(cx, cy, r, startAngle, endAngle, color, label, labelSide) {
    ctx.strokeStyle = color;
    ctx.lineWidth = 1.5;
    ctx.beginPath();
    ctx.arc(cx, cy, r, startAngle, endAngle, endAngle < startAngle);
    ctx.stroke();

    const midAngle = (startAngle + endAngle) / 2;
    const lr = r + 15;
    const lx = cx + lr * Math.cos(midAngle);
    const ly = cy + lr * Math.sin(midAngle);
    ctx.fillStyle = color;
    ctx.font = '12px Georgia';
    ctx.textAlign = labelSide === 'left' ? 'right' : 'left';
    ctx.fillText(label, lx, ly);
    ctx.textAlign = 'left';
}

function drawRay(x1, y1, x2, y2, color, alpha, width) {
    ctx.strokeStyle = color;
    ctx.globalAlpha = alpha;
    ctx.lineWidth = width;
    ctx.beginPath();
    ctx.moveTo(x1, y1);
    ctx.lineTo(x2, y2);
    ctx.stroke();
    ctx.globalAlpha = 1;

    const glow = ctx.createLinearGradient(x1, y1, x2, y2);
    glow.addColorStop(0, 'rgba(255,255,200,0)');
    glow.addColorStop(0.5, color.replace(')', ',0.15)').replace('rgb', 'rgba'));
    glow.addColorStop(1, 'rgba(255,255,200,0)');
    ctx.strokeStyle = glow;
    ctx.lineWidth = width + 6;
    ctx.globalAlpha = 0.3;
    ctx.beginPath();
    ctx.moveTo(x1, y1);
    ctx.lineTo(x2, y2);
    ctx.stroke();
    ctx.globalAlpha = 1;
}

function drawPhotons(x1, y1, x2, y2, color, speed, alpha) {
    const dx = x2 - x1, dy = y2 - y1;
    const len = Math.sqrt(dx * dx + dy * dy);
    const nx = dx / len, ny = dy / len;
    const count = Math.floor(len / 40);
    for (let i = 0; i < count; i++) {
        const t = ((animTime * speed + i / count) % 1);
        const px = x1 + dx * t;
        const py = y1 + dy * t;
        ctx.beginPath();
        ctx.arc(px, py, 3, 0, Math.PI * 2);
        ctx.fillStyle = color;
        ctx.globalAlpha = alpha * (0.5 + 0.5 * Math.sin(t * Math.PI));
        ctx.fill();
        ctx.globalAlpha = 1;
    }
}

function draw() {
    ctx.clearRect(0, 0, W, H);
    drawMedium();
    drawNormal();

    const cx = W / 2, cy = midY;
    const rayLen = Math.max(W, H) * 0.6;

    const sinI = Math.sin(incidentAngle);
    const cosI = Math.cos(incidentAngle);

    const ix1 = cx - rayLen * sinI;
    const iy1 = cy - rayLen * cosI;
    drawRay(ix1, iy1, cx, cy, 'rgb(255,220,80)', 0.9, 3);
    drawPhotons(ix1, iy1, cx, cy, '#ffd850', 0.3, 0.7);

    const rx = cx + rayLen * sinI;
    const ry = cy - rayLen * cosI;
    const theta2 = getRefractedAngle(incidentAngle);
    const R = fresnel(incidentAngle, theta2);
    const reflAlpha = Math.max(0.15, R);

    drawRay(cx, cy, rx, ry, 'rgb(100,180,255)', reflAlpha, 2);
    drawPhotons(cx, cy, rx, ry, '#64b4ff', 0.3, reflAlpha * 0.7);

    const isTIR = theta2 === null;

    if (!isTIR) {
        const sinR = Math.sin(theta2);
        const cosR = Math.cos(theta2);
        const tx = cx + rayLen * sinR;
        const ty = cy + rayLen * cosR;
        const transAlpha = Math.max(0.15, 1 - R);
        drawRay(cx, cy, tx, ty, 'rgb(80,255,160)', transAlpha, 2.5);
        drawPhotons(cx, cy, tx, ty, '#50ff90', 0.25, transAlpha * 0.7);

        drawArc(cx, cy, 50, -Math.PI / 2, -Math.PI / 2 + incidentAngle, 'rgba(255,220,80,0.7)',
            `θ₁=${(incidentAngle * 180 / Math.PI).toFixed(1)}°`, 'right');
        drawArc(cx, cy, 45, Math.PI / 2 - theta2, Math.PI / 2, 'rgba(80,255,160,0.7)',
            `θ₂=${(theta2 * 180 / Math.PI).toFixed(1)}°`, 'right');
        drawArc(cx, cy, 55, -Math.PI / 2 - incidentAngle, -Math.PI / 2, 'rgba(100,180,255,0.5)',
            `θᵣ=${(incidentAngle * 180 / Math.PI).toFixed(1)}°`, 'left');

        document.getElementById('rAngle2').textContent = (theta2 * 180 / Math.PI).toFixed(1) + '°';
    } else {
        drawArc(cx, cy, 50, -Math.PI / 2, -Math.PI / 2 + incidentAngle, 'rgba(255,220,80,0.7)',
            `θ₁=${(incidentAngle * 180 / Math.PI).toFixed(1)}°`, 'right');
        drawArc(cx, cy, 55, -Math.PI / 2 - incidentAngle, -Math.PI / 2, 'rgba(100,180,255,0.7)',
            `θᵣ=${(incidentAngle * 180 / Math.PI).toFixed(1)}°`, 'left');

        // Evanescent wave hint
        for (let i = 0; i < 30; i++) {
            const ex = cx - 60 + i * 4;
            const depth = 5 + 25 * Math.exp(-i * 0.08);
            const ea = 0.3 * Math.exp(-i * 0.08) * (0.7 + 0.3 * Math.sin(animTime * 5 + i * 0.5));
            ctx.beginPath();
            ctx.arc(ex, cy + depth, 2, 0, Math.PI * 2);
            ctx.fillStyle = `rgba(80,255,160,${ea})`;
            ctx.fill();
        }

        document.getElementById('rAngle2').textContent = 'TIR';
    }

    document.getElementById('rAngle1').textContent = (incidentAngle * 180 / Math.PI).toFixed(1) + '°';
    document.getElementById('rAngleR').textContent = (incidentAngle * 180 / Math.PI).toFixed(1) + '°';

    const critAngle = getCriticalAngle();
    if (critAngle !== null) {
        document.getElementById('rCritical').textContent = (critAngle * 180 / Math.PI).toFixed(1) + '°';
        // Draw critical angle marker
        ctx.strokeStyle = 'rgba(255,100,100,0.4)';
        ctx.lineWidth = 1;
        ctx.setLineDash([3, 5]);
        const csx = cx - 150 * Math.sin(critAngle);
        const csy = cy - 150 * Math.cos(critAngle);
        ctx.beginPath();
        ctx.moveTo(csx, csy);
        ctx.lineTo(cx, cy);
        ctx.stroke();
        ctx.setLineDash([]);
    } else {
        document.getElementById('rCritical').textContent = 'N/A';
    }

    document.getElementById('tirWarning').style.display = isTIR ? 'block' : 'none';

    // Incident ray arrow
    const arrowDist = 0.5;
    const ax = ix1 + (cx - ix1) * arrowDist;
    const ay = iy1 + (cy - iy1) * arrowDist;
    const aDx = sinI, aDy = cosI;
    ctx.fillStyle = 'rgb(255,220,80)';
    ctx.beginPath();
    ctx.moveTo(ax + aDx * 8, ay + aDy * 8);
    ctx.lineTo(ax - aDx * 4 + aDy * 5, ay - aDy * 4 - aDx * 5);
    ctx.lineTo(ax - aDx * 4 - aDy * 5, ay - aDy * 4 + aDx * 5);
    ctx.fill();

    if (!paused) animTime += 0.016;
}

function animate() {
    draw();
    requestAnimationFrame(animate);
}

window.reset = function() {
    n1 = 1.0; n2 = 1.5;
    incidentAngle = Math.PI / 4;
    sN1.value = 1.0; vN1.textContent = '1.00';
    sN2.value = 1.5; vN2.textContent = '1.50';
    animTime = 0;
    paused = false;
};

animate();
</script>
<script src="../assets/js/enhance.js"></script>
</body>
</html>
