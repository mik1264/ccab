<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polarization Explorer - Optical Phenomena</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #0a0e1a;
            color: #e0e0e0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }
        canvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
        }
        .back-link {
            position: fixed;
            top: 15px;
            left: 15px;
            color: #8af;
            text-decoration: none;
            font-size: 14px;
            z-index: 100;
            background: rgba(20,20,40,0.85);
            padding: 6px 14px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }
        .back-link:hover { color: #bdf; }
        #controls {
            position: fixed;
            top: 15px;
            right: 15px;
            background: rgba(20,20,40,0.85);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 16px;
            z-index: 100;
            width: 280px;
            border: 1px solid rgba(100,140,255,0.15);
        }
        #controls h3 {
            color: #8af;
            margin-bottom: 10px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .control-group {
            margin-bottom: 10px;
        }
        .control-group label {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            margin-bottom: 3px;
            color: #aaa;
        }
        .control-group label span { color: #8af; }
        input[type="range"] {
            width: 100%;
            height: 4px;
            -webkit-appearance: none;
            background: rgba(100,140,255,0.2);
            border-radius: 2px;
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #8af;
            cursor: pointer;
        }
        .mode-btn {
            padding: 6px 10px;
            margin: 2px;
            border: 1px solid rgba(100,140,255,0.3);
            background: rgba(100,140,255,0.1);
            color: #8af;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
        }
        .mode-btn.active {
            background: rgba(100,140,255,0.35);
            border-color: #8af;
        }
        #info {
            position: fixed;
            bottom: 15px;
            left: 15px;
            background: rgba(20,20,40,0.85);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 14px 18px;
            z-index: 100;
            max-width: 400px;
            border: 1px solid rgba(100,140,255,0.15);
            font-size: 12px;
            line-height: 1.6;
            color: #bbb;
        }
        #info h4 { color: #8af; margin-bottom: 6px; font-size: 13px; }
        .intensity-bar {
            margin-top: 8px;
            height: 14px;
            background: rgba(255,255,255,0.05);
            border-radius: 7px;
            overflow: hidden;
        }
        .intensity-fill {
            height: 100%;
            border-radius: 7px;
            transition: width 0.15s;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">&#8592; Optical Phenomena</a>
    <canvas id="canvas"></canvas>
    <div id="controls">
        <h3>Polarization Explorer</h3>
        <div style="margin-bottom:10px;">
            <button class="mode-btn active" onclick="setMode('two')">Two Polarizers</button>
            <button class="mode-btn" onclick="setMode('three')">Three Polarizer Paradox</button>
        </div>
        <div class="control-group">
            <label>Analyzer Angle <span id="angleVal">0&#176;</span></label>
            <input type="range" id="angleSlider" min="0" max="180" value="0" step="1">
        </div>
        <div class="control-group" id="midAngleGroup" style="display:none;">
            <label>Middle Polarizer Angle <span id="midAngleVal">45&#176;</span></label>
            <input type="range" id="midAngleSlider" min="0" max="180" value="45" step="1">
        </div>
        <div class="control-group">
            <label>Animation Speed <span id="speedVal">1.0x</span></label>
            <input type="range" id="speedSlider" min="0.1" max="3" value="1" step="0.1">
        </div>
        <div style="margin-top:10px; font-size:11px; color:#888;">
            <div>Output Intensity:</div>
            <div class="intensity-bar"><div class="intensity-fill" id="intensityBar" style="width:50%;background:#8af;"></div></div>
            <div style="margin-top:4px;text-align:right;" id="intensityText">I = 50%</div>
        </div>
    </div>
    <div id="info">
        <h4>Malus's Law</h4>
        <p>When polarized light passes through a polarizer tilted at angle &theta;, the transmitted intensity follows <strong>I = I&#8320; cos&sup2;(&theta;)</strong>.</p>
        <p style="margin-top:6px;">Two crossed polarizers block all light. But adding a <em>third</em> polarizer at 45&deg; between them lets light through &mdash; a beautiful paradox!</p>
    </div>
    <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    let W, H;
    function resize() {
        W = canvas.width = window.innerWidth;
        H = canvas.height = window.innerHeight;
    }
    resize();
    window.addEventListener('resize', resize);

    let mode = 'two';
    let analyzerAngle = 0;
    let midAngle = 45;
    let speed = 1;
    let time = 0;
    let paused = false;

    const angleSlider = document.getElementById('angleSlider');
    const midAngleSlider = document.getElementById('midAngleSlider');
    const speedSlider = document.getElementById('speedSlider');

    angleSlider.oninput = () => {
        analyzerAngle = +angleSlider.value;
        document.getElementById('angleVal').innerHTML = analyzerAngle + '&#176;';
    };
    midAngleSlider.oninput = () => {
        midAngle = +midAngleSlider.value;
        document.getElementById('midAngleVal').innerHTML = midAngle + '&#176;';
    };
    speedSlider.oninput = () => {
        speed = +speedSlider.value;
        document.getElementById('speedVal').textContent = speed.toFixed(1) + 'x';
    };

    function setMode(m) {
        mode = m;
        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
        document.querySelector('.mode-btn[onclick*="' + m + '"]').classList.add('active');
        document.getElementById('midAngleGroup').style.display = m === 'three' ? 'block' : 'none';
    }

    function drawPolarizer(x, angle, label, color) {
        ctx.save();
        ctx.translate(x, H * 0.45);
        ctx.strokeStyle = color;
        ctx.lineWidth = 3;
        ctx.globalAlpha = 0.7;
        ctx.beginPath();
        ctx.rect(-30, -100, 60, 200);
        ctx.stroke();
        ctx.globalAlpha = 0.15;
        ctx.fillStyle = color;
        ctx.fillRect(-30, -100, 60, 200);
        ctx.globalAlpha = 1;
        const rad = angle * Math.PI / 180;
        const len = 80;
        for (let i = -3; i <= 3; i++) {
            ctx.beginPath();
            ctx.moveTo(i * 7 - Math.cos(rad) * len * 0.5, -Math.sin(rad) * len * 0.5);
            ctx.lineTo(i * 7 + Math.cos(rad) * len * 0.5, Math.sin(rad) * len * 0.5);
            ctx.strokeStyle = color;
            ctx.lineWidth = 1.5;
            ctx.stroke();
        }
        ctx.fillStyle = '#fff';
        ctx.font = '11px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText(label, 0, 125);
        ctx.fillStyle = '#8af';
        ctx.fillText(angle + '\u00B0', 0, 140);
        ctx.restore();
    }

    function drawEField(x, endX, angle, intensity, t) {
        if (intensity < 0.005) return;
        const rad = angle * Math.PI / 180;
        const cy = H * 0.45;
        const amp = 40 * Math.sqrt(intensity);
        ctx.save();
        ctx.globalAlpha = Math.min(1, intensity + 0.2);
        ctx.strokeStyle = `hsl(${200 + angle * 0.5}, 80%, ${50 + intensity * 30}%)`;
        ctx.lineWidth = 2;
        ctx.beginPath();
        for (let px = x; px <= endX; px += 2) {
            const phase = (px - x) * 0.04 - t * 3 * speed;
            const wave = Math.sin(phase) * amp;
            const dx = wave * Math.cos(rad + Math.PI / 2);
            const dy = wave * Math.sin(rad + Math.PI / 2);
            if (px === x) ctx.moveTo(px + dx, cy + dy);
            else ctx.lineTo(px + dx, cy + dy);
        }
        ctx.stroke();
        ctx.restore();
    }

    function drawUnpolarized(x, endX, t) {
        const cy = H * 0.45;
        const amp = 35;
        for (let a = 0; a < 180; a += 30) {
            const rad = a * Math.PI / 180;
            ctx.save();
            ctx.globalAlpha = 0.3;
            ctx.strokeStyle = `hsl(${a * 2}, 70%, 60%)`;
            ctx.lineWidth = 1.2;
            ctx.beginPath();
            for (let px = x; px <= endX; px += 3) {
                const phase = (px - x) * 0.04 - t * 3 * speed + a * 0.1;
                const wave = Math.sin(phase) * amp;
                const dx = wave * Math.cos(rad + Math.PI / 2);
                const dy = wave * Math.sin(rad + Math.PI / 2);
                if (px === x) ctx.moveTo(px + dx, cy + dy);
                else ctx.lineTo(px + dx, cy + dy);
            }
            ctx.stroke();
            ctx.restore();
        }
    }

    function drawArrow(x, y, angle, len, color, alpha) {
        const rad = angle * Math.PI / 180;
        ctx.save();
        ctx.globalAlpha = alpha;
        ctx.strokeStyle = color;
        ctx.fillStyle = color;
        ctx.lineWidth = 2;
        const ex = x + Math.cos(rad) * len;
        const ey = y + Math.sin(rad) * len;
        ctx.beginPath();
        ctx.moveTo(x - Math.cos(rad) * len, y - Math.sin(rad) * len);
        ctx.lineTo(ex, ey);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(ex, ey);
        ctx.lineTo(ex - Math.cos(rad - 0.3) * 8, ey - Math.sin(rad - 0.3) * 8);
        ctx.lineTo(ex - Math.cos(rad + 0.3) * 8, ey - Math.sin(rad + 0.3) * 8);
        ctx.fill();
        ctx.restore();
    }

    function drawLightSource(x, y) {
        const grd = ctx.createRadialGradient(x, y, 5, x, y, 50);
        grd.addColorStop(0, 'rgba(255,255,200,0.8)');
        grd.addColorStop(0.5, 'rgba(255,255,150,0.2)');
        grd.addColorStop(1, 'rgba(255,255,100,0)');
        ctx.fillStyle = grd;
        ctx.beginPath();
        ctx.arc(x, y, 50, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = '#ffe';
        ctx.beginPath();
        ctx.arc(x, y, 12, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = '#fff';
        ctx.font = '11px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('Light Source', x, y + 30);
    }

    function drawOutputGlow(x, intensity) {
        if (intensity < 0.01) return;
        const cy = H * 0.45;
        const grd = ctx.createRadialGradient(x, cy, 5, x, cy, 80 * intensity);
        grd.addColorStop(0, `rgba(180,220,255,${intensity * 0.6})`);
        grd.addColorStop(1, 'rgba(180,220,255,0)');
        ctx.fillStyle = grd;
        ctx.beginPath();
        ctx.arc(x, cy, 80 * intensity, 0, Math.PI * 2);
        ctx.fill();
    }

    function computeIntensity() {
        if (mode === 'two') {
            const theta = analyzerAngle * Math.PI / 180;
            return 0.5 * Math.cos(theta) * Math.cos(theta);
        } else {
            const theta1 = midAngle * Math.PI / 180;
            const theta2 = (analyzerAngle - midAngle) * Math.PI / 180;
            return 0.5 * Math.cos(theta1) * Math.cos(theta1) * Math.cos(theta2) * Math.cos(theta2);
        }
    }

    function animate(ts) {
        if (!paused) time = ts * 0.001;
        ctx.clearRect(0, 0, W, H);

        const margin = 120;
        const usableW = W - 2 * margin;

        if (mode === 'two') {
            const p1x = margin + usableW * 0.3;
            const p2x = margin + usableW * 0.65;
            const outX = margin + usableW * 0.9;

            drawLightSource(margin + 30, H * 0.45);
            drawUnpolarized(margin + 55, p1x - 35, time);
            drawPolarizer(p1x, 90, 'Polarizer (V)', '#6cf');
            drawEField(p1x + 35, p2x - 35, 90, 0.5, time);
            drawPolarizer(p2x, 90 + analyzerAngle, 'Analyzer', '#f8a');
            const I = computeIntensity();
            drawEField(p2x + 35, outX, 90 + analyzerAngle, I, time);
            drawOutputGlow(outX + 20, I);
        } else {
            const p1x = margin + usableW * 0.2;
            const pmx = margin + usableW * 0.42;
            const p2x = margin + usableW * 0.64;
            const outX = margin + usableW * 0.88;

            drawLightSource(margin + 20, H * 0.45);
            drawUnpolarized(margin + 45, p1x - 35, time);
            drawPolarizer(p1x, 90, 'Polarizer (V)', '#6cf');
            const I1 = 0.5;
            drawEField(p1x + 35, pmx - 35, 90, I1, time);
            drawPolarizer(pmx, 90 + midAngle, 'Middle', '#af6');
            const I2 = I1 * Math.cos(midAngle * Math.PI / 180) ** 2;
            drawEField(pmx + 35, p2x - 35, 90 + midAngle, I2, time);
            drawPolarizer(p2x, 90 + analyzerAngle, 'Analyzer', '#f8a');
            const theta2 = (analyzerAngle - midAngle) * Math.PI / 180;
            const I3 = I2 * Math.cos(theta2) ** 2;
            drawEField(p2x + 35, outX, 90 + analyzerAngle, I3, time);
            drawOutputGlow(outX + 15, I3);
        }

        const I = computeIntensity();
        const pct = Math.round(I * 100);
        document.getElementById('intensityBar').style.width = pct + '%';
        document.getElementById('intensityBar').style.background = `hsl(${210 + pct * 0.5}, 80%, ${40 + pct * 0.3}%)`;
        document.getElementById('intensityText').textContent = 'I = ' + pct + '%';

        requestAnimationFrame(animate);
    }

    window.reset = function() {
        analyzerAngle = 0;
        midAngle = 45;
        speed = 1;
        mode = 'two';
        angleSlider.value = 0;
        midAngleSlider.value = 45;
        speedSlider.value = 1;
        document.getElementById('angleVal').innerHTML = '0&#176;';
        document.getElementById('midAngleVal').innerHTML = '45&#176;';
        document.getElementById('speedVal').textContent = '1.0x';
        setMode('two');
        time = 0;
    };

    requestAnimationFrame(animate);
    </script>
    <script src="../assets/js/enhance.js"></script>
</body>
</html>
