<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testing Impact on Epidemic</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            width: 90%;
        }
        h1 {
            font-size: 24px;
            margin-bottom: 10px;
            color: #333;
        }
        .description {
            font-size: 14px;
            color: #666;
            margin-bottom: 25px;
            line-height: 1.6;
        }
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }
        .param {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
        }
        label {
            display: block;
            font-size: 13px;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }
        .value {
            font-weight: bold;
            color: #667eea;
        }
        input[type="range"] {
            width: 100%;
        }
        .charts {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .chart-container {
            background: #f8f8f8;
            padding: 15px;
            border-radius: 8px;
        }
        .chart-title {
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        canvas {
            width: 100%;
            height: 200px;
            background: white;
            border-radius: 5px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        .stat-box {
            background: #f5f5f5;
            padding: 12px;
            border-radius: 6px;
            text-align: center;
        }
        .stat-label {
            font-size: 11px;
            color: #666;
            margin-bottom: 5px;
        }
        .stat-value {
            font-size: 20px;
            font-weight: bold;
        }
        .infected-val { color: #ef4444; }
        .peak-val { color: #f59e0b; }
        .total-val { color: #8b5cf6; }
        .duration-val { color: #3b82f6; }
        button {
            width: 100%;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            margin-top: 15px;
        }
        button:hover {
            background: #5568d3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Testing Impact on Epidemic Dynamics</h1>
        <p class="description">
            Compare epidemic outcomes with different testing frequencies. Higher testing rates allow earlier detection,
            behavior modification, and reduced transmission. Adjust testing frequency to see the dramatic impact.
        </p>

        <div class="controls">
            <div class="param">
                <label>Testing Frequency (Low): <span class="value" id="testLowVal">2</span>%/year</label>
                <input type="range" id="testLow" min="0" max="30" value="2">
            </div>
            <div class="param">
                <label>Testing Frequency (High): <span class="value" id="testHighVal">20</span>%/year</label>
                <input type="range" id="testHigh" min="5" max="50" value="20">
            </div>
        </div>

        <div class="charts">
            <div class="chart-container">
                <div class="chart-title">Low Testing Scenario</div>
                <canvas id="chartLow"></canvas>
            </div>
            <div class="chart-container">
                <div class="chart-title">High Testing Scenario</div>
                <canvas id="chartHigh"></canvas>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-box">
                <div class="stat-label">Current Infected (Low)</div>
                <div class="stat-value infected-val" id="infectedLow">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Peak Infected (Low)</div>
                <div class="stat-value peak-val" id="peakLow">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Current Infected (High)</div>
                <div class="stat-value infected-val" id="infectedHigh">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Peak Infected (High)</div>
                <div class="stat-value peak-val" id="peakHigh">0</div>
            </div>
        </div>

        <button id="reset">Reset Comparison</button>
    </div>

    <script>
        const chartLowCanvas = document.getElementById('chartLow');
        const chartHighCanvas = document.getElementById('chartHigh');
        const ctxLow = chartLowCanvas.getContext('2d');
        const ctxHigh = chartHighCanvas.getContext('2d');

        chartLowCanvas.width = chartLowCanvas.offsetWidth;
        chartLowCanvas.height = chartLowCanvas.offsetHeight;
        chartHighCanvas.width = chartHighCanvas.offsetWidth;
        chartHighCanvas.height = chartHighCanvas.offsetHeight;

        let params = {
            testLow: 2,
            testHigh: 20
        };

        const SUSCEPTIBLE = 0;
        const INFECTED_UNKNOWN = 1;
        const INFECTED_KNOWN = 2;
        const RECOVERED = 3;

        class Simulation {
            constructor(testingRate) {
                this.testingRate = testingRate;
                this.population = 500;
                this.agents = [];
                this.history = { susceptible: [], infectedUnknown: [], infectedKnown: [], recovered: [] };
                this.time = 0;
                this.peakInfected = 0;

                // Initialize population
                for (let i = 0; i < this.population; i++) {
                    this.agents.push({
                        state: i < 5 ? INFECTED_UNKNOWN : SUSCEPTIBLE,
                        timeSinceTest: Math.random() * 52,
                        infectionTime: 0
                    });
                }
            }

            step() {
                // Testing
                this.agents.forEach(agent => {
                    agent.timeSinceTest++;
                    const testProbPerWeek = this.testingRate / 100 / 52;
                    if (agent.state === INFECTED_UNKNOWN && Math.random() < testProbPerWeek) {
                        agent.state = INFECTED_KNOWN;
                        agent.timeSinceTest = 0;
                    }
                });

                // Transmission (random mixing)
                const infectedUnknown = this.agents.filter(a => a.state === INFECTED_UNKNOWN).length;
                const susceptible = this.agents.filter(a => a.state === SUSCEPTIBLE);

                susceptible.forEach(agent => {
                    // Contact with unknown infected (normal transmission)
                    const contactRate = 0.5; // contacts per week
                    const transmissionProb = 0.05; // per contact
                    const pInfection = 1 - Math.pow(1 - transmissionProb, contactRate * infectedUnknown / this.population);

                    if (Math.random() < pInfection) {
                        agent.state = INFECTED_UNKNOWN;
                        agent.infectionTime = 0;
                    }
                });

                // Recovery
                this.agents.forEach(agent => {
                    if (agent.state === INFECTED_UNKNOWN || agent.state === INFECTED_KNOWN) {
                        agent.infectionTime++;
                        if (agent.infectionTime > 20) { // 20 weeks
                            if (Math.random() < 0.1) { // 10% recovery per week after
                                agent.state = RECOVERED;
                            }
                        }
                    }
                });

                // Track statistics
                const stats = this.getStats();
                this.history.susceptible.push(stats.susceptible);
                this.history.infectedUnknown.push(stats.infectedUnknown);
                this.history.infectedKnown.push(stats.infectedKnown);
                this.history.recovered.push(stats.recovered);

                const totalInfected = stats.infectedUnknown + stats.infectedKnown;
                if (totalInfected > this.peakInfected) {
                    this.peakInfected = totalInfected;
                }

                this.time++;
            }

            getStats() {
                let susceptible = 0, infectedUnknown = 0, infectedKnown = 0, recovered = 0;
                this.agents.forEach(a => {
                    switch (a.state) {
                        case SUSCEPTIBLE: susceptible++; break;
                        case INFECTED_UNKNOWN: infectedUnknown++; break;
                        case INFECTED_KNOWN: infectedKnown++; break;
                        case RECOVERED: recovered++; break;
                    }
                });
                return { susceptible, infectedUnknown, infectedKnown, recovered };
            }
        }

        let simLow, simHigh;

        function init() {
            simLow = new Simulation(params.testLow);
            simHigh = new Simulation(params.testHigh);
        }

        function drawChart(sim, ctx, canvas) {
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const maxHistory = 200;
            const data = [
                sim.history.susceptible.slice(-maxHistory),
                sim.history.infectedUnknown.slice(-maxHistory),
                sim.history.infectedKnown.slice(-maxHistory),
                sim.history.recovered.slice(-maxHistory)
            ];

            const maxVal = Math.max(...data.flat(), 1);
            const xScale = canvas.width / maxHistory;
            const yScale = canvas.height / maxVal;

            const colors = ['#4ade80', '#ef4444', '#9333ea', '#94a3b8'];

            data.forEach((series, i) => {
                ctx.strokeStyle = colors[i];
                ctx.lineWidth = 2;
                ctx.beginPath();
                series.forEach((val, j) => {
                    const x = j * xScale;
                    const y = canvas.height - val * yScale;
                    if (j === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                });
                ctx.stroke();
            });
        }

        function updateStats() {
            const statsLow = simLow.getStats();
            const statsHigh = simHigh.getStats();

            document.getElementById('infectedLow').textContent =
                statsLow.infectedUnknown + statsLow.infectedKnown;
            document.getElementById('peakLow').textContent = simLow.peakInfected;

            document.getElementById('infectedHigh').textContent =
                statsHigh.infectedUnknown + statsHigh.infectedKnown;
            document.getElementById('peakHigh').textContent = simHigh.peakInfected;
        }

        function animate() {
            simLow.step();
            simHigh.step();

            drawChart(simLow, ctxLow, chartLowCanvas);
            drawChart(simHigh, ctxHigh, chartHighCanvas);

            updateStats();

            requestAnimationFrame(animate);
        }

        // Event listeners
        document.getElementById('testLow').addEventListener('input', (e) => {
            params.testLow = parseInt(e.target.value);
            document.getElementById('testLowVal').textContent = params.testLow;
        });

        document.getElementById('testHigh').addEventListener('input', (e) => {
            params.testHigh = parseInt(e.target.value);
            document.getElementById('testHighVal').textContent = params.testHigh;
        });

        document.getElementById('reset').addEventListener('click', () => {
            init();
        });

        init();
        animate();
    </script>
</body>
</html>
