<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crystal Structures - Chemistry</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); color: #eee; min-height: 100vh; padding: 20px; }
        .back-link { position: fixed; top: 20px; left: 20px; color: #60a5fa; text-decoration: none; font-weight: 600; padding: 8px 16px; background: rgba(0,0,0,0.3); border-radius: 20px; z-index: 100; }
        h1 { text-align: center; margin: 40px 0 10px; font-size: 2.2em; color: #60a5fa; }
        .subtitle { text-align: center; opacity: 0.8; margin-bottom: 20px; }
        .container { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 1fr 300px; gap: 20px; }
        .panel { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 25px; }
        .info-box { background: rgba(96, 165, 250, 0.1); border: 1px solid rgba(96, 165, 250, 0.3); border-radius: 8px; padding: 15px; margin-bottom: 20px; font-size: 0.85em; line-height: 1.6; }
        h3 { color: #60a5fa; margin-bottom: 15px; }
        canvas { width: 100%; border-radius: 8px; background: #0a0a14; cursor: grab; }
        .control-group { margin: 15px 0; }
        .control-group label { display: block; margin-bottom: 5px; }
        .control-group input, .control-group select { width: 100%; }
        .value-display { color: #60a5fa; font-family: monospace; }
        button { width: 100%; padding: 12px; margin: 8px 0; border: none; border-radius: 8px; font-size: 1em; font-weight: 600; cursor: pointer; }
        .btn-primary { background: #60a5fa; color: #1a1a2e; }
        .btn-secondary { background: rgba(255,255,255,0.1); color: #fff; }
        .structure-info { padding: 12px; background: rgba(0,0,0,0.3); border-radius: 8px; margin: 10px 0; font-size: 0.9em; }
        @media (max-width: 900px) { .container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back</a>
    <h1>Crystal Structures</h1>
    <p class="subtitle">Unit cells, lattice formations, and packing efficiency</p>

    <div class="container">
        <div class="panel">
            <canvas id="canvas" width="800" height="500"></canvas>
            <p style="text-align: center; font-size: 0.85em; margin-top: 10px; opacity: 0.7;">
                Click and drag to rotate the crystal
            </p>
        </div>

        <div class="panel">
            <div class="info-box">
                <strong>Crystal Lattices:</strong>
                Atoms arrange in repeating 3D patterns called unit cells.
                Different structures have different packing efficiencies
                and physical properties.
            </div>

            <div class="control-group">
                <label>Crystal Structure:</label>
                <select id="structureSelect" onchange="updateStructure()">
                    <option value="sc">Simple Cubic (SC)</option>
                    <option value="bcc">Body-Centered Cubic (BCC)</option>
                    <option value="fcc" selected>Face-Centered Cubic (FCC)</option>
                    <option value="hcp">Hexagonal Close-Packed (HCP)</option>
                    <option value="diamond">Diamond Cubic</option>
                    <option value="nacl">NaCl (Rock Salt)</option>
                </select>
            </div>

            <div class="structure-info" id="structureInfo">
                <strong>Face-Centered Cubic</strong><br>
                Atoms at corners and face centers<br>
                Examples: Cu, Al, Au, Ag
            </div>

            <div class="control-group">
                <label>Unit Cells: <span class="value-display" id="cellVal">1</span></label>
                <input type="range" id="cellSlider" min="1" max="3" value="1" oninput="updateParams()">
            </div>

            <div class="control-group">
                <label>Atom Size: <span class="value-display" id="sizeVal">100%</span></label>
                <input type="range" id="sizeSlider" min="50" max="150" value="100" oninput="updateParams()">
            </div>

            <div class="control-group">
                <label>Rotation Speed: <span class="value-display" id="speedVal">Medium</span></label>
                <input type="range" id="speedSlider" min="0" max="10" value="3" oninput="updateParams()">
            </div>

            <button class="btn-primary" onclick="toggleBonds()">Toggle Bonds</button>
            <button class="btn-secondary" onclick="toggleUnitCell()">Toggle Unit Cell</button>
            <button class="btn-secondary" onclick="resetView()">Reset View</button>

            <h3 style="margin-top: 15px;">Crystal Properties</h3>
            <div style="font-size: 0.9em;">
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Atoms per cell:</span><span class="value-display" id="atomsVal">4</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Coordination #:</span><span class="value-display" id="coordVal">12</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Packing Efficiency:</span><span class="value-display" id="packVal">74%</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Lattice Parameter:</span><span class="value-display" id="latticeVal">a</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        const structures = {
            sc: {
                name: 'Simple Cubic',
                info: 'Atoms at corners only<br>Examples: Po (Polonium)',
                atoms: 1, coord: 6, packing: 52,
                positions: [[0,0,0], [1,0,0], [0,1,0], [0,0,1], [1,1,0], [1,0,1], [0,1,1], [1,1,1]],
                colors: ['#60a5fa']
            },
            bcc: {
                name: 'Body-Centered Cubic',
                info: 'Atoms at corners + center<br>Examples: Fe, Cr, W',
                atoms: 2, coord: 8, packing: 68,
                positions: [[0,0,0], [1,0,0], [0,1,0], [0,0,1], [1,1,0], [1,0,1], [0,1,1], [1,1,1], [0.5,0.5,0.5]],
                colors: ['#60a5fa', '#f87171']
            },
            fcc: {
                name: 'Face-Centered Cubic',
                info: 'Atoms at corners + face centers<br>Examples: Cu, Al, Au, Ag',
                atoms: 4, coord: 12, packing: 74,
                positions: [
                    [0,0,0], [1,0,0], [0,1,0], [0,0,1], [1,1,0], [1,0,1], [0,1,1], [1,1,1],
                    [0.5,0.5,0], [0.5,0,0.5], [0,0.5,0.5], [1,0.5,0.5], [0.5,1,0.5], [0.5,0.5,1]
                ],
                colors: ['#60a5fa', '#4ade80']
            },
            hcp: {
                name: 'Hexagonal Close-Packed',
                info: 'ABAB stacking pattern<br>Examples: Mg, Ti, Zn',
                atoms: 6, coord: 12, packing: 74,
                positions: [
                    [0,0,0], [1,0,0], [0.5,0.866,0], [0,0,1], [1,0,1], [0.5,0.866,1],
                    [0.5,0.289,0.5], [0,0.577,0.5]
                ],
                colors: ['#60a5fa', '#facc15']
            },
            diamond: {
                name: 'Diamond Cubic',
                info: 'FCC + 4 internal atoms<br>Examples: C (diamond), Si, Ge',
                atoms: 8, coord: 4, packing: 34,
                positions: [
                    [0,0,0], [1,0,0], [0,1,0], [0,0,1], [1,1,0], [1,0,1], [0,1,1], [1,1,1],
                    [0.5,0.5,0], [0.5,0,0.5], [0,0.5,0.5], [1,0.5,0.5], [0.5,1,0.5], [0.5,0.5,1],
                    [0.25,0.25,0.25], [0.75,0.75,0.25], [0.75,0.25,0.75], [0.25,0.75,0.75]
                ],
                colors: ['#60a5fa', '#4ade80', '#a78bfa']
            },
            nacl: {
                name: 'Rock Salt (NaCl)',
                info: 'Interpenetrating FCC lattices<br>Examples: NaCl, MgO, CaO',
                atoms: 8, coord: 6, packing: 52,
                positions: [
                    // Na+ (FCC)
                    [0,0,0], [1,0,0], [0,1,0], [0,0,1], [1,1,0], [1,0,1], [0,1,1], [1,1,1],
                    [0.5,0.5,0], [0.5,0,0.5], [0,0.5,0.5], [1,0.5,0.5], [0.5,1,0.5], [0.5,0.5,1],
                    // Cl- (offset FCC)
                    [0.5,0,0], [0,0.5,0], [0,0,0.5], [0.5,0.5,0.5], [1,0.5,0], [0.5,1,0],
                    [1,0,0.5], [0,1,0.5], [0.5,0,1], [0,0.5,1], [1,1,0.5], [1,0.5,1], [0.5,1,1]
                ],
                colors: ['#60a5fa', '#f87171'], // Na+ blue, Cl- red
                ionTypes: [0,0,0,0,0,0,0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,1,1,1,1,1]
            }
        };

        let structure = 'fcc';
        let rotX = 0.5, rotY = 0.5;
        let autoRotSpeed = 3;
        let atomScale = 1;
        let showBonds = false;
        let showUnitCell = true;
        let unitCells = 1;
        let dragging = false;
        let lastX, lastY;

        function updateStructure() {
            structure = document.getElementById('structureSelect').value;
            const s = structures[structure];

            document.getElementById('structureInfo').innerHTML =
                `<strong>${s.name}</strong><br>${s.info}`;
            document.getElementById('atomsVal').textContent = s.atoms;
            document.getElementById('coordVal').textContent = s.coord;
            document.getElementById('packVal').textContent = s.packing + '%';
            document.getElementById('latticeVal').textContent = structure === 'hcp' ? 'a, c' : 'a';
        }

        function updateParams() {
            unitCells = parseInt(document.getElementById('cellSlider').value);
            atomScale = parseInt(document.getElementById('sizeSlider').value) / 100;
            autoRotSpeed = parseInt(document.getElementById('speedSlider').value);

            document.getElementById('cellVal').textContent = unitCells + '×' + unitCells + '×' + unitCells;
            document.getElementById('sizeVal').textContent = Math.round(atomScale * 100) + '%';
            const speeds = ['None', 'Very Slow', 'Slow', 'Medium', 'Medium', 'Medium', 'Fast', 'Fast', 'Very Fast', 'Very Fast', 'Maximum'];
            document.getElementById('speedVal').textContent = speeds[autoRotSpeed];
        }

        function toggleBonds() {
            showBonds = !showBonds;
        }

        function toggleUnitCell() {
            showUnitCell = !showUnitCell;
        }

        function resetView() {
            rotX = 0.5;
            rotY = 0.5;
        }

        function project(x, y, z) {
            // Rotate around Y axis
            const cosY = Math.cos(rotY);
            const sinY = Math.sin(rotY);
            let x1 = x * cosY - z * sinY;
            let z1 = x * sinY + z * cosY;

            // Rotate around X axis
            const cosX = Math.cos(rotX);
            const sinX = Math.sin(rotX);
            let y1 = y * cosX - z1 * sinX;
            let z2 = y * sinX + z1 * cosX;

            // Perspective
            const scale = 150;
            const perspective = 5;
            const factor = perspective / (perspective + z2);

            return {
                x: canvas.width / 2 + x1 * scale * factor,
                y: canvas.height / 2 + y1 * scale * factor,
                z: z2,
                scale: factor
            };
        }

        function draw() {
            ctx.fillStyle = '#0a0a14';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const s = structures[structure];
            const atoms = [];
            const bonds = [];

            // Generate atoms for all unit cells
            for (let cx = 0; cx < unitCells; cx++) {
                for (let cy = 0; cy < unitCells; cy++) {
                    for (let cz = 0; cz < unitCells; cz++) {
                        const offset = unitCells / 2 - 0.5;
                        for (let i = 0; i < s.positions.length; i++) {
                            const p = s.positions[i];
                            const colorIdx = s.ionTypes ? s.ionTypes[i] : (p[0] + p[1] + p[2] > 1.5 ? 1 : 0);

                            atoms.push({
                                x: p[0] + cx - offset,
                                y: p[1] + cy - offset,
                                z: p[2] + cz - offset,
                                color: s.colors[colorIdx % s.colors.length]
                            });
                        }
                    }
                }
            }

            // Sort atoms by z for proper rendering
            const projectedAtoms = atoms.map(a => ({
                ...a,
                proj: project(a.x, a.y, a.z)
            })).sort((a, b) => a.proj.z - b.proj.z);

            // Draw unit cell outline
            if (showUnitCell) {
                ctx.strokeStyle = 'rgba(96, 165, 250, 0.3)';
                ctx.lineWidth = 1;

                for (let cx = 0; cx < unitCells; cx++) {
                    for (let cy = 0; cy < unitCells; cy++) {
                        for (let cz = 0; cz < unitCells; cz++) {
                            const offset = unitCells / 2 - 0.5;
                            const corners = [
                                [cx - offset, cy - offset, cz - offset],
                                [cx + 1 - offset, cy - offset, cz - offset],
                                [cx + 1 - offset, cy + 1 - offset, cz - offset],
                                [cx - offset, cy + 1 - offset, cz - offset],
                                [cx - offset, cy - offset, cz + 1 - offset],
                                [cx + 1 - offset, cy - offset, cz + 1 - offset],
                                [cx + 1 - offset, cy + 1 - offset, cz + 1 - offset],
                                [cx - offset, cy + 1 - offset, cz + 1 - offset]
                            ];

                            const edges = [
                                [0,1], [1,2], [2,3], [3,0],
                                [4,5], [5,6], [6,7], [7,4],
                                [0,4], [1,5], [2,6], [3,7]
                            ];

                            for (const [i, j] of edges) {
                                const p1 = project(...corners[i]);
                                const p2 = project(...corners[j]);
                                ctx.beginPath();
                                ctx.moveTo(p1.x, p1.y);
                                ctx.lineTo(p2.x, p2.y);
                                ctx.stroke();
                            }
                        }
                    }
                }
            }

            // Draw bonds
            if (showBonds) {
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
                ctx.lineWidth = 2;

                for (let i = 0; i < projectedAtoms.length; i++) {
                    for (let j = i + 1; j < projectedAtoms.length; j++) {
                        const a1 = projectedAtoms[i];
                        const a2 = projectedAtoms[j];
                        const dx = a1.x - a2.x;
                        const dy = a1.y - a2.y;
                        const dz = a1.z - a2.z;
                        const dist = Math.sqrt(dx*dx + dy*dy + dz*dz);

                        if (dist < 0.8) {
                            ctx.beginPath();
                            ctx.moveTo(a1.proj.x, a1.proj.y);
                            ctx.lineTo(a2.proj.x, a2.proj.y);
                            ctx.stroke();
                        }
                    }
                }
            }

            // Draw atoms
            for (const atom of projectedAtoms) {
                const radius = 20 * atomScale * atom.proj.scale;

                // Glow
                const gradient = ctx.createRadialGradient(
                    atom.proj.x, atom.proj.y, 0,
                    atom.proj.x, atom.proj.y, radius * 1.5
                );
                gradient.addColorStop(0, atom.color + 'cc');
                gradient.addColorStop(0.5, atom.color + '40');
                gradient.addColorStop(1, 'transparent');

                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(atom.proj.x, atom.proj.y, radius * 1.5, 0, Math.PI * 2);
                ctx.fill();

                // Atom
                ctx.fillStyle = atom.color;
                ctx.beginPath();
                ctx.arc(atom.proj.x, atom.proj.y, radius, 0, Math.PI * 2);
                ctx.fill();

                // Highlight
                ctx.fillStyle = 'rgba(255,255,255,0.3)';
                ctx.beginPath();
                ctx.arc(atom.proj.x - radius * 0.3, atom.proj.y - radius * 0.3, radius * 0.3, 0, Math.PI * 2);
                ctx.fill();
            }

            // Info
            ctx.fillStyle = '#60a5fa';
            ctx.font = '14px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText(structures[structure].name + ' Structure', 15, 25);
        }

        // Mouse interaction
        canvas.addEventListener('mousedown', (e) => {
            dragging = true;
            lastX = e.clientX;
            lastY = e.clientY;
            canvas.style.cursor = 'grabbing';
        });

        canvas.addEventListener('mousemove', (e) => {
            if (!dragging) return;
            const dx = e.clientX - lastX;
            const dy = e.clientY - lastY;
            rotY += dx * 0.01;
            rotX += dy * 0.01;
            lastX = e.clientX;
            lastY = e.clientY;
        });

        canvas.addEventListener('mouseup', () => {
            dragging = false;
            canvas.style.cursor = 'grab';
        });

        canvas.addEventListener('mouseleave', () => {
            dragging = false;
            canvas.style.cursor = 'grab';
        });

        function animate() {
            if (!dragging && autoRotSpeed > 0) {
                rotY += autoRotSpeed * 0.002;
            }
            draw();
            requestAnimationFrame(animate);
        }

        updateStructure();
        updateParams();
        animate();
    </script>
</body>
</html>
