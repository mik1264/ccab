<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enzyme Kinetics | Chemistry</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
            color: #e0e0e0;
            min-height: 100vh;
            overflow: hidden;
        }
        #canvas { display: block; }
        .controls {
            position: fixed;
            top: 20px; right: 20px;
            background: rgba(0,0,0,0.85);
            padding: 20px; border-radius: 15px;
            min-width: 280px;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        h1 { color: #10b981; font-size: 1.3em; margin-bottom: 15px; }
        .control-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; color: #aaa; font-size: 0.9em; }
        input[type="range"], select { width: 100%; }
        .value { float: right; color: #10b981; }
        button {
            width: 100%; padding: 10px; margin: 5px 0;
            border: none; border-radius: 8px;
            background: #10b981; color: white;
            font-weight: bold; cursor: pointer;
        }
        button:hover { background: #34d399; }
        .stats { margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); }
        .stat-row { display: flex; justify-content: space-between; padding: 5px 0; font-size: 0.9em; }
        .stat-label { color: #888; }
        .stat-value { color: #10b981; font-weight: bold; }
        .info { font-size: 0.8em; color: #666; margin-top: 15px; line-height: 1.5; }
        a.back-link {
            position: fixed; top: 20px; left: 20px;
            color: #10b981; text-decoration: none;
            background: rgba(0,0,0,0.8); padding: 10px 20px;
            border-radius: 25px; font-size: 0.9em;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <a href="index.html" class="back-link">← Back to Chemistry</a>

    <div class="controls">
        <h1>Enzyme Kinetics</h1>
        <p style="font-size:0.85em; color:#888; margin-bottom:15px;">Michaelis-Menten model</p>

        <div class="control-group">
            <label>Substrate [S]: <span class="value" id="substrateValue">50</span></label>
            <input type="range" id="substrate" min="10" max="100" step="5" value="50">
        </div>

        <div class="control-group">
            <label>Enzyme [E]: <span class="value" id="enzymeValue">10</span></label>
            <input type="range" id="enzyme" min="2" max="20" step="1" value="10">
        </div>

        <div class="control-group">
            <label>Binding Rate (k₁): <span class="value" id="k1Value">0.1</span></label>
            <input type="range" id="k1" min="0.01" max="0.3" step="0.01" value="0.1">
        </div>

        <div class="control-group">
            <label>Unbinding Rate (k₋₁): <span class="value" id="k1rValue">0.05</span></label>
            <input type="range" id="k1r" min="0.01" max="0.2" step="0.01" value="0.05">
        </div>

        <div class="control-group">
            <label>Catalytic Rate (k₂): <span class="value" id="k2Value">0.08</span></label>
            <input type="range" id="k2" min="0.01" max="0.2" step="0.01" value="0.08">
        </div>

        <button id="runBtn">Start Reaction</button>
        <button id="resetBtn" style="background:#444;color:#fff">Reset</button>

        <div class="stats">
            <div class="stat-row">
                <span class="stat-label">Substrate [S]</span>
                <span class="stat-value" id="subCount">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Complex [ES]</span>
                <span class="stat-value" id="esCount">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Product [P]</span>
                <span class="stat-value" id="prodCount">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Reaction Rate (v)</span>
                <span class="stat-value" id="rate">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Kₘ</span>
                <span class="stat-value" id="km">0</span>
            </div>
        </div>

        <div class="info">
            <strong>E + S ⇌ ES → E + P</strong><br>
            <strong>Kₘ:</strong> (k₋₁ + k₂) / k₁
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            initSimulation();
        }
        resize();
        window.onresize = resize;

        let substrates = [];
        let enzymes = [];
        let products = [];
        let initSubstrate = 50;
        let initEnzyme = 10;
        let k1 = 0.1;
        let k1r = 0.05;
        let k2 = 0.08;
        let running = false;
        let timeStep = 0;
        let productHistory = [];

        function initSimulation() {
            substrates = [];
            enzymes = [];
            products = [];
            productHistory = [];
            timeStep = 0;

            const w = canvas.width - 400;
            const h = canvas.height - 200;

            for (let i = 0; i < initSubstrate; i++) {
                substrates.push(createMolecule('S', w, h));
            }

            for (let i = 0; i < initEnzyme; i++) {
                enzymes.push(createEnzyme(w, h));
            }

            updateStats();
        }

        function createMolecule(type, w, h) {
            return {
                x: 80 + Math.random() * (w - 60),
                y: 80 + Math.random() * (h - 60),
                vx: (Math.random() - 0.5) * 3,
                vy: (Math.random() - 0.5) * 3,
                type
            };
        }

        function createEnzyme(w, h) {
            return {
                x: 80 + Math.random() * (w - 60),
                y: 80 + Math.random() * (h - 60),
                vx: (Math.random() - 0.5) * 1,
                vy: (Math.random() - 0.5) * 1,
                bound: null, // Bound substrate
                catalyzing: false,
                catalyzeTimer: 0
            };
        }

        function update() {
            if (!running) return;

            const w = canvas.width - 400;
            const h = canvas.height - 200;

            // Move substrates
            for (const s of substrates) {
                s.x += s.vx;
                s.y += s.vy;

                if (s.x < 60) { s.x = 60; s.vx = -s.vx; }
                if (s.x > 40 + w) { s.x = 40 + w; s.vx = -s.vx; }
                if (s.y < 60) { s.y = 60; s.vy = -s.vy; }
                if (s.y > 40 + h) { s.y = 40 + h; s.vy = -s.vy; }
            }

            // Move products
            for (const p of products) {
                p.x += p.vx;
                p.y += p.vy;

                if (p.x < 60) { p.x = 60; p.vx = -p.vx; }
                if (p.x > 40 + w) { p.x = 40 + w; p.vx = -p.vx; }
                if (p.y < 60) { p.y = 60; p.vy = -p.vy; }
                if (p.y > 40 + h) { p.y = 40 + h; p.vy = -p.vy; }
            }

            // Move enzymes
            for (const e of enzymes) {
                e.x += e.vx;
                e.y += e.vy;

                e.vx += (Math.random() - 0.5) * 0.2;
                e.vy += (Math.random() - 0.5) * 0.2;
                e.vx *= 0.98;
                e.vy *= 0.98;

                if (e.x < 70) { e.x = 70; e.vx = -e.vx; }
                if (e.x > 30 + w) { e.x = 30 + w; e.vx = -e.vx; }
                if (e.y < 70) { e.y = 70; e.vy = -e.vy; }
                if (e.y > 30 + h) { e.y = 30 + h; e.vy = -e.vy; }

                if (e.bound) {
                    if (e.catalyzing) {
                        e.catalyzeTimer++;
                        if (e.catalyzeTimer > 20) {
                            // Release product
                            products.push({
                                x: e.x + 20,
                                y: e.y,
                                vx: 2 + Math.random(),
                                vy: (Math.random() - 0.5) * 2,
                                type: 'P'
                            });
                            e.bound = null;
                            e.catalyzing = false;
                            e.catalyzeTimer = 0;
                        }
                    } else {
                        // Check for unbinding or catalysis
                        if (Math.random() < k1r) {
                            // Unbind
                            substrates.push({
                                x: e.x + 15,
                                y: e.y,
                                vx: (Math.random() - 0.5) * 3,
                                vy: (Math.random() - 0.5) * 3,
                                type: 'S'
                            });
                            e.bound = null;
                        } else if (Math.random() < k2) {
                            // Start catalysis
                            e.catalyzing = true;
                            e.catalyzeTimer = 0;
                        }
                    }
                } else {
                    // Try to bind substrate
                    for (let i = substrates.length - 1; i >= 0; i--) {
                        const s = substrates[i];
                        const dx = s.x - e.x;
                        const dy = s.y - e.y;
                        const dist = Math.sqrt(dx * dx + dy * dy);

                        if (dist < 25 && Math.random() < k1) {
                            e.bound = s;
                            substrates.splice(i, 1);
                            break;
                        }
                    }
                }
            }

            timeStep++;
            updateStats();
        }

        function updateStats() {
            const esCount = enzymes.filter(e => e.bound).length;

            document.getElementById('subCount').textContent = substrates.length;
            document.getElementById('esCount').textContent = esCount;
            document.getElementById('prodCount').textContent = products.length;

            const km = (k1r + k2) / k1;
            document.getElementById('km').textContent = km.toFixed(2);

            // Reaction rate (products formed per time)
            productHistory.push(products.length);
            if (productHistory.length > 50) productHistory.shift();

            let rate = 0;
            if (productHistory.length > 1) {
                rate = (productHistory[productHistory.length - 1] - productHistory[0]) / productHistory.length;
            }
            document.getElementById('rate').textContent = (rate * 10).toFixed(2);
        }

        function drawHistory() {
            const graphX = 50;
            const graphY = canvas.height - 180;
            const graphW = canvas.width - 450;
            const graphH = 150;

            ctx.fillStyle = 'rgba(0,0,0,0.4)';
            ctx.fillRect(graphX - 10, graphY - 30, graphW + 20, graphH + 50);

            ctx.fillStyle = '#fff';
            ctx.font = '14px sans-serif';
            ctx.fillText('Reaction Progress', graphX, graphY - 10);

            if (productHistory.length < 2) return;

            const maxProd = Math.max(...productHistory, initSubstrate);

            ctx.beginPath();
            ctx.strokeStyle = '#a855f7';
            ctx.lineWidth = 2;
            for (let i = 0; i < productHistory.length; i++) {
                const x = graphX + (i / (productHistory.length - 1)) * graphW;
                const y = graphY + graphH - (productHistory[i] / maxProd) * graphH;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();

            // Theoretical Vmax line
            const vmax = initEnzyme * k2;
            ctx.setLineDash([5, 5]);
            ctx.strokeStyle = '#666';
            ctx.beginPath();
            ctx.moveTo(graphX, graphY + graphH * 0.2);
            ctx.lineTo(graphX + graphW, graphY + graphH * 0.2);
            ctx.stroke();
            ctx.setLineDash([]);
            ctx.fillStyle = '#666';
            ctx.font = '10px sans-serif';
            ctx.fillText('Vmax', graphX + graphW + 5, graphY + graphH * 0.2 + 4);
        }

        function draw() {
            ctx.fillStyle = '#0f172a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            update();

            const w = canvas.width - 400;
            const h = canvas.height - 200;

            // Draw container
            ctx.strokeStyle = '#10b981';
            ctx.lineWidth = 2;
            ctx.strokeRect(50, 50, w, h);

            // Draw enzymes
            for (const e of enzymes) {
                // Enzyme body (Y-shape)
                ctx.fillStyle = e.catalyzing ? '#fbbf24' : (e.bound ? '#22c55e' : '#10b981');
                ctx.beginPath();
                ctx.arc(e.x, e.y, 15, 0, Math.PI * 2);
                ctx.fill();

                // Active site
                ctx.beginPath();
                ctx.arc(e.x + 10, e.y, 8, 0, Math.PI * 2);
                ctx.fillStyle = e.bound ? '#fbbf24' : '#0f172a';
                ctx.fill();
                ctx.strokeStyle = e.catalyzing ? '#fbbf24' : '#10b981';
                ctx.lineWidth = 2;
                ctx.stroke();

                // Bound substrate
                if (e.bound) {
                    ctx.beginPath();
                    ctx.arc(e.x + 10, e.y, 5, 0, Math.PI * 2);
                    ctx.fillStyle = e.catalyzing ? '#a855f7' : '#ef4444';
                    ctx.fill();
                }

                // Label
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 10px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('E', e.x - 2, e.y + 4);
            }

            // Draw substrates
            for (const s of substrates) {
                ctx.beginPath();
                ctx.arc(s.x, s.y, 6, 0, Math.PI * 2);
                ctx.fillStyle = '#ef4444';
                ctx.fill();
            }

            // Draw products
            for (const p of products) {
                ctx.beginPath();
                ctx.moveTo(p.x, p.y - 6);
                ctx.lineTo(p.x + 6, p.y + 3);
                ctx.lineTo(p.x - 6, p.y + 3);
                ctx.closePath();
                ctx.fillStyle = '#a855f7';
                ctx.fill();
            }

            drawHistory();

            // Legend
            ctx.fillStyle = '#ef4444';
            ctx.beginPath();
            ctx.arc(canvas.width - 330, canvas.height - 100, 6, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#a855f7';
            ctx.beginPath();
            ctx.moveTo(canvas.width - 330, canvas.height - 82);
            ctx.lineTo(canvas.width - 324, canvas.height - 73);
            ctx.lineTo(canvas.width - 336, canvas.height - 73);
            ctx.fill();
            ctx.fillStyle = '#10b981';
            ctx.beginPath();
            ctx.arc(canvas.width - 330, canvas.height - 60, 10, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = '#888';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('Substrate (S)', canvas.width - 315, canvas.height - 96);
            ctx.fillText('Product (P)', canvas.width - 315, canvas.height - 73);
            ctx.fillText('Enzyme (E)', canvas.width - 315, canvas.height - 56);

            // Title
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 18px sans-serif';
            ctx.fillText('Enzyme Kinetics: E + S ⇌ ES → E + P', 50, 30);

            requestAnimationFrame(draw);
        }

        // Event listeners
        document.getElementById('substrate').oninput = (e) => {
            initSubstrate = parseInt(e.target.value);
            document.getElementById('substrateValue').textContent = initSubstrate;
        };

        document.getElementById('enzyme').oninput = (e) => {
            initEnzyme = parseInt(e.target.value);
            document.getElementById('enzymeValue').textContent = initEnzyme;
        };

        document.getElementById('k1').oninput = (e) => {
            k1 = parseFloat(e.target.value);
            document.getElementById('k1Value').textContent = k1.toFixed(2);
        };

        document.getElementById('k1r').oninput = (e) => {
            k1r = parseFloat(e.target.value);
            document.getElementById('k1rValue').textContent = k1r.toFixed(2);
        };

        document.getElementById('k2').oninput = (e) => {
            k2 = parseFloat(e.target.value);
            document.getElementById('k2Value').textContent = k2.toFixed(2);
        };

        document.getElementById('runBtn').onclick = () => {
            running = !running;
            document.getElementById('runBtn').textContent = running ? 'Pause' : 'Start Reaction';
        };

        document.getElementById('resetBtn').onclick = initSimulation;

        // Initialize
        initSimulation();
        draw();
    </script>
</body>
</html>
