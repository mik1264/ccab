<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orbital Viewer - Chemistry</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); color: #eee; min-height: 100vh; padding: 20px; }
        .back-link { position: fixed; top: 20px; left: 20px; color: #60a5fa; text-decoration: none; font-weight: 600; padding: 8px 16px; background: rgba(0,0,0,0.3); border-radius: 20px; z-index: 100; }
        h1 { text-align: center; margin: 40px 0 10px; font-size: 2.2em; color: #60a5fa; }
        .subtitle { text-align: center; opacity: 0.8; margin-bottom: 20px; }
        .container { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 1fr 300px; gap: 20px; }
        .panel { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 25px; }
        .info-box { background: rgba(96, 165, 250, 0.1); border: 1px solid rgba(96, 165, 250, 0.3); border-radius: 8px; padding: 15px; margin-bottom: 20px; font-size: 0.85em; line-height: 1.6; }
        h3 { color: #60a5fa; margin-bottom: 15px; }
        canvas { width: 100%; border-radius: 8px; background: #050510; cursor: grab; }
        .control-group { margin: 15px 0; }
        .control-group label { display: block; margin-bottom: 5px; }
        .control-group input, .control-group select { width: 100%; }
        .value-display { color: #60a5fa; font-family: monospace; }
        button { width: 100%; padding: 12px; margin: 8px 0; border: none; border-radius: 8px; font-size: 1em; font-weight: 600; cursor: pointer; }
        .btn-primary { background: #60a5fa; color: #1a1a2e; }
        .btn-secondary { background: rgba(255,255,255,0.1); color: #fff; }
        .orbital-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin: 15px 0; }
        .orbital-btn { padding: 10px 5px; text-align: center; background: rgba(255,255,255,0.1); border: none; border-radius: 8px; color: #fff; cursor: pointer; font-family: monospace; transition: all 0.2s; }
        .orbital-btn:hover { background: rgba(96, 165, 250, 0.3); }
        .orbital-btn.active { background: #60a5fa; color: #1a1a2e; }
        .quantum-numbers { font-family: monospace; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 8px; margin: 10px 0; }
        @media (max-width: 900px) { .container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back</a>
    <h1>Orbital Viewer</h1>
    <p class="subtitle">Atomic orbitals and electron probability clouds</p>

    <div class="container">
        <div class="panel">
            <canvas id="canvas" width="800" height="500"></canvas>
            <p style="text-align: center; font-size: 0.85em; margin-top: 10px; opacity: 0.7;">
                Click and drag to rotate
            </p>
        </div>

        <div class="panel">
            <div class="info-box">
                <strong>Atomic Orbitals:</strong>
                Regions where electrons are likely to be found.
                Shape determined by quantum numbers (n, l, m).
                Colors represent wave function phases (+/-).
            </div>

            <h3>Select Orbital</h3>
            <div class="orbital-grid" id="orbitalGrid">
                <button class="orbital-btn" data-orbital="1s">1s</button>
                <button class="orbital-btn" data-orbital="2s">2s</button>
                <button class="orbital-btn active" data-orbital="2p">2p</button>
                <button class="orbital-btn" data-orbital="3s">3s</button>
                <button class="orbital-btn" data-orbital="3p">3p</button>
                <button class="orbital-btn" data-orbital="3d">3d</button>
                <button class="orbital-btn" data-orbital="4s">4s</button>
                <button class="orbital-btn" data-orbital="4f">4f</button>
            </div>

            <div class="quantum-numbers" id="quantumNumbers">
                n = 2, l = 1, m = 0
            </div>

            <div class="control-group">
                <label>Orbital Subtype:</label>
                <select id="subtypeSelect" onchange="updateOrbital()">
                    <option value="pz">pz</option>
                    <option value="px">px</option>
                    <option value="py">py</option>
                </select>
            </div>

            <div class="control-group">
                <label>Point Density: <span class="value-display" id="densityVal">Medium</span></label>
                <input type="range" id="densitySlider" min="500" max="5000" value="2000" oninput="updateParams()">
            </div>

            <div class="control-group">
                <label>Probability Cutoff: <span class="value-display" id="cutoffVal">10%</span></label>
                <input type="range" id="cutoffSlider" min="1" max="50" value="10" oninput="updateParams()">
            </div>

            <button class="btn-primary" onclick="toggleNucleus()">Toggle Nucleus</button>
            <button class="btn-secondary" onclick="toggleAxes()">Toggle Axes</button>
            <button class="btn-secondary" onclick="resetView()">Reset View</button>

            <h3 style="margin-top: 15px;">Orbital Properties</h3>
            <div style="font-size: 0.9em;">
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Shape:</span><span class="value-display" id="shapeVal">Dumbbell</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Nodes:</span><span class="value-display" id="nodesVal">1 angular</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Max Electrons:</span><span class="value-display" id="maxElVal">6</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Energy Level:</span><span class="value-display" id="energyVal">-3.4 eV</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let currentOrbital = '2p';
        let subtype = 'pz';
        let pointDensity = 2000;
        let cutoff = 0.1;
        let rotX = 0.3, rotY = 0.5;
        let showNucleus = true;
        let showAxes = true;
        let dragging = false;
        let lastX, lastY;
        let points = [];

        const orbitalInfo = {
            '1s': { n: 1, l: 0, shape: 'Sphere', nodes: '0', maxEl: 2, energy: -13.6, subtypes: ['s'] },
            '2s': { n: 2, l: 0, shape: 'Sphere (1 node)', nodes: '1 radial', maxEl: 2, energy: -3.4, subtypes: ['s'] },
            '2p': { n: 2, l: 1, shape: 'Dumbbell', nodes: '1 angular', maxEl: 6, energy: -3.4, subtypes: ['pz', 'px', 'py'] },
            '3s': { n: 3, l: 0, shape: 'Sphere (2 nodes)', nodes: '2 radial', maxEl: 2, energy: -1.5, subtypes: ['s'] },
            '3p': { n: 3, l: 1, shape: 'Dumbbell', nodes: '1 radial, 1 angular', maxEl: 6, energy: -1.5, subtypes: ['pz', 'px', 'py'] },
            '3d': { n: 3, l: 2, shape: 'Cloverleaf', nodes: '2 angular', maxEl: 10, energy: -1.5, subtypes: ['dz2', 'dxz', 'dyz', 'dxy', 'dx2y2'] },
            '4s': { n: 4, l: 0, shape: 'Sphere (3 nodes)', nodes: '3 radial', maxEl: 2, energy: -0.85, subtypes: ['s'] },
            '4f': { n: 4, l: 3, shape: 'Complex', nodes: '3 angular', maxEl: 14, energy: -0.85, subtypes: ['fz3', 'fxz2', 'fyz2', 'fxyz'] }
        };

        // Setup orbital buttons
        document.querySelectorAll('.orbital-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.orbital-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentOrbital = btn.dataset.orbital;
                updateSubtypeOptions();
                generatePoints();
                updateInfo();
            });
        });

        function updateSubtypeOptions() {
            const select = document.getElementById('subtypeSelect');
            const info = orbitalInfo[currentOrbital];
            select.innerHTML = '';
            info.subtypes.forEach(st => {
                const opt = document.createElement('option');
                opt.value = st;
                opt.textContent = st;
                select.appendChild(opt);
            });
            subtype = info.subtypes[0];
        }

        function updateOrbital() {
            subtype = document.getElementById('subtypeSelect').value;
            generatePoints();
        }

        function updateParams() {
            pointDensity = parseInt(document.getElementById('densitySlider').value);
            cutoff = parseInt(document.getElementById('cutoffSlider').value) / 100;

            const densities = ['Low', 'Low', 'Medium', 'Medium', 'High', 'Very High'];
            document.getElementById('densityVal').textContent = densities[Math.floor(pointDensity / 1000)];
            document.getElementById('cutoffVal').textContent = Math.round(cutoff * 100) + '%';

            generatePoints();
        }

        function updateInfo() {
            const info = orbitalInfo[currentOrbital];
            document.getElementById('quantumNumbers').textContent =
                `n = ${info.n}, l = ${info.l}, m = varies`;
            document.getElementById('shapeVal').textContent = info.shape;
            document.getElementById('nodesVal').textContent = info.nodes;
            document.getElementById('maxElVal').textContent = info.maxEl;
            document.getElementById('energyVal').textContent = info.energy + ' eV';
        }

        // Wave function calculations (simplified for visualization)
        function psi(x, y, z, orbital, sub) {
            const r = Math.sqrt(x*x + y*y + z*z);
            if (r < 0.01) return 0;

            const a0 = 1; // Bohr radius normalized

            if (orbital === '1s') {
                return Math.exp(-r / a0);
            } else if (orbital === '2s') {
                return (1 - r / (2 * a0)) * Math.exp(-r / (2 * a0));
            } else if (orbital === '2p') {
                const radial = r * Math.exp(-r / (2 * a0));
                if (sub === 'pz') return radial * (z / r);
                if (sub === 'px') return radial * (x / r);
                if (sub === 'py') return radial * (y / r);
            } else if (orbital === '3s') {
                const rho = 2 * r / (3 * a0);
                return (1 - 2*rho + 2*rho*rho/3) * Math.exp(-rho/2);
            } else if (orbital === '3p') {
                const radial = r * (1 - r / (6 * a0)) * Math.exp(-r / (3 * a0));
                if (sub === 'pz') return radial * (z / r);
                if (sub === 'px') return radial * (x / r);
                if (sub === 'py') return radial * (y / r);
            } else if (orbital === '3d') {
                const radial = r * r * Math.exp(-r / (3 * a0));
                if (sub === 'dz2') return radial * (3*z*z - r*r) / (r*r);
                if (sub === 'dxz') return radial * (x * z) / (r*r);
                if (sub === 'dyz') return radial * (y * z) / (r*r);
                if (sub === 'dxy') return radial * (x * y) / (r*r);
                if (sub === 'dx2y2') return radial * (x*x - y*y) / (r*r);
            } else if (orbital === '4s') {
                const rho = r / (4 * a0);
                return (1 - 3*rho + 2*rho*rho - rho*rho*rho/3) * Math.exp(-rho);
            } else if (orbital === '4f') {
                const radial = r * r * r * Math.exp(-r / (4 * a0));
                if (sub === 'fz3') return radial * z * (5*z*z - 3*r*r) / (r*r*r);
                if (sub === 'fxz2') return radial * x * (5*z*z - r*r) / (r*r*r);
                if (sub === 'fyz2') return radial * y * (5*z*z - r*r) / (r*r*r);
                if (sub === 'fxyz') return radial * x * y * z / (r*r*r);
            }

            return 0;
        }

        function generatePoints() {
            points = [];
            const info = orbitalInfo[currentOrbital];
            const maxR = info.n * 2.5;

            for (let i = 0; i < pointDensity; i++) {
                // Random point in sphere
                const r = Math.random() * maxR;
                const theta = Math.random() * Math.PI;
                const phi = Math.random() * Math.PI * 2;

                const x = r * Math.sin(theta) * Math.cos(phi);
                const y = r * Math.sin(theta) * Math.sin(phi);
                const z = r * Math.cos(theta);

                const prob = psi(x, y, z, currentOrbital, subtype);
                const probSq = prob * prob;

                // Accept point based on probability
                if (Math.random() < probSq / cutoff) {
                    points.push({
                        x, y, z,
                        phase: prob > 0 ? 1 : -1
                    });
                }
            }
        }

        function project(x, y, z) {
            const cosY = Math.cos(rotY);
            const sinY = Math.sin(rotY);
            let x1 = x * cosY - z * sinY;
            let z1 = x * sinY + z * cosY;

            const cosX = Math.cos(rotX);
            const sinX = Math.sin(rotX);
            let y1 = y * cosX - z1 * sinX;
            let z2 = y * sinX + z1 * cosX;

            const scale = 50;
            const perspective = 8;
            const factor = perspective / (perspective + z2);

            return {
                x: canvas.width / 2 + x1 * scale * factor,
                y: canvas.height / 2 + y1 * scale * factor,
                z: z2,
                scale: factor
            };
        }

        function toggleNucleus() {
            showNucleus = !showNucleus;
        }

        function toggleAxes() {
            showAxes = !showAxes;
        }

        function resetView() {
            rotX = 0.3;
            rotY = 0.5;
        }

        function draw() {
            ctx.fillStyle = '#050510';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw axes
            if (showAxes) {
                const axisLen = 4;
                const axes = [
                    { dir: [axisLen, 0, 0], color: '#f87171', label: 'x' },
                    { dir: [0, axisLen, 0], color: '#4ade80', label: 'y' },
                    { dir: [0, 0, axisLen], color: '#60a5fa', label: 'z' }
                ];

                for (const axis of axes) {
                    const origin = project(0, 0, 0);
                    const end = project(...axis.dir);

                    ctx.strokeStyle = axis.color + '60';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(origin.x, origin.y);
                    ctx.lineTo(end.x, end.y);
                    ctx.stroke();

                    ctx.fillStyle = axis.color;
                    ctx.font = '12px sans-serif';
                    ctx.fillText(axis.label, end.x + 5, end.y + 5);
                }
            }

            // Sort points by z
            const sortedPoints = points.map(p => ({
                ...p,
                proj: project(p.x, p.y, p.z)
            })).sort((a, b) => a.proj.z - b.proj.z);

            // Draw points
            for (const point of sortedPoints) {
                const alpha = Math.min(1, 0.3 + point.proj.scale * 0.3);
                const color = point.phase > 0 ? `rgba(96, 165, 250, ${alpha})` : `rgba(248, 113, 113, ${alpha})`;

                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(point.proj.x, point.proj.y, 2 * point.proj.scale, 0, Math.PI * 2);
                ctx.fill();
            }

            // Draw nucleus
            if (showNucleus) {
                const nucleus = project(0, 0, 0);
                ctx.fillStyle = '#facc15';
                ctx.beginPath();
                ctx.arc(nucleus.x, nucleus.y, 8, 0, Math.PI * 2);
                ctx.fill();

                ctx.fillStyle = '#fff';
                ctx.font = 'bold 10px sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('+', nucleus.x, nucleus.y);
            }

            // Info
            ctx.fillStyle = '#60a5fa';
            ctx.font = '16px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText(currentOrbital + ' orbital (' + subtype + ')', 15, 25);

            // Legend
            ctx.fillStyle = '#60a5fa';
            ctx.fillRect(15, 40, 12, 12);
            ctx.fillStyle = '#fff';
            ctx.font = '12px sans-serif';
            ctx.fillText('+ phase', 30, 50);

            ctx.fillStyle = '#f87171';
            ctx.fillRect(15, 58, 12, 12);
            ctx.fillStyle = '#fff';
            ctx.fillText('- phase', 30, 68);
        }

        // Mouse interaction
        canvas.addEventListener('mousedown', (e) => {
            dragging = true;
            lastX = e.clientX;
            lastY = e.clientY;
            canvas.style.cursor = 'grabbing';
        });

        canvas.addEventListener('mousemove', (e) => {
            if (!dragging) return;
            const dx = e.clientX - lastX;
            const dy = e.clientY - lastY;
            rotY += dx * 0.01;
            rotX += dy * 0.01;
            lastX = e.clientX;
            lastY = e.clientY;
        });

        canvas.addEventListener('mouseup', () => {
            dragging = false;
            canvas.style.cursor = 'grab';
        });

        canvas.addEventListener('mouseleave', () => {
            dragging = false;
            canvas.style.cursor = 'grab';
        });

        function animate() {
            if (!dragging) {
                rotY += 0.003;
            }
            draw();
            requestAnimationFrame(animate);
        }

        updateSubtypeOptions();
        updateParams();
        updateInfo();
        generatePoints();
        animate();
    </script>
</body>
</html>
