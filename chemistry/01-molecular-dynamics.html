<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Molecular Dynamics | Chemistry</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
            color: #e0e0e0;
            min-height: 100vh;
            overflow: hidden;
        }
        #canvas { display: block; }
        .controls {
            position: fixed;
            top: 20px; right: 20px;
            background: rgba(0,0,0,0.85);
            padding: 20px; border-radius: 15px;
            min-width: 280px;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        h1 { color: #10b981; font-size: 1.3em; margin-bottom: 15px; }
        .control-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; color: #aaa; font-size: 0.9em; }
        input[type="range"], select { width: 100%; }
        .value { float: right; color: #10b981; }
        button {
            width: 100%; padding: 10px; margin: 5px 0;
            border: none; border-radius: 8px;
            background: #10b981; color: white;
            font-weight: bold; cursor: pointer;
        }
        button:hover { background: #34d399; }
        .stats { margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); }
        .stat-row { display: flex; justify-content: space-between; padding: 5px 0; font-size: 0.9em; }
        .stat-label { color: #888; }
        .stat-value { color: #10b981; font-weight: bold; }
        .info { font-size: 0.8em; color: #666; margin-top: 15px; line-height: 1.5; }
        a.back-link {
            position: fixed; top: 20px; left: 20px;
            color: #10b981; text-decoration: none;
            background: rgba(0,0,0,0.8); padding: 10px 20px;
            border-radius: 25px; font-size: 0.9em;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <a href="index.html" class="back-link">← Back to Chemistry</a>

    <div class="controls">
        <h1>Molecular Dynamics</h1>
        <p style="font-size:0.85em; color:#888; margin-bottom:15px;">Lennard-Jones potential</p>

        <div class="control-group">
            <label>Particles: <span class="value" id="particlesValue">80</span></label>
            <input type="range" id="particles" min="20" max="150" step="10" value="80">
        </div>

        <div class="control-group">
            <label>Temperature: <span class="value" id="tempValue">1.0</span></label>
            <input type="range" id="temperature" min="0.1" max="3" step="0.1" value="1.0">
        </div>

        <div class="control-group">
            <label>Interaction Strength (ε): <span class="value" id="epsilonValue">1.0</span></label>
            <input type="range" id="epsilon" min="0.5" max="3" step="0.1" value="1.0">
        </div>

        <div class="control-group">
            <label>Particle Size (σ): <span class="value" id="sigmaValue">20</span></label>
            <input type="range" id="sigma" min="10" max="30" step="2" value="20">
        </div>

        <button id="runBtn">Start Simulation</button>
        <button id="resetBtn" style="background:#444;color:#fff">Reset</button>

        <div class="stats">
            <div class="stat-row">
                <span class="stat-label">Kinetic Energy</span>
                <span class="stat-value" id="kinetic">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Potential Energy</span>
                <span class="stat-value" id="potential">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Total Energy</span>
                <span class="stat-value" id="total">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Temperature</span>
                <span class="stat-value" id="actualTemp">0</span>
            </div>
        </div>

        <div class="info">
            <strong>Lennard-Jones:</strong> V(r) = 4ε[(σ/r)¹² - (σ/r)⁶]<br>
            <strong>Repulsion:</strong> Short range. <strong>Attraction:</strong> Medium range.
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            initParticles();
        }
        resize();
        window.onresize = resize;

        let particles = [];
        let nParticles = 80;
        let temperature = 1.0;
        let epsilon = 1.0;
        let sigma = 20;
        let running = false;
        let timeStep = 0;

        const dt = 0.005;
        const mass = 1.0;

        function initParticles() {
            particles = [];
            timeStep = 0;

            const w = canvas.width - 400;
            const h = canvas.height - 100;
            const cols = Math.ceil(Math.sqrt(nParticles * w / h));
            const rows = Math.ceil(nParticles / cols);
            const spacing = Math.min(w / cols, h / rows);

            let idx = 0;
            for (let i = 0; i < rows && idx < nParticles; i++) {
                for (let j = 0; j < cols && idx < nParticles; j++) {
                    const x = 100 + j * spacing + spacing / 2;
                    const y = 50 + i * spacing + spacing / 2;

                    // Maxwell-Boltzmann distribution
                    const speed = Math.sqrt(temperature) * Math.sqrt(-2 * Math.log(Math.random()));
                    const angle = Math.random() * 2 * Math.PI;

                    particles.push({
                        x, y,
                        vx: speed * Math.cos(angle),
                        vy: speed * Math.sin(angle),
                        fx: 0, fy: 0
                    });
                    idx++;
                }
            }
        }

        function computeForces() {
            // Reset forces
            for (const p of particles) {
                p.fx = 0;
                p.fy = 0;
            }

            let potentialEnergy = 0;

            // Pair interactions
            for (let i = 0; i < particles.length; i++) {
                for (let j = i + 1; j < particles.length; j++) {
                    const p1 = particles[i];
                    const p2 = particles[j];

                    let dx = p2.x - p1.x;
                    let dy = p2.y - p1.y;
                    const r2 = dx * dx + dy * dy;
                    const r = Math.sqrt(r2);

                    if (r < sigma * 3) {
                        // Lennard-Jones force
                        const sr2 = (sigma * sigma) / r2;
                        const sr6 = sr2 * sr2 * sr2;
                        const sr12 = sr6 * sr6;

                        const force = 24 * epsilon * (2 * sr12 - sr6) / r2;

                        const fx = force * dx;
                        const fy = force * dy;

                        p1.fx -= fx;
                        p1.fy -= fy;
                        p2.fx += fx;
                        p2.fy += fy;

                        // Potential energy
                        potentialEnergy += 4 * epsilon * (sr12 - sr6);
                    }
                }
            }

            return potentialEnergy;
        }

        function integrate() {
            const w = canvas.width - 400;
            const h = canvas.height - 100;

            for (const p of particles) {
                // Velocity Verlet integration
                p.vx += 0.5 * p.fx / mass * dt;
                p.vy += 0.5 * p.fy / mass * dt;

                p.x += p.vx * dt;
                p.y += p.vy * dt;

                // Wall collisions (elastic)
                if (p.x < 50 + sigma / 2) {
                    p.x = 50 + sigma / 2;
                    p.vx = -p.vx;
                }
                if (p.x > 50 + w - sigma / 2) {
                    p.x = 50 + w - sigma / 2;
                    p.vx = -p.vx;
                }
                if (p.y < 50 + sigma / 2) {
                    p.y = 50 + sigma / 2;
                    p.vy = -p.vy;
                }
                if (p.y > 50 + h - sigma / 2) {
                    p.y = 50 + h - sigma / 2;
                    p.vy = -p.vy;
                }
            }
        }

        function thermostat() {
            // Berendsen thermostat
            let kineticEnergy = 0;
            for (const p of particles) {
                kineticEnergy += 0.5 * mass * (p.vx * p.vx + p.vy * p.vy);
            }

            const currentTemp = kineticEnergy / particles.length;
            const tau = 0.1;
            const lambda = Math.sqrt(1 + dt / tau * (temperature / currentTemp - 1));

            for (const p of particles) {
                p.vx *= lambda;
                p.vy *= lambda;
            }
        }

        function update() {
            if (!running) return;

            computeForces();
            integrate();
            computeForces();

            // Second half of velocity update
            for (const p of particles) {
                p.vx += 0.5 * p.fx / mass * dt;
                p.vy += 0.5 * p.fy / mass * dt;
            }

            thermostat();
            timeStep++;
            updateStats();
        }

        function updateStats() {
            let kineticEnergy = 0;
            for (const p of particles) {
                kineticEnergy += 0.5 * mass * (p.vx * p.vx + p.vy * p.vy);
            }

            const potentialEnergy = computeForces();
            const totalEnergy = kineticEnergy + potentialEnergy;
            const actualTemp = kineticEnergy / particles.length;

            document.getElementById('kinetic').textContent = kineticEnergy.toFixed(1);
            document.getElementById('potential').textContent = potentialEnergy.toFixed(1);
            document.getElementById('total').textContent = totalEnergy.toFixed(1);
            document.getElementById('actualTemp').textContent = actualTemp.toFixed(2);
        }

        function draw() {
            ctx.fillStyle = '#0f172a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            update();

            const w = canvas.width - 400;
            const h = canvas.height - 100;

            // Draw container
            ctx.strokeStyle = '#10b981';
            ctx.lineWidth = 2;
            ctx.strokeRect(50, 50, w, h);

            // Draw particles
            for (const p of particles) {
                // Particle glow based on speed
                const speed = Math.sqrt(p.vx * p.vx + p.vy * p.vy);
                const hue = 160 - speed * 30; // Green to orange

                ctx.beginPath();
                ctx.arc(p.x, p.y, sigma / 2, 0, Math.PI * 2);
                ctx.fillStyle = `hsl(${hue}, 70%, 50%)`;
                ctx.fill();

                // Highlight
                ctx.beginPath();
                ctx.arc(p.x - sigma / 6, p.y - sigma / 6, sigma / 6, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(255,255,255,0.3)';
                ctx.fill();

                // Velocity vector
                if (running) {
                    ctx.beginPath();
                    ctx.moveTo(p.x, p.y);
                    ctx.lineTo(p.x + p.vx * 10, p.y + p.vy * 10);
                    ctx.strokeStyle = 'rgba(255,255,255,0.3)';
                    ctx.lineWidth = 1;
                    ctx.stroke();
                }
            }

            // Title
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 18px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('Molecular Dynamics Simulation', 50, 30);

            requestAnimationFrame(draw);
        }

        // Event listeners
        document.getElementById('particles').oninput = (e) => {
            nParticles = parseInt(e.target.value);
            document.getElementById('particlesValue').textContent = nParticles;
        };

        document.getElementById('temperature').oninput = (e) => {
            temperature = parseFloat(e.target.value);
            document.getElementById('tempValue').textContent = temperature.toFixed(1);
        };

        document.getElementById('epsilon').oninput = (e) => {
            epsilon = parseFloat(e.target.value);
            document.getElementById('epsilonValue').textContent = epsilon.toFixed(1);
        };

        document.getElementById('sigma').oninput = (e) => {
            sigma = parseInt(e.target.value);
            document.getElementById('sigmaValue').textContent = sigma;
        };

        document.getElementById('runBtn').onclick = () => {
            running = !running;
            document.getElementById('runBtn').textContent = running ? 'Pause' : 'Start Simulation';
        };

        document.getElementById('resetBtn').onclick = initParticles;

        // Initialize
        initParticles();
        draw();
    </script>
</body>
</html>
