<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stoichiometry - Chemistry</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); color: #eee; min-height: 100vh; padding: 20px; }
        .back-link { position: fixed; top: 20px; left: 20px; color: #60a5fa; text-decoration: none; font-weight: 600; padding: 8px 16px; background: rgba(0,0,0,0.3); border-radius: 20px; z-index: 100; }
        h1 { text-align: center; margin: 40px 0 10px; font-size: 2.2em; color: #60a5fa; }
        .subtitle { text-align: center; opacity: 0.8; margin-bottom: 20px; }
        .container { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 1fr 300px; gap: 20px; }
        .panel { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 25px; }
        .info-box { background: rgba(96, 165, 250, 0.1); border: 1px solid rgba(96, 165, 250, 0.3); border-radius: 8px; padding: 15px; margin-bottom: 20px; font-size: 0.85em; line-height: 1.6; }
        h3 { color: #60a5fa; margin-bottom: 15px; }
        canvas { width: 100%; border-radius: 8px; background: #0a0a14; }
        .control-group { margin: 15px 0; }
        .control-group label { display: block; margin-bottom: 5px; }
        .control-group input, .control-group select { width: 100%; padding: 8px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.1); color: #fff; }
        .value-display { color: #60a5fa; font-family: monospace; }
        button { width: 100%; padding: 12px; margin: 8px 0; border: none; border-radius: 8px; font-size: 1em; font-weight: 600; cursor: pointer; }
        .btn-primary { background: #60a5fa; color: #1a1a2e; }
        .btn-secondary { background: rgba(255,255,255,0.1); color: #fff; }
        .equation-display { font-family: monospace; font-size: 1.3em; text-align: center; padding: 20px; background: rgba(0,0,0,0.3); border-radius: 12px; margin: 15px 0; }
        .result-box { padding: 15px; background: rgba(74, 222, 128, 0.1); border: 1px solid rgba(74, 222, 128, 0.3); border-radius: 8px; margin: 10px 0; }
        .limiting-reagent { color: #f87171; font-weight: bold; }
        .excess-reagent { color: #4ade80; }
        @media (max-width: 900px) { .container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back</a>
    <h1>Stoichiometry</h1>
    <p class="subtitle">Balancing equations and molar ratios</p>

    <div class="container">
        <div class="panel">
            <canvas id="canvas" width="800" height="500"></canvas>
        </div>

        <div class="panel">
            <div class="info-box">
                <strong>Stoichiometry:</strong>
                The calculation of reactants and products in chemical reactions.
                Uses molar ratios from balanced equations to determine
                quantities needed or produced.
            </div>

            <div class="control-group">
                <label>Select Reaction:</label>
                <select id="reactionSelect" onchange="updateReaction()">
                    <option value="combustion">2H₂ + O₂ → 2H₂O</option>
                    <option value="synthesis">N₂ + 3H₂ → 2NH₃</option>
                    <option value="neutralization">HCl + NaOH → NaCl + H₂O</option>
                    <option value="decomposition">2H₂O₂ → 2H₂O + O₂</option>
                    <option value="replacement">Zn + 2HCl → ZnCl₂ + H₂</option>
                </select>
            </div>

            <div class="equation-display" id="equationDisplay">
                2H₂ + O₂ → 2H₂O
            </div>

            <h3>Reactant Amounts</h3>
            <div class="control-group">
                <label>Reactant A: <span class="value-display" id="reactantAName">H₂</span></label>
                <input type="range" id="reactantASlider" min="0" max="100" value="50" oninput="calculate()">
                <span class="value-display" id="reactantAVal">50 mol</span>
            </div>

            <div class="control-group">
                <label>Reactant B: <span class="value-display" id="reactantBName">O₂</span></label>
                <input type="range" id="reactantBSlider" min="0" max="100" value="25" oninput="calculate()">
                <span class="value-display" id="reactantBVal">25 mol</span>
            </div>

            <button class="btn-primary" onclick="runReaction()">Run Reaction</button>
            <button class="btn-secondary" onclick="resetReaction()">Reset</button>

            <div class="result-box" id="resultBox">
                <h3>Results</h3>
                <div id="limitingDisplay">Limiting Reagent: <span class="limiting-reagent">H₂</span></div>
                <div id="excessDisplay">Excess: <span class="excess-reagent">0 mol O₂</span></div>
                <div id="productDisplay">Product: <span class="value-display">50 mol H₂O</span></div>
                <div id="yieldDisplay">Theoretical Yield: <span class="value-display">100%</span></div>
            </div>

            <h3 style="margin-top: 15px;">Molar Ratios</h3>
            <div style="font-size: 0.9em;" id="ratioDisplay">
                <div>H₂ : O₂ = 2 : 1</div>
                <div>H₂ : H₂O = 2 : 2 = 1 : 1</div>
                <div>O₂ : H₂O = 1 : 2</div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        const reactions = {
            combustion: {
                equation: '2H₂ + O₂ → 2H₂O',
                reactantA: { name: 'H₂', coeff: 2, color: '#60a5fa', molar: 2 },
                reactantB: { name: 'O₂', coeff: 1, color: '#f87171', molar: 32 },
                product: { name: 'H₂O', coeff: 2, color: '#4ade80', molar: 18 },
                ratios: ['H₂ : O₂ = 2 : 1', 'H₂ : H₂O = 1 : 1', 'O₂ : H₂O = 1 : 2']
            },
            synthesis: {
                equation: 'N₂ + 3H₂ → 2NH₃',
                reactantA: { name: 'N₂', coeff: 1, color: '#a78bfa', molar: 28 },
                reactantB: { name: 'H₂', coeff: 3, color: '#60a5fa', molar: 2 },
                product: { name: 'NH₃', coeff: 2, color: '#4ade80', molar: 17 },
                ratios: ['N₂ : H₂ = 1 : 3', 'N₂ : NH₃ = 1 : 2', 'H₂ : NH₃ = 3 : 2']
            },
            neutralization: {
                equation: 'HCl + NaOH → NaCl + H₂O',
                reactantA: { name: 'HCl', coeff: 1, color: '#f87171', molar: 36.5 },
                reactantB: { name: 'NaOH', coeff: 1, color: '#60a5fa', molar: 40 },
                product: { name: 'NaCl', coeff: 1, color: '#facc15', molar: 58.5 },
                ratios: ['HCl : NaOH = 1 : 1', 'HCl : NaCl = 1 : 1', 'NaOH : NaCl = 1 : 1']
            },
            decomposition: {
                equation: '2H₂O₂ → 2H₂O + O₂',
                reactantA: { name: 'H₂O₂', coeff: 2, color: '#60a5fa', molar: 34 },
                reactantB: { name: '(catalyst)', coeff: 0, color: '#9ca3af', molar: 0 },
                product: { name: 'H₂O + O₂', coeff: 2, color: '#4ade80', molar: 18 },
                ratios: ['H₂O₂ : H₂O = 1 : 1', 'H₂O₂ : O₂ = 2 : 1']
            },
            replacement: {
                equation: 'Zn + 2HCl → ZnCl₂ + H₂',
                reactantA: { name: 'Zn', coeff: 1, color: '#9ca3af', molar: 65 },
                reactantB: { name: 'HCl', coeff: 2, color: '#f87171', molar: 36.5 },
                product: { name: 'ZnCl₂ + H₂', coeff: 1, color: '#4ade80', molar: 136 },
                ratios: ['Zn : HCl = 1 : 2', 'Zn : ZnCl₂ = 1 : 1', 'Zn : H₂ = 1 : 1']
            }
        };

        let currentReaction = 'combustion';
        let amountA = 50;
        let amountB = 25;
        let particles = { reactantA: [], reactantB: [], product: [] };
        let reactionRunning = false;
        let reactionProgress = 0;

        function updateReaction() {
            currentReaction = document.getElementById('reactionSelect').value;
            const rxn = reactions[currentReaction];

            document.getElementById('equationDisplay').textContent = rxn.equation;
            document.getElementById('reactantAName').textContent = rxn.reactantA.name;
            document.getElementById('reactantBName').textContent = rxn.reactantB.name;

            // Update ratio display
            document.getElementById('ratioDisplay').innerHTML =
                rxn.ratios.map(r => `<div>${r}</div>`).join('');

            resetReaction();
        }

        function calculate() {
            amountA = parseInt(document.getElementById('reactantASlider').value);
            amountB = parseInt(document.getElementById('reactantBSlider').value);

            document.getElementById('reactantAVal').textContent = amountA + ' mol';
            document.getElementById('reactantBVal').textContent = amountB + ' mol';

            const rxn = reactions[currentReaction];

            // Determine limiting reagent
            const ratioNeeded = rxn.reactantA.coeff / (rxn.reactantB.coeff || 1);
            const actualRatio = amountA / (amountB || 0.001);

            let limiting, excess, excessAmount, productAmount;

            if (rxn.reactantB.coeff === 0) {
                // Decomposition - only one reactant
                limiting = rxn.reactantA.name;
                excess = 'N/A';
                excessAmount = 0;
                productAmount = amountA * (rxn.product.coeff / rxn.reactantA.coeff);
            } else if (actualRatio > ratioNeeded) {
                // A is in excess, B is limiting
                limiting = rxn.reactantB.name;
                const aNeeded = amountB * ratioNeeded;
                excessAmount = amountA - aNeeded;
                excess = rxn.reactantA.name;
                productAmount = amountB * (rxn.product.coeff / rxn.reactantB.coeff);
            } else {
                // B is in excess, A is limiting
                limiting = rxn.reactantA.name;
                const bNeeded = amountA / ratioNeeded;
                excessAmount = amountB - bNeeded;
                excess = rxn.reactantB.name;
                productAmount = amountA * (rxn.product.coeff / rxn.reactantA.coeff);
            }

            document.getElementById('limitingDisplay').innerHTML =
                `Limiting Reagent: <span class="limiting-reagent">${limiting}</span>`;
            document.getElementById('excessDisplay').innerHTML =
                `Excess: <span class="excess-reagent">${excessAmount.toFixed(1)} mol ${excess}</span>`;
            document.getElementById('productDisplay').innerHTML =
                `Product: <span class="value-display">${productAmount.toFixed(1)} mol ${rxn.product.name}</span>`;

            initParticles();
            draw();
        }

        function initParticles() {
            particles = { reactantA: [], reactantB: [], product: [] };
            const rxn = reactions[currentReaction];

            // Create reactant A particles
            const numA = Math.min(amountA, 50);
            for (let i = 0; i < numA; i++) {
                particles.reactantA.push({
                    x: 100 + Math.random() * 200,
                    y: 100 + Math.random() * 300,
                    vx: (Math.random() - 0.5) * 2,
                    vy: (Math.random() - 0.5) * 2,
                    color: rxn.reactantA.color,
                    label: rxn.reactantA.name
                });
            }

            // Create reactant B particles
            if (rxn.reactantB.coeff > 0) {
                const numB = Math.min(amountB, 50);
                for (let i = 0; i < numB; i++) {
                    particles.reactantB.push({
                        x: 500 + Math.random() * 200,
                        y: 100 + Math.random() * 300,
                        vx: (Math.random() - 0.5) * 2,
                        vy: (Math.random() - 0.5) * 2,
                        color: rxn.reactantB.color,
                        label: rxn.reactantB.name
                    });
                }
            }
        }

        function runReaction() {
            if (reactionRunning) return;
            reactionRunning = true;
            reactionProgress = 0;
            animateReaction();
        }

        function animateReaction() {
            if (!reactionRunning) return;

            reactionProgress += 0.02;

            const rxn = reactions[currentReaction];
            const ratioNeeded = rxn.reactantA.coeff / (rxn.reactantB.coeff || 1);

            // Move particles toward center
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;

            for (const p of [...particles.reactantA, ...particles.reactantB]) {
                const dx = centerX - p.x;
                const dy = centerY - p.y;
                p.vx += dx * 0.001;
                p.vy += dy * 0.001;
                p.x += p.vx;
                p.y += p.vy;
            }

            // React particles when they meet
            if (reactionProgress > 0.3 && particles.reactantA.length > 0) {
                const reactRate = Math.ceil(particles.reactantA.length * 0.1);

                for (let i = 0; i < reactRate; i++) {
                    if (particles.reactantA.length > 0 &&
                        (rxn.reactantB.coeff === 0 || particles.reactantB.length > 0)) {

                        // Remove reactants
                        const a = particles.reactantA.pop();

                        if (rxn.reactantB.coeff > 0 && particles.reactantB.length > 0) {
                            particles.reactantB.pop();
                        }

                        // Create product
                        particles.product.push({
                            x: a.x,
                            y: a.y,
                            vx: (Math.random() - 0.5) * 3,
                            vy: (Math.random() - 0.5) * 3,
                            color: rxn.product.color,
                            label: rxn.product.name
                        });
                    }
                }
            }

            // Move products outward
            for (const p of particles.product) {
                p.x += p.vx;
                p.y += p.vy;
                p.vx *= 0.99;
                p.vy *= 0.99;

                // Bounce
                if (p.x < 50 || p.x > canvas.width - 50) p.vx *= -1;
                if (p.y < 50 || p.y > canvas.height - 50) p.vy *= -1;
            }

            draw();

            if (reactionProgress < 1 || particles.reactantA.length > 0) {
                requestAnimationFrame(animateReaction);
            } else {
                reactionRunning = false;
            }
        }

        function resetReaction() {
            reactionRunning = false;
            reactionProgress = 0;
            calculate();
        }

        function draw() {
            ctx.fillStyle = '#0a0a14';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const rxn = reactions[currentReaction];

            // Draw container
            ctx.strokeStyle = 'rgba(96, 165, 250, 0.3)';
            ctx.lineWidth = 2;
            ctx.strokeRect(50, 50, canvas.width - 100, canvas.height - 100);

            // Draw reaction arrow
            ctx.fillStyle = 'rgba(255,255,255,0.2)';
            ctx.font = '40px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('→', canvas.width / 2, canvas.height / 2 + 15);

            // Draw all particles
            ctx.font = 'bold 10px sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            const allParticles = [
                ...particles.reactantA.map(p => ({ ...p, type: 'A' })),
                ...particles.reactantB.map(p => ({ ...p, type: 'B' })),
                ...particles.product.map(p => ({ ...p, type: 'P' }))
            ];

            for (const p of allParticles) {
                // Glow
                const gradient = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, 20);
                gradient.addColorStop(0, p.color + '60');
                gradient.addColorStop(1, 'transparent');
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(p.x, p.y, 20, 0, Math.PI * 2);
                ctx.fill();

                // Particle
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, 12, 0, Math.PI * 2);
                ctx.fill();

                // Label
                ctx.fillStyle = '#000';
                ctx.fillText(p.label.substring(0, 3), p.x, p.y);
            }

            // Legend
            ctx.fillStyle = '#fff';
            ctx.font = '14px sans-serif';
            ctx.textAlign = 'left';

            ctx.fillStyle = rxn.reactantA.color;
            ctx.fillRect(60, 60, 15, 15);
            ctx.fillStyle = '#fff';
            ctx.fillText(`${rxn.reactantA.name}: ${particles.reactantA.length}`, 80, 72);

            if (rxn.reactantB.coeff > 0) {
                ctx.fillStyle = rxn.reactantB.color;
                ctx.fillRect(60, 85, 15, 15);
                ctx.fillStyle = '#fff';
                ctx.fillText(`${rxn.reactantB.name}: ${particles.reactantB.length}`, 80, 97);
            }

            ctx.fillStyle = rxn.product.color;
            ctx.fillRect(60, 110, 15, 15);
            ctx.fillStyle = '#fff';
            ctx.fillText(`${rxn.product.name}: ${particles.product.length}`, 80, 122);

            // Progress bar if reacting
            if (reactionRunning) {
                ctx.fillStyle = 'rgba(74, 222, 128, 0.3)';
                ctx.fillRect(50, canvas.height - 30, (canvas.width - 100) * reactionProgress, 10);
                ctx.strokeStyle = '#4ade80';
                ctx.strokeRect(50, canvas.height - 30, canvas.width - 100, 10);
            }
        }

        updateReaction();
    </script>
</body>
</html>
