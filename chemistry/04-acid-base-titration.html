<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acid-Base Titration - Chemistry</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); color: #eee; min-height: 100vh; padding: 20px; }
        .back-link { position: fixed; top: 20px; left: 20px; color: #60a5fa; text-decoration: none; font-weight: 600; padding: 8px 16px; background: rgba(0,0,0,0.3); border-radius: 20px; z-index: 100; }
        h1 { text-align: center; margin: 40px 0 10px; font-size: 2.2em; color: #60a5fa; }
        .subtitle { text-align: center; opacity: 0.8; margin-bottom: 20px; }
        .container { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 1fr 300px; gap: 20px; }
        .panel { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 25px; }
        .info-box { background: rgba(96, 165, 250, 0.1); border: 1px solid rgba(96, 165, 250, 0.3); border-radius: 8px; padding: 15px; margin-bottom: 20px; font-size: 0.85em; line-height: 1.6; }
        h3 { color: #60a5fa; margin-bottom: 15px; }
        canvas { width: 100%; border-radius: 8px; }
        .control-group { margin: 15px 0; }
        .control-group label { display: block; margin-bottom: 5px; }
        .control-group input, .control-group select { width: 100%; }
        .value-display { color: #60a5fa; font-family: monospace; }
        button { width: 100%; padding: 12px; margin: 8px 0; border: none; border-radius: 8px; font-size: 1em; font-weight: 600; cursor: pointer; }
        .btn-primary { background: #60a5fa; color: #1a1a2e; }
        .btn-secondary { background: rgba(255,255,255,0.1); color: #fff; }
        .ph-display { font-size: 3em; text-align: center; font-family: monospace; padding: 20px; border-radius: 12px; margin: 15px 0; }
        .ph-scale { display: flex; height: 20px; border-radius: 10px; overflow: hidden; margin: 10px 0; }
        .ph-scale div { flex: 1; }
        @media (max-width: 900px) { .container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back</a>
    <h1>Acid-Base Titration</h1>
    <p class="subtitle">pH curves, equivalence points, and indicators</p>

    <div class="container">
        <div class="panel">
            <div style="display: grid; grid-template-columns: 250px 1fr; gap: 20px;">
                <canvas id="beakerCanvas" width="250" height="400"></canvas>
                <canvas id="chartCanvas" width="500" height="400"></canvas>
            </div>
        </div>

        <div class="panel">
            <div class="info-box">
                <strong>Titration:</strong>
                A technique to determine unknown concentration by
                adding a known concentration solution until the
                <em>equivalence point</em> is reached.
            </div>

            <div class="ph-display" id="phDisplay" style="background: #f87171;">
                pH: 1.00
            </div>

            <div class="ph-scale">
                <div style="background: #f87171;"></div>
                <div style="background: #fb923c;"></div>
                <div style="background: #facc15;"></div>
                <div style="background: #a3e635;"></div>
                <div style="background: #4ade80;"></div>
                <div style="background: #2dd4bf;"></div>
                <div style="background: #22d3ee;"></div>
                <div style="background: #60a5fa;"></div>
                <div style="background: #818cf8;"></div>
                <div style="background: #a78bfa;"></div>
            </div>
            <div style="display: flex; justify-content: space-between; font-size: 0.8em; margin-bottom: 15px;">
                <span>Acidic (0)</span>
                <span>Neutral (7)</span>
                <span>Basic (14)</span>
            </div>

            <div class="control-group">
                <label>Acid Type:</label>
                <select id="acidSelect" onchange="updateParams()">
                    <option value="strong">Strong Acid (HCl)</option>
                    <option value="weak">Weak Acid (CH₃COOH)</option>
                </select>
            </div>

            <div class="control-group">
                <label>Base Type:</label>
                <select id="baseSelect" onchange="updateParams()">
                    <option value="strong">Strong Base (NaOH)</option>
                    <option value="weak">Weak Base (NH₃)</option>
                </select>
            </div>

            <div class="control-group">
                <label>Acid Concentration: <span class="value-display" id="acidConcVal">0.1</span> M</label>
                <input type="range" id="acidConcSlider" min="1" max="20" value="10" oninput="updateParams()">
            </div>

            <div class="control-group">
                <label>Base Concentration: <span class="value-display" id="baseConcVal">0.1</span> M</label>
                <input type="range" id="baseConcSlider" min="1" max="20" value="10" oninput="updateParams()">
            </div>

            <div class="control-group">
                <label>Drop Size: <span class="value-display" id="dropVal">1</span> mL</label>
                <input type="range" id="dropSlider" min="1" max="10" value="1" oninput="updateParams()">
            </div>

            <button class="btn-primary" onclick="addDrop()">Add Drop of Base</button>
            <button class="btn-secondary" onclick="autoTitrate()">Auto Titrate</button>
            <button class="btn-secondary" onclick="resetSim()">Reset</button>

            <h3 style="margin-top: 15px;">Titration Data</h3>
            <div style="font-size: 0.9em;">
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Volume Added:</span><span class="value-display" id="volVal">0 mL</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Equivalence Point:</span><span class="value-display" id="eqVal">-- mL</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Indicator Color:</span><span class="value-display" id="indicatorVal">Red</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const beakerCanvas = document.getElementById('beakerCanvas');
        const bctx = beakerCanvas.getContext('2d');
        const chartCanvas = document.getElementById('chartCanvas');
        const cctx = chartCanvas.getContext('2d');

        let acidType = 'strong';
        let baseType = 'strong';
        let acidConc = 0.1;
        let baseConc = 0.1;
        let dropSize = 1;

        let acidVolume = 50; // mL
        let baseAdded = 0; // mL
        let pH = 1;
        let history = [];
        let autoRunning = false;

        // pKa values
        const pKa = { strong: -7, weak: 4.76 }; // weak = acetic acid
        const pKb = { strong: -1.7, weak: 4.75 }; // weak = ammonia

        function updateParams() {
            acidType = document.getElementById('acidSelect').value;
            baseType = document.getElementById('baseSelect').value;
            acidConc = parseInt(document.getElementById('acidConcSlider').value) / 100;
            baseConc = parseInt(document.getElementById('baseConcSlider').value) / 100;
            dropSize = parseInt(document.getElementById('dropSlider').value);

            document.getElementById('acidConcVal').textContent = acidConc.toFixed(2);
            document.getElementById('baseConcVal').textContent = baseConc.toFixed(2);
            document.getElementById('dropVal').textContent = dropSize;
        }

        function calculatePH() {
            const molesAcid = acidConc * acidVolume / 1000;
            const molesBase = baseConc * baseAdded / 1000;

            // Calculate pH based on acid/base types
            if (acidType === 'strong' && baseType === 'strong') {
                return calculateStrongStrongPH(molesAcid, molesBase);
            } else if (acidType === 'weak' && baseType === 'strong') {
                return calculateWeakAcidStrongBasePH(molesAcid, molesBase);
            } else if (acidType === 'strong' && baseType === 'weak') {
                return calculateStrongAcidWeakBasePH(molesAcid, molesBase);
            } else {
                return calculateWeakWeakPH(molesAcid, molesBase);
            }
        }

        function calculateStrongStrongPH(molesAcid, molesBase) {
            const totalVol = (acidVolume + baseAdded) / 1000;
            const excess = molesAcid - molesBase;

            if (excess > 0.0001) {
                // Excess acid
                const H = excess / totalVol;
                return -Math.log10(H);
            } else if (excess < -0.0001) {
                // Excess base
                const OH = -excess / totalVol;
                const pOH = -Math.log10(OH);
                return 14 - pOH;
            } else {
                return 7; // Equivalence point
            }
        }

        function calculateWeakAcidStrongBasePH(molesAcid, molesBase) {
            const Ka = Math.pow(10, -4.76);
            const totalVol = (acidVolume + baseAdded) / 1000;

            if (molesBase < molesAcid * 0.01) {
                // Initial - before any base
                const H = Math.sqrt(Ka * molesAcid / totalVol);
                return -Math.log10(H);
            } else if (molesBase < molesAcid * 0.99) {
                // Buffer region
                const acidRemaining = molesAcid - molesBase;
                const conjugateBase = molesBase;
                return 4.76 + Math.log10(conjugateBase / acidRemaining);
            } else if (molesBase < molesAcid * 1.01) {
                // Near equivalence
                const Kb = 1e-14 / Ka;
                const concSalt = molesAcid / totalVol;
                const OH = Math.sqrt(Kb * concSalt);
                return 14 + Math.log10(OH);
            } else {
                // Excess base
                const excessOH = (molesBase - molesAcid) / totalVol;
                return 14 + Math.log10(excessOH);
            }
        }

        function calculateStrongAcidWeakBasePH(molesAcid, molesBase) {
            const Kb = Math.pow(10, -4.75);
            const totalVol = (acidVolume + baseAdded) / 1000;

            if (molesBase > molesAcid * 1.01) {
                const excessBase = molesBase - molesAcid;
                const OH = Math.sqrt(Kb * excessBase / totalVol);
                return 14 + Math.log10(OH);
            } else if (molesBase > molesAcid * 0.5) {
                // Buffer region
                return 9.25 + Math.log10(molesBase / (molesAcid - molesBase + 0.001));
            } else {
                const H = molesAcid / totalVol;
                return -Math.log10(H);
            }
        }

        function calculateWeakWeakPH(molesAcid, molesBase) {
            // Simplified - treat as buffer
            const Ka = Math.pow(10, -4.76);
            const totalVol = (acidVolume + baseAdded) / 1000;

            if (molesBase < molesAcid) {
                return 4.76 + Math.log10((molesBase + 0.001) / (molesAcid - molesBase + 0.001));
            } else {
                return 9.25 + Math.log10((molesBase - molesAcid + 0.001) / (molesAcid + 0.001));
            }
        }

        function getPhColor(ph) {
            if (ph < 2) return '#f87171';
            if (ph < 4) return '#fb923c';
            if (ph < 5) return '#facc15';
            if (ph < 6) return '#a3e635';
            if (ph < 7) return '#4ade80';
            if (ph < 8) return '#2dd4bf';
            if (ph < 9) return '#22d3ee';
            if (ph < 10) return '#60a5fa';
            if (ph < 12) return '#818cf8';
            return '#a78bfa';
        }

        function getIndicatorColor(ph) {
            // Phenolphthalein indicator
            if (ph < 8.2) return { color: 'Colorless', hex: 'transparent' };
            if (ph < 10) return { color: 'Pink', hex: '#ff69b4' };
            return { color: 'Deep Pink', hex: '#ff1493' };
        }

        function addDrop() {
            baseAdded += dropSize;
            pH = calculatePH();
            pH = Math.max(0, Math.min(14, pH));

            history.push({ vol: baseAdded, ph: pH });

            updateDisplay();
            drawBeaker();
            drawChart();
        }

        function autoTitrate() {
            if (autoRunning) {
                autoRunning = false;
                return;
            }
            autoRunning = true;
            autoStep();
        }

        function autoStep() {
            if (!autoRunning) return;
            if (baseAdded < acidVolume * 2) {
                addDrop();
                setTimeout(autoStep, 100);
            } else {
                autoRunning = false;
            }
        }

        function updateDisplay() {
            const phDisplay = document.getElementById('phDisplay');
            phDisplay.textContent = 'pH: ' + pH.toFixed(2);
            phDisplay.style.background = getPhColor(pH);

            document.getElementById('volVal').textContent = baseAdded.toFixed(1) + ' mL';

            // Calculate equivalence point
            const eqVol = (acidConc * acidVolume) / baseConc;
            document.getElementById('eqVal').textContent = eqVol.toFixed(1) + ' mL';

            const indicator = getIndicatorColor(pH);
            document.getElementById('indicatorVal').textContent = indicator.color;
        }

        function drawBeaker() {
            bctx.fillStyle = '#0a0a14';
            bctx.fillRect(0, 0, beakerCanvas.width, beakerCanvas.height);

            const bx = 40;
            const by = 50;
            const bw = 170;
            const bh = 280;

            // Beaker outline
            bctx.strokeStyle = '#60a5fa';
            bctx.lineWidth = 3;
            bctx.beginPath();
            bctx.moveTo(bx, by);
            bctx.lineTo(bx, by + bh);
            bctx.lineTo(bx + bw, by + bh);
            bctx.lineTo(bx + bw, by);
            bctx.stroke();

            // Solution level
            const totalVol = acidVolume + baseAdded;
            const maxVol = acidVolume * 3;
            const level = Math.min((totalVol / maxVol) * bh, bh - 10);

            // Solution color based on pH
            const phColor = getPhColor(pH);
            bctx.fillStyle = phColor + '80';
            bctx.fillRect(bx + 3, by + bh - level, bw - 6, level - 3);

            // Phenolphthalein indicator
            const indicator = getIndicatorColor(pH);
            if (indicator.hex !== 'transparent') {
                bctx.fillStyle = indicator.hex + '40';
                bctx.fillRect(bx + 3, by + bh - level, bw - 6, level - 3);
            }

            // Bubbles
            bctx.fillStyle = 'rgba(255,255,255,0.3)';
            for (let i = 0; i < 10; i++) {
                const bub = {
                    x: bx + 20 + Math.random() * (bw - 40),
                    y: by + bh - 20 - Math.random() * level
                };
                bctx.beginPath();
                bctx.arc(bub.x, bub.y, 2 + Math.random() * 3, 0, Math.PI * 2);
                bctx.fill();
            }

            // Burette
            bctx.strokeStyle = '#aaa';
            bctx.lineWidth = 2;
            bctx.beginPath();
            bctx.moveTo(bx + bw / 2 - 10, 10);
            bctx.lineTo(bx + bw / 2 - 10, 40);
            bctx.lineTo(bx + bw / 2 - 3, 45);
            bctx.lineTo(bx + bw / 2 - 3, by - 5);
            bctx.stroke();
            bctx.beginPath();
            bctx.moveTo(bx + bw / 2 + 10, 10);
            bctx.lineTo(bx + bw / 2 + 10, 40);
            bctx.lineTo(bx + bw / 2 + 3, 45);
            bctx.lineTo(bx + bw / 2 + 3, by - 5);
            bctx.stroke();

            // Base in burette
            bctx.fillStyle = '#60a5fa40';
            bctx.fillRect(bx + bw / 2 - 8, 12, 16, 30);

            // Labels
            bctx.fillStyle = '#fff';
            bctx.font = '12px sans-serif';
            bctx.textAlign = 'center';
            bctx.fillText('NaOH', bx + bw / 2, 8);
            bctx.fillText(baseAdded.toFixed(1) + ' mL added', bx + bw / 2, by + bh + 25);

            // pH indicator
            bctx.font = 'bold 18px sans-serif';
            bctx.fillStyle = phColor;
            bctx.fillText('pH ' + pH.toFixed(1), bx + bw / 2, by + bh - level / 2);
        }

        function drawChart() {
            cctx.fillStyle = '#0a0a14';
            cctx.fillRect(0, 0, chartCanvas.width, chartCanvas.height);

            const margin = 50;
            const width = chartCanvas.width - 2 * margin;
            const height = chartCanvas.height - 2 * margin;

            // Axes
            cctx.strokeStyle = 'rgba(255,255,255,0.3)';
            cctx.lineWidth = 1;
            cctx.beginPath();
            cctx.moveTo(margin, margin);
            cctx.lineTo(margin, chartCanvas.height - margin);
            cctx.lineTo(chartCanvas.width - margin, chartCanvas.height - margin);
            cctx.stroke();

            // Grid lines for pH
            cctx.strokeStyle = 'rgba(255,255,255,0.1)';
            for (let ph = 0; ph <= 14; ph += 2) {
                const y = margin + height - (ph / 14) * height;
                cctx.beginPath();
                cctx.moveTo(margin, y);
                cctx.lineTo(chartCanvas.width - margin, y);
                cctx.stroke();

                cctx.fillStyle = '#aaa';
                cctx.font = '10px sans-serif';
                cctx.textAlign = 'right';
                cctx.fillText(ph.toString(), margin - 5, y + 3);
            }

            // Equivalence point line
            const eqVol = (acidConc * acidVolume) / baseConc;
            const maxVol = acidVolume * 2;
            const eqX = margin + (eqVol / maxVol) * width;

            cctx.strokeStyle = '#facc15';
            cctx.setLineDash([5, 5]);
            cctx.beginPath();
            cctx.moveTo(eqX, margin);
            cctx.lineTo(eqX, chartCanvas.height - margin);
            cctx.stroke();
            cctx.setLineDash([]);

            cctx.fillStyle = '#facc15';
            cctx.font = '11px sans-serif';
            cctx.textAlign = 'center';
            cctx.fillText('Eq. Point', eqX, margin - 5);

            // pH curve
            if (history.length > 1) {
                cctx.strokeStyle = '#60a5fa';
                cctx.lineWidth = 2;
                cctx.beginPath();
                history.forEach((h, i) => {
                    const x = margin + (h.vol / maxVol) * width;
                    const y = margin + height - (h.ph / 14) * height;
                    if (i === 0) cctx.moveTo(x, y);
                    else cctx.lineTo(x, y);
                });
                cctx.stroke();

                // Current point
                const last = history[history.length - 1];
                const cx = margin + (last.vol / maxVol) * width;
                const cy = margin + height - (last.ph / 14) * height;
                cctx.fillStyle = getPhColor(last.ph);
                cctx.beginPath();
                cctx.arc(cx, cy, 6, 0, Math.PI * 2);
                cctx.fill();
            }

            // Labels
            cctx.fillStyle = '#aaa';
            cctx.font = '12px sans-serif';
            cctx.textAlign = 'center';
            cctx.fillText('Volume of Base Added (mL)', chartCanvas.width / 2, chartCanvas.height - 10);

            cctx.save();
            cctx.translate(15, chartCanvas.height / 2);
            cctx.rotate(-Math.PI / 2);
            cctx.fillText('pH', 0, 0);
            cctx.restore();

            // Title
            cctx.fillStyle = '#fff';
            cctx.font = 'bold 16px sans-serif';
            cctx.fillText('Titration Curve', chartCanvas.width / 2, 25);
        }

        function resetSim() {
            autoRunning = false;
            baseAdded = 0;
            pH = calculatePH();
            history = [{ vol: 0, ph: pH }];
            updateDisplay();
            drawBeaker();
            drawChart();
        }

        updateParams();
        resetSim();
    </script>
</body>
</html>
