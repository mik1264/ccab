<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pH & Buffer Solutions | Chemistry</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
            color: #e0e0e0;
            min-height: 100vh;
            overflow: hidden;
        }
        #canvas { display: block; }
        .controls {
            position: fixed;
            top: 20px; right: 20px;
            background: rgba(0,0,0,0.85);
            padding: 20px; border-radius: 15px;
            min-width: 280px;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        h1 { color: #10b981; font-size: 1.3em; margin-bottom: 15px; }
        .control-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; color: #aaa; font-size: 0.9em; }
        input[type="range"], select { width: 100%; }
        .value { float: right; color: #10b981; }
        button {
            width: 100%; padding: 10px; margin: 5px 0;
            border: none; border-radius: 8px;
            background: #10b981; color: white;
            font-weight: bold; cursor: pointer;
        }
        button:hover { background: #34d399; }
        .button-row { display: flex; gap: 10px; }
        .button-row button { flex: 1; }
        .stats { margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); }
        .stat-row { display: flex; justify-content: space-between; padding: 5px 0; font-size: 0.9em; }
        .stat-label { color: #888; }
        .stat-value { color: #10b981; font-weight: bold; }
        .info { font-size: 0.8em; color: #666; margin-top: 15px; line-height: 1.5; }
        a.back-link {
            position: fixed; top: 20px; left: 20px;
            color: #10b981; text-decoration: none;
            background: rgba(0,0,0,0.8); padding: 10px 20px;
            border-radius: 25px; font-size: 0.9em;
        }
        .ph-meter {
            margin-top: 15px;
            padding: 15px;
            background: linear-gradient(90deg,
                #ef4444 0%, #f59e0b 15%, #fbbf24 30%,
                #22c55e 50%, #3b82f6 70%, #8b5cf6 85%, #a855f7 100%);
            border-radius: 8px;
            position: relative;
        }
        .ph-indicator {
            width: 4px;
            height: 30px;
            background: #fff;
            position: absolute;
            top: 5px;
            border-radius: 2px;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
        }
        .ph-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.8em;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <a href="index.html" class="back-link">← Back to Chemistry</a>

    <div class="controls">
        <h1>pH & Buffer Solutions</h1>
        <p style="font-size:0.85em; color:#888; margin-bottom:15px;">Acid-base equilibrium</p>

        <div class="control-group">
            <label>Solution Type</label>
            <select id="solutionType">
                <option value="water">Pure Water</option>
                <option value="buffer">Acetate Buffer</option>
                <option value="strong">Strong Acid/Base</option>
            </select>
        </div>

        <div class="control-group">
            <label>Buffer Concentration: <span class="value" id="bufferValue">0.1</span> M</label>
            <input type="range" id="bufferConc" min="0.01" max="0.5" step="0.01" value="0.1">
        </div>

        <div class="button-row">
            <button id="addAcidBtn" style="background:#ef4444">Add Acid (H⁺)</button>
            <button id="addBaseBtn" style="background:#3b82f6">Add Base (OH⁻)</button>
        </div>

        <button id="resetBtn" style="background:#444;color:#fff">Reset</button>

        <div class="ph-meter">
            <div class="ph-indicator" id="phIndicator"></div>
        </div>
        <div class="ph-labels">
            <span>0 (Acidic)</span>
            <span>7</span>
            <span>14 (Basic)</span>
        </div>

        <div class="stats">
            <div class="stat-row">
                <span class="stat-label">pH</span>
                <span class="stat-value" id="currentPH">7.00</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">[H⁺]</span>
                <span class="stat-value" id="hConc">1.0×10⁻⁷</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">[OH⁻]</span>
                <span class="stat-value" id="ohConc">1.0×10⁻⁷</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Buffer Capacity</span>
                <span class="stat-value" id="bufferCap">0</span>
            </div>
        </div>

        <div class="info">
            <strong>Buffer:</strong> Resists pH changes.<br>
            <strong>Henderson-Hasselbalch:</strong> pH = pKa + log([A⁻]/[HA])
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resize();
        window.onresize = resize;

        let particles = [];
        let solutionType = 'water';
        let bufferConc = 0.1;
        let hConcentration = 1e-7; // mol/L
        let ohConcentration = 1e-7;
        let haConcentration = 0.05; // Weak acid
        let aConcentration = 0.05;  // Conjugate base
        let phHistory = [];

        const pKa = 4.76; // Acetic acid
        const Kw = 1e-14; // Water equilibrium

        function initSolution() {
            particles = [];
            phHistory = [];

            const w = canvas.width - 400;
            const h = canvas.height - 200;

            switch (solutionType) {
                case 'water':
                    hConcentration = 1e-7;
                    ohConcentration = 1e-7;
                    haConcentration = 0;
                    aConcentration = 0;
                    break;
                case 'buffer':
                    hConcentration = Math.pow(10, -(pKa));
                    ohConcentration = Kw / hConcentration;
                    haConcentration = bufferConc / 2;
                    aConcentration = bufferConc / 2;
                    break;
                case 'strong':
                    hConcentration = 0.01;
                    ohConcentration = Kw / hConcentration;
                    haConcentration = 0;
                    aConcentration = 0;
                    break;
            }

            // Create visual particles based on concentrations
            updateParticles(w, h);
            updateStats();
        }

        function updateParticles(w, h) {
            particles = [];

            // Scale concentrations for visualization
            const scale = 500;

            // H+ ions (red)
            const nH = Math.min(100, Math.floor(-Math.log10(hConcentration) < 7 ?
                scale * hConcentration * 1e6 : 3));
            for (let i = 0; i < nH; i++) {
                particles.push({
                    x: 80 + Math.random() * (w - 60),
                    y: 80 + Math.random() * (h - 60),
                    vx: (Math.random() - 0.5) * 4,
                    vy: (Math.random() - 0.5) * 4,
                    type: 'H+'
                });
            }

            // OH- ions (blue)
            const nOH = Math.min(100, Math.floor(-Math.log10(ohConcentration) < 7 ?
                scale * ohConcentration * 1e6 : 3));
            for (let i = 0; i < nOH; i++) {
                particles.push({
                    x: 80 + Math.random() * (w - 60),
                    y: 80 + Math.random() * (h - 60),
                    vx: (Math.random() - 0.5) * 4,
                    vy: (Math.random() - 0.5) * 4,
                    type: 'OH-'
                });
            }

            // Buffer components
            if (solutionType === 'buffer') {
                const nHA = Math.floor(haConcentration * 200);
                for (let i = 0; i < nHA; i++) {
                    particles.push({
                        x: 80 + Math.random() * (w - 60),
                        y: 80 + Math.random() * (h - 60),
                        vx: (Math.random() - 0.5) * 2,
                        vy: (Math.random() - 0.5) * 2,
                        type: 'HA'
                    });
                }

                const nA = Math.floor(aConcentration * 200);
                for (let i = 0; i < nA; i++) {
                    particles.push({
                        x: 80 + Math.random() * (w - 60),
                        y: 80 + Math.random() * (h - 60),
                        vx: (Math.random() - 0.5) * 2,
                        vy: (Math.random() - 0.5) * 2,
                        type: 'A-'
                    });
                }
            }
        }

        function addAcid() {
            const amount = 0.001; // mol/L

            if (solutionType === 'buffer') {
                // Buffer reaction: A- + H+ -> HA
                if (aConcentration > amount) {
                    aConcentration -= amount;
                    haConcentration += amount;
                    // pH change is small
                    hConcentration = Math.pow(10, -pKa) * haConcentration / aConcentration;
                } else {
                    // Buffer exhausted
                    hConcentration += amount;
                }
            } else {
                hConcentration += amount;
            }

            ohConcentration = Kw / hConcentration;
            updateParticles(canvas.width - 400, canvas.height - 200);
            updateStats();
        }

        function addBase() {
            const amount = 0.001; // mol/L

            if (solutionType === 'buffer') {
                // Buffer reaction: HA + OH- -> A- + H2O
                if (haConcentration > amount) {
                    haConcentration -= amount;
                    aConcentration += amount;
                    hConcentration = Math.pow(10, -pKa) * haConcentration / aConcentration;
                } else {
                    // Buffer exhausted
                    ohConcentration += amount;
                    hConcentration = Kw / ohConcentration;
                }
            } else {
                // Neutralization
                if (hConcentration > amount) {
                    hConcentration -= amount;
                } else {
                    ohConcentration += amount - hConcentration;
                    hConcentration = Kw / ohConcentration;
                }
            }

            ohConcentration = Kw / hConcentration;
            updateParticles(canvas.width - 400, canvas.height - 200);
            updateStats();
        }

        function updateStats() {
            const pH = -Math.log10(hConcentration);

            document.getElementById('currentPH').textContent = pH.toFixed(2);
            document.getElementById('currentPH').style.color = pHToColor(pH);

            const hExp = Math.floor(Math.log10(hConcentration));
            const hMant = (hConcentration / Math.pow(10, hExp)).toFixed(1);
            document.getElementById('hConc').textContent = `${hMant}×10${superscript(hExp)}`;

            const ohExp = Math.floor(Math.log10(ohConcentration));
            const ohMant = (ohConcentration / Math.pow(10, ohExp)).toFixed(1);
            document.getElementById('ohConc').textContent = `${ohMant}×10${superscript(ohExp)}`;

            // Buffer capacity
            let capacity = 0;
            if (solutionType === 'buffer') {
                capacity = 2.3 * bufferConc * haConcentration * aConcentration /
                          Math.pow(haConcentration + aConcentration, 2);
            }
            document.getElementById('bufferCap').textContent = capacity.toFixed(3);

            // Update pH indicator
            const indicator = document.getElementById('phIndicator');
            indicator.style.left = `${(pH / 14) * 100}%`;

            phHistory.push(pH);
            if (phHistory.length > 100) phHistory.shift();
        }

        function superscript(n) {
            const sups = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹'];
            return n.toString().split('').map(d => {
                if (d === '-') return '⁻';
                return sups[parseInt(d)];
            }).join('');
        }

        function pHToColor(pH) {
            if (pH < 3) return '#ef4444';
            if (pH < 6) return '#f59e0b';
            if (pH < 8) return '#22c55e';
            if (pH < 11) return '#3b82f6';
            return '#a855f7';
        }

        function update() {
            const w = canvas.width - 400;
            const h = canvas.height - 200;

            // Move particles
            for (const p of particles) {
                p.x += p.vx;
                p.y += p.vy;

                // Random motion
                p.vx += (Math.random() - 0.5) * 0.5;
                p.vy += (Math.random() - 0.5) * 0.5;
                p.vx *= 0.98;
                p.vy *= 0.98;

                // Bounds
                if (p.x < 60) { p.x = 60; p.vx = -p.vx; }
                if (p.x > 40 + w) { p.x = 40 + w; p.vx = -p.vx; }
                if (p.y < 60) { p.y = 60; p.vy = -p.vy; }
                if (p.y > 40 + h) { p.y = 40 + h; p.vy = -p.vy; }
            }
        }

        function drawHistory() {
            const graphX = 50;
            const graphY = canvas.height - 180;
            const graphW = canvas.width - 450;
            const graphH = 150;

            ctx.fillStyle = 'rgba(0,0,0,0.4)';
            ctx.fillRect(graphX - 10, graphY - 30, graphW + 20, graphH + 50);

            ctx.fillStyle = '#fff';
            ctx.font = '14px sans-serif';
            ctx.fillText('pH Over Time', graphX, graphY - 10);

            if (phHistory.length < 2) return;

            // pH = 7 line
            ctx.setLineDash([5, 5]);
            ctx.strokeStyle = '#666';
            ctx.beginPath();
            const y7 = graphY + graphH - (7 / 14) * graphH;
            ctx.moveTo(graphX, y7);
            ctx.lineTo(graphX + graphW, y7);
            ctx.stroke();
            ctx.setLineDash([]);

            // pH line
            ctx.beginPath();
            ctx.lineWidth = 2;
            for (let i = 0; i < phHistory.length; i++) {
                const x = graphX + (i / (phHistory.length - 1)) * graphW;
                const y = graphY + graphH - (phHistory[i] / 14) * graphH;
                ctx.strokeStyle = pHToColor(phHistory[i]);
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();

            // Labels
            ctx.fillStyle = '#888';
            ctx.font = '10px sans-serif';
            ctx.textAlign = 'right';
            ctx.fillText('14', graphX - 5, graphY + 5);
            ctx.fillText('7', graphX - 5, y7 + 3);
            ctx.fillText('0', graphX - 5, graphY + graphH);
        }

        function draw() {
            ctx.fillStyle = '#0f172a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            update();

            const w = canvas.width - 400;
            const h = canvas.height - 200;
            const pH = -Math.log10(hConcentration);

            // Draw solution container with pH color
            const gradient = ctx.createLinearGradient(50, 50, 50, 50 + h);
            gradient.addColorStop(0, pHToColor(pH) + '40');
            gradient.addColorStop(1, pHToColor(pH) + '80');
            ctx.fillStyle = gradient;
            ctx.fillRect(50, 50, w, h);

            ctx.strokeStyle = '#10b981';
            ctx.lineWidth = 2;
            ctx.strokeRect(50, 50, w, h);

            // Draw particles
            for (const p of particles) {
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.type === 'HA' || p.type === 'A-' ? 8 : 5, 0, Math.PI * 2);

                switch (p.type) {
                    case 'H+':
                        ctx.fillStyle = '#ef4444';
                        break;
                    case 'OH-':
                        ctx.fillStyle = '#3b82f6';
                        break;
                    case 'HA':
                        ctx.fillStyle = '#f59e0b';
                        break;
                    case 'A-':
                        ctx.fillStyle = '#a855f7';
                        break;
                }
                ctx.fill();

                // Labels
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 8px sans-serif';
                ctx.textAlign = 'center';
                if (p.type === 'H+') ctx.fillText('H⁺', p.x, p.y + 3);
                else if (p.type === 'OH-') ctx.fillText('OH⁻', p.x, p.y + 3);
            }

            drawHistory();

            // Legend
            const legX = canvas.width - 340;
            const legY = 400;
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'left';

            ctx.fillStyle = '#ef4444';
            ctx.beginPath(); ctx.arc(legX, legY, 5, 0, Math.PI * 2); ctx.fill();
            ctx.fillStyle = '#888';
            ctx.fillText('H⁺ (Hydrogen ion)', legX + 15, legY + 4);

            ctx.fillStyle = '#3b82f6';
            ctx.beginPath(); ctx.arc(legX, legY + 25, 5, 0, Math.PI * 2); ctx.fill();
            ctx.fillStyle = '#888';
            ctx.fillText('OH⁻ (Hydroxide ion)', legX + 15, legY + 29);

            if (solutionType === 'buffer') {
                ctx.fillStyle = '#f59e0b';
                ctx.beginPath(); ctx.arc(legX, legY + 50, 5, 0, Math.PI * 2); ctx.fill();
                ctx.fillStyle = '#888';
                ctx.fillText('HA (Weak acid)', legX + 15, legY + 54);

                ctx.fillStyle = '#a855f7';
                ctx.beginPath(); ctx.arc(legX, legY + 75, 5, 0, Math.PI * 2); ctx.fill();
                ctx.fillStyle = '#888';
                ctx.fillText('A⁻ (Conjugate base)', legX + 15, legY + 79);
            }

            // Title
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 18px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('pH & Buffer Solutions', 50, 30);

            requestAnimationFrame(draw);
        }

        // Event listeners
        document.getElementById('solutionType').onchange = (e) => {
            solutionType = e.target.value;
            initSolution();
        };

        document.getElementById('bufferConc').oninput = (e) => {
            bufferConc = parseFloat(e.target.value);
            document.getElementById('bufferValue').textContent = bufferConc.toFixed(2);
            if (solutionType === 'buffer') initSolution();
        };

        document.getElementById('addAcidBtn').onclick = addAcid;
        document.getElementById('addBaseBtn').onclick = addBase;
        document.getElementById('resetBtn').onclick = initSolution;

        // Initialize
        initSolution();
        draw();
    </script>
</body>
</html>
