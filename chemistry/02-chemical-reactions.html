<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chemical Reactions | Chemistry</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
            color: #e0e0e0;
            min-height: 100vh;
            overflow: hidden;
        }
        #canvas { display: block; }
        .controls {
            position: fixed;
            top: 20px; right: 20px;
            background: rgba(0,0,0,0.85);
            padding: 20px; border-radius: 15px;
            min-width: 280px;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        h1 { color: #10b981; font-size: 1.3em; margin-bottom: 15px; }
        .control-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; color: #aaa; font-size: 0.9em; }
        input[type="range"], select { width: 100%; }
        .value { float: right; color: #10b981; }
        button {
            width: 100%; padding: 10px; margin: 5px 0;
            border: none; border-radius: 8px;
            background: #10b981; color: white;
            font-weight: bold; cursor: pointer;
        }
        button:hover { background: #34d399; }
        .stats { margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); }
        .stat-row { display: flex; justify-content: space-between; padding: 5px 0; font-size: 0.9em; }
        .stat-label { color: #888; }
        .stat-value { color: #10b981; font-weight: bold; }
        .info { font-size: 0.8em; color: #666; margin-top: 15px; line-height: 1.5; }
        a.back-link {
            position: fixed; top: 20px; left: 20px;
            color: #10b981; text-decoration: none;
            background: rgba(0,0,0,0.8); padding: 10px 20px;
            border-radius: 25px; font-size: 0.9em;
        }
        .legend { margin-top: 15px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1); }
        .legend-item { display: flex; align-items: center; gap: 8px; margin: 5px 0; font-size: 0.85em; }
        .legend-color { width: 15px; height: 15px; border-radius: 50%; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <a href="index.html" class="back-link">← Back to Chemistry</a>

    <div class="controls">
        <h1>Chemical Reactions</h1>
        <p style="font-size:0.85em; color:#888; margin-bottom:15px;">A + B ⇌ C equilibrium</p>

        <div class="control-group">
            <label>Initial A Molecules: <span class="value" id="aValue">50</span></label>
            <input type="range" id="initA" min="20" max="100" step="5" value="50">
        </div>

        <div class="control-group">
            <label>Initial B Molecules: <span class="value" id="bValue">50</span></label>
            <input type="range" id="initB" min="20" max="100" step="5" value="50">
        </div>

        <div class="control-group">
            <label>Forward Rate (k₁): <span class="value" id="k1Value">0.05</span></label>
            <input type="range" id="k1" min="0.01" max="0.2" step="0.01" value="0.05">
        </div>

        <div class="control-group">
            <label>Reverse Rate (k₋₁): <span class="value" id="k2Value">0.02</span></label>
            <input type="range" id="k2" min="0.005" max="0.1" step="0.005" value="0.02">
        </div>

        <div class="control-group">
            <label>Temperature: <span class="value" id="tempValue">1.0</span></label>
            <input type="range" id="temp" min="0.5" max="2" step="0.1" value="1.0">
        </div>

        <button id="runBtn">Start Reaction</button>
        <button id="resetBtn" style="background:#444;color:#fff">Reset</button>

        <div class="stats">
            <div class="stat-row">
                <span class="stat-label" style="color:#ef4444">[A]</span>
                <span class="stat-value" style="color:#ef4444" id="concA">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label" style="color:#3b82f6">[B]</span>
                <span class="stat-value" style="color:#3b82f6" id="concB">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label" style="color:#a855f7">[C]</span>
                <span class="stat-value" style="color:#a855f7" id="concC">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">K_eq</span>
                <span class="stat-value" id="keq">0</span>
            </div>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background:#ef4444"></div>
                <span>A (Reactant)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background:#3b82f6"></div>
                <span>B (Reactant)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background:#a855f7"></div>
                <span>C (Product)</span>
            </div>
        </div>

        <div class="info">
            <strong>Equilibrium:</strong> K = k₁/k₋₁ = [C]/([A][B])<br>
            <strong>Collision:</strong> A + B must collide to react.
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            initMolecules();
        }
        resize();
        window.onresize = resize;

        let molecules = [];
        let initA = 50;
        let initB = 50;
        let k1 = 0.05;
        let k2 = 0.02;
        let temperature = 1.0;
        let running = false;
        let timeStep = 0;
        let history = [];

        function initMolecules() {
            molecules = [];
            history = [];
            timeStep = 0;

            const w = canvas.width - 400;
            const h = canvas.height - 200;

            for (let i = 0; i < initA; i++) {
                molecules.push(createMolecule('A', w, h));
            }

            for (let i = 0; i < initB; i++) {
                molecules.push(createMolecule('B', w, h));
            }

            updateStats();
        }

        function createMolecule(type, w, h) {
            const speed = Math.sqrt(temperature) * (1 + Math.random());
            const angle = Math.random() * 2 * Math.PI;

            return {
                type,
                x: 100 + Math.random() * (w - 100),
                y: 100 + Math.random() * (h - 100),
                vx: speed * Math.cos(angle),
                vy: speed * Math.sin(angle),
                radius: type === 'C' ? 15 : 10
            };
        }

        function checkCollision(m1, m2) {
            const dx = m2.x - m1.x;
            const dy = m2.y - m1.y;
            const dist = Math.sqrt(dx * dx + dy * dy);
            return dist < m1.radius + m2.radius;
        }

        function update() {
            if (!running) return;

            const w = canvas.width - 400;
            const h = canvas.height - 200;

            // Move molecules
            for (const m of molecules) {
                m.x += m.vx;
                m.y += m.vy;

                // Wall collisions
                if (m.x < 50 + m.radius) { m.x = 50 + m.radius; m.vx = -m.vx; }
                if (m.x > 50 + w - m.radius) { m.x = 50 + w - m.radius; m.vx = -m.vx; }
                if (m.y < 50 + m.radius) { m.y = 50 + m.radius; m.vy = -m.vy; }
                if (m.y > 50 + h - m.radius) { m.y = 50 + h - m.radius; m.vy = -m.vy; }
            }

            // Check for reactions
            const toRemove = [];
            const toAdd = [];

            // Forward reaction: A + B -> C
            const typeA = molecules.filter(m => m.type === 'A' && !toRemove.includes(m));
            const typeB = molecules.filter(m => m.type === 'B' && !toRemove.includes(m));

            for (const a of typeA) {
                for (const b of typeB) {
                    if (toRemove.includes(a) || toRemove.includes(b)) continue;

                    if (checkCollision(a, b)) {
                        if (Math.random() < k1 * temperature) {
                            toRemove.push(a, b);
                            toAdd.push({
                                type: 'C',
                                x: (a.x + b.x) / 2,
                                y: (a.y + b.y) / 2,
                                vx: (a.vx + b.vx) / 2,
                                vy: (a.vy + b.vy) / 2,
                                radius: 15
                            });
                        } else {
                            // Elastic collision
                            const temp = a.vx;
                            a.vx = b.vx;
                            b.vx = temp;
                            const temp2 = a.vy;
                            a.vy = b.vy;
                            b.vy = temp2;
                        }
                    }
                }
            }

            // Reverse reaction: C -> A + B
            const typeC = molecules.filter(m => m.type === 'C' && !toRemove.includes(m));
            for (const c of typeC) {
                if (Math.random() < k2 * temperature) {
                    toRemove.push(c);
                    const angle1 = Math.random() * Math.PI * 2;
                    const angle2 = angle1 + Math.PI;
                    const speed = Math.sqrt(temperature);

                    toAdd.push({
                        type: 'A',
                        x: c.x + Math.cos(angle1) * 15,
                        y: c.y + Math.sin(angle1) * 15,
                        vx: speed * Math.cos(angle1),
                        vy: speed * Math.sin(angle1),
                        radius: 10
                    });
                    toAdd.push({
                        type: 'B',
                        x: c.x + Math.cos(angle2) * 15,
                        y: c.y + Math.sin(angle2) * 15,
                        vx: speed * Math.cos(angle2),
                        vy: speed * Math.sin(angle2),
                        radius: 10
                    });
                }
            }

            molecules = molecules.filter(m => !toRemove.includes(m));
            molecules.push(...toAdd);

            timeStep++;
            updateStats();
        }

        function updateStats() {
            const countA = molecules.filter(m => m.type === 'A').length;
            const countB = molecules.filter(m => m.type === 'B').length;
            const countC = molecules.filter(m => m.type === 'C').length;

            document.getElementById('concA').textContent = countA;
            document.getElementById('concB').textContent = countB;
            document.getElementById('concC').textContent = countC;

            const keq = countA > 0 && countB > 0 ? (countC / (countA * countB)).toFixed(4) : '∞';
            document.getElementById('keq').textContent = keq;

            history.push({ a: countA, b: countB, c: countC });
            if (history.length > 300) history.shift();
        }

        function drawHistory() {
            const graphX = 50;
            const graphY = canvas.height - 180;
            const graphW = canvas.width - 450;
            const graphH = 150;

            ctx.fillStyle = 'rgba(0,0,0,0.4)';
            ctx.fillRect(graphX - 10, graphY - 30, graphW + 20, graphH + 50);

            ctx.fillStyle = '#fff';
            ctx.font = '14px sans-serif';
            ctx.fillText('Concentration Over Time', graphX, graphY - 10);

            if (history.length < 2) return;

            const maxConc = Math.max(...history.flatMap(h => [h.a, h.b, h.c]), 1);

            // A concentration
            ctx.beginPath();
            ctx.strokeStyle = '#ef4444';
            ctx.lineWidth = 2;
            for (let i = 0; i < history.length; i++) {
                const x = graphX + (i / (history.length - 1)) * graphW;
                const y = graphY + graphH - (history[i].a / maxConc) * graphH;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();

            // B concentration
            ctx.beginPath();
            ctx.strokeStyle = '#3b82f6';
            for (let i = 0; i < history.length; i++) {
                const x = graphX + (i / (history.length - 1)) * graphW;
                const y = graphY + graphH - (history[i].b / maxConc) * graphH;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();

            // C concentration
            ctx.beginPath();
            ctx.strokeStyle = '#a855f7';
            for (let i = 0; i < history.length; i++) {
                const x = graphX + (i / (history.length - 1)) * graphW;
                const y = graphY + graphH - (history[i].c / maxConc) * graphH;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
        }

        function draw() {
            ctx.fillStyle = '#0f172a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            update();

            const w = canvas.width - 400;
            const h = canvas.height - 200;

            // Draw container
            ctx.strokeStyle = '#10b981';
            ctx.lineWidth = 2;
            ctx.strokeRect(50, 50, w, h);

            // Draw molecules
            for (const m of molecules) {
                ctx.beginPath();
                ctx.arc(m.x, m.y, m.radius, 0, Math.PI * 2);

                switch (m.type) {
                    case 'A':
                        ctx.fillStyle = '#ef4444';
                        break;
                    case 'B':
                        ctx.fillStyle = '#3b82f6';
                        break;
                    case 'C':
                        ctx.fillStyle = '#a855f7';
                        break;
                }
                ctx.fill();

                // Label
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 10px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(m.type, m.x, m.y + 4);
            }

            drawHistory();

            // Title
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 18px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('Chemical Reaction: A + B ⇌ C', 50, 30);

            requestAnimationFrame(draw);
        }

        // Event listeners
        document.getElementById('initA').oninput = (e) => {
            initA = parseInt(e.target.value);
            document.getElementById('aValue').textContent = initA;
        };

        document.getElementById('initB').oninput = (e) => {
            initB = parseInt(e.target.value);
            document.getElementById('bValue').textContent = initB;
        };

        document.getElementById('k1').oninput = (e) => {
            k1 = parseFloat(e.target.value);
            document.getElementById('k1Value').textContent = k1.toFixed(2);
        };

        document.getElementById('k2').oninput = (e) => {
            k2 = parseFloat(e.target.value);
            document.getElementById('k2Value').textContent = k2.toFixed(3);
        };

        document.getElementById('temp').oninput = (e) => {
            temperature = parseFloat(e.target.value);
            document.getElementById('tempValue').textContent = temperature.toFixed(1);
        };

        document.getElementById('runBtn').onclick = () => {
            running = !running;
            document.getElementById('runBtn').textContent = running ? 'Pause' : 'Start Reaction';
        };

        document.getElementById('resetBtn').onclick = initMolecules;

        // Initialize
        initMolecules();
        draw();
    </script>
</body>
</html>
