<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chemical Equilibrium - Chemistry</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); color: #eee; min-height: 100vh; padding: 20px; }
        .back-link { position: fixed; top: 20px; left: 20px; color: #60a5fa; text-decoration: none; font-weight: 600; padding: 8px 16px; background: rgba(0,0,0,0.3); border-radius: 20px; z-index: 100; }
        h1 { text-align: center; margin: 40px 0 10px; font-size: 2.2em; color: #60a5fa; }
        .subtitle { text-align: center; opacity: 0.8; margin-bottom: 20px; }
        .container { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 1fr 300px; gap: 20px; }
        .panel { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 25px; }
        .info-box { background: rgba(96, 165, 250, 0.1); border: 1px solid rgba(96, 165, 250, 0.3); border-radius: 8px; padding: 15px; margin-bottom: 20px; font-size: 0.85em; line-height: 1.6; }
        h3 { color: #60a5fa; margin-bottom: 15px; }
        canvas { width: 100%; border-radius: 8px; }
        .control-group { margin: 15px 0; }
        .control-group label { display: block; margin-bottom: 5px; }
        .control-group input, .control-group select { width: 100%; }
        .value-display { color: #60a5fa; font-family: monospace; }
        button { width: 100%; padding: 12px; margin: 8px 0; border: none; border-radius: 8px; font-size: 1em; font-weight: 600; cursor: pointer; }
        .btn-primary { background: #60a5fa; color: #1a1a2e; }
        .btn-danger { background: #f87171; color: #fff; }
        .btn-secondary { background: rgba(255,255,255,0.1); color: #fff; }
        .equation { font-family: 'Times New Roman', serif; font-size: 1.2em; text-align: center; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 8px; margin: 15px 0; }
        .concentration-bars { display: flex; gap: 10px; margin: 15px 0; }
        .conc-bar { flex: 1; text-align: center; }
        .conc-bar-fill { height: 100px; background: rgba(255,255,255,0.1); border-radius: 8px; position: relative; overflow: hidden; }
        .conc-bar-level { position: absolute; bottom: 0; left: 0; right: 0; transition: height 0.3s; border-radius: 0 0 8px 8px; }
        @media (max-width: 900px) { .container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back</a>
    <h1>Chemical Equilibrium</h1>
    <p class="subtitle">Le Chatelier's principle and dynamic balance</p>

    <div class="container">
        <div class="panel">
            <canvas id="canvas" width="800" height="350"></canvas>
            <canvas id="chartCanvas" width="800" height="150" style="margin-top: 15px;"></canvas>
        </div>

        <div class="panel">
            <div class="info-box">
                <strong>Le Chatelier's Principle:</strong>
                When a system at equilibrium is disturbed, it shifts to
                counteract the change. Changes in concentration, temperature,
                or pressure will shift the equilibrium position.
            </div>

            <div class="equation">
                A + B ⇌ C + D
            </div>

            <h3>Concentrations</h3>
            <div class="concentration-bars">
                <div class="conc-bar">
                    <div class="conc-bar-fill">
                        <div class="conc-bar-level" id="barA" style="height: 50%; background: #60a5fa;"></div>
                    </div>
                    <div style="margin-top: 5px;">[A]</div>
                </div>
                <div class="conc-bar">
                    <div class="conc-bar-fill">
                        <div class="conc-bar-level" id="barB" style="height: 50%; background: #4ade80;"></div>
                    </div>
                    <div style="margin-top: 5px;">[B]</div>
                </div>
                <div class="conc-bar">
                    <div class="conc-bar-fill">
                        <div class="conc-bar-level" id="barC" style="height: 30%; background: #f87171;"></div>
                    </div>
                    <div style="margin-top: 5px;">[C]</div>
                </div>
                <div class="conc-bar">
                    <div class="conc-bar-fill">
                        <div class="conc-bar-level" id="barD" style="height: 30%; background: #facc15;"></div>
                    </div>
                    <div style="margin-top: 5px;">[D]</div>
                </div>
            </div>

            <div class="control-group">
                <label>Forward Rate (kf): <span class="value-display" id="kfVal">0.5</span></label>
                <input type="range" id="kfSlider" min="1" max="20" value="5" oninput="updateParams()">
            </div>

            <div class="control-group">
                <label>Reverse Rate (kr): <span class="value-display" id="krVal">0.5</span></label>
                <input type="range" id="krSlider" min="1" max="20" value="5" oninput="updateParams()">
            </div>

            <div class="control-group">
                <label>Temperature: <span class="value-display" id="tempVal">300</span> K</label>
                <input type="range" id="tempSlider" min="200" max="500" value="300" oninput="updateParams()">
            </div>

            <button class="btn-primary" onclick="addReactant('A')">Add Reactant A</button>
            <button class="btn-secondary" onclick="addReactant('C')">Add Product C</button>
            <button class="btn-danger" onclick="removeSpecies()">Remove Product</button>
            <button class="btn-secondary" onclick="resetSim()">Reset</button>

            <h3 style="margin-top: 15px;">Equilibrium</h3>
            <div style="font-size: 0.9em;">
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>K (equilibrium const):</span><span class="value-display" id="kVal">1.00</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Q (reaction quotient):</span><span class="value-display" id="qVal">1.00</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Direction:</span><span class="value-display" id="dirVal">At Equilibrium</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Time:</span><span class="value-display" id="timeVal">0</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const chartCanvas = document.getElementById('chartCanvas');
        const cctx = chartCanvas.getContext('2d');

        // Concentrations
        let conc = { A: 1.0, B: 1.0, C: 0.2, D: 0.2 };
        let kf = 0.5; // Forward rate constant
        let kr = 0.5; // Reverse rate constant
        let temperature = 300;
        let time = 0;
        let history = [];
        let particles = [];

        const colors = {
            A: '#60a5fa',
            B: '#4ade80',
            C: '#f87171',
            D: '#facc15'
        };

        function updateParams() {
            kf = parseInt(document.getElementById('kfSlider').value) / 10;
            kr = parseInt(document.getElementById('krSlider').value) / 10;
            temperature = parseInt(document.getElementById('tempSlider').value);

            document.getElementById('kfVal').textContent = kf.toFixed(1);
            document.getElementById('krVal').textContent = kr.toFixed(1);
            document.getElementById('tempVal').textContent = temperature;

            // Temperature affects rates (Arrhenius)
            const tempFactor = Math.exp((temperature - 300) / 100);
            // Forward reaction is exothermic, so higher temp shifts left
        }

        function initParticles() {
            particles = [];
            const types = ['A', 'B', 'C', 'D'];

            for (const type of types) {
                const count = Math.round(conc[type] * 30);
                for (let i = 0; i < count; i++) {
                    particles.push({
                        type: type,
                        x: Math.random() * canvas.width,
                        y: Math.random() * canvas.height,
                        vx: (Math.random() - 0.5) * 3,
                        vy: (Math.random() - 0.5) * 3
                    });
                }
            }
        }

        function updateReaction() {
            time++;

            // Rate equations
            const forwardRate = kf * conc.A * conc.B;
            const reverseRate = kr * conc.C * conc.D;

            const dt = 0.01;
            const dA = (-forwardRate + reverseRate) * dt;

            conc.A += dA;
            conc.B += dA;
            conc.C -= dA;
            conc.D -= dA;

            // Clamp concentrations
            for (const key of ['A', 'B', 'C', 'D']) {
                conc[key] = Math.max(0.01, Math.min(2, conc[key]));
            }

            // Update particle counts
            syncParticles();

            // Record history
            history.push({
                t: time,
                A: conc.A,
                B: conc.B,
                C: conc.C,
                D: conc.D
            });
            if (history.length > 300) history.shift();

            updateDisplay();
        }

        function syncParticles() {
            const types = ['A', 'B', 'C', 'D'];
            for (const type of types) {
                const targetCount = Math.round(conc[type] * 30);
                const currentCount = particles.filter(p => p.type === type).length;

                if (currentCount < targetCount) {
                    // Add particles
                    for (let i = 0; i < targetCount - currentCount; i++) {
                        particles.push({
                            type: type,
                            x: Math.random() * canvas.width,
                            y: Math.random() * canvas.height,
                            vx: (Math.random() - 0.5) * 3,
                            vy: (Math.random() - 0.5) * 3
                        });
                    }
                } else if (currentCount > targetCount) {
                    // Remove particles
                    let toRemove = currentCount - targetCount;
                    for (let i = particles.length - 1; i >= 0 && toRemove > 0; i--) {
                        if (particles[i].type === type) {
                            particles.splice(i, 1);
                            toRemove--;
                        }
                    }
                }
            }
        }

        function updateDisplay() {
            // Update bars
            document.getElementById('barA').style.height = (conc.A / 2 * 100) + '%';
            document.getElementById('barB').style.height = (conc.B / 2 * 100) + '%';
            document.getElementById('barC').style.height = (conc.C / 2 * 100) + '%';
            document.getElementById('barD').style.height = (conc.D / 2 * 100) + '%';

            // Equilibrium constant K = kf/kr
            const K = kf / kr;
            // Reaction quotient Q = [C][D]/[A][B]
            const Q = (conc.C * conc.D) / (conc.A * conc.B);

            document.getElementById('kVal').textContent = K.toFixed(2);
            document.getElementById('qVal').textContent = Q.toFixed(2);
            document.getElementById('timeVal').textContent = time;

            // Direction
            let direction = 'At Equilibrium';
            if (Q < K * 0.95) direction = '→ Forward';
            else if (Q > K * 1.05) direction = '← Reverse';
            document.getElementById('dirVal').textContent = direction;
        }

        function addReactant(type) {
            conc[type] = Math.min(2, conc[type] + 0.3);
            syncParticles();
            updateDisplay();
        }

        function removeSpecies() {
            conc.C = Math.max(0.05, conc.C - 0.3);
            conc.D = Math.max(0.05, conc.D - 0.3);
            syncParticles();
            updateDisplay();
        }

        function draw() {
            ctx.fillStyle = '#0a0a14';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw container
            ctx.strokeStyle = '#60a5fa';
            ctx.lineWidth = 2;
            ctx.strokeRect(10, 10, canvas.width - 20, canvas.height - 20);

            // Draw equilibrium arrow
            ctx.fillStyle = 'rgba(255,255,255,0.1)';
            ctx.font = '40px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('⇌', canvas.width / 2, canvas.height / 2 + 15);

            // Move and draw particles
            for (const p of particles) {
                p.x += p.vx;
                p.y += p.vy;

                // Bounce
                if (p.x < 20 || p.x > canvas.width - 20) p.vx *= -1;
                if (p.y < 20 || p.y > canvas.height - 20) p.vy *= -1;

                p.x = Math.max(20, Math.min(canvas.width - 20, p.x));
                p.y = Math.max(20, Math.min(canvas.height - 20, p.y));

                // Draw
                ctx.fillStyle = colors[p.type];
                ctx.beginPath();
                ctx.arc(p.x, p.y, 6, 0, Math.PI * 2);
                ctx.fill();

                ctx.fillStyle = '#000';
                ctx.font = 'bold 8px sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(p.type, p.x, p.y);
            }

            // Labels
            ctx.fillStyle = '#fff';
            ctx.font = '14px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('Reactants (A + B)', 20, 30);
            ctx.textAlign = 'right';
            ctx.fillText('Products (C + D)', canvas.width - 20, 30);
        }

        function drawChart() {
            cctx.fillStyle = '#0a0a14';
            cctx.fillRect(0, 0, chartCanvas.width, chartCanvas.height);

            if (history.length < 2) return;

            const scaleX = (chartCanvas.width - 60) / 300;
            const scaleY = (chartCanvas.height - 40) / 2;

            // Draw lines for each species
            const species = ['A', 'B', 'C', 'D'];
            for (const sp of species) {
                cctx.strokeStyle = colors[sp];
                cctx.lineWidth = 2;
                cctx.beginPath();
                history.forEach((h, i) => {
                    const x = 50 + (h.t - history[0].t) * scaleX;
                    const y = chartCanvas.height - 25 - h[sp] * scaleY;
                    if (i === 0) cctx.moveTo(x, y);
                    else cctx.lineTo(x, y);
                });
                cctx.stroke();
            }

            // Axes
            cctx.strokeStyle = 'rgba(255,255,255,0.3)';
            cctx.lineWidth = 1;
            cctx.beginPath();
            cctx.moveTo(50, 10);
            cctx.lineTo(50, chartCanvas.height - 25);
            cctx.lineTo(chartCanvas.width - 10, chartCanvas.height - 25);
            cctx.stroke();

            // Legend
            cctx.font = '11px sans-serif';
            species.forEach((sp, i) => {
                cctx.fillStyle = colors[sp];
                cctx.fillRect(60 + i * 50, 5, 12, 12);
                cctx.fillStyle = '#fff';
                cctx.fillText('[' + sp + ']', 75 + i * 50, 15);
            });
        }

        function resetSim() {
            time = 0;
            history = [];
            conc = { A: 1.0, B: 1.0, C: 0.2, D: 0.2 };
            initParticles();
            updateDisplay();
            draw();
            drawChart();
        }

        function animate() {
            updateReaction();
            draw();
            drawChart();
            requestAnimationFrame(animate);
        }

        updateParams();
        resetSim();
        animate();
    </script>
</body>
</html>
