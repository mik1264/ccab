<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase Transitions | Chemistry</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
            color: #e0e0e0;
            min-height: 100vh;
            overflow: hidden;
        }
        #canvas { display: block; }
        .controls {
            position: fixed;
            top: 20px; right: 20px;
            background: rgba(0,0,0,0.85);
            padding: 20px; border-radius: 15px;
            min-width: 280px;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        h1 { color: #10b981; font-size: 1.3em; margin-bottom: 15px; }
        .control-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; color: #aaa; font-size: 0.9em; }
        input[type="range"], select { width: 100%; }
        .value { float: right; color: #10b981; }
        button {
            width: 100%; padding: 10px; margin: 5px 0;
            border: none; border-radius: 8px;
            background: #10b981; color: white;
            font-weight: bold; cursor: pointer;
        }
        button:hover { background: #34d399; }
        .stats { margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); }
        .stat-row { display: flex; justify-content: space-between; padding: 5px 0; font-size: 0.9em; }
        .stat-label { color: #888; }
        .stat-value { color: #10b981; font-weight: bold; }
        .info { font-size: 0.8em; color: #666; margin-top: 15px; line-height: 1.5; }
        a.back-link {
            position: fixed; top: 20px; left: 20px;
            color: #10b981; text-decoration: none;
            background: rgba(0,0,0,0.8); padding: 10px 20px;
            border-radius: 25px; font-size: 0.9em;
        }
        .phase-indicator {
            display: flex; justify-content: center; gap: 20px;
            margin-top: 15px; padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
        }
        .phase-item {
            text-align: center; font-size: 0.9em;
        }
        .phase-name { font-weight: bold; color: #fff; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <a href="index.html" class="back-link">← Back to Chemistry</a>

    <div class="controls">
        <h1>Phase Transitions</h1>
        <p style="font-size:0.85em; color:#888; margin-bottom:15px;">Solid ↔ Liquid ↔ Gas</p>

        <div class="control-group">
            <label>Temperature: <span class="value" id="tempValue">0.5</span></label>
            <input type="range" id="temperature" min="0.1" max="2.5" step="0.1" value="0.5">
        </div>

        <div class="control-group">
            <label>Pressure: <span class="value" id="pressValue">1.0</span></label>
            <input type="range" id="pressure" min="0.2" max="3" step="0.1" value="1.0">
        </div>

        <div class="control-group">
            <label>Particles: <span class="value" id="particlesValue">100</span></label>
            <input type="range" id="particles" min="50" max="200" step="10" value="100">
        </div>

        <button id="runBtn">Start Simulation</button>
        <button id="resetBtn" style="background:#444;color:#fff">Reset</button>
        <button id="heatBtn" style="background:#ef4444">Add Heat</button>
        <button id="coolBtn" style="background:#3b82f6">Remove Heat</button>

        <div class="phase-indicator">
            <div class="phase-item">
                <div class="phase-name" style="color:#3b82f6">Solid</div>
                <div id="solidCount">0</div>
            </div>
            <div class="phase-item">
                <div class="phase-name" style="color:#22c55e">Liquid</div>
                <div id="liquidCount">0</div>
            </div>
            <div class="phase-item">
                <div class="phase-name" style="color:#ef4444">Gas</div>
                <div id="gasCount">0</div>
            </div>
        </div>

        <div class="stats">
            <div class="stat-row">
                <span class="stat-label">Current Phase</span>
                <span class="stat-value" id="phase">Solid</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Kinetic Energy</span>
                <span class="stat-value" id="kinetic">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Order Parameter</span>
                <span class="stat-value" id="order">0</span>
            </div>
        </div>

        <div class="info">
            <strong>Solid:</strong> Fixed lattice positions.<br>
            <strong>Liquid:</strong> Close but mobile.<br>
            <strong>Gas:</strong> Free expansion.
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            initParticles();
        }
        resize();
        window.onresize = resize;

        let particles = [];
        let nParticles = 100;
        let temperature = 0.5;
        let pressure = 1.0;
        let running = false;
        let timeStep = 0;

        const meltingPoint = 0.8;
        const boilingPoint = 1.5;

        function initParticles() {
            particles = [];
            timeStep = 0;

            const w = canvas.width - 400;
            const h = canvas.height - 100;

            // Start in solid lattice
            const cols = Math.ceil(Math.sqrt(nParticles * w / h));
            const rows = Math.ceil(nParticles / cols);
            const spacing = Math.min(w / cols, h / rows) * 0.8;

            const offsetX = 50 + (w - cols * spacing) / 2;
            const offsetY = 50 + (h - rows * spacing) / 2;

            let idx = 0;
            for (let i = 0; i < rows && idx < nParticles; i++) {
                for (let j = 0; j < cols && idx < nParticles; j++) {
                    particles.push({
                        x: offsetX + j * spacing + spacing / 2,
                        y: offsetY + i * spacing + spacing / 2,
                        homeX: offsetX + j * spacing + spacing / 2,
                        homeY: offsetY + i * spacing + spacing / 2,
                        vx: 0,
                        vy: 0,
                        phase: 'solid'
                    });
                    idx++;
                }
            }

            updatePhases();
        }

        function updatePhases() {
            for (const p of particles) {
                if (temperature < meltingPoint) {
                    p.phase = 'solid';
                } else if (temperature < boilingPoint) {
                    p.phase = 'liquid';
                } else {
                    p.phase = 'gas';
                }
            }
        }

        function computeForces() {
            const w = canvas.width - 400;
            const h = canvas.height - 100;

            for (const p of particles) {
                let fx = 0, fy = 0;

                if (p.phase === 'solid') {
                    // Spring force toward lattice position
                    const springK = 5 * pressure;
                    fx += springK * (p.homeX - p.x);
                    fy += springK * (p.homeY - p.y);
                }

                // Lennard-Jones between particles
                for (const other of particles) {
                    if (other === p) continue;

                    const dx = other.x - p.x;
                    const dy = other.y - p.y;
                    const r2 = dx * dx + dy * dy;
                    const r = Math.sqrt(r2);

                    if (r < 50) {
                        const sigma = p.phase === 'gas' ? 15 : 20;
                        const epsilon = p.phase === 'gas' ? 0.5 : 1.0;

                        if (r > sigma * 0.5) {
                            const sr2 = (sigma * sigma) / r2;
                            const sr6 = sr2 * sr2 * sr2;
                            const sr12 = sr6 * sr6;

                            const force = 24 * epsilon * (2 * sr12 - sr6) / r2;

                            fx -= force * dx * 0.1;
                            fy -= force * dy * 0.1;
                        } else {
                            // Strong repulsion when too close
                            fx -= dx / r * 2;
                            fy -= dy / r * 2;
                        }
                    }
                }

                // Wall pressure
                const wallForce = pressure * 0.5;
                const margin = 60;
                if (p.x < margin) fx += wallForce * (margin - p.x);
                if (p.x > 50 + w - margin) fx -= wallForce * (p.x - (50 + w - margin));
                if (p.y < margin) fy += wallForce * (margin - p.y);
                if (p.y > 50 + h - margin) fy -= wallForce * (p.y - (50 + h - margin));

                // Apply force
                p.vx += fx * 0.01;
                p.vy += fy * 0.01;
            }
        }

        function update() {
            if (!running) return;

            updatePhases();
            computeForces();

            const w = canvas.width - 400;
            const h = canvas.height - 100;

            for (const p of particles) {
                // Thermal motion
                const thermalKick = Math.sqrt(temperature) * 0.5;
                p.vx += (Math.random() - 0.5) * thermalKick;
                p.vy += (Math.random() - 0.5) * thermalKick;

                // Damping (phase-dependent)
                const damping = p.phase === 'solid' ? 0.9 : (p.phase === 'liquid' ? 0.95 : 0.98);
                p.vx *= damping;
                p.vy *= damping;

                // Speed limit
                const maxSpeed = p.phase === 'solid' ? 2 : (p.phase === 'liquid' ? 5 : 10);
                const speed = Math.sqrt(p.vx * p.vx + p.vy * p.vy);
                if (speed > maxSpeed) {
                    p.vx *= maxSpeed / speed;
                    p.vy *= maxSpeed / speed;
                }

                p.x += p.vx;
                p.y += p.vy;

                // Wall boundaries
                if (p.x < 55) { p.x = 55; p.vx = -p.vx * 0.5; }
                if (p.x > 45 + w) { p.x = 45 + w; p.vx = -p.vx * 0.5; }
                if (p.y < 55) { p.y = 55; p.vy = -p.vy * 0.5; }
                if (p.y > 45 + h) { p.y = 45 + h; p.vy = -p.vy * 0.5; }
            }

            timeStep++;
            updateStats();
        }

        function updateStats() {
            const solidCount = particles.filter(p => p.phase === 'solid').length;
            const liquidCount = particles.filter(p => p.phase === 'liquid').length;
            const gasCount = particles.filter(p => p.phase === 'gas').length;

            document.getElementById('solidCount').textContent = solidCount;
            document.getElementById('liquidCount').textContent = liquidCount;
            document.getElementById('gasCount').textContent = gasCount;

            let kinetic = 0;
            for (const p of particles) {
                kinetic += 0.5 * (p.vx * p.vx + p.vy * p.vy);
            }

            // Order parameter (how crystalline)
            let order = 0;
            for (const p of particles) {
                const dx = p.x - p.homeX;
                const dy = p.y - p.homeY;
                const dist = Math.sqrt(dx * dx + dy * dy);
                order += Math.exp(-dist / 20);
            }
            order /= particles.length;

            const mainPhase = temperature < meltingPoint ? 'Solid' :
                             (temperature < boilingPoint ? 'Liquid' : 'Gas');

            document.getElementById('phase').textContent = mainPhase;
            document.getElementById('kinetic').textContent = kinetic.toFixed(1);
            document.getElementById('order').textContent = order.toFixed(2);
        }

        function draw() {
            ctx.fillStyle = '#0f172a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            update();

            const w = canvas.width - 400;
            const h = canvas.height - 100;

            // Draw container
            ctx.strokeStyle = '#10b981';
            ctx.lineWidth = 2;
            ctx.strokeRect(50, 50, w, h);

            // Draw particles
            for (const p of particles) {
                ctx.beginPath();

                let color, radius;
                switch (p.phase) {
                    case 'solid':
                        color = '#3b82f6';
                        radius = 10;
                        break;
                    case 'liquid':
                        color = '#22c55e';
                        radius = 8;
                        break;
                    case 'gas':
                        color = '#ef4444';
                        radius = 6;
                        break;
                }

                ctx.arc(p.x, p.y, radius, 0, Math.PI * 2);
                ctx.fillStyle = color;
                ctx.fill();

                // Velocity trail for gas
                if (p.phase === 'gas') {
                    ctx.beginPath();
                    ctx.moveTo(p.x, p.y);
                    ctx.lineTo(p.x - p.vx * 3, p.y - p.vy * 3);
                    ctx.strokeStyle = 'rgba(239, 68, 68, 0.3)';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
            }

            // Draw phase diagram indicator
            const pdX = canvas.width - 330;
            const pdY = canvas.height - 200;
            const pdW = 120;
            const pdH = 100;

            ctx.fillStyle = 'rgba(0,0,0,0.4)';
            ctx.fillRect(pdX - 10, pdY - 20, pdW + 20, pdH + 40);

            ctx.fillStyle = '#fff';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Phase Diagram', pdX + pdW / 2, pdY - 5);

            // Axes
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(pdX, pdY + pdH);
            ctx.lineTo(pdX + pdW, pdY + pdH);
            ctx.moveTo(pdX, pdY + pdH);
            ctx.lineTo(pdX, pdY);
            ctx.stroke();

            ctx.font = '9px sans-serif';
            ctx.fillText('T', pdX + pdW / 2, pdY + pdH + 12);
            ctx.save();
            ctx.translate(pdX - 8, pdY + pdH / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('P', 0, 0);
            ctx.restore();

            // Phase regions
            ctx.fillStyle = 'rgba(59, 130, 246, 0.3)';
            ctx.fillRect(pdX, pdY, pdW * 0.3, pdH);
            ctx.fillStyle = 'rgba(34, 197, 94, 0.3)';
            ctx.fillRect(pdX + pdW * 0.3, pdY, pdW * 0.35, pdH);
            ctx.fillStyle = 'rgba(239, 68, 68, 0.3)';
            ctx.fillRect(pdX + pdW * 0.65, pdY, pdW * 0.35, pdH);

            // Current state point
            const stateX = pdX + (temperature / 2.5) * pdW;
            const stateY = pdY + pdH - (pressure / 3) * pdH;
            ctx.beginPath();
            ctx.arc(stateX, stateY, 5, 0, Math.PI * 2);
            ctx.fillStyle = '#fff';
            ctx.fill();

            // Title
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 18px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('Phase Transitions', 50, 30);

            requestAnimationFrame(draw);
        }

        // Event listeners
        document.getElementById('temperature').oninput = (e) => {
            temperature = parseFloat(e.target.value);
            document.getElementById('tempValue').textContent = temperature.toFixed(1);
        };

        document.getElementById('pressure').oninput = (e) => {
            pressure = parseFloat(e.target.value);
            document.getElementById('pressValue').textContent = pressure.toFixed(1);
        };

        document.getElementById('particles').oninput = (e) => {
            nParticles = parseInt(e.target.value);
            document.getElementById('particlesValue').textContent = nParticles;
        };

        document.getElementById('runBtn').onclick = () => {
            running = !running;
            document.getElementById('runBtn').textContent = running ? 'Pause' : 'Start Simulation';
        };

        document.getElementById('resetBtn').onclick = initParticles;

        document.getElementById('heatBtn').onclick = () => {
            temperature = Math.min(2.5, temperature + 0.2);
            document.getElementById('temperature').value = temperature;
            document.getElementById('tempValue').textContent = temperature.toFixed(1);
        };

        document.getElementById('coolBtn').onclick = () => {
            temperature = Math.max(0.1, temperature - 0.2);
            document.getElementById('temperature').value = temperature;
            document.getElementById('tempValue').textContent = temperature.toFixed(1);
        };

        // Initialize
        initParticles();
        draw();
    </script>
</body>
</html>
