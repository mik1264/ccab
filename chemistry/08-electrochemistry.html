<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Electrochemistry | Chemistry</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
            color: #e0e0e0;
            min-height: 100vh;
            overflow: hidden;
        }
        #canvas { display: block; }
        .controls {
            position: fixed;
            top: 20px; right: 20px;
            background: rgba(0,0,0,0.85);
            padding: 20px; border-radius: 15px;
            min-width: 280px;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        h1 { color: #10b981; font-size: 1.3em; margin-bottom: 15px; }
        .control-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; color: #aaa; font-size: 0.9em; }
        input[type="range"], select { width: 100%; }
        .value { float: right; color: #10b981; }
        button {
            width: 100%; padding: 10px; margin: 5px 0;
            border: none; border-radius: 8px;
            background: #10b981; color: white;
            font-weight: bold; cursor: pointer;
        }
        button:hover { background: #34d399; }
        .stats { margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); }
        .stat-row { display: flex; justify-content: space-between; padding: 5px 0; font-size: 0.9em; }
        .stat-label { color: #888; }
        .stat-value { color: #10b981; font-weight: bold; }
        .info { font-size: 0.8em; color: #666; margin-top: 15px; line-height: 1.5; }
        a.back-link {
            position: fixed; top: 20px; left: 20px;
            color: #10b981; text-decoration: none;
            background: rgba(0,0,0,0.8); padding: 10px 20px;
            border-radius: 25px; font-size: 0.9em;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <a href="index.html" class="back-link">← Back to Chemistry</a>

    <div class="controls">
        <h1>Electrochemistry</h1>
        <p style="font-size:0.85em; color:#888; margin-bottom:15px;">Galvanic cell simulation</p>

        <div class="control-group">
            <label>Cell Type</label>
            <select id="cellType">
                <option value="zn-cu">Zinc-Copper (Daniell Cell)</option>
                <option value="mg-cu">Magnesium-Copper</option>
                <option value="zn-ag">Zinc-Silver</option>
            </select>
        </div>

        <div class="control-group">
            <label>Electrolyte Concentration: <span class="value" id="concValue">1.0</span> M</label>
            <input type="range" id="concentration" min="0.1" max="2.0" step="0.1" value="1.0">
        </div>

        <div class="control-group">
            <label>External Resistance: <span class="value" id="resistValue">100</span> Ω</label>
            <input type="range" id="resistance" min="10" max="500" step="10" value="100">
        </div>

        <button id="runBtn">Connect Circuit</button>
        <button id="resetBtn" style="background:#444;color:#fff">Reset</button>

        <div class="stats">
            <div class="stat-row">
                <span class="stat-label">Cell Voltage (E°)</span>
                <span class="stat-value" id="voltage">0 V</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Current</span>
                <span class="stat-value" id="current">0 mA</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Anode Mass Lost</span>
                <span class="stat-value" id="anodeMass">0 g</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Cathode Mass Gained</span>
                <span class="stat-value" id="cathodeMass">0 g</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Electrons Transferred</span>
                <span class="stat-value" id="electrons">0</span>
            </div>
        </div>

        <div class="info">
            <strong>Anode:</strong> Oxidation (loses electrons).<br>
            <strong>Cathode:</strong> Reduction (gains electrons).
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resize();
        window.onresize = resize;

        const cellData = {
            'zn-cu': {
                anode: { name: 'Zn', color: '#94a3b8', E: -0.76, mass: 65.38, n: 2 },
                cathode: { name: 'Cu', color: '#f59e0b', E: 0.34, mass: 63.55, n: 2 },
                anolyte: 'ZnSO₄',
                catholyte: 'CuSO₄'
            },
            'mg-cu': {
                anode: { name: 'Mg', color: '#d1d5db', E: -2.37, mass: 24.31, n: 2 },
                cathode: { name: 'Cu', color: '#f59e0b', E: 0.34, mass: 63.55, n: 2 },
                anolyte: 'MgSO₄',
                catholyte: 'CuSO₄'
            },
            'zn-ag': {
                anode: { name: 'Zn', color: '#94a3b8', E: -0.76, mass: 65.38, n: 2 },
                cathode: { name: 'Ag', color: '#e5e7eb', E: 0.80, mass: 107.87, n: 1 },
                anolyte: 'ZnSO₄',
                catholyte: 'AgNO₃'
            }
        };

        let cellType = 'zn-cu';
        let concentration = 1.0;
        let resistance = 100;
        let running = false;
        let timeStep = 0;
        let electronsMoved = 0;
        let anodeMassLost = 0;
        let cathodeMassGained = 0;

        let ions = [];
        let electrons = [];
        let bubbles = [];

        function initCell() {
            ions = [];
            electrons = [];
            bubbles = [];
            timeStep = 0;
            electronsMoved = 0;
            anodeMassLost = 0;
            cathodeMassGained = 0;

            const w = canvas.width - 400;
            const h = canvas.height - 100;

            // Create initial ions
            const nIons = Math.floor(concentration * 30);

            // Anolyte ions
            for (let i = 0; i < nIons; i++) {
                ions.push({
                    x: 80 + Math.random() * (w / 2 - 80),
                    y: 200 + Math.random() * (h - 280),
                    vx: (Math.random() - 0.5) * 2,
                    vy: (Math.random() - 0.5) * 2,
                    type: 'cation',
                    side: 'anode',
                    charge: 2
                });
            }

            // Catholyte ions
            for (let i = 0; i < nIons; i++) {
                ions.push({
                    x: w / 2 + 40 + Math.random() * (w / 2 - 80),
                    y: 200 + Math.random() * (h - 280),
                    vx: (Math.random() - 0.5) * 2,
                    vy: (Math.random() - 0.5) * 2,
                    type: 'cation',
                    side: 'cathode',
                    charge: 2
                });
            }

            updateStats();
        }

        function getCellVoltage() {
            const cell = cellData[cellType];
            return cell.cathode.E - cell.anode.E;
        }

        function getCurrent() {
            const voltage = getCellVoltage();
            return (voltage / resistance) * 1000; // mA
        }

        function update() {
            if (!running) return;

            const w = canvas.width - 400;
            const h = canvas.height - 100;
            const cell = cellData[cellType];
            const current = getCurrent();

            // Electron flow rate based on current
            const electronRate = current * 0.01;

            // Generate electrons at anode
            if (Math.random() < electronRate) {
                electrons.push({
                    x: 100,
                    y: 80,
                    progress: 0
                });

                // Metal ion released from anode
                ions.push({
                    x: 100 + (Math.random() - 0.5) * 20,
                    y: 200 + Math.random() * 50,
                    vx: Math.random() * 2,
                    vy: (Math.random() - 0.5) * 2,
                    type: 'newCation',
                    side: 'anode',
                    charge: cell.anode.n,
                    age: 0
                });

                anodeMassLost += cell.anode.mass / (96485 * cell.anode.n) * 0.001;
                electronsMoved++;
            }

            // Move electrons through wire
            for (let i = electrons.length - 1; i >= 0; i--) {
                const e = electrons[i];
                e.progress += 0.02;

                if (e.progress >= 1) {
                    electrons.splice(i, 1);
                    cathodeMassGained += cell.cathode.mass / (96485 * cell.cathode.n) * 0.001;

                    // Remove an ion from catholyte (reduction)
                    const cathodeIons = ions.filter(ion => ion.side === 'cathode' && ion.type === 'cation');
                    if (cathodeIons.length > 0 && Math.random() < 0.5) {
                        const idx = ions.indexOf(cathodeIons[Math.floor(Math.random() * cathodeIons.length)]);
                        if (idx >= 0) ions.splice(idx, 1);
                    }
                }
            }

            // Move ions
            for (const ion of ions) {
                ion.vx += (Math.random() - 0.5) * 0.3;
                ion.vy += (Math.random() - 0.5) * 0.3;
                ion.vx *= 0.98;
                ion.vy *= 0.98;

                ion.x += ion.vx;
                ion.y += ion.vy;

                // Bounds per side
                if (ion.side === 'anode') {
                    if (ion.x < 80) { ion.x = 80; ion.vx = -ion.vx; }
                    if (ion.x > w / 2 - 20) { ion.x = w / 2 - 20; ion.vx = -ion.vx; }
                } else {
                    if (ion.x < w / 2 + 20) { ion.x = w / 2 + 20; ion.vx = -ion.vx; }
                    if (ion.x > w - 20) { ion.x = w - 20; ion.vx = -ion.vx; }
                }

                if (ion.y < 200) { ion.y = 200; ion.vy = -ion.vy; }
                if (ion.y > h - 20) { ion.y = h - 20; ion.vy = -ion.vy; }

                if (ion.type === 'newCation') {
                    ion.age++;
                    if (ion.age > 50) ion.type = 'cation';
                }
            }

            timeStep++;
            updateStats();
        }

        function updateStats() {
            const voltage = getCellVoltage();
            const current = running ? getCurrent() : 0;

            document.getElementById('voltage').textContent = voltage.toFixed(2) + ' V';
            document.getElementById('current').textContent = current.toFixed(2) + ' mA';
            document.getElementById('anodeMass').textContent = (anodeMassLost * 1000).toFixed(3) + ' mg';
            document.getElementById('cathodeMass').textContent = (cathodeMassGained * 1000).toFixed(3) + ' mg';
            document.getElementById('electrons').textContent = electronsMoved;
        }

        function draw() {
            ctx.fillStyle = '#0f172a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            update();

            const w = canvas.width - 400;
            const h = canvas.height - 100;
            const cell = cellData[cellType];

            // Draw beakers
            const beakerY = 150;
            const beakerH = h - beakerY;

            // Anode beaker
            ctx.fillStyle = 'rgba(148, 163, 184, 0.2)';
            ctx.fillRect(60, beakerY, w / 2 - 40, beakerH);
            ctx.strokeStyle = '#64748b';
            ctx.lineWidth = 3;
            ctx.strokeRect(60, beakerY, w / 2 - 40, beakerH);

            // Cathode beaker
            ctx.fillStyle = 'rgba(245, 158, 11, 0.2)';
            ctx.fillRect(w / 2 + 20, beakerY, w / 2 - 40, beakerH);
            ctx.strokeStyle = '#64748b';
            ctx.strokeRect(w / 2 + 20, beakerY, w / 2 - 40, beakerH);

            // Salt bridge
            ctx.fillStyle = '#666';
            ctx.fillRect(w / 2 - 15, beakerY + 20, 30, 80);
            ctx.fillStyle = '#888';
            ctx.font = '10px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Salt Bridge', w / 2, beakerY + 60);

            // Electrodes
            // Anode
            ctx.fillStyle = cell.anode.color;
            ctx.fillRect(90, beakerY - 20, 30, beakerH * 0.7);
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 14px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(cell.anode.name, 105, beakerY + 30);
            ctx.fillText('(−)', 105, beakerY + 50);

            // Cathode
            ctx.fillStyle = cell.cathode.color;
            ctx.fillRect(w - 80, beakerY - 20, 30, beakerH * 0.7);
            ctx.fillStyle = '#fff';
            ctx.fillText(cell.cathode.name, w - 65, beakerY + 30);
            ctx.fillText('(+)', w - 65, beakerY + 50);

            // Wire
            ctx.strokeStyle = running ? '#fbbf24' : '#666';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(105, beakerY - 20);
            ctx.lineTo(105, 80);
            ctx.lineTo(w / 2, 60);
            ctx.lineTo(w - 65, 80);
            ctx.lineTo(w - 65, beakerY - 20);
            ctx.stroke();

            // Light bulb / resistor
            ctx.beginPath();
            ctx.arc(w / 2, 60, 20, 0, Math.PI * 2);
            ctx.fillStyle = running ? '#fbbf24' : '#333';
            ctx.fill();
            ctx.strokeStyle = '#888';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Electrons in wire
            for (const e of electrons) {
                let x, y;
                if (e.progress < 0.3) {
                    // Moving up from anode
                    x = 105;
                    y = beakerY - 20 - e.progress / 0.3 * (beakerY - 100);
                } else if (e.progress < 0.7) {
                    // Moving across
                    const t = (e.progress - 0.3) / 0.4;
                    x = 105 + t * (w - 170);
                    y = 70 + Math.sin(t * Math.PI) * -20;
                } else {
                    // Moving down to cathode
                    const t = (e.progress - 0.7) / 0.3;
                    x = w - 65;
                    y = 80 + t * (beakerY - 100);
                }

                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.fillStyle = '#3b82f6';
                ctx.fill();
            }

            // Draw ions
            for (const ion of ions) {
                ctx.beginPath();
                ctx.arc(ion.x, ion.y, 6, 0, Math.PI * 2);

                if (ion.type === 'newCation') {
                    ctx.fillStyle = cell.anode.color;
                } else if (ion.side === 'cathode') {
                    ctx.fillStyle = cell.cathode.color;
                } else {
                    ctx.fillStyle = '#666';
                }
                ctx.fill();

                // Charge indicator
                ctx.fillStyle = '#fff';
                ctx.font = '8px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('+', ion.x, ion.y + 3);
            }

            // Labels
            ctx.fillStyle = '#888';
            ctx.font = '14px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Anode (Oxidation)', 60 + (w / 2 - 40) / 2, h + 30);
            ctx.fillText('Cathode (Reduction)', w / 2 + 20 + (w / 2 - 40) / 2, h + 30);
            ctx.fillText(cell.anolyte, 60 + (w / 2 - 40) / 2, h + 50);
            ctx.fillText(cell.catholyte, w / 2 + 20 + (w / 2 - 40) / 2, h + 50);

            // Electron flow arrow
            if (running) {
                ctx.fillStyle = '#3b82f6';
                ctx.font = '12px sans-serif';
                ctx.fillText('e⁻ →', w / 2, 40);
            }

            // Title
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 18px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('Electrochemical Cell', 50, 30);

            requestAnimationFrame(draw);
        }

        // Event listeners
        document.getElementById('cellType').onchange = (e) => {
            cellType = e.target.value;
            initCell();
        };

        document.getElementById('concentration').oninput = (e) => {
            concentration = parseFloat(e.target.value);
            document.getElementById('concValue').textContent = concentration.toFixed(1);
        };

        document.getElementById('resistance').oninput = (e) => {
            resistance = parseInt(e.target.value);
            document.getElementById('resistValue').textContent = resistance;
        };

        document.getElementById('runBtn').onclick = () => {
            running = !running;
            document.getElementById('runBtn').textContent = running ? 'Disconnect' : 'Connect Circuit';
        };

        document.getElementById('resetBtn').onclick = initCell;

        // Initialize
        initCell();
        draw();
    </script>
</body>
</html>
