<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chemical Reaction Kinetics (A + B → C)</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
canvas { display: block; }
.title-overlay {
    position: fixed; top: 50px; left: 50%; transform: translateX(-50%);
    color: #fbbf24; font-size: 20px; font-weight: 600; z-index: 998;
    text-shadow: 0 0 10px rgba(251,191,36,0.5); pointer-events: none;
}
.controls {
    position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
    display: flex; gap: 16px; align-items: center; z-index: 999;
    background: rgba(0,0,0,0.7); padding: 12px 24px; border-radius: 12px;
    border: 1px solid rgba(251,191,36,0.3); flex-wrap: wrap; justify-content: center;
}
.controls label { color: #ccc; font-size: 13px; white-space: nowrap; }
.controls input[type=range] { width: 120px; accent-color: #fbbf24; }
.controls span { color: #fbbf24; font-size: 13px; min-width: 25px; }
.controls button {
    background: rgba(251,191,36,0.2); color: #fbbf24; border: 1px solid rgba(251,191,36,0.5);
    padding: 6px 14px; border-radius: 6px; cursor: pointer; font-size: 13px;
}
.controls button:hover { background: rgba(251,191,36,0.4); }
.legend {
    position: fixed; top: 80px; right: 20px; z-index: 998;
    background: rgba(0,0,0,0.6); padding: 12px 16px; border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.1);
}
.legend div { display: flex; align-items: center; gap: 8px; margin: 4px 0; font-size: 13px; }
.legend .dot { width: 12px; height: 12px; border-radius: 50%; }
.legend .label { color: #ccc; }
</style>
</head>
<body>
<a href="../index.html" style="position:fixed;top:10px;left:10px;padding:8px 16px;background:rgba(0,0,0,0.7);color:#fbbf24;text-decoration:none;border-radius:6px;font-size:14px;z-index:999;font-family:sans-serif;">← Back to Gallery</a>
<div class="title-overlay">Chemical Reaction Kinetics: A + B → C</div>
<div class="legend">
    <div><span class="dot" style="background:#4a9eff;"></span><span class="label">Reactant A</span></div>
    <div><span class="dot" style="background:#ff4a6a;"></span><span class="label">Reactant B</span></div>
    <div><span class="dot" style="background:#a855f7;"></span><span class="label">Product C</span></div>
</div>
<div class="controls">
    <label>Activation Energy: <input type="range" id="eaSlider" min="1" max="100" value="50"> <span id="eaVal">50</span></label>
    <label>Speed: <input type="range" id="speedSlider" min="1" max="10" value="4"> <span id="speedVal">4</span></label>
    <button id="resetBtn">Reset</button>
    <button id="addA">+10 A</button>
    <button id="addB">+10 B</button>
</div>
<canvas id="canvas"></canvas>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let W, H;

function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
}
resize();
window.addEventListener('resize', resize);

let activationEnergy = 50;
let speed = 4;
let particles = [];
let concentrationHistory = { A: [], B: [], C: [] };
let time = 0;
const graphW = 280, graphH = 160;

class Particle {
    constructor(type, x, y) {
        this.type = type;
        this.x = x || Math.random() * W;
        this.y = y || Math.random() * (H - 100);
        const angle = Math.random() * Math.PI * 2;
        const s = (1 + Math.random() * 2) * (speed / 3);
        this.vx = Math.cos(angle) * s;
        this.vy = Math.sin(angle) * s;
        this.r = type === 'C' ? 8 : 6;
        this.age = 0;
        this.flash = type === 'C' ? 1 : 0;
    }
    get color() {
        if (this.type === 'A') return '#4a9eff';
        if (this.type === 'B') return '#ff4a6a';
        return '#a855f7';
    }
}

function init() {
    particles = [];
    for (let i = 0; i < 60; i++) particles.push(new Particle('A'));
    for (let i = 0; i < 60; i++) particles.push(new Particle('B'));
    concentrationHistory = { A: [], B: [], C: [] };
    time = 0;
}
init();

document.getElementById('eaSlider').addEventListener('input', function() {
    activationEnergy = +this.value;
    document.getElementById('eaVal').textContent = this.value;
});
document.getElementById('speedSlider').addEventListener('input', function() {
    speed = +this.value;
    document.getElementById('speedVal').textContent = this.value;
});
document.getElementById('resetBtn').addEventListener('click', init);
document.getElementById('addA').addEventListener('click', () => {
    for (let i = 0; i < 10; i++) particles.push(new Particle('A'));
});
document.getElementById('addB').addEventListener('click', () => {
    for (let i = 0; i < 10; i++) particles.push(new Particle('B'));
});

function update() {
    time++;
    for (let p of particles) {
        p.x += p.vx * (speed / 3);
        p.y += p.vy * (speed / 3);
        p.age++;
        if (p.flash > 0) p.flash *= 0.95;

        if (p.x < p.r) { p.x = p.r; p.vx *= -1; }
        if (p.x > W - p.r) { p.x = W - p.r; p.vx *= -1; }
        if (p.y < p.r) { p.y = p.r; p.vy *= -1; }
        if (p.y > H - 100 - p.r) { p.y = H - 100 - p.r; p.vy *= -1; }
    }

    // Check collisions between A and B
    const toRemove = new Set();
    const toAdd = [];
    const aParticles = particles.filter(p => p.type === 'A');
    const bParticles = particles.filter(p => p.type === 'B');

    for (let a of aParticles) {
        if (toRemove.has(a)) continue;
        for (let b of bParticles) {
            if (toRemove.has(b)) continue;
            const dx = a.x - b.x;
            const dy = a.y - b.y;
            const d = Math.sqrt(dx * dx + dy * dy);
            if (d < a.r + b.r) {
                const kineticEnergy = 0.5 * (a.vx * a.vx + a.vy * a.vy + b.vx * b.vx + b.vy * b.vy);
                const threshold = activationEnergy * 0.1;
                if (kineticEnergy > threshold || Math.random() < 0.02 * (100 - activationEnergy) / 100) {
                    toRemove.add(a);
                    toRemove.add(b);
                    const c = new Particle('C', (a.x + b.x) / 2, (a.y + b.y) / 2);
                    c.vx = (a.vx + b.vx) / 2;
                    c.vy = (a.vy + b.vy) / 2;
                    toAdd.push(c);
                }
            }
        }
    }

    particles = particles.filter(p => !toRemove.has(p));
    particles.push(...toAdd);

    // Record concentrations
    if (time % 3 === 0) {
        const aCount = particles.filter(p => p.type === 'A').length;
        const bCount = particles.filter(p => p.type === 'B').length;
        const cCount = particles.filter(p => p.type === 'C').length;
        concentrationHistory.A.push(aCount);
        concentrationHistory.B.push(bCount);
        concentrationHistory.C.push(cCount);
        if (concentrationHistory.A.length > 200) {
            concentrationHistory.A.shift();
            concentrationHistory.B.shift();
            concentrationHistory.C.shift();
        }
    }
}

function drawGraph() {
    const gx = 20, gy = 80;
    ctx.fillStyle = 'rgba(0,0,0,0.6)';
    ctx.strokeStyle = 'rgba(255,255,255,0.15)';
    ctx.lineWidth = 1;

    // Background
    ctx.beginPath();
    ctx.roundRect(gx, gy, graphW, graphH + 30, 10);
    ctx.fill();
    ctx.stroke();

    ctx.fillStyle = '#aaa';
    ctx.font = '11px sans-serif';
    ctx.fillText('Concentration vs Time', gx + 70, gy + 15);

    const maxVal = Math.max(
        Math.max(...(concentrationHistory.A.length ? concentrationHistory.A : [1])),
        Math.max(...(concentrationHistory.B.length ? concentrationHistory.B : [1])),
        Math.max(...(concentrationHistory.C.length ? concentrationHistory.C : [1])),
        1
    );

    const colors = { A: '#4a9eff', B: '#ff4a6a', C: '#a855f7' };
    for (let type of ['A', 'B', 'C']) {
        const data = concentrationHistory[type];
        if (data.length < 2) continue;
        ctx.beginPath();
        ctx.strokeStyle = colors[type];
        ctx.lineWidth = 2;
        for (let i = 0; i < data.length; i++) {
            const x = gx + 10 + (i / 200) * (graphW - 20);
            const y = gy + graphH + 15 - (data[i] / maxVal) * (graphH - 15);
            if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
        }
        ctx.stroke();
    }

    // Labels
    ctx.font = '10px sans-serif';
    ctx.fillStyle = '#4a9eff'; ctx.fillText('[A]: ' + particles.filter(p => p.type === 'A').length, gx + 10, gy + graphH + 28);
    ctx.fillStyle = '#ff4a6a'; ctx.fillText('[B]: ' + particles.filter(p => p.type === 'B').length, gx + 80, gy + graphH + 28);
    ctx.fillStyle = '#a855f7'; ctx.fillText('[C]: ' + particles.filter(p => p.type === 'C').length, gx + 150, gy + graphH + 28);
}

function draw() {
    ctx.fillStyle = 'rgba(10, 14, 26, 0.2)';
    ctx.fillRect(0, 0, W, H);

    // Draw particles
    for (let p of particles) {
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
        ctx.fillStyle = p.color;
        ctx.fill();

        if (p.flash > 0.1) {
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.r + 10 * p.flash, 0, Math.PI * 2);
            ctx.strokeStyle = `rgba(168, 85, 247, ${p.flash * 0.8})`;
            ctx.lineWidth = 2;
            ctx.stroke();
        }

        // Glow
        const grd = ctx.createRadialGradient(p.x, p.y, p.r, p.x, p.y, p.r * 2.5);
        grd.addColorStop(0, p.color.replace(')', ', 0.2)').replace('rgb', 'rgba'));
        grd.addColorStop(1, 'transparent');
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.r * 2.5, 0, Math.PI * 2);
        ctx.fillStyle = grd;
        ctx.fill();

        // Label
        ctx.fillStyle = '#fff';
        ctx.font = 'bold 9px sans-serif';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(p.type, p.x, p.y);
    }

    drawGraph();

    // Reaction equation
    ctx.fillStyle = 'rgba(0,0,0,0.5)';
    ctx.fillRect(W / 2 - 100, H - 95, 200, 30);
    ctx.font = '16px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillStyle = '#4a9eff'; ctx.fillText('A', W / 2 - 40, H - 76);
    ctx.fillStyle = '#ccc'; ctx.fillText('+', W / 2 - 18, H - 76);
    ctx.fillStyle = '#ff4a6a'; ctx.fillText('B', W / 2, H - 76);
    ctx.fillStyle = '#ccc'; ctx.fillText('→', W / 2 + 22, H - 76);
    ctx.fillStyle = '#a855f7'; ctx.fillText('C', W / 2 + 45, H - 76);
}

function animate() {
    update();
    draw();
    requestAnimationFrame(animate);
}
animate();
</script>
</body>
</html>
