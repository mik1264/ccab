<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Greenhouse Effect Energy Balance</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: 'Nunito', sans-serif; }
canvas { display: block; }
.title-overlay {
    position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
    color: #fff; font-size: 1.4rem; font-weight: 600;
    text-shadow: 0 2px 10px rgba(0,0,0,0.7);
    pointer-events: none; z-index: 10; text-align: center;
}
.title-overlay .subtitle {
    font-size: 0.8rem; opacity: 0.7; margin-top: 4px; font-weight: 300;
}
.organic-back-link {
    position: fixed; top: 20px; left: 20px; z-index: 100;
    display: flex; align-items: center; gap: 8px;
    padding: 8px 16px; border-radius: 20px;
    background: rgba(255,255,255,0.1); backdrop-filter: blur(10px);
    color: #fff; text-decoration: none; font-size: 0.9rem;
    transition: background 0.3s;
}
.organic-back-link:hover { background: rgba(255,255,255,0.2); }
.controls {
    position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
    display: flex; gap: 20px; align-items: center; z-index: 10; flex-wrap: wrap; justify-content: center;
    background: rgba(0,0,0,0.6); backdrop-filter: blur(10px);
    padding: 12px 24px; border-radius: 20px; color: #fff; font-size: 0.85rem;
}
.controls label { display: flex; align-items: center; gap: 8px; white-space: nowrap; }
.controls input[type="range"] { width: 120px; }
.info-panel {
    position: fixed; top: 80px; right: 20px; z-index: 10;
    background: rgba(0,0,0,0.5); backdrop-filter: blur(10px);
    padding: 12px 16px; border-radius: 12px; color: #fff; font-size: 0.75rem;
    line-height: 1.8;
}
.temp-display {
    font-size: 1.2rem; font-weight: bold; margin-top: 4px;
}
</style>
</head>
<body>
<a href="../index.html" class="organic-back-link">
    <span class="back-arrow">&larr;</span>
    <span class="back-text">Gallery</span>
</a>
<div class="title-overlay">
    Greenhouse Effect Energy Balance
    <div class="subtitle">Solar radiation in, infrared absorption by greenhouse gases</div>
</div>
<div class="info-panel">
    <div>CO2 Level: <span id="co2Level">400</span> ppm</div>
    <div>Solar Input: <span id="solarIn">0</span> photons/s</div>
    <div>IR Escaped: <span id="irOut">0</span> photons/s</div>
    <div>IR Trapped: <span id="irTrapped">0</span> photons/s</div>
    <div class="temp-display">Surface: <span id="surfTemp">15</span>&deg;C</div>
</div>
<div class="controls">
    <label>CO2 Concentration: <input type="range" id="co2Slider" min="200" max="1000" step="10" value="400"> <span id="co2Val">400</span> ppm</label>
    <label>Solar Intensity: <input type="range" id="solarSlider" min="0.3" max="2" step="0.1" value="1"> <span id="solarVal">1.0</span></label>
</div>
<canvas id="canvas"></canvas>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

let W, H;
function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
}
resize();
window.addEventListener('resize', resize);

// Zones
function getZones() {
    return {
        space: { top: 0, bottom: H * 0.1 },
        atmosphere: { top: H * 0.1, bottom: H * 0.75 },
        ground: { top: H * 0.75, bottom: H }
    };
}

// Photon types
const SOLAR = 'solar';     // Yellow, comes from top
const IR = 'ir';           // Red, emitted from ground
const IR_REEMIT = 'ir_re'; // Orange, re-emitted by GHG

const photons = [];
const MAX_PHOTONS = 800;

// GHG molecules
const molecules = [];
const MAX_MOLECULES = 60;

let surfaceTemp = 15;
let solarCount = 0;
let irEscaped = 0;
let irTrapped = 0;
let frameCount = 0;

class Molecule {
    constructor(co2) {
        this.respawn(co2);
    }
    respawn(co2) {
        const zones = getZones();
        this.x = Math.random() * W;
        this.y = zones.atmosphere.top + Math.random() * (zones.atmosphere.bottom - zones.atmosphere.top);
        this.size = 6 + Math.random() * 4;
        this.vx = (Math.random() - 0.5) * 0.3;
        this.vy = (Math.random() - 0.5) * 0.2;
        this.wobble = Math.random() * Math.PI * 2;
        this.active = true;
        this.glowTimer = 0;
    }
    update() {
        this.wobble += 0.03;
        this.x += this.vx + Math.sin(this.wobble) * 0.2;
        this.y += this.vy + Math.cos(this.wobble * 0.7) * 0.1;

        const zones = getZones();
        if (this.x < 10) this.vx = Math.abs(this.vx);
        if (this.x > W - 10) this.vx = -Math.abs(this.vx);
        if (this.y < zones.atmosphere.top + 10) this.vy = Math.abs(this.vy);
        if (this.y > zones.atmosphere.bottom - 10) this.vy = -Math.abs(this.vy);

        if (this.glowTimer > 0) this.glowTimer -= 0.02;
    }
    draw() {
        // CO2 molecule: O=C=O shape
        const glow = this.glowTimer > 0;
        const alpha = glow ? 0.9 : 0.4;
        const color = glow ? `rgba(255, 150, 50, ${alpha})` : `rgba(100, 200, 100, ${alpha})`;

        if (glow) {
            ctx.shadowColor = 'rgba(255, 100, 0, 0.5)';
            ctx.shadowBlur = 15;
        }

        // Central carbon
        ctx.fillStyle = color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size * 0.5, 0, Math.PI * 2);
        ctx.fill();

        // Two oxygens
        const ox = Math.cos(this.wobble * 0.5) * this.size;
        const oy = Math.sin(this.wobble * 0.5) * this.size * 0.3;
        ctx.fillStyle = glow ? `rgba(255, 100, 30, ${alpha})` : `rgba(80, 150, 80, ${alpha * 0.8})`;
        ctx.beginPath();
        ctx.arc(this.x - ox, this.y - oy, this.size * 0.4, 0, Math.PI * 2);
        ctx.fill();
        ctx.beginPath();
        ctx.arc(this.x + ox, this.y + oy, this.size * 0.4, 0, Math.PI * 2);
        ctx.fill();

        ctx.shadowBlur = 0;
    }
}

class Photon {
    constructor(type, x, y, vy) {
        this.type = type;
        this.x = x;
        this.y = y;
        this.vx = (Math.random() - 0.5) * 0.5;
        this.vy = vy;
        this.life = 1;
        this.size = type === SOLAR ? 3 : 2.5;
        this.trail = [];
    }
    update(co2Level) {
        this.trail.push({ x: this.x, y: this.y });
        if (this.trail.length > 8) this.trail.shift();

        this.x += this.vx;
        this.y += this.vy;

        const zones = getZones();

        // Solar photon hits ground
        if (this.type === SOLAR && this.y > zones.ground.top) {
            this.life = 0;
            surfaceTemp += 0.005;
            // Emit IR photon upward
            if (photons.length < MAX_PHOTONS && Math.random() < 0.7) {
                photons.push(new Photon(IR, this.x + (Math.random() - 0.5) * 30, zones.ground.top - 5, -1.5 - Math.random()));
            }
            return;
        }

        // IR photon in atmosphere - chance of being absorbed by GHG
        if ((this.type === IR || this.type === IR_REEMIT) && this.y > zones.atmosphere.top && this.y < zones.atmosphere.bottom) {
            const absorptionChance = (co2Level / 400) * 0.003;
            for (const mol of molecules) {
                const dx = this.x - mol.x;
                const dy = this.y - mol.y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                if (dist < mol.size * 2 && Math.random() < absorptionChance) {
                    mol.glowTimer = 1;
                    this.life = 0;
                    irTrapped++;
                    surfaceTemp += 0.002;
                    // Re-emit in random direction
                    if (photons.length < MAX_PHOTONS) {
                        const angle = Math.random() * Math.PI * 2;
                        const speed = 1 + Math.random() * 0.5;
                        photons.push(new Photon(IR_REEMIT, mol.x, mol.y, Math.sin(angle) * speed));
                        photons[photons.length - 1].vx = Math.cos(angle) * speed;
                    }
                    return;
                }
            }
        }

        // Photon escapes to space
        if (this.y < zones.space.top) {
            this.life = 0;
            if (this.type === IR || this.type === IR_REEMIT) {
                irEscaped++;
                surfaceTemp -= 0.003;
            }
            return;
        }

        // IR re-emitted downward hits ground
        if (this.type === IR_REEMIT && this.vy > 0 && this.y > zones.ground.top) {
            this.life = 0;
            surfaceTemp += 0.003;
            return;
        }

        // Out of bounds
        if (this.x < -20 || this.x > W + 20 || this.y > H + 20) {
            this.life = 0;
        }
    }
    draw() {
        let color, glowColor;
        if (this.type === SOLAR) {
            color = 'rgba(255, 255, 100, 0.9)';
            glowColor = 'rgba(255, 255, 0, 0.3)';
        } else if (this.type === IR) {
            color = 'rgba(255, 60, 30, 0.8)';
            glowColor = 'rgba(255, 0, 0, 0.2)';
        } else {
            color = 'rgba(255, 140, 40, 0.8)';
            glowColor = 'rgba(255, 100, 0, 0.2)';
        }

        // Trail
        for (let i = 0; i < this.trail.length; i++) {
            const alpha = (i / this.trail.length) * 0.3;
            ctx.fillStyle = this.type === SOLAR ?
                `rgba(255,255,100,${alpha})` :
                `rgba(255,80,30,${alpha})`;
            ctx.beginPath();
            ctx.arc(this.trail[i].x, this.trail[i].y, this.size * 0.5, 0, Math.PI * 2);
            ctx.fill();
        }

        // Glow
        ctx.shadowColor = glowColor;
        ctx.shadowBlur = 8;
        ctx.fillStyle = color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();
        ctx.shadowBlur = 0;
    }
}

function spawnMolecules(co2) {
    const target = Math.floor((co2 / 400) * 30);
    while (molecules.length < target && molecules.length < MAX_MOLECULES) {
        molecules.push(new Molecule(co2));
    }
    while (molecules.length > target) {
        molecules.pop();
    }
}

function drawBackground() {
    const zones = getZones();

    // Space
    const spaceGrad = ctx.createLinearGradient(0, 0, 0, zones.space.bottom);
    spaceGrad.addColorStop(0, '#000005');
    spaceGrad.addColorStop(1, '#050815');
    ctx.fillStyle = spaceGrad;
    ctx.fillRect(0, 0, W, zones.space.bottom);

    // Sun
    ctx.fillStyle = 'rgba(255, 220, 50, 0.15)';
    ctx.beginPath();
    ctx.arc(W * 0.2, -20, 80, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = 'rgba(255, 240, 100, 0.8)';
    ctx.beginPath();
    ctx.arc(W * 0.2, -20, 30, 0, Math.PI * 2);
    ctx.fill();

    // Atmosphere
    const atmoGrad = ctx.createLinearGradient(0, zones.atmosphere.top, 0, zones.atmosphere.bottom);
    atmoGrad.addColorStop(0, 'rgba(20, 40, 80, 0.3)');
    atmoGrad.addColorStop(0.5, 'rgba(30, 50, 90, 0.2)');
    atmoGrad.addColorStop(1, 'rgba(40, 60, 100, 0.15)');
    ctx.fillStyle = atmoGrad;
    ctx.fillRect(0, zones.atmosphere.top, W, zones.atmosphere.bottom - zones.atmosphere.top);

    // Ground
    const tempColor = Math.min(255, Math.floor(100 + surfaceTemp * 5));
    const groundGrad = ctx.createLinearGradient(0, zones.ground.top, 0, H);
    groundGrad.addColorStop(0, `rgba(${tempColor}, ${Math.floor(tempColor * 0.5)}, ${Math.floor(tempColor * 0.2)}, 0.8)`);
    groundGrad.addColorStop(1, `rgba(${Math.floor(tempColor * 0.5)}, ${Math.floor(tempColor * 0.3)}, ${Math.floor(tempColor * 0.1)}, 0.9)`);
    ctx.fillStyle = groundGrad;
    ctx.fillRect(0, zones.ground.top, W, H - zones.ground.top);

    // Zone labels
    ctx.fillStyle = 'rgba(255,255,255,0.1)';
    ctx.font = '12px sans-serif';
    ctx.fillText('Space', 10, zones.space.bottom - 10);
    ctx.fillText('Atmosphere (GHG layer)', 10, (zones.atmosphere.top + zones.atmosphere.bottom) / 2);
    ctx.fillText('Ground Surface', 10, zones.ground.top + 20);

    // Zone boundaries
    ctx.strokeStyle = 'rgba(255,255,255,0.08)';
    ctx.setLineDash([4, 8]);
    ctx.beginPath();
    ctx.moveTo(0, zones.atmosphere.top);
    ctx.lineTo(W, zones.atmosphere.top);
    ctx.moveTo(0, zones.ground.top);
    ctx.lineTo(W, zones.ground.top);
    ctx.stroke();
    ctx.setLineDash([]);

    // Legend
    drawLegend();
}

function drawLegend() {
    const x = W - 180;
    const y = H * 0.12;
    ctx.fillStyle = 'rgba(0,0,0,0.4)';
    ctx.beginPath();
    ctx.roundRect(x - 10, y - 5, 175, 85, 8);
    ctx.fill();

    ctx.font = '11px sans-serif';
    // Solar
    ctx.fillStyle = 'rgba(255, 255, 100, 0.9)';
    ctx.beginPath();
    ctx.arc(x + 5, y + 12, 4, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = 'rgba(255,255,255,0.7)';
    ctx.fillText('Solar radiation (visible)', x + 15, y + 16);

    // IR
    ctx.fillStyle = 'rgba(255, 60, 30, 0.8)';
    ctx.beginPath();
    ctx.arc(x + 5, y + 35, 4, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = 'rgba(255,255,255,0.7)';
    ctx.fillText('Infrared (from ground)', x + 15, y + 39);

    // Re-emitted
    ctx.fillStyle = 'rgba(255, 140, 40, 0.8)';
    ctx.beginPath();
    ctx.arc(x + 5, y + 58, 4, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = 'rgba(255,255,255,0.7)';
    ctx.fillText('Re-emitted IR (trapped)', x + 15, y + 62);
}

let time = 0;

function animate() {
    const co2 = parseInt(document.getElementById('co2Slider').value);
    const solarIntensity = parseFloat(document.getElementById('solarSlider').value);
    document.getElementById('co2Val').textContent = co2;
    document.getElementById('solarVal').textContent = solarIntensity.toFixed(1);

    // Natural cooling
    surfaceTemp += (15 - surfaceTemp) * 0.0001;
    surfaceTemp = Math.max(-10, Math.min(60, surfaceTemp));

    ctx.fillStyle = 'rgba(10, 14, 26, 0.3)';
    ctx.fillRect(0, 0, W, H);
    drawBackground();

    spawnMolecules(co2);

    // Spawn solar photons
    if (Math.random() < 0.15 * solarIntensity && photons.length < MAX_PHOTONS) {
        const x = Math.random() * W;
        photons.push(new Photon(SOLAR, x, -5, 1.5 + Math.random()));
        solarCount++;
    }

    // Update molecules
    for (const mol of molecules) {
        mol.update();
        mol.draw();
    }

    // Update photons
    for (let i = photons.length - 1; i >= 0; i--) {
        photons[i].update(co2);
        if (photons[i].life <= 0) {
            photons.splice(i, 1);
        } else {
            photons[i].draw();
        }
    }

    // Update info
    frameCount++;
    if (frameCount % 30 === 0) {
        document.getElementById('co2Level').textContent = co2;
        document.getElementById('solarIn').textContent = Math.floor(solarCount / (frameCount / 60));
        document.getElementById('irOut').textContent = Math.floor(irEscaped / (frameCount / 60));
        document.getElementById('irTrapped').textContent = Math.floor(irTrapped / (frameCount / 60));
        document.getElementById('surfTemp').textContent = surfaceTemp.toFixed(1);
    }

    time += 0.016;
    requestAnimationFrame(animate);
}
animate();
</script>
</body>
</html>
