<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vector-Borne Disease (Mosquito)</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
canvas { display: block; }
#title-overlay { position: fixed; top: 18px; left: 50%; transform: translateX(-50%); color: #fbbf24; font-size: 22px; font-weight: 700; text-shadow: 0 2px 10px rgba(0,0,0,0.7); z-index: 10; pointer-events: none; }
#legend { position: fixed; top: 60px; right: 20px; background: rgba(0,0,0,0.85); padding: 14px 18px; border-radius: 10px; color: #e0e0e0; font-size: 13px; z-index: 10; border: 1px solid rgba(251,191,36,0.2); }
.legend-item { display: flex; align-items: center; gap: 8px; margin: 5px 0; }
.legend-dot { width: 12px; height: 12px; border-radius: 50%; }
.legend-tri { width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-bottom: 12px solid; }
#controls { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.85); padding: 16px 24px; border-radius: 14px; color: #e0e0e0; z-index: 10; display: flex; gap: 24px; align-items: center; border: 1px solid rgba(251,191,36,0.3); font-size: 13px; }
#controls button { padding: 8px 18px; background: #fbbf24; color: #0a0e1a; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; font-size: 13px; }
#controls button:hover { background: #f59e0b; }
#controls input[type=range] { width: 120px; accent-color: #fbbf24; }
.val { color: #fbbf24; font-weight: 700; }
#stats { position: fixed; top: 60px; left: 20px; background: rgba(0,0,0,0.85); padding: 14px 18px; border-radius: 10px; color: #e0e0e0; font-size: 13px; z-index: 10; border: 1px solid rgba(251,191,36,0.2); }
#info { position: fixed; top: 240px; left: 20px; background: rgba(0,0,0,0.85); padding: 14px 18px; border-radius: 10px; color: #ccc; font-size: 12px; z-index: 10; border: 1px solid rgba(251,191,36,0.2); max-width: 185px; line-height: 1.5; }
</style>
</head>
<body>
<a href="../index.html" style="position:fixed;top:10px;left:10px;padding:8px 16px;background:rgba(0,0,0,0.7);color:#fbbf24;text-decoration:none;border-radius:6px;font-size:14px;z-index:999;font-family:sans-serif;">&#8592; Back to Gallery</a>
<div id="title-overlay">Vector-Borne Disease (Mosquito Model)</div>
<div id="legend">
    <div style="font-weight:700;margin-bottom:6px;">Humans (circles):</div>
    <div class="legend-item"><div class="legend-dot" style="background:#4a9eff;"></div> Healthy</div>
    <div class="legend-item"><div class="legend-dot" style="background:#ff4a4a;"></div> Infected</div>
    <div class="legend-item"><div class="legend-dot" style="background:#4aff88;"></div> Recovered</div>
    <div style="font-weight:700;margin:8px 0 6px;">Mosquitoes (triangles):</div>
    <div class="legend-item"><div class="legend-tri" style="border-bottom-color:#aaa;"></div> Clean</div>
    <div class="legend-item"><div class="legend-tri" style="border-bottom-color:#ff4a4a;"></div> Carrier</div>
</div>
<div id="stats">
    <div>Day: <span id="dayNum" class="val">0</span></div>
    <div style="margin-top:4px;font-weight:700;">Humans:</div>
    <div>Healthy: <span id="hHealthy" style="color:#4a9eff;">0</span></div>
    <div>Infected: <span id="hInfected" style="color:#ff4a4a;">0</span></div>
    <div>Recovered: <span id="hRecovered" style="color:#4aff88;">0</span></div>
    <div style="margin-top:4px;font-weight:700;">Mosquitoes:</div>
    <div>Clean: <span id="mClean" style="color:#aaa;">0</span></div>
    <div>Carriers: <span id="mCarrier" style="color:#ff4a4a;">0</span></div>
</div>
<div id="info">Mosquitoes acquire the pathogen by biting infected humans, then transmit to healthy humans on subsequent bites. No direct human-to-human transmission.</div>
<div id="controls">
    <label>Mosquito Density <input type="range" id="mosqDensity" min="20" max="200" value="80"><span class="val" id="mosqVal">80</span></label>
    <label>Bite Rate <input type="range" id="biteRate" min="0.001" max="0.05" step="0.001" value="0.015"><span class="val" id="biteVal">1.5%</span></label>
    <button id="resetBtn">Reset</button>
</div>
<canvas id="canvas"></canvas>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let W, H, simW, simH;

const NUM_HUMANS = 150;
const HUMAN_RADIUS = 5;
const HUMAN_SPEED = 0.6;
const MOSQ_SPEED = 2.0;
const BITE_DIST = 20;
const RECOVERY_TIME = 350;

const HEALTHY = 0, INFECTED = 1, RECOVERED = 2;

let humans = [], mosquitoes = [], history = [], frame = 0, biteFlashes = [];

function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
    simW = W * 0.6;
    simH = H - 100;
}

function init() {
    humans = [];
    mosquitoes = [];
    history = [];
    biteFlashes = [];
    frame = 0;

    for (let i = 0; i < NUM_HUMANS; i++) {
        humans.push({
            x: 30 + Math.random() * (simW - 60),
            y: 70 + Math.random() * (simH - 30),
            vx: (Math.random() - 0.5) * HUMAN_SPEED * 2,
            vy: (Math.random() - 0.5) * HUMAN_SPEED * 2,
            state: i < 3 ? INFECTED : HEALTHY,
            infectedTime: 0
        });
    }

    const numMosq = parseInt(document.getElementById('mosqDensity').value);
    for (let i = 0; i < numMosq; i++) {
        mosquitoes.push({
            x: 30 + Math.random() * (simW - 60),
            y: 70 + Math.random() * (simH - 30),
            vx: (Math.random() - 0.5) * MOSQ_SPEED * 2,
            vy: (Math.random() - 0.5) * MOSQ_SPEED * 2,
            carrier: false,
            angle: Math.random() * Math.PI * 2,
            biteCooldown: 0
        });
    }
}

function update() {
    const biteRate = parseFloat(document.getElementById('biteRate').value);

    // Update humans
    for (let h of humans) {
        h.x += h.vx;
        h.y += h.vy;
        if (h.x < 20 || h.x > simW - 20) h.vx *= -1;
        if (h.y < 60 || h.y > simH + 20) h.vy *= -1;
        h.x = Math.max(20, Math.min(simW - 20, h.x));
        h.y = Math.max(60, Math.min(simH + 20, h.y));

        if (Math.random() < 0.02) {
            h.vx += (Math.random() - 0.5) * 0.3;
            h.vy += (Math.random() - 0.5) * 0.3;
        }

        if (h.state === INFECTED) {
            h.infectedTime++;
            if (h.infectedTime > RECOVERY_TIME) h.state = RECOVERED;
        }
    }

    // Update mosquitoes
    for (let m of mosquitoes) {
        // Erratic flight pattern
        m.angle += (Math.random() - 0.5) * 0.5;
        m.vx = Math.cos(m.angle) * MOSQ_SPEED;
        m.vy = Math.sin(m.angle) * MOSQ_SPEED;

        // Attracted to nearest human
        let nearestH = null, nearestD = Infinity;
        for (let h of humans) {
            const dx = h.x - m.x, dy = h.y - m.y;
            const d = Math.sqrt(dx * dx + dy * dy);
            if (d < nearestD) { nearestD = d; nearestH = h; }
        }
        if (nearestH && nearestD < 100) {
            const dx = nearestH.x - m.x, dy = nearestH.y - m.y;
            const d = Math.max(nearestD, 1);
            m.vx += (dx / d) * 0.5;
            m.vy += (dy / d) * 0.5;
        }

        m.x += m.vx;
        m.y += m.vy;
        if (m.x < 15 || m.x > simW - 15) { m.angle = Math.PI - m.angle; m.x = Math.max(15, Math.min(simW - 15, m.x)); }
        if (m.y < 55 || m.y > simH + 25) { m.angle = -m.angle; m.y = Math.max(55, Math.min(simH + 25, m.y)); }

        if (m.biteCooldown > 0) m.biteCooldown--;

        // Bite check
        if (m.biteCooldown <= 0) {
            for (let h of humans) {
                const dx = h.x - m.x, dy = h.y - m.y;
                if (dx * dx + dy * dy < BITE_DIST * BITE_DIST) {
                    if (Math.random() < biteRate) {
                        m.biteCooldown = 60;
                        biteFlashes.push({ x: m.x, y: m.y, life: 20 });

                        if (m.carrier && h.state === HEALTHY) {
                            h.state = INFECTED;
                            h.infectedTime = 0;
                        } else if (!m.carrier && h.state === INFECTED) {
                            m.carrier = true;
                        }
                        break;
                    }
                }
            }
        }
    }

    // Update bite flashes
    for (let i = biteFlashes.length - 1; i >= 0; i--) {
        biteFlashes[i].life--;
        if (biteFlashes[i].life <= 0) biteFlashes.splice(i, 1);
    }

    // History
    if (frame % 3 === 0) {
        let hc = [0, 0, 0], mc = [0, 0];
        for (let h of humans) hc[h.state]++;
        for (let m of mosquitoes) mc[m.carrier ? 1 : 0]++;
        history.push({ hc, mc });
    }
    frame++;
}

function drawTriangle(x, y, size, angle, color) {
    ctx.save();
    ctx.translate(x, y);
    ctx.rotate(angle);
    ctx.beginPath();
    ctx.moveTo(0, -size);
    ctx.lineTo(-size * 0.6, size * 0.6);
    ctx.lineTo(size * 0.6, size * 0.6);
    ctx.closePath();
    ctx.fillStyle = color;
    ctx.fill();
    ctx.restore();
}

function draw() {
    ctx.fillStyle = '#0a0e1a';
    ctx.fillRect(0, 0, W, H);

    // Sim border
    ctx.strokeStyle = 'rgba(251,191,36,0.12)';
    ctx.strokeRect(10, 55, simW - 10, simH);

    // Water puddles (breeding grounds visual)
    for (let i = 0; i < 5; i++) {
        const px = 80 + i * (simW - 160) / 4;
        const py = simH - 30 + Math.sin(i * 2) * 20;
        ctx.beginPath();
        ctx.ellipse(px, py, 25, 12, 0, 0, Math.PI * 2);
        ctx.fillStyle = 'rgba(74,158,255,0.06)';
        ctx.fill();
        ctx.strokeStyle = 'rgba(74,158,255,0.1)';
        ctx.stroke();
    }

    // Draw humans
    const HCOLORS = ['#4a9eff', '#ff4a4a', '#4aff88'];
    for (let h of humans) {
        ctx.beginPath();
        ctx.arc(h.x, h.y, HUMAN_RADIUS, 0, Math.PI * 2);
        ctx.fillStyle = HCOLORS[h.state];
        if (h.state === INFECTED) {
            ctx.shadowBlur = 10;
            ctx.shadowColor = '#ff4a4a';
        } else {
            ctx.shadowBlur = 0;
        }
        ctx.fill();
        ctx.shadowBlur = 0;
    }

    // Draw mosquitoes
    for (let m of mosquitoes) {
        const angle = Math.atan2(m.vy, m.vx) + Math.PI / 2;
        const color = m.carrier ? '#ff4a4a' : 'rgba(200,200,200,0.6)';
        drawTriangle(m.x, m.y, 4, angle, color);
        if (m.carrier) {
            ctx.shadowBlur = 6;
            ctx.shadowColor = '#ff4a4a';
            drawTriangle(m.x, m.y, 4, angle, color);
            ctx.shadowBlur = 0;
        }

        // Wing flutter effect
        const wing = Math.sin(frame * 0.5 + m.x) * 2;
        ctx.strokeStyle = m.carrier ? 'rgba(255,74,74,0.3)' : 'rgba(200,200,200,0.15)';
        ctx.lineWidth = 0.5;
        ctx.beginPath();
        ctx.moveTo(m.x - wing, m.y);
        ctx.lineTo(m.x + wing, m.y);
        ctx.stroke();
    }

    // Bite flashes
    for (let f of biteFlashes) {
        const a = f.life / 20;
        ctx.beginPath();
        ctx.arc(f.x, f.y, 8 + (20 - f.life), 0, Math.PI * 2);
        ctx.strokeStyle = `rgba(255,74,74,${a * 0.6})`;
        ctx.lineWidth = 2;
        ctx.stroke();
    }

    // Graph
    const gx = simW + 30, gy = 80, gw = W - gx - 30, gh = H - 200;
    ctx.fillStyle = 'rgba(0,0,0,0.4)';
    ctx.fillRect(gx - 5, gy - 5, gw + 10, gh + 10);
    ctx.strokeStyle = 'rgba(251,191,36,0.2)';
    ctx.strokeRect(gx - 5, gy - 5, gw + 10, gh + 10);

    ctx.fillStyle = '#aaa';
    ctx.font = '12px sans-serif';
    ctx.fillText('Infection Spread via Vector', gx + gw / 2 - 70, gy - 12);

    if (history.length > 1) {
        const lines = [
            { key: 'hc', idx: 0, color: '#4a9eff', label: 'Healthy' },
            { key: 'hc', idx: 1, color: '#ff4a4a', label: 'Infected' },
            { key: 'hc', idx: 2, color: '#4aff88', label: 'Recovered' }
        ];
        for (let line of lines) {
            ctx.beginPath();
            ctx.strokeStyle = line.color;
            ctx.lineWidth = 2;
            for (let i = 0; i < history.length; i++) {
                const x = gx + (i / Math.max(history.length - 1, 1)) * gw;
                const y = gy + gh - (history[i][line.key][line.idx] / NUM_HUMANS) * gh;
                if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
            }
            ctx.stroke();
        }

        // Carrier mosquitoes
        const maxMosq = mosquitoes.length || 1;
        ctx.beginPath();
        ctx.strokeStyle = '#ff8c00';
        ctx.lineWidth = 1;
        ctx.setLineDash([3, 3]);
        for (let i = 0; i < history.length; i++) {
            const x = gx + (i / Math.max(history.length - 1, 1)) * gw;
            const y = gy + gh - (history[i].mc[1] / maxMosq) * gh;
            if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
        }
        ctx.stroke();
        ctx.setLineDash([]);
    }

    // Stats
    let hc = [0, 0, 0], mc = [0, 0];
    for (let h of humans) hc[h.state]++;
    for (let m of mosquitoes) mc[m.carrier ? 1 : 0]++;
    document.getElementById('dayNum').textContent = Math.floor(frame / 60);
    document.getElementById('hHealthy').textContent = hc[0];
    document.getElementById('hInfected').textContent = hc[1];
    document.getElementById('hRecovered').textContent = hc[2];
    document.getElementById('mClean').textContent = mc[0];
    document.getElementById('mCarrier').textContent = mc[1];
}

document.getElementById('mosqDensity').oninput = function() { document.getElementById('mosqVal').textContent = this.value; };
document.getElementById('biteRate').oninput = function() { document.getElementById('biteVal').textContent = (this.value * 100).toFixed(1) + '%'; };
document.getElementById('resetBtn').onclick = init;
window.addEventListener('resize', () => { resize(); init(); });

function animate() { update(); draw(); requestAnimationFrame(animate); }
resize();
init();
animate();
</script>
</body>
</html>
