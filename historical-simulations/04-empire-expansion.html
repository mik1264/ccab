<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empire Expansion | Historical Simulations</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #d4a574;
            text-decoration: none;
            font-weight: 500;
            margin-bottom: 15px;
            padding: 8px 16px;
            background: rgba(212, 165, 116, 0.1);
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        .back-link:hover {
            background: rgba(212, 165, 116, 0.2);
            transform: translateX(-5px);
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #d4a574, #bc8c5c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .description {
            color: #a0a0a0;
            max-width: 700px;
            margin: 0 auto;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }

        .canvas-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 15px;
            border: 1px solid rgba(212, 165, 116, 0.2);
        }

        canvas {
            display: block;
            width: 100%;
            border-radius: 10px;
            cursor: pointer;
        }

        .controls {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(212, 165, 116, 0.2);
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            color: #d4a574;
            font-weight: 500;
        }

        .control-group input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }

        .control-value {
            text-align: right;
            font-size: 0.85rem;
            color: #888;
        }

        .empire-select {
            width: 100%;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(212, 165, 116, 0.3);
            border-radius: 8px;
            color: #e0e0e0;
            font-size: 0.95rem;
            cursor: pointer;
        }

        .empire-select option {
            background: #1a1a2e;
        }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #d4a574, #bc8c5c);
            color: #1a1a2e;
            font-weight: 600;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(212, 165, 116, 0.3);
        }

        .btn-secondary {
            background: rgba(212, 165, 116, 0.2);
            color: #d4a574;
            border: 1px solid rgba(212, 165, 116, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(212, 165, 116, 0.3);
        }

        .stats-panel {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #888;
        }

        .stat-value {
            font-weight: 600;
            color: #d4a574;
        }

        .legend {
            margin-top: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .legend-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #d4a574;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 0;
            font-size: 0.85rem;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        .year-display {
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: #d4a574;
            margin: 15px 0;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-link">
                <span>‚Üê</span>
                <span>Back to Historical Simulations</span>
            </a>
            <h1>Empire Expansion</h1>
            <p class="description">Model territory conquest dynamics with military strength, economic power, and cultural influence. Watch empires rise, expand, and interact.</p>
        </header>

        <div class="main-content">
            <div class="canvas-container">
                <canvas id="canvas"></canvas>
            </div>

            <div class="controls">
                <div class="year-display">
                    Year: <span id="yearDisplay">500 BCE</span>
                </div>

                <div class="control-group">
                    <label>Select Empire to Focus</label>
                    <select class="empire-select" id="empireSelect">
                        <option value="-1">All Empires</option>
                    </select>
                </div>

                <div class="control-group">
                    <label>Military Power Factor</label>
                    <input type="range" id="militaryFactor" min="0.5" max="2" step="0.1" value="1">
                    <div class="control-value"><span id="militaryValue">1.0</span>x</div>
                </div>

                <div class="control-group">
                    <label>Economic Growth Rate</label>
                    <input type="range" id="economicRate" min="0.5" max="2" step="0.1" value="1">
                    <div class="control-value"><span id="economicValue">1.0</span>x</div>
                </div>

                <div class="control-group">
                    <label>Cultural Spread Speed</label>
                    <input type="range" id="culturalSpeed" min="0.5" max="2" step="0.1" value="1">
                    <div class="control-value"><span id="culturalValue">1.0</span>x</div>
                </div>

                <div class="control-group">
                    <label>Simulation Speed</label>
                    <input type="range" id="simSpeed" min="1" max="10" step="1" value="5">
                    <div class="control-value"><span id="speedValue">5</span> years/tick</div>
                </div>

                <button class="btn btn-primary" id="playPause">Pause</button>
                <button class="btn btn-secondary" id="reset">Reset Simulation</button>

                <div class="stats-panel">
                    <div class="stat-row">
                        <span class="stat-label">Total Territories</span>
                        <span class="stat-value" id="totalTerritories">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Active Empires</span>
                        <span class="stat-value" id="activeEmpires">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Conflicts This Era</span>
                        <span class="stat-value" id="conflicts">0</span>
                    </div>
                </div>

                <div class="legend" id="legend">
                    <div class="legend-title">Empires</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // Set canvas size
        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth - 30;
            canvas.height = Math.min(600, window.innerHeight - 250);
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Empire definitions with historical colors
        const empireTemplates = [
            { name: 'Roman Empire', color: '#8B0000', startYear: -500, peakYear: 100 },
            { name: 'Persian Empire', color: '#DAA520', startYear: -550, peakYear: -450 },
            { name: 'Greek States', color: '#4169E1', startYear: -800, peakYear: -400 },
            { name: 'Egyptian Kingdom', color: '#CD853F', startYear: -3000, peakYear: -1200 },
            { name: 'Carthage', color: '#8B4513', startYear: -800, peakYear: -250 },
            { name: 'Celtic Tribes', color: '#228B22', startYear: -800, peakYear: -300 },
            { name: 'Parthian Empire', color: '#9932CC', startYear: -247, peakYear: 100 },
            { name: 'Han Dynasty', color: '#DC143C', startYear: -206, peakYear: 100 }
        ];

        // Simulation state
        let territories = [];
        let empires = [];
        let year = -500;
        let running = true;
        let conflictCount = 0;

        // Parameters
        let militaryFactor = 1;
        let economicRate = 1;
        let culturalSpeed = 1;
        let simSpeed = 5;

        // Initialize territories (hex-like grid)
        function initTerritories() {
            territories = [];
            const cols = 20;
            const rows = 12;
            const hexWidth = canvas.width / cols;
            const hexHeight = canvas.height / rows;

            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    const offset = row % 2 === 0 ? 0 : hexWidth / 2;
                    territories.push({
                        x: col * hexWidth + offset + hexWidth / 2,
                        y: row * hexHeight + hexHeight / 2,
                        width: hexWidth,
                        height: hexHeight,
                        row, col,
                        owner: -1,
                        resources: 0.5 + Math.random() * 0.5,
                        population: Math.random() * 100,
                        loyalty: 0,
                        culture: -1
                    });
                }
            }
        }

        // Initialize empires
        function initEmpires() {
            empires = empireTemplates.map((template, i) => ({
                ...template,
                id: i,
                military: 50 + Math.random() * 50,
                economy: 50 + Math.random() * 50,
                culture: 50 + Math.random() * 50,
                capital: null,
                active: false,
                territories: 0
            }));

            // Assign starting positions
            const startPositions = [
                { row: 6, col: 8 },   // Rome - center
                { row: 5, col: 15 },  // Persia - east
                { row: 4, col: 10 },  // Greece
                { row: 8, col: 12 },  // Egypt
                { row: 7, col: 5 },   // Carthage
                { row: 2, col: 4 },   // Celts
                { row: 6, col: 17 },  // Parthia
                { row: 3, col: 18 }   // Han
            ];

            empires.forEach((empire, i) => {
                const pos = startPositions[i];
                const territory = territories.find(t => t.row === pos.row && t.col === pos.col);
                if (territory) {
                    empire.capital = territory;
                    territory.owner = i;
                    territory.loyalty = 100;
                    territory.culture = i;
                    empire.active = year >= empire.startYear;
                    if (empire.active) empire.territories = 1;
                }
            });

            updateEmpireSelect();
            updateLegend();
        }

        function updateEmpireSelect() {
            const select = document.getElementById('empireSelect');
            select.innerHTML = '<option value="-1">All Empires</option>';
            empires.forEach((empire, i) => {
                if (empire.active) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = empire.name;
                    select.appendChild(option);
                }
            });
        }

        function updateLegend() {
            const legend = document.getElementById('legend');
            legend.innerHTML = '<div class="legend-title">Empires</div>';
            empires.forEach(empire => {
                if (empire.active) {
                    const item = document.createElement('div');
                    item.className = 'legend-item';
                    item.innerHTML = `
                        <div class="legend-color" style="background: ${empire.color}"></div>
                        <span>${empire.name} (${empire.territories})</span>
                    `;
                    legend.appendChild(item);
                }
            });
        }

        // Get neighboring territories
        function getNeighbors(territory) {
            return territories.filter(t => {
                const dx = Math.abs(t.x - territory.x);
                const dy = Math.abs(t.y - territory.y);
                return dx < territory.width * 1.2 && dy < territory.height * 1.2 && t !== territory;
            });
        }

        // Simulate expansion
        function simulate() {
            if (!running) return;

            year += simSpeed;
            document.getElementById('yearDisplay').textContent =
                year < 0 ? `${Math.abs(year)} BCE` : `${year} CE`;

            // Activate empires based on year
            empires.forEach((empire, i) => {
                if (!empire.active && year >= empire.startYear) {
                    empire.active = true;
                    if (empire.capital) {
                        empire.capital.owner = i;
                        empire.territories = 1;
                    }
                    updateEmpireSelect();
                }
            });

            // Each active empire tries to expand
            empires.forEach((empire, empireId) => {
                if (!empire.active) return;

                // Calculate power based on year relative to peak
                const yearFromPeak = Math.abs(year - empire.peakYear);
                const peakMultiplier = Math.max(0.3, 1 - yearFromPeak / 500);

                // Update empire stats
                empire.economy += (economicRate * 0.5 * peakMultiplier - 0.2) * (empire.territories / 10);
                empire.military += (militaryFactor * 0.3 * peakMultiplier - 0.15) * (empire.territories / 10);
                empire.culture += (culturalSpeed * 0.2 * peakMultiplier);

                empire.economy = Math.max(10, Math.min(200, empire.economy));
                empire.military = Math.max(10, Math.min(200, empire.military));
                empire.culture = Math.max(10, Math.min(200, empire.culture));

                // Try to expand to neighboring territories
                const ownedTerritories = territories.filter(t => t.owner === empireId);

                ownedTerritories.forEach(owned => {
                    const neighbors = getNeighbors(owned);
                    neighbors.forEach(neighbor => {
                        if (neighbor.owner === -1) {
                            // Unowned territory - chance to claim
                            const claimChance = (empire.military * militaryFactor + empire.economy * economicRate) / 500 * peakMultiplier;
                            if (Math.random() < claimChance * 0.1) {
                                neighbor.owner = empireId;
                                neighbor.loyalty = 30 + Math.random() * 20;
                                neighbor.culture = empireId;
                                empire.territories++;
                            }
                        } else if (neighbor.owner !== empireId) {
                            // Enemy territory - possible conflict
                            const enemy = empires[neighbor.owner];
                            if (enemy && enemy.active) {
                                const attackPower = empire.military * militaryFactor * peakMultiplier;
                                const defensePower = enemy.military * militaryFactor * (neighbor.loyalty / 100);

                                if (attackPower > defensePower * 1.5 && Math.random() < 0.05) {
                                    // Conquest
                                    enemy.territories--;
                                    neighbor.owner = empireId;
                                    neighbor.loyalty = 20;
                                    empire.territories++;
                                    conflictCount++;

                                    // Damage to both
                                    empire.military *= 0.95;
                                    enemy.military *= 0.9;
                                }
                            }
                        }
                    });
                });

                // Cultural spread
                ownedTerritories.forEach(owned => {
                    owned.loyalty = Math.min(100, owned.loyalty + culturalSpeed * 0.5);
                });

                // Check for collapse
                if (empire.territories === 0 || (year - empire.peakYear > 400 && empire.territories < 3)) {
                    empire.active = false;
                    territories.forEach(t => {
                        if (t.owner === empireId) {
                            t.owner = -1;
                            t.loyalty = 0;
                        }
                    });
                }
            });

            // Update territory count
            empires.forEach((empire, i) => {
                empire.territories = territories.filter(t => t.owner === i).length;
            });

            updateStats();
            updateLegend();
        }

        function updateStats() {
            const owned = territories.filter(t => t.owner !== -1).length;
            const active = empires.filter(e => e.active).length;

            document.getElementById('totalTerritories').textContent = owned;
            document.getElementById('activeEmpires').textContent = active;
            document.getElementById('conflicts').textContent = conflictCount;
        }

        // Draw territories
        function drawHexagon(x, y, size, color, borderColor) {
            ctx.beginPath();
            for (let i = 0; i < 6; i++) {
                const angle = (Math.PI / 3) * i - Math.PI / 6;
                const hx = x + size * Math.cos(angle);
                const hy = y + size * Math.sin(angle);
                if (i === 0) ctx.moveTo(hx, hy);
                else ctx.lineTo(hx, hy);
            }
            ctx.closePath();
            ctx.fillStyle = color;
            ctx.fill();
            ctx.strokeStyle = borderColor;
            ctx.lineWidth = 1;
            ctx.stroke();
        }

        function draw() {
            ctx.fillStyle = '#0a1628';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw sea/land background
            ctx.fillStyle = '#1a3a5c';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const selectedEmpire = parseInt(document.getElementById('empireSelect').value);

            // Draw territories
            territories.forEach(territory => {
                let color = '#2a4a3a'; // Unowned land
                let borderColor = '#1a2a2a';

                if (territory.owner !== -1) {
                    const empire = empires[territory.owner];
                    if (empire) {
                        color = empire.color;

                        // Adjust alpha based on loyalty
                        const alpha = 0.4 + (territory.loyalty / 100) * 0.6;
                        color = empire.color + Math.floor(alpha * 255).toString(16).padStart(2, '0');

                        // Highlight selected empire
                        if (selectedEmpire !== -1 && territory.owner === selectedEmpire) {
                            borderColor = '#ffffff';
                        } else if (selectedEmpire !== -1) {
                            color = empire.color + '44'; // Fade others
                        }
                    }
                }

                const size = Math.min(territory.width, territory.height) * 0.45;
                drawHexagon(territory.x, territory.y, size, color, borderColor);

                // Draw capital marker
                if (empires[territory.owner]?.capital === territory) {
                    ctx.fillStyle = '#ffffff';
                    ctx.beginPath();
                    ctx.arc(territory.x, territory.y, 5, 0, Math.PI * 2);
                    ctx.fill();
                }
            });

            // Draw empire labels for active empires
            empires.forEach(empire => {
                if (empire.active && empire.capital) {
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
                    ctx.font = 'bold 10px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText(empire.name.split(' ')[0], empire.capital.x, empire.capital.y + 20);
                }
            });
        }

        function animate() {
            simulate();
            draw();
            setTimeout(() => requestAnimationFrame(animate), 200);
        }

        // Controls
        document.getElementById('militaryFactor').addEventListener('input', (e) => {
            militaryFactor = parseFloat(e.target.value);
            document.getElementById('militaryValue').textContent = militaryFactor.toFixed(1);
        });

        document.getElementById('economicRate').addEventListener('input', (e) => {
            economicRate = parseFloat(e.target.value);
            document.getElementById('economicValue').textContent = economicRate.toFixed(1);
        });

        document.getElementById('culturalSpeed').addEventListener('input', (e) => {
            culturalSpeed = parseFloat(e.target.value);
            document.getElementById('culturalValue').textContent = culturalSpeed.toFixed(1);
        });

        document.getElementById('simSpeed').addEventListener('input', (e) => {
            simSpeed = parseInt(e.target.value);
            document.getElementById('speedValue').textContent = simSpeed;
        });

        document.getElementById('playPause').addEventListener('click', () => {
            running = !running;
            document.getElementById('playPause').textContent = running ? 'Pause' : 'Play';
        });

        document.getElementById('reset').addEventListener('click', () => {
            year = -500;
            conflictCount = 0;
            initTerritories();
            initEmpires();
            document.getElementById('yearDisplay').textContent = '500 BCE';
        });

        // Initialize
        initTerritories();
        initEmpires();
        animate();
    </script>
</body>
</html>
