<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Technology Diffusion | Historical Simulations</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #d4a574;
            text-decoration: none;
            font-weight: 500;
            margin-bottom: 15px;
            padding: 8px 16px;
            background: rgba(212, 165, 116, 0.1);
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        .back-link:hover {
            background: rgba(212, 165, 116, 0.2);
            transform: translateX(-5px);
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #d4a574, #bc8c5c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .description {
            color: #a0a0a0;
            max-width: 700px;
            margin: 0 auto;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }

        .canvas-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 15px;
            border: 1px solid rgba(212, 165, 116, 0.2);
        }

        canvas {
            display: block;
            width: 100%;
            border-radius: 10px;
        }

        .controls {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(212, 165, 116, 0.2);
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            color: #d4a574;
            font-weight: 500;
        }

        .control-group input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }

        select {
            width: 100%;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(212, 165, 116, 0.3);
            border-radius: 8px;
            color: #e0e0e0;
            font-size: 0.95rem;
        }

        select option {
            background: #1a1a2e;
        }

        .control-value {
            text-align: right;
            font-size: 0.85rem;
            color: #888;
        }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #d4a574, #bc8c5c);
            color: #1a1a2e;
            font-weight: 600;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(212, 165, 116, 0.3);
        }

        .btn-secondary {
            background: rgba(212, 165, 116, 0.2);
            color: #d4a574;
            border: 1px solid rgba(212, 165, 116, 0.3);
        }

        .year-display {
            text-align: center;
            font-size: 1.3rem;
            font-weight: 700;
            color: #d4a574;
            margin: 15px 0;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .stats-panel {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #888;
            font-size: 0.9rem;
        }

        .stat-value {
            font-weight: 600;
            color: #d4a574;
        }

        .tech-info {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            border-left: 3px solid #d4a574;
        }

        .tech-name {
            font-weight: 600;
            color: #d4a574;
            margin-bottom: 5px;
        }

        .tech-desc {
            font-size: 0.85rem;
            color: #a0a0a0;
            line-height: 1.5;
        }

        .adoption-chart {
            margin-top: 15px;
            height: 80px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-link">
                <span>←</span>
                <span>Back to Historical Simulations</span>
            </a>
            <h1>Technology Diffusion</h1>
            <p class="description">Visualize how transformative innovations like the wheel, printing press, and gunpowder spread across civilizations through trade, conquest, and cultural exchange.</p>
        </header>

        <div class="main-content">
            <div class="canvas-container">
                <canvas id="canvas"></canvas>
            </div>

            <div class="controls">
                <div class="year-display">
                    <span id="yearDisplay">3500 BCE</span>
                </div>

                <div class="control-group">
                    <label>Technology</label>
                    <select id="techSelect">
                        <option value="wheel">The Wheel (3500 BCE)</option>
                        <option value="bronze">Bronze Working (3300 BCE)</option>
                        <option value="iron">Iron Smelting (1200 BCE)</option>
                        <option value="paper">Paper Making (100 CE)</option>
                        <option value="gunpowder">Gunpowder (850 CE)</option>
                        <option value="compass">Magnetic Compass (1100 CE)</option>
                        <option value="printing">Printing Press (1440 CE)</option>
                    </select>
                </div>

                <div class="control-group">
                    <label>Diffusion Speed</label>
                    <input type="range" id="diffusionSpeed" min="0.5" max="2" step="0.1" value="1">
                    <div class="control-value"><span id="diffusionValue">1.0</span>x</div>
                </div>

                <div class="control-group">
                    <label>Trade Network Strength</label>
                    <input type="range" id="tradeStrength" min="0.5" max="2" step="0.1" value="1">
                    <div class="control-value"><span id="tradeValue">1.0</span>x</div>
                </div>

                <div class="control-group">
                    <label>Cultural Resistance</label>
                    <input type="range" id="resistance" min="0" max="1" step="0.1" value="0.3">
                    <div class="control-value"><span id="resistanceValue">0.3</span></div>
                </div>

                <button class="btn btn-primary" id="playPause">Pause</button>
                <button class="btn btn-secondary" id="reset">Reset</button>

                <div class="stats-panel">
                    <div class="stat-row">
                        <span class="stat-label">Global Adoption</span>
                        <span class="stat-value" id="adoption">0%</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Regions Reached</span>
                        <span class="stat-value" id="regionsReached">1</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Years Since Invention</span>
                        <span class="stat-value" id="yearsSince">0</span>
                    </div>
                </div>

                <div class="tech-info" id="techInfo">
                    <div class="tech-name">The Wheel</div>
                    <div class="tech-desc">Invented in Mesopotamia, revolutionized transportation and pottery making. Spread via trade routes across Eurasia.</div>
                </div>

                <div class="adoption-chart">
                    <canvas id="chartCanvas" width="260" height="80"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const chartCanvas = document.getElementById('chartCanvas');
        const chartCtx = chartCanvas.getContext('2d');

        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth - 30;
            canvas.height = Math.min(550, window.innerHeight - 250);
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Technology definitions
        const technologies = {
            wheel: {
                name: 'The Wheel',
                origin: { x: 0.58, y: 0.40, name: 'Mesopotamia' },
                startYear: -3500,
                desc: 'Invented in Mesopotamia, revolutionized transportation and pottery making. Spread via trade routes across Eurasia.',
                color: '#8B4513'
            },
            bronze: {
                name: 'Bronze Working',
                origin: { x: 0.58, y: 0.40, name: 'Near East' },
                startYear: -3300,
                desc: 'Copper-tin alloy enabled superior weapons and tools. Knowledge spread through metallurgist migration and trade.',
                color: '#CD7F32'
            },
            iron: {
                name: 'Iron Smelting',
                origin: { x: 0.55, y: 0.38, name: 'Anatolia' },
                startYear: -1200,
                desc: 'Hittites developed iron working, ending Bronze Age. Spread after Hittite collapse, democratizing metal tools.',
                color: '#434343'
            },
            paper: {
                name: 'Paper Making',
                origin: { x: 0.80, y: 0.38, name: 'China' },
                startYear: 100,
                desc: 'Cai Lun refined papermaking process. Spread west via Silk Road, reaching Islamic world then Europe.',
                color: '#F5F5DC'
            },
            gunpowder: {
                name: 'Gunpowder',
                origin: { x: 0.80, y: 0.40, name: 'China' },
                startYear: 850,
                desc: 'Chinese alchemists discovered explosive mixture. Mongol conquests spread it westward, transforming warfare.',
                color: '#2F4F4F'
            },
            compass: {
                name: 'Magnetic Compass',
                origin: { x: 0.80, y: 0.42, name: 'China' },
                startYear: 1100,
                desc: 'Chinese navigators first used magnetized needles. Enabled Age of Exploration and global maritime trade.',
                color: '#4169E1'
            },
            printing: {
                name: 'Printing Press',
                origin: { x: 0.48, y: 0.30, name: 'Germany' },
                startYear: 1440,
                desc: 'Gutenberg\'s movable type revolutionized information spread. Fueled Renaissance, Reformation, and Scientific Revolution.',
                color: '#1C1C1C'
            }
        };

        // Civilization centers
        const civilizations = [
            { name: 'Mesopotamia', x: 0.58, y: 0.40 },
            { name: 'Egypt', x: 0.52, y: 0.48 },
            { name: 'Indus', x: 0.68, y: 0.44 },
            { name: 'China', x: 0.80, y: 0.38 },
            { name: 'Greece', x: 0.52, y: 0.36 },
            { name: 'Rome', x: 0.48, y: 0.36 },
            { name: 'Persia', x: 0.62, y: 0.40 },
            { name: 'India', x: 0.70, y: 0.48 },
            { name: 'Arabia', x: 0.58, y: 0.48 },
            { name: 'Japan', x: 0.88, y: 0.36 },
            { name: 'Britain', x: 0.45, y: 0.28 },
            { name: 'France', x: 0.46, y: 0.32 },
            { name: 'Germany', x: 0.48, y: 0.30 },
            { name: 'Spain', x: 0.42, y: 0.38 },
            { name: 'Russia', x: 0.62, y: 0.25 },
            { name: 'Ethiopia', x: 0.56, y: 0.55 },
            { name: 'Southeast Asia', x: 0.78, y: 0.52 },
            { name: 'Korea', x: 0.84, y: 0.35 }
        ];

        // State
        let currentTech = 'wheel';
        let year = -3500;
        let running = true;
        let adoptionHistory = [];

        // Parameters
        let diffusionSpeed = 1;
        let tradeStrength = 1;
        let resistance = 0.3;

        // Adoption levels per civilization
        let adoption = {};

        function initSimulation() {
            const tech = technologies[currentTech];
            year = tech.startYear;
            adoption = {};
            adoptionHistory = [];

            civilizations.forEach(civ => {
                adoption[civ.name] = 0;
            });

            // Origin has full adoption
            adoption[tech.origin.name] = 100;

            updateTechInfo();
        }

        function updateTechInfo() {
            const tech = technologies[currentTech];
            document.getElementById('techInfo').innerHTML = `
                <div class="tech-name">${tech.name}</div>
                <div class="tech-desc">${tech.desc}</div>
            `;
        }

        // Calculate distance between two civilizations
        function getDistance(civ1, civ2) {
            const dx = civ1.x - civ2.x;
            const dy = civ1.y - civ2.y;
            return Math.sqrt(dx * dx + dy * dy);
        }

        // Get trade connections (simplified)
        function getTradeConnections(civName) {
            const connections = {
                'Mesopotamia': ['Egypt', 'Persia', 'Indus', 'Greece'],
                'Egypt': ['Mesopotamia', 'Greece', 'Arabia', 'Ethiopia'],
                'Indus': ['Mesopotamia', 'Persia', 'India', 'China'],
                'China': ['Indus', 'India', 'Japan', 'Korea', 'Southeast Asia'],
                'Greece': ['Mesopotamia', 'Egypt', 'Rome', 'Persia'],
                'Rome': ['Greece', 'Egypt', 'Spain', 'France', 'Britain'],
                'Persia': ['Mesopotamia', 'Greece', 'India', 'Arabia'],
                'India': ['Persia', 'China', 'Southeast Asia', 'Arabia'],
                'Arabia': ['Egypt', 'Persia', 'India', 'Ethiopia'],
                'Japan': ['China', 'Korea'],
                'Britain': ['Rome', 'France', 'Germany'],
                'France': ['Rome', 'Britain', 'Germany', 'Spain'],
                'Germany': ['France', 'Britain', 'Russia'],
                'Spain': ['Rome', 'France', 'Arabia'],
                'Russia': ['Germany', 'Persia', 'China'],
                'Ethiopia': ['Egypt', 'Arabia'],
                'Southeast Asia': ['India', 'China'],
                'Korea': ['China', 'Japan']
            };
            return connections[civName] || [];
        }

        function simulate() {
            if (!running) return;

            const tech = technologies[currentTech];
            year += Math.round(10 * diffusionSpeed);

            const yearStr = year < 0 ? `${Math.abs(year)} BCE` : `${year} CE`;
            document.getElementById('yearDisplay').textContent = yearStr;

            // Diffusion simulation
            civilizations.forEach(civ => {
                if (adoption[civ.name] >= 100) return;

                // Check influence from connected civilizations
                const connections = getTradeConnections(civ.name);
                let totalInfluence = 0;

                connections.forEach(connName => {
                    const connAdoption = adoption[connName] || 0;
                    if (connAdoption > 0) {
                        const connCiv = civilizations.find(c => c.name === connName);
                        const distance = getDistance(civ, connCiv);
                        const influence = (connAdoption / 100) * tradeStrength / (distance * 10);
                        totalInfluence += influence;
                    }
                });

                // Apply diffusion with resistance
                if (totalInfluence > 0) {
                    const adoptionRate = totalInfluence * diffusionSpeed * (1 - resistance) * 2;
                    adoption[civ.name] = Math.min(100, (adoption[civ.name] || 0) + adoptionRate);
                }
            });

            // Record history for chart
            const totalAdoption = Object.values(adoption).reduce((a, b) => a + b, 0);
            const avgAdoption = totalAdoption / civilizations.length;
            adoptionHistory.push(avgAdoption);
            if (adoptionHistory.length > 50) adoptionHistory.shift();

            updateStats();
            drawChart();
        }

        function updateStats() {
            const totalAdoption = Object.values(adoption).reduce((a, b) => a + b, 0);
            const avgAdoption = Math.round(totalAdoption / civilizations.length);
            const regionsReached = Object.values(adoption).filter(a => a > 10).length;
            const tech = technologies[currentTech];
            const yearsSince = year - tech.startYear;

            document.getElementById('adoption').textContent = avgAdoption + '%';
            document.getElementById('regionsReached').textContent = regionsReached;
            document.getElementById('yearsSince').textContent = yearsSince.toLocaleString();
        }

        function drawChart() {
            chartCtx.fillStyle = 'rgba(0, 0, 0, 0.3)';
            chartCtx.fillRect(0, 0, chartCanvas.width, chartCanvas.height);

            if (adoptionHistory.length < 2) return;

            chartCtx.strokeStyle = '#d4a574';
            chartCtx.lineWidth = 2;
            chartCtx.beginPath();

            adoptionHistory.forEach((val, i) => {
                const x = (i / 50) * chartCanvas.width;
                const y = chartCanvas.height - (val / 100) * (chartCanvas.height - 10) - 5;
                if (i === 0) chartCtx.moveTo(x, y);
                else chartCtx.lineTo(x, y);
            });

            chartCtx.stroke();

            // Fill under curve
            chartCtx.lineTo(chartCanvas.width, chartCanvas.height);
            chartCtx.lineTo(0, chartCanvas.height);
            chartCtx.closePath();
            chartCtx.fillStyle = 'rgba(212, 165, 116, 0.2)';
            chartCtx.fill();
        }

        function draw() {
            // Ocean background
            ctx.fillStyle = '#0a1830';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Simplified continents
            ctx.fillStyle = '#1a3a2a';

            // Europe
            ctx.beginPath();
            ctx.moveTo(canvas.width * 0.40, canvas.height * 0.15);
            ctx.lineTo(canvas.width * 0.55, canvas.height * 0.18);
            ctx.lineTo(canvas.width * 0.58, canvas.height * 0.35);
            ctx.lineTo(canvas.width * 0.50, canvas.height * 0.42);
            ctx.lineTo(canvas.width * 0.38, canvas.height * 0.40);
            ctx.lineTo(canvas.width * 0.38, canvas.height * 0.25);
            ctx.fill();

            // Africa
            ctx.beginPath();
            ctx.moveTo(canvas.width * 0.42, canvas.height * 0.42);
            ctx.lineTo(canvas.width * 0.60, canvas.height * 0.42);
            ctx.lineTo(canvas.width * 0.62, canvas.height * 0.75);
            ctx.lineTo(canvas.width * 0.50, canvas.height * 0.85);
            ctx.lineTo(canvas.width * 0.42, canvas.height * 0.70);
            ctx.fill();

            // Asia
            ctx.beginPath();
            ctx.moveTo(canvas.width * 0.55, canvas.height * 0.15);
            ctx.lineTo(canvas.width * 0.92, canvas.height * 0.18);
            ctx.lineTo(canvas.width * 0.90, canvas.height * 0.55);
            ctx.lineTo(canvas.width * 0.65, canvas.height * 0.55);
            ctx.lineTo(canvas.width * 0.58, canvas.height * 0.35);
            ctx.fill();

            // India
            ctx.beginPath();
            ctx.moveTo(canvas.width * 0.65, canvas.height * 0.42);
            ctx.lineTo(canvas.width * 0.75, canvas.height * 0.42);
            ctx.lineTo(canvas.width * 0.70, canvas.height * 0.58);
            ctx.fill();

            // Draw trade routes (faded lines between connected civs)
            ctx.strokeStyle = 'rgba(212, 165, 116, 0.15)';
            ctx.lineWidth = 1;
            civilizations.forEach(civ => {
                const connections = getTradeConnections(civ.name);
                connections.forEach(connName => {
                    const conn = civilizations.find(c => c.name === connName);
                    if (conn) {
                        ctx.beginPath();
                        ctx.moveTo(civ.x * canvas.width, civ.y * canvas.height);
                        ctx.lineTo(conn.x * canvas.width, conn.y * canvas.height);
                        ctx.stroke();
                    }
                });
            });

            // Draw civilizations
            const tech = technologies[currentTech];

            civilizations.forEach(civ => {
                const x = civ.x * canvas.width;
                const y = civ.y * canvas.height;
                const adoptLevel = adoption[civ.name] || 0;

                // Adoption glow
                if (adoptLevel > 0) {
                    const glowSize = 10 + adoptLevel * 0.3;
                    const alpha = adoptLevel / 200;
                    const gradient = ctx.createRadialGradient(x, y, 0, x, y, glowSize);
                    gradient.addColorStop(0, `rgba(212, 165, 116, ${alpha})`);
                    gradient.addColorStop(1, 'rgba(212, 165, 116, 0)');
                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.arc(x, y, glowSize, 0, Math.PI * 2);
                    ctx.fill();
                }

                // City marker
                const isOrigin = civ.name === tech.origin.name;
                ctx.fillStyle = adoptLevel > 50 ? '#d4a574' :
                               adoptLevel > 10 ? '#a08060' : '#4a5a4a';
                ctx.beginPath();
                ctx.arc(x, y, isOrigin ? 8 : 5, 0, Math.PI * 2);
                ctx.fill();

                if (isOrigin) {
                    ctx.strokeStyle = '#ffffff';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }

                // Label
                ctx.fillStyle = adoptLevel > 20 ? '#e0e0e0' : '#808080';
                ctx.font = '10px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(civ.name, x, y + 15);

                // Adoption percentage
                if (adoptLevel > 0) {
                    ctx.fillStyle = '#d4a574';
                    ctx.font = 'bold 9px sans-serif';
                    ctx.fillText(Math.round(adoptLevel) + '%', x, y - 10);
                }
            });

            // Technology origin marker
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 12px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('★ ' + tech.name + ' Origin', 15, 25);
        }

        function animate() {
            simulate();
            draw();
            setTimeout(() => requestAnimationFrame(animate), 150);
        }

        // Controls
        document.getElementById('techSelect').addEventListener('change', (e) => {
            currentTech = e.target.value;
            initSimulation();
        });

        document.getElementById('diffusionSpeed').addEventListener('input', (e) => {
            diffusionSpeed = parseFloat(e.target.value);
            document.getElementById('diffusionValue').textContent = diffusionSpeed.toFixed(1);
        });

        document.getElementById('tradeStrength').addEventListener('input', (e) => {
            tradeStrength = parseFloat(e.target.value);
            document.getElementById('tradeValue').textContent = tradeStrength.toFixed(1);
        });

        document.getElementById('resistance').addEventListener('input', (e) => {
            resistance = parseFloat(e.target.value);
            document.getElementById('resistanceValue').textContent = resistance.toFixed(1);
        });

        document.getElementById('playPause').addEventListener('click', () => {
            running = !running;
            document.getElementById('playPause').textContent = running ? 'Pause' : 'Play';
        });

        document.getElementById('reset').addEventListener('click', initSimulation);

        // Initialize
        initSimulation();
        animate();
    </script>
</body>
</html>
