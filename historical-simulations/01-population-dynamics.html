<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Population Dynamics | Historical Simulations</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e2e8f0;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        .back-link {
            display: inline-block;
            color: #d4a574;
            text-decoration: none;
            margin-bottom: 20px;
            padding: 8px 16px;
            border: 1px solid rgba(212, 165, 116, 0.3);
            border-radius: 20px;
            transition: all 0.3s;
        }

        .back-link:hover {
            background: rgba(212, 165, 116, 0.1);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #d4a574, #bc8c5c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: #94a3b8;
            font-size: 1.1rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 30px;
        }

        .simulation-area {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(212, 165, 116, 0.2);
        }

        #canvas {
            width: 100%;
            height: 400px;
            background: #0a0a14;
            border-radius: 15px;
        }

        .chart-area {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 15px;
            margin-top: 20px;
        }

        .chart-title {
            color: #d4a574;
            font-size: 0.9rem;
            margin-bottom: 10px;
            text-align: center;
        }

        #chartCanvas {
            width: 100%;
            height: 150px;
        }

        .controls {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(212, 165, 116, 0.2);
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            color: #d4a574;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .control-group input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: rgba(212, 165, 116, 0.2);
            -webkit-appearance: none;
        }

        .control-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #d4a574;
            cursor: pointer;
        }

        .control-value {
            text-align: right;
            color: #94a3b8;
            font-size: 0.85rem;
            margin-top: 5px;
        }

        .btn {
            width: 100%;
            padding: 12px;
            font-size: 0.95rem;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #d4a574, #bc8c5c);
            color: #1a1a2e;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(212, 165, 116, 0.3);
        }

        .stats-panel {
            background: rgba(212, 165, 116, 0.1);
            border-radius: 15px;
            padding: 15px;
            margin-top: 20px;
        }

        .stats-panel h3 {
            color: #d4a574;
            margin-bottom: 12px;
            font-size: 0.95rem;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.85rem;
        }

        .stat-label {
            color: #94a3b8;
        }

        .stat-value {
            color: #d4a574;
            font-weight: 600;
        }

        .year-display {
            text-align: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .year-value {
            font-size: 2rem;
            color: #d4a574;
            font-weight: bold;
        }

        .year-label {
            color: #94a3b8;
            font-size: 0.85rem;
        }

        .event-log {
            max-height: 120px;
            overflow-y: auto;
            font-size: 0.8rem;
            color: #94a3b8;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 10px;
            margin-top: 15px;
        }

        .event-log p {
            margin-bottom: 5px;
            border-left: 2px solid #d4a574;
            padding-left: 8px;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-link">← Back to Historical Simulations</a>
            <h1>Population Dynamics</h1>
            <p class="subtitle">Model ancient civilization growth across generations</p>
        </header>

        <div class="main-content">
            <div class="simulation-area">
                <canvas id="canvas"></canvas>
                <div class="chart-area">
                    <div class="chart-title">Population Over Time</div>
                    <canvas id="chartCanvas"></canvas>
                </div>
            </div>

            <div class="controls">
                <div class="year-display">
                    <div class="year-value" id="year">3000 BCE</div>
                    <div class="year-label">Current Year</div>
                </div>

                <div class="control-group">
                    <label>Birth Rate</label>
                    <input type="range" id="birthRate" min="1" max="10" value="4">
                    <div class="control-value"><span id="birthValue">4</span>%</div>
                </div>

                <div class="control-group">
                    <label>Death Rate</label>
                    <input type="range" id="deathRate" min="1" max="10" value="3">
                    <div class="control-value"><span id="deathValue">3</span>%</div>
                </div>

                <div class="control-group">
                    <label>Carrying Capacity (K)</label>
                    <input type="range" id="capacity" min="500" max="5000" step="100" value="2000">
                    <div class="control-value"><span id="capacityValue">2,000</span></div>
                </div>

                <div class="control-group">
                    <label>Migration Rate</label>
                    <input type="range" id="migration" min="0" max="5" value="1">
                    <div class="control-value"><span id="migrationValue">1</span>%</div>
                </div>

                <div class="control-group">
                    <label>Simulation Speed</label>
                    <input type="range" id="speed" min="1" max="10" value="5">
                    <div class="control-value"><span id="speedValue">5</span>x</div>
                </div>

                <button class="btn btn-primary" id="startBtn">▶ Start</button>
                <button class="btn btn-primary" id="resetBtn">↺ Reset</button>

                <div class="stats-panel">
                    <h3>Statistics</h3>
                    <div class="stat-row">
                        <span class="stat-label">Total Population</span>
                        <span class="stat-value" id="totalPop">100</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Settlements</span>
                        <span class="stat-value" id="settlements">1</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Growth Rate</span>
                        <span class="stat-value" id="growthRate">1%</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Max Reached</span>
                        <span class="stat-value" id="maxPop">100</span>
                    </div>
                </div>

                <div class="event-log" id="eventLog">
                    <p>Simulation ready...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const chartCanvas = document.getElementById('chartCanvas');
        const chartCtx = chartCanvas.getContext('2d');

        let width, height;
        let running = false;
        let year = -3000;
        let settlements = [];
        let populationHistory = [];
        let maxPopulation = 100;

        function resize() {
            width = canvas.offsetWidth * 2;
            height = canvas.offsetHeight * 2;
            canvas.width = width;
            canvas.height = height;
            chartCanvas.width = chartCanvas.offsetWidth * 2;
            chartCanvas.height = chartCanvas.offsetHeight * 2;
        }

        function createSettlement(x, y, pop) {
            return {
                x: x || Math.random() * width * 0.8 + width * 0.1,
                y: y || Math.random() * height * 0.8 + height * 0.1,
                population: pop || 50 + Math.floor(Math.random() * 50),
                age: 0
            };
        }

        function init() {
            settlements = [createSettlement(width / 2, height / 2, 100)];
            year = -3000;
            populationHistory = [];
            maxPopulation = 100;
            updateDisplay();
        }

        function logEvent(msg) {
            const log = document.getElementById('eventLog');
            const p = document.createElement('p');
            p.textContent = `${formatYear(year)}: ${msg}`;
            log.insertBefore(p, log.firstChild);
            if (log.children.length > 20) {
                log.removeChild(log.lastChild);
            }
        }

        function formatYear(y) {
            return y < 0 ? `${Math.abs(y)} BCE` : `${y} CE`;
        }

        function update() {
            const birthRate = parseInt(document.getElementById('birthRate').value) / 100;
            const deathRate = parseInt(document.getElementById('deathRate').value) / 100;
            const capacity = parseInt(document.getElementById('capacity').value);
            const migrationRate = parseInt(document.getElementById('migration').value) / 100;

            let totalPop = settlements.reduce((sum, s) => sum + s.population, 0);

            settlements.forEach(settlement => {
                settlement.age++;

                // Logistic growth
                const growthFactor = 1 - totalPop / capacity;
                const births = Math.floor(settlement.population * birthRate * Math.max(0, growthFactor));
                const deaths = Math.floor(settlement.population * deathRate * (1 + Math.max(0, (totalPop - capacity) / capacity)));

                settlement.population += births - deaths;
                settlement.population = Math.max(10, settlement.population);

                // Migration to new settlement
                if (settlement.population > capacity / settlements.length && Math.random() < migrationRate) {
                    const migrants = Math.floor(settlement.population * 0.2);
                    settlement.population -= migrants;

                    const newX = settlement.x + (Math.random() - 0.5) * 200;
                    const newY = settlement.y + (Math.random() - 0.5) * 200;
                    settlements.push(createSettlement(
                        Math.max(50, Math.min(width - 50, newX)),
                        Math.max(50, Math.min(height - 50, newY)),
                        migrants
                    ));
                    logEvent(`New settlement founded with ${migrants} migrants`);
                }
            });

            // Random events
            if (Math.random() < 0.01) {
                const eventType = Math.random();
                if (eventType < 0.3) {
                    // Plague
                    const affected = settlements[Math.floor(Math.random() * settlements.length)];
                    const deaths = Math.floor(affected.population * (0.1 + Math.random() * 0.2));
                    affected.population -= deaths;
                    logEvent(`Plague kills ${deaths} people`);
                } else if (eventType < 0.5) {
                    // Famine
                    settlements.forEach(s => {
                        s.population = Math.floor(s.population * 0.9);
                    });
                    logEvent('Famine strikes the region');
                } else if (eventType < 0.7) {
                    // Good harvest
                    settlements.forEach(s => {
                        s.population = Math.floor(s.population * 1.1);
                    });
                    logEvent('Bountiful harvest increases population');
                }
            }

            // Remove tiny settlements
            settlements = settlements.filter(s => s.population > 5);
            if (settlements.length === 0) {
                settlements = [createSettlement(width / 2, height / 2, 50)];
                logEvent('Civilization rebuilt from remnants');
            }

            totalPop = settlements.reduce((sum, s) => sum + s.population, 0);
            maxPopulation = Math.max(maxPopulation, totalPop);
            populationHistory.push(totalPop);
            if (populationHistory.length > 200) populationHistory.shift();

            year += 10;
            updateDisplay();
        }

        function updateDisplay() {
            const totalPop = settlements.reduce((sum, s) => sum + s.population, 0);
            const growthRate = populationHistory.length > 1
                ? ((totalPop - populationHistory[populationHistory.length - 2]) / populationHistory[populationHistory.length - 2] * 100).toFixed(1)
                : 0;

            document.getElementById('year').textContent = formatYear(year);
            document.getElementById('totalPop').textContent = totalPop.toLocaleString();
            document.getElementById('settlements').textContent = settlements.length;
            document.getElementById('growthRate').textContent = growthRate + '%';
            document.getElementById('maxPop').textContent = maxPopulation.toLocaleString();
        }

        function draw() {
            ctx.fillStyle = '#0a0a14';
            ctx.fillRect(0, 0, width, height);

            // Draw terrain (simple)
            ctx.fillStyle = 'rgba(212, 165, 116, 0.1)';
            ctx.beginPath();
            ctx.arc(width / 2, height / 2, 300, 0, Math.PI * 2);
            ctx.fill();

            // Draw connections between settlements
            ctx.strokeStyle = 'rgba(212, 165, 116, 0.2)';
            ctx.lineWidth = 1;
            for (let i = 0; i < settlements.length; i++) {
                for (let j = i + 1; j < settlements.length; j++) {
                    const dist = Math.sqrt(
                        Math.pow(settlements[i].x - settlements[j].x, 2) +
                        Math.pow(settlements[i].y - settlements[j].y, 2)
                    );
                    if (dist < 200) {
                        ctx.beginPath();
                        ctx.moveTo(settlements[i].x, settlements[i].y);
                        ctx.lineTo(settlements[j].x, settlements[j].y);
                        ctx.stroke();
                    }
                }
            }

            // Draw settlements
            settlements.forEach(s => {
                const size = Math.sqrt(s.population) * 2;
                const gradient = ctx.createRadialGradient(s.x, s.y, 0, s.x, s.y, size);
                gradient.addColorStop(0, 'rgba(212, 165, 116, 0.8)');
                gradient.addColorStop(1, 'rgba(212, 165, 116, 0)');

                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(s.x, s.y, size, 0, Math.PI * 2);
                ctx.fill();

                ctx.fillStyle = '#d4a574';
                ctx.beginPath();
                ctx.arc(s.x, s.y, size * 0.3, 0, Math.PI * 2);
                ctx.fill();

                // Population label
                if (s.population > 100) {
                    ctx.fillStyle = '#e2e8f0';
                    ctx.font = '16px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText(s.population.toString(), s.x, s.y - size - 10);
                }
            });

            drawChart();
        }

        function drawChart() {
            const w = chartCanvas.width;
            const h = chartCanvas.height;

            chartCtx.fillStyle = 'rgba(0, 0, 0, 0.3)';
            chartCtx.fillRect(0, 0, w, h);

            if (populationHistory.length < 2) return;

            const maxPop = Math.max(...populationHistory) * 1.1;
            const stepX = w / (populationHistory.length - 1);

            chartCtx.strokeStyle = '#d4a574';
            chartCtx.lineWidth = 2;
            chartCtx.beginPath();

            populationHistory.forEach((pop, i) => {
                const x = i * stepX;
                const y = h - (pop / maxPop) * h * 0.9 - h * 0.05;
                if (i === 0) chartCtx.moveTo(x, y);
                else chartCtx.lineTo(x, y);
            });
            chartCtx.stroke();

            // Fill
            chartCtx.lineTo((populationHistory.length - 1) * stepX, h);
            chartCtx.lineTo(0, h);
            chartCtx.fillStyle = 'rgba(212, 165, 116, 0.2)';
            chartCtx.fill();
        }

        function animate() {
            if (running) {
                const speed = parseInt(document.getElementById('speed').value);
                for (let i = 0; i < speed; i++) {
                    update();
                }
            }
            draw();
            requestAnimationFrame(animate);
        }

        // Event listeners
        document.getElementById('startBtn').addEventListener('click', () => {
            running = !running;
            document.getElementById('startBtn').textContent = running ? '⏸ Pause' : '▶ Start';
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            running = false;
            document.getElementById('startBtn').textContent = '▶ Start';
            init();
        });

        ['birthRate', 'deathRate', 'capacity', 'migration', 'speed'].forEach(id => {
            document.getElementById(id).addEventListener('input', (e) => {
                const valueId = id.replace('Rate', 'Value').replace('capacity', 'capacityValue').replace('migration', 'migrationValue').replace('speed', 'speedValue');
                const val = id === 'capacity' ? parseInt(e.target.value).toLocaleString() : e.target.value;
                document.getElementById(valueId).textContent = val;
            });
        });

        window.addEventListener('resize', resize);
        resize();
        init();
        animate();
    </script>
</body>
</html>
