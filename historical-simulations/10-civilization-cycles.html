<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Civilization Cycles | Historical Simulations</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #d4a574;
            text-decoration: none;
            font-weight: 500;
            margin-bottom: 15px;
            padding: 8px 16px;
            background: rgba(212, 165, 116, 0.1);
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        .back-link:hover {
            background: rgba(212, 165, 116, 0.2);
            transform: translateX(-5px);
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #d4a574, #bc8c5c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .description {
            color: #a0a0a0;
            max-width: 700px;
            margin: 0 auto;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }

        .canvas-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 15px;
            border: 1px solid rgba(212, 165, 116, 0.2);
        }

        canvas {
            display: block;
            width: 100%;
            border-radius: 10px;
        }

        .controls {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(212, 165, 116, 0.2);
            max-height: 85vh;
            overflow-y: auto;
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            color: #d4a574;
            font-weight: 500;
        }

        .control-group input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }

        .control-value {
            text-align: right;
            font-size: 0.85rem;
            color: #888;
        }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #d4a574, #bc8c5c);
            color: #1a1a2e;
            font-weight: 600;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(212, 165, 116, 0.3);
        }

        .btn-secondary {
            background: rgba(212, 165, 116, 0.2);
            color: #d4a574;
            border: 1px solid rgba(212, 165, 116, 0.3);
        }

        .year-display {
            text-align: center;
            font-size: 1.3rem;
            font-weight: 700;
            color: #d4a574;
            margin: 15px 0;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .civ-status {
            margin-top: 15px;
        }

        .civ-card {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 3px solid #d4a574;
            transition: all 0.3s ease;
        }

        .civ-card.rising {
            border-left-color: #51cf66;
        }

        .civ-card.peak {
            border-left-color: #ffd43b;
        }

        .civ-card.declining {
            border-left-color: #ff6b6b;
        }

        .civ-card.collapsed {
            border-left-color: #868e96;
            opacity: 0.6;
        }

        .civ-name {
            font-weight: 600;
            color: #d4a574;
            margin-bottom: 5px;
        }

        .civ-phase {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 8px;
        }

        .civ-meters {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .meter {
            text-align: center;
        }

        .meter-label {
            font-size: 0.7rem;
            color: #666;
            margin-bottom: 2px;
        }

        .meter-bar {
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
        }

        .meter-fill {
            height: 100%;
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        .fill-military { background: #ff6b6b; }
        .fill-economy { background: #ffd43b; }
        .fill-culture { background: #51cf66; }

        .legend {
            margin-top: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .legend-title {
            font-weight: 600;
            color: #d4a574;
            margin-bottom: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 0;
            font-size: 0.85rem;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-link">
                <span>‚Üê</span>
                <span>Back to Historical Simulations</span>
            </a>
            <h1>Civilization Cycles</h1>
            <p class="description">Explore the rise and fall of empires through a dynamic model of growth, peak, stagnation, and collapse. Based on historical patterns of civilizational development.</p>
        </header>

        <div class="main-content">
            <div class="canvas-container">
                <canvas id="canvas"></canvas>
            </div>

            <div class="controls">
                <div class="year-display">
                    Year: <span id="yearDisplay">3000 BCE</span>
                </div>

                <div class="control-group">
                    <label>External Pressure (Invasions)</label>
                    <input type="range" id="externalPressure" min="0" max="2" step="0.1" value="1">
                    <div class="control-value"><span id="pressureValue">1.0</span>x</div>
                </div>

                <div class="control-group">
                    <label>Internal Stability Factor</label>
                    <input type="range" id="stability" min="0.5" max="1.5" step="0.1" value="1">
                    <div class="control-value"><span id="stabilityValue">1.0</span>x</div>
                </div>

                <div class="control-group">
                    <label>Economic Resilience</label>
                    <input type="range" id="resilience" min="0.5" max="1.5" step="0.1" value="1">
                    <div class="control-value"><span id="resilienceValue">1.0</span>x</div>
                </div>

                <button class="btn btn-primary" id="playPause">Pause</button>
                <button class="btn btn-secondary" id="reset">Reset Simulation</button>

                <div class="legend">
                    <div class="legend-title">Civilization Phases</div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #51cf66;"></div>
                        <span>Rising - Expansion & Growth</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ffd43b;"></div>
                        <span>Peak - Golden Age</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ff6b6b;"></div>
                        <span>Declining - Contraction</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #868e96;"></div>
                        <span>Collapsed - Remnant State</span>
                    </div>
                </div>

                <div class="civ-status" id="civStatus">
                    <!-- Civilization cards will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth - 30;
            canvas.height = Math.min(600, window.innerHeight - 250);
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Civilization templates with historical data
        const civTemplates = [
            {
                name: 'Egypt',
                color: '#CD853F',
                x: 0.52, y: 0.48,
                startYear: -3100,
                peakYear: -1400,
                endYear: -30,
                desc: 'Ancient Egyptian civilization'
            },
            {
                name: 'Mesopotamia',
                color: '#8B4513',
                x: 0.58, y: 0.42,
                startYear: -3500,
                peakYear: -1800,
                endYear: -539,
                desc: 'Sumerian, Akkadian, Babylonian'
            },
            {
                name: 'Greece',
                color: '#4169E1',
                x: 0.52, y: 0.38,
                startYear: -800,
                peakYear: -430,
                endYear: -146,
                desc: 'Classical Greek civilization'
            },
            {
                name: 'Rome',
                color: '#8B0000',
                x: 0.48, y: 0.36,
                startYear: -753,
                peakYear: 117,
                endYear: 476,
                desc: 'Roman Republic and Empire'
            },
            {
                name: 'Persia',
                color: '#9932CC',
                x: 0.62, y: 0.40,
                startYear: -550,
                peakYear: -480,
                endYear: 651,
                desc: 'Persian Empire (Achaemenid to Sassanid)'
            },
            {
                name: 'China',
                color: '#DC143C',
                x: 0.80, y: 0.38,
                startYear: -1600,
                peakYear: 750,
                endYear: 2100,
                desc: 'Chinese civilization (continuous)'
            },
            {
                name: 'India',
                color: '#FF8C00',
                x: 0.68, y: 0.48,
                startYear: -1500,
                peakYear: 400,
                endYear: 2100,
                desc: 'Indian subcontinent civilizations'
            },
            {
                name: 'Byzantium',
                color: '#6A0DAD',
                x: 0.55, y: 0.36,
                startYear: 330,
                peakYear: 565,
                endYear: 1453,
                desc: 'Eastern Roman/Byzantine Empire'
            },
            {
                name: 'Islamic Caliphate',
                color: '#006400',
                x: 0.58, y: 0.46,
                startYear: 632,
                peakYear: 850,
                endYear: 1258,
                desc: 'Umayyad and Abbasid Caliphates'
            },
            {
                name: 'Mongols',
                color: '#2F4F4F',
                x: 0.72, y: 0.30,
                startYear: 1206,
                peakYear: 1279,
                endYear: 1368,
                desc: 'Mongol Empire'
            },
            {
                name: 'Ottomans',
                color: '#B22222',
                x: 0.56, y: 0.38,
                startYear: 1299,
                peakYear: 1566,
                endYear: 1922,
                desc: 'Ottoman Empire'
            },
            {
                name: 'Britain',
                color: '#000080',
                x: 0.45, y: 0.28,
                startYear: 1600,
                peakYear: 1900,
                endYear: 2100,
                desc: 'British Empire'
            }
        ];

        // State
        let civilizations = [];
        let year = -3000;
        let running = true;

        // Parameters
        let externalPressure = 1;
        let stability = 1;
        let resilience = 1;

        function initSimulation() {
            year = -3000;
            civilizations = civTemplates.map(template => ({
                ...template,
                military: 0,
                economy: 0,
                culture: 0,
                phase: 'dormant',
                power: 0,
                history: []
            }));
        }

        function getPhase(civ, currentYear) {
            if (currentYear < civ.startYear) return 'dormant';
            if (currentYear > civ.endYear) return 'collapsed';

            const totalSpan = civ.endYear - civ.startYear;
            const risingEnd = civ.peakYear - totalSpan * 0.1;
            const peakEnd = civ.peakYear + totalSpan * 0.1;

            if (currentYear < risingEnd) return 'rising';
            if (currentYear < peakEnd) return 'peak';
            return 'declining';
        }

        function simulate() {
            if (!running) return;

            year += 25;
            if (year > 2050) year = -3000;

            const yearStr = year < 0 ? `${Math.abs(year)} BCE` : `${year} CE`;
            document.getElementById('yearDisplay').textContent = yearStr;

            civilizations.forEach(civ => {
                const prevPhase = civ.phase;
                civ.phase = getPhase(civ, year);

                if (civ.phase === 'dormant') {
                    civ.military = 0;
                    civ.economy = 0;
                    civ.culture = 0;
                    civ.power = 0;
                    return;
                }

                // Base growth/decline rates
                let militaryChange = 0;
                let economyChange = 0;
                let cultureChange = 0;

                switch (civ.phase) {
                    case 'rising':
                        militaryChange = 2 + Math.random() * 2;
                        economyChange = 2.5 + Math.random() * 2;
                        cultureChange = 1.5 + Math.random() * 1.5;
                        break;
                    case 'peak':
                        militaryChange = 0.5 - Math.random() * 1;
                        economyChange = 0.5 - Math.random() * 0.5;
                        cultureChange = 1 + Math.random() * 2; // Culture peaks late
                        break;
                    case 'declining':
                        militaryChange = -1.5 - Math.random() * 2 * externalPressure;
                        economyChange = -1 - Math.random() * 1.5 / resilience;
                        cultureChange = -0.5 - Math.random() * 1;
                        break;
                    case 'collapsed':
                        militaryChange = -3;
                        economyChange = -2;
                        cultureChange = -1;
                        break;
                }

                // Apply stability modifier
                militaryChange *= stability;
                economyChange *= stability;

                // Update values
                civ.military = Math.max(0, Math.min(100, civ.military + militaryChange));
                civ.economy = Math.max(0, Math.min(100, civ.economy + economyChange));
                civ.culture = Math.max(0, Math.min(100, civ.culture + cultureChange));

                // Calculate overall power
                civ.power = (civ.military * 0.4 + civ.economy * 0.35 + civ.culture * 0.25);

                // Record history for chart
                civ.history.push({ year, power: civ.power });
                if (civ.history.length > 100) civ.history.shift();
            });

            updateCivStatus();
        }

        function updateCivStatus() {
            const statusDiv = document.getElementById('civStatus');
            statusDiv.innerHTML = '';

            // Sort by power, show top civilizations
            const activeCivs = civilizations
                .filter(c => c.phase !== 'dormant')
                .sort((a, b) => b.power - a.power)
                .slice(0, 6);

            activeCivs.forEach(civ => {
                const card = document.createElement('div');
                card.className = `civ-card ${civ.phase}`;
                card.innerHTML = `
                    <div class="civ-name" style="color: ${civ.color}">${civ.name}</div>
                    <div class="civ-phase">${civ.phase.charAt(0).toUpperCase() + civ.phase.slice(1)} Phase</div>
                    <div class="civ-meters">
                        <div class="meter">
                            <div class="meter-label">Military</div>
                            <div class="meter-bar">
                                <div class="meter-fill fill-military" style="width: ${civ.military}%"></div>
                            </div>
                        </div>
                        <div class="meter">
                            <div class="meter-label">Economy</div>
                            <div class="meter-bar">
                                <div class="meter-fill fill-economy" style="width: ${civ.economy}%"></div>
                            </div>
                        </div>
                        <div class="meter">
                            <div class="meter-label">Culture</div>
                            <div class="meter-bar">
                                <div class="meter-fill fill-culture" style="width: ${civ.culture}%"></div>
                            </div>
                        </div>
                    </div>
                `;
                statusDiv.appendChild(card);
            });
        }

        function draw() {
            // Background
            ctx.fillStyle = '#0a1628';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw timeline at bottom
            const timelineY = canvas.height - 40;
            ctx.strokeStyle = 'rgba(212, 165, 116, 0.3)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(50, timelineY);
            ctx.lineTo(canvas.width - 20, timelineY);
            ctx.stroke();

            // Timeline markers
            const markers = [-3000, -2000, -1000, 0, 1000, 2000];
            markers.forEach(m => {
                const x = 50 + ((m + 3000) / 5050) * (canvas.width - 70);
                ctx.fillStyle = '#666';
                ctx.font = '10px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(m === 0 ? '1 CE' : m < 0 ? `${Math.abs(m)}` : m.toString(), x, timelineY + 15);

                ctx.strokeStyle = 'rgba(212, 165, 116, 0.2)';
                ctx.beginPath();
                ctx.moveTo(x, timelineY - 5);
                ctx.lineTo(x, timelineY + 5);
                ctx.stroke();
            });

            // Current year marker
            const currentX = 50 + ((year + 3000) / 5050) * (canvas.width - 70);
            ctx.strokeStyle = '#d4a574';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(currentX, 20);
            ctx.lineTo(currentX, timelineY);
            ctx.stroke();

            // Draw civilization timelines
            const chartHeight = canvas.height - 100;
            const civHeight = chartHeight / civilizations.length;

            civilizations.forEach((civ, index) => {
                const y = 30 + index * civHeight;

                // Civ name
                ctx.fillStyle = civ.phase === 'dormant' || civ.phase === 'collapsed' ? '#444' : civ.color;
                ctx.font = '11px sans-serif';
                ctx.textAlign = 'right';
                ctx.fillText(civ.name, 45, y + civHeight / 2 + 4);

                // Draw civilization span
                const startX = 50 + ((civ.startYear + 3000) / 5050) * (canvas.width - 70);
                const endX = 50 + ((Math.min(civ.endYear, 2050) + 3000) / 5050) * (canvas.width - 70);
                const peakX = 50 + ((civ.peakYear + 3000) / 5050) * (canvas.width - 70);

                // Background span
                ctx.fillStyle = `${civ.color}22`;
                ctx.fillRect(startX, y + 5, endX - startX, civHeight - 10);

                // Power history line
                if (civ.history.length > 1) {
                    ctx.strokeStyle = civ.color;
                    ctx.lineWidth = 2;
                    ctx.beginPath();

                    civ.history.forEach((h, i) => {
                        const hx = 50 + ((h.year + 3000) / 5050) * (canvas.width - 70);
                        const hy = y + civHeight - 5 - (h.power / 100) * (civHeight - 10);
                        if (i === 0) ctx.moveTo(hx, hy);
                        else ctx.lineTo(hx, hy);
                    });
                    ctx.stroke();
                }

                // Peak marker
                ctx.fillStyle = '#ffd43b';
                ctx.beginPath();
                ctx.arc(peakX, y + civHeight / 2, 3, 0, Math.PI * 2);
                ctx.fill();

                // Current power indicator
                if (civ.phase !== 'dormant' && civ.phase !== 'collapsed') {
                    const powerHeight = (civ.power / 100) * (civHeight - 10);
                    ctx.fillStyle = civ.color + '88';
                    ctx.fillRect(currentX - 3, y + civHeight - 5 - powerHeight, 6, powerHeight);
                }
            });

            // Chart title
            ctx.fillStyle = '#d4a574';
            ctx.font = 'bold 14px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('Civilization Power Over Time', 50, 20);

            // Phase colors legend in corner
            ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
            ctx.fillRect(canvas.width - 140, 10, 130, 70);

            ctx.font = '10px sans-serif';
            const phases = [
                { color: '#51cf66', label: 'Rising' },
                { color: '#ffd43b', label: 'Peak' },
                { color: '#ff6b6b', label: 'Declining' }
            ];

            phases.forEach((p, i) => {
                ctx.fillStyle = p.color;
                ctx.fillRect(canvas.width - 130, 20 + i * 18, 10, 10);
                ctx.fillStyle = '#e0e0e0';
                ctx.textAlign = 'left';
                ctx.fillText(p.label, canvas.width - 115, 28 + i * 18);
            });
        }

        function animate() {
            simulate();
            draw();
            setTimeout(() => requestAnimationFrame(animate), 150);
        }

        // Controls
        document.getElementById('externalPressure').addEventListener('input', (e) => {
            externalPressure = parseFloat(e.target.value);
            document.getElementById('pressureValue').textContent = externalPressure.toFixed(1);
        });

        document.getElementById('stability').addEventListener('input', (e) => {
            stability = parseFloat(e.target.value);
            document.getElementById('stabilityValue').textContent = stability.toFixed(1);
        });

        document.getElementById('resilience').addEventListener('input', (e) => {
            resilience = parseFloat(e.target.value);
            document.getElementById('resilienceValue').textContent = resilience.toFixed(1);
        });

        document.getElementById('playPause').addEventListener('click', () => {
            running = !running;
            document.getElementById('playPause').textContent = running ? 'Pause' : 'Play';
        });

        document.getElementById('reset').addEventListener('click', initSimulation);

        // Initialize
        initSimulation();
        animate();
    </script>
</body>
</html>
