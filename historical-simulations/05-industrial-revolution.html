<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Industrial Revolution | Historical Simulations</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #d4a574;
            text-decoration: none;
            font-weight: 500;
            margin-bottom: 15px;
            padding: 8px 16px;
            background: rgba(212, 165, 116, 0.1);
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        .back-link:hover {
            background: rgba(212, 165, 116, 0.2);
            transform: translateX(-5px);
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #d4a574, #bc8c5c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .description {
            color: #a0a0a0;
            max-width: 700px;
            margin: 0 auto;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }

        .canvas-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 15px;
            border: 1px solid rgba(212, 165, 116, 0.2);
        }

        canvas {
            display: block;
            width: 100%;
            border-radius: 10px;
        }

        .controls {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(212, 165, 116, 0.2);
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            color: #d4a574;
            font-weight: 500;
        }

        .control-group input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }

        .control-value {
            text-align: right;
            font-size: 0.85rem;
            color: #888;
        }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #d4a574, #bc8c5c);
            color: #1a1a2e;
            font-weight: 600;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(212, 165, 116, 0.3);
        }

        .year-display {
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: #d4a574;
            margin: 15px 0;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .stats-panel {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #888;
            font-size: 0.9rem;
        }

        .stat-value {
            font-weight: 600;
            color: #d4a574;
        }

        .progress-bar {
            height: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            margin-top: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .tech-coal { background: linear-gradient(90deg, #4a4a4a, #6a6a6a); }
        .tech-steam { background: linear-gradient(90deg, #7a9bae, #9abbe6); }
        .tech-textile { background: linear-gradient(90deg, #8b5a3c, #b87a5c); }
        .tech-rail { background: linear-gradient(90deg, #5c4033, #8b6914); }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-link">
                <span>‚Üê</span>
                <span>Back to Historical Simulations</span>
            </a>
            <h1>Industrial Revolution</h1>
            <p class="description">Model the transformation from agrarian to industrial society. Watch urbanization, factory growth, and technological adoption spread across 18th-19th century Britain.</p>
        </header>

        <div class="main-content">
            <div class="canvas-container">
                <canvas id="canvas"></canvas>
            </div>

            <div class="controls">
                <div class="year-display">
                    Year: <span id="yearDisplay">1750</span>
                </div>

                <div class="control-group">
                    <label>Innovation Rate</label>
                    <input type="range" id="innovationRate" min="0.5" max="2" step="0.1" value="1">
                    <div class="control-value"><span id="innovationValue">1.0</span>x</div>
                </div>

                <div class="control-group">
                    <label>Capital Investment</label>
                    <input type="range" id="capitalRate" min="0.5" max="2" step="0.1" value="1">
                    <div class="control-value"><span id="capitalValue">1.0</span>x</div>
                </div>

                <div class="control-group">
                    <label>Labor Migration Speed</label>
                    <input type="range" id="migrationSpeed" min="0.5" max="2" step="0.1" value="1">
                    <div class="control-value"><span id="migrationValue">1.0</span>x</div>
                </div>

                <button class="btn btn-primary" id="playPause">Pause</button>
                <button class="btn btn-secondary" id="reset">Reset to 1750</button>

                <div class="stats-panel">
                    <div class="stat-row">
                        <span class="stat-label">Urban Population</span>
                        <span class="stat-value" id="urbanPop">15%</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Factory Workers</span>
                        <span class="stat-value" id="factoryWorkers">5%</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Total Factories</span>
                        <span class="stat-value" id="totalFactories">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Rail Miles</span>
                        <span class="stat-value" id="railMiles">0</span>
                    </div>
                </div>

                <div class="stats-panel">
                    <div class="stat-row">
                        <span class="stat-label">Coal Mining</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill tech-coal" id="coalProgress" style="width: 10%"></div>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Steam Power</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill tech-steam" id="steamProgress" style="width: 5%"></div>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Textile Industry</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill tech-textile" id="textileProgress" style="width: 8%"></div>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Railways</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill tech-rail" id="railProgress" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth - 30;
            canvas.height = Math.min(600, window.innerHeight - 250);
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // City definitions (approximating British industrial centers)
        const cityTemplates = [
            { name: 'London', x: 0.75, y: 0.65, pop: 750000, type: 'capital' },
            { name: 'Manchester', x: 0.45, y: 0.35, pop: 75000, type: 'textile' },
            { name: 'Birmingham', x: 0.55, y: 0.50, pop: 50000, type: 'iron' },
            { name: 'Liverpool', x: 0.38, y: 0.38, pop: 35000, type: 'port' },
            { name: 'Leeds', x: 0.52, y: 0.30, pop: 30000, type: 'textile' },
            { name: 'Sheffield', x: 0.52, y: 0.38, pop: 25000, type: 'steel' },
            { name: 'Bristol', x: 0.40, y: 0.65, pop: 50000, type: 'port' },
            { name: 'Newcastle', x: 0.52, y: 0.15, pop: 30000, type: 'coal' },
            { name: 'Glasgow', x: 0.32, y: 0.08, pop: 40000, type: 'shipyard' },
            { name: 'Edinburgh', x: 0.42, y: 0.05, pop: 50000, type: 'capital' },
            { name: 'Cardiff', x: 0.35, y: 0.70, pop: 15000, type: 'coal' },
            { name: 'Nottingham', x: 0.55, y: 0.42, pop: 20000, type: 'textile' }
        ];

        // Simulation state
        let year = 1750;
        let running = true;
        let cities = [];
        let factories = [];
        let railroads = [];
        let smoke = [];

        // Technology levels
        let tech = {
            coal: 10,
            steam: 5,
            textile: 8,
            rail: 0
        };

        // Parameters
        let innovationRate = 1;
        let capitalRate = 1;
        let migrationSpeed = 1;

        function initSimulation() {
            year = 1750;
            tech = { coal: 10, steam: 5, textile: 8, rail: 0 };
            factories = [];
            railroads = [];
            smoke = [];

            cities = cityTemplates.map(template => ({
                ...template,
                x: template.x * canvas.width,
                y: template.y * canvas.height,
                population: template.pop,
                ruralPop: template.pop * 3,
                factories: [],
                industrialization: 0
            }));
        }

        function simulate() {
            if (!running) return;

            year++;
            document.getElementById('yearDisplay').textContent = year;

            // Technology advancement
            const baseAdvance = 0.1 * innovationRate;
            tech.coal = Math.min(100, tech.coal + baseAdvance * (1 + Math.random()));
            tech.steam = Math.min(100, tech.steam + baseAdvance * 0.8 * (tech.coal / 50));
            tech.textile = Math.min(100, tech.textile + baseAdvance * 0.9 * (tech.steam / 30 + 0.5));

            if (year >= 1825) {
                tech.rail = Math.min(100, tech.rail + baseAdvance * 1.5 * (tech.steam / 50));
            }

            // City growth and industrialization
            cities.forEach(city => {
                // Factory construction
                const factoryChance = (tech.coal + tech.steam) / 200 * capitalRate * 0.1;
                if (Math.random() < factoryChance && city.factories.length < 20) {
                    const factoryType = getFactoryType(city);
                    const factory = {
                        x: city.x + (Math.random() - 0.5) * 40,
                        y: city.y + (Math.random() - 0.5) * 40,
                        type: factoryType,
                        workers: 50 + Math.floor(Math.random() * 150),
                        output: 1
                    };
                    city.factories.push(factory);
                    factories.push(factory);
                }

                // Population migration
                const migrationPull = city.factories.length * 100 * migrationSpeed;
                const migrants = Math.min(city.ruralPop * 0.01, migrationPull * 0.1);
                city.population += migrants;
                city.ruralPop -= migrants;

                // Natural growth
                city.population *= 1.001;
                city.ruralPop *= 1.002;

                // Industrialization index
                city.industrialization = Math.min(100,
                    (city.factories.length * 5) +
                    (tech.steam * 0.3) +
                    (tech.coal * 0.2)
                );
            });

            // Railroad construction
            if (year >= 1825 && tech.rail > 10) {
                const railChance = tech.rail / 500 * capitalRate;
                if (Math.random() < railChance && railroads.length < 20) {
                    // Connect two cities
                    const city1 = cities[Math.floor(Math.random() * cities.length)];
                    const city2 = cities[Math.floor(Math.random() * cities.length)];
                    if (city1 !== city2 && !hasRailroad(city1, city2)) {
                        railroads.push({ from: city1, to: city2 });
                    }
                }
            }

            // Generate smoke particles
            factories.forEach(factory => {
                if (Math.random() < 0.3) {
                    smoke.push({
                        x: factory.x,
                        y: factory.y,
                        size: 3 + Math.random() * 5,
                        life: 1,
                        vx: (Math.random() - 0.5) * 0.5,
                        vy: -0.5 - Math.random() * 0.5
                    });
                }
            });

            // Update smoke
            smoke = smoke.filter(s => {
                s.x += s.vx;
                s.y += s.vy;
                s.life -= 0.02;
                s.size *= 1.01;
                return s.life > 0;
            });

            updateStats();
        }

        function getFactoryType(city) {
            const types = {
                textile: ['cotton', 'wool', 'silk'],
                iron: ['ironworks', 'foundry'],
                steel: ['steelworks', 'forge'],
                coal: ['mine', 'colliery'],
                port: ['warehouse', 'shipyard'],
                capital: ['factory', 'workshop'],
                shipyard: ['shipyard', 'dockyard']
            };
            const cityTypes = types[city.type] || types.capital;
            return cityTypes[Math.floor(Math.random() * cityTypes.length)];
        }

        function hasRailroad(city1, city2) {
            return railroads.some(r =>
                (r.from === city1 && r.to === city2) ||
                (r.from === city2 && r.to === city1)
            );
        }

        function updateStats() {
            const totalPop = cities.reduce((sum, c) => sum + c.population + c.ruralPop, 0);
            const urbanPop = cities.reduce((sum, c) => sum + c.population, 0);
            const factoryWorkers = factories.reduce((sum, f) => sum + f.workers, 0);

            document.getElementById('urbanPop').textContent =
                Math.round(urbanPop / totalPop * 100) + '%';
            document.getElementById('factoryWorkers').textContent =
                Math.round(factoryWorkers / urbanPop * 100) + '%';
            document.getElementById('totalFactories').textContent = factories.length;
            document.getElementById('railMiles').textContent =
                Math.round(railroads.length * 30);

            document.getElementById('coalProgress').style.width = tech.coal + '%';
            document.getElementById('steamProgress').style.width = tech.steam + '%';
            document.getElementById('textileProgress').style.width = tech.textile + '%';
            document.getElementById('railProgress').style.width = tech.rail + '%';
        }

        function draw() {
            // Background - British Isles simplified
            ctx.fillStyle = '#1a3a2a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw landmass shape (simplified)
            ctx.fillStyle = '#2a4a3a';
            ctx.beginPath();
            ctx.moveTo(canvas.width * 0.25, canvas.height * 0.0);
            ctx.lineTo(canvas.width * 0.55, canvas.height * 0.0);
            ctx.lineTo(canvas.width * 0.6, canvas.height * 0.15);
            ctx.lineTo(canvas.width * 0.55, canvas.height * 0.25);
            ctx.lineTo(canvas.width * 0.65, canvas.height * 0.35);
            ctx.lineTo(canvas.width * 0.7, canvas.height * 0.45);
            ctx.lineTo(canvas.width * 0.85, canvas.height * 0.6);
            ctx.lineTo(canvas.width * 0.8, canvas.height * 0.75);
            ctx.lineTo(canvas.width * 0.6, canvas.height * 0.85);
            ctx.lineTo(canvas.width * 0.35, canvas.height * 0.75);
            ctx.lineTo(canvas.width * 0.25, canvas.height * 0.65);
            ctx.lineTo(canvas.width * 0.35, canvas.height * 0.5);
            ctx.lineTo(canvas.width * 0.3, canvas.height * 0.35);
            ctx.lineTo(canvas.width * 0.35, canvas.height * 0.2);
            ctx.lineTo(canvas.width * 0.25, canvas.height * 0.0);
            ctx.fill();

            // Draw railroads
            ctx.strokeStyle = '#5c4033';
            ctx.lineWidth = 3;
            railroads.forEach(rail => {
                ctx.beginPath();
                ctx.moveTo(rail.from.x, rail.from.y);
                ctx.lineTo(rail.to.x, rail.to.y);
                ctx.stroke();

                // Rail ties
                const dx = rail.to.x - rail.from.x;
                const dy = rail.to.y - rail.from.y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                const ties = Math.floor(dist / 15);

                ctx.strokeStyle = '#3a2a1a';
                ctx.lineWidth = 1;
                for (let i = 0; i < ties; i++) {
                    const t = i / ties;
                    const x = rail.from.x + dx * t;
                    const y = rail.from.y + dy * t;
                    const perpX = -dy / dist * 5;
                    const perpY = dx / dist * 5;
                    ctx.beginPath();
                    ctx.moveTo(x + perpX, y + perpY);
                    ctx.lineTo(x - perpX, y - perpY);
                    ctx.stroke();
                }
            });

            // Draw smoke first (behind buildings)
            smoke.forEach(s => {
                ctx.fillStyle = `rgba(80, 80, 80, ${s.life * 0.5})`;
                ctx.beginPath();
                ctx.arc(s.x, s.y, s.size, 0, Math.PI * 2);
                ctx.fill();
            });

            // Draw factories
            factories.forEach(factory => {
                // Factory building
                ctx.fillStyle = '#4a3a2a';
                ctx.fillRect(factory.x - 8, factory.y - 12, 16, 16);

                // Chimney
                ctx.fillStyle = '#3a2a1a';
                ctx.fillRect(factory.x - 2, factory.y - 20, 4, 12);
            });

            // Draw cities
            cities.forEach(city => {
                // City glow based on industrialization
                const glowSize = 20 + city.industrialization * 0.3;
                const gradient = ctx.createRadialGradient(
                    city.x, city.y, 0,
                    city.x, city.y, glowSize
                );
                gradient.addColorStop(0, `rgba(255, 200, 100, ${city.industrialization / 200})`);
                gradient.addColorStop(1, 'rgba(255, 200, 100, 0)');
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(city.x, city.y, glowSize, 0, Math.PI * 2);
                ctx.fill();

                // City circle
                const size = Math.sqrt(city.population / 10000) * 3 + 5;
                ctx.fillStyle = city.type === 'capital' ? '#d4a574' : '#a08060';
                ctx.beginPath();
                ctx.arc(city.x, city.y, size, 0, Math.PI * 2);
                ctx.fill();

                // City label
                ctx.fillStyle = '#e0e0e0';
                ctx.font = '11px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(city.name, city.x, city.y + size + 12);

                // Population
                ctx.fillStyle = '#a0a0a0';
                ctx.font = '9px sans-serif';
                const popText = city.population >= 100000
                    ? Math.round(city.population / 1000) + 'k'
                    : Math.round(city.population / 100) / 10 + 'k';
                ctx.fillText(popText, city.x, city.y + size + 22);
            });

            // Year indicator with era
            ctx.fillStyle = '#d4a574';
            ctx.font = 'bold 14px sans-serif';
            ctx.textAlign = 'left';
            let era = 'Early Industrial';
            if (year >= 1800) era = 'Factory Age';
            if (year >= 1830) era = 'Railway Age';
            if (year >= 1850) era = 'High Industrial';
            ctx.fillText(era, 20, 30);
        }

        function animate() {
            simulate();
            draw();
            setTimeout(() => requestAnimationFrame(animate), 100);
        }

        // Controls
        document.getElementById('innovationRate').addEventListener('input', (e) => {
            innovationRate = parseFloat(e.target.value);
            document.getElementById('innovationValue').textContent = innovationRate.toFixed(1);
        });

        document.getElementById('capitalRate').addEventListener('input', (e) => {
            capitalRate = parseFloat(e.target.value);
            document.getElementById('capitalValue').textContent = capitalRate.toFixed(1);
        });

        document.getElementById('migrationSpeed').addEventListener('input', (e) => {
            migrationSpeed = parseFloat(e.target.value);
            document.getElementById('migrationValue').textContent = migrationSpeed.toFixed(1);
        });

        document.getElementById('playPause').addEventListener('click', () => {
            running = !running;
            document.getElementById('playPause').textContent = running ? 'Pause' : 'Play';
        });

        document.getElementById('reset').addEventListener('click', () => {
            initSimulation();
        });

        // Initialize
        initSimulation();
        animate();
    </script>
</body>
</html>
