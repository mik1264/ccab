<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agricultural Spread | Historical Simulations</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #d4a574;
            text-decoration: none;
            font-weight: 500;
            margin-bottom: 15px;
            padding: 8px 16px;
            background: rgba(212, 165, 116, 0.1);
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        .back-link:hover {
            background: rgba(212, 165, 116, 0.2);
            transform: translateX(-5px);
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #d4a574, #bc8c5c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .description {
            color: #a0a0a0;
            max-width: 700px;
            margin: 0 auto;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }

        .canvas-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 15px;
            border: 1px solid rgba(212, 165, 116, 0.2);
        }

        canvas {
            display: block;
            width: 100%;
            border-radius: 10px;
        }

        .controls {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(212, 165, 116, 0.2);
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            color: #d4a574;
            font-weight: 500;
        }

        .control-group input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }

        .control-value {
            text-align: right;
            font-size: 0.85rem;
            color: #888;
        }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #d4a574, #bc8c5c);
            color: #1a1a2e;
            font-weight: 600;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(212, 165, 116, 0.3);
        }

        .btn-secondary {
            background: rgba(212, 165, 116, 0.2);
            color: #d4a574;
            border: 1px solid rgba(212, 165, 116, 0.3);
        }

        .year-display {
            text-align: center;
            font-size: 1.3rem;
            font-weight: 700;
            color: #d4a574;
            margin: 15px 0;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .stats-panel {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #888;
            font-size: 0.9rem;
        }

        .stat-value {
            font-weight: 600;
            color: #d4a574;
        }

        .legend {
            margin-top: 15px;
        }

        .legend-title {
            font-weight: 600;
            color: #d4a574;
            margin-bottom: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 0;
            font-size: 0.85rem;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        .crop-list {
            margin-top: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .crop-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            font-size: 0.85rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-link">
                <span>‚Üê</span>
                <span>Back to Historical Simulations</span>
            </a>
            <h1>Agricultural Spread</h1>
            <p class="description">The Neolithic Revolution: watch the spread of farming from the Fertile Crescent across continents over millennia, transforming hunter-gatherer societies.</p>
        </header>

        <div class="main-content">
            <div class="canvas-container">
                <canvas id="canvas"></canvas>
            </div>

            <div class="controls">
                <div class="year-display">
                    <span id="yearDisplay">10,000 BCE</span>
                </div>

                <div class="control-group">
                    <label>Spread Rate</label>
                    <input type="range" id="spreadRate" min="0.5" max="2" step="0.1" value="1">
                    <div class="control-value"><span id="spreadValue">1.0</span>x (‚âà1 km/year)</div>
                </div>

                <div class="control-group">
                    <label>Climate Favorability</label>
                    <input type="range" id="climateFactor" min="0.5" max="1.5" step="0.1" value="1">
                    <div class="control-value"><span id="climateValue">1.0</span>x</div>
                </div>

                <div class="control-group">
                    <label>Population Pressure</label>
                    <input type="range" id="popPressure" min="0.5" max="2" step="0.1" value="1">
                    <div class="control-value"><span id="popValue">1.0</span>x</div>
                </div>

                <div class="control-group">
                    <label>Simulation Speed</label>
                    <input type="range" id="simSpeed" min="10" max="100" step="10" value="50">
                    <div class="control-value"><span id="speedValue">50</span> years/tick</div>
                </div>

                <button class="btn btn-primary" id="playPause">Pause</button>
                <button class="btn btn-secondary" id="reset">Reset to 10,000 BCE</button>

                <div class="stats-panel">
                    <div class="stat-row">
                        <span class="stat-label">Agricultural Zones</span>
                        <span class="stat-value" id="agriZones">0%</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Est. Farmers</span>
                        <span class="stat-value" id="farmers">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Domesticated Crops</span>
                        <span class="stat-value" id="cropCount">1</span>
                    </div>
                </div>

                <div class="legend">
                    <div class="legend-title">Land Use</div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #2d4a1c;"></div>
                        <span>Hunter-Gatherer</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #8B7355;"></div>
                        <span>Early Agriculture</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #DAA520;"></div>
                        <span>Established Farming</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #FFD700;"></div>
                        <span>Agricultural Heartland</span>
                    </div>
                </div>

                <div class="crop-list">
                    <div class="legend-title">Crops & Animals</div>
                    <div id="cropsList"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth - 30;
            canvas.height = Math.min(550, window.innerHeight - 250);
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Grid for agriculture spread
        const gridSize = 8;
        let grid = [];
        let cols, rows;

        // State
        let year = -10000;
        let running = true;

        // Parameters
        let spreadRate = 1;
        let climateFactor = 1;
        let popPressure = 1;
        let simSpeed = 50;

        // Origin centers with domesticated species
        const origins = [
            {
                name: 'Fertile Crescent',
                x: 0.58, y: 0.42,
                startYear: -10000,
                crops: ['Wheat', 'Barley', 'Lentils'],
                animals: ['Sheep', 'Goats', 'Cattle']
            },
            {
                name: 'Yellow River',
                x: 0.78, y: 0.38,
                startYear: -8000,
                crops: ['Millet', 'Rice', 'Soybeans'],
                animals: ['Pigs', 'Chickens']
            },
            {
                name: 'Yangtze River',
                x: 0.80, y: 0.45,
                startYear: -7500,
                crops: ['Rice', 'Tea'],
                animals: ['Water Buffalo']
            },
            {
                name: 'New Guinea',
                x: 0.88, y: 0.58,
                startYear: -7000,
                crops: ['Taro', 'Bananas', 'Sugarcane'],
                animals: []
            },
            {
                name: 'Mesoamerica',
                x: 0.18, y: 0.48,
                startYear: -5000,
                crops: ['Maize', 'Squash', 'Beans'],
                animals: ['Turkeys']
            },
            {
                name: 'Andes',
                x: 0.25, y: 0.65,
                startYear: -5000,
                crops: ['Potatoes', 'Quinoa'],
                animals: ['Llamas', 'Alpacas']
            },
            {
                name: 'Sahel',
                x: 0.48, y: 0.52,
                startYear: -4000,
                crops: ['Sorghum', 'Pearl Millet'],
                animals: ['Donkeys']
            }
        ];

        // Climate zones (affects spread rate)
        function getClimateModifier(x, y) {
            // Higher latitudes = harder to farm (initially)
            const latEffect = 1 - Math.abs(y - 0.45) * 0.8;
            // Deserts
            if (x > 0.45 && x < 0.55 && y > 0.45 && y < 0.60) return 0.2; // Sahara
            if (x > 0.60 && x < 0.70 && y > 0.40 && y < 0.50) return 0.3; // Arabian
            // Mountains reduce spread
            if (x > 0.55 && x < 0.62 && y > 0.35 && y < 0.42) return 0.5; // Zagros/Caucasus
            return Math.max(0.3, latEffect * climateFactor);
        }

        // Check if position is land
        function isLand(x, y) {
            // Simplified continent shapes
            // North America
            if (x > 0.05 && x < 0.28 && y > 0.15 && y < 0.55) return true;
            // South America
            if (x > 0.18 && x < 0.35 && y > 0.52 && y < 0.90) return true;
            // Europe
            if (x > 0.40 && x < 0.60 && y > 0.15 && y < 0.42) return true;
            // Africa
            if (x > 0.42 && x < 0.60 && y > 0.42 && y < 0.80) return true;
            // Asia
            if (x > 0.55 && x < 0.95 && y > 0.15 && y < 0.55) return true;
            // Southeast Asia/Indonesia
            if (x > 0.75 && x < 0.92 && y > 0.48 && y < 0.62) return true;
            // Australia
            if (x > 0.80 && x < 0.95 && y > 0.65 && y < 0.82) return true;
            return false;
        }

        function initGrid() {
            cols = Math.floor(canvas.width / gridSize);
            rows = Math.floor(canvas.height / gridSize);
            grid = [];

            for (let y = 0; y < rows; y++) {
                grid[y] = [];
                for (let x = 0; x < cols; x++) {
                    const normX = x / cols;
                    const normY = y / rows;
                    grid[y][x] = {
                        agriculture: 0,
                        land: isLand(normX, normY),
                        climate: getClimateModifier(normX, normY),
                        crops: new Set(),
                        animals: new Set()
                    };
                }
            }

            year = -10000;
        }

        function simulate() {
            if (!running) return;

            year += simSpeed;
            const yearStr = year < 0 ? `${Math.abs(year).toLocaleString()} BCE` : `${year.toLocaleString()} CE`;
            document.getElementById('yearDisplay').textContent = yearStr;

            // Process each origin point
            origins.forEach(origin => {
                if (year < origin.startYear) return;

                const originCol = Math.floor(origin.x * cols);
                const originRow = Math.floor(origin.y * rows);

                // Initialize origin if needed
                if (grid[originRow] && grid[originCol]) {
                    const cell = grid[originRow][originCol];
                    if (cell.agriculture === 0) {
                        cell.agriculture = 100;
                        origin.crops.forEach(c => cell.crops.add(c));
                        origin.animals.forEach(a => cell.animals.add(a));
                    }
                }
            });

            // Spread agriculture
            const newGrid = JSON.parse(JSON.stringify(grid));
            // Copy Sets properly
            for (let y = 0; y < rows; y++) {
                for (let x = 0; x < cols; x++) {
                    newGrid[y][x].crops = new Set(grid[y][x].crops);
                    newGrid[y][x].animals = new Set(grid[y][x].animals);
                }
            }

            for (let y = 0; y < rows; y++) {
                for (let x = 0; x < cols; x++) {
                    const cell = grid[y][x];
                    if (!cell.land || cell.agriculture >= 100) continue;

                    // Check neighbors for agriculture
                    let maxNeighborAgri = 0;
                    let neighborCrops = new Set();
                    let neighborAnimals = new Set();

                    for (let dy = -1; dy <= 1; dy++) {
                        for (let dx = -1; dx <= 1; dx++) {
                            if (dx === 0 && dy === 0) continue;
                            const ny = y + dy;
                            const nx = x + dx;
                            if (ny >= 0 && ny < rows && nx >= 0 && nx < cols) {
                                const neighbor = grid[ny][nx];
                                if (neighbor.agriculture > maxNeighborAgri) {
                                    maxNeighborAgri = neighbor.agriculture;
                                }
                                neighbor.crops.forEach(c => neighborCrops.add(c));
                                neighbor.animals.forEach(a => neighborAnimals.add(a));
                            }
                        }
                    }

                    if (maxNeighborAgri > 20) {
                        const spreadChance = spreadRate * cell.climate * popPressure * 0.1;
                        const spread = Math.min(10, maxNeighborAgri * spreadChance * 0.1);

                        newGrid[y][x].agriculture = Math.min(100, cell.agriculture + spread);

                        if (newGrid[y][x].agriculture > 30) {
                            neighborCrops.forEach(c => newGrid[y][x].crops.add(c));
                            neighborAnimals.forEach(a => newGrid[y][x].animals.add(a));
                        }
                    }
                }
            }

            grid = newGrid;
            updateStats();
        }

        function updateStats() {
            let totalAgri = 0;
            let landCells = 0;
            let allCrops = new Set();
            let allAnimals = new Set();

            for (let y = 0; y < rows; y++) {
                for (let x = 0; x < cols; x++) {
                    const cell = grid[y][x];
                    if (cell.land) {
                        landCells++;
                        if (cell.agriculture > 20) {
                            totalAgri++;
                        }
                        cell.crops.forEach(c => allCrops.add(c));
                        cell.animals.forEach(a => allAnimals.add(a));
                    }
                }
            }

            const agriPercent = Math.round((totalAgri / landCells) * 100);
            document.getElementById('agriZones').textContent = agriPercent + '%';

            // Rough population estimate
            const farmers = Math.round(totalAgri * 5000);
            document.getElementById('farmers').textContent = farmers.toLocaleString();

            document.getElementById('cropCount').textContent = allCrops.size + allAnimals.size;

            // Update crop list
            const cropsList = document.getElementById('cropsList');
            cropsList.innerHTML = '';
            [...allCrops].slice(0, 6).forEach(crop => {
                const div = document.createElement('div');
                div.className = 'crop-item';
                div.innerHTML = `<span>üåæ ${crop}</span>`;
                cropsList.appendChild(div);
            });
            [...allAnimals].slice(0, 4).forEach(animal => {
                const div = document.createElement('div');
                div.className = 'crop-item';
                div.innerHTML = `<span>üêë ${animal}</span>`;
                cropsList.appendChild(div);
            });
        }

        function draw() {
            // Ocean
            ctx.fillStyle = '#0a1830';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw grid cells
            for (let y = 0; y < rows; y++) {
                for (let x = 0; x < cols; x++) {
                    const cell = grid[y][x];
                    if (!cell.land) continue;

                    let color;
                    if (cell.agriculture < 10) {
                        color = '#2d4a1c'; // Hunter-gatherer (forest)
                    } else if (cell.agriculture < 40) {
                        color = '#8B7355'; // Early agriculture
                    } else if (cell.agriculture < 70) {
                        color = '#DAA520'; // Established farming
                    } else {
                        color = '#FFD700'; // Agricultural heartland
                    }

                    ctx.fillStyle = color;
                    ctx.fillRect(x * gridSize, y * gridSize, gridSize - 1, gridSize - 1);
                }
            }

            // Draw origin labels
            origins.forEach(origin => {
                if (year >= origin.startYear) {
                    const x = origin.x * canvas.width;
                    const y = origin.y * canvas.height;

                    // Marker
                    ctx.fillStyle = '#ffffff';
                    ctx.beginPath();
                    ctx.arc(x, y, 4, 0, Math.PI * 2);
                    ctx.fill();

                    // Label
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                    ctx.font = '9px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText(origin.name, x, y - 8);
                }
            });

            // Era label
            ctx.fillStyle = '#d4a574';
            ctx.font = 'bold 12px sans-serif';
            ctx.textAlign = 'left';
            let era = 'Pre-Pottery Neolithic';
            if (year > -7000) era = 'Pottery Neolithic';
            if (year > -5000) era = 'Chalcolithic';
            if (year > -3000) era = 'Bronze Age';
            if (year > -1200) era = 'Iron Age';
            if (year > 500) era = 'Medieval Period';
            ctx.fillText(era, 15, 25);
        }

        function animate() {
            simulate();
            draw();
            setTimeout(() => requestAnimationFrame(animate), 150);
        }

        // Controls
        document.getElementById('spreadRate').addEventListener('input', (e) => {
            spreadRate = parseFloat(e.target.value);
            document.getElementById('spreadValue').textContent = spreadRate.toFixed(1);
        });

        document.getElementById('climateFactor').addEventListener('input', (e) => {
            climateFactor = parseFloat(e.target.value);
            document.getElementById('climateValue').textContent = climateFactor.toFixed(1);
        });

        document.getElementById('popPressure').addEventListener('input', (e) => {
            popPressure = parseFloat(e.target.value);
            document.getElementById('popValue').textContent = popPressure.toFixed(1);
        });

        document.getElementById('simSpeed').addEventListener('input', (e) => {
            simSpeed = parseInt(e.target.value);
            document.getElementById('speedValue').textContent = simSpeed;
        });

        document.getElementById('playPause').addEventListener('click', () => {
            running = !running;
            document.getElementById('playPause').textContent = running ? 'Pause' : 'Play';
        });

        document.getElementById('reset').addEventListener('click', initGrid);

        // Initialize
        initGrid();
        animate();
    </script>
</body>
</html>
