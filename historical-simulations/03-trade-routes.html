<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trade Route Networks | Historical Simulations</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e2e8f0;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        .back-link {
            display: inline-block;
            color: #f59e0b;
            text-decoration: none;
            margin-bottom: 20px;
            padding: 8px 16px;
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 20px;
            transition: all 0.3s;
        }

        .back-link:hover {
            background: rgba(245, 158, 11, 0.1);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: #94a3b8;
            font-size: 1.1rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
        }

        .simulation-area {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        #canvas {
            width: 100%;
            height: 500px;
            background: #0a0a14;
            border-radius: 15px;
        }

        .controls {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            color: #f59e0b;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .control-group select {
            width: 100%;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
        }

        .control-group select option {
            background: #1a1a2e;
        }

        .control-group input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: rgba(245, 158, 11, 0.2);
            -webkit-appearance: none;
        }

        .control-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #f59e0b;
            cursor: pointer;
        }

        .control-value {
            text-align: right;
            color: #94a3b8;
            font-size: 0.85rem;
            margin-top: 5px;
        }

        .btn {
            width: 100%;
            padding: 12px;
            font-size: 0.95rem;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: #1a1a2e;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
        }

        .stats-panel {
            background: rgba(245, 158, 11, 0.1);
            border-radius: 15px;
            padding: 15px;
            margin-top: 15px;
        }

        .stats-panel h3 {
            color: #f59e0b;
            margin-bottom: 12px;
            font-size: 0.95rem;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.85rem;
        }

        .stat-label {
            color: #94a3b8;
        }

        .stat-value {
            color: #f59e0b;
            font-weight: 600;
        }

        .city-info {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .city-info h4 {
            color: #f59e0b;
            margin-bottom: 10px;
        }

        .good-list {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 8px;
        }

        .good-tag {
            padding: 4px 10px;
            background: rgba(245, 158, 11, 0.2);
            border-radius: 12px;
            font-size: 0.75rem;
            color: #f59e0b;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-link">← Back to Historical Simulations</a>
            <h1>Trade Route Networks</h1>
            <p class="subtitle">Silk Road and maritime trade with goods and city prosperity</p>
        </header>

        <div class="main-content">
            <div class="simulation-area">
                <canvas id="canvas"></canvas>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label>Trade Network</label>
                    <select id="network">
                        <option value="silk">Silk Road (Land)</option>
                        <option value="mediterranean">Mediterranean Sea</option>
                        <option value="both">Both Networks</option>
                    </select>
                </div>

                <div class="control-group">
                    <label>Trade Volume</label>
                    <input type="range" id="volume" min="1" max="10" value="5">
                    <div class="control-value"><span id="volumeValue">5</span></div>
                </div>

                <div class="control-group">
                    <label>Bandit Activity</label>
                    <input type="range" id="bandits" min="0" max="10" value="3">
                    <div class="control-value"><span id="banditsValue">3</span></div>
                </div>

                <div class="control-group">
                    <label>Speed</label>
                    <input type="range" id="speed" min="1" max="5" value="2">
                    <div class="control-value"><span id="speedValue">2</span>x</div>
                </div>

                <button class="btn btn-primary" id="startBtn">▶ Start Trade</button>
                <button class="btn btn-primary" id="resetBtn">↺ Reset</button>

                <div class="stats-panel">
                    <h3>Global Statistics</h3>
                    <div class="stat-row">
                        <span class="stat-label">Active Caravans</span>
                        <span class="stat-value" id="caravanCount">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Total Trade Value</span>
                        <span class="stat-value" id="totalValue">0 gold</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Caravans Lost</span>
                        <span class="stat-value" id="caravansLost">0</span>
                    </div>
                </div>

                <div class="city-info" id="cityInfo">
                    <h4>Select a City</h4>
                    <p style="color: #94a3b8; font-size: 0.85rem;">Click on a city to see details</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let width, height;
        let running = false;
        let caravans = [];
        let totalTradeValue = 0;
        let caravansLost = 0;
        let selectedCity = null;

        const cities = [
            // Silk Road cities
            { name: 'Chang\'an', x: 0.85, y: 0.4, network: 'silk', goods: ['Silk', 'Tea', 'Porcelain'], wealth: 1000 },
            { name: 'Dunhuang', x: 0.75, y: 0.35, network: 'silk', goods: ['Silk', 'Jade'], wealth: 500 },
            { name: 'Samarkand', x: 0.55, y: 0.35, network: 'silk', goods: ['Cotton', 'Horses', 'Paper'], wealth: 700 },
            { name: 'Baghdad', x: 0.45, y: 0.5, network: 'both', goods: ['Spices', 'Textiles', 'Books'], wealth: 800 },
            { name: 'Damascus', x: 0.4, y: 0.52, network: 'both', goods: ['Steel', 'Glass', 'Dates'], wealth: 600 },

            // Mediterranean cities
            { name: 'Constantinople', x: 0.35, y: 0.45, network: 'both', goods: ['Gold', 'Silk', 'Wine'], wealth: 900 },
            { name: 'Venice', x: 0.25, y: 0.4, network: 'mediterranean', goods: ['Glass', 'Salt', 'Spices'], wealth: 800 },
            { name: 'Alexandria', x: 0.38, y: 0.65, network: 'mediterranean', goods: ['Grain', 'Papyrus', 'Linen'], wealth: 700 },
            { name: 'Carthage', x: 0.2, y: 0.55, network: 'mediterranean', goods: ['Olive Oil', 'Wine', 'Dyes'], wealth: 500 },
            { name: 'Rome', x: 0.22, y: 0.45, network: 'mediterranean', goods: ['Wine', 'Marble', 'Weapons'], wealth: 750 }
        ];

        const routes = [
            // Silk Road
            { from: 'Chang\'an', to: 'Dunhuang', network: 'silk' },
            { from: 'Dunhuang', to: 'Samarkand', network: 'silk' },
            { from: 'Samarkand', to: 'Baghdad', network: 'silk' },
            { from: 'Baghdad', to: 'Damascus', network: 'silk' },
            { from: 'Damascus', to: 'Constantinople', network: 'silk' },

            // Mediterranean
            { from: 'Constantinople', to: 'Venice', network: 'mediterranean' },
            { from: 'Venice', to: 'Rome', network: 'mediterranean' },
            { from: 'Rome', to: 'Carthage', network: 'mediterranean' },
            { from: 'Alexandria', to: 'Constantinople', network: 'mediterranean' },
            { from: 'Alexandria', to: 'Carthage', network: 'mediterranean' },
            { from: 'Baghdad', to: 'Alexandria', network: 'mediterranean' }
        ];

        function resize() {
            width = canvas.offsetWidth * 2;
            height = canvas.offsetHeight * 2;
            canvas.width = width;
            canvas.height = height;

            cities.forEach(city => {
                city.screenX = city.x * width;
                city.screenY = city.y * height;
            });
        }

        function init() {
            caravans = [];
            totalTradeValue = 0;
            caravansLost = 0;
            cities.forEach(city => city.wealth = city.wealth || 500);
            updateStats();
        }

        function spawnCaravan() {
            const network = document.getElementById('network').value;
            const availableRoutes = routes.filter(r =>
                network === 'both' || r.network === network || r.network === 'both'
            );

            if (availableRoutes.length === 0) return;

            const route = availableRoutes[Math.floor(Math.random() * availableRoutes.length)];
            const fromCity = cities.find(c => c.name === route.from);
            const toCity = cities.find(c => c.name === route.to);

            if (!fromCity || !toCity) return;

            const goods = fromCity.goods[Math.floor(Math.random() * fromCity.goods.length)];
            const value = 50 + Math.floor(Math.random() * 150);

            caravans.push({
                x: fromCity.screenX,
                y: fromCity.screenY,
                targetX: toCity.screenX,
                targetY: toCity.screenY,
                from: fromCity,
                to: toCity,
                goods: goods,
                value: value,
                progress: 0,
                network: route.network
            });
        }

        function update() {
            const volume = parseInt(document.getElementById('volume').value);
            const bandits = parseInt(document.getElementById('bandits').value);
            const speed = parseInt(document.getElementById('speed').value);

            // Spawn new caravans
            if (Math.random() < volume * 0.02) {
                spawnCaravan();
            }

            // Update caravans
            caravans.forEach(caravan => {
                caravan.progress += 0.005 * speed;

                caravan.x = caravan.from.screenX + (caravan.targetX - caravan.from.screenX) * caravan.progress;
                caravan.y = caravan.from.screenY + (caravan.targetY - caravan.from.screenY) * caravan.progress;

                // Bandit attack
                if (Math.random() < bandits * 0.001) {
                    caravan.lost = true;
                    caravansLost++;
                }
            });

            // Complete deliveries
            caravans = caravans.filter(caravan => {
                if (caravan.lost) return false;

                if (caravan.progress >= 1) {
                    caravan.to.wealth += caravan.value;
                    totalTradeValue += caravan.value;
                    return false;
                }
                return true;
            });

            updateStats();
        }

        function updateStats() {
            document.getElementById('caravanCount').textContent = caravans.length;
            document.getElementById('totalValue').textContent = totalTradeValue.toLocaleString() + ' gold';
            document.getElementById('caravansLost').textContent = caravansLost;
        }

        function draw() {
            ctx.fillStyle = '#0a0a14';
            ctx.fillRect(0, 0, width, height);

            const network = document.getElementById('network').value;

            // Draw land/sea background
            ctx.fillStyle = 'rgba(139, 90, 43, 0.1)';
            ctx.fillRect(0, 0, width, height);

            ctx.fillStyle = 'rgba(30, 64, 175, 0.15)';
            ctx.beginPath();
            ctx.moveTo(0, height * 0.35);
            ctx.quadraticCurveTo(width * 0.3, height * 0.5, width * 0.45, height * 0.55);
            ctx.lineTo(width * 0.45, height);
            ctx.lineTo(0, height);
            ctx.fill();

            // Draw routes
            routes.forEach(route => {
                if (network !== 'both' && route.network !== network && route.network !== 'both') return;

                const from = cities.find(c => c.name === route.from);
                const to = cities.find(c => c.name === route.to);
                if (!from || !to) return;

                ctx.strokeStyle = route.network === 'silk' ? 'rgba(212, 165, 116, 0.4)' : 'rgba(59, 130, 246, 0.4)';
                ctx.lineWidth = 3;
                ctx.setLineDash(route.network === 'silk' ? [10, 5] : []);
                ctx.beginPath();
                ctx.moveTo(from.screenX, from.screenY);
                ctx.lineTo(to.screenX, to.screenY);
                ctx.stroke();
                ctx.setLineDash([]);
            });

            // Draw cities
            cities.forEach(city => {
                if (network !== 'both' && city.network !== network && city.network !== 'both') return;

                const size = Math.sqrt(city.wealth / 100) * 5 + 10;
                const isSelected = selectedCity === city;

                // Glow
                const gradient = ctx.createRadialGradient(city.screenX, city.screenY, 0, city.screenX, city.screenY, size * 2);
                gradient.addColorStop(0, isSelected ? 'rgba(245, 158, 11, 0.5)' : 'rgba(245, 158, 11, 0.2)');
                gradient.addColorStop(1, 'transparent');
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(city.screenX, city.screenY, size * 2, 0, Math.PI * 2);
                ctx.fill();

                // City
                ctx.fillStyle = isSelected ? '#f59e0b' : '#d4a574';
                ctx.beginPath();
                ctx.arc(city.screenX, city.screenY, size, 0, Math.PI * 2);
                ctx.fill();

                // Name
                ctx.fillStyle = '#e2e8f0';
                ctx.font = isSelected ? 'bold 16px sans-serif' : '14px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(city.name, city.screenX, city.screenY - size - 10);
            });

            // Draw caravans
            caravans.forEach(caravan => {
                ctx.fillStyle = caravan.network === 'silk' ? '#d4a574' : '#60a5fa';
                ctx.beginPath();
                ctx.arc(caravan.x, caravan.y, 6, 0, Math.PI * 2);
                ctx.fill();

                // Trail
                ctx.strokeStyle = caravan.network === 'silk' ? 'rgba(212, 165, 116, 0.3)' : 'rgba(96, 165, 250, 0.3)';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(caravan.from.screenX, caravan.from.screenY);
                ctx.lineTo(caravan.x, caravan.y);
                ctx.stroke();
            });
        }

        function animate() {
            if (running) {
                update();
            }
            draw();
            requestAnimationFrame(animate);
        }

        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX - rect.left) * (width / rect.width);
            const y = (e.clientY - rect.top) * (height / rect.height);

            selectedCity = null;
            cities.forEach(city => {
                const dist = Math.sqrt(Math.pow(x - city.screenX, 2) + Math.pow(y - city.screenY, 2));
                if (dist < 30) {
                    selectedCity = city;
                }
            });

            if (selectedCity) {
                document.getElementById('cityInfo').innerHTML = `
                    <h4>${selectedCity.name}</h4>
                    <div style="margin-top: 8px;">
                        <span style="color: #94a3b8;">Wealth:</span>
                        <span style="color: #f59e0b;">${selectedCity.wealth.toLocaleString()} gold</span>
                    </div>
                    <div style="margin-top: 5px; color: #94a3b8; font-size: 0.85rem;">Exports:</div>
                    <div class="good-list">
                        ${selectedCity.goods.map(g => `<span class="good-tag">${g}</span>`).join('')}
                    </div>
                `;
            } else {
                document.getElementById('cityInfo').innerHTML = `
                    <h4>Select a City</h4>
                    <p style="color: #94a3b8; font-size: 0.85rem;">Click on a city to see details</p>
                `;
            }
        });

        document.getElementById('startBtn').addEventListener('click', () => {
            running = !running;
            document.getElementById('startBtn').textContent = running ? '⏸ Pause' : '▶ Start Trade';
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            running = false;
            document.getElementById('startBtn').textContent = '▶ Start Trade';
            init();
        });

        ['volume', 'bandits', 'speed'].forEach(id => {
            document.getElementById(id).addEventListener('input', (e) => {
                document.getElementById(id + 'Value').textContent = e.target.value;
            });
        });

        window.addEventListener('resize', resize);
        resize();
        init();
        animate();
    </script>
</body>
</html>
