<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Competitive Exclusion Principle</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: sans-serif; }
canvas { display: block; }
#title {
    position: fixed; top: 50px; left: 50%; transform: translateX(-50%);
    color: #fbbf24; font-size: 22px; font-weight: bold; text-align: center;
    text-shadow: 0 0 20px rgba(251,191,36,0.3); z-index: 10; pointer-events: none;
}
#controls {
    position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
    display: flex; gap: 20px; z-index: 10; background: rgba(0,0,0,0.7);
    padding: 12px 20px; border-radius: 10px; align-items: center;
}
.ctrl { display: flex; flex-direction: column; align-items: center; }
.ctrl label { color: #ccc; font-size: 11px; margin-bottom: 4px; }
.ctrl input[type=range] { width: 100px; accent-color: #fbbf24; }
.ctrl span { color: #fbbf24; font-size: 11px; margin-top: 2px; }
button {
    background: rgba(251,191,36,0.2); color: #fbbf24; border: 1px solid #fbbf24;
    padding: 6px 14px; border-radius: 6px; cursor: pointer; font-size: 12px;
}
button:hover { background: rgba(251,191,36,0.4); }
#stats {
    position: fixed; top: 50px; right: 20px; color: #ccc; font-size: 13px;
    background: rgba(0,0,0,0.7); padding: 10px 16px; border-radius: 8px; z-index: 10;
    line-height: 1.8;
}
</style>
</head>
<body>
<a href="../index.html" style="position:fixed;top:10px;left:10px;padding:8px 16px;background:rgba(0,0,0,0.7);color:#fbbf24;text-decoration:none;border-radius:6px;font-size:14px;z-index:999;font-family:sans-serif;">← Back to Gallery</a>
<div id="title">Competitive Exclusion Principle</div>
<div id="stats">
    <span style="color:#60a5fa;">Species A: <span id="countA">0</span></span><br>
    <span style="color:#f472b6;">Species B: <span id="countB">0</span></span><br>
    <span style="color:#a3e635;">Resources: <span id="resCount">0</span></span><br>
    <span style="color:#999;">Generation: <span id="gen">0</span></span>
</div>
<div id="controls">
    <div class="ctrl">
        <label>Species A Fitness</label>
        <input type="range" id="fitnessA" min="0.5" max="1.5" step="0.05" value="1.0">
        <span id="fitAVal">1.00</span>
    </div>
    <div class="ctrl">
        <label>Species B Fitness</label>
        <input type="range" id="fitnessB" min="0.5" max="1.5" step="0.05" value="0.9">
        <span id="fitBVal">0.90</span>
    </div>
    <div class="ctrl">
        <label>Resource Rate</label>
        <input type="range" id="resRate" min="0.01" max="0.1" step="0.01" value="0.04">
        <span id="resVal">0.04</span>
    </div>
    <button id="resetBtn">Reset</button>
</div>
<canvas id="canvas"></canvas>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
resize();
window.addEventListener('resize', resize);

let fitnessA = 1.0;
let fitnessB = 0.9;
let resourceRate = 0.04;

document.getElementById('fitnessA').oninput = function() {
    fitnessA = parseFloat(this.value);
    document.getElementById('fitAVal').textContent = fitnessA.toFixed(2);
};
document.getElementById('fitnessB').oninput = function() {
    fitnessB = parseFloat(this.value);
    document.getElementById('fitBVal').textContent = fitnessB.toFixed(2);
};
document.getElementById('resRate').oninput = function() {
    resourceRate = parseFloat(this.value);
    document.getElementById('resVal').textContent = this.value;
};

class Individual {
    constructor(x, y, species) {
        this.x = x;
        this.y = y;
        this.species = species;
        this.vx = (Math.random() - 0.5) * 2;
        this.vy = (Math.random() - 0.5) * 2;
        this.energy = 50 + Math.random() * 30;
        this.alive = true;
        this.size = 3;
        this.pulse = Math.random() * Math.PI * 2;
    }

    update(w, h) {
        this.pulse += 0.04;
        this.vx += (Math.random() - 0.5) * 0.3;
        this.vy += (Math.random() - 0.5) * 0.3;
        let speed = Math.sqrt(this.vx * this.vx + this.vy * this.vy);
        let maxS = this.species === 'A' ? 1.5 : 1.3;
        if (speed > maxS) {
            this.vx = (this.vx / speed) * maxS;
            this.vy = (this.vy / speed) * maxS;
        }
        this.x += this.vx;
        this.y += this.vy;
        if (this.x < 5) { this.x = 5; this.vx *= -1; }
        if (this.x > w - 5) { this.x = w - 5; this.vx *= -1; }
        if (this.y < 80) { this.y = 80; this.vy *= -1; }
        if (this.y > h - 80) { this.y = h - 80; this.vy *= -1; }
        this.energy -= 0.15;
        if (this.energy <= 0) this.alive = false;
    }

    draw(ctx) {
        let s = this.size + Math.sin(this.pulse) * 0.5;
        ctx.beginPath();
        ctx.arc(this.x, this.y, s, 0, Math.PI * 2);
        if (this.species === 'A') {
            ctx.fillStyle = `rgba(96, 165, 250, ${0.6 + this.energy / 200})`;
            ctx.shadowColor = '#60a5fa';
        } else {
            ctx.fillStyle = `rgba(244, 114, 182, ${0.6 + this.energy / 200})`;
            ctx.shadowColor = '#f472b6';
        }
        ctx.shadowBlur = 6;
        ctx.fill();
        ctx.shadowBlur = 0;
    }
}

class Resource {
    constructor(x, y) {
        this.x = x;
        this.y = y;
        this.size = 2;
        this.pulse = Math.random() * Math.PI * 2;
        this.consumed = false;
    }

    draw(ctx) {
        this.pulse += 0.03;
        let s = this.size + Math.sin(this.pulse) * 0.5;
        ctx.beginPath();
        ctx.arc(this.x, this.y, s, 0, Math.PI * 2);
        ctx.fillStyle = 'rgba(163, 230, 53, 0.7)';
        ctx.shadowColor = '#a3e635';
        ctx.shadowBlur = 4;
        ctx.fill();
        ctx.shadowBlur = 0;
    }
}

let individuals = [];
let resources = [];
let popHistoryA = [];
let popHistoryB = [];
let generation = 0;
const MAX_HISTORY = 400;
const MAX_POP = 600;

function init() {
    individuals = [];
    resources = [];
    popHistoryA = [];
    popHistoryB = [];
    generation = 0;
    let w = canvas.width;
    let h = canvas.height;
    for (let i = 0; i < 60; i++) {
        individuals.push(new Individual(
            Math.random() * w * 0.4 + w * 0.05,
            Math.random() * (h - 200) + 100,
            'A'
        ));
    }
    for (let i = 0; i < 60; i++) {
        individuals.push(new Individual(
            Math.random() * w * 0.4 + w * 0.55,
            Math.random() * (h - 200) + 100,
            'B'
        ));
    }
    for (let i = 0; i < 150; i++) {
        resources.push(new Resource(
            Math.random() * (w - 20) + 10,
            Math.random() * (h - 200) + 100
        ));
    }
}

document.getElementById('resetBtn').onclick = init;
init();

let frameCount = 0;

function update() {
    frameCount++;
    let w = canvas.width;
    let h = canvas.height;

    for (let ind of individuals) {
        ind.update(w, h);
    }

    if (Math.random() < resourceRate) {
        resources.push(new Resource(
            Math.random() * (w - 20) + 10,
            Math.random() * (h - 200) + 100
        ));
    }

    for (let ind of individuals) {
        if (!ind.alive) continue;
        let fitness = ind.species === 'A' ? fitnessA : fitnessB;
        for (let res of resources) {
            if (res.consumed) continue;
            let dx = ind.x - res.x;
            let dy = ind.y - res.y;
            if (dx * dx + dy * dy < 200 * fitness) {
                res.consumed = true;
                ind.energy += 25 * fitness;
                break;
            }
        }
    }

    resources = resources.filter(r => !r.consumed);
    if (resources.length > 500) resources.splice(0, resources.length - 500);

    if (frameCount % 4 === 0) {
        let births = [];
        for (let ind of individuals) {
            if (!ind.alive) continue;
            let fitness = ind.species === 'A' ? fitnessA : fitnessB;
            if (ind.energy > 70 && Math.random() < 0.03 * fitness && individuals.length + births.length < MAX_POP) {
                ind.energy -= 30;
                births.push(new Individual(
                    ind.x + (Math.random() - 0.5) * 20,
                    ind.y + (Math.random() - 0.5) * 20,
                    ind.species
                ));
            }
        }
        for (let b of births) individuals.push(b);
    }

    individuals = individuals.filter(i => i.alive);

    let countA = individuals.filter(i => i.species === 'A').length;
    let countB = individuals.filter(i => i.species === 'B').length;

    document.getElementById('countA').textContent = countA;
    document.getElementById('countB').textContent = countB;
    document.getElementById('resCount').textContent = resources.length;

    if (frameCount % 6 === 0) {
        generation++;
        document.getElementById('gen').textContent = generation;
        popHistoryA.push(countA);
        popHistoryB.push(countB);
        if (popHistoryA.length > MAX_HISTORY) popHistoryA.shift();
        if (popHistoryB.length > MAX_HISTORY) popHistoryB.shift();
    }

    if (countA === 0 && countB === 0) init();
}

function drawGraph(ctx) {
    let gw = 300, gh = 140;
    let gx = 20, gy = canvas.height - gh - 80;

    ctx.fillStyle = 'rgba(0,0,0,0.7)';
    ctx.strokeStyle = 'rgba(251,191,36,0.3)';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.roundRect(gx - 10, gy - 25, gw + 20, gh + 40, 8);
    ctx.fill();
    ctx.stroke();

    ctx.fillStyle = '#fbbf24';
    ctx.font = '11px sans-serif';
    ctx.fillText('Population Over Time', gx + 5, gy - 10);

    ctx.strokeStyle = 'rgba(255,255,255,0.1)';
    ctx.beginPath();
    ctx.moveTo(gx, gy + gh); ctx.lineTo(gx + gw, gy + gh);
    ctx.moveTo(gx, gy); ctx.lineTo(gx, gy + gh);
    ctx.stroke();

    let maxVal = 10;
    for (let i = 0; i < popHistoryA.length; i++) {
        if (popHistoryA[i] > maxVal) maxVal = popHistoryA[i];
        if (popHistoryB[i] > maxVal) maxVal = popHistoryB[i];
    }
    maxVal *= 1.2;

    if (popHistoryA.length > 1) {
        ctx.beginPath();
        for (let i = 0; i < popHistoryA.length; i++) {
            let x = gx + (i / MAX_HISTORY) * gw;
            let y = gy + gh - (popHistoryA[i] / maxVal) * gh;
            if (i === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
        }
        ctx.strokeStyle = 'rgba(96, 165, 250, 0.9)';
        ctx.lineWidth = 2;
        ctx.stroke();

        ctx.beginPath();
        for (let i = 0; i < popHistoryB.length; i++) {
            let x = gx + (i / MAX_HISTORY) * gw;
            let y = gy + gh - (popHistoryB[i] / maxVal) * gh;
            if (i === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
        }
        ctx.strokeStyle = 'rgba(244, 114, 182, 0.9)';
        ctx.lineWidth = 2;
        ctx.stroke();
    }

    ctx.fillStyle = '#60a5fa';
    ctx.font = '10px sans-serif';
    ctx.fillText('● Species A', gx + gw - 130, gy - 10);
    ctx.fillStyle = '#f472b6';
    ctx.fillText('● Species B', gx + gw - 60, gy - 10);
}

function draw() {
    ctx.fillStyle = '#0a0e1a';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    let grad = ctx.createRadialGradient(
        canvas.width / 2, canvas.height / 2, 0,
        canvas.width / 2, canvas.height / 2, canvas.width * 0.5
    );
    grad.addColorStop(0, 'rgba(25,20,40,0.4)');
    grad.addColorStop(1, 'rgba(10,14,26,0)');
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    for (let r of resources) {
        r.draw(ctx);
    }
    for (let ind of individuals) {
        ind.draw(ctx);
    }
    drawGraph(ctx);
}

function animate() {
    update();
    draw();
    requestAnimationFrame(animate);
}
animate();
</script>
</body>
</html>
