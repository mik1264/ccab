<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shor's Algorithm Visualization</title>
    <style>
        body { background: #111; color: #0f0; font-family: monospace; padding: 20px; }
        canvas { border: 1px solid #333; background: #000; }
        .inputs { margin-bottom: 20px; }
        input { background: #222; color: #0f0; border: 1px solid #0f0; padding: 5px; width: 60px; }
    </style>
</head>
<body>
    <h1>Shor's Algorithm: Period Finding</h1>
    <div class="inputs">
        f(x) = <input type="number" id="a" value="2"> ^ x mod <input type="number" id="N" value="15">
        <button onclick="calculate()">Find Period (r)</button>
    </div>
    <canvas id="canvas"></canvas>
    <div id="result"></div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const W = 800, H = 400;
        canvas.width = W;
        canvas.height = H;

        function calculate() {
            const a = parseInt(document.getElementById('a').value);
            const N = parseInt(document.getElementById('N').value);
            
            ctx.clearRect(0, 0, W, H);
            
            const values = [];
            for(let x=0; x<30; x++) {
                // Modular Exponentiation
                let val = 1;
                for(let i=0; i<x; i++) val = (val * a) % N;
                values.push(val);
            }

            // Draw Graph
            const barW = W / values.length;
            const scaleY = (H - 50) / N;

            ctx.fillStyle = '#0f0';
            ctx.font = '12px monospace';

            values.forEach((v, i) => {
                const h = v * scaleY;
                ctx.fillRect(i * barW + 2, H - h - 20, barW - 4, h);
                ctx.fillText(v, i * barW + 5, H - 5);
                ctx.fillText(i, i * barW + 5, H - h - 25);
            });

            // Find Period
            let period = 0;
            for(let r=1; r<values.length; r++) {
                if(values[r] === values[0]) {
                    period = r;
                    break;
                }
            }

            // Draw periodicity arcs
            if(period > 0) {
                ctx.strokeStyle = '#f0f';
                ctx.lineWidth = 2;
                ctx.beginPath();
                for(let i=0; i<values.length; i+=period) {
                    const x = i * barW + barW/2;
                    ctx.moveTo(x, H - 20);
                    // Draw arc to next
                    if(i + period < values.length) {
                        const nextX = (i + period) * barW + barW/2;
                        ctx.quadraticCurveTo((x+nextX)/2, H - 100, nextX, H - 20);
                    }
                }
                ctx.stroke();
                document.getElementById('result').innerHTML = `Period r = ${period}<br>Factors of ${N}: ${gcd(Math.pow(a, period/2)-1, N)} and ${gcd(Math.pow(a, period/2)+1, N)}`;
            } else {
                document.getElementById('result').textContent = "Period not found in range.";
            }
        }

        function gcd(a, b) {
            if(!b) return a;
            return gcd(b, a % b);
        }

        // Expose for enhance.js keyboard shortcuts
        window.reset = calculate;

        calculate();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
