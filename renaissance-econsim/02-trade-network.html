<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Renaissance EconSim: Trade Networks</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #ecf0f1;
            overflow: hidden;
            height: 100vh;
            display: flex;
        }
        #sidebar {
            width: 320px;
            background: rgba(0, 0, 0, 0.4);
            padding: 20px;
            overflow-y: auto;
        }
        h1 {
            font-size: 20px;
            margin-bottom: 15px;
            color: #e67e22;
        }
        .controls {
            margin-bottom: 20px;
        }
        .control-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-size: 12px;
            color: #bdc3c7;
        }
        input[type="range"] {
            width: 100%;
        }
        button {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            background: #e67e22;
            border: none;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #d35400;
        }
        .stats {
            font-size: 12px;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            padding: 5px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }
        .city-list {
            margin-top: 15px;
        }
        .city-item {
            padding: 8px;
            margin-bottom: 5px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
            font-size: 11px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .city-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .city-name {
            font-weight: bold;
            color: #e67e22;
            margin-bottom: 3px;
        }
        .city-wealth {
            color: #f39c12;
        }
        #canvas-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        canvas {
            border: 2px solid #0f3460;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        .info {
            font-size: 11px;
            color: #95a5a6;
            margin-top: 15px;
            line-height: 1.4;
        }
        .event-log {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            margin-top: 15px;
            max-height: 150px;
            overflow-y: auto;
            font-size: 10px;
        }
        .event {
            padding: 3px;
            margin-bottom: 3px;
            border-left: 2px solid #e67e22;
            padding-left: 8px;
        }
    </style>
</head>
<body>
    <div id="sidebar">
        <h1>Renaissance Trade Networks</h1>
        <div class="info">
            Visualizing trade routes between major Renaissance city-states. Watch wealth flow through Europe's economic arteries.
        </div>

        <div class="controls">
            <button id="resetBtn">Reset Network</button>
            <button id="pauseBtn">Pause</button>

            <div class="control-group">
                <label>Trade Volume: <span id="volumeDisplay">5</span></label>
                <input type="range" id="volumeSlider" min="1" max="10" value="5">
            </div>

            <div class="control-group">
                <label>Tariff Rate: <span id="tariffDisplay">0.10</span></label>
                <input type="range" id="tariffSlider" min="0" max="30" value="10">
            </div>

            <div class="control-group">
                <label>Plague Risk: <span id="plagueDisplay">0.02</span></label>
                <input type="range" id="plagueSlider" min="0" max="10" value="2">
            </div>
        </div>

        <div class="stats">
            <h3 style="margin-bottom: 10px; color: #e67e22;">Network Metrics</h3>
            <div class="stat-item">
                <span>Total Trade Volume:</span>
                <span id="totalTrade">0</span>
            </div>
            <div class="stat-item">
                <span>Active Routes:</span>
                <span id="activeRoutes">0</span>
            </div>
            <div class="stat-item">
                <span>Network Wealth:</span>
                <span id="networkWealth">0</span>
            </div>
            <div class="stat-item">
                <span>Wealthiest City:</span>
                <span id="wealthiestCity">-</span>
            </div>
        </div>

        <div class="city-list">
            <h3 style="margin-bottom: 10px; color: #e67e22;">City-States</h3>
            <div id="cityListContainer"></div>
        </div>

        <div class="event-log">
            <h3 style="margin-bottom: 8px; color: #e67e22;">Trade Events</h3>
            <div id="eventLog"></div>
        </div>
    </div>

    <div id="canvas-container">
        <canvas id="canvas"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 900;
        canvas.height = 700;

        let paused = false;
        let time = 0;
        let totalTradeVolume = 0;
        let events = [];

        const cities = [
            { name: 'Florence', x: 400, y: 450, wealth: 1000, goods: ['textiles', 'banking'] },
            { name: 'Venice', x: 520, y: 380, wealth: 1200, goods: ['spices', 'glass'] },
            { name: 'Genoa', x: 350, y: 400, wealth: 900, goods: ['shipping', 'trade'] },
            { name: 'Milan', x: 380, y: 320, wealth: 800, goods: ['armor', 'silk'] },
            { name: 'Rome', x: 450, y: 550, wealth: 700, goods: ['art', 'religion'] },
            { name: 'Naples', x: 500, y: 650, wealth: 600, goods: ['agriculture', 'wine'] },
            { name: 'Bruges', x: 380, y: 120, wealth: 850, goods: ['wool', 'tapestries'] },
            { name: 'London', x: 280, y: 100, wealth: 950, goods: ['wool', 'metals'] },
            { name: 'Paris', x: 300, y: 200, wealth: 800, goods: ['luxury', 'fashion'] },
            { name: 'Augsburg', x: 500, y: 250, wealth: 750, goods: ['banking', 'mining'] },
            { name: 'Constantinople', x: 780, y: 480, wealth: 1100, goods: ['silk', 'exotic'] },
            { name: 'Alexandria', x: 700, y: 650, wealth: 650, goods: ['spices', 'grain'] }
        ];

        const tradeRoutes = [];

        function generateRoutes() {
            tradeRoutes.length = 0;
            cities.forEach((city, i) => {
                cities.forEach((other, j) => {
                    if (i < j) {
                        const dist = Math.hypot(city.x - other.x, city.y - other.y);
                        if (dist < 350 || Math.random() < 0.3) {
                            tradeRoutes.push({
                                from: i,
                                to: j,
                                volume: Math.random() * 100,
                                goods: Math.floor(Math.random() * 5)
                            });
                        }
                    }
                });
            });
        }

        class TradeShip {
            constructor(route) {
                this.route = route;
                this.progress = 0;
                this.speed = 0.005 + Math.random() * 0.01;
                this.value = 10 + Math.random() * 50;
            }

            update() {
                this.progress += this.speed;
                return this.progress >= 1;
            }

            draw() {
                const from = cities[this.route.from];
                const to = cities[this.route.to];
                const x = from.x + (to.x - from.x) * this.progress;
                const y = from.y + (to.y - from.y) * this.progress;

                ctx.fillStyle = '#f39c12';
                ctx.beginPath();
                ctx.arc(x, y, 3, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        let ships = [];

        function spawnShips() {
            const volumeFactor = parseFloat(document.getElementById('volumeSlider').value);
            if (Math.random() < volumeFactor / 50) {
                const route = tradeRoutes[Math.floor(Math.random() * tradeRoutes.length)];
                if (route) {
                    ships.push(new TradeShip(route));
                }
            }
        }

        function updateEconomy() {
            ships = ships.filter(ship => {
                const completed = ship.update();
                if (completed) {
                    const tariff = parseFloat(document.getElementById('tariffSlider').value) / 100;
                    const value = ship.value * (1 - tariff);
                    cities[ship.route.to].wealth += value;
                    cities[ship.route.from].wealth += ship.value * 0.3;
                    totalTradeVolume += ship.value;

                    if (Math.random() < 0.05) {
                        addEvent(`${cities[ship.route.from].name} â†’ ${cities[ship.route.to].name}: ${ship.value.toFixed(0)} florins`);
                    }
                }
                return !completed;
            });

            // Plague events
            const plagueRisk = parseFloat(document.getElementById('plagueSlider').value) / 1000;
            cities.forEach(city => {
                if (Math.random() < plagueRisk) {
                    const loss = city.wealth * 0.1;
                    city.wealth -= loss;
                    addEvent(`âš  Plague strikes ${city.name}! Lost ${loss.toFixed(0)} wealth`);
                }
            });

            // Natural growth
            cities.forEach(city => {
                city.wealth += 0.5;
            });
        }

        function addEvent(text) {
            events.unshift(text);
            if (events.length > 20) events.pop();

            const log = document.getElementById('eventLog');
            log.innerHTML = events.map(e => `<div class="event">${e}</div>`).join('');
        }

        function updateStats() {
            document.getElementById('totalTrade').textContent = totalTradeVolume.toFixed(0);
            document.getElementById('activeRoutes').textContent = tradeRoutes.length;

            const totalWealth = cities.reduce((sum, c) => sum + c.wealth, 0);
            document.getElementById('networkWealth').textContent = totalWealth.toFixed(0);

            const wealthiest = cities.reduce((max, city) => city.wealth > max.wealth ? city : max, cities[0]);
            document.getElementById('wealthiestCity').textContent = wealthiest.name;

            // Update city list
            const cityList = cities
                .sort((a, b) => b.wealth - a.wealth)
                .map(city => `
                    <div class="city-item">
                        <div class="city-name">${city.name}</div>
                        <div class="city-wealth">ðŸ’° ${city.wealth.toFixed(0)} florins</div>
                        <div style="color: #95a5a6;">${city.goods.join(', ')}</div>
                    </div>
                `).join('');

            document.getElementById('cityListContainer').innerHTML = cityList;
        }

        function drawNetwork() {
            ctx.fillStyle = '#0a0e27';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw routes
            tradeRoutes.forEach(route => {
                const from = cities[route.from];
                const to = cities[route.to];

                const alpha = Math.min(route.volume / 100, 0.5);
                ctx.strokeStyle = `rgba(230, 126, 34, ${alpha})`;
                ctx.lineWidth = 1 + route.volume / 50;

                ctx.beginPath();
                ctx.moveTo(from.x, from.y);
                ctx.lineTo(to.x, to.y);
                ctx.stroke();
            });

            // Draw cities
            cities.forEach(city => {
                const size = 8 + (city.wealth / 200);

                // City glow
                const gradient = ctx.createRadialGradient(city.x, city.y, 0, city.x, city.y, size * 2);
                gradient.addColorStop(0, 'rgba(230, 126, 34, 0.6)');
                gradient.addColorStop(1, 'rgba(230, 126, 34, 0)');
                ctx.fillStyle = gradient;
                ctx.fillRect(city.x - size * 2, city.y - size * 2, size * 4, size * 4);

                // City circle
                ctx.fillStyle = city.wealth > 1000 ? '#f39c12' : '#e67e22';
                ctx.beginPath();
                ctx.arc(city.x, city.y, size, 0, Math.PI * 2);
                ctx.fill();

                // City border
                ctx.strokeStyle = '#ecf0f1';
                ctx.lineWidth = 2;
                ctx.stroke();

                // City name
                ctx.fillStyle = '#ecf0f1';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(city.name, city.x, city.y - size - 8);

                // Wealth indicator
                ctx.font = '10px Arial';
                ctx.fillStyle = '#f39c12';
                ctx.fillText(city.wealth.toFixed(0), city.x, city.y + size + 15);
            });

            // Draw ships
            ships.forEach(ship => ship.draw());
        }

        function animate() {
            if (!paused) {
                drawNetwork();
                spawnShips();
                updateEconomy();

                time++;
                if (time % 30 === 0) updateStats();
            }

            requestAnimationFrame(animate);
        }

        // Controls
        document.getElementById('resetBtn').addEventListener('click', () => {
            cities.forEach(city => {
                city.wealth = 500 + Math.random() * 500;
            });
            ships = [];
            totalTradeVolume = 0;
            events = [];
            generateRoutes();
        });

        document.getElementById('pauseBtn').addEventListener('click', (e) => {
            paused = !paused;
            e.target.textContent = paused ? 'Resume' : 'Pause';
        });

        document.getElementById('volumeSlider').addEventListener('input', (e) => {
            document.getElementById('volumeDisplay').textContent = e.target.value;
        });

        document.getElementById('tariffSlider').addEventListener('input', (e) => {
            document.getElementById('tariffDisplay').textContent = (e.target.value / 100).toFixed(2);
        });

        document.getElementById('plagueSlider').addEventListener('input', (e) => {
            document.getElementById('plagueDisplay').textContent = (e.target.value / 100).toFixed(2);
        });

        // Initialize
        generateRoutes();
        addEvent('âš¡ Trade network initialized');
        addEvent('ðŸ“Š 12 city-states connected');
        updateStats();
        animate();
    </script>
</body>
</html>
