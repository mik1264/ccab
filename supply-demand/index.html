<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Supply and Demand Equilibrium</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
canvas { display: block; }
#title { position: fixed; top: 10px; left: 50%; transform: translateX(-50%); color: #fbbf24; font-size: 20px; font-weight: 700; z-index: 999; text-shadow: 0 0 20px rgba(251,191,36,0.5); font-family: sans-serif; }
#controls { position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; z-index: 999; background: rgba(0,0,0,0.75); padding: 12px 20px; border-radius: 10px; flex-wrap: wrap; justify-content: center; }
#controls button { background: rgba(251,191,36,0.15); color: #fbbf24; border: 1px solid rgba(251,191,36,0.4); padding: 6px 14px; border-radius: 6px; cursor: pointer; font-size: 12px; transition: all 0.2s; }
#controls button:hover { background: rgba(251,191,36,0.3); }
#controls button.active { background: rgba(251,191,36,0.4); border-color: #fbbf24; }
#info { position: fixed; top: 50px; right: 15px; color: #ccc; font-size: 12px; z-index: 999; background: rgba(0,0,0,0.65); padding: 12px; border-radius: 8px; line-height: 1.8; }
#info .eq { color: #fbbf24; font-weight: bold; }
#info .cs { color: #4ade80; }
#info .ps { color: #60a5fa; }
#instructions { position: fixed; top: 50px; left: 15px; color: rgba(255,255,255,0.5); font-size: 11px; z-index: 999; max-width: 200px; line-height: 1.5; }
</style>
</head>
<body>
<a href="../index.html" style="position:fixed;top:10px;left:10px;padding:8px 16px;background:rgba(0,0,0,0.7);color:#fbbf24;text-decoration:none;border-radius:6px;font-size:14px;z-index:999;font-family:sans-serif;">‚Üê Back to Gallery</a>
<div id="title">Supply and Demand Equilibrium</div>
<div id="instructions">Drag the colored dots to shift supply and demand curves. Use buttons below to apply economic shocks.</div>
<div id="info">
    <div>Equilibrium Price: <span class="eq" id="eqPrice">--</span></div>
    <div>Equilibrium Qty: <span class="eq" id="eqQty">--</span></div>
    <div>Consumer Surplus: <span class="cs" id="cSurplus">--</span></div>
    <div>Producer Surplus: <span class="ps" id="pSurplus">--</span></div>
    <div style="margin-top:6px;font-size:10px;color:#888;">Tax Revenue: <span id="taxRev" style="color:#f472b6;">--</span></div>
</div>
<canvas id="canvas"></canvas>
<div id="controls">
    <button id="btnTax">Apply Tax (+$15)</button>
    <button id="btnSubsidy">Apply Subsidy (-$10)</button>
    <button id="btnDemandUp">Demand Shock +</button>
    <button id="btnDemandDown">Demand Shock -</button>
    <button id="btnSupplyUp">Supply Shock +</button>
    <button id="btnSupplyDown">Supply Shock -</button>
    <button id="btnReset">Reset</button>
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
resize();
window.addEventListener('resize', resize);

// Supply: P = supplyBase + supplySlope * Q
// Demand: P = demandBase - demandSlope * Q
let supplyBase = 10, supplySlope = 0.8;
let demandBase = 100, demandSlope = 0.7;
let tax = 0;
let supplyShift = 0;
let demandShift = 0;

// Animated targets
let aSupplyBase = supplyBase, aDemandBase = demandBase, aTax = 0;

// Draggable control points
let dragPoints = {
    supply: { x: 0, y: 0 },  // recalculated
    demand: { x: 0, y: 0 }
};
let dragging = null;

function getChartArea() {
    const W = canvas.width, H = canvas.height;
    return {
        left: W * 0.12,
        right: W * 0.85,
        top: H * 0.12,
        bottom: H * 0.78,
        get width() { return this.right - this.left; },
        get height() { return this.bottom - this.top; }
    };
}

function qToX(q, chart) {
    return chart.left + (q / 120) * chart.width;
}
function pToY(p, chart) {
    return chart.bottom - (p / 120) * chart.height;
}
function xToQ(x, chart) {
    return ((x - chart.left) / chart.width) * 120;
}
function yToP(y, chart) {
    return ((chart.bottom - y) / chart.height) * 120;
}

function supplyP(q) { return (aSupplyBase + supplyShift) + supplySlope * q + aTax; }
function demandP(q) { return (aDemandBase + demandShift) - demandSlope * q; }
function supplyPNoTax(q) { return (aSupplyBase + supplyShift) + supplySlope * q; }

function equilibrium() {
    // Supply: P = sB + sS*Q + tax; Demand: P = dB - dS*Q
    // sB + sS*Q + tax = dB - dS*Q
    // Q = (dB - sB - tax) / (sS + dS)
    const qEq = ((aDemandBase + demandShift) - (aSupplyBase + supplyShift) - aTax) / (supplySlope + demandSlope);
    const pEq = demandP(qEq);
    return { q: Math.max(0, qEq), p: Math.max(0, pEq) };
}

document.getElementById('btnTax').onclick = () => { tax += 15; };
document.getElementById('btnSubsidy').onclick = () => { tax -= 10; };
document.getElementById('btnDemandUp').onclick = () => { demandShift += 15; };
document.getElementById('btnDemandDown').onclick = () => { demandShift -= 15; };
document.getElementById('btnSupplyUp').onclick = () => { supplyShift -= 10; };
document.getElementById('btnSupplyDown').onclick = () => { supplyShift += 10; };
document.getElementById('btnReset').onclick = () => {
    supplyBase = 10; supplySlope = 0.8;
    demandBase = 100; demandSlope = 0.7;
    tax = 0; supplyShift = 0; demandShift = 0;
};

canvas.addEventListener('mousedown', (e) => {
    const chart = getChartArea();
    const mx = e.clientX, my = e.clientY;
    // Check supply control point
    const eq = equilibrium();
    const spx = qToX(eq.q, chart), spy = pToY(supplyP(eq.q), chart);
    const dpx = qToX(eq.q, chart), dpy = pToY(demandP(eq.q), chart);

    // Check supply intercept
    const si = { x: qToX(0, chart), y: pToY(supplyP(0), chart) };
    const di = { x: qToX(0, chart), y: pToY(demandP(0), chart) };

    if (Math.hypot(mx - si.x, my - si.y) < 20) { dragging = 'supply'; return; }
    if (Math.hypot(mx - di.x, my - di.y) < 20) { dragging = 'demand'; return; }
});

canvas.addEventListener('mousemove', (e) => {
    if (!dragging) return;
    const chart = getChartArea();
    const p = yToP(e.clientY, chart);
    if (dragging === 'supply') {
        supplyShift = p - supplyBase - aTax;
    } else if (dragging === 'demand') {
        demandShift = p - demandBase;
    }
});

canvas.addEventListener('mouseup', () => { dragging = null; });
canvas.addEventListener('mouseleave', () => { dragging = null; });

function lerp(a, b, t) { return a + (b - a) * t; }

function draw() {
    // Animate
    aSupplyBase = lerp(aSupplyBase, supplyBase, 0.08);
    aDemandBase = lerp(aDemandBase, demandBase, 0.08);
    aTax = lerp(aTax, tax, 0.08);

    const W = canvas.width, H = canvas.height;
    ctx.fillStyle = '#0a0e1a';
    ctx.fillRect(0, 0, W, H);

    const chart = getChartArea();

    // Grid
    ctx.strokeStyle = 'rgba(255,255,255,0.05)';
    ctx.lineWidth = 1;
    for (let i = 0; i <= 12; i++) {
        const x = chart.left + (chart.width / 12) * i;
        ctx.beginPath(); ctx.moveTo(x, chart.top); ctx.lineTo(x, chart.bottom); ctx.stroke();
        const y = chart.top + (chart.height / 12) * i;
        ctx.beginPath(); ctx.moveTo(chart.left, y); ctx.lineTo(chart.right, y); ctx.stroke();
    }

    // Axes
    ctx.strokeStyle = 'rgba(255,255,255,0.3)';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(chart.left, chart.top);
    ctx.lineTo(chart.left, chart.bottom);
    ctx.lineTo(chart.right, chart.bottom);
    ctx.stroke();

    // Labels
    ctx.fillStyle = 'rgba(255,255,255,0.5)';
    ctx.font = '12px sans-serif';
    ctx.save();
    ctx.translate(chart.left - 40, chart.top + chart.height / 2);
    ctx.rotate(-Math.PI / 2);
    ctx.textAlign = 'center';
    ctx.fillText('Price ($)', 0, 0);
    ctx.restore();
    ctx.textAlign = 'center';
    ctx.fillText('Quantity', chart.left + chart.width / 2, chart.bottom + 35);

    // Tick labels
    ctx.font = '10px sans-serif';
    ctx.textAlign = 'right';
    for (let p = 0; p <= 120; p += 20) {
        ctx.fillText('$' + p, chart.left - 5, pToY(p, chart) + 3);
    }
    ctx.textAlign = 'center';
    for (let q = 0; q <= 120; q += 20) {
        ctx.fillText(q, qToX(q, chart), chart.bottom + 15);
    }

    const eq = equilibrium();

    // Consumer surplus area (above eq price, below demand curve)
    if (eq.q > 0 && eq.p > 0) {
        ctx.beginPath();
        ctx.moveTo(qToX(0, chart), pToY(demandP(0), chart));
        for (let q = 0; q <= eq.q; q += 0.5) {
            ctx.lineTo(qToX(q, chart), pToY(demandP(q), chart));
        }
        ctx.lineTo(qToX(eq.q, chart), pToY(eq.p, chart));
        ctx.lineTo(qToX(0, chart), pToY(eq.p, chart));
        ctx.closePath();
        ctx.fillStyle = 'rgba(74,222,128,0.15)';
        ctx.fill();

        // Producer surplus area
        ctx.beginPath();
        ctx.moveTo(qToX(0, chart), pToY(supplyPNoTax(0), chart));
        for (let q = 0; q <= eq.q; q += 0.5) {
            ctx.lineTo(qToX(q, chart), pToY(supplyPNoTax(q), chart));
        }
        const pProducer = supplyPNoTax(eq.q);
        ctx.lineTo(qToX(eq.q, chart), pToY(pProducer, chart));
        ctx.lineTo(qToX(eq.q, chart), pToY(eq.p - aTax, chart));
        ctx.lineTo(qToX(0, chart), pToY(eq.p - aTax, chart));
        ctx.closePath();
        ctx.fillStyle = 'rgba(96,165,250,0.15)';
        ctx.fill();

        // Tax revenue area
        if (Math.abs(aTax) > 0.5) {
            ctx.beginPath();
            ctx.moveTo(qToX(0, chart), pToY(eq.p, chart));
            ctx.lineTo(qToX(eq.q, chart), pToY(eq.p, chart));
            ctx.lineTo(qToX(eq.q, chart), pToY(eq.p - aTax, chart));
            ctx.lineTo(qToX(0, chart), pToY(eq.p - aTax, chart));
            ctx.closePath();
            ctx.fillStyle = 'rgba(244,114,182,0.12)';
            ctx.fill();
        }
    }

    // Draw supply curve
    ctx.beginPath();
    ctx.strokeStyle = '#60a5fa';
    ctx.lineWidth = 3;
    for (let q = 0; q <= 120; q += 0.5) {
        const p = supplyP(q);
        const x = qToX(q, chart), y = pToY(p, chart);
        if (q === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
    }
    ctx.stroke();

    // Supply label
    ctx.fillStyle = '#60a5fa';
    ctx.font = 'bold 14px sans-serif';
    ctx.textAlign = 'left';
    const sLabelQ = 90;
    ctx.fillText('Supply (S)', qToX(sLabelQ, chart) + 5, pToY(supplyP(sLabelQ), chart) - 8);

    // Draw supply curve without tax (if tax active)
    if (Math.abs(aTax) > 1) {
        ctx.beginPath();
        ctx.strokeStyle = 'rgba(96,165,250,0.3)';
        ctx.lineWidth = 1.5;
        ctx.setLineDash([5, 5]);
        for (let q = 0; q <= 120; q += 0.5) {
            const p = supplyPNoTax(q);
            const x = qToX(q, chart), y = pToY(p, chart);
            if (q === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
        }
        ctx.stroke();
        ctx.setLineDash([]);
    }

    // Draw demand curve
    ctx.beginPath();
    ctx.strokeStyle = '#4ade80';
    ctx.lineWidth = 3;
    for (let q = 0; q <= 120; q += 0.5) {
        const p = demandP(q);
        const x = qToX(q, chart), y = pToY(p, chart);
        if (q === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
    }
    ctx.stroke();

    // Demand label
    ctx.fillStyle = '#4ade80';
    ctx.font = 'bold 14px sans-serif';
    const dLabelQ = 90;
    ctx.fillText('Demand (D)', qToX(dLabelQ, chart) + 5, pToY(demandP(dLabelQ), chart) + 18);

    // Equilibrium point
    if (eq.q > 0 && eq.p > 0) {
        const ex = qToX(eq.q, chart), ey = pToY(eq.p, chart);

        // Dashed lines to axes
        ctx.strokeStyle = 'rgba(251,191,36,0.4)';
        ctx.lineWidth = 1;
        ctx.setLineDash([4, 4]);
        ctx.beginPath();
        ctx.moveTo(ex, ey);
        ctx.lineTo(chart.left, ey);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(ex, ey);
        ctx.lineTo(ex, chart.bottom);
        ctx.stroke();
        ctx.setLineDash([]);

        // Equilibrium dot with glow
        ctx.beginPath();
        ctx.arc(ex, ey, 8, 0, Math.PI * 2);
        ctx.fillStyle = 'rgba(251,191,36,0.3)';
        ctx.fill();
        ctx.beginPath();
        ctx.arc(ex, ey, 5, 0, Math.PI * 2);
        ctx.fillStyle = '#fbbf24';
        ctx.fill();

        ctx.fillStyle = '#fbbf24';
        ctx.font = 'bold 12px sans-serif';
        ctx.textAlign = 'left';
        ctx.fillText('Equilibrium', ex + 12, ey - 5);
    }

    // Draggable control points at intercepts
    const si = { x: qToX(0, chart), y: pToY(supplyP(0), chart) };
    const di = { x: qToX(0, chart), y: pToY(demandP(0), chart) };

    // Supply intercept dot
    ctx.beginPath();
    ctx.arc(si.x, si.y, 8, 0, Math.PI * 2);
    ctx.fillStyle = dragging === 'supply' ? '#60a5fa' : 'rgba(96,165,250,0.6)';
    ctx.fill();
    ctx.strokeStyle = '#60a5fa';
    ctx.lineWidth = 2;
    ctx.stroke();

    // Demand intercept dot
    ctx.beginPath();
    ctx.arc(di.x, di.y, 8, 0, Math.PI * 2);
    ctx.fillStyle = dragging === 'demand' ? '#4ade80' : 'rgba(74,222,128,0.6)';
    ctx.fill();
    ctx.strokeStyle = '#4ade80';
    ctx.lineWidth = 2;
    ctx.stroke();

    // Update info
    document.getElementById('eqPrice').textContent = eq.p > 0 ? '$' + eq.p.toFixed(2) : 'N/A';
    document.getElementById('eqQty').textContent = eq.q > 0 ? eq.q.toFixed(1) : 'N/A';

    if (eq.q > 0 && eq.p > 0) {
        const cs = 0.5 * eq.q * (demandP(0) - eq.p);
        const ps = 0.5 * eq.q * (eq.p - aTax - supplyPNoTax(0));
        const tRev = aTax * eq.q;
        document.getElementById('cSurplus').textContent = '$' + Math.max(0, cs).toFixed(0);
        document.getElementById('pSurplus').textContent = '$' + Math.max(0, ps).toFixed(0);
        document.getElementById('taxRev').textContent = Math.abs(tRev) > 0.5 ? '$' + tRev.toFixed(0) : 'None';
    }

    requestAnimationFrame(draw);
}

draw();
</script>
</body>
</html>
