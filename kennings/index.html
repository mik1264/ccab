<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Kenning Exhibition - Where Ancient Metaphor Meets Generative Art</title>
    <meta name="description" content="An interactive Norse poetry gallery exploring kennings from Beowulf, the Prose Edda, and Skaldskaparmal. Forge new kennings, explore generative runic art, and contribute to the Living Edda.">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>&#x16A8;</text></svg>">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,600;0,700;1,400;1,600&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-deep: #1a1a2e;
            --bg-mid: #16213e;
            --bg-surface: #1f2641;
            --gold: #e6c069;
            --gold-dim: #b8944d;
            --parchment: #d4c5a9;
            --parchment-dim: #9e9279;
            --ink: #0d0d1a;
            --glow: rgba(230, 192, 105, 0.15);

            --accent: #e6c069;
            --accent-glow: rgba(230, 192, 105, 0.12);

            --font-display: 'EB Garamond', 'Georgia', serif;
            --font-body: 'Inter', 'Helvetica Neue', sans-serif;

            --nav-width: 260px;
            --transition-room: 0.6s cubic-bezier(0.22, 1, 0.36, 1);
        }

        /* === Reset & Base === */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: var(--font-body);
            background: var(--bg-deep);
            color: var(--parchment);
            line-height: 1.7;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* === Focus Visible === */
        :focus-visible {
            outline: 2px solid var(--gold);
            outline-offset: 3px;
        }

        /* === Scrollbar === */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-deep); }
        ::-webkit-scrollbar-thumb { background: var(--gold-dim); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--gold); }

        /* === Persistent Navigation === */
        .exhibition-nav {
            position: fixed;
            top: 0;
            left: 0;
            width: var(--nav-width);
            height: 100vh;
            background: linear-gradient(180deg, var(--ink) 0%, var(--bg-deep) 100%);
            border-right: 1px solid rgba(230, 192, 105, 0.08);
            padding: 30px 0;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            transition: transform 0.4s cubic-bezier(0.22, 1, 0.36, 1);
        }

        .exhibition-nav .nav-title {
            font-family: var(--font-display);
            font-size: 1.1rem;
            color: var(--gold);
            text-align: center;
            padding: 0 20px 25px;
            border-bottom: 1px solid rgba(230, 192, 105, 0.1);
            letter-spacing: 0.05em;
        }

        .exhibition-nav .nav-rooms {
            flex: 1;
            padding: 15px 0;
            overflow-y: auto;
        }

        .exhibition-nav .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: var(--parchment-dim);
            text-decoration: none;
            font-family: var(--font-body);
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .exhibition-nav .nav-link:hover {
            color: var(--gold);
            background: rgba(230, 192, 105, 0.05);
            border-left-color: var(--gold-dim);
        }

        .exhibition-nav .nav-link.active {
            color: var(--gold);
            background: rgba(230, 192, 105, 0.08);
            border-left-color: var(--accent);
        }

        .exhibition-nav .nav-icon {
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }

        .exhibition-nav .nav-footer {
            padding: 15px 0;
            border-top: 1px solid rgba(230, 192, 105, 0.1);
        }

        .exhibition-nav .nav-back {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: var(--parchment-dim);
            text-decoration: none;
            font-family: var(--font-body);
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .exhibition-nav .nav-back:hover {
            color: var(--gold);
            background: rgba(230, 192, 105, 0.05);
            border-left-color: var(--gold-dim);
        }

        /* === Mobile Header === */
        .mobile-header {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 56px;
            background: var(--ink);
            border-bottom: 1px solid rgba(230, 192, 105, 0.1);
            align-items: center;
            padding: 0 16px;
            z-index: 999;
        }

        .hamburger {
            width: 40px;
            height: 40px;
            background: none;
            border: none;
            color: var(--gold);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .mobile-title {
            font-family: var(--font-display);
            color: var(--gold);
            font-size: 1rem;
            margin-left: 12px;
            letter-spacing: 0.03em;
        }

        .nav-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 998;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .nav-overlay.visible {
            opacity: 1;
            pointer-events: all;
        }

        /* === Room Transition === */
        .room-transition {
            position: fixed;
            inset: 0;
            background: var(--ink);
            z-index: 9999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
        }

        .room-transition.active {
            opacity: 1;
            pointer-events: all;
        }

        /* === p5.js Backdrop === */
        #p5-backdrop {
            position: fixed;
            top: 0;
            left: var(--nav-width);
            right: 0;
            bottom: 0;
            z-index: 0;
            opacity: 0.35;
            pointer-events: none;
        }

        #p5-backdrop canvas {
            display: block;
            width: 100% !important;
            height: 100% !important;
        }

        /* === Main Content === */
        .exhibition-main {
            margin-left: var(--nav-width);
            min-height: 100vh;
            position: relative;
        }

        /* === Hero Section === */
        .hero {
            position: relative;
            z-index: 1;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 60px 40px;
        }

        .hero-title {
            font-family: var(--font-display);
            font-weight: 700;
            letter-spacing: 0.18em;
            text-transform: uppercase;
            color: var(--gold);
            margin-bottom: 20px;
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 1.2s ease, transform 1.2s ease;
        }

        .hero-title.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .hero-title-line1 {
            font-size: 2.2rem;
            display: block;
        }

        .hero-title-line2 {
            font-size: 3.2rem;
            display: block;
        }

        .hero-subtitle {
            font-family: var(--font-display);
            font-style: italic;
            font-size: 1.2rem;
            color: var(--parchment-dim);
            letter-spacing: 0.04em;
            margin-bottom: 50px;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 1s ease 0.4s, transform 1s ease 0.4s;
        }

        .hero-subtitle.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* === Featured Kenning === */
        .featured-kenning {
            position: relative;
            background: rgba(31, 38, 65, 0.6);
            border: 1px solid rgba(230, 192, 105, 0.12);
            border-radius: 12px;
            padding: 35px 50px;
            max-width: 560px;
            width: 100%;
            margin-bottom: 20px;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 1s ease 0.8s, transform 1s ease 0.8s;
        }

        .featured-kenning.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .featured-label {
            font-family: var(--font-body);
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--parchment-dim);
            margin-bottom: 16px;
        }

        .featured-kenning-text {
            position: relative;
            min-height: 80px;
        }

        .kenning-display {
            transition: opacity 0.8s ease;
        }

        .kenning-display.fading {
            opacity: 0;
        }

        .kenning {
            font-family: var(--font-display);
            font-style: italic;
            color: var(--gold);
            letter-spacing: 0.02em;
            font-size: 2.4rem;
            font-weight: 600;
            line-height: 1.3;
        }

        .kenning-literal {
            font-family: var(--font-display);
            font-style: italic;
            font-size: 1.15rem;
            color: var(--parchment);
            margin-top: 6px;
        }

        .kenning-meaning {
            font-family: var(--font-body);
            font-size: 0.85rem;
            color: var(--parchment-dim);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-top: 10px;
        }

        .kenning-source {
            font-family: var(--font-body);
            font-size: 0.78rem;
            color: var(--parchment-dim);
            margin-top: 6px;
            opacity: 0.7;
        }

        .scroll-hint {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            color: var(--parchment-dim);
            font-size: 0.8rem;
            font-family: var(--font-body);
            letter-spacing: 0.05em;
            opacity: 0;
            animation: fadeInScroll 1s ease 2.5s forwards;
        }

        .scroll-hint-arrow {
            display: block;
            text-align: center;
            font-size: 1.2rem;
            margin-top: 4px;
            animation: bounceDown 2s ease-in-out infinite;
        }

        @keyframes fadeInScroll {
            to { opacity: 0.6; }
        }

        @keyframes bounceDown {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(6px); }
        }

        /* === Rooms Section === */
        .rooms-section {
            position: relative;
            z-index: 1;
            padding: 60px 40px 100px;
            max-width: 1100px;
            margin: 0 auto;
        }

        .rooms-heading {
            font-family: var(--font-display);
            font-size: 1.6rem;
            font-weight: 600;
            color: var(--gold);
            text-align: center;
            margin-bottom: 12px;
            letter-spacing: 0.05em;
        }

        .rooms-tier-label {
            font-family: var(--font-body);
            font-size: 0.8rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            color: var(--parchment-dim);
            text-align: center;
            margin-bottom: 24px;
            margin-top: 48px;
        }

        .rooms-tier-label:first-of-type {
            margin-top: 30px;
        }

        .rooms-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
        }

        /* === Room Card === */
        .room-card {
            display: block;
            position: relative;
            background: rgba(31, 38, 65, 0.5);
            border: 1px solid rgba(230, 192, 105, 0.08);
            border-radius: 12px;
            padding: 30px 24px;
            text-decoration: none;
            transition: all 0.4s cubic-bezier(0.22, 1, 0.36, 1);
            opacity: 0;
            transform: translateY(40px);
        }

        .room-card.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .room-card:hover {
            transform: translateY(-4px);
            border-color: var(--card-accent, var(--gold-dim));
            box-shadow: 0 0 30px var(--card-glow, rgba(230, 192, 105, 0.1));
        }

        .room-card-icon {
            font-size: 1.8rem;
            margin-bottom: 14px;
            display: block;
        }

        .room-card-name {
            font-family: var(--font-display);
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--gold);
            margin-bottom: 8px;
        }

        .room-card-teaser {
            font-family: var(--font-body);
            font-size: 0.88rem;
            color: var(--parchment-dim);
            line-height: 1.6;
            margin-bottom: 16px;
        }

        .room-card-enter {
            font-family: var(--font-body);
            font-size: 0.78rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--gold-dim);
            transition: color 0.3s ease;
        }

        .room-card:hover .room-card-enter {
            color: var(--gold);
        }

        /* Per-room accent colors */
        .room-card[data-room="beowulf"] {
            --card-accent: #8b2500;
            --card-glow: rgba(139, 37, 0, 0.15);
        }
        .room-card[data-room="edda"] {
            --card-accent: #4a8fa8;
            --card-glow: rgba(74, 143, 168, 0.15);
        }
        .room-card[data-room="skald"] {
            --card-accent: #c77d2e;
            --card-glow: rgba(199, 125, 46, 0.15);
        }
        .room-card[data-room="forge"] {
            --card-accent: #d4601a;
            --card-glow: rgba(212, 96, 26, 0.15);
        }
        .room-card[data-room="living"] {
            --card-accent: #3a7d44;
            --card-glow: rgba(58, 125, 68, 0.15);
        }
        .room-card[data-room="runic"] {
            --card-accent: #7b5ea7;
            --card-glow: rgba(123, 94, 167, 0.15);
        }

        /* === About Section === */
        .about-section {
            position: relative;
            z-index: 1;
            max-width: 680px;
            margin: 0 auto;
            padding: 0 40px 80px;
            text-align: center;
        }

        .about-text {
            font-family: var(--font-display);
            font-size: 1.1rem;
            font-style: italic;
            color: var(--parchment-dim);
            line-height: 1.9;
        }

        /* === Audio Toggle === */
        .audio-toggle {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--bg-surface);
            border: 1px solid rgba(230, 192, 105, 0.15);
            color: var(--gold);
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .audio-toggle:hover {
            background: rgba(230, 192, 105, 0.15);
            transform: scale(1.1);
        }

        .audio-toggle.muted {
            color: var(--parchment-dim);
        }

        /* === StoryLeaf Gallery === */
        .storyleaf-section {
            position: relative;
            z-index: 1;
            padding: 60px 40px 80px;
            max-width: 1100px;
            margin: 0 auto;
        }

        .storyleaf-heading {
            font-family: var(--font-display);
            font-size: 1.6rem;
            font-weight: 600;
            color: var(--gold);
            text-align: center;
            margin-bottom: 8px;
            letter-spacing: 0.05em;
        }

        .storyleaf-subheading {
            font-family: var(--font-body);
            font-size: 0.85rem;
            color: var(--parchment-dim);
            text-align: center;
            margin-bottom: 32px;
        }

        .storyleaf-subheading a {
            color: var(--gold-dim);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .storyleaf-subheading a:hover {
            color: var(--gold);
        }

        .storyleaf-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }

        .storyleaf-card {
            position: relative;
            background: rgba(31, 38, 65, 0.5);
            border: 1px solid rgba(230, 192, 105, 0.08);
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.22, 1, 0.36, 1);
            opacity: 0;
            transform: translateY(30px);
        }

        .storyleaf-card.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .storyleaf-card:hover {
            transform: translateY(-4px);
            border-color: var(--gold-dim);
            box-shadow: 0 0 20px rgba(230, 192, 105, 0.15), 0 0 40px rgba(230, 192, 105, 0.05);
        }

        .storyleaf-card img {
            width: 100%;
            aspect-ratio: 1 / 1;
            object-fit: cover;
            display: block;
            background: var(--bg-mid);
            transition: transform 0.4s ease;
        }

        .storyleaf-card:hover img {
            transform: scale(1.05);
        }

        .storyleaf-card-info {
            padding: 12px 14px;
        }

        .storyleaf-card-caption {
            font-family: var(--font-display);
            font-style: italic;
            font-size: 0.95rem;
            color: var(--gold);
            line-height: 1.3;
            margin-bottom: 4px;
        }

        .storyleaf-card-artist {
            font-family: var(--font-body);
            font-size: 0.72rem;
            color: var(--parchment-dim);
            letter-spacing: 0.03em;
        }

        .storyleaf-more {
            text-align: center;
            margin-top: 32px;
        }

        .storyleaf-more a {
            display: inline-block;
            font-family: var(--font-body);
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--gold-dim);
            text-decoration: none;
            padding: 10px 28px;
            border: 1px solid rgba(230, 192, 105, 0.2);
            border-radius: 6px;
            transition: all 0.3s ease;
            letter-spacing: 0.04em;
        }

        .storyleaf-more a:hover {
            color: var(--gold);
            border-color: var(--gold-dim);
            background: rgba(230, 192, 105, 0.06);
        }

        /* === Lightbox === */
        .lightbox-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.92);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.35s ease;
        }

        .lightbox-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .lightbox-content {
            position: relative;
            max-width: 80vw;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .lightbox-content img {
            max-width: 100%;
            max-height: 70vh;
            border-radius: 8px;
            box-shadow: 0 0 60px rgba(230, 192, 105, 0.12);
            object-fit: contain;
        }

        .lightbox-caption {
            margin-top: 16px;
            text-align: center;
        }

        .lightbox-caption-text {
            font-family: var(--font-display);
            font-style: italic;
            font-size: 1.5rem;
            color: var(--gold);
            margin-bottom: 6px;
        }

        .lightbox-caption-artist {
            font-family: var(--font-body);
            font-size: 0.82rem;
            color: var(--parchment-dim);
        }

        .lightbox-close {
            position: absolute;
            top: -40px;
            right: -10px;
            width: 36px;
            height: 36px;
            background: none;
            border: 1px solid rgba(230, 192, 105, 0.2);
            border-radius: 50%;
            color: var(--parchment);
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .lightbox-close:hover {
            border-color: var(--gold);
            color: var(--gold);
        }

        .lightbox-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 44px;
            height: 44px;
            background: rgba(31, 38, 65, 0.7);
            border: 1px solid rgba(230, 192, 105, 0.15);
            border-radius: 50%;
            color: var(--parchment);
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .lightbox-nav:hover {
            background: rgba(230, 192, 105, 0.15);
            color: var(--gold);
            border-color: var(--gold-dim);
        }

        .lightbox-prev { left: -60px; }
        .lightbox-next { right: -60px; }

        .lightbox-counter {
            font-family: var(--font-body);
            font-size: 0.75rem;
            color: var(--parchment-dim);
            margin-top: 10px;
        }

        /* === Featured Kenning Image === */
        .featured-kenning-image {
            width: 100%;
            max-width: 280px;
            margin-top: 16px;
            border-radius: 8px;
            border: 1px solid rgba(230, 192, 105, 0.12);
            opacity: 0;
            transition: opacity 0.8s ease;
            display: none;
        }

        .featured-kenning-image.visible {
            opacity: 1;
        }

        /* === Reduced Motion === */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                transition-duration: 0.01ms !important;
            }

            #p5-backdrop { display: none; }
            .room-transition { display: none; }

            .hero-title, .hero-subtitle, .featured-kenning, .room-card, .storyleaf-card {
                opacity: 1;
                transform: none;
            }
        }

        /* === Tablet (768-1023px) === */
        @media (max-width: 1023px) {
            :root {
                --nav-width: 60px;
            }

            .exhibition-nav .nav-label { display: none; }
            .exhibition-nav .nav-title { font-size: 0; padding: 15px 0; }
            .exhibition-nav .nav-title::after {
                content: 'KE';
                font-size: 0.9rem;
                display: block;
            }
            .exhibition-nav .nav-link { justify-content: center; padding: 14px 0; }
            .exhibition-nav .nav-icon { font-size: 1.4rem; }
            .exhibition-nav .nav-back { justify-content: center; padding: 14px 0; }

            .hero-title-line1 { font-size: 1.8rem; }
            .hero-title-line2 { font-size: 2.6rem; }

            .rooms-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .storyleaf-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* === Mobile (<768px) === */
        @media (max-width: 767px) {
            :root {
                --nav-width: 0px;
            }

            .exhibition-nav {
                transform: translateX(-100%);
                width: 280px;
            }

            .exhibition-nav .nav-label { display: inline; }
            .exhibition-nav .nav-title { font-size: 1.1rem; padding: 0 20px 25px; }
            .exhibition-nav .nav-title::after { display: none; }
            .exhibition-nav .nav-link { justify-content: flex-start; padding: 12px 20px; }
            .exhibition-nav .nav-icon { font-size: 1.2rem; }
            .exhibition-nav .nav-back { justify-content: flex-start; padding: 12px 20px; }

            .exhibition-nav.open {
                transform: translateX(0);
            }

            .mobile-header {
                display: flex;
            }

            .exhibition-main {
                margin-left: 0;
                padding-top: 56px;
            }

            .hero {
                min-height: calc(100vh - 56px);
                padding: 40px 20px;
            }

            .hero-title-line1 { font-size: 1.4rem; }
            .hero-title-line2 { font-size: 2rem; }
            .hero-subtitle { font-size: 1rem; }

            .kenning { font-size: 1.8rem; }

            .featured-kenning { padding: 25px 20px; }

            .rooms-section { padding: 40px 20px 80px; }

            .rooms-grid {
                grid-template-columns: 1fr;
            }

            .storyleaf-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 14px;
            }

            .storyleaf-section { padding: 40px 20px 60px; }

            .lightbox-prev { left: 8px; }
            .lightbox-next { right: 8px; }
            .lightbox-content { max-width: 95vw; }

            .about-section { padding: 0 20px 60px; }

            .audio-toggle {
                bottom: 20px;
                right: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Persistent Navigation -->
    <nav class="exhibition-nav" id="exhibition-nav" role="navigation" aria-label="Exhibition rooms">
        <div class="nav-title">The Kenning Exhibition</div>
        <div class="nav-rooms">
            <a href="index.html" class="nav-link active" data-room="hall">
                <span class="nav-icon">&#x2302;</span>
                <span class="nav-label">Exhibition Hall</span>
            </a>
            <a href="beowulf.html" class="nav-link" data-room="beowulf">
                <span class="nav-icon">&#x2694;</span>
                <span class="nav-label">Beowulf Room</span>
            </a>
            <a href="prose-edda.html" class="nav-link" data-room="edda">
                <span class="nav-icon">&#x2744;</span>
                <span class="nav-label">Prose Edda</span>
            </a>
            <a href="skaldskaparmal.html" class="nav-link" data-room="skald">
                <span class="nav-icon">&#x270D;</span>
                <span class="nav-label">Skaldskaparmal</span>
            </a>
            <a href="kenning-forge.html" class="nav-link" data-room="forge">
                <span class="nav-icon">&#x2692;</span>
                <span class="nav-label">Kenning Forge</span>
            </a>
            <a href="living-edda.html" class="nav-link" data-room="living">
                <span class="nav-icon">&#x2618;</span>
                <span class="nav-label">Living Edda</span>
            </a>
            <a href="runic-gallery.html" class="nav-link" data-room="runic">
                <span class="nav-icon">&#x25CA;</span>
                <span class="nav-label">Runic Gallery</span>
            </a>
        </div>
        <div class="nav-footer">
            <a href="../index.html" class="nav-back">
                <span class="nav-icon">&#x2190;</span>
                <span class="nav-label">Back to CCAB</span>
            </a>
        </div>
    </nav>

    <!-- Mobile header -->
    <header class="mobile-header" id="mobile-header">
        <button class="hamburger" id="hamburger" aria-label="Open navigation">&#x2630;</button>
        <span class="mobile-title">The Kenning Exhibition</span>
    </header>

    <!-- Mobile overlay -->
    <div class="nav-overlay" id="nav-overlay"></div>

    <!-- Room transition -->
    <div class="room-transition" id="room-transition"></div>

    <!-- p5.js backdrop -->
    <div id="p5-backdrop" aria-hidden="true"></div>

    <!-- Main content -->
    <main class="exhibition-main" role="main">
        <!-- Hero -->
        <section class="hero" aria-label="Exhibition entrance">
            <h1 class="hero-title" id="hero-title">
                <span class="hero-title-line1">The Kenning</span>
                <span class="hero-title-line2">Exhibition</span>
            </h1>
            <p class="hero-subtitle" id="hero-subtitle">Where Ancient Metaphor Meets Generative Art</p>

            <div class="featured-kenning" id="featured-kenning" aria-live="polite">
                <div class="featured-label">Featured Kenning</div>
                <div class="featured-kenning-text" id="featured-text">
                    <div class="kenning-display" id="kenning-display">
                        <div class="kenning" id="kenning-word"></div>
                        <div class="kenning-literal" id="kenning-literal"></div>
                        <div class="kenning-meaning" id="kenning-meaning"></div>
                        <div class="kenning-source" id="kenning-source"></div>
                        <img class="featured-kenning-image" id="featured-kenning-image" alt="" loading="lazy">
                    </div>
                </div>
            </div>

            <div class="scroll-hint" aria-hidden="true">
                <span>Explore the Rooms</span>
                <span class="scroll-hint-arrow">&#x2193;</span>
            </div>
        </section>

        <!-- Rooms -->
        <section class="rooms-section" aria-label="Exhibition rooms">
            <h2 class="rooms-heading">Enter the Exhibition</h2>

            <div class="rooms-tier-label">Source Rooms -- Scholarly Collections</div>
            <div class="rooms-grid" id="source-rooms">
                <a href="beowulf.html" class="room-card" data-room="beowulf" aria-label="Enter the Beowulf Room">
                    <span class="room-card-icon" aria-hidden="true">&#x2694;</span>
                    <div class="room-card-name">The Beowulf Room</div>
                    <p class="room-card-teaser">Kennings from the great Anglo-Saxon epic. Battle-lights, whale-roads, and bone-houses from the oldest English poem.</p>
                    <span class="room-card-enter">Enter Room &#x2192;</span>
                </a>
                <a href="prose-edda.html" class="room-card" data-room="edda" aria-label="Enter the Prose Edda Room">
                    <span class="room-card-icon" aria-hidden="true">&#x2744;</span>
                    <div class="room-card-name">The Prose Edda Room</div>
                    <p class="room-card-teaser">Snorri Sturluson's mythological kennings. Navigate the Nine Worlds through frost-veiled metaphors of gods and giants.</p>
                    <span class="room-card-enter">Enter Room &#x2192;</span>
                </a>
                <a href="skaldskaparmal.html" class="room-card" data-room="skald" aria-label="Enter the Skaldskaparmal Room">
                    <span class="room-card-icon" aria-hidden="true">&#x270D;</span>
                    <div class="room-card-name">The Skaldskaparmal Room</div>
                    <p class="room-card-teaser">The language of poetry itself. A comprehensive catalog of skaldic kennings -- Sif's hair, Frodi's flour, and the mead of Kvasir.</p>
                    <span class="room-card-enter">Enter Room &#x2192;</span>
                </a>
            </div>

            <div class="rooms-tier-label">Experience Rooms -- Interactive &amp; Generative</div>
            <div class="rooms-grid" id="experience-rooms">
                <a href="kenning-forge.html" class="room-card" data-room="forge" aria-label="Enter the Kenning Forge">
                    <span class="room-card-icon" aria-hidden="true">&#x2692;</span>
                    <div class="room-card-name">The Kenning Forge</div>
                    <p class="room-card-teaser">Craft new kennings from ancient patterns. Choose your subject, pick a structure, and forge metaphors from authentic word-banks.</p>
                    <span class="room-card-enter">Enter Room &#x2192;</span>
                </a>
                <a href="living-edda.html" class="room-card" data-room="living" aria-label="Enter the Living Edda">
                    <span class="room-card-icon" aria-hidden="true">&#x2618;</span>
                    <div class="room-card-name">The Living Edda</div>
                    <p class="room-card-teaser">A growing collection of visitor kennings. Contribute your own metaphors and discover what others have created.</p>
                    <span class="room-card-enter">Enter Room &#x2192;</span>
                </a>
                <a href="runic-gallery.html" class="room-card" data-room="runic" aria-label="Enter the Runic Gallery">
                    <span class="room-card-icon" aria-hidden="true">&#x25CA;</span>
                    <div class="room-card-name">The Runic Gallery</div>
                    <p class="room-card-teaser">Generative art from Elder Futhark runes. Interactive pieces that transform ancient symbols into living visual poetry.</p>
                    <span class="room-card-enter">Enter Room &#x2192;</span>
                </a>
            </div>
        </section>

        <!-- StoryLeaf Gallery -->
        <section class="storyleaf-section" aria-label="StoryLeaf kenning art collection">
            <h2 class="storyleaf-heading">From the StoryLeaf Collection</h2>
            <p class="storyleaf-subheading">317 kenning artworks by Lucien &amp; Gabriel and Levon Kelekyan -- from <a href="https://kenning.storyleaf.ai" target="_blank" rel="noopener">kenning.storyleaf.ai</a></p>
            <div class="storyleaf-grid" id="storyleaf-grid" role="list">
                <!-- Populated by JS -->
            </div>
            <div class="storyleaf-more">
                <a href="https://kenning.storyleaf.ai" target="_blank" rel="noopener">View Full Collection &rarr;</a>
            </div>
        </section>

        <!-- Lightbox -->
        <div class="lightbox-overlay" id="lightbox-overlay" role="dialog" aria-modal="true" aria-label="Image viewer">
            <div class="lightbox-content">
                <button class="lightbox-close" id="lightbox-close" aria-label="Close">&times;</button>
                <button class="lightbox-nav lightbox-prev" id="lightbox-prev" aria-label="Previous image">&larr;</button>
                <button class="lightbox-nav lightbox-next" id="lightbox-next" aria-label="Next image">&rarr;</button>
                <img id="lightbox-img" src="" alt="">
                <div class="lightbox-caption">
                    <div class="lightbox-caption-text" id="lightbox-caption-text"></div>
                    <div class="lightbox-caption-artist" id="lightbox-caption-artist"></div>
                </div>
                <div class="lightbox-counter" id="lightbox-counter"></div>
            </div>
        </div>

        <!-- About -->
        <section class="about-section" aria-label="About the exhibition">
            <p class="about-text">
                A kenning is a compound metaphor -- two nouns that name a third, unspoken thing.
                The Old Norse poets called the sea a <em>whale-road</em>, the body a <em>bone-house</em>,
                and gold the <em>tears of Freyja</em>. This exhibition brings their art to life.
            </p>
        </section>
    </main>

    <!-- Audio Toggle -->
    <button class="audio-toggle muted" id="audio-toggle" aria-label="Toggle ambient sound" title="Toggle ambient sound">
        <span id="audio-icon">&#x1F507;</span>
    </button>

    <!-- p5.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>

    <!-- StoryLeaf image data -->
    <script src="kenning-images-data.js"></script>

    <script>
    /* ===== Featured Kenning Rotation ===== */
    const featuredKennings = [
        { kenning: "hron-rad", literal: "whale-road", meaning: "the sea", source: "Beowulf, line 10" },
        { kenning: "ban-hus", literal: "bone-house", meaning: "the body", source: "Beowulf, line 2508" },
        { kenning: "beag-gyfa", literal: "ring-giver", meaning: "king / lord", source: "Beowulf, line 1102" },
        { kenning: "heofon-candel", literal: "heaven-candle", meaning: "the sun", source: "Beowulf" },
        { kenning: "word-hord", literal: "word-hoard", meaning: "vocabulary / speech", source: "Beowulf" },
        { kenning: "beado-leoma", literal: "battle-light", meaning: "a sword", source: "Beowulf, line 1523" },
        { kenning: "freoðu-webbe", literal: "peace-weaver", meaning: "a queen / noblewoman", source: "Beowulf" },
        { kenning: "breost-hord", literal: "breast-hoard", meaning: "the heart / mind", source: "Beowulf, line 2792" },
        { kenning: "har Sifjar", literal: "hair of Sif", meaning: "gold", source: "Skaldskaparmal" },
        { kenning: "tar Freyju", literal: "tears of Freyja", meaning: "gold", source: "Skaldskaparmal" },
        { kenning: "dreyri Kvasis", literal: "blood of Kvasir", meaning: "poetry / mead", source: "Skaldskaparmal" },
        { kenning: "blod Ymis", literal: "blood of Ymir", meaning: "the sea", source: "Skaldskaparmal" },
        { kenning: "haus Ymis", literal: "skull of Ymir", meaning: "the sky", source: "Skaldskaparmal" },
        { kenning: "stormr swerda", literal: "storm of swords", meaning: "battle", source: "Skaldskaparmal" },
        { kenning: "hestr sjavar", literal: "horse of the sea", meaning: "a ship", source: "Skaldskaparmal" },
        { kenning: "eldr Aegis", literal: "fire of Aegir", meaning: "gold", source: "Skaldskaparmal" },
        { kenning: "Yggdrasill", literal: "Odin's steed", meaning: "the World-Tree", source: "Gylfaginning, Ch. 15" },
        { kenning: "ganotes baeð", literal: "gannet's bath", meaning: "the sea", source: "Beowulf, line 1861" },
        { kenning: "guth-wine", literal: "war-friend", meaning: "a sword", source: "Beowulf, line 1810" },
        { kenning: "sveiti swerda", literal: "sweat of swords", meaning: "blood", source: "Skaldskaparmal" }
    ];

    let currentKenningIndex = 0;
    let kenningInterval = null;

    function showKenning(index) {
        const display = document.getElementById('kenning-display');
        const k = featuredKennings[index];

        display.classList.add('fading');

        setTimeout(() => {
            document.getElementById('kenning-word').textContent = k.kenning;
            document.getElementById('kenning-literal').textContent = k.literal;
            document.getElementById('kenning-meaning').textContent = '= ' + k.meaning;
            document.getElementById('kenning-source').textContent = k.source;
            display.classList.remove('fading');
        }, 800);
    }

    function cycleKenning() {
        currentKenningIndex = (currentKenningIndex + 1) % featuredKennings.length;
        showKenning(currentKenningIndex);
    }

    function startKenningRotation() {
        // Show first immediately (no fade)
        const k = featuredKennings[0];
        document.getElementById('kenning-word').textContent = k.kenning;
        document.getElementById('kenning-literal').textContent = k.literal;
        document.getElementById('kenning-meaning').textContent = '= ' + k.meaning;
        document.getElementById('kenning-source').textContent = k.source;

        // Show matching image for first kenning
        const imgEl = document.getElementById('featured-kenning-image');
        if (imgEl && typeof findMatchingImage === 'function') {
            const matchImg = findMatchingImage(k);
            if (matchImg) {
                imgEl.src = STORYLEAF_IMG_BASE + matchImg.filename;
                imgEl.alt = matchImg.caption;
                imgEl.style.display = 'block';
                setTimeout(() => imgEl.classList.add('visible'), 100);
            }
        }

        kenningInterval = setInterval(cycleKenning, 8000);
    }

    /* ===== Entrance Animations ===== */
    function triggerHeroAnimations() {
        requestAnimationFrame(() => {
            document.getElementById('hero-title').classList.add('visible');
            document.getElementById('hero-subtitle').classList.add('visible');
            document.getElementById('featured-kenning').classList.add('visible');
        });
    }

    /* ===== Scroll-triggered Card Animations ===== */
    function setupScrollAnimations() {
        const cards = document.querySelectorAll('.room-card');
        if (!cards.length) return;

        if ('IntersectionObserver' in window) {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach((entry, i) => {
                    if (entry.isIntersecting) {
                        const card = entry.target;
                        const idx = Array.from(cards).indexOf(card);
                        setTimeout(() => {
                            card.classList.add('visible');
                        }, idx % 3 * 120);
                        observer.unobserve(card);
                    }
                });
            }, { threshold: 0.15 });

            cards.forEach(card => observer.observe(card));
        } else {
            cards.forEach(card => card.classList.add('visible'));
        }
    }

    /* ===== Navigation ===== */
    (function() {
        const nav = document.getElementById('exhibition-nav');
        const hamburger = document.getElementById('hamburger');
        const overlay = document.getElementById('nav-overlay');
        const transition = document.getElementById('room-transition');
        const navLinks = document.querySelectorAll('.nav-link');

        if (hamburger) {
            hamburger.addEventListener('click', () => {
                nav.classList.toggle('open');
                overlay.classList.toggle('visible');
            });
        }

        if (overlay) {
            overlay.addEventListener('click', () => {
                nav.classList.remove('open');
                overlay.classList.remove('visible');
            });
        }

        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                if (link.classList.contains('active')) {
                    e.preventDefault();
                    return;
                }
                e.preventDefault();
                transition.classList.add('active');
                setTimeout(() => {
                    window.location.href = link.href;
                }, 400);
            });
        });

        // Room card transitions
        document.querySelectorAll('.room-card').forEach(card => {
            card.addEventListener('click', (e) => {
                e.preventDefault();
                transition.classList.add('active');
                setTimeout(() => {
                    window.location.href = card.href;
                }, 400);
            });
        });

        // Fade in on page load
        window.addEventListener('load', () => {
            transition.classList.add('active');
            requestAnimationFrame(() => {
                requestAnimationFrame(() => {
                    transition.classList.remove('active');
                });
            });
        });
    })();

    /* ===== Audio: Ambient Drone ===== */
    class RoomAmbience {
        constructor(fundamental, type1, type2, filterFreq) {
            this.ctx = null;
            this.fundamental = fundamental;
            this.type1 = type1;
            this.type2 = type2;
            this.filterFreq = filterFreq;
            this.isPlaying = false;
        }

        init() {
            this.ctx = new (window.AudioContext || window.webkitAudioContext)();
            this.master = this.ctx.createGain();
            this.master.gain.value = 0;
            this.master.connect(this.ctx.destination);

            this.filter = this.ctx.createBiquadFilter();
            this.filter.type = 'lowpass';
            this.filter.frequency.value = this.filterFreq;
            this.filter.Q.value = 1;
            this.filter.connect(this.master);

            this.osc1 = this.ctx.createOscillator();
            this.osc1.type = this.type1;
            this.osc1.frequency.value = this.fundamental;
            this.gain1 = this.ctx.createGain();
            this.gain1.gain.value = 0.3;
            this.osc1.connect(this.gain1);
            this.gain1.connect(this.filter);
            this.osc1.start();

            this.osc2 = this.ctx.createOscillator();
            this.osc2.type = this.type2;
            this.osc2.frequency.value = this.fundamental * 1.5;
            this.gain2 = this.ctx.createGain();
            this.gain2.gain.value = 0.15;
            this.osc2.connect(this.gain2);
            this.gain2.connect(this.filter);
            this.osc2.start();

            this.lfo = this.ctx.createOscillator();
            this.lfo.type = 'sine';
            this.lfo.frequency.value = 0.05;
            this.lfoGain = this.ctx.createGain();
            this.lfoGain.gain.value = this.filterFreq * 0.3;
            this.lfo.connect(this.lfoGain);
            this.lfoGain.connect(this.filter.frequency);
            this.lfo.start();
        }

        fadeIn(duration) {
            duration = duration || 3;
            if (!this.ctx) this.init();
            if (this.ctx.state === 'suspended') this.ctx.resume();
            this.master.gain.cancelScheduledValues(this.ctx.currentTime);
            this.master.gain.setValueAtTime(this.master.gain.value, this.ctx.currentTime);
            this.master.gain.linearRampToValueAtTime(0.12, this.ctx.currentTime + duration);
            this.isPlaying = true;
        }

        fadeOut(duration) {
            duration = duration || 2;
            if (!this.ctx) return;
            this.master.gain.cancelScheduledValues(this.ctx.currentTime);
            this.master.gain.setValueAtTime(this.master.gain.value, this.ctx.currentTime);
            this.master.gain.linearRampToValueAtTime(0, this.ctx.currentTime + duration);
            this.isPlaying = false;
        }

        toggle() {
            this.isPlaying ? this.fadeOut() : this.fadeIn();
        }
    }

    // Exhibition Hall: A2 (110Hz), sine + sine (fifth)
    const ambience = new RoomAmbience(110, 'sine', 'sine', 800);

    (function setupAudioToggle() {
        const btn = document.getElementById('audio-toggle');
        const icon = document.getElementById('audio-icon');
        const pref = localStorage.getItem('exhibition-audio');

        btn.addEventListener('click', () => {
            ambience.toggle();
            if (ambience.isPlaying) {
                btn.classList.remove('muted');
                icon.textContent = '\u{1F50A}';
                localStorage.setItem('exhibition-audio', 'true');
            } else {
                btn.classList.add('muted');
                icon.textContent = '\u{1F507}';
                localStorage.setItem('exhibition-audio', 'false');
            }
        });

        // Restore preference on first interaction
        if (pref === 'true') {
            const startOnGesture = () => {
                ambience.fadeIn();
                btn.classList.remove('muted');
                icon.textContent = '\u{1F50A}';
                document.removeEventListener('click', startOnGesture);
                document.removeEventListener('keydown', startOnGesture);
            };
            document.addEventListener('click', startOnGesture, { once: false });
            document.addEventListener('keydown', startOnGesture, { once: false });
        }
    })();

    /* ===== Track visited rooms ===== */
    (function trackVisit() {
        try {
            let visited = JSON.parse(localStorage.getItem('exhibition-visited') || '[]');
            if (!visited.includes('hall')) {
                visited.push('hall');
                localStorage.setItem('exhibition-visited', JSON.stringify(visited));
            }
        } catch(e) {}
    })();

    /* ===== p5.js Floating Runes Backdrop ===== */
    const runeSketch = (p) => {
        const elderFuthark = [
            '\u16A0','\u16A2','\u16A6','\u16A8','\u16B1','\u16B2','\u16B7','\u16B9',
            '\u16BA','\u16BE','\u16C1','\u16C3','\u16C7','\u16C8','\u16C9','\u16CA',
            '\u16CF','\u16D2','\u16D6','\u16D7','\u16DA','\u16DC','\u16DE','\u16DF'
        ];

        let particles = [];
        const MAX_PARTICLES = 200;

        class RuneParticle {
            constructor() {
                this.reset();
                this.y = p.random(p.height);
            }

            reset() {
                this.x = p.random(p.width);
                this.y = p.height + 20;
                this.rune = elderFuthark[Math.floor(Math.random() * elderFuthark.length)];
                this.speed = p.random(0.3, 1.2);
                this.size = p.random(14, 30);
                this.alpha = p.random(40, 120);
                this.wobble = p.random(0.002, 0.008);
                this.wobbleOffset = p.random(p.TWO_PI);
                this.rotation = p.random(-0.3, 0.3);
                this.rotSpeed = p.random(-0.003, 0.003);
            }

            update() {
                this.y -= this.speed;
                this.x += Math.sin(p.frameCount * this.wobble + this.wobbleOffset) * 0.3;
                this.rotation += this.rotSpeed;

                if (this.y < -40) {
                    this.reset();
                }
            }

            draw() {
                p.push();
                p.translate(this.x, this.y);
                p.rotate(this.rotation);
                p.fill(230, 192, 105, this.alpha);
                p.noStroke();
                p.textSize(this.size);
                p.textAlign(p.CENTER, p.CENTER);
                p.text(this.rune, 0, 0);
                p.pop();
            }
        }

        p.setup = () => {
            const container = document.getElementById('p5-backdrop');
            const cnv = p.createCanvas(container.offsetWidth, container.offsetHeight);
            cnv.parent('p5-backdrop');
            p.frameRate(30);
            p.textFont('serif');

            for (let i = 0; i < MAX_PARTICLES; i++) {
                const rp = new RuneParticle();
                rp.y = p.random(p.height);
                particles.push(rp);
            }
        };

        p.draw = () => {
            p.clear();

            for (let i = 0; i < particles.length; i++) {
                particles[i].update();
                particles[i].draw();
            }
        };

        p.windowResized = () => {
            const container = document.getElementById('p5-backdrop');
            if (container) {
                p.resizeCanvas(container.offsetWidth, container.offsetHeight);
            }
        };
    };

    // Only create p5 if not reduced motion
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    if (!prefersReducedMotion) {
        new p5(runeSketch);
    }

    /* ===== StoryLeaf Gallery ===== */
    const STORYLEAF_IMG_BASE = 'https://kenning.storyleaf.ai/img/';
    const GALLERY_COUNT = 16;
    let galleryImages = [];
    let lightboxIndex = 0;

    function shuffleArray(arr) {
        const a = arr.slice();
        for (let i = a.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
    }

    function initGallery() {
        if (typeof kenningImagesData === 'undefined') return;

        // Pick a diverse random subset
        const shuffled = shuffleArray(kenningImagesData);
        // Prefer unique captions for variety
        const seen = new Set();
        const picks = [];
        for (const img of shuffled) {
            if (picks.length >= GALLERY_COUNT) break;
            if (!seen.has(img.caption)) {
                seen.add(img.caption);
                picks.push(img);
            }
        }
        // Fill up if needed
        for (const img of shuffled) {
            if (picks.length >= GALLERY_COUNT) break;
            if (!picks.includes(img)) picks.push(img);
        }

        galleryImages = picks;
        const grid = document.getElementById('storyleaf-grid');

        picks.forEach((img, i) => {
            const card = document.createElement('div');
            card.className = 'storyleaf-card';
            card.setAttribute('role', 'listitem');
            card.setAttribute('tabindex', '0');
            card.innerHTML =
                '<img src="' + STORYLEAF_IMG_BASE + img.filename + '" alt="' + img.caption.replace(/"/g, '&quot;') + '" loading="lazy">' +
                '<div class="storyleaf-card-info">' +
                    '<div class="storyleaf-card-caption">' + img.caption + '</div>' +
                    '<div class="storyleaf-card-artist">' + img.artist + '</div>' +
                '</div>';

            card.addEventListener('click', () => openLightbox(i));
            card.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    openLightbox(i);
                }
            });

            grid.appendChild(card);
        });

        // Scroll-reveal gallery cards
        const cards = grid.querySelectorAll('.storyleaf-card');
        if ('IntersectionObserver' in window) {
            const obs = new IntersectionObserver((entries) => {
                entries.forEach((entry) => {
                    if (entry.isIntersecting) {
                        const card = entry.target;
                        const idx = Array.from(cards).indexOf(card);
                        setTimeout(() => card.classList.add('visible'), (idx % 4) * 80);
                        obs.unobserve(card);
                    }
                });
            }, { threshold: 0.1 });
            cards.forEach(c => obs.observe(c));
        } else {
            cards.forEach(c => c.classList.add('visible'));
        }
    }

    /* ===== Lightbox ===== */
    function openLightbox(index) {
        lightboxIndex = index;
        updateLightbox();
        document.getElementById('lightbox-overlay').classList.add('active');
        document.body.style.overflow = 'hidden';
    }

    function closeLightbox() {
        document.getElementById('lightbox-overlay').classList.remove('active');
        document.body.style.overflow = '';
    }

    function updateLightbox() {
        const img = galleryImages[lightboxIndex];
        document.getElementById('lightbox-img').src = STORYLEAF_IMG_BASE + img.filename;
        document.getElementById('lightbox-img').alt = img.caption;
        document.getElementById('lightbox-caption-text').textContent = img.caption;
        document.getElementById('lightbox-caption-artist').textContent = img.artist;
        document.getElementById('lightbox-counter').textContent = (lightboxIndex + 1) + ' / ' + galleryImages.length;
    }

    function lightboxPrev() {
        lightboxIndex = (lightboxIndex - 1 + galleryImages.length) % galleryImages.length;
        updateLightbox();
    }

    function lightboxNext() {
        lightboxIndex = (lightboxIndex + 1) % galleryImages.length;
        updateLightbox();
    }

    (function setupLightbox() {
        document.getElementById('lightbox-close').addEventListener('click', closeLightbox);
        document.getElementById('lightbox-prev').addEventListener('click', lightboxPrev);
        document.getElementById('lightbox-next').addEventListener('click', lightboxNext);

        document.getElementById('lightbox-overlay').addEventListener('click', (e) => {
            if (e.target === document.getElementById('lightbox-overlay')) closeLightbox();
        });

        document.addEventListener('keydown', (e) => {
            if (!document.getElementById('lightbox-overlay').classList.contains('active')) return;
            if (e.key === 'Escape') closeLightbox();
            if (e.key === 'ArrowLeft') lightboxPrev();
            if (e.key === 'ArrowRight') lightboxNext();
        });

        // Touch/swipe support
        let touchStartX = 0;
        const overlay = document.getElementById('lightbox-overlay');
        overlay.addEventListener('touchstart', (e) => {
            touchStartX = e.changedTouches[0].screenX;
        }, { passive: true });
        overlay.addEventListener('touchend', (e) => {
            const diff = e.changedTouches[0].screenX - touchStartX;
            if (Math.abs(diff) > 50) {
                diff > 0 ? lightboxPrev() : lightboxNext();
            }
        }, { passive: true });
    })();

    /* ===== Featured Kenning Image Matching ===== */
    // Map featured kennings to matching images from the data
    const kenningImageMap = {};

    function buildKenningImageMap() {
        if (typeof kenningImagesData === 'undefined') return;
        kenningImagesData.forEach((img) => {
            // Normalize caption for matching: lowercase, strip possessives
            const key = img.caption.toLowerCase().trim();
            if (!kenningImageMap[key]) {
                kenningImageMap[key] = img;
            }
        });
    }

    function findMatchingImage(kenningObj) {
        // Try to match featured kenning's literal/meaning to image captions
        const literal = (kenningObj.literal || '').toLowerCase();
        const meaning = (kenningObj.meaning || '').toLowerCase();

        // Build candidate search terms
        const candidates = [];

        // "tears of Freyja" -> "Gold is Freyjas Tears"
        // "blood of Kvasir" -> look for Kvasir
        // "whale-road" -> look for sea, ocean
        // Map kenning meanings to possible caption subjects
        const meaningToSubject = {
            'the sea': ['ocean', 'sea', 'whale'],
            'the body': ['body', 'bone'],
            'king / lord': ['king', 'court', 'power'],
            'the sun': ['sun', 'dawn'],
            'vocabulary / speech': ['word', 'book'],
            'a sword': ['sword', 'battle'],
            'a queen / noblewoman': ['peace'],
            'the heart / mind': ['mind', 'heart'],
            'gold': ['gold', 'freyja'],
            'poetry / mead': ['poetry', 'mead', 'meter'],
            'the sky': ['sky'],
            'battle': ['battle', 'storm', 'chaos'],
            'a ship': ['ship', 'sea'],
            'the world-tree': ['forest', 'roots'],
            'blood': ['blood', 'sorrow']
        };

        const subjects = meaningToSubject[meaning] || [];

        for (const key in kenningImageMap) {
            for (const subj of subjects) {
                if (key.includes(subj)) {
                    return kenningImageMap[key];
                }
            }
            // Also try matching the literal text
            if (literal && key.includes(literal.replace(/-/g, ' '))) {
                return kenningImageMap[key];
            }
        }
        return null;
    }

    // Patch the showKenning function to also show matching images
    const originalShowKenning = showKenning;
    showKenning = function(index) {
        const display = document.getElementById('kenning-display');
        const k = featuredKennings[index];
        const imgEl = document.getElementById('featured-kenning-image');

        display.classList.add('fading');
        imgEl.classList.remove('visible');

        setTimeout(() => {
            document.getElementById('kenning-word').textContent = k.kenning;
            document.getElementById('kenning-literal').textContent = k.literal;
            document.getElementById('kenning-meaning').textContent = '= ' + k.meaning;
            document.getElementById('kenning-source').textContent = k.source;

            // Try to show a matching image
            const matchImg = findMatchingImage(k);
            if (matchImg) {
                imgEl.src = STORYLEAF_IMG_BASE + matchImg.filename;
                imgEl.alt = matchImg.caption;
                imgEl.style.display = 'block';
                // Small delay so the fade looks smooth
                setTimeout(() => imgEl.classList.add('visible'), 50);
            } else {
                imgEl.style.display = 'none';
            }

            display.classList.remove('fading');
        }, 800);
    };

    /* ===== Init ===== */
    window.addEventListener('DOMContentLoaded', () => {
        triggerHeroAnimations();
        setupScrollAnimations();
        buildKenningImageMap();
        startKenningRotation();
        initGallery();
    });

    /* ===== Expose reset for enhance.js ===== */
    window.reset = () => {
        currentKenningIndex = 0;
        showKenning(0);
    };
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
