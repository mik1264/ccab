<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Beowulf Room - The Kenning Exhibition</title>
    <meta name="description" content="Explore 38 kennings from the Anglo-Saxon epic Beowulf, organized by theme. Whale-roads, bone-houses, and ring-givers brought to life.">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>&#x2694;</text></svg>">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,600;0,700;1,400;1,600&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <style>
        /* === SHARED CSS: Reset & Base === */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        :root {
            /* Base palette */
            --bg-deep: #1a1a2e;
            --bg-mid: #16213e;
            --bg-surface: #1f2641;
            --gold: #e6c069;
            --gold-dim: #b8944d;
            --parchment: #d4c5a9;
            --parchment-dim: #9e9279;
            --ink: #0d0d1a;
            --glow: rgba(230, 192, 105, 0.15);

            /* Room accent: Blood Red */
            --accent: #8b2500;
            --accent-glow: rgba(139, 37, 0, 0.12);

            /* Typography */
            --font-display: 'EB Garamond', 'Georgia', serif;
            --font-body: 'Inter', 'Helvetica Neue', sans-serif;

            /* Spacing */
            --nav-width: 260px;
            --transition-room: 0.6s cubic-bezier(0.22, 1, 0.36, 1);
        }

        body {
            font-family: var(--font-body);
            background: var(--bg-deep);
            color: var(--parchment);
            line-height: 1.7;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* === SHARED CSS: Navigation === */
        .exhibition-nav {
            position: fixed;
            top: 0;
            left: 0;
            width: var(--nav-width);
            height: 100vh;
            background: linear-gradient(180deg, var(--ink) 0%, var(--bg-deep) 100%);
            border-right: 1px solid rgba(230, 192, 105, 0.08);
            padding: 30px 0;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            transition: transform 0.4s cubic-bezier(0.22, 1, 0.36, 1);
        }

        .exhibition-nav .nav-title {
            font-family: var(--font-display);
            font-size: 1.1rem;
            color: var(--gold);
            text-align: center;
            padding: 0 20px 25px;
            border-bottom: 1px solid rgba(230, 192, 105, 0.1);
            letter-spacing: 0.05em;
        }

        .exhibition-nav .nav-rooms {
            flex: 1;
            padding: 15px 0;
            overflow-y: auto;
        }

        .exhibition-nav .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: var(--parchment-dim);
            text-decoration: none;
            font-family: var(--font-body);
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .exhibition-nav .nav-link:hover {
            color: var(--gold);
            background: rgba(230, 192, 105, 0.05);
            border-left-color: var(--gold-dim);
        }

        .exhibition-nav .nav-link.active {
            color: var(--gold);
            background: rgba(230, 192, 105, 0.08);
            border-left-color: var(--accent);
        }

        .exhibition-nav .nav-icon {
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }

        .exhibition-nav .nav-footer {
            padding: 15px 0;
            border-top: 1px solid rgba(230, 192, 105, 0.1);
        }

        .exhibition-nav .nav-back {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: var(--parchment-dim);
            text-decoration: none;
            font-family: var(--font-body);
            font-size: 0.85rem;
            font-weight: 400;
            transition: all 0.3s ease;
        }

        .exhibition-nav .nav-back:hover {
            color: var(--gold);
        }

        /* === SHARED CSS: Main Content === */
        .exhibition-main {
            margin-left: var(--nav-width);
            min-height: 100vh;
            position: relative;
        }

        /* === SHARED CSS: Room Transition === */
        .room-transition {
            position: fixed;
            inset: 0;
            background: var(--ink);
            z-index: 9999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
        }

        .room-transition.active {
            opacity: 1;
            pointer-events: all;
        }

        /* === SHARED CSS: Audio Toggle === */
        .audio-toggle {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--bg-surface);
            border: 1px solid rgba(230, 192, 105, 0.15);
            color: var(--gold);
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .audio-toggle:hover {
            background: rgba(230, 192, 105, 0.15);
            transform: scale(1.1);
        }

        .audio-toggle.muted {
            color: var(--parchment-dim);
        }

        /* === SHARED CSS: p5.js Backdrop === */
        #p5-backdrop {
            position: fixed;
            top: 0;
            left: var(--nav-width);
            right: 0;
            bottom: 0;
            z-index: 0;
            opacity: 0.35;
            pointer-events: none;
        }

        #p5-backdrop canvas {
            display: block;
            width: 100% !important;
            height: 100% !important;
        }

        /* === SHARED CSS: Scrollbar === */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-deep);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gold-dim);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--gold);
        }

        /* === SHARED CSS: Mobile Header === */
        .mobile-header {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 56px;
            background: var(--ink);
            border-bottom: 1px solid rgba(230, 192, 105, 0.1);
            align-items: center;
            padding: 0 16px;
            z-index: 999;
        }

        .hamburger {
            width: 40px;
            height: 40px;
            background: none;
            border: none;
            color: var(--gold);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .mobile-title {
            font-family: var(--font-display);
            color: var(--gold);
            font-size: 1rem;
            margin-left: 12px;
        }

        .nav-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 998;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .nav-overlay.visible {
            opacity: 1;
            pointer-events: all;
        }

        /* === SHARED CSS: Focus & Accessibility === */
        :focus-visible {
            outline: 2px solid var(--gold);
            outline-offset: 2px;
        }

        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                transition-duration: 0.01ms !important;
            }
            #p5-backdrop { display: none; }
            .room-transition { display: none; }
            .kenning-card { opacity: 1 !important; transform: none !important; }
        }

        /* ============================================ */
        /* === BEOWULF ROOM: Page-Specific Styles === */
        /* ============================================ */

        .room-content {
            position: relative;
            z-index: 1;
            padding: 60px 50px 100px;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Room Header */
        .room-header {
            text-align: center;
            margin-bottom: 50px;
            padding-bottom: 40px;
            border-bottom: 1px solid rgba(139, 37, 0, 0.3);
        }

        .room-header h1 {
            font-family: var(--font-display);
            font-size: 2.4rem;
            font-weight: 600;
            color: var(--gold);
            margin-bottom: 8px;
            letter-spacing: 0.04em;
        }

        .room-header .room-subtitle {
            font-family: var(--font-display);
            font-size: 1.1rem;
            font-style: italic;
            color: var(--parchment-dim);
            letter-spacing: 0.02em;
        }

        .room-header .room-count {
            display: inline-block;
            margin-top: 16px;
            font-family: var(--font-body);
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--parchment-dim);
            text-transform: uppercase;
            letter-spacing: 0.12em;
            padding: 4px 16px;
            border: 1px solid rgba(139, 37, 0, 0.3);
            border-radius: 20px;
        }

        /* Featured Kenning Spotlight */
        .spotlight {
            background: linear-gradient(135deg, rgba(139, 37, 0, 0.12), rgba(31, 38, 65, 0.6));
            border: 1px solid rgba(139, 37, 0, 0.25);
            border-radius: 16px;
            padding: 40px;
            text-align: center;
            margin-bottom: 50px;
            position: relative;
            overflow: hidden;
        }

        .spotlight::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent), transparent);
        }

        .spotlight-label {
            font-family: var(--font-body);
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--accent);
            margin-bottom: 20px;
        }

        .spotlight-kenning {
            font-family: var(--font-display);
            font-size: 3.2rem;
            font-weight: 700;
            font-style: italic;
            color: var(--gold);
            letter-spacing: 0.02em;
            margin-bottom: 8px;
            transition: opacity 0.6s ease;
        }

        .spotlight-literal {
            font-family: var(--font-body);
            font-size: 1rem;
            color: var(--parchment);
            margin-bottom: 4px;
        }

        .spotlight-meaning {
            font-family: var(--font-body);
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--parchment-dim);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .spotlight-source {
            font-family: var(--font-body);
            font-size: 0.75rem;
            color: var(--parchment-dim);
            margin-top: 12px;
            opacity: 0.7;
        }

        .spotlight-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 20px;
        }

        .spotlight-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--parchment-dim);
            opacity: 0.4;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            padding: 0;
        }

        .spotlight-dot.active {
            opacity: 1;
            background: var(--gold);
            transform: scale(1.3);
        }

        /* Category Filters */
        .filters {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 40px;
        }

        .filter-btn {
            font-family: var(--font-body);
            font-size: 0.8rem;
            font-weight: 500;
            padding: 8px 20px;
            border-radius: 24px;
            border: 1px solid rgba(230, 192, 105, 0.2);
            background: rgba(31, 38, 65, 0.5);
            color: var(--parchment-dim);
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 0.03em;
        }

        .filter-btn:hover {
            color: var(--gold);
            border-color: var(--gold-dim);
            background: rgba(230, 192, 105, 0.08);
        }

        .filter-btn.active {
            color: #fff;
            background: var(--accent);
            border-color: var(--accent);
        }

        .filter-btn .filter-count {
            font-size: 0.7rem;
            margin-left: 6px;
            opacity: 0.7;
        }

        /* Kenning Cards Grid */
        .kenning-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 24px;
        }

        /* Category Section Headers */
        .category-header {
            grid-column: 1 / -1;
            padding: 16px 0 8px;
            border-bottom: 1px solid rgba(139, 37, 0, 0.2);
            margin-top: 16px;
        }

        .category-header:first-child {
            margin-top: 0;
        }

        .category-header h2 {
            font-family: var(--font-display);
            font-size: 1.6rem;
            font-weight: 600;
            color: var(--gold);
            letter-spacing: 0.02em;
        }

        .category-header .cat-count {
            font-family: var(--font-body);
            font-size: 0.75rem;
            color: var(--parchment-dim);
            margin-top: 2px;
        }

        /* Kenning Card */
        .kenning-card {
            background: rgba(31, 38, 65, 0.6);
            border: 1px solid rgba(230, 192, 105, 0.08);
            border-radius: 12px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(20px);
            position: relative;
            overflow: hidden;
        }

        .kenning-card.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .kenning-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            background: var(--accent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .kenning-card:hover {
            border-color: rgba(139, 37, 0, 0.4);
            background: rgba(31, 38, 65, 0.8);
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .kenning-card:hover::before {
            opacity: 1;
        }

        .kenning-card.expanded {
            border-color: rgba(139, 37, 0, 0.5);
            background: rgba(31, 38, 65, 0.9);
        }

        .kenning-card.expanded::before {
            opacity: 1;
        }

        .kenning-card.hidden-by-filter {
            display: none;
        }

        .card-oe {
            font-family: var(--font-display);
            font-size: 1.3rem;
            font-weight: 600;
            font-style: italic;
            color: var(--gold);
            letter-spacing: 0.02em;
            margin-bottom: 6px;
        }

        .card-literal {
            font-family: var(--font-body);
            font-size: 0.95rem;
            color: var(--parchment);
            margin-bottom: 4px;
        }

        .card-meaning {
            font-family: var(--font-body);
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--parchment-dim);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 10px;
        }

        .card-source {
            font-family: var(--font-body);
            font-size: 0.75rem;
            color: var(--parchment-dim);
            opacity: 0.6;
        }

        .card-expand-hint {
            font-family: var(--font-body);
            font-size: 0.7rem;
            color: var(--parchment-dim);
            opacity: 0.4;
            margin-top: 10px;
            text-align: right;
            transition: opacity 0.3s ease;
        }

        .kenning-card:hover .card-expand-hint {
            opacity: 0.7;
        }

        .card-logic {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(230, 192, 105, 0.1);
            font-family: var(--font-display);
            font-size: 0.95rem;
            font-style: italic;
            color: var(--parchment);
            line-height: 1.8;
            display: none;
        }

        .card-logic-label {
            font-family: var(--font-body);
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--accent);
            margin-bottom: 6px;
            font-style: normal;
        }

        .kenning-card.expanded .card-logic {
            display: block;
        }

        .kenning-card.expanded .card-expand-hint {
            display: none;
        }

        /* === CATEGORY HEADER IMAGES === */
        .category-banner {
            grid-column: 1 / -1;
            display: flex;
            gap: 16px;
            margin-bottom: 8px;
            overflow: hidden;
            border-radius: 12px;
        }

        .category-banner-img {
            flex: 1;
            position: relative;
            height: 180px;
            overflow: hidden;
            border-radius: 12px;
            cursor: pointer;
            border: 1px solid rgba(139, 37, 0, 0.2);
        }

        .category-banner-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.6s cubic-bezier(0.22, 1, 0.36, 1);
            display: block;
        }

        .category-banner-img:hover img {
            transform: scale(1.05);
        }

        .category-banner-img .banner-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 24px 14px 10px;
            background: linear-gradient(transparent, rgba(0,0,0,0.75));
            font-family: var(--font-display);
            font-size: 0.85rem;
            font-style: italic;
            color: var(--parchment);
            line-height: 1.4;
        }

        .banner-credit {
            display: block;
            font-family: var(--font-body);
            font-size: 0.65rem;
            font-style: normal;
            color: var(--parchment-dim);
            margin-top: 2px;
            opacity: 0.7;
        }

        /* === CARD THUMBNAIL === */
        .card-thumb-wrap {
            float: right;
            width: 80px;
            height: 80px;
            margin: 0 0 8px 14px;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid rgba(139, 37, 0, 0.2);
            cursor: pointer;
            flex-shrink: 0;
        }

        .card-thumb-wrap img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s ease;
            display: block;
        }

        .card-thumb-wrap:hover img {
            transform: scale(1.1);
        }

        /* === LIGHTBOX MODAL === */
        .lightbox-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.92);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.35s ease;
            cursor: zoom-out;
        }

        .lightbox-overlay.open {
            opacity: 1;
            pointer-events: all;
        }

        .lightbox-overlay img {
            max-width: 90vw;
            max-height: 80vh;
            border-radius: 8px;
            box-shadow: 0 12px 60px rgba(0, 0, 0, 0.6);
            transform: scale(0.92);
            transition: transform 0.35s cubic-bezier(0.22, 1, 0.36, 1);
        }

        .lightbox-overlay.open img {
            transform: scale(1);
        }

        .lightbox-caption {
            margin-top: 16px;
            font-family: var(--font-display);
            font-size: 1.1rem;
            font-style: italic;
            color: var(--parchment);
            text-align: center;
            max-width: 600px;
        }

        .lightbox-credit {
            font-family: var(--font-body);
            font-size: 0.75rem;
            font-style: normal;
            color: var(--parchment-dim);
            margin-top: 6px;
        }

        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 24px;
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 50%;
            color: var(--parchment);
            font-size: 1.3rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s ease;
        }

        .lightbox-close:hover {
            background: rgba(255,255,255,0.2);
        }

        /* === RESPONSIVE === */

        /* Tablet */
        @media (max-width: 1023px) {
            :root {
                --nav-width: 60px;
            }

            .exhibition-nav .nav-label { display: none; }
            .exhibition-nav .nav-title { font-size: 0; padding: 15px 0; }
            .exhibition-nav .nav-title::after {
                content: 'KE';
                font-size: 0.9rem;
                display: block;
                color: var(--gold);
                font-family: var(--font-display);
            }
            .exhibition-nav .nav-link { justify-content: center; padding: 14px 0; }
            .exhibition-nav .nav-icon { font-size: 1.4rem; }
            .exhibition-nav .nav-footer .nav-back { justify-content: center; }

            .room-content {
                padding: 40px 30px 80px;
            }

            .spotlight-kenning {
                font-size: 2.4rem;
            }

            .category-banner-img {
                height: 150px;
            }
        }

        /* Mobile */
        @media (max-width: 767px) {
            :root {
                --nav-width: 0px;
            }

            .exhibition-nav {
                transform: translateX(-100%);
                width: 280px;
            }

            .exhibition-nav.open {
                transform: translateX(0);
            }

            .mobile-header {
                display: flex;
            }

            .exhibition-main {
                margin-left: 0;
                padding-top: 56px;
            }

            .room-content {
                padding: 30px 16px 80px;
            }

            .room-header h1 {
                font-size: 1.8rem;
            }

            .spotlight {
                padding: 24px 16px;
            }

            .spotlight-kenning {
                font-size: 2rem;
            }

            .kenning-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .filters {
                gap: 6px;
            }

            .filter-btn {
                padding: 6px 14px;
                font-size: 0.75rem;
            }

            .audio-toggle {
                bottom: 16px;
                right: 16px;
            }

            .category-banner {
                flex-direction: column;
                gap: 10px;
            }

            .category-banner-img {
                height: 140px;
            }

            .card-thumb-wrap {
                width: 64px;
                height: 64px;
            }
        }
    </style>
</head>
<body>

    <!-- === SHARED NAV === -->
    <nav class="exhibition-nav" id="exhibition-nav" role="navigation" aria-label="Exhibition rooms">
        <div class="nav-title">The Kenning Exhibition</div>
        <div class="nav-rooms">
            <a href="index.html" class="nav-link" data-room="hall">
                <span class="nav-icon">&#x2302;</span>
                <span class="nav-label">Exhibition Hall</span>
            </a>
            <a href="beowulf.html" class="nav-link active" data-room="beowulf">
                <span class="nav-icon">&#x2694;</span>
                <span class="nav-label">Beowulf Room</span>
            </a>
            <a href="prose-edda.html" class="nav-link" data-room="edda">
                <span class="nav-icon">&#x2744;</span>
                <span class="nav-label">Prose Edda</span>
            </a>
            <a href="skaldskaparmal.html" class="nav-link" data-room="skald">
                <span class="nav-icon">&#x270D;</span>
                <span class="nav-label">Skaldskaparmal</span>
            </a>
            <a href="kenning-forge.html" class="nav-link" data-room="forge">
                <span class="nav-icon">&#x2692;</span>
                <span class="nav-label">Kenning Forge</span>
            </a>
            <a href="living-edda.html" class="nav-link" data-room="living">
                <span class="nav-icon">&#x2618;</span>
                <span class="nav-label">Living Edda</span>
            </a>
            <a href="runic-gallery.html" class="nav-link" data-room="runic">
                <span class="nav-icon">&#x25CA;</span>
                <span class="nav-label">Runic Gallery</span>
            </a>
        </div>
        <div class="nav-footer">
            <a href="../index.html" class="nav-back">
                <span class="nav-icon">&#x2190;</span>
                <span class="nav-label">Back to CCAB</span>
            </a>
        </div>
    </nav>

    <!-- Mobile header -->
    <header class="mobile-header" id="mobile-header">
        <button class="hamburger" id="hamburger" aria-label="Open navigation">&#x2630;</button>
        <span class="mobile-title">The Kenning Exhibition</span>
    </header>

    <!-- Mobile overlay -->
    <div class="nav-overlay" id="nav-overlay"></div>

    <!-- Room transition -->
    <div class="room-transition" id="room-transition"></div>

    <!-- p5.js backdrop -->
    <div id="p5-backdrop" aria-hidden="true"></div>

    <!-- Audio toggle -->
    <button class="audio-toggle muted" id="audio-toggle" aria-label="Toggle ambient sound" title="Toggle ambient sound">
        &#x1F507;
    </button>

    <!-- === MAIN CONTENT === -->
    <main class="exhibition-main" role="main">
        <div class="room-content">

            <!-- Room Header -->
            <header class="room-header">
                <h1>The Beowulf Room</h1>
                <p class="room-subtitle">Kennings from the great Anglo-Saxon epic</p>
                <span class="room-count">38 Kennings &middot; Cotton Vitellius A.xv, c. 1000 CE</span>
            </header>

            <!-- Featured Kenning Spotlight -->
            <section class="spotlight" id="spotlight" aria-label="Featured kenning">
                <div class="spotlight-label">Featured Kenning</div>
                <div class="spotlight-kenning" id="spotlight-kenning"></div>
                <div class="spotlight-literal" id="spotlight-literal"></div>
                <div class="spotlight-meaning" id="spotlight-meaning"></div>
                <div class="spotlight-source" id="spotlight-source"></div>
                <div class="spotlight-dots" id="spotlight-dots" role="tablist" aria-label="Featured kennings"></div>
            </section>

            <!-- Category Filters -->
            <nav class="filters" id="filters" aria-label="Filter kennings by category">
            </nav>

            <!-- Kenning Cards Grid -->
            <section class="kenning-grid" id="kenning-grid" aria-label="Beowulf kennings">
            </section>

        </div>
    </main>

    <!-- Lightbox Modal -->
    <div class="lightbox-overlay" id="lightbox" role="dialog" aria-modal="true" aria-label="Image viewer">
        <button class="lightbox-close" id="lightbox-close" aria-label="Close image viewer">&times;</button>
        <img id="lightbox-img" src="" alt="" />
        <div class="lightbox-caption" id="lightbox-caption"></div>
        <div class="lightbox-credit" id="lightbox-credit"></div>
    </div>

    <!-- p5.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>

    <!-- enhance.js -->
    <script src="../assets/js/enhance.js" defer></script>

    <script>
    // =============================================
    // BEOWULF KENNING DATA
    // =============================================
    const kennings = [
        // === The Sea ===
        { kenning: "hron-rad", literal: "whale-road", meaning: "the sea", source: "Beowulf", line: 10, category: "sea", logic: "The sea as a path traversed by whales" },
        { kenning: "swan-rad", literal: "swan-road", meaning: "the sea", source: "Beowulf", line: 200, category: "sea", logic: "The sea as a path where swans glide" },
        { kenning: "segl-rad", literal: "sail-road", meaning: "the sea", source: "Beowulf", line: "1429b", category: "sea", logic: "The sea as a surface for sailing" },
        { kenning: "b\u00e6\u00f0-weg", literal: "bath-way", meaning: "the sea", source: "Andreas", line: "513a", category: "sea", logic: "The sea as a great bathing place" },
        { kenning: "hw\u00e6l-weg", literal: "whale-way", meaning: "the sea", source: "Seafarer", line: "63a", category: "sea", logic: "Variant of whale-road" },
        { kenning: "mere-str\u00e6t", literal: "sea-street", meaning: "the sea", source: "Beowulf", line: 514, category: "sea", logic: "Ocean as a road between lands" },
        { kenning: "ganotes b\u00e6\u00f0", literal: "gannet\u2019s bath", meaning: "the sea", source: "Beowulf", line: 1861, category: "sea", logic: "The sea where seabirds bathe" },
        { kenning: "fisces e\u00f0el", literal: "fish\u2019s homeland", meaning: "the sea", source: "Beowulf", line: 254, category: "sea", logic: "The sea as native country of fish" },

        // === The Body and Death ===
        { kenning: "ban-hus", literal: "bone-house", meaning: "the body", source: "Beowulf", line: "2508, 3147", category: "body", logic: "The body as a house built of bones" },
        { kenning: "ban-fatu", literal: "bone-vessel", meaning: "the body", source: "Beowulf", line: 1116, category: "body", logic: "The body as a container of bones" },
        { kenning: "ban-cofa", literal: "bone-chamber", meaning: "the body", source: "Beowulf", line: 1445, category: "body", logic: "The body as an inner room of bones" },
        { kenning: "breost-hord", literal: "breast-hoard", meaning: "heart / mind", source: "Beowulf", line: 2792, category: "body", logic: "The heart treasured within the chest" },
        { kenning: "ferh-hus", literal: "life-house", meaning: "the body", source: "Beowulf", line: "\u2014", category: "body", logic: "The body as dwelling-place of the soul" },
        { kenning: "lic-hama", literal: "body-covering", meaning: "the body / flesh", source: "Beowulf", line: 1007, category: "body", logic: "The flesh that covers the spirit" },
        { kenning: "sawol-drior", literal: "soul-blood", meaning: "lifeblood", source: "Beowulf", line: "\u2014", category: "body", logic: "Blood as the substance of the soul" },
        { kenning: "sweord-slep", literal: "sword-sleep", meaning: "death", source: "Beowulf", line: "\u2014", category: "body", logic: "Death as an eternal sleep caused by the sword" },
        { kenning: "w\u00e6l-bed", literal: "slaughter-bed", meaning: "deathbed", source: "Beowulf", line: 964, category: "body", logic: "The place of final rest in battle" },
        { kenning: "gu\u00f0-sweord", literal: "war-sweat", meaning: "blood", source: "Beowulf", line: "\u2014", category: "body", logic: "Blood as the perspiration of combat" },

        // === Kings, Lords, and Leaders ===
        { kenning: "beag-gyfa", literal: "ring-giver", meaning: "king / lord", source: "Beowulf", line: 1102, category: "kings", logic: "A lord who distributes treasure-rings" },
        { kenning: "gold-wine", literal: "gold-friend", meaning: "generous lord", source: "Beowulf", line: "1171, 1476", category: "kings", logic: "A lord who is a friend through gold-giving" },
        { kenning: "sinc-gyfa", literal: "treasure-giver", meaning: "king / lord", source: "Beowulf", line: 1012, category: "kings", logic: "A lord who bestows treasure" },
        { kenning: "hord-weard", literal: "hoard-ward", meaning: "king / guardian", source: "Beowulf", line: "1047, 1852", category: "kings", logic: "One who guards the treasure-hoard" },
        { kenning: "folc-cyning", literal: "folk-king", meaning: "king of the people", source: "Beowulf", line: 2733, category: "kings", logic: "A king defined by his people" },
        { kenning: "wig-fruma", literal: "war-chief", meaning: "battle-leader", source: "Beowulf", line: 664, category: "kings", logic: "A leader in the front of battle" },
        { kenning: "helm Scyldinga", literal: "helm of the Scyldings", meaning: "king of the Danes", source: "Beowulf", line: "371, 456", category: "kings", logic: "The king as protector (helm) of his nation" },
        { kenning: "hyrde folces", literal: "shepherd of the people", meaning: "king / lord", source: "Beowulf", line: "610, 2644", category: "kings", logic: "The king as tender of his flock" },

        // === Warriors and Heroes ===
        { kenning: "gu\u00f0-rinc", literal: "war-man", meaning: "warrior", source: "Beowulf", line: "838, 1501", category: "warriors", logic: "A man defined by battle" },
        { kenning: "gar-cene", literal: "spear-bold", meaning: "brave warrior", source: "Beowulf", line: 1958, category: "warriors", logic: "Boldness measured by the spear" },
        { kenning: "rand-wiga", literal: "shield-warrior", meaning: "warrior", source: "Beowulf", line: 1298, category: "warriors", logic: "A warrior defined by his shield" },
        { kenning: "helm-berend", literal: "helmet-bearer", meaning: "warrior", source: "Beowulf", line: "2517, 2642", category: "warriors", logic: "Warriors identified by their war-gear" },
        { kenning: "lind-h\u00e6bbendan", literal: "linden-wood-havers", meaning: "warriors with shields", source: "Beowulf", line: 245, category: "warriors", logic: "Warriors carrying linden-wood shields" },
        { kenning: "\u00e6sc-wiga", literal: "ash-warrior", meaning: "spearman", source: "Beowulf", line: 2042, category: "warriors", logic: "A warrior wielding an ash-wood spear" },

        // === Weapons and Armor ===
        { kenning: "beado-leoma", literal: "battle-light", meaning: "sword", source: "Beowulf", line: 1523, category: "weapons", logic: "A sword gleaming in combat" },
        { kenning: "gu\u00f0-wine", literal: "war-friend", meaning: "sword", source: "Beowulf", line: 1810, category: "weapons", logic: "A sword as a warrior\u2019s trusted companion" },
        { kenning: "hring-m\u00e6l", literal: "ring-marked blade", meaning: "sword", source: "Beowulf", line: 1521, category: "weapons", logic: "A blade with ring-pattern forging" },
        { kenning: "hring-iren", literal: "ring-iron", meaning: "ring-mail shirt", source: "Beowulf", line: 322, category: "weapons", logic: "Chain mail made of interlocking rings" },

        // === Ships and Voyaging ===
        { kenning: "s\u00e6-wudu", literal: "sea-wood", meaning: "ship", source: "Beowulf", line: 226, category: "ships", logic: "A ship as wood upon the sea" },
        { kenning: "y\u00f0-lida", literal: "wave-traverser", meaning: "ship", source: "Beowulf", line: 198, category: "ships", logic: "A ship that crosses the waves" },

        // === Other ===
        { kenning: "word-hord", literal: "word-hoard", meaning: "vocabulary / speech", source: "Beowulf", line: "\u2014", category: "other", logic: "The mind\u2019s treasury of words" },
        { kenning: "heofon-candel", literal: "heaven-candle", meaning: "the sun", source: "Beowulf", line: "\u2014", category: "other", logic: "The sun as a candle lighting the sky" },
        { kenning: "meodu-seld", literal: "mead-hall", meaning: "hall / court", source: "Beowulf", line: "\u2014", category: "other", logic: "The hall where mead is served" },
        { kenning: "feorhcwala", literal: "life-queller", meaning: "murderer / slayer", source: "Beowulf", line: "\u2014", category: "other", logic: "One who extinguishes life" },
        { kenning: "freo\u00f0u-webbe", literal: "peace-weaver", meaning: "queen / noblewoman", source: "Beowulf", line: "\u2014", category: "other", logic: "A woman who weaves peace between clans through marriage" },
    ];

    // Category metadata
    const categories = {
        sea:      { label: "The Sea", icon: "\u2248" },
        body:     { label: "Body & Death", icon: "\u2620" },
        kings:    { label: "Kings & Lords", icon: "\u265A" },
        warriors: { label: "Warriors", icon: "\u2694" },
        weapons:  { label: "Weapons & Armor", icon: "\u2720" },
        ships:    { label: "Ships", icon: "\u26F5" },
        other:    { label: "Other", icon: "\u2726" },
    };

    // Image base URL
    const imgBase = 'https://kenning.storyleaf.ai/img/';
    const imgCredit = 'storyleaf.ai';

    // Category banner images (1-2 per category section header)
    const categoryBanners = {
        sea: [
            { file: 'kenning-0028.png', caption: 'The Ocean is Salt-mother' },
            { file: 'kenning-0138.png', caption: 'The Ocean is Whale-universe' },
        ],
        body: [
            { file: 'kenning-0038.png', caption: 'Breath is Soul-wind' },
            { file: 'kenning-0161.png', caption: 'Smoke is Fire-Ghost' },
        ],
        kings: [
            { file: 'kenning-0244.png', caption: 'The Kings Court is Power-Theater' },
            { file: 'kenning-0249.png', caption: 'The Kings Court is Loyalty-Maze' },
        ],
        warriors: [
            { file: 'kenning-0243.png', caption: 'The Courthouse is Justice-Theater' },
        ],
        weapons: [
            { file: 'kenning-0069.png', caption: 'Lightning is Storm-herald' },
        ],
        ships: [
            { file: 'kenning-0051.png', caption: 'Fog is Ship-hider' },
            { file: 'kenning-0052.png', caption: 'Fog is Vision-thief' },
        ],
        other: [
            { file: 'kenning-0134.png', caption: 'The Ocean is Evolution-birthplace' },
        ],
    };

    // Thumbnail images for select kenning cards (by kenning name)
    const cardThumbnails = {
        'hron-rad':      { file: 'kenning-0136.png', caption: 'The Ocean is Storm-cradle' },
        'ganotes bæð':   { file: 'kenning-0202.png', caption: 'The Sea is Pearl-Hider' },
        'fisces eðel':   { file: 'kenning-0201.png', caption: 'The Sea is Current-Weaver' },
        'mere-stræt':    { file: 'kenning-0137.png', caption: 'The Ocean is Trade-highway' },
        'ban-hus':       { file: 'kenning-0038.png', caption: 'Breath is Soul-wind' },
        'beag-gyfa':     { file: 'kenning-0244.png', caption: 'The Kings Court is Power-Theater' },
        'beado-leoma':   { file: 'kenning-0069.png', caption: 'Lightning is Storm-herald' },
        'sæ-wudu':       { file: 'kenning-0051.png', caption: 'Fog is Ship-hider' },
        'sweord-slep':   { file: 'kenning-0161.png', caption: 'Smoke is Fire-Ghost' },
        'swan-rad':      { file: 'kenning-0144.png', caption: 'The Sea is Storm-nursery' },
    };

    // Featured kennings for the spotlight
    const featured = [
        kennings[0],   // hron-rad
        kennings[8],   // ban-hus
        kennings[18],  // beag-gyfa
        kennings[32],  // beado-leoma
        kennings[38],  // word-hord
    ];

    // =============================================
    // SPOTLIGHT
    // =============================================
    let spotlightIdx = 0;
    let spotlightTimer = null;

    function renderSpotlight(idx) {
        const k = featured[idx];
        const el = document.getElementById('spotlight-kenning');
        el.style.opacity = 0;
        setTimeout(() => {
            el.textContent = '"' + k.kenning + '"';
            document.getElementById('spotlight-literal').textContent = k.literal;
            document.getElementById('spotlight-meaning').textContent = '= ' + k.meaning;
            document.getElementById('spotlight-source').textContent = k.source + (k.line !== '\u2014' ? ', line ' + k.line : '');
            el.style.opacity = 1;
        }, 300);

        document.querySelectorAll('.spotlight-dot').forEach((dot, i) => {
            dot.classList.toggle('active', i === idx);
        });
    }

    function initSpotlight() {
        const dotsEl = document.getElementById('spotlight-dots');
        featured.forEach((_, i) => {
            const dot = document.createElement('button');
            dot.className = 'spotlight-dot' + (i === 0 ? ' active' : '');
            dot.setAttribute('role', 'tab');
            dot.setAttribute('aria-label', 'Featured kenning ' + (i + 1));
            dot.addEventListener('click', () => {
                spotlightIdx = i;
                renderSpotlight(i);
                resetSpotlightTimer();
            });
            dotsEl.appendChild(dot);
        });
        renderSpotlight(0);
        startSpotlightTimer();
    }

    function startSpotlightTimer() {
        spotlightTimer = setInterval(() => {
            spotlightIdx = (spotlightIdx + 1) % featured.length;
            renderSpotlight(spotlightIdx);
        }, 8000);
    }

    function resetSpotlightTimer() {
        clearInterval(spotlightTimer);
        startSpotlightTimer();
    }

    // =============================================
    // FILTERS
    // =============================================
    let activeFilter = 'all';

    function initFilters() {
        const filtersEl = document.getElementById('filters');

        // All button
        const allBtn = document.createElement('button');
        allBtn.className = 'filter-btn active';
        allBtn.setAttribute('aria-pressed', 'true');
        allBtn.innerHTML = 'All <span class="filter-count">(' + kennings.length + ')</span>';
        allBtn.dataset.cat = 'all';
        allBtn.addEventListener('click', () => setFilter('all'));
        filtersEl.appendChild(allBtn);

        // Per-category buttons
        const catOrder = ['sea', 'body', 'kings', 'warriors', 'weapons', 'ships', 'other'];
        catOrder.forEach(cat => {
            const count = kennings.filter(k => k.category === cat).length;
            const btn = document.createElement('button');
            btn.className = 'filter-btn';
            btn.setAttribute('aria-pressed', 'false');
            btn.innerHTML = categories[cat].label + ' <span class="filter-count">(' + count + ')</span>';
            btn.dataset.cat = cat;
            btn.addEventListener('click', () => setFilter(cat));
            filtersEl.appendChild(btn);
        });
    }

    function setFilter(cat) {
        activeFilter = cat;

        // Update button states
        document.querySelectorAll('.filter-btn').forEach(btn => {
            const isActive = btn.dataset.cat === cat;
            btn.classList.toggle('active', isActive);
            btn.setAttribute('aria-pressed', isActive ? 'true' : 'false');
        });

        // Update card visibility
        document.querySelectorAll('.kenning-card').forEach(card => {
            const match = cat === 'all' || card.dataset.category === cat;
            card.classList.toggle('hidden-by-filter', !match);
        });

        // Update category headers and banners visibility
        document.querySelectorAll('.category-header, .category-banner').forEach(el => {
            const eCat = el.dataset.category;
            if (cat === 'all') {
                el.style.display = '';
            } else {
                el.style.display = eCat === cat ? '' : 'none';
            }
        });
    }

    // =============================================
    // KENNING CARDS
    // =============================================
    function initCards() {
        const grid = document.getElementById('kenning-grid');
        const catOrder = ['sea', 'body', 'kings', 'warriors', 'weapons', 'ships', 'other'];

        catOrder.forEach(cat => {
            const catKennings = kennings.filter(k => k.category === cat);
            if (catKennings.length === 0) return;

            // Category header
            const header = document.createElement('div');
            header.className = 'category-header';
            header.dataset.category = cat;
            header.innerHTML = '<h2>' + categories[cat].label + '</h2>' +
                '<div class="cat-count">' + catKennings.length + ' kenning' + (catKennings.length > 1 ? 's' : '') + '</div>';
            grid.appendChild(header);

            // Category banner images
            const banners = categoryBanners[cat];
            if (banners && banners.length > 0) {
                const bannerRow = document.createElement('div');
                bannerRow.className = 'category-banner';
                bannerRow.dataset.category = cat;
                banners.forEach(b => {
                    const wrap = document.createElement('div');
                    wrap.className = 'category-banner-img';
                    wrap.innerHTML =
                        '<img src="' + imgBase + b.file + '" alt="' + b.caption + '" loading="lazy" />' +
                        '<div class="banner-caption">' + b.caption +
                        '<span class="banner-credit">' + imgCredit + '</span></div>';
                    wrap.addEventListener('click', () => openLightbox(imgBase + b.file, b.caption));
                    bannerRow.appendChild(wrap);
                });
                grid.appendChild(bannerRow);
            }

            // Cards
            catKennings.forEach(k => {
                const card = document.createElement('article');
                card.className = 'kenning-card';
                card.dataset.category = k.category;
                card.setAttribute('tabindex', '0');
                card.setAttribute('role', 'button');
                card.setAttribute('aria-expanded', 'false');

                const lineStr = k.line !== '\u2014' ? k.source + ', line ' + k.line : k.source;

                // Check if this card gets a thumbnail
                const thumb = cardThumbnails[k.kenning];
                const thumbHtml = thumb
                    ? '<div class="card-thumb-wrap" data-img="' + imgBase + thumb.file + '" data-caption="' + thumb.caption + '">' +
                      '<img src="' + imgBase + thumb.file + '" alt="' + thumb.caption + '" loading="lazy" /></div>'
                    : '';

                card.innerHTML =
                    thumbHtml +
                    '<div class="card-oe">"' + k.kenning + '"</div>' +
                    '<div class="card-literal">' + k.literal + '</div>' +
                    '<div class="card-meaning">= ' + k.meaning + '</div>' +
                    '<div class="card-source">' + lineStr + '</div>' +
                    '<div class="card-expand-hint">click to expand</div>' +
                    '<div class="card-logic">' +
                        '<div class="card-logic-label">Poetic Logic</div>' +
                        k.logic +
                    '</div>';

                // Thumbnail click opens lightbox (stop propagation so card doesn't toggle)
                const thumbEl = card.querySelector('.card-thumb-wrap');
                if (thumbEl) {
                    thumbEl.addEventListener('click', (e) => {
                        e.stopPropagation();
                        openLightbox(thumbEl.dataset.img, thumbEl.dataset.caption);
                    });
                }

                card.addEventListener('click', () => toggleCard(card));
                card.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        toggleCard(card);
                    }
                });

                grid.appendChild(card);
            });
        });
    }

    function toggleCard(card) {
        const isExpanded = card.classList.toggle('expanded');
        card.setAttribute('aria-expanded', isExpanded ? 'true' : 'false');
    }

    // =============================================
    // SCROLL-TRIGGERED REVEAL (IntersectionObserver)
    // =============================================
    function initScrollReveal() {
        const observer = new IntersectionObserver((entries) => {
            entries.forEach((entry, i) => {
                if (entry.isIntersecting) {
                    const card = entry.target;
                    const staggerDelay = Array.from(document.querySelectorAll('.kenning-card:not(.hidden-by-filter)'))
                        .indexOf(card);
                    setTimeout(() => {
                        card.classList.add('visible');
                    }, Math.min(staggerDelay, 6) * 80);
                    observer.unobserve(card);
                }
            });
        }, {
            threshold: 0.1,
            rootMargin: '0px 0px -40px 0px'
        });

        document.querySelectorAll('.kenning-card').forEach(card => {
            observer.observe(card);
        });
    }

    // =============================================
    // WEB AUDIO: D2 73Hz dark warrior drone
    // =============================================
    class RoomAmbience {
        constructor() {
            this.ctx = null;
            this.isPlaying = false;
        }

        init() {
            this.ctx = new (window.AudioContext || window.webkitAudioContext)();
            this.master = this.ctx.createGain();
            this.master.gain.value = 0;
            this.master.connect(this.ctx.destination);

            // Lowpass filter
            this.filter = this.ctx.createBiquadFilter();
            this.filter.type = 'lowpass';
            this.filter.frequency.value = 400;
            this.filter.Q.value = 1;
            this.filter.connect(this.master);

            // Drone 1: D2 73Hz sawtooth (filtered for darkness)
            this.osc1 = this.ctx.createOscillator();
            this.osc1.type = 'sawtooth';
            this.osc1.frequency.value = 73;
            this.gain1 = this.ctx.createGain();
            this.gain1.gain.value = 0.3;
            this.osc1.connect(this.gain1);
            this.gain1.connect(this.filter);
            this.osc1.start();

            // Drone 2: Perfect fifth sine (109.5Hz)
            this.osc2 = this.ctx.createOscillator();
            this.osc2.type = 'sine';
            this.osc2.frequency.value = 73 * 1.5;
            this.gain2 = this.ctx.createGain();
            this.gain2.gain.value = 0.15;
            this.osc2.connect(this.gain2);
            this.gain2.connect(this.filter);
            this.osc2.start();

            // Slow LFO on filter cutoff
            this.lfo = this.ctx.createOscillator();
            this.lfo.type = 'sine';
            this.lfo.frequency.value = 0.05;
            this.lfoGain = this.ctx.createGain();
            this.lfoGain.gain.value = 120;
            this.lfo.connect(this.lfoGain);
            this.lfoGain.connect(this.filter.frequency);
            this.lfo.start();
        }

        fadeIn(duration) {
            duration = duration || 3;
            if (!this.ctx) this.init();
            if (this.ctx.state === 'suspended') this.ctx.resume();
            this.master.gain.cancelScheduledValues(this.ctx.currentTime);
            this.master.gain.setValueAtTime(this.master.gain.value, this.ctx.currentTime);
            this.master.gain.linearRampToValueAtTime(0.12, this.ctx.currentTime + duration);
            this.isPlaying = true;
        }

        fadeOut(duration) {
            duration = duration || 2;
            if (!this.ctx) return;
            this.master.gain.cancelScheduledValues(this.ctx.currentTime);
            this.master.gain.setValueAtTime(this.master.gain.value, this.ctx.currentTime);
            this.master.gain.linearRampToValueAtTime(0, this.ctx.currentTime + duration);
            this.isPlaying = false;
        }

        toggle() {
            this.isPlaying ? this.fadeOut() : this.fadeIn();
        }
    }

    const ambience = new RoomAmbience();

    function initAudio() {
        const btn = document.getElementById('audio-toggle');
        const stored = localStorage.getItem('exhibition-audio');

        btn.addEventListener('click', () => {
            ambience.toggle();
            btn.classList.toggle('muted', !ambience.isPlaying);
            btn.innerHTML = ambience.isPlaying ? '&#x1F50A;' : '&#x1F507;';
            localStorage.setItem('exhibition-audio', ambience.isPlaying ? 'on' : 'off');
        });

        // Restore preference (still requires gesture, so we just update the icon)
        if (stored === 'on') {
            // Attempt auto-start on first user interaction
            const startOnGesture = () => {
                ambience.fadeIn();
                btn.classList.remove('muted');
                btn.innerHTML = '&#x1F50A;';
                document.removeEventListener('click', startOnGesture);
                document.removeEventListener('keydown', startOnGesture);
            };
            document.addEventListener('click', startOnGesture, { once: false });
            document.addEventListener('keydown', startOnGesture, { once: false });
        }
    }

    // =============================================
    // p5.js BACKDROP: Blood Tide
    // =============================================
    const bloodTide = (p) => {
        const waves = [];
        const maxParticles = 200;
        let w, h;

        p.setup = () => {
            const container = document.getElementById('p5-backdrop');
            w = container.offsetWidth;
            h = container.offsetHeight;
            const cnv = p.createCanvas(w, h);
            cnv.parent('p5-backdrop');
            p.frameRate(30);
            p.noStroke();

            // Initialize wave particles
            for (let i = 0; i < maxParticles; i++) {
                waves.push({
                    x: p.random(w),
                    y: p.random(h),
                    baseY: p.random(h),
                    speed: p.random(0.2, 0.8),
                    size: p.random(2, 6),
                    offset: p.random(1000),
                    amplitude: p.random(30, 80),
                });
            }
        };

        p.draw = () => {
            // Semi-transparent background for trails
            p.background(26, 26, 46, 25);

            const t = p.frameCount * 0.008;

            // Draw horizontal wave bands
            for (let band = 0; band < 5; band++) {
                const bandY = (h * 0.15) + (band * h * 0.18);
                const bandAlpha = p.map(band, 0, 4, 60, 20);

                p.beginShape();
                p.noFill();
                p.stroke(139, 37, 0, bandAlpha);
                p.strokeWeight(1.5);

                for (let x = 0; x <= w; x += 8) {
                    const noiseVal = p.noise(x * 0.003 + band * 0.5, t + band * 0.3);
                    const y = bandY + (noiseVal - 0.5) * 80;
                    p.curveVertex(x, y);
                }
                p.endShape();
            }

            // Draw particles
            p.noStroke();
            for (let i = 0; i < waves.length; i++) {
                const particle = waves[i];
                const nx = p.noise(particle.offset + t, i * 0.1);
                const ny = p.noise(particle.offset + 500 + t * 0.7, i * 0.1);

                particle.x += particle.speed;
                if (particle.x > w + 10) {
                    particle.x = -10;
                    particle.baseY = p.random(h);
                }

                const yOff = (ny - 0.5) * particle.amplitude;
                const drawY = particle.baseY + yOff;

                // Color: mix of deep red and occasional bright crest
                const brightness = nx > 0.7 ? 255 : p.map(nx, 0, 0.7, 80, 180);
                const alpha = p.map(nx, 0.3, 0.8, 20, 80);

                p.fill(brightness, p.map(nx, 0, 1, 20, 60), 0, alpha);
                p.ellipse(particle.x, drawY, particle.size * nx * 2, particle.size * nx);
            }
        };

        p.windowResized = () => {
            const container = document.getElementById('p5-backdrop');
            w = container.offsetWidth;
            h = container.offsetHeight;
            p.resizeCanvas(w, h);
        };
    };

    // Only start p5 if reduced motion is not preferred
    if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
        new p5(bloodTide);
    }

    // =============================================
    // SHARED NAV LOGIC
    // =============================================
    (function() {
        const nav = document.getElementById('exhibition-nav');
        const hamburger = document.getElementById('hamburger');
        const overlay = document.getElementById('nav-overlay');
        const transition = document.getElementById('room-transition');
        const navLinks = document.querySelectorAll('.nav-link');

        // Mobile toggle
        if (hamburger) {
            hamburger.addEventListener('click', () => {
                nav.classList.toggle('open');
                overlay.classList.toggle('visible');
            });
        }

        if (overlay) {
            overlay.addEventListener('click', () => {
                nav.classList.remove('open');
                overlay.classList.remove('visible');
            });
        }

        // Room transitions
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                if (link.classList.contains('active')) {
                    e.preventDefault();
                    return;
                }
                e.preventDefault();
                transition.classList.add('active');
                setTimeout(() => {
                    window.location.href = link.href;
                }, 400);
            });
        });

        // Fade in on page load
        window.addEventListener('load', () => {
            transition.classList.add('active');
            requestAnimationFrame(() => {
                requestAnimationFrame(() => {
                    transition.classList.remove('active');
                });
            });
        });
    })();

    // =============================================
    // TRACK VISITED ROOMS
    // =============================================
    (function() {
        try {
            let visited = JSON.parse(localStorage.getItem('exhibition-visited') || '[]');
            if (!visited.includes('beowulf')) {
                visited.push('beowulf');
                localStorage.setItem('exhibition-visited', JSON.stringify(visited));
            }
        } catch(e) {}
    })();

    // =============================================
    // LIGHTBOX
    // =============================================
    function openLightbox(src, caption) {
        const overlay = document.getElementById('lightbox');
        const img = document.getElementById('lightbox-img');
        const cap = document.getElementById('lightbox-caption');
        const cred = document.getElementById('lightbox-credit');

        img.src = src;
        img.alt = caption;
        cap.textContent = caption;
        cred.textContent = imgCredit;
        overlay.classList.add('open');
        document.body.style.overflow = 'hidden';
    }

    function closeLightbox() {
        const overlay = document.getElementById('lightbox');
        overlay.classList.remove('open');
        document.body.style.overflow = '';
    }

    function initLightbox() {
        const overlay = document.getElementById('lightbox');
        const closeBtn = document.getElementById('lightbox-close');

        closeBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            closeLightbox();
        });

        overlay.addEventListener('click', (e) => {
            // Close if clicking the overlay background, not the image
            if (e.target === overlay) {
                closeLightbox();
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && overlay.classList.contains('open')) {
                closeLightbox();
            }
        });
    }

    // =============================================
    // EXPOSE window.reset FOR enhance.js
    // =============================================
    window.reset = function() {
        closeLightbox();
        setFilter('all');
        spotlightIdx = 0;
        renderSpotlight(0);
        resetSpotlightTimer();
        document.querySelectorAll('.kenning-card.expanded').forEach(c => {
            c.classList.remove('expanded');
            c.setAttribute('aria-expanded', 'false');
        });
        window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    // =============================================
    // INIT
    // =============================================
    document.addEventListener('DOMContentLoaded', () => {
        initSpotlight();
        initFilters();
        initCards();
        initScrollReveal();
        initAudio();
        initLightbox();
    });
    </script>
</body>
</html>
