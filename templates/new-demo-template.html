<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo - CCAB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); min-height: 100vh; font-family: system-ui, sans-serif; color: #e2e8f0; overflow: hidden; }
        .back-link { position: fixed; top: 15px; left: 15px; padding: 10px 18px; background: rgba(0,0,0,0.6); color: #38bdf8; text-decoration: none; border-radius: 8px; font-size: 14px; z-index: 1000; border: 1px solid rgba(56,189,248,0.3); transition: all 0.2s; }
        .back-link:hover { background: rgba(56,189,248,0.2); transform: translateX(-2px); }
        #canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; }
        #panel { position: fixed; right: 0; top: 0; width: 320px; height: 100%; background: rgba(15, 23, 42, 0.95); padding: 70px 20px 20px; border-left: 1px solid rgba(56,189,248,0.2); overflow-y: auto; backdrop-filter: blur(10px); transform: translateX(0); transition: transform 0.3s ease; }
        #panel.collapsed { transform: translateX(320px); }
        .toggle-panel { position: fixed; top: 15px; right: 335px; width: 40px; height: 40px; background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(56,189,248,0.3); border-radius: 8px; color: #38bdf8; cursor: pointer; z-index: 1001; display: flex; align-items: center; justify-content: center; transition: right 0.3s ease; }
        #panel.collapsed + .toggle-panel { right: 15px; }
        
        h1 { font-size: 1.4rem; margin-bottom: 10px; color: #38bdf8; font-weight: 600; }
        .desc { font-size: 0.9rem; line-height: 1.6; color: #94a3b8; margin-bottom: 20px; border-bottom: 1px solid rgba(56,189,248,0.1); padding-bottom: 15px; }
        
        .btn { padding: 10px 16px; background: linear-gradient(135deg, #38bdf8, #2563eb); border: none; color: white; border-radius: 6px; cursor: pointer; font-size: 0.9rem; margin-right: 8px; margin-bottom: 12px; font-weight: 500; transition: opacity 0.2s; }
        .btn:hover { opacity: 0.9; }
        .controls { margin-bottom: 25px; }
        
        .slider-group { margin-bottom: 15px; }
        .slider-group label { display: flex; justify-content: space-between; font-size: 0.85rem; color: #cbd5e1; margin-bottom: 6px; }
        input[type="range"] { width: 100%; height: 6px; -webkit-appearance: none; background: rgba(56,189,248,0.2); border-radius: 3px; outline: none; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 16px; height: 16px; background: #38bdf8; border-radius: 50%; cursor: pointer; border: 2px solid #0f172a; }
        
        .stat-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 20px 0; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; }
        .stat { text-align: center; }
        .stat-value { font-size: 1.2rem; color: #38bdf8; font-weight: 700; font-variant-numeric: tabular-nums; }
        .stat-label { font-size: 0.75rem; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-top: 4px; }
        
        .info-box { background: rgba(56,189,248,0.05); border: 1px solid rgba(56,189,248,0.1); border-radius: 8px; padding: 15px; font-size: 0.85rem; line-height: 1.6; color: #cbd5e1; }
        
        @media (max-width: 600px) {
            #panel { width: 100%; transform: translateY(0); top: auto; bottom: 0; height: 40%; border-left: none; border-top: 1px solid rgba(56,189,248,0.2); }
            #panel.collapsed { transform: translateY(100%); }
            .toggle-panel { top: auto; bottom: 42%; right: 15px; }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back</a>
    <button class="toggle-panel" id="toggleBtn">☰</button>
    <canvas id="canvas"></canvas>
    <div id="panel">
        <h1 id="title">Demo Title</h1>
        <p class="desc" id="description">Demo description goes here.</p>
        
        <div class="controls">
            <button class="btn" id="playBtn">⏸ Pause</button>
            <button class="btn" id="resetBtn">↺ Reset</button>
        </div>
        
        <div id="controls-container">
            <!-- Dynamic controls inserted here -->
        </div>

        <div class="stat-row">
            <div class="stat"><div class="stat-value" id="timeVal">0.0</div><div class="stat-label">Time</div></div>
            <div class="stat"><div class="stat-value" id="fpsVal">60</div><div class="stat-label">FPS</div></div>
        </div>
        
        <div class="info-box" id="infoBox"></div>
    </div>
    
    <!-- Libraries -->
    <script src="../assets/js/three.min.js"></script>
    
    <!-- Main Script -->
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let width, height;
        let animationId;
        let playing = true;
        let time = 0;
        
        // Demo State
        const state = {
            scale: 1.0,
            speed: 1.0
        };

        // Resize Handler
        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
            if(window.resizeDemo) window.resizeDemo(width, height);
        }
        window.addEventListener('resize', resize);
        resize();

        // UI Toggle
        const panel = document.getElementById('panel');
        document.getElementById('toggleBtn').onclick = () => {
            panel.classList.toggle('collapsed');
        };

        // Animation Loop
        let lastTime = 0;
        function loop(timestamp) {
            const dt = (timestamp - lastTime) / 1000;
            lastTime = timestamp;
            
            if (playing && dt < 0.1) {
                time += dt * state.speed;
                if(window.updateDemo) window.updateDemo(dt, time);
            }
            
            // Clear background
            ctx.fillStyle = '#0f172a';
            ctx.fillRect(0, 0, width, height);
            
            if(window.drawDemo) window.drawDemo(ctx, width, height);
            
            // Update Stats
            document.getElementById('timeVal').textContent = time.toFixed(1);
            document.getElementById('fpsVal').textContent = Math.round(1/dt);
            
            animationId = requestAnimationFrame(loop);
        }
        
        // Controls
        document.getElementById('playBtn').onclick = function() {
            playing = !playing;
            this.textContent = playing ? '⏸ Pause' : '▶ Play';
        };
        
        document.getElementById('resetBtn').onclick = function() {
            time = 0;
            if(window.initDemo) window.initDemo();
        };

        // Helper to create sliders
        window.createSlider = function(id, label, min, max, step, value, callback) {
            const container = document.getElementById('controls-container');
            const div = document.createElement('div');
            div.className = 'slider-group';
            div.innerHTML = `
                <label>${label} <span id="${id}-val">${value}</span></label>
                <input type="range" id="${id}" min="${min}" max="${max}" step="${step}" value="${value}">
            `;
            container.appendChild(div);
            
            const input = div.querySelector('input');
            input.oninput = function(e) {
                const v = parseFloat(e.target.value);
                document.getElementById(`${id}-val`).textContent = v;
                state[id] = v;
                if(callback) callback(v);
            };
            state[id] = value;
        };

        // Start
        if(window.initDemo) window.initDemo();
        requestAnimationFrame(loop);
    </script>
</body>
</html>
