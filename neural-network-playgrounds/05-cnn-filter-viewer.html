<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CNN Filter Viewer - Neural Network Playgrounds</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e8e6e1;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .back-link {
            color: #fbbf24;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            transition: transform 0.2s;
        }

        .back-link:hover {
            transform: translateX(-4px);
        }

        h1 {
            font-size: 1.8rem;
            background: linear-gradient(135deg, #f59e0b, #fbbf24);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .panel-title {
            font-size: 1.1rem;
            color: #fbbf24;
            margin-bottom: 15px;
        }

        .image-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 300px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            margin-bottom: 15px;
            overflow: hidden;
        }

        canvas {
            max-width: 100%;
            max-height: 300px;
            image-rendering: pixelated;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .filter-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .filter-card:hover {
            transform: translateY(-2px);
            border-color: rgba(251, 191, 36, 0.3);
        }

        .filter-card.active {
            border-color: #fbbf24;
            background: rgba(251, 191, 36, 0.1);
        }

        .filter-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            text-align: center;
        }

        .filter-preview {
            display: grid;
            gap: 2px;
            margin: 0 auto;
            width: fit-content;
        }

        .filter-cell {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-family: 'Courier New', monospace;
            border-radius: 3px;
        }

        .controls {
            margin-top: 20px;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            color: #9ca3af;
            font-size: 14px;
        }

        select {
            width: 100%;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #e8e6e1;
            font-size: 14px;
        }

        select:focus {
            outline: none;
            border-color: #fbbf24;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            flex: 1;
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 100px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #f59e0b, #fbbf24);
            color: #1a1a2e;
            font-weight: 600;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.4);
        }

        .info-box {
            background: rgba(59, 130, 246, 0.1);
            border-left: 3px solid #3b82f6;
            padding: 12px;
            border-radius: 0 8px 8px 0;
            font-size: 13px;
            line-height: 1.5;
            color: #9ca3af;
            margin-top: 20px;
        }

        .kernel-matrix {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .kernel-matrix-title {
            font-size: 12px;
            color: #9ca3af;
            margin-bottom: 10px;
        }

        .kernel-grid {
            display: grid;
            gap: 4px;
            width: fit-content;
            margin: 0 auto;
        }

        .kernel-cell {
            width: 50px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-family: 'Courier New', monospace;
            border-radius: 4px;
            font-weight: 600;
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-link">
                <span>‚Üê</span> Back to Gallery
            </a>
            <h1>CNN Filter Viewer</h1>
        </header>

        <div class="main-content">
            <div class="panel">
                <h2 class="panel-title">Original Image</h2>
                <div class="image-container">
                    <canvas id="originalCanvas"></canvas>
                </div>
                <div class="controls">
                    <div class="control-group">
                        <label>Select Image</label>
                        <select id="imageSelect">
                            <option value="gradient">Gradient Pattern</option>
                            <option value="checkerboard">Checkerboard</option>
                            <option value="circle">Circle</option>
                            <option value="edges">Edge Pattern</option>
                            <option value="noise">Random Noise</option>
                            <option value="text">Text "AI"</option>
                        </select>
                    </div>
                    <div class="button-group">
                        <button class="btn-primary" id="applyBtn">Apply Filter</button>
                    </div>
                </div>
            </div>

            <div class="panel">
                <h2 class="panel-title">Filtered Result</h2>
                <div class="image-container">
                    <canvas id="filteredCanvas"></canvas>
                </div>
                <div class="kernel-matrix">
                    <div class="kernel-matrix-title">Current Kernel (3x3)</div>
                    <div class="kernel-grid" id="kernelGrid" style="grid-template-columns: repeat(3, 1fr);"></div>
                </div>
            </div>
        </div>

        <div class="panel" style="margin-top: 20px;">
            <h2 class="panel-title">Convolutional Filters</h2>
            <div class="filter-grid" id="filterGrid"></div>
            <div class="info-box">
                <strong>How Convolution Works:</strong> A kernel (filter) slides across the image. At each position, it multiplies overlapping pixels by kernel weights and sums them to produce a single output pixel. Different kernels detect different features like edges, blur, or sharpen.
            </div>
        </div>
    </div>

    <script>
        // Filter definitions
        const filters = [
            {
                name: 'Identity',
                kernel: [
                    [0, 0, 0],
                    [0, 1, 0],
                    [0, 0, 0]
                ],
                description: 'No change'
            },
            {
                name: 'Edge Detect',
                kernel: [
                    [-1, -1, -1],
                    [-1, 8, -1],
                    [-1, -1, -1]
                ],
                description: 'Laplacian edge detection'
            },
            {
                name: 'Sobel X',
                kernel: [
                    [-1, 0, 1],
                    [-2, 0, 2],
                    [-1, 0, 1]
                ],
                description: 'Vertical edge detection'
            },
            {
                name: 'Sobel Y',
                kernel: [
                    [-1, -2, -1],
                    [0, 0, 0],
                    [1, 2, 1]
                ],
                description: 'Horizontal edge detection'
            },
            {
                name: 'Sharpen',
                kernel: [
                    [0, -1, 0],
                    [-1, 5, -1],
                    [0, -1, 0]
                ],
                description: 'Enhance edges'
            },
            {
                name: 'Box Blur',
                kernel: [
                    [1/9, 1/9, 1/9],
                    [1/9, 1/9, 1/9],
                    [1/9, 1/9, 1/9]
                ],
                description: 'Average blur'
            },
            {
                name: 'Gaussian Blur',
                kernel: [
                    [1/16, 2/16, 1/16],
                    [2/16, 4/16, 2/16],
                    [1/16, 2/16, 1/16]
                ],
                description: 'Smooth blur'
            },
            {
                name: 'Emboss',
                kernel: [
                    [-2, -1, 0],
                    [-1, 1, 1],
                    [0, 1, 2]
                ],
                description: '3D emboss effect'
            },
            {
                name: 'Prewitt X',
                kernel: [
                    [-1, 0, 1],
                    [-1, 0, 1],
                    [-1, 0, 1]
                ],
                description: 'Prewitt vertical'
            },
            {
                name: 'Prewitt Y',
                kernel: [
                    [-1, -1, -1],
                    [0, 0, 0],
                    [1, 1, 1]
                ],
                description: 'Prewitt horizontal'
            },
            {
                name: 'Ridge',
                kernel: [
                    [-1, -1, -1],
                    [-1, 4, -1],
                    [-1, -1, -1]
                ],
                description: 'Ridge detection'
            },
            {
                name: 'Outline',
                kernel: [
                    [-1, -1, -1],
                    [-1, 8, -1],
                    [-1, -1, -1]
                ],
                description: 'Strong outline'
            }
        ];

        let currentFilter = 0;
        let imageData = null;

        // Canvas setup
        const originalCanvas = document.getElementById('originalCanvas');
        const filteredCanvas = document.getElementById('filteredCanvas');
        const originalCtx = originalCanvas.getContext('2d');
        const filteredCtx = filteredCanvas.getContext('2d');

        const imgSize = 256;
        originalCanvas.width = imgSize;
        originalCanvas.height = imgSize;
        filteredCanvas.width = imgSize;
        filteredCanvas.height = imgSize;

        // Generate images
        function generateImage(type) {
            originalCtx.fillStyle = '#000';
            originalCtx.fillRect(0, 0, imgSize, imgSize);

            switch (type) {
                case 'gradient':
                    for (let y = 0; y < imgSize; y++) {
                        for (let x = 0; x < imgSize; x++) {
                            const v = Math.floor((x / imgSize) * 255);
                            originalCtx.fillStyle = `rgb(${v}, ${v}, ${v})`;
                            originalCtx.fillRect(x, y, 1, 1);
                        }
                    }
                    break;

                case 'checkerboard':
                    const squareSize = 32;
                    for (let y = 0; y < imgSize; y += squareSize) {
                        for (let x = 0; x < imgSize; x += squareSize) {
                            const isWhite = ((x / squareSize) + (y / squareSize)) % 2 === 0;
                            originalCtx.fillStyle = isWhite ? '#fff' : '#000';
                            originalCtx.fillRect(x, y, squareSize, squareSize);
                        }
                    }
                    break;

                case 'circle':
                    const gradient = originalCtx.createRadialGradient(
                        imgSize/2, imgSize/2, 0,
                        imgSize/2, imgSize/2, imgSize/2
                    );
                    gradient.addColorStop(0, '#fff');
                    gradient.addColorStop(1, '#000');
                    originalCtx.fillStyle = gradient;
                    originalCtx.fillRect(0, 0, imgSize, imgSize);
                    break;

                case 'edges':
                    originalCtx.fillStyle = '#fff';
                    originalCtx.fillRect(50, 50, imgSize - 100, imgSize - 100);
                    originalCtx.fillStyle = '#000';
                    originalCtx.fillRect(80, 80, imgSize - 160, imgSize - 160);
                    originalCtx.fillStyle = '#888';
                    originalCtx.fillRect(110, 110, imgSize - 220, imgSize - 220);
                    break;

                case 'noise':
                    const noiseData = originalCtx.createImageData(imgSize, imgSize);
                    for (let i = 0; i < noiseData.data.length; i += 4) {
                        const v = Math.floor(Math.random() * 256);
                        noiseData.data[i] = v;
                        noiseData.data[i + 1] = v;
                        noiseData.data[i + 2] = v;
                        noiseData.data[i + 3] = 255;
                    }
                    originalCtx.putImageData(noiseData, 0, 0);
                    break;

                case 'text':
                    originalCtx.fillStyle = '#fff';
                    originalCtx.font = 'bold 120px Arial';
                    originalCtx.textAlign = 'center';
                    originalCtx.textBaseline = 'middle';
                    originalCtx.fillText('AI', imgSize/2, imgSize/2);
                    break;
            }

            imageData = originalCtx.getImageData(0, 0, imgSize, imgSize);
            applyFilter();
        }

        // Apply convolution
        function applyFilter() {
            if (!imageData) return;

            const kernel = filters[currentFilter].kernel;
            const kSize = kernel.length;
            const kHalf = Math.floor(kSize / 2);

            const src = imageData.data;
            const output = filteredCtx.createImageData(imgSize, imgSize);
            const dst = output.data;

            for (let y = 0; y < imgSize; y++) {
                for (let x = 0; x < imgSize; x++) {
                    let r = 0, g = 0, b = 0;

                    for (let ky = 0; ky < kSize; ky++) {
                        for (let kx = 0; kx < kSize; kx++) {
                            const px = x + kx - kHalf;
                            const py = y + ky - kHalf;

                            if (px >= 0 && px < imgSize && py >= 0 && py < imgSize) {
                                const idx = (py * imgSize + px) * 4;
                                const weight = kernel[ky][kx];
                                r += src[idx] * weight;
                                g += src[idx + 1] * weight;
                                b += src[idx + 2] * weight;
                            }
                        }
                    }

                    const dstIdx = (y * imgSize + x) * 4;
                    dst[dstIdx] = Math.max(0, Math.min(255, r));
                    dst[dstIdx + 1] = Math.max(0, Math.min(255, g));
                    dst[dstIdx + 2] = Math.max(0, Math.min(255, b));
                    dst[dstIdx + 3] = 255;
                }
            }

            filteredCtx.putImageData(output, 0, 0);
            updateKernelDisplay();
        }

        // Create filter cards
        const filterGrid = document.getElementById('filterGrid');
        filters.forEach((filter, index) => {
            const card = document.createElement('div');
            card.className = 'filter-card' + (index === 0 ? ' active' : '');
            card.innerHTML = `
                <div class="filter-name">${filter.name}</div>
                <div class="filter-preview" style="grid-template-columns: repeat(3, 1fr);">
                    ${filter.kernel.flat().map(v => {
                        const intensity = Math.abs(v);
                        const bg = v > 0 ? `rgba(59, 130, 246, ${Math.min(1, intensity)})` :
                                   v < 0 ? `rgba(239, 68, 68, ${Math.min(1, intensity)})` :
                                   'rgba(255, 255, 255, 0.1)';
                        return `<div class="filter-cell" style="background: ${bg};">${v.toFixed(1)}</div>`;
                    }).join('')}
                </div>
            `;

            card.addEventListener('click', () => {
                document.querySelectorAll('.filter-card').forEach(c => c.classList.remove('active'));
                card.classList.add('active');
                currentFilter = index;
                applyFilter();
            });

            filterGrid.appendChild(card);
        });

        // Update kernel display
        function updateKernelDisplay() {
            const kernelGrid = document.getElementById('kernelGrid');
            const kernel = filters[currentFilter].kernel;

            kernelGrid.innerHTML = kernel.flat().map(v => {
                const intensity = Math.abs(v);
                const bg = v > 0 ? `rgba(59, 130, 246, ${Math.min(1, intensity * 0.5)})` :
                           v < 0 ? `rgba(239, 68, 68, ${Math.min(1, intensity * 0.5)})` :
                           'rgba(255, 255, 255, 0.1)';
                return `<div class="kernel-cell" style="background: ${bg};">${v.toFixed(2)}</div>`;
            }).join('');
        }

        // Event handlers
        document.getElementById('imageSelect').addEventListener('change', (e) => {
            generateImage(e.target.value);
        });

        document.getElementById('applyBtn').addEventListener('click', applyFilter);

        // Initialize
        generateImage('gradient');
    </script>
</body>
</html>
