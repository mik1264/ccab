<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vigenere Cipher Square - Polyalphabetic Encryption - CCAB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            font-family: 'Courier New', monospace;
            color: #e8e8f0;
        }
        .back-link {
            position: fixed; top: 15px; left: 15px;
            padding: 10px 18px; background: rgba(0,0,0,0.6);
            color: #00ff88; text-decoration: none; border-radius: 8px;
            font-size: 14px; z-index: 1000; border: 1px solid rgba(0,255,136,0.3);
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 70px 20px 40px;
        }
        h1 { font-size: 1.8rem; color: #00ff88; margin-bottom: 10px; text-align: center; }
        .desc { text-align: center; color: #888; margin-bottom: 20px; max-width: 700px; margin-left: auto; margin-right: auto; }
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
        }
        .square-container {
            background: rgba(0,0,0,0.6);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(0,255,136,0.2);
            overflow-x: auto;
        }
        #vigenereTable {
            border-collapse: collapse;
            font-size: 11px;
        }
        #vigenereTable td, #vigenereTable th {
            width: 22px; height: 22px;
            text-align: center;
            border: 1px solid rgba(0,255,136,0.1);
            transition: all 0.2s;
        }
        #vigenereTable th {
            background: rgba(0,255,136,0.2);
            color: #00ff88;
            font-weight: bold;
        }
        #vigenereTable td.highlight-row { background: rgba(255,100,100,0.3); }
        #vigenereTable td.highlight-col { background: rgba(100,100,255,0.3); }
        #vigenereTable td.highlight-cell {
            background: #00ff88;
            color: #000;
            font-weight: bold;
            transform: scale(1.3);
            box-shadow: 0 0 20px rgba(0,255,136,0.8);
        }
        .panel {
            background: rgba(0,0,0,0.8);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(0,255,136,0.2);
        }
        .control-group { margin-bottom: 20px; }
        .control-group label { display: block; font-size: 0.8rem; color: #00ff88; margin-bottom: 8px; }
        input[type="text"], textarea {
            width: 100%;
            padding: 12px;
            background: rgba(0,255,136,0.1);
            border: 1px solid rgba(0,255,136,0.3);
            border-radius: 8px;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
        }
        textarea { min-height: 70px; resize: vertical; }
        .output-box {
            background: rgba(0,0,0,0.5);
            border: 1px solid rgba(0,255,136,0.3);
            border-radius: 8px;
            padding: 15px;
            min-height: 70px;
            font-size: 1rem;
            word-break: break-all;
        }
        .key-display {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin: 10px 0;
        }
        .key-char {
            width: 28px; height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,100,100,0.3);
            border-radius: 4px;
            font-weight: bold;
            color: #ff6666;
        }
        .plain-char {
            background: rgba(100,100,255,0.3);
            color: #6666ff;
        }
        .cipher-char {
            background: rgba(0,255,136,0.3);
            color: #00ff88;
        }
        .btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            border: none;
            border-radius: 8px;
            color: #000;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
        }
        .info-box {
            background: rgba(0,255,136,0.1);
            border: 1px solid rgba(0,255,136,0.2);
            border-radius: 8px;
            padding: 12px;
            margin-top: 20px;
            font-size: 0.75rem;
            line-height: 1.5;
            color: #aaa;
        }
        .step-display {
            background: rgba(0,0,0,0.5);
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
            font-size: 0.8rem;
        }
        @media (max-width: 1000px) {
            .main-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back</a>

    <div class="container">
        <h1>Vigenere Cipher Square</h1>
        <p class="desc">A polyalphabetic substitution cipher using a keyword. Each letter of the key determines which Caesar cipher to use for that position.</p>

        <div class="main-grid">
            <div class="square-container">
                <table id="vigenereTable"></table>
            </div>

            <div class="panel">
                <div class="control-group">
                    <label>Keyword</label>
                    <input type="text" id="keyword" value="SECRET" placeholder="Enter keyword...">
                </div>

                <div class="control-group">
                    <label>Plaintext</label>
                    <textarea id="plaintext" placeholder="Enter message...">ATTACK AT DAWN</textarea>
                </div>

                <div class="step-display" id="stepDisplay">
                    <div>Key:  <span class="key-display" id="keyDisplay"></span></div>
                    <div style="margin-top:5px">Plain: <span class="key-display" id="plainDisplay"></span></div>
                    <div style="margin-top:5px">Cipher: <span class="key-display" id="cipherDisplay"></span></div>
                </div>

                <div class="control-group">
                    <label>Ciphertext</label>
                    <div class="output-box" id="ciphertext"></div>
                </div>

                <button class="btn" id="animateBtn">Animate Encryption</button>

                <div class="info-box">
                    <strong>How it works:</strong> The keyword repeats to match the plaintext length. Each plaintext letter finds its row, and the key letter finds the column. The intersection is the ciphertext letter. This was considered unbreakable for 300 years!
                </div>
            </div>
        </div>
    </div>

    <script>
        const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        let animationIndex = -1;
        let animationInterval = null;

        function buildTable() {
            const table = document.getElementById('vigenereTable');
            let html = '<tr><th></th>';
            for (let c of alphabet) html += `<th>${c}</th>`;
            html += '</tr>';

            for (let i = 0; i < 26; i++) {
                html += `<tr><th>${alphabet[i]}</th>`;
                for (let j = 0; j < 26; j++) {
                    const char = alphabet[(i + j) % 26];
                    html += `<td data-row="${i}" data-col="${j}">${char}</td>`;
                }
                html += '</tr>';
            }
            table.innerHTML = html;
        }

        function highlightCell(row, col) {
            // Clear previous highlights
            document.querySelectorAll('#vigenereTable td').forEach(td => {
                td.classList.remove('highlight-row', 'highlight-col', 'highlight-cell');
            });

            if (row < 0 || col < 0) return;

            // Highlight row and column
            document.querySelectorAll(`#vigenereTable td[data-row="${row}"]`).forEach(td => {
                td.classList.add('highlight-row');
            });
            document.querySelectorAll(`#vigenereTable td[data-col="${col}"]`).forEach(td => {
                td.classList.add('highlight-col');
            });

            // Highlight intersection
            const cell = document.querySelector(`#vigenereTable td[data-row="${row}"][data-col="${col}"]`);
            if (cell) cell.classList.add('highlight-cell');
        }

        function encrypt() {
            const keyword = document.getElementById('keyword').value.toUpperCase().replace(/[^A-Z]/g, '');
            const plaintext = document.getElementById('plaintext').value.toUpperCase();

            if (!keyword) {
                document.getElementById('ciphertext').textContent = 'Enter a keyword';
                return '';
            }

            let result = '';
            let keyIndex = 0;

            for (let char of plaintext) {
                const plainIndex = alphabet.indexOf(char);
                if (plainIndex === -1) {
                    result += char;
                } else {
                    const keyChar = keyword[keyIndex % keyword.length];
                    const keyShift = alphabet.indexOf(keyChar);
                    result += alphabet[(plainIndex + keyShift) % 26];
                    keyIndex++;
                }
            }

            document.getElementById('ciphertext').textContent = result;
            return result;
        }

        function updateDisplays(upToIndex = -1) {
            const keyword = document.getElementById('keyword').value.toUpperCase().replace(/[^A-Z]/g, '');
            const plaintext = document.getElementById('plaintext').value.toUpperCase();
            const ciphertext = document.getElementById('ciphertext').textContent;

            let keyHtml = '', plainHtml = '', cipherHtml = '';
            let keyIndex = 0;

            for (let i = 0; i < plaintext.length; i++) {
                const char = plaintext[i];
                const plainIndex = alphabet.indexOf(char);

                if (plainIndex === -1) {
                    plainHtml += `<span class="key-char plain-char">${char}</span>`;
                    cipherHtml += `<span class="key-char cipher-char">${char}</span>`;
                    keyHtml += `<span class="key-char" style="opacity:0.3">-</span>`;
                } else {
                    const keyChar = keyword[keyIndex % keyword.length];
                    const isActive = upToIndex >= 0 && keyIndex === upToIndex;
                    const isEncrypted = upToIndex < 0 || keyIndex <= upToIndex;

                    keyHtml += `<span class="key-char" style="${isActive ? 'transform:scale(1.2);box-shadow:0 0 10px #ff6666' : ''}">${keyChar}</span>`;
                    plainHtml += `<span class="key-char plain-char" style="${isActive ? 'transform:scale(1.2);box-shadow:0 0 10px #6666ff' : ''}">${char}</span>`;

                    if (isEncrypted && ciphertext[i]) {
                        cipherHtml += `<span class="key-char cipher-char" style="${isActive ? 'transform:scale(1.2);box-shadow:0 0 10px #00ff88' : ''}">${ciphertext[i]}</span>`;
                    } else {
                        cipherHtml += `<span class="key-char cipher-char" style="opacity:0.3">?</span>`;
                    }

                    keyIndex++;
                }
            }

            document.getElementById('keyDisplay').innerHTML = keyHtml;
            document.getElementById('plainDisplay').innerHTML = plainHtml;
            document.getElementById('cipherDisplay').innerHTML = cipherHtml;
        }

        function animateEncryption() {
            if (animationInterval) {
                clearInterval(animationInterval);
                animationInterval = null;
                highlightCell(-1, -1);
                updateDisplays(-1);
                document.getElementById('animateBtn').textContent = 'Animate Encryption';
                return;
            }

            const keyword = document.getElementById('keyword').value.toUpperCase().replace(/[^A-Z]/g, '');
            const plaintext = document.getElementById('plaintext').value.toUpperCase();

            if (!keyword) return;

            // First encrypt
            encrypt();

            let keyIndex = 0;
            let charIndex = 0;
            document.getElementById('animateBtn').textContent = 'Stop Animation';

            animationInterval = setInterval(() => {
                // Find next letter
                while (charIndex < plaintext.length && alphabet.indexOf(plaintext[charIndex]) === -1) {
                    charIndex++;
                }

                if (charIndex >= plaintext.length) {
                    clearInterval(animationInterval);
                    animationInterval = null;
                    highlightCell(-1, -1);
                    updateDisplays(-1);
                    document.getElementById('animateBtn').textContent = 'Animate Encryption';
                    return;
                }

                const plainChar = plaintext[charIndex];
                const keyChar = keyword[keyIndex % keyword.length];
                const row = alphabet.indexOf(plainChar);
                const col = alphabet.indexOf(keyChar);

                highlightCell(row, col);
                updateDisplays(keyIndex);

                keyIndex++;
                charIndex++;
            }, 500);
        }

        document.getElementById('keyword').addEventListener('input', () => { encrypt(); updateDisplays(); });
        document.getElementById('plaintext').addEventListener('input', () => { encrypt(); updateDisplays(); });
        document.getElementById('animateBtn').addEventListener('click', animateEncryption);

        buildTable();
        encrypt();
        updateDisplays();
    </script>
</body>
</html>
