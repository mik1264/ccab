<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Langton's Ant Sequencer</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #0f0f0f;
            min-height: 100vh;
            font-family: 'Segoe UI', sans-serif;
            overflow: hidden;
        }
        canvas { display: block; }
        .controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
        }
        button, select {
            background: rgba(255,100,100,0.1);
            border: 1px solid rgba(255,100,100,0.5);
            color: #f88;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
        }
        button:hover, select:hover { background: rgba(255,100,100,0.2); }
        .info {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255,100,100,0.7);
            font-size: 14px;
        }
        .stats {
            position: fixed;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255,255,255,0.5);
            font-size: 12px;
        }
        a.back { position: fixed; top: 20px; left: 20px; color: #f88; text-decoration: none; }
    </style>
</head>
<body>
    <a class="back" href="index.html">← Back</a>
    <div class="info">The ant creates emergent patterns that become music</div>
    <div class="stats" id="stats">Steps: 0</div>
    <canvas id="canvas"></canvas>
    <div class="controls">
        <button id="playBtn">▶ Play</button>
        <button id="resetBtn">Reset</button>
        <select id="speedSelect">
            <option value="1">Slow</option>
            <option value="5" selected>Medium</option>
            <option value="20">Fast</option>
            <option value="50">Very Fast</option>
        </select>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let width = canvas.width = window.innerWidth;
        let height = canvas.height = window.innerHeight;

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        const cellSize = 8;
        let cols, rows;
        let grid = [];
        let ant = { x: 0, y: 0, dir: 0 }; // dir: 0=up, 1=right, 2=down, 3=left
        let isPlaying = false;
        let steps = 0;
        let stepsPerFrame = 5;

        const directions = [
            { dx: 0, dy: -1 }, // up
            { dx: 1, dy: 0 },  // right
            { dx: 0, dy: 1 },  // down
            { dx: -1, dy: 0 }  // left
        ];

        // Notes for each color/state
        const notes = [
            { freq: 261.63, type: 'sine' },
            { freq: 329.63, type: 'triangle' },
            { freq: 392.00, type: 'sine' },
            { freq: 523.25, type: 'square' }
        ];

        // Multi-color variant: LLRR rule
        const rules = ['L', 'L', 'R', 'R'];
        const colors = ['#1a1a1a', '#ff6b6b', '#4ecdc4', '#ffe66d', '#a8e6cf'];

        function init() {
            cols = Math.floor(width / cellSize);
            rows = Math.floor(height / cellSize);
            grid = Array(cols).fill(null).map(() => Array(rows).fill(0));
            ant = {
                x: Math.floor(cols / 2),
                y: Math.floor(rows / 2),
                dir: 0
            };
            steps = 0;
        }

        function step() {
            const { x, y, dir } = ant;
            const currentColor = grid[x][y];

            // Turn based on rule
            const rule = rules[currentColor % rules.length];
            if (rule === 'L') {
                ant.dir = (dir + 3) % 4; // Turn left
            } else {
                ant.dir = (dir + 1) % 4; // Turn right
            }

            // Change color
            grid[x][y] = (currentColor + 1) % rules.length;

            // Play note based on new color and position
            if (steps % 3 === 0) {
                playNote(grid[x][y], x, y);
            }

            // Move forward
            const move = directions[ant.dir];
            ant.x = (x + move.dx + cols) % cols;
            ant.y = (y + move.dy + rows) % rows;

            steps++;
            document.getElementById('stats').textContent = `Steps: ${steps.toLocaleString()}`;
        }

        function playNote(colorIndex, x, y) {
            const note = notes[colorIndex % notes.length];

            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            const filter = audioCtx.createBiquadFilter();

            // Position affects pitch slightly
            const pitchMod = 1 + (x / cols - 0.5) * 0.2;
            osc.frequency.value = note.freq * pitchMod;
            osc.type = note.type;

            filter.type = 'lowpass';
            filter.frequency.value = 1500 + (y / rows) * 1000;

            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.15);

            osc.connect(filter);
            filter.connect(gain);
            gain.connect(audioCtx.destination);

            osc.start();
            osc.stop(audioCtx.currentTime + 0.15);
        }

        function draw() {
            // Semi-transparent for trail effect
            ctx.fillStyle = 'rgba(15, 15, 15, 0.05)';
            ctx.fillRect(0, 0, width, height);

            // Draw changed cells
            for (let x = 0; x < cols; x++) {
                for (let y = 0; y < rows; y++) {
                    if (grid[x][y] > 0) {
                        const hue = grid[x][y] * 90;
                        ctx.fillStyle = `hsl(${hue}, 70%, 50%)`;
                        ctx.fillRect(x * cellSize, y * cellSize, cellSize - 1, cellSize - 1);
                    }
                }
            }

            // Draw ant
            ctx.fillStyle = '#fff';
            ctx.shadowColor = '#fff';
            ctx.shadowBlur = 10;
            ctx.beginPath();
            ctx.arc(
                ant.x * cellSize + cellSize / 2,
                ant.y * cellSize + cellSize / 2,
                cellSize / 2,
                0, Math.PI * 2
            );
            ctx.fill();
            ctx.shadowBlur = 0;

            // Draw direction indicator
            const dirX = ant.x * cellSize + cellSize / 2 + directions[ant.dir].dx * cellSize;
            const dirY = ant.y * cellSize + cellSize / 2 + directions[ant.dir].dy * cellSize;
            ctx.beginPath();
            ctx.moveTo(ant.x * cellSize + cellSize / 2, ant.y * cellSize + cellSize / 2);
            ctx.lineTo(dirX, dirY);
            ctx.strokeStyle = 'rgba(255,255,255,0.5)';
            ctx.lineWidth = 2;
            ctx.stroke();

            if (isPlaying) {
                for (let i = 0; i < stepsPerFrame; i++) {
                    step();
                }
            }

            requestAnimationFrame(draw);
        }

        document.getElementById('playBtn').addEventListener('click', function() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            isPlaying = !isPlaying;
            this.textContent = isPlaying ? '⏸ Pause' : '▶ Play';
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            init();
            ctx.fillStyle = '#0f0f0f';
            ctx.fillRect(0, 0, width, height);
        });

        document.getElementById('speedSelect').addEventListener('change', function() {
            stepsPerFrame = parseInt(this.value);
        });

        window.addEventListener('resize', () => {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            init();
        });

        init();
        draw();
    </script>
</body>
</html>
