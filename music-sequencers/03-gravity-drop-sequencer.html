<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gravity Drop Sequencer</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: linear-gradient(180deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', sans-serif;
            overflow: hidden;
        }
        canvas { display: block; }
        .controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
        }
        button {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
        }
        button:hover { background: rgba(255,255,255,0.2); }
        .info {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255,255,255,0.7);
            font-size: 14px;
        }
        a.back { position: fixed; top: 20px; left: 20px; color: #8af; text-decoration: none; }
    </style>
</head>
<body>
    <a class="back" href="index.html">← Back</a>
    <div class="info">Click to drop balls • They trigger notes when landing on platforms</div>
    <canvas id="canvas"></canvas>
    <div class="controls">
        <button id="gravityBtn">Gravity: Normal</button>
        <button id="clearBtn">Clear Balls</button>
        <button id="rainBtn">Ball Rain</button>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let width = canvas.width = window.innerWidth;
        let height = canvas.height = window.innerHeight;

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        let gravity = 0.3;
        const balls = [];
        const platforms = [];
        const splashes = [];

        // Musical scale (C major pentatonic across 2 octaves)
        const notes = [261.63, 293.66, 329.63, 392.00, 440.00, 523.25, 587.33, 659.25, 783.99, 880.00];

        // Create platforms (piano-like arrangement)
        function initPlatforms() {
            platforms.length = 0;
            const platformWidth = width / 12;
            for (let i = 0; i < 10; i++) {
                const x = (i + 1) * platformWidth;
                const y = height - 100 - (i % 3) * 50;
                platforms.push({
                    x: x - platformWidth / 2,
                    y: y,
                    width: platformWidth - 10,
                    height: 15,
                    note: notes[i],
                    hue: i * 36,
                    glow: 0
                });
            }
        }

        function playNote(platform) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();

            osc.type = 'sine';
            osc.frequency.value = platform.note;

            // Add harmonics
            const osc2 = audioCtx.createOscillator();
            osc2.type = 'triangle';
            osc2.frequency.value = platform.note * 2;
            const gain2 = audioCtx.createGain();
            gain2.gain.value = 0.1;

            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.8);

            osc.connect(gain);
            osc2.connect(gain2);
            gain2.connect(gain);
            gain.connect(audioCtx.destination);

            osc.start();
            osc2.start();
            osc.stop(audioCtx.currentTime + 0.8);
            osc2.stop(audioCtx.currentTime + 0.8);

            platform.glow = 1;
        }

        function createBall(x, y) {
            balls.push({
                x, y,
                vx: (Math.random() - 0.5) * 2,
                vy: 0,
                radius: 8 + Math.random() * 8,
                hue: Math.random() * 360,
                bounces: 0
            });
        }

        function createSplash(x, y, hue) {
            for (let i = 0; i < 8; i++) {
                const angle = (i / 8) * Math.PI * 2;
                splashes.push({
                    x, y,
                    vx: Math.cos(angle) * 3,
                    vy: Math.sin(angle) * 3 - 2,
                    life: 1,
                    hue
                });
            }
        }

        function update() {
            // Update balls
            for (let i = balls.length - 1; i >= 0; i--) {
                const ball = balls[i];
                ball.vy += gravity;
                ball.x += ball.vx;
                ball.y += ball.vy;

                // Wall bounces
                if (ball.x < ball.radius || ball.x > width - ball.radius) {
                    ball.vx *= -0.8;
                    ball.x = Math.max(ball.radius, Math.min(width - ball.radius, ball.x));
                }

                // Platform collisions
                platforms.forEach(platform => {
                    if (ball.y + ball.radius > platform.y &&
                        ball.y - ball.radius < platform.y + platform.height &&
                        ball.x > platform.x &&
                        ball.x < platform.x + platform.width &&
                        ball.vy > 0) {

                        ball.y = platform.y - ball.radius;
                        ball.vy *= -0.7;
                        ball.vx += (Math.random() - 0.5) * 2;

                        if (Math.abs(ball.vy) > 2) {
                            playNote(platform);
                            createSplash(ball.x, platform.y, platform.hue);
                        }

                        ball.bounces++;
                    }
                });

                // Remove if off screen or too many bounces
                if (ball.y > height + 50 || ball.bounces > 20) {
                    balls.splice(i, 1);
                }
            }

            // Update splashes
            for (let i = splashes.length - 1; i >= 0; i--) {
                const splash = splashes[i];
                splash.x += splash.vx;
                splash.y += splash.vy;
                splash.vy += 0.2;
                splash.life -= 0.03;
                if (splash.life <= 0) splashes.splice(i, 1);
            }

            // Decay platform glow
            platforms.forEach(p => {
                if (p.glow > 0) p.glow -= 0.02;
            });
        }

        function draw() {
            ctx.fillStyle = 'rgba(15, 12, 41, 0.3)';
            ctx.fillRect(0, 0, width, height);

            // Draw platforms
            platforms.forEach(platform => {
                if (platform.glow > 0) {
                    ctx.shadowColor = `hsl(${platform.hue}, 80%, 60%)`;
                    ctx.shadowBlur = 30 * platform.glow;
                }

                const gradient = ctx.createLinearGradient(platform.x, platform.y, platform.x, platform.y + platform.height);
                gradient.addColorStop(0, `hsl(${platform.hue}, 70%, 60%)`);
                gradient.addColorStop(1, `hsl(${platform.hue}, 70%, 40%)`);

                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.roundRect(platform.x, platform.y, platform.width, platform.height, 5);
                ctx.fill();
                ctx.shadowBlur = 0;
            });

            // Draw balls
            balls.forEach(ball => {
                ctx.beginPath();
                ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
                const gradient = ctx.createRadialGradient(ball.x - 3, ball.y - 3, 0, ball.x, ball.y, ball.radius);
                gradient.addColorStop(0, `hsl(${ball.hue}, 80%, 70%)`);
                gradient.addColorStop(1, `hsl(${ball.hue}, 70%, 40%)`);
                ctx.fillStyle = gradient;
                ctx.fill();
            });

            // Draw splashes
            splashes.forEach(splash => {
                ctx.beginPath();
                ctx.arc(splash.x, splash.y, 3, 0, Math.PI * 2);
                ctx.fillStyle = `hsla(${splash.hue}, 80%, 60%, ${splash.life})`;
                ctx.fill();
            });

            update();
            requestAnimationFrame(draw);
        }

        canvas.addEventListener('click', (e) => {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            createBall(e.clientX, e.clientY);
        });

        canvas.addEventListener('mousemove', (e) => {
            if (e.buttons === 1) {
                if (Math.random() < 0.3) createBall(e.clientX, e.clientY);
            }
        });

        document.getElementById('gravityBtn').addEventListener('click', function() {
            gravity = gravity === 0.3 ? 0.1 : gravity === 0.1 ? 0.6 : 0.3;
            const labels = { 0.1: 'Low', 0.3: 'Normal', 0.6: 'High' };
            this.textContent = `Gravity: ${labels[gravity]}`;
        });

        document.getElementById('clearBtn').addEventListener('click', () => {
            balls.length = 0;
        });

        document.getElementById('rainBtn').addEventListener('click', () => {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    createBall(Math.random() * width, -20);
                }, i * 100);
            }
        });

        window.addEventListener('resize', () => {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            initPlatforms();
        });

        initPlatforms();
        draw();
    </script>
</body>
</html>
