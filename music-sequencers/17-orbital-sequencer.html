<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orbital Sequencer</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: radial-gradient(ellipse at center, #0f1729 0%, #000510 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', sans-serif;
            overflow: hidden;
        }
        canvas { display: block; cursor: pointer; }
        .controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
        }
        button {
            background: rgba(100,150,255,0.15);
            border: 1px solid rgba(100,150,255,0.5);
            color: #8af;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
        }
        button:hover { background: rgba(100,150,255,0.25); }
        .info {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(100,150,255,0.8);
            font-size: 14px;
        }
        a.back { position: fixed; top: 20px; left: 20px; color: #8af; text-decoration: none; }
    </style>
</head>
<body>
    <a class="back" href="index.html">← Back</a>
    <div class="info">Planets orbit the sun • Notes play when crossing the trigger line</div>
    <canvas id="canvas"></canvas>
    <div class="controls">
        <button id="playBtn">▶ Play</button>
        <button id="addBtn">+ Add Planet</button>
        <button id="clearBtn">Clear</button>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let width = canvas.width = window.innerWidth;
        let height = canvas.height = window.innerHeight;

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        let isPlaying = false;
        const planets = [];
        let centerX, centerY;

        const notes = [130.81, 146.83, 164.81, 196.00, 220.00, 261.63, 293.66, 329.63, 392.00, 440.00, 523.25];
        const planetColors = ['#ff6b6b', '#feca57', '#48dbfb', '#ff9ff3', '#54a0ff', '#00d2d3', '#1dd1a1', '#ff9f43'];

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            centerX = width / 2;
            centerY = height / 2;
        }

        class Planet {
            constructor(orbitRadius) {
                this.orbitRadius = orbitRadius;
                this.angle = Math.random() * Math.PI * 2;
                this.speed = 0.5 / Math.sqrt(orbitRadius / 50);
                this.size = 8 + Math.random() * 12;
                this.hue = Math.random() * 360;
                this.noteIndex = Math.floor((orbitRadius - 50) / 30) % notes.length;
                this.lastQuadrant = Math.floor(this.angle / (Math.PI / 2));
                this.glow = 0;
                this.trail = [];
            }

            update() {
                this.angle += this.speed * 0.02;
                if (this.angle > Math.PI * 2) this.angle -= Math.PI * 2;

                this.x = centerX + Math.cos(this.angle) * this.orbitRadius;
                this.y = centerY + Math.sin(this.angle) * this.orbitRadius;

                // Trail
                this.trail.push({ x: this.x, y: this.y });
                if (this.trail.length > 20) this.trail.shift();

                // Check trigger line crossing (right side)
                const currentQuadrant = Math.floor(this.angle / (Math.PI / 2));
                if (currentQuadrant === 0 && this.lastQuadrant === 3) {
                    this.playNote();
                }
                this.lastQuadrant = currentQuadrant;

                if (this.glow > 0) this.glow -= 0.02;
            }

            playNote() {
                const freq = notes[this.noteIndex];

                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                const filter = audioCtx.createBiquadFilter();

                osc.type = 'sine';
                osc.frequency.value = freq;

                // Add overtone
                const osc2 = audioCtx.createOscillator();
                osc2.type = 'sine';
                osc2.frequency.value = freq * 2;
                const gain2 = audioCtx.createGain();
                gain2.gain.value = 0.1;

                filter.type = 'lowpass';
                filter.frequency.value = 2000;

                gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.6);

                osc.connect(filter);
                osc2.connect(gain2);
                gain2.connect(filter);
                filter.connect(gain);
                gain.connect(audioCtx.destination);

                osc.start();
                osc2.start();
                osc.stop(audioCtx.currentTime + 0.6);
                osc2.stop(audioCtx.currentTime + 0.6);

                this.glow = 1;
            }

            draw() {
                // Draw orbit
                ctx.beginPath();
                ctx.arc(centerX, centerY, this.orbitRadius, 0, Math.PI * 2);
                ctx.strokeStyle = 'rgba(100, 150, 255, 0.1)';
                ctx.lineWidth = 1;
                ctx.stroke();

                // Draw trail
                if (this.trail.length > 1) {
                    ctx.beginPath();
                    ctx.moveTo(this.trail[0].x, this.trail[0].y);
                    this.trail.forEach(p => ctx.lineTo(p.x, p.y));
                    ctx.strokeStyle = `hsla(${this.hue}, 70%, 50%, 0.3)`;
                    ctx.lineWidth = this.size * 0.3;
                    ctx.stroke();
                }

                // Draw planet
                if (this.glow > 0) {
                    ctx.shadowColor = `hsl(${this.hue}, 80%, 60%)`;
                    ctx.shadowBlur = 30 * this.glow;
                }

                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                const gradient = ctx.createRadialGradient(this.x - 3, this.y - 3, 0, this.x, this.y, this.size);
                gradient.addColorStop(0, `hsl(${this.hue}, 70%, 70%)`);
                gradient.addColorStop(1, `hsl(${this.hue}, 70%, 40%)`);
                ctx.fillStyle = gradient;
                ctx.fill();

                ctx.shadowBlur = 0;
            }
        }

        function drawSun() {
            // Glow
            const gradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, 80);
            gradient.addColorStop(0, 'rgba(255, 200, 50, 0.8)');
            gradient.addColorStop(0.5, 'rgba(255, 150, 0, 0.3)');
            gradient.addColorStop(1, 'rgba(255, 100, 0, 0)');
            ctx.fillStyle = gradient;
            ctx.fillRect(centerX - 80, centerY - 80, 160, 160);

            // Sun body
            ctx.beginPath();
            ctx.arc(centerX, centerY, 30, 0, Math.PI * 2);
            const sunGradient = ctx.createRadialGradient(centerX - 10, centerY - 10, 0, centerX, centerY, 30);
            sunGradient.addColorStop(0, '#fff8dc');
            sunGradient.addColorStop(0.5, '#ffd700');
            sunGradient.addColorStop(1, '#ff8c00');
            ctx.fillStyle = sunGradient;
            ctx.fill();
        }

        function drawTriggerLine() {
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(width, centerY);
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.lineWidth = 2;
            ctx.setLineDash([10, 10]);
            ctx.stroke();
            ctx.setLineDash([]);

            // Glow at intersection points
            planets.forEach(planet => {
                if (Math.abs(planet.angle) < 0.1 || Math.abs(planet.angle - Math.PI * 2) < 0.1) {
                    ctx.beginPath();
                    ctx.arc(centerX + planet.orbitRadius, centerY, 10, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                    ctx.fill();
                }
            });
        }

        function draw() {
            ctx.fillStyle = 'rgba(0, 5, 16, 0.15)';
            ctx.fillRect(0, 0, width, height);

            // Stars
            if (Math.random() < 0.1) {
                ctx.beginPath();
                ctx.arc(Math.random() * width, Math.random() * height, 0.5, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(255,255,255,0.5)';
                ctx.fill();
            }

            drawTriggerLine();
            drawSun();

            if (isPlaying) {
                planets.forEach(p => p.update());
            }
            planets.forEach(p => p.draw());

            requestAnimationFrame(draw);
        }

        function addPlanet() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const orbitRadius = 80 + planets.length * 40 + Math.random() * 20;
            if (orbitRadius < Math.min(width, height) / 2 - 50) {
                planets.push(new Planet(orbitRadius));
            }
        }

        canvas.addEventListener('click', (e) => {
            const dist = Math.hypot(e.clientX - centerX, e.clientY - centerY);
            if (dist > 50 && dist < Math.min(width, height) / 2 - 30) {
                if (audioCtx.state === 'suspended') audioCtx.resume();
                const planet = new Planet(dist);
                planet.angle = Math.atan2(e.clientY - centerY, e.clientX - centerX);
                planets.push(planet);
            }
        });

        document.getElementById('playBtn').addEventListener('click', function() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            isPlaying = !isPlaying;
            this.textContent = isPlaying ? '⏸ Pause' : '▶ Play';
        });

        document.getElementById('addBtn').addEventListener('click', addPlanet);

        document.getElementById('clearBtn').addEventListener('click', () => {
            planets.length = 0;
        });

        window.addEventListener('resize', resize);
        resize();

        // Initial planets
        for (let i = 0; i < 5; i++) {
            addPlanet();
        }

        draw();
    </script>
</body>
</html>
