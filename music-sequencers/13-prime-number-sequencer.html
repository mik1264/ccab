<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prime Number Sequencer</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            font-family: 'Courier New', monospace;
            overflow: hidden;
        }
        canvas { display: block; }
        .controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
        }
        button {
            background: rgba(255,215,0,0.15);
            border: 1px solid rgba(255,215,0,0.5);
            color: #ffd700;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
        }
        button:hover { background: rgba(255,215,0,0.25); }
        .info {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255,215,0,0.8);
            font-size: 14px;
        }
        .counter {
            position: fixed;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255,255,255,0.5);
            font-size: 24px;
        }
        a.back { position: fixed; top: 20px; left: 20px; color: #ffd700; text-decoration: none; }
    </style>
</head>
<body>
    <a class="back" href="index.html">← Back</a>
    <div class="info">Prime numbers create musical patterns • Twin primes harmonize</div>
    <div class="counter" id="counter">0</div>
    <canvas id="canvas"></canvas>
    <div class="controls">
        <button id="playBtn">▶ Play</button>
        <button id="speedBtn">Speed: 1x</button>
        <button id="resetBtn">Reset</button>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let width = canvas.width = window.innerWidth;
        let height = canvas.height = window.innerHeight;

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        let isPlaying = false;
        let currentNumber = 1;
        let speed = 1;
        let lastUpdate = 0;
        const primes = [];
        const visualPrimes = [];

        // Musical intervals based on prime factors
        const primeToNote = {
            2: 261.63,  // C
            3: 293.66,  // D
            5: 329.63,  // E
            7: 392.00,  // G
            11: 440.00, // A
            13: 493.88, // B
            17: 523.25, // C5
            19: 587.33, // D5
            23: 659.25, // E5
            29: 698.46, // F5
            31: 783.99, // G5
        };

        function isPrime(n) {
            if (n < 2) return false;
            if (n === 2) return true;
            if (n % 2 === 0) return false;
            for (let i = 3; i <= Math.sqrt(n); i += 2) {
                if (n % i === 0) return false;
            }
            return true;
        }

        function isTwinPrime(n) {
            return isPrime(n) && (isPrime(n - 2) || isPrime(n + 2));
        }

        function playPrimeNote(prime) {
            // Base frequency from prime modulo
            const baseFreq = 220;
            const interval = prime % 12;
            const octave = Math.floor((prime % 48) / 12);
            const freq = baseFreq * Math.pow(2, interval / 12 + octave);

            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            const filter = audioCtx.createBiquadFilter();

            osc.type = prime % 4 === 1 ? 'sine' : 'triangle';
            osc.frequency.value = freq;

            filter.type = 'lowpass';
            filter.frequency.value = 2000;

            gain.gain.setValueAtTime(0.15, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.4);

            osc.connect(filter);
            filter.connect(gain);
            gain.connect(audioCtx.destination);

            osc.start();
            osc.stop(audioCtx.currentTime + 0.4);

            // Twin prime harmony
            if (isTwinPrime(prime)) {
                const osc2 = audioCtx.createOscillator();
                const gain2 = audioCtx.createGain();
                osc2.type = 'sine';
                osc2.frequency.value = freq * 1.5; // Perfect fifth
                gain2.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain2.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.6);
                osc2.connect(filter);
                filter.connect(gain2);
                gain2.connect(audioCtx.destination);
                osc2.start();
                osc2.stop(audioCtx.currentTime + 0.6);
            }
        }

        function addVisualPrime(prime) {
            // Ulam spiral position
            const angle = Math.sqrt(prime) * 2.5;
            const radius = Math.sqrt(prime) * 8;

            visualPrimes.push({
                prime,
                x: width / 2 + Math.cos(angle) * radius,
                y: height / 2 + Math.sin(angle) * radius,
                life: 1,
                isTwin: isTwinPrime(prime),
                hue: (prime * 7) % 360
            });
        }

        function draw(timestamp) {
            ctx.fillStyle = 'rgba(26, 26, 46, 0.1)';
            ctx.fillRect(0, 0, width, height);

            if (isPlaying && timestamp - lastUpdate > 100 / speed) {
                currentNumber++;
                document.getElementById('counter').textContent = currentNumber;

                if (isPrime(currentNumber)) {
                    primes.push(currentNumber);
                    addVisualPrime(currentNumber);
                    playPrimeNote(currentNumber);
                }

                lastUpdate = timestamp;
            }

            // Draw connections between recent primes
            if (visualPrimes.length > 1) {
                ctx.beginPath();
                const recent = visualPrimes.slice(-20);
                ctx.moveTo(recent[0].x, recent[0].y);
                for (let i = 1; i < recent.length; i++) {
                    ctx.lineTo(recent[i].x, recent[i].y);
                }
                ctx.strokeStyle = 'rgba(255, 215, 0, 0.2)';
                ctx.lineWidth = 1;
                ctx.stroke();
            }

            // Draw visual primes
            visualPrimes.forEach((vp, i) => {
                const size = vp.isTwin ? 8 : 5;
                const alpha = Math.min(vp.life, 1);

                if (vp.life > 0.8) {
                    ctx.shadowColor = vp.isTwin ? '#ffd700' : `hsl(${vp.hue}, 70%, 60%)`;
                    ctx.shadowBlur = 20 * (vp.life - 0.8) * 5;
                }

                ctx.beginPath();
                ctx.arc(vp.x, vp.y, size, 0, Math.PI * 2);
                ctx.fillStyle = vp.isTwin
                    ? `rgba(255, 215, 0, ${alpha})`
                    : `hsla(${vp.hue}, 70%, 60%, ${alpha})`;
                ctx.fill();

                ctx.shadowBlur = 0;

                // Draw prime number
                if (vp.life > 0.9 && vp.prime < 1000) {
                    ctx.font = '10px Courier New';
                    ctx.fillStyle = `rgba(255, 255, 255, ${(vp.life - 0.9) * 10})`;
                    ctx.textAlign = 'center';
                    ctx.fillText(vp.prime, vp.x, vp.y - 10);
                }

                vp.life -= 0.002;
            });

            // Remove dead primes
            while (visualPrimes.length > 0 && visualPrimes[0].life <= 0) {
                visualPrimes.shift();
            }

            // Draw prime count
            ctx.font = '14px Courier New';
            ctx.fillStyle = 'rgba(255, 215, 0, 0.6)';
            ctx.textAlign = 'left';
            ctx.fillText(`Primes found: ${primes.length}`, 20, height - 50);

            // Draw recent primes
            const recentPrimes = primes.slice(-10).join(', ');
            ctx.fillText(`Recent: ${recentPrimes}`, 20, height - 30);

            requestAnimationFrame(draw);
        }

        document.getElementById('playBtn').addEventListener('click', function() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            isPlaying = !isPlaying;
            this.textContent = isPlaying ? '⏸ Pause' : '▶ Play';
        });

        document.getElementById('speedBtn').addEventListener('click', function() {
            speed = speed === 1 ? 2 : speed === 2 ? 5 : speed === 5 ? 10 : 1;
            this.textContent = `Speed: ${speed}x`;
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            currentNumber = 1;
            primes.length = 0;
            visualPrimes.length = 0;
            document.getElementById('counter').textContent = '0';
            ctx.fillStyle = 'rgba(26, 26, 46, 1)';
            ctx.fillRect(0, 0, width, height);
        });

        window.addEventListener('resize', () => {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        });

        requestAnimationFrame(draw);
    </script>
</body>
</html>
