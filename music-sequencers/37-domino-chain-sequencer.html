<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Domino Chain Sequencer</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #1a1008; min-height: 100vh; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        canvas { display: block; cursor: pointer; }
        .controls { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 15px; }
        button { background: rgba(200,150,100,0.2); border: 1px solid rgba(200,150,100,0.5); color: #c96; padding: 10px 20px; border-radius: 20px; cursor: pointer; }
        button:hover { background: rgba(200,150,100,0.3); }
        .info { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); color: rgba(200,150,100,0.7); font-size: 14px; }
        a.back { position: fixed; top: 20px; left: 20px; color: #c96; text-decoration: none; }
    </style>
</head>
<body>
    <a class="back" href="index.html">← Back</a>
    <div class="info">Click to place dominoes • Knock them down to create cascading melodies</div>
    <canvas id="canvas"></canvas>
    <div class="controls">
        <button id="pushBtn">Push First</button>
        <button id="clearBtn">Clear</button>
        <button id="resetBtn">Stand Up</button>
    </div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let width = canvas.width = window.innerWidth;
        let height = canvas.height = window.innerHeight;
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        const dominoes = [];
        const notes = [220, 246.94, 261.63, 293.66, 329.63, 349.23, 392, 440, 493.88, 523.25];

        class Domino {
            constructor(x) {
                this.x = x;
                this.y = height - 100;
                this.width = 15;
                this.height = 60;
                this.angle = 0;
                this.falling = false;
                this.fell = false;
                this.angularVelocity = 0;
                this.noteIndex = Math.floor(Math.random() * notes.length);
                this.hue = Math.random() * 40 + 20;
            }

            push() {
                if (!this.fell) {
                    this.falling = true;
                    this.angularVelocity = 0.02;
                }
            }

            update() {
                if (this.falling && !this.fell) {
                    this.angularVelocity += 0.003;
                    this.angle += this.angularVelocity;

                    if (this.angle > Math.PI / 2.5) {
                        this.angle = Math.PI / 2.5;
                        this.fell = true;
                        this.playNote();

                        // Find next domino
                        const tipX = this.x + Math.cos(Math.PI/2 - this.angle) * this.height;
                        dominoes.forEach(d => {
                            if (d !== this && !d.fell && d.x > this.x && d.x < tipX + 30) {
                                setTimeout(() => d.push(), 50);
                            }
                        });
                    }
                }
            }

            playNote() {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'triangle';
                osc.frequency.value = notes[this.noteIndex];
                gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.3);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            }

            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.angle);

                ctx.fillStyle = `hsl(${this.hue}, 50%, ${this.fell ? 30 : 50}%)`;
                ctx.strokeStyle = `hsl(${this.hue}, 60%, 60%)`;
                ctx.lineWidth = 2;
                ctx.fillRect(-this.width/2, -this.height, this.width, this.height);
                ctx.strokeRect(-this.width/2, -this.height, this.width, this.height);

                // Dots
                ctx.fillStyle = '#fff';
                ctx.beginPath();
                ctx.arc(0, -this.height * 0.7, 3, 0, Math.PI * 2);
                ctx.arc(0, -this.height * 0.3, 3, 0, Math.PI * 2);
                ctx.fill();

                ctx.restore();
            }
        }

        function draw() {
            ctx.fillStyle = 'rgba(26, 16, 8, 0.2)';
            ctx.fillRect(0, 0, width, height);

            // Ground
            ctx.fillStyle = '#2a1a0a';
            ctx.fillRect(0, height - 40, width, 40);

            dominoes.forEach(d => {
                d.update();
                d.draw();
            });

            requestAnimationFrame(draw);
        }

        canvas.addEventListener('click', (e) => {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            // Check if clicking on empty space
            const clickX = e.clientX;
            const exists = dominoes.some(d => Math.abs(d.x - clickX) < 30);
            if (!exists && e.clientY > 100 && e.clientY < height - 50) {
                dominoes.push(new Domino(clickX));
                dominoes.sort((a, b) => a.x - b.x);
            }
        });

        document.getElementById('pushBtn').addEventListener('click', () => {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const standing = dominoes.filter(d => !d.fell);
            if (standing.length > 0) {
                standing[0].push();
            }
        });

        document.getElementById('clearBtn').addEventListener('click', () => {
            dominoes.length = 0;
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            dominoes.forEach(d => {
                d.angle = 0;
                d.falling = false;
                d.fell = false;
                d.angularVelocity = 0;
            });
        });

        window.addEventListener('resize', () => {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        });

        // Create initial dominoes
        for (let i = 0; i < 15; i++) {
            dominoes.push(new Domino(100 + i * 50));
        }

        draw();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
