<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fourier Epicycles - Educational Demo</title>
    <link rel="stylesheet" href="../assets/css/edu-panel.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #1a1a2e;
            color: #fff;
            font-family: 'Segoe UI', system-ui, sans-serif;
            overflow: hidden;
        }
        #canvas {
            display: block;
        }
        .controls {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.85);
            padding: 15px;
            border-radius: 10px;
            z-index: 100;
            min-width: 200px;
        }
        .controls h3 {
            margin-bottom: 10px;
            color: #f39c12;
        }
        .control-group {
            margin-bottom: 10px;
        }
        .control-group label {
            display: block;
            font-size: 12px;
            margin-bottom: 3px;
            color: #aaa;
        }
        .control-group input[type="range"] {
            width: 100%;
        }
        .control-group select {
            width: 100%;
            padding: 5px;
            background: #333;
            color: #fff;
            border: 1px solid #555;
            border-radius: 4px;
        }
        .buttons {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }
        .buttons button {
            flex: 1;
            padding: 8px;
            background: #f39c12;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        .buttons button:hover { background: #e67e22; }
        .draw-mode {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #333;
            font-size: 11px;
            color: #888;
        }
        .back-link {
            position: fixed;
            top: 20px;
            right: 20px;
            color: #f39c12;
            text-decoration: none;
            background: rgba(0,0,0,0.8);
            padding: 10px 15px;
            border-radius: 5px;
            z-index: 100;
        }
        .back-link:hover { background: rgba(243,156,18,0.3); }
        /* Edu panel dark theme overrides */
        .edu-panel { background: rgba(20,20,30,0.95); }
        .edu-tab { background: #1a1a2e; color: #aaa; }
        .edu-tab.active { background: #f39c12; color: #fff; }
        .edu-tab:hover:not(.active) { background: #2a2a4e; }
        .edu-content { color: #ccc; }
        .edu-content h4 { color: #f39c12; }
        .concept-card { background: rgba(243,156,18,0.1); border-color: #f39c12; }
        .step-number { background: #f39c12; }
        code { background: rgba(243,156,18,0.2); }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <a href="index.html" class="back-link">‚Üê Back</a>

    <div class="controls">
        <h3>Fourier Epicycles</h3>

        <div class="control-group">
            <label>Number of Circles: <span id="circlesVal">50</span></label>
            <input type="range" id="circles" min="1" max="200" value="50">
        </div>

        <div class="control-group">
            <label>Speed: <span id="speedVal">1.0</span>x</label>
            <input type="range" id="speed" min="0.1" max="3" step="0.1" value="1">
        </div>

        <div class="control-group">
            <label>Shape</label>
            <select id="shape">
                <option value="square">Square Wave</option>
                <option value="sawtooth">Sawtooth Wave</option>
                <option value="triangle">Triangle Wave</option>
                <option value="star">Star</option>
                <option value="heart">Heart</option>
                <option value="treble">Treble Clef</option>
                <option value="custom">Custom (Draw)</option>
            </select>
        </div>

        <div class="control-group">
            <label>
                <input type="checkbox" id="showCircles" checked> Show circles
            </label>
        </div>

        <div class="buttons">
            <button onclick="reset()">Reset</button>
            <button onclick="clearPath()">Clear Path</button>
        </div>

        <div class="draw-mode">
            <p>Select "Custom" and draw on canvas to create your own shape!</p>
        </div>
    </div>

    <div id="edu-panel"></div>

    <script src="../assets/js/edu-panel.js"></script>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let width, height;
        let time = 0;
        let path = [];
        let epicycles = [];
        let numCircles = 50;
        let speed = 1;
        let showCircles = true;
        let currentShape = 'square';

        // Custom drawing
        let isDrawing = false;
        let customPoints = [];

        // Predefined shapes as complex paths
        const shapes = {
            square: (t) => {
                // Square wave approximation
                const x = Math.cos(t);
                const y = Math.sign(Math.sin(t));
                return { x: x * 150, y: y * 150 };
            },
            star: generateStarPoints,
            heart: generateHeartPoints,
            treble: generateTreblePoints
        };

        function generateStarPoints() {
            const points = [];
            const n = 5;
            const outerR = 150, innerR = 60;
            for (let i = 0; i < n * 2; i++) {
                const angle = (i * Math.PI / n) - Math.PI / 2;
                const r = i % 2 === 0 ? outerR : innerR;
                points.push({ x: Math.cos(angle) * r, y: Math.sin(angle) * r });
            }
            points.push(points[0]); // Close
            return points;
        }

        function generateHeartPoints() {
            const points = [];
            for (let t = 0; t < Math.PI * 2; t += 0.1) {
                const x = 16 * Math.pow(Math.sin(t), 3);
                const y = 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t);
                points.push({ x: x * 8, y: -y * 8 });
            }
            return points;
        }

        function generateTreblePoints() {
            // Simplified treble clef approximation
            const points = [];
            for (let t = 0; t < Math.PI * 4; t += 0.1) {
                const r = 50 + 30 * Math.sin(t * 2);
                const x = Math.cos(t) * r;
                const y = Math.sin(t) * r + t * 10 - 100;
                points.push({ x, y });
            }
            return points;
        }

        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
        }

        // Discrete Fourier Transform
        function dft(points) {
            const N = points.length;
            const X = [];

            for (let k = 0; k < N; k++) {
                let re = 0, im = 0;

                for (let n = 0; n < N; n++) {
                    const phi = (2 * Math.PI * k * n) / N;
                    re += points[n].x * Math.cos(phi) + points[n].y * Math.sin(phi);
                    im += points[n].y * Math.cos(phi) - points[n].x * Math.sin(phi);
                }

                re /= N;
                im /= N;

                const freq = k;
                const amp = Math.sqrt(re * re + im * im);
                const phase = Math.atan2(im, re);

                X.push({ re, im, freq, amp, phase });
            }

            return X;
        }

        function generateWavePoints(type) {
            const points = [];
            const samples = 256;

            for (let i = 0; i < samples; i++) {
                const t = (i / samples) * Math.PI * 2;
                let x, y;

                switch (type) {
                    case 'square':
                        x = (i / samples) * 300 - 150;
                        y = Math.sign(Math.sin(t)) * 100;
                        break;
                    case 'sawtooth':
                        x = (i / samples) * 300 - 150;
                        y = ((t / Math.PI) % 2 - 1) * 100;
                        break;
                    case 'triangle':
                        x = (i / samples) * 300 - 150;
                        y = (Math.asin(Math.sin(t)) / (Math.PI/2)) * 100;
                        break;
                    default:
                        x = Math.cos(t) * 100;
                        y = Math.sin(t) * 100;
                }

                points.push({ x, y });
            }

            return points;
        }

        function computeEpicycles() {
            let points;

            if (currentShape === 'custom' && customPoints.length > 10) {
                points = customPoints;
            } else if (shapes[currentShape] && typeof shapes[currentShape] === 'function') {
                points = shapes[currentShape]();
            } else {
                points = generateWavePoints(currentShape);
            }

            const fourier = dft(points);

            // Sort by amplitude (largest first)
            fourier.sort((a, b) => b.amp - a.amp);

            // Take top N circles
            epicycles = fourier.slice(0, Math.min(numCircles, fourier.length));
        }

        function drawEpicycles(x, y) {
            for (let i = 0; i < epicycles.length; i++) {
                const prevX = x;
                const prevY = y;

                const { freq, amp, phase } = epicycles[i];

                x += amp * Math.cos(freq * time + phase);
                y += amp * Math.sin(freq * time + phase);

                if (showCircles) {
                    // Draw circle
                    ctx.strokeStyle = `hsla(${30 + i * 3}, 70%, 60%, 0.3)`;
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.arc(prevX, prevY, amp, 0, Math.PI * 2);
                    ctx.stroke();

                    // Draw radius
                    ctx.strokeStyle = `hsla(${30 + i * 3}, 70%, 60%, 0.6)`;
                    ctx.beginPath();
                    ctx.moveTo(prevX, prevY);
                    ctx.lineTo(x, y);
                    ctx.stroke();
                }
            }

            return { x, y };
        }

        function animate() {
            ctx.fillStyle = 'rgba(26, 26, 46, 0.1)';
            ctx.fillRect(0, 0, width, height);

            const centerX = width / 2;
            const centerY = height / 2;

            // Draw epicycles
            const { x, y } = drawEpicycles(centerX, centerY);

            // Add point to path
            path.unshift({ x, y });
            if (path.length > 2000) path.pop();

            // Draw the traced path
            ctx.strokeStyle = '#f39c12';
            ctx.lineWidth = 2;
            ctx.beginPath();
            for (let i = 0; i < path.length; i++) {
                if (i === 0) ctx.moveTo(path[i].x, path[i].y);
                else ctx.lineTo(path[i].x, path[i].y);
            }
            ctx.stroke();

            // Draw current point
            ctx.fillStyle = '#fff';
            ctx.beginPath();
            ctx.arc(x, y, 4, 0, Math.PI * 2);
            ctx.fill();

            time += 0.01 * speed;

            // Loop when complete
            if (time >= Math.PI * 2) {
                time = 0;
                path = [];
            }

            requestAnimationFrame(animate);
        }

        function reset() {
            time = 0;
            path = [];
            computeEpicycles();
        }

        function clearPath() {
            path = [];
        }

        // Event handlers
        canvas.addEventListener('mousedown', (e) => {
            if (currentShape === 'custom') {
                isDrawing = true;
                customPoints = [];
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            if (isDrawing) {
                const x = e.clientX - width / 2;
                const y = e.clientY - height / 2;
                customPoints.push({ x, y });

                // Draw while sketching
                ctx.fillStyle = '#f39c12';
                ctx.beginPath();
                ctx.arc(e.clientX, e.clientY, 2, 0, Math.PI * 2);
                ctx.fill();
            }
        });

        canvas.addEventListener('mouseup', () => {
            if (isDrawing && customPoints.length > 10) {
                isDrawing = false;
                reset();
            }
        });

        // Controls
        document.getElementById('circles').addEventListener('input', (e) => {
            numCircles = parseInt(e.target.value);
            document.getElementById('circlesVal').textContent = numCircles;
            reset();
        });

        document.getElementById('speed').addEventListener('input', (e) => {
            speed = parseFloat(e.target.value);
            document.getElementById('speedVal').textContent = speed.toFixed(1);
        });

        document.getElementById('shape').addEventListener('change', (e) => {
            currentShape = e.target.value;
            customPoints = [];
            reset();
        });

        document.getElementById('showCircles').addEventListener('change', (e) => {
            showCircles = e.target.checked;
        });

        window.addEventListener('resize', resize);

        // Initialize
        resize();
        computeEpicycles();
        animate();

        // Educational Panel
        new EduPanel('#edu-panel', {
            title: 'Fourier Epicycles',
            startOpen: false,
            tabs: [
                {
                    id: 'theory',
                    label: 'Theory',
                    content: `
                        <h4>What are Fourier Epicycles?</h4>
                        <p>Any periodic function can be decomposed into a sum of sines and cosines - this is Fourier analysis. Epicycles visualize this: rotating circles (each a frequency component) combine to draw the original shape.</p>

                        <div class="concept-card">
                            <h5>The Fourier Series</h5>
                            <p>Any periodic function f(t) can be written as:</p>
                            <code>f(t) = Œ£ (a‚Çôcos(nœât) + b‚Çôsin(nœât))</code>
                            <p>Each term is a "harmonic" at frequency n.</p>
                        </div>

                        <div class="concept-card">
                            <h5>Complex Form</h5>
                            <p>Using Euler's formula e^(iŒ∏) = cos(Œ∏) + i¬∑sin(Œ∏):</p>
                            <code>f(t) = Œ£ c‚Çô¬∑e^(inœât)</code>
                            <p>Each c‚Çô is a complex number encoding amplitude and phase.</p>
                        </div>

                        <div class="concept-card">
                            <h5>Epicycles</h5>
                            <p>Each e^(inœât) is a rotating vector (phasor). Visualized as a circle:</p>
                            <ul>
                                <li><strong>Radius</strong> = amplitude |c‚Çô|</li>
                                <li><strong>Rotation speed</strong> = frequency n</li>
                                <li><strong>Starting angle</strong> = phase arg(c‚Çô)</li>
                            </ul>
                        </div>

                        <div class="concept-card">
                            <h5>Historical Context</h5>
                            <p>Epicycles were used in ancient astronomy (Ptolemy) to model planetary motion. Fourier rediscovered them mathematically in 1807 for heat transfer problems.</p>
                        </div>
                    `
                },
                {
                    id: 'algorithm',
                    label: 'Algorithm',
                    content: `
                        <h4>Discrete Fourier Transform</h4>
                        <p>For N sampled points, compute N frequency components:</p>

                        <div class="steps">
                            <div class="step">
                                <span class="step-number">1</span>
                                <div>
                                    <strong>Sample the Path</strong>
                                    <p>Get N (x,y) points from the shape</p>
                                </div>
                            </div>
                            <div class="step">
                                <span class="step-number">2</span>
                                <div>
                                    <strong>Compute DFT</strong>
                                    <p>For each frequency k, sum over all samples</p>
                                </div>
                            </div>
                            <div class="step">
                                <span class="step-number">3</span>
                                <div>
                                    <strong>Extract Parameters</strong>
                                    <p>Amplitude = |c|, Phase = arg(c), Freq = k</p>
                                </div>
                            </div>
                            <div class="step">
                                <span class="step-number">4</span>
                                <div>
                                    <strong>Sort by Amplitude</strong>
                                    <p>Largest amplitudes contribute most to shape</p>
                                </div>
                            </div>
                        </div>

                        <h4>DFT Formula</h4>
                        <pre><code>for k = 0 to N-1:
    X‚Çñ = 0
    for n = 0 to N-1:
        œÜ = 2œÄ¬∑k¬∑n / N
        X‚Çñ += x‚Çô¬∑e^(-i¬∑œÜ)
    X‚Çñ /= N

    amplitude[k] = |X‚Çñ|
    phase[k] = atan2(Im(X‚Çñ), Re(X‚Çñ))
    frequency[k] = k</code></pre>

                        <div class="concept-card">
                            <h5>FFT Optimization</h5>
                            <p>The Fast Fourier Transform (FFT) reduces O(N¬≤) to O(N log N) using divide-and-conquer. Essential for audio/image processing.</p>
                        </div>
                    `
                },
                {
                    id: 'applications',
                    label: 'Applications',
                    content: `
                        <h4>Real-World Applications</h4>

                        <div class="application">
                            <h5>üéµ Audio Processing</h5>
                            <p>Music equalizers, noise cancellation, audio compression (MP3), voice recognition, and spectrum analyzers all use FFT.</p>
                        </div>

                        <div class="application">
                            <h5>üì∑ Image Processing</h5>
                            <p>JPEG compression uses the related DCT. Edge detection, image filtering, and MRI reconstruction rely on Fourier transforms.</p>
                        </div>

                        <div class="application">
                            <h5>üì° Telecommunications</h5>
                            <p>OFDM (used in WiFi, 4G/5G) divides signals into frequency bands. Radar, sonar, and GPS use spectral analysis.</p>
                        </div>

                        <div class="application">
                            <h5>üî¨ Scientific Analysis</h5>
                            <p>X-ray crystallography, NMR spectroscopy, gravitational wave detection (LIGO), and quantum mechanics all use Fourier methods.</p>
                        </div>

                        <div class="application">
                            <h5>üéÆ Computer Graphics</h5>
                            <p>Texture synthesis, ocean wave simulation, and font rendering use Fourier techniques.</p>
                        </div>

                        <div class="concept-card">
                            <h5>The Uncertainty Principle</h5>
                            <p>You can't precisely know both time and frequency - narrowing one spreads the other. This is fundamental to quantum mechanics and signal processing.</p>
                        </div>
                    `
                },
                {
                    id: 'explore',
                    label: 'Explore',
                    content: `
                        <h4>Interactive Experiments</h4>

                        <div class="tutorial">
                            <h5>1. Square Wave</h5>
                            <p>Select "Square Wave". Notice how adding more circles reduces the "ringing" (Gibbs phenomenon) at corners.</p>
                            <p><strong>Try:</strong> Start with 1 circle, then increase to 50, 100, 200</p>
                        </div>

                        <div class="tutorial">
                            <h5>2. Compare Waveforms</h5>
                            <p>Switch between Square, Sawtooth, and Triangle. Notice:</p>
                            <ul>
                                <li>Square: Only odd harmonics</li>
                                <li>Sawtooth: All harmonics, equal spacing</li>
                                <li>Triangle: Odd harmonics, faster decay</li>
                            </ul>
                        </div>

                        <div class="tutorial">
                            <h5>3. Complex Shapes</h5>
                            <p>Try Star, Heart, or Treble Clef. More complex shapes need more circles for accuracy.</p>
                        </div>

                        <div class="tutorial">
                            <h5>4. Draw Your Own</h5>
                            <p>Select "Custom", then draw any shape on the canvas. Watch the epicycles recreate it!</p>
                            <p><strong>Tip:</strong> Draw slowly for smoother paths</p>
                        </div>

                        <div class="tutorial">
                            <h5>5. Circle Count Effect</h5>
                            <p>With fewer circles, only major features appear. Add circles to see details emerge.</p>
                            <p><strong>Insight:</strong> This is how compression works - keep important frequencies, discard small ones</p>
                        </div>

                        <div class="concept-card">
                            <h5>Hidden Circles</h5>
                            <p>Toggle "Show circles" off. The magic: the complex path emerges from simple circular motion!</p>
                        </div>
                    `
                },
                {
                    id: 'references',
                    label: 'References',
                    content: `
                        <h4>Learn More</h4>

                        <div class="reference-list">
                            <a href="https://www.youtube.com/watch?v=spUNpyF58BY" target="_blank">3Blue1Brown: Fourier Transform</a>
                            <a href="https://en.wikipedia.org/wiki/Fourier_series" target="_blank">Wikipedia: Fourier Series</a>
                            <a href="https://betterexplained.com/articles/an-interactive-guide-to-the-fourier-transform/" target="_blank">Better Explained: Fourier Transform</a>
                            <a href="https://www.jezzamon.com/fourier/" target="_blank">Jez Swanson: Interactive Fourier</a>
                        </div>

                        <h4>Key Figures</h4>
                        <ul>
                            <li><strong>Joseph Fourier</strong> (1768-1830) - Developed the theory for heat transfer</li>
                            <li><strong>Cooley & Tukey</strong> (1965) - Rediscovered the FFT algorithm</li>
                            <li><strong>Gauss</strong> (1805) - Actually invented FFT first, unpublished!</li>
                        </ul>

                        <h4>Related Topics</h4>
                        <ul>
                            <li>Signal Processing</li>
                            <li>Harmonic Analysis</li>
                            <li>Spectral Methods</li>
                            <li>Laplace Transform</li>
                            <li>Wavelet Transform</li>
                        </ul>
                    `
                }
            ]
        });
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
