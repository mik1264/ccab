<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lorenz Attractor - Educational Demo</title>
    <link rel="stylesheet" href="../assets/css/edu-panel.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #0a0a1a;
            color: #fff;
            font-family: 'Segoe UI', system-ui, sans-serif;
            overflow: hidden;
        }
        #canvas {
            display: block;
        }
        .controls {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.85);
            padding: 15px;
            border-radius: 10px;
            z-index: 100;
            min-width: 200px;
        }
        .controls h3 {
            margin-bottom: 10px;
            color: #9b59b6;
        }
        .control-group {
            margin-bottom: 10px;
        }
        .control-group label {
            display: block;
            font-size: 11px;
            margin-bottom: 3px;
            color: #aaa;
        }
        .control-group input[type="range"] {
            width: 100%;
        }
        .buttons {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }
        .buttons button {
            flex: 1;
            padding: 6px;
            background: #9b59b6;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
        }
        .buttons button:hover { background: #8e44ad; }
        .info {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #333;
            font-size: 10px;
            color: #888;
        }
        .back-link {
            position: fixed;
            top: 20px;
            right: 20px;
            color: #9b59b6;
            text-decoration: none;
            background: rgba(0,0,0,0.8);
            padding: 10px 15px;
            border-radius: 5px;
            z-index: 100;
        }
        .back-link:hover { background: rgba(155,89,182,0.3); }
        /* Edu panel dark theme overrides */
        .edu-panel { background: rgba(15,15,30,0.95); }
        .edu-tab { background: #1a1a2e; color: #aaa; }
        .edu-tab.active { background: #9b59b6; color: #fff; }
        .edu-tab:hover:not(.active) { background: #2a2a4e; }
        .edu-content { color: #ccc; }
        .edu-content h4 { color: #9b59b6; }
        .concept-card { background: rgba(155,89,182,0.1); border-color: #9b59b6; }
        .step-number { background: #9b59b6; }
        code { background: rgba(155,89,182,0.2); }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <a href="index.html" class="back-link">‚Üê Back</a>

    <div class="controls">
        <h3>Lorenz Attractor</h3>

        <div class="control-group">
            <label>œÉ (sigma): <span id="sigmaVal">10</span></label>
            <input type="range" id="sigma" min="1" max="30" step="0.5" value="10">
        </div>

        <div class="control-group">
            <label>œÅ (rho): <span id="rhoVal">28</span></label>
            <input type="range" id="rho" min="0" max="50" step="0.5" value="28">
        </div>

        <div class="control-group">
            <label>Œ≤ (beta): <span id="betaVal">2.67</span></label>
            <input type="range" id="beta" min="0" max="10" step="0.1" value="2.67">
        </div>

        <div class="control-group">
            <label>Speed: <span id="speedVal">1.0</span>x</label>
            <input type="range" id="speed" min="0.1" max="3" step="0.1" value="1">
        </div>

        <div class="control-group">
            <label>Trail Length: <span id="trailVal">1000</span></label>
            <input type="range" id="trail" min="100" max="5000" step="100" value="1000">
        </div>

        <div class="control-group">
            <label>
                <input type="checkbox" id="showDual"> Show divergence
            </label>
        </div>

        <div class="buttons">
            <button onclick="reset()">Reset</button>
            <button onclick="randomize()">Randomize</button>
        </div>

        <div class="info">
            <div>x: <span id="xVal">0</span></div>
            <div>y: <span id="yVal">0</span></div>
            <div>z: <span id="zVal">0</span></div>
        </div>
    </div>

    <div id="edu-panel"></div>

    <script src="../assets/js/edu-panel.js"></script>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let width, height;

        // Lorenz parameters
        let sigma = 10;
        let rho = 28;
        let beta = 8/3;
        let dt = 0.005;
        let speed = 1;
        let trailLength = 1000;
        let showDual = false;

        // State
        let x = 0.1, y = 0, z = 0;
        let x2 = 0.1001, y2 = 0, z2 = 0; // Slightly different initial condition
        let trail = [];
        let trail2 = [];

        // Camera
        let rotX = -0.3;
        let rotZ = 0.7;
        let scale = 10;
        let isDragging = false;
        let lastMouseX, lastMouseY;

        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
        }

        function lorenz(x, y, z) {
            const dx = sigma * (y - x);
            const dy = x * (rho - z) - y;
            const dz = x * y - beta * z;
            return { dx, dy, dz };
        }

        function step() {
            // RK4 integration for primary trajectory
            const k1 = lorenz(x, y, z);
            const k2 = lorenz(x + k1.dx*dt/2, y + k1.dy*dt/2, z + k1.dz*dt/2);
            const k3 = lorenz(x + k2.dx*dt/2, y + k2.dy*dt/2, z + k2.dz*dt/2);
            const k4 = lorenz(x + k3.dx*dt, y + k3.dy*dt, z + k3.dz*dt);

            x += (k1.dx + 2*k2.dx + 2*k3.dx + k4.dx) * dt / 6;
            y += (k1.dy + 2*k2.dy + 2*k3.dy + k4.dy) * dt / 6;
            z += (k1.dz + 2*k2.dz + 2*k3.dz + k4.dz) * dt / 6;

            trail.push({ x, y, z });
            if (trail.length > trailLength) trail.shift();

            // Secondary trajectory for divergence visualization
            if (showDual) {
                const k1b = lorenz(x2, y2, z2);
                const k2b = lorenz(x2 + k1b.dx*dt/2, y2 + k1b.dy*dt/2, z2 + k1b.dz*dt/2);
                const k3b = lorenz(x2 + k2b.dx*dt/2, y2 + k2b.dy*dt/2, z2 + k2b.dz*dt/2);
                const k4b = lorenz(x2 + k3b.dx*dt, y2 + k3b.dy*dt, z2 + k3b.dz*dt);

                x2 += (k1b.dx + 2*k2b.dx + 2*k3b.dx + k4b.dx) * dt / 6;
                y2 += (k1b.dy + 2*k2b.dy + 2*k3b.dy + k4b.dy) * dt / 6;
                z2 += (k1b.dz + 2*k2b.dz + 2*k3b.dz + k4b.dz) * dt / 6;

                trail2.push({ x: x2, y: y2, z: z2 });
                if (trail2.length > trailLength) trail2.shift();
            }
        }

        function project(x, y, z) {
            // Rotate around Z axis
            const cosZ = Math.cos(rotZ);
            const sinZ = Math.sin(rotZ);
            const x1 = x * cosZ - y * sinZ;
            const y1 = x * sinZ + y * cosZ;

            // Rotate around X axis
            const cosX = Math.cos(rotX);
            const sinX = Math.sin(rotX);
            const y2 = y1 * cosX - z * sinX;
            const z2 = y1 * sinX + z * cosX;

            // Project to screen
            return {
                x: width/2 + x1 * scale,
                y: height/2 - y2 * scale
            };
        }

        function drawTrail(points, hueBase, alpha = 1) {
            if (points.length < 2) return;

            ctx.lineWidth = 1.5;
            ctx.lineCap = 'round';

            for (let i = 1; i < points.length; i++) {
                const p1 = project(points[i-1].x, points[i-1].y, points[i-1].z);
                const p2 = project(points[i].x, points[i].y, points[i].z);

                const progress = i / points.length;
                const hue = hueBase + progress * 60;
                ctx.strokeStyle = `hsla(${hue}, 80%, 60%, ${progress * alpha})`;

                ctx.beginPath();
                ctx.moveTo(p1.x, p1.y);
                ctx.lineTo(p2.x, p2.y);
                ctx.stroke();
            }
        }

        function drawPoint(x, y, z, color) {
            const p = project(x, y, z);
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.arc(p.x, p.y, 4, 0, Math.PI * 2);
            ctx.fill();
        }

        function animate() {
            ctx.fillStyle = 'rgba(10, 10, 26, 0.15)';
            ctx.fillRect(0, 0, width, height);

            // Simulation steps per frame
            const stepsPerFrame = Math.ceil(speed * 5);
            for (let i = 0; i < stepsPerFrame; i++) {
                step();
            }

            // Draw trails
            drawTrail(trail, 270); // Purple hue
            if (showDual) {
                drawTrail(trail2, 30, 0.7); // Orange hue
            }

            // Draw current points
            drawPoint(x, y, z, '#fff');
            if (showDual) {
                drawPoint(x2, y2, z2, '#f39c12');
            }

            // Update info
            document.getElementById('xVal').textContent = x.toFixed(2);
            document.getElementById('yVal').textContent = y.toFixed(2);
            document.getElementById('zVal').textContent = z.toFixed(2);

            requestAnimationFrame(animate);
        }

        function reset() {
            x = 0.1; y = 0; z = 0;
            x2 = 0.1001; y2 = 0; z2 = 0;
            trail = [];
            trail2 = [];
        }

        function randomize() {
            x = (Math.random() - 0.5) * 30;
            y = (Math.random() - 0.5) * 30;
            z = Math.random() * 50;
            x2 = x + 0.0001;
            y2 = y;
            z2 = z;
            trail = [];
            trail2 = [];
        }

        // Mouse controls for rotation
        canvas.addEventListener('mousedown', (e) => {
            isDragging = true;
            lastMouseX = e.clientX;
            lastMouseY = e.clientY;
        });

        canvas.addEventListener('mousemove', (e) => {
            if (isDragging) {
                const dx = e.clientX - lastMouseX;
                const dy = e.clientY - lastMouseY;
                rotZ += dx * 0.01;
                rotX += dy * 0.01;
                lastMouseX = e.clientX;
                lastMouseY = e.clientY;
            }
        });

        canvas.addEventListener('mouseup', () => { isDragging = false; });
        canvas.addEventListener('mouseleave', () => { isDragging = false; });

        canvas.addEventListener('wheel', (e) => {
            e.preventDefault();
            scale *= e.deltaY > 0 ? 0.9 : 1.1;
            scale = Math.max(2, Math.min(30, scale));
        });

        // Controls
        document.getElementById('sigma').addEventListener('input', (e) => {
            sigma = parseFloat(e.target.value);
            document.getElementById('sigmaVal').textContent = sigma;
        });

        document.getElementById('rho').addEventListener('input', (e) => {
            rho = parseFloat(e.target.value);
            document.getElementById('rhoVal').textContent = rho;
        });

        document.getElementById('beta').addEventListener('input', (e) => {
            beta = parseFloat(e.target.value);
            document.getElementById('betaVal').textContent = beta.toFixed(2);
        });

        document.getElementById('speed').addEventListener('input', (e) => {
            speed = parseFloat(e.target.value);
            document.getElementById('speedVal').textContent = speed.toFixed(1);
        });

        document.getElementById('trail').addEventListener('input', (e) => {
            trailLength = parseInt(e.target.value);
            document.getElementById('trailVal').textContent = trailLength;
        });

        document.getElementById('showDual').addEventListener('change', (e) => {
            showDual = e.target.checked;
            if (showDual) {
                x2 = x + 0.0001;
                y2 = y;
                z2 = z;
                trail2 = [];
            }
        });

        window.addEventListener('resize', resize);

        // Initialize
        resize();
        animate();

        // Educational Panel
        new EduPanel('#edu-panel', {
            title: 'Lorenz Attractor',
            startOpen: false,
            tabs: [
                {
                    id: 'theory',
                    label: 'Theory',
                    content: `
                        <h4>What is the Lorenz Attractor?</h4>
                        <p>Discovered by meteorologist Edward Lorenz in 1963, this system of equations models atmospheric convection but became the iconic image of chaos theory.</p>

                        <div class="concept-card">
                            <h5>The Equations</h5>
                            <code>dx/dt = œÉ(y - x)</code><br>
                            <code>dy/dt = x(œÅ - z) - y</code><br>
                            <code>dz/dt = xy - Œ≤z</code>
                        </div>

                        <div class="concept-card">
                            <h5>Parameters</h5>
                            <ul>
                                <li><strong>œÉ (sigma)</strong>: Prandtl number - fluid viscosity ratio</li>
                                <li><strong>œÅ (rho)</strong>: Rayleigh number - temperature difference</li>
                                <li><strong>Œ≤ (beta)</strong>: Geometric factor</li>
                            </ul>
                            <p>Classic values: œÉ=10, œÅ=28, Œ≤=8/3</p>
                        </div>

                        <div class="concept-card">
                            <h5>Strange Attractor</h5>
                            <p>The system settles onto a fractal set of points - not a fixed point, not a cycle, but a strange attractor. Trajectories never repeat but stay bounded.</p>
                        </div>

                        <div class="concept-card">
                            <h5>The Butterfly Effect</h5>
                            <p>Lorenz's famous metaphor: "Does the flap of a butterfly's wings in Brazil set off a tornado in Texas?" Small changes ‚Üí radically different outcomes.</p>
                        </div>

                        <div class="concept-card">
                            <h5>Deterministic Chaos</h5>
                            <p>The equations are completely deterministic - no randomness. Yet long-term prediction is impossible because tiny errors grow exponentially.</p>
                        </div>
                    `
                },
                {
                    id: 'algorithm',
                    label: 'Algorithm',
                    content: `
                        <h4>Numerical Integration</h4>
                        <p>We can't solve these equations analytically - we must simulate step by step.</p>

                        <div class="steps">
                            <div class="step">
                                <span class="step-number">1</span>
                                <div>
                                    <strong>Initialize</strong>
                                    <p>Start at some point (x‚ÇÄ, y‚ÇÄ, z‚ÇÄ)</p>
                                </div>
                            </div>
                            <div class="step">
                                <span class="step-number">2</span>
                                <div>
                                    <strong>Compute Derivatives</strong>
                                    <p>Calculate dx/dt, dy/dt, dz/dt at current point</p>
                                </div>
                            </div>
                            <div class="step">
                                <span class="step-number">3</span>
                                <div>
                                    <strong>Step Forward</strong>
                                    <p>Update position using integration method</p>
                                </div>
                            </div>
                            <div class="step">
                                <span class="step-number">4</span>
                                <div>
                                    <strong>Record & Render</strong>
                                    <p>Store point, project 3D ‚Üí 2D, draw</p>
                                </div>
                            </div>
                        </div>

                        <h4>Runge-Kutta 4 (RK4)</h4>
                        <pre><code>function rk4_step(x, y, z, dt):
    k1 = lorenz(x, y, z)
    k2 = lorenz(x + k1.dx*dt/2, ...)
    k3 = lorenz(x + k2.dx*dt/2, ...)
    k4 = lorenz(x + k3.dx*dt, ...)

    x += (k1.dx + 2*k2.dx +
          2*k3.dx + k4.dx) * dt / 6
    # Same for y, z

    return (x, y, z)</code></pre>

                        <div class="concept-card">
                            <h5>Why RK4?</h5>
                            <p>Simple Euler method (x += dx*dt) accumulates errors. RK4 samples the derivative at multiple points for 4th-order accuracy.</p>
                        </div>
                    `
                },
                {
                    id: 'applications',
                    label: 'Applications',
                    content: `
                        <h4>Real-World Applications</h4>

                        <div class="application">
                            <h5>üå¶Ô∏è Weather Prediction</h5>
                            <p>Lorenz's original motivation. Weather systems are chaotic - predictions degrade beyond ~2 weeks regardless of data quality.</p>
                        </div>

                        <div class="application">
                            <h5>üíπ Financial Markets</h5>
                            <p>Stock prices exhibit chaotic dynamics. Chaos theory informs risk models and trading strategies.</p>
                        </div>

                        <div class="application">
                            <h5>‚ù§Ô∏è Cardiology</h5>
                            <p>Heart rhythm can become chaotic (arrhythmia). Understanding strange attractors helps diagnose cardiac issues.</p>
                        </div>

                        <div class="application">
                            <h5>üîê Cryptography</h5>
                            <p>Chaotic systems generate pseudo-random sequences. Used in secure communications and encryption.</p>
                        </div>

                        <div class="application">
                            <h5>üåå Astrophysics</h5>
                            <p>Three-body problem in celestial mechanics is chaotic. Planetary systems, asteroid orbits, and stellar dynamics.</p>
                        </div>

                        <div class="concept-card">
                            <h5>Lyapunov Exponent</h5>
                            <p>Measures chaos: how fast nearby trajectories diverge. Positive = chaotic. For Lorenz with standard parameters, Œª ‚âà 0.9.</p>
                        </div>
                    `
                },
                {
                    id: 'explore',
                    label: 'Explore',
                    content: `
                        <h4>Interactive Experiments</h4>

                        <div class="tutorial">
                            <h5>1. Sensitive Dependence</h5>
                            <p>Enable "Show divergence". Two points start just 0.0001 apart. Watch them initially track together, then rapidly separate.</p>
                            <p><strong>Key insight:</strong> Identical equations, nearly identical starts, totally different outcomes</p>
                        </div>

                        <div class="tutorial">
                            <h5>2. Parameter Exploration - œÅ</h5>
                            <p>Vary œÅ (rho) from 0 to 50:</p>
                            <ul>
                                <li>œÅ < 1: Point attractor (stable)</li>
                                <li>1 < œÅ < 24.74: Two point attractors</li>
                                <li>œÅ > 24.74: Strange attractor (chaos!)</li>
                            </ul>
                        </div>

                        <div class="tutorial">
                            <h5>3. Wing Shape</h5>
                            <p>The "butterfly" has two wings. The trajectory randomly switches between lobes. This is deterministic but unpredictable!</p>
                        </div>

                        <div class="tutorial">
                            <h5>4. 3D Rotation</h5>
                            <p>Drag to rotate, scroll to zoom. View the attractor from different angles to appreciate its 3D structure.</p>
                        </div>

                        <div class="tutorial">
                            <h5>5. Œ≤ Effect</h5>
                            <p>Œ≤ controls the "height" of the wings. Very small Œ≤ creates tall, thin loops. Large Œ≤ creates flat, wide loops.</p>
                        </div>

                        <div class="concept-card">
                            <h5>Challenge</h5>
                            <p>Can you find parameter values that:</p>
                            <ul>
                                <li>Create a stable fixed point?</li>
                                <li>Create a limit cycle (repeating orbit)?</li>
                                <li>Create maximum chaos (fast divergence)?</li>
                            </ul>
                        </div>
                    `
                },
                {
                    id: 'references',
                    label: 'References',
                    content: `
                        <h4>Learn More</h4>

                        <div class="reference-list">
                            <a href="https://en.wikipedia.org/wiki/Lorenz_system" target="_blank">Wikipedia: Lorenz System</a>
                            <a href="https://www.youtube.com/watch?v=fDek6cYijxI" target="_blank">Veritasium: Chaos Theory</a>
                            <a href="https://mathworld.wolfram.com/LorenzAttractor.html" target="_blank">MathWorld: Lorenz Attractor</a>
                            <a href="https://www.youtube.com/watch?v=ovJcsL7vyrk" target="_blank">3Blue1Brown: Differential Equations</a>
                        </div>

                        <h4>Key Papers</h4>
                        <ul>
                            <li>Lorenz, E.N. (1963) - "Deterministic Nonperiodic Flow"</li>
                            <li>Ruelle, D. & Takens, F. (1971) - Coined "strange attractor"</li>
                            <li>Sparrow, C. (1982) - "The Lorenz Equations: Bifurcations, Chaos, and Strange Attractors"</li>
                        </ul>

                        <h4>Related Topics</h4>
                        <ul>
                            <li>Chaos Theory</li>
                            <li>Dynamical Systems</li>
                            <li>Bifurcation Theory</li>
                            <li>Fractals</li>
                            <li>Nonlinear Dynamics</li>
                        </ul>
                    `
                }
            ]
        });
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
