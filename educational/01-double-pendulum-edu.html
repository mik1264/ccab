<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Double Pendulum - Educational Demo</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600;700&family=Nunito:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/edu-panel.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            font-family: 'Nunito', sans-serif;
            overflow: hidden;
            min-height: 100vh;
        }

        .back-link {
            position: fixed;
            top: 15px;
            left: 15px;
            color: #fff;
            text-decoration: none;
            opacity: 0.8;
            z-index: 100;
            padding: 8px 12px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
        }

        .back-link:hover {
            opacity: 1;
            background: rgba(0,0,0,0.5);
        }

        #container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        canvas {
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            box-shadow: 0 0 40px rgba(255, 150, 100, 0.3);
            background: #000;
        }

        .info-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            color: white;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px 20px;
            border-radius: 10px;
            font-size: 14px;
            line-height: 1.6;
            backdrop-filter: blur(10px);
            max-width: 250px;
        }

        .info-panel h3 {
            color: #ffaa88;
            margin-bottom: 10px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }

        .stat-label { color: #888; }
        .stat-value { color: #fff; font-weight: 600; }

        .controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .control-group {
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 15px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-group label {
            color: #ffaa88;
            font-size: 12px;
            font-weight: 500;
        }

        .control-group input[type="range"] { width: 100px; }

        .control-group button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: transform 0.2s;
        }

        .control-group button:hover { transform: scale(1.05); }

        .value-display {
            color: white;
            font-size: 12px;
            min-width: 35px;
            text-align: right;
        }

        /* Educational Panel Positioning */
        .edu-panel {
            position: fixed;
            bottom: 80px;
            left: 20px;
            max-width: 450px;
            max-height: 60vh;
            overflow-y: auto;
            z-index: 100;
        }

        /* Dark theme override for edu-panel */
        .edu-panel {
            background: rgba(0, 0, 0, 0.85);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .edu-header {
            background: rgba(255, 170, 136, 0.1);
        }

        .edu-title { color: #ffaa88; }
        .edu-toggle { color: #ffaa88; }

        .edu-tab {
            background: rgba(255, 255, 255, 0.1);
            color: #888;
            border-color: rgba(255, 255, 255, 0.2);
        }

        .edu-tab.active, .edu-tab:hover {
            background: #ffaa88;
            color: #000;
            border-color: #ffaa88;
        }

        .edu-tab-content {
            color: #ccc;
        }

        .edu-tab-content h4 {
            color: #ffaa88;
        }

        .edu-tab-content h5 {
            color: #888;
        }

        .edu-equation {
            background: rgba(255, 255, 255, 0.05);
            border-left-color: #ffaa88;
            font-family: 'Courier New', monospace;
            color: #ddd;
        }

        .edu-step .step-num {
            background: #ffaa88;
            color: #000;
        }

        .edu-pseudocode pre {
            background: rgba(255, 255, 255, 0.05);
            color: #aaa;
        }

        .edu-key-concepts ul {
            color: #aaa;
        }

        .edu-refs a {
            color: #88aaff;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Educational Demos</a>

    <div id="container">
        <canvas id="canvas"></canvas>
    </div>

    <div class="info-panel">
        <h3>Double Pendulum</h3>
        <div class="stat-row">
            <span class="stat-label">Energy:</span>
            <span class="stat-value" id="energy">0</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">Angle 1:</span>
            <span class="stat-value" id="angle1">0¬∞</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">Angle 2:</span>
            <span class="stat-value" id="angle2">0¬∞</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">Angular Vel:</span>
            <span class="stat-value" id="angvel">0</span>
        </div>
    </div>

    <div class="edu-panel" id="edu-panel">
        <div class="edu-header">
            <span class="edu-icon">üìö</span>
            <span class="edu-title">Learn: Chaos Theory</span>
            <span class="edu-toggle">‚ñº</span>
        </div>
        <div class="edu-content">
            <div class="edu-tabs">
                <button class="edu-tab active" data-tab="theory">Theory</button>
                <button class="edu-tab" data-tab="algorithm">Algorithm</button>
                <button class="edu-tab" data-tab="applications">Applications</button>
                <button class="edu-tab" data-tab="explore">Explore</button>
                <button class="edu-tab" data-tab="references">References</button>
            </div>

            <div class="edu-tab-content active" id="theory" data-tab="theory">
                <h4>Mathematical Foundation</h4>
                <p class="edu-intro">The double pendulum is a classic example of a chaotic system - one that is deterministic yet unpredictable due to extreme sensitivity to initial conditions.</p>

                <div class="edu-equation">
                    Œ∏‚ÇÅ'' = [‚àíg(2m‚ÇÅ+m‚ÇÇ)sin(Œ∏‚ÇÅ) ‚àí m‚ÇÇg¬∑sin(Œ∏‚ÇÅ‚àí2Œ∏‚ÇÇ) ‚àí 2sin(Œ∏‚ÇÅ‚àíŒ∏‚ÇÇ)m‚ÇÇ(Œ∏‚ÇÇ'¬≤L‚ÇÇ + Œ∏‚ÇÅ'¬≤L‚ÇÅcos(Œ∏‚ÇÅ‚àíŒ∏‚ÇÇ))] / [L‚ÇÅ(2m‚ÇÅ+m‚ÇÇ‚àím‚ÇÇcos(2Œ∏‚ÇÅ‚àí2Œ∏‚ÇÇ))]
                </div>

                <p class="edu-explanation">These equations of motion come from Lagrangian mechanics. The coupled nature of Œ∏‚ÇÅ and Œ∏‚ÇÇ creates the chaotic behavior - each angle depends on the other's position and velocity.</p>

                <div class="edu-key-concepts">
                    <h5>Key Concepts</h5>
                    <ul>
                        <li><strong>Chaos:</strong> Deterministic systems with extreme sensitivity to initial conditions</li>
                        <li><strong>Lyapunov Exponent:</strong> Measures the rate of divergence of nearby trajectories</li>
                        <li><strong>Phase Space:</strong> Multi-dimensional space of all possible states</li>
                        <li><strong>Strange Attractor:</strong> The shape traced in phase space by chaotic motion</li>
                    </ul>
                </div>
            </div>

            <div class="edu-tab-content" id="algorithm" data-tab="algorithm">
                <h4>How It Works</h4>
                <p>The simulation uses numerical integration to solve the coupled differential equations at each timestep.</p>

                <div class="edu-steps">
                    <div class="edu-step">
                        <span class="step-num">1</span>
                        <span class="step-text">Calculate angular accelerations using Lagrangian equations</span>
                    </div>
                    <div class="edu-step">
                        <span class="step-num">2</span>
                        <span class="step-text">Update angular velocities: œâ += Œ± √ó dt</span>
                    </div>
                    <div class="edu-step">
                        <span class="step-num">3</span>
                        <span class="step-text">Update angles: Œ∏ += œâ √ó dt</span>
                    </div>
                    <div class="edu-step">
                        <span class="step-num">4</span>
                        <span class="step-text">Calculate bob positions from angles</span>
                    </div>
                    <div class="edu-step">
                        <span class="step-num">5</span>
                        <span class="step-text">Render pendulum and store trail points</span>
                    </div>
                </div>

                <div class="edu-pseudocode">
                    <pre>
for each frame:
    a1_accel = lagrangian_eq1(Œ∏1, Œ∏2, œâ1, œâ2, g, m1, m2, L1, L2)
    a2_accel = lagrangian_eq2(Œ∏1, Œ∏2, œâ1, œâ2, g, m1, m2, L1, L2)

    œâ1 += a1_accel √ó dt
    œâ2 += a2_accel √ó dt
    Œ∏1 += œâ1 √ó dt
    Œ∏2 += œâ2 √ó dt

    x1 = L1 √ó sin(Œ∏1)
    y1 = L1 √ó cos(Œ∏1)
    x2 = x1 + L2 √ó sin(Œ∏2)
    y2 = y1 + L2 √ó cos(Œ∏2)
                    </pre>
                </div>
            </div>

            <div class="edu-tab-content" id="applications" data-tab="applications">
                <h4>Real-World Applications</h4>

                <div class="edu-application">
                    <h5>üå§Ô∏è Weather Prediction</h5>
                    <p>The "butterfly effect" in meteorology - small atmospheric changes can lead to dramatically different weather outcomes. This is why long-term weather forecasts are inherently limited.</p>
                </div>

                <div class="edu-application">
                    <h5>üìà Financial Markets</h5>
                    <p>Stock markets exhibit chaotic behavior where small events can trigger large market movements. Understanding chaos helps in risk management.</p>
                </div>

                <div class="edu-application">
                    <h5>‚ù§Ô∏è Cardiac Rhythms</h5>
                    <p>Heart rhythms can transition between regular and chaotic states. Chaos theory helps understand and predict cardiac arrhythmias.</p>
                </div>

                <div class="edu-application">
                    <h5>üé∏ Music & Acoustics</h5>
                    <p>Non-linear vibrations in musical instruments create rich harmonic content. Understanding chaos helps design better acoustic systems.</p>
                </div>
            </div>

            <div class="edu-tab-content" id="explore" data-tab="explore">
                <h4>Interactive Tutorial</h4>

                <div class="edu-tutorial-step">
                    <span class="edu-try-this">üí° Try This</span>
                    <p>Start the pendulum and wait until it's swinging smoothly. Then reset and start again with the EXACT same initial position. Notice how the motion eventually diverges - this is sensitivity to tiny numerical differences!</p>
                </div>

                <div class="edu-tutorial-step">
                    <span class="edu-try-this">üí° Try This</span>
                    <p>Increase gravity to maximum. Observe how the pendulum becomes more chaotic more quickly. Higher energy means faster exploration of phase space.</p>
                </div>

                <div class="edu-tutorial-step">
                    <span class="edu-try-this">üí° Try This</span>
                    <p>Watch the trail pattern. Even though motion is chaotic, notice how certain regions are visited more often than others - this hints at the underlying strange attractor.</p>
                </div>

                <div class="edu-tutorial-step">
                    <span class="edu-try-this">üí° Try This</span>
                    <p>Start with the pendulum nearly vertical (small initial angle). The motion stays regular longer. Start nearly horizontal for immediate chaos!</p>
                </div>
            </div>

            <div class="edu-tab-content" id="references" data-tab="references">
                <h4>Further Reading</h4>
                <ul class="edu-refs">
                    <li><a href="https://en.wikipedia.org/wiki/Double_pendulum" target="_blank" rel="noopener">Double Pendulum - Wikipedia</a></li>
                    <li><a href="https://en.wikipedia.org/wiki/Chaos_theory" target="_blank" rel="noopener">Chaos Theory - Wikipedia</a></li>
                    <li><a href="https://mathworld.wolfram.com/DoublePendulum.html" target="_blank" rel="noopener">Double Pendulum - Wolfram MathWorld</a></li>
                    <li><a href="https://www.youtube.com/watch?v=d0Z8wLLPNE0" target="_blank" rel="noopener">Veritasium: Chaos Theory Explained</a></li>
                </ul>
            </div>
        </div>
    </div>

    <div class="controls">
        <div class="control-group">
            <label>Gravity:</label>
            <input type="range" id="gravity" min="1" max="20" value="10">
            <span class="value-display" id="gravity-val">10</span>
        </div>
        <div class="control-group">
            <label>Length 1:</label>
            <input type="range" id="length1" min="50" max="200" value="150">
            <span class="value-display" id="length1-val">150</span>
        </div>
        <div class="control-group">
            <label>Length 2:</label>
            <input type="range" id="length2" min="50" max="200" value="150">
            <span class="value-display" id="length2-val">150</span>
        </div>
        <div class="control-group">
            <button id="reset">Reset</button>
            <button id="trail">Toggle Trail</button>
        </div>
    </div>

    <script src="../assets/js/edu-panel.js"></script>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        const width = 800;
        const height = 600;
        canvas.width = width;
        canvas.height = height;

        const originX = width / 2;
        const originY = 180;

        let m1 = 10, m2 = 10;
        let L1 = 150, L2 = 150;
        let a1, a2, a1_v, a2_v;
        let trail = [];
        let showTrail = true;

        function init() {
            a1 = Math.PI / 2 + (Math.random() - 0.5) * 0.01;
            a2 = Math.PI / 2 + (Math.random() - 0.5) * 0.01;
            a1_v = 0;
            a2_v = 0;
            trail = [];
        }

        function update() {
            const g = parseFloat(document.getElementById('gravity').value) / 10;
            L1 = parseFloat(document.getElementById('length1').value);
            L2 = parseFloat(document.getElementById('length2').value);
            const dt = 0.1;

            // Double pendulum equations
            const num1 = -g * (2 * m1 + m2) * Math.sin(a1);
            const num2 = -m2 * g * Math.sin(a1 - 2 * a2);
            const num3 = -2 * Math.sin(a1 - a2) * m2;
            const num4 = a2_v * a2_v * L2 + a1_v * a1_v * L1 * Math.cos(a1 - a2);
            const den = L1 * (2 * m1 + m2 - m2 * Math.cos(2 * a1 - 2 * a2));
            const a1_a = (num1 + num2 + num3 * num4) / den;

            const num5 = 2 * Math.sin(a1 - a2);
            const num6 = a1_v * a1_v * L1 * (m1 + m2);
            const num7 = g * (m1 + m2) * Math.cos(a1);
            const num8 = a2_v * a2_v * L2 * m2 * Math.cos(a1 - a2);
            const den2 = L2 * (2 * m1 + m2 - m2 * Math.cos(2 * a1 - 2 * a2));
            const a2_a = (num5 * (num6 + num7 + num8)) / den2;

            a1_v += a1_a * dt;
            a2_v += a2_a * dt;
            a1 += a1_v * dt;
            a2 += a2_v * dt;

            // Add damping
            a1_v *= 0.9999;
            a2_v *= 0.9999;

            // Calculate bob positions
            const x1 = originX + L1 * Math.sin(a1);
            const y1 = originY + L1 * Math.cos(a1);
            const x2 = x1 + L2 * Math.sin(a2);
            const y2 = y1 + L2 * Math.cos(a2);

            trail.push({ x: x2, y: y2 });
            if (trail.length > 500) trail.shift();

            // Update stats
            const y1_pos = L1 * (1 - Math.cos(a1));
            const y2_pos = y1_pos + L2 * (1 - Math.cos(a2));
            const PE = m1 * g * 10 * y1_pos + m2 * g * 10 * y2_pos;
            const KE = 0.5 * m1 * (L1 * a1_v) ** 2 + 0.5 * m2 * ((L1 * a1_v) ** 2 + (L2 * a2_v) ** 2);

            document.getElementById('energy').textContent = (PE + KE).toFixed(0);
            document.getElementById('angle1').textContent = ((a1 * 180 / Math.PI) % 360).toFixed(1) + '¬∞';
            document.getElementById('angle2').textContent = ((a2 * 180 / Math.PI) % 360).toFixed(1) + '¬∞';
            document.getElementById('angvel').textContent = Math.sqrt(a1_v * a1_v + a2_v * a2_v).toFixed(2);
        }

        function render() {
            // Clear with fade
            if (showTrail) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
            } else {
                ctx.fillStyle = '#000';
            }
            ctx.fillRect(0, 0, width, height);

            // Draw trail
            if (showTrail && trail.length > 1) {
                for (let i = 1; i < trail.length; i++) {
                    const alpha = i / trail.length;
                    const hue = (i / trail.length) * 60 + 180;
                    ctx.strokeStyle = `hsla(${hue}, 100%, 60%, ${alpha * 0.8})`;
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(trail[i - 1].x, trail[i - 1].y);
                    ctx.lineTo(trail[i].x, trail[i].y);
                    ctx.stroke();
                }
            }

            // Calculate positions
            const x1 = originX + L1 * Math.sin(a1);
            const y1 = originY + L1 * Math.cos(a1);
            const x2 = x1 + L2 * Math.sin(a2);
            const y2 = y1 + L2 * Math.cos(a2);

            // Draw rods
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(originX, originY);
            ctx.lineTo(x1, y1);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.stroke();

            // Draw pivot
            ctx.fillStyle = '#888';
            ctx.beginPath();
            ctx.arc(originX, originY, 6, 0, Math.PI * 2);
            ctx.fill();

            // Draw bobs
            ctx.fillStyle = '#ff6666';
            ctx.beginPath();
            ctx.arc(x1, y1, 15, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = '#6666ff';
            ctx.beginPath();
            ctx.arc(x2, y2, 15, 0, Math.PI * 2);
            ctx.fill();
        }

        // Controls
        document.getElementById('gravity').addEventListener('input', (e) => {
            document.getElementById('gravity-val').textContent = e.target.value;
        });

        document.getElementById('length1').addEventListener('input', (e) => {
            document.getElementById('length1-val').textContent = e.target.value;
        });

        document.getElementById('length2').addEventListener('input', (e) => {
            document.getElementById('length2-val').textContent = e.target.value;
        });

        document.getElementById('reset').addEventListener('click', init);

        document.getElementById('trail').addEventListener('click', () => {
            showTrail = !showTrail;
        });

        function animate() {
            update();
            render();
            requestAnimationFrame(animate);
        }

        init();
        animate();

        // Initialize educational panel
        new EduPanel('#edu-panel', { startOpen: false });
    </script>
</body>
</html>
