<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bogosort - Sorting Algorithms</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; color: #e0e0e0; font-family: 'Segoe UI', system-ui, sans-serif; overflow: hidden; }
canvas { display: block; }
a.back-link {
    position: fixed; top: 16px; left: 16px; color: #8ab4f8; text-decoration: none;
    font-size: 14px; z-index: 100; opacity: 0.8; transition: opacity 0.2s;
}
a.back-link:hover { opacity: 1; }

.controls {
    position: fixed; top: 16px; right: 16px; z-index: 100;
    background: rgba(20,20,40,0.85); backdrop-filter: blur(10px);
    border-radius: 12px; padding: 16px; min-width: 240px;
    border: 1px solid rgba(255,255,255,0.08);
}
.controls h3 { font-size: 14px; color: #ff6b6b; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px; }
.controls label { display: block; font-size: 12px; color: #aaa; margin-top: 8px; }
.controls input[type=range] { width: 100%; margin: 4px 0; accent-color: #ff6b6b; }
.controls .value { font-size: 11px; color: #666; text-align: right; }
.btn {
    display: inline-block; margin: 4px 2px; padding: 6px 14px; border: none; border-radius: 6px;
    background: #5c1a1a; color: #ff6b6b; font-size: 12px; cursor: pointer; transition: background 0.2s;
}
.btn:hover { background: #6c2424; }
.btn.active { background: #2e6b3e; color: #8f8; }
.btn-row { margin-top: 10px; display: flex; flex-wrap: wrap; gap: 4px; }
.warning {
    margin-top: 8px; padding: 6px 10px; background: rgba(255,107,107,0.15);
    border: 1px solid rgba(255,107,107,0.3); border-radius: 6px;
    font-size: 11px; color: #ff9999; line-height: 1.4;
}

.stats {
    position: fixed; bottom: 16px; left: 16px; z-index: 100;
    background: rgba(20,20,40,0.85); backdrop-filter: blur(10px);
    border-radius: 12px; padding: 14px 18px;
    border: 1px solid rgba(255,255,255,0.08); font-size: 13px;
}
.stats .stat-row { display: flex; justify-content: space-between; gap: 20px; margin: 3px 0; }
.stats .stat-label { color: #888; }
.stats .stat-value { color: #ff6b6b; font-family: 'Courier New', monospace; }
.stats .stat-value.big { font-size: 18px; font-weight: bold; }

.info-panel {
    position: fixed; bottom: 16px; right: 16px; z-index: 100;
    background: rgba(20,20,40,0.85); backdrop-filter: blur(10px);
    border-radius: 12px; padding: 14px 18px; max-width: 320px;
    border: 1px solid rgba(255,255,255,0.08); font-size: 12px; line-height: 1.6;
}
.info-panel h4 { color: #ff6b6b; margin-bottom: 6px; }
.info-panel .complexity { color: #f8d868; font-family: 'Courier New', monospace; font-size: 11px; }

.check-overlay {
    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
    font-size: 48px; color: #2ecc71; opacity: 0; transition: opacity 0.3s;
    z-index: 200; text-shadow: 0 0 30px rgba(46,204,113,0.5);
    pointer-events: none;
}
.check-overlay.show { opacity: 1; }
</style>
</head>
<body>
<a href="index.html" class="back-link">&#8592; Back to Gallery</a>
<canvas id="canvas"></canvas>
<div id="checkOverlay" class="check-overlay">SORTED!</div>

<div class="controls">
    <h3>Bogosort</h3>
    <label>Array Size: <span id="sizeVal">6</span></label>
    <input type="range" id="sizeSlider" min="3" max="10" value="6">
    <label>Speed: <span id="speedVal">50</span></label>
    <input type="range" id="speedSlider" min="1" max="100" value="50">
    <div class="btn-row">
        <button class="btn" id="btnStart">Start</button>
        <button class="btn" id="btnStep">Shuffle Once</button>
        <button class="btn" id="btnNew">New Array</button>
    </div>
    <div class="warning" id="warningBox">
        Array size limited to 10. Expected shuffles for <span id="warnN">6</span> elements: <strong id="warnFact">720</strong>
    </div>
</div>

<div class="stats">
    <div class="stat-row"><span class="stat-label">Shuffles:</span><span class="stat-value big" id="shuffleCount">0</span></div>
    <div class="stat-row"><span class="stat-label">Checks:</span><span class="stat-value" id="checkCount">0</span></div>
    <div class="stat-row"><span class="stat-label">Expected (n!):</span><span class="stat-value" id="expectedVal">720</span></div>
    <div class="stat-row"><span class="stat-label">Check Progress:</span><span class="stat-value" id="checkProgress">--</span></div>
    <div class="stat-row"><span class="stat-label">Status:</span><span class="stat-value" id="statusText">Ready</span></div>
</div>

<div class="info-panel">
    <h4>Bogosort (Stupid Sort)</h4>
    <p>The anti-algorithm: randomly shuffle the array, then check if it happens to be sorted. If not, shuffle again. And again. And again...</p>
    <p class="complexity">
        Worst:&nbsp;&nbsp;&nbsp;O(&infin;) unbounded!<br>
        Average: O(n &times; n!)<br>
        Best:&nbsp;&nbsp;&nbsp;&nbsp;O(n) (already sorted)<br>
        Space:&nbsp;&nbsp;&nbsp;O(1)
    </p>
    <p style="margin-top:6px;color:#888;">For 6 elements, expect ~720 shuffles on average. Don't try this on real data.</p>
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

let arr = [];
let n = 6;
let speed = 50;
let running = false;
let sorted = false;

let shuffles = 0, checks = 0;
let checkIndex = -1;
let phase = 'idle'; // idle, checking, shuffling
let checkPassed = [];
let shuffleAnim = 0;
let shakeOffsets = [];

function factorial(x) {
    let r = 1;
    for (let i = 2; i <= x; i++) r *= i;
    return r;
}

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
resize();
window.addEventListener('resize', resize);

function generateArray() {
    arr = [];
    for (let k = 0; k < n; k++) {
        arr.push((k + 1) / (n + 1));
    }
    // Fisher-Yates shuffle
    for (let i = arr.length - 1; i > 0; i--) {
        let j = Math.floor(Math.random() * (i + 1));
        let tmp = arr[i]; arr[i] = arr[j]; arr[j] = tmp;
    }
    shuffles = 0; checks = 0;
    checkIndex = -1;
    phase = 'idle';
    checkPassed = new Array(n).fill(false);
    shakeOffsets = new Array(n).fill(0);
    shuffleAnim = 0;
    sorted = false;
    running = false;
    updateStats();
    updateWarning();
    document.getElementById('btnStart').textContent = 'Start';
    document.getElementById('statusText').textContent = 'Ready';
    document.getElementById('checkOverlay').classList.remove('show');
}

function updateWarning() {
    let f = factorial(n);
    document.getElementById('warnN').textContent = n;
    document.getElementById('warnFact').textContent = f.toLocaleString();
    document.getElementById('expectedVal').textContent = f.toLocaleString();
}

function valueToColor(val) {
    return 'hsl(' + ((1 - val) * 240) + ', 85%, 55%)';
}

function draw() {
    ctx.fillStyle = '#0a0e1a';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    let padding = Math.max(80, canvas.width * 0.15);
    let topPad = 100;
    let bottomPad = 120;
    let drawWidth = canvas.width - padding * 2;
    let drawHeight = canvas.height - topPad - bottomPad;
    let barWidth = drawWidth / n;
    let gapPx = Math.max(2, barWidth * 0.15);

    // Title
    ctx.font = 'bold 14px monospace';
    ctx.fillStyle = '#ff6b6b';
    ctx.textAlign = 'center';
    if (phase === 'shuffling') {
        ctx.fillText('SHUFFLING...', canvas.width / 2, topPad - 30);
    } else if (phase === 'checking') {
        ctx.fillText('Is it sorted? Checking...', canvas.width / 2, topPad - 30);
    }

    for (let k = 0; k < n; k++) {
        let barH = arr[k] * drawHeight;
        let shake = shakeOffsets[k] || 0;
        let x = padding + k * barWidth + shake;
        let y = topPad + drawHeight - barH;

        let color;
        if (sorted) {
            color = '#2ecc71';
        } else if (phase === 'checking' && k <= checkIndex) {
            color = checkPassed[k] ? '#2ecc71' : '#ff4444';
        } else if (phase === 'shuffling') {
            color = '#ff6b6b';
        } else {
            color = valueToColor(arr[k]);
        }

        ctx.fillStyle = color;
        ctx.fillRect(x + gapPx / 2, y, barWidth - gapPx, barH);

        // Bar shine
        if (barWidth > 10) {
            ctx.fillStyle = 'rgba(255,255,255,0.15)';
            ctx.fillRect(x + gapPx / 2, y, 2, barH);
        }

        // Check mark / X below bar
        if (phase === 'checking' && k <= checkIndex) {
            ctx.font = 'bold 20px sans-serif';
            ctx.textAlign = 'center';
            if (checkPassed[k]) {
                ctx.fillStyle = '#2ecc71';
                ctx.fillText('\u2713', x + barWidth / 2, topPad + drawHeight + 28);
            } else {
                ctx.fillStyle = '#ff4444';
                ctx.fillText('\u2717', x + barWidth / 2, topPad + drawHeight + 28);
            }
        }

        // Value label
        ctx.font = '12px monospace';
        ctx.fillStyle = '#ccc';
        ctx.textAlign = 'center';
        ctx.fillText(Math.round(arr[k] * n), x + barWidth / 2, y - 8);
    }

    // Shuffle counter big display
    if (shuffles > 0) {
        ctx.font = 'bold 16px monospace';
        ctx.fillStyle = 'rgba(255,107,107,0.3)';
        ctx.textAlign = 'center';
        ctx.fillText('Attempt #' + shuffles.toLocaleString(), canvas.width / 2, canvas.height - 30);
    }

    requestAnimationFrame(draw);
}

function updateStats() {
    document.getElementById('shuffleCount').textContent = shuffles.toLocaleString();
    document.getElementById('checkCount').textContent = checks.toLocaleString();
    document.getElementById('checkProgress').textContent = checkIndex >= 0 ? (checkIndex + 1) + '/' + n : '--';
}

function isSorted() {
    for (let i = 0; i < arr.length - 1; i++) {
        if (arr[i] > arr[i + 1]) return false;
    }
    return true;
}

function shuffleArray() {
    for (let i = arr.length - 1; i > 0; i--) {
        let j = Math.floor(Math.random() * (i + 1));
        let tmp = arr[i]; arr[i] = arr[j]; arr[j] = tmp;
    }
    shuffles++;
    // Random shake offsets for visual flair
    for (let i = 0; i < n; i++) {
        shakeOffsets[i] = (Math.random() - 0.5) * 15;
    }
    setTimeout(function() {
        for (let i = 0; i < n; i++) shakeOffsets[i] = 0;
    }, 80);
}

function bogoStep() {
    if (sorted) return;

    if (phase === 'idle' || phase === 'shuffling') {
        // Shuffle then start checking
        shuffleArray();
        phase = 'checking';
        checkIndex = -1;
        checkPassed = new Array(n).fill(false);
        updateStats();
        return;
    }

    if (phase === 'checking') {
        checkIndex++;
        checks++;
        if (checkIndex < n - 1) {
            if (arr[checkIndex] <= arr[checkIndex + 1]) {
                checkPassed[checkIndex] = true;
                checkPassed[checkIndex + 1] = true;
            } else {
                // Failed
                checkPassed[checkIndex] = false;
                phase = 'shuffling';
                updateStats();
                return;
            }
        }
        if (checkIndex >= n - 1) {
            // All checks passed
            checkPassed[n - 1] = true;
            sorted = true;
            running = false;
            phase = 'idle';
            document.getElementById('btnStart').textContent = 'Start';
            document.getElementById('statusText').textContent = 'Sorted! (' + shuffles + ' shuffles)';
            document.getElementById('checkOverlay').classList.add('show');
        }
        updateStats();
    }
}

let lastTime = 0;
function sortLoop(timestamp) {
    if (!running) return;
    if (!lastTime) lastTime = timestamp;

    let delay = Math.max(5, 300 - speed * 3);
    if (timestamp - lastTime >= delay) {
        lastTime = timestamp;
        let steps = speed > 90 ? 3 : (speed > 70 ? 2 : 1);
        for (let s = 0; s < steps && !sorted; s++) {
            bogoStep();
        }
    }
    if (running) requestAnimationFrame(sortLoop);
}

function startSort() {
    if (sorted) { generateArray(); return; }
    running = !running;
    if (phase === 'idle') phase = 'shuffling';
    document.getElementById('btnStart').textContent = running ? 'Pause' : 'Resume';
    document.getElementById('statusText').textContent = running ? 'Sorting... (good luck)' : 'Paused';
    if (running) {
        lastTime = 0;
        requestAnimationFrame(sortLoop);
    }
}

function doStep() {
    if (sorted) { generateArray(); return; }
    running = false;
    if (phase === 'idle') phase = 'shuffling';
    document.getElementById('btnStart').textContent = 'Resume';
    document.getElementById('statusText').textContent = 'Step mode';
    bogoStep();
}

document.getElementById('sizeSlider').addEventListener('input', function() {
    n = parseInt(this.value);
    document.getElementById('sizeVal').textContent = n;
    generateArray();
});
document.getElementById('speedSlider').addEventListener('input', function() {
    speed = parseInt(this.value);
    document.getElementById('speedVal').textContent = speed;
});
document.getElementById('btnStart').addEventListener('click', startSort);
document.getElementById('btnStep').addEventListener('click', doStep);
document.getElementById('btnNew').addEventListener('click', generateArray);

window.reset = function() {
    generateArray();
};

generateArray();
requestAnimationFrame(draw);
</script>
<script src="../assets/js/enhance.js"></script>
</body>
</html>
