<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Ising Model - Phase Transition</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        canvas { display: block; }
        .controls {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 5px;
        }
        input { width: 200px; }
    </style>
</head>
<body>
    <div class="controls">
        <h3>3D Ising Model</h3>
        <label>Temperature: <span id="temp">4.5</span></label><br>
        <input type="range" id="temperature" min="1" max="8" step="0.1" value="4.5"><br>
        <label>Layer: <span id="layerNum">15</span></label><br>
        <input type="range" id="layer" min="0" max="29" value="15"><br>
        <div style="margin-top:10px; font-size:12px">
            <div>Magnetization: <span id="mag">0</span></div>
            <div>Tc (3D) â‰ˆ 4.511</div>
        </div>
    </div>
    <canvas id="canvas"></canvas>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const gridSize = 30;
        const cellSize = 15;
        canvas.width = gridSize * cellSize;
        canvas.height = gridSize * cellSize;

        let lattice3D = [];
        let temperature = 4.5;
        let currentLayer = 15;

        function initLattice() {
            lattice3D = [];
            for (let z = 0; z < gridSize; z++) {
                lattice3D[z] = [];
                for (let x = 0; x < gridSize; x++) {
                    lattice3D[z][x] = [];
                    for (let y = 0; y < gridSize; y++) {
                        lattice3D[z][x][y] = Math.random() < 0.5 ? 1 : -1;
                    }
                }
            }
        }

        function getEnergy(z, x, y) {
            const spin = lattice3D[z][x][y];
            const neighbors =
                lattice3D[(z+1)%gridSize][x][y] +
                lattice3D[(z-1+gridSize)%gridSize][x][y] +
                lattice3D[z][(x+1)%gridSize][y] +
                lattice3D[z][(x-1+gridSize)%gridSize][y] +
                lattice3D[z][x][(y+1)%gridSize] +
                lattice3D[z][x][(y-1+gridSize)%gridSize];
            return -spin * neighbors;
        }

        function mcStep() {
            for (let n = 0; n < gridSize * gridSize * gridSize / 10; n++) {
                const z = Math.floor(Math.random() * gridSize);
                const x = Math.floor(Math.random() * gridSize);
                const y = Math.floor(Math.random() * gridSize);

                const dE = -2 * getEnergy(z, x, y);

                if (dE < 0 || Math.random() < Math.exp(-dE / temperature)) {
                    lattice3D[z][x][y] *= -1;
                }
            }
        }

        function getMagnetization() {
            let sum = 0;
            for (let z = 0; z < gridSize; z++) {
                for (let x = 0; x < gridSize; x++) {
                    for (let y = 0; y < gridSize; y++) {
                        sum += lattice3D[z][x][y];
                    }
                }
            }
            return sum / (gridSize * gridSize * gridSize);
        }

        function render() {
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const layer = lattice3D[currentLayer];
            for (let x = 0; x < gridSize; x++) {
                for (let y = 0; y < gridSize; y++) {
                    const spin = layer[x][y];
                    ctx.fillStyle = spin === 1 ? '#ffffff' : '#222222';
                    ctx.fillRect(x * cellSize, y * cellSize, cellSize-1, cellSize-1);
                }
            }

            document.getElementById('mag').textContent = getMagnetization().toFixed(3);
        }

        function animate() {
            mcStep();
            render();
            requestAnimationFrame(animate);
        }

        document.getElementById('temperature').addEventListener('input', (e) => {
            temperature = parseFloat(e.target.value);
            document.getElementById('temp').textContent = temperature.toFixed(1);
        });

        document.getElementById('layer').addEventListener('input', (e) => {
            currentLayer = parseInt(e.target.value);
            document.getElementById('layerNum').textContent = currentLayer;
        });

        initLattice();
        animate();
    </script>
</body>
</html>
