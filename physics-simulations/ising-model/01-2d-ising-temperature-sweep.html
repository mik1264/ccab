<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2D Ising Model - Temperature Sweep</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }
        canvas {
            border: 2px solid #333;
            image-rendering: pixelated;
        }
        .controls {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 15px;
            border-radius: 5px;
            font-size: 14px;
        }
        .controls input {
            width: 200px;
        }
        .stats {
            margin-top: 10px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="controls">
        <h3>2D Ising Model</h3>
        <label>Temperature (T): <span id="tempValue">2.27</span></label><br>
        <input type="range" id="temperature" min="0.5" max="5" step="0.01" value="2.27"><br>
        <div class="stats">
            <div>Magnetization: <span id="magnetization">0</span></div>
            <div>Energy: <span id="energy">0</span></div>
            <div>Critical Temp (Tc): 2.269</div>
        </div>
    </div>
    <canvas id="canvas"></canvas>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const size = 200;
        canvas.width = size;
        canvas.height = size;

        // Scale for display
        canvas.style.width = '600px';
        canvas.style.height = '600px';

        let lattice = [];
        let temperature = 2.27;
        const J = 1.0; // Coupling constant
        const k = 1.0; // Boltzmann constant

        // Initialize lattice with random spins
        function initLattice() {
            lattice = [];
            for (let i = 0; i < size; i++) {
                lattice[i] = [];
                for (let j = 0; j < size; j++) {
                    lattice[i][j] = Math.random() < 0.5 ? 1 : -1;
                }
            }
        }

        // Calculate energy of a spin with its neighbors
        function getEnergy(i, j) {
            const spin = lattice[i][j];
            const neighbors =
                lattice[(i+1)%size][j] +
                lattice[(i-1+size)%size][j] +
                lattice[i][(j+1)%size] +
                lattice[i][(j-1+size)%size];
            return -J * spin * neighbors;
        }

        // Metropolis Monte Carlo step
        function mcStep() {
            for (let n = 0; n < size * size; n++) {
                const i = Math.floor(Math.random() * size);
                const j = Math.floor(Math.random() * size);

                const dE = -2 * getEnergy(i, j);

                if (dE < 0 || Math.random() < Math.exp(-dE / (k * temperature))) {
                    lattice[i][j] *= -1;
                }
            }
        }

        // Calculate total magnetization
        function getMagnetization() {
            let sum = 0;
            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    sum += lattice[i][j];
                }
            }
            return sum / (size * size);
        }

        // Calculate total energy
        function getTotalEnergy() {
            let energy = 0;
            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    energy += getEnergy(i, j);
                }
            }
            return energy / (size * size) / 2; // Divide by 2 to avoid double counting
        }

        // Render the lattice
        function render() {
            const imageData = ctx.createImageData(size, size);
            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    const idx = (i * size + j) * 4;
                    const color = lattice[i][j] === 1 ? 255 : 0;
                    imageData.data[idx] = color;
                    imageData.data[idx + 1] = color;
                    imageData.data[idx + 2] = color;
                    imageData.data[idx + 3] = 255;
                }
            }
            ctx.putImageData(imageData, 0, 0);

            // Update stats
            document.getElementById('magnetization').textContent = getMagnetization().toFixed(3);
            document.getElementById('energy').textContent = getTotalEnergy().toFixed(3);
        }

        // Animation loop
        function animate() {
            for (let i = 0; i < 10; i++) {
                mcStep();
            }
            render();
            requestAnimationFrame(animate);
        }

        // Controls
        document.getElementById('temperature').addEventListener('input', (e) => {
            temperature = parseFloat(e.target.value);
            document.getElementById('tempValue').textContent = temperature.toFixed(2);
        });

        initLattice();
        animate();
    </script>
</body>
</html>
