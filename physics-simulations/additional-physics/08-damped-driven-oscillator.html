<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Damped & Driven Harmonic Oscillator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        #container {
            position: relative;
        }
        canvas {
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            box-shadow: 0 0 40px rgba(100, 200, 255, 0.3);
            background: #0a0a15;
        }
        .back-link {
            position: fixed;
            top: 15px;
            left: 15px;
            color: #88ddff;
            text-decoration: none;
            font-size: 14px;
            opacity: 0.8;
            z-index: 100;
        }
        .back-link:hover {
            opacity: 1;
        }
        .info {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            background: rgba(0, 0, 0, 0.85);
            padding: 15px 20px;
            border-radius: 10px;
            font-size: 13px;
            line-height: 1.6;
            max-width: 280px;
            backdrop-filter: blur(10px);
        }
        .info h3 {
            color: #88ddff;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .info .equation {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            color: #ffdd88;
            margin: 8px 0;
            font-size: 14px;
        }
        .controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .control-group {
            background: rgba(0, 0, 0, 0.85);
            padding: 10px 15px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .control-group label {
            color: #88ddff;
            font-size: 11px;
            font-weight: 500;
            min-width: 60px;
        }
        .control-group input[type="range"] {
            width: 80px;
            accent-color: #88ddff;
        }
        .control-group .value {
            color: #fff;
            font-size: 11px;
            min-width: 35px;
            text-align: right;
        }
        .control-group button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: transform 0.2s;
        }
        .control-group button:hover {
            transform: scale(1.05);
        }
        .mode-indicator {
            position: absolute;
            top: 20px;
            left: 80px;
            background: rgba(0, 0, 0, 0.85);
            padding: 10px 15px;
            border-radius: 8px;
            color: white;
            font-size: 12px;
        }
        .mode-indicator span {
            display: block;
            margin: 3px 0;
        }
        .underdamped { color: #88ff88; }
        .critically { color: #ffff88; }
        .overdamped { color: #ff8888; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back</a>
    <div id="container">
        <canvas id="canvas"></canvas>
        <div class="info">
            <h3>Damped & Driven Oscillator</h3>
            <div class="equation">m x'' + c x' + k x = F cos(wt)</div>
            <p><strong>Damping (c):</strong> Energy loss rate</p>
            <p><strong>Driving (F):</strong> External periodic force</p>
            <p><strong>Resonance:</strong> Max amplitude when w = w0</p>
        </div>
        <div class="mode-indicator">
            <span>Damping Mode: <span id="dampMode">Underdamped</span></span>
            <span>Amplitude: <span id="ampDisplay">0.0</span></span>
        </div>
        <div class="controls">
            <div class="control-group">
                <label>Damping (c)</label>
                <input type="range" id="damping" min="0" max="2" step="0.01" value="0.1">
                <span class="value" id="dampVal">0.10</span>
            </div>
            <div class="control-group">
                <label>Spring (k)</label>
                <input type="range" id="spring" min="0.5" max="5" step="0.1" value="1">
                <span class="value" id="springVal">1.0</span>
            </div>
            <div class="control-group">
                <label>Drive (F)</label>
                <input type="range" id="drive" min="0" max="2" step="0.05" value="0.5">
                <span class="value" id="driveVal">0.50</span>
            </div>
            <div class="control-group">
                <label>Drive Freq</label>
                <input type="range" id="driveFreq" min="0.1" max="3" step="0.05" value="1">
                <span class="value" id="freqVal">1.00</span>
            </div>
            <div class="control-group">
                <button id="resetBtn">Reset</button>
                <button id="resonanceBtn">Set Resonance</button>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        canvas.width = 900;
        canvas.height = 700;

        // Physics parameters
        let damping = 0.1;      // Damping coefficient (c)
        let springK = 1.0;      // Spring constant (k)
        let driveForce = 0.5;   // Driving force amplitude (F)
        let driveFreq = 1.0;    // Driving frequency (w)
        const mass = 1.0;       // Mass (m)

        // State variables
        let x = 100;            // Position (displacement from equilibrium)
        let v = 0;              // Velocity
        let t = 0;              // Time
        const dt = 0.05;        // Time step

        // Trail history for phase space and position
        const positionHistory = [];
        const phaseHistory = [];
        const maxHistory = 500;

        // Amplitude tracking
        let maxAmplitude = 0;
        let amplitudeDecay = 0.99;

        // UI Elements
        const dampingSlider = document.getElementById('damping');
        const springSlider = document.getElementById('spring');
        const driveSlider = document.getElementById('drive');
        const driveFreqSlider = document.getElementById('driveFreq');
        const dampVal = document.getElementById('dampVal');
        const springVal = document.getElementById('springVal');
        const driveVal = document.getElementById('driveVal');
        const freqVal = document.getElementById('freqVal');
        const dampModeDisplay = document.getElementById('dampMode');
        const ampDisplay = document.getElementById('ampDisplay');

        // Event listeners
        dampingSlider.addEventListener('input', (e) => {
            damping = parseFloat(e.target.value);
            dampVal.textContent = damping.toFixed(2);
            updateDampingMode();
        });

        springSlider.addEventListener('input', (e) => {
            springK = parseFloat(e.target.value);
            springVal.textContent = springK.toFixed(1);
            updateDampingMode();
        });

        driveSlider.addEventListener('input', (e) => {
            driveForce = parseFloat(e.target.value);
            driveVal.textContent = driveForce.toFixed(2);
        });

        driveFreqSlider.addEventListener('input', (e) => {
            driveFreq = parseFloat(e.target.value);
            freqVal.textContent = driveFreq.toFixed(2);
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            x = 100;
            v = 0;
            t = 0;
            positionHistory.length = 0;
            phaseHistory.length = 0;
            maxAmplitude = 0;
        });

        document.getElementById('resonanceBtn').addEventListener('click', () => {
            // Set driving frequency to natural frequency for resonance
            const omega0 = Math.sqrt(springK / mass);
            driveFreq = omega0;
            driveFreqSlider.value = driveFreq;
            freqVal.textContent = driveFreq.toFixed(2);
        });

        function updateDampingMode() {
            const omega0 = Math.sqrt(springK / mass);
            const gamma = damping / (2 * mass);
            const criticalDamping = 2 * Math.sqrt(springK * mass);

            if (damping < criticalDamping * 0.99) {
                dampModeDisplay.textContent = 'Underdamped';
                dampModeDisplay.className = 'underdamped';
            } else if (damping > criticalDamping * 1.01) {
                dampModeDisplay.textContent = 'Overdamped';
                dampModeDisplay.className = 'overdamped';
            } else {
                dampModeDisplay.textContent = 'Critical';
                dampModeDisplay.className = 'critically';
            }
        }

        function simulate() {
            // Damped driven harmonic oscillator equation:
            // m*x'' + c*x' + k*x = F*cos(w*t)
            // x'' = (F*cos(w*t) - c*x' - k*x) / m

            const drivingForce = driveForce * Math.cos(driveFreq * t);
            const acceleration = (drivingForce - damping * v - springK * x) / mass;

            // Velocity Verlet integration for better accuracy
            v += acceleration * dt;
            x += v * dt;
            t += dt;

            // Track amplitude
            const currentAmp = Math.abs(x);
            if (currentAmp > maxAmplitude) {
                maxAmplitude = currentAmp;
            } else {
                maxAmplitude *= amplitudeDecay;
            }

            // Store history
            positionHistory.push({ t: t, x: x });
            phaseHistory.push({ x: x, v: v });

            if (positionHistory.length > maxHistory) {
                positionHistory.shift();
                phaseHistory.shift();
            }
        }

        function drawSpring(x1, y1, x2, y2, coils) {
            ctx.beginPath();
            ctx.moveTo(x1, y1);

            const dx = x2 - x1;
            const dy = y2 - y1;
            const len = Math.sqrt(dx * dx + dy * dy);
            const coilWidth = 15;

            for (let i = 0; i <= coils; i++) {
                const t = i / coils;
                const px = x1 + dx * t;
                const py = y1 + dy * t;
                const offset = (i % 2 === 0 ? 1 : -1) * coilWidth * Math.sin(t * Math.PI);

                if (i === 0 || i === coils) {
                    ctx.lineTo(px, py);
                } else {
                    ctx.lineTo(px, py + offset);
                }
            }

            ctx.strokeStyle = '#88ddff';
            ctx.lineWidth = 2;
            ctx.stroke();
        }

        function drawDamper(x1, y1, x2, y2) {
            const mx = (x1 + x2) / 2;
            const my = (y1 + y2) / 2;
            const width = 20;
            const height = 30;

            ctx.strokeStyle = '#ff8888';
            ctx.lineWidth = 2;

            // Piston shaft
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(mx - 5, my);
            ctx.stroke();

            // Cylinder
            ctx.strokeRect(mx - width/2, my - height/2, width, height);

            // Piston
            ctx.beginPath();
            ctx.moveTo(mx + 5, my);
            ctx.lineTo(x2, y2);
            ctx.stroke();
        }

        function draw() {
            ctx.fillStyle = '#0a0a15';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const centerY = 180;
            const equilibriumX = 300;
            const massX = equilibriumX + x;
            const massRadius = 25;

            // Draw wall
            ctx.fillStyle = '#444';
            ctx.fillRect(50, centerY - 60, 20, 120);

            // Draw equilibrium line
            ctx.setLineDash([5, 5]);
            ctx.strokeStyle = '#666';
            ctx.beginPath();
            ctx.moveTo(equilibriumX, centerY - 80);
            ctx.lineTo(equilibriumX, centerY + 80);
            ctx.stroke();
            ctx.setLineDash([]);

            // Draw spring (top)
            drawSpring(70, centerY - 20, massX - massRadius, centerY - 20, 12);

            // Draw damper (bottom)
            drawDamper(70, centerY + 20, massX - massRadius, centerY + 20);

            // Draw mass
            const gradient = ctx.createRadialGradient(massX, centerY, 0, massX, centerY, massRadius);
            gradient.addColorStop(0, '#88ddff');
            gradient.addColorStop(1, '#4488aa');
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(massX, centerY, massRadius, 0, Math.PI * 2);
            ctx.fill();
            ctx.strokeStyle = '#aaeeff';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Draw driving force arrow
            if (driveForce > 0) {
                const forceScale = 30;
                const forceX = driveForce * Math.cos(driveFreq * t) * forceScale;
                ctx.strokeStyle = '#ffdd88';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(massX + massRadius + 10, centerY);
                ctx.lineTo(massX + massRadius + 10 + forceX, centerY);
                ctx.stroke();

                // Arrow head
                if (Math.abs(forceX) > 5) {
                    const dir = forceX > 0 ? 1 : -1;
                    ctx.beginPath();
                    ctx.moveTo(massX + massRadius + 10 + forceX, centerY);
                    ctx.lineTo(massX + massRadius + 10 + forceX - dir * 10, centerY - 5);
                    ctx.lineTo(massX + massRadius + 10 + forceX - dir * 10, centerY + 5);
                    ctx.closePath();
                    ctx.fillStyle = '#ffdd88';
                    ctx.fill();
                }
            }

            // Draw position vs time graph
            const graphX = 50;
            const graphY = 320;
            const graphW = 400;
            const graphH = 150;

            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;
            ctx.strokeRect(graphX, graphY, graphW, graphH);

            // Graph title
            ctx.fillStyle = '#88ddff';
            ctx.font = '14px Segoe UI';
            ctx.fillText('Position vs Time', graphX, graphY - 10);

            // Zero line
            ctx.strokeStyle = '#444';
            ctx.beginPath();
            ctx.moveTo(graphX, graphY + graphH / 2);
            ctx.lineTo(graphX + graphW, graphY + graphH / 2);
            ctx.stroke();

            // Plot position history
            if (positionHistory.length > 1) {
                ctx.beginPath();
                ctx.strokeStyle = '#88ddff';
                ctx.lineWidth = 2;

                for (let i = 0; i < positionHistory.length; i++) {
                    const px = graphX + (i / maxHistory) * graphW;
                    const py = graphY + graphH / 2 - (positionHistory[i].x / 150) * (graphH / 2);

                    if (i === 0) {
                        ctx.moveTo(px, py);
                    } else {
                        ctx.lineTo(px, py);
                    }
                }
                ctx.stroke();
            }

            // Draw phase space diagram
            const phaseX = 500;
            const phaseY = 320;
            const phaseW = 350;
            const phaseH = 350;

            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;
            ctx.strokeRect(phaseX, phaseY, phaseW, phaseH);

            // Phase space title
            ctx.fillStyle = '#88ddff';
            ctx.fillText('Phase Space (x vs v)', phaseX, phaseY - 10);

            // Axes
            ctx.strokeStyle = '#444';
            ctx.beginPath();
            ctx.moveTo(phaseX + phaseW / 2, phaseY);
            ctx.lineTo(phaseX + phaseW / 2, phaseY + phaseH);
            ctx.moveTo(phaseX, phaseY + phaseH / 2);
            ctx.lineTo(phaseX + phaseW, phaseY + phaseH / 2);
            ctx.stroke();

            // Axis labels
            ctx.fillStyle = '#666';
            ctx.font = '12px Segoe UI';
            ctx.fillText('x', phaseX + phaseW - 15, phaseY + phaseH / 2 - 10);
            ctx.fillText('v', phaseX + phaseW / 2 + 10, phaseY + 15);

            // Plot phase space trajectory
            if (phaseHistory.length > 1) {
                const scale = 1.5;

                for (let i = 1; i < phaseHistory.length; i++) {
                    const alpha = i / phaseHistory.length;
                    ctx.beginPath();

                    const px1 = phaseX + phaseW / 2 + phaseHistory[i-1].x * scale;
                    const py1 = phaseY + phaseH / 2 - phaseHistory[i-1].v * scale * 10;
                    const px2 = phaseX + phaseW / 2 + phaseHistory[i].x * scale;
                    const py2 = phaseY + phaseH / 2 - phaseHistory[i].v * scale * 10;

                    ctx.strokeStyle = `rgba(136, 221, 255, ${alpha})`;
                    ctx.lineWidth = 2;
                    ctx.moveTo(px1, py1);
                    ctx.lineTo(px2, py2);
                    ctx.stroke();
                }

                // Current point
                const lastPt = phaseHistory[phaseHistory.length - 1];
                const cpx = phaseX + phaseW / 2 + lastPt.x * scale;
                const cpy = phaseY + phaseH / 2 - lastPt.v * scale * 10;

                ctx.beginPath();
                ctx.arc(cpx, cpy, 5, 0, Math.PI * 2);
                ctx.fillStyle = '#ffdd88';
                ctx.fill();
            }

            // Update amplitude display
            ampDisplay.textContent = maxAmplitude.toFixed(1);

            // Draw resonance indicator
            const omega0 = Math.sqrt(springK / mass);
            const resonanceRatio = driveFreq / omega0;

            ctx.fillStyle = '#888';
            ctx.font = '12px Segoe UI';
            ctx.fillText(`Natural freq (w0): ${omega0.toFixed(2)}`, graphX, graphY + graphH + 25);
            ctx.fillText(`Drive/Natural ratio: ${resonanceRatio.toFixed(2)}`, graphX, graphY + graphH + 45);

            if (Math.abs(resonanceRatio - 1) < 0.1) {
                ctx.fillStyle = '#ff8888';
                ctx.fillText('RESONANCE!', graphX + 250, graphY + graphH + 35);
            }
        }

        function animate() {
            simulate();
            draw();
            requestAnimationFrame(animate);
        }

        updateDampingMode();
        animate();
    </script>
    <script src="../../assets/js/enhance.js" defer></script>
</body>
</html>
