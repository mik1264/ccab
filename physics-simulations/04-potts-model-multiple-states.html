<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Potts Model - Multiple States</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: Arial; }
        canvas { display: block; image-rendering: pixelated; }
        .controls {
            position: absolute; top: 10px; left: 10px;
            background: rgba(0,0,0,0.8); color: white;
            padding: 15px; border-radius: 5px;
        }
        input { width: 200px; }
    </style>
</head>
<body>
    <div class="controls">
        <h3>Potts Model (q-state)</h3>
        <label>Temperature: <span id="temp">1.0</span></label><br>
        <input type="range" id="temperature" min="0.5" max="3" step="0.01" value="1.0"><br>
        <label>States (q): <span id="qVal">5</span></label><br>
        <input type="range" id="qStates" min="2" max="12" value="5"><br>
    </div>
    <canvas id="canvas"></canvas>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const size = 150;
        canvas.width = size;
        canvas.height = size;
        canvas.style.width = '600px';
        canvas.style.height = '600px';

        let lattice, temperature = 1.0, q = 5;
        const colors = ['#e74c3c', '#3498db', '#2ecc71', '#f39c12', '#9b59b6', '#1abc9c', '#e67e22', '#34495e', '#f1c40f', '#95a5a6', '#d35400', '#c0392b'];

        function initLattice() {
            lattice = Array(size).fill().map(() => Array(size).fill().map(() => Math.floor(Math.random() * q)));
        }

        function getEnergy(i, j) {
            const state = lattice[i][j];
            let sameNeighbors = 0;
            [[1,0],[-1,0],[0,1],[0,-1]].forEach(([di,dj]) => {
                if (lattice[(i+di+size)%size][(j+dj+size)%size] === state) sameNeighbors++;
            });
            return -sameNeighbors;
        }

        function mcStep() {
            for (let n = 0; n < size * size / 2; n++) {
                const i = Math.floor(Math.random() * size);
                const j = Math.floor(Math.random() * size);
                const oldState = lattice[i][j];
                const oldE = getEnergy(i, j);
                lattice[i][j] = Math.floor(Math.random() * q);
                const newE = getEnergy(i, j);
                const dE = newE - oldE;
                if (dE > 0 && Math.random() > Math.exp(-dE / temperature)) {
                    lattice[i][j] = oldState;
                }
            }
        }

        function render() {
            const imgData = ctx.createImageData(size, size);
            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    const idx = (i * size + j) * 4;
                    const color = colors[lattice[i][j] % colors.length];
                    const rgb = parseInt(color.slice(1), 16);
                    imgData.data[idx] = (rgb >> 16) & 255;
                    imgData.data[idx+1] = (rgb >> 8) & 255;
                    imgData.data[idx+2] = rgb & 255;
                    imgData.data[idx+3] = 255;
                }
            }
            ctx.putImageData(imgData, 0, 0);
        }

        function animate() {
            mcStep();
            render();
            requestAnimationFrame(animate);
        }

        document.getElementById('temperature').oninput = e => {
            temperature = parseFloat(e.target.value);
            document.getElementById('temp').textContent = temperature.toFixed(2);
        };
        document.getElementById('qStates').oninput = e => {
            q = parseInt(e.target.value);
            document.getElementById('qVal').textContent = q;
            initLattice();
        };

        initLattice();
        animate();
    </script>
</body>
</html>
