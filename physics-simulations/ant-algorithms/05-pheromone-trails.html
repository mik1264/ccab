<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pheromone Trail Formation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
        }

        #canvas {
            display: block;
            background: #0a0a0a;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
        }

        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(26, 26, 46, 0.95);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            min-width: 280px;
        }

        .info {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(26, 26, 46, 0.95);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            max-width: 320px;
        }

        h1 {
            font-size: 1.3em;
            margin-bottom: 10px;
            color: #64ffda;
        }

        h2 {
            font-size: 1em;
            margin-bottom: 15px;
            color: #64ffda;
        }

        .control-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9em;
            color: #b0b0b0;
        }

        input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }

        .value {
            font-size: 0.85em;
            color: #64ffda;
        }

        button {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.3s;
        }

        button:hover {
            background: #764ba2;
        }

        .info p {
            font-size: 0.85em;
            line-height: 1.6;
            margin-bottom: 10px;
            color: #c0c0c0;
        }
    </style>
</head>
<body>
    <div class="info">
        <h1>Pheromone Trails</h1>
        <p>Watch ants create and follow pheromone trails. Ants deposit chemicals as they explore, and other ants are attracted to these trails.</p>
        <p>Brighter trails indicate higher pheromone concentration. Trails evaporate over time unless reinforced.</p>
        <p><strong>Click</strong> to place food sources.</p>
    </div>

    <div class="controls">
        <h2>Trail Parameters</h2>

        <div class="control-group">
            <label>Ant Count: <span class="value" id="countValue">100</span></label>
            <input type="range" id="countSlider" min="20" max="300" step="20" value="100">
        </div>

        <div class="control-group">
            <label>Deposit Rate: <span class="value" id="depositValue">5</span></label>
            <input type="range" id="depositSlider" min="1" max="20" step="1" value="5">
        </div>

        <div class="control-group">
            <label>Evaporation: <span class="value" id="evapValue">0.02</span></label>
            <input type="range" id="evapSlider" min="0.005" max="0.1" step="0.005" value="0.02">
        </div>

        <div class="control-group">
            <label>Diffusion: <span class="value" id="diffValue">0.5</span></label>
            <input type="range" id="diffSlider" min="0" max="2" step="0.1" value="0.5">
        </div>

        <div class="control-group">
            <label>Sensitivity: <span class="value" id="sensValue">5</span></label>
            <input type="range" id="sensSlider" min="1" max="20" step="1" value="5">
        </div>

        <button id="resetBtn">Reset Simulation</button>
        <button id="addFoodBtn">Add Random Food</button>
        <button id="pauseBtn">Pause</button>
    </div>

    <canvas id="canvas"></canvas>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let width = window.innerWidth;
        let height = window.innerHeight;
        canvas.width = width;
        canvas.height = height;

        const gridSize = 150;
        const cellSize = Math.min(width, height) / gridSize;

        let antCount = 100;
        let depositRate = 5;
        let evaporationRate = 0.02;
        let diffusionRate = 0.5;
        let sensitivity = 5;

        let pheromones;
        let newPheromones;
        let ants = [];
        let foodSources = [];
        let nest;
        let paused = false;

        function init() {
            pheromones = new Float32Array(gridSize * gridSize);
            newPheromones = new Float32Array(gridSize * gridSize);

            nest = { x: gridSize / 2, y: gridSize / 2 };
            foodSources = [];

            // Add initial food sources
            for (let i = 0; i < 3; i++) {
                addRandomFood();
            }

            // Create ants
            ants = [];
            for (let i = 0; i < antCount; i++) {
                ants.push(createAnt());
            }
        }

        function createAnt() {
            return {
                x: nest.x + (Math.random() - 0.5) * 5,
                y: nest.y + (Math.random() - 0.5) * 5,
                angle: Math.random() * Math.PI * 2,
                hasFood: false,
                targetFood: null
            };
        }

        function addRandomFood() {
            const angle = Math.random() * Math.PI * 2;
            const dist = gridSize * 0.2 + Math.random() * gridSize * 0.2;
            foodSources.push({
                x: nest.x + Math.cos(angle) * dist,
                y: nest.y + Math.sin(angle) * dist,
                amount: 1000
            });
        }

        function moveAnt(ant) {
            const idx = Math.floor(ant.y) * gridSize + Math.floor(ant.x);

            if (!ant.hasFood) {
                // Search for food - follow pheromones and explore
                let leftPhero = 0, centerPhero = 0, rightPhero = 0;

                // Sample pheromones in three directions
                const angles = [ant.angle - 0.5, ant.angle, ant.angle + 0.5];
                const samples = [];

                for (const angle of angles) {
                    const sx = ant.x + Math.cos(angle) * 3;
                    const sy = ant.y + Math.sin(angle) * 3;

                    if (sx >= 0 && sx < gridSize && sy >= 0 && sy < gridSize) {
                        const sidx = Math.floor(sy) * gridSize + Math.floor(sx);
                        samples.push(pheromones[sidx]);
                    } else {
                        samples.push(0);
                    }
                }

                [leftPhero, centerPhero, rightPhero] = samples;

                // Steer towards higher pheromone concentration
                const total = leftPhero + centerPhero + rightPhero + 0.01;
                const rand = Math.random();

                if (rand < leftPhero / total) {
                    ant.angle -= 0.3;
                } else if (rand < (leftPhero + rightPhero) / total) {
                    ant.angle += 0.3;
                }

                // Random exploration
                ant.angle += (Math.random() - 0.5) * 0.5;

                // Check for food
                for (const food of foodSources) {
                    const dist = Math.hypot(ant.x - food.x, ant.y - food.y);
                    if (dist < 3 && food.amount > 0) {
                        ant.hasFood = true;
                        ant.targetFood = food;
                        food.amount--;
                        ant.angle += Math.PI; // Turn around
                        break;
                    }
                }
            } else {
                // Return to nest
                const dx = nest.x - ant.x;
                const dy = nest.y - ant.y;
                const targetAngle = Math.atan2(dy, dx);

                // Smooth angle transition
                let angleDiff = targetAngle - ant.angle;
                while (angleDiff > Math.PI) angleDiff -= Math.PI * 2;
                while (angleDiff < -Math.PI) angleDiff += Math.PI * 2;

                ant.angle += angleDiff * 0.1;

                // Deposit pheromones
                if (idx >= 0 && idx < pheromones.length) {
                    pheromones[idx] += depositRate;
                }

                // Check if reached nest
                const distToNest = Math.hypot(ant.x - nest.x, ant.y - nest.y);
                if (distToNest < 3) {
                    ant.hasFood = false;
                    ant.angle = Math.random() * Math.PI * 2;
                }
            }

            // Move forward
            ant.x += Math.cos(ant.angle) * 1.5;
            ant.y += Math.sin(ant.angle) * 1.5;

            // Boundary conditions
            ant.x = Math.max(0, Math.min(gridSize - 1, ant.x));
            ant.y = Math.max(0, Math.min(gridSize - 1, ant.y));
        }

        function diffusePheromones() {
            for (let y = 1; y < gridSize - 1; y++) {
                for (let x = 1; x < gridSize - 1; x++) {
                    const idx = y * gridSize + x;

                    // Simple diffusion
                    const sum = pheromones[idx] +
                        pheromones[idx - 1] + pheromones[idx + 1] +
                        pheromones[idx - gridSize] + pheromones[idx + gridSize];

                    newPheromones[idx] = pheromones[idx] * (1 - diffusionRate) +
                        (sum / 5) * diffusionRate;

                    // Evaporation
                    newPheromones[idx] *= (1 - evaporationRate);
                }
            }

            [pheromones, newPheromones] = [newPheromones, pheromones];
        }

        function step() {
            for (const ant of ants) {
                moveAnt(ant);
            }
            diffusePheromones();
        }

        function render() {
            const imageData = ctx.createImageData(width, height);
            const data = imageData.data;

            // Draw pheromones
            for (let py = 0; py < height; py++) {
                for (let px = 0; px < width; px++) {
                    const gx = Math.floor(px / cellSize);
                    const gy = Math.floor(py / cellSize);

                    if (gx < gridSize && gy < gridSize) {
                        const idx = gy * gridSize + gx;
                        const p = Math.min(1, pheromones[idx] / 30);

                        const pixelIdx = (py * width + px) * 4;
                        data[pixelIdx] = Math.floor(p * 100);
                        data[pixelIdx + 1] = Math.floor(p * 255);
                        data[pixelIdx + 2] = Math.floor(p * 218);
                        data[pixelIdx + 3] = 255;
                    }
                }
            }

            ctx.putImageData(imageData, 0, 0);

            // Draw nest
            ctx.fillStyle = '#4ecdc4';
            ctx.beginPath();
            ctx.arc(nest.x * cellSize, nest.y * cellSize, 10, 0, Math.PI * 2);
            ctx.fill();

            // Draw food
            ctx.fillStyle = '#ffe66d';
            for (const food of foodSources) {
                if (food.amount > 0) {
                    ctx.beginPath();
                    ctx.arc(food.x * cellSize, food.y * cellSize, 8, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            // Draw ants
            for (const ant of ants) {
                ctx.fillStyle = ant.hasFood ? '#ff6b6b' : '#ffffff';
                ctx.beginPath();
                ctx.arc(ant.x * cellSize, ant.y * cellSize, 2, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function animate() {
            if (!paused) {
                for (let i = 0; i < 3; i++) {
                    step();
                }
                render();
            }
            requestAnimationFrame(animate);
        }

        // Event listeners
        document.getElementById('countSlider').addEventListener('input', (e) => {
            antCount = parseInt(e.target.value);
            document.getElementById('countValue').textContent = antCount;
            init();
        });

        document.getElementById('depositSlider').addEventListener('input', (e) => {
            depositRate = parseFloat(e.target.value);
            document.getElementById('depositValue').textContent = depositRate;
        });

        document.getElementById('evapSlider').addEventListener('input', (e) => {
            evaporationRate = parseFloat(e.target.value);
            document.getElementById('evapValue').textContent = evaporationRate.toFixed(3);
        });

        document.getElementById('diffSlider').addEventListener('input', (e) => {
            diffusionRate = parseFloat(e.target.value);
            document.getElementById('diffValue').textContent = diffusionRate.toFixed(1);
        });

        document.getElementById('sensSlider').addEventListener('input', (e) => {
            sensitivity = parseFloat(e.target.value);
            document.getElementById('sensValue').textContent = sensitivity;
        });

        document.getElementById('resetBtn').addEventListener('click', init);

        document.getElementById('addFoodBtn').addEventListener('click', addRandomFood);

        document.getElementById('pauseBtn').addEventListener('click', (e) => {
            paused = !paused;
            e.target.textContent = paused ? 'Resume' : 'Pause';
        });

        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX - rect.left) / cellSize;
            const y = (e.clientY - rect.top) / cellSize;
            foodSources.push({ x, y, amount: 500 });
        });

        window.addEventListener('resize', () => {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
        });

        init();
        animate();
    </script>
</body>
</html>
