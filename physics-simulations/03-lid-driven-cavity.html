<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Lid-Driven Cavity Flow</title>
    <style>
        * { margin: 0; padding: 0; }
        body { background: #1a1a2e; color: #e0e0e0; font-family: sans-serif; overflow: hidden; }
        #canvas { display: block; }
        .info { position: fixed; top: 20px; left: 20px; background: rgba(26, 26, 46, 0.95); padding: 20px; border-radius: 10px; max-width: 300px; }
        h1 { font-size: 1.3em; color: #64ffda; margin-bottom: 10px; }
        p { font-size: 0.85em; color: #c0c0c0; line-height: 1.6; }
    </style>
</head>
<body>
    <div class="info">
        <h1>Lid-Driven Cavity</h1>
        <p>Classic CFD benchmark. Top wall moves horizontally, creating recirculating vortex flow inside the cavity.</p>
    </div>
    <canvas id="canvas"></canvas>
    <script>
        const N = 128, canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = N * 4; canvas.height = N * 4;

        const ex = [0, 1, 0, -1, 0, 1, -1, -1, 1];
        const ey = [0, 0, 1, 0, -1, 1, 1, -1, -1];
        const w = [4/9, 1/9, 1/9, 1/9, 1/9, 1/36, 1/36, 1/36, 1/36];
        const omega = 1.7;

        let f = Array(9).fill(0).map(() => new Float32Array(N * N));
        let ux = new Float32Array(N * N), uy = new Float32Array(N * N);
        let rho = new Float32Array(N * N);

        for (let i = 0; i < N * N; i++) {
            rho[i] = 1;
            for (let k = 0; k < 9; k++) f[k][i] = w[k];
        }

        function step() {
            for (let i = 0; i < N * N; i++) {
                const usq = ux[i] * ux[i] + uy[i] * uy[i];
                for (let k = 0; k < 9; k++) {
                    const cu = ex[k] * ux[i] + ey[k] * uy[i];
                    const feq = w[k] * rho[i] * (1 + 3 * cu + 4.5 * cu * cu - 1.5 * usq);
                    f[k][i] += omega * (feq - f[k][i]);
                }
            }

            const fnew = Array(9).fill(0).map(() => new Float32Array(N * N));
            for (let y = 0; y < N; y++) {
                for (let x = 0; x < N; x++) {
                    const idx = y * N + x;
                    for (let k = 0; k < 9; k++) {
                        let nx = x + ex[k], ny = y + ey[k];
                        if (nx >= 0 && nx < N && ny >= 0 && ny < N) {
                            fnew[k][ny * N + nx] = f[k][idx];
                        } else {
                            const opp = [0, 3, 4, 1, 2, 7, 8, 5, 6][k];
                            fnew[opp][idx] = f[k][idx];
                        }
                    }
                }
            }
            f = fnew;

            for (let i = 0; i < N * N; i++) {
                rho[i] = 0; ux[i] = 0; uy[i] = 0;
                for (let k = 0; k < 9; k++) {
                    rho[i] += f[k][i];
                    ux[i] += ex[k] * f[k][i];
                    uy[i] += ey[k] * f[k][i];
                }
                ux[i] /= rho[i]; uy[i] /= rho[i];
            }

            for (let x = 0; x < N; x++) {
                ux[x] = 0.1; uy[x] = 0;
            }
        }

        function render() {
            const img = ctx.createImageData(canvas.width, canvas.height);
            const d = img.data;
            for (let py = 0; py < canvas.height; py++) {
                for (let px = 0; px < canvas.width; px++) {
                    const x = Math.floor(px / 4), y = Math.floor(py / 4);
                    const idx = y * N + x;
                    const speed = Math.sqrt(ux[idx] ** 2 + uy[idx] ** 2);
                    const v = Math.min(255, speed * 1000);
                    const pidx = (py * canvas.width + px) * 4;
                    d[pidx] = v * 0.5; d[pidx + 1] = v; d[pidx + 2] = v * 1.5; d[pidx + 3] = 255;
                }
            }
            ctx.putImageData(img, 0, 0);
        }

        function animate() {
            for (let i = 0; i < 5; i++) step();
            render();
            requestAnimationFrame(animate);
        }
        animate();
    </script>
</body>
</html>
