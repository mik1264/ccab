<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spring-Mass Systems</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            font-family: 'Segoe UI', system-ui, sans-serif;
            overflow: hidden;
        }

        #canvas {
            display: block;
        }

        .controls {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(20, 25, 45, 0.95);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(100, 200, 255, 0.3);
            z-index: 100;
            min-width: 280px;
        }

        h1 {
            font-size: 1.4em;
            margin-bottom: 5px;
            color: #64c8ff;
        }

        .subtitle {
            font-size: 0.85em;
            color: #888;
            margin-bottom: 15px;
        }

        .control-group {
            margin-bottom: 12px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.85em;
            color: #aaa;
        }

        select, input[type="range"] {
            width: 100%;
            padding: 8px;
            background: rgba(40, 50, 80, 0.8);
            border: 1px solid rgba(100, 200, 255, 0.3);
            border-radius: 6px;
            color: #fff;
            font-size: 0.9em;
        }

        input[type="range"] {
            -webkit-appearance: none;
            height: 8px;
            padding: 0;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #64c8ff;
            border-radius: 50%;
            cursor: pointer;
        }

        .btn-row {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        button {
            flex: 1;
            padding: 10px;
            background: linear-gradient(135deg, #0077b6, #00a8e8);
            border: none;
            border-radius: 6px;
            color: #fff;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 168, 232, 0.4);
        }

        .presets {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 10px;
        }

        .preset-btn {
            padding: 8px;
            font-size: 0.8em;
            background: rgba(60, 80, 120, 0.8);
        }

        .info {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(20, 25, 45, 0.95);
            padding: 15px;
            border-radius: 10px;
            font-size: 0.85em;
            border: 1px solid rgba(100, 200, 255, 0.3);
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            margin: 3px 0;
            gap: 15px;
        }

        .info-label {
            color: #888;
        }

        .info-value {
            color: #64c8ff;
            font-family: 'Consolas', monospace;
        }

        .formula {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(20, 25, 45, 0.95);
            padding: 15px;
            border-radius: 10px;
            font-size: 0.9em;
            border: 1px solid rgba(100, 200, 255, 0.3);
            text-align: center;
        }

        .formula h3 {
            color: #64c8ff;
            margin-bottom: 10px;
        }

        .formula-eq {
            font-family: 'Georgia', serif;
            font-style: italic;
            color: #fff;
            font-size: 1.1em;
        }

        .back-link {
            position: fixed;
            bottom: 20px;
            right: 20px;
            color: #64c8ff;
            text-decoration: none;
            padding: 10px 20px;
            background: rgba(20, 25, 45, 0.95);
            border-radius: 8px;
            border: 1px solid rgba(100, 200, 255, 0.3);
            transition: all 0.3s;
        }

        .back-link:hover {
            background: rgba(0, 168, 232, 0.2);
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>

    <div class="controls">
        <h1>⚛️ Spring-Mass Systems</h1>
        <p class="subtitle">Hooke's Law: F = -kx</p>

        <div class="control-group">
            <label>System Type</label>
            <select id="systemType">
                <option value="single">Single Oscillator</option>
                <option value="vertical">Vertical Chain (5 masses)</option>
                <option value="horizontal">Horizontal Chain</option>
                <option value="coupled">Coupled Pendulum</option>
                <option value="grid">2D Grid (Soft Body)</option>
            </select>
        </div>

        <div class="control-group">
            <label>Spring Constant (k): <span id="kValue">50</span></label>
            <input type="range" id="springK" min="10" max="200" value="50">
        </div>

        <div class="control-group">
            <label>Damping: <span id="dampValue">0.98</span></label>
            <input type="range" id="damping" min="0.9" max="1" step="0.005" value="0.98">
        </div>

        <div class="control-group">
            <label>Mass: <span id="massValue">1</span></label>
            <input type="range" id="mass" min="0.5" max="5" step="0.1" value="1">
        </div>

        <div class="control-group">
            <label>Gravity: <span id="gravValue">0.3</span></label>
            <input type="range" id="gravity" min="0" max="1" step="0.05" value="0.3">
        </div>

        <div class="btn-row">
            <button onclick="resetSystem()">Reset</button>
            <button onclick="perturb()">Perturb</button>
        </div>

        <div class="presets" style="margin-top: 15px;">
            <button class="preset-btn" onclick="loadPreset('bouncy')">Bouncy</button>
            <button class="preset-btn" onclick="loadPreset('stiff')">Stiff</button>
            <button class="preset-btn" onclick="loadPreset('damped')">Damped</button>
            <button class="preset-btn" onclick="loadPreset('chaotic')">Chaotic</button>
        </div>
    </div>

    <div class="formula">
        <h3>Physics</h3>
        <div class="formula-eq">F = -kx - bv + mg</div>
        <p style="color: #888; font-size: 0.8em; margin-top: 10px;">
            k = spring constant<br>
            b = damping<br>
            m = mass, g = gravity
        </p>
    </div>

    <div class="info">
        <div class="info-row">
            <span class="info-label">Total Energy:</span>
            <span class="info-value" id="energy">0.00</span>
        </div>
        <div class="info-row">
            <span class="info-label">Kinetic:</span>
            <span class="info-value" id="kinetic">0.00</span>
        </div>
        <div class="info-row">
            <span class="info-label">Potential:</span>
            <span class="info-value" id="potential">0.00</span>
        </div>
    </div>

    <a href="../index.html" class="back-link">← Back to Gallery</a>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // Parameters
        let springK = 50;
        let damping = 0.98;
        let massVal = 1;
        let gravity = 0.3;

        // System state
        let masses = [];
        let springs = [];
        let anchors = [];

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            resetSystem();
        }

        class Mass {
            constructor(x, y, mass, fixed = false) {
                this.x = x;
                this.y = y;
                this.prevX = x;
                this.prevY = y;
                this.mass = mass;
                this.fixed = fixed;
                this.radius = Math.sqrt(mass) * 15;
            }

            update(dt) {
                if (this.fixed) return;

                // Verlet integration
                const vx = (this.x - this.prevX) * damping;
                const vy = (this.y - this.prevY) * damping;

                this.prevX = this.x;
                this.prevY = this.y;

                this.x += vx;
                this.y += vy + gravity * this.mass;
            }

            applyForce(fx, fy) {
                if (this.fixed) return;
                this.x += fx / this.mass;
                this.y += fy / this.mass;
            }

            draw() {
                // Glow effect
                const gradient = ctx.createRadialGradient(
                    this.x, this.y, 0,
                    this.x, this.y, this.radius * 1.5
                );
                gradient.addColorStop(0, 'rgba(100, 200, 255, 0.8)');
                gradient.addColorStop(0.5, 'rgba(100, 200, 255, 0.3)');
                gradient.addColorStop(1, 'rgba(100, 200, 255, 0)');

                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius * 1.5, 0, Math.PI * 2);
                ctx.fill();

                // Mass ball
                ctx.fillStyle = this.fixed ? '#ff6b6b' : '#64c8ff';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();

                // Highlight
                ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.beginPath();
                ctx.arc(this.x - this.radius * 0.3, this.y - this.radius * 0.3,
                       this.radius * 0.4, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        class Spring {
            constructor(massA, massB, restLength, k) {
                this.massA = massA;
                this.massB = massB;
                this.restLength = restLength;
                this.k = k;
            }

            update() {
                const dx = this.massB.x - this.massA.x;
                const dy = this.massB.y - this.massA.y;
                const dist = Math.sqrt(dx * dx + dy * dy);

                if (dist === 0) return;

                const stretch = dist - this.restLength;
                const force = stretch * this.k;

                const fx = (dx / dist) * force;
                const fy = (dy / dist) * force;

                this.massA.applyForce(fx, fy);
                this.massB.applyForce(-fx, -fy);
            }

            draw() {
                const dx = this.massB.x - this.massA.x;
                const dy = this.massB.y - this.massA.y;
                const dist = Math.sqrt(dx * dx + dy * dy);

                // Draw spring coils
                const coils = 12;
                const amplitude = 10;

                ctx.strokeStyle = 'rgba(255, 200, 100, 0.8)';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(this.massA.x, this.massA.y);

                const angle = Math.atan2(dy, dx);
                const perpX = -Math.sin(angle);
                const perpY = Math.cos(angle);

                for (let i = 0; i <= coils; i++) {
                    const t = i / coils;
                    const x = this.massA.x + dx * t;
                    const y = this.massA.y + dy * t;
                    const offset = Math.sin(t * coils * Math.PI) * amplitude * (1 - Math.abs(t - 0.5) * 0.5);

                    ctx.lineTo(x + perpX * offset, y + perpY * offset);
                }

                ctx.stroke();

                // Stress indicator
                const stretch = Math.abs(dist - this.restLength) / this.restLength;
                const color = stretch > 0.5 ? '#ff6b6b' : stretch > 0.2 ? '#ffa500' : '#4ecdc4';
                ctx.strokeStyle = color;
                ctx.lineWidth = 3;
                ctx.stroke();
            }
        }

        function createSingleOscillator() {
            const cx = canvas.width / 2;
            const cy = canvas.height / 3;

            const anchor = new Mass(cx, cy - 50, 1, true);
            const bob = new Mass(cx, cy + 100, massVal, false);

            masses = [anchor, bob];
            springs = [new Spring(anchor, bob, 100, springK)];
        }

        function createVerticalChain() {
            const cx = canvas.width / 2;
            const startY = 100;
            const spacing = 80;
            const count = 5;

            masses = [];
            springs = [];

            const anchor = new Mass(cx, startY, 1, true);
            masses.push(anchor);

            for (let i = 0; i < count; i++) {
                const m = new Mass(cx, startY + spacing * (i + 1), massVal, false);
                masses.push(m);
                springs.push(new Spring(masses[i], m, spacing, springK));
            }
        }

        function createHorizontalChain() {
            const cy = canvas.height / 2;
            const startX = canvas.width * 0.2;
            const spacing = 80;
            const count = 6;

            masses = [];
            springs = [];

            const anchorLeft = new Mass(startX, cy, 1, true);
            masses.push(anchorLeft);

            for (let i = 0; i < count; i++) {
                const m = new Mass(startX + spacing * (i + 1), cy, massVal, false);
                masses.push(m);
                springs.push(new Spring(masses[i], m, spacing, springK));
            }

            // Right anchor
            const anchorRight = new Mass(startX + spacing * (count + 1), cy, 1, true);
            masses.push(anchorRight);
            springs.push(new Spring(masses[masses.length - 2], anchorRight, spacing, springK));
        }

        function createCoupledPendulum() {
            const startY = 100;
            const spacing = 150;
            const pendLength = 150;

            masses = [];
            springs = [];

            const cx = canvas.width / 2;

            // Two pendulums with coupling spring
            const anchor1 = new Mass(cx - spacing, startY, 1, true);
            const anchor2 = new Mass(cx + spacing, startY, 1, true);
            const bob1 = new Mass(cx - spacing + 30, startY + pendLength, massVal, false);
            const bob2 = new Mass(cx + spacing, startY + pendLength, massVal, false);

            masses = [anchor1, anchor2, bob1, bob2];

            // Pendulum springs
            springs.push(new Spring(anchor1, bob1, pendLength, springK));
            springs.push(new Spring(anchor2, bob2, pendLength, springK));

            // Coupling spring (weaker)
            springs.push(new Spring(bob1, bob2, spacing * 2, springK * 0.2));
        }

        function createGrid() {
            const rows = 6;
            const cols = 8;
            const spacing = 50;
            const startX = canvas.width / 2 - (cols - 1) * spacing / 2;
            const startY = 100;

            masses = [];
            springs = [];

            // Create masses
            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    const fixed = r === 0;
                    const m = new Mass(
                        startX + c * spacing,
                        startY + r * spacing,
                        massVal,
                        fixed
                    );
                    masses.push(m);
                }
            }

            // Create springs (structural)
            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    const idx = r * cols + c;

                    // Horizontal
                    if (c < cols - 1) {
                        springs.push(new Spring(masses[idx], masses[idx + 1], spacing, springK));
                    }

                    // Vertical
                    if (r < rows - 1) {
                        springs.push(new Spring(masses[idx], masses[idx + cols], spacing, springK));
                    }

                    // Diagonal (shear)
                    if (r < rows - 1 && c < cols - 1) {
                        springs.push(new Spring(masses[idx], masses[idx + cols + 1],
                            spacing * Math.SQRT2, springK * 0.5));
                    }
                    if (r < rows - 1 && c > 0) {
                        springs.push(new Spring(masses[idx], masses[idx + cols - 1],
                            spacing * Math.SQRT2, springK * 0.5));
                    }
                }
            }
        }

        function resetSystem() {
            const type = document.getElementById('systemType').value;

            switch (type) {
                case 'single': createSingleOscillator(); break;
                case 'vertical': createVerticalChain(); break;
                case 'horizontal': createHorizontalChain(); break;
                case 'coupled': createCoupledPendulum(); break;
                case 'grid': createGrid(); break;
            }
        }

        function perturb() {
            for (const m of masses) {
                if (!m.fixed) {
                    m.x += (Math.random() - 0.5) * 50;
                    m.y += (Math.random() - 0.5) * 50;
                }
            }
        }

        function loadPreset(name) {
            const presets = {
                bouncy: { k: 30, damp: 0.995, mass: 0.5, grav: 0.4 },
                stiff: { k: 150, damp: 0.98, mass: 2, grav: 0.3 },
                damped: { k: 50, damp: 0.92, mass: 1, grav: 0.3 },
                chaotic: { k: 80, damp: 0.995, mass: 0.8, grav: 0.5 }
            };

            const p = presets[name];
            springK = p.k;
            damping = p.damp;
            massVal = p.mass;
            gravity = p.grav;

            document.getElementById('springK').value = p.k;
            document.getElementById('damping').value = p.damp;
            document.getElementById('mass').value = p.mass;
            document.getElementById('gravity').value = p.grav;
            document.getElementById('kValue').textContent = p.k;
            document.getElementById('dampValue').textContent = p.damp.toFixed(3);
            document.getElementById('massValue').textContent = p.mass;
            document.getElementById('gravValue').textContent = p.grav;

            resetSystem();
        }

        function calculateEnergy() {
            let kinetic = 0;
            let potential = 0;

            for (const m of masses) {
                if (m.fixed) continue;

                const vx = m.x - m.prevX;
                const vy = m.y - m.prevY;
                kinetic += 0.5 * m.mass * (vx * vx + vy * vy) * 100;

                // Gravitational potential
                potential += m.mass * gravity * m.y * 0.1;
            }

            // Spring potential energy
            for (const s of springs) {
                const dx = s.massB.x - s.massA.x;
                const dy = s.massB.y - s.massA.y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                const stretch = dist - s.restLength;
                potential += 0.5 * s.k * stretch * stretch * 0.01;
            }

            return { kinetic, potential, total: kinetic + potential };
        }

        // Mouse interaction
        let dragging = null;

        canvas.addEventListener('mousedown', (e) => {
            const rect = canvas.getBoundingClientRect();
            const mx = e.clientX - rect.left;
            const my = e.clientY - rect.top;

            for (const m of masses) {
                const dx = mx - m.x;
                const dy = my - m.y;
                if (dx * dx + dy * dy < m.radius * m.radius * 4) {
                    dragging = m;
                    break;
                }
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            if (dragging) {
                const rect = canvas.getBoundingClientRect();
                dragging.x = e.clientX - rect.left;
                dragging.y = e.clientY - rect.top;
                dragging.prevX = dragging.x;
                dragging.prevY = dragging.y;
            }
        });

        canvas.addEventListener('mouseup', () => {
            dragging = null;
        });

        // UI updates
        document.getElementById('springK').addEventListener('input', (e) => {
            springK = parseFloat(e.target.value);
            document.getElementById('kValue').textContent = springK;
            for (const s of springs) s.k = springK;
        });

        document.getElementById('damping').addEventListener('input', (e) => {
            damping = parseFloat(e.target.value);
            document.getElementById('dampValue').textContent = damping.toFixed(3);
        });

        document.getElementById('mass').addEventListener('input', (e) => {
            massVal = parseFloat(e.target.value);
            document.getElementById('massValue').textContent = massVal;
            resetSystem();
        });

        document.getElementById('gravity').addEventListener('input', (e) => {
            gravity = parseFloat(e.target.value);
            document.getElementById('gravValue').textContent = gravity;
        });

        document.getElementById('systemType').addEventListener('change', resetSystem);

        function update() {
            // Multiple substeps for stability
            const substeps = 4;

            for (let s = 0; s < substeps; s++) {
                // Update springs
                for (const spring of springs) {
                    spring.update();
                }

                // Update masses
                for (const m of masses) {
                    m.update(1 / substeps);
                }
            }

            // Boundary constraints
            for (const m of masses) {
                if (m.y > canvas.height - m.radius) {
                    m.y = canvas.height - m.radius;
                    m.prevY = m.y + (m.y - m.prevY) * 0.5;
                }
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw springs first
            for (const spring of springs) {
                spring.draw();
            }

            // Draw masses on top
            for (const m of masses) {
                m.draw();
            }

            // Update energy display
            const energy = calculateEnergy();
            document.getElementById('energy').textContent = energy.total.toFixed(2);
            document.getElementById('kinetic').textContent = energy.kinetic.toFixed(2);
            document.getElementById('potential').textContent = energy.potential.toFixed(2);
        }

        function animate() {
            update();
            draw();
            requestAnimationFrame(animate);
        }

        // Initialize
        window.addEventListener('resize', resize);
        resize();
        animate();
    </script>
</body>
</html>
