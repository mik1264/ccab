<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Traffic Lights - Traffic & Urban</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); color: #eee; min-height: 100vh; padding: 20px; }
        .back-link { position: fixed; top: 20px; left: 20px; color: #facc15; text-decoration: none; font-weight: 600; padding: 8px 16px; background: rgba(0,0,0,0.3); border-radius: 20px; z-index: 100; }
        h1 { text-align: center; margin: 40px 0 10px; font-size: 2.2em; color: #facc15; }
        .subtitle { text-align: center; opacity: 0.8; margin-bottom: 20px; }
        .container { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 1fr 300px; gap: 20px; }
        .panel { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 25px; }
        .info-box { background: rgba(250, 204, 21, 0.1); border: 1px solid rgba(250, 204, 21, 0.3); border-radius: 8px; padding: 15px; margin-bottom: 20px; font-size: 0.85em; line-height: 1.6; }
        h3 { color: #facc15; margin-bottom: 15px; }
        canvas { width: 100%; border-radius: 8px; }
        .control-group { margin: 15px 0; }
        .control-group label { display: block; margin-bottom: 5px; }
        .control-group input, .control-group select { width: 100%; }
        .value-display { color: #facc15; font-family: monospace; }
        button { width: 100%; padding: 12px; margin: 8px 0; border: none; border-radius: 8px; font-size: 1em; font-weight: 600; cursor: pointer; }
        .btn-primary { background: #facc15; color: #1a1a2e; }
        .btn-secondary { background: rgba(255,255,255,0.1); color: #fff; }
        .light-status { display: flex; gap: 20px; justify-content: center; margin: 15px 0; }
        .light-box { text-align: center; padding: 15px; border-radius: 8px; background: rgba(0,0,0,0.3); }
        .light { width: 30px; height: 30px; border-radius: 50%; margin: 5px auto; }
        @media (max-width: 900px) { .container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back</a>
    <h1>Traffic Lights</h1>
    <p class="subtitle">Intersection timing and signal optimization</p>

    <div class="container">
        <div class="panel">
            <canvas id="canvas" width="800" height="500"></canvas>
        </div>

        <div class="panel">
            <div class="info-box">
                <strong>Signal Optimization:</strong>
                Traffic lights control flow at intersections.
                Optimal timing reduces wait times and improves throughput.
                Adaptive signals respond to real-time traffic conditions.
            </div>

            <h3>Current Signals</h3>
            <div class="light-status">
                <div class="light-box">
                    <div>N-S</div>
                    <div class="light" id="nsLight" style="background: #4ade80;"></div>
                </div>
                <div class="light-box">
                    <div>E-W</div>
                    <div class="light" id="ewLight" style="background: #f87171;"></div>
                </div>
            </div>

            <div class="control-group">
                <label>Signal Mode:</label>
                <select id="modeSelect" onchange="updateParams()">
                    <option value="fixed">Fixed Timing</option>
                    <option value="adaptive">Adaptive (Traffic-Based)</option>
                    <option value="coordinated">Coordinated (Green Wave)</option>
                </select>
            </div>

            <div class="control-group">
                <label>Green Duration: <span class="value-display" id="greenVal">30</span> sec</label>
                <input type="range" id="greenSlider" min="10" max="60" value="30" oninput="updateParams()">
            </div>

            <div class="control-group">
                <label>Yellow Duration: <span class="value-display" id="yellowVal">3</span> sec</label>
                <input type="range" id="yellowSlider" min="2" max="6" value="3" oninput="updateParams()">
            </div>

            <div class="control-group">
                <label>Traffic Volume: <span class="value-display" id="volumeVal">Medium</span></label>
                <input type="range" id="volumeSlider" min="1" max="10" value="5" oninput="updateParams()">
            </div>

            <button class="btn-primary" onclick="toggleSim()">Start/Stop</button>
            <button class="btn-secondary" onclick="resetSim()">Reset</button>

            <h3 style="margin-top: 15px;">Performance</h3>
            <div style="font-size: 0.9em;">
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Avg Wait Time:</span><span class="value-display" id="waitVal">0 sec</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Cars Passed:</span><span class="value-display" id="passedVal">0</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Queue Length:</span><span class="value-display" id="queueVal">0</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Cycle Time:</span><span class="value-display" id="cycleVal">0 sec</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let mode = 'fixed';
        let greenDuration = 30;
        let yellowDuration = 3;
        let trafficVolume = 5;

        let nsState = 'green'; // green, yellow, red
        let ewState = 'red';
        let cycleTime = 0;
        let stateTime = 0;

        let cars = [];
        let running = false;
        let time = 0;
        let totalWaitTime = 0;
        let carsPassed = 0;

        function updateParams() {
            mode = document.getElementById('modeSelect').value;
            greenDuration = parseInt(document.getElementById('greenSlider').value);
            yellowDuration = parseInt(document.getElementById('yellowSlider').value);
            trafficVolume = parseInt(document.getElementById('volumeSlider').value);

            document.getElementById('greenVal').textContent = greenDuration;
            document.getElementById('yellowVal').textContent = yellowDuration;
            const volumes = ['Very Low', 'Low', 'Low', 'Medium', 'Medium', 'Medium', 'High', 'High', 'Very High', 'Very High'];
            document.getElementById('volumeVal').textContent = volumes[trafficVolume - 1];
        }

        function updateLights() {
            stateTime++;
            cycleTime = stateTime;

            let cycleDuration = greenDuration;

            if (mode === 'adaptive') {
                // Count cars waiting
                const nsWaiting = cars.filter(c => (c.dir === 'n' || c.dir === 's') && c.waiting).length;
                const ewWaiting = cars.filter(c => (c.dir === 'e' || c.dir === 'w') && c.waiting).length;

                if (nsState === 'green' && nsWaiting < 2 && ewWaiting > 5) {
                    cycleDuration = Math.max(15, greenDuration - 10);
                }
            }

            // State transitions
            if (nsState === 'green' && stateTime >= cycleDuration) {
                nsState = 'yellow';
                stateTime = 0;
            } else if (nsState === 'yellow' && stateTime >= yellowDuration) {
                nsState = 'red';
                ewState = 'green';
                stateTime = 0;
            } else if (ewState === 'green' && stateTime >= cycleDuration) {
                ewState = 'yellow';
                stateTime = 0;
            } else if (ewState === 'yellow' && stateTime >= yellowDuration) {
                ewState = 'red';
                nsState = 'green';
                stateTime = 0;
            }

            // Update light indicators
            const nsLight = document.getElementById('nsLight');
            const ewLight = document.getElementById('ewLight');

            nsLight.style.background = nsState === 'green' ? '#4ade80' : nsState === 'yellow' ? '#facc15' : '#f87171';
            ewLight.style.background = ewState === 'green' ? '#4ade80' : ewState === 'yellow' ? '#facc15' : '#f87171';
        }

        function spawnCar() {
            const dirs = ['n', 's', 'e', 'w'];
            const dir = dirs[Math.floor(Math.random() * 4)];

            let x, y, vx, vy;
            const speed = 2 + Math.random();

            switch (dir) {
                case 'n':
                    x = canvas.width / 2 - 30;
                    y = canvas.height;
                    vx = 0; vy = -speed;
                    break;
                case 's':
                    x = canvas.width / 2 + 30;
                    y = 0;
                    vx = 0; vy = speed;
                    break;
                case 'e':
                    x = 0;
                    y = canvas.height / 2 + 30;
                    vx = speed; vy = 0;
                    break;
                case 'w':
                    x = canvas.width;
                    y = canvas.height / 2 - 30;
                    vx = -speed; vy = 0;
                    break;
            }

            cars.push({
                x, y, vx, vy, dir,
                baseSpeed: speed,
                waiting: false,
                waitStart: 0,
                color: `hsl(${Math.random() * 360}, 60%, 50%)`
            });
        }

        function updateCars() {
            const intersectionZone = {
                x1: canvas.width / 2 - 80,
                x2: canvas.width / 2 + 80,
                y1: canvas.height / 2 - 80,
                y2: canvas.height / 2 + 80
            };

            for (let i = cars.length - 1; i >= 0; i--) {
                const car = cars[i];

                // Check if approaching intersection
                const nearIntersection =
                    (car.dir === 'n' && car.y > intersectionZone.y2 && car.y < intersectionZone.y2 + 100) ||
                    (car.dir === 's' && car.y < intersectionZone.y1 && car.y > intersectionZone.y1 - 100) ||
                    (car.dir === 'e' && car.x < intersectionZone.x1 && car.x > intersectionZone.x1 - 100) ||
                    (car.dir === 'w' && car.x > intersectionZone.x2 && car.x < intersectionZone.x2 + 100);

                // Check light
                const canGo = ((car.dir === 'n' || car.dir === 's') && nsState === 'green') ||
                              ((car.dir === 'e' || car.dir === 'w') && ewState === 'green');

                // Stop for red light
                if (nearIntersection && !canGo) {
                    if (!car.waiting) {
                        car.waiting = true;
                        car.waitStart = time;
                    }
                    // Check for car ahead
                } else {
                    if (car.waiting) {
                        totalWaitTime += time - car.waitStart;
                        car.waiting = false;
                    }
                    car.x += car.vx;
                    car.y += car.vy;
                }

                // Remove cars that left the screen
                if (car.x < -50 || car.x > canvas.width + 50 ||
                    car.y < -50 || car.y > canvas.height + 50) {
                    carsPassed++;
                    cars.splice(i, 1);
                }
            }
        }

        function updateStats() {
            const avgWait = carsPassed > 0 ? (totalWaitTime / carsPassed).toFixed(1) : 0;
            const queueLength = cars.filter(c => c.waiting).length;

            document.getElementById('waitVal').textContent = avgWait + ' sec';
            document.getElementById('passedVal').textContent = carsPassed;
            document.getElementById('queueVal').textContent = queueLength;
            document.getElementById('cycleVal').textContent = (greenDuration * 2 + yellowDuration * 2) + ' sec';
        }

        function draw() {
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const roadWidth = 80;

            // Draw roads
            ctx.fillStyle = '#333';
            // N-S road
            ctx.fillRect(centerX - roadWidth, 0, roadWidth * 2, canvas.height);
            // E-W road
            ctx.fillRect(0, centerY - roadWidth, canvas.width, roadWidth * 2);

            // Intersection
            ctx.fillStyle = '#444';
            ctx.fillRect(centerX - roadWidth, centerY - roadWidth, roadWidth * 2, roadWidth * 2);

            // Lane markings
            ctx.strokeStyle = '#facc15';
            ctx.setLineDash([20, 20]);
            ctx.lineWidth = 2;

            // N-S center line
            ctx.beginPath();
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, centerY - roadWidth);
            ctx.moveTo(centerX, centerY + roadWidth);
            ctx.lineTo(centerX, canvas.height);
            ctx.stroke();

            // E-W center line
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(centerX - roadWidth, centerY);
            ctx.moveTo(centerX + roadWidth, centerY);
            ctx.lineTo(canvas.width, centerY);
            ctx.stroke();

            ctx.setLineDash([]);

            // Stop lines
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 4;
            ctx.beginPath();
            // N approach
            ctx.moveTo(centerX - roadWidth, centerY + roadWidth + 10);
            ctx.lineTo(centerX, centerY + roadWidth + 10);
            // S approach
            ctx.moveTo(centerX, centerY - roadWidth - 10);
            ctx.lineTo(centerX + roadWidth, centerY - roadWidth - 10);
            // E approach
            ctx.moveTo(centerX - roadWidth - 10, centerY);
            ctx.lineTo(centerX - roadWidth - 10, centerY + roadWidth);
            // W approach
            ctx.moveTo(centerX + roadWidth + 10, centerY - roadWidth);
            ctx.lineTo(centerX + roadWidth + 10, centerY);
            ctx.stroke();

            // Traffic lights
            function drawLight(x, y, state) {
                ctx.fillStyle = '#222';
                ctx.fillRect(x - 12, y - 30, 24, 60);

                // Red
                ctx.fillStyle = state === 'red' ? '#f87171' : '#4a1a1a';
                ctx.beginPath();
                ctx.arc(x, y - 18, 8, 0, Math.PI * 2);
                ctx.fill();

                // Yellow
                ctx.fillStyle = state === 'yellow' ? '#facc15' : '#4a4a1a';
                ctx.beginPath();
                ctx.arc(x, y, 8, 0, Math.PI * 2);
                ctx.fill();

                // Green
                ctx.fillStyle = state === 'green' ? '#4ade80' : '#1a4a1a';
                ctx.beginPath();
                ctx.arc(x, y + 18, 8, 0, Math.PI * 2);
                ctx.fill();
            }

            drawLight(centerX - roadWidth - 30, centerY + roadWidth + 50, nsState);
            drawLight(centerX + roadWidth + 30, centerY - roadWidth - 50, nsState);
            drawLight(centerX - roadWidth - 50, centerY - roadWidth - 30, ewState);
            drawLight(centerX + roadWidth + 50, centerY + roadWidth + 30, ewState);

            // Draw cars
            for (const car of cars) {
                ctx.fillStyle = car.color;

                ctx.save();
                ctx.translate(car.x, car.y);

                if (car.dir === 'n' || car.dir === 's') {
                    ctx.fillRect(-10, -15, 20, 30);
                    ctx.fillStyle = '#333';
                    ctx.fillRect(-7, -10, 14, 8);
                    ctx.fillRect(-7, 5, 14, 8);
                } else {
                    ctx.fillRect(-15, -10, 30, 20);
                    ctx.fillStyle = '#333';
                    ctx.fillRect(-10, -7, 8, 14);
                    ctx.fillRect(5, -7, 8, 14);
                }

                ctx.restore();
            }

            // Timer display
            ctx.fillStyle = '#fff';
            ctx.font = '16px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(`Time: ${time}s | ${nsState === 'green' ? 'N-S' : 'E-W'} Green`, canvas.width / 2, 30);
        }

        function toggleSim() {
            running = !running;
            if (running) animate();
        }

        function resetSim() {
            running = false;
            time = 0;
            stateTime = 0;
            cars = [];
            carsPassed = 0;
            totalWaitTime = 0;
            nsState = 'green';
            ewState = 'red';
            updateStats();
            draw();
        }

        function animate() {
            if (!running) return;

            time++;

            // Spawn cars based on volume
            if (Math.random() < trafficVolume * 0.03) {
                spawnCar();
            }

            updateLights();
            updateCars();
            updateStats();
            draw();

            setTimeout(() => requestAnimationFrame(animate), 50);
        }

        updateParams();
        resetSim();
    </script>
</body>
</html>
