<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Murmuration Frequency Spectrum | CCAB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3a 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        h1 {
            text-align: center;
            font-size: 2rem;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
        }
        .container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
            max-width: 1400px;
            margin: 0 auto;
        }
        .main-panel {
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        canvas {
            width: 100%;
            background: #000;
            border-radius: 8px;
        }
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        .info-panel {
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .panel-title {
            color: #667eea;
            margin-bottom: 12px;
            font-size: 1rem;
        }
        .frequency-list {
            list-style: none;
        }
        .frequency-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .freq-bar {
            height: 8px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 4px;
            margin-top: 4px;
        }
        .peak-indicator {
            color: #fbbf24;
            font-size: 0.8rem;
        }
        .control-group {
            margin-bottom: 16px;
        }
        label {
            display: block;
            font-size: 0.85rem;
            color: #888;
            margin-bottom: 8px;
        }
        select {
            width: 100%;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            color: #fff;
        }
        .legend {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-top: 16px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
        }
        .legend-bar {
            width: 30px;
            height: 12px;
            border-radius: 2px;
        }
        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #667eea;
            text-decoration: none;
            font-size: 0.9rem;
            opacity: 0.8;
            z-index: 100;
        }
        .back-link:hover { opacity: 1; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Gallery</a>
    <h1>Murmuration Frequency Spectrum</h1>
    <p class="subtitle">Fourier analysis reveals the periodic components of murmuration waves</p>

    <div class="container">
        <div class="main-panel">
            <canvas id="spectrumCanvas" height="300"></canvas>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-bar" style="background: #4ade80"></div>
                    <span>Rank 0 spectrum</span>
                </div>
                <div class="legend-item">
                    <div class="legend-bar" style="background: #60a5fa"></div>
                    <span>Rank 1 spectrum</span>
                </div>
            </div>
            <canvas id="waveCanvas" height="200" style="margin-top: 20px;"></canvas>
        </div>

        <div class="sidebar">
            <div class="info-panel">
                <h3 class="panel-title">Dominant Frequencies</h3>
                <ul class="frequency-list" id="freqList"></ul>
            </div>

            <div class="info-panel">
                <h3 class="panel-title">Analysis Controls</h3>

                <div class="control-group">
                    <label>Sample Size</label>
                    <select id="sampleSize">
                        <option value="1000">1,000 curves</option>
                        <option value="10000" selected>10,000 curves</option>
                        <option value="100000">100,000 curves</option>
                    </select>
                </div>

                <div class="control-group">
                    <label>Frequency Resolution</label>
                    <select id="resolution">
                        <option value="64">Low (64 bins)</option>
                        <option value="128" selected>Medium (128 bins)</option>
                        <option value="256">High (256 bins)</option>
                    </select>
                </div>
            </div>

            <div class="info-panel">
                <h3 class="panel-title">About Spectral Analysis</h3>
                <p style="font-size: 0.85rem; color: #aaa; line-height: 1.6;">
                    The frequency spectrum shows which periodic components contribute to the murmuration pattern.
                    <br><br>
                    Peaks indicate dominant oscillation frequencies. Rank 0 and Rank 1 curves have similar frequency content but different phases and amplitudes.
                </p>
            </div>
        </div>
    </div>

    <script>
        const spectrumCanvas = document.getElementById('spectrumCanvas');
        const waveCanvas = document.getElementById('waveCanvas');
        const specCtx = spectrumCanvas.getContext('2d');
        const waveCtx = waveCanvas.getContext('2d');

        let sampleSize = 10000;
        let resolution = 128;

        function resize() {
            spectrumCanvas.width = spectrumCanvas.offsetWidth * 2;
            spectrumCanvas.height = 600;
            waveCanvas.width = waveCanvas.offsetWidth * 2;
            waveCanvas.height = 400;
        }
        resize();
        window.addEventListener('resize', () => { resize(); draw(); });

        // Generate murmuration wave data
        function generateWave(numPoints, isRank1) {
            const data = [];
            for (let i = 0; i < numPoints; i++) {
                const t = i / numPoints;

                // Multiple frequency components
                const f1 = Math.sin(2 * Math.PI * t * 5);   // 5 cycles
                const f2 = Math.sin(2 * Math.PI * t * 8);   // 8 cycles
                const f3 = Math.sin(2 * Math.PI * t * 13);  // 13 cycles
                const f4 = Math.sin(2 * Math.PI * t * 21);  // 21 cycles

                const decay = Math.exp(-t * 2);

                let value;
                if (isRank1) {
                    value = (-0.5 * f1 - 0.3 * f2 - 0.15 * f3 - 0.05 * f4) * decay;
                } else {
                    value = (0.5 * f1 + 0.3 * f2 + 0.15 * f3 + 0.05 * f4) * decay;
                }

                // Add some noise (less for larger samples)
                const noiseLevel = 0.1 / Math.sqrt(sampleSize / 1000);
                value += (Math.random() - 0.5) * noiseLevel;

                data.push(value);
            }
            return data;
        }

        // Simple DFT for visualization
        function computeSpectrum(data) {
            const N = data.length;
            const spectrum = [];

            for (let k = 0; k < resolution; k++) {
                let real = 0, imag = 0;
                for (let n = 0; n < N; n++) {
                    const angle = -2 * Math.PI * k * n / N;
                    real += data[n] * Math.cos(angle);
                    imag += data[n] * Math.sin(angle);
                }
                const magnitude = Math.sqrt(real * real + imag * imag) / N;
                spectrum.push(magnitude);
            }

            return spectrum;
        }

        function draw() {
            const rank0Wave = generateWave(512, false);
            const rank1Wave = generateWave(512, true);

            const rank0Spectrum = computeSpectrum(rank0Wave);
            const rank1Spectrum = computeSpectrum(rank1Wave);

            // Draw spectrum
            const sw = spectrumCanvas.width;
            const sh = spectrumCanvas.height;
            const margin = { top: 40, right: 40, bottom: 60, left: 60 };

            specCtx.fillStyle = '#000';
            specCtx.fillRect(0, 0, sw, sh);

            const plotW = sw - margin.left - margin.right;
            const plotH = sh - margin.top - margin.bottom;

            // Grid
            specCtx.strokeStyle = 'rgba(102, 126, 234, 0.1)';
            specCtx.lineWidth = 1;
            for (let i = 0; i <= 10; i++) {
                const x = margin.left + (i / 10) * plotW;
                specCtx.beginPath();
                specCtx.moveTo(x, margin.top);
                specCtx.lineTo(x, sh - margin.bottom);
                specCtx.stroke();
            }

            // Find max for scaling
            const maxSpec = Math.max(...rank0Spectrum, ...rank1Spectrum) * 1.2;

            // Bar width
            const barWidth = plotW / (resolution / 2) / 2 - 2;

            // Draw rank 0 bars
            specCtx.fillStyle = 'rgba(74, 222, 128, 0.8)';
            for (let i = 0; i < resolution / 2; i++) {
                const x = margin.left + (i / (resolution / 2)) * plotW;
                const h = (rank0Spectrum[i] / maxSpec) * plotH;
                specCtx.fillRect(x, sh - margin.bottom - h, barWidth, h);
            }

            // Draw rank 1 bars (offset)
            specCtx.fillStyle = 'rgba(96, 165, 250, 0.8)';
            for (let i = 0; i < resolution / 2; i++) {
                const x = margin.left + (i / (resolution / 2)) * plotW + barWidth + 1;
                const h = (rank1Spectrum[i] / maxSpec) * plotH;
                specCtx.fillRect(x, sh - margin.bottom - h, barWidth, h);
            }

            // Labels
            specCtx.fillStyle = '#888';
            specCtx.font = '24px system-ui';
            specCtx.textAlign = 'center';
            specCtx.fillText('Frequency (cycles per unit p)', sw / 2, sh - 15);

            specCtx.save();
            specCtx.translate(20, sh / 2);
            specCtx.rotate(-Math.PI / 2);
            specCtx.fillText('Magnitude', 0, 0);
            specCtx.restore();

            // Draw wave reconstruction
            const ww = waveCanvas.width;
            const wh = waveCanvas.height;

            waveCtx.fillStyle = '#000';
            waveCtx.fillRect(0, 0, ww, wh);

            const wMargin = { top: 30, right: 30, bottom: 40, left: 50 };
            const wPlotW = ww - wMargin.left - wMargin.right;
            const wPlotH = wh - wMargin.top - wMargin.bottom;

            // Zero line
            waveCtx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            waveCtx.lineWidth = 1;
            waveCtx.beginPath();
            waveCtx.moveTo(wMargin.left, wMargin.top + wPlotH / 2);
            waveCtx.lineTo(ww - wMargin.right, wMargin.top + wPlotH / 2);
            waveCtx.stroke();

            // Draw waves
            const zeroY = wMargin.top + wPlotH / 2;

            waveCtx.strokeStyle = '#4ade80';
            waveCtx.lineWidth = 3;
            waveCtx.beginPath();
            rank0Wave.forEach((v, i) => {
                const x = wMargin.left + (i / rank0Wave.length) * wPlotW;
                const y = zeroY - v * (wPlotH / 2.5);
                if (i === 0) waveCtx.moveTo(x, y);
                else waveCtx.lineTo(x, y);
            });
            waveCtx.stroke();

            waveCtx.strokeStyle = '#60a5fa';
            waveCtx.lineWidth = 3;
            waveCtx.beginPath();
            rank1Wave.forEach((v, i) => {
                const x = wMargin.left + (i / rank1Wave.length) * wPlotW;
                const y = zeroY - v * (wPlotH / 2.5);
                if (i === 0) waveCtx.moveTo(x, y);
                else waveCtx.lineTo(x, y);
            });
            waveCtx.stroke();

            waveCtx.fillStyle = '#666';
            waveCtx.font = '20px system-ui';
            waveCtx.textAlign = 'center';
            waveCtx.fillText('Original Murmuration Waves', ww / 2, wh - 10);

            // Update frequency list
            updateFrequencyList(rank0Spectrum);
        }

        function updateFrequencyList(spectrum) {
            const list = document.getElementById('freqList');
            list.innerHTML = '';

            // Find peaks
            const peaks = [];
            for (let i = 1; i < spectrum.length / 2 - 1; i++) {
                if (spectrum[i] > spectrum[i-1] && spectrum[i] > spectrum[i+1] && spectrum[i] > 0.05) {
                    peaks.push({ freq: i, magnitude: spectrum[i] });
                }
            }

            peaks.sort((a, b) => b.magnitude - a.magnitude);
            const topPeaks = peaks.slice(0, 5);

            topPeaks.forEach((peak, idx) => {
                const item = document.createElement('li');
                item.className = 'frequency-item';
                item.innerHTML = `
                    <div>
                        <span>f = ${peak.freq} cycles</span>
                        ${idx === 0 ? '<span class="peak-indicator"> ★ Dominant</span>' : ''}
                        <div class="freq-bar" style="width: ${peak.magnitude * 200}%"></div>
                    </div>
                    <span>${(peak.magnitude * 100).toFixed(1)}%</span>
                `;
                list.appendChild(item);
            });
        }

        document.getElementById('sampleSize').addEventListener('change', (e) => {
            sampleSize = parseInt(e.target.value);
            draw();
        });

        document.getElementById('resolution').addEventListener('change', (e) => {
            resolution = parseInt(e.target.value);
            draw();
        });

        draw();
    </script>
</body>
</html>
