<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LMFDB-Style Explorer | CCAB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3a 100%);
            color: #fff;
            min-height: 100vh;
        }
        .header {
            background: rgba(255,255,255,0.05);
            padding: 20px 40px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        h1 {
            font-size: 1.5rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .subtitle {
            color: #888;
            font-size: 0.9rem;
        }
        .container {
            display: flex;
            height: calc(100vh - 80px);
        }
        .sidebar {
            width: 300px;
            background: rgba(255,255,255,0.03);
            padding: 20px;
            border-right: 1px solid rgba(255,255,255,0.1);
            overflow-y: auto;
        }
        .main {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        .search-box {
            width: 100%;
            padding: 12px;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 8px;
            color: #fff;
            font-size: 1rem;
            margin-bottom: 20px;
        }
        .search-box::placeholder { color: #666; }
        .filter-section {
            margin-bottom: 20px;
        }
        .filter-title {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 8px;
            text-transform: uppercase;
        }
        .filter-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .filter-btn {
            padding: 6px 12px;
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 4px;
            color: #aaa;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .filter-btn:hover, .filter-btn.active {
            background: rgba(102, 126, 234, 0.3);
            color: #fff;
        }
        .curves-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        .curves-table th {
            text-align: left;
            padding: 12px;
            background: rgba(102, 126, 234, 0.2);
            font-size: 0.8rem;
            text-transform: uppercase;
            color: #888;
        }
        .curves-table td {
            padding: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            font-size: 0.9rem;
        }
        .curves-table tr:hover {
            background: rgba(102, 126, 234, 0.1);
            cursor: pointer;
        }
        .label {
            display: inline-block;
            color: #667eea;
            text-decoration: none;
        }
        .label:hover { text-decoration: underline; }
        .rank-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: bold;
        }
        .rank-0 { background: rgba(74, 222, 128, 0.2); color: #4ade80; }
        .rank-1 { background: rgba(96, 165, 250, 0.2); color: #60a5fa; }
        .rank-2 { background: rgba(244, 114, 182, 0.2); color: #f472b6; }
        .detail-panel {
            display: none;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
        }
        .detail-panel.active { display: block; }
        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        .detail-title {
            font-size: 1.4rem;
            color: #667eea;
        }
        .close-btn {
            background: none;
            border: none;
            color: #888;
            font-size: 1.5rem;
            cursor: pointer;
        }
        .close-btn:hover { color: #fff; }
        .detail-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }
        .detail-item {
            background: rgba(102, 126, 234, 0.1);
            padding: 16px;
            border-radius: 8px;
        }
        .detail-label {
            font-size: 0.75rem;
            color: #888;
            margin-bottom: 4px;
        }
        .detail-value {
            font-size: 1.1rem;
            color: #fff;
        }
        .ap-chart {
            height: 200px;
            background: #000;
            border-radius: 8px;
        }
        .back-link {
            color: #667eea;
            text-decoration: none;
            font-size: 0.9rem;
            opacity: 0.8;
        }
        .back-link:hover { opacity: 1; }
        .pagination {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 20px;
        }
        .page-btn {
            padding: 8px 12px;
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 4px;
            color: #aaa;
            cursor: pointer;
        }
        .page-btn:hover, .page-btn.active {
            background: rgba(102, 126, 234, 0.4);
            color: #fff;
        }
    </style>
</head>
<body>
    <div class="header">
        <div>
            <a href="index.html" class="back-link">← Back to Gallery</a>
            <h1>LMFDB-Style Elliptic Curve Explorer</h1>
            <p class="subtitle">Simulated database explorer inspired by the LMFDB</p>
        </div>
    </div>

    <div class="container">
        <div class="sidebar">
            <input type="text" class="search-box" id="searchBox" placeholder="Search by label (e.g., 11a1)">

            <div class="filter-section">
                <div class="filter-title">Conductor Range</div>
                <div class="filter-options">
                    <button class="filter-btn active" data-conductor="100">N ≤ 100</button>
                    <button class="filter-btn" data-conductor="500">N ≤ 500</button>
                    <button class="filter-btn" data-conductor="1000">N ≤ 1000</button>
                </div>
            </div>

            <div class="filter-section">
                <div class="filter-title">Rank</div>
                <div class="filter-options">
                    <button class="filter-btn rank-filter active" data-rank="all">All</button>
                    <button class="filter-btn rank-filter" data-rank="0">Rank 0</button>
                    <button class="filter-btn rank-filter" data-rank="1">Rank 1</button>
                    <button class="filter-btn rank-filter" data-rank="2">Rank 2+</button>
                </div>
            </div>

            <div class="filter-section">
                <div class="filter-title">Torsion</div>
                <div class="filter-options">
                    <button class="filter-btn torsion-filter active" data-torsion="all">All</button>
                    <button class="filter-btn torsion-filter" data-torsion="1">Trivial</button>
                    <button class="filter-btn torsion-filter" data-torsion="2">Z/2Z</button>
                    <button class="filter-btn torsion-filter" data-torsion="3">Z/3Z</button>
                </div>
            </div>
        </div>

        <div class="main">
            <div class="detail-panel" id="detailPanel">
                <div class="detail-header">
                    <div class="detail-title" id="detailTitle">11a1</div>
                    <button class="close-btn" id="closeBtn">×</button>
                </div>
                <div class="detail-grid">
                    <div class="detail-item">
                        <div class="detail-label">Weierstrass Equation</div>
                        <div class="detail-value" id="detailEq">y² = x³ - x</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Conductor</div>
                        <div class="detail-value" id="detailConductor">11</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Rank</div>
                        <div class="detail-value" id="detailRank">0</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Torsion Group</div>
                        <div class="detail-value" id="detailTorsion">Z/5Z</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Discriminant</div>
                        <div class="detail-value" id="detailDisc">-161051</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">j-invariant</div>
                        <div class="detail-value" id="detailJ">-122023936/161051</div>
                    </div>
                </div>
                <div class="detail-label">aₚ Values for First Primes</div>
                <canvas class="ap-chart" id="apChart"></canvas>
            </div>

            <table class="curves-table">
                <thead>
                    <tr>
                        <th>Label</th>
                        <th>Conductor</th>
                        <th>Rank</th>
                        <th>Torsion</th>
                        <th>a-invariants</th>
                    </tr>
                </thead>
                <tbody id="curvesBody">
                </tbody>
            </table>

            <div class="pagination" id="pagination"></div>
        </div>
    </div>

    <script>
        const torsionGroups = ['trivial', 'Z/2Z', 'Z/3Z', 'Z/4Z', 'Z/5Z', 'Z/6Z', 'Z/7Z', 'Z/8Z', 'Z/9Z', 'Z/10Z', 'Z/12Z', 'Z/2Z × Z/2Z', 'Z/2Z × Z/4Z'];
        const letters = 'abcdefghijklmnopqrstuvwxyz';

        let curves = [];
        let filteredCurves = [];
        let currentPage = 1;
        const perPage = 20;
        let conductorMax = 100;
        let rankFilter = 'all';
        let torsionFilter = 'all';

        function generateCurves() {
            curves = [];

            // Generate realistic-looking curve data
            for (let N = 11; N <= conductorMax; N++) {
                // Skip some conductors (not all have curves)
                if (Math.random() < 0.3) continue;

                const numIsogeny = Math.floor(Math.random() * 4) + 1;

                for (let j = 0; j < numIsogeny; j++) {
                    const rank = Math.random() < 0.65 ? 0 : (Math.random() < 0.85 ? 1 : 2);
                    const torsionIdx = Math.floor(Math.random() * torsionGroups.length);

                    // Generate a-invariants
                    const a1 = Math.floor(Math.random() * 3) - 1;
                    const a2 = Math.floor(Math.random() * 5) - 2;
                    const a3 = Math.floor(Math.random() * 3) - 1;
                    const a4 = Math.floor(Math.random() * 100) - 50;
                    const a6 = Math.floor(Math.random() * 500) - 250;

                    const label = `${N}${letters[j]}1`;

                    // Generate aₚ values
                    const apValues = [];
                    const primes = [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47];
                    primes.forEach(p => {
                        if (N % p === 0) {
                            apValues.push(Math.random() < 0.5 ? 1 : -1);
                        } else {
                            const bound = 2 * Math.sqrt(p);
                            apValues.push(Math.round((Math.random() * 2 - 1) * bound));
                        }
                    });

                    curves.push({
                        label,
                        conductor: N,
                        rank,
                        torsion: torsionGroups[torsionIdx],
                        torsionIdx,
                        aInvariants: [a1, a2, a3, a4, a6],
                        apValues,
                        discriminant: Math.pow(-1, Math.floor(Math.random() * 2)) * Math.floor(Math.random() * 1000000),
                        jInvariant: `${Math.floor(Math.random() * 10000000)}/${Math.floor(Math.random() * 10000) + 1}`
                    });
                }
            }

            filterCurves();
        }

        function filterCurves() {
            filteredCurves = curves.filter(c => {
                if (rankFilter !== 'all' && c.rank !== parseInt(rankFilter)) return false;
                if (torsionFilter !== 'all') {
                    if (torsionFilter === '1' && c.torsion !== 'trivial') return false;
                    if (torsionFilter === '2' && c.torsion !== 'Z/2Z') return false;
                    if (torsionFilter === '3' && c.torsion !== 'Z/3Z') return false;
                }
                return true;
            });

            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            if (searchTerm) {
                filteredCurves = filteredCurves.filter(c =>
                    c.label.toLowerCase().includes(searchTerm)
                );
            }

            currentPage = 1;
            renderTable();
            renderPagination();
        }

        function renderTable() {
            const tbody = document.getElementById('curvesBody');
            const start = (currentPage - 1) * perPage;
            const end = start + perPage;
            const pageData = filteredCurves.slice(start, end);

            tbody.innerHTML = pageData.map(c => `
                <tr data-label="${c.label}">
                    <td><span class="label">${c.label}</span></td>
                    <td>${c.conductor}</td>
                    <td><span class="rank-badge rank-${c.rank}">Rank ${c.rank}</span></td>
                    <td>${c.torsion}</td>
                    <td>[${c.aInvariants.join(', ')}]</td>
                </tr>
            `).join('');

            // Add click handlers
            tbody.querySelectorAll('tr').forEach(tr => {
                tr.addEventListener('click', () => showDetail(tr.dataset.label));
            });
        }

        function renderPagination() {
            const totalPages = Math.ceil(filteredCurves.length / perPage);
            const pagination = document.getElementById('pagination');

            let html = '';
            for (let i = 1; i <= Math.min(totalPages, 10); i++) {
                html += `<button class="page-btn ${i === currentPage ? 'active' : ''}" data-page="${i}">${i}</button>`;
            }
            pagination.innerHTML = html;

            pagination.querySelectorAll('.page-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    currentPage = parseInt(btn.dataset.page);
                    renderTable();
                    renderPagination();
                });
            });
        }

        function showDetail(label) {
            const curve = curves.find(c => c.label === label);
            if (!curve) return;

            document.getElementById('detailTitle').textContent = curve.label;
            document.getElementById('detailEq').textContent = `y² + ${curve.aInvariants[0]}xy + ${curve.aInvariants[2]}y = x³ + ${curve.aInvariants[1]}x² + ${curve.aInvariants[3]}x + ${curve.aInvariants[4]}`;
            document.getElementById('detailConductor').textContent = curve.conductor;
            document.getElementById('detailRank').textContent = curve.rank;
            document.getElementById('detailTorsion').textContent = curve.torsion;
            document.getElementById('detailDisc').textContent = curve.discriminant;
            document.getElementById('detailJ').textContent = curve.jInvariant;

            document.getElementById('detailPanel').classList.add('active');

            // Draw aₚ chart
            const canvas = document.getElementById('apChart');
            canvas.width = canvas.offsetWidth;
            canvas.height = 200;
            const ctx = canvas.getContext('2d');

            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const primes = [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47];
            const w = canvas.width;
            const h = canvas.height;
            const barW = w / primes.length;

            // Find max for scaling
            const maxAp = Math.max(...primes.map(p => 2 * Math.sqrt(p)));
            const cy = h / 2;

            // Zero line
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.beginPath();
            ctx.moveTo(0, cy);
            ctx.lineTo(w, cy);
            ctx.stroke();

            // Draw bars
            curve.apValues.forEach((ap, i) => {
                const barH = (ap / maxAp) * (h / 2) * 0.8;
                const color = ap >= 0 ? '#4ade80' : '#f472b6';

                ctx.fillStyle = color;
                if (ap >= 0) {
                    ctx.fillRect(i * barW + 5, cy - barH, barW - 10, barH);
                } else {
                    ctx.fillRect(i * barW + 5, cy, barW - 10, -barH);
                }

                // Label
                ctx.fillStyle = '#888';
                ctx.font = '10px system-ui';
                ctx.textAlign = 'center';
                ctx.fillText(primes[i], i * barW + barW / 2, h - 5);
            });
        }

        document.getElementById('closeBtn').addEventListener('click', () => {
            document.getElementById('detailPanel').classList.remove('active');
        });

        document.getElementById('searchBox').addEventListener('input', filterCurves);

        document.querySelectorAll('[data-conductor]').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('[data-conductor]').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                conductorMax = parseInt(btn.dataset.conductor);
                generateCurves();
            });
        });

        document.querySelectorAll('.rank-filter').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.rank-filter').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                rankFilter = btn.dataset.rank;
                filterCurves();
            });
        });

        document.querySelectorAll('.torsion-filter').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.torsion-filter').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                torsionFilter = btn.dataset.torsion;
                filterCurves();
            });
        });

        generateCurves();
    </script>
</body>
</html>
