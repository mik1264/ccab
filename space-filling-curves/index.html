<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space-Filling Curves - Dragon, Hilbert, Gosper - CCAB</title>
    <meta name="description" content="Interactive space-filling curve visualizations: Dragon Curve, Hilbert Curve, Gosper Curve, and more. Watch fractals unfold through L-system rules.">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a14;
            min-height: 100vh;
            color: #e8e6e1;
            overflow: hidden;
        }
        #container { display: flex; height: 100vh; }
        #canvas-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        canvas { border-radius: 8px; }
        #controls {
            width: 300px;
            background: rgba(0, 0, 0, 0.85);
            padding: 20px;
            overflow-y: auto;
            border-left: 1px solid #333;
        }
        h2 {
            color: #a29bfe;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 1px solid #a29bfe;
            padding-bottom: 10px;
        }
        h3 {
            color: #d5aaff;
            margin: 15px 0 10px;
            font-size: 0.95em;
        }
        .control-group { margin-bottom: 12px; }
        label {
            display: block;
            margin-bottom: 5px;
            color: #aaa;
            font-size: 0.85em;
        }
        input[type="range"] {
            width: 100%;
            margin: 5px 0;
            accent-color: #a29bfe;
        }
        .value {
            color: #a29bfe;
            font-weight: bold;
            float: right;
        }
        select {
            width: 100%;
            padding: 8px;
            background: #222;
            border: 1px solid #444;
            color: #fff;
            border-radius: 4px;
        }
        button {
            width: 48%;
            padding: 10px;
            margin: 5px 1%;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }
        .draw-btn { background: #a29bfe; color: #000; }
        .draw-btn:hover { background: #d5aaff; }
        .animate-btn { background: #6c5ce7; color: white; }
        .animate-btn:hover { background: #a29bfe; }
        .stats-panel {
            background: rgba(162, 155, 254, 0.1);
            border: 1px solid #a29bfe;
            border-radius: 5px;
            padding: 10px;
            margin-top: 15px;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 0.8em;
        }
        .stat-label { color: #888; }
        .stat-value { color: #a29bfe; font-weight: bold; }
        .info-box {
            background: rgba(162, 155, 254, 0.1);
            border-left: 3px solid #a29bfe;
            padding: 10px;
            margin-top: 15px;
            font-size: 0.75em;
            line-height: 1.5;
        }
        .back-link {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #a29bfe;
            text-decoration: none;
            font-size: 0.9em;
            z-index: 100;
            background: rgba(0,0,0,0.7);
            padding: 8px 12px;
            border-radius: 5px;
        }
        .back-link:hover { color: #d5aaff; }
    </style>
</head>
<body>
    <a href="../index.html" class="back-link">‚Üê Back to Gallery</a>
    <div id="container">
        <div id="canvas-container">
            <canvas id="canvas"></canvas>
        </div>
        <div id="controls">
            <h2>üåÄ Space-Filling Curves</h2>

            <h3>Curve Type</h3>
            <div class="control-group">
                <select id="curve-type" onchange="updateCurve()">
                    <option value="dragon">Dragon Curve (Heighway)</option>
                    <option value="hilbert">Hilbert Curve</option>
                    <option value="gosper">Gosper Curve (Flowsnake)</option>
                    <option value="sierpinski">Sierpi≈Ñski Arrowhead</option>
                    <option value="peano">Peano Curve</option>
                    <option value="moore">Moore Curve</option>
                    <option value="levy">L√©vy C Curve</option>
                </select>
            </div>

            <h3>Iterations</h3>
            <div class="control-group">
                <label>Depth: <span class="value" id="depth-val">10</span></label>
                <input type="range" id="depth" min="1" max="16" step="1" value="10" oninput="updateDepth()">
            </div>

            <h3>Appearance</h3>
            <div class="control-group">
                <label>Line Width: <span class="value" id="linewidth-val">1.5</span></label>
                <input type="range" id="linewidth" min="0.5" max="5" step="0.5" value="1.5" oninput="updateStyle()">
            </div>

            <div class="control-group">
                <label>Color Mode:</label>
                <select id="color-mode" onchange="draw()">
                    <option value="rainbow">Rainbow (by position)</option>
                    <option value="gradient">Gradient</option>
                    <option value="depth">By Iteration</option>
                    <option value="solid">Solid Color</option>
                </select>
            </div>

            <div class="control-group">
                <label>
                    <input type="checkbox" id="show-progress" onchange="draw()"> Show Step Numbers
                </label>
            </div>

            <div style="margin: 15px 0;">
                <button class="draw-btn" onclick="draw()">Draw</button>
                <button class="animate-btn" onclick="toggleAnimate()">Animate</button>
            </div>

            <div class="stats-panel">
                <div class="stat-row">
                    <span class="stat-label">Curve:</span>
                    <span class="stat-value" id="curve-stat">Dragon</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Iterations:</span>
                    <span class="stat-value" id="iter-stat">10</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Segments:</span>
                    <span class="stat-value" id="segments-stat">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">L-System Length:</span>
                    <span class="stat-value" id="length-stat">0</span>
                </div>
            </div>

            <div class="info-box" id="curve-info">
                <strong>Dragon Curve:</strong><br>
                L-System: F ‚Üí F+G, G ‚Üí F-G<br>
                Angle: 90¬∞<br><br>
                Named for its resemblance to a dragon. First described by physicists John Heighway, Bruce Banks, and William Harter.
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let depth = 10;
        let lineWidth = 1.5;
        let colorMode = 'rainbow';
        let curveType = 'dragon';
        let animating = false;
        let animProgress = 0;
        let segments = [];

        const curves = {
            dragon: {
                name: 'Dragon Curve',
                axiom: 'F',
                rules: { F: 'F+G', G: 'F-G' },
                angle: 90,
                draw: 'FG',
                info: '<strong>Dragon Curve:</strong><br>L-System: F ‚Üí F+G, G ‚Üí F-G<br>Angle: 90¬∞<br><br>Named for its resemblance to a dragon. First described by physicists John Heighway, Bruce Banks, and William Harter.'
            },
            hilbert: {
                name: 'Hilbert Curve',
                axiom: 'A',
                rules: { A: '+BF-AFA-FB+', B: '-AF+BFB+FA-' },
                angle: 90,
                draw: 'F',
                info: '<strong>Hilbert Curve:</strong><br>L-System: A ‚Üí +BF-AFA-FB+, B ‚Üí -AF+BFB+FA-<br>Angle: 90¬∞<br><br>Discovered by David Hilbert (1891). A continuous fractal that fills the entire unit square.'
            },
            gosper: {
                name: 'Gosper Curve',
                axiom: 'A',
                rules: { A: 'A-B--B+A++AA+B-', B: '+A-BB--B-A++A+B' },
                angle: 60,
                draw: 'AB',
                info: '<strong>Gosper Curve (Flowsnake):</strong><br>L-System: A ‚Üí A-B--B+A++AA+B-<br>Angle: 60¬∞<br><br>Named after Bill Gosper. Also called the Peano-Gosper curve.'
            },
            sierpinski: {
                name: 'Sierpi≈Ñski Arrowhead',
                axiom: 'A',
                rules: { A: 'B-A-B', B: 'A+B+A' },
                angle: 60,
                draw: 'AB',
                info: '<strong>Sierpi≈Ñski Arrowhead:</strong><br>L-System: A ‚Üí B-A-B, B ‚Üí A+B+A<br>Angle: 60¬∞<br><br>Converges to the Sierpi≈Ñski triangle.'
            },
            peano: {
                name: 'Peano Curve',
                axiom: 'F',
                rules: { F: 'F+F-F-F-F+F+F+F-F' },
                angle: 90,
                draw: 'F',
                info: '<strong>Peano Curve:</strong><br>L-System: F ‚Üí F+F-F-F-F+F+F+F-F<br>Angle: 90¬∞<br><br>The first space-filling curve, discovered by Giuseppe Peano (1890).'
            },
            moore: {
                name: 'Moore Curve',
                axiom: 'LFL+F+LFL',
                rules: { L: '-RF+LFL+FR-', R: '+LF-RFR-FL+' },
                angle: 90,
                draw: 'F',
                info: '<strong>Moore Curve:</strong><br>L-System: L ‚Üí -RF+LFL+FR-<br>Angle: 90¬∞<br><br>A variant of the Hilbert curve that forms a closed loop.'
            },
            levy: {
                name: 'L√©vy C Curve',
                axiom: 'F',
                rules: { F: '+F--F+' },
                angle: 45,
                draw: 'F',
                info: '<strong>L√©vy C Curve:</strong><br>L-System: F ‚Üí +F--F+<br>Angle: 45¬∞<br><br>Named after French mathematician Paul L√©vy. Self-similar with Hausdorff dimension 2.'
            }
        };

        function resize() {
            const container = document.getElementById('canvas-container');
            const size = Math.min(container.clientWidth, container.clientHeight) - 40;
            canvas.width = size;
            canvas.height = size;
        }

        function generateLSystem(axiom, rules, iterations) {
            let current = axiom;
            for (let i = 0; i < iterations; i++) {
                let next = '';
                for (const char of current) {
                    next += rules[char] || char;
                }
                current = next;
            }
            return current;
        }

        function interpretLSystem(lsystem, angle, drawChars) {
            segments = [];
            let x = 0, y = 0;
            let dir = 0;
            const stack = [];

            for (const char of lsystem) {
                if (drawChars.includes(char)) {
                    const rad = dir * Math.PI / 180;
                    const nx = x + Math.cos(rad);
                    const ny = y + Math.sin(rad);
                    segments.push({ x1: x, y1: y, x2: nx, y2: ny });
                    x = nx;
                    y = ny;
                } else if (char === '+') {
                    dir += angle;
                } else if (char === '-') {
                    dir -= angle;
                } else if (char === '[') {
                    stack.push({ x, y, dir });
                } else if (char === ']') {
                    const state = stack.pop();
                    x = state.x;
                    y = state.y;
                    dir = state.dir;
                }
            }

            return segments;
        }

        function normalizeSegments() {
            if (segments.length === 0) return;

            let minX = Infinity, minY = Infinity;
            let maxX = -Infinity, maxY = -Infinity;

            for (const seg of segments) {
                minX = Math.min(minX, seg.x1, seg.x2);
                minY = Math.min(minY, seg.y1, seg.y2);
                maxX = Math.max(maxX, seg.x1, seg.x2);
                maxY = Math.max(maxY, seg.y1, seg.y2);
            }

            const width = maxX - minX || 1;
            const height = maxY - minY || 1;
            const scale = Math.min(canvas.width * 0.9, canvas.height * 0.9) / Math.max(width, height);
            const offsetX = (canvas.width - width * scale) / 2 - minX * scale;
            const offsetY = (canvas.height - height * scale) / 2 - minY * scale;

            for (const seg of segments) {
                seg.x1 = seg.x1 * scale + offsetX;
                seg.y1 = seg.y1 * scale + offsetY;
                seg.x2 = seg.x2 * scale + offsetX;
                seg.y2 = seg.y2 * scale + offsetY;
            }
        }

        function draw() {
            const curve = curves[curveType];

            ctx.fillStyle = '#0a0a14';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const lsystem = generateLSystem(curve.axiom, curve.rules, depth);
            interpretLSystem(lsystem, curve.angle, curve.draw);
            normalizeSegments();

            const totalSegments = animating ? Math.floor(segments.length * animProgress) : segments.length;

            ctx.lineWidth = lineWidth;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';

            for (let i = 0; i < totalSegments; i++) {
                const seg = segments[i];
                const t = i / segments.length;

                let color;
                switch (colorMode) {
                    case 'rainbow':
                        color = `hsl(${t * 360}, 80%, 60%)`;
                        break;
                    case 'gradient':
                        color = `hsl(${260 + t * 60}, 70%, ${50 + t * 20}%)`;
                        break;
                    case 'depth':
                        color = `hsl(${(i % 100) * 3.6}, 70%, 55%)`;
                        break;
                    case 'solid':
                    default:
                        color = '#a29bfe';
                }

                ctx.strokeStyle = color;
                ctx.beginPath();
                ctx.moveTo(seg.x1, seg.y1);
                ctx.lineTo(seg.x2, seg.y2);
                ctx.stroke();
            }

            // Update stats
            document.getElementById('curve-stat').textContent = curve.name;
            document.getElementById('iter-stat').textContent = depth;
            document.getElementById('segments-stat').textContent = segments.length.toLocaleString();
            document.getElementById('length-stat').textContent = generateLSystem(curve.axiom, curve.rules, depth).length.toLocaleString();
            document.getElementById('curve-info').innerHTML = curve.info;
        }

        function updateCurve() {
            curveType = document.getElementById('curve-type').value;

            // Adjust max depth based on curve complexity
            const maxDepths = {
                dragon: 16,
                hilbert: 8,
                gosper: 5,
                sierpinski: 10,
                peano: 5,
                moore: 6,
                levy: 14
            };

            const depthInput = document.getElementById('depth');
            depthInput.max = maxDepths[curveType];
            if (depth > maxDepths[curveType]) {
                depth = maxDepths[curveType];
                depthInput.value = depth;
                document.getElementById('depth-val').textContent = depth;
            }

            draw();
        }

        function updateDepth() {
            depth = parseInt(document.getElementById('depth').value);
            document.getElementById('depth-val').textContent = depth;
            draw();
        }

        function updateStyle() {
            lineWidth = parseFloat(document.getElementById('linewidth').value);
            document.getElementById('linewidth-val').textContent = lineWidth;
            draw();
        }

        function toggleAnimate() {
            animating = !animating;
            if (animating) {
                animProgress = 0;
                animate();
            }
        }

        function animate() {
            if (!animating) return;

            animProgress += 0.005;
            if (animProgress >= 1) {
                animProgress = 1;
                animating = false;
            }

            draw();

            if (animating) {
                requestAnimationFrame(animate);
            }
        }

        window.updateCurve = updateCurve;
        window.updateDepth = updateDepth;
        window.updateStyle = updateStyle;
        window.draw = draw;
        window.toggleAnimate = toggleAnimate;

        window.addEventListener('resize', () => { resize(); draw(); });

        resize();
        draw();
    </script>
</body>
</html>
