<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Writing System Evolution | Historical Simulations</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            overflow: hidden;
        }
        #canvas { display: block; }
        .controls {
            position: fixed;
            top: 20px; right: 20px;
            background: rgba(0,0,0,0.85);
            padding: 20px; border-radius: 15px;
            min-width: 280px;
            border: 1px solid rgba(217, 119, 6, 0.3);
        }
        h1 { color: #d97706; font-size: 1.3em; margin-bottom: 15px; }
        .control-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; color: #aaa; font-size: 0.9em; }
        input[type="range"], select { width: 100%; }
        .value { float: right; color: #d97706; }
        button {
            width: 100%; padding: 10px; margin: 5px 0;
            border: none; border-radius: 8px;
            background: #d97706; color: white;
            font-weight: bold; cursor: pointer;
        }
        button:hover { background: #f59e0b; }
        .stats { margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); }
        .stat-row { display: flex; justify-content: space-between; padding: 5px 0; font-size: 0.9em; }
        .stat-label { color: #888; }
        .stat-value { color: #d97706; font-weight: bold; }
        .info { font-size: 0.8em; color: #666; margin-top: 15px; line-height: 1.5; }
        a.back-link {
            position: fixed; top: 20px; left: 20px;
            color: #d97706; text-decoration: none;
            background: rgba(0,0,0,0.8); padding: 10px 20px;
            border-radius: 25px; font-size: 0.9em;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <a href="index.html" class="back-link">← Back to Historical</a>

    <div class="controls">
        <h1>Writing Evolution</h1>
        <p style="font-size:0.85em; color:#888; margin-bottom:15px;">Symbol simplification simulation</p>

        <div class="control-group">
            <label>Writing System</label>
            <select id="writingSystem">
                <option value="cuneiform">Cuneiform (Sumerian)</option>
                <option value="hieroglyphic">Hieroglyphic (Egyptian)</option>
                <option value="chinese">Chinese Characters</option>
                <option value="custom">Custom Symbols</option>
            </select>
        </div>

        <div class="control-group">
            <label>Simplification Rate: <span class="value" id="rateValue">0.5</span></label>
            <input type="range" id="rate" min="0.1" max="1" step="0.1" value="0.5">
        </div>

        <div class="control-group">
            <label>Usage Frequency Bias: <span class="value" id="freqValue">0.7</span></label>
            <input type="range" id="freq" min="0" max="1" step="0.1" value="0.7">
        </div>

        <div class="control-group">
            <label>Number of Symbols: <span class="value" id="numValue">12</span></label>
            <input type="range" id="numSymbols" min="6" max="24" value="12">
        </div>

        <button id="evolveBtn">Evolve Generation</button>
        <button id="autoBtn">Auto Evolution</button>
        <button id="resetBtn" style="background:#444">Reset</button>

        <div class="stats">
            <div class="stat-row">
                <span class="stat-label">Generation</span>
                <span class="stat-value" id="generation">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Avg Complexity</span>
                <span class="stat-value" id="complexity">100%</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Total Strokes</span>
                <span class="stat-value" id="strokes">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Writing Speed</span>
                <span class="stat-value" id="speed">1.0x</span>
            </div>
        </div>

        <div class="info">
            <strong>Evolution:</strong> Frequently used symbols simplify faster.<br>
            <strong>Pictograph → Abstract:</strong> Icons become geometric.<br>
            <strong>History:</strong> 3000+ years of writing evolution
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resize();
        window.onresize = resize;

        let writingSystem = 'cuneiform';
        let simplificationRate = 0.5;
        let frequencyBias = 0.7;
        let numSymbols = 12;
        let symbols = [];
        let generation = 0;
        let autoEvolving = false;
        let frameCount = 0;

        // Symbol definitions - each symbol has strokes (relative coordinates)
        const symbolTemplates = {
            cuneiform: [
                // Sun - circle with rays
                { name: 'Sun', meaning: 'day/god', strokes: [[0,0,1,0],[0,0,0,1],[0,0,-1,0],[0,0,0,-1],[0.7,0.7,0.3,0.3],[-0.7,0.7,-0.3,0.3],[0.7,-0.7,0.3,-0.3],[-0.7,-0.7,-0.3,-0.3]], frequency: 0.9 },
                // Water - wavy lines
                { name: 'Water', meaning: 'river', strokes: [[-1,0.3,1,0.3],[-1,0,1,0],[-1,-0.3,1,-0.3]], frequency: 0.8 },
                // Mountain - triangle
                { name: 'Mountain', meaning: 'land', strokes: [[0,-1,-1,1],[0,-1,1,1],[-1,1,1,1]], frequency: 0.5 },
                // Eye - oval with dot
                { name: 'Eye', meaning: 'see', strokes: [[-1,0,0,-0.5],[0,-0.5,1,0],[1,0,0,0.5],[0,0.5,-1,0],[0,0,0.1,0.1]], frequency: 0.7 },
                // Hand - palm and fingers
                { name: 'Hand', meaning: 'make/do', strokes: [[0,1,0,-0.3],[-0.5,-0.3,-0.8,-1],[-0.2,-0.3,-0.3,-1],[0.2,-0.3,0.3,-1],[0.5,-0.3,0.8,-1]], frequency: 0.85 },
                // House - square with roof
                { name: 'House', meaning: 'temple', strokes: [[-1,0,-1,1],[1,0,1,1],[-1,1,1,1],[-1,0,0,-1],[1,0,0,-1]], frequency: 0.6 },
                // Bird - simple bird shape
                { name: 'Bird', meaning: 'sky', strokes: [[0,0,-0.8,0.5],[0,0,0.8,0.5],[0,0,0,0.8]], frequency: 0.4 },
                // Fish - body and tail
                { name: 'Fish', meaning: 'food', strokes: [[-1,0,0.5,0.4],[0.5,0.4,0.5,-0.4],[0.5,-0.4,-1,0],[0.5,0,1,0.3],[0.5,0,1,-0.3]], frequency: 0.6 },
                // Ox - head with horns
                { name: 'Ox', meaning: 'wealth', strokes: [[0,1,0,-0.5],[-0.5,-0.5,-1,-1],[0.5,-0.5,1,-1],[-0.3,0.3,0.3,0.3]], frequency: 0.5 },
                // Grain - stalk with seeds
                { name: 'Grain', meaning: 'barley', strokes: [[0,1,0,-1],[-0.3,0.5,0.3,0.5],[-0.3,0,0.3,0],[-0.3,-0.5,0.3,-0.5]], frequency: 0.9 },
                // Star - five points
                { name: 'Star', meaning: 'god/heaven', strokes: [[0,-1,0.4,0.4],[0.4,0.4,-0.9,0],[0,-1,-0.4,0.4],[-0.4,0.4,0.9,0],[0,0.8,0,-0.2]], frequency: 0.3 },
                // Moon - crescent
                { name: 'Moon', meaning: 'month', strokes: [[0.5,-0.8,-0.5,-0.8],[-0.5,-0.8,-0.8,0],[-0.8,0,-0.5,0.8],[-0.5,0.8,0.5,0.8]], frequency: 0.7 }
            ],
            hieroglyphic: [
                { name: 'Ra', meaning: 'sun god', strokes: [[0,0,0.8,0],[0,0,0,0.8],[0,0,-0.8,0],[0,0,0,-0.8],[0.5,0.5,0.3,0.3],[-0.5,0.5,-0.3,0.3]], frequency: 0.8 },
                { name: 'Ankh', meaning: 'life', strokes: [[0,1,0,-0.5],[0,-0.5,-0.5,-0.5],[0,-0.5,0.5,-0.5],[0,0.3,-0.3,0.7],[0,0.3,0.3,0.7],[0.3,0.7,-0.3,0.7]], frequency: 0.9 },
                { name: 'Eye of Horus', meaning: 'protection', strokes: [[-1,0,1,0],[-0.5,-0.3,0.5,-0.3],[-0.5,0.3,0.5,0.3],[0,0,0,-0.8]], frequency: 0.7 },
                { name: 'Scarab', meaning: 'rebirth', strokes: [[-0.5,0,0.5,0],[-0.5,0,-0.5,-0.5],[0.5,0,0.5,-0.5],[0,0.5,0,-0.5]], frequency: 0.5 },
                { name: 'Djed', meaning: 'stability', strokes: [[0,1,0,-1],[-0.5,0.5,0.5,0.5],[-0.5,0,0.5,0],[-0.5,-0.5,0.5,-0.5]], frequency: 0.6 },
                { name: 'Was', meaning: 'power', strokes: [[0,1,0,-0.5],[0,-0.5,-0.3,-1],[0,-0.5,0.3,-1],[0,0.5,-0.3,0.2]], frequency: 0.5 }
            ],
            chinese: [
                { name: 'Ri', meaning: 'sun/day', strokes: [[-0.8,-0.8,0.8,-0.8],[0.8,-0.8,0.8,0.8],[0.8,0.8,-0.8,0.8],[-0.8,0.8,-0.8,-0.8],[-0.8,0,0.8,0]], frequency: 0.9 },
                { name: 'Shui', meaning: 'water', strokes: [[0,-1,0,1],[-0.5,-0.3,-0.8,0.3],[0.5,-0.3,0.8,0.3]], frequency: 0.8 },
                { name: 'Shan', meaning: 'mountain', strokes: [[0,-1,0,1],[-0.6,0,-0.6,1],[0.6,0,0.6,1]], frequency: 0.6 },
                { name: 'Mu', meaning: 'tree', strokes: [[0,-1,0,1],[-0.8,0,0,0],[0.8,0,0,0],[-0.5,0.8,0,0.3],[0.5,0.8,0,0.3]], frequency: 0.7 },
                { name: 'Huo', meaning: 'fire', strokes: [[0,-1,0,0.5],[-0.5,0,-0.3,0.8],[0.5,0,0.3,0.8],[0,0.5,-0.2,0.8],[0,0.5,0.2,0.8]], frequency: 0.7 },
                { name: 'Tu', meaning: 'earth', strokes: [[-0.8,0.8,0.8,0.8],[0,-0.8,0,0.8],[-0.5,-0.5,0.5,-0.5]], frequency: 0.6 }
            ],
            custom: []
        };

        function createRandomSymbol(index) {
            const numStrokes = 3 + Math.floor(Math.random() * 5);
            const strokes = [];

            for (let i = 0; i < numStrokes; i++) {
                const x1 = (Math.random() - 0.5) * 1.6;
                const y1 = (Math.random() - 0.5) * 1.6;
                const x2 = (Math.random() - 0.5) * 1.6;
                const y2 = (Math.random() - 0.5) * 1.6;
                strokes.push([x1, y1, x2, y2]);
            }

            return {
                name: `Symbol ${index + 1}`,
                meaning: `concept ${index + 1}`,
                strokes: strokes,
                frequency: 0.3 + Math.random() * 0.7
            };
        }

        function initializeSymbols() {
            symbols = [];
            generation = 0;

            let templates;
            if (writingSystem === 'custom') {
                templates = [];
                for (let i = 0; i < numSymbols; i++) {
                    templates.push(createRandomSymbol(i));
                }
            } else {
                templates = symbolTemplates[writingSystem];
            }

            for (let i = 0; i < Math.min(numSymbols, templates.length); i++) {
                const template = templates[i];
                symbols.push({
                    name: template.name,
                    meaning: template.meaning,
                    strokes: JSON.parse(JSON.stringify(template.strokes)),
                    originalStrokes: JSON.parse(JSON.stringify(template.strokes)),
                    frequency: template.frequency,
                    evolution: [JSON.parse(JSON.stringify(template.strokes))]
                });
            }

            // Fill remaining with custom if needed
            while (symbols.length < numSymbols) {
                const custom = createRandomSymbol(symbols.length);
                symbols.push({
                    ...custom,
                    originalStrokes: JSON.parse(JSON.stringify(custom.strokes)),
                    evolution: [JSON.parse(JSON.stringify(custom.strokes))]
                });
            }

            updateStats();
        }

        function simplifyStroke(stroke) {
            // Simplify a stroke by reducing its complexity
            const simplified = [...stroke];

            // Shorten strokes
            const dx = stroke[2] - stroke[0];
            const dy = stroke[3] - stroke[1];
            const shrinkFactor = 0.9 + Math.random() * 0.05;

            simplified[2] = stroke[0] + dx * shrinkFactor;
            simplified[3] = stroke[1] + dy * shrinkFactor;

            // Straighten curved implications (snap to grid)
            const gridSize = 0.2;
            simplified[0] = Math.round(simplified[0] / gridSize) * gridSize;
            simplified[1] = Math.round(simplified[1] / gridSize) * gridSize;
            simplified[2] = Math.round(simplified[2] / gridSize) * gridSize;
            simplified[3] = Math.round(simplified[3] / gridSize) * gridSize;

            return simplified;
        }

        function evolveSymbols() {
            generation++;

            for (const symbol of symbols) {
                // More frequent symbols evolve faster
                const evolutionChance = simplificationRate *
                    (frequencyBias * symbol.frequency + (1 - frequencyBias) * 0.5);

                if (Math.random() < evolutionChance) {
                    const newStrokes = [];

                    for (let i = 0; i < symbol.strokes.length; i++) {
                        const stroke = symbol.strokes[i];

                        // Chance to simplify stroke
                        if (Math.random() < 0.3) {
                            newStrokes.push(simplifyStroke(stroke));
                        }
                        // Chance to merge with another stroke
                        else if (Math.random() < 0.1 && i < symbol.strokes.length - 1) {
                            const next = symbol.strokes[i + 1];
                            newStrokes.push([stroke[0], stroke[1], next[2], next[3]]);
                            i++; // Skip next stroke
                        }
                        // Chance to remove very short stroke
                        else if (Math.random() < 0.1) {
                            const len = Math.sqrt(
                                Math.pow(stroke[2] - stroke[0], 2) +
                                Math.pow(stroke[3] - stroke[1], 2)
                            );
                            if (len < 0.2 && symbol.strokes.length > 2) {
                                continue; // Remove stroke
                            }
                            newStrokes.push(stroke);
                        }
                        else {
                            newStrokes.push(stroke);
                        }
                    }

                    if (newStrokes.length >= 1) {
                        symbol.strokes = newStrokes;
                        symbol.evolution.push(JSON.parse(JSON.stringify(newStrokes)));
                    }
                }
            }

            updateStats();
        }

        function calculateComplexity(symbol) {
            const original = symbol.originalStrokes.length;
            const current = symbol.strokes.length;

            let originalLength = 0;
            for (const stroke of symbol.originalStrokes) {
                originalLength += Math.sqrt(
                    Math.pow(stroke[2] - stroke[0], 2) +
                    Math.pow(stroke[3] - stroke[1], 2)
                );
            }

            let currentLength = 0;
            for (const stroke of symbol.strokes) {
                currentLength += Math.sqrt(
                    Math.pow(stroke[2] - stroke[0], 2) +
                    Math.pow(stroke[3] - stroke[1], 2)
                );
            }

            return ((current / original) * 0.5 + (currentLength / originalLength) * 0.5) * 100;
        }

        function updateStats() {
            let totalComplexity = 0;
            let totalStrokes = 0;

            for (const symbol of symbols) {
                totalComplexity += calculateComplexity(symbol);
                totalStrokes += symbol.strokes.length;
            }

            const avgComplexity = (totalComplexity / symbols.length).toFixed(0);
            const speed = (200 / (totalComplexity / symbols.length)).toFixed(1);

            document.getElementById('generation').textContent = generation;
            document.getElementById('complexity').textContent = avgComplexity + '%';
            document.getElementById('strokes').textContent = totalStrokes;
            document.getElementById('speed').textContent = speed + 'x';
        }

        function drawSymbol(symbol, x, y, size, showOriginal = false) {
            const strokes = showOriginal ? symbol.originalStrokes : symbol.strokes;

            ctx.strokeStyle = showOriginal ? '#666' : '#d97706';
            ctx.lineWidth = showOriginal ? 1 : 2;
            ctx.lineCap = 'round';

            for (const stroke of strokes) {
                ctx.beginPath();
                ctx.moveTo(x + stroke[0] * size * 0.4, y + stroke[1] * size * 0.4);
                ctx.lineTo(x + stroke[2] * size * 0.4, y + stroke[3] * size * 0.4);
                ctx.stroke();
            }
        }

        function draw() {
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const startX = 100;
            const startY = 100;
            const cellSize = 120;
            const cols = Math.min(6, Math.ceil(Math.sqrt(symbols.length)));

            // Title
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 22px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Writing System Evolution', canvas.width / 2 - 100, 40);
            ctx.font = '14px sans-serif';
            ctx.fillStyle = '#888';
            ctx.fillText(`${writingSystem.charAt(0).toUpperCase() + writingSystem.slice(1)} - Generation ${generation}`, canvas.width / 2 - 100, 65);

            // Draw symbols
            for (let i = 0; i < symbols.length; i++) {
                const symbol = symbols[i];
                const col = i % cols;
                const row = Math.floor(i / cols);
                const x = startX + col * cellSize;
                const y = startY + row * cellSize;

                // Background
                ctx.fillStyle = 'rgba(217, 119, 6, 0.1)';
                ctx.fillRect(x - 45, y - 45, cellSize - 10, cellSize - 10);
                ctx.strokeStyle = '#d97706';
                ctx.lineWidth = 1;
                ctx.strokeRect(x - 45, y - 45, cellSize - 10, cellSize - 10);

                // Draw original faintly
                drawSymbol(symbol, x, y, 80, true);

                // Draw current
                drawSymbol(symbol, x, y, 80, false);

                // Label
                ctx.fillStyle = '#fff';
                ctx.font = '10px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(symbol.name, x, y + 50);

                // Frequency indicator
                const barWidth = 40;
                ctx.fillStyle = '#333';
                ctx.fillRect(x - barWidth/2, y + 55, barWidth, 4);
                ctx.fillStyle = '#22c55e';
                ctx.fillRect(x - barWidth/2, y + 55, barWidth * symbol.frequency, 4);
            }

            // Evolution timeline (if we have history)
            if (symbols.length > 0 && symbols[0].evolution.length > 1) {
                const timelineY = startY + Math.ceil(symbols.length / cols) * cellSize + 50;
                const timelineWidth = 600;
                const timelineX = 100;

                ctx.fillStyle = '#fff';
                ctx.font = '14px sans-serif';
                ctx.textAlign = 'left';
                ctx.fillText('Evolution Timeline (First Symbol):', timelineX, timelineY);

                const evolution = symbols[0].evolution;
                const numToShow = Math.min(evolution.length, 8);
                const spacing = timelineWidth / numToShow;

                for (let i = 0; i < numToShow; i++) {
                    const idx = Math.floor(i * (evolution.length - 1) / (numToShow - 1));
                    const ex = timelineX + i * spacing + 40;
                    const ey = timelineY + 60;

                    // Draw this evolution stage
                    const strokes = evolution[idx];
                    ctx.strokeStyle = '#d97706';
                    ctx.lineWidth = 2;

                    for (const stroke of strokes) {
                        ctx.beginPath();
                        ctx.moveTo(ex + stroke[0] * 25, ey + stroke[1] * 25);
                        ctx.lineTo(ex + stroke[2] * 25, ey + stroke[3] * 25);
                        ctx.stroke();
                    }

                    // Generation label
                    ctx.fillStyle = '#888';
                    ctx.font = '9px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText(`Gen ${idx}`, ex, ey + 45);

                    // Arrow to next
                    if (i < numToShow - 1) {
                        ctx.strokeStyle = '#444';
                        ctx.beginPath();
                        ctx.moveTo(ex + 35, ey);
                        ctx.lineTo(ex + spacing - 35, ey);
                        ctx.stroke();
                        ctx.fillStyle = '#444';
                        ctx.beginPath();
                        ctx.moveTo(ex + spacing - 35, ey);
                        ctx.lineTo(ex + spacing - 45, ey - 5);
                        ctx.lineTo(ex + spacing - 45, ey + 5);
                        ctx.fill();
                    }
                }
            }

            // Auto evolution
            if (autoEvolving) {
                frameCount++;
                if (frameCount % 30 === 0) {
                    evolveSymbols();
                }
            }

            requestAnimationFrame(draw);
        }

        // Event listeners
        document.getElementById('writingSystem').onchange = (e) => {
            writingSystem = e.target.value;
            initializeSymbols();
        };

        document.getElementById('rate').oninput = (e) => {
            simplificationRate = parseFloat(e.target.value);
            document.getElementById('rateValue').textContent = simplificationRate.toFixed(1);
        };

        document.getElementById('freq').oninput = (e) => {
            frequencyBias = parseFloat(e.target.value);
            document.getElementById('freqValue').textContent = frequencyBias.toFixed(1);
        };

        document.getElementById('numSymbols').oninput = (e) => {
            numSymbols = parseInt(e.target.value);
            document.getElementById('numValue').textContent = numSymbols;
        };

        document.getElementById('evolveBtn').onclick = evolveSymbols;

        document.getElementById('autoBtn').onclick = () => {
            autoEvolving = !autoEvolving;
            document.getElementById('autoBtn').textContent = autoEvolving ? 'Stop Auto' : 'Auto Evolution';
        };

        document.getElementById('resetBtn').onclick = () => {
            autoEvolving = false;
            document.getElementById('autoBtn').textContent = 'Auto Evolution';
            initializeSymbols();
        };

        // Initialize
        initializeSymbols();
        draw();
    </script>
</body>
</html>
