<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ant Colony Optimization - Optimization Algorithms</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0e1a;
            color: #e0e0e0;
            overflow: hidden;
        }

        #canvas {
            display: block;
            width: 100vw;
            height: 100vh;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(138, 154, 91, 0.9);
            color: white;
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            z-index: 1000;
            transition: all 0.3s;
            font-size: 14px;
        }

        .back-link:hover {
            background: rgba(138, 154, 91, 1);
            transform: translateX(-5px);
        }

        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(20, 25, 35, 0.95);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(138, 154, 91, 0.3);
            min-width: 300px;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .controls h3 {
            margin: 0 0 15px 0;
            color: #8A9A5B;
            font-size: 18px;
            border-bottom: 2px solid rgba(138, 154, 91, 0.3);
            padding-bottom: 10px;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            margin-bottom: 5px;
            color: #b0b0b0;
            font-size: 13px;
        }

        .value {
            color: #DDA15E;
            font-weight: 600;
            font-size: 14px;
        }

        button {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            background: linear-gradient(135deg, #8A9A5B, #606C38);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(138, 154, 91, 0.4);
        }

        .info {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(20, 25, 35, 0.95);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(138, 154, 91, 0.3);
            max-width: 350px;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .info h4 {
            color: #8A9A5B;
            margin-bottom: 10px;
        }

        .info p {
            font-size: 13px;
            line-height: 1.6;
            color: #b0b0b0;
            margin-bottom: 8px;
        }

        .stat {
            color: #DDA15E;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Gallery</a>

    <div class="controls">
        <h3>Ant Colony Optimization</h3>

        <div class="control-group">
            <label>Ants per Cycle: <span class="value" id="antsValue">20</span></label>
            <input type="range" id="numAnts" min="5" max="50" step="5" value="20" style="width: 100%;">
        </div>

        <div class="control-group">
            <label>Pheromone Importance (α): <span class="value" id="alphaValue">1.0</span></label>
            <input type="range" id="alpha" min="0.5" max="2" step="0.1" value="1.0" style="width: 100%;">
        </div>

        <div class="control-group">
            <label>Distance Importance (β): <span class="value" id="betaValue">2.0</span></label>
            <input type="range" id="beta" min="0.5" max="5" step="0.5" value="2.0" style="width: 100%;">
        </div>

        <div class="control-group">
            <label>Evaporation Rate (ρ): <span class="value" id="rhoValue">0.5</span></label>
            <input type="range" id="rho" min="0.1" max="0.9" step="0.1" value="0.5" style="width: 100%;">
        </div>

        <div class="control-group">
            <label>Cities: <span class="value" id="citiesValue">15</span></label>
            <input type="range" id="numCities" min="8" max="25" step="1" value="15" style="width: 100%;">
        </div>

        <button id="reset">Reset & New Cities</button>
    </div>

    <div class="info">
        <h4>Algorithm: Ant Colony</h4>
        <p>Ants probabilistically choose paths based on pheromone strength and distance. Shorter paths get reinforced through positive feedback.</p>
        <p><strong>Cycle:</strong> <span class="stat" id="cycleInfo">0</span></p>
        <p><strong>Best Distance:</strong> <span class="stat" id="bestInfo">-</span></p>
        <p><strong>Cycle Best:</strong> <span class="stat" id="cyclebestInfo">-</span></p>
        <p><em>Brighter edges = stronger pheromones</em></p>
    </div>

    <canvas id="canvas"></canvas>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let width, height;
        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        resize();
        window.addEventListener('resize', resize);

        // Parameters
        let numAnts = 20;
        let alpha = 1.0; // Pheromone importance
        let beta = 2.0; // Distance importance
        let rho = 0.5; // Evaporation rate
        let Q = 100; // Pheromone constant
        let numCities = 15;

        // State
        let cities = [];
        let pheromones = []; // 2D matrix
        let bestRoute = null;
        let bestDistance = Infinity;
        let cycle = 0;
        let ants = [];

        function distance(city1, city2) {
            const dx = city1.x - city2.x;
            const dy = city1.y - city2.y;
            return Math.sqrt(dx * dx + dy * dy);
        }

        function totalDistance(route) {
            let sum = 0;
            for (let i = 0; i < route.length; i++) {
                const city1 = cities[route[i]];
                const city2 = cities[route[(i + 1) % route.length]];
                sum += distance(city1, city2);
            }
            return sum;
        }

        function generateCities() {
            cities = [];
            const margin = 150;
            for (let i = 0; i < numCities; i++) {
                cities.push({
                    x: margin + Math.random() * (width - margin * 2),
                    y: margin + Math.random() * (height - margin * 2)
                });
            }

            // Initialize pheromone matrix
            pheromones = [];
            for (let i = 0; i < numCities; i++) {
                pheromones[i] = [];
                for (let j = 0; j < numCities; j++) {
                    pheromones[i][j] = 0.1; // Initial pheromone
                }
            }
        }

        function reset() {
            generateCities();
            bestRoute = null;
            bestDistance = Infinity;
            cycle = 0;
            ants = [];
        }

        reset();

        // Controls
        document.getElementById('numAnts').addEventListener('input', (e) => {
            numAnts = parseInt(e.target.value);
            document.getElementById('antsValue').textContent = numAnts;
        });

        document.getElementById('alpha').addEventListener('input', (e) => {
            alpha = parseFloat(e.target.value);
            document.getElementById('alphaValue').textContent = alpha.toFixed(1);
        });

        document.getElementById('beta').addEventListener('input', (e) => {
            beta = parseFloat(e.target.value);
            document.getElementById('betaValue').textContent = beta.toFixed(1);
        });

        document.getElementById('rho').addEventListener('input', (e) => {
            rho = parseFloat(e.target.value);
            document.getElementById('rhoValue').textContent = rho.toFixed(1);
        });

        document.getElementById('numCities').addEventListener('input', (e) => {
            numCities = parseInt(e.target.value);
            document.getElementById('citiesValue').textContent = numCities;
            reset();
        });

        document.getElementById('reset').addEventListener('click', reset);

        // Ant construction
        function constructAntSolution() {
            const visited = new Array(numCities).fill(false);
            const route = [];

            // Start at random city
            let current = Math.floor(Math.random() * numCities);
            route.push(current);
            visited[current] = true;

            // Build route
            while (route.length < numCities) {
                const probabilities = [];
                let sum = 0;

                // Calculate probabilities for unvisited cities
                for (let j = 0; j < numCities; j++) {
                    if (!visited[j]) {
                        const pheromone = Math.pow(pheromones[current][j], alpha);
                        const dist = distance(cities[current], cities[j]);
                        const visibility = Math.pow(1 / (dist + 0.001), beta);
                        const prob = pheromone * visibility;
                        probabilities.push({ city: j, prob });
                        sum += prob;
                    }
                }

                // Roulette wheel selection
                let r = Math.random() * sum;
                let selected = probabilities[0].city;

                for (const p of probabilities) {
                    r -= p.prob;
                    if (r <= 0) {
                        selected = p.city;
                        break;
                    }
                }

                route.push(selected);
                visited[selected] = true;
                current = selected;
            }

            return route;
        }

        function updatePheromones(antRoutes) {
            // Evaporation
            for (let i = 0; i < numCities; i++) {
                for (let j = 0; j < numCities; j++) {
                    pheromones[i][j] *= (1 - rho);
                }
            }

            // Add new pheromones
            antRoutes.forEach(ant => {
                const contribution = Q / ant.distance;
                for (let i = 0; i < ant.route.length; i++) {
                    const from = ant.route[i];
                    const to = ant.route[(i + 1) % ant.route.length];
                    pheromones[from][to] += contribution;
                    pheromones[to][from] += contribution;
                }
            });
        }

        function runCycle() {
            const antRoutes = [];

            // Construct solutions for all ants
            for (let i = 0; i < numAnts; i++) {
                const route = constructAntSolution();
                const dist = totalDistance(route);
                antRoutes.push({ route, distance: dist });

                if (dist < bestDistance) {
                    bestDistance = dist;
                    bestRoute = [...route];
                }
            }

            updatePheromones(antRoutes);
            cycle++;

            // Update info
            const cycleBest = Math.min(...antRoutes.map(a => a.distance));
            document.getElementById('cycleInfo').textContent = cycle;
            document.getElementById('bestInfo').textContent = bestDistance.toFixed(1);
            document.getElementById('cyclebestInfo').textContent = cycleBest.toFixed(1);

            // Store current ants for visualization
            ants = antRoutes.slice(0, 5); // Show only a few
        }

        // Render
        function render() {
            ctx.fillStyle = '#0a0e1a';
            ctx.fillRect(0, 0, width, height);

            // Draw pheromone trails
            const maxPheromone = Math.max(...pheromones.flat());

            for (let i = 0; i < numCities; i++) {
                for (let j = i + 1; j < numCities; j++) {
                    const intensity = pheromones[i][j] / (maxPheromone + 0.001);

                    const r = Math.floor(138 * intensity);
                    const g = Math.floor(154 * intensity);
                    const b = Math.floor(91 * intensity);

                    ctx.strokeStyle = `rgba(${r}, ${g}, ${b}, ${0.2 + intensity * 0.6})`;
                    ctx.lineWidth = 1 + intensity * 4;

                    ctx.beginPath();
                    ctx.moveTo(cities[i].x, cities[i].y);
                    ctx.lineTo(cities[j].x, cities[j].y);
                    ctx.stroke();
                }
            }

            // Draw recent ant trails (faint)
            ants.forEach((ant, idx) => {
                ctx.strokeStyle = `rgba(221, 161, 94, ${0.1 + idx * 0.05})`;
                ctx.lineWidth = 1;
                ctx.setLineDash([3, 3]);
                ctx.beginPath();
                for (let i = 0; i < ant.route.length; i++) {
                    const city = cities[ant.route[i]];
                    if (i === 0) ctx.moveTo(city.x, city.y);
                    else ctx.lineTo(city.x, city.y);
                }
                ctx.closePath();
                ctx.stroke();
                ctx.setLineDash([]);
            });

            // Draw best route
            if (bestRoute) {
                ctx.strokeStyle = '#DDA15E';
                ctx.lineWidth = 3;
                ctx.beginPath();
                for (let i = 0; i < bestRoute.length; i++) {
                    const city = cities[bestRoute[i]];
                    if (i === 0) ctx.moveTo(city.x, city.y);
                    else ctx.lineTo(city.x, city.y);
                }
                ctx.closePath();
                ctx.stroke();
            }

            // Draw cities
            cities.forEach((city, idx) => {
                // Glow
                const gradient = ctx.createRadialGradient(city.x, city.y, 0, city.x, city.y, 15);
                gradient.addColorStop(0, 'rgba(221, 161, 94, 0.6)');
                gradient.addColorStop(1, 'rgba(221, 161, 94, 0)');
                ctx.fillStyle = gradient;
                ctx.fillRect(city.x - 15, city.y - 15, 30, 30);

                // City
                ctx.fillStyle = '#DDA15E';
                ctx.beginPath();
                ctx.arc(city.x, city.y, 6, 0, Math.PI * 2);
                ctx.fill();

                ctx.strokeStyle = '#FEFAE0';
                ctx.lineWidth = 2;
                ctx.stroke();

                // Number
                ctx.fillStyle = '#b0b0b0';
                ctx.font = '11px monospace';
                ctx.textAlign = 'center';
                ctx.fillText(idx.toString(), city.x, city.y - 18);
            });
        }

        // Animation loop
        let frameCount = 0;
        function animate() {
            frameCount++;

            // Run cycle every 30 frames
            if (frameCount % 30 === 0) {
                runCycle();
            }

            render();
            requestAnimationFrame(animate);
        }

        animate();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
