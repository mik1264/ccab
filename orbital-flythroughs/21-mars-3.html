<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mars 3 - First Mars Soft Landing (USSR)</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0a0a1a; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
        canvas { display: block; }
        .info-panel { position: fixed; top: 20px; left: 20px; background: rgba(10, 20, 40, 0.9); border: 1px solid #c0392b; border-radius: 10px; padding: 20px; color: #ecf0f1; max-width: 300px; z-index: 100; }
        .info-panel h1 { font-size: 1.4em; color: #c0392b; margin-bottom: 10px; }
        .info-panel p { font-size: 0.85em; line-height: 1.5; color: #bdc3c7; }
        .mission-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 12px; }
        .stat { background: rgba(192, 57, 43, 0.2); padding: 6px; border-radius: 5px; text-align: center; }
        .stat-value { font-size: 1em; color: #c0392b; font-weight: bold; }
        .stat-label { font-size: 0.65em; color: #7f8c8d; }
        .controls { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; z-index: 100; }
        .controls button { background: rgba(192, 57, 43, 0.8); border: none; color: white; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
        .controls button.active { background: #27ae60; }
        .back-link { position: fixed; top: 20px; right: 20px; background: rgba(10, 20, 40, 0.9); border: 1px solid #c0392b; border-radius: 8px; padding: 10px 15px; color: #c0392b; text-decoration: none; z-index: 100; }
        .flyby-indicator { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(192, 57, 43, 0.9); padding: 20px 40px; border-radius: 10px; color: white; font-size: 1.3em; font-weight: bold; opacity: 0; transition: opacity 0.5s; pointer-events: none; z-index: 200; }
        .flyby-indicator.show { opacity: 1; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div class="info-panel">
        <h1>üöÄ Mars 3 ‚ò≠</h1>
        <p>First soft landing on Mars! Launched May 28, 1971 by the Soviet Union. Orbiter and lander mission.</p>
        <p style="margin-top:8px">Lander transmitted for ~20 seconds before failing (possibly due to dust storm). Orbiter operated until Aug 1972.</p>
        <div class="mission-stats">
            <div class="stat"><div class="stat-value">1971</div><div class="stat-label">Launch</div></div>
            <div class="stat"><div class="stat-value">USSR</div><div class="stat-label">Origin</div></div>
            <div class="stat"><div class="stat-value">1st</div><div class="stat-label">Mars Landing</div></div>
            <div class="stat"><div class="stat-value">20 sec</div><div class="stat-label">Surface Ops</div></div>
        </div>
    </div>
    <a href="index.html" class="back-link">‚Üê Back</a>
    <div class="controls">
        <button id="playPause" class="active">‚è∏ Pause</button>
        <button id="restart">üîÑ Restart</button>
        <button id="speedDown">üê¢</button>
        <button id="speedUp">üêá</button>
    </div>
    <div class="flyby-indicator" id="flybyIndicator">EVENT!</div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let width, height, centerX, centerY, scale;
        function resize() { width = canvas.width = window.innerWidth; height = canvas.height = window.innerHeight; centerX = width / 2; centerY = height / 2; scale = Math.min(width, height) / 5; }
        resize(); window.addEventListener('resize', resize);
        let playing = true, time = 0, speed = 1;
        const planets = [{ name: 'Earth', radius: 1.0, color: '#4169e1', size: 7, period: 1.0 }, { name: 'Mars', radius: 1.52, color: '#cd5c5c', size: 8, period: 1.88 }];
        const trajectory = [];
        const dur = 8;
        function genTraj() {
            trajectory.length = 0;
            const marsArr = 4;
            // Hohmann transfer to Mars
            for (let t = 0; t < marsArr; t += 0.02) {
                const p = t / marsArr;
                const a = (1.0 + 1.52) / 2;
                const e = (1.52 - 1.0) / (1.0 + 1.52);
                const trueAnomaly = p * Math.PI;
                const r = a * (1 - e * e) / (1 + e * Math.cos(trueAnomaly));
                const angle = Math.PI + p * Math.PI;
                trajectory.push({ time: t, x: r * Math.cos(angle), y: r * Math.sin(angle) });
            }
            let angle = Math.PI * 2;
            // Mars orbit insertion
            for (let t = marsArr; t < marsArr + 0.3; t += 0.02) {
                const p = (t - marsArr) / 0.3;
                trajectory.push({ time: t, x: 1.52 * Math.cos(angle + p * 0.5), y: 1.52 * Math.sin(angle + p * 0.5), atMars: true });
            }
            // Landing
            for (let i = 0; i < 10; i++) {
                trajectory.push({ time: marsArr + 0.3 + i * 0.01, x: 1.52 * Math.cos(angle + 0.5 + i * 0.02), y: 1.52 * Math.sin(angle + 0.5 + i * 0.02), landing: true });
            }
            // Orbiter continues
            for (let t = marsArr + 0.4; t < dur; t += 0.02) {
                const p = (t - marsArr - 0.4) / (dur - marsArr - 0.4);
                angle += 0.05;
                trajectory.push({ time: t, x: 1.52 * Math.cos(angle), y: 1.52 * Math.sin(angle), orbiting: true });
            }
        }
        genTraj();
        function draw() {
            ctx.fillStyle = '#0a0a1a'; ctx.fillRect(0, 0, width, height);
            for (let i = 0; i < 150; i++) { ctx.fillStyle = `rgba(255,255,255,${0.3 + Math.sin(time + i) * 0.2})`; ctx.beginPath(); ctx.arc((Math.sin(i * 192) * 0.5 + 0.5) * width, (Math.cos(i * 281) * 0.5 + 0.5) * height, 1, 0, Math.PI * 2); ctx.fill(); }
            const g = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, 30);
            g.addColorStop(0, '#fff'); g.addColorStop(0.3, '#ffcc00'); g.addColorStop(1, 'transparent');
            ctx.fillStyle = g; ctx.beginPath(); ctx.arc(centerX, centerY, 30, 0, Math.PI * 2); ctx.fill();
            planets.forEach(p => {
                ctx.strokeStyle = 'rgba(255,255,255,0.1)'; ctx.beginPath(); ctx.arc(centerX, centerY, p.radius * scale, 0, Math.PI * 2); ctx.stroke();
                const mt = (time * 0.3) % dur;
                const a = (mt * 2 * Math.PI / p.period) + p.radius * 10;
                const x = centerX + p.radius * scale * Math.cos(a), y = centerY + p.radius * scale * Math.sin(a);
                ctx.fillStyle = p.color; ctx.beginPath(); ctx.arc(x, y, p.size, 0, Math.PI * 2); ctx.fill();
                ctx.fillStyle = 'rgba(255,255,255,0.7)'; ctx.font = '10px sans-serif'; ctx.textAlign = 'center'; ctx.fillText(p.name, x, y + p.size + 12);
            });
            const currentTime = (time * 0.3) % dur;
            let idx = 0; for (let i = 0; i < trajectory.length; i++) if (trajectory[i].time <= currentTime) idx = i;
            ctx.beginPath();
            for (let i = 0; i <= idx; i++) { const p = trajectory[i]; const x = centerX + p.x * scale, y = centerY + p.y * scale; if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y); }
            ctx.strokeStyle = '#c0392b'; ctx.lineWidth = 2; ctx.stroke();
            if (idx < trajectory.length) {
                const p = trajectory[idx];
                const x = centerX + p.x * scale, y = centerY + p.y * scale;
                ctx.fillStyle = '#c0392b'; ctx.beginPath(); ctx.arc(x, y, 5, 0, Math.PI * 2); ctx.fill();
                ctx.font = 'bold 10px sans-serif'; ctx.fillText('Mars 3', x + 10, y - 8);
                const ind = document.getElementById('flybyIndicator');
                if (p.landing) { ind.textContent = 'FIRST MARS SOFT LANDING!'; ind.style.background = 'rgba(39,174,96,0.9)'; ind.classList.add('show'); }
                else if (p.atMars) { ind.textContent = 'MARS ORBIT INSERTION'; ind.classList.add('show'); }
                else if (p.orbiting) { ind.textContent = 'ORBITER OPERATIONS'; ind.style.background = 'rgba(192,57,43,0.7)'; ind.classList.add('show'); }
                else ind.classList.remove('show');
            }
        }
        function animate() { if (playing) time += 0.016 * speed; draw(); requestAnimationFrame(animate); }
        document.getElementById('playPause').onclick = function() { playing = !playing; this.textContent = playing ? '‚è∏ Pause' : '‚ñ∂ Play'; this.classList.toggle('active', playing); };
        document.getElementById('restart').onclick = () => time = 0;
        document.getElementById('speedDown').onclick = () => speed = Math.max(0.25, speed * 0.5);
        document.getElementById('speedUp').onclick = () => speed = Math.min(4, speed * 2);
        animate();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
