<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chang'e 2 - Chinese Moon/Asteroid Mission (CNSA)</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0a0a1a; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
        canvas { display: block; }
        .info-panel { position: fixed; top: 20px; left: 20px; background: rgba(10, 20, 40, 0.9); border: 1px solid #c0392b; border-radius: 10px; padding: 15px; color: #ecf0f1; max-width: 280px; z-index: 100; }
        .info-panel h1 { font-size: 1.3em; color: #e74c3c; margin-bottom: 8px; }
        .info-panel p { font-size: 0.8em; line-height: 1.4; color: #bdc3c7; }
        .stats { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-top: 10px; }
        .stat { background: rgba(192, 57, 43, 0.2); padding: 5px; border-radius: 4px; text-align: center; }
        .stat-value { font-size: 0.9em; color: #e74c3c; font-weight: bold; }
        .stat-label { font-size: 0.6em; color: #7f8c8d; }
        .controls { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 8px; z-index: 100; }
        .controls button { background: rgba(192, 57, 43, 0.8); border: none; color: white; padding: 8px 16px; border-radius: 5px; cursor: pointer; }
        .controls button.active { background: #27ae60; }
        .back-link { position: fixed; top: 20px; right: 20px; background: rgba(10, 20, 40, 0.9); border: 1px solid #c0392b; border-radius: 6px; padding: 8px 12px; color: #e74c3c; text-decoration: none; z-index: 100; }
        .flyby-indicator { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(192, 57, 43, 0.9); padding: 15px 30px; border-radius: 8px; color: white; font-size: 1.2em; font-weight: bold; opacity: 0; transition: opacity 0.5s; pointer-events: none; z-index: 200; }
        .flyby-indicator.show { opacity: 1; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div class="info-panel">
        <h1>üöÄ Chang'e 2 üá®üá≥</h1>
        <p>China's lunar/asteroid mission! Launched October 1, 2010. Mapped Moon, then flew to L2 point and asteroid 4179 Toutatis.</p>
        <p style="margin-top:6px">First Chinese probe to leave Earth-Moon system. Mapped Moon from 100 km, then became first probe to flyby asteroid from lunar orbit!</p>
        <div class="stats">
            <div class="stat"><div class="stat-value">2010</div><div class="stat-label">Launch</div></div>
            <div class="stat"><div class="stat-value">CNSA</div><div class="stat-label">Agency</div></div>
            <div class="stat"><div class="stat-value">3.2 km</div><div class="stat-label">Toutatis</div></div>
            <div class="stat"><div class="stat-value">L2‚ÜíAst</div><div class="stat-label">Extended</div></div>
        </div>
    </div>
    <a href="index.html" class="back-link">‚Üê Back</a>
    <div class="controls">
        <button id="playPause" class="active">‚è∏</button>
        <button id="restart">üîÑ</button>
        <button id="speedDown">üê¢</button>
        <button id="speedUp">üêá</button>
    </div>
    <div class="flyby-indicator" id="flybyIndicator"></div>
    <script>
        const canvas = document.getElementById('canvas'), ctx = canvas.getContext('2d');
        let width, height, cx, cy, scale;
        function resize() { width = canvas.width = innerWidth; height = canvas.height = innerHeight; cx = width/2; cy = height/2; scale = Math.min(width,height)/3.5; }
        resize(); addEventListener('resize', resize);
        let playing = true, time = 0, speed = 1;
        const planets = [{n:'Earth',r:1,c:'#4169e1',s:8,p:1}];
        const traj = [];
        function gen() {
            traj.length = 0;
            let angle = 0;
            // Trans-lunar injection
            for (let t = 0; t < 1.5; t += 0.02) {
                const p = t / 1.5;
                angle += 0.06;
                const r = 1 + p * 0.4;
                traj.push({t, x: r * Math.cos(angle), y: r * Math.sin(angle), tli: true});
            }
            // Lunar orbit and mapping
            for (let i = 0; i < 25; i++) {
                angle += 0.22;
                const orbitR = 1.4 + 0.03 * Math.sin(angle * 5);
                const isMapping = i > 3 && i < 20;
                traj.push({t: 1.5 + i * 0.012, x: orbitR * Math.cos(angle), y: orbitR * Math.sin(angle), moon: true, mapping: isMapping});
            }
            // Departure to L2
            for (let t = 1.8; t < 2.8; t += 0.02) {
                const p = (t - 1.8) / 1;
                angle += 0.05;
                const r = 1.4 + p * 0.2;
                traj.push({t, x: r * Math.cos(angle), y: r * Math.sin(angle), departing: true});
            }
            // L2 operations
            for (let i = 0; i < 15; i++) {
                angle += 0.15;
                const r = 1.6 + 0.05 * Math.sin(angle * 3);
                traj.push({t: 2.8 + i * 0.015, x: r * Math.cos(angle), y: r * Math.sin(angle), l2: true});
            }
            // Cruise to asteroid Toutatis
            for (let t = 3.025; t < 4.5; t += 0.02) {
                const p = (t - 3.025) / 1.475;
                angle += 0.04;
                const r = 1.6 - p * 0.3;
                traj.push({t, x: r * Math.cos(angle), y: r * Math.sin(angle), cruising: true});
            }
            // Toutatis flyby
            for (let i = 0; i < 10; i++) {
                const isClose = i > 3 && i < 7;
                angle += 0.08;
                traj.push({t: 4.5 + i * 0.015, x: 1.3 * Math.cos(angle), y: 1.3 * Math.sin(angle), toutatis: true, closest: isClose});
            }
        }
        gen();
        function draw() {
            ctx.fillStyle = '#0a0a1a'; ctx.fillRect(0,0,width,height);
            for (let i = 0; i < 120; i++) { ctx.fillStyle = `rgba(255,255,255,${0.3+Math.sin(time+i)*0.2})`; ctx.beginPath(); ctx.arc((Math.sin(i*192)*0.5+0.5)*width,(Math.cos(i*281)*0.5+0.5)*height,1,0,Math.PI*2); ctx.fill(); }

            // Draw Moon
            const moonAngle = time * 0.15;
            const moonX = cx + 1.4 * scale * Math.cos(moonAngle);
            const moonY = cy + 1.4 * scale * Math.sin(moonAngle);
            const moonG = ctx.createRadialGradient(moonX, moonY, 0, moonX, moonY, 12);
            moonG.addColorStop(0, '#d3d3d3'); moonG.addColorStop(1, '#808080');
            ctx.fillStyle = moonG; ctx.beginPath(); ctx.arc(moonX, moonY, 12, 0, Math.PI * 2); ctx.fill();
            ctx.fillStyle = 'rgba(211,211,211,0.6)'; ctx.font = '9px sans-serif'; ctx.fillText('Moon', moonX - 15, moonY + 20);

            // Draw Toutatis asteroid
            const astAngle = time * 0.25 + 3;
            const astX = cx + 1.3 * scale * Math.cos(astAngle);
            const astY = cy + 1.3 * scale * Math.sin(astAngle);
            ctx.fillStyle = '#8b7355'; ctx.beginPath(); ctx.ellipse(astX, astY, 5, 3, astAngle, 0, Math.PI * 2); ctx.fill();
            ctx.fillStyle = 'rgba(139,115,85,0.6)'; ctx.font = '8px sans-serif'; ctx.fillText('Toutatis', astX + 8, astY);

            planets.forEach(p => {
                ctx.strokeStyle = 'rgba(255,255,255,0.1)'; ctx.beginPath(); ctx.arc(cx,cy,p.r*scale,0,Math.PI*2); ctx.stroke();
                const ang = (time*0.1/p.p)+p.r*10, x = cx+p.r*scale*Math.cos(ang), y = cy+p.r*scale*Math.sin(ang);
                const g = ctx.createRadialGradient(x,y,0,x,y,p.s); g.addColorStop(0,'#4169e1'); g.addColorStop(0.7,'#1e3a8a'); g.addColorStop(1,'transparent');
                ctx.fillStyle = g; ctx.beginPath(); ctx.arc(x,y,p.s,0,Math.PI*2); ctx.fill();
                ctx.fillStyle = 'rgba(255,255,255,0.7)'; ctx.font = '11px sans-serif'; ctx.fillText(p.n,x,y+p.s+14);
            });
            const ct = (time*0.16)%4.65; let idx = 0;
            for (let i = 0; i < traj.length; i++) if (traj[i].t <= ct) idx = i;
            ctx.beginPath();
            for (let i = 0; i <= idx; i++) { const p = traj[i], x = cx+p.x*scale, y = cy+p.y*scale; if (i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y); }
            ctx.strokeStyle = '#e74c3c'; ctx.lineWidth = 2; ctx.stroke();
            if (idx < traj.length) {
                const p = traj[idx], x = cx+p.x*scale, y = cy+p.y*scale;
                ctx.fillStyle = '#e74c3c'; ctx.beginPath(); ctx.arc(x,y,5,0,Math.PI*2); ctx.fill();
                ctx.font = 'bold 10px sans-serif'; ctx.fillText("Chang'e 2",x+8,y-6);
                const ind = document.getElementById('flybyIndicator');
                if (p.mapping) { ind.textContent = 'MAPPING MOON - 100 km orbit'; ind.style.background = 'rgba(211,211,211,0.9)'; ind.classList.add('show'); }
                else if (p.moon) { ind.textContent = 'LUNAR ORBIT'; ind.classList.add('show'); }
                else if (p.l2) { ind.textContent = 'L2 LAGRANGE POINT Operations'; ind.style.background = 'rgba(255,215,0,0.9)'; ind.classList.add('show'); }
                else if (p.closest) { ind.textContent = 'TOUTATIS FLYBY - 3.2 km!'; ind.style.background = 'rgba(139,115,85,0.9)'; ind.classList.add('show'); }
                else if (p.toutatis) { ind.textContent = 'ASTEROID ENCOUNTER'; ind.classList.add('show'); }
                else if (p.cruising) { ind.textContent = 'CRUISING TO TOUTATIS'; ind.classList.add('show'); }
                else ind.classList.remove('show');
            }
        }
        function animate() { if (playing) time += 0.016*speed; draw(); requestAnimationFrame(animate); }
        document.getElementById('playPause').onclick = function() { playing = !playing; this.textContent = playing ? '‚è∏' : '‚ñ∂'; this.classList.toggle('active', playing); };
        document.getElementById('restart').onclick = () => time = 0;
        document.getElementById('speedDown').onclick = () => speed = Math.max(0.25, speed*0.5);
        document.getElementById('speedUp').onclick = () => speed = Math.min(4, speed*2);
        animate();
    </script>
</body>
</html>
