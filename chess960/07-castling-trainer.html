<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess960 Castling Trainer - CCAB</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600;700&family=Nunito:wght@400;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #0f3460 100%);
            color: #e8e6e1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: #f59e0b;
            text-decoration: none;
            border-radius: 30px;
            font-size: 14px;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .back-link:hover {
            background: rgba(245, 158, 11, 0.2);
            transform: translateX(-4px);
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            margin-top: 40px;
        }

        h1 {
            font-family: 'Lora', serif;
            font-size: 2.5rem;
            color: #f59e0b;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #a0a0a0;
            font-size: 1.1rem;
            max-width: 600px;
        }

        .main-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
            max-width: 1100px;
            width: 100%;
        }

        .game-area {
            display: flex;
            gap: 40px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: flex-start;
        }

        .board-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 0;
            border: 4px solid #f59e0b;
            border-radius: 8px;
            overflow: hidden;
        }

        .square {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 42px;
            position: relative;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .square.light {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        }

        .square.dark {
            background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
        }

        .square.highlight-king {
            box-shadow: inset 0 0 15px rgba(59, 130, 246, 0.8);
        }

        .square.highlight-rook {
            box-shadow: inset 0 0 15px rgba(16, 185, 129, 0.8);
        }

        .square.highlight-target {
            box-shadow: inset 0 0 20px rgba(251, 191, 36, 0.9);
        }

        .square.clickable:hover {
            filter: brightness(1.1);
            transform: scale(1.02);
        }

        .square .piece {
            filter: drop-shadow(2px 2px 2px rgba(0, 0, 0, 0.3));
            transition: all 0.3s ease;
        }

        .square.moving .piece {
            animation: pieceMove 0.4s ease;
        }

        @keyframes pieceMove {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .file-labels {
            display: flex;
            justify-content: space-around;
            margin-top: 8px;
            font-size: 14px;
            color: #888;
        }

        .info-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            min-width: 300px;
            max-width: 350px;
        }

        .panel-title {
            font-family: 'Lora', serif;
            color: #f59e0b;
            font-size: 1.3rem;
            margin-bottom: 20px;
            text-align: center;
        }

        .castling-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 25px;
        }

        .castle-btn {
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #e8e6e1;
            font-family: 'Nunito', sans-serif;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .castle-btn:hover:not(:disabled) {
            background: rgba(245, 158, 11, 0.2);
            border-color: #f59e0b;
        }

        .castle-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .castle-btn.active {
            background: rgba(245, 158, 11, 0.3);
            border-color: #f59e0b;
        }

        .castle-notation {
            font-family: 'Courier New', monospace;
            color: #f59e0b;
        }

        .rules-box {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .rules-box h4 {
            color: #f59e0b;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .rule-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 8px;
            font-size: 13px;
            color: #aaa;
        }

        .rule-icon {
            color: #f59e0b;
            font-size: 14px;
        }

        .position-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
        }

        .info-label {
            color: #888;
        }

        .info-value {
            font-family: 'Courier New', monospace;
            color: #22d3ee;
        }

        .controls {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
        }

        button {
            padding: 12px 24px;
            font-size: 15px;
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .primary-btn {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: #1a1a2e;
        }

        .primary-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(245, 158, 11, 0.4);
        }

        .secondary-btn {
            background: rgba(255, 255, 255, 0.1);
            color: #e8e6e1;
        }

        .secondary-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .result-message {
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            margin-top: 15px;
            font-weight: 600;
            display: none;
        }

        .result-message.success {
            display: block;
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 2px solid #10b981;
        }

        .result-message.error {
            display: block;
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 2px solid #ef4444;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: #888;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .legend-color.king { box-shadow: inset 0 0 10px rgba(59, 130, 246, 0.8); background: #3b82f6; }
        .legend-color.rook { box-shadow: inset 0 0 10px rgba(16, 185, 129, 0.8); background: #10b981; }
        .legend-color.target { box-shadow: inset 0 0 10px rgba(251, 191, 36, 0.9); background: #fbbf24; }

        .score-display {
            text-align: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .score-value {
            font-size: 2rem;
            font-weight: 700;
            color: #f59e0b;
        }

        .score-label {
            font-size: 12px;
            color: #888;
        }

        @media (max-width: 800px) {
            .square {
                width: 42px;
                height: 42px;
                font-size: 30px;
            }

            h1 {
                font-size: 1.8rem;
            }

            .game-area {
                flex-direction: column;
                align-items: center;
            }

            .info-panel {
                min-width: unset;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Chess960</a>

    <header>
        <h1>Castling Trainer</h1>
        <p class="subtitle">Master Chess960 castling - the king always ends on c or g file!</p>
    </header>

    <div class="main-container">
        <div class="game-area">
            <div class="board-container">
                <div class="board" id="board"></div>
                <div class="file-labels">
                    <span>a</span><span>b</span><span>c</span><span>d</span>
                    <span>e</span><span>f</span><span>g</span><span>h</span>
                </div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color king"></div>
                        <span>King</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color rook"></div>
                        <span>Rooks</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color target"></div>
                        <span>Castling Targets</span>
                    </div>
                </div>
            </div>

            <div class="info-panel">
                <div class="score-display">
                    <div class="score-value" id="score">0</div>
                    <div class="score-label">Correct Castles</div>
                </div>

                <h3 class="panel-title">Choose Castling Move</h3>

                <div class="castling-options">
                    <button class="castle-btn" id="castleKingside" onclick="executeCastle('kingside')">
                        <span>Castle Kingside</span>
                        <span class="castle-notation" id="kingsideNotation">O-O</span>
                    </button>
                    <button class="castle-btn" id="castleQueenside" onclick="executeCastle('queenside')">
                        <span>Castle Queenside</span>
                        <span class="castle-notation" id="queensideNotation">O-O-O</span>
                    </button>
                </div>

                <div class="position-info">
                    <div class="info-row">
                        <span class="info-label">Position #</span>
                        <span class="info-value" id="posNum">---</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">King on</span>
                        <span class="info-value" id="kingFile">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Rooks on</span>
                        <span class="info-value" id="rookFiles">-, -</span>
                    </div>
                </div>

                <div class="rules-box">
                    <h4>Chess960 Castling Rules</h4>
                    <div class="rule-item">
                        <span class="rule-icon">‚ôî</span>
                        <span>King always moves to <strong>c1</strong> (queenside) or <strong>g1</strong> (kingside)</span>
                    </div>
                    <div class="rule-item">
                        <span class="rule-icon">‚ôñ</span>
                        <span>Rook always moves to <strong>d1</strong> (queenside) or <strong>f1</strong> (kingside)</span>
                    </div>
                    <div class="rule-item">
                        <span class="rule-icon">‚ö°</span>
                        <span>All squares between king and rook destinations must be empty</span>
                    </div>
                </div>

                <div class="result-message" id="resultMessage"></div>

                <div class="controls">
                    <button class="primary-btn" onclick="newPosition()">
                        üé≤ New Position
                    </button>
                    <button class="secondary-btn" onclick="showHints()">
                        üí° Show Hints
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const PIECES = {
            K: '‚ôî', Q: '‚ôï', R: '‚ôñ', B: '‚ôó', N: '‚ôò', P: '‚ôô',
            k: '‚ôö', q: '‚ôõ', r: '‚ôú', b: '‚ôù', n: '‚ôû', p: '‚ôü'
        };

        const FILES = 'abcdefgh';
        let currentPieces = [];
        let kingFile = -1;
        let rookFiles = [];
        let score = 0;
        let hintsShown = false;

        function generateFromNumber(n) {
            const pieces = new Array(8).fill(null);

            const lightBishop = (n % 4) * 2 + 1;
            n = Math.floor(n / 4);
            const darkBishop = (n % 4) * 2;
            n = Math.floor(n / 4);

            pieces[lightBishop] = 'B';
            pieces[darkBishop] = 'B';

            const queenIndex = n % 6;
            n = Math.floor(n / 6);
            let count = 0;
            for (let i = 0; i < 8; i++) {
                if (pieces[i] === null) {
                    if (count === queenIndex) {
                        pieces[i] = 'Q';
                        break;
                    }
                    count++;
                }
            }

            const knightTable = [
                [0, 1], [0, 2], [0, 3], [0, 4],
                [1, 2], [1, 3], [1, 4],
                [2, 3], [2, 4], [3, 4]
            ];

            const knights = knightTable[n];
            let emptySquares = [];
            for (let i = 0; i < 8; i++) {
                if (pieces[i] === null) emptySquares.push(i);
            }

            pieces[emptySquares[knights[0]]] = 'N';
            pieces[emptySquares[knights[1]]] = 'N';

            emptySquares = [];
            for (let i = 0; i < 8; i++) {
                if (pieces[i] === null) emptySquares.push(i);
            }

            pieces[emptySquares[0]] = 'R';
            pieces[emptySquares[1]] = 'K';
            pieces[emptySquares[2]] = 'R';

            return pieces;
        }

        function renderBoard() {
            const board = document.getElementById('board');
            board.innerHTML = '';

            for (let rank = 7; rank >= 0; rank--) {
                for (let file = 0; file < 8; file++) {
                    const square = document.createElement('div');
                    const isLight = (rank + file) % 2 === 1;
                    square.className = `square ${isLight ? 'light' : 'dark'}`;
                    square.dataset.file = file;
                    square.dataset.rank = rank;

                    let piece = null;
                    if (rank === 0) {
                        piece = currentPieces[file];
                        if (piece === 'K') square.classList.add('highlight-king');
                        if (piece === 'R') square.classList.add('highlight-rook');
                    } else if (rank === 1) {
                        piece = 'P';
                    }

                    if (piece) {
                        const pieceSpan = document.createElement('span');
                        pieceSpan.className = 'piece';
                        pieceSpan.textContent = PIECES[piece];
                        square.appendChild(pieceSpan);
                    }

                    board.appendChild(square);
                }
            }
        }

        function showHints() {
            if (hintsShown) return;
            hintsShown = true;

            // Show target squares
            // Kingside: King to g1, Rook to f1
            const g1 = document.querySelector('[data-file="6"][data-rank="0"]');
            const f1 = document.querySelector('[data-file="5"][data-rank="0"]');
            // Queenside: King to c1, Rook to d1
            const c1 = document.querySelector('[data-file="2"][data-rank="0"]');
            const d1 = document.querySelector('[data-file="3"][data-rank="0"]');

            if (canCastleKingside()) {
                g1.classList.add('highlight-target');
                f1.classList.add('highlight-target');
            }
            if (canCastleQueenside()) {
                c1.classList.add('highlight-target');
                d1.classList.add('highlight-target');
            }
        }

        function canCastleKingside() {
            // King goes to g1 (file 6), Rook to f1 (file 5)
            // Need rook on a file > kingFile
            const kingsideRook = rookFiles.find(r => r > kingFile);
            if (kingsideRook === undefined) return false;

            // Check if path is clear between king and g1, and between rook and f1
            const kingTarget = 6;
            const rookTarget = 5;

            // Check squares that need to be empty
            const minFile = Math.min(kingFile, kingTarget, kingsideRook, rookTarget);
            const maxFile = Math.max(kingFile, kingTarget, kingsideRook, rookTarget);

            for (let f = minFile; f <= maxFile; f++) {
                if (f !== kingFile && f !== kingsideRook) {
                    if (currentPieces[f] !== null) return false;
                }
            }

            return true;
        }

        function canCastleQueenside() {
            // King goes to c1 (file 2), Rook to d1 (file 3)
            // Need rook on a file < kingFile
            const queensideRook = rookFiles.find(r => r < kingFile);
            if (queensideRook === undefined) return false;

            // Check if path is clear
            const kingTarget = 2;
            const rookTarget = 3;

            const minFile = Math.min(kingFile, kingTarget, queensideRook, rookTarget);
            const maxFile = Math.max(kingFile, kingTarget, queensideRook, rookTarget);

            for (let f = minFile; f <= maxFile; f++) {
                if (f !== kingFile && f !== queensideRook) {
                    if (currentPieces[f] !== null) return false;
                }
            }

            return true;
        }

        function executeCastle(side) {
            hideResult();

            const isKingside = side === 'kingside';
            const canCastle = isKingside ? canCastleKingside() : canCastleQueenside();

            if (!canCastle) {
                showResult(false, `Cannot castle ${side} - path is blocked!`);
                return;
            }

            // Animate the castling
            const kingTarget = isKingside ? 6 : 2;
            const rookTarget = isKingside ? 5 : 3;
            const rook = isKingside ?
                rookFiles.find(r => r > kingFile) :
                rookFiles.find(r => r < kingFile);

            // Update pieces array
            currentPieces[kingFile] = null;
            currentPieces[rook] = null;
            currentPieces[kingTarget] = 'K';
            currentPieces[rookTarget] = 'R';

            // Re-render
            renderBoard();

            // Update info
            score++;
            document.getElementById('score').textContent = score;
            showResult(true, `${isKingside ? 'Kingside' : 'Queenside'} castle complete! King: ${FILES[kingTarget]}1, Rook: ${FILES[rookTarget]}1`);

            // Disable buttons after castling
            document.getElementById('castleKingside').disabled = true;
            document.getElementById('castleQueenside').disabled = true;
        }

        function showResult(success, message) {
            const resultEl = document.getElementById('resultMessage');
            resultEl.textContent = message;
            resultEl.className = `result-message ${success ? 'success' : 'error'}`;
        }

        function hideResult() {
            document.getElementById('resultMessage').className = 'result-message';
        }

        function updateInfo(posNum) {
            document.getElementById('posNum').textContent = posNum;
            document.getElementById('kingFile').textContent = FILES[kingFile].toUpperCase() + '1';
            document.getElementById('rookFiles').textContent =
                rookFiles.map(r => FILES[r].toUpperCase() + '1').join(', ');

            // Update castling notation
            const kingsideRook = rookFiles.find(r => r > kingFile);
            const queensideRook = rookFiles.find(r => r < kingFile);

            if (kingsideRook !== undefined) {
                document.getElementById('kingsideNotation').textContent =
                    `K${FILES[kingFile]}‚Üíg, R${FILES[kingsideRook]}‚Üíf`;
            }
            if (queensideRook !== undefined) {
                document.getElementById('queensideNotation').textContent =
                    `K${FILES[kingFile]}‚Üíc, R${FILES[queensideRook]}‚Üíd`;
            }

            // Enable/disable buttons based on legality
            document.getElementById('castleKingside').disabled = !canCastleKingside();
            document.getElementById('castleQueenside').disabled = !canCastleQueenside();
        }

        function newPosition() {
            hideResult();
            hintsShown = false;

            const posNum = Math.floor(Math.random() * 960);
            currentPieces = generateFromNumber(posNum);

            kingFile = currentPieces.indexOf('K');
            rookFiles = [];
            currentPieces.forEach((p, i) => {
                if (p === 'R') rookFiles.push(i);
            });

            renderBoard();
            updateInfo(posNum);
        }

        // Initialize
        newPosition();
    </script>
</body>
</html>
