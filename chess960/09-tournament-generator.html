<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess960 Tournament Generator - CCAB</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600;700&family=Nunito:wght@400;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e8e6e1;
            padding: 20px;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: #14b8a6;
            text-decoration: none;
            border-radius: 30px;
            font-size: 14px;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .back-link:hover {
            background: rgba(20, 184, 166, 0.2);
            transform: translateX(-4px);
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding-top: 40px;
        }

        h1 {
            font-family: 'Lora', serif;
            font-size: 2.5rem;
            color: #14b8a6;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #a0a0a0;
            font-size: 1.1rem;
        }

        .main-container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .generator-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .panel-title {
            font-family: 'Lora', serif;
            font-size: 1.3rem;
            color: #14b8a6;
            margin-bottom: 20px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-size: 14px;
            color: #888;
        }

        input, select {
            padding: 12px 16px;
            font-size: 16px;
            font-family: 'Nunito', sans-serif;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
            color: #e8e6e1;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #14b8a6;
        }

        select {
            cursor: pointer;
        }

        .btn-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        button {
            padding: 15px 30px;
            font-size: 16px;
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%);
            color: white;
            box-shadow: 0 4px 20px rgba(20, 184, 166, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(20, 184, 166, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #e8e6e1;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .results-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .round-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .round-tab {
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid transparent;
            border-radius: 25px;
            color: #888;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .round-tab:hover {
            background: rgba(20, 184, 166, 0.2);
        }

        .round-tab.active {
            background: rgba(20, 184, 166, 0.3);
            border-color: #14b8a6;
            color: #14b8a6;
        }

        .positions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .position-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }

        .position-card:hover {
            border-color: rgba(20, 184, 166, 0.3);
            transform: translateY(-3px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .game-number {
            font-family: 'Lora', serif;
            font-size: 1.1rem;
            color: #14b8a6;
        }

        .position-num {
            background: rgba(20, 184, 166, 0.2);
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 13px;
            color: #14b8a6;
        }

        .mini-board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 1px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .mini-square {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .mini-square.light {
            background: #d1d5db;
        }

        .mini-square.dark {
            background: #6b7280;
        }

        .setup-display {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #a0a0a0;
            text-align: center;
            letter-spacing: 1px;
        }

        .export-section {
            margin-top: 30px;
            padding-top: 25px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .export-title {
            font-size: 14px;
            color: #888;
            margin-bottom: 15px;
        }

        .export-btns {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .export-btn {
            padding: 10px 20px;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #a0a0a0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #e8e6e1;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-state .icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #14b8a6;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            font-weight: 600;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 1.8rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .positions-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Chess960</a>

    <header>
        <h1>Tournament Generator</h1>
        <p class="subtitle">Generate Chess960 positions for your tournament</p>
    </header>

    <div class="main-container">
        <div class="generator-panel">
            <h3 class="panel-title">Tournament Settings</h3>

            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label">Tournament Name</label>
                    <input type="text" id="tournamentName" placeholder="Chess960 Championship" value="Chess960 Championship">
                </div>
                <div class="form-group">
                    <label class="form-label">Number of Rounds</label>
                    <select id="numRounds">
                        <option value="1">1 Round</option>
                        <option value="3">3 Rounds</option>
                        <option value="5">5 Rounds</option>
                        <option value="7" selected>7 Rounds</option>
                        <option value="9">9 Rounds</option>
                        <option value="11">11 Rounds</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Games per Round</label>
                    <select id="gamesPerRound">
                        <option value="1" selected>1 Game (Single)</option>
                        <option value="2">2 Games (Double)</option>
                        <option value="4">4 Games</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Unique Positions</label>
                    <select id="uniquePositions">
                        <option value="true" selected>Yes - No duplicates</option>
                        <option value="false">No - Allow duplicates</option>
                    </select>
                </div>
            </div>

            <div class="btn-row">
                <button class="btn-primary" onclick="generateTournament()">
                    üé≤ Generate Tournament
                </button>
                <button class="btn-secondary" onclick="clearTournament()">
                    Clear
                </button>
            </div>
        </div>

        <div class="results-panel" id="resultsPanel">
            <div class="results-header">
                <h3 class="panel-title" id="resultsTitle">Generated Positions</h3>
                <div class="round-tabs" id="roundTabs"></div>
            </div>

            <div id="positionsContainer">
                <div class="empty-state">
                    <div class="icon">üèÜ</div>
                    <p>Configure your tournament settings and click "Generate Tournament"</p>
                </div>
            </div>

            <div class="export-section" id="exportSection" style="display: none;">
                <p class="export-title">Export Tournament Data</p>
                <div class="export-btns">
                    <button class="export-btn" onclick="exportJSON()">üìÑ JSON</button>
                    <button class="export-btn" onclick="exportCSV()">üìä CSV</button>
                    <button class="export-btn" onclick="exportText()">üìù Text</button>
                    <button class="export-btn" onclick="copyAllFEN()">üìã Copy All FEN</button>
                    <button class="export-btn" onclick="printTournament()">üñ®Ô∏è Print</button>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast">Copied to clipboard!</div>

    <script>
        const PIECES = { K: '‚ôî', Q: '‚ôï', R: '‚ôñ', B: '‚ôó', N: '‚ôò' };

        let tournamentData = null;
        let currentRound = 0;

        function generateFromNumber(n) {
            const pieces = new Array(8).fill(null);

            const lightBishop = (n % 4) * 2 + 1;
            n = Math.floor(n / 4);
            const darkBishop = (n % 4) * 2;
            n = Math.floor(n / 4);

            pieces[lightBishop] = 'B';
            pieces[darkBishop] = 'B';

            const queenIndex = n % 6;
            n = Math.floor(n / 6);
            let count = 0;
            for (let i = 0; i < 8; i++) {
                if (pieces[i] === null) {
                    if (count === queenIndex) {
                        pieces[i] = 'Q';
                        break;
                    }
                    count++;
                }
            }

            const knightTable = [
                [0, 1], [0, 2], [0, 3], [0, 4],
                [1, 2], [1, 3], [1, 4],
                [2, 3], [2, 4], [3, 4]
            ];

            const knights = knightTable[n];
            let emptySquares = [];
            for (let i = 0; i < 8; i++) {
                if (pieces[i] === null) emptySquares.push(i);
            }

            pieces[emptySquares[knights[0]]] = 'N';
            pieces[emptySquares[knights[1]]] = 'N';

            emptySquares = [];
            for (let i = 0; i < 8; i++) {
                if (pieces[i] === null) emptySquares.push(i);
            }

            pieces[emptySquares[0]] = 'R';
            pieces[emptySquares[1]] = 'K';
            pieces[emptySquares[2]] = 'R';

            return pieces;
        }

        function generateFEN(pieces) {
            const blackPieces = pieces.map(p => p.toLowerCase()).join('');
            return `${blackPieces}/pppppppp/8/8/8/8/PPPPPPPP/${pieces.join('')} w KQkq - 0 1`;
        }

        function generateTournament() {
            const name = document.getElementById('tournamentName').value;
            const numRounds = parseInt(document.getElementById('numRounds').value);
            const gamesPerRound = parseInt(document.getElementById('gamesPerRound').value);
            const unique = document.getElementById('uniquePositions').value === 'true';

            const totalGames = numRounds * gamesPerRound;
            const usedPositions = new Set();
            const rounds = [];

            for (let r = 0; r < numRounds; r++) {
                const games = [];
                for (let g = 0; g < gamesPerRound; g++) {
                    let posNum;
                    if (unique) {
                        do {
                            posNum = Math.floor(Math.random() * 960);
                        } while (usedPositions.has(posNum) && usedPositions.size < 960);
                        usedPositions.add(posNum);
                    } else {
                        posNum = Math.floor(Math.random() * 960);
                    }

                    const pieces = generateFromNumber(posNum);
                    games.push({
                        gameNumber: r * gamesPerRound + g + 1,
                        positionNumber: posNum,
                        pieces: pieces,
                        setup: pieces.join(''),
                        fen: generateFEN(pieces)
                    });
                }
                rounds.push({
                    roundNumber: r + 1,
                    games: games
                });
            }

            tournamentData = {
                name: name,
                createdAt: new Date().toISOString(),
                numRounds: numRounds,
                gamesPerRound: gamesPerRound,
                uniquePositions: unique,
                totalGames: totalGames,
                rounds: rounds
            };

            currentRound = 0;
            renderTournament();
        }

        function renderTournament() {
            if (!tournamentData) return;

            document.getElementById('resultsTitle').textContent = tournamentData.name;
            document.getElementById('exportSection').style.display = 'block';

            // Render round tabs
            const tabsContainer = document.getElementById('roundTabs');
            tabsContainer.innerHTML = '';

            tournamentData.rounds.forEach((round, idx) => {
                const tab = document.createElement('button');
                tab.className = `round-tab ${idx === currentRound ? 'active' : ''}`;
                tab.textContent = `Round ${round.roundNumber}`;
                tab.onclick = () => {
                    currentRound = idx;
                    renderTournament();
                };
                tabsContainer.appendChild(tab);
            });

            // Render positions
            const container = document.getElementById('positionsContainer');
            const round = tournamentData.rounds[currentRound];

            container.innerHTML = '';

            const grid = document.createElement('div');
            grid.className = 'positions-grid';

            round.games.forEach(game => {
                const card = document.createElement('div');
                card.className = 'position-card';

                card.innerHTML = `
                    <div class="card-header">
                        <span class="game-number">Game ${game.gameNumber}</span>
                        <span class="position-num">#${game.positionNumber}</span>
                    </div>
                    <div class="mini-board">${renderMiniBoard(game.pieces)}</div>
                    <div class="setup-display">${game.setup}</div>
                `;

                grid.appendChild(card);
            });

            container.appendChild(grid);
        }

        function renderMiniBoard(pieces) {
            let html = '';
            // Only render the back rank
            for (let file = 0; file < 8; file++) {
                const isLight = file % 2 === 1;
                const piece = pieces[file];
                html += `<div class="mini-square ${isLight ? 'light' : 'dark'}">${PIECES[piece]}</div>`;
            }
            return html;
        }

        function clearTournament() {
            tournamentData = null;
            document.getElementById('resultsTitle').textContent = 'Generated Positions';
            document.getElementById('roundTabs').innerHTML = '';
            document.getElementById('positionsContainer').innerHTML = `
                <div class="empty-state">
                    <div class="icon">üèÜ</div>
                    <p>Configure your tournament settings and click "Generate Tournament"</p>
                </div>
            `;
            document.getElementById('exportSection').style.display = 'none';
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }

        function exportJSON() {
            if (!tournamentData) return;
            const blob = new Blob([JSON.stringify(tournamentData, null, 2)], { type: 'application/json' });
            downloadBlob(blob, `${tournamentData.name.replace(/\s+/g, '_')}.json`);
        }

        function exportCSV() {
            if (!tournamentData) return;
            let csv = 'Round,Game,Position Number,Setup,FEN\n';
            tournamentData.rounds.forEach(round => {
                round.games.forEach(game => {
                    csv += `${round.roundNumber},${game.gameNumber},${game.positionNumber},"${game.setup}","${game.fen}"\n`;
                });
            });
            const blob = new Blob([csv], { type: 'text/csv' });
            downloadBlob(blob, `${tournamentData.name.replace(/\s+/g, '_')}.csv`);
        }

        function exportText() {
            if (!tournamentData) return;
            let text = `${tournamentData.name}\n`;
            text += `${'='.repeat(tournamentData.name.length)}\n\n`;
            text += `Created: ${new Date(tournamentData.createdAt).toLocaleString()}\n`;
            text += `Rounds: ${tournamentData.numRounds}\n`;
            text += `Games per Round: ${tournamentData.gamesPerRound}\n`;
            text += `Total Games: ${tournamentData.totalGames}\n\n`;

            tournamentData.rounds.forEach(round => {
                text += `Round ${round.roundNumber}\n`;
                text += `---------\n`;
                round.games.forEach(game => {
                    text += `  Game ${game.gameNumber}: Position #${game.positionNumber} - ${game.setup}\n`;
                });
                text += '\n';
            });

            const blob = new Blob([text], { type: 'text/plain' });
            downloadBlob(blob, `${tournamentData.name.replace(/\s+/g, '_')}.txt`);
        }

        function copyAllFEN() {
            if (!tournamentData) return;
            let fenList = '';
            tournamentData.rounds.forEach(round => {
                round.games.forEach(game => {
                    fenList += `Round ${round.roundNumber} Game ${game.gameNumber}: ${game.fen}\n`;
                });
            });
            navigator.clipboard.writeText(fenList).then(() => {
                showToast('All FEN strings copied!');
            });
        }

        function printTournament() {
            if (!tournamentData) return;
            const printWindow = window.open('', '_blank');
            let html = `
                <html>
                <head>
                    <title>${tournamentData.name}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        h1 { color: #14b8a6; }
                        .round { margin-bottom: 30px; }
                        .round h2 { color: #333; border-bottom: 2px solid #14b8a6; padding-bottom: 10px; }
                        .game { display: inline-block; margin: 10px; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
                        .game-title { font-weight: bold; margin-bottom: 5px; }
                        .position-num { color: #14b8a6; }
                        .setup { font-family: monospace; font-size: 16px; }
                    </style>
                </head>
                <body>
                    <h1>${tournamentData.name}</h1>
                    <p>Generated: ${new Date(tournamentData.createdAt).toLocaleString()}</p>
            `;

            tournamentData.rounds.forEach(round => {
                html += `<div class="round"><h2>Round ${round.roundNumber}</h2>`;
                round.games.forEach(game => {
                    html += `
                        <div class="game">
                            <div class="game-title">Game ${game.gameNumber} <span class="position-num">#${game.positionNumber}</span></div>
                            <div class="setup">${game.setup}</div>
                        </div>
                    `;
                });
                html += '</div>';
            });

            html += '</body></html>';
            printWindow.document.write(html);
            printWindow.document.close();
            printWindow.print();
        }

        function downloadBlob(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
            showToast(`Downloaded ${filename}`);
        }
    </script>
</body>
</html>
