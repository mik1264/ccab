<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Antibiotic Resistance Evolution</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
canvas { display: block; cursor: crosshair; }
#title-overlay { position: fixed; top: 18px; left: 50%; transform: translateX(-50%); color: #fbbf24; font-size: 22px; font-weight: 700; text-shadow: 0 2px 10px rgba(0,0,0,0.7); z-index: 10; pointer-events: none; }
#legend { position: fixed; top: 60px; right: 20px; background: rgba(0,0,0,0.85); padding: 14px 18px; border-radius: 10px; color: #e0e0e0; font-size: 13px; z-index: 10; border: 1px solid rgba(251,191,36,0.2); }
.legend-item { display: flex; align-items: center; gap: 8px; margin: 5px 0; }
.legend-dot { width: 12px; height: 12px; border-radius: 50%; }
#controls { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.85); padding: 16px 24px; border-radius: 14px; color: #e0e0e0; z-index: 10; display: flex; gap: 16px; align-items: center; border: 1px solid rgba(251,191,36,0.3); font-size: 13px; flex-wrap: wrap; justify-content: center; }
#controls button { padding: 8px 16px; border: 2px solid; border-radius: 8px; font-weight: 700; cursor: pointer; font-size: 12px; background: transparent; }
#controls button:hover { opacity: 0.8; }
#controls button.selected { box-shadow: 0 0 12px currentColor; }
.btn-a { color: #3498db; border-color: #3498db; }
.btn-b { color: #e74c3c; border-color: #e74c3c; }
.btn-c { color: #2ecc71; border-color: #2ecc71; }
#controls .reset-btn { padding: 8px 18px; background: #fbbf24; color: #0a0e1a; border: 2px solid #fbbf24; border-radius: 8px; font-weight: 700; cursor: pointer; }
#stats { position: fixed; top: 60px; left: 20px; background: rgba(0,0,0,0.85); padding: 14px 18px; border-radius: 10px; color: #e0e0e0; font-size: 13px; z-index: 10; border: 1px solid rgba(251,191,36,0.2); }
#info { position: fixed; top: 220px; left: 20px; background: rgba(0,0,0,0.85); padding: 14px 18px; border-radius: 10px; color: #ccc; font-size: 12px; z-index: 10; border: 1px solid rgba(251,191,36,0.2); max-width: 190px; line-height: 1.5; }
</style>
</head>
<body>
<a href="../index.html" style="position:fixed;top:10px;left:10px;padding:8px 16px;background:rgba(0,0,0,0.7);color:#fbbf24;text-decoration:none;border-radius:6px;font-size:14px;z-index:999;font-family:sans-serif;">&#8592; Back to Gallery</a>
<div id="title-overlay">Antibiotic Resistance Evolution</div>
<div id="legend">
    <div class="legend-item"><div class="legend-dot" style="background:#5dade2;"></div> Normal Bacteria</div>
    <div class="legend-item"><div class="legend-dot" style="background:#f39c12;"></div> Resistant (Type A)</div>
    <div class="legend-item"><div class="legend-dot" style="background:#e74c3c;"></div> Resistant (Type B)</div>
    <div class="legend-item"><div class="legend-dot" style="background:#8e44ad;"></div> Resistant (Type C)</div>
    <div class="legend-item"><div class="legend-dot" style="background:#ff4a4a;"></div> Multi-Drug Resistant</div>
    <div style="margin-top:8px;font-size:11px;color:#aaa;">Click to apply antibiotic</div>
</div>
<div id="stats">
    <div>Generation: <span id="genNum" class="val" style="color:#fbbf24;">0</span></div>
    <div>Total Bacteria: <span id="totalBac" style="color:#5dade2;">0</span></div>
    <div>Normal: <span id="normalCount" style="color:#5dade2;">0</span></div>
    <div>Resistant: <span id="resistCount" style="color:#f39c12;">0</span></div>
    <div>Multi-Resistant: <span id="multiCount" style="color:#ff4a4a;">0</span></div>
    <div>Resistance %: <span id="resPct" style="color:#fbbf24;">0%</span></div>
</div>
<div id="info">Select an antibiotic and click on the petri dish. Most bacteria die, but resistant mutants survive and multiply. Overuse creates superbugs!</div>
<div id="controls">
    <span>Select Antibiotic:</span>
    <button class="btn-a selected" id="abA" onclick="selectAB(0)">Antibiotic A</button>
    <button class="btn-b" id="abB" onclick="selectAB(1)">Antibiotic B</button>
    <button class="btn-c" id="abC" onclick="selectAB(2)">Antibiotic C</button>
    <span style="margin-left:10px;">Brush: <input type="range" id="brushSize" min="30" max="150" value="70" style="width:80px;accent-color:#fbbf24;vertical-align:middle;"></span>
    <button class="reset-btn" onclick="init()">Reset</button>
</div>
<canvas id="canvas"></canvas>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let W, H, centerX, centerY, petriR;

const MAX_BACTERIA = 1200;
const GROWTH_RATE = 0.003;
const MUTATION_RATE = 0.005;
const SPREAD_SPEED = 0.4;

let bacteria = [], antibioticZones = [], selectedAB = 0, frame = 0, generation = 0;
const AB_COLORS = ['rgba(52,152,219,0.3)', 'rgba(231,76,60,0.3)', 'rgba(46,204,113,0.3)'];
const AB_NAMES = ['A', 'B', 'C'];

function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
    centerX = W / 2;
    centerY = H / 2;
    petriR = Math.min(W, H) * 0.38;
}

function init() {
    bacteria = [];
    antibioticZones = [];
    frame = 0;
    generation = 0;

    // Seed bacteria
    for (let i = 0; i < 200; i++) {
        const angle = Math.random() * Math.PI * 2;
        const r = Math.random() * petriR * 0.7;
        bacteria.push(createBacterium(
            centerX + Math.cos(angle) * r,
            centerY + Math.sin(angle) * r,
            [false, false, false] // No resistance
        ));
    }
}

function createBacterium(x, y, resistance) {
    return {
        x, y,
        vx: (Math.random() - 0.5) * SPREAD_SPEED,
        vy: (Math.random() - 0.5) * SPREAD_SPEED,
        resistance: [...resistance],
        size: 2 + Math.random(),
        age: 0,
        divideTimer: 150 + Math.random() * 200
    };
}

function getBacteriaColor(b) {
    const resCount = b.resistance.filter(r => r).length;
    if (resCount >= 2) return '#ff4a4a'; // Multi-drug resistant
    if (b.resistance[0]) return '#f39c12';
    if (b.resistance[1]) return '#e74c3c';
    if (b.resistance[2]) return '#8e44ad';
    return '#5dade2';
}

function selectAB(idx) {
    selectedAB = idx;
    document.querySelectorAll('#controls button:not(.reset-btn)').forEach((b, i) => {
        b.classList.toggle('selected', i === idx);
    });
}

function isInPetri(x, y) {
    const dx = x - centerX, dy = y - centerY;
    return dx * dx + dy * dy < petriR * petriR;
}

function update() {
    // Grow and divide
    for (let i = bacteria.length - 1; i >= 0; i--) {
        const b = bacteria[i];
        b.age++;
        b.x += b.vx;
        b.y += b.vy;

        // Brownian motion
        b.vx += (Math.random() - 0.5) * 0.1;
        b.vy += (Math.random() - 0.5) * 0.1;
        b.vx *= 0.95;
        b.vy *= 0.95;

        // Keep in petri dish
        const dx = b.x - centerX, dy = b.y - centerY;
        const d = Math.sqrt(dx * dx + dy * dy);
        if (d > petriR - 10) {
            b.vx -= (dx / d) * 0.3;
            b.vy -= (dy / d) * 0.3;
        }

        // Division
        if (b.age > b.divideTimer && bacteria.length < MAX_BACTERIA) {
            const offspring = createBacterium(
                b.x + (Math.random() - 0.5) * 8,
                b.y + (Math.random() - 0.5) * 8,
                b.resistance
            );
            // Mutation
            for (let r = 0; r < 3; r++) {
                if (!offspring.resistance[r] && Math.random() < MUTATION_RATE) {
                    offspring.resistance[r] = true;
                }
            }
            if (isInPetri(offspring.x, offspring.y)) {
                bacteria.push(offspring);
            }
            b.divideTimer = b.age + 150 + Math.random() * 200;
            generation++;
        }
    }

    // Antibiotic zones decay and kill
    for (let z = antibioticZones.length - 1; z >= 0; z--) {
        const zone = antibioticZones[z];
        zone.life--;
        zone.radius += 0.3; // Diffusion

        if (zone.life <= 0) {
            antibioticZones.splice(z, 1);
            continue;
        }

        // Kill susceptible bacteria in zone
        for (let i = bacteria.length - 1; i >= 0; i--) {
            const b = bacteria[i];
            const dx = b.x - zone.x, dy = b.y - zone.y;
            if (dx * dx + dy * dy < zone.radius * zone.radius) {
                if (!b.resistance[zone.type]) {
                    if (Math.random() < 0.08) {
                        bacteria.splice(i, 1);
                    }
                }
            }
        }
    }

    frame++;
}

function draw() {
    ctx.fillStyle = '#0a0e1a';
    ctx.fillRect(0, 0, W, H);

    // Petri dish
    ctx.beginPath();
    ctx.arc(centerX, centerY, petriR, 0, Math.PI * 2);
    const grad = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, petriR);
    grad.addColorStop(0, 'rgba(30,35,50,0.9)');
    grad.addColorStop(0.8, 'rgba(20,25,40,0.95)');
    grad.addColorStop(1, 'rgba(15,20,35,1)');
    ctx.fillStyle = grad;
    ctx.fill();

    // Petri dish rim
    ctx.beginPath();
    ctx.arc(centerX, centerY, petriR, 0, Math.PI * 2);
    ctx.strokeStyle = 'rgba(251,191,36,0.25)';
    ctx.lineWidth = 3;
    ctx.stroke();
    ctx.beginPath();
    ctx.arc(centerX, centerY, petriR + 4, 0, Math.PI * 2);
    ctx.strokeStyle = 'rgba(251,191,36,0.1)';
    ctx.lineWidth = 2;
    ctx.stroke();

    // Agar medium texture
    for (let i = 0; i < 30; i++) {
        const angle = (i / 30) * Math.PI * 2;
        const r = petriR * 0.3 + (i * 37 % petriR * 0.6);
        ctx.beginPath();
        ctx.arc(centerX + Math.cos(angle) * r, centerY + Math.sin(angle) * r, 2, 0, Math.PI * 2);
        ctx.fillStyle = 'rgba(255,255,255,0.02)';
        ctx.fill();
    }

    // Antibiotic zones
    for (let zone of antibioticZones) {
        const alpha = (zone.life / zone.maxLife) * 0.4;
        ctx.beginPath();
        ctx.arc(zone.x, zone.y, zone.radius, 0, Math.PI * 2);
        const zoneGrad = ctx.createRadialGradient(zone.x, zone.y, 0, zone.x, zone.y, zone.radius);
        const baseColor = zone.type === 0 ? '52,152,219' : zone.type === 1 ? '231,76,60' : '46,204,113';
        zoneGrad.addColorStop(0, `rgba(${baseColor},${alpha})`);
        zoneGrad.addColorStop(1, `rgba(${baseColor},0)`);
        ctx.fillStyle = zoneGrad;
        ctx.fill();

        // Zone border
        ctx.strokeStyle = `rgba(${baseColor},${alpha * 0.5})`;
        ctx.lineWidth = 1;
        ctx.stroke();
    }

    // Draw bacteria
    ctx.shadowBlur = 0;
    for (let b of bacteria) {
        const color = getBacteriaColor(b);
        ctx.beginPath();
        ctx.arc(b.x, b.y, b.size, 0, Math.PI * 2);
        ctx.fillStyle = color;

        const resCount = b.resistance.filter(r => r).length;
        if (resCount > 0) {
            ctx.shadowBlur = 4 + resCount * 3;
            ctx.shadowColor = color;
        }
        ctx.fill();
        ctx.shadowBlur = 0;

        // Resistance indicator ring for multi-resistant
        if (resCount >= 2) {
            ctx.beginPath();
            ctx.arc(b.x, b.y, b.size + 2, 0, Math.PI * 2);
            ctx.strokeStyle = 'rgba(255,74,74,0.5)';
            ctx.lineWidth = 0.5;
            ctx.stroke();
        }
    }

    // Stats
    let normal = 0, resistant = 0, multi = 0;
    for (let b of bacteria) {
        const rc = b.resistance.filter(r => r).length;
        if (rc === 0) normal++;
        else if (rc === 1) resistant++;
        else multi++;
    }
    document.getElementById('genNum').textContent = Math.floor(generation / 10);
    document.getElementById('totalBac').textContent = bacteria.length;
    document.getElementById('normalCount').textContent = normal;
    document.getElementById('resistCount').textContent = resistant;
    document.getElementById('multiCount').textContent = multi;
    document.getElementById('resPct').textContent = bacteria.length > 0 ?
        ((resistant + multi) / bacteria.length * 100).toFixed(1) + '%' : '0%';
}

// Mouse interaction
let mouseDown = false;
canvas.addEventListener('mousedown', (e) => { mouseDown = true; applyAntibiotic(e); });
canvas.addEventListener('mousemove', (e) => { if (mouseDown) applyAntibiotic(e); });
canvas.addEventListener('mouseup', () => mouseDown = false);
canvas.addEventListener('mouseleave', () => mouseDown = false);

function applyAntibiotic(e) {
    const rect = canvas.getBoundingClientRect();
    const mx = e.clientX - rect.left;
    const my = e.clientY - rect.top;
    const brushR = parseInt(document.getElementById('brushSize').value);
    if (isInPetri(mx, my)) {
        antibioticZones.push({
            x: mx, y: my,
            radius: brushR,
            type: selectedAB,
            life: 120,
            maxLife: 120
        });
    }
}

window.addEventListener('resize', () => { resize(); init(); });

function animate() { update(); draw(); requestAnimationFrame(animate); }
resize();
init();
animate();
</script>
</body>
</html>
