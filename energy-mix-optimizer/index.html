<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Renewable Energy Mix Optimizer</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
canvas { display: block; }
#title {
    position: fixed; top: 50px; left: 50%; transform: translateX(-50%);
    color: #fbbf24; font-size: 22px; font-weight: 600;
    text-shadow: 0 0 20px rgba(251,191,36,0.5); z-index: 10;
    pointer-events: none; text-align: center;
}
#controls {
    position: fixed; right: 20px; top: 80px;
    background: rgba(0,0,0,0.85); border: 1px solid rgba(251,191,36,0.3);
    border-radius: 12px; padding: 16px; z-index: 10; width: 230px;
}
.source-ctrl { margin-bottom: 10px; }
.source-label { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2px; }
.source-name { font-size: 11px; font-weight: bold; letter-spacing: 0.5px; }
.source-pct { font-size: 12px; color: #fff; font-weight: bold; }
input[type="range"] { width: 100%; accent-color: #fbbf24; height: 6px; }
button {
    width: 100%; margin-top: 8px;
    background: rgba(251,191,36,0.2); color: #fbbf24; border: 1px solid #fbbf24;
    padding: 8px; border-radius: 6px; cursor: pointer; font-size: 12px;
    font-weight: bold; transition: background 0.2s;
}
button:hover { background: rgba(251,191,36,0.4); }
</style>
</head>
<body>
<a href="../index.html" style="position:fixed;top:10px;left:10px;padding:8px 16px;background:rgba(0,0,0,0.7);color:#fbbf24;text-decoration:none;border-radius:6px;font-size:14px;z-index:999;font-family:sans-serif;">&#8592; Back to Gallery</a>
<div id="title">Renewable Energy Mix Optimizer</div>
<canvas id="canvas"></canvas>
<div id="controls">
    <div style="color:#fbbf24;font-size:13px;font-weight:bold;margin-bottom:10px;text-align:center;">Energy Source Mix</div>
</div>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let W, H;
function resize() { W = canvas.width = window.innerWidth; H = canvas.height = window.innerHeight; }
resize();
window.addEventListener('resize', resize);

const sources = [
    { name: 'Solar',   share: 20, color: '#ffc800', cost: 40,  co2: 5,   reliability: 0.25, icon: '\u2600' },
    { name: 'Wind',    share: 15, color: '#64c8ff', cost: 45,  co2: 7,   reliability: 0.35, icon: '\ud83c\udf2c' },
    { name: 'Hydro',   share: 10, color: '#0096ff', cost: 55,  co2: 4,   reliability: 0.90, icon: '\ud83d\udca7' },
    { name: 'Nuclear', share: 20, color: '#00ff64', cost: 70,  co2: 6,   reliability: 0.92, icon: '\u2622' },
    { name: 'Gas',     share: 25, color: '#ff7832', cost: 60,  co2: 450, reliability: 0.87, icon: '\ud83d\udd25' },
    { name: 'Coal',    share: 10, color: '#888888', cost: 65,  co2: 1000,reliability: 0.85, icon: '\u26cf' }
];

const controlsDiv = document.getElementById('controls');
sources.forEach((s, i) => {
    const div = document.createElement('div');
    div.className = 'source-ctrl';
    div.innerHTML = `
        <div class="source-label">
            <span class="source-name" style="color:${s.color}">${s.icon} ${s.name}</span>
            <span class="source-pct" id="pct-${i}">${s.share}%</span>
        </div>
        <input type="range" min="0" max="60" value="${s.share}" id="slider-${i}" style="accent-color:${s.color}">
    `;
    controlsDiv.appendChild(div);
    div.querySelector('input').addEventListener('input', e => {
        s.share = +e.target.value;
        document.getElementById('pct-' + i).textContent = s.share + '%';
    });
});
const optBtn = document.createElement('button');
optBtn.textContent = 'Auto-Optimize (Low CO\u2082)';
optBtn.addEventListener('click', autoOptimize);
controlsDiv.appendChild(optBtn);
const resetBtn = document.createElement('button');
resetBtn.textContent = 'Reset';
resetBtn.style.marginTop = '4px';
resetBtn.addEventListener('click', () => {
    const defaults = [20, 15, 10, 20, 25, 10];
    sources.forEach((s, i) => {
        s.share = defaults[i];
        document.getElementById('slider-' + i).value = defaults[i];
        document.getElementById('pct-' + i).textContent = defaults[i] + '%';
    });
});
controlsDiv.appendChild(resetBtn);

function autoOptimize() {
    const targets = [30, 25, 15, 25, 5, 0];
    sources.forEach((s, i) => {
        s.share = targets[i];
        document.getElementById('slider-' + i).value = targets[i];
        document.getElementById('pct-' + i).textContent = targets[i] + '%';
    });
}

function getMetrics() {
    const totalShare = sources.reduce((s, src) => s + src.share, 0) || 1;
    let totalCost = 0, totalCO2 = 0, totalReliability = 0;
    sources.forEach(s => {
        const frac = s.share / totalShare;
        totalCost += s.cost * frac;
        totalCO2 += s.co2 * frac;
        totalReliability += s.reliability * frac;
    });
    return { totalShare, totalCost, totalCO2, totalReliability, normalized: sources.map(s => s.share / totalShare) };
}

function drawPieChart(cx, cy, r) {
    const m = getMetrics();
    let startAngle = -Math.PI / 2;
    sources.forEach((s, i) => {
        const slice = m.normalized[i] * Math.PI * 2;
        if (slice < 0.001) return;
        ctx.beginPath();
        ctx.moveTo(cx, cy);
        ctx.arc(cx, cy, r, startAngle, startAngle + slice);
        ctx.closePath();
        const grad = ctx.createRadialGradient(cx, cy, r * 0.3, cx, cy, r);
        grad.addColorStop(0, s.color + 'aa');
        grad.addColorStop(1, s.color + '66');
        ctx.fillStyle = grad;
        ctx.fill();
        ctx.strokeStyle = '#0a0e1a';
        ctx.lineWidth = 2;
        ctx.stroke();

        const midAngle = startAngle + slice / 2;
        const labelR = r + 25;
        const lx = cx + Math.cos(midAngle) * labelR;
        const ly = cy + Math.sin(midAngle) * labelR;
        if (m.normalized[i] > 0.03) {
            ctx.fillStyle = s.color;
            ctx.font = 'bold 11px sans-serif';
            ctx.textAlign = Math.cos(midAngle) > 0 ? 'left' : 'right';
            ctx.fillText(s.name + ' ' + (m.normalized[i] * 100).toFixed(0) + '%', lx, ly);
        }

        const iconR = r * 0.65;
        const ix = cx + Math.cos(midAngle) * iconR;
        const iy = cy + Math.sin(midAngle) * iconR;
        if (m.normalized[i] > 0.05) {
            ctx.font = '16px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(s.icon, ix, iy + 5);
        }

        startAngle += slice;
    });

    ctx.beginPath();
    ctx.arc(cx, cy, r * 0.3, 0, Math.PI * 2);
    ctx.fillStyle = '#0a0e1a';
    ctx.fill();
    ctx.fillStyle = '#fbbf24';
    ctx.font = 'bold 14px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('Energy', cx, cy - 4);
    ctx.fillText('Mix', cx, cy + 14);
}

function drawBarMetric(x, y, w, h, value, maxVal, label, color, unit) {
    ctx.fillStyle = 'rgba(0,0,0,0.5)';
    ctx.beginPath();
    ctx.roundRect(x, y, w, h, 6);
    ctx.fill();
    const fillW = (value / maxVal) * (w - 8);
    ctx.fillStyle = color + '44';
    ctx.beginPath();
    ctx.roundRect(x + 4, y + 4, fillW, h - 8, 4);
    ctx.fill();
    ctx.fillStyle = color;
    ctx.font = 'bold 11px sans-serif';
    ctx.textAlign = 'left';
    ctx.fillText(label, x + 8, y - 4);
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 13px sans-serif';
    ctx.textAlign = 'right';
    ctx.fillText(value.toFixed(1) + ' ' + unit, x + w - 8, y + h / 2 + 5);
}

function drawStackedArea(x, y, w, h) {
    ctx.fillStyle = 'rgba(0,0,0,0.6)';
    ctx.strokeStyle = 'rgba(251,191,36,0.2)';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.roundRect(x, y, w, h, 8);
    ctx.fill();
    ctx.stroke();
    ctx.fillStyle = '#fbbf24';
    ctx.font = 'bold 11px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('24-Hour Generation Profile', x + w / 2, y + 14);

    const gx = x + 10, gy = y + 24, gw = w - 20, gh = h - 36;
    const hours = 24;
    const profiles = sources.map((s, i) => {
        const vals = [];
        for (let hr = 0; hr < hours; hr++) {
            let factor = 1;
            if (s.name === 'Solar') factor = Math.max(0, Math.sin((hr - 6) * Math.PI / 12)) * (hr > 6 && hr < 18 ? 1 : 0);
            else if (s.name === 'Wind') factor = 0.4 + 0.3 * Math.sin(hr * 0.5) + 0.2 * Math.cos(hr * 0.3);
            else factor = 0.8 + 0.15 * Math.sin(hr * 0.3);
            vals.push(s.share * factor);
        }
        return vals;
    });

    for (let si = sources.length - 1; si >= 0; si--) {
        ctx.beginPath();
        for (let hr = 0; hr < hours; hr++) {
            let stackVal = 0;
            for (let j = 0; j <= si; j++) stackVal += profiles[j][hr];
            const px = gx + (hr / (hours - 1)) * gw;
            const py = gy + gh - (stackVal / 120) * gh;
            if (hr === 0) ctx.moveTo(px, py);
            else ctx.lineTo(px, py);
        }
        ctx.lineTo(gx + gw, gy + gh);
        ctx.lineTo(gx, gy + gh);
        ctx.closePath();
        ctx.fillStyle = sources[si].color + '55';
        ctx.fill();
    }

    ctx.strokeStyle = 'rgba(255,255,255,0.15)';
    ctx.lineWidth = 1;
    for (let hr = 0; hr < hours; hr += 6) {
        const px = gx + (hr / (hours - 1)) * gw;
        ctx.beginPath(); ctx.moveTo(px, gy); ctx.lineTo(px, gy + gh); ctx.stroke();
        ctx.fillStyle = '#666';
        ctx.font = '8px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText(hr + 'h', px, gy + gh + 10);
    }
}

function drawScoreCard(x, y, w, h, m) {
    ctx.fillStyle = 'rgba(0,0,0,0.7)';
    ctx.strokeStyle = 'rgba(251,191,36,0.2)';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.roundRect(x, y, w, h, 10);
    ctx.fill();
    ctx.stroke();

    ctx.fillStyle = '#fbbf24';
    ctx.font = 'bold 13px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('Performance Score', x + w / 2, y + 22);

    const co2Score = Math.max(0, 100 - m.totalCO2 / 5);
    const costScore = Math.max(0, 100 - (m.totalCost - 30));
    const relScore = m.totalReliability * 100;
    const overall = (co2Score * 0.4 + costScore * 0.3 + relScore * 0.3);

    const scores = [
        ['CO\u2082 Score', co2Score, co2Score > 70 ? '#4f8' : co2Score > 40 ? '#fb4' : '#f44'],
        ['Cost Score', costScore, costScore > 70 ? '#4f8' : costScore > 40 ? '#fb4' : '#f44'],
        ['Reliability', relScore, relScore > 70 ? '#4f8' : relScore > 40 ? '#fb4' : '#f44'],
        ['OVERALL', overall, overall > 70 ? '#4f8' : overall > 40 ? '#fb4' : '#f44']
    ];

    scores.forEach((s, i) => {
        const sy = y + 40 + i * 30;
        ctx.fillStyle = '#888';
        ctx.font = '11px sans-serif';
        ctx.textAlign = 'left';
        ctx.fillText(s[0], x + 12, sy);

        const barX = x + 90, barW = w - 140, barH = 10;
        ctx.fillStyle = 'rgba(255,255,255,0.1)';
        ctx.beginPath();
        ctx.roundRect(barX, sy - 8, barW, barH, 3);
        ctx.fill();
        ctx.fillStyle = s[2] + '88';
        ctx.beginPath();
        ctx.roundRect(barX, sy - 8, barW * (s[1] / 100), barH, 3);
        ctx.fill();

        ctx.fillStyle = s[2];
        ctx.font = 'bold 11px sans-serif';
        ctx.textAlign = 'right';
        ctx.fillText(s[1].toFixed(0), x + w - 12, sy);
    });
}

function drawAnimatedParticles() {
    const t = Date.now() / 1000;
    sources.forEach((s, i) => {
        if (s.share < 3) return;
        const count = Math.floor(s.share / 8);
        for (let j = 0; j < count; j++) {
            const phase = t * 0.5 + j * 1.3 + i * 2;
            const px = W * 0.3 + Math.cos(phase) * 20 + Math.cos(phase * 0.7) * 30;
            const py = H * 0.2 + Math.sin(phase * 0.8) * 15 + i * 8;
            ctx.beginPath();
            ctx.arc(px, py, 1.5, 0, Math.PI * 2);
            ctx.fillStyle = s.color + '44';
            ctx.fill();
        }
    });
}

function animate() {
    ctx.clearRect(0, 0, W, H);
    ctx.fillStyle = '#0a0e1a';
    ctx.fillRect(0, 0, W, H);

    drawAnimatedParticles();

    const m = getMetrics();
    const pieR = Math.min(140, W * 0.12, H * 0.18);
    drawPieChart(W * 0.22, H * 0.32, pieR);

    const barX = W * 0.05, barW = Math.min(300, W * 0.32);
    drawBarMetric(barX, H * 0.6, barW, 30, m.totalCost, 80, 'Avg Cost ($/MWh)', '#4af', '$/MWh');
    drawBarMetric(barX, H * 0.67, barW, 30, m.totalCO2, 1000, 'CO\u2082 Emissions (g/kWh)', m.totalCO2 < 200 ? '#4f8' : m.totalCO2 < 500 ? '#fb4' : '#f44', 'g/kWh');
    drawBarMetric(barX, H * 0.74, barW, 30, m.totalReliability * 100, 100, 'Grid Reliability (%)', m.totalReliability > 0.7 ? '#4f8' : '#fb4', '%');

    const saW = Math.min(380, W * 0.35);
    drawStackedArea(W * 0.38, H * 0.58, saW, 170);
    drawScoreCard(W * 0.38, H * 0.1, Math.min(300, W * 0.28), 180);

    requestAnimationFrame(animate);
}
animate();
</script>
</body>
</html>
