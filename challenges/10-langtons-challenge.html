<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Langton's Ant Challenge - CCAB</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600;700&family=Nunito:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Nunito', sans-serif;
            background: #1a1a2e;
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            color: #8A9A5B;
            text-decoration: none;
            font-weight: 500;
            padding: 8px 16px;
            background: rgba(0,0,0,0.5);
            border-radius: 20px;
        }
        h1 {
            font-family: 'Lora', serif;
            color: #8A9A5B;
            margin: 20px 0;
        }
        .game-container {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }
        canvas {
            border: 2px solid #333;
            border-radius: 10px;
        }
        .controls {
            background: rgba(0,0,0,0.5);
            padding: 20px;
            border-radius: 15px;
            width: 300px;
        }
        .controls h3 {
            font-family: 'Lora', serif;
            color: #8A9A5B;
            margin-bottom: 15px;
        }
        .info-box {
            background: rgba(138, 154, 91, 0.2);
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 15px;
            font-size: 0.85rem;
        }
        .control-group {
            margin-bottom: 12px;
        }
        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9rem;
            color: #ccc;
        }
        .control-group input[type="range"] {
            width: 100%;
            accent-color: #BC6C25;
        }
        .btn-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        .btn {
            background: linear-gradient(135deg, #606C38, #8A9A5B);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            flex: 1;
            min-width: 80px;
        }
        .btn:hover { transform: scale(1.02); }
        .btn.secondary {
            background: linear-gradient(135deg, #BC6C25, #DDA15E);
        }
        .rule-selector {
            margin: 15px 0;
        }
        .rule-selector h4 {
            color: #8A9A5B;
            margin-bottom: 8px;
        }
        .rule-btn {
            background: rgba(138, 154, 91, 0.2);
            border: 1px solid #8A9A5B;
            color: #8A9A5B;
            padding: 6px 10px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.8rem;
            margin: 3px;
        }
        .rule-btn.active {
            background: #8A9A5B;
            color: white;
        }
        .stats {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #444;
        }
        .stats div {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            font-size: 0.85rem;
        }
        .stats .label { color: #888; }
        .stats .value { color: #8A9A5B; font-weight: bold; }
        .challenge-status {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #444;
        }
        .challenge-item {
            margin-bottom: 8px;
            font-size: 0.8rem;
        }
        .challenge-item.completed { color: #4CAF50; }
        .challenge-item.pending { color: #888; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Challenges</a>

    <h1>Langton's Ant Challenge</h1>

    <div class="game-container">
        <canvas id="canvas" width="500" height="500"></canvas>

        <div class="controls">
            <h3>üêú Langton's Ant</h3>

            <div class="info-box">
                Simple rules create complex emergent behavior. On white: turn right, flip to black. On black: turn left, flip to white.
            </div>

            <div class="control-group">
                <label>Speed: <span id="speedVal">10</span> steps/frame</label>
                <input type="range" id="speed" min="1" max="100" value="10">
            </div>

            <div class="btn-group">
                <button class="btn" id="playBtn" onclick="togglePlay()">‚ñ∂ Play</button>
                <button class="btn" onclick="step()">Step</button>
                <button class="btn secondary" onclick="reset()">Reset</button>
            </div>

            <div class="rule-selector">
                <h4>Rule Variation:</h4>
                <button class="rule-btn active" onclick="setRule('RL')">RL (Classic)</button>
                <button class="rule-btn" onclick="setRule('RLR')">RLR</button>
                <button class="rule-btn" onclick="setRule('LLRR')">LLRR</button>
                <button class="rule-btn" onclick="setRule('LRRRRRLLR')">LRRRRRLLR</button>
            </div>

            <div class="stats">
                <div><span class="label">Steps:</span> <span class="value" id="steps">0</span></div>
                <div><span class="label">Black Cells:</span> <span class="value" id="blackCells">0</span></div>
                <div><span class="label">Direction:</span> <span class="value" id="direction">‚Üë</span></div>
                <div><span class="label">Highway:</span> <span class="value" id="highway">Not yet</span></div>
            </div>

            <div class="challenge-status">
                <div class="challenge-item pending" id="ch1">‚≠ï Run 1000 steps</div>
                <div class="challenge-item pending" id="ch2">‚≠ï Observe highway emergence (~10,000 steps)</div>
                <div class="challenge-item pending" id="ch3">‚≠ï Try all 4 rule variations</div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        const COLS = 100;
        const ROWS = 100;
        const CELL = canvas.width / COLS;

        let grid = [];
        let ant = { x: 50, y: 50, dir: 0 }; // 0=up, 1=right, 2=down, 3=left
        let steps = 0;
        let isPlaying = false;
        let stepsPerFrame = 10;
        let rule = 'RL';
        let triedRules = new Set(['RL']);
        let completedChallenges = new Set();
        let highwayDetected = false;
        let recentPositions = [];

        const DIRS = [
            { dx: 0, dy: -1, symbol: '‚Üë' },
            { dx: 1, dy: 0, symbol: '‚Üí' },
            { dx: 0, dy: 1, symbol: '‚Üì' },
            { dx: -1, dy: 0, symbol: '‚Üê' }
        ];

        const COLORS = [
            '#1a1a2e', // 0 - background
            '#8A9A5B', // 1 - green
            '#BC6C25', // 2 - orange
            '#4CAF50', // 3 - bright green
            '#f44336', // 4 - red
            '#9C27B0', // 5 - purple
            '#2196F3', // 6 - blue
            '#FFEB3B', // 7 - yellow
            '#00BCD4', // 8 - cyan
        ];

        function initGrid() {
            grid = [];
            for (let y = 0; y < ROWS; y++) {
                grid[y] = [];
                for (let x = 0; x < COLS; x++) {
                    grid[y][x] = 0;
                }
            }
        }

        function reset() {
            initGrid();
            ant = { x: Math.floor(COLS / 2), y: Math.floor(ROWS / 2), dir: 0 };
            steps = 0;
            highwayDetected = false;
            recentPositions = [];
            draw();
            updateStats();
        }

        function setRule(r) {
            rule = r;
            triedRules.add(r);

            document.querySelectorAll('.rule-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent.startsWith(r));
            });

            reset();
            checkChallenges();
        }

        function step() {
            const x = ant.x;
            const y = ant.y;
            const currentColor = grid[y][x];
            const numColors = rule.length;

            // Get turn direction from rule
            const turn = rule[currentColor];

            // Turn
            if (turn === 'L') {
                ant.dir = (ant.dir + 3) % 4;
            } else {
                ant.dir = (ant.dir + 1) % 4;
            }

            // Flip color
            grid[y][x] = (currentColor + 1) % numColors;

            // Move forward
            ant.x += DIRS[ant.dir].dx;
            ant.y += DIRS[ant.dir].dy;

            // Wrap around
            if (ant.x < 0) ant.x = COLS - 1;
            if (ant.x >= COLS) ant.x = 0;
            if (ant.y < 0) ant.y = ROWS - 1;
            if (ant.y >= ROWS) ant.y = 0;

            steps++;

            // Track positions for highway detection
            recentPositions.push({ x: ant.x, y: ant.y, step: steps });
            if (recentPositions.length > 200) recentPositions.shift();
        }

        function detectHighway() {
            if (recentPositions.length < 104) return false;

            // Highway has period 104 in classic Langton's ant
            // Check if we're in a repeating pattern
            const period = 104;
            const recent = recentPositions.slice(-period * 2);

            if (recent.length < period * 2) return false;

            // Check if last 'period' positions match the period before
            let matches = 0;
            for (let i = 0; i < period; i++) {
                const curr = recent[recent.length - 1 - i];
                const prev = recent[recent.length - 1 - i - period];

                // Check if direction is consistent (diagonal movement)
                const dx = curr.x - prev.x;
                const dy = curr.y - prev.y;

                // Highway moves diagonally
                if (Math.abs(dx) === Math.abs(dy) || (Math.abs(dx) <= 2 && Math.abs(dy) <= 2)) {
                    matches++;
                }
            }

            return matches > period * 0.8;
        }

        function togglePlay() {
            isPlaying = !isPlaying;
            document.getElementById('playBtn').textContent = isPlaying ? '‚è∏ Pause' : '‚ñ∂ Play';
            if (isPlaying) gameLoop();
        }

        function gameLoop() {
            if (!isPlaying) return;

            for (let i = 0; i < stepsPerFrame; i++) {
                step();
            }

            draw();
            updateStats();
            checkChallenges();

            requestAnimationFrame(gameLoop);
        }

        function draw() {
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw grid
            for (let y = 0; y < ROWS; y++) {
                for (let x = 0; x < COLS; x++) {
                    if (grid[y][x] > 0) {
                        ctx.fillStyle = COLORS[grid[y][x]];
                        ctx.fillRect(x * CELL, y * CELL, CELL, CELL);
                    }
                }
            }

            // Draw ant
            ctx.fillStyle = '#f44336';
            ctx.beginPath();
            const cx = ant.x * CELL + CELL / 2;
            const cy = ant.y * CELL + CELL / 2;
            const angle = ant.dir * Math.PI / 2 - Math.PI / 2;

            ctx.save();
            ctx.translate(cx, cy);
            ctx.rotate(angle);
            ctx.beginPath();
            ctx.moveTo(0, -CELL / 2);
            ctx.lineTo(CELL / 3, CELL / 3);
            ctx.lineTo(-CELL / 3, CELL / 3);
            ctx.closePath();
            ctx.fill();
            ctx.restore();
        }

        function updateStats() {
            let blackCells = 0;
            for (let y = 0; y < ROWS; y++) {
                for (let x = 0; x < COLS; x++) {
                    if (grid[y][x] > 0) blackCells++;
                }
            }

            document.getElementById('steps').textContent = steps.toLocaleString();
            document.getElementById('blackCells').textContent = blackCells;
            document.getElementById('direction').textContent = DIRS[ant.dir].symbol;

            // Check for highway
            if (!highwayDetected && steps > 10000 && detectHighway()) {
                highwayDetected = true;
                document.getElementById('highway').textContent = 'Detected!';
                document.getElementById('highway').style.color = '#4CAF50';
            } else if (!highwayDetected) {
                document.getElementById('highway').textContent = steps > 10000 ? 'Looking...' : 'Not yet';
            }
        }

        function checkChallenges() {
            // Challenge 1: 1000 steps
            if (!completedChallenges.has('ch1') && steps >= 1000) {
                completedChallenges.add('ch1');
                markComplete('ch1', 20);
            }

            // Challenge 2: Highway emergence
            if (!completedChallenges.has('ch2') && highwayDetected) {
                completedChallenges.add('ch2');
                markComplete('ch2', 50);
            }

            // Challenge 3: Try all 4 rules
            if (!completedChallenges.has('ch3') && triedRules.size >= 4) {
                completedChallenges.add('ch3');
                markComplete('ch3', 30);
            }
        }

        function markComplete(id, xp) {
            const el = document.getElementById(id);
            el.className = 'challenge-item completed';
            el.textContent = '‚úÖ ' + el.textContent.substring(2);
            showNotification(xp);

            try {
                const data = JSON.parse(localStorage.getItem('ccab-challenges')) || { completed: [], xp: 0 };
                if (!data.completed.includes('langtons-' + id)) {
                    data.completed.push('langtons-' + id);
                    data.xp += xp;
                    localStorage.setItem('ccab-challenges', JSON.stringify(data));
                }
            } catch (e) {}
        }

        function showNotification(xp) {
            const notification = document.createElement('div');
            notification.innerHTML = `<div style="font-size: 2rem;">üèÜ</div><div>Challenge Complete!</div><div>+${xp} XP</div>`;
            notification.style.cssText = `
                position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #606C38, #8A9A5B); color: white;
                padding: 2rem 3rem; border-radius: 20px; text-align: center; z-index: 10000;
            `;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 2500);
        }

        // Control bindings
        document.getElementById('speed').oninput = (e) => {
            stepsPerFrame = parseInt(e.target.value);
            document.getElementById('speedVal').textContent = stepsPerFrame;
        };

        initGrid();
        draw();
        updateStats();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
