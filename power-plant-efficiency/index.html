<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Power Plant Efficiency (Carnot)</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
canvas { display: block; }
#title {
    position: fixed; top: 50px; left: 50%; transform: translateX(-50%);
    color: #fbbf24; font-size: 22px; font-weight: 600;
    text-shadow: 0 0 20px rgba(251,191,36,0.5); z-index: 10;
    pointer-events: none; text-align: center;
}
#controls {
    position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
    background: rgba(0,0,0,0.85); border: 1px solid rgba(251,191,36,0.3);
    border-radius: 12px; padding: 14px 20px; display: flex; gap: 20px;
    align-items: center; z-index: 10; flex-wrap: wrap; justify-content: center;
}
.control-group { display: flex; flex-direction: column; align-items: center; gap: 4px; }
label { color: #fbbf24; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; }
input[type="range"] { width: 140px; accent-color: #fbbf24; }
.value-display { color: #fff; font-size: 13px; font-weight: bold; }
button {
    background: rgba(251,191,36,0.2); color: #fbbf24; border: 1px solid #fbbf24;
    padding: 8px 14px; border-radius: 6px; cursor: pointer; font-size: 12px;
    font-weight: bold; transition: background 0.2s; min-width: 80px;
}
button:hover { background: rgba(251,191,36,0.4); }
button.active { background: rgba(251,191,36,0.5); }
</style>
</head>
<body>
<a href="../index.html" style="position:fixed;top:10px;left:10px;padding:8px 16px;background:rgba(0,0,0,0.7);color:#fbbf24;text-decoration:none;border-radius:6px;font-size:14px;z-index:999;font-family:sans-serif;">&#8592; Back to Gallery</a>
<div id="title">Power Plant Efficiency (Carnot)</div>
<canvas id="canvas"></canvas>
<div id="controls">
    <div class="control-group">
        <label>Hot Source (\u00b0C)</label>
        <input type="range" id="hotSlider" min="100" max="1500" value="600">
        <span class="value-display" id="hotVal">600\u00b0C</span>
    </div>
    <div class="control-group">
        <label>Cold Sink (\u00b0C)</label>
        <input type="range" id="coldSlider" min="0" max="100" value="25">
        <span class="value-display" id="coldVal">25\u00b0C</span>
    </div>
    <button id="btn-coal" class="active" onclick="selectPlant('coal')">Coal</button>
    <button id="btn-gas" onclick="selectPlant('gas')">Gas</button>
    <button id="btn-nuclear" onclick="selectPlant('nuclear')">Nuclear</button>
    <button id="btn-solar" onclick="selectPlant('solar')">Solar CSP</button>
    <button id="btn-geothermal" onclick="selectPlant('geothermal')">Geothermal</button>
</div>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let W, H;
function resize() { W = canvas.width = window.innerWidth; H = canvas.height = window.innerHeight; }
resize();
window.addEventListener('resize', resize);

let hotTemp = 600, coldTemp = 25;
let selectedPlant = 'coal';

const plants = {
    coal:       { name: 'Coal Plant',     hotRange: [500, 600],  actualEff: 0.33, color: '#888', icon: '\u26cf' },
    gas:        { name: 'Gas Turbine (CCGT)', hotRange: [1000, 1400], actualEff: 0.55, color: '#ff7832', icon: '\ud83d\udd25' },
    nuclear:    { name: 'Nuclear (PWR)',  hotRange: [300, 330],  actualEff: 0.33, color: '#00ff64', icon: '\u2622' },
    solar:      { name: 'Solar CSP',      hotRange: [400, 565],  actualEff: 0.25, color: '#ffc800', icon: '\u2600' },
    geothermal: { name: 'Geothermal',     hotRange: [150, 300],  actualEff: 0.12, color: '#ff6666', icon: '\ud83c\udf0b' }
};

document.getElementById('hotSlider').addEventListener('input', e => {
    hotTemp = +e.target.value;
    document.getElementById('hotVal').textContent = hotTemp + '\u00b0C';
});
document.getElementById('coldSlider').addEventListener('input', e => {
    coldTemp = +e.target.value;
    if (coldTemp >= hotTemp) coldTemp = hotTemp - 10;
    document.getElementById('coldVal').textContent = coldTemp + '\u00b0C';
});

function selectPlant(type) {
    selectedPlant = type;
    const p = plants[type];
    hotTemp = Math.round((p.hotRange[0] + p.hotRange[1]) / 2);
    document.getElementById('hotSlider').value = hotTemp;
    document.getElementById('hotVal').textContent = hotTemp + '\u00b0C';
    ['coal', 'gas', 'nuclear', 'solar', 'geothermal'].forEach(k => {
        document.getElementById('btn-' + k).classList.toggle('active', k === type);
    });
}
window.selectPlant = selectPlant;

function carnotEfficiency(tHot, tCold) {
    const tH = tHot + 273.15;
    const tC = tCold + 273.15;
    return Math.max(0, 1 - tC / tH);
}

function drawHeatEngine(x, y, w, h) {
    const carnot = carnotEfficiency(hotTemp, coldTemp);
    const plant = plants[selectedPlant];
    const qIn = 100;
    const wOut = qIn * plant.actualEff;
    const qWaste = qIn - wOut;

    // Hot source
    const hotY = y;
    const hotH = 60;
    const hotGrad = ctx.createLinearGradient(x, hotY, x + w, hotY);
    hotGrad.addColorStop(0, '#cc2200');
    hotGrad.addColorStop(0.5, '#ff4400');
    hotGrad.addColorStop(1, '#cc2200');
    ctx.fillStyle = hotGrad;
    ctx.beginPath();
    ctx.roundRect(x, hotY, w, hotH, 8);
    ctx.fill();
    ctx.strokeStyle = '#ff6633';
    ctx.lineWidth = 2;
    ctx.stroke();
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 16px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('HOT SOURCE', x + w / 2, hotY + 25);
    ctx.font = '14px sans-serif';
    ctx.fillText(hotTemp + '\u00b0C (' + (hotTemp + 273) + ' K)', x + w / 2, hotY + 45);

    // Engine
    const engY = hotY + hotH + 70;
    const engH = 80;
    ctx.fillStyle = plant.color + '33';
    ctx.beginPath();
    ctx.roundRect(x + 20, engY, w - 40, engH, 10);
    ctx.fill();
    ctx.strokeStyle = plant.color;
    ctx.lineWidth = 2;
    ctx.stroke();
    ctx.fillStyle = plant.color;
    ctx.font = 'bold 14px sans-serif';
    ctx.fillText(plant.icon + ' ' + plant.name, x + w / 2, engY + 30);
    ctx.fillStyle = '#fff';
    ctx.font = '12px sans-serif';
    ctx.fillText('Actual: ' + (plant.actualEff * 100).toFixed(1) + '%', x + w / 2, engY + 50);
    ctx.fillStyle = '#fbbf24';
    ctx.fillText('Carnot Limit: ' + (carnot * 100).toFixed(1) + '%', x + w / 2, engY + 68);

    // Cold sink
    const coldY = engY + engH + 70;
    const coldH = 60;
    const coldGrad = ctx.createLinearGradient(x, coldY, x + w, coldY);
    coldGrad.addColorStop(0, '#0044aa');
    coldGrad.addColorStop(0.5, '#0066dd');
    coldGrad.addColorStop(1, '#0044aa');
    ctx.fillStyle = coldGrad;
    ctx.beginPath();
    ctx.roundRect(x, coldY, w, coldH, 8);
    ctx.fill();
    ctx.strokeStyle = '#4488ff';
    ctx.lineWidth = 2;
    ctx.stroke();
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 16px sans-serif';
    ctx.fillText('COLD SINK', x + w / 2, coldY + 25);
    ctx.font = '14px sans-serif';
    ctx.fillText(coldTemp + '\u00b0C (' + (coldTemp + 273) + ' K)', x + w / 2, coldY + 45);

    // Arrows: Qin
    drawArrow(x + w / 2, hotY + hotH + 5, x + w / 2, engY - 5, '#ff4400', 'Q_in = ' + qIn.toFixed(0) + ' MW', 3 + qIn / 30);
    // Arrows: Wout
    drawArrow(x + w + 10, engY + engH / 2, x + w + 80, engY + engH / 2, '#fbbf24', 'W = ' + wOut.toFixed(1) + ' MW', 2 + wOut / 20);
    // Arrows: Qwaste
    drawArrow(x + w / 2, engY + engH + 5, x + w / 2, coldY - 5, '#4488ff', 'Q_waste = ' + qWaste.toFixed(1) + ' MW', 2 + qWaste / 30);

    // Animated heat particles
    const t = Date.now() / 1000;
    for (let i = 0; i < 8; i++) {
        const p = (t * 0.5 + i * 0.125) % 1;
        const px = x + w / 2 + Math.sin(t * 2 + i) * 10;
        const py = hotY + hotH + 5 + p * (engY - hotY - hotH - 10);
        ctx.beginPath();
        ctx.arc(px, py, 3, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(255,100,0,${0.6 * (1 - p)})`;
        ctx.fill();
    }
    for (let i = 0; i < 6; i++) {
        const p = (t * 0.4 + i * 0.167) % 1;
        const px = x + w / 2 + Math.sin(t * 1.5 + i) * 8;
        const py = engY + engH + 5 + p * (coldY - engY - engH - 10);
        ctx.beginPath();
        ctx.arc(px, py, 2.5, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(80,140,255,${0.5 * (1 - p)})`;
        ctx.fill();
    }
    for (let i = 0; i < 4; i++) {
        const p = (t * 0.6 + i * 0.25) % 1;
        const px = x + w + 10 + p * 70;
        const py = engY + engH / 2 + Math.sin(t * 3 + i) * 5;
        ctx.beginPath();
        ctx.arc(px, py, 2.5, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(251,191,36,${0.7 * (1 - p)})`;
        ctx.fill();
    }
}

function drawArrow(x1, y1, x2, y2, color, label, width) {
    const dx = x2 - x1, dy = y2 - y1;
    const len = Math.sqrt(dx * dx + dy * dy);
    const nx = dx / len, ny = dy / len;
    ctx.beginPath();
    ctx.moveTo(x1, y1);
    ctx.lineTo(x2 - nx * 10, y2 - ny * 10);
    ctx.strokeStyle = color;
    ctx.lineWidth = width;
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(x2, y2);
    ctx.lineTo(x2 - nx * 12 - ny * 6, y2 - ny * 12 + nx * 6);
    ctx.lineTo(x2 - nx * 12 + ny * 6, y2 - ny * 12 - nx * 6);
    ctx.closePath();
    ctx.fillStyle = color;
    ctx.fill();
    const lx = (x1 + x2) / 2 + ny * 18;
    const ly = (y1 + y2) / 2 - nx * 18;
    ctx.fillStyle = color;
    ctx.font = 'bold 10px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText(label, lx, ly);
}

function drawSankeyDiagram(x, y, w, h) {
    ctx.fillStyle = 'rgba(0,0,0,0.65)';
    ctx.strokeStyle = 'rgba(251,191,36,0.2)';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.roundRect(x, y, w, h, 10);
    ctx.fill();
    ctx.stroke();
    ctx.fillStyle = '#fbbf24';
    ctx.font = 'bold 12px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('Energy Flow (Sankey)', x + w / 2, y + 18);

    const plant = plants[selectedPlant];
    const eff = plant.actualEff;
    const totalH = h - 50;
    const workH = totalH * eff;
    const wasteH = totalH * (1 - eff);

    const sx = x + 30;
    const sy = y + 35;
    const ew = w - 60;

    // Input
    ctx.fillStyle = '#ff440044';
    ctx.fillRect(sx, sy, ew * 0.25, totalH);
    ctx.strokeStyle = '#ff4400';
    ctx.lineWidth = 1;
    ctx.strokeRect(sx, sy, ew * 0.25, totalH);
    ctx.fillStyle = '#ff6633';
    ctx.font = '10px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('Q_in', sx + ew * 0.125, sy + totalH / 2);
    ctx.fillText('100%', sx + ew * 0.125, sy + totalH / 2 + 14);

    // Work output
    ctx.fillStyle = '#fbbf2444';
    const workY = sy;
    ctx.beginPath();
    ctx.moveTo(sx + ew * 0.25, sy);
    ctx.lineTo(sx + ew * 0.75, sy);
    ctx.lineTo(sx + ew * 0.75, sy + workH);
    ctx.lineTo(sx + ew * 0.25, sy + workH);
    ctx.closePath();
    ctx.fill();
    ctx.strokeStyle = '#fbbf24';
    ctx.stroke();

    ctx.fillStyle = '#fbbf2444';
    ctx.fillRect(sx + ew * 0.75, sy, ew * 0.25, workH);
    ctx.strokeStyle = '#fbbf24';
    ctx.strokeRect(sx + ew * 0.75, sy, ew * 0.25, workH);
    ctx.fillStyle = '#fbbf24';
    ctx.font = '10px sans-serif';
    ctx.fillText('Work', sx + ew * 0.875, sy + workH / 2);
    ctx.fillText((eff * 100).toFixed(1) + '%', sx + ew * 0.875, sy + workH / 2 + 14);

    // Waste
    ctx.fillStyle = '#4488ff33';
    ctx.beginPath();
    ctx.moveTo(sx + ew * 0.25, sy + workH);
    ctx.lineTo(sx + ew * 0.75, sy + workH);
    ctx.lineTo(sx + ew * 0.75, sy + totalH);
    ctx.lineTo(sx + ew * 0.25, sy + totalH);
    ctx.closePath();
    ctx.fill();
    ctx.strokeStyle = '#4488ff';
    ctx.stroke();

    ctx.fillStyle = '#4488ff33';
    ctx.fillRect(sx + ew * 0.75, sy + workH, ew * 0.25, wasteH);
    ctx.strokeStyle = '#4488ff';
    ctx.strokeRect(sx + ew * 0.75, sy + workH, ew * 0.25, wasteH);
    ctx.fillStyle = '#4488ff';
    ctx.fillText('Waste Heat', sx + ew * 0.875, sy + workH + wasteH / 2);
    ctx.fillText(((1 - eff) * 100).toFixed(1) + '%', sx + ew * 0.875, sy + workH + wasteH / 2 + 14);
}

function drawComparisonChart(x, y, w, h) {
    ctx.fillStyle = 'rgba(0,0,0,0.65)';
    ctx.strokeStyle = 'rgba(251,191,36,0.2)';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.roundRect(x, y, w, h, 10);
    ctx.fill();
    ctx.stroke();
    ctx.fillStyle = '#fbbf24';
    ctx.font = 'bold 12px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('Efficiency Comparison', x + w / 2, y + 18);

    const barH = 16;
    const gap = 6;
    const gx = x + 90, gw = w - 110;
    let by = y + 32;
    const plantKeys = ['coal', 'gas', 'nuclear', 'solar', 'geothermal'];
    plantKeys.forEach(key => {
        const p = plants[key];
        const tH = (p.hotRange[0] + p.hotRange[1]) / 2;
        const carnotEff = carnotEfficiency(tH, 25);
        ctx.fillStyle = key === selectedPlant ? '#fff' : '#888';
        ctx.font = key === selectedPlant ? 'bold 10px sans-serif' : '10px sans-serif';
        ctx.textAlign = 'right';
        ctx.fillText(p.name, gx - 6, by + barH / 2 + 3);

        // Carnot bar
        ctx.fillStyle = 'rgba(255,255,255,0.1)';
        ctx.fillRect(gx, by, gw * carnotEff, barH);
        ctx.strokeStyle = 'rgba(255,255,255,0.2)';
        ctx.lineWidth = 0.5;
        ctx.strokeRect(gx, by, gw * carnotEff, barH);

        // Actual bar
        ctx.fillStyle = p.color + '88';
        ctx.fillRect(gx, by + 2, gw * p.actualEff, barH - 4);

        ctx.fillStyle = p.color;
        ctx.font = '9px sans-serif';
        ctx.textAlign = 'left';
        ctx.fillText((p.actualEff * 100).toFixed(0) + '% / ' + (carnotEff * 100).toFixed(0) + '% Carnot', gx + gw * carnotEff + 5, by + barH / 2 + 3);

        by += barH + gap;
    });

    ctx.fillStyle = 'rgba(255,255,255,0.1)';
    ctx.fillRect(gx - 2, by + 2, 8, 8);
    ctx.fillStyle = '#888';
    ctx.font = '8px sans-serif';
    ctx.textAlign = 'left';
    ctx.fillText('Carnot Limit', gx + 10, by + 10);
    ctx.fillStyle = '#fbbf2488';
    ctx.fillRect(gx + 80, by + 2, 8, 8);
    ctx.fillStyle = '#888';
    ctx.fillText('Actual Efficiency', gx + 92, by + 10);
}

function drawEfficiencyFormula(x, y) {
    ctx.fillStyle = 'rgba(0,0,0,0.7)';
    ctx.beginPath();
    ctx.roundRect(x, y, 220, 70, 8);
    ctx.fill();
    ctx.strokeStyle = 'rgba(251,191,36,0.2)';
    ctx.lineWidth = 1;
    ctx.stroke();
    ctx.fillStyle = '#fbbf24';
    ctx.font = 'bold 11px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('Carnot Efficiency', x + 110, y + 16);
    ctx.fillStyle = '#fff';
    ctx.font = '14px monospace';
    ctx.fillText('\u03b7 = 1 - T_cold / T_hot', x + 110, y + 38);
    const carnot = carnotEfficiency(hotTemp, coldTemp);
    ctx.fillStyle = '#4f8';
    ctx.font = '12px monospace';
    ctx.fillText('\u03b7 = 1 - ' + (coldTemp + 273) + '/' + (hotTemp + 273) + ' = ' + (carnot * 100).toFixed(1) + '%', x + 110, y + 56);
}

function animate() {
    ctx.clearRect(0, 0, W, H);
    ctx.fillStyle = '#0a0e1a';
    ctx.fillRect(0, 0, W, H);

    const engW = Math.min(220, W * 0.2);
    const engX = W * 0.06;
    const engY = H * 0.1;
    drawHeatEngine(engX, engY, engW, H * 0.7);

    const sankeyW = Math.min(280, W * 0.25);
    const sankeyX = W * 0.35;
    drawSankeyDiagram(sankeyX, H * 0.1, sankeyW, 230);

    drawEfficiencyFormula(sankeyX, H * 0.1 + 245);

    const chartW = Math.min(320, W * 0.3);
    drawComparisonChart(W * 0.65, H * 0.1, chartW, 220);

    // Extra info panel
    const plant = plants[selectedPlant];
    const carnot = carnotEfficiency(hotTemp, coldTemp);
    const secondLawEff = plant.actualEff / carnot;
    const ix = W * 0.65, iy = H * 0.1 + 240, iw = chartW;
    ctx.fillStyle = 'rgba(0,0,0,0.65)';
    ctx.beginPath();
    ctx.roundRect(ix, iy, iw, 120, 8);
    ctx.fill();
    ctx.strokeStyle = 'rgba(251,191,36,0.2)';
    ctx.lineWidth = 1;
    ctx.stroke();
    ctx.fillStyle = '#fbbf24';
    ctx.font = 'bold 12px sans-serif';
    ctx.textAlign = 'left';
    ctx.fillText(plant.icon + ' ' + plant.name + ' Details', ix + 12, iy + 20);
    const details = [
        ['Operating Temp Range', plant.hotRange[0] + ' - ' + plant.hotRange[1] + '\u00b0C'],
        ['Carnot Efficiency', (carnot * 100).toFixed(1) + '%'],
        ['Actual Efficiency', (plant.actualEff * 100).toFixed(1) + '%'],
        ['2nd Law Efficiency', (secondLawEff * 100).toFixed(1) + '%'],
        ['Waste Heat', ((1 - plant.actualEff) * 100).toFixed(1) + '%']
    ];
    details.forEach((d, i) => {
        ctx.fillStyle = '#888';
        ctx.font = '11px sans-serif';
        ctx.textAlign = 'left';
        ctx.fillText(d[0], ix + 12, iy + 40 + i * 16);
        ctx.fillStyle = '#fff';
        ctx.textAlign = 'right';
        ctx.fillText(d[1], ix + iw - 12, iy + 40 + i * 16);
    });

    requestAnimationFrame(animate);
}
animate();
</script>
</body>
</html>
