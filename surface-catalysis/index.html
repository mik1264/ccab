<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Surface Catalysis Simulation</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
canvas { display: block; }
.title-overlay {
    position: fixed; top: 50px; left: 50%; transform: translateX(-50%);
    color: #fbbf24; font-size: 20px; font-weight: 600; z-index: 998;
    text-shadow: 0 0 10px rgba(251,191,36,0.5); pointer-events: none;
}
.controls {
    position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
    display: flex; gap: 16px; align-items: center; z-index: 999;
    background: rgba(0,0,0,0.7); padding: 12px 24px; border-radius: 12px;
    border: 1px solid rgba(251,191,36,0.3); flex-wrap: wrap; justify-content: center;
}
.controls label { color: #ccc; font-size: 13px; white-space: nowrap; }
.controls input[type=range] { width: 110px; accent-color: #fbbf24; }
.controls span { color: #fbbf24; font-size: 13px; }
.controls button {
    background: rgba(251,191,36,0.2); color: #fbbf24; border: 1px solid rgba(251,191,36,0.5);
    padding: 6px 14px; border-radius: 6px; cursor: pointer; font-size: 13px;
}
.controls button:hover { background: rgba(251,191,36,0.4); }
.legend {
    position: fixed; top: 80px; right: 20px; z-index: 998;
    background: rgba(0,0,0,0.6); padding: 12px 16px; border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.1); font-size: 12px; color: #ccc; line-height: 2;
}
.legend .dot { display: inline-block; width: 10px; height: 10px; border-radius: 50%; margin-right: 6px; }
</style>
</head>
<body>
<a href="../index.html" style="position:fixed;top:10px;left:10px;padding:8px 16px;background:rgba(0,0,0,0.7);color:#fbbf24;text-decoration:none;border-radius:6px;font-size:14px;z-index:999;font-family:sans-serif;">← Back to Gallery</a>
<div class="title-overlay">Surface Catalysis (Langmuir-Hinshelwood)</div>
<div class="legend">
    <div><span class="dot" style="background:#4a9eff;"></span>Reactant A (gas)</div>
    <div><span class="dot" style="background:#ff4a6a;"></span>Reactant B (gas)</div>
    <div><span class="dot" style="background:#22c55e;"></span>Product (desorbed)</div>
    <div><span class="dot" style="background:#fbbf24;"></span>Adsorbed A on surface</div>
    <div><span class="dot" style="background:#f97316;"></span>Adsorbed B on surface</div>
    <div style="margin-top:8px;font-size:10px;color:#888;">
        LH mechanism:<br>
        A(g) → A(ads)<br>
        B(g) → B(ads)<br>
        A(ads) + B(ads) → Product(g)
    </div>
</div>
<div class="controls">
    <label>Gas Pressure: <input type="range" id="pressureSlider" min="1" max="20" value="8"> <span id="pressureVal">8</span></label>
    <label>Temperature: <input type="range" id="tempSlider" min="1" max="100" value="50"> <span id="tempVal">50</span></label>
    <label>Cat. Activity: <input type="range" id="actSlider" min="1" max="100" value="50"> <span id="actVal">50</span></label>
    <button id="resetBtn">Reset</button>
</div>
<canvas id="canvas"></canvas>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let W, H;

function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
    surfaceY = H * 0.7;
    initSurface();
}

let surfaceY;
let pressure = 8;
let temperature = 50;
let catalystActivity = 50;
let gasParticles = [];
let products = [];
let surfaceSites = [];
let coverageHistory = [];
let rateHistory = [];
let reactionCount = 0;
let rateWindow = [];
let frame = 0;

const NUM_SITES = 30;

function initSurface() {
    surfaceSites = [];
    const siteSpacing = (W - 100) / NUM_SITES;
    for (let i = 0; i < NUM_SITES; i++) {
        surfaceSites.push({
            x: 50 + i * siteSpacing + siteSpacing / 2,
            y: surfaceY,
            occupied: null, // null, 'A', or 'B'
            timer: 0
        });
    }
}

function init() {
    gasParticles = [];
    products = [];
    coverageHistory = [];
    rateHistory = [];
    reactionCount = 0;
    rateWindow = [];
    frame = 0;
    surfaceY = H * 0.7;
    initSurface();
    spawnGas(40);
}

function spawnGas(count) {
    for (let i = 0; i < count; i++) {
        const type = Math.random() < 0.5 ? 'A' : 'B';
        gasParticles.push({
            x: Math.random() * (W - 40) + 20,
            y: Math.random() * (surfaceY - 120) + 80,
            vx: (Math.random() - 0.5) * 3 * (temperature / 50),
            vy: (Math.random() - 0.5) * 3 * (temperature / 50),
            type: type,
            r: 5
        });
    }
}

resize();
init();
window.addEventListener('resize', () => { resize(); init(); });

document.getElementById('pressureSlider').addEventListener('input', function() {
    pressure = +this.value;
    document.getElementById('pressureVal').textContent = this.value;
});
document.getElementById('tempSlider').addEventListener('input', function() {
    temperature = +this.value;
    document.getElementById('tempVal').textContent = this.value;
});
document.getElementById('actSlider').addEventListener('input', function() {
    catalystActivity = +this.value;
    document.getElementById('actVal').textContent = this.value;
});
document.getElementById('resetBtn').addEventListener('click', init);

function update() {
    frame++;

    // Spawn new gas particles based on pressure
    if (frame % Math.max(1, Math.floor(30 / pressure)) === 0) {
        const type = Math.random() < 0.5 ? 'A' : 'B';
        gasParticles.push({
            x: Math.random() * (W - 40) + 20,
            y: 80 + Math.random() * 30,
            vx: (Math.random() - 0.5) * 2 * (temperature / 50),
            vy: Math.random() * 2 * (temperature / 50),
            type: type,
            r: 5
        });
    }

    // Update gas particles
    for (let p of gasParticles) {
        p.vy += 0.02; // Slight gravity toward surface
        p.x += p.vx;
        p.y += p.vy;

        if (p.x < p.r) { p.x = p.r; p.vx *= -1; }
        if (p.x > W - p.r) { p.x = W - p.r; p.vx *= -1; }
        if (p.y < p.r + 70) { p.y = p.r + 70; p.vy *= -1; }

        // Adsorption check
        if (p.y > surfaceY - 15) {
            // Find nearest empty site
            let nearestSite = null;
            let minDist = Infinity;
            for (let site of surfaceSites) {
                if (site.occupied) continue;
                const d = Math.abs(p.x - site.x);
                if (d < minDist && d < 25) {
                    minDist = d;
                    nearestSite = site;
                }
            }
            if (nearestSite && Math.random() < 0.3) {
                nearestSite.occupied = p.type;
                nearestSite.timer = 0;
                p.remove = true;
            } else {
                p.vy *= -0.8;
                p.y = surfaceY - 15;
            }
        }
    }
    gasParticles = gasParticles.filter(p => !p.remove);

    // Limit gas particles
    if (gasParticles.length > 150) {
        gasParticles = gasParticles.slice(-150);
    }

    // Surface reaction: adjacent A(ads) + B(ads) → product
    for (let i = 0; i < surfaceSites.length - 1; i++) {
        const s1 = surfaceSites[i];
        const s2 = surfaceSites[i + 1];
        s1.timer++;
        if (s1.occupied && s2.occupied && s1.occupied !== s2.occupied) {
            const reactionProb = catalystActivity / 2000;
            if (Math.random() < reactionProb) {
                // React!
                products.push({
                    x: (s1.x + s2.x) / 2,
                    y: surfaceY - 10,
                    vx: (Math.random() - 0.5) * 2,
                    vy: -2 - Math.random() * 3,
                    r: 6,
                    life: 200,
                    flash: 1
                });
                s1.occupied = null;
                s2.occupied = null;
                reactionCount++;
                rateWindow.push(frame);
            }
        }
    }

    // Thermal desorption
    for (let site of surfaceSites) {
        if (site.occupied && site.timer > 200) {
            if (Math.random() < temperature / 5000) {
                gasParticles.push({
                    x: site.x,
                    y: surfaceY - 15,
                    vx: (Math.random() - 0.5) * 2,
                    vy: -2 - Math.random() * 2,
                    type: site.occupied,
                    r: 5
                });
                site.occupied = null;
            }
        }
    }

    // Update products
    for (let p of products) {
        p.x += p.vx;
        p.y += p.vy;
        p.vy -= 0.01;
        p.life--;
        if (p.flash > 0) p.flash *= 0.95;
    }
    products = products.filter(p => p.life > 0 && p.y > 60);

    // Rate tracking
    rateWindow = rateWindow.filter(t => frame - t < 120);

    // Record history
    if (frame % 10 === 0) {
        const occupied = surfaceSites.filter(s => s.occupied).length;
        const coverage = occupied / surfaceSites.length;
        coverageHistory.push(coverage);
        rateHistory.push(rateWindow.length);
        if (coverageHistory.length > 150) { coverageHistory.shift(); rateHistory.shift(); }
    }
}

function drawSurface() {
    // Catalyst surface
    const grad = ctx.createLinearGradient(0, surfaceY, 0, H);
    grad.addColorStop(0, '#3d3d3d');
    grad.addColorStop(0.3, '#2a2a2a');
    grad.addColorStop(1, '#1a1a1a');
    ctx.fillStyle = grad;
    ctx.fillRect(0, surfaceY, W, H - surfaceY);

    // Surface texture
    ctx.strokeStyle = 'rgba(255,255,255,0.05)';
    for (let x = 0; x < W; x += 8) {
        ctx.beginPath();
        ctx.moveTo(x, surfaceY);
        ctx.lineTo(x, surfaceY + 4 + Math.sin(x * 0.1) * 2);
        ctx.stroke();
    }

    // Surface shine
    ctx.strokeStyle = 'rgba(251,191,36,0.15)';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(0, surfaceY);
    ctx.lineTo(W, surfaceY);
    ctx.stroke();

    // Active sites
    for (let site of surfaceSites) {
        // Site marker
        ctx.beginPath();
        ctx.arc(site.x, site.y + 3, 4, 0, Math.PI * 2);
        ctx.fillStyle = site.occupied ? 'rgba(251,191,36,0.3)' : 'rgba(100,100,100,0.4)';
        ctx.fill();

        if (site.occupied) {
            const color = site.occupied === 'A' ? '#fbbf24' : '#f97316';
            ctx.beginPath();
            ctx.arc(site.x, site.y - 8, 6, 0, Math.PI * 2);
            ctx.fillStyle = color;
            ctx.fill();

            // Bond to surface
            ctx.strokeStyle = 'rgba(255,255,255,0.3)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(site.x, site.y - 2);
            ctx.lineTo(site.x, site.y + 3);
            ctx.stroke();

            ctx.fillStyle = '#000';
            ctx.font = 'bold 8px sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(site.occupied, site.x, site.y - 8);
        }
    }
}

function drawGraphs() {
    const gx = 20, gy = 80, gw = 230, gh = 100;

    // Coverage graph
    ctx.fillStyle = 'rgba(0,0,0,0.6)';
    ctx.beginPath();
    ctx.roundRect(gx, gy, gw, gh + 25, 10);
    ctx.fill();
    ctx.strokeStyle = 'rgba(255,255,255,0.15)';
    ctx.stroke();

    ctx.fillStyle = '#aaa';
    ctx.font = '11px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('Surface Coverage & Rate', gx + gw / 2, gy + 14);

    if (coverageHistory.length > 1) {
        // Coverage line
        ctx.beginPath();
        ctx.strokeStyle = '#fbbf24';
        ctx.lineWidth = 2;
        for (let i = 0; i < coverageHistory.length; i++) {
            const x = gx + 10 + (i / 150) * (gw - 20);
            const y = gy + gh + 5 - coverageHistory[i] * (gh - 20);
            if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
        }
        ctx.stroke();

        // Rate line
        const maxRate = Math.max(...rateHistory, 1);
        ctx.beginPath();
        ctx.strokeStyle = '#22c55e';
        ctx.lineWidth = 2;
        for (let i = 0; i < rateHistory.length; i++) {
            const x = gx + 10 + (i / 150) * (gw - 20);
            const y = gy + gh + 5 - (rateHistory[i] / maxRate) * (gh - 20);
            if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
        }
        ctx.stroke();
    }

    ctx.font = '10px sans-serif';
    ctx.textAlign = 'left';
    ctx.fillStyle = '#fbbf24'; ctx.fillText('— Coverage (θ)', gx + 10, gy + gh + 20);
    ctx.fillStyle = '#22c55e'; ctx.fillText('— Rate', gx + 130, gy + gh + 20);

    // Stats
    const occupied = surfaceSites.filter(s => s.occupied).length;
    const occA = surfaceSites.filter(s => s.occupied === 'A').length;
    const occB = surfaceSites.filter(s => s.occupied === 'B').length;

    ctx.fillStyle = 'rgba(0,0,0,0.6)';
    ctx.beginPath();
    ctx.roundRect(gx, gy + gh + 35, gw, 55, 10);
    ctx.fill();
    ctx.font = '11px sans-serif';
    ctx.fillStyle = '#ccc';
    ctx.fillText(`Coverage: ${(occupied / NUM_SITES * 100).toFixed(0)}% (A: ${occA}, B: ${occB})`, gx + 10, gy + gh + 53);
    ctx.fillText(`Gas particles: ${gasParticles.length}`, gx + 10, gy + gh + 68);
    ctx.fillText(`Total reactions: ${reactionCount}  Rate: ${rateWindow.length}/s`, gx + 10, gy + gh + 83);
}

function draw() {
    ctx.fillStyle = 'rgba(10, 14, 26, 0.3)';
    ctx.fillRect(0, 0, W, H);

    drawSurface();

    // Gas particles
    for (let p of gasParticles) {
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
        ctx.fillStyle = p.type === 'A' ? '#4a9eff' : '#ff4a6a';
        ctx.fill();
        ctx.fillStyle = '#fff';
        ctx.font = 'bold 7px sans-serif';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(p.type, p.x, p.y);
    }

    // Products
    for (let p of products) {
        const alpha = p.life / 200;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(34, 197, 94, ${alpha})`;
        ctx.fill();

        if (p.flash > 0.1) {
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.r + 12 * p.flash, 0, Math.PI * 2);
            ctx.strokeStyle = `rgba(34, 197, 94, ${p.flash * 0.5})`;
            ctx.lineWidth = 2;
            ctx.stroke();
        }

        ctx.fillStyle = `rgba(0,0,0,${alpha})`;
        ctx.font = 'bold 7px sans-serif';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText('P', p.x, p.y);
    }

    drawGraphs();

    // Label zones
    ctx.fillStyle = 'rgba(255,255,255,0.15)';
    ctx.font = '12px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('Gas Phase', W / 2, surfaceY - 30);
    ctx.fillText('Catalyst Surface', W / 2, surfaceY + 25);
}

function animate() {
    update();
    draw();
    requestAnimationFrame(animate);
}
animate();
</script>
</body>
</html>
