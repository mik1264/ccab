<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Entanglement | Quantum Physics</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a0a2e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            overflow: hidden;
        }
        #canvas { display: block; }
        .controls {
            position: fixed;
            top: 20px; right: 20px;
            background: rgba(0,0,0,0.85);
            padding: 20px; border-radius: 15px;
            min-width: 300px;
            border: 1px solid rgba(255, 200, 100, 0.3);
        }
        h1 { color: #ffc864; font-size: 1.3em; margin-bottom: 15px; }
        .control-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; color: #aaa; font-size: 0.9em; }
        input[type="range"], select { width: 100%; }
        select { padding: 8px; border-radius: 5px; background: #333; color: #fff; border: none; }
        .value { float: right; color: #ffc864; }
        button {
            width: 100%; padding: 10px; margin: 5px 0;
            border: none; border-radius: 8px;
            background: #ffc864; color: #0a0a1a;
            font-weight: bold; cursor: pointer;
        }
        button:hover { background: #ffd88c; }
        .correlation-meter {
            height: 30px; background: linear-gradient(90deg, #ff6464 0%, #888 50%, #64ff64 100%);
            border-radius: 15px; margin: 15px 0; position: relative;
        }
        .correlation-indicator {
            position: absolute; width: 20px; height: 40px;
            background: #fff; border-radius: 5px;
            top: -5px; transform: translateX(-50%);
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
            transition: left 0.3s;
        }
        .results-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        .result-cell { padding: 10px; border-radius: 8px; text-align: center; }
        .alice { background: rgba(100, 200, 255, 0.2); }
        .bob { background: rgba(255, 150, 100, 0.2); }
        .count { font-size: 1.5em; font-weight: bold; }
        .stats { margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); }
        .stat-row { display: flex; justify-content: space-between; padding: 5px 0; font-size: 0.9em; }
        .stat-label { color: #888; }
        .stat-value { color: #ffc864; font-weight: bold; }
        .info { font-size: 0.8em; color: #666; margin-top: 15px; line-height: 1.5; }
        a.back-link {
            position: fixed; top: 20px; left: 20px;
            color: #ffc864; text-decoration: none;
            background: rgba(0,0,0,0.8); padding: 10px 20px;
            border-radius: 25px; font-size: 0.9em;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <a href="index.html" class="back-link">← Back to Quantum Physics</a>

    <div class="controls">
        <h1>Quantum Entanglement</h1>
        <p style="font-size:0.85em; color:#888; margin-bottom:15px;">Bell state correlations & EPR paradox</p>

        <div class="control-group">
            <label>Entangled State</label>
            <select id="bellState">
                <option value="phi+">|Φ⁺⟩ = (|↑↑⟩ + |↓↓⟩)/√2</option>
                <option value="phi-">|Φ⁻⟩ = (|↑↑⟩ - |↓↓⟩)/√2</option>
                <option value="psi+">|Ψ⁺⟩ = (|↑↓⟩ + |↓↑⟩)/√2</option>
                <option value="psi-">|Ψ⁻⟩ = (|↑↓⟩ - |↓↑⟩)/√2</option>
            </select>
        </div>

        <div class="control-group">
            <label>Alice's Angle: <span class="value" id="aliceValue">0°</span></label>
            <input type="range" id="aliceAngle" min="0" max="360" value="0">
        </div>

        <div class="control-group">
            <label>Bob's Angle: <span class="value" id="bobValue">0°</span></label>
            <input type="range" id="bobAngle" min="0" max="360" value="0">
        </div>

        <button id="measureBtn">Measure Both</button>
        <button id="measure100Btn">Measure 100x</button>
        <button id="bellTestBtn">Run Bell Test</button>
        <button id="resetBtn">Reset</button>

        <div style="text-align:center; margin:15px 0; font-size:0.9em; color:#888;">
            Correlation E(a,b)
        </div>
        <div class="correlation-meter">
            <div class="correlation-indicator" id="correlationIndicator" style="left:50%"></div>
        </div>
        <div style="display:flex; justify-content:space-between; font-size:0.8em; color:#888;">
            <span>-1 (anti)</span>
            <span>0</span>
            <span>+1 (corr)</span>
        </div>

        <div class="results-grid">
            <div class="result-cell alice">
                <div style="color:#64c8ff; font-size:0.85em;">Alice</div>
                <div class="count" id="aliceUp" style="color:#64ffc8;">↑ 0</div>
                <div class="count" id="aliceDown" style="color:#ff6496;">↓ 0</div>
            </div>
            <div class="result-cell bob">
                <div style="color:#ff9664; font-size:0.85em;">Bob</div>
                <div class="count" id="bobUp" style="color:#64ffc8;">↑ 0</div>
                <div class="count" id="bobDown" style="color:#ff6496;">↓ 0</div>
            </div>
        </div>

        <div class="stats">
            <div class="stat-row">
                <span class="stat-label">Same Results</span>
                <span class="stat-value" id="sameCount">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Different Results</span>
                <span class="stat-value" id="diffCount">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Correlation</span>
                <span class="stat-value" id="correlation">-</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Bell Inequality S</span>
                <span class="stat-value" id="bellS">-</span>
            </div>
        </div>

        <div class="info">
            <strong>Bell's Inequality:</strong> Classical physics predicts |S| ≤ 2. Quantum mechanics allows |S| ≤ 2√2 ≈ 2.83. Violations prove entanglement!
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resize();
        window.onresize = resize;

        let bellState = 'phi+';
        let aliceAngle = 0;
        let bobAngle = 0;

        let aliceUp = 0, aliceDown = 0;
        let bobUp = 0, bobDown = 0;
        let sameCount = 0, diffCount = 0;

        let particles = [];
        let entanglementLines = [];

        function measurePair() {
            const a = aliceAngle * Math.PI / 180;
            const b = bobAngle * Math.PI / 180;

            // Quantum correlation for Bell states
            let aliceResult, bobResult;

            // First, Alice measures - random outcome
            aliceResult = Math.random() < 0.5 ? 1 : -1;

            // Bob's result is correlated based on state and angles
            const angleDiff = a - b;
            let correlation;

            switch (bellState) {
                case 'phi+':
                    // Perfect correlation when measuring same axis
                    correlation = Math.cos(angleDiff);
                    break;
                case 'phi-':
                    correlation = Math.cos(angleDiff);
                    break;
                case 'psi+':
                    // Anti-correlation
                    correlation = -Math.cos(angleDiff);
                    break;
                case 'psi-':
                    correlation = -Math.cos(angleDiff);
                    break;
            }

            // Bob's outcome based on correlation
            const p = (1 + aliceResult * correlation) / 2;
            bobResult = Math.random() < p ? 1 : -1;

            // For phi states with same measurement, results should match
            // For psi states with same measurement, results should anti-match
            if (bellState.startsWith('phi') && Math.abs(angleDiff) < 0.01) {
                bobResult = aliceResult;
            } else if (bellState.startsWith('psi') && Math.abs(angleDiff) < 0.01) {
                bobResult = -aliceResult;
            }

            // Update counts
            if (aliceResult === 1) aliceUp++;
            else aliceDown++;

            if (bobResult === 1) bobUp++;
            else bobDown++;

            if (aliceResult === bobResult) sameCount++;
            else diffCount++;

            // Add particle animation
            addParticle(aliceResult, bobResult);

            updateStats();
        }

        function addParticle(aliceRes, bobRes) {
            const cy = canvas.height / 2;
            const startX = (canvas.width - 300) / 2;

            particles.push({
                x: startX, y: cy,
                vx: -5, vy: 0,
                result: aliceRes,
                target: 'alice',
                life: 100
            });

            particles.push({
                x: startX, y: cy,
                vx: 5, vy: 0,
                result: bobRes,
                target: 'bob',
                life: 100
            });

            // Entanglement visualization line
            entanglementLines.push({
                life: 30,
                aliceRes, bobRes
            });
        }

        function calculateCorrelation() {
            const total = sameCount + diffCount;
            if (total === 0) return 0;

            // E = (N_same - N_diff) / N_total
            return (sameCount - diffCount) / total;
        }

        function runBellTest() {
            // CHSH inequality test with angles 0, 45, 22.5, 67.5
            const angles = {
                a1: 0,
                a2: 45,
                b1: 22.5,
                b2: 67.5
            };

            let E = {};
            const trials = 1000;

            for (const [aKey, aVal] of [['a1', angles.a1], ['a2', angles.a2]]) {
                for (const [bKey, bVal] of [['b1', angles.b1], ['b2', angles.b2]]) {
                    let same = 0, diff = 0;

                    const a = aVal * Math.PI / 180;
                    const b = bVal * Math.PI / 180;
                    const angleDiff = a - b;

                    // Simulate measurements
                    for (let i = 0; i < trials; i++) {
                        const aliceRes = Math.random() < 0.5 ? 1 : -1;
                        let correlation = bellState.startsWith('phi') ?
                            Math.cos(angleDiff) : -Math.cos(angleDiff);

                        const p = (1 + aliceRes * correlation) / 2;
                        const bobRes = Math.random() < p ? 1 : -1;

                        if (aliceRes === bobRes) same++;
                        else diff++;
                    }

                    E[`${aKey}${bKey}`] = (same - diff) / trials;
                }
            }

            // S = E(a1,b1) - E(a1,b2) + E(a2,b1) + E(a2,b2)
            const S = E.a1b1 - E.a1b2 + E.a2b1 + E.a2b2;

            document.getElementById('bellS').textContent = S.toFixed(3);
            document.getElementById('bellS').style.color = Math.abs(S) > 2 ? '#64ff64' : '#ff6464';
        }

        function updateStats() {
            document.getElementById('aliceUp').textContent = '↑ ' + aliceUp;
            document.getElementById('aliceDown').textContent = '↓ ' + aliceDown;
            document.getElementById('bobUp').textContent = '↑ ' + bobUp;
            document.getElementById('bobDown').textContent = '↓ ' + bobDown;
            document.getElementById('sameCount').textContent = sameCount;
            document.getElementById('diffCount').textContent = diffCount;

            const corr = calculateCorrelation();
            document.getElementById('correlation').textContent = corr.toFixed(3);

            // Update correlation meter
            const percent = (corr + 1) / 2 * 100;
            document.getElementById('correlationIndicator').style.left = percent + '%';
        }

        function draw() {
            ctx.fillStyle = '#0a0a1a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const cx = (canvas.width - 300) / 2;
            const cy = canvas.height / 2;

            // Draw entanglement source
            const sourceGradient = ctx.createRadialGradient(cx, cy, 0, cx, cy, 50);
            sourceGradient.addColorStop(0, 'rgba(255, 200, 100, 0.8)');
            sourceGradient.addColorStop(0.5, 'rgba(255, 200, 100, 0.3)');
            sourceGradient.addColorStop(1, 'rgba(255, 200, 100, 0)');

            ctx.beginPath();
            ctx.arc(cx, cy, 50, 0, Math.PI * 2);
            ctx.fillStyle = sourceGradient;
            ctx.fill();

            // Pulsing effect
            const pulse = 1 + 0.2 * Math.sin(Date.now() / 200);
            ctx.beginPath();
            ctx.arc(cx, cy, 30 * pulse, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(255, 200, 100, 0.5)';
            ctx.fill();

            ctx.fillStyle = '#ffc864';
            ctx.font = 'bold 14px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Entangled', cx, cy - 60);
            ctx.fillText('Source', cx, cy - 45);

            // Draw Alice's detector
            drawDetector(cx - 300, cy, 'Alice', aliceAngle, '#64c8ff');

            // Draw Bob's detector
            drawDetector(cx + 300, cy, 'Bob', bobAngle, '#ff9664');

            // Draw entanglement lines
            for (let i = entanglementLines.length - 1; i >= 0; i--) {
                const line = entanglementLines[i];
                line.life--;

                if (line.life <= 0) {
                    entanglementLines.splice(i, 1);
                    continue;
                }

                const alpha = line.life / 30;
                ctx.beginPath();
                ctx.strokeStyle = `rgba(255, 200, 100, ${alpha * 0.5})`;
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.moveTo(cx - 300, cy);
                ctx.lineTo(cx + 300, cy);
                ctx.stroke();
                ctx.setLineDash([]);
            }

            // Update and draw particles
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.x += p.vx;
                p.life--;

                if (p.life <= 0) {
                    particles.splice(i, 1);
                    continue;
                }

                const alpha = Math.min(1, p.life / 50);
                ctx.beginPath();
                ctx.arc(p.x, p.y, 8, 0, Math.PI * 2);

                if (p.result === 1) {
                    ctx.fillStyle = `rgba(100, 255, 200, ${alpha})`;
                } else {
                    ctx.fillStyle = `rgba(255, 100, 150, ${alpha})`;
                }
                ctx.fill();

                // Trail
                ctx.beginPath();
                ctx.moveTo(p.x, p.y);
                ctx.lineTo(p.x - p.vx * 10, p.y);
                ctx.strokeStyle = ctx.fillStyle;
                ctx.lineWidth = 2;
                ctx.stroke();
            }
        }

        function drawDetector(x, y, name, angle, color) {
            // Detector body
            ctx.fillStyle = '#333';
            ctx.beginPath();
            ctx.arc(x, y, 60, 0, Math.PI * 2);
            ctx.fill();

            ctx.strokeStyle = color;
            ctx.lineWidth = 3;
            ctx.stroke();

            // Measurement axis
            const rad = angle * Math.PI / 180;
            ctx.beginPath();
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.moveTo(x - Math.cos(rad) * 45, y - Math.sin(rad) * 45);
            ctx.lineTo(x + Math.cos(rad) * 45, y + Math.sin(rad) * 45);
            ctx.stroke();

            // Arrow head
            ctx.beginPath();
            ctx.fillStyle = color;
            const ax = x + Math.cos(rad) * 45;
            const ay = y + Math.sin(rad) * 45;
            ctx.moveTo(ax, ay);
            ctx.lineTo(ax - Math.cos(rad + 0.5) * 10, ay - Math.sin(rad + 0.5) * 10);
            ctx.lineTo(ax - Math.cos(rad - 0.5) * 10, ay - Math.sin(rad - 0.5) * 10);
            ctx.closePath();
            ctx.fill();

            // Label
            ctx.fillStyle = color;
            ctx.font = 'bold 16px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(name, x, y - 80);
            ctx.font = '12px sans-serif';
            ctx.fillText(angle + '°', x, y + 85);
        }

        function animate() {
            draw();
            requestAnimationFrame(animate);
        }

        // Event listeners
        document.getElementById('bellState').onchange = (e) => {
            bellState = e.target.value;
        };

        document.getElementById('aliceAngle').oninput = (e) => {
            aliceAngle = parseInt(e.target.value);
            document.getElementById('aliceValue').textContent = aliceAngle + '°';
        };

        document.getElementById('bobAngle').oninput = (e) => {
            bobAngle = parseInt(e.target.value);
            document.getElementById('bobValue').textContent = bobAngle + '°';
        };

        document.getElementById('measureBtn').onclick = measurePair;

        document.getElementById('measure100Btn').onclick = () => {
            for (let i = 0; i < 100; i++) measurePair();
        };

        document.getElementById('bellTestBtn').onclick = runBellTest;

        document.getElementById('resetBtn').onclick = () => {
            aliceUp = aliceDown = bobUp = bobDown = 0;
            sameCount = diffCount = 0;
            particles = [];
            entanglementLines = [];
            document.getElementById('bellS').textContent = '-';
            document.getElementById('bellS').style.color = '#ffc864';
            updateStats();
        };

        // Initialize
        updateStats();
        animate();
    </script>
</body>
</html>
