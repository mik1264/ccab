<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stern-Gerlach Experiment - Quantum Physics</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3e 100%); color: #eee; min-height: 100vh; padding: 20px; }
        .back-link { position: fixed; top: 20px; left: 20px; color: #60a5fa; text-decoration: none; font-weight: 600; padding: 8px 16px; background: rgba(0,0,0,0.3); border-radius: 20px; z-index: 100; }
        h1 { text-align: center; margin: 40px 0 10px; font-size: 2.2em; color: #60a5fa; }
        .subtitle { text-align: center; opacity: 0.8; margin-bottom: 20px; }
        .container { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 1fr 300px; gap: 20px; }
        .panel { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 25px; }
        .info-box { background: rgba(96, 165, 250, 0.1); border: 1px solid rgba(96, 165, 250, 0.3); border-radius: 8px; padding: 15px; margin-bottom: 20px; font-size: 0.85em; line-height: 1.6; }
        h3 { color: #60a5fa; margin-bottom: 15px; }
        canvas { width: 100%; border-radius: 8px; background: #050510; }
        .control-group { margin: 15px 0; }
        .control-group label { display: block; margin-bottom: 5px; }
        .control-group input, .control-group select { width: 100%; }
        .value-display { color: #60a5fa; font-family: monospace; }
        button { width: 100%; padding: 12px; margin: 8px 0; border: none; border-radius: 8px; font-size: 1em; font-weight: 600; cursor: pointer; }
        .btn-primary { background: #60a5fa; color: #0a0a1a; }
        .btn-secondary { background: rgba(255,255,255,0.1); color: #fff; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        .stat-box { background: rgba(0,0,0,0.2); border-radius: 8px; padding: 12px; text-align: center; }
        .stat-value { font-size: 1.3em; font-weight: bold; }
        .stat-label { font-size: 0.75em; opacity: 0.8; }
        .spin-up { color: #4ade80; }
        .spin-down { color: #f87171; }
        @media (max-width: 900px) { .container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back</a>
    <h1>Stern-Gerlach Experiment</h1>
    <p class="subtitle">Spin measurement and quantization</p>

    <div class="container">
        <div class="panel">
            <canvas id="canvas" width="800" height="500"></canvas>
        </div>

        <div class="panel">
            <div class="info-box">
                <strong>Stern-Gerlach:</strong>
                Silver atoms pass through an inhomogeneous magnetic field.
                Classically, they should spread continuously. Instead, they split
                into discrete beams - proving spin is quantized!
                Spin-½ particles have only two states: up (+ℏ/2) or down (-ℏ/2).
            </div>

            <h3>Input State</h3>
            <div class="control-group">
                <select id="inputState" onchange="updateSetup()">
                    <option value="random">Random (unpolarized)</option>
                    <option value="up_z">Spin Up (+Z)</option>
                    <option value="down_z">Spin Down (-Z)</option>
                    <option value="up_x">Spin Up (+X)</option>
                    <option value="superposition">Superposition</option>
                </select>
            </div>

            <h3>Magnet Orientation</h3>
            <div class="control-group">
                <label>First Magnet: <span class="value-display" id="mag1Val">Z-axis</span></label>
                <select id="magnet1" onchange="updateSetup()">
                    <option value="z">Z-axis (vertical)</option>
                    <option value="x">X-axis (horizontal)</option>
                    <option value="45">45° angle</option>
                </select>
            </div>

            <div class="control-group">
                <label>Second Magnet (optional):</label>
                <select id="magnet2" onchange="updateSetup()">
                    <option value="none">None</option>
                    <option value="z">Z-axis</option>
                    <option value="x">X-axis</option>
                </select>
            </div>

            <button class="btn-primary" onclick="sendAtom()">Send Atom</button>
            <button class="btn-secondary" onclick="sendBurst()">Send 50 Atoms</button>
            <button class="btn-secondary" onclick="resetStats()">Reset Statistics</button>

            <h3 style="margin-top: 15px;">Measurement Results</h3>
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-value spin-up" id="upCount">0</div>
                    <div class="stat-label">Spin Up</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value spin-down" id="downCount">0</div>
                    <div class="stat-label">Spin Down</div>
                </div>
            </div>

            <div class="stat-box" style="margin-top: 10px;">
                <div>Total: <span class="value-display" id="totalCount">0</span></div>
                <div style="font-size: 0.85em; margin-top: 5px;">
                    Up: <span id="upPercent">0%</span> | Down: <span id="downPercent">0%</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let atoms = [];
        let upCount = 0;
        let downCount = 0;
        let inputState = 'random';
        let magnet1 = 'z';
        let magnet2 = 'none';

        const sourceX = 50;
        const magnet1X = 250;
        const magnet1End = 400;
        const magnet2X = 500;
        const magnet2End = 650;
        const screenX = 750;

        function updateSetup() {
            inputState = document.getElementById('inputState').value;
            magnet1 = document.getElementById('magnet1').value;
            magnet2 = document.getElementById('magnet2').value;
            document.getElementById('mag1Val').textContent =
                magnet1 === 'z' ? 'Z-axis' : magnet1 === 'x' ? 'X-axis' : '45°';
        }

        function getInitialSpin() {
            switch (inputState) {
                case 'random': return Math.random() < 0.5 ? 1 : -1;
                case 'up_z': return 1;
                case 'down_z': return -1;
                case 'up_x': return Math.random() < 0.5 ? 1 : -1; // 50/50 in Z basis
                case 'superposition': return Math.random() < 0.5 ? 1 : -1;
                default: return Math.random() < 0.5 ? 1 : -1;
            }
        }

        function measureSpin(currentSpin, magnetAxis, inputAxis) {
            // If measuring in same axis as preparation, deterministic
            // If orthogonal, 50/50
            // If 45°, cos²(22.5°) ≈ 85% same, 15% flip

            if (magnetAxis === 'z') {
                if (inputState === 'up_z') return 1;
                if (inputState === 'down_z') return -1;
                if (inputState === 'up_x') return Math.random() < 0.5 ? 1 : -1;
            }

            if (magnetAxis === 'x') {
                if (inputState === 'up_x') return 1;
                if (inputState === 'up_z' || inputState === 'down_z') {
                    return Math.random() < 0.5 ? 1 : -1;
                }
            }

            if (magnetAxis === '45') {
                // 45° angle gives cos²(45°/2) probability
                const prob = Math.pow(Math.cos(Math.PI / 8), 2);
                return Math.random() < prob ? currentSpin : -currentSpin;
            }

            return currentSpin;
        }

        function sendAtom() {
            const initialSpin = getInitialSpin();

            atoms.push({
                x: sourceX,
                y: canvas.height / 2,
                vx: 4,
                vy: 0,
                spin: initialSpin,
                phase: 'incoming',
                measured: false,
                deflection: 0,
                trail: []
            });
        }

        function sendBurst() {
            for (let i = 0; i < 50; i++) {
                setTimeout(() => sendAtom(), i * 30);
            }
        }

        function resetStats() {
            upCount = 0;
            downCount = 0;
            atoms = [];
            updateStatsDisplay();
        }

        function updateStatsDisplay() {
            document.getElementById('upCount').textContent = upCount;
            document.getElementById('downCount').textContent = downCount;
            document.getElementById('totalCount').textContent = upCount + downCount;

            const total = upCount + downCount;
            document.getElementById('upPercent').textContent = total > 0 ?
                (upCount / total * 100).toFixed(1) + '%' : '0%';
            document.getElementById('downPercent').textContent = total > 0 ?
                (downCount / total * 100).toFixed(1) + '%' : '0%';
        }

        function updateAtoms() {
            for (let i = atoms.length - 1; i >= 0; i--) {
                const atom = atoms[i];
                atom.trail.push({ x: atom.x, y: atom.y });
                if (atom.trail.length > 30) atom.trail.shift();

                atom.x += atom.vx;
                atom.y += atom.vy;

                // First magnet region
                if (atom.x >= magnet1X && atom.x <= magnet1End && atom.phase === 'incoming') {
                    if (!atom.measured) {
                        atom.spin = measureSpin(atom.spin, magnet1, inputState);
                        atom.measured = true;
                    }
                    atom.vy = atom.spin * 0.15;
                    atom.phase = 'magnet1';
                }

                // After first magnet
                if (atom.x > magnet1End && atom.phase === 'magnet1') {
                    atom.phase = 'between';
                    if (magnet2 === 'none') {
                        atom.vy *= 0.3; // Some divergence
                    }
                }

                // Second magnet (if active)
                if (magnet2 !== 'none' && atom.x >= magnet2X && atom.x <= magnet2End) {
                    if (atom.phase === 'between') {
                        atom.spin = measureSpin(atom.spin, magnet2, magnet1);
                        atom.phase = 'magnet2';
                    }
                    atom.vy = atom.spin * 0.15;
                }

                // After second magnet
                if (atom.x > magnet2End && atom.phase === 'magnet2') {
                    atom.phase = 'final';
                    atom.vy *= 0.3;
                }

                // Hit screen
                if (atom.x >= screenX) {
                    if (atom.spin > 0) upCount++;
                    else downCount++;
                    updateStatsDisplay();
                    atoms.splice(i, 1);
                }

                // Out of bounds
                if (atom.y < 20 || atom.y > canvas.height - 20) {
                    atoms.splice(i, 1);
                }
            }
        }

        function drawMagnet(x, width, axis) {
            const h = 100;
            const y = canvas.height / 2;

            // North pole (top)
            ctx.fillStyle = '#f87171';
            if (axis === 'z') {
                ctx.fillRect(x, y - h - 30, width, 25);
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 14px sans-serif';
                ctx.fillText('N', x + width / 2 - 5, y - h - 12);
            } else if (axis === 'x') {
                ctx.fillRect(x, y - 15, 25, 30);
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 12px sans-serif';
                ctx.fillText('N', x + 5, y + 5);
            } else {
                // 45 degree
                ctx.save();
                ctx.translate(x + width / 2, y - h / 2);
                ctx.rotate(-Math.PI / 4);
                ctx.fillRect(-width / 2, -15, width, 25);
                ctx.restore();
            }

            // South pole (bottom)
            ctx.fillStyle = '#60a5fa';
            if (axis === 'z') {
                ctx.fillRect(x, y + h + 5, width, 25);
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 14px sans-serif';
                ctx.fillText('S', x + width / 2 - 5, y + h + 22);
            } else if (axis === 'x') {
                ctx.fillRect(x + width - 25, y - 15, 25, 30);
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 12px sans-serif';
                ctx.fillText('S', x + width - 20, y + 5);
            } else {
                ctx.save();
                ctx.translate(x + width / 2, y + h / 2);
                ctx.rotate(-Math.PI / 4);
                ctx.fillRect(-width / 2, -10, width, 25);
                ctx.restore();
            }

            // Field gradient indication
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.lineWidth = 1;
            for (let i = 0; i < 5; i++) {
                ctx.beginPath();
                if (axis === 'z') {
                    const yOff = (i - 2) * 30;
                    ctx.moveTo(x, y + yOff);
                    ctx.lineTo(x + width, y + yOff);
                } else {
                    const xOff = i * width / 4;
                    ctx.moveTo(x + xOff, y - h);
                    ctx.lineTo(x + xOff, y + h);
                }
                ctx.stroke();
            }
        }

        function draw() {
            ctx.fillStyle = '#050510';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const centerY = canvas.height / 2;

            // Draw source
            ctx.fillStyle = '#facc15';
            ctx.beginPath();
            ctx.arc(sourceX, centerY, 15, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#fff';
            ctx.font = '10px sans-serif';
            ctx.fillText('Ag Source', sourceX - 25, centerY + 35);

            // Draw collimator
            ctx.fillStyle = '#444';
            ctx.fillRect(100, centerY - 50, 20, 40);
            ctx.fillRect(100, centerY + 10, 20, 40);

            // Draw first magnet
            drawMagnet(magnet1X, magnet1End - magnet1X, magnet1);
            ctx.fillStyle = '#fff';
            ctx.font = '12px sans-serif';
            ctx.fillText('SG-1', magnet1X + 60, 30);

            // Draw second magnet if active
            if (magnet2 !== 'none') {
                drawMagnet(magnet2X, magnet2End - magnet2X, magnet2);
                ctx.fillText('SG-2', magnet2X + 60, 30);
            }

            // Draw screen
            ctx.fillStyle = '#222';
            ctx.fillRect(screenX, centerY - 150, 15, 300);

            // Draw expected beam positions
            ctx.fillStyle = 'rgba(74, 222, 128, 0.3)';
            ctx.beginPath();
            ctx.arc(screenX + 7, centerY - 80, 15, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = 'rgba(248, 113, 113, 0.3)';
            ctx.beginPath();
            ctx.arc(screenX + 7, centerY + 80, 15, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = '#fff';
            ctx.font = '11px sans-serif';
            ctx.fillText('+½ℏ', screenX + 25, centerY - 75);
            ctx.fillText('-½ℏ', screenX + 25, centerY + 85);

            // Draw atoms with trails
            for (const atom of atoms) {
                // Trail
                ctx.strokeStyle = atom.spin > 0 ? 'rgba(74, 222, 128, 0.3)' : 'rgba(248, 113, 113, 0.3)';
                ctx.lineWidth = 2;
                ctx.beginPath();
                atom.trail.forEach((t, i) => {
                    if (i === 0) ctx.moveTo(t.x, t.y);
                    else ctx.lineTo(t.x, t.y);
                });
                ctx.stroke();

                // Atom
                ctx.fillStyle = atom.spin > 0 ? '#4ade80' : '#f87171';
                ctx.beginPath();
                ctx.arc(atom.x, atom.y, 5, 0, Math.PI * 2);
                ctx.fill();
            }

            // Labels
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 14px sans-serif';
            ctx.fillText('Stern-Gerlach Apparatus', 20, 30);

            // Classical expectation note
            ctx.font = '11px sans-serif';
            ctx.fillStyle = 'rgba(255,255,255,0.6)';
            ctx.fillText('Classical: continuous spread', screenX - 100, canvas.height - 40);
            ctx.fillText('Quantum: two discrete spots!', screenX - 100, canvas.height - 25);
        }

        function animate() {
            updateAtoms();
            draw();
            requestAnimationFrame(animate);
        }

        updateSetup();
        animate();
    </script>
</body>
</html>
