<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Electoral College Simulation</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; color: #e0e0e0; font-family: 'Segoe UI', system-ui, sans-serif; overflow: hidden; }
canvas { display: block; cursor: pointer; }
#controls {
    position: fixed; top: 10px; right: 10px; width: 300px;
    background: rgba(20,20,40,0.85); backdrop-filter: blur(10px);
    border-radius: 12px; padding: 16px; z-index: 10;
    border: 1px solid rgba(100,140,200,0.3);
    max-height: 92vh; overflow-y: auto;
}
#info {
    position: fixed; bottom: 10px; left: 10px; max-width: 380px;
    background: rgba(20,20,40,0.85); backdrop-filter: blur(10px);
    border-radius: 12px; padding: 16px; z-index: 10;
    border: 1px solid rgba(100,140,200,0.3); font-size: 13px; line-height: 1.5;
}
h3 { color: #7eb8f0; margin-bottom: 8px; font-size: 15px; }
button {
    background: rgba(60,80,140,0.6); color: #c0d4f0; border: 1px solid rgba(100,140,200,0.4);
    border-radius: 6px; padding: 6px 14px; cursor: pointer; font-size: 12px; margin: 3px 2px;
    transition: background 0.2s;
}
button:hover { background: rgba(80,110,180,0.7); }
.stat { font-size: 13px; margin: 4px 0; }
.stat-label { color: #8099bb; }
.red { color: #f06070; }
.blue { color: #5090e0; }
.green { color: #50d890; }
.yellow { color: #f0c040; }
a { color: #7eb8f0; text-decoration: none; }
a:hover { text-decoration: underline; }
#backLink { position: fixed; top: 10px; left: 10px; z-index: 20; font-size: 13px; }
</style>
</head>
<body>
<a id="backLink" href="index.html">&#8592; Back</a>
<canvas id="canvas"></canvas>

<div id="controls">
    <h3>Electoral College</h3>
    <p style="font-size:12px;color:#8099bb;margin-bottom:8px;">Click states to toggle Red/Blue. Goal: win 270+ electoral votes.</p>
    <div id="stats"></div>
    <div style="margin-top:10px;">
        <button id="randomize">Randomize</button>
        <button id="minWin">Show Min Popular Vote Win</button>
        <button id="resetBtn">Reset</button>
    </div>
    <div id="messageBox" style="margin-top:8px;font-size:12px;"></div>
</div>

<div id="info">
    <h3>Electoral College</h3>
    <p>Winner-take-all in each state means winning the right combination of states lets you win with a <strong>minority of the popular vote</strong>.</p>
    <p style="margin-top:4px;">The minimum popular vote to win the Electoral College is roughly <strong>22%</strong> in theory.</p>
    <p style="margin-top:4px;">Votes in "safe" states are effectively <strong>wasted</strong> - they don't change the outcome.</p>
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let W, H;

// Simplified states (grid layout)
const statesData = [
    { name: 'CA', pop: 39500, ev: 54 }, { name: 'TX', pop: 29100, ev: 40 },
    { name: 'FL', pop: 21500, ev: 30 }, { name: 'NY', pop: 20200, ev: 28 },
    { name: 'PA', pop: 13000, ev: 19 }, { name: 'IL', pop: 12800, ev: 19 },
    { name: 'OH', pop: 11800, ev: 17 }, { name: 'GA', pop: 10700, ev: 16 },
    { name: 'NC', pop: 10400, ev: 16 }, { name: 'MI', pop: 10000, ev: 15 },
    { name: 'NJ', pop: 9300, ev: 14 }, { name: 'VA', pop: 8600, ev: 13 },
    { name: 'WA', pop: 7600, ev: 12 }, { name: 'AZ', pop: 7200, ev: 11 },
    { name: 'MA', pop: 7000, ev: 11 }, { name: 'TN', pop: 6900, ev: 11 },
    { name: 'IN', pop: 6700, ev: 11 }, { name: 'MO', pop: 6200, ev: 10 },
    { name: 'MD', pop: 6200, ev: 10 }, { name: 'WI', pop: 5900, ev: 10 },
    { name: 'CO', pop: 5800, ev: 10 }, { name: 'MN', pop: 5700, ev: 10 },
    { name: 'SC', pop: 5100, ev: 9 }, { name: 'AL', pop: 5000, ev: 9 },
    { name: 'LA', pop: 4700, ev: 8 }, { name: 'KY', pop: 4500, ev: 8 },
    { name: 'OR', pop: 4200, ev: 8 }, { name: 'OK', pop: 4000, ev: 7 },
    { name: 'CT', pop: 3600, ev: 7 }, { name: 'UT', pop: 3300, ev: 6 },
    { name: 'IA', pop: 3200, ev: 6 }, { name: 'NV', pop: 3100, ev: 6 },
    { name: 'AR', pop: 3000, ev: 6 }, { name: 'MS', pop: 3000, ev: 6 },
    { name: 'KS', pop: 2900, ev: 6 }, { name: 'NM', pop: 2100, ev: 5 },
    { name: 'NE', pop: 2000, ev: 5 }, { name: 'ID', pop: 1900, ev: 4 },
    { name: 'WV', pop: 1800, ev: 4 }, { name: 'HI', pop: 1500, ev: 4 },
    { name: 'NH', pop: 1400, ev: 4 }, { name: 'ME', pop: 1400, ev: 4 },
    { name: 'MT', pop: 1100, ev: 4 }, { name: 'RI', pop: 1100, ev: 4 },
    { name: 'DE', pop: 1000, ev: 3 }, { name: 'SD', pop: 900, ev: 3 },
    { name: 'ND', pop: 800, ev: 3 }, { name: 'AK', pop: 730, ev: 3 },
    { name: 'VT', pop: 650, ev: 3 }, { name: 'WY', pop: 580, ev: 3 },
    { name: 'DC', pop: 700, ev: 3 }
];

let states = statesData.map(s => ({
    ...s,
    party: 'none', // 'red', 'blue', 'none'
    margin: 0.5 // 0-1, how much of pop votes for winner
}));

let hoveredState = -1;
let stateRects = [];
let animT = 0;

function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
    layoutStates();
}
window.addEventListener('resize', resize);

function layoutStates() {
    stateRects = [];
    const cols = Math.ceil(Math.sqrt(states.length * 1.5));
    const rows = Math.ceil(states.length / cols);
    const margin = 40;
    const left = margin;
    const top = 70;
    const right = Math.min(W - 340, W * 0.65);
    const bottom = H - 60;
    const cellW = (right - left) / cols;
    const cellH = (bottom - top) / rows;
    const size = Math.min(cellW, cellH) - 4;

    states.forEach((s, i) => {
        const col = i % cols;
        const row = Math.floor(i / cols);
        stateRects.push({
            x: left + col * cellW + (cellW - size) / 2,
            y: top + row * cellH + (cellH - size) / 2,
            w: size,
            h: size
        });
    });
}

resize();

function computeStats() {
    let redEV = 0, blueEV = 0, redPop = 0, bluePop = 0, totalPop = 0;
    let wastedRed = 0, wastedBlue = 0;
    states.forEach(s => {
        totalPop += s.pop;
        if (s.party === 'red') {
            redEV += s.ev;
            redPop += Math.ceil(s.pop * s.margin);
            bluePop += Math.floor(s.pop * (1 - s.margin));
            wastedRed += Math.max(0, Math.ceil(s.pop * s.margin) - Math.floor(s.pop * (1 - s.margin)) - 1);
        } else if (s.party === 'blue') {
            blueEV += s.ev;
            bluePop += Math.ceil(s.pop * s.margin);
            redPop += Math.floor(s.pop * (1 - s.margin));
            wastedBlue += Math.max(0, Math.ceil(s.pop * s.margin) - Math.floor(s.pop * (1 - s.margin)) - 1);
        }
    });
    return { redEV, blueEV, redPop, bluePop, totalPop, wastedRed, wastedBlue };
}

function updateStats() {
    const s = computeStats();
    const totalEV = states.reduce((a, st) => a + st.ev, 0);
    const needed = Math.ceil(totalEV / 2) + 1;
    const statsDiv = document.getElementById('stats');
    const redWin = s.redEV >= needed;
    const blueWin = s.blueEV >= needed;
    const totalVotes = s.redPop + s.bluePop || 1;

    statsDiv.innerHTML = `
        <div class="stat"><span class="red">Red: ${s.redEV} EV</span> | <span class="blue">Blue: ${s.blueEV} EV</span></div>
        <div class="stat"><span class="stat-label">Need ${needed} to win (of ${totalEV})</span></div>
        <div class="stat"><span class="red">Red Pop: ${s.redPop.toLocaleString()}k (${(s.redPop/totalVotes*100).toFixed(1)}%)</span></div>
        <div class="stat"><span class="blue">Blue Pop: ${s.bluePop.toLocaleString()}k (${(s.bluePop/totalVotes*100).toFixed(1)}%)</span></div>
        ${redWin ? '<div class="stat green">RED WINS the Electoral College!</div>' : ''}
        ${blueWin ? '<div class="stat green">BLUE WINS the Electoral College!</div>' : ''}
        ${(redWin && s.redPop < s.bluePop) || (blueWin && s.bluePop < s.redPop)
            ? '<div class="stat yellow">POPULAR VOTE LOSER wins EC!</div>' : ''}
    `;
}

canvas.addEventListener('click', (e) => {
    const rect = canvas.getBoundingClientRect();
    const mx = e.clientX - rect.left;
    const my = e.clientY - rect.top;

    for (let i = 0; i < stateRects.length; i++) {
        const r = stateRects[i];
        if (mx >= r.x && mx <= r.x + r.w && my >= r.y && my <= r.y + r.h) {
            if (states[i].party === 'none') states[i].party = 'red';
            else if (states[i].party === 'red') states[i].party = 'blue';
            else states[i].party = 'none';
            states[i].margin = 0.5 + Math.random() * 0.3;
            updateStats();
            break;
        }
    }
});

canvas.addEventListener('mousemove', (e) => {
    const rect = canvas.getBoundingClientRect();
    const mx = e.clientX - rect.left;
    const my = e.clientY - rect.top;
    hoveredState = -1;
    for (let i = 0; i < stateRects.length; i++) {
        const r = stateRects[i];
        if (mx >= r.x && mx <= r.x + r.w && my >= r.y && my <= r.y + r.h) {
            hoveredState = i;
            break;
        }
    }
});

document.getElementById('randomize').addEventListener('click', () => {
    states.forEach(s => {
        const r = Math.random();
        s.party = r < 0.45 ? 'red' : r < 0.9 ? 'blue' : 'none';
        s.margin = 0.51 + Math.random() * 0.3;
    });
    updateStats();
});

document.getElementById('minWin').addEventListener('click', () => {
    // Find minimum popular vote to win EC
    // Strategy: win smallest states by tiny margins, lose big states by huge margins
    const sorted = states.map((s, i) => ({i, ev: s.ev, pop: s.pop})).sort((a, b) => a.pop / a.ev - b.pop / b.ev);
    const totalEV = states.reduce((a, s) => a + s.ev, 0);
    const needed = Math.ceil(totalEV / 2) + 1;

    // Reset all
    states.forEach(s => { s.party = 'blue'; s.margin = 0.99; });

    let accEV = 0;
    for (const st of sorted) {
        if (accEV >= needed) break;
        states[st.i].party = 'red';
        states[st.i].margin = 0.501; // barely win
        accEV += st.ev;
    }

    updateStats();
    const stats = computeStats();
    const totalVotes = stats.redPop + stats.bluePop || 1;
    document.getElementById('messageBox').innerHTML = `
        <div style="color:#f0c040;padding:6px;background:rgba(240,192,64,0.1);border-radius:6px;">
            Red wins ${accEV} EVs with only ${(stats.redPop/totalVotes*100).toFixed(1)}% of the popular vote!
            Strategy: barely win small states, massively lose big ones.
        </div>`;
});

document.getElementById('resetBtn').addEventListener('click', () => { window.reset(); });

function draw() {
    ctx.clearRect(0, 0, W, H);
    animT += 0.01;

    // Grid bg
    ctx.strokeStyle = 'rgba(60,80,120,0.1)';
    for (let x = 0; x < W; x += 40) { ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, H); ctx.stroke(); }
    for (let y = 0; y < H; y += 40) { ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(W, y); ctx.stroke(); }

    // Title
    ctx.fillStyle = '#c0d4f0';
    ctx.font = 'bold 18px system-ui';
    ctx.textAlign = 'center';
    ctx.fillText('Electoral College Simulation', W * 0.35, 40);
    ctx.font = '12px system-ui';
    ctx.fillStyle = '#6080a0';
    ctx.fillText('Click states to cycle: None > Red > Blue', W * 0.35, 58);

    // Draw states
    const maxEV = Math.max(...states.map(s => s.ev));
    for (let i = 0; i < states.length; i++) {
        const r = stateRects[i];
        if (!r) continue;
        const s = states[i];

        // Size proportional to EV
        const scale = 0.5 + 0.5 * (s.ev / maxEV);
        const sw = r.w * scale;
        const sh = r.h * scale;
        const sx = r.x + (r.w - sw) / 2;
        const sy = r.y + (r.h - sh) / 2;

        // Color
        let fill;
        if (s.party === 'red') fill = 'rgba(220,70,80,0.7)';
        else if (s.party === 'blue') fill = 'rgba(60,120,210,0.7)';
        else fill = 'rgba(80,90,110,0.5)';

        ctx.fillStyle = fill;
        ctx.fillRect(sx, sy, sw, sh);

        // Border
        if (i === hoveredState) {
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
        } else {
            ctx.strokeStyle = 'rgba(150,170,200,0.3)';
            ctx.lineWidth = 1;
        }
        ctx.strokeRect(sx, sy, sw, sh);

        // Label
        ctx.fillStyle = '#e0e8f0';
        ctx.font = `bold ${Math.min(11, sw * 0.35)}px system-ui`;
        ctx.textAlign = 'center';
        ctx.fillText(s.name, sx + sw / 2, sy + sh / 2 - 2);
        ctx.font = `${Math.min(9, sw * 0.25)}px system-ui`;
        ctx.fillStyle = '#a0b0c8';
        ctx.fillText(s.ev + ' EV', sx + sw / 2, sy + sh / 2 + 10);
    }

    // Tooltip
    if (hoveredState >= 0) {
        const s = states[hoveredState];
        const r = stateRects[hoveredState];
        const tx = r.x + r.w + 10;
        const ty = r.y;
        ctx.fillStyle = 'rgba(15,20,35,0.9)';
        ctx.fillRect(tx, ty, 140, 60);
        ctx.strokeStyle = 'rgba(100,140,200,0.4)';
        ctx.strokeRect(tx, ty, 140, 60);
        ctx.fillStyle = '#e0e8f0';
        ctx.font = 'bold 12px system-ui';
        ctx.textAlign = 'left';
        ctx.fillText(s.name, tx + 8, ty + 16);
        ctx.font = '11px system-ui';
        ctx.fillStyle = '#a0b4d0';
        ctx.fillText(`Pop: ${s.pop.toLocaleString()}k`, tx + 8, ty + 32);
        ctx.fillText(`Electoral Votes: ${s.ev}`, tx + 8, ty + 48);
    }

    // EV bar at bottom
    const barY = H - 45;
    const barH = 25;
    const totalEV = states.reduce((a, s) => a + s.ev, 0);
    const stats = computeStats();
    const barLeft = 60;
    const barRight = Math.min(W - 340, W * 0.65);
    const barW = barRight - barLeft;

    ctx.fillStyle = 'rgba(220,70,80,0.6)';
    ctx.fillRect(barLeft, barY, barW * (stats.redEV / totalEV), barH);
    ctx.fillStyle = 'rgba(60,120,210,0.6)';
    ctx.fillRect(barLeft + barW * (stats.redEV / totalEV), barY, barW * (stats.blueEV / totalEV), barH);
    ctx.fillStyle = 'rgba(80,90,110,0.4)';
    const rest = totalEV - stats.redEV - stats.blueEV;
    ctx.fillRect(barLeft + barW * ((stats.redEV + stats.blueEV) / totalEV), barY, barW * (rest / totalEV), barH);

    // 270 line
    const needed = Math.ceil(totalEV / 2) + 1;
    const lineX = barLeft + barW * (needed / totalEV);
    ctx.strokeStyle = '#f0c040';
    ctx.lineWidth = 2;
    ctx.setLineDash([4, 3]);
    ctx.beginPath(); ctx.moveTo(lineX, barY - 8); ctx.lineTo(lineX, barY + barH + 8); ctx.stroke();
    ctx.setLineDash([]);
    ctx.lineWidth = 1;
    ctx.fillStyle = '#f0c040';
    ctx.font = '10px system-ui';
    ctx.textAlign = 'center';
    ctx.fillText(needed + ' to win', lineX, barY - 12);

    requestAnimationFrame(draw);
}

window.reset = function() {
    states = statesData.map(s => ({ ...s, party: 'none', margin: 0.5 }));
    document.getElementById('messageBox').innerHTML = '';
    updateStats();
};

updateStats();
draw();
</script>
<script src="../assets/js/enhance.js"></script>
</body>
</html>
