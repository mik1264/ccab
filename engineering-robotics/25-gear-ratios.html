<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gear Ratio Simulator - CCAB</title>
    <link rel="stylesheet" href="../assets/css/gallery-standard.css">
    <style>
        body {
            background: #e5e5e5;
            color: #333;
            font-family: system-ui;
            padding: 2rem;
            text-align: center;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        
        canvas {
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .controls {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 40px;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
        }
        
        .gear-ctrl {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .info {
            font-size: 1.2rem;
            margin-top: 20px;
            font-weight: bold;
            color: #3b82f6;
        }
        
    </style>
</head>
<body>

<div class="container">
    <a href="../index.html" class="gallery-back">‚Üê Back to Gallery</a>
    <h1>Gear Ratio Simulator</h1>
    
    <canvas id="canvas" width="800" height="400"></canvas>
    
    <div class="info" id="ratio-display">Ratio: 1:1</div>
    
    <div class="controls">
        <div class="gear-ctrl">
            <label>Driver (N1)</label>
            <input type="range" id="n1" min="8" max="60" value="20">
            <span id="n1-val">20</span>
        </div>
        
        <div class="gear-ctrl">
            <label>Driven (N2)</label>
            <input type="range" id="n2" min="8" max="60" value="40">
            <span id="n2-val">40</span>
        </div>
        
        <div class="gear-ctrl">
            <label>Input Speed (RPM)</label>
            <input type="range" id="speed" min="0" max="200" value="60">
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    let n1 = 20;
    let n2 = 40;
    let speed = 60; // RPM
    
    let angle1 = 0;
    let angle2 = 0;
    
    // Config
    const MODULE = 5; // Size of teeth
    
    document.getElementById('n1').addEventListener('input', update);
    document.getElementById('n2').addEventListener('input', update);
    document.getElementById('speed').addEventListener('input', update);
    
    function update() {
        n1 = parseInt(document.getElementById('n1').value);
        n2 = parseInt(document.getElementById('n2').value);
        speed = parseInt(document.getElementById('speed').value);
        
        document.getElementById('n1-val').textContent = n1;
        document.getElementById('n2-val').textContent = n2;
        
        const ratio = n2 / n1;
        document.getElementById('ratio-display').textContent = `Ratio: 1:${ratio.toFixed(2)} | Output Speed: ${(speed / ratio).toFixed(1)} RPM`;
    }
    
    function loop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Update angles
        // Radians per frame
        const delta1 = (speed / 60) * 2 * Math.PI * (1/60); // 60fps approx
        const ratio = n2 / n1;
        const delta2 = -delta1 / ratio; // Opposite direction
        
        angle1 += delta1;
        angle2 += delta2;
        
        // Draw Gears
        const r1 = (n1 * MODULE) / 2;
        const r2 = (n2 * MODULE) / 2;
        
        const x1 = 400 - r1 - 10;
        const y = 200;
        
        const x2 = 400 + r2; // Center distance = r1+r2 roughly
        // Actually pitch radius is N*M/2. Distance = r1+r2.
        
        // Center the assembly
        const totalW = r1 + r2;
        const centerX = 400;
        const c1x = centerX - (r1+r2)/2;
        const c2x = centerX + (r1+r2)/2; // No, c2x = c1x + r1 + r2
        
        drawGear(c1x, y, r1, n1, angle1, '#ef4444');
        drawGear(c1x + r1 + r2, y, r2, n2, angle2, '#3b82f6');
        
        requestAnimationFrame(loop);
    }
    
    function drawGear(cx, cy, radius, teeth, theta, color) {
        ctx.save();
        ctx.translate(cx, cy);
        ctx.rotate(theta);
        
        ctx.fillStyle = color;
        ctx.strokeStyle = '#222';
        ctx.lineWidth = 2;
        
        ctx.beginPath();
        const outerR = radius + MODULE;
        const innerR = radius - MODULE;
        
        for (let i = 0; i < teeth * 2; i++) {
            const a = (Math.PI * 2 * i) / (teeth * 2);
            const r = (i % 2 === 0) ? outerR : innerR;
            if (i===0) ctx.moveTo(r * Math.cos(a), r * Math.sin(a));
            else ctx.lineTo(r * Math.cos(a), r * Math.sin(a));
        }
        ctx.closePath();
        ctx.fill();
        ctx.stroke();
        
        // Center hole
        ctx.fillStyle = '#fff';
        ctx.beginPath();
        ctx.arc(0, 0, 10, 0, Math.PI*2);
        ctx.fill();
        ctx.stroke();
        
        // Marker
        ctx.fillStyle = '#000';
        ctx.beginPath();
        ctx.arc(radius * 0.7, 0, 5, 0, Math.PI*2);
        ctx.fill();
        
        ctx.restore();
    }
    
    update();
    requestAnimationFrame(loop);

</script>
</body>
</html>
