<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Op-Amp Circuits - CCAB</title>
    <link rel="stylesheet" href="../assets/css/gallery-standard.css">
    <style>
        body {
            background: #fff;
            color: #333;
            font-family: system-ui;
            padding: 2rem;
            text-align: center;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        
        .circuit-diagram {
            width: 600px;
            height: 300px;
            margin: 0 auto;
            border: 1px solid #ccc;
            background: #fafafa;
            position: relative;
        }
        
        canvas {
            background: #222;
            border-radius: 4px;
            margin-top: 20px;
        }
        
        .controls {
            margin: 20px 0;
            padding: 15px;
            background: #f3f4f6;
            border-radius: 8px;
            display: inline-block;
        }
        
        select { padding: 8px; margin-right: 10px; }
        input { width: 100px; }
        
        /* Schematic styling via SVG overlay logic or static image replacement */
        /* For demo, simple schematic via CSS/Divs is hard. Using Canvas for both. */
        
    </style>
</head>
<body>

<div class="container">
    <a href="../index.html" class="gallery-back">← Back to Gallery</a>
    <h1>Operational Amplifier Circuits</h1>
    
    <div class="controls">
        <label>Circuit Type:</label>
        <select id="type-select">
            <option value="inverting">Inverting Amplifier</option>
            <option value="non-inverting">Non-Inverting Amplifier</option>
            <!-- <option value="integrator">Integrator (Low Pass)</option> -->
        </select>
        
        <label>R1 (kΩ): <span id="r1-val">10</span></label>
        <input type="range" id="r1" min="1" max="100" value="10">
        
        <label>R2 (Rf) (kΩ): <span id="r2-val">20</span></label>
        <input type="range" id="r2" min="1" max="100" value="20">
    </div>

    <div class="circuit-diagram" id="schematic">
        <!-- We'll draw schematic here too -->
        <canvas id="schematic-canvas" width="600" height="300"></canvas>
    </div>
    
    <h3>Input (Green) vs Output (Red)</h3>
    <canvas id="scope" width="800" height="200"></canvas>
</div>

<script>
    const schematicCanvas = document.getElementById('schematic-canvas');
    const ctxSch = schematicCanvas.getContext('2d');
    const scopeCanvas = document.getElementById('scope');
    const ctxScope = scopeCanvas.getContext('2d');
    
    let type = 'inverting';
    let r1 = 10;
    let r2 = 20;
    let time = 0;
    
    function update() {
        type = document.getElementById('type-select').value;
        r1 = parseInt(document.getElementById('r1').value);
        r2 = parseInt(document.getElementById('r2').value);
        
        document.getElementById('r1-val').textContent = r1;
        document.getElementById('r2-val').textContent = r2;
        
        drawSchematic();
    }
    
    document.getElementById('type-select').addEventListener('change', update);
    document.getElementById('r1').addEventListener('input', update);
    document.getElementById('r2').addEventListener('input', update);
    
    function drawSchematic() {
        const ctx = ctxSch;
        ctx.clearRect(0, 0, 600, 300);
        ctx.strokeStyle = '#000';
        ctx.lineWidth = 2;
        ctx.fillStyle = '#000';
        ctx.font = '16px sans-serif';
        
        // Op-Amp Triangle
        const cx = 300, cy = 150;
        ctx.beginPath();
        ctx.moveTo(cx, cy - 50);
        ctx.lineTo(cx, cy + 50);
        ctx.lineTo(cx + 80, cy);
        ctx.closePath();
        ctx.stroke();
        
        // Terminals
        ctx.fillText("-", cx + 10, cy - 25);
        ctx.fillText("+", cx + 10, cy + 35);
        
        if (type === 'inverting') {
            // Inverting config
            // - input gets Vin via R1
            // + input grounded
            // Rf (R2) feedback from Out to -
            
            // + Input to Gnd
            ctx.beginPath();
            ctx.moveTo(cx, cy + 25);
            ctx.lineTo(cx - 20, cy + 25);
            ctx.lineTo(cx - 20, cy + 60); // Gnd
            ctx.moveTo(cx - 30, cy + 60); ctx.lineTo(cx - 10, cy + 60);
            ctx.stroke();
            
            // - Input line
            ctx.beginPath();
            ctx.moveTo(cx, cy - 25);
            ctx.lineTo(cx - 100, cy - 25);
            
            // R1
            ctx.lineTo(cx - 100, cy - 35);
            ctx.rect(cx - 140, cy - 35, 40, 20); // Resistor box
            ctx.moveTo(cx - 140, cy - 25);
            ctx.lineTo(cx - 180, cy - 25); // Vin
            ctx.stroke();
            ctx.fillText(`R1=${r1}k`, cx - 135, cy - 40);
            ctx.fillText("Vin", cx - 200, cy - 20);
            
            // Feedback R2
            ctx.beginPath();
            ctx.moveTo(cx - 50, cy - 25);
            ctx.lineTo(cx - 50, cy - 80);
            ctx.lineTo(cx + 100, cy - 80);
            ctx.lineTo(cx + 100, cy); // To Vout line
            ctx.stroke();
            
            // Resistor R2 on feedback
            ctx.strokeRect(cx, cy - 90, 40, 20);
            ctx.fillText(`R2=${r2}k`, cx + 5, cy - 95);
            
            // Vout
            ctx.beginPath();
            ctx.moveTo(cx + 80, cy);
            ctx.lineTo(cx + 150, cy);
            ctx.stroke();
            ctx.fillText("Vout", cx + 160, cy + 5);
            
            // Gain text
            const gain = -r2/r1;
            ctx.fillStyle = '#d97706';
            ctx.fillText(`Gain = -R2/R1 = ${gain.toFixed(2)}`, 20, 280);
            
        } else {
            // Non-Inverting
            // + input gets Vin
            // - input gets R1 to Gnd, R2 feedback
            
            // + Input to Vin
            ctx.beginPath();
            ctx.moveTo(cx, cy + 25);
            ctx.lineTo(cx - 180, cy + 25);
            ctx.stroke();
            ctx.fillText("Vin", cx - 200, cy + 30);
            
            // - Input line
            ctx.beginPath();
            ctx.moveTo(cx, cy - 25);
            ctx.lineTo(cx - 50, cy - 25);
            ctx.lineTo(cx - 50, cy + 60); // To R1
            // R1 to Gnd
            ctx.rect(cx - 70, cy + 60, 40, 20);
            ctx.moveTo(cx - 50, cy + 80);
            ctx.lineTo(cx - 50, cy + 100); // Gnd
            ctx.moveTo(cx - 60, cy + 100); ctx.lineTo(cx - 40, cy + 100);
            ctx.stroke();
            ctx.fillText(`R1=${r1}k`, cx - 90, cy + 75);
            
            // Feedback R2
            ctx.beginPath();
            ctx.moveTo(cx - 50, cy - 25);
            ctx.lineTo(cx - 50, cy - 80);
            ctx.lineTo(cx + 100, cy - 80);
            ctx.lineTo(cx + 100, cy);
            ctx.stroke();
            
            ctx.strokeRect(cx, cy - 90, 40, 20);
            ctx.fillText(`R2=${r2}k`, cx + 5, cy - 95);
            
            // Vout
            ctx.beginPath();
            ctx.moveTo(cx + 80, cy);
            ctx.lineTo(cx + 150, cy);
            ctx.stroke();
            ctx.fillText("Vout", cx + 160, cy + 5);
            
            // Gain text
            const gain = 1 + r2/r1;
            ctx.fillStyle = '#d97706';
            ctx.fillText(`Gain = 1 + R2/R1 = ${gain.toFixed(2)}`, 20, 280);
        }
    }
    
    function loop() {
        time += 0.05;
        
        ctxScope.fillStyle = '#222';
        ctxScope.fillRect(0, 0, scopeCanvas.width, scopeCanvas.height);
        
        ctxScope.strokeStyle = '#333';
        ctxScope.beginPath();
        ctxScope.moveTo(0, 100); ctxScope.lineTo(800, 100);
        ctxScope.stroke();
        
        const gain = (type === 'inverting') ? -r2/r1 : (1 + r2/r1);
        
        // Draw Input (Green)
        ctxScope.strokeStyle = '#10b981';
        ctxScope.lineWidth = 2;
        ctxScope.beginPath();
        for(let x=0; x<800; x++) {
            const t = time + x * 0.02;
            const vin = Math.sin(t) * 20; // 20px amplitude
            if(x===0) ctxScope.moveTo(x, 100 - vin);
            else ctxScope.lineTo(x, 100 - vin);
        }
        ctxScope.stroke();
        
        // Draw Output (Red)
        ctxScope.strokeStyle = '#ef4444';
        ctxScope.lineWidth = 2;
        ctxScope.beginPath();
        for(let x=0; x<800; x++) {
            const t = time + x * 0.02;
            let vin = Math.sin(t) * 20;
            let vout = vin * gain;
            
            // Saturation?
            if (vout > 90) vout = 90;
            if (vout < -90) vout = -90;
            
            if(x===0) ctxScope.moveTo(x, 100 - vout);
            else ctxScope.lineTo(x, 100 - vout);
        }
        ctxScope.stroke();
        
        requestAnimationFrame(loop);
    }
    
    update();
    requestAnimationFrame(loop);

</script>
</body>
</html>
