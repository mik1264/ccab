<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Formation | Sports Analytics</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            overflow: hidden;
        }
        #canvas { display: block; cursor: pointer; }
        .controls {
            position: fixed;
            top: 20px; right: 20px;
            background: rgba(0,0,0,0.85);
            padding: 20px; border-radius: 15px;
            min-width: 280px;
            border: 1px solid rgba(20, 184, 166, 0.3);
        }
        h1 { color: #14b8a6; font-size: 1.3em; margin-bottom: 15px; }
        .control-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; color: #aaa; font-size: 0.9em; }
        input[type="range"], select { width: 100%; }
        .value { float: right; color: #14b8a6; }
        button {
            width: 100%; padding: 10px; margin: 5px 0;
            border: none; border-radius: 8px;
            background: #14b8a6; color: white;
            font-weight: bold; cursor: pointer;
        }
        button:hover { background: #2dd4bf; }
        .stats { margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); }
        .stat-row { display: flex; justify-content: space-between; padding: 5px 0; font-size: 0.9em; }
        .stat-label { color: #888; }
        .stat-value { color: #14b8a6; font-weight: bold; }
        .info { font-size: 0.8em; color: #666; margin-top: 15px; line-height: 1.5; }
        a.back-link {
            position: fixed; top: 20px; left: 20px;
            color: #14b8a6; text-decoration: none;
            background: rgba(0,0,0,0.8); padding: 10px 20px;
            border-radius: 25px; font-size: 0.9em;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <a href="index.html" class="back-link">‚Üê Back to Sports Analytics</a>

    <div class="controls">
        <h1>Team Formation</h1>
        <p style="font-size:0.85em; color:#888; margin-bottom:15px;">Tactical positioning & analysis</p>

        <div class="control-group">
            <label>Formation</label>
            <select id="formation">
                <option value="442">4-4-2</option>
                <option value="433">4-3-3</option>
                <option value="352">3-5-2</option>
                <option value="4231">4-2-3-1</option>
                <option value="532">5-3-2</option>
            </select>
        </div>

        <div class="control-group">
            <label>Show Analysis</label>
            <select id="analysis">
                <option value="none">None</option>
                <option value="passing">Passing Lanes</option>
                <option value="defensive">Defensive Shape</option>
                <option value="pressing">Pressing Zones</option>
            </select>
        </div>

        <div class="control-group">
            <label>Team Width: <span class="value" id="widthValue">0.8</span></label>
            <input type="range" id="teamWidth" min="0.5" max="1" step="0.05" value="0.8">
        </div>

        <div class="control-group">
            <label>Defensive Line: <span class="value" id="lineValue">0.3</span></label>
            <input type="range" id="defensiveLine" min="0.15" max="0.5" step="0.05" value="0.3">
        </div>

        <button id="animateBtn">Animate Formation</button>
        <button id="resetBtn" style="background:#444">Reset Positions</button>

        <div class="stats">
            <div class="stat-row">
                <span class="stat-label">Compactness</span>
                <span class="stat-value" id="compactness">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Width Coverage</span>
                <span class="stat-value" id="widthCoverage">0%</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Depth</span>
                <span class="stat-value" id="depth">0 m</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Selected</span>
                <span class="stat-value" id="selected">None</span>
            </div>
        </div>

        <div class="info">
            <strong>Drag players</strong> to adjust positions.<br>
            <strong>Compactness:</strong> How tight the formation is.<br>
            <strong>Width:</strong> Horizontal coverage.
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resize();
        window.onresize = resize;

        let currentFormation = '442';
        let analysisMode = 'none';
        let teamWidthFactor = 0.8;
        let defensiveLineFactor = 0.3;
        let animate = false;
        let animTime = 0;

        const fieldWidth = 700;
        const fieldHeight = 450;

        let players = [];
        let selectedPlayer = null;
        let dragging = false;

        const formations = {
            '442': [
                { x: 0.08, y: 0.5, role: 'GK' },
                { x: 0.25, y: 0.15, role: 'LB' }, { x: 0.25, y: 0.38, role: 'CB' },
                { x: 0.25, y: 0.62, role: 'CB' }, { x: 0.25, y: 0.85, role: 'RB' },
                { x: 0.45, y: 0.15, role: 'LM' }, { x: 0.45, y: 0.38, role: 'CM' },
                { x: 0.45, y: 0.62, role: 'CM' }, { x: 0.45, y: 0.85, role: 'RM' },
                { x: 0.7, y: 0.35, role: 'ST' }, { x: 0.7, y: 0.65, role: 'ST' }
            ],
            '433': [
                { x: 0.08, y: 0.5, role: 'GK' },
                { x: 0.25, y: 0.15, role: 'LB' }, { x: 0.25, y: 0.38, role: 'CB' },
                { x: 0.25, y: 0.62, role: 'CB' }, { x: 0.25, y: 0.85, role: 'RB' },
                { x: 0.45, y: 0.3, role: 'CM' }, { x: 0.45, y: 0.5, role: 'CDM' }, { x: 0.45, y: 0.7, role: 'CM' },
                { x: 0.7, y: 0.2, role: 'LW' }, { x: 0.7, y: 0.5, role: 'ST' }, { x: 0.7, y: 0.8, role: 'RW' }
            ],
            '352': [
                { x: 0.08, y: 0.5, role: 'GK' },
                { x: 0.25, y: 0.25, role: 'CB' }, { x: 0.25, y: 0.5, role: 'CB' }, { x: 0.25, y: 0.75, role: 'CB' },
                { x: 0.4, y: 0.1, role: 'LWB' }, { x: 0.45, y: 0.35, role: 'CM' },
                { x: 0.45, y: 0.5, role: 'CDM' }, { x: 0.45, y: 0.65, role: 'CM' }, { x: 0.4, y: 0.9, role: 'RWB' },
                { x: 0.7, y: 0.35, role: 'ST' }, { x: 0.7, y: 0.65, role: 'ST' }
            ],
            '4231': [
                { x: 0.08, y: 0.5, role: 'GK' },
                { x: 0.25, y: 0.15, role: 'LB' }, { x: 0.25, y: 0.38, role: 'CB' },
                { x: 0.25, y: 0.62, role: 'CB' }, { x: 0.25, y: 0.85, role: 'RB' },
                { x: 0.4, y: 0.4, role: 'CDM' }, { x: 0.4, y: 0.6, role: 'CDM' },
                { x: 0.55, y: 0.2, role: 'LAM' }, { x: 0.55, y: 0.5, role: 'CAM' }, { x: 0.55, y: 0.8, role: 'RAM' },
                { x: 0.75, y: 0.5, role: 'ST' }
            ],
            '532': [
                { x: 0.08, y: 0.5, role: 'GK' },
                { x: 0.2, y: 0.1, role: 'LWB' }, { x: 0.25, y: 0.3, role: 'CB' },
                { x: 0.25, y: 0.5, role: 'CB' }, { x: 0.25, y: 0.7, role: 'CB' }, { x: 0.2, y: 0.9, role: 'RWB' },
                { x: 0.45, y: 0.3, role: 'CM' }, { x: 0.45, y: 0.5, role: 'CDM' }, { x: 0.45, y: 0.7, role: 'CM' },
                { x: 0.7, y: 0.35, role: 'ST' }, { x: 0.7, y: 0.65, role: 'ST' }
            ]
        };

        function initPlayers() {
            const formation = formations[currentFormation];
            players = formation.map((pos, i) => ({
                id: i,
                baseX: pos.x,
                baseY: pos.y,
                x: pos.x,
                y: pos.y,
                role: pos.role
            }));
            applyFormationModifiers();
        }

        function applyFormationModifiers() {
            players.forEach(p => {
                // Apply width
                const centerY = 0.5;
                p.y = centerY + (p.baseY - centerY) * teamWidthFactor;

                // Apply defensive line (except GK and forwards)
                if (p.baseX > 0.15 && p.baseX < 0.6) {
                    p.x = p.baseX * (defensiveLineFactor / 0.3);
                }
            });
        }

        function getFieldOffset() {
            return {
                x: (canvas.width - 350 - fieldWidth) / 2,
                y: (canvas.height - fieldHeight) / 2
            };
        }

        function drawField() {
            const offset = getFieldOffset();

            // Grass
            ctx.fillStyle = '#2d8a3e';
            ctx.fillRect(offset.x, offset.y, fieldWidth, fieldHeight);

            // Lines
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.strokeRect(offset.x, offset.y, fieldWidth, fieldHeight);

            // Center line
            ctx.beginPath();
            ctx.moveTo(offset.x + fieldWidth / 2, offset.y);
            ctx.lineTo(offset.x + fieldWidth / 2, offset.y + fieldHeight);
            ctx.stroke();

            // Center circle
            ctx.beginPath();
            ctx.arc(offset.x + fieldWidth / 2, offset.y + fieldHeight / 2, 60, 0, Math.PI * 2);
            ctx.stroke();

            // Penalty areas
            ctx.strokeRect(offset.x, offset.y + 112, 110, 226);
            ctx.strokeRect(offset.x + fieldWidth - 110, offset.y + 112, 110, 226);

            // Goal areas
            ctx.strokeRect(offset.x, offset.y + 168, 40, 114);
            ctx.strokeRect(offset.x + fieldWidth - 40, offset.y + 168, 40, 114);
        }

        function drawPassingLanes() {
            const offset = getFieldOffset();

            ctx.strokeStyle = 'rgba(20, 184, 166, 0.3)';
            ctx.lineWidth = 2;

            players.forEach((p1, i) => {
                players.forEach((p2, j) => {
                    if (i >= j) return;

                    const dist = Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));
                    if (dist < 0.4) {
                        ctx.beginPath();
                        ctx.moveTo(offset.x + p1.x * fieldWidth, offset.y + p1.y * fieldHeight);
                        ctx.lineTo(offset.x + p2.x * fieldWidth, offset.y + p2.y * fieldHeight);
                        ctx.stroke();
                    }
                });
            });
        }

        function drawDefensiveShape() {
            const offset = getFieldOffset();

            // Draw convex hull of outfield players
            const outfield = players.filter(p => p.role !== 'GK');
            if (outfield.length < 3) return;

            // Simple convex hull
            const points = outfield.map(p => ({ x: p.x, y: p.y }));
            points.sort((a, b) => a.y - b.y || a.x - b.x);

            ctx.fillStyle = 'rgba(20, 184, 166, 0.15)';
            ctx.beginPath();
            ctx.moveTo(offset.x + points[0].x * fieldWidth, offset.y + points[0].y * fieldHeight);
            points.forEach(p => {
                ctx.lineTo(offset.x + p.x * fieldWidth, offset.y + p.y * fieldHeight);
            });
            ctx.closePath();
            ctx.fill();
        }

        function drawPressingZones() {
            const offset = getFieldOffset();

            // High press zone
            ctx.fillStyle = 'rgba(239, 68, 68, 0.2)';
            ctx.fillRect(offset.x + fieldWidth * 0.6, offset.y, fieldWidth * 0.4, fieldHeight);

            // Mid press zone
            ctx.fillStyle = 'rgba(234, 179, 8, 0.15)';
            ctx.fillRect(offset.x + fieldWidth * 0.35, offset.y, fieldWidth * 0.25, fieldHeight);

            // Labels
            ctx.fillStyle = '#ef4444';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('HIGH PRESS', offset.x + fieldWidth * 0.8, offset.y + 20);
            ctx.fillStyle = '#eab308';
            ctx.fillText('MID BLOCK', offset.x + fieldWidth * 0.47, offset.y + 20);
        }

        function drawPlayers() {
            const offset = getFieldOffset();

            if (animate) {
                animTime += 0.02;
                players.forEach(p => {
                    p.x = p.baseX + Math.sin(animTime + p.id) * 0.02;
                    p.y = (0.5 + (p.baseY - 0.5) * teamWidthFactor) + Math.cos(animTime + p.id * 2) * 0.02;
                });
            }

            players.forEach(p => {
                const x = offset.x + p.x * fieldWidth;
                const y = offset.y + p.y * fieldHeight;

                // Player circle
                ctx.beginPath();
                ctx.arc(x, y, 15, 0, Math.PI * 2);
                ctx.fillStyle = selectedPlayer === p.id ? '#14b8a6' : '#ef4444';
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();

                // Role label
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 9px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(p.role, x, y + 4);

                // Number
                ctx.fillStyle = '#fff';
                ctx.font = '10px sans-serif';
                ctx.fillText(p.id + 1, x, y - 20);
            });
        }

        function calculateStats() {
            const outfield = players.filter(p => p.role !== 'GK');

            // Compactness (average distance between players)
            let totalDist = 0;
            let pairs = 0;
            outfield.forEach((p1, i) => {
                outfield.forEach((p2, j) => {
                    if (i < j) {
                        totalDist += Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));
                        pairs++;
                    }
                });
            });
            const compactness = (1 - totalDist / pairs) * 100;

            // Width coverage
            const ys = outfield.map(p => p.y);
            const widthCoverage = (Math.max(...ys) - Math.min(...ys)) * 100;

            // Depth
            const xs = outfield.map(p => p.x);
            const depth = (Math.max(...xs) - Math.min(...xs)) * fieldWidth * 0.15;

            document.getElementById('compactness').textContent = compactness.toFixed(0) + '%';
            document.getElementById('widthCoverage').textContent = widthCoverage.toFixed(0) + '%';
            document.getElementById('depth').textContent = depth.toFixed(0) + ' m';
            document.getElementById('selected').textContent =
                selectedPlayer !== null ? players[selectedPlayer].role : 'None';
        }

        function draw() {
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = '#fff';
            ctx.font = 'bold 24px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Team Formation Tactics', canvas.width / 2 - 100, 40);

            // Draw analysis overlays
            if (analysisMode === 'defensive') drawDefensiveShape();
            if (analysisMode === 'pressing') drawPressingZones();

            drawField();

            if (analysisMode === 'passing') drawPassingLanes();

            drawPlayers();
            calculateStats();

            // Formation label
            const offset = getFieldOffset();
            ctx.fillStyle = '#14b8a6';
            ctx.font = 'bold 20px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(currentFormation.split('').join('-'), offset.x + fieldWidth / 4, offset.y - 15);

            requestAnimationFrame(draw);
        }

        // Event listeners
        document.getElementById('formation').onchange = (e) => {
            currentFormation = e.target.value;
            initPlayers();
        };

        document.getElementById('analysis').onchange = (e) => {
            analysisMode = e.target.value;
        };

        document.getElementById('teamWidth').oninput = (e) => {
            teamWidthFactor = parseFloat(e.target.value);
            document.getElementById('widthValue').textContent = teamWidthFactor.toFixed(2);
            applyFormationModifiers();
        };

        document.getElementById('defensiveLine').oninput = (e) => {
            defensiveLineFactor = parseFloat(e.target.value);
            document.getElementById('lineValue').textContent = defensiveLineFactor.toFixed(2);
            applyFormationModifiers();
        };

        document.getElementById('animateBtn').onclick = () => {
            animate = !animate;
            document.getElementById('animateBtn').textContent = animate ? 'Stop Animation' : 'Animate Formation';
        };

        document.getElementById('resetBtn').onclick = initPlayers;

        canvas.onmousedown = (e) => {
            const rect = canvas.getBoundingClientRect();
            const offset = getFieldOffset();
            const mx = (e.clientX - rect.left - offset.x) / fieldWidth;
            const my = (e.clientY - rect.top - offset.y) / fieldHeight;

            players.forEach(p => {
                const dist = Math.sqrt(Math.pow(p.x - mx, 2) + Math.pow(p.y - my, 2));
                if (dist < 0.05) {
                    selectedPlayer = p.id;
                    dragging = true;
                }
            });
        };

        canvas.onmousemove = (e) => {
            if (!dragging || selectedPlayer === null) return;

            const rect = canvas.getBoundingClientRect();
            const offset = getFieldOffset();
            const mx = (e.clientX - rect.left - offset.x) / fieldWidth;
            const my = (e.clientY - rect.top - offset.y) / fieldHeight;

            players[selectedPlayer].x = Math.max(0, Math.min(1, mx));
            players[selectedPlayer].y = Math.max(0, Math.min(1, my));
            players[selectedPlayer].baseX = players[selectedPlayer].x;
            players[selectedPlayer].baseY = players[selectedPlayer].y;
        };

        canvas.onmouseup = () => {
            dragging = false;
        };

        // Initialize
        initPlayers();
        draw();
    </script>
</body>
</html>
