<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player Tracking | Sports Analytics</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            overflow: hidden;
        }
        #canvas { display: block; }
        .controls {
            position: fixed;
            top: 20px; right: 20px;
            background: rgba(0,0,0,0.85);
            padding: 20px; border-radius: 15px;
            min-width: 280px;
            border: 1px solid rgba(20, 184, 166, 0.3);
        }
        h1 { color: #14b8a6; font-size: 1.3em; margin-bottom: 15px; }
        .control-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; color: #aaa; font-size: 0.9em; }
        input[type="range"], select { width: 100%; }
        .value { float: right; color: #14b8a6; }
        button {
            width: 100%; padding: 10px; margin: 5px 0;
            border: none; border-radius: 8px;
            background: #14b8a6; color: white;
            font-weight: bold; cursor: pointer;
        }
        button:hover { background: #2dd4bf; }
        .stats { margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); }
        .stat-row { display: flex; justify-content: space-between; padding: 5px 0; font-size: 0.9em; }
        .stat-label { color: #888; }
        .stat-value { color: #14b8a6; font-weight: bold; }
        .info { font-size: 0.8em; color: #666; margin-top: 15px; line-height: 1.5; }
        a.back-link {
            position: fixed; top: 20px; left: 20px;
            color: #14b8a6; text-decoration: none;
            background: rgba(0,0,0,0.8); padding: 10px 20px;
            border-radius: 25px; font-size: 0.9em;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <a href="index.html" class="back-link">‚Üê Back to Sports Analytics</a>

    <div class="controls">
        <h1>Player Tracking</h1>
        <p style="font-size:0.85em; color:#888; margin-bottom:15px;">Movement analysis & heatmaps</p>

        <div class="control-group">
            <label>Display Mode</label>
            <select id="displayMode">
                <option value="players">Live Players</option>
                <option value="trails">Movement Trails</option>
                <option value="heatmap">Position Heatmap</option>
                <option value="voronoi">Space Control</option>
            </select>
        </div>

        <div class="control-group">
            <label>Game Speed: <span class="value" id="speedValue">1.0</span>x</label>
            <input type="range" id="speed" min="0.5" max="3" step="0.1" value="1">
        </div>

        <div class="control-group">
            <label>Selected Player</label>
            <select id="selectedPlayer">
                <option value="-1">All Players</option>
            </select>
        </div>

        <button id="playBtn">Play / Pause</button>
        <button id="resetBtn" style="background:#444">Reset</button>

        <div class="stats">
            <div class="stat-row">
                <span class="stat-label">Game Time</span>
                <span class="stat-value" id="gameTime">0:00</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Distance Covered</span>
                <span class="stat-value" id="distance">0 m</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Avg Speed</span>
                <span class="stat-value" id="avgSpeed">0 km/h</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Max Speed</span>
                <span class="stat-value" id="maxSpeed">0 km/h</span>
            </div>
        </div>

        <div class="info">
            <strong>Trails:</strong> Show player movement paths.<br>
            <strong>Heatmap:</strong> Position frequency.<br>
            <strong>Voronoi:</strong> Space control zones.
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resize();
        window.onresize = resize;

        let displayMode = 'players';
        let gameSpeed = 1;
        let selectedPlayer = -1;
        let playing = true;
        let gameTime = 0;

        // Soccer field dimensions (relative)
        const fieldWidth = 700;
        const fieldHeight = 450;

        // Players: 11 per team
        const players = [];
        const teamColors = ['#ef4444', '#3b82f6'];

        function initPlayers() {
            players.length = 0;

            // Team 1 (red) - 4-4-2 formation
            const team1Positions = [
                { x: 50, y: 225 },  // GK
                { x: 150, y: 80 }, { x: 150, y: 170 }, { x: 150, y: 280 }, { x: 150, y: 370 }, // Defenders
                { x: 280, y: 80 }, { x: 280, y: 170 }, { x: 280, y: 280 }, { x: 280, y: 370 }, // Midfield
                { x: 400, y: 150 }, { x: 400, y: 300 } // Forwards
            ];

            // Team 2 (blue) - mirror
            const team2Positions = team1Positions.map(p => ({
                x: fieldWidth - p.x,
                y: p.y
            }));

            team1Positions.forEach((pos, i) => {
                players.push({
                    id: i,
                    team: 0,
                    x: pos.x,
                    y: pos.y,
                    homeX: pos.x,
                    homeY: pos.y,
                    vx: 0, vy: 0,
                    trail: [],
                    totalDistance: 0,
                    maxSpeed: 0,
                    name: `P${i + 1}`
                });
            });

            team2Positions.forEach((pos, i) => {
                players.push({
                    id: i + 11,
                    team: 1,
                    x: pos.x,
                    y: pos.y,
                    homeX: pos.x,
                    homeY: pos.y,
                    vx: 0, vy: 0,
                    trail: [],
                    totalDistance: 0,
                    maxSpeed: 0,
                    name: `P${i + 12}`
                });
            });

            // Populate player selector
            const selector = document.getElementById('selectedPlayer');
            selector.innerHTML = '<option value="-1">All Players</option>';
            players.forEach(p => {
                const option = document.createElement('option');
                option.value = p.id;
                option.textContent = `${p.name} (${p.team === 0 ? 'Red' : 'Blue'})`;
                selector.appendChild(option);
            });
        }

        function updatePlayers(dt) {
            players.forEach(player => {
                // Random movement toward tactical positions
                const targetX = player.homeX + (Math.random() - 0.5) * 100;
                const targetY = player.homeY + (Math.random() - 0.5) * 80;

                const dx = targetX - player.x;
                const dy = targetY - player.y;
                const dist = Math.sqrt(dx * dx + dy * dy);

                if (dist > 5) {
                    const speed = 2 + Math.random() * 3;
                    player.vx = (dx / dist) * speed;
                    player.vy = (dy / dist) * speed;
                }

                // Update position
                const oldX = player.x;
                const oldY = player.y;

                player.x += player.vx * dt * gameSpeed;
                player.y += player.vy * dt * gameSpeed;

                // Keep in bounds
                player.x = Math.max(10, Math.min(fieldWidth - 10, player.x));
                player.y = Math.max(10, Math.min(fieldHeight - 10, player.y));

                // Calculate distance and speed
                const moveDist = Math.sqrt(Math.pow(player.x - oldX, 2) + Math.pow(player.y - oldY, 2));
                player.totalDistance += moveDist * 0.15; // Scale to meters
                const currentSpeed = moveDist * 10 * 3.6; // km/h
                player.maxSpeed = Math.max(player.maxSpeed, currentSpeed);

                // Add to trail
                player.trail.push({ x: player.x, y: player.y });
                if (player.trail.length > 200) player.trail.shift();

                // Damping
                player.vx *= 0.95;
                player.vy *= 0.95;
            });
        }

        function getFieldOffset() {
            return {
                x: (canvas.width - 350 - fieldWidth) / 2,
                y: (canvas.height - fieldHeight) / 2
            };
        }

        function drawField() {
            const offset = getFieldOffset();

            // Grass
            ctx.fillStyle = '#2d8a3e';
            ctx.fillRect(offset.x, offset.y, fieldWidth, fieldHeight);

            // Lines
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.strokeRect(offset.x, offset.y, fieldWidth, fieldHeight);

            // Center line
            ctx.beginPath();
            ctx.moveTo(offset.x + fieldWidth / 2, offset.y);
            ctx.lineTo(offset.x + fieldWidth / 2, offset.y + fieldHeight);
            ctx.stroke();

            // Center circle
            ctx.beginPath();
            ctx.arc(offset.x + fieldWidth / 2, offset.y + fieldHeight / 2, 60, 0, Math.PI * 2);
            ctx.stroke();

            // Penalty areas
            ctx.strokeRect(offset.x, offset.y + 112, 110, 226);
            ctx.strokeRect(offset.x + fieldWidth - 110, offset.y + 112, 110, 226);

            // Goal areas
            ctx.strokeRect(offset.x, offset.y + 168, 40, 114);
            ctx.strokeRect(offset.x + fieldWidth - 40, offset.y + 168, 40, 114);
        }

        function drawPlayers() {
            const offset = getFieldOffset();

            players.forEach(player => {
                if (selectedPlayer !== -1 && player.id !== selectedPlayer) return;

                ctx.beginPath();
                ctx.arc(offset.x + player.x, offset.y + player.y, 12, 0, Math.PI * 2);
                ctx.fillStyle = teamColors[player.team];
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();

                // Player number
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 10px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(player.id % 11 + 1, offset.x + player.x, offset.y + player.y + 4);
            });
        }

        function drawTrails() {
            const offset = getFieldOffset();

            players.forEach(player => {
                if (selectedPlayer !== -1 && player.id !== selectedPlayer) return;
                if (player.trail.length < 2) return;

                ctx.beginPath();
                ctx.strokeStyle = teamColors[player.team] + '80';
                ctx.lineWidth = 2;

                for (let i = 0; i < player.trail.length; i++) {
                    const point = player.trail[i];
                    if (i === 0) ctx.moveTo(offset.x + point.x, offset.y + point.y);
                    else ctx.lineTo(offset.x + point.x, offset.y + point.y);
                }
                ctx.stroke();
            });
        }

        function drawHeatmap() {
            const offset = getFieldOffset();
            const resolution = 20;
            const heatmap = [];

            // Initialize heatmap
            for (let x = 0; x < fieldWidth; x += resolution) {
                for (let y = 0; y < fieldHeight; y += resolution) {
                    heatmap.push({ x, y, count: 0 });
                }
            }

            // Count positions
            players.forEach(player => {
                if (selectedPlayer !== -1 && player.id !== selectedPlayer) return;

                player.trail.forEach(point => {
                    const gridX = Math.floor(point.x / resolution) * resolution;
                    const gridY = Math.floor(point.y / resolution) * resolution;
                    const cell = heatmap.find(c => c.x === gridX && c.y === gridY);
                    if (cell) cell.count++;
                });
            });

            // Draw heatmap
            const maxCount = Math.max(...heatmap.map(c => c.count), 1);
            heatmap.forEach(cell => {
                if (cell.count === 0) return;
                const intensity = cell.count / maxCount;
                ctx.fillStyle = `rgba(255, ${255 - intensity * 200}, 0, ${intensity * 0.7})`;
                ctx.fillRect(offset.x + cell.x, offset.y + cell.y, resolution, resolution);
            });
        }

        function drawVoronoi() {
            const offset = getFieldOffset();
            const resolution = 8;

            for (let x = 0; x < fieldWidth; x += resolution) {
                for (let y = 0; y < fieldHeight; y += resolution) {
                    let nearestPlayer = null;
                    let nearestDist = Infinity;

                    players.forEach(player => {
                        const dist = Math.sqrt(Math.pow(x - player.x, 2) + Math.pow(y - player.y, 2));
                        if (dist < nearestDist) {
                            nearestDist = dist;
                            nearestPlayer = player;
                        }
                    });

                    if (nearestPlayer) {
                        ctx.fillStyle = teamColors[nearestPlayer.team] + '40';
                        ctx.fillRect(offset.x + x, offset.y + y, resolution, resolution);
                    }
                }
            }
        }

        function updateStats() {
            const minutes = Math.floor(gameTime / 60);
            const seconds = Math.floor(gameTime % 60);
            document.getElementById('gameTime').textContent =
                `${minutes}:${seconds.toString().padStart(2, '0')}`;

            if (selectedPlayer === -1) {
                const totalDist = players.reduce((sum, p) => sum + p.totalDistance, 0);
                const avgDist = totalDist / players.length;
                const maxSpd = Math.max(...players.map(p => p.maxSpeed));

                document.getElementById('distance').textContent = avgDist.toFixed(0) + ' m (avg)';
                document.getElementById('maxSpeed').textContent = maxSpd.toFixed(1) + ' km/h';
                document.getElementById('avgSpeed').textContent = (avgDist / Math.max(gameTime, 1) * 3.6).toFixed(1) + ' km/h';
            } else {
                const player = players.find(p => p.id === selectedPlayer);
                if (player) {
                    document.getElementById('distance').textContent = player.totalDistance.toFixed(0) + ' m';
                    document.getElementById('maxSpeed').textContent = player.maxSpeed.toFixed(1) + ' km/h';
                    document.getElementById('avgSpeed').textContent =
                        (player.totalDistance / Math.max(gameTime, 1) * 3.6).toFixed(1) + ' km/h';
                }
            }
        }

        function draw() {
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            if (playing) {
                gameTime += 0.016 * gameSpeed;
                updatePlayers(1);
            }

            ctx.fillStyle = '#fff';
            ctx.font = 'bold 24px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Player Tracking System', canvas.width / 2 - 100, 40);

            // Draw based on display mode
            if (displayMode === 'voronoi') drawVoronoi();
            if (displayMode === 'heatmap') drawHeatmap();

            drawField();

            if (displayMode === 'trails') drawTrails();

            drawPlayers();
            updateStats();

            requestAnimationFrame(draw);
        }

        // Event listeners
        document.getElementById('displayMode').onchange = (e) => {
            displayMode = e.target.value;
        };

        document.getElementById('speed').oninput = (e) => {
            gameSpeed = parseFloat(e.target.value);
            document.getElementById('speedValue').textContent = gameSpeed.toFixed(1);
        };

        document.getElementById('selectedPlayer').onchange = (e) => {
            selectedPlayer = parseInt(e.target.value);
        };

        document.getElementById('playBtn').onclick = () => {
            playing = !playing;
            document.getElementById('playBtn').textContent = playing ? 'Pause' : 'Play';
        };

        document.getElementById('resetBtn').onclick = () => {
            gameTime = 0;
            initPlayers();
        };

        // Initialize
        initPlayers();
        draw();
    </script>
</body>
</html>
