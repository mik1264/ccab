<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tournament Bracket | Sports Analytics</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            overflow: hidden;
        }
        #canvas { display: block; }
        .controls {
            position: fixed;
            top: 20px; right: 20px;
            background: rgba(0,0,0,0.85);
            padding: 20px; border-radius: 15px;
            min-width: 280px;
            border: 1px solid rgba(20, 184, 166, 0.3);
        }
        h1 { color: #14b8a6; font-size: 1.3em; margin-bottom: 15px; }
        .control-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; color: #aaa; font-size: 0.9em; }
        input[type="range"], select { width: 100%; }
        .value { float: right; color: #14b8a6; }
        button {
            width: 100%; padding: 10px; margin: 5px 0;
            border: none; border-radius: 8px;
            background: #14b8a6; color: white;
            font-weight: bold; cursor: pointer;
        }
        button:hover { background: #2dd4bf; }
        .stats { margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); }
        .stat-row { display: flex; justify-content: space-between; padding: 5px 0; font-size: 0.9em; }
        .stat-label { color: #888; }
        .stat-value { color: #14b8a6; font-weight: bold; }
        .info { font-size: 0.8em; color: #666; margin-top: 15px; line-height: 1.5; }
        a.back-link {
            position: fixed; top: 20px; left: 20px;
            color: #14b8a6; text-decoration: none;
            background: rgba(0,0,0,0.8); padding: 10px 20px;
            border-radius: 25px; font-size: 0.9em;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <a href="index.html" class="back-link">‚Üê Back to Sports Analytics</a>

    <div class="controls">
        <h1>Tournament Bracket</h1>
        <p style="font-size:0.85em; color:#888; margin-bottom:15px;">Knockout tournament simulation</p>

        <div class="control-group">
            <label>Tournament Size</label>
            <select id="tournamentSize">
                <option value="8">8 Teams</option>
                <option value="16" selected>16 Teams</option>
                <option value="32">32 Teams</option>
            </select>
        </div>

        <div class="control-group">
            <label>Seeding Method</label>
            <select id="seedMethod">
                <option value="random">Random</option>
                <option value="ranked">By Ranking</option>
                <option value="serpentine">Serpentine</option>
            </select>
        </div>

        <div class="control-group">
            <label>Upset Probability: <span class="value" id="upsetValue">0.3</span></label>
            <input type="range" id="upsetProb" min="0" max="0.5" step="0.05" value="0.3">
        </div>

        <button id="newBtn">New Tournament</button>
        <button id="simRoundBtn">Simulate Next Round</button>
        <button id="simAllBtn" style="background:#8b5cf6">Simulate All</button>

        <div class="stats">
            <div class="stat-row">
                <span class="stat-label">Current Round</span>
                <span class="stat-value" id="currentRound">Round 1</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Matches Played</span>
                <span class="stat-value" id="matchesPlayed">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Upsets</span>
                <span class="stat-value" id="upsets">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Champion</span>
                <span class="stat-value" id="champion">TBD</span>
            </div>
        </div>

        <div class="info">
            <strong>Seeding:</strong> Higher seeds face lower seeds.<br>
            <strong>Upset:</strong> Lower seed defeating higher seed.<br>
            <strong>Click team</strong> to see their path.
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resize();
        window.onresize = resize;

        let tournamentSize = 16;
        let seedMethod = 'ranked';
        let upsetProb = 0.3;
        let teams = [];
        let bracket = [];
        let currentRound = 0;
        let matchesPlayed = 0;
        let upsets = 0;
        let champion = null;
        let selectedTeam = null;

        const teamNames = [
            'Lions', 'Tigers', 'Bears', 'Wolves', 'Eagles', 'Hawks', 'Falcons', 'Ravens',
            'Sharks', 'Dolphins', 'Whales', 'Panthers', 'Cougars', 'Jaguars', 'Leopards', 'Cheetahs',
            'Dragons', 'Phoenix', 'Titans', 'Giants', 'Warriors', 'Knights', 'Spartans', 'Vikings',
            'Bulls', 'Rams', 'Stallions', 'Mustangs', 'Broncos', 'Colts', 'Chargers', 'Thunder'
        ];

        function createTeams() {
            teams = [];
            for (let i = 0; i < tournamentSize; i++) {
                teams.push({
                    id: i,
                    name: teamNames[i],
                    seed: i + 1,
                    rating: 100 - i * 2 + Math.random() * 10,
                    eliminated: false,
                    roundReached: 0
                });
            }

            // Apply seeding
            if (seedMethod === 'random') {
                teams.sort(() => Math.random() - 0.5);
                teams.forEach((t, i) => t.seed = i + 1);
            }
        }

        function createBracket() {
            bracket = [];
            currentRound = 0;
            matchesPlayed = 0;
            upsets = 0;
            champion = null;

            // Create first round matchups
            const firstRound = [];
            const numMatches = tournamentSize / 2;

            if (seedMethod === 'serpentine') {
                // 1v16, 8v9, 4v13, 5v12, 2v15, 7v10, 3v14, 6v11
                const order = [0, 15, 7, 8, 3, 12, 4, 11, 1, 14, 6, 9, 2, 13, 5, 10];
                for (let i = 0; i < numMatches; i++) {
                    firstRound.push({
                        team1: teams[order[i * 2] % tournamentSize],
                        team2: teams[order[i * 2 + 1] % tournamentSize],
                        winner: null,
                        played: false
                    });
                }
            } else {
                // Standard bracket: 1v16, 2v15, etc. or random pairs
                for (let i = 0; i < numMatches; i++) {
                    firstRound.push({
                        team1: teams[i],
                        team2: teams[tournamentSize - 1 - i],
                        winner: null,
                        played: false
                    });
                }
            }

            bracket.push(firstRound);

            // Create empty rounds
            let roundSize = numMatches / 2;
            while (roundSize >= 1) {
                const round = [];
                for (let i = 0; i < roundSize; i++) {
                    round.push({ team1: null, team2: null, winner: null, played: false });
                }
                bracket.push(round);
                roundSize /= 2;
            }
        }

        function simulateMatch(match) {
            if (!match.team1 || !match.team2 || match.played) return;

            const team1Chance = match.team1.rating / (match.team1.rating + match.team2.rating);
            const adjustedChance = team1Chance * (1 - upsetProb) + 0.5 * upsetProb;

            const team1Wins = Math.random() < adjustedChance;
            match.winner = team1Wins ? match.team1 : match.team2;
            match.played = true;
            matchesPlayed++;

            const loser = team1Wins ? match.team2 : match.team1;
            loser.eliminated = true;
            loser.roundReached = currentRound + 1;
            match.winner.roundReached = currentRound + 2;

            // Check for upset
            if ((team1Wins && match.team1.seed > match.team2.seed) ||
                (!team1Wins && match.team2.seed > match.team1.seed)) {
                upsets++;
            }
        }

        function simulateRound() {
            if (currentRound >= bracket.length) return;

            const round = bracket[currentRound];
            round.forEach(match => simulateMatch(match));

            // Advance winners to next round
            if (currentRound < bracket.length - 1) {
                const nextRound = bracket[currentRound + 1];
                for (let i = 0; i < round.length; i += 2) {
                    const matchIndex = Math.floor(i / 2);
                    if (matchIndex < nextRound.length) {
                        nextRound[matchIndex].team1 = round[i].winner;
                        if (i + 1 < round.length) {
                            nextRound[matchIndex].team2 = round[i + 1].winner;
                        }
                    }
                }
            }

            currentRound++;

            // Check for champion
            if (currentRound === bracket.length) {
                champion = bracket[bracket.length - 1][0].winner;
            }

            updateStats();
        }

        function updateStats() {
            const roundNames = ['Round 1', 'Round 2', 'Quarter-Finals', 'Semi-Finals', 'Final', 'Complete'];
            const roundIndex = Math.min(currentRound, roundNames.length - 1);
            document.getElementById('currentRound').textContent = roundNames[roundIndex];
            document.getElementById('matchesPlayed').textContent = matchesPlayed;
            document.getElementById('upsets').textContent = upsets;
            document.getElementById('champion').textContent = champion ? champion.name : 'TBD';
        }

        function draw() {
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = '#fff';
            ctx.font = 'bold 24px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Tournament Bracket', canvas.width / 2 - 100, 40);

            if (bracket.length === 0) {
                requestAnimationFrame(draw);
                return;
            }

            const numRounds = bracket.length;
            const bracketWidth = canvas.width - 400;
            const bracketHeight = canvas.height - 100;
            const roundWidth = bracketWidth / numRounds;

            const matchHeight = 50;
            const matchWidth = roundWidth - 20;

            // Draw each round
            for (let r = 0; r < numRounds; r++) {
                const round = bracket[r];
                const matchesInRound = round.length;
                const verticalSpacing = bracketHeight / matchesInRound;

                const x = 50 + r * roundWidth;

                // Round label
                const roundNames = ['R1', 'R2', 'QF', 'SF', 'Final'];
                ctx.fillStyle = '#888';
                ctx.font = '12px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(roundNames[r] || `R${r + 1}`, x + matchWidth / 2, 70);

                for (let m = 0; m < matchesInRound; m++) {
                    const match = round[m];
                    const y = 80 + m * verticalSpacing + verticalSpacing / 2 - matchHeight / 2;

                    // Match box
                    ctx.fillStyle = 'rgba(20, 184, 166, 0.1)';
                    ctx.fillRect(x, y, matchWidth, matchHeight);
                    ctx.strokeStyle = '#14b8a6';
                    ctx.lineWidth = 1;
                    ctx.strokeRect(x, y, matchWidth, matchHeight);

                    // Team 1
                    if (match.team1) {
                        const isWinner = match.winner === match.team1;
                        const isLoser = match.played && !isWinner;
                        const isSelected = selectedTeam === match.team1.id;

                        ctx.fillStyle = isSelected ? '#14b8a6' : (isLoser ? '#666' : '#fff');
                        ctx.font = isWinner ? 'bold 11px sans-serif' : '11px sans-serif';
                        ctx.textAlign = 'left';
                        ctx.fillText(`${match.team1.seed}. ${match.team1.name}`, x + 5, y + 18);
                    }

                    // Team 2
                    if (match.team2) {
                        const isWinner = match.winner === match.team2;
                        const isLoser = match.played && !isWinner;
                        const isSelected = selectedTeam === match.team2.id;

                        ctx.fillStyle = isSelected ? '#14b8a6' : (isLoser ? '#666' : '#fff');
                        ctx.font = isWinner ? 'bold 11px sans-serif' : '11px sans-serif';
                        ctx.textAlign = 'left';
                        ctx.fillText(`${match.team2.seed}. ${match.team2.name}`, x + 5, y + 38);
                    }

                    // Divider
                    ctx.strokeStyle = '#333';
                    ctx.beginPath();
                    ctx.moveTo(x, y + matchHeight / 2);
                    ctx.lineTo(x + matchWidth, y + matchHeight / 2);
                    ctx.stroke();

                    // Connect to next round
                    if (r < numRounds - 1) {
                        const nextM = Math.floor(m / 2);
                        const nextVertSpacing = bracketHeight / bracket[r + 1].length;
                        const nextY = 80 + nextM * nextVertSpacing + nextVertSpacing / 2;

                        ctx.strokeStyle = 'rgba(20, 184, 166, 0.3)';
                        ctx.beginPath();
                        ctx.moveTo(x + matchWidth, y + matchHeight / 2);
                        ctx.lineTo(x + matchWidth + 10, y + matchHeight / 2);
                        ctx.lineTo(x + matchWidth + 10, nextY);
                        ctx.lineTo(x + roundWidth, nextY);
                        ctx.stroke();
                    }
                }
            }

            // Draw champion
            if (champion) {
                const trophyX = 50 + (numRounds - 0.5) * roundWidth;
                const trophyY = canvas.height / 2;

                ctx.fillStyle = '#fbbf24';
                ctx.font = '40px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('üèÜ', trophyX, trophyY - 20);

                ctx.fillStyle = '#14b8a6';
                ctx.font = 'bold 16px sans-serif';
                ctx.fillText(champion.name, trophyX, trophyY + 20);
                ctx.fillStyle = '#888';
                ctx.font = '12px sans-serif';
                ctx.fillText('CHAMPION', trophyX, trophyY + 40);
            }

            requestAnimationFrame(draw);
        }

        // Event listeners
        document.getElementById('tournamentSize').onchange = (e) => {
            tournamentSize = parseInt(e.target.value);
            createTeams();
            createBracket();
            updateStats();
        };

        document.getElementById('seedMethod').onchange = (e) => {
            seedMethod = e.target.value;
            createTeams();
            createBracket();
            updateStats();
        };

        document.getElementById('upsetProb').oninput = (e) => {
            upsetProb = parseFloat(e.target.value);
            document.getElementById('upsetValue').textContent = upsetProb.toFixed(2);
        };

        document.getElementById('newBtn').onclick = () => {
            createTeams();
            createBracket();
            updateStats();
        };

        document.getElementById('simRoundBtn').onclick = simulateRound;

        document.getElementById('simAllBtn').onclick = () => {
            while (currentRound < bracket.length) {
                simulateRound();
            }
        };

        // Initialize
        createTeams();
        createBracket();
        updateStats();
        draw();
    </script>
</body>
</html>
