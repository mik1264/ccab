<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aizawa Attractor - GPU Accelerated</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            overflow: hidden;
            background: #000;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        canvas {
            display: block;
            width: 100vw;
            height: 100vh;
        }

        .info {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            font-size: 14px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
            z-index: 10;
        }

        .info h1 {
            font-size: 24px;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .info p {
            margin: 4px 0;
            opacity: 0.9;
        }

        .tech-badge {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(102, 126, 234, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(102, 126, 234, 0.3);
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-size: 12px;
            text-align: center;
            z-index: 10;
        }

        .controls {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            color: white;
            font-size: 12px;
            min-width: 200px;
            z-index: 10;
            max-height: 80vh;
            overflow-y: auto;
        }

        .controls label {
            display: block;
            margin: 8px 0 4px 0;
            opacity: 0.8;
        }

        .controls input[type="range"] {
            width: 100%;
        }

        .controls .value {
            float: right;
            color: #667eea;
        }
    </style>
</head>
<body>
    <div class="info">
        <h1>Aizawa Attractor</h1>
        <p>Complex 3D chaotic system with intricate geometry</p>
        <p>Drag to rotate • Scroll to zoom</p>
    </div>

    <div class="controls">
        <label>a: <span class="value" id="a-val">0.95</span></label>
        <input type="range" id="a" min="0.5" max="1.5" step="0.01" value="0.95">

        <label>b: <span class="value" id="b-val">0.70</span></label>
        <input type="range" id="b" min="0.3" max="1.0" step="0.01" value="0.7">

        <label>c: <span class="value" id="c-val">0.60</span></label>
        <input type="range" id="c" min="0.3" max="1.0" step="0.01" value="0.6">

        <label>d: <span class="value" id="d-val">3.50</span></label>
        <input type="range" id="d" min="2.5" max="4.5" step="0.1" value="3.5">

        <label>e: <span class="value" id="e-val">0.25</span></label>
        <input type="range" id="e" min="0.1" max="0.5" step="0.01" value="0.25">

        <label>f: <span class="value" id="f-val">0.10</span></label>
        <input type="range" id="f" min="0.05" max="0.2" step="0.01" value="0.1">

        <label>Speed: <span class="value" id="speed-val">1.0</span></label>
        <input type="range" id="speed" min="0.1" max="3" step="0.1" value="1">
    </div>

    <div class="tech-badge">
        GPU-Accelerated • Three.js TSL • Chaotic Dynamics
    </div>

    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.169.0/build/three.module.js",
            "three/webgpu": "https://unpkg.com/three@0.169.0/build/three.webgpu.js",
            "three/tsl": "https://unpkg.com/three@0.169.0/build/three.webgpu.js",
            "three/addons/": "https://unpkg.com/three@0.169.0/examples/jsm/"
        }
    }
    </script>

    <script type="module">
        import * as THREE from 'three/webgpu';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // Scene setup
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x000000);
        scene.fog = new THREE.Fog(0x000000, 5, 20);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(3, 2, 3);

        const renderer = await new THREE.WebGPURenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        document.body.appendChild(renderer.domElement);

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.minDistance = 2;
        controls.maxDistance = 30;

        // Parameters
        let params = {
            a: 0.95,
            b: 0.7,
            c: 0.6,
            d: 3.5,
            e: 0.25,
            f: 0.1,
            dt: 0.01,
            speed: 1.0
        };

        // Storage for particle trails
        const numParticles = 12;
        const trailLength = 3000;

        const lines = [];
        for (let i = 0; i < numParticles; i++) {
            const lineGeometry = new THREE.BufferGeometry();
            const linePositions = new Float32Array(trailLength * 3);
            const lineColors = new Float32Array(trailLength * 3);

            // Rich color gradient based on position in trail
            const baseHue = (i / numParticles) * 360;
            for (let j = 0; j < trailLength; j++) {
                const t = j / trailLength;
                const idx = j * 3;

                const hue = (baseHue + t * 60) % 360;
                const saturation = 80 + t * 20;
                const lightness = 40 + t * 30;

                const color = new THREE.Color().setHSL(hue / 360, saturation / 100, lightness / 100);
                lineColors[idx] = color.r;
                lineColors[idx + 1] = color.g;
                lineColors[idx + 2] = color.b;
            }

            lineGeometry.setAttribute('position', new THREE.BufferAttribute(linePositions, 3));
            lineGeometry.setAttribute('color', new THREE.BufferAttribute(lineColors, 3));

            const material = new THREE.LineBasicMaterial({
                vertexColors: true,
                transparent: true,
                opacity: 0.5,
                blending: THREE.AdditiveBlending
            });

            const line = new THREE.Line(lineGeometry, material);
            scene.add(line);

            lines.push({
                geometry: lineGeometry,
                positions: linePositions,
                currentPos: [
                    0.1 + (Math.random() - 0.5) * 0.1,
                    (Math.random() - 0.5) * 0.1,
                    (Math.random() - 0.5) * 0.1
                ],
                index: 0
            });
        }

        // Add dynamic lighting
        const light1 = new THREE.PointLight(0x667eea, 1.5, 15);
        light1.position.set(2, 2, 2);
        scene.add(light1);

        const light2 = new THREE.PointLight(0xf093fb, 1.5, 15);
        light2.position.set(-2, -2, -2);
        scene.add(light2);

        const light3 = new THREE.PointLight(0x4facfe, 1.5, 15);
        light3.position.set(0, 2, -2);
        scene.add(light3);

        const ambientLight = new THREE.AmbientLight(0x303030);
        scene.add(ambientLight);

        // Aizawa attractor computation
        function aizawaStep(pos, dt) {
            const [x, y, z] = pos;
            const { a, b, c, d, e, f } = params;

            const dx = (z - b) * x - d * y;
            const dy = d * x + (z - b) * y;
            const dz = c + a * z - (z * z * z) / 3 - (x * x + y * y) * (1 + e * z) + f * z * x * x * x;

            return [
                x + dx * dt,
                y + dy * dt,
                z + dz * dt
            ];
        }

        // Animation loop
        function animate() {
            const stepsPerFrame = Math.floor(10 * params.speed);

            for (let step = 0; step < stepsPerFrame; step++) {
                lines.forEach((line) => {
                    // Compute next position
                    line.currentPos = aizawaStep(line.currentPos, params.dt);

                    // Add to trail
                    const idx = (line.index % trailLength) * 3;
                    line.positions[idx] = line.currentPos[0];
                    line.positions[idx + 1] = line.currentPos[1];
                    line.positions[idx + 2] = line.currentPos[2];

                    line.index++;

                    if (step % 5 === 0 && line.index > 2) {
                        line.geometry.attributes.position.needsUpdate = true;
                        line.geometry.setDrawRange(0, Math.min(line.index, trailLength));
                    }
                });
            }

            // Animate lights
            const time = Date.now() * 0.001;
            light1.position.x = Math.sin(time * 0.3) * 2;
            light1.position.z = Math.cos(time * 0.3) * 2;

            light2.position.x = Math.cos(time * 0.4) * 2;
            light2.position.y = Math.sin(time * 0.5) * 2;

            light3.position.y = Math.sin(time * 0.2) * 2;
            light3.position.z = Math.cos(time * 0.25) * 2;

            controls.update();
            renderer.render(scene, camera);
        }

        renderer.setAnimationLoop(animate);

        // Controls
        const controlInputs = ['a', 'b', 'c', 'd', 'e', 'f', 'speed'];
        controlInputs.forEach(id => {
            document.getElementById(id).addEventListener('input', (e) => {
                const value = parseFloat(e.target.value);
                if (id === 'speed') {
                    params.speed = value;
                } else {
                    params[id] = value;
                }
                const decimals = id === 'd' ? 2 : (id === 'speed' ? 1 : 2);
                document.getElementById(`${id}-val`).textContent = value.toFixed(decimals);
            });
        });

        // Handle window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
    <script src="../../assets/js/enhance.js" defer></script>
</body>
</html>
