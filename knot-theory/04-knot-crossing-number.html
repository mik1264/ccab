<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Knot Crossing Numbers</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow-y: auto; font-family: 'Segoe UI', Tahoma, sans-serif; color: #c8d8ff; }

#header {
    text-align: center; padding: 80px 20px 30px;
}
#header h1 { color: #8af; font-size: 1.8em; margin-bottom: 8px; }
#header p { font-size: 0.9em; opacity: 0.75; max-width: 600px; margin: 0 auto; line-height: 1.5; }

#table {
    display: flex; flex-direction: column; align-items: center; padding: 20px;
    max-width: 900px; margin: 0 auto;
}
.crossing-group {
    width: 100%; margin-bottom: 30px;
}
.crossing-group h2 {
    color: #ffda6e; font-size: 1em; margin-bottom: 12px;
    border-bottom: 1px solid rgba(138,170,255,0.15); padding-bottom: 6px;
}
.knot-grid {
    display: flex; flex-wrap: wrap; gap: 12px;
}
.knot-card {
    background: rgba(10, 14, 30, 0.7); backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(138, 170, 255, 0.15); border-radius: 10px;
    padding: 10px; cursor: pointer; transition: all 0.3s;
    display: flex; flex-direction: column; align-items: center;
    width: 120px;
}
.knot-card:hover, .knot-card.active {
    border-color: #8af; box-shadow: 0 0 15px rgba(138,170,255,0.3);
    transform: translateY(-2px);
}
.knot-card canvas { border-radius: 6px; margin-bottom: 6px; }
.knot-card .kname { font-size: 0.8em; color: #8af; font-weight: bold; }
.knot-card .kprops { font-size: 0.7em; opacity: 0.65; margin-top: 2px; }

#viewer {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(5, 8, 20, 0.95); z-index: 200; display: none;
    justify-content: center; align-items: center; flex-direction: column;
}
#viewer.show { display: flex; }
#viewerCanvas { border-radius: 12px; }
#viewerInfo {
    position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%);
    background: rgba(10, 14, 30, 0.85); backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(138, 170, 255, 0.2); border-radius: 12px;
    padding: 16px 28px; text-align: center; max-width: 400px;
}
#viewerInfo h3 { color: #8af; margin-bottom: 4px; }
#viewerInfo p { font-size: 0.85em; opacity: 0.8; }
#viewerClose {
    position: absolute; top: 20px; right: 30px; color: #8af;
    font-size: 2em; cursor: pointer; z-index: 210; background: none; border: none;
}
#viewerClose:hover { color: #fff; }
.stat { color: #ffda6e; font-weight: bold; }

#badProjection {
    max-width: 900px; margin: 10px auto 40px; padding: 20px;
    background: rgba(10,14,30,0.7); border: 1px solid rgba(138,170,255,0.15);
    border-radius: 12px; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
}
#badProjection h3 { color: #ff6e8a; margin-bottom: 8px; font-size: 0.95em; }
#badProjection p { font-size: 0.82em; opacity: 0.8; line-height: 1.5; }
</style>
</head>
<body>
<a href="index.html" style="position:fixed;top:20px;left:20px;color:#8af;text-decoration:none;z-index:100;font-size:1.2em">&#8592; Back</a>

<div id="header">
    <h1>The Knot Table</h1>
    <p>Prime knots organized by their minimum crossing number. The crossing number is the fewest crossings in any diagram of the knot. Click any knot to view it in 3D.</p>
</div>

<div id="table"></div>

<div id="badProjection">
    <h3>Bad Projections Have MORE Crossings</h3>
    <p>The crossing number is the <span class="stat">minimum</span> over all possible diagrams. A trefoil has crossing number 3, but you can draw it with 5, 7, or more crossings if you choose a bad projection. The crossing number captures the intrinsic complexity of the knot.</p>
    <canvas id="badProjCanvas" width="300" height="120" style="margin-top:10px;border-radius:8px;"></canvas>
</div>

<div id="viewer">
    <button id="viewerClose" onclick="closeViewer()">&times;</button>
    <canvas id="viewerCanvas" width="500" height="500"></canvas>
    <div id="viewerInfo">
        <h3 id="vName"></h3>
        <p id="vDesc"></p>
        <p>Crossing number: <span class="stat" id="vCross"></span></p>
    </div>
</div>

<script>
const KNOTS = [
    { name: '0\u2081 (Unknot)', crossing: 0, desc: 'The trivial knot',
      fn: t => ({ x: Math.cos(t) * 100, y: Math.sin(t) * 100, z: 15 * Math.sin(t) }) },
    { name: '3\u2081 (Trefoil)', crossing: 3, desc: 'Simplest non-trivial knot. (2,3)-torus knot.',
      fn: t => ({ x: (Math.sin(t) + 2 * Math.sin(2 * t)) * 65, y: (Math.cos(t) - 2 * Math.cos(2 * t)) * 65, z: -Math.sin(3 * t) * 65 }) },
    { name: '4\u2081 (Figure-Eight)', crossing: 4, desc: 'The unique 4-crossing knot. Amphichiral.',
      fn: t => ({ x: (2 + Math.cos(2 * t)) * Math.cos(3 * t) * 42, y: (2 + Math.cos(2 * t)) * Math.sin(3 * t) * 42, z: Math.sin(4 * t) * 50 }) },
    { name: '5\u2081 (Cinquefoil)', crossing: 5, desc: '(2,5)-torus knot with five-fold symmetry.',
      fn: t => ({ x: (Math.sin(t) + 2 * Math.sin(2 * t)) * 60, y: (Math.cos(t) - 2 * Math.cos(2 * t)) * 60, z: -Math.sin(5 * t) * 45 }) },
    { name: '5\u2082 (Three-Twist)', crossing: 5, desc: 'A twist knot. Hyperbolic.',
      fn: t => { const r = 85 + 35 * Math.cos(3 * t); return { x: r * Math.cos(2 * t) * 0.7, y: r * Math.sin(2 * t) * 0.7, z: Math.sin(5 * t) * 50 }; } },
    { name: '6\u2081 (Stevedore)', crossing: 6, desc: 'A twist knot used by dock workers.',
      fn: t => { const r = 90 + 40 * Math.cos(4 * t); return { x: r * Math.cos(2 * t) * 0.65, y: r * Math.sin(2 * t) * 0.65, z: Math.sin(6 * t) * 45 }; } },
    { name: '6\u2082', crossing: 6, desc: 'Second prime knot with 6 crossings.',
      fn: t => { const r = 80 + 45 * Math.cos(3 * t); return { x: r * Math.cos(2.5 * t) * 0.65, y: r * Math.sin(2.5 * t) * 0.65, z: Math.sin(6 * t) * 50 }; } },
    { name: '6\u2083', crossing: 6, desc: 'Third prime knot with 6 crossings.',
      fn: t => ({ x: (2.2 + Math.cos(3 * t)) * Math.cos(2 * t) * 42, y: (2.2 + Math.cos(3 * t)) * Math.sin(2 * t) * 42, z: Math.sin(6 * t) * 48 }) },
    { name: '7\u2081', crossing: 7, desc: 'A (2,7)-torus knot.',
      fn: t => ({ x: (Math.sin(t) + 2 * Math.sin(2 * t)) * 55, y: (Math.cos(t) - 2 * Math.cos(2 * t)) * 55, z: -Math.sin(7 * t) * 40 }) },
    { name: '7\u2082', crossing: 7, desc: 'Second prime knot with 7 crossings.',
      fn: t => { const r = 80 + 40 * Math.cos(4 * t); return { x: r * Math.cos(2 * t) * 0.6, y: r * Math.sin(2 * t) * 0.6, z: Math.sin(7 * t) * 45 }; } },
    { name: '7\u2083', crossing: 7, desc: 'Third prime knot with 7 crossings.',
      fn: t => ({ x: (2 + Math.cos(2.5 * t)) * Math.cos(3 * t) * 38, y: (2 + Math.cos(2.5 * t)) * Math.sin(3 * t) * 38, z: Math.sin(7 * t) * 42 }) },
    { name: '7\u2084', crossing: 7, desc: 'Fourth prime knot with 7 crossings.',
      fn: t => { const r = 85 + 35 * Math.cos(5 * t); return { x: r * Math.cos(2 * t) * 0.58, y: r * Math.sin(2 * t) * 0.58, z: Math.sin(7 * t) * 40 }; } },
    { name: '7\u2085', crossing: 7, desc: 'Fifth prime knot with 7 crossings.',
      fn: t => ({ x: (2.1 + Math.cos(3 * t)) * Math.cos(2.5 * t) * 36, y: (2.1 + Math.cos(3 * t)) * Math.sin(2.5 * t) * 36, z: Math.sin(7 * t) * 44 }) },
    { name: '7\u2086', crossing: 7, desc: 'Sixth prime knot with 7 crossings.',
      fn: t => { const r = 75 + 45 * Math.cos(3.5 * t); return { x: r * Math.cos(2 * t) * 0.6, y: r * Math.sin(2 * t) * 0.6, z: Math.sin(7 * t) * 42 }; } },
    { name: '7\u2087', crossing: 7, desc: 'Seventh prime knot with 7 crossings.',
      fn: t => ({ x: (2.3 + Math.cos(4 * t)) * Math.cos(2 * t) * 35, y: (2.3 + Math.cos(4 * t)) * Math.sin(2 * t) * 35, z: Math.sin(7 * t) * 46 }) },
];

// Group by crossing number
const groups = {};
for (const k of KNOTS) {
    if (!groups[k.crossing]) groups[k.crossing] = [];
    groups[k.crossing].push(k);
}

const tableDiv = document.getElementById('table');

function drawKnotDiagram(canvas, knot, size) {
    const tctx = canvas.getContext('2d');
    tctx.fillStyle = '#0c1020';
    tctx.fillRect(0, 0, size, size);

    const N = 250;
    const segments = [];
    for (let i = 0; i < N; i++) {
        const t0 = (i / N) * Math.PI * 2;
        const t1 = ((i + 1) / N) * Math.PI * 2;
        const p0 = knot.fn(t0);
        const p1 = knot.fn(t1);
        const scale = (size - 20) / 250;
        segments.push({
            x0: size / 2 + p0.x * scale, y0: size / 2 + p0.y * scale,
            x1: size / 2 + p1.x * scale, y1: size / 2 + p1.y * scale,
            z: (p0.z + p1.z) / 2, t: t0
        });
    }

    segments.sort((a, b) => a.z - b.z);

    for (const seg of segments) {
        const depthF = 0.4 + 0.6 * ((seg.z + 100) / 200);
        const hue = (seg.t / (Math.PI * 2)) * 360;

        tctx.strokeStyle = '#0c1020';
        tctx.lineWidth = size > 90 ? 5 : 3.5;
        tctx.lineCap = 'round';
        tctx.beginPath(); tctx.moveTo(seg.x0, seg.y0); tctx.lineTo(seg.x1, seg.y1); tctx.stroke();

        tctx.strokeStyle = `hsl(${hue}, 70%, ${depthF * 55}%)`;
        tctx.lineWidth = size > 90 ? 3 : 2;
        tctx.beginPath(); tctx.moveTo(seg.x0, seg.y0); tctx.lineTo(seg.x1, seg.y1); tctx.stroke();
    }
}

for (const cn of Object.keys(groups).sort((a, b) => a - b)) {
    const group = document.createElement('div');
    group.className = 'crossing-group';
    group.innerHTML = `<h2>${cn} Crossing${cn !== '1' ? 's' : ''} (${groups[cn].length} knot${groups[cn].length > 1 ? 's' : ''})</h2>`;

    const grid = document.createElement('div');
    grid.className = 'knot-grid';

    groups[cn].forEach((knot, idx) => {
        const card = document.createElement('div');
        card.className = 'knot-card';

        const cv = document.createElement('canvas');
        cv.width = 90; cv.height = 90;
        drawKnotDiagram(cv, knot, 90);
        card.appendChild(cv);

        const nameEl = document.createElement('div');
        nameEl.className = 'kname';
        nameEl.textContent = knot.name;
        card.appendChild(nameEl);

        card.addEventListener('click', () => openViewer(knot));
        grid.appendChild(card);
    });

    group.appendChild(grid);
    tableDiv.appendChild(group);
}

// Bad projection example
const badCanvas = document.getElementById('badProjCanvas');
const bctx = badCanvas.getContext('2d');
bctx.fillStyle = '#0c1020';
bctx.fillRect(0, 0, 300, 120);
// Draw a "good" trefoil (3 crossings)
bctx.fillStyle = '#8af';
bctx.font = '11px sans-serif';
bctx.fillText('3 crossings (minimal)', 10, 110);
const trefoilFn = t => ({ x: (Math.sin(t) + 2 * Math.sin(2 * t)) * 22, y: (Math.cos(t) - 2 * Math.cos(2 * t)) * 22, z: -Math.sin(3 * t) * 22 });
const N = 200;
for (let i = 0; i < N; i++) {
    const t = (i / N) * Math.PI * 2;
    const t2 = ((i + 1) / N) * Math.PI * 2;
    const p0 = trefoilFn(t), p1 = trefoilFn(t2);
    const depthF = 0.4 + 0.6 * ((p0.z + 30) / 60);
    bctx.strokeStyle = `hsl(${(t / (Math.PI * 2)) * 360}, 70%, ${depthF * 55}%)`;
    bctx.lineWidth = 2.5;
    bctx.beginPath();
    bctx.moveTo(70 + p0.x, 50 + p0.y);
    bctx.lineTo(70 + p1.x, 50 + p1.y);
    bctx.stroke();
}
// Draw a "bad" projection (rotated to show more crossings)
bctx.fillStyle = '#ff6e8a';
bctx.fillText('5+ crossings (bad projection)', 155, 110);
for (let i = 0; i < N; i++) {
    const t = (i / N) * Math.PI * 2;
    const t2 = ((i + 1) / N) * Math.PI * 2;
    let p0 = trefoilFn(t), p1 = trefoilFn(t2);
    // Rotate to a bad angle
    const a = 0.8;
    const nx0 = p0.x, nz0 = p0.x * Math.sin(a) + p0.z * Math.cos(a);
    const nx1 = p1.x, nz1 = p1.x * Math.sin(a) + p1.z * Math.cos(a);
    p0 = { x: nx0 * Math.cos(a) + p0.z * Math.sin(a), y: p0.y, z: nz0 };
    p1 = { x: nx1 * Math.cos(a) + p1.z * Math.sin(a), y: p1.y, z: nz1 };
    const depthF = 0.4 + 0.6 * ((p0.z + 30) / 60);
    bctx.strokeStyle = `hsl(${(t / (Math.PI * 2)) * 60}, 80%, ${depthF * 50}%)`;
    bctx.lineWidth = 2.5;
    bctx.beginPath();
    bctx.moveTo(230 + p0.x, 50 + p0.y);
    bctx.lineTo(230 + p1.x, 50 + p1.y);
    bctx.stroke();
}

// 3D Viewer
const viewerEl = document.getElementById('viewer');
const vCanvas = document.getElementById('viewerCanvas');
const vCtx = vCanvas.getContext('2d');
let viewerKnot = null;
let viewerRot = 0;
let viewerRotX = 0.3;
let viewerDrag = false, vLastMX = 0, vLastMY = 0;
let viewerUserRotY = 0, viewerUserRotX = 0.3;
let viewerAnimId = null;

function openViewer(knot) {
    viewerKnot = knot;
    viewerEl.classList.add('show');
    document.getElementById('vName').textContent = knot.name;
    document.getElementById('vDesc').textContent = knot.desc;
    document.getElementById('vCross').textContent = knot.crossing;
    viewerRot = 0;
    viewerUserRotY = 0;
    viewerUserRotX = 0.3;
    if (!viewerAnimId) viewerAnimate();
}

function closeViewer() {
    viewerEl.classList.remove('show');
    viewerKnot = null;
    if (viewerAnimId) { cancelAnimationFrame(viewerAnimId); viewerAnimId = null; }
}

vCanvas.addEventListener('mousedown', e => { viewerDrag = true; vLastMX = e.clientX; vLastMY = e.clientY; });
window.addEventListener('mousemove', e => {
    if (!viewerDrag) return;
    viewerUserRotY += (e.clientX - vLastMX) * 0.005;
    viewerUserRotX += (e.clientY - vLastMY) * 0.005;
    viewerUserRotX = Math.max(-1.2, Math.min(1.2, viewerUserRotX));
    vLastMX = e.clientX; vLastMY = e.clientY;
});
window.addEventListener('mouseup', () => viewerDrag = false);

vCanvas.addEventListener('touchstart', e => {
    viewerDrag = true; vLastMX = e.touches[0].clientX; vLastMY = e.touches[0].clientY;
}, { passive: true });
window.addEventListener('touchmove', e => {
    if (!viewerDrag) return;
    viewerUserRotY += (e.touches[0].clientX - vLastMX) * 0.005;
    viewerUserRotX += (e.touches[0].clientY - vLastMY) * 0.005;
    viewerUserRotX = Math.max(-1.2, Math.min(1.2, viewerUserRotX));
    vLastMX = e.touches[0].clientX; vLastMY = e.touches[0].clientY;
}, { passive: true });
window.addEventListener('touchend', () => viewerDrag = false);

function rotYA(x, y, z, a) { return { x: x * Math.cos(a) + z * Math.sin(a), y, z: -x * Math.sin(a) + z * Math.cos(a) }; }
function rotXA(x, y, z, a) { return { x, y: y * Math.cos(a) - z * Math.sin(a), z: y * Math.sin(a) + z * Math.cos(a) }; }

function viewerAnimate() {
    if (!viewerKnot) return;
    viewerRot += 0.01;
    const sz = 500;
    const FOV = 400;
    vCtx.fillStyle = '#080c18';
    vCtx.fillRect(0, 0, sz, sz);

    const ry = viewerRot + viewerUserRotY;
    const rx = viewerUserRotX;
    const segments = [];
    const VN = 400;

    for (let i = 0; i < VN; i++) {
        const t0 = (i / VN) * Math.PI * 2;
        const t1 = ((i + 1) / VN) * Math.PI * 2;
        const p0 = viewerKnot.fn(t0);
        const p1 = viewerKnot.fn(t1);

        let r0 = rotYA(p0.x, p0.y, p0.z, ry); r0 = rotXA(r0.x, r0.y, r0.z, rx);
        let r1 = rotYA(p1.x, p1.y, p1.z, ry); r1 = rotXA(r1.x, r1.y, r1.z, rx);

        const sc0 = FOV / (FOV + r0.z), sc1 = FOV / (FOV + r1.z);
        segments.push({
            x0: sz / 2 + r0.x * sc0, y0: sz / 2 + r0.y * sc0,
            x1: sz / 2 + r1.x * sc1, y1: sz / 2 + r1.y * sc1,
            avgZ: (r0.z + r1.z) / 2, sc: (sc0 + sc1) / 2, t: t0
        });
    }

    segments.sort((a, b) => b.avgZ - a.avgZ);

    for (const seg of segments) {
        const depthF = 0.4 + 0.6 * ((seg.avgZ + 150) / 300);
        const hue = (seg.t / (Math.PI * 2)) * 360;
        const color = `hsl(${hue}, 80%, ${depthF * 55}%)`;
        const w = 10 * seg.sc;

        vCtx.save();
        vCtx.shadowBlur = 14;
        vCtx.shadowColor = color;
        vCtx.strokeStyle = color;
        vCtx.lineWidth = w + 3;
        vCtx.globalAlpha = 0.2;
        vCtx.beginPath(); vCtx.moveTo(seg.x0, seg.y0); vCtx.lineTo(seg.x1, seg.y1); vCtx.stroke();
        vCtx.restore();

        vCtx.strokeStyle = '#050810';
        vCtx.lineWidth = w + 3;
        vCtx.lineCap = 'round';
        vCtx.beginPath(); vCtx.moveTo(seg.x0, seg.y0); vCtx.lineTo(seg.x1, seg.y1); vCtx.stroke();

        vCtx.strokeStyle = color;
        vCtx.lineWidth = w;
        vCtx.lineCap = 'round';
        vCtx.beginPath(); vCtx.moveTo(seg.x0, seg.y0); vCtx.lineTo(seg.x1, seg.y1); vCtx.stroke();
    }

    viewerAnimId = requestAnimationFrame(viewerAnimate);
}

document.addEventListener('keydown', e => {
    if (e.key === 'Escape' && viewerEl.classList.contains('show')) closeViewer();
});

window.reset = function() {
    closeViewer();
    window.scrollTo(0, 0);
};
</script>
<script src="../assets/js/enhance.js"></script>
</body>
</html>
