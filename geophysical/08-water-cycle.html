<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water Cycle Simulation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0a0e1a;
            color: #e0e0e0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
        }

        #canvas {
            display: block;
            width: 100vw;
            height: 100vh;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #8A9A5B;
            text-decoration: none;
            font-size: 18px;
            font-weight: 600;
            z-index: 100;
            background: rgba(10, 14, 26, 0.8);
            padding: 10px 20px;
            border-radius: 8px;
            border: 2px solid #8A9A5B;
            transition: all 0.3s;
        }

        .back-link:hover {
            background: #8A9A5B;
            color: #0a0e1a;
            transform: translateX(-5px);
        }

        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(10, 14, 26, 0.9);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #606C38;
            z-index: 100;
            max-width: 300px;
        }

        .controls h3 {
            color: #DDA15E;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            color: #8A9A5B;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .control-group input[type="range"] {
            width: 100%;
            cursor: pointer;
        }

        .control-group .value {
            color: #DDA15E;
            font-weight: bold;
            font-size: 14px;
        }

        .info {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(10, 14, 26, 0.9);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #BC6C25;
            max-width: 400px;
            z-index: 100;
        }

        .info h3 {
            color: #DDA15E;
            margin-bottom: 10px;
        }

        .info p {
            line-height: 1.6;
            font-size: 14px;
            color: #e0e0e0;
        }

        .stats {
            margin-top: 10px;
            font-size: 12px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .stat-item {
            background: rgba(138, 154, 91, 0.2);
            padding: 8px;
            border-radius: 6px;
        }

        .stat-label {
            color: #8A9A5B;
            font-size: 11px;
        }

        .stat-value {
            color: #DDA15E;
            font-weight: bold;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Geophysical</a>

    <canvas id="canvas"></canvas>

    <div class="controls">
        <h3>Water Cycle Controls</h3>

        <div class="control-group">
            <label>Solar Energy: <span class="value" id="solarValue">100%</span></label>
            <input type="range" id="solar" min="0" max="200" step="10" value="100">
        </div>

        <div class="control-group">
            <label>Temperature: <span class="value" id="tempValue">20°C</span></label>
            <input type="range" id="temperature" min="0" max="40" step="1" value="20">
        </div>

        <div class="control-group">
            <label>Wind Speed: <span class="value" id="windValue">1.0x</span></label>
            <input type="range" id="wind" min="0" max="3" step="0.1" value="1">
        </div>
    </div>

    <div class="info">
        <h3>The Water Cycle</h3>
        <p>Follow water molecules through evaporation from oceans, condensation into clouds, precipitation as rain, and runoff back to the ocean.</p>
        <div class="stats">
            <div class="stat-item">
                <div class="stat-label">Ocean Water</div>
                <div class="stat-value"><span id="oceanStat">0</span></div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Atmosphere</div>
                <div class="stat-value"><span id="atmStat">0</span></div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Precipitation</div>
                <div class="stat-value"><span id="rainStat">0</span></div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Groundwater</div>
                <div class="stat-value"><span id="groundStat">0</span></div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let width, height;

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        resize();
        window.addEventListener('resize', resize);

        // Water molecule states
        const OCEAN = 0;
        const EVAPORATING = 1;
        const VAPOR = 2;
        const CLOUD = 3;
        const RAIN = 4;
        const GROUNDWATER = 5;
        const RUNOFF = 6;

        class WaterMolecule {
            constructor(x, y, state) {
                this.x = x;
                this.y = y;
                this.state = state;
                this.vx = 0;
                this.vy = 0;
                this.life = 0;
                this.size = 2;
            }

            update(solarEnergy, temperature, windSpeed) {
                switch (this.state) {
                    case OCEAN:
                        // Chance to evaporate
                        if (Math.random() < solarEnergy * temperature * 0.00001) {
                            this.state = EVAPORATING;
                            this.vy = -1 - Math.random();
                            this.life = 100;
                        }
                        break;

                    case EVAPORATING:
                        this.vy -= 0.05;
                        this.x += (Math.random() - 0.5) * 0.5;
                        this.y += this.vy;
                        this.life--;

                        if (this.life <= 0 || this.y < height * 0.3) {
                            this.state = VAPOR;
                        }
                        break;

                    case VAPOR:
                        // Rise and drift
                        this.vy = -0.5 - Math.random() * 0.3;
                        this.vx = windSpeed * (Math.random() - 0.3);
                        this.x += this.vx;
                        this.y += this.vy;

                        // Condensation at high altitude
                        if (this.y < height * 0.25 && Math.random() < 0.02) {
                            this.state = CLOUD;
                            this.life = 200;
                        }
                        break;

                    case CLOUD:
                        // Drift with wind
                        this.vx = windSpeed * (0.5 + Math.random() * 0.5);
                        this.x += this.vx;
                        this.y += (Math.random() - 0.5) * 0.3;
                        this.life--;

                        // Cloud grows
                        this.size = Math.min(5, this.size + 0.05);

                        // Precipitation
                        if (this.life <= 0 || this.size > 4) {
                            this.state = RAIN;
                            this.vy = 0;
                        }
                        break;

                    case RAIN:
                        this.vy += 0.2;
                        this.vy = Math.min(this.vy, 8);
                        this.y += this.vy;
                        this.x += windSpeed * 0.5;

                        // Hit ground
                        if (this.y > height * 0.7) {
                            if (this.x > width * 0.6) {
                                // Land - becomes groundwater or runoff
                                this.state = Math.random() < 0.5 ? GROUNDWATER : RUNOFF;
                                this.life = 100;
                            } else {
                                // Ocean - back to ocean
                                this.state = OCEAN;
                                this.y = height * 0.75;
                            }
                        }
                        break;

                    case GROUNDWATER:
                        // Slow underground flow
                        this.x -= 0.1;
                        this.life--;

                        if (this.life <= 0 || this.x < width * 0.3) {
                            this.state = RUNOFF;
                        }
                        break;

                    case RUNOFF:
                        // Flow to ocean
                        this.vx = -2;
                        this.x += this.vx;

                        if (this.x < width * 0.4) {
                            this.state = OCEAN;
                            this.y = height * 0.75;
                        }
                        break;
                }

                // Wrap around
                if (this.x < -10) this.x = width + 10;
                if (this.x > width + 10) this.x = -10;
                if (this.y < -10) this.y = -10;
                if (this.y > height) this.y = height * 0.75;

                return true;
            }

            draw(ctx) {
                let color, alpha = 0.7;

                switch (this.state) {
                    case OCEAN:
                        color = '#1e4d7b';
                        this.size = 2;
                        break;
                    case EVAPORATING:
                        color = '#88ccff';
                        alpha = 0.5;
                        break;
                    case VAPOR:
                        color = '#cceeff';
                        alpha = 0.3;
                        this.size = 1;
                        break;
                    case CLOUD:
                        color = '#f0f0f0';
                        alpha = 0.6;
                        break;
                    case RAIN:
                        color = '#4488cc';
                        alpha = 0.8;
                        this.size = 2;
                        break;
                    case GROUNDWATER:
                        color = '#6b4423';
                        alpha = 0.4;
                        break;
                    case RUNOFF:
                        color = '#5599cc';
                        alpha = 0.6;
                        break;
                }

                ctx.fillStyle = color.replace(')', `, ${alpha})`).replace('rgb', 'rgba');
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // Simulation state
        let molecules = [];
        let solarEnergy = 1;
        let temperature = 20;
        let windSpeed = 1;

        // Initialize molecules
        for (let i = 0; i < 1000; i++) {
            molecules.push(new WaterMolecule(
                Math.random() * width * 0.5,
                height * 0.7 + Math.random() * height * 0.3,
                OCEAN
            ));
        }

        // Draw landscape
        function drawLandscape() {
            // Sky gradient
            const skyGradient = ctx.createLinearGradient(0, 0, 0, height * 0.7);
            skyGradient.addColorStop(0, '#1a2f4a');
            skyGradient.addColorStop(1, '#4a7ba7');
            ctx.fillStyle = skyGradient;
            ctx.fillRect(0, 0, width, height * 0.7);

            // Sun
            const sunGradient = ctx.createRadialGradient(width * 0.8, height * 0.15, 0, width * 0.8, height * 0.15, 60);
            sunGradient.addColorStop(0, `rgba(255, 220, 100, ${solarEnergy * 0.8})`);
            sunGradient.addColorStop(1, 'rgba(255, 220, 100, 0)');
            ctx.fillStyle = sunGradient;
            ctx.fillRect(width * 0.7, height * 0.05, 200, 200);

            // Ocean
            const oceanGradient = ctx.createLinearGradient(0, height * 0.7, 0, height);
            oceanGradient.addColorStop(0, '#2a5f8f');
            oceanGradient.addColorStop(1, '#1a3f5f');
            ctx.fillStyle = oceanGradient;
            ctx.fillRect(0, height * 0.7, width * 0.5, height * 0.3);

            // Land
            ctx.fillStyle = '#3d5a2f';
            ctx.beginPath();
            ctx.moveTo(width * 0.5, height * 0.7);
            ctx.lineTo(width * 0.6, height * 0.5);
            ctx.lineTo(width * 0.8, height * 0.6);
            ctx.lineTo(width, height * 0.65);
            ctx.lineTo(width, height);
            ctx.lineTo(width * 0.5, height);
            ctx.closePath();
            ctx.fill();

            // Mountain
            ctx.fillStyle = '#6b7d5c';
            ctx.beginPath();
            ctx.moveTo(width * 0.65, height * 0.7);
            ctx.lineTo(width * 0.75, height * 0.3);
            ctx.lineTo(width * 0.85, height * 0.7);
            ctx.closePath();
            ctx.fill();

            // Snow cap
            ctx.fillStyle = '#f0f0f0';
            ctx.beginPath();
            ctx.moveTo(width * 0.72, height * 0.4);
            ctx.lineTo(width * 0.75, height * 0.3);
            ctx.lineTo(width * 0.78, height * 0.4);
            ctx.closePath();
            ctx.fill();
        }

        // Update statistics
        function updateStats() {
            const counts = {
                ocean: 0,
                atmosphere: 0,
                rain: 0,
                ground: 0
            };

            for (const m of molecules) {
                if (m.state === OCEAN) counts.ocean++;
                else if (m.state === VAPOR || m.state === EVAPORATING) counts.atmosphere++;
                else if (m.state === RAIN) counts.rain++;
                else if (m.state === GROUNDWATER) counts.ground++;
                else if (m.state === CLOUD) counts.atmosphere++;
            }

            document.getElementById('oceanStat').textContent = counts.ocean;
            document.getElementById('atmStat').textContent = counts.atmosphere;
            document.getElementById('rainStat').textContent = counts.rain;
            document.getElementById('groundStat').textContent = counts.ground;
        }

        // Animation loop
        function animate() {
            ctx.fillStyle = '#0a0e1a';
            ctx.fillRect(0, 0, width, height);

            drawLandscape();

            // Update and draw molecules
            for (const molecule of molecules) {
                molecule.update(solarEnergy, temperature / 40, windSpeed);
                molecule.draw(ctx);
            }

            updateStats();

            requestAnimationFrame(animate);
        }

        // Controls
        document.getElementById('solar').addEventListener('input', (e) => {
            solarEnergy = parseInt(e.target.value) / 100;
            document.getElementById('solarValue').textContent = e.target.value + '%';
        });

        document.getElementById('temperature').addEventListener('input', (e) => {
            temperature = parseInt(e.target.value);
            document.getElementById('tempValue').textContent = temperature + '°C';
        });

        document.getElementById('wind').addEventListener('input', (e) => {
            windSpeed = parseFloat(e.target.value);
            document.getElementById('windValue').textContent = windSpeed.toFixed(1) + 'x';
        });

        // Start animation
        animate();
    </script>
</body>
</html>
