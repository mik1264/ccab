<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PCI: Consciousness Detection Simulator - Consciousness Science</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600;700&family=Nunito:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --conscious: #10B981;
            --unconscious: #6B7280;
            --threshold: #F59E0B;
            --tms-pulse: #8B5CF6;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #0f1419 0%, #1a2332 50%, #0d1117 100%);
            color: #fff;
            min-height: 100vh;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            font-weight: 600;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            z-index: 100;
        }

        .back-link:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(-5px);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 80px 2rem 2rem;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
        }

        h1 {
            font-family: 'Lora', serif;
            font-size: clamp(2rem, 5vw, 3rem);
            margin-bottom: 0.5rem;
            color: var(--conscious);
        }

        .subtitle {
            color: rgba(255,255,255,0.7);
            font-size: 1.1rem;
            max-width: 700px;
            margin: 0 auto;
        }

        .method-explain {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
            text-align: center;
        }

        .zap-zip {
            display: flex;
            justify-content: center;
            gap: 3rem;
            margin: 1.5rem 0;
            flex-wrap: wrap;
        }

        .step {
            text-align: center;
        }

        .step-icon {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .step-title {
            font-family: 'Lora', serif;
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
        }

        .step-desc {
            font-size: 0.9rem;
            opacity: 0.7;
            max-width: 200px;
        }

        .arrow {
            font-size: 2rem;
            color: var(--threshold);
            align-self: center;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 2rem;
            margin-top: 2rem;
        }

        .simulation-area {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 1.5rem;
        }

        .brain-eeg-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .brain-view {
            position: relative;
            aspect-ratio: 1;
        }

        #brainCanvas {
            width: 100%;
            height: 100%;
            border-radius: 15px;
            background: rgba(0,0,0,0.3);
        }

        .eeg-view {
            position: relative;
        }

        #eegCanvas {
            width: 100%;
            height: 100%;
            border-radius: 15px;
            background: rgba(0,0,0,0.3);
        }

        .pci-display {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            text-align: center;
        }

        .pci-label {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            opacity: 0.6;
            margin-bottom: 0.5rem;
        }

        .pci-value {
            font-family: 'Lora', serif;
            font-size: 4rem;
            font-weight: 700;
            transition: color 0.5s ease;
        }

        .pci-value.conscious {
            color: var(--conscious);
        }

        .pci-value.unconscious {
            color: var(--unconscious);
        }

        .threshold-line {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }

        .threshold-bar {
            flex: 1;
            height: 10px;
            background: linear-gradient(90deg, var(--unconscious), var(--unconscious) 31%, var(--threshold) 31%, var(--threshold) 33%, var(--conscious) 33%);
            border-radius: 5px;
            position: relative;
        }

        .threshold-marker {
            position: absolute;
            left: 31%;
            top: -5px;
            width: 4px;
            height: 20px;
            background: var(--threshold);
            border-radius: 2px;
        }

        .pci-indicator {
            position: absolute;
            top: -8px;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            transform: translateX(-50%);
            transition: left 0.5s ease;
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
        }

        .verdict {
            margin-top: 1rem;
            padding: 0.75rem;
            border-radius: 10px;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .verdict.conscious {
            background: rgba(16, 185, 129, 0.2);
            color: var(--conscious);
        }

        .verdict.unconscious {
            background: rgba(107, 114, 128, 0.2);
            color: var(--unconscious);
        }

        .controls-panel {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 1.5rem;
        }

        .controls-panel h3 {
            font-family: 'Lora', serif;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid rgba(255,255,255,0.1);
        }

        .scenario-buttons {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .scenario-btn {
            padding: 1rem;
            border-radius: 12px;
            border: 2px solid rgba(255,255,255,0.2);
            background: transparent;
            color: white;
            font-family: 'Nunito', sans-serif;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .scenario-btn:hover {
            border-color: var(--conscious);
            background: rgba(16, 185, 129, 0.1);
        }

        .scenario-btn.active {
            border-color: var(--conscious);
            background: rgba(16, 185, 129, 0.2);
        }

        .scenario-name {
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .scenario-desc {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .action-btn {
            width: 100%;
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 12px;
            border: none;
            background: linear-gradient(135deg, var(--tms-pulse), #6366F1);
            color: white;
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.3);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .info-section {
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 2px solid rgba(255,255,255,0.1);
        }

        .info-section h4 {
            margin-bottom: 0.5rem;
            color: var(--conscious);
        }

        .info-section p {
            font-size: 0.85rem;
            opacity: 0.8;
            line-height: 1.5;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .stat {
            background: rgba(0,0,0,0.2);
            padding: 0.75rem;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-family: 'Lora', serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--threshold);
        }

        .stat-label {
            font-size: 0.75rem;
            opacity: 0.6;
        }

        .applications-section {
            grid-column: 1 / -1;
            margin-top: 2rem;
        }

        .applications-section h3 {
            font-family: 'Lora', serif;
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .applications-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .application-card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 1.5rem;
            border-left: 4px solid var(--conscious);
        }

        .application-card h4 {
            margin-bottom: 0.5rem;
        }

        .application-card p {
            font-size: 0.9rem;
            opacity: 0.8;
            line-height: 1.5;
        }

        @media (max-width: 900px) {
            .main-grid {
                grid-template-columns: 1fr;
            }

            .brain-eeg-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Gallery</a>

    <div class="container">
        <header>
            <h1>PCI: Consciousness Detection</h1>
            <p class="subtitle">Simulate the Perturbational Complexity Index ‚Äî the clinical tool that detects hidden awareness</p>
        </header>

        <div class="method-explain">
            <h3 style="font-family: Lora; margin-bottom: 1rem;">The "Zap and Zip" Method</h3>
            <div class="zap-zip">
                <div class="step">
                    <div class="step-icon">‚ö°</div>
                    <div class="step-title">ZAP</div>
                    <div class="step-desc">Deliver TMS pulse to cortex</div>
                </div>
                <div class="arrow">‚Üí</div>
                <div class="step">
                    <div class="step-icon">üìä</div>
                    <div class="step-title">RECORD</div>
                    <div class="step-desc">Capture EEG for 300ms</div>
                </div>
                <div class="arrow">‚Üí</div>
                <div class="step">
                    <div class="step-icon">üóúÔ∏è</div>
                    <div class="step-title">ZIP</div>
                    <div class="step-desc">Compress the pattern</div>
                </div>
                <div class="arrow">‚Üí</div>
                <div class="step">
                    <div class="step-icon">üìà</div>
                    <div class="step-title">PCI</div>
                    <div class="step-desc">Measure complexity</div>
                </div>
            </div>
            <p style="opacity: 0.7; font-size: 0.9rem;">PCI > 0.31 = Conscious | PCI < 0.31 = Unconscious</p>
        </div>

        <div class="main-grid">
            <div class="simulation-area">
                <div class="brain-eeg-container">
                    <div class="brain-view">
                        <canvas id="brainCanvas"></canvas>
                    </div>
                    <div class="eeg-view">
                        <canvas id="eegCanvas"></canvas>
                    </div>
                </div>

                <div class="pci-display">
                    <div class="pci-label">Perturbational Complexity Index</div>
                    <div class="pci-value unconscious" id="pciValue">0.00</div>
                    <div class="threshold-line">
                        <span style="font-size: 0.8rem;">0</span>
                        <div class="threshold-bar">
                            <div class="threshold-marker"></div>
                            <div class="pci-indicator" id="pciIndicator" style="left: 0%"></div>
                        </div>
                        <span style="font-size: 0.8rem;">1</span>
                    </div>
                    <div class="verdict unconscious" id="verdict">Awaiting test...</div>
                </div>
            </div>

            <div class="controls-panel">
                <h3>Select Scenario</h3>
                <div class="scenario-buttons">
                    <button class="scenario-btn active" data-scenario="awake">
                        <div class="scenario-name">Healthy Awake</div>
                        <div class="scenario-desc">Normal waking consciousness</div>
                    </button>
                    <button class="scenario-btn" data-scenario="dreaming">
                        <div class="scenario-name">REM Sleep (Dreaming)</div>
                        <div class="scenario-desc">Conscious but unresponsive</div>
                    </button>
                    <button class="scenario-btn" data-scenario="mcs">
                        <div class="scenario-name">Minimally Conscious</div>
                        <div class="scenario-desc">Covert awareness present</div>
                    </button>
                    <button class="scenario-btn" data-scenario="vegetative">
                        <div class="scenario-name">Vegetative State</div>
                        <div class="scenario-desc">No awareness detected</div>
                    </button>
                    <button class="scenario-btn" data-scenario="anesthesia">
                        <div class="scenario-name">Under Anesthesia</div>
                        <div class="scenario-desc">Propofol-induced unconsciousness</div>
                    </button>
                    <button class="scenario-btn" data-scenario="deep-sleep">
                        <div class="scenario-name">Deep Sleep (NREM)</div>
                        <div class="scenario-desc">No dreams, no awareness</div>
                    </button>
                </div>

                <button class="action-btn" id="zapBtn">‚ö° DELIVER TMS PULSE</button>

                <div class="info-section">
                    <h4>Clinical Significance</h4>
                    <p>Up to 40% of minimally conscious patients are misdiagnosed as vegetative using bedside exams. PCI achieves 94.7% sensitivity for detecting hidden awareness.</p>
                </div>

                <div class="stats-grid">
                    <div class="stat">
                        <div class="stat-value">0.31</div>
                        <div class="stat-label">Threshold</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">94.7%</div>
                        <div class="stat-label">Sensitivity</div>
                    </div>
                </div>
            </div>

            <div class="applications-section">
                <h3>Clinical Applications</h3>
                <div class="applications-grid">
                    <div class="application-card">
                        <h4>Disorders of Consciousness</h4>
                        <p>Distinguishes minimally conscious state from vegetative state when behavioral assessment fails. Changes treatment decisions for unresponsive patients.</p>
                    </div>
                    <div class="application-card">
                        <h4>Anesthesia Monitoring</h4>
                        <p>Tracks consciousness depth during surgery. Different anesthetics produce characteristic PCI signatures ‚Äî ketamine preserves dreams, propofol abolishes them.</p>
                    </div>
                    <div class="application-card">
                        <h4>Locked-In Syndrome</h4>
                        <p>Detects fully conscious patients who cannot move or communicate. PCI remains high despite complete behavioral unresponsiveness.</p>
                    </div>
                    <div class="application-card">
                        <h4>Brain Injury Prognosis</h4>
                        <p>Patients with covert awareness (high PCI despite unresponsiveness) have better one-year outcomes than those without.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const brainCanvas = document.getElementById('brainCanvas');
        const eegCanvas = document.getElementById('eegCanvas');
        const brainCtx = brainCanvas.getContext('2d');
        const eegCtx = eegCanvas.getContext('2d');

        let currentScenario = 'awake';
        let isAnimating = false;
        let animationTime = 0;
        let pulseWaves = [];
        let eegData = [];
        let targetPCI = 0;
        let currentPCI = 0;

        const scenarios = {
            'awake': { pci: 0.65, complexity: 'high', spread: 'wide' },
            'dreaming': { pci: 0.52, complexity: 'high', spread: 'medium' },
            'mcs': { pci: 0.38, complexity: 'medium', spread: 'medium' },
            'vegetative': { pci: 0.18, complexity: 'low', spread: 'narrow' },
            'anesthesia': { pci: 0.12, complexity: 'low', spread: 'narrow' },
            'deep-sleep': { pci: 0.15, complexity: 'low', spread: 'narrow' }
        };

        function resizeCanvases() {
            [brainCanvas, eegCanvas].forEach(canvas => {
                const container = canvas.parentElement;
                canvas.width = container.clientWidth * window.devicePixelRatio;
                canvas.height = container.clientHeight * window.devicePixelRatio;
                canvas.style.width = container.clientWidth + 'px';
                canvas.style.height = container.clientHeight + 'px';
                canvas.getContext('2d').scale(window.devicePixelRatio, window.devicePixelRatio);
            });
        }

        function drawBrain() {
            const w = brainCanvas.clientWidth;
            const h = brainCanvas.clientHeight;

            brainCtx.clearRect(0, 0, w, h);

            // Draw brain outline
            brainCtx.beginPath();
            brainCtx.ellipse(w/2, h/2, w*0.4, h*0.38, 0, 0, Math.PI * 2);
            brainCtx.strokeStyle = 'rgba(255,255,255,0.3)';
            brainCtx.lineWidth = 2;
            brainCtx.stroke();

            // Draw TMS coil position
            brainCtx.beginPath();
            brainCtx.arc(w*0.35, h*0.35, 15, 0, Math.PI * 2);
            brainCtx.fillStyle = 'rgba(139, 92, 246, 0.5)';
            brainCtx.fill();
            brainCtx.strokeStyle = '#8B5CF6';
            brainCtx.stroke();

            // Draw pulse waves
            pulseWaves.forEach(wave => {
                brainCtx.beginPath();
                brainCtx.arc(wave.x, wave.y, wave.radius, 0, Math.PI * 2);
                brainCtx.strokeStyle = `rgba(139, 92, 246, ${wave.opacity})`;
                brainCtx.lineWidth = 2;
                brainCtx.stroke();
            });

            // Update waves
            pulseWaves = pulseWaves.filter(wave => {
                wave.radius += wave.speed;
                wave.opacity -= 0.008;
                return wave.opacity > 0;
            });

            // EEG electrode positions
            const electrodes = [
                { x: 0.3, y: 0.25 }, { x: 0.5, y: 0.2 }, { x: 0.7, y: 0.25 },
                { x: 0.25, y: 0.45 }, { x: 0.5, y: 0.4 }, { x: 0.75, y: 0.45 },
                { x: 0.3, y: 0.65 }, { x: 0.5, y: 0.6 }, { x: 0.7, y: 0.65 },
                { x: 0.4, y: 0.8 }, { x: 0.6, y: 0.8 }
            ];

            electrodes.forEach((e, i) => {
                const activity = eegData[i] || 0;
                brainCtx.beginPath();
                brainCtx.arc(w * e.x, h * e.y, 6 + activity * 4, 0, Math.PI * 2);
                brainCtx.fillStyle = activity > 0.3 ? `rgba(16, 185, 129, ${0.5 + activity * 0.5})` : 'rgba(107, 114, 128, 0.5)';
                brainCtx.fill();
            });

            // Label
            brainCtx.fillStyle = 'rgba(255,255,255,0.5)';
            brainCtx.font = '11px Nunito';
            brainCtx.textAlign = 'center';
            brainCtx.fillText('TMS Stimulation Site', w*0.35, h*0.35 + 30);
        }

        function drawEEG() {
            const w = eegCanvas.clientWidth;
            const h = eegCanvas.clientHeight;

            eegCtx.clearRect(0, 0, w, h);

            // Draw EEG traces
            const numChannels = 8;
            const channelHeight = h / (numChannels + 1);

            for (let ch = 0; ch < numChannels; ch++) {
                const y = channelHeight * (ch + 1);

                // Channel label
                eegCtx.fillStyle = 'rgba(255,255,255,0.4)';
                eegCtx.font = '10px Nunito';
                eegCtx.textAlign = 'left';
                eegCtx.fillText(`Ch${ch + 1}`, 5, y + 4);

                // Draw trace
                eegCtx.beginPath();
                eegCtx.moveTo(35, y);

                const complexity = scenarios[currentScenario].complexity;
                const amplitude = complexity === 'high' ? 15 : complexity === 'medium' ? 10 : 5;
                const frequency = complexity === 'high' ? 0.1 : complexity === 'medium' ? 0.05 : 0.02;

                for (let x = 35; x < w - 10; x++) {
                    const t = (x - 35 + animationTime * 50) * frequency;
                    const noise = Math.sin(t) * amplitude +
                                  Math.sin(t * 2.3) * amplitude * 0.5 +
                                  Math.sin(t * 5.7) * amplitude * 0.3 +
                                  (Math.random() - 0.5) * amplitude * 0.5;
                    eegCtx.lineTo(x, y + noise * (eegData[ch] || 0.1));
                }

                const channelActivity = eegData[ch] || 0;
                eegCtx.strokeStyle = channelActivity > 0.3 ? '#10B981' : 'rgba(107, 114, 128, 0.5)';
                eegCtx.lineWidth = 1;
                eegCtx.stroke();
            }

            // Time marker
            const timeMs = Math.min(animationTime * 1000, 300);
            eegCtx.fillStyle = 'rgba(245, 158, 11, 0.8)';
            eegCtx.font = '12px Nunito';
            eegCtx.textAlign = 'right';
            eegCtx.fillText(`${timeMs.toFixed(0)}ms`, w - 10, h - 10);
        }

        function updatePCI() {
            const diff = targetPCI - currentPCI;
            currentPCI += diff * 0.05;

            const pciEl = document.getElementById('pciValue');
            const indicatorEl = document.getElementById('pciIndicator');
            const verdictEl = document.getElementById('verdict');

            pciEl.textContent = currentPCI.toFixed(2);
            indicatorEl.style.left = (currentPCI * 100) + '%';

            if (currentPCI >= 0.31) {
                pciEl.className = 'pci-value conscious';
                verdictEl.className = 'verdict conscious';
                verdictEl.textContent = 'CONSCIOUS - Awareness detected';
            } else {
                pciEl.className = 'pci-value unconscious';
                verdictEl.className = 'verdict unconscious';
                verdictEl.textContent = currentPCI > 0 ? 'UNCONSCIOUS - No awareness' : 'Awaiting test...';
            }
        }

        function animate() {
            if (isAnimating) {
                animationTime += 0.016;

                // Update EEG data based on pulse propagation
                const scenario = scenarios[currentScenario];
                const spread = scenario.spread === 'wide' ? 1 : scenario.spread === 'medium' ? 0.7 : 0.4;

                for (let i = 0; i < 11; i++) {
                    const distance = i * 0.1;
                    const delay = distance * 0.5;
                    const activity = Math.max(0, Math.sin((animationTime - delay) * 5) * Math.exp(-(animationTime - delay) * 2));
                    eegData[i] = activity * spread * (0.5 + Math.random() * 0.5);
                }

                // Add waves during stimulation
                if (animationTime < 0.5 && Math.random() < 0.3) {
                    const w = brainCanvas.clientWidth;
                    const h = brainCanvas.clientHeight;
                    pulseWaves.push({
                        x: w * 0.35,
                        y: h * 0.35,
                        radius: 10,
                        opacity: 0.8,
                        speed: 2 + Math.random() * 2
                    });
                }

                // End animation after 300ms simulated time
                if (animationTime > 0.3) {
                    targetPCI = scenario.pci;
                }

                if (animationTime > 2) {
                    isAnimating = false;
                }
            }

            drawBrain();
            drawEEG();
            updatePCI();
            requestAnimationFrame(animate);
        }

        function deliverPulse() {
            if (isAnimating) return;

            isAnimating = true;
            animationTime = 0;
            eegData = new Array(11).fill(0);
            pulseWaves = [];
            currentPCI = 0;
            targetPCI = 0;

            document.getElementById('zapBtn').disabled = true;
            setTimeout(() => {
                document.getElementById('zapBtn').disabled = false;
            }, 2500);
        }

        // Event listeners
        document.querySelectorAll('.scenario-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.scenario-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentScenario = btn.dataset.scenario;

                // Reset display
                currentPCI = 0;
                targetPCI = 0;
                eegData = new Array(11).fill(0.1);
                isAnimating = false;
            });
        });

        document.getElementById('zapBtn').addEventListener('click', deliverPulse);

        window.addEventListener('resize', resizeCanvases);

        // Initialize
        resizeCanvases();
        eegData = new Array(11).fill(0.1);
        animate();
    </script>
</body>
</html>
