<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S-Process Nucleosynthesis - Slow Neutron Capture - CCAB</title>
    <meta name="description" content="Visualize slow neutron capture nucleosynthesis in AGB stars. Watch elements build up through beta decay chains.">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: linear-gradient(135deg, #0a0814 0%, #1a0a2e 100%);
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: #e8e6e1;
            overflow-x: hidden;
        }
        .back-link {
            position: fixed;
            top: 15px; left: 15px;
            padding: 10px 18px;
            background: rgba(0, 0, 0, 0.6);
            color: #a855f7;
            text-decoration: none;
            border-radius: 8px;
            font-size: 14px;
            z-index: 1000;
            border: 1px solid rgba(168, 85, 247, 0.3);
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 60px 20px 20px;
        }
        h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            color: #a855f7;
            text-align: center;
        }
        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
            font-size: 0.95rem;
        }
        #chart {
            width: 100%;
            height: 500px;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        #canvas { width: 100%; height: 100%; }
        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #a855f7 0%, #7c3aed 100%);
            border: none;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: transform 0.2s;
        }
        .btn:hover { transform: scale(1.02); }
        .btn.secondary {
            background: rgba(168, 85, 247, 0.2);
            border: 1px solid rgba(168, 85, 247, 0.5);
        }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .info-panel {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(168, 85, 247, 0.2);
        }
        .info-panel h2 {
            font-size: 1.1rem;
            color: #a855f7;
            margin-bottom: 15px;
        }
        .reaction-display {
            font-family: 'Times New Roman', serif;
            font-size: 1.2rem;
            text-align: center;
            padding: 15px;
            background: rgba(168, 85, 247, 0.1);
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .element-card {
            display: inline-block;
            padding: 8px 15px;
            background: rgba(168, 85, 247, 0.2);
            border-radius: 8px;
            margin: 5px;
            font-size: 0.9rem;
        }
        .element-card.active {
            background: linear-gradient(135deg, #a855f7 0%, #7c3aed 100%);
        }
        .stats-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        .stat-box {
            text-align: center;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
        }
        .stat-value { font-size: 1.5rem; color: #a855f7; font-weight: 600; }
        .stat-label { font-size: 0.75rem; color: #888; }
        .legend {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        .progress-bar {
            height: 8px;
            background: rgba(0,0,0,0.3);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #22c55e, #a855f7, #ef4444);
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Gallery</a>

    <div class="container">
        <h1>S-Process Nucleosynthesis</h1>
        <p class="subtitle">Slow neutron capture in AGB stars creates half of all heavy elements beyond iron</p>

        <div id="chart">
            <canvas id="canvas"></canvas>
        </div>

        <div class="controls">
            <button class="btn" id="playBtn">▶ Start Capture</button>
            <button class="btn secondary" id="stepBtn">Capture Once</button>
            <button class="btn secondary" id="resetBtn">↺ Reset to Fe-56</button>
            <select id="speedSelect" style="padding: 12px; border-radius: 8px; background: rgba(168,85,247,0.2); color: white; border: 1px solid rgba(168,85,247,0.5);">
                <option value="0.5">0.5x Speed</option>
                <option value="1" selected>1x Speed</option>
                <option value="2">2x Speed</option>
                <option value="4">4x Speed</option>
            </select>
        </div>

        <div class="info-grid">
            <div class="info-panel">
                <h2>Current Isotope</h2>
                <div class="reaction-display" id="currentElement">⁵⁶Fe (Iron-56)</div>
                <p style="font-size: 0.85rem; color: #888; margin-bottom: 10px;">
                    <strong>Atomic Number (Z):</strong> <span id="atomicNum">26</span><br>
                    <strong>Mass Number (A):</strong> <span id="massNum">56</span><br>
                    <strong>Neutrons (N):</strong> <span id="neutronNum">30</span>
                </p>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                <p style="font-size: 0.75rem; color: #666; margin-top: 5px; text-align: center;">
                    Progress: Fe-56 → Bi-209 (s-process endpoint)
                </p>
            </div>

            <div class="info-panel">
                <h2>Process Steps</h2>
                <div class="reaction-display" id="reactionEq">Waiting for neutron capture...</div>
                <p style="font-size: 0.85rem; color: #888; line-height: 1.6;">
                    <strong>S-Process:</strong> Slow neutron capture occurs over thousands of years.
                    When a nucleus captures a neutron, it either:<br>
                    • Remains stable (if new isotope is stable)<br>
                    • Undergoes β⁻ decay → new element
                </p>
            </div>

            <div class="info-panel">
                <h2>Elements Created</h2>
                <div id="elementList">
                    <span class="element-card active">Fe (26)</span>
                </div>
                <div class="stats-row">
                    <div class="stat-box">
                        <div class="stat-value" id="captureCount">0</div>
                        <div class="stat-label">Neutron Captures</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="decayCount">0</div>
                        <div class="stat-label">β⁻ Decays</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="elementsCount">1</div>
                        <div class="stat-label">Elements Visited</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #22c55e;"></div>
                <span>Stable Isotope</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #3b82f6;"></div>
                <span>Neutron</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ef4444;"></div>
                <span>β⁻ Decay</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #a855f7;"></div>
                <span>Current Nucleus</span>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resize() {
            const rect = canvas.parentElement.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
        }
        resize();
        window.addEventListener('resize', resize);

        // Element data for s-process path
        const elements = [
            { symbol: 'Fe', name: 'Iron', Z: 26 },
            { symbol: 'Co', name: 'Cobalt', Z: 27 },
            { symbol: 'Ni', name: 'Nickel', Z: 28 },
            { symbol: 'Cu', name: 'Copper', Z: 29 },
            { symbol: 'Zn', name: 'Zinc', Z: 30 },
            { symbol: 'Ga', name: 'Gallium', Z: 31 },
            { symbol: 'Ge', name: 'Germanium', Z: 32 },
            { symbol: 'As', name: 'Arsenic', Z: 33 },
            { symbol: 'Se', name: 'Selenium', Z: 34 },
            { symbol: 'Br', name: 'Bromine', Z: 35 },
            { symbol: 'Kr', name: 'Krypton', Z: 36 },
            { symbol: 'Rb', name: 'Rubidium', Z: 37 },
            { symbol: 'Sr', name: 'Strontium', Z: 38 },
            { symbol: 'Y', name: 'Yttrium', Z: 39 },
            { symbol: 'Zr', name: 'Zirconium', Z: 40 },
            { symbol: 'Nb', name: 'Niobium', Z: 41 },
            { symbol: 'Mo', name: 'Molybdenum', Z: 42 },
            { symbol: 'Tc', name: 'Technetium', Z: 43 },
            { symbol: 'Ru', name: 'Ruthenium', Z: 44 },
            { symbol: 'Rh', name: 'Rhodium', Z: 45 },
            { symbol: 'Pd', name: 'Palladium', Z: 46 },
            { symbol: 'Ag', name: 'Silver', Z: 47 },
            { symbol: 'Cd', name: 'Cadmium', Z: 48 },
            { symbol: 'In', name: 'Indium', Z: 49 },
            { symbol: 'Sn', name: 'Tin', Z: 50 },
            { symbol: 'Sb', name: 'Antimony', Z: 51 },
            { symbol: 'Te', name: 'Tellurium', Z: 52 },
            { symbol: 'I', name: 'Iodine', Z: 53 },
            { symbol: 'Xe', name: 'Xenon', Z: 54 },
            { symbol: 'Cs', name: 'Cesium', Z: 55 },
            { symbol: 'Ba', name: 'Barium', Z: 56 },
            { symbol: 'La', name: 'Lanthanum', Z: 57 },
            { symbol: 'Ce', name: 'Cerium', Z: 58 },
            { symbol: 'Pr', name: 'Praseodymium', Z: 59 },
            { symbol: 'Nd', name: 'Neodymium', Z: 60 },
            { symbol: 'Pm', name: 'Promethium', Z: 61 },
            { symbol: 'Sm', name: 'Samarium', Z: 62 },
            { symbol: 'Eu', name: 'Europium', Z: 63 },
            { symbol: 'Gd', name: 'Gadolinium', Z: 64 },
            { symbol: 'Tb', name: 'Terbium', Z: 65 },
            { symbol: 'Dy', name: 'Dysprosium', Z: 66 },
            { symbol: 'Ho', name: 'Holmium', Z: 67 },
            { symbol: 'Er', name: 'Erbium', Z: 68 },
            { symbol: 'Tm', name: 'Thulium', Z: 69 },
            { symbol: 'Yb', name: 'Ytterbium', Z: 70 },
            { symbol: 'Lu', name: 'Lutetium', Z: 71 },
            { symbol: 'Hf', name: 'Hafnium', Z: 72 },
            { symbol: 'Ta', name: 'Tantalum', Z: 73 },
            { symbol: 'W', name: 'Tungsten', Z: 74 },
            { symbol: 'Re', name: 'Rhenium', Z: 75 },
            { symbol: 'Os', name: 'Osmium', Z: 76 },
            { symbol: 'Ir', name: 'Iridium', Z: 77 },
            { symbol: 'Pt', name: 'Platinum', Z: 78 },
            { symbol: 'Au', name: 'Gold', Z: 79 },
            { symbol: 'Hg', name: 'Mercury', Z: 80 },
            { symbol: 'Tl', name: 'Thallium', Z: 81 },
            { symbol: 'Pb', name: 'Lead', Z: 82 },
            { symbol: 'Bi', name: 'Bismuth', Z: 83 }
        ];

        // State
        let playing = false;
        let speed = 1;
        let currentZ = 26;
        let currentA = 56;
        let captureCount = 0;
        let decayCount = 0;
        let visitedElements = new Set([26]);
        let neutrons = [];
        let decayParticles = [];
        let nucleusGlow = 0;
        let lastAction = null;
        let actionTimer = 0;

        // Animation state
        let nucleusX, nucleusY;

        function getElementByZ(z) {
            return elements.find(e => e.Z === z) || { symbol: '?', name: 'Unknown', Z: z };
        }

        function shouldDecay() {
            // Simplified s-process logic: decay probability increases with excess neutrons
            const N = currentA - currentZ;
            const excessN = N - currentZ;
            // Higher probability of decay with more neutron-rich isotopes
            return Math.random() < 0.3 + excessN * 0.05;
        }

        function updateUI() {
            const elem = getElementByZ(currentZ);
            document.getElementById('currentElement').innerHTML =
                `<sup>${currentA}</sup>${elem.symbol} (${elem.name}-${currentA})`;
            document.getElementById('atomicNum').textContent = currentZ;
            document.getElementById('massNum').textContent = currentA;
            document.getElementById('neutronNum').textContent = currentA - currentZ;

            document.getElementById('captureCount').textContent = captureCount;
            document.getElementById('decayCount').textContent = decayCount;
            document.getElementById('elementsCount').textContent = visitedElements.size;

            // Progress bar
            const progress = (currentZ - 26) / (83 - 26) * 100;
            document.getElementById('progressFill').style.width = progress + '%';

            // Update element list
            const elementList = document.getElementById('elementList');
            elementList.innerHTML = '';
            visitedElements.forEach(z => {
                const el = getElementByZ(z);
                const isActive = z === currentZ;
                elementList.innerHTML += `<span class="element-card${isActive ? ' active' : ''}">${el.symbol} (${z})</span>`;
            });

            // Update reaction equation
            if (lastAction === 'capture') {
                const elem = getElementByZ(currentZ);
                document.getElementById('reactionEq').innerHTML =
                    `<sup>${currentA-1}</sup>${elem.symbol} + n → <sup>${currentA}</sup>${elem.symbol}`;
            } else if (lastAction === 'decay') {
                const prevElem = getElementByZ(currentZ - 1);
                const elem = getElementByZ(currentZ);
                document.getElementById('reactionEq').innerHTML =
                    `<sup>${currentA}</sup>${prevElem.symbol} → <sup>${currentA}</sup>${elem.symbol} + e⁻ + ν̄ₑ`;
            }
        }

        function captureNeutron() {
            if (currentZ >= 83) return; // Endpoint reached

            // Spawn neutron
            const angle = Math.random() * Math.PI * 2;
            const dist = 300;
            neutrons.push({
                x: nucleusX + Math.cos(angle) * dist,
                y: nucleusY + Math.sin(angle) * dist,
                targetX: nucleusX,
                targetY: nucleusY,
                speed: 3 * speed,
                captured: false
            });

            actionTimer = 60 / speed;
            lastAction = 'capture';
        }

        function performBetaDecay() {
            if (currentZ >= 83) return;

            currentZ++;
            visitedElements.add(currentZ);
            decayCount++;

            // Spawn beta particle and neutrino
            for (let i = 0; i < 2; i++) {
                const angle = Math.random() * Math.PI * 2;
                decayParticles.push({
                    x: nucleusX,
                    y: nucleusY,
                    vx: Math.cos(angle) * 4 * speed,
                    vy: Math.sin(angle) * 4 * speed,
                    type: i === 0 ? 'electron' : 'neutrino',
                    life: 1
                });
            }

            nucleusGlow = 1;
            lastAction = 'decay';
            updateUI();
        }

        function drawNucleus() {
            const radius = 50 + currentZ * 0.3;

            // Glow effect
            if (nucleusGlow > 0) {
                const gradient = ctx.createRadialGradient(nucleusX, nucleusY, radius, nucleusX, nucleusY, radius * 2);
                gradient.addColorStop(0, `rgba(168, 85, 247, ${nucleusGlow * 0.5})`);
                gradient.addColorStop(1, 'transparent');
                ctx.beginPath();
                ctx.arc(nucleusX, nucleusY, radius * 2, 0, Math.PI * 2);
                ctx.fillStyle = gradient;
                ctx.fill();
            }

            // Main nucleus
            const gradient = ctx.createRadialGradient(
                nucleusX - radius * 0.2, nucleusY - radius * 0.2, 0,
                nucleusX, nucleusY, radius
            );

            const hue = 270 + (currentZ - 26) * 2;
            gradient.addColorStop(0, `hsl(${hue}, 70%, 70%)`);
            gradient.addColorStop(0.5, `hsl(${hue}, 70%, 50%)`);
            gradient.addColorStop(1, `hsl(${hue}, 70%, 30%)`);

            ctx.beginPath();
            ctx.arc(nucleusX, nucleusY, radius, 0, Math.PI * 2);
            ctx.fillStyle = gradient;
            ctx.fill();

            // Nucleons pattern
            ctx.save();
            ctx.beginPath();
            ctx.arc(nucleusX, nucleusY, radius, 0, Math.PI * 2);
            ctx.clip();

            const nucleonCount = Math.min(currentA, 50);
            for (let i = 0; i < nucleonCount; i++) {
                const angle = (i / nucleonCount) * Math.PI * 2 + Date.now() * 0.0001;
                const r = Math.random() * radius * 0.8;
                const nx = nucleusX + Math.cos(angle + i) * r;
                const ny = nucleusY + Math.sin(angle + i) * r;

                ctx.beginPath();
                ctx.arc(nx, ny, 5, 0, Math.PI * 2);
                ctx.fillStyle = i < currentZ ? 'rgba(255,100,100,0.6)' : 'rgba(100,100,255,0.6)';
                ctx.fill();
            }
            ctx.restore();

            // Label
            const elem = getElementByZ(currentZ);
            ctx.font = 'bold 24px Arial';
            ctx.fillStyle = 'white';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(elem.symbol, nucleusX, nucleusY);

            ctx.font = '14px Arial';
            ctx.fillText(`A=${currentA}`, nucleusX, nucleusY + radius + 20);
        }

        function animate(time) {
            ctx.fillStyle = 'rgba(10, 8, 20, 0.3)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            nucleusX = canvas.width / 2;
            nucleusY = canvas.height / 2;

            // Background grid
            ctx.strokeStyle = 'rgba(168, 85, 247, 0.1)';
            ctx.lineWidth = 1;
            for (let i = 0; i < canvas.width; i += 50) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, canvas.height);
                ctx.stroke();
            }
            for (let i = 0; i < canvas.height; i += 50) {
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(canvas.width, i);
                ctx.stroke();
            }

            // Draw s-process path preview
            const pathRadius = Math.min(canvas.width, canvas.height) * 0.4;
            const startAngle = -Math.PI / 2;
            ctx.strokeStyle = 'rgba(168, 85, 247, 0.2)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(nucleusX, nucleusY, pathRadius, startAngle, startAngle + Math.PI * 2 * 0.9);
            ctx.stroke();

            // Draw element markers on path
            elements.forEach((elem, i) => {
                const angle = startAngle + (i / elements.length) * Math.PI * 2 * 0.9;
                const x = nucleusX + Math.cos(angle) * pathRadius;
                const y = nucleusY + Math.sin(angle) * pathRadius;

                const isVisited = visitedElements.has(elem.Z);
                const isCurrent = elem.Z === currentZ;

                ctx.beginPath();
                ctx.arc(x, y, isCurrent ? 12 : 6, 0, Math.PI * 2);
                ctx.fillStyle = isCurrent ? '#a855f7' : isVisited ? '#22c55e' : 'rgba(168, 85, 247, 0.3)';
                ctx.fill();

                if (isCurrent || (isVisited && i % 5 === 0)) {
                    ctx.font = '10px Arial';
                    ctx.fillStyle = '#ccc';
                    ctx.textAlign = 'center';
                    ctx.fillText(elem.symbol, x, y - 15);
                }
            });

            // Update and draw neutrons
            neutrons = neutrons.filter(n => {
                if (n.captured) return false;

                const dx = n.targetX - n.x;
                const dy = n.targetY - n.y;
                const dist = Math.sqrt(dx * dx + dy * dy);

                if (dist < 10) {
                    // Capture!
                    currentA++;
                    captureCount++;
                    nucleusGlow = 1;

                    // Check for decay
                    setTimeout(() => {
                        if (shouldDecay() && currentZ < 83) {
                            performBetaDecay();
                        }
                        updateUI();
                    }, 500 / speed);

                    return false;
                }

                n.x += (dx / dist) * n.speed;
                n.y += (dy / dist) * n.speed;

                // Draw neutron
                ctx.beginPath();
                ctx.arc(n.x, n.y, 8, 0, Math.PI * 2);
                ctx.fillStyle = '#3b82f6';
                ctx.fill();

                ctx.font = '10px Arial';
                ctx.fillStyle = 'white';
                ctx.textAlign = 'center';
                ctx.fillText('n', n.x, n.y + 3);

                return true;
            });

            // Update and draw decay particles
            decayParticles = decayParticles.filter(p => {
                p.x += p.vx;
                p.y += p.vy;
                p.life -= 0.02;

                if (p.life <= 0) return false;

                ctx.beginPath();
                ctx.arc(p.x, p.y, p.type === 'electron' ? 5 : 3, 0, Math.PI * 2);
                ctx.fillStyle = p.type === 'electron'
                    ? `rgba(239, 68, 68, ${p.life})`
                    : `rgba(34, 197, 94, ${p.life})`;
                ctx.fill();

                return true;
            });

            // Draw main nucleus
            drawNucleus();

            // Update glow
            nucleusGlow = Math.max(0, nucleusGlow - 0.02);

            // Auto capture
            if (playing && actionTimer <= 0 && currentZ < 83) {
                captureNeutron();
            }

            actionTimer = Math.max(0, actionTimer - 1);

            requestAnimationFrame(animate);
        }

        // Event listeners
        document.getElementById('playBtn').addEventListener('click', () => {
            playing = !playing;
            document.getElementById('playBtn').textContent = playing ? '⏸ Pause' : '▶ Start Capture';
        });

        document.getElementById('stepBtn').addEventListener('click', () => {
            if (!playing && currentZ < 83) {
                captureNeutron();
            }
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            playing = false;
            currentZ = 26;
            currentA = 56;
            captureCount = 0;
            decayCount = 0;
            visitedElements = new Set([26]);
            neutrons = [];
            decayParticles = [];
            lastAction = null;
            document.getElementById('playBtn').textContent = '▶ Start Capture';
            document.getElementById('reactionEq').textContent = 'Waiting for neutron capture...';
            updateUI();
        });

        document.getElementById('speedSelect').addEventListener('change', (e) => {
            speed = parseFloat(e.target.value);
        });

        updateUI();
        requestAnimationFrame(animate);
    </script>
</body>
</html>
