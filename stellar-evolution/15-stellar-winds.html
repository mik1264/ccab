<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stellar Winds - Mass Loss Mechanisms - CCAB</title>
    <meta name="description" content="Visualize stellar winds and mass loss from different types of stars. Watch particles stream from solar-type, hot, and AGB stars.">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #000;
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: #e8e6e1;
            overflow: hidden;
        }
        .back-link {
            position: fixed;
            top: 15px; left: 15px;
            padding: 10px 18px;
            background: rgba(0, 0, 0, 0.6);
            color: #22c55e;
            text-decoration: none;
            border-radius: 8px;
            font-size: 14px;
            z-index: 1000;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }
        #canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; }
        #panel {
            position: fixed;
            right: 0; top: 0;
            width: 340px; height: 100%;
            background: rgba(0, 0, 0, 0.9);
            padding: 70px 20px 20px;
            border-left: 1px solid rgba(34, 197, 94, 0.2);
            overflow-y: auto;
        }
        h1 { font-size: 1.3rem; margin-bottom: 10px; color: #22c55e; }
        h2 { font-size: 0.95rem; margin: 15px 0 10px; color: #22c55e; }
        .desc { font-size: 0.82rem; line-height: 1.6; color: #aaa; margin-bottom: 15px; }
        .star-types {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 15px;
        }
        .star-type {
            padding: 12px;
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.2);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .star-type:hover { background: rgba(34, 197, 94, 0.2); }
        .star-type.active {
            background: rgba(34, 197, 94, 0.25);
            border-color: #22c55e;
        }
        .star-type .name { font-weight: 600; margin-bottom: 3px; }
        .star-type .info { font-size: 0.75rem; color: #888; }
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }
        .stat-box {
            background: rgba(0,0,0,0.4);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-value { font-size: 1.1rem; color: #22c55e; font-weight: 600; }
        .stat-label { font-size: 0.7rem; color: #888; }
        .controls { margin-bottom: 15px; }
        .btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            border: none;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-right: 8px;
        }
        .btn:hover { transform: scale(1.02); }
        .btn.secondary {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid rgba(34, 197, 94, 0.5);
        }
        .slider-group { margin-bottom: 12px; }
        .slider-group label {
            display: block;
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 5px;
        }
        input[type="range"] {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            background: rgba(34, 197, 94, 0.2);
            border-radius: 3px;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px; height: 16px;
            background: #22c55e;
            border-radius: 50%;
            cursor: pointer;
        }
        .legend {
            margin-top: 15px;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
            font-size: 0.8rem;
        }
        .legend-dot {
            width: 10px; height: 10px;
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Gallery</a>
    <canvas id="canvas"></canvas>

    <div id="panel">
        <h1>Stellar Winds</h1>
        <p class="desc">
            Stars continuously lose mass through stellar winds. The mechanism and intensity
            depend on the star type, driving everything from gentle solar winds to extreme
            mass loss in evolved giants.
        </p>

        <h2>Star Type</h2>
        <div class="star-types" id="starTypes"></div>

        <div class="stats-grid">
            <div class="stat-box">
                <div class="stat-value" id="massLossVal">2×10⁻¹⁴</div>
                <div class="stat-label">Mass Loss (M☉/yr)</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="velocityVal">400</div>
                <div class="stat-label">Wind Speed (km/s)</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="particleVal">0</div>
                <div class="stat-label">Particles</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="tempVal">5,800</div>
                <div class="stat-label">Surface Temp (K)</div>
            </div>
        </div>

        <h2>Controls</h2>
        <div class="controls">
            <button class="btn" id="playBtn">⏸ Pause</button>
            <button class="btn secondary" id="resetBtn">↺ Reset</button>
        </div>

        <div class="slider-group">
            <label>Particle Density: <span id="densityVal">1.0</span>x</label>
            <input type="range" id="density" min="0.1" max="3" step="0.1" value="1">
        </div>

        <div class="slider-group">
            <label>Time Scale: <span id="timeVal">1.0</span>x</label>
            <input type="range" id="timeScale" min="0.2" max="3" step="0.1" value="1">
        </div>

        <h2>Wind Mechanism</h2>
        <p class="desc" id="mechanismDesc">
            The solar wind is driven by the hot corona. Thermal energy accelerates
            particles to escape velocity, carrying plasma into the heliosphere.
        </p>

        <div class="legend">
            <div class="legend-item"><div class="legend-dot" style="background: #ffdd44;"></div>Protons/Ions</div>
            <div class="legend-item"><div class="legend-dot" style="background: #44aaff;"></div>Electrons</div>
            <div class="legend-item"><div class="legend-dot" style="background: #ff6644;"></div>Dust (AGB winds)</div>
            <div class="legend-item"><div class="legend-dot" style="background: #88ff88;"></div>Molecules (cool winds)</div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resize();
        window.addEventListener('resize', resize);

        const starTypes = [
            {
                id: 'solar',
                name: 'Solar-type Star',
                info: 'G2V • 5,800 K • Like our Sun',
                color: '#fff5cc',
                radius: 60,
                massLoss: '2×10⁻¹⁴',
                velocity: 400,
                temp: 5800,
                particleRate: 3,
                windSpeed: 5,
                mechanism: 'The solar wind is driven by the million-degree corona. Thermal energy heats particles beyond escape velocity, creating a supersonic plasma flow that fills the heliosphere.',
                particleTypes: [
                    { color: '#ffdd44', size: 2, ratio: 0.7 },
                    { color: '#44aaff', size: 1.5, ratio: 0.3 }
                ]
            },
            {
                id: 'hot-ob',
                name: 'Hot O/B Star',
                info: 'O5V • 40,000 K • Massive blue star',
                color: '#aaccff',
                radius: 80,
                massLoss: '10⁻⁶',
                velocity: 2500,
                temp: 40000,
                particleRate: 15,
                windSpeed: 12,
                mechanism: 'Line-driven winds! Intense UV radiation is absorbed by metal ions, transferring momentum to the gas. The wind is so powerful it can strip 10⁻⁶ solar masses per year.',
                particleTypes: [
                    { color: '#aaccff', size: 2.5, ratio: 0.5 },
                    { color: '#ffffff', size: 2, ratio: 0.3 },
                    { color: '#88aaff', size: 1.5, ratio: 0.2 }
                ]
            },
            {
                id: 'red-giant',
                name: 'Red Giant',
                info: 'M2III • 3,500 K • Evolved giant',
                color: '#ff8855',
                radius: 100,
                massLoss: '10⁻⁸',
                velocity: 20,
                temp: 3500,
                particleRate: 8,
                windSpeed: 2,
                mechanism: 'Slow, dust-driven wind. Pulsations levitate gas to cool regions where dust grains form. Radiation pressure on dust drags the gas outward at just 10-20 km/s.',
                particleTypes: [
                    { color: '#ff6644', size: 3, ratio: 0.4 },
                    { color: '#ffaa66', size: 2.5, ratio: 0.3 },
                    { color: '#88ff88', size: 2, ratio: 0.3 }
                ]
            },
            {
                id: 'agb',
                name: 'AGB Star (Mira)',
                info: 'M7III • 2,800 K • Pulsating giant',
                color: '#ff5533',
                radius: 120,
                massLoss: '10⁻⁵',
                velocity: 15,
                temp: 2800,
                particleRate: 20,
                windSpeed: 1.5,
                mechanism: 'Extreme mass loss! Strong pulsations and shocks lift gas to cool regions. Massive dust formation drives a "superwind" that can strip the entire envelope in ~10⁵ years.',
                particleTypes: [
                    { color: '#ff4422', size: 4, ratio: 0.3 },
                    { color: '#aa3311', size: 3.5, ratio: 0.3 },
                    { color: '#66ff66', size: 2.5, ratio: 0.2 },
                    { color: '#ffcc88', size: 2, ratio: 0.2 }
                ],
                pulsating: true
            },
            {
                id: 'wolf-rayet',
                name: 'Wolf-Rayet Star',
                info: 'WN • 50,000 K • Stripped massive star',
                color: '#88ccff',
                radius: 50,
                massLoss: '10⁻⁵',
                velocity: 3000,
                temp: 50000,
                particleRate: 25,
                windSpeed: 15,
                mechanism: 'Extreme line-driven wind from a stripped stellar core. With no hydrogen envelope left, helium and heavy elements produce dense, fast winds that shape spectacular nebulae.',
                particleTypes: [
                    { color: '#ffffff', size: 2, ratio: 0.4 },
                    { color: '#aaddff', size: 2.5, ratio: 0.3 },
                    { color: '#ffdd88', size: 2, ratio: 0.3 }
                ]
            }
        ];

        let currentStar = starTypes[0];
        let particles = [];
        let playing = true;
        let density = 1;
        let timeScale = 1;
        let time = 0;

        // Create star type buttons
        function createStarTypeList() {
            const container = document.getElementById('starTypes');
            container.innerHTML = '';
            starTypes.forEach(star => {
                const div = document.createElement('div');
                div.className = 'star-type' + (star.id === currentStar.id ? ' active' : '');
                div.innerHTML = `
                    <div class="name">${star.name}</div>
                    <div class="info">${star.info}</div>
                `;
                div.addEventListener('click', () => selectStar(star));
                container.appendChild(div);
            });
        }

        function selectStar(star) {
            currentStar = star;
            particles = [];
            createStarTypeList();
            updateUI();
        }

        function updateUI() {
            document.getElementById('massLossVal').textContent = currentStar.massLoss;
            document.getElementById('velocityVal').textContent = currentStar.velocity;
            document.getElementById('tempVal').textContent = currentStar.temp.toLocaleString();
            document.getElementById('mechanismDesc').textContent = currentStar.mechanism;
        }

        function spawnParticle() {
            const angle = Math.random() * Math.PI * 2;
            const type = selectParticleType();
            const speed = currentStar.windSpeed * (0.8 + Math.random() * 0.4);

            // AGB stars have clumpy wind
            const clump = currentStar.pulsating ? 0.5 + Math.random() : 1;

            particles.push({
                x: 0,
                y: 0,
                angle: angle,
                dist: currentStar.radius + 5,
                speed: speed * clump,
                color: type.color,
                size: type.size * (0.8 + Math.random() * 0.4),
                life: 1,
                spiral: currentStar.id === 'solar' ? Math.random() * 0.02 : 0
            });
        }

        function selectParticleType() {
            const r = Math.random();
            let cumulative = 0;
            for (const type of currentStar.particleTypes) {
                cumulative += type.ratio;
                if (r < cumulative) return type;
            }
            return currentStar.particleTypes[0];
        }

        function drawStar(x, y) {
            let radius = currentStar.radius;

            // Pulsation for AGB stars
            if (currentStar.pulsating) {
                radius *= 1 + 0.1 * Math.sin(time * 0.5);
            }

            // Glow layers
            for (let i = 5; i >= 1; i--) {
                const glowRadius = radius * (1 + i * 0.4);
                const gradient = ctx.createRadialGradient(x, y, radius, x, y, glowRadius);
                gradient.addColorStop(0, currentStar.color + '40');
                gradient.addColorStop(1, 'transparent');
                ctx.beginPath();
                ctx.arc(x, y, glowRadius, 0, Math.PI * 2);
                ctx.fillStyle = gradient;
                ctx.fill();
            }

            // Main body
            const bodyGradient = ctx.createRadialGradient(
                x - radius * 0.2, y - radius * 0.2, 0,
                x, y, radius
            );
            bodyGradient.addColorStop(0, '#ffffff');
            bodyGradient.addColorStop(0.3, currentStar.color);
            bodyGradient.addColorStop(1, currentStar.color + '88');

            ctx.beginPath();
            ctx.arc(x, y, radius, 0, Math.PI * 2);
            ctx.fillStyle = bodyGradient;
            ctx.fill();

            // Corona/atmosphere for hot stars
            if (currentStar.temp > 10000) {
                ctx.strokeStyle = currentStar.color + '30';
                ctx.lineWidth = 2;
                for (let i = 0; i < 12; i++) {
                    const angle = (i / 12) * Math.PI * 2 + time * 0.1;
                    const length = radius * 0.5 + Math.random() * radius * 0.3;
                    ctx.beginPath();
                    ctx.moveTo(x + Math.cos(angle) * radius, y + Math.sin(angle) * radius);
                    ctx.lineTo(x + Math.cos(angle) * (radius + length), y + Math.sin(angle) * (radius + length));
                    ctx.stroke();
                }
            }

            // Convection cells for cool stars
            if (currentStar.temp < 4000) {
                ctx.save();
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI * 2);
                ctx.clip();

                for (let i = 0; i < 8; i++) {
                    const cellAngle = (i / 8) * Math.PI * 2 + time * 0.05;
                    const cellX = x + Math.cos(cellAngle) * radius * 0.5;
                    const cellY = y + Math.sin(cellAngle) * radius * 0.5;
                    const cellR = radius * 0.3;

                    const cellGrad = ctx.createRadialGradient(cellX, cellY, 0, cellX, cellY, cellR);
                    cellGrad.addColorStop(0, '#ffcc88' + '40');
                    cellGrad.addColorStop(1, 'transparent');
                    ctx.beginPath();
                    ctx.arc(cellX, cellY, cellR, 0, Math.PI * 2);
                    ctx.fillStyle = cellGrad;
                    ctx.fill();
                }
                ctx.restore();
            }
        }

        function animate() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.15)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const centerX = (canvas.width - 340) / 2;
            const centerY = canvas.height / 2;

            if (playing) {
                time += 0.016 * timeScale;

                // Spawn particles
                const rate = currentStar.particleRate * density;
                for (let i = 0; i < rate; i++) {
                    if (Math.random() < rate - Math.floor(rate) || i < Math.floor(rate)) {
                        spawnParticle();
                    }
                }
            }

            // Update and draw particles
            particles = particles.filter(p => {
                if (playing) {
                    p.dist += p.speed * timeScale;
                    p.angle += p.spiral * timeScale;
                    p.life = Math.max(0, 1 - (p.dist - currentStar.radius) / 400);
                }

                if (p.life <= 0 || p.dist > 500) return false;

                const px = centerX + Math.cos(p.angle) * p.dist;
                const py = centerY + Math.sin(p.angle) * p.dist;

                // Trail
                const trailLen = Math.min(p.speed * 3, 20);
                const trailX = centerX + Math.cos(p.angle) * (p.dist - trailLen);
                const trailY = centerY + Math.sin(p.angle) * (p.dist - trailLen);

                const gradient = ctx.createLinearGradient(trailX, trailY, px, py);
                gradient.addColorStop(0, 'transparent');
                gradient.addColorStop(1, p.color + Math.floor(p.life * 200).toString(16).padStart(2, '0'));

                ctx.beginPath();
                ctx.moveTo(trailX, trailY);
                ctx.lineTo(px, py);
                ctx.strokeStyle = gradient;
                ctx.lineWidth = p.size;
                ctx.stroke();

                // Particle head
                ctx.beginPath();
                ctx.arc(px, py, p.size * 0.5, 0, Math.PI * 2);
                ctx.fillStyle = p.color + Math.floor(p.life * 255).toString(16).padStart(2, '0');
                ctx.fill();

                return true;
            });

            // Draw star
            drawStar(centerX, centerY);

            // Update stats
            document.getElementById('particleVal').textContent = particles.length;

            requestAnimationFrame(animate);
        }

        // Event listeners
        document.getElementById('playBtn').addEventListener('click', () => {
            playing = !playing;
            document.getElementById('playBtn').textContent = playing ? '⏸ Pause' : '▶ Play';
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            particles = [];
            time = 0;
        });

        document.getElementById('density').addEventListener('input', (e) => {
            density = parseFloat(e.target.value);
            document.getElementById('densityVal').textContent = density.toFixed(1);
        });

        document.getElementById('timeScale').addEventListener('input', (e) => {
            timeScale = parseFloat(e.target.value);
            document.getElementById('timeVal').textContent = timeScale.toFixed(1);
        });

        createStarTypeList();
        updateUI();
        requestAnimationFrame(animate);
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
