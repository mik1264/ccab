<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Variable Stars - Pulsation and Eclipsing Binaries - CCAB</title>
    <meta name="description" content="Explore different types of variable stars: Cepheids, RR Lyrae, Mira, and eclipsing binaries. Watch their brightness variations over time.">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: linear-gradient(135deg, #05050a 0%, #0a0a1a 100%);
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: #e8e6e1;
            overflow-x: hidden;
        }
        .back-link {
            position: fixed;
            top: 15px; left: 15px;
            padding: 10px 18px;
            background: rgba(0, 0, 0, 0.6);
            color: #60a5fa;
            text-decoration: none;
            border-radius: 8px;
            font-size: 14px;
            z-index: 1000;
            border: 1px solid rgba(96, 165, 250, 0.3);
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 60px 20px 20px;
        }
        h1 { font-size: 2rem; margin-bottom: 10px; color: #60a5fa; text-align: center; }
        .subtitle { text-align: center; color: #888; margin-bottom: 30px; }
        .main-grid {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
        }
        @media (max-width: 900px) {
            .main-grid { grid-template-columns: 1fr; }
        }
        .sidebar {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 20px;
        }
        .sidebar h2 { font-size: 1rem; color: #60a5fa; margin-bottom: 15px; }
        .star-list { list-style: none; }
        .star-item {
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(96, 165, 250, 0.1);
            border: 1px solid rgba(96, 165, 250, 0.2);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .star-item:hover { background: rgba(96, 165, 250, 0.2); }
        .star-item.active {
            background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(139, 92, 246, 0.3));
            border-color: #60a5fa;
        }
        .star-item .name { font-weight: 600; margin-bottom: 3px; }
        .star-item .type { font-size: 0.8rem; color: #888; }
        .visualization {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            overflow: hidden;
        }
        #starCanvas { width: 100%; height: 300px; display: block; }
        #lightCurve { width: 100%; height: 200px; display: block; }
        .info-panel {
            padding: 20px;
            border-top: 1px solid rgba(96, 165, 250, 0.2);
        }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        .info-box {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .info-value { font-size: 1.3rem; color: #60a5fa; font-weight: 600; }
        .info-label { font-size: 0.75rem; color: #888; }
        .description { font-size: 0.9rem; color: #aaa; line-height: 1.6; }
        .controls {
            padding: 15px 20px;
            background: rgba(0,0,0,0.2);
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        .btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
            border: none;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .btn:hover { transform: scale(1.02); }
        .btn.secondary {
            background: rgba(96, 165, 250, 0.2);
            border: 1px solid rgba(96, 165, 250, 0.5);
        }
        .time-display { color: #fbbf24; font-family: monospace; font-size: 1.1rem; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Gallery</a>

    <div class="container">
        <h1>Variable Stars</h1>
        <p class="subtitle">Explore pulsating and eclipsing variable stars</p>

        <div class="main-grid">
            <div class="sidebar">
                <h2>Star Types</h2>
                <ul class="star-list" id="starList"></ul>
            </div>

            <div class="visualization">
                <canvas id="starCanvas"></canvas>
                <canvas id="lightCurve"></canvas>
                <div class="controls">
                    <button class="btn" id="playBtn">▶ Play</button>
                    <button class="btn secondary" id="resetBtn">↺ Reset</button>
                    <select id="speedSelect" style="padding: 10px; border-radius: 8px; background: rgba(96,165,250,0.2); color: white; border: 1px solid rgba(96,165,250,0.5);">
                        <option value="0.5">0.5x Speed</option>
                        <option value="1" selected>1x Speed</option>
                        <option value="2">2x Speed</option>
                        <option value="5">5x Speed</option>
                    </select>
                    <span class="time-display">Phase: <span id="phase">0.00</span></span>
                </div>
                <div class="info-panel">
                    <div class="info-grid" id="infoGrid"></div>
                    <p class="description" id="description"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const starCanvas = document.getElementById('starCanvas');
        const starCtx = starCanvas.getContext('2d');
        const curveCanvas = document.getElementById('lightCurve');
        const curveCtx = curveCanvas.getContext('2d');

        function resize() {
            const container = starCanvas.parentElement;
            starCanvas.width = container.clientWidth;
            starCanvas.height = 300;
            curveCanvas.width = container.clientWidth;
            curveCanvas.height = 200;
        }
        resize();
        window.addEventListener('resize', resize);

        // Variable star data
        const variableStars = [
            {
                id: 'cepheid',
                name: 'Delta Cephei',
                type: 'Classical Cepheid',
                period: 5.366, // days
                amplitude: 0.9, // magnitude
                minMag: 4.37,
                maxMag: 3.48,
                color: { base: '#fff5cc', bright: '#fffae6', dim: '#ffeb99' },
                spectralType: 'F5-G2',
                description: 'Classical Cepheids are supergiant stars that pulsate radially, expanding and contracting. Their period-luminosity relationship makes them invaluable distance indicators.',
                category: 'pulsating'
            },
            {
                id: 'rr-lyrae',
                name: 'RR Lyrae',
                type: 'RR Lyrae Variable',
                period: 0.567, // days
                amplitude: 1.0,
                minMag: 8.12,
                maxMag: 7.06,
                color: { base: '#e0e8ff', bright: '#f0f4ff', dim: '#b0c0ff' },
                spectralType: 'A7-F5',
                description: 'RR Lyrae stars are old, low-mass giants found in globular clusters. They pulsate with shorter periods than Cepheids and serve as Population II distance indicators.',
                category: 'pulsating'
            },
            {
                id: 'mira',
                name: 'Mira (ο Ceti)',
                type: 'Mira Variable',
                period: 332, // days
                amplitude: 6.0,
                minMag: 10.1,
                maxMag: 2.0,
                color: { base: '#ff6b4a', bright: '#ff8866', dim: '#cc3300' },
                spectralType: 'M5-M9',
                description: 'Mira variables are red giant stars with very long periods and large amplitude variations. They are in late stages of stellar evolution, shedding their outer layers.',
                category: 'pulsating'
            },
            {
                id: 'algol',
                name: 'Algol (β Persei)',
                type: 'Eclipsing Binary',
                period: 2.867, // days
                amplitude: 1.3,
                minMag: 3.39,
                maxMag: 2.12,
                color: { base: '#ffffff', bright: '#ffffff', dim: '#cccccc' },
                spectralType: 'B8 + K2',
                description: 'Algol is the prototype eclipsing binary. Its brightness drops when the dimmer companion passes in front of the brighter primary star as seen from Earth.',
                category: 'eclipsing',
                companion: { ratio: 0.6, color: '#ffaa66' }
            },
            {
                id: 'beta-lyrae',
                name: 'β Lyrae',
                type: 'Semi-detached Binary',
                period: 12.94, // days
                amplitude: 1.0,
                minMag: 4.36,
                maxMag: 3.25,
                color: { base: '#aaccff', bright: '#ccddff', dim: '#6699cc' },
                spectralType: 'B7 + B',
                description: 'Beta Lyrae systems feature mass transfer between stars, creating complex light curves with continuous brightness variations and no flat sections.',
                category: 'eclipsing',
                companion: { ratio: 0.7, color: '#ffcc88' }
            },
            {
                id: 'w-uma',
                name: 'W Ursae Majoris',
                type: 'Contact Binary',
                period: 0.334, // days
                amplitude: 0.75,
                minMag: 8.48,
                maxMag: 7.75,
                color: { base: '#ffe0aa', bright: '#fff0cc', dim: '#ffcc66' },
                spectralType: 'F8 + F8',
                description: 'Contact binaries share a common envelope, with both stars filling their Roche lobes. They show continuous ellipsoidal variations with nearly equal minima.',
                category: 'eclipsing',
                companion: { ratio: 0.95, color: '#ffe0aa' }
            }
        ];

        let currentStar = variableStars[0];
        let phase = 0;
        let playing = false;
        let speed = 1;
        let history = [];
        const maxHistory = 200;

        // Create star list
        function createStarList() {
            const list = document.getElementById('starList');
            list.innerHTML = '';
            variableStars.forEach(star => {
                const li = document.createElement('li');
                li.className = 'star-item' + (star.id === currentStar.id ? ' active' : '');
                li.innerHTML = `
                    <div class="name">${star.name}</div>
                    <div class="type">${star.type}</div>
                `;
                li.addEventListener('click', () => selectStar(star));
                list.appendChild(li);
            });
        }

        function selectStar(star) {
            currentStar = star;
            phase = 0;
            history = [];
            createStarList();
            updateInfo();
        }

        function updateInfo() {
            const grid = document.getElementById('infoGrid');
            grid.innerHTML = `
                <div class="info-box">
                    <div class="info-value">${currentStar.period.toFixed(3)}</div>
                    <div class="info-label">Period (days)</div>
                </div>
                <div class="info-box">
                    <div class="info-value">${currentStar.amplitude.toFixed(2)}</div>
                    <div class="info-label">Amplitude (mag)</div>
                </div>
                <div class="info-box">
                    <div class="info-value">${currentStar.maxMag.toFixed(2)}</div>
                    <div class="info-label">Max Brightness</div>
                </div>
                <div class="info-box">
                    <div class="info-value">${currentStar.minMag.toFixed(2)}</div>
                    <div class="info-label">Min Brightness</div>
                </div>
                <div class="info-box">
                    <div class="info-value">${currentStar.spectralType}</div>
                    <div class="info-label">Spectral Type</div>
                </div>
            `;
            document.getElementById('description').textContent = currentStar.description;
        }

        function getBrightness(p) {
            // Returns brightness from 0 (dimmest) to 1 (brightest)
            if (currentStar.category === 'pulsating') {
                // Asymmetric pulsation - fast rise, slow decline
                const normalized = p % 1;
                if (normalized < 0.3) {
                    // Rising
                    return 0.5 + 0.5 * Math.sin((normalized / 0.3) * Math.PI / 2);
                } else {
                    // Declining
                    return 1 - 0.5 * (1 - Math.cos(((normalized - 0.3) / 0.7) * Math.PI));
                }
            } else {
                // Eclipsing binary
                const normalized = p % 1;
                let brightness = 1;

                // Primary eclipse (deeper)
                if (normalized < 0.1 || normalized > 0.9) {
                    const dist = normalized < 0.1 ? normalized : 1 - normalized;
                    const eclipseDepth = 1 - Math.pow(dist / 0.1, 2);
                    brightness -= eclipseDepth * 0.6;
                }
                // Secondary eclipse
                else if (normalized > 0.45 && normalized < 0.55) {
                    const dist = Math.abs(normalized - 0.5);
                    const eclipseDepth = 1 - Math.pow(dist / 0.05, 2);
                    brightness -= eclipseDepth * 0.3;
                }

                // Ellipsoidal variation for contact binaries
                if (currentStar.id === 'w-uma') {
                    brightness += 0.1 * Math.sin(normalized * Math.PI * 4);
                }

                return brightness;
            }
        }

        function drawStar() {
            starCtx.fillStyle = '#05050a';
            starCtx.fillRect(0, 0, starCanvas.width, starCanvas.height);

            // Background stars
            for (let i = 0; i < 80; i++) {
                const x = (i * 137.5) % starCanvas.width;
                const y = (i * 97.3) % starCanvas.height;
                starCtx.beginPath();
                starCtx.arc(x, y, 0.5 + Math.random(), 0, Math.PI * 2);
                starCtx.fillStyle = `rgba(255,255,255,${0.2 + Math.random() * 0.3})`;
                starCtx.fill();
            }

            const centerX = starCanvas.width / 2;
            const centerY = starCanvas.height / 2;
            const brightness = getBrightness(phase);
            const baseRadius = 50;

            if (currentStar.category === 'pulsating') {
                // Pulsating star - size and color change
                const sizeVar = currentStar.id === 'mira' ? 0.3 : 0.15;
                const radius = baseRadius * (1 + sizeVar * (brightness - 0.5));

                // Color temperature variation
                const color = brightness > 0.5 ? currentStar.color.bright : currentStar.color.dim;

                // Glow
                const gradient = starCtx.createRadialGradient(centerX, centerY, 0, centerX, centerY, radius * 3);
                gradient.addColorStop(0, color);
                gradient.addColorStop(0.3, color + '80');
                gradient.addColorStop(1, 'transparent');
                starCtx.beginPath();
                starCtx.arc(centerX, centerY, radius * 3, 0, Math.PI * 2);
                starCtx.fillStyle = gradient;
                starCtx.fill();

                // Star body
                const bodyGradient = starCtx.createRadialGradient(
                    centerX - radius * 0.2, centerY - radius * 0.2, 0,
                    centerX, centerY, radius
                );
                bodyGradient.addColorStop(0, '#ffffff');
                bodyGradient.addColorStop(0.5, color);
                bodyGradient.addColorStop(1, currentStar.color.dim);

                starCtx.beginPath();
                starCtx.arc(centerX, centerY, radius, 0, Math.PI * 2);
                starCtx.fillStyle = bodyGradient;
                starCtx.fill();

                // Label
                starCtx.font = '14px Arial';
                starCtx.fillStyle = '#aaa';
                starCtx.textAlign = 'center';
                starCtx.fillText(currentStar.name, centerX, centerY + radius + 25);
                starCtx.fillText(`Phase: ${(phase % 1).toFixed(2)}`, centerX, centerY + radius + 45);

            } else {
                // Eclipsing binary
                const separation = 80;
                const normalized = phase % 1;

                // Calculate positions (simplified circular orbit, viewed edge-on)
                const orbitAngle = normalized * Math.PI * 2;
                const star1X = centerX - Math.sin(orbitAngle) * separation / 2;
                const star2X = centerX + Math.sin(orbitAngle) * separation / 2;
                const star1Z = Math.cos(orbitAngle);
                const star2Z = -Math.cos(orbitAngle);

                // Draw background star first
                const drawOrder = star1Z > star2Z ? [2, 1] : [1, 2];

                drawOrder.forEach(starNum => {
                    const x = starNum === 1 ? star1X : star2X;
                    const isPrimary = starNum === 1;
                    const radius = isPrimary ? baseRadius : baseRadius * (currentStar.companion?.ratio || 0.6);
                    const color = isPrimary ? currentStar.color.base : (currentStar.companion?.color || '#ffaa66');

                    // Glow
                    const gradient = starCtx.createRadialGradient(x, centerY, 0, x, centerY, radius * 2);
                    gradient.addColorStop(0, color + 'aa');
                    gradient.addColorStop(1, 'transparent');
                    starCtx.beginPath();
                    starCtx.arc(x, centerY, radius * 2, 0, Math.PI * 2);
                    starCtx.fillStyle = gradient;
                    starCtx.fill();

                    // Star body
                    const bodyGradient = starCtx.createRadialGradient(
                        x - radius * 0.2, centerY - radius * 0.2, 0,
                        x, centerY, radius
                    );
                    bodyGradient.addColorStop(0, '#ffffff');
                    bodyGradient.addColorStop(0.5, color);
                    bodyGradient.addColorStop(1, color + '88');

                    starCtx.beginPath();
                    starCtx.arc(x, centerY, radius, 0, Math.PI * 2);
                    starCtx.fillStyle = bodyGradient;
                    starCtx.fill();
                });

                // Labels
                starCtx.font = '14px Arial';
                starCtx.fillStyle = '#aaa';
                starCtx.textAlign = 'center';
                starCtx.fillText(currentStar.name, centerX, centerY + 100);
                starCtx.fillText(`Phase: ${normalized.toFixed(2)}`, centerX, centerY + 120);
            }
        }

        function drawLightCurve() {
            curveCtx.fillStyle = '#0a0a1a';
            curveCtx.fillRect(0, 0, curveCanvas.width, curveCanvas.height);

            const padding = { left: 50, right: 20, top: 20, bottom: 30 };
            const width = curveCanvas.width - padding.left - padding.right;
            const height = curveCanvas.height - padding.top - padding.bottom;

            // Grid
            curveCtx.strokeStyle = 'rgba(255,255,255,0.1)';
            curveCtx.lineWidth = 1;

            for (let i = 0; i <= 4; i++) {
                const y = padding.top + (i / 4) * height;
                curveCtx.beginPath();
                curveCtx.moveTo(padding.left, y);
                curveCtx.lineTo(curveCanvas.width - padding.right, y);
                curveCtx.stroke();
            }

            // Phase markers
            for (let p = 0; p <= 2; p += 0.5) {
                const x = padding.left + (p / 2) * width;
                curveCtx.beginPath();
                curveCtx.moveTo(x, padding.top);
                curveCtx.lineTo(x, curveCanvas.height - padding.bottom);
                curveCtx.stroke();

                curveCtx.fillStyle = '#888';
                curveCtx.font = '11px Arial';
                curveCtx.textAlign = 'center';
                curveCtx.fillText(p.toFixed(1), x, curveCanvas.height - 10);
            }

            // Axis labels
            curveCtx.fillStyle = '#888';
            curveCtx.font = '12px Arial';
            curveCtx.textAlign = 'center';
            curveCtx.fillText('Phase', curveCanvas.width / 2, curveCanvas.height - 5);

            curveCtx.save();
            curveCtx.translate(12, curveCanvas.height / 2);
            curveCtx.rotate(-Math.PI / 2);
            curveCtx.fillText('Brightness', 0, 0);
            curveCtx.restore();

            // Theoretical curve
            curveCtx.beginPath();
            curveCtx.strokeStyle = 'rgba(96, 165, 250, 0.3)';
            curveCtx.lineWidth = 2;

            for (let p = 0; p <= 2; p += 0.01) {
                const x = padding.left + (p / 2) * width;
                const b = getBrightness(p);
                const y = padding.top + (1 - b) * height;

                if (p === 0) curveCtx.moveTo(x, y);
                else curveCtx.lineTo(x, y);
            }
            curveCtx.stroke();

            // History trace
            if (history.length > 1) {
                curveCtx.beginPath();
                curveCtx.strokeStyle = '#60a5fa';
                curveCtx.lineWidth = 2;

                history.forEach((point, i) => {
                    const x = padding.left + (point.phase / 2) * width;
                    const y = padding.top + (1 - point.brightness) * height;

                    if (i === 0) curveCtx.moveTo(x, y);
                    else curveCtx.lineTo(x, y);
                });
                curveCtx.stroke();
            }

            // Current point
            const currentBrightness = getBrightness(phase);
            const currentX = padding.left + ((phase % 2) / 2) * width;
            const currentY = padding.top + (1 - currentBrightness) * height;

            curveCtx.beginPath();
            curveCtx.arc(currentX, currentY, 6, 0, Math.PI * 2);
            curveCtx.fillStyle = '#fbbf24';
            curveCtx.fill();

            // Glow on current point
            const gradient = curveCtx.createRadialGradient(currentX, currentY, 0, currentX, currentY, 15);
            gradient.addColorStop(0, 'rgba(251, 191, 36, 0.5)');
            gradient.addColorStop(1, 'transparent');
            curveCtx.beginPath();
            curveCtx.arc(currentX, currentY, 15, 0, Math.PI * 2);
            curveCtx.fillStyle = gradient;
            curveCtx.fill();
        }

        function animate(time) {
            if (playing) {
                // Advance phase based on period
                const dt = 0.016 * speed;
                phase += dt / currentStar.period;

                // Add to history
                const brightness = getBrightness(phase);
                history.push({ phase: phase % 2, brightness });
                if (history.length > maxHistory) history.shift();
            }

            document.getElementById('phase').textContent = (phase % 1).toFixed(3);

            drawStar();
            drawLightCurve();
            requestAnimationFrame(animate);
        }

        // Event listeners
        document.getElementById('playBtn').addEventListener('click', () => {
            playing = !playing;
            document.getElementById('playBtn').textContent = playing ? '⏸ Pause' : '▶ Play';
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            phase = 0;
            history = [];
            playing = false;
            document.getElementById('playBtn').textContent = '▶ Play';
        });

        document.getElementById('speedSelect').addEventListener('change', (e) => {
            speed = parseFloat(e.target.value);
        });

        createStarList();
        updateInfo();
        requestAnimationFrame(animate);
    </script>
</body>
</html>
