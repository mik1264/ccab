<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R-Process Nucleosynthesis - Rapid Neutron Capture - CCAB</title>
    <meta name="description" content="Visualize rapid neutron capture in neutron star mergers. Watch superheavy elements form in milliseconds.">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: linear-gradient(135deg, #0a0814 0%, #2a0a1e 100%);
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: #e8e6e1;
            overflow: hidden;
        }
        .back-link {
            position: fixed;
            top: 15px; left: 15px;
            padding: 10px 18px;
            background: rgba(0, 0, 0, 0.6);
            color: #ef4444;
            text-decoration: none;
            border-radius: 8px;
            font-size: 14px;
            z-index: 1000;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        #canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; }
        #panel {
            position: fixed;
            right: 0; top: 0;
            width: 380px; height: 100%;
            background: rgba(10, 8, 20, 0.95);
            padding: 70px 20px 20px;
            border-left: 1px solid rgba(239, 68, 68, 0.2);
            overflow-y: auto;
        }
        h1 { font-size: 1.3rem; margin-bottom: 10px; color: #ef4444; }
        h2 { font-size: 0.95rem; margin: 15px 0 10px; color: #ef4444; }
        .desc { font-size: 0.82rem; line-height: 1.6; color: #aaa; margin-bottom: 15px; }
        .controls { margin-bottom: 15px; }
        .btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border: none;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-right: 8px;
            margin-bottom: 8px;
        }
        .btn:hover { transform: scale(1.02); }
        .btn.secondary {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.5);
        }
        .event-display {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(168, 85, 247, 0.2));
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }
        .event-display .event-type {
            font-size: 1.5rem;
            color: #ef4444;
            font-weight: 700;
            margin-bottom: 5px;
        }
        .timer {
            font-family: 'Courier New', monospace;
            font-size: 2rem;
            color: #fbbf24;
            text-align: center;
            margin: 10px 0;
        }
        .element-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 4px;
            margin: 15px 0;
        }
        .element-cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            background: rgba(0,0,0,0.3);
            border-radius: 4px;
            color: #666;
            transition: all 0.3s;
        }
        .element-cell.active {
            background: linear-gradient(135deg, #ef4444, #a855f7);
            color: white;
            font-weight: 600;
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
        }
        .element-cell.gold {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: black;
        }
        .element-cell.platinum {
            background: linear-gradient(135deg, #94a3b8, #64748b);
            color: white;
        }
        .element-cell.uranium {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }
        .stat-box {
            background: rgba(0,0,0,0.3);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-value { font-size: 1.3rem; color: #ef4444; font-weight: 600; }
        .stat-label { font-size: 0.7rem; color: #888; }
        .neutron-density {
            height: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .neutron-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ef4444);
            transition: width 0.1s;
        }
        .comparison {
            font-size: 0.75rem;
            color: #888;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            margin-top: 10px;
        }
        .comparison strong { color: #ef4444; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Gallery</a>
    <canvas id="canvas"></canvas>

    <div id="panel">
        <h1>R-Process Nucleosynthesis</h1>
        <p class="desc">
            The rapid neutron capture process occurs in extreme environments like neutron star mergers.
            Nuclei capture hundreds of neutrons in milliseconds before decay can occur, creating
            the heaviest elements in the universe.
        </p>

        <div class="event-display">
            <div class="event-type" id="eventType">NEUTRON STAR MERGER</div>
            <div id="eventDesc">GW170817 - First observed r-process event</div>
        </div>

        <div class="timer" id="timer">t = 0.000 ms</div>

        <div class="controls">
            <button class="btn" id="mergeBtn">üåü Trigger Merger</button>
            <button class="btn secondary" id="resetBtn">‚Ü∫ Reset</button>
        </div>

        <h2>Neutron Density</h2>
        <div class="neutron-density">
            <div class="neutron-fill" id="densityFill" style="width: 100%"></div>
        </div>
        <div style="font-size: 0.75rem; color: #888;">
            n = <span id="densityVal">10¬≤‚Å∂</span> neutrons/cm¬≥
        </div>

        <h2>Elements Created</h2>
        <div class="element-grid" id="elementGrid"></div>

        <div class="stats-grid">
            <div class="stat-box">
                <div class="stat-value" id="massNum">56</div>
                <div class="stat-label">Current Mass #</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="atomicNum">26</div>
                <div class="stat-label">Atomic # (Z)</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="captures">0</div>
                <div class="stat-label">n Captures</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="decays">0</div>
                <div class="stat-label">Œ≤ Decays</div>
            </div>
        </div>

        <h2>Notable Elements Formed</h2>
        <div class="comparison">
            <strong>Gold (Z=79):</strong> All gold on Earth came from r-process events<br><br>
            <strong>Platinum (Z=78):</strong> Extremely rare, formed in neutron star mergers<br><br>
            <strong>Uranium (Z=92):</strong> The heaviest naturally occurring element
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resize();
        window.addEventListener('resize', resize);

        // Heavy elements with notable ones highlighted
        const heavyElements = [];
        for (let z = 26; z <= 98; z++) {
            const symbols = ['Fe','Co','Ni','Cu','Zn','Ga','Ge','As','Se','Br',
                           'Kr','Rb','Sr','Y','Zr','Nb','Mo','Tc','Ru','Rh',
                           'Pd','Ag','Cd','In','Sn','Sb','Te','I','Xe','Cs',
                           'Ba','La','Ce','Pr','Nd','Pm','Sm','Eu','Gd','Tb',
                           'Dy','Ho','Er','Tm','Yb','Lu','Hf','Ta','W','Re',
                           'Os','Ir','Pt','Au','Hg','Tl','Pb','Bi','Po','At',
                           'Rn','Fr','Ra','Ac','Th','Pa','U','Np','Pu','Am',
                           'Cm','Bk','Cf'];
            heavyElements.push({
                Z: z,
                symbol: symbols[z - 26] || '?',
                created: false
            });
        }

        // State
        let merging = false;
        let time = 0;
        let currentZ = 26;
        let currentA = 56;
        let captures = 0;
        let decays = 0;
        let neutronDensity = 1;
        let neutrons = [];
        let explosionParticles = [];
        let nucleusX, nucleusY;
        let mergerPhase = 0; // 0=idle, 1=approaching, 2=collision, 3=r-process, 4=cooling

        // Create element grid
        function createElementGrid() {
            const grid = document.getElementById('elementGrid');
            grid.innerHTML = '';
            heavyElements.forEach(el => {
                const cell = document.createElement('div');
                cell.className = 'element-cell';
                cell.id = `el-${el.Z}`;
                cell.textContent = el.symbol;
                if (el.Z === 79) cell.classList.add('gold');
                else if (el.Z === 78) cell.classList.add('platinum');
                else if (el.Z === 92) cell.classList.add('uranium');
                grid.appendChild(cell);
            });
        }
        createElementGrid();

        function updateUI() {
            document.getElementById('timer').textContent = `t = ${time.toFixed(3)} ms`;
            document.getElementById('massNum').textContent = currentA;
            document.getElementById('atomicNum').textContent = currentZ;
            document.getElementById('captures').textContent = captures;
            document.getElementById('decays').textContent = decays;

            const densityPercent = neutronDensity * 100;
            document.getElementById('densityFill').style.width = densityPercent + '%';

            const exponent = Math.floor(26 * neutronDensity);
            document.getElementById('densityVal').textContent = `10^${exponent}`;

            // Update element grid
            heavyElements.forEach(el => {
                const cell = document.getElementById(`el-${el.Z}`);
                if (el.created && !cell.classList.contains('active')) {
                    cell.classList.add('active');
                }
            });

            // Event description
            if (mergerPhase === 0) {
                document.getElementById('eventType').textContent = 'READY TO MERGE';
                document.getElementById('eventDesc').textContent = 'Click to simulate neutron star collision';
            } else if (mergerPhase === 1) {
                document.getElementById('eventType').textContent = 'STARS APPROACHING';
                document.getElementById('eventDesc').textContent = 'Gravitational waves intensifying';
            } else if (mergerPhase === 2) {
                document.getElementById('eventType').textContent = 'COLLISION!';
                document.getElementById('eventDesc').textContent = 'Neutron-rich matter ejected';
            } else if (mergerPhase === 3) {
                document.getElementById('eventType').textContent = 'R-PROCESS ACTIVE';
                document.getElementById('eventDesc').textContent = 'Rapid neutron capture underway';
            } else {
                document.getElementById('eventType').textContent = 'KILONOVA';
                document.getElementById('eventDesc').textContent = 'Radioactive decay powers afterglow';
            }
        }

        function drawNeutronStar(x, y, radius, phase) {
            // Intense magnetic field lines
            ctx.strokeStyle = 'rgba(100, 200, 255, 0.3)';
            ctx.lineWidth = 2;
            for (let i = 0; i < 8; i++) {
                const angle = (i / 8) * Math.PI * 2 + Date.now() * 0.001;
                ctx.beginPath();
                ctx.moveTo(x, y);
                const endX = x + Math.cos(angle) * radius * 3;
                const endY = y + Math.sin(angle) * radius * 3;
                ctx.lineTo(endX, endY);
                ctx.stroke();
            }

            // Core
            const gradient = ctx.createRadialGradient(x, y, 0, x, y, radius);
            gradient.addColorStop(0, '#ffffff');
            gradient.addColorStop(0.3, '#64b5f6');
            gradient.addColorStop(0.7, '#1565c0');
            gradient.addColorStop(1, '#0d47a1');

            ctx.beginPath();
            ctx.arc(x, y, radius, 0, Math.PI * 2);
            ctx.fillStyle = gradient;
            ctx.fill();

            // Surface details
            ctx.save();
            ctx.beginPath();
            ctx.arc(x, y, radius, 0, Math.PI * 2);
            ctx.clip();
            for (let i = 0; i < 20; i++) {
                const sx = x + (Math.random() - 0.5) * radius * 2;
                const sy = y + (Math.random() - 0.5) * radius * 2;
                ctx.beginPath();
                ctx.arc(sx, sy, 2, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(255,255,255,0.5)';
                ctx.fill();
            }
            ctx.restore();
        }

        function drawExplosion(x, y, intensity) {
            const gradient = ctx.createRadialGradient(x, y, 0, x, y, 400 * intensity);
            gradient.addColorStop(0, `rgba(255, 255, 255, ${intensity})`);
            gradient.addColorStop(0.2, `rgba(255, 200, 100, ${intensity * 0.8})`);
            gradient.addColorStop(0.5, `rgba(255, 100, 50, ${intensity * 0.5})`);
            gradient.addColorStop(0.8, `rgba(150, 50, 200, ${intensity * 0.3})`);
            gradient.addColorStop(1, 'transparent');

            ctx.beginPath();
            ctx.arc(x, y, 400 * intensity, 0, Math.PI * 2);
            ctx.fillStyle = gradient;
            ctx.fill();
        }

        function drawNucleus(x, y, z, a) {
            const radius = 30 + z * 0.3;

            // Glow for heavy elements
            if (z > 70) {
                const glowGradient = ctx.createRadialGradient(x, y, radius, x, y, radius * 2);
                glowGradient.addColorStop(0, 'rgba(239, 68, 68, 0.5)');
                glowGradient.addColorStop(1, 'transparent');
                ctx.beginPath();
                ctx.arc(x, y, radius * 2, 0, Math.PI * 2);
                ctx.fillStyle = glowGradient;
                ctx.fill();
            }

            // Nucleus with color based on Z
            const hue = 360 - (z - 26) * 3;
            const gradient = ctx.createRadialGradient(x - radius * 0.2, y - radius * 0.2, 0, x, y, radius);
            gradient.addColorStop(0, `hsl(${hue}, 80%, 70%)`);
            gradient.addColorStop(0.5, `hsl(${hue}, 80%, 50%)`);
            gradient.addColorStop(1, `hsl(${hue}, 80%, 30%)`);

            ctx.beginPath();
            ctx.arc(x, y, radius, 0, Math.PI * 2);
            ctx.fillStyle = gradient;
            ctx.fill();

            // Element symbol
            const el = heavyElements.find(e => e.Z === z);
            ctx.font = 'bold 18px Arial';
            ctx.fillStyle = 'white';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(el ? el.symbol : '?', x, y);

            // Mass number
            ctx.font = '10px Arial';
            ctx.fillText(`A=${a}`, x, y + radius + 12);
        }

        let star1 = { x: 0, y: 0 };
        let star2 = { x: 0, y: 0 };
        let explosionIntensity = 0;

        function animate(timestamp) {
            ctx.fillStyle = 'rgba(10, 8, 20, 0.2)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const centerX = (canvas.width - 380) / 2;
            const centerY = canvas.height / 2;

            // Background stars
            for (let i = 0; i < 100; i++) {
                const sx = (i * 137.5) % (canvas.width - 380);
                const sy = (i * 97.3) % canvas.height;
                const brightness = 0.3 + 0.7 * Math.sin(timestamp * 0.001 + i);
                ctx.beginPath();
                ctx.arc(sx, sy, 1, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(255, 255, 255, ${brightness * 0.3})`;
                ctx.fill();
            }

            if (merging) {
                time += 0.016;

                if (mergerPhase === 1) {
                    // Approaching phase
                    const approachProgress = Math.min(1, time / 2);
                    const separation = 300 * (1 - approachProgress * 0.9);

                    star1.x = centerX - separation;
                    star1.y = centerY;
                    star2.x = centerX + separation;
                    star2.y = centerY;

                    drawNeutronStar(star1.x, star1.y, 40, 1);
                    drawNeutronStar(star2.x, star2.y, 40, 1);

                    // Gravitational wave visualization
                    for (let i = 0; i < 5; i++) {
                        const waveRadius = ((timestamp * 0.1 + i * 100) % 500);
                        ctx.beginPath();
                        ctx.arc(centerX, centerY, waveRadius, 0, Math.PI * 2);
                        ctx.strokeStyle = `rgba(100, 200, 255, ${0.3 * (1 - waveRadius / 500)})`;
                        ctx.lineWidth = 2;
                        ctx.stroke();
                    }

                    if (approachProgress >= 1) {
                        mergerPhase = 2;
                        time = 0;
                        explosionIntensity = 1;
                    }
                } else if (mergerPhase === 2) {
                    // Collision phase
                    explosionIntensity = Math.max(0, 1 - time * 0.5);
                    drawExplosion(centerX, centerY, explosionIntensity);

                    // Spawn lots of neutrons
                    if (time < 1) {
                        for (let i = 0; i < 10; i++) {
                            const angle = Math.random() * Math.PI * 2;
                            const speed = 2 + Math.random() * 4;
                            neutrons.push({
                                x: centerX + (Math.random() - 0.5) * 100,
                                y: centerY + (Math.random() - 0.5) * 100,
                                vx: Math.cos(angle) * speed,
                                vy: Math.sin(angle) * speed,
                                life: 1
                            });
                        }
                    }

                    if (time > 0.5) {
                        mergerPhase = 3;
                        time = 0;
                        nucleusX = centerX;
                        nucleusY = centerY;
                    }
                } else if (mergerPhase === 3) {
                    // R-process phase - rapid captures
                    const captureRate = 50; // captures per ms

                    if (neutronDensity > 0.01) {
                        // Capture neutrons rapidly
                        const newCaptures = Math.floor(captureRate * 0.016);
                        for (let i = 0; i < newCaptures; i++) {
                            currentA++;
                            captures++;

                            // Spawn visual neutron coming in
                            if (Math.random() < 0.3) {
                                const angle = Math.random() * Math.PI * 2;
                                neutrons.push({
                                    x: nucleusX + Math.cos(angle) * 150,
                                    y: nucleusY + Math.sin(angle) * 150,
                                    vx: -Math.cos(angle) * 8,
                                    vy: -Math.sin(angle) * 8,
                                    life: 0.5
                                });
                            }

                            // Occasional beta decay cascade
                            if (currentA - currentZ > currentZ * 1.5 && Math.random() < 0.2) {
                                currentZ++;
                                decays++;
                                heavyElements.find(e => e.Z === currentZ).created = true;

                                // Decay particle
                                const angle = Math.random() * Math.PI * 2;
                                explosionParticles.push({
                                    x: nucleusX,
                                    y: nucleusY,
                                    vx: Math.cos(angle) * 3,
                                    vy: Math.sin(angle) * 3,
                                    life: 1,
                                    color: '#ef4444'
                                });
                            }
                        }

                        neutronDensity -= 0.0002;
                    } else {
                        // Transition to decay phase
                        mergerPhase = 4;
                        time = 0;
                    }

                    drawNucleus(nucleusX, nucleusY, currentZ, currentA);
                } else if (mergerPhase === 4) {
                    // Kilonova cooling phase - mostly decays
                    if (currentA - currentZ > currentZ * 0.5) {
                        if (Math.random() < 0.1) {
                            currentZ++;
                            decays++;
                            if (currentZ <= 98) {
                                const el = heavyElements.find(e => e.Z === currentZ);
                                if (el) el.created = true;
                            }
                        }
                    }

                    // Kilonova glow
                    const glowRadius = 200 + time * 20;
                    const glowIntensity = Math.max(0.1, 0.5 - time * 0.02);
                    const gradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, glowRadius);
                    gradient.addColorStop(0, `rgba(255, 100, 100, ${glowIntensity})`);
                    gradient.addColorStop(0.5, `rgba(200, 50, 150, ${glowIntensity * 0.5})`);
                    gradient.addColorStop(1, 'transparent');
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, glowRadius, 0, Math.PI * 2);
                    ctx.fillStyle = gradient;
                    ctx.fill();

                    drawNucleus(nucleusX, nucleusY, Math.min(currentZ, 98), currentA);
                }
            } else {
                // Idle state
                star1.x = centerX - 150;
                star1.y = centerY;
                star2.x = centerX + 150;
                star2.y = centerY;

                drawNeutronStar(star1.x, star1.y, 50, 0);
                drawNeutronStar(star2.x, star2.y, 50, 0);

                ctx.font = '14px Arial';
                ctx.fillStyle = '#888';
                ctx.textAlign = 'center';
                ctx.fillText('Two neutron stars in binary orbit', centerX, centerY + 100);
            }

            // Draw neutrons
            neutrons = neutrons.filter(n => {
                n.x += n.vx;
                n.y += n.vy;
                n.life -= 0.02;

                if (n.life <= 0) return false;

                ctx.beginPath();
                ctx.arc(n.x, n.y, 4, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(59, 130, 246, ${n.life})`;
                ctx.fill();

                return true;
            });

            // Draw explosion particles
            explosionParticles = explosionParticles.filter(p => {
                p.x += p.vx;
                p.y += p.vy;
                p.life -= 0.015;

                if (p.life <= 0) return false;

                ctx.beginPath();
                ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
                ctx.fillStyle = p.color.replace(')', `, ${p.life})`).replace('rgb', 'rgba');
                ctx.fill();

                return true;
            });

            updateUI();
            requestAnimationFrame(animate);
        }

        // Event listeners
        document.getElementById('mergeBtn').addEventListener('click', () => {
            if (!merging) {
                merging = true;
                mergerPhase = 1;
                time = 0;
                document.getElementById('mergeBtn').textContent = '‚è≥ In Progress...';
                document.getElementById('mergeBtn').disabled = true;
            }
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            merging = false;
            mergerPhase = 0;
            time = 0;
            currentZ = 26;
            currentA = 56;
            captures = 0;
            decays = 0;
            neutronDensity = 1;
            neutrons = [];
            explosionParticles = [];
            explosionIntensity = 0;

            heavyElements.forEach(el => {
                el.created = false;
                document.getElementById(`el-${el.Z}`).classList.remove('active');
            });

            document.getElementById('mergeBtn').textContent = 'üåü Trigger Merger';
            document.getElementById('mergeBtn').disabled = false;
            updateUI();
        });

        updateUI();
        requestAnimationFrame(animate);
    </script>
</body>
</html>
