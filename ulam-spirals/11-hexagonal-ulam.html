<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hexagonal Ulam Spiral</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0a0a0f; overflow: hidden; font-family: system-ui; }
        canvas { display: block; }
        .back-link {
            position: fixed; top: 20px; left: 20px; z-index: 100;
            color: #8A9A5B; text-decoration: none;
            background: rgba(0,0,0,0.7); padding: 10px 20px; border-radius: 25px;
            font-size: 14px; transition: all 0.3s;
        }
        .back-link:hover { background: rgba(138,154,91,0.3); }
        .info {
            position: fixed; bottom: 20px; left: 20px; z-index: 100;
            background: rgba(0,0,0,0.85); padding: 20px; border-radius: 15px;
            color: white; font-size: 14px; max-width: 300px;
        }
        .info h3 { color: #DDA15E; margin-bottom: 10px; }
        .controls {
            position: fixed; top: 20px; right: 20px; z-index: 100;
            background: rgba(0,0,0,0.8); padding: 15px 20px; border-radius: 10px;
        }
        .controls label { color: white; display: block; margin: 8px 0; font-size: 14px; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Gallery</a>
    <div class="controls">
        <label>Size: <span id="sizeVal">15</span>
            <input type="range" id="size" min="5" max="30" value="15">
        </label>
    </div>
    <div class="info">
        <h3>Hexagonal Prime Spiral</h3>
        <p>The Ulam spiral on a hexagonal grid. Each cell has 6 neighbors instead of 4, creating different diagonal patterns for primes.</p>
    </div>
    <canvas id="canvas"></canvas>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let hexRadius = 15;
        const maxN = 10000;

        // Sieve
        const isPrimeArr = new Array(maxN + 1).fill(true);
        isPrimeArr[0] = isPrimeArr[1] = false;
        for (let i = 2; i * i <= maxN; i++) {
            if (isPrimeArr[i]) {
                for (let j = i * i; j <= maxN; j += i) {
                    isPrimeArr[j] = false;
                }
            }
        }

        // Hexagonal spiral coordinates
        // Direction vectors for hex grid (pointy-top)
        const hexDirs = [
            { q: 1, r: 0 },   // E
            { q: 0, r: 1 },   // SE
            { q: -1, r: 1 },  // SW
            { q: -1, r: 0 },  // W
            { q: 0, r: -1 },  // NW
            { q: 1, r: -1 }   // NE
        ];

        function getHexSpiralCoord(n) {
            if (n === 1) return { q: 0, r: 0 };

            let q = 0, r = 0;
            let dir = 0;
            let steps = 1;
            let stepCount = 0;
            let turnCount = 0;

            for (let i = 2; i <= n; i++) {
                q += hexDirs[dir].q;
                r += hexDirs[dir].r;
                stepCount++;

                if (stepCount === steps) {
                    stepCount = 0;
                    dir = (dir + 1) % 6;
                    turnCount++;
                    if (turnCount === 2) {
                        turnCount = 0;
                        steps++;
                    }
                }
            }
            return { q, r };
        }

        function hexToPixel(q, r, size) {
            const x = size * (Math.sqrt(3) * q + Math.sqrt(3) / 2 * r);
            const y = size * (3 / 2 * r);
            return { x, y };
        }

        function drawHex(cx, cy, size, fill, stroke) {
            ctx.beginPath();
            for (let i = 0; i < 6; i++) {
                const angle = Math.PI / 180 * (60 * i - 30);
                const x = cx + size * Math.cos(angle);
                const y = cy + size * Math.sin(angle);
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.closePath();
            if (fill) {
                ctx.fillStyle = fill;
                ctx.fill();
            }
            if (stroke) {
                ctx.strokeStyle = stroke;
                ctx.lineWidth = 1;
                ctx.stroke();
            }
        }

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            draw();
        }

        function draw() {
            const offsetX = canvas.width / 2;
            const offsetY = canvas.height / 2;

            ctx.fillStyle = '#0a0a0f';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Calculate how many numbers fit on screen
            const maxVisible = Math.min(maxN, 3000);

            for (let n = 1; n <= maxVisible; n++) {
                const { q, r } = getHexSpiralCoord(n);
                const { x, y } = hexToPixel(q, r, hexRadius);
                const px = offsetX + x;
                const py = offsetY + y;

                if (px < -hexRadius * 2 || px > canvas.width + hexRadius * 2 ||
                    py < -hexRadius * 2 || py > canvas.height + hexRadius * 2) continue;

                if (isPrimeArr[n]) {
                    const hue = 30 + (n % 40);
                    drawHex(px, py, hexRadius * 0.9, `hsl(${hue}, 80%, 55%)`, null);

                    // Inner glow
                    ctx.fillStyle = `hsla(${hue}, 90%, 70%, 0.5)`;
                    ctx.beginPath();
                    ctx.arc(px, py, hexRadius * 0.4, 0, Math.PI * 2);
                    ctx.fill();
                } else {
                    drawHex(px, py, hexRadius * 0.9, 'rgba(40, 40, 50, 0.5)', 'rgba(60, 60, 70, 0.3)');
                }

                // Show numbers on larger hex
                if (hexRadius > 18 && n <= 200) {
                    ctx.fillStyle = isPrimeArr[n] ? '#fff' : '#666';
                    ctx.font = `${hexRadius * 0.5}px monospace`;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(n, px, py);
                }
            }

            // Center marker
            drawHex(offsetX, offsetY, hexRadius * 0.5, '#BC6C25', null);
        }

        document.getElementById('size').addEventListener('input', (e) => {
            hexRadius = parseInt(e.target.value);
            document.getElementById('sizeVal').textContent = hexRadius;
            draw();
        });

        window.addEventListener('resize', resize);
        resize();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
