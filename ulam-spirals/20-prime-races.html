<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prime Races - Ulam Spiral</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0a0a0f; overflow: hidden; font-family: system-ui; }
        canvas { display: block; }
        .back-link {
            position: fixed; top: 20px; left: 20px; z-index: 100;
            color: #8A9A5B; text-decoration: none;
            background: rgba(0,0,0,0.7); padding: 10px 20px; border-radius: 25px;
            font-size: 14px; transition: all 0.3s;
        }
        .back-link:hover { background: rgba(138,154,91,0.3); }
        .legend {
            position: fixed; bottom: 20px; right: 20px; z-index: 100;
            background: rgba(0,0,0,0.85); padding: 20px; border-radius: 15px;
            color: white; font-size: 14px;
        }
        .legend h3 { color: #DDA15E; margin-bottom: 12px; }
        .legend-item { display: flex; align-items: center; margin: 8px 0; }
        .legend-color { width: 20px; height: 20px; border-radius: 50%; margin-right: 10px; }
        .info {
            position: fixed; bottom: 20px; left: 20px; z-index: 100;
            background: rgba(0,0,0,0.85); padding: 20px; border-radius: 15px;
            color: white; font-size: 13px; max-width: 350px;
        }
        .info h3 { color: #DDA15E; margin-bottom: 10px; }
        .stats {
            position: fixed; top: 20px; right: 20px; z-index: 100;
            background: rgba(0,0,0,0.85); padding: 20px; border-radius: 15px;
            color: white; font-size: 14px;
        }
        .stats h3 { color: #DDA15E; margin-bottom: 10px; }
        .stats div { margin: 5px 0; }
        .race-bar {
            width: 200px; height: 20px; background: #333;
            border-radius: 10px; overflow: hidden; margin-top: 10px;
            display: flex;
        }
        .race-bar .team1 { background: #ff6b6b; height: 100%; }
        .race-bar .team3 { background: #6bffff; height: 100%; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Gallery</a>
    <div class="stats">
        <h3>Prime Race: 4k+1 vs 4k+3</h3>
        <div>p ≡ 1 (mod 4): <span style="color:#ff6b6b" id="count1">0</span></div>
        <div>p ≡ 3 (mod 4): <span style="color:#6bffff" id="count3">0</span></div>
        <div>Leader: <span id="leader">-</span></div>
        <div class="race-bar">
            <div class="team1" id="bar1" style="width:50%"></div>
            <div class="team3" id="bar3" style="width:50%"></div>
        </div>
    </div>
    <div class="info">
        <h3>Chebyshev's Bias</h3>
        <p>Primes of form 4k+3 (cyan) tend to outnumber 4k+1 primes (red) despite being asymptotically equal. This "prime race" was first noticed by Chebyshev in 1853.</p>
    </div>
    <div class="legend">
        <h3>Prime Classes (mod 4)</h3>
        <div class="legend-item">
            <div class="legend-color" style="background: #ff6b6b;"></div>
            <span>p ≡ 1 (mod 4) - e.g., 5, 13, 17</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #6bffff;"></div>
            <span>p ≡ 3 (mod 4) - e.g., 3, 7, 11</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FFD764;"></div>
            <span>p = 2 (special case)</span>
        </div>
    </div>
    <canvas id="canvas"></canvas>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        const gridSize = 181;
        const maxN = gridSize * gridSize;
        let cellSize;
        let time = 0;

        // Sieve
        const isPrimeArr = new Array(maxN + 1).fill(true);
        isPrimeArr[0] = isPrimeArr[1] = false;
        for (let i = 2; i * i <= maxN; i++) {
            if (isPrimeArr[i]) {
                for (let j = i * i; j <= maxN; j += i) {
                    isPrimeArr[j] = false;
                }
            }
        }

        // Categorize primes
        const primes1 = new Set(); // p ≡ 1 (mod 4)
        const primes3 = new Set(); // p ≡ 3 (mod 4)

        for (let p = 3; p <= maxN; p++) {
            if (isPrimeArr[p]) {
                if (p % 4 === 1) primes1.add(p);
                else if (p % 4 === 3) primes3.add(p);
            }
        }

        function getSpiralCoord(n) {
            if (n === 1) return { x: 0, y: 0 };
            let layer = Math.ceil((Math.sqrt(n) - 1) / 2);
            let leg = Math.floor((n - (2 * layer - 1) ** 2) / (2 * layer));
            let element = (n - (2 * layer - 1) ** 2) % (2 * layer);
            let x, y;
            switch (leg) {
                case 0: x = layer; y = -layer + 1 + element; break;
                case 1: x = layer - 1 - element; y = layer; break;
                case 2: x = -layer; y = layer - 1 - element; break;
                case 3: x = -layer + 1 + element; y = -layer; break;
            }
            return { x, y };
        }

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            cellSize = Math.min(canvas.width, canvas.height) / gridSize;
        }

        function draw() {
            time += 0.02;

            const offsetX = canvas.width / 2;
            const offsetY = canvas.height / 2;

            ctx.fillStyle = 'rgba(10, 10, 15, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            for (let n = 2; n <= maxN; n++) {
                const { x, y } = getSpiralCoord(n);
                const px = offsetX + x * cellSize;
                const py = offsetY + y * cellSize;

                if (px < -cellSize * 2 || px > canvas.width + cellSize * 2 ||
                    py < -cellSize * 2 || py > canvas.height + cellSize * 2) continue;

                const isPrime = isPrimeArr[n];

                if (n === 2) {
                    // Special case for 2
                    ctx.fillStyle = '#FFD764';
                    ctx.beginPath();
                    ctx.arc(px, py, cellSize * 0.45, 0, Math.PI * 2);
                    ctx.fill();
                } else if (primes1.has(n)) {
                    // p ≡ 1 (mod 4) - red team
                    const pulse = 0.9 + 0.1 * Math.sin(time * 3 + n * 0.01);
                    ctx.fillStyle = `rgba(255, 107, 107, ${0.7 * pulse})`;
                    ctx.beginPath();
                    ctx.arc(px, py, cellSize * 0.4 * pulse, 0, Math.PI * 2);
                    ctx.fill();

                    ctx.fillStyle = 'rgba(255, 150, 150, 0.3)';
                    ctx.beginPath();
                    ctx.arc(px, py, cellSize * 0.6, 0, Math.PI * 2);
                    ctx.fill();
                } else if (primes3.has(n)) {
                    // p ≡ 3 (mod 4) - cyan team
                    const pulse = 0.9 + 0.1 * Math.sin(time * 3 + n * 0.01 + Math.PI);
                    ctx.fillStyle = `rgba(107, 255, 255, ${0.7 * pulse})`;
                    ctx.beginPath();
                    ctx.arc(px, py, cellSize * 0.4 * pulse, 0, Math.PI * 2);
                    ctx.fill();

                    ctx.fillStyle = 'rgba(150, 255, 255, 0.3)';
                    ctx.beginPath();
                    ctx.arc(px, py, cellSize * 0.6, 0, Math.PI * 2);
                    ctx.fill();
                } else if (cellSize > 2) {
                    ctx.fillStyle = 'rgba(50, 50, 60, 0.2)';
                    ctx.beginPath();
                    ctx.arc(px, py, cellSize * 0.1, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            // Center
            ctx.fillStyle = '#BC6C25';
            ctx.beginPath();
            ctx.arc(offsetX, offsetY, cellSize * 0.5, 0, Math.PI * 2);
            ctx.fill();

            // Update stats
            const c1 = primes1.size;
            const c3 = primes3.size;
            const total = c1 + c3;

            document.getElementById('count1').textContent = c1;
            document.getElementById('count3').textContent = c3;

            if (c3 > c1) {
                document.getElementById('leader').innerHTML = '<span style="color:#6bffff">4k+3 leads by ' + (c3 - c1) + '</span>';
            } else if (c1 > c3) {
                document.getElementById('leader').innerHTML = '<span style="color:#ff6b6b">4k+1 leads by ' + (c1 - c3) + '</span>';
            } else {
                document.getElementById('leader').textContent = 'Tied!';
            }

            document.getElementById('bar1').style.width = (c1 / total * 100) + '%';
            document.getElementById('bar3').style.width = (c3 / total * 100) + '%';

            requestAnimationFrame(draw);
        }

        window.addEventListener('resize', resize);
        resize();
        draw();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
