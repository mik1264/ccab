<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sieve of Eratosthenes Animation</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0a0a0f; overflow: hidden; font-family: system-ui; }
        canvas { display: block; }
        .back-link {
            position: fixed; top: 20px; left: 20px; z-index: 100;
            color: #8A9A5B; text-decoration: none;
            background: rgba(0,0,0,0.7); padding: 10px 20px; border-radius: 25px;
            font-size: 14px; transition: all 0.3s;
        }
        .back-link:hover { background: rgba(138,154,91,0.3); }
        .stats {
            position: fixed; top: 20px; right: 20px; z-index: 100;
            background: rgba(0,0,0,0.85); padding: 20px; border-radius: 15px;
            color: white; font-size: 14px;
        }
        .stats div { margin: 5px 0; }
        .stats span { font-weight: bold; }
        .stats .sieving { color: #ff6b6b; }
        .stats .found { color: #00ff88; }
        .stats .crossed { color: #888; }
        .controls {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            z-index: 100; display: flex; gap: 10px;
        }
        .controls button {
            background: rgba(138,154,91,0.8); border: none; color: white;
            padding: 12px 24px; border-radius: 25px; cursor: pointer;
            font-size: 14px; transition: all 0.3s;
        }
        .controls button:hover { background: #8A9A5B; }
        .legend {
            position: fixed; bottom: 20px; right: 20px; z-index: 100;
            background: rgba(0,0,0,0.85); padding: 15px 20px; border-radius: 10px;
            color: white; font-size: 13px;
        }
        .legend-item { display: flex; align-items: center; margin: 5px 0; }
        .legend-dot { width: 12px; height: 12px; border-radius: 50%; margin-right: 8px; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Gallery</a>
    <div class="stats">
        <div>Current: <span class="sieving" id="currentPrime">2</span></div>
        <div>Primes: <span class="found" id="primeCount">0</span></div>
        <div>Crossed: <span class="crossed" id="crossedCount">0</span></div>
    </div>
    <div class="controls">
        <button id="step">Step</button>
        <button id="play">Play</button>
        <button id="fast">Fast</button>
        <button id="reset">Reset</button>
    </div>
    <div class="legend">
        <div class="legend-item"><div class="legend-dot" style="background:#00ff88"></div>Confirmed Prime</div>
        <div class="legend-item"><div class="legend-dot" style="background:#ff6b6b"></div>Current Sieve</div>
        <div class="legend-item"><div class="legend-dot" style="background:#444"></div>Crossed Out</div>
        <div class="legend-item"><div class="legend-dot" style="background:#666"></div>Unknown</div>
    </div>
    <canvas id="canvas"></canvas>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        const gridSize = 101;
        const maxN = gridSize * gridSize;
        let cellSize;

        let status = new Array(maxN + 1).fill(0); // 0=unknown, 1=prime, 2=crossed
        let currentPrime = 2;
        let sievingMultiple = 0;
        let isPlaying = false;
        let speed = 1;

        function getSpiralCoord(n) {
            if (n === 1) return { x: 0, y: 0 };
            let layer = Math.ceil((Math.sqrt(n) - 1) / 2);
            let leg = Math.floor((n - (2 * layer - 1) ** 2) / (2 * layer));
            let element = (n - (2 * layer - 1) ** 2) % (2 * layer);
            let x, y;
            switch (leg) {
                case 0: x = layer; y = -layer + 1 + element; break;
                case 1: x = layer - 1 - element; y = layer; break;
                case 2: x = -layer; y = layer - 1 - element; break;
                case 3: x = -layer + 1 + element; y = -layer; break;
            }
            return { x, y };
        }

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            cellSize = Math.min(canvas.width, canvas.height) / gridSize;
            draw();
        }

        function step() {
            if (currentPrime * currentPrime > maxN) {
                // Mark all remaining unknowns as prime
                for (let i = 2; i <= maxN; i++) {
                    if (status[i] === 0) status[i] = 1;
                }
                isPlaying = false;
                document.getElementById('currentPrime').textContent = 'Done!';
                draw();
                return false;
            }

            if (sievingMultiple === 0) {
                // Start sieving with current prime
                if (status[currentPrime] === 0) {
                    status[currentPrime] = 1;
                    sievingMultiple = currentPrime * 2;
                } else {
                    currentPrime++;
                    return step();
                }
            } else {
                // Cross out multiple
                if (sievingMultiple <= maxN) {
                    status[sievingMultiple] = 2;
                    sievingMultiple += currentPrime;
                } else {
                    // Move to next prime
                    currentPrime++;
                    sievingMultiple = 0;
                    return step();
                }
            }

            updateStats();
            draw();
            return true;
        }

        function updateStats() {
            document.getElementById('currentPrime').textContent = currentPrime;
            document.getElementById('primeCount').textContent = status.filter(s => s === 1).length;
            document.getElementById('crossedCount').textContent = status.filter(s => s === 2).length;
        }

        function draw() {
            const offsetX = canvas.width / 2;
            const offsetY = canvas.height / 2;

            ctx.fillStyle = '#0a0a0f';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            for (let n = 2; n <= maxN; n++) {
                const { x, y } = getSpiralCoord(n);
                const px = offsetX + x * cellSize;
                const py = offsetY + y * cellSize;

                if (px < -cellSize || px > canvas.width + cellSize ||
                    py < -cellSize || py > canvas.height + cellSize) continue;

                let color, size;
                const isCurrentMultiple = sievingMultiple > 0 && n === sievingMultiple;
                const isCurrentPrime = n === currentPrime && sievingMultiple > 0;

                if (isCurrentMultiple) {
                    color = '#ff0000';
                    size = 0.5;
                } else if (isCurrentPrime) {
                    color = '#ff6b6b';
                    size = 0.5;
                    // Glow
                    ctx.fillStyle = 'rgba(255, 107, 107, 0.3)';
                    ctx.beginPath();
                    ctx.arc(px, py, cellSize * 0.8, 0, Math.PI * 2);
                    ctx.fill();
                } else if (status[n] === 1) {
                    color = '#00ff88';
                    size = 0.4;
                } else if (status[n] === 2) {
                    color = '#333';
                    size = 0.15;
                } else {
                    color = '#666';
                    size = 0.25;
                }

                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(px, py, cellSize * size, 0, Math.PI * 2);
                ctx.fill();
            }

            // Center marker (1 is neither prime nor composite)
            ctx.fillStyle = '#BC6C25';
            ctx.beginPath();
            ctx.arc(offsetX, offsetY, cellSize * 0.4, 0, Math.PI * 2);
            ctx.fill();
        }

        function reset() {
            status = new Array(maxN + 1).fill(0);
            currentPrime = 2;
            sievingMultiple = 0;
            isPlaying = false;
            updateStats();
            draw();
        }

        function playLoop() {
            if (!isPlaying) return;
            for (let i = 0; i < speed; i++) {
                if (!step()) return;
            }
            requestAnimationFrame(playLoop);
        }

        document.getElementById('step').addEventListener('click', step);
        document.getElementById('play').addEventListener('click', () => {
            isPlaying = !isPlaying;
            speed = 1;
            document.getElementById('play').textContent = isPlaying ? 'Pause' : 'Play';
            if (isPlaying) playLoop();
        });
        document.getElementById('fast').addEventListener('click', () => {
            isPlaying = true;
            speed = 50;
            document.getElementById('play').textContent = 'Pause';
            playLoop();
        });
        document.getElementById('reset').addEventListener('click', reset);

        window.addEventListener('resize', resize);
        resize();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
