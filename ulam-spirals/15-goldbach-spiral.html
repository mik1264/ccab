<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Goldbach Spiral Visualization</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0a0a0f; overflow: hidden; font-family: system-ui; }
        canvas { display: block; }
        .back-link {
            position: fixed; top: 20px; left: 20px; z-index: 100;
            color: #8A9A5B; text-decoration: none;
            background: rgba(0,0,0,0.7); padding: 10px 20px; border-radius: 25px;
            font-size: 14px; transition: all 0.3s;
        }
        .back-link:hover { background: rgba(138,154,91,0.3); }
        .info {
            position: fixed; bottom: 20px; left: 20px; z-index: 100;
            background: rgba(0,0,0,0.85); padding: 20px; border-radius: 15px;
            color: white; font-size: 13px; max-width: 350px;
        }
        .info h3 { color: #DDA15E; margin-bottom: 10px; }
        .controls {
            position: fixed; top: 20px; right: 20px; z-index: 100;
            background: rgba(0,0,0,0.85); padding: 20px; border-radius: 15px;
        }
        .controls h3 { color: #DDA15E; margin-bottom: 10px; }
        .controls label { color: white; display: block; margin: 10px 0; font-size: 14px; }
        .controls input { width: 100px; padding: 5px; }
        .controls button {
            background: #8A9A5B; border: none; color: white;
            padding: 8px 16px; border-radius: 5px; cursor: pointer; margin-top: 10px;
        }
        .result {
            position: fixed; top: 150px; right: 20px; z-index: 100;
            background: rgba(0,0,0,0.85); padding: 15px 20px; border-radius: 10px;
            color: white; font-size: 14px; max-width: 250px;
        }
        .result span { color: #00ff88; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Gallery</a>
    <div class="controls">
        <h3>Goldbach Partition</h3>
        <label>Even number:
            <input type="number" id="evenNum" value="100" min="4" step="2">
        </label>
        <button id="show">Show Partition</button>
    </div>
    <div class="result" id="result" style="display:none;">
        <span id="numDisplay">100</span> = <span id="partition"></span>
        <div style="margin-top:10px;opacity:0.7">
            Partitions found: <span id="partCount">0</span>
        </div>
    </div>
    <div class="info">
        <h3>Goldbach's Conjecture</h3>
        <p>Every even integer greater than 2 can be expressed as the sum of two primes. Enter an even number to see its prime pair(s) highlighted on the Ulam spiral.</p>
    </div>
    <canvas id="canvas"></canvas>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        const gridSize = 151;
        const maxN = gridSize * gridSize;
        let cellSize;

        let targetNum = 100;
        let partitions = [];
        let highlightedPrimes = new Set();

        // Sieve
        const isPrimeArr = new Array(maxN + 1).fill(true);
        isPrimeArr[0] = isPrimeArr[1] = false;
        for (let i = 2; i * i <= maxN; i++) {
            if (isPrimeArr[i]) {
                for (let j = i * i; j <= maxN; j += i) {
                    isPrimeArr[j] = false;
                }
            }
        }

        function findGoldbachPartitions(n) {
            const parts = [];
            for (let i = 2; i <= n / 2; i++) {
                if (isPrimeArr[i] && isPrimeArr[n - i]) {
                    parts.push([i, n - i]);
                }
            }
            return parts;
        }

        function getSpiralCoord(n) {
            if (n === 1) return { x: 0, y: 0 };
            let layer = Math.ceil((Math.sqrt(n) - 1) / 2);
            let leg = Math.floor((n - (2 * layer - 1) ** 2) / (2 * layer));
            let element = (n - (2 * layer - 1) ** 2) % (2 * layer);
            let x, y;
            switch (leg) {
                case 0: x = layer; y = -layer + 1 + element; break;
                case 1: x = layer - 1 - element; y = layer; break;
                case 2: x = -layer; y = layer - 1 - element; break;
                case 3: x = -layer + 1 + element; y = -layer; break;
            }
            return { x, y };
        }

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            cellSize = Math.min(canvas.width, canvas.height) / gridSize;
            draw();
        }

        function updatePartition() {
            targetNum = parseInt(document.getElementById('evenNum').value);
            if (targetNum % 2 !== 0 || targetNum < 4) {
                alert('Please enter an even number >= 4');
                return;
            }

            partitions = findGoldbachPartitions(targetNum);
            highlightedPrimes = new Set();
            partitions.forEach(([a, b]) => {
                highlightedPrimes.add(a);
                highlightedPrimes.add(b);
            });

            document.getElementById('result').style.display = 'block';
            document.getElementById('numDisplay').textContent = targetNum;
            document.getElementById('partCount').textContent = partitions.length;

            if (partitions.length > 0) {
                const partStr = partitions.slice(0, 5).map(([a, b]) => `${a} + ${b}`).join(', ');
                document.getElementById('partition').textContent = partStr + (partitions.length > 5 ? '...' : '');
            } else {
                document.getElementById('partition').textContent = 'None found (number too large)';
            }

            draw();
        }

        function draw() {
            const offsetX = canvas.width / 2;
            const offsetY = canvas.height / 2;

            ctx.fillStyle = '#0a0a0f';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw connection lines between partition pairs
            ctx.lineWidth = 2;
            partitions.forEach(([a, b], idx) => {
                const c1 = getSpiralCoord(a);
                const c2 = getSpiralCoord(b);
                const hue = (idx * 60) % 360;

                ctx.strokeStyle = `hsla(${hue}, 80%, 50%, 0.4)`;
                ctx.beginPath();
                ctx.moveTo(offsetX + c1.x * cellSize, offsetY + c1.y * cellSize);
                ctx.lineTo(offsetX + c2.x * cellSize, offsetY + c2.y * cellSize);
                ctx.stroke();
            });

            // Draw numbers
            for (let n = 1; n <= maxN; n++) {
                const { x, y } = getSpiralCoord(n);
                const px = offsetX + x * cellSize;
                const py = offsetY + y * cellSize;

                if (px < -cellSize || px > canvas.width + cellSize ||
                    py < -cellSize || py > canvas.height + cellSize) continue;

                const isPrime = isPrimeArr[n];
                const isHighlighted = highlightedPrimes.has(n);

                if (isHighlighted) {
                    // Find which partition this belongs to
                    let pIdx = 0;
                    for (let i = 0; i < partitions.length; i++) {
                        if (partitions[i].includes(n)) { pIdx = i; break; }
                    }
                    const hue = (pIdx * 60) % 360;

                    // Glow
                    const gradient = ctx.createRadialGradient(px, py, 0, px, py, cellSize);
                    gradient.addColorStop(0, `hsla(${hue}, 90%, 60%, 1)`);
                    gradient.addColorStop(0.5, `hsla(${hue}, 90%, 50%, 0.5)`);
                    gradient.addColorStop(1, 'transparent');
                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.arc(px, py, cellSize, 0, Math.PI * 2);
                    ctx.fill();

                    ctx.fillStyle = `hsl(${hue}, 90%, 70%)`;
                    ctx.beginPath();
                    ctx.arc(px, py, cellSize * 0.45, 0, Math.PI * 2);
                    ctx.fill();

                    // Label
                    if (cellSize > 4) {
                        ctx.fillStyle = '#fff';
                        ctx.font = `${Math.max(8, cellSize * 0.4)}px monospace`;
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        ctx.fillText(n, px, py);
                    }
                } else if (isPrime) {
                    ctx.fillStyle = 'rgba(255, 215, 100, 0.4)';
                    ctx.beginPath();
                    ctx.arc(px, py, cellSize * 0.3, 0, Math.PI * 2);
                    ctx.fill();
                } else if (cellSize > 2) {
                    ctx.fillStyle = 'rgba(50, 50, 60, 0.3)';
                    ctx.beginPath();
                    ctx.arc(px, py, cellSize * 0.1, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            // Center
            ctx.fillStyle = '#BC6C25';
            ctx.beginPath();
            ctx.arc(offsetX, offsetY, cellSize * 0.5, 0, Math.PI * 2);
            ctx.fill();
        }

        document.getElementById('show').addEventListener('click', updatePartition);
        document.getElementById('evenNum').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') updatePartition();
        });

        window.addEventListener('resize', resize);
        resize();
        updatePartition();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
