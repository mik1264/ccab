<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animated Ulam Spiral Growth</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0a0a0f; overflow: hidden; font-family: system-ui; }
        canvas { display: block; }
        .back-link {
            position: fixed; top: 20px; left: 20px; z-index: 100;
            color: #8A9A5B; text-decoration: none;
            background: rgba(0,0,0,0.7); padding: 10px 20px; border-radius: 25px;
            font-size: 14px; transition: all 0.3s;
        }
        .back-link:hover { background: rgba(138,154,91,0.3); }
        .stats {
            position: fixed; top: 20px; right: 20px; z-index: 100;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); padding: 20px; border-radius: 15px;
            color: white; font-size: 14px;
        }
        .stats div { margin: 5px 0; }
        .stats span { color: #DDA15E; font-weight: bold; }
        .controls {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            z-index: 100; display: flex; gap: 10px;
        }
        .controls button {
            background: rgba(138,154,91,0.8); border: none; color: white;
            padding: 12px 24px; border-radius: 25px; cursor: pointer;
            font-size: 14px; transition: all 0.3s;
        }
        .controls button:hover { background: #8A9A5B; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Gallery</a>
    <div class="stats">
        <div>Current: <span id="currentNum">1</span></div>
        <div>Primes Found: <span id="primeCount">0</span></div>
        <div>Prime Ratio: <span id="ratio">0%</span></div>
    </div>
    <div class="controls">
        <button id="pause">Pause</button>
        <button id="speed1">1x</button>
        <button id="speed10">10x</button>
        <button id="speed100">100x</button>
        <button id="reset">Reset</button>
    </div>
    <canvas id="canvas"></canvas>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let cellSize = 8;
        let currentN = 1;
        let primeCount = 0;
        let speed = 1;
        let paused = false;
        let particles = [];

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        function isPrime(n) {
            if (n < 2) return false;
            if (n === 2) return true;
            if (n % 2 === 0) return false;
            for (let i = 3; i * i <= n; i += 2) {
                if (n % i === 0) return false;
            }
            return true;
        }

        function getSpiralCoord(n) {
            if (n === 1) return { x: 0, y: 0 };
            let layer = Math.ceil((Math.sqrt(n) - 1) / 2);
            let leg = Math.floor((n - (2 * layer - 1) ** 2) / (2 * layer));
            let element = (n - (2 * layer - 1) ** 2) % (2 * layer);
            let x, y;
            switch (leg) {
                case 0: x = layer; y = -layer + 1 + element; break;
                case 1: x = layer - 1 - element; y = layer; break;
                case 2: x = -layer; y = layer - 1 - element; break;
                case 3: x = -layer + 1 + element; y = -layer; break;
            }
            return { x, y };
        }

        function addNumber() {
            const { x, y } = getSpiralCoord(currentN);
            const px = canvas.width / 2 + x * cellSize;
            const py = canvas.height / 2 + y * cellSize;

            const prime = isPrime(currentN);
            if (prime) {
                primeCount++;
                // Add burst particles for primes
                for (let i = 0; i < 8; i++) {
                    const angle = (i / 8) * Math.PI * 2;
                    particles.push({
                        x: px, y: py,
                        vx: Math.cos(angle) * 2,
                        vy: Math.sin(angle) * 2,
                        life: 30,
                        color: `hsl(${45 + Math.random() * 20}, 90%, 60%)`
                    });
                }
            }

            ctx.fillStyle = prime ? '#FFD764' : 'rgba(60, 60, 70, 0.6)';
            ctx.beginPath();
            ctx.arc(px, py, prime ? cellSize * 0.45 : cellSize * 0.25, 0, Math.PI * 2);
            ctx.fill();

            if (prime && cellSize > 4) {
                ctx.fillStyle = 'rgba(255, 215, 100, 0.3)';
                ctx.beginPath();
                ctx.arc(px, py, cellSize * 0.7, 0, Math.PI * 2);
                ctx.fill();
            }

            currentN++;

            document.getElementById('currentNum').textContent = currentN;
            document.getElementById('primeCount').textContent = primeCount;
            document.getElementById('ratio').textContent = ((primeCount / currentN) * 100).toFixed(2) + '%';
        }

        function updateParticles() {
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.life--;

                ctx.globalAlpha = p.life / 30;
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, 2, 0, Math.PI * 2);
                ctx.fill();
                ctx.globalAlpha = 1;

                if (p.life <= 0) particles.splice(i, 1);
            }
        }

        function animate() {
            if (!paused) {
                for (let i = 0; i < speed; i++) {
                    if (currentN <= 100000) addNumber();
                }
            }
            updateParticles();
            requestAnimationFrame(animate);
        }

        function reset() {
            currentN = 1;
            primeCount = 0;
            particles = [];
            ctx.fillStyle = '#0a0a0f';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw center
            ctx.fillStyle = '#BC6C25';
            ctx.beginPath();
            ctx.arc(canvas.width / 2, canvas.height / 2, cellSize * 0.5, 0, Math.PI * 2);
            ctx.fill();
        }

        document.getElementById('pause').addEventListener('click', () => {
            paused = !paused;
            document.getElementById('pause').textContent = paused ? 'Resume' : 'Pause';
        });
        document.getElementById('speed1').addEventListener('click', () => speed = 1);
        document.getElementById('speed10').addEventListener('click', () => speed = 10);
        document.getElementById('speed100').addEventListener('click', () => speed = 100);
        document.getElementById('reset').addEventListener('click', reset);

        window.addEventListener('resize', () => { resize(); reset(); });
        // Expose for enhance.js keyboard shortcuts
        window.reset = reset;

        resize();
        reset();
        animate();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
