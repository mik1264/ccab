<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auction Mechanisms - Game Theory</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #eee;
            min-height: 100vh;
            padding: 20px;
        }
        .back-link {
            position: fixed; top: 20px; left: 20px; color: #4ade80; text-decoration: none;
            font-weight: 600; padding: 8px 16px; background: rgba(0,0,0,0.3); border-radius: 20px;
            z-index: 100;
        }
        h1 { text-align: center; margin: 40px 0 10px; font-size: 2.2em; color: #4ade80; }
        .subtitle { text-align: center; opacity: 0.8; margin-bottom: 20px; }
        .container { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 1fr 300px; gap: 20px; }
        .panel { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 25px; }
        .info-box { background: rgba(74, 222, 128, 0.1); border: 1px solid rgba(74, 222, 128, 0.3); border-radius: 8px; padding: 15px; margin-bottom: 20px; font-size: 0.85em; line-height: 1.6; }
        h3 { color: #4ade80; margin-bottom: 15px; }
        .auction-tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .tab-btn { padding: 10px 16px; border: 2px solid rgba(255,255,255,0.2); border-radius: 8px; background: transparent; color: #fff; cursor: pointer; font-weight: 600; transition: all 0.3s; }
        .tab-btn.active { border-color: #4ade80; background: rgba(74, 222, 128, 0.2); }
        .auction-display { background: rgba(0,0,0,0.3); border-radius: 12px; padding: 25px; text-align: center; }
        .item-display { font-size: 3em; margin-bottom: 10px; }
        .current-price { font-size: 2.5em; color: #facc15; margin: 20px 0; }
        .price-label { font-size: 0.9em; opacity: 0.7; }
        .bidders-display { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin: 20px 0; }
        .bidder-card { background: rgba(255,255,255,0.05); border-radius: 10px; padding: 15px; min-width: 100px; }
        .bidder-card.winner { border: 2px solid #4ade80; background: rgba(74, 222, 128, 0.2); }
        .bidder-card.out { opacity: 0.4; }
        .bidder-name { font-weight: 600; color: #22d3ee; }
        .bidder-value { font-size: 0.85em; opacity: 0.7; }
        .bidder-bid { color: #4ade80; font-size: 1.2em; margin-top: 5px; }
        button { padding: 12px 24px; border: none; border-radius: 8px; font-size: 1em; font-weight: 600; cursor: pointer; margin: 5px; }
        .btn-primary { background: #4ade80; color: #1a1a2e; }
        .btn-secondary { background: rgba(255,255,255,0.1); color: #fff; }
        .result-box { background: rgba(74, 222, 128, 0.2); border: 2px solid #4ade80; border-radius: 12px; padding: 20px; margin-top: 20px; text-align: center; }
        .result-title { font-size: 1.3em; color: #4ade80; margin-bottom: 10px; }
        .control-group { margin: 15px 0; }
        .control-group label { display: block; margin-bottom: 5px; }
        .control-group input { width: 100%; }
        .value-display { color: #4ade80; font-family: monospace; }
        canvas { width: 100%; height: 250px; border-radius: 8px; background: #0a0a15; margin: 15px 0; }
        .stats-list { list-style: none; }
        .stats-list li { padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; }
        @media (max-width: 900px) { .container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back</a>
    <h1>Auction Mechanisms</h1>
    <p class="subtitle">English, Dutch, and Vickrey auctions</p>

    <div class="container">
        <div class="panel">
            <div class="auction-tabs">
                <button class="tab-btn active" onclick="setAuction('english')">English (Ascending)</button>
                <button class="tab-btn" onclick="setAuction('dutch')">Dutch (Descending)</button>
                <button class="tab-btn" onclick="setAuction('vickrey')">Vickrey (2nd Price)</button>
                <button class="tab-btn" onclick="setAuction('firstprice')">First Price Sealed</button>
            </div>

            <div class="info-box" id="auctionInfo">
                <strong>English Auction:</strong> Price starts low and increases. Bidders drop out as price rises.
                Last remaining bidder wins at the current price. Strategically equivalent to Vickrey auction.
            </div>

            <div class="auction-display">
                <div class="item-display">üé®</div>
                <div class="price-label" id="priceLabel">Current Price</div>
                <div class="current-price">$<span id="currentPrice">0</span></div>

                <div class="bidders-display" id="biddersDisplay"></div>

                <button class="btn-primary" onclick="startAuction()">Start Auction</button>
                <button class="btn-secondary" onclick="stepAuction()">Step</button>
                <button class="btn-secondary" onclick="resetAuction()">Reset</button>

                <div class="result-box" id="resultBox" style="display: none;">
                    <div class="result-title" id="resultTitle">Winner!</div>
                    <div id="resultText"></div>
                </div>
            </div>

            <h3 style="margin-top: 25px;">Revenue Comparison</h3>
            <canvas id="canvas"></canvas>
        </div>

        <div class="panel">
            <h3>Settings</h3>

            <div class="control-group">
                <label>Number of Bidders: <span class="value-display" id="numBidders">5</span></label>
                <input type="range" id="bidderSlider" min="2" max="10" value="5" oninput="updateSettings()">
            </div>

            <div class="control-group">
                <label>Value Distribution: <span class="value-display" id="valueDist">$50-$150</span></label>
                <input type="range" id="valueRange" min="50" max="150" value="100" oninput="updateSettings()">
            </div>

            <h3 style="margin-top: 20px;">Auction Statistics</h3>
            <ul class="stats-list">
                <li><span>Auctions Run:</span><span class="value-display" id="auctionsRun">0</span></li>
                <li><span>Avg Revenue:</span><span class="value-display" id="avgRevenue">$0</span></li>
                <li><span>Avg Winner Surplus:</span><span class="value-display" id="avgSurplus">$0</span></li>
                <li><span>Efficient Allocation:</span><span class="value-display" id="efficiency">0%</span></li>
            </ul>

            <div class="info-box" style="margin-top: 20px;">
                <strong>Revenue Equivalence Theorem:</strong>
                Under certain conditions, all standard auction formats yield the same expected revenue to the seller.
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 600;
        canvas.height = 250;

        let auctionType = 'english';
        let bidders = [];
        let currentPrice = 0;
        let running = false;
        let winner = null;
        let stats = { english: [], dutch: [], vickrey: [], firstprice: [] };

        const auctionDescriptions = {
            english: '<strong>English Auction:</strong> Price starts low and increases. Bidders drop out as price rises. Last remaining bidder wins at the current price.',
            dutch: '<strong>Dutch Auction:</strong> Price starts high and decreases. First bidder to accept wins at that price. Fast but can be nerve-wracking.',
            vickrey: '<strong>Vickrey (2nd Price) Auction:</strong> Sealed bids, highest wins but pays second-highest bid. Truthful bidding is dominant strategy.',
            firstprice: '<strong>First Price Sealed Bid:</strong> Sealed bids, highest wins and pays their bid. Bidders shade bids below true value.'
        };

        function setAuction(type) {
            auctionType = type;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('auctionInfo').innerHTML = auctionDescriptions[type];
            resetAuction();
        }

        function updateSettings() {
            document.getElementById('numBidders').textContent = document.getElementById('bidderSlider').value;
            const range = parseInt(document.getElementById('valueRange').value);
            document.getElementById('valueDist').textContent = `$${range - 50}-$${range + 50}`;
            resetAuction();
        }

        function initBidders() {
            const n = parseInt(document.getElementById('bidderSlider').value);
            const baseValue = parseInt(document.getElementById('valueRange').value);
            bidders = [];

            for (let i = 0; i < n; i++) {
                bidders.push({
                    id: i + 1,
                    name: `Bidder ${i + 1}`,
                    value: baseValue - 50 + Math.random() * 100,
                    active: true,
                    bid: 0
                });
            }

            // Sort by value for display
            bidders.sort((a, b) => b.value - a.value);
        }

        function updateDisplay() {
            document.getElementById('currentPrice').textContent = Math.round(currentPrice);

            const display = document.getElementById('biddersDisplay');
            display.innerHTML = bidders.map(b => {
                let className = 'bidder-card';
                if (winner === b) className += ' winner';
                else if (!b.active) className += ' out';

                return `<div class="${className}">
                    <div class="bidder-name">${b.name}</div>
                    <div class="bidder-value">Value: $${Math.round(b.value)}</div>
                    ${b.bid > 0 ? `<div class="bidder-bid">Bid: $${Math.round(b.bid)}</div>` : ''}
                </div>`;
            }).join('');
        }

        function stepAuction() {
            if (winner) return;

            switch (auctionType) {
                case 'english':
                    stepEnglish();
                    break;
                case 'dutch':
                    stepDutch();
                    break;
                case 'vickrey':
                    runVickrey();
                    break;
                case 'firstprice':
                    runFirstPrice();
                    break;
            }
        }

        function stepEnglish() {
            currentPrice += 5;
            document.getElementById('priceLabel').textContent = 'Current Price';

            // Bidders drop out if price exceeds their value
            bidders.forEach(b => {
                if (b.active && currentPrice > b.value) {
                    b.active = false;
                }
            });

            const activeBidders = bidders.filter(b => b.active);
            if (activeBidders.length === 1) {
                winner = activeBidders[0];
                winner.bid = currentPrice;
                showResult();
            } else if (activeBidders.length === 0) {
                currentPrice -= 5;
                winner = bidders.reduce((max, b) => b.value > max.value ? b : max, bidders[0]);
                winner.bid = currentPrice;
                showResult();
            }

            updateDisplay();
        }

        function stepDutch() {
            if (currentPrice <= 0) {
                currentPrice = Math.max(...bidders.map(b => b.value)) + 30;
            }
            currentPrice -= 5;
            document.getElementById('priceLabel').textContent = 'Price Dropping...';

            // First bidder whose value >= price accepts
            const accepter = bidders.find(b => b.value >= currentPrice && Math.random() < 0.3);
            if (accepter || currentPrice <= Math.min(...bidders.map(b => b.value))) {
                winner = accepter || bidders.reduce((max, b) => b.value > max.value ? b : max, bidders[0]);
                winner.bid = Math.max(currentPrice, winner.value * 0.9);
                currentPrice = winner.bid;
                bidders.forEach(b => b.active = (b === winner));
                showResult();
            }

            updateDisplay();
        }

        function runVickrey() {
            document.getElementById('priceLabel').textContent = 'Sealed Bids';

            // Truthful bidding is optimal in Vickrey
            bidders.forEach(b => {
                b.bid = b.value; // Optimal strategy
            });

            bidders.sort((a, b) => b.bid - a.bid);
            winner = bidders[0];
            currentPrice = bidders[1].bid; // Second-highest bid

            bidders.forEach(b => b.active = (b === winner));
            showResult();
            updateDisplay();
        }

        function runFirstPrice() {
            document.getElementById('priceLabel').textContent = 'Sealed Bids';

            // Bid shading in first-price auction
            const n = bidders.length;
            bidders.forEach(b => {
                // Optimal bid shading: bid = value * (n-1)/n
                b.bid = b.value * (n - 1) / n;
            });

            bidders.sort((a, b) => b.bid - a.bid);
            winner = bidders[0];
            currentPrice = winner.bid;

            bidders.forEach(b => b.active = (b === winner));
            showResult();
            updateDisplay();
        }

        function showResult() {
            const resultBox = document.getElementById('resultBox');
            resultBox.style.display = 'block';
            document.getElementById('resultTitle').textContent = `${winner.name} Wins!`;
            const surplus = winner.value - currentPrice;
            document.getElementById('resultText').innerHTML =
                `Paid: $${Math.round(currentPrice)}<br>
                 True Value: $${Math.round(winner.value)}<br>
                 Surplus: $${Math.round(surplus)}`;

            // Record stats
            const highestValue = Math.max(...bidders.map(b => b.value));
            stats[auctionType].push({
                revenue: currentPrice,
                surplus: surplus,
                efficient: winner.value === highestValue
            });

            updateStats();
            drawChart();
        }

        function updateStats() {
            const allRuns = Object.values(stats).flat();
            const n = allRuns.length;

            document.getElementById('auctionsRun').textContent = n;
            if (n > 0) {
                document.getElementById('avgRevenue').textContent = '$' + Math.round(allRuns.reduce((s, r) => s + r.revenue, 0) / n);
                document.getElementById('avgSurplus').textContent = '$' + Math.round(allRuns.reduce((s, r) => s + r.surplus, 0) / n);
                document.getElementById('efficiency').textContent = Math.round(allRuns.filter(r => r.efficient).length / n * 100) + '%';
            }
        }

        function drawChart() {
            ctx.fillStyle = '#0a0a15';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const types = ['english', 'dutch', 'vickrey', 'firstprice'];
            const colors = ['#4ade80', '#f87171', '#22d3ee', '#facc15'];
            const labels = ['English', 'Dutch', 'Vickrey', '1st Price'];

            const barWidth = 100;
            const gap = 30;
            const startX = 80;

            types.forEach((type, i) => {
                const data = stats[type];
                const avgRev = data.length > 0 ? data.reduce((s, r) => s + r.revenue, 0) / data.length : 0;
                const maxRev = 150;

                const x = startX + i * (barWidth + gap);
                const barHeight = (avgRev / maxRev) * 180;

                ctx.fillStyle = colors[i];
                ctx.fillRect(x, 220 - barHeight, barWidth, barHeight);

                ctx.fillStyle = '#fff';
                ctx.font = '12px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(labels[i], x + barWidth / 2, 240);
                ctx.fillText(`$${Math.round(avgRev)}`, x + barWidth / 2, 215 - barHeight);
                ctx.fillText(`(n=${data.length})`, x + barWidth / 2, 205 - barHeight);
            });

            ctx.fillStyle = '#4ade80';
            ctx.font = 'bold 14px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('Average Revenue by Auction Type', 10, 20);
        }

        async function startAuction() {
            if (running || winner) return;
            running = true;

            while (!winner && running) {
                stepAuction();
                await new Promise(r => setTimeout(r, auctionType === 'vickrey' || auctionType === 'firstprice' ? 0 : 200));
            }
            running = false;
        }

        function resetAuction() {
            running = false;
            winner = null;
            currentPrice = 0;
            initBidders();
            document.getElementById('resultBox').style.display = 'none';
            document.getElementById('priceLabel').textContent = 'Starting Price';
            updateDisplay();
        }

        updateSettings();
        drawChart();
    </script>
</body>
</html>
