<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rock-Paper-Scissors Evolution | Game Theory</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 10px; color: #4fc3f7; }
        .subtitle { text-align: center; color: #888; margin-bottom: 20px; }

        .controls {
            display: flex; gap: 15px; flex-wrap: wrap;
            justify-content: center; margin-bottom: 20px; align-items: center;
        }
        button {
            padding: 10px 20px; border: none; border-radius: 8px;
            background: #4fc3f7; color: #1a1a2e; font-weight: bold;
            cursor: pointer; transition: all 0.3s;
        }
        button:hover { background: #81d4fa; }
        label { display: flex; align-items: center; gap: 8px; }
        input[type="range"] { width: 80px; }
        select { padding: 8px; border-radius: 6px; background: #1a1a2e; color: #e0e0e0; border: 1px solid #4fc3f7; }

        .main-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 900px) { .main-grid { grid-template-columns: 1fr; } }

        .panel {
            background: rgba(255,255,255,0.05);
            border-radius: 15px; padding: 20px;
            border: 1px solid rgba(79, 195, 247, 0.2);
        }
        .panel h2 { color: #4fc3f7; margin-bottom: 15px; }

        #spatialCanvas { width: 100%; border-radius: 10px; }

        .population-bars {
            display: flex; gap: 10px; margin: 15px 0;
        }
        .pop-bar-container {
            flex: 1; text-align: center;
        }
        .pop-bar {
            height: 100px; border-radius: 8px;
            display: flex; flex-direction: column;
            justify-content: flex-end; align-items: center;
            padding-bottom: 5px; transition: height 0.3s;
        }
        .pop-bar-fill {
            width: 100%; border-radius: 8px;
            transition: height 0.3s;
        }
        .rock-color { background: linear-gradient(180deg, #78909c, #546e7a); }
        .paper-color { background: linear-gradient(180deg, #fff59d, #fdd835); }
        .scissors-color { background: linear-gradient(180deg, #ef5350, #c62828); }

        .pop-icon { font-size: 2em; margin-bottom: 5px; }
        .pop-count { font-weight: bold; }

        canvas { width: 100%; border-radius: 10px; background: rgba(0,0,0,0.2); }

        .simplex-container {
            position: relative; width: 100%; padding-top: 86.6%; /* sqrt(3)/2 ratio */
        }
        #simplexCanvas {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
        }

        .stat-row {
            display: flex; justify-content: space-between;
            padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .legend {
            display: flex; justify-content: center; gap: 20px;
            margin: 10px 0;
        }
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .legend-dot {
            width: 15px; height: 15px; border-radius: 50%;
        }

        a.back-link {
            display: inline-block; margin-bottom: 20px;
            color: #4fc3f7; text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê Back to Game Theory</a>
        <h1>Rock-Paper-Scissors Evolution</h1>
        <p class="subtitle">Cyclic dominance and evolutionary dynamics</p>

        <div class="controls">
            <button id="startBtn">Start</button>
            <button id="stepBtn">Step</button>
            <button id="resetBtn">Reset</button>
            <label>
                Mode:
                <select id="mode">
                    <option value="spatial">Spatial Grid</option>
                    <option value="wellmixed">Well-Mixed</option>
                </select>
            </label>
            <label>
                Speed:
                <input type="range" id="speed" min="1" max="30" value="10">
            </label>
        </div>

        <div class="main-grid">
            <div class="panel">
                <h2>Population</h2>
                <canvas id="spatialCanvas" height="400"></canvas>

                <div class="population-bars">
                    <div class="pop-bar-container">
                        <div class="pop-icon">ü™®</div>
                        <div class="pop-bar">
                            <div class="pop-bar-fill rock-color" id="rockBar" style="height:33%;"></div>
                        </div>
                        <div class="pop-count" id="rockCount">0</div>
                    </div>
                    <div class="pop-bar-container">
                        <div class="pop-icon">üìÑ</div>
                        <div class="pop-bar">
                            <div class="pop-bar-fill paper-color" id="paperBar" style="height:33%;"></div>
                        </div>
                        <div class="pop-count" id="paperCount">0</div>
                    </div>
                    <div class="pop-bar-container">
                        <div class="pop-icon">‚úÇÔ∏è</div>
                        <div class="pop-bar">
                            <div class="pop-bar-fill scissors-color" id="scissorsBar" style="height:33%;"></div>
                        </div>
                        <div class="pop-count" id="scissorsCount">0</div>
                    </div>
                </div>

                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-dot rock-color"></div>
                        <span>Rock beats Scissors</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot scissors-color"></div>
                        <span>Scissors beats Paper</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot paper-color"></div>
                        <span>Paper beats Rock</span>
                    </div>
                </div>
            </div>

            <div class="panel">
                <h2>Simplex Trajectory</h2>
                <div class="simplex-container">
                    <canvas id="simplexCanvas"></canvas>
                </div>

                <h2 style="margin-top:20px;">Statistics</h2>
                <div class="stat-row">
                    <span>Generation</span>
                    <span id="generation">0</span>
                </div>
                <div class="stat-row">
                    <span>Biodiversity (Shannon)</span>
                    <span id="biodiversity">0</span>
                </div>
                <div class="stat-row">
                    <span>Cycle Period</span>
                    <span id="cyclePeriod">-</span>
                </div>

                <h2 style="margin-top:20px;">Population History</h2>
                <canvas id="historyChart" height="150"></canvas>

                <div style="font-size:0.85em; color:#aaa; line-height:1.6; margin-top:15px;">
                    <strong>Cyclic Dominance:</strong><br>
                    Rock ‚Üí Scissors ‚Üí Paper ‚Üí Rock creates oscillating dynamics.
                    In well-mixed populations, frequencies oscillate.
                    In spatial settings, spiral waves emerge.
                    <br><br>
                    <strong>Real examples:</strong> Bacteria competitions (E. coli colicin), lizard mating strategies, coral reef dynamics.
                </div>
            </div>
        </div>
    </div>

    <script>
        const spatialCanvas = document.getElementById('spatialCanvas');
        const spatialCtx = spatialCanvas.getContext('2d');
        const simplexCanvas = document.getElementById('simplexCanvas');
        const simplexCtx = simplexCanvas.getContext('2d');
        const historyCanvas = document.getElementById('historyChart');
        const historyCtx = historyCanvas.getContext('2d');

        const SIZE = 100;
        const TYPES = ['rock', 'paper', 'scissors'];
        const COLORS = {
            rock: '#78909c',
            paper: '#fdd835',
            scissors: '#ef5350'
        };

        // Rock beats Scissors, Scissors beats Paper, Paper beats Rock
        const beats = {
            rock: 'scissors',
            scissors: 'paper',
            paper: 'rock'
        };

        let grid = [];
        let generation = 0;
        let running = false;
        let history = { rock: [], paper: [], scissors: [] };
        let simplexPath = [];

        function init() {
            grid = [];
            for (let i = 0; i < SIZE; i++) {
                grid[i] = [];
                for (let j = 0; j < SIZE; j++) {
                    grid[i][j] = TYPES[Math.floor(Math.random() * 3)];
                }
            }
            generation = 0;
            history = { rock: [], paper: [], scissors: [] };
            simplexPath = [];

            updateDisplay();
            draw();
        }

        function step() {
            const mode = document.getElementById('mode').value;

            if (mode === 'spatial') {
                stepSpatial();
            } else {
                stepWellMixed();
            }

            generation++;
            updateDisplay();
            draw();
        }

        function stepSpatial() {
            // Random cell interactions
            const interactions = SIZE * SIZE;

            for (let n = 0; n < interactions; n++) {
                const i = Math.floor(Math.random() * SIZE);
                const j = Math.floor(Math.random() * SIZE);

                // Random neighbor
                const di = Math.floor(Math.random() * 3) - 1;
                const dj = Math.floor(Math.random() * 3) - 1;
                if (di === 0 && dj === 0) continue;

                const ni = (i + di + SIZE) % SIZE;
                const nj = (j + dj + SIZE) % SIZE;

                const myType = grid[i][j];
                const theirType = grid[ni][nj];

                // If I beat them, they become my type (reproduction)
                if (beats[myType] === theirType) {
                    grid[ni][nj] = myType;
                }
            }
        }

        function stepWellMixed() {
            // Count populations
            const counts = { rock: 0, paper: 0, scissors: 0 };
            for (let i = 0; i < SIZE; i++) {
                for (let j = 0; j < SIZE; j++) {
                    counts[grid[i][j]]++;
                }
            }

            const total = SIZE * SIZE;
            const freq = {
                rock: counts.rock / total,
                paper: counts.paper / total,
                scissors: counts.scissors / total
            };

            // Replicator dynamics
            const interactions = SIZE * SIZE;
            for (let n = 0; n < interactions; n++) {
                const i = Math.floor(Math.random() * SIZE);
                const j = Math.floor(Math.random() * SIZE);

                // Opponent type based on population frequency
                const r = Math.random();
                let opponent;
                if (r < freq.rock) opponent = 'rock';
                else if (r < freq.rock + freq.paper) opponent = 'paper';
                else opponent = 'scissors';

                const myType = grid[i][j];

                // If opponent beats me, I become their type
                if (beats[opponent] === myType) {
                    grid[i][j] = opponent;
                }
            }
        }

        function updateDisplay() {
            const counts = { rock: 0, paper: 0, scissors: 0 };
            for (let i = 0; i < SIZE; i++) {
                for (let j = 0; j < SIZE; j++) {
                    counts[grid[i][j]]++;
                }
            }

            const total = SIZE * SIZE;

            document.getElementById('rockCount').textContent = counts.rock;
            document.getElementById('paperCount').textContent = counts.paper;
            document.getElementById('scissorsCount').textContent = counts.scissors;

            document.getElementById('rockBar').style.height = (counts.rock / total * 100) + '%';
            document.getElementById('paperBar').style.height = (counts.paper / total * 100) + '%';
            document.getElementById('scissorsBar').style.height = (counts.scissors / total * 100) + '%';

            document.getElementById('generation').textContent = generation;

            // Shannon biodiversity
            const shannon = -TYPES.reduce((s, t) => {
                const p = counts[t] / total;
                return s + (p > 0 ? p * Math.log(p) : 0);
            }, 0);
            document.getElementById('biodiversity').textContent = shannon.toFixed(3);

            // Record history
            history.rock.push(counts.rock / total);
            history.paper.push(counts.paper / total);
            history.scissors.push(counts.scissors / total);

            if (history.rock.length > 300) {
                history.rock.shift();
                history.paper.shift();
                history.scissors.shift();
            }

            // Simplex path
            simplexPath.push({
                rock: counts.rock / total,
                paper: counts.paper / total,
                scissors: counts.scissors / total
            });
            if (simplexPath.length > 500) simplexPath.shift();

            drawHistory();
            drawSimplex();
        }

        function draw() {
            const dpr = window.devicePixelRatio || 1;
            spatialCanvas.width = spatialCanvas.offsetWidth * dpr;
            spatialCanvas.height = 400 * dpr;
            spatialCtx.scale(dpr, dpr);

            const w = spatialCanvas.offsetWidth;
            const h = 400;
            const cellW = w / SIZE;
            const cellH = h / SIZE;

            for (let i = 0; i < SIZE; i++) {
                for (let j = 0; j < SIZE; j++) {
                    spatialCtx.fillStyle = COLORS[grid[i][j]];
                    spatialCtx.fillRect(i * cellW, j * cellH, cellW + 1, cellH + 1);
                }
            }
        }

        function drawSimplex() {
            const rect = simplexCanvas.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            simplexCanvas.width = rect.width * dpr;
            simplexCanvas.height = rect.height * dpr;
            simplexCtx.scale(dpr, dpr);

            const w = rect.width;
            const h = rect.height;

            simplexCtx.fillStyle = 'rgba(0,0,0,0.2)';
            simplexCtx.fillRect(0, 0, w, h);

            // Triangle vertices
            const margin = 30;
            const triH = h - margin * 2;
            const triW = triH * 2 / Math.sqrt(3);

            const centerX = w / 2;
            const rock = { x: centerX, y: margin }; // top
            const paper = { x: centerX - triW / 2, y: margin + triH }; // bottom left
            const scissors = { x: centerX + triW / 2, y: margin + triH }; // bottom right

            // Draw triangle
            simplexCtx.strokeStyle = 'rgba(255,255,255,0.3)';
            simplexCtx.lineWidth = 2;
            simplexCtx.beginPath();
            simplexCtx.moveTo(rock.x, rock.y);
            simplexCtx.lineTo(paper.x, paper.y);
            simplexCtx.lineTo(scissors.x, scissors.y);
            simplexCtx.closePath();
            simplexCtx.stroke();

            // Labels
            simplexCtx.fillStyle = COLORS.rock;
            simplexCtx.font = '12px sans-serif';
            simplexCtx.textAlign = 'center';
            simplexCtx.fillText('ü™® Rock', rock.x, rock.y - 10);
            simplexCtx.fillStyle = COLORS.paper;
            simplexCtx.fillText('üìÑ Paper', paper.x - 20, paper.y + 15);
            simplexCtx.fillStyle = COLORS.scissors;
            simplexCtx.fillText('‚úÇÔ∏è Scissors', scissors.x + 20, scissors.y + 15);

            // Convert barycentric to Cartesian
            function toCartesian(r, p, s) {
                return {
                    x: r * rock.x + p * paper.x + s * scissors.x,
                    y: r * rock.y + p * paper.y + s * scissors.y
                };
            }

            // Draw path
            if (simplexPath.length > 1) {
                simplexCtx.strokeStyle = '#4fc3f7';
                simplexCtx.lineWidth = 1;
                simplexCtx.beginPath();

                for (let i = 0; i < simplexPath.length; i++) {
                    const pt = simplexPath[i];
                    const pos = toCartesian(pt.rock, pt.paper, pt.scissors);

                    if (i === 0) simplexCtx.moveTo(pos.x, pos.y);
                    else simplexCtx.lineTo(pos.x, pos.y);
                }
                simplexCtx.stroke();

                // Current point
                const current = simplexPath[simplexPath.length - 1];
                const currentPos = toCartesian(current.rock, current.paper, current.scissors);
                simplexCtx.fillStyle = '#fff';
                simplexCtx.beginPath();
                simplexCtx.arc(currentPos.x, currentPos.y, 5, 0, Math.PI * 2);
                simplexCtx.fill();
            }
        }

        function drawHistory() {
            const dpr = window.devicePixelRatio || 1;
            historyCanvas.width = historyCanvas.offsetWidth * dpr;
            historyCanvas.height = 150 * dpr;
            historyCtx.scale(dpr, dpr);

            const w = historyCanvas.offsetWidth;
            const h = 150;

            historyCtx.fillStyle = 'rgba(0,0,0,0.2)';
            historyCtx.fillRect(0, 0, w, h);

            if (history.rock.length < 2) return;

            const n = history.rock.length;

            // Draw each population
            for (const type of TYPES) {
                historyCtx.strokeStyle = COLORS[type];
                historyCtx.lineWidth = 2;
                historyCtx.beginPath();

                for (let i = 0; i < n; i++) {
                    const x = (i / (n - 1)) * w;
                    const y = h - history[type][i] * (h - 20) - 10;
                    if (i === 0) historyCtx.moveTo(x, y);
                    else historyCtx.lineTo(x, y);
                }
                historyCtx.stroke();
            }
        }

        let animationId = null;
        function animate() {
            if (!running) return;
            step();
            const speed = parseInt(document.getElementById('speed').value);
            animationId = setTimeout(animate, 1000 / speed);
        }

        // Event listeners
        document.getElementById('startBtn').onclick = () => {
            running = !running;
            document.getElementById('startBtn').textContent = running ? 'Pause' : 'Start';
            if (running) animate();
        };

        document.getElementById('stepBtn').onclick = () => {
            if (!running) step();
        };

        document.getElementById('resetBtn').onclick = init;

        // Initialize
        init();
    </script>
</body>
</html>
