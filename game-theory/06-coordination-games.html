<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coordination Games - Game Theory</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #eee;
            min-height: 100vh;
            padding: 20px;
        }
        .back-link {
            position: fixed; top: 20px; left: 20px; color: #4ade80; text-decoration: none;
            font-weight: 600; padding: 8px 16px; background: rgba(0,0,0,0.3); border-radius: 20px;
            z-index: 100;
        }
        h1 { text-align: center; margin: 40px 0 10px; font-size: 2.2em; color: #4ade80; }
        .subtitle { text-align: center; opacity: 0.8; margin-bottom: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .games-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; }
        .game-panel { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 25px; }
        h3 { color: #4ade80; margin-bottom: 15px; }
        .info-box { background: rgba(74, 222, 128, 0.1); border: 1px solid rgba(74, 222, 128, 0.3); border-radius: 8px; padding: 12px; margin-bottom: 15px; font-size: 0.85em; line-height: 1.5; }
        .matrix-table { width: 100%; border-collapse: collapse; margin: 15px 0; font-size: 0.9em; }
        .matrix-table th, .matrix-table td { border: 1px solid rgba(255,255,255,0.2); padding: 10px; text-align: center; }
        .matrix-table th { background: rgba(74, 222, 128, 0.2); }
        .cell-highlight { background: rgba(74, 222, 128, 0.3) !important; }
        canvas { width: 100%; height: 200px; border-radius: 8px; background: #0a0a15; margin: 10px 0; }
        .control-row { display: flex; gap: 10px; margin: 10px 0; }
        button { padding: 10px 16px; border: none; border-radius: 6px; font-size: 0.9em; font-weight: 600; cursor: pointer; flex: 1; }
        .btn-a { background: #4ade80; color: #1a1a2e; }
        .btn-b { background: #22d3ee; color: #1a1a2e; }
        .btn-run { background: rgba(255,255,255,0.2); color: #fff; }
        .result-display { text-align: center; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 8px; margin: 10px 0; }
        .result-text { font-size: 1.2em; color: #4ade80; }
        .population-display { display: flex; justify-content: space-around; margin: 15px 0; }
        .pop-item { text-align: center; }
        .pop-value { font-size: 1.8em; font-weight: 700; }
        .pop-label { font-size: 0.8em; opacity: 0.7; }
        .equilibria-box { background: rgba(250, 204, 21, 0.1); border: 1px solid rgba(250, 204, 21, 0.3); border-radius: 8px; padding: 12px; margin-top: 15px; }
        .equilibria-title { color: #facc15; font-weight: 600; margin-bottom: 8px; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back</a>
    <h1>Coordination Games</h1>
    <p class="subtitle">Stag Hunt, Battle of Sexes, and more</p>

    <div class="container">
        <div class="games-grid">
            <!-- Stag Hunt -->
            <div class="game-panel">
                <h3>Stag Hunt</h3>
                <div class="info-box">
                    Two hunters can hunt a stag (requires cooperation) or hunt hares individually.
                    Both equilibria (Stag, Stag) and (Hare, Hare) are Nash equilibria, but stag hunting is Pareto optimal.
                </div>

                <table class="matrix-table">
                    <tr><th></th><th>Stag</th><th>Hare</th></tr>
                    <tr><th>Stag</th><td class="cell-highlight" id="sh-ss">4, 4</td><td id="sh-sh">0, 3</td></tr>
                    <tr><th>Hare</th><td id="sh-hs">3, 0</td><td class="cell-highlight" id="sh-hh">3, 3</td></tr>
                </table>

                <canvas id="stagCanvas"></canvas>

                <div class="population-display">
                    <div class="pop-item">
                        <div class="pop-value" id="stagPop" style="color: #4ade80;">50%</div>
                        <div class="pop-label">Stag Hunters</div>
                    </div>
                    <div class="pop-item">
                        <div class="pop-value" id="harePop" style="color: #22d3ee;">50%</div>
                        <div class="pop-label">Hare Hunters</div>
                    </div>
                </div>

                <div class="control-row">
                    <button class="btn-a" onclick="setStagInit(0.8)">Start High</button>
                    <button class="btn-b" onclick="setStagInit(0.2)">Start Low</button>
                    <button class="btn-run" onclick="runStag()">Run</button>
                </div>

                <div class="equilibria-box">
                    <div class="equilibria-title">Nash Equilibria</div>
                    (Stag, Stag) - Payoff-dominant<br>
                    (Hare, Hare) - Risk-dominant
                </div>
            </div>

            <!-- Battle of Sexes -->
            <div class="game-panel">
                <h3>Battle of Sexes</h3>
                <div class="info-box">
                    A couple wants to spend time together but prefers different activities.
                    Being together is better than being apart, but each has a preferred activity.
                </div>

                <table class="matrix-table">
                    <tr><th></th><th>Opera</th><th>Football</th></tr>
                    <tr><th>Opera</th><td class="cell-highlight">3, 2</td><td>0, 0</td></tr>
                    <tr><th>Football</th><td>0, 0</td><td class="cell-highlight">2, 3</td></tr>
                </table>

                <canvas id="bosCanvas"></canvas>

                <div class="population-display">
                    <div class="pop-item">
                        <div class="pop-value" id="operaPop" style="color: #f472b6;">50%</div>
                        <div class="pop-label">Opera</div>
                    </div>
                    <div class="pop-item">
                        <div class="pop-value" id="footballPop" style="color: #fb923c;">50%</div>
                        <div class="pop-label">Football</div>
                    </div>
                </div>

                <div class="control-row">
                    <button class="btn-a" onclick="setBosInit(0.8)" style="background: #f472b6;">Opera Bias</button>
                    <button class="btn-b" onclick="setBosInit(0.2)" style="background: #fb923c;">Football Bias</button>
                    <button class="btn-run" onclick="runBos()">Run</button>
                </div>

                <div class="equilibria-box">
                    <div class="equilibria-title">Nash Equilibria</div>
                    (Opera, Opera), (Football, Football)<br>
                    Mixed: (3/5, 2/5) for each player
                </div>
            </div>

            <!-- Pure Coordination -->
            <div class="game-panel">
                <h3>Pure Coordination</h3>
                <div class="info-box">
                    Players just want to match - both choosing A or both choosing B.
                    No conflict of interest, just need to coordinate.
                </div>

                <table class="matrix-table">
                    <tr><th></th><th>A</th><th>B</th></tr>
                    <tr><th>A</th><td class="cell-highlight">1, 1</td><td>0, 0</td></tr>
                    <tr><th>B</th><td>0, 0</td><td class="cell-highlight">1, 1</td></tr>
                </table>

                <canvas id="pureCanvas"></canvas>

                <div class="population-display">
                    <div class="pop-item">
                        <div class="pop-value" id="purePop" style="color: #a78bfa;">50%</div>
                        <div class="pop-label">Choose A</div>
                    </div>
                </div>

                <div class="control-row">
                    <button class="btn-run" onclick="runPure()" style="width: 100%;">Run with Random Start</button>
                </div>

                <div class="equilibria-box">
                    <div class="equilibria-title">Nash Equilibria</div>
                    (A, A) and (B, B) - Both stable<br>
                    Unstable mixed at 50/50
                </div>
            </div>

            <!-- Assurance Game -->
            <div class="game-panel">
                <h3>Assurance Game</h3>
                <div class="info-box">
                    Similar to Stag Hunt but with higher payoffs for mutual cooperation.
                    Trust is essential - defection is costly for everyone.
                </div>

                <table class="matrix-table">
                    <tr><th></th><th>Cooperate</th><th>Defect</th></tr>
                    <tr><th>Cooperate</th><td class="cell-highlight">5, 5</td><td>-2, 2</td></tr>
                    <tr><th>Defect</th><td>2, -2</td><td class="cell-highlight">1, 1</td></tr>
                </table>

                <canvas id="assuranceCanvas"></canvas>

                <div class="population-display">
                    <div class="pop-item">
                        <div class="pop-value" id="coopPop" style="color: #4ade80;">50%</div>
                        <div class="pop-label">Cooperators</div>
                    </div>
                </div>

                <div class="control-row">
                    <button class="btn-a" onclick="setAssuranceInit(0.7)">High Trust</button>
                    <button class="btn-b" onclick="setAssuranceInit(0.3)">Low Trust</button>
                    <button class="btn-run" onclick="runAssurance()">Run</button>
                </div>

                <div class="equilibria-box">
                    <div class="equilibria-title">Threshold</div>
                    If cooperation > 60%, evolves to full cooperation<br>
                    Otherwise, collapses to defection
                </div>
            </div>
        </div>
    </div>

    <script>
        // Canvas setup
        const canvases = {
            stag: { el: document.getElementById('stagCanvas'), ctx: null, history: [], prop: 0.5 },
            bos: { el: document.getElementById('bosCanvas'), ctx: null, history: [], prop: 0.5 },
            pure: { el: document.getElementById('pureCanvas'), ctx: null, history: [], prop: 0.5 },
            assurance: { el: document.getElementById('assuranceCanvas'), ctx: null, history: [], prop: 0.5 }
        };

        Object.keys(canvases).forEach(k => {
            canvases[k].el.width = 350;
            canvases[k].el.height = 200;
            canvases[k].ctx = canvases[k].el.getContext('2d');
        });

        // Replicator dynamics helper
        function replicator(p, fitA, fitB, speed = 0.1) {
            const avgFit = p * fitA + (1 - p) * fitB;
            const delta = p * (fitA - avgFit) * speed;
            return Math.min(0.99, Math.max(0.01, p + delta));
        }

        // Stag Hunt
        function stagFitness(p) {
            // Stag: p*4 + (1-p)*0
            // Hare: p*3 + (1-p)*3 = 3
            return { stag: p * 4, hare: 3 };
        }

        let stagRunning = false;
        function setStagInit(p) {
            canvases.stag.prop = p;
            canvases.stag.history = [];
            updateStagDisplay();
        }

        function updateStagDisplay() {
            const p = canvases.stag.prop;
            document.getElementById('stagPop').textContent = Math.round(p * 100) + '%';
            document.getElementById('harePop').textContent = Math.round((1 - p) * 100) + '%';
            drawHistory(canvases.stag, '#4ade80', '#22d3ee');
        }

        async function runStag() {
            if (stagRunning) return;
            stagRunning = true;
            canvases.stag.history = [];

            for (let i = 0; i < 100 && stagRunning; i++) {
                const fit = stagFitness(canvases.stag.prop);
                canvases.stag.prop = replicator(canvases.stag.prop, fit.stag, fit.hare);
                canvases.stag.history.push(canvases.stag.prop);
                updateStagDisplay();
                await new Promise(r => setTimeout(r, 30));
            }
            stagRunning = false;
        }

        // Battle of Sexes
        function bosFitness(p) {
            // Opera (row prefers): p*3 + (1-p)*0
            // Football: p*0 + (1-p)*2
            return { opera: p * 3, football: (1 - p) * 2 };
        }

        let bosRunning = false;
        function setBosInit(p) {
            canvases.bos.prop = p;
            canvases.bos.history = [];
            updateBosDisplay();
        }

        function updateBosDisplay() {
            const p = canvases.bos.prop;
            document.getElementById('operaPop').textContent = Math.round(p * 100) + '%';
            document.getElementById('footballPop').textContent = Math.round((1 - p) * 100) + '%';
            drawHistory(canvases.bos, '#f472b6', '#fb923c');
        }

        async function runBos() {
            if (bosRunning) return;
            bosRunning = true;
            canvases.bos.history = [];

            for (let i = 0; i < 100 && bosRunning; i++) {
                const fit = bosFitness(canvases.bos.prop);
                canvases.bos.prop = replicator(canvases.bos.prop, fit.opera, fit.football);
                canvases.bos.history.push(canvases.bos.prop);
                updateBosDisplay();
                await new Promise(r => setTimeout(r, 30));
            }
            bosRunning = false;
        }

        // Pure Coordination
        function pureFitness(p) {
            return { a: p, b: 1 - p };
        }

        let pureRunning = false;
        async function runPure() {
            if (pureRunning) return;
            canvases.pure.prop = 0.3 + Math.random() * 0.4; // Random start
            canvases.pure.history = [];
            pureRunning = true;

            for (let i = 0; i < 100 && pureRunning; i++) {
                const fit = pureFitness(canvases.pure.prop);
                canvases.pure.prop = replicator(canvases.pure.prop, fit.a, fit.b);
                canvases.pure.history.push(canvases.pure.prop);
                document.getElementById('purePop').textContent = Math.round(canvases.pure.prop * 100) + '%';
                drawHistory(canvases.pure, '#a78bfa', '#60a5fa');
                await new Promise(r => setTimeout(r, 30));
            }
            pureRunning = false;
        }

        // Assurance Game
        function assuranceFitness(p) {
            // Cooperate: p*5 + (1-p)*(-2)
            // Defect: p*2 + (1-p)*1
            return { coop: p * 5 + (1 - p) * (-2), defect: p * 2 + (1 - p) * 1 };
        }

        let assuranceRunning = false;
        function setAssuranceInit(p) {
            canvases.assurance.prop = p;
            canvases.assurance.history = [];
            updateAssuranceDisplay();
        }

        function updateAssuranceDisplay() {
            const p = canvases.assurance.prop;
            document.getElementById('coopPop').textContent = Math.round(p * 100) + '%';
            drawHistory(canvases.assurance, '#4ade80', '#f87171');
        }

        async function runAssurance() {
            if (assuranceRunning) return;
            assuranceRunning = true;
            canvases.assurance.history = [];

            for (let i = 0; i < 100 && assuranceRunning; i++) {
                const fit = assuranceFitness(canvases.assurance.prop);
                canvases.assurance.prop = replicator(canvases.assurance.prop, fit.coop, fit.defect);
                canvases.assurance.history.push(canvases.assurance.prop);
                updateAssuranceDisplay();
                await new Promise(r => setTimeout(r, 30));
            }
            assuranceRunning = false;
        }

        // Drawing helper
        function drawHistory(c, colorA, colorB) {
            const ctx = c.ctx;
            const w = c.el.width;
            const h = c.el.height;

            ctx.fillStyle = '#0a0a15';
            ctx.fillRect(0, 0, w, h);

            if (c.history.length < 2) return;

            // Draw proportion line
            ctx.strokeStyle = colorA;
            ctx.lineWidth = 2;
            ctx.beginPath();
            c.history.forEach((p, i) => {
                const x = (i / (c.history.length - 1)) * w;
                const y = h * (1 - p);
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            ctx.stroke();

            // 50% line
            ctx.strokeStyle = 'rgba(255,255,255,0.2)';
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(0, h / 2);
            ctx.lineTo(w, h / 2);
            ctx.stroke();
            ctx.setLineDash([]);
        }

        // Initialize displays
        updateStagDisplay();
        updateBosDisplay();
        updateAssuranceDisplay();
        document.getElementById('purePop').textContent = '50%';
        Object.keys(canvases).forEach(k => drawHistory(canvases[k], '#4ade80', '#22d3ee'));
    </script>
</body>
</html>
