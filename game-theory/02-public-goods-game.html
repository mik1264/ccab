<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Public Goods Game - Game Theory</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0e1a;
            color: #e0e0e0;
            overflow-x: hidden;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .back-link {
            display: inline-block;
            color: #64b5f6;
            text-decoration: none;
            margin-bottom: 20px;
            font-size: 16px;
            transition: color 0.3s;
        }

        .back-link:hover {
            color: #90caf9;
        }

        h1 {
            color: #fff;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .description {
            color: #b0b0b0;
            margin-bottom: 30px;
            line-height: 1.6;
            max-width: 800px;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
            margin-bottom: 20px;
        }

        .canvas-container {
            background: #151b2b;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #2a3f5f;
        }

        canvas {
            display: block;
            width: 100%;
            background: #0a0e1a;
            border-radius: 5px;
        }

        .controls-panel {
            background: #151b2b;
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #2a3f5f;
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            color: #64b5f6;
            font-weight: 500;
        }

        button {
            width: 100%;
            padding: 12px;
            background: #1976d2;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background 0.3s;
            margin-bottom: 10px;
        }

        button:hover {
            background: #1565c0;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        input[type="range"] {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: #2a3f5f;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #64b5f6;
            cursor: pointer;
        }

        .slider-value {
            min-width: 50px;
            text-align: right;
            color: #90caf9;
            font-weight: 500;
        }

        .stats-box {
            background: #0f1520;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .stats-box h3 {
            color: #64b5f6;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #2a3f5f;
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #b0b0b0;
        }

        .stat-value {
            color: #81c784;
            font-weight: 600;
        }

        .player-contribution {
            background: #0f1520;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
        }

        .player-contribution label {
            display: block;
            margin-bottom: 5px;
            color: #90caf9;
            font-size: 13px;
        }

        .contribution-bar {
            width: 100%;
            height: 25px;
            background: #1a2332;
            border-radius: 3px;
            position: relative;
            overflow: hidden;
        }

        .contribution-fill {
            height: 100%;
            background: linear-gradient(90deg, #4fc3f7, #64b5f6);
            transition: width 0.3s;
        }

        .contribution-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-weight: 600;
            font-size: 12px;
        }

        .info-box {
            background: #1a2332;
            border-left: 4px solid #64b5f6;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
        }

        .info-box h3 {
            color: #64b5f6;
            margin-bottom: 10px;
        }

        .info-box p {
            line-height: 1.6;
            color: #b0b0b0;
            margin-bottom: 8px;
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">← Back to Game Theory</a>

        <h1>Public Goods Game</h1>
        <p class="description">
            N players each receive an endowment and decide how much to contribute to a common pool.
            The pool is multiplied and redistributed equally. Free-riders benefit without contributing,
            creating a tension between individual and group interests.
        </p>

        <div class="main-grid">
            <div class="canvas-container">
                <canvas id="canvas"></canvas>
            </div>

            <div class="controls-panel">
                <div class="control-group">
                    <button id="playRoundBtn">Play Round</button>
                    <button id="resetBtn">Reset Game</button>
                </div>

                <div class="control-group">
                    <label>Number of Players: <span id="playersValue">5</span></label>
                    <div class="slider-container">
                        <input type="range" id="playersSlider" min="3" max="10" value="5">
                        <span class="slider-value" id="playersDisplay">5</span>
                    </div>
                </div>

                <div class="control-group">
                    <label>Multiplier: <span id="multiplierValue">2.0</span></label>
                    <div class="slider-container">
                        <input type="range" id="multiplierSlider" min="10" max="40" value="20">
                        <span class="slider-value" id="multiplierDisplay">2.0</span>
                    </div>
                </div>

                <div class="control-group">
                    <label>Endowment per Player: <span id="endowmentValue">10</span></label>
                    <div class="slider-container">
                        <input type="range" id="endowmentSlider" min="5" max="20" value="10">
                        <span class="slider-value" id="endowmentDisplay">10</span>
                    </div>
                </div>

                <div class="stats-box">
                    <h3>Current Round Stats</h3>
                    <div class="stat-row">
                        <span class="stat-label">Round</span>
                        <span class="stat-value" id="roundNum">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Total Contributed</span>
                        <span class="stat-value" id="totalContrib">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Pool (after multiplier)</span>
                        <span class="stat-value" id="poolValue">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Redistribution per Player</span>
                        <span class="stat-value" id="redistValue">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Avg Contribution %</span>
                        <span class="stat-value" id="avgContrib">0%</span>
                    </div>
                </div>

                <div id="playerContributions"></div>
            </div>
        </div>

        <div class="info-box">
            <h3>About the Public Goods Game</h3>
            <p><strong>The Dilemma:</strong> Each player receives an endowment (e.g., 10 coins). They simultaneously decide how much to contribute to a public pool.</p>
            <p><strong>Multiplication:</strong> The total pool is multiplied (e.g., by 2.0) and then divided equally among all players.</p>
            <p><strong>The Paradox:</strong> Individually, it's rational to contribute nothing (free-ride) since you keep your endowment plus your share of others' contributions. But if everyone free-rides, the total payoff is minimized.</p>
            <p><strong>Example:</strong> With 5 players, endowment 10, multiplier 2.0:</p>
            <p>• If everyone contributes 10: Pool = 50 × 2 = 100. Each gets 20. Net gain: +10 each.</p>
            <p>• If you contribute 0 and others contribute 10: Pool = 40 × 2 = 80. Each gets 16. You net: 10 + 16 = 26.</p>
            <p>• If everyone contributes 0: Pool = 0. Each keeps 10. No gain.</p>
            <p>This game models real-world scenarios like taxation, environmental protection, and public infrastructure funding.</p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth - 40;
            canvas.height = 600;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Game state
        let numPlayers = 5;
        let multiplier = 2.0;
        let endowment = 10;
        let round = 0;
        let players = [];
        let history = [];

        class Player {
            constructor(id) {
                this.id = id;
                this.wealth = 0;
                this.contribution = 0;
                this.contributionPercent = Math.random(); // Random strategy initially
                this.color = `hsl(${id * 360 / numPlayers}, 70%, 60%)`;
            }

            decide() {
                // Randomize contribution strategy
                this.contribution = Math.round(endowment * this.contributionPercent);
                return this.contribution;
            }

            receive(amount) {
                this.wealth += amount;
            }
        }

        function initializePlayers() {
            players = [];
            for (let i = 0; i < numPlayers; i++) {
                players.push(new Player(i));
            }
            updatePlayerControls();
        }

        function updatePlayerControls() {
            const container = document.getElementById('playerContributions');
            container.innerHTML = players.map(p => `
                <div class="player-contribution">
                    <label>Player ${p.id + 1} Contribution</label>
                    <div class="contribution-bar">
                        <div class="contribution-fill" id="player${p.id}bar" style="width: ${p.contributionPercent * 100}%"></div>
                        <div class="contribution-text" id="player${p.id}text">${Math.round(endowment * p.contributionPercent)}/${endowment}</div>
                    </div>
                    <input type="range" min="0" max="100" value="${p.contributionPercent * 100}"
                           style="width: 100%; margin-top: 5px;"
                           onchange="updatePlayerContribution(${p.id}, this.value)">
                </div>
            `).join('');
        }

        window.updatePlayerContribution = function(playerId, value) {
            const percent = value / 100;
            players[playerId].contributionPercent = percent;
            const contrib = Math.round(endowment * percent);
            document.getElementById(`player${playerId}bar`).style.width = `${value}%`;
            document.getElementById(`player${playerId}text`).textContent = `${contrib}/${endowment}`;
        };

        function playRound() {
            round++;

            // Collect contributions
            let totalContribution = 0;
            players.forEach(p => {
                p.contribution = p.decide();
                totalContribution += p.contribution;
            });

            // Multiply and redistribute
            const pool = totalContribution * multiplier;
            const redistribution = pool / numPlayers;

            // Calculate wealth
            players.forEach(p => {
                const kept = endowment - p.contribution;
                const received = redistribution;
                p.wealth = kept + received;
            });

            // Update stats
            document.getElementById('roundNum').textContent = round;
            document.getElementById('totalContrib').textContent = totalContribution;
            document.getElementById('poolValue').textContent = pool.toFixed(1);
            document.getElementById('redistValue').textContent = redistribution.toFixed(2);
            const avgPercent = (totalContribution / (numPlayers * endowment) * 100).toFixed(1);
            document.getElementById('avgContrib').textContent = avgPercent + '%';

            // Store in history
            history.push({
                round,
                totalContribution,
                pool,
                redistribution,
                players: players.map(p => ({
                    contribution: p.contribution,
                    wealth: p.wealth
                }))
            });

            draw();
        }

        function draw() {
            ctx.fillStyle = '#0a0e1a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            if (history.length === 0) {
                ctx.fillStyle = '#64b5f6';
                ctx.font = '20px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Click "Play Round" to start', canvas.width / 2, canvas.height / 2);
                return;
            }

            // Draw history graph
            const margin = 60;
            const graphWidth = canvas.width - margin * 2;
            const graphHeight = 200;
            const graphY = 50;

            // Draw axes
            ctx.strokeStyle = '#2a3f5f';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(margin, graphY);
            ctx.lineTo(margin, graphY + graphHeight);
            ctx.lineTo(canvas.width - margin, graphY + graphHeight);
            ctx.stroke();

            // Draw labels
            ctx.fillStyle = '#64b5f6';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Total Contributions Over Time', canvas.width / 2, 30);

            // Draw contribution line
            if (history.length > 1) {
                const maxContrib = Math.max(...history.map(h => h.totalContribution), numPlayers * endowment);
                const xStep = graphWidth / (history.length - 1);

                ctx.strokeStyle = '#4fc3f7';
                ctx.lineWidth = 3;
                ctx.beginPath();
                history.forEach((h, i) => {
                    const x = margin + i * xStep;
                    const y = graphY + graphHeight - (h.totalContribution / maxContrib) * graphHeight;
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                });
                ctx.stroke();

                // Draw points
                ctx.fillStyle = '#4fc3f7';
                history.forEach((h, i) => {
                    const x = margin + i * xStep;
                    const y = graphY + graphHeight - (h.totalContribution / maxContrib) * graphHeight;
                    ctx.beginPath();
                    ctx.arc(x, y, 4, 0, Math.PI * 2);
                    ctx.fill();
                });
            }

            // Draw current player wealth bars
            const barY = graphY + graphHeight + 80;
            const barWidth = graphWidth / numPlayers;
            const maxWealth = Math.max(...players.map(p => p.wealth), endowment);

            ctx.fillStyle = '#64b5f6';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Player Wealth After Round ' + round, canvas.width / 2, barY - 20);

            players.forEach((p, i) => {
                const x = margin + i * barWidth;
                const barHeight = (p.wealth / maxWealth) * 150;
                const y = barY + 150 - barHeight;

                // Draw bar
                ctx.fillStyle = p.color;
                ctx.fillRect(x + 5, y, barWidth - 10, barHeight);

                // Draw wealth value
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 12px Arial';
                ctx.fillText(p.wealth.toFixed(1), x + barWidth / 2, y - 5);

                // Draw contribution
                ctx.fillStyle = '#b0b0b0';
                ctx.font = '11px Arial';
                ctx.fillText(`(gave ${p.contribution})`, x + barWidth / 2, y - 20);

                // Draw player label
                ctx.fillStyle = '#64b5f6';
                ctx.fillText(`P${i + 1}`, x + barWidth / 2, barY + 170);
            });

            // Draw reference line for endowment
            const endowmentY = barY + 150 - (endowment / maxWealth) * 150;
            ctx.strokeStyle = '#ffb74d';
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(margin, endowmentY);
            ctx.lineTo(canvas.width - margin, endowmentY);
            ctx.stroke();
            ctx.setLineDash([]);

            ctx.fillStyle = '#ffb74d';
            ctx.font = '11px Arial';
            ctx.textAlign = 'right';
            ctx.fillText('Initial endowment', margin - 5, endowmentY + 4);
        }

        // Event listeners
        document.getElementById('playRoundBtn').addEventListener('click', playRound);

        document.getElementById('resetBtn').addEventListener('click', () => {
            round = 0;
            history = [];
            initializePlayers();
            document.getElementById('roundNum').textContent = '0';
            document.getElementById('totalContrib').textContent = '0';
            document.getElementById('poolValue').textContent = '0';
            document.getElementById('redistValue').textContent = '0';
            document.getElementById('avgContrib').textContent = '0%';
            draw();
        });

        document.getElementById('playersSlider').addEventListener('input', (e) => {
            numPlayers = parseInt(e.target.value);
            document.getElementById('playersDisplay').textContent = numPlayers;
            initializePlayers();
            round = 0;
            history = [];
            draw();
        });

        document.getElementById('multiplierSlider').addEventListener('input', (e) => {
            multiplier = parseInt(e.target.value) / 10;
            document.getElementById('multiplierDisplay').textContent = multiplier.toFixed(1);
        });

        document.getElementById('endowmentSlider').addEventListener('input', (e) => {
            endowment = parseInt(e.target.value);
            document.getElementById('endowmentDisplay').textContent = endowment;
            updatePlayerControls();
        });

        // Expose functions for enhance.js keyboard shortcuts
        window.reset = function() { initializePlayers(); draw(); };

        // Initialize
        initializePlayers();
        draw();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
