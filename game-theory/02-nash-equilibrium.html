<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nash Equilibrium Finder - Game Theory</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #eee;
            min-height: 100vh;
            padding: 20px;
        }
        .back-link {
            position: fixed; top: 20px; left: 20px; color: #4ade80; text-decoration: none;
            font-weight: 600; padding: 8px 16px; background: rgba(0,0,0,0.3); border-radius: 20px;
            transition: all 0.3s; z-index: 100;
        }
        .back-link:hover { background: rgba(74, 222, 128, 0.2); }
        h1 { text-align: center; margin: 40px 0 10px; font-size: 2.2em; color: #4ade80; }
        .subtitle { text-align: center; opacity: 0.8; margin-bottom: 30px; }
        .container { max-width: 1000px; margin: 0 auto; display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        .panel { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 25px; }
        .info-box { background: rgba(74, 222, 128, 0.1); border: 1px solid rgba(74, 222, 128, 0.3); border-radius: 8px; padding: 15px; margin-bottom: 20px; font-size: 0.9em; line-height: 1.6; }
        h3 { color: #4ade80; margin-bottom: 15px; }
        .matrix-container { display: flex; flex-direction: column; gap: 10px; }
        .matrix-row { display: flex; gap: 10px; align-items: center; }
        .matrix-label { width: 80px; text-align: right; padding-right: 10px; font-weight: 600; }
        .matrix-cell { display: flex; gap: 5px; }
        .matrix-cell input {
            width: 50px; padding: 8px; border: 1px solid rgba(255,255,255,0.2); border-radius: 6px;
            background: rgba(0,0,0,0.3); color: #fff; text-align: center; font-size: 1em;
        }
        .header-row { margin-left: 90px; display: flex; gap: 10px; margin-bottom: 10px; }
        .header-cell { width: 110px; text-align: center; font-weight: 600; color: #22d3ee; }
        .result-box { background: rgba(0,0,0,0.3); border-radius: 8px; padding: 20px; margin-top: 20px; }
        .equilibrium { background: rgba(74, 222, 128, 0.2); border: 2px solid #4ade80; border-radius: 8px; padding: 15px; margin: 10px 0; }
        .equilibrium-title { font-weight: 700; color: #4ade80; margin-bottom: 5px; }
        button { padding: 12px 24px; border: none; border-radius: 8px; font-size: 1em; font-weight: 600; cursor: pointer; transition: all 0.3s; margin: 5px; }
        .btn-primary { background: #4ade80; color: #1a1a2e; }
        .btn-primary:hover { background: #22c55e; }
        .btn-secondary { background: rgba(255,255,255,0.1); color: #fff; }
        .btn-secondary:hover { background: rgba(255,255,255,0.2); }
        canvas { width: 100%; height: 300px; border-radius: 8px; background: #0a0a15; margin-top: 15px; }
        .preset-games { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; }
        .preset-btn { padding: 6px 12px; font-size: 0.85em; }
        .player-colors { display: flex; gap: 20px; margin-top: 10px; }
        .player-color { display: flex; align-items: center; gap: 8px; }
        .color-dot { width: 12px; height: 12px; border-radius: 50%; }
        @media (max-width: 800px) { .container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back</a>
    <h1>Nash Equilibrium Finder</h1>
    <p class="subtitle">Find pure and mixed strategy Nash equilibria in 2x2 games</p>

    <div class="container">
        <div class="panel">
            <div class="info-box">
                <strong>Nash Equilibrium</strong>: A strategy profile where no player can benefit by unilaterally changing their strategy.
                Enter payoffs as (Row player, Column player).
            </div>

            <div class="preset-games">
                <button class="btn-secondary preset-btn" onclick="loadPreset('pd')">Prisoner's Dilemma</button>
                <button class="btn-secondary preset-btn" onclick="loadPreset('chicken')">Chicken</button>
                <button class="btn-secondary preset-btn" onclick="loadPreset('stag')">Stag Hunt</button>
                <button class="btn-secondary preset-btn" onclick="loadPreset('matching')">Matching Pennies</button>
                <button class="btn-secondary preset-btn" onclick="loadPreset('bos')">Battle of Sexes</button>
            </div>

            <h3>Payoff Matrix</h3>
            <div class="matrix-container">
                <div class="header-row">
                    <div class="header-cell">Left</div>
                    <div class="header-cell">Right</div>
                </div>
                <div class="matrix-row">
                    <div class="matrix-label">Up</div>
                    <div class="matrix-cell">
                        <input type="number" id="a11_r" value="3">
                        <input type="number" id="a11_c" value="3">
                    </div>
                    <div class="matrix-cell">
                        <input type="number" id="a12_r" value="0">
                        <input type="number" id="a12_c" value="5">
                    </div>
                </div>
                <div class="matrix-row">
                    <div class="matrix-label">Down</div>
                    <div class="matrix-cell">
                        <input type="number" id="a21_r" value="5">
                        <input type="number" id="a21_c" value="0">
                    </div>
                    <div class="matrix-cell">
                        <input type="number" id="a22_r" value="1">
                        <input type="number" id="a22_c" value="1">
                    </div>
                </div>
            </div>

            <div class="player-colors">
                <div class="player-color"><div class="color-dot" style="background: #4ade80;"></div> Row Player</div>
                <div class="player-color"><div class="color-dot" style="background: #22d3ee;"></div> Column Player</div>
            </div>

            <div style="margin-top: 20px;">
                <button class="btn-primary" onclick="findEquilibria()">Find Equilibria</button>
            </div>
        </div>

        <div class="panel">
            <h3>Results</h3>
            <div class="result-box" id="results">
                <p style="opacity: 0.6;">Click "Find Equilibria" to analyze the game.</p>
            </div>

            <h3 style="margin-top: 20px;">Best Response Visualization</h3>
            <canvas id="canvas"></canvas>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 400;
        canvas.height = 300;

        const presets = {
            pd: { name: "Prisoner's Dilemma", values: [3,3, 0,5, 5,0, 1,1] },
            chicken: { name: "Chicken (Hawk-Dove)", values: [0,0, -1,1, 1,-1, -10,-10] },
            stag: { name: "Stag Hunt", values: [4,4, 0,3, 3,0, 3,3] },
            matching: { name: "Matching Pennies", values: [1,-1, -1,1, -1,1, 1,-1] },
            bos: { name: "Battle of Sexes", values: [3,2, 0,0, 0,0, 2,3] }
        };

        function loadPreset(key) {
            const p = presets[key].values;
            document.getElementById('a11_r').value = p[0];
            document.getElementById('a11_c').value = p[1];
            document.getElementById('a12_r').value = p[2];
            document.getElementById('a12_c').value = p[3];
            document.getElementById('a21_r').value = p[4];
            document.getElementById('a21_c').value = p[5];
            document.getElementById('a22_r').value = p[6];
            document.getElementById('a22_c').value = p[7];
            findEquilibria();
        }

        function getMatrix() {
            return {
                a11: [parseFloat(document.getElementById('a11_r').value), parseFloat(document.getElementById('a11_c').value)],
                a12: [parseFloat(document.getElementById('a12_r').value), parseFloat(document.getElementById('a12_c').value)],
                a21: [parseFloat(document.getElementById('a21_r').value), parseFloat(document.getElementById('a21_c').value)],
                a22: [parseFloat(document.getElementById('a22_r').value), parseFloat(document.getElementById('a22_c').value)]
            };
        }

        function findEquilibria() {
            const m = getMatrix();
            const results = [];

            // Check pure strategy Nash equilibria
            // (Up, Left) is NE if: a11_r >= a21_r (Row doesn't want to deviate) AND a11_c >= a12_c (Col doesn't want to deviate)
            const pureNE = [];

            if (m.a11[0] >= m.a21[0] && m.a11[1] >= m.a12[1]) {
                pureNE.push({ row: 'Up', col: 'Left', payoffs: m.a11 });
            }
            if (m.a12[0] >= m.a22[0] && m.a12[1] >= m.a11[1]) {
                pureNE.push({ row: 'Up', col: 'Right', payoffs: m.a12 });
            }
            if (m.a21[0] >= m.a11[0] && m.a21[1] >= m.a22[1]) {
                pureNE.push({ row: 'Down', col: 'Left', payoffs: m.a21 });
            }
            if (m.a22[0] >= m.a12[0] && m.a22[1] >= m.a21[1]) {
                pureNE.push({ row: 'Down', col: 'Right', payoffs: m.a22 });
            }

            // Find mixed strategy NE
            // Row player mixes so Column is indifferent: p*a11_c + (1-p)*a21_c = p*a12_c + (1-p)*a22_c
            // Col player mixes so Row is indifferent: q*a11_r + (1-q)*a12_r = q*a21_r + (1-q)*a22_r

            let mixedNE = null;

            // Solve for p (probability Row plays Up)
            const pNum = m.a22[1] - m.a21[1];
            const pDen = (m.a11[1] - m.a21[1]) - (m.a12[1] - m.a22[1]);

            // Solve for q (probability Col plays Left)
            const qNum = m.a22[0] - m.a12[0];
            const qDen = (m.a11[0] - m.a12[0]) - (m.a21[0] - m.a22[0]);

            if (pDen !== 0 && qDen !== 0) {
                const p = pNum / pDen;
                const q = qNum / qDen;

                if (p > 0 && p < 1 && q > 0 && q < 1) {
                    const rowPayoff = q * m.a11[0] + (1-q) * m.a12[0];
                    const colPayoff = p * m.a11[1] + (1-p) * m.a21[1];
                    mixedNE = { p, q, rowPayoff, colPayoff };
                }
            }

            // Display results
            let html = '';

            if (pureNE.length > 0) {
                html += '<h4 style="color: #4ade80;">Pure Strategy Nash Equilibria</h4>';
                pureNE.forEach(ne => {
                    html += `<div class="equilibrium">
                        <div class="equilibrium-title">(${ne.row}, ${ne.col})</div>
                        Payoffs: Row = ${ne.payoffs[0]}, Column = ${ne.payoffs[1]}
                    </div>`;
                });
            } else {
                html += '<p style="opacity: 0.6;">No pure strategy Nash equilibria found.</p>';
            }

            if (mixedNE) {
                html += '<h4 style="color: #22d3ee; margin-top: 20px;">Mixed Strategy Nash Equilibrium</h4>';
                html += `<div class="equilibrium" style="border-color: #22d3ee; background: rgba(34, 211, 238, 0.2);">
                    <div class="equilibrium-title">Mixed Strategy NE</div>
                    Row plays Up with probability: ${mixedNE.p.toFixed(3)}<br>
                    Column plays Left with probability: ${mixedNE.q.toFixed(3)}<br>
                    Expected payoffs: Row = ${mixedNE.rowPayoff.toFixed(3)}, Col = ${mixedNE.colPayoff.toFixed(3)}
                </div>`;
            }

            document.getElementById('results').innerHTML = html;
            drawBestResponse(m, pureNE, mixedNE);
        }

        function drawBestResponse(m, pureNE, mixedNE) {
            ctx.fillStyle = '#0a0a15';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const margin = 50;
            const w = canvas.width - 2 * margin;
            const h = canvas.height - 2 * margin;

            // Draw axes
            ctx.strokeStyle = 'rgba(255,255,255,0.3)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(margin, margin);
            ctx.lineTo(margin, margin + h);
            ctx.lineTo(margin + w, margin + h);
            ctx.stroke();

            // Labels
            ctx.fillStyle = '#fff';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('q (Column plays Left)', margin + w/2, canvas.height - 10);
            ctx.save();
            ctx.translate(15, margin + h/2);
            ctx.rotate(-Math.PI/2);
            ctx.fillText('p (Row plays Up)', 0, 0);
            ctx.restore();

            // Draw Row's best response (green)
            ctx.strokeStyle = '#4ade80';
            ctx.lineWidth = 3;
            ctx.beginPath();

            // Row's BR: if q*a11_r + (1-q)*a12_r > q*a21_r + (1-q)*a22_r, play Up (p=1)
            // Indifference when q = (a22_r - a12_r) / ((a11_r - a12_r) - (a21_r - a22_r))
            const qIndiff = (m.a22[0] - m.a12[0]) / ((m.a11[0] - m.a12[0]) - (m.a21[0] - m.a22[0]));

            if (isFinite(qIndiff) && qIndiff > 0 && qIndiff < 1) {
                // Check which side prefers Up
                const prefUpAtQ0 = m.a12[0] > m.a22[0];
                if (prefUpAtQ0) {
                    ctx.moveTo(margin, margin); // q=0, p=1
                    ctx.lineTo(margin + qIndiff * w, margin); // q=qIndiff, p=1
                    ctx.lineTo(margin + qIndiff * w, margin + h); // vertical at indifference
                    ctx.lineTo(margin + w, margin + h); // q=1, p=0
                } else {
                    ctx.moveTo(margin, margin + h); // q=0, p=0
                    ctx.lineTo(margin + qIndiff * w, margin + h);
                    ctx.lineTo(margin + qIndiff * w, margin);
                    ctx.lineTo(margin + w, margin);
                }
            } else {
                // Dominated strategy
                const alwaysUp = m.a11[0] >= m.a21[0] && m.a12[0] >= m.a22[0];
                ctx.moveTo(margin, alwaysUp ? margin : margin + h);
                ctx.lineTo(margin + w, alwaysUp ? margin : margin + h);
            }
            ctx.stroke();

            // Draw Column's best response (cyan)
            ctx.strokeStyle = '#22d3ee';
            ctx.beginPath();

            const pIndiff = (m.a22[1] - m.a21[1]) / ((m.a11[1] - m.a21[1]) - (m.a12[1] - m.a22[1]));

            if (isFinite(pIndiff) && pIndiff > 0 && pIndiff < 1) {
                const prefLeftAtP0 = m.a21[1] > m.a22[1];
                if (prefLeftAtP0) {
                    ctx.moveTo(margin, margin + h);
                    ctx.lineTo(margin, margin + h - pIndiff * h);
                    ctx.lineTo(margin + w, margin + h - pIndiff * h);
                    ctx.lineTo(margin + w, margin);
                } else {
                    ctx.moveTo(margin + w, margin + h);
                    ctx.lineTo(margin + w, margin + h - pIndiff * h);
                    ctx.lineTo(margin, margin + h - pIndiff * h);
                    ctx.lineTo(margin, margin);
                }
            } else {
                const alwaysLeft = m.a11[1] >= m.a12[1] && m.a21[1] >= m.a22[1];
                ctx.moveTo(alwaysLeft ? margin : margin + w, margin);
                ctx.lineTo(alwaysLeft ? margin : margin + w, margin + h);
            }
            ctx.stroke();

            // Draw equilibrium points
            pureNE.forEach(ne => {
                const x = margin + (ne.col === 'Left' ? 0 : w);
                const y = margin + (ne.row === 'Up' ? 0 : h);
                ctx.fillStyle = '#fff';
                ctx.beginPath();
                ctx.arc(x, y, 8, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#4ade80';
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, Math.PI * 2);
                ctx.fill();
            });

            if (mixedNE) {
                const x = margin + mixedNE.q * w;
                const y = margin + (1 - mixedNE.p) * h;
                ctx.fillStyle = '#fff';
                ctx.beginPath();
                ctx.arc(x, y, 8, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#a78bfa';
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, Math.PI * 2);
                ctx.fill();
            }

            // Legend
            ctx.font = '11px sans-serif';
            ctx.fillStyle = '#4ade80';
            ctx.fillText('Row BR', canvas.width - 50, 20);
            ctx.fillStyle = '#22d3ee';
            ctx.fillText('Col BR', canvas.width - 50, 35);
        }

        loadPreset('pd');
    </script>
</body>
</html>
