<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coordination Games | Game Theory</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 10px; color: #4fc3f7; }
        .subtitle { text-align: center; color: #888; margin-bottom: 20px; }

        .game-tabs {
            display: flex; gap: 10px; justify-content: center; margin-bottom: 20px;
        }
        .game-tab {
            padding: 10px 20px; border-radius: 8px;
            background: rgba(79, 195, 247, 0.1);
            border: 1px solid rgba(79, 195, 247, 0.3);
            cursor: pointer; transition: all 0.2s;
        }
        .game-tab.active {
            background: rgba(79, 195, 247, 0.3);
            border-color: #4fc3f7;
        }

        .main-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 800px) { .main-grid { grid-template-columns: 1fr; } }

        .panel {
            background: rgba(255,255,255,0.05);
            border-radius: 15px; padding: 20px;
            border: 1px solid rgba(79, 195, 247, 0.2);
        }
        .panel h2 { color: #4fc3f7; margin-bottom: 15px; }

        .payoff-matrix {
            display: grid; grid-template-columns: auto 1fr 1fr; gap: 3px;
            margin: 15px 0;
        }
        .payoff-cell {
            padding: 15px; text-align: center;
            background: rgba(79, 195, 247, 0.1);
            border-radius: 5px;
        }
        .payoff-cell.header {
            background: rgba(79, 195, 247, 0.25);
            font-weight: bold;
        }
        .payoff-cell.nash { border: 2px solid #4caf50; }

        .choice-buttons {
            display: flex; gap: 15px; justify-content: center; margin: 20px 0;
        }
        .choice-btn {
            padding: 20px 40px; border: none; border-radius: 15px;
            font-size: 1.2em; font-weight: bold;
            cursor: pointer; transition: all 0.3s;
        }
        .choice-a { background: linear-gradient(135deg, #4caf50, #2e7d32); color: white; }
        .choice-b { background: linear-gradient(135deg, #ff9800, #f57c00); color: white; }
        .choice-btn:hover { transform: scale(1.05); }

        .result-display {
            text-align: center; padding: 20px;
            border-radius: 10px; margin: 15px 0;
            font-size: 1.2em;
        }
        .coordinated { background: rgba(76, 175, 80, 0.2); border: 1px solid #4caf50; }
        .miscoordinated { background: rgba(244, 67, 54, 0.2); border: 1px solid #f44336; }

        #spatialCanvas { width: 100%; border-radius: 10px; }
        canvas { width: 100%; border-radius: 10px; background: rgba(0,0,0,0.2); }

        .stat-row {
            display: flex; justify-content: space-between;
            padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .controls {
            display: flex; gap: 10px; flex-wrap: wrap;
            justify-content: center; margin: 15px 0;
        }
        button {
            padding: 10px 20px; border: none; border-radius: 8px;
            background: #4fc3f7; color: #1a1a2e; font-weight: bold;
            cursor: pointer;
        }
        button:hover { background: #81d4fa; }

        label { display: flex; align-items: center; gap: 8px; }
        input[type="range"] { width: 80px; }

        a.back-link {
            display: inline-block; margin-bottom: 20px;
            color: #4fc3f7; text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê Back to Game Theory</a>
        <h1>Coordination Games</h1>
        <p class="subtitle">Can you coordinate without communication?</p>

        <div class="game-tabs">
            <div class="game-tab active" data-game="stag">Stag Hunt</div>
            <div class="game-tab" data-game="battle">Battle of Sexes</div>
            <div class="game-tab" data-game="pure">Pure Coordination</div>
        </div>

        <div class="main-grid">
            <div class="panel">
                <h2 id="gameTitle">Stag Hunt</h2>
                <p id="gameDesc" style="color:#888; margin-bottom:15px;">
                    Hunt stag together (high reward) or hare alone (safe but low)
                </p>

                <div class="payoff-matrix" id="payoffMatrix">
                    <div class="payoff-cell header"></div>
                    <div class="payoff-cell header" id="colA">Stag</div>
                    <div class="payoff-cell header" id="colB">Hare</div>
                    <div class="payoff-cell header" id="rowA">Stag</div>
                    <div class="payoff-cell nash" id="cellAA">4, 4</div>
                    <div class="payoff-cell" id="cellAB">0, 3</div>
                    <div class="payoff-cell header" id="rowB">Hare</div>
                    <div class="payoff-cell" id="cellBA">3, 0</div>
                    <div class="payoff-cell nash" id="cellBB">3, 3</div>
                </div>

                <div class="choice-buttons">
                    <button class="choice-btn choice-a" id="choiceA">ü¶å Stag</button>
                    <button class="choice-btn choice-b" id="choiceB">üê∞ Hare</button>
                </div>

                <div class="result-display" id="result" style="display:none;"></div>

                <h2 style="margin-top:20px;">Spatial Evolution</h2>
                <div class="controls">
                    <button id="startSpatial">Start</button>
                    <button id="resetSpatial">Reset</button>
                    <label>
                        Speed:
                        <input type="range" id="speed" min="1" max="20" value="10">
                    </label>
                </div>
                <canvas id="spatialCanvas" height="250"></canvas>
            </div>

            <div class="panel">
                <h2>Statistics</h2>
                <div class="stat-row">
                    <span>Games Played</span>
                    <span id="gamesPlayed">0</span>
                </div>
                <div class="stat-row">
                    <span>Coordinations</span>
                    <span id="coordinations">0</span>
                </div>
                <div class="stat-row">
                    <span>Your Avg Payoff</span>
                    <span id="avgPayoff">0</span>
                </div>
                <div class="stat-row">
                    <span>Convention A %</span>
                    <span id="conventionA">50%</span>
                </div>

                <h2 style="margin-top:20px;">History</h2>
                <canvas id="historyChart" height="180"></canvas>

                <h2 style="margin-top:20px;" id="theoryTitle">Theory</h2>
                <div id="theoryText" style="font-size:0.85em; color:#aaa; line-height:1.6;">
                    <strong>Stag Hunt (Rousseau):</strong><br>
                    Two equilibria exist:
                    <br>‚Ä¢ (Stag, Stag): Payoff-dominant (better for both)
                    <br>‚Ä¢ (Hare, Hare): Risk-dominant (safer)
                    <br><br>
                    The dilemma: Do you trust your partner to cooperate for the better outcome?
                </div>
            </div>
        </div>
    </div>

    <script>
        const spatialCanvas = document.getElementById('spatialCanvas');
        const spatialCtx = spatialCanvas.getContext('2d');
        const historyCanvas = document.getElementById('historyChart');
        const historyCtx = historyCanvas.getContext('2d');

        const games = {
            stag: {
                title: 'Stag Hunt',
                desc: 'Hunt stag together (high reward) or hare alone (safe but low)',
                labels: { a: 'Stag', b: 'Hare' },
                icons: { a: 'ü¶å', b: 'üê∞' },
                payoffs: { AA: [4, 4], AB: [0, 3], BA: [3, 0], BB: [3, 3] },
                nash: ['AA', 'BB'],
                theory: `<strong>Stag Hunt (Rousseau):</strong><br>
                    Two equilibria exist:
                    <br>‚Ä¢ (Stag, Stag): Payoff-dominant (better for both)
                    <br>‚Ä¢ (Hare, Hare): Risk-dominant (safer)
                    <br><br>
                    The dilemma: Do you trust your partner to cooperate for the better outcome?`
            },
            battle: {
                title: 'Battle of the Sexes',
                desc: 'Both want to coordinate, but prefer different events',
                labels: { a: 'Opera', b: 'Football' },
                icons: { a: 'üé≠', b: '‚öΩ' },
                payoffs: { AA: [3, 2], AB: [0, 0], BA: [0, 0], BB: [2, 3] },
                nash: ['AA', 'BB'],
                theory: `<strong>Battle of the Sexes:</strong><br>
                    Two equilibria: both at Opera (3,2) or both at Football (2,3).
                    <br><br>
                    Conflict: Player 1 prefers Opera, Player 2 prefers Football.
                    But both prefer coordination to miscoordination.
                    <br><br>
                    Often resolved through: communication, alternation, or focal points.`
            },
            pure: {
                title: 'Pure Coordination',
                desc: 'Both just want to match - no preference difference',
                labels: { a: 'Left', b: 'Right' },
                icons: { a: '‚¨ÖÔ∏è', b: '‚û°Ô∏è' },
                payoffs: { AA: [1, 1], AB: [0, 0], BA: [0, 0], BB: [1, 1] },
                nash: ['AA', 'BB'],
                theory: `<strong>Pure Coordination:</strong><br>
                    Both equilibria are equally good - just need to match!
                    <br><br>
                    Examples: Which side of the road to drive on, meeting place, time zones.
                    <br><br>
                    <strong>Focal Points (Schelling):</strong> Cultural conventions help coordinate (e.g., "meet at noon at the obvious place").`
            }
        };

        let currentGame = 'stag';
        let stats = { played: 0, coordinated: 0, totalPayoff: 0, choiceA: 0 };
        let history = [];

        // Spatial simulation
        const SIZE = 50;
        let grid = [];
        let spatialRunning = false;

        function setGame(gameName) {
            currentGame = gameName;
            const game = games[gameName];

            document.querySelectorAll('.game-tab').forEach(el => {
                el.classList.toggle('active', el.dataset.game === gameName);
            });

            document.getElementById('gameTitle').textContent = game.title;
            document.getElementById('gameDesc').textContent = game.desc;

            // Update matrix labels
            document.getElementById('colA').textContent = game.labels.a;
            document.getElementById('colB').textContent = game.labels.b;
            document.getElementById('rowA').textContent = game.labels.a;
            document.getElementById('rowB').textContent = game.labels.b;

            // Update payoffs
            document.getElementById('cellAA').textContent = game.payoffs.AA.join(', ');
            document.getElementById('cellAB').textContent = game.payoffs.AB.join(', ');
            document.getElementById('cellBA').textContent = game.payoffs.BA.join(', ');
            document.getElementById('cellBB').textContent = game.payoffs.BB.join(', ');

            // Nash equilibria highlighting
            document.getElementById('cellAA').classList.toggle('nash', game.nash.includes('AA'));
            document.getElementById('cellBB').classList.toggle('nash', game.nash.includes('BB'));

            // Update buttons
            document.getElementById('choiceA').textContent = game.icons.a + ' ' + game.labels.a;
            document.getElementById('choiceB').textContent = game.icons.b + ' ' + game.labels.b;

            // Update theory
            document.getElementById('theoryText').innerHTML = game.theory;

            document.getElementById('result').style.display = 'none';
            resetSpatial();
        }

        function play(myChoice) {
            const game = games[currentGame];

            // AI opponent - slight bias toward A to create convention
            const conventionBias = stats.played > 0 ? stats.choiceA / stats.played : 0.5;
            const oppChoice = Math.random() < conventionBias + 0.1 ? 'A' : 'B';

            const outcome = myChoice + oppChoice;
            const myPayoff = game.payoffs[outcome][0];
            const oppPayoff = game.payoffs[outcome][1];

            const coordinated = myChoice === oppChoice;

            stats.played++;
            if (coordinated) stats.coordinated++;
            stats.totalPayoff += myPayoff;
            if (myChoice === 'A') stats.choiceA++;

            history.push({ mine: myChoice, theirs: oppChoice, coordinated });
            if (history.length > 50) history.shift();

            // Display result
            const result = document.getElementById('result');
            result.style.display = 'block';
            result.className = 'result-display ' + (coordinated ? 'coordinated' : 'miscoordinated');

            if (coordinated) {
                result.innerHTML = `
                    <strong>‚úì Coordinated!</strong><br>
                    Both chose ${game.labels[myChoice.toLowerCase()]}<br>
                    Payoffs: ${myPayoff}, ${oppPayoff}
                `;
            } else {
                result.innerHTML = `
                    <strong>‚úó Miscoordinated</strong><br>
                    You: ${game.labels[myChoice.toLowerCase()]} | Them: ${game.labels[oppChoice.toLowerCase()]}<br>
                    Payoffs: ${myPayoff}, ${oppPayoff}
                `;
            }

            updateStats();
        }

        function updateStats() {
            document.getElementById('gamesPlayed').textContent = stats.played;
            document.getElementById('coordinations').textContent = stats.coordinated;
            document.getElementById('avgPayoff').textContent =
                stats.played > 0 ? (stats.totalPayoff / stats.played).toFixed(2) : '0';
            document.getElementById('conventionA').textContent =
                stats.played > 0 ? ((stats.choiceA / stats.played) * 100).toFixed(0) + '%' : '50%';

            drawHistory();
        }

        function drawHistory() {
            const dpr = window.devicePixelRatio || 1;
            historyCanvas.width = historyCanvas.offsetWidth * dpr;
            historyCanvas.height = 180 * dpr;
            historyCtx.scale(dpr, dpr);

            const w = historyCanvas.offsetWidth;
            const h = 180;

            historyCtx.fillStyle = 'rgba(0,0,0,0.2)';
            historyCtx.fillRect(0, 0, w, h);

            if (history.length === 0) return;

            const dotSize = Math.min(15, (w - 20) / history.length);

            history.forEach((h, i) => {
                const x = 10 + i * dotSize + dotSize / 2;

                // My choice
                historyCtx.fillStyle = h.mine === 'A' ? '#4caf50' : '#ff9800';
                historyCtx.beginPath();
                historyCtx.arc(x, 50, dotSize/3, 0, Math.PI * 2);
                historyCtx.fill();

                // Their choice
                historyCtx.fillStyle = h.theirs === 'A' ? '#4caf50' : '#ff9800';
                historyCtx.beginPath();
                historyCtx.arc(x, 90, dotSize/3, 0, Math.PI * 2);
                historyCtx.fill();

                // Coordination indicator
                historyCtx.fillStyle = h.coordinated ? '#4caf50' : '#f44336';
                historyCtx.fillRect(x - dotSize/4, 120, dotSize/2, 20);
            });

            historyCtx.fillStyle = '#888';
            historyCtx.font = '10px sans-serif';
            historyCtx.fillText('You', w - 25, 55);
            historyCtx.fillText('Them', w - 30, 95);
            historyCtx.fillText('Match', w - 35, 135);
        }

        // Spatial simulation
        function resetSpatial() {
            grid = [];
            for (let i = 0; i < SIZE; i++) {
                grid[i] = [];
                for (let j = 0; j < SIZE; j++) {
                    grid[i][j] = Math.random() < 0.5 ? 'A' : 'B';
                }
            }
            drawSpatial();
        }

        function stepSpatial() {
            const game = games[currentGame];
            const newGrid = [];

            for (let i = 0; i < SIZE; i++) {
                newGrid[i] = [];
                for (let j = 0; j < SIZE; j++) {
                    // Calculate payoff for each strategy
                    let payoffA = 0, payoffB = 0;

                    for (let di = -1; di <= 1; di++) {
                        for (let dj = -1; dj <= 1; dj++) {
                            if (di === 0 && dj === 0) continue;
                            const ni = (i + di + SIZE) % SIZE;
                            const nj = (j + dj + SIZE) % SIZE;
                            const neighbor = grid[ni][nj];

                            payoffA += game.payoffs['A' + neighbor][0];
                            payoffB += game.payoffs['B' + neighbor][0];
                        }
                    }

                    // Choose best response
                    if (payoffA > payoffB) {
                        newGrid[i][j] = 'A';
                    } else if (payoffB > payoffA) {
                        newGrid[i][j] = 'B';
                    } else {
                        newGrid[i][j] = grid[i][j]; // Keep current
                    }
                }
            }

            grid = newGrid;
            drawSpatial();
            updateSpatialStats();
        }

        function drawSpatial() {
            const dpr = window.devicePixelRatio || 1;
            spatialCanvas.width = spatialCanvas.offsetWidth * dpr;
            spatialCanvas.height = 250 * dpr;
            spatialCtx.scale(dpr, dpr);

            const w = spatialCanvas.offsetWidth;
            const h = 250;
            const cellW = w / SIZE;
            const cellH = h / SIZE;

            for (let i = 0; i < SIZE; i++) {
                for (let j = 0; j < SIZE; j++) {
                    spatialCtx.fillStyle = grid[i][j] === 'A' ? '#4caf50' : '#ff9800';
                    spatialCtx.fillRect(i * cellW, j * cellH, cellW + 1, cellH + 1);
                }
            }
        }

        function updateSpatialStats() {
            let countA = 0;
            for (let i = 0; i < SIZE; i++) {
                for (let j = 0; j < SIZE; j++) {
                    if (grid[i][j] === 'A') countA++;
                }
            }
            document.getElementById('conventionA').textContent =
                ((countA / (SIZE * SIZE)) * 100).toFixed(0) + '%';
        }

        let spatialAnimationId = null;
        function animateSpatial() {
            if (!spatialRunning) return;
            stepSpatial();
            const speed = parseInt(document.getElementById('speed').value);
            spatialAnimationId = setTimeout(animateSpatial, 1000 / speed);
        }

        // Event listeners
        document.querySelectorAll('.game-tab').forEach(el => {
            el.onclick = () => setGame(el.dataset.game);
        });

        document.getElementById('choiceA').onclick = () => play('A');
        document.getElementById('choiceB').onclick = () => play('B');

        document.getElementById('startSpatial').onclick = () => {
            spatialRunning = !spatialRunning;
            document.getElementById('startSpatial').textContent = spatialRunning ? 'Pause' : 'Start';
            if (spatialRunning) animateSpatial();
        };

        document.getElementById('resetSpatial').onclick = () => {
            spatialRunning = false;
            document.getElementById('startSpatial').textContent = 'Start';
            resetSpatial();
        };

        // Initialize
        setGame('stag');
    </script>
</body>
</html>
