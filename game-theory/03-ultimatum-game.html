<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimatum Game - Game Theory</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #eee;
            min-height: 100vh;
            padding: 20px;
        }
        .back-link {
            position: fixed; top: 20px; left: 20px; color: #4ade80; text-decoration: none;
            font-weight: 600; padding: 8px 16px; background: rgba(0,0,0,0.3); border-radius: 20px;
            z-index: 100;
        }
        .back-link:hover { background: rgba(74, 222, 128, 0.2); }
        h1 { text-align: center; margin: 40px 0 10px; font-size: 2.2em; color: #4ade80; }
        .subtitle { text-align: center; opacity: 0.8; margin-bottom: 20px; }
        .container { max-width: 1100px; margin: 0 auto; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .panel { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 25px; }
        .info-box { background: rgba(74, 222, 128, 0.1); border: 1px solid rgba(74, 222, 128, 0.3); border-radius: 8px; padding: 15px; margin-bottom: 20px; font-size: 0.9em; line-height: 1.6; }
        h3 { color: #4ade80; margin-bottom: 15px; }
        .game-display { text-align: center; padding: 30px; background: rgba(0,0,0,0.3); border-radius: 12px; margin-bottom: 20px; }
        .pot-display { font-size: 3em; color: #facc15; margin-bottom: 20px; }
        .offer-display { font-size: 1.5em; margin: 20px 0; }
        .player-section { display: flex; justify-content: space-around; margin: 20px 0; }
        .player { text-align: center; padding: 20px; background: rgba(255,255,255,0.05); border-radius: 12px; min-width: 150px; }
        .player-name { font-weight: 700; color: #22d3ee; margin-bottom: 10px; }
        .player-amount { font-size: 2em; color: #4ade80; }
        .slider-container { margin: 20px 0; }
        .slider-container input { width: 100%; }
        .slider-labels { display: flex; justify-content: space-between; font-size: 0.85em; opacity: 0.7; }
        button { padding: 12px 24px; border: none; border-radius: 8px; font-size: 1em; font-weight: 600; cursor: pointer; margin: 5px; }
        .btn-accept { background: #4ade80; color: #1a1a2e; }
        .btn-reject { background: #f87171; color: #fff; }
        .btn-primary { background: #4ade80; color: #1a1a2e; width: 100%; }
        .btn-secondary { background: rgba(255,255,255,0.1); color: #fff; }
        .result-message { padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center; font-weight: 600; }
        .result-accept { background: rgba(74, 222, 128, 0.2); color: #4ade80; }
        .result-reject { background: rgba(248, 113, 113, 0.2); color: #f87171; }
        canvas { width: 100%; height: 300px; border-radius: 8px; background: #0a0a15; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; }
        .stat-box { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; text-align: center; }
        .stat-value { font-size: 1.8em; color: #4ade80; }
        .stat-label { font-size: 0.85em; opacity: 0.7; }
        .threshold-indicator { height: 6px; background: linear-gradient(to right, #f87171 0%, #f87171 30%, #4ade80 30%, #4ade80 100%); border-radius: 3px; margin: 10px 0; }
        @media (max-width: 800px) { .container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back</a>
    <h1>Ultimatum Game</h1>
    <p class="subtitle">Fairness norms in division games</p>

    <div class="container">
        <div class="panel">
            <div class="info-box">
                <strong>The Ultimatum Game:</strong> Player 1 (Proposer) offers to split $100. Player 2 (Responder) can Accept or Reject.
                If rejected, both get nothing. Game theory predicts any offer > $0 should be accepted, but humans typically reject "unfair" offers below 20-30%.
            </div>

            <div class="game-display">
                <div class="pot-display">$100</div>

                <div class="player-section">
                    <div class="player">
                        <div class="player-name">Proposer</div>
                        <div class="player-amount" id="proposerAmount">$50</div>
                    </div>
                    <div class="player">
                        <div class="player-name">Responder</div>
                        <div class="player-amount" id="responderAmount">$50</div>
                    </div>
                </div>

                <div class="slider-container">
                    <label>Your Offer to Responder: <strong id="offerDisplay">$50</strong></label>
                    <input type="range" id="offerSlider" min="0" max="100" value="50" oninput="updateOffer()">
                    <div class="slider-labels">
                        <span>$0 (keep all)</span>
                        <span>$100 (give all)</span>
                    </div>
                </div>

                <div id="gameButtons">
                    <button class="btn-primary" onclick="makeOffer()">Make Offer</button>
                </div>

                <div id="responseButtons" style="display: none;">
                    <p style="margin-bottom: 15px;">AI Responder is deciding...</p>
                    <button class="btn-accept" onclick="respond(true)">Accept</button>
                    <button class="btn-reject" onclick="respond(false)">Reject</button>
                </div>

                <div id="resultMessage" class="result-message" style="display: none;"></div>
            </div>

            <button class="btn-secondary" onclick="resetGame()" style="width: 100%;">Play Again</button>
        </div>

        <div class="panel">
            <h3>Responder Threshold</h3>
            <p style="font-size: 0.9em; opacity: 0.8; margin-bottom: 15px;">
                Set the AI responder's minimum acceptable offer. This simulates different fairness preferences.
            </p>

            <div class="slider-container">
                <label>Minimum Acceptable: <strong id="thresholdDisplay">$20</strong></label>
                <input type="range" id="thresholdSlider" min="0" max="50" value="20" oninput="updateThreshold()">
                <div class="threshold-indicator" id="thresholdBar"></div>
            </div>

            <h3 style="margin-top: 25px;">Historical Results</h3>
            <canvas id="canvas"></canvas>

            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-value" id="totalGames">0</div>
                    <div class="stat-label">Total Games</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="acceptRate">0%</div>
                    <div class="stat-label">Accept Rate</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="avgOffer">$0</div>
                    <div class="stat-label">Avg Offer</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="avgEarnings">$0</div>
                    <div class="stat-label">Avg Earnings</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 400;
        canvas.height = 300;

        let gameHistory = [];
        let threshold = 20;

        function updateOffer() {
            const offer = parseInt(document.getElementById('offerSlider').value);
            document.getElementById('offerDisplay').textContent = '$' + offer;
            document.getElementById('responderAmount').textContent = '$' + offer;
            document.getElementById('proposerAmount').textContent = '$' + (100 - offer);
        }

        function updateThreshold() {
            threshold = parseInt(document.getElementById('thresholdSlider').value);
            document.getElementById('thresholdDisplay').textContent = '$' + threshold;
            const bar = document.getElementById('thresholdBar');
            bar.style.background = `linear-gradient(to right, #f87171 0%, #f87171 ${threshold}%, #4ade80 ${threshold}%, #4ade80 100%)`;
        }

        function makeOffer() {
            const offer = parseInt(document.getElementById('offerSlider').value);

            document.getElementById('gameButtons').style.display = 'none';
            document.getElementById('responseButtons').style.display = 'block';
            document.getElementById('offerSlider').disabled = true;

            // Simulate AI decision after delay
            setTimeout(() => {
                const accept = offer >= threshold;
                showResult(offer, accept);
            }, 1500);
        }

        function respond(accept) {
            const offer = parseInt(document.getElementById('offerSlider').value);
            showResult(offer, accept);
        }

        function showResult(offer, accept) {
            document.getElementById('responseButtons').style.display = 'none';

            const resultDiv = document.getElementById('resultMessage');
            resultDiv.style.display = 'block';

            if (accept) {
                resultDiv.className = 'result-message result-accept';
                resultDiv.innerHTML = `ACCEPTED! Proposer: $${100 - offer}, Responder: $${offer}`;
                gameHistory.push({ offer, accepted: true, proposerEarning: 100 - offer, responderEarning: offer });
            } else {
                resultDiv.className = 'result-message result-reject';
                resultDiv.innerHTML = `REJECTED! Both players get $0`;
                gameHistory.push({ offer, accepted: false, proposerEarning: 0, responderEarning: 0 });
            }

            updateStats();
            drawChart();
        }

        function resetGame() {
            document.getElementById('gameButtons').style.display = 'block';
            document.getElementById('responseButtons').style.display = 'none';
            document.getElementById('resultMessage').style.display = 'none';
            document.getElementById('offerSlider').disabled = false;
            document.getElementById('offerSlider').value = 50;
            updateOffer();
        }

        function updateStats() {
            const total = gameHistory.length;
            const accepted = gameHistory.filter(g => g.accepted).length;
            const avgOffer = total > 0 ? gameHistory.reduce((s, g) => s + g.offer, 0) / total : 0;
            const avgEarnings = total > 0 ? gameHistory.reduce((s, g) => s + g.proposerEarning, 0) / total : 0;

            document.getElementById('totalGames').textContent = total;
            document.getElementById('acceptRate').textContent = total > 0 ? Math.round(accepted / total * 100) + '%' : '0%';
            document.getElementById('avgOffer').textContent = '$' + avgOffer.toFixed(0);
            document.getElementById('avgEarnings').textContent = '$' + avgEarnings.toFixed(0);
        }

        function drawChart() {
            ctx.fillStyle = '#0a0a15';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            if (gameHistory.length === 0) {
                ctx.fillStyle = 'rgba(255,255,255,0.3)';
                ctx.font = '14px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('Play games to see history', canvas.width / 2, canvas.height / 2);
                return;
            }

            // Draw offer distribution histogram
            const bins = new Array(11).fill(0);
            const acceptBins = new Array(11).fill(0);

            gameHistory.forEach(g => {
                const bin = Math.min(Math.floor(g.offer / 10), 10);
                bins[bin]++;
                if (g.accepted) acceptBins[bin]++;
            });

            const maxBin = Math.max(...bins, 1);
            const barWidth = (canvas.width - 60) / 11;
            const maxHeight = canvas.height - 60;

            // Draw bars
            for (let i = 0; i < 11; i++) {
                const x = 40 + i * barWidth;
                const totalHeight = (bins[i] / maxBin) * maxHeight;
                const acceptHeight = (acceptBins[i] / maxBin) * maxHeight;

                // Rejected portion
                ctx.fillStyle = '#f87171';
                ctx.fillRect(x + 2, canvas.height - 40 - totalHeight, barWidth - 4, totalHeight - acceptHeight);

                // Accepted portion
                ctx.fillStyle = '#4ade80';
                ctx.fillRect(x + 2, canvas.height - 40 - acceptHeight, barWidth - 4, acceptHeight);

                // Label
                ctx.fillStyle = '#fff';
                ctx.font = '10px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(`$${i * 10}`, x + barWidth / 2, canvas.height - 25);
            }

            // Y-axis
            ctx.strokeStyle = 'rgba(255,255,255,0.3)';
            ctx.beginPath();
            ctx.moveTo(40, 20);
            ctx.lineTo(40, canvas.height - 40);
            ctx.stroke();

            // Title
            ctx.fillStyle = '#4ade80';
            ctx.font = 'bold 14px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Offer Distribution (Green = Accepted)', canvas.width / 2, 15);
        }

        updateThreshold();
        drawChart();
    </script>
</body>
</html>
