<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tragedy of the Commons - Game Theory</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #eee;
            min-height: 100vh;
            padding: 20px;
        }
        .back-link {
            position: fixed; top: 20px; left: 20px; color: #4ade80; text-decoration: none;
            font-weight: 600; padding: 8px 16px; background: rgba(0,0,0,0.3); border-radius: 20px;
            z-index: 100;
        }
        h1 { text-align: center; margin: 40px 0 10px; font-size: 2.2em; color: #4ade80; }
        .subtitle { text-align: center; opacity: 0.8; margin-bottom: 20px; }
        .container { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 2fr 1fr; gap: 20px; }
        .panel { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 25px; }
        .info-box { background: rgba(74, 222, 128, 0.1); border: 1px solid rgba(74, 222, 128, 0.3); border-radius: 8px; padding: 15px; margin-bottom: 20px; font-size: 0.85em; line-height: 1.6; }
        h3 { color: #4ade80; margin-bottom: 15px; }
        .commons-display { position: relative; width: 100%; height: 400px; background: linear-gradient(to bottom, #87CEEB 0%, #87CEEB 20%, #228B22 20%, #228B22 100%); border-radius: 12px; overflow: hidden; }
        .grass-level { position: absolute; bottom: 0; left: 0; right: 0; background: #228B22; transition: height 0.3s; }
        .cow { position: absolute; font-size: 30px; transition: all 0.5s; }
        .resource-bar { position: absolute; top: 10px; left: 10px; right: 10px; height: 30px; background: rgba(0,0,0,0.3); border-radius: 15px; overflow: hidden; }
        .resource-fill { height: 100%; background: linear-gradient(90deg, #22c55e, #4ade80); transition: width 0.3s; display: flex; align-items: center; justify-content: center; font-weight: 600; color: #1a1a2e; }
        .year-display { position: absolute; bottom: 10px; right: 10px; background: rgba(0,0,0,0.5); padding: 8px 15px; border-radius: 8px; font-size: 1.2em; }
        .farmers-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; margin: 15px 0; }
        .farmer-card { background: rgba(255,255,255,0.05); border-radius: 8px; padding: 10px; text-align: center; }
        .farmer-cows { font-size: 1.5em; color: #facc15; }
        .farmer-profit { font-size: 0.85em; color: #4ade80; }
        canvas { width: 100%; height: 200px; border-radius: 8px; background: #0a0a15; margin: 15px 0; }
        button { width: 100%; padding: 12px; margin: 8px 0; border: none; border-radius: 8px; font-size: 1em; font-weight: 600; cursor: pointer; }
        .btn-primary { background: #4ade80; color: #1a1a2e; }
        .btn-secondary { background: rgba(255,255,255,0.1); color: #fff; }
        .control-group { margin: 15px 0; }
        .control-group label { display: block; margin-bottom: 5px; }
        .control-group input { width: 100%; }
        .value-display { color: #4ade80; font-family: monospace; }
        .regulation-box { background: rgba(250, 204, 21, 0.1); border: 1px solid rgba(250, 204, 21, 0.3); border-radius: 8px; padding: 12px; margin-top: 15px; }
        .collapse-warning { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(248, 113, 113, 0.9); padding: 20px 30px; border-radius: 12px; font-size: 1.5em; font-weight: 700; display: none; }
        @media (max-width: 900px) { .container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back</a>
    <h1>Tragedy of the Commons</h1>
    <p class="subtitle">Common-pool resource depletion</p>

    <div class="container">
        <div class="panel">
            <div class="info-box">
                <strong>Tragedy of the Commons (Garrett Hardin, 1968):</strong>
                When a resource is shared, individual incentives lead to overuse.
                Each farmer benefits from adding more cattle, but the commons suffers.
                Without regulation or cooperation, the resource is depleted.
            </div>

            <div class="commons-display" id="commons">
                <div class="resource-bar">
                    <div class="resource-fill" id="resourceFill" style="width: 100%;">100%</div>
                </div>
                <div class="collapse-warning" id="collapseWarning">COMMONS COLLAPSED!</div>
                <div class="year-display">Year: <span id="year">0</span></div>
            </div>

            <h3 style="margin-top: 20px;">Farmers</h3>
            <div class="farmers-grid" id="farmersGrid"></div>

            <canvas id="canvas"></canvas>
        </div>

        <div class="panel">
            <h3>Simulation Controls</h3>

            <div class="control-group">
                <label>Number of Farmers: <span class="value-display" id="numFarmers">5</span></label>
                <input type="range" id="farmersSlider" min="2" max="10" value="5" oninput="updateSettings()">
            </div>

            <div class="control-group">
                <label>Carrying Capacity: <span class="value-display" id="capacity">50</span> cows</label>
                <input type="range" id="capacitySlider" min="20" max="100" value="50" oninput="updateSettings()">
            </div>

            <div class="control-group">
                <label>Regeneration Rate: <span class="value-display" id="regenRate">10%</span></label>
                <input type="range" id="regenSlider" min="1" max="30" value="10" oninput="updateSettings()">
            </div>

            <div class="control-group">
                <label>Farmer Greed: <span class="value-display" id="greedLevel">Medium</span></label>
                <input type="range" id="greedSlider" min="1" max="3" value="2" oninput="updateSettings()">
            </div>

            <button class="btn-primary" onclick="runSimulation()">Run Simulation</button>
            <button class="btn-secondary" onclick="stepYear()">Step One Year</button>
            <button class="btn-secondary" onclick="resetSimulation()">Reset</button>

            <div class="regulation-box">
                <label><input type="checkbox" id="quotaCheck" onchange="toggleQuota()"> Enable Quotas</label>
                <div style="margin-top: 10px; display: none;" id="quotaSettings">
                    <label>Max cows per farmer: <span class="value-display" id="quotaVal">5</span></label>
                    <input type="range" id="quotaSlider" min="1" max="15" value="5" oninput="document.getElementById('quotaVal').textContent = this.value">
                </div>
            </div>

            <h3 style="margin-top: 20px;">Statistics</h3>
            <div style="font-size: 0.9em;">
                <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                    <span>Total Cows:</span>
                    <span class="value-display" id="totalCows">0</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                    <span>Resource Level:</span>
                    <span class="value-display" id="resourceLevel">100%</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                    <span>Total Profit:</span>
                    <span class="value-display" id="totalProfit">$0</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                    <span>Sustainability:</span>
                    <span class="value-display" id="sustainability">Stable</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 600;
        canvas.height = 200;

        let farmers = [];
        let resource = 100;
        let year = 0;
        let history = [];
        let running = false;
        let collapsed = false;
        let capacity = 50;
        let regenRate = 0.1;
        let greed = 2;

        function updateSettings() {
            document.getElementById('numFarmers').textContent = document.getElementById('farmersSlider').value;
            capacity = parseInt(document.getElementById('capacitySlider').value);
            document.getElementById('capacity').textContent = capacity;
            regenRate = parseInt(document.getElementById('regenSlider').value) / 100;
            document.getElementById('regenRate').textContent = Math.round(regenRate * 100) + '%';
            greed = parseInt(document.getElementById('greedSlider').value);
            const greedLabels = ['Low', 'Medium', 'High'];
            document.getElementById('greedLevel').textContent = greedLabels[greed - 1];
            resetSimulation();
        }

        function toggleQuota() {
            document.getElementById('quotaSettings').style.display =
                document.getElementById('quotaCheck').checked ? 'block' : 'none';
        }

        function initFarmers() {
            const n = parseInt(document.getElementById('farmersSlider').value);
            farmers = [];
            for (let i = 0; i < n; i++) {
                farmers.push({
                    id: i + 1,
                    cows: 2,
                    profit: 0,
                    totalProfit: 0
                });
            }
        }

        function stepYear() {
            if (collapsed) return;

            year++;
            const quota = document.getElementById('quotaCheck').checked ?
                parseInt(document.getElementById('quotaSlider').value) : Infinity;

            // Each farmer decides whether to add a cow
            const totalCows = farmers.reduce((s, f) => s + f.cows, 0);
            const crowding = totalCows / capacity;

            farmers.forEach(f => {
                // Profit per cow decreases with crowding
                const profitPerCow = Math.max(0, 10 * (1 - crowding * 0.8));
                f.profit = f.cows * profitPerCow * (resource / 100);
                f.totalProfit += f.profit;

                // Decision to add cow based on greed and expected profit
                if (f.cows < quota && profitPerCow > 2 * greed && Math.random() < 0.3 * greed) {
                    f.cows++;
                }
            });

            // Resource consumption
            const newTotalCows = farmers.reduce((s, f) => s + f.cows, 0);
            const consumption = newTotalCows * 2;
            const regeneration = resource * regenRate * (1 - resource / 100);

            resource = Math.max(0, Math.min(100, resource - consumption + regeneration));

            // Cows die if resource too low
            if (resource < 20) {
                farmers.forEach(f => {
                    const deaths = Math.floor(f.cows * (1 - resource / 20) * 0.3);
                    f.cows = Math.max(1, f.cows - deaths);
                });
            }

            // Collapse check
            if (resource < 5) {
                collapsed = true;
                document.getElementById('collapseWarning').style.display = 'block';
            }

            history.push({
                year,
                resource,
                totalCows: farmers.reduce((s, f) => s + f.cows, 0),
                avgProfit: farmers.reduce((s, f) => s + f.profit, 0) / farmers.length
            });

            updateDisplay();
        }

        function updateDisplay() {
            document.getElementById('year').textContent = year;
            document.getElementById('resourceFill').style.width = resource + '%';
            document.getElementById('resourceFill').textContent = Math.round(resource) + '%';

            // Update cows on commons
            const commons = document.getElementById('commons');
            commons.querySelectorAll('.cow').forEach(c => c.remove());

            const totalCows = farmers.reduce((s, f) => s + f.cows, 0);
            const cowsToShow = Math.min(totalCows, 30);

            for (let i = 0; i < cowsToShow; i++) {
                const cow = document.createElement('div');
                cow.className = 'cow';
                cow.textContent = 'üêÑ';
                cow.style.left = (10 + Math.random() * 80) + '%';
                cow.style.top = (30 + Math.random() * 50) + '%';
                commons.appendChild(cow);
            }

            // Update farmer cards
            const grid = document.getElementById('farmersGrid');
            grid.innerHTML = farmers.map(f => `
                <div class="farmer-card">
                    <div>Farmer ${f.id}</div>
                    <div class="farmer-cows">${f.cows} üêÑ</div>
                    <div class="farmer-profit">$${Math.round(f.profit)}/yr</div>
                </div>
            `).join('');

            // Update stats
            document.getElementById('totalCows').textContent = totalCows;
            document.getElementById('resourceLevel').textContent = Math.round(resource) + '%';
            document.getElementById('totalProfit').textContent = '$' + Math.round(farmers.reduce((s, f) => s + f.totalProfit, 0));

            const sustainable = totalCows <= capacity * 0.6 && resource > 50;
            document.getElementById('sustainability').textContent = collapsed ? 'COLLAPSED' :
                sustainable ? 'Sustainable' : resource > 30 ? 'Stressed' : 'Critical';
            document.getElementById('sustainability').style.color = collapsed ? '#f87171' :
                sustainable ? '#4ade80' : resource > 30 ? '#facc15' : '#f87171';

            drawChart();
        }

        function drawChart() {
            ctx.fillStyle = '#0a0a15';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            if (history.length < 2) return;

            const margin = { top: 20, right: 20, bottom: 30, left: 40 };
            const w = canvas.width - margin.left - margin.right;
            const h = canvas.height - margin.top - margin.bottom;

            // Draw axes
            ctx.strokeStyle = 'rgba(255,255,255,0.3)';
            ctx.beginPath();
            ctx.moveTo(margin.left, margin.top);
            ctx.lineTo(margin.left, margin.top + h);
            ctx.lineTo(margin.left + w, margin.top + h);
            ctx.stroke();

            // Draw resource line
            ctx.strokeStyle = '#4ade80';
            ctx.lineWidth = 2;
            ctx.beginPath();
            history.forEach((d, i) => {
                const x = margin.left + (i / (history.length - 1)) * w;
                const y = margin.top + h * (1 - d.resource / 100);
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            ctx.stroke();

            // Draw cows line
            const maxCows = Math.max(...history.map(d => d.totalCows), capacity);
            ctx.strokeStyle = '#facc15';
            ctx.beginPath();
            history.forEach((d, i) => {
                const x = margin.left + (i / (history.length - 1)) * w;
                const y = margin.top + h * (1 - d.totalCows / maxCows);
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            ctx.stroke();

            // Capacity line
            ctx.strokeStyle = 'rgba(248, 113, 113, 0.5)';
            ctx.setLineDash([5, 5]);
            const capY = margin.top + h * (1 - capacity / maxCows);
            ctx.beginPath();
            ctx.moveTo(margin.left, capY);
            ctx.lineTo(margin.left + w, capY);
            ctx.stroke();
            ctx.setLineDash([]);

            // Legend
            ctx.font = '11px sans-serif';
            ctx.fillStyle = '#4ade80';
            ctx.fillText('Resource %', 50, 15);
            ctx.fillStyle = '#facc15';
            ctx.fillText('Total Cows', 130, 15);
            ctx.fillStyle = '#f87171';
            ctx.fillText('Capacity', 210, 15);
        }

        async function runSimulation() {
            if (running) {
                running = false;
                return;
            }
            running = true;

            while (!collapsed && year < 100 && running) {
                stepYear();
                await new Promise(r => setTimeout(r, 200));
            }

            running = false;
        }

        function resetSimulation() {
            running = false;
            collapsed = false;
            resource = 100;
            year = 0;
            history = [];
            document.getElementById('collapseWarning').style.display = 'none';
            initFarmers();
            updateDisplay();
        }

        updateSettings();
    </script>
</body>
</html>
