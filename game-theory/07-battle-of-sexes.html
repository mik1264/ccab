<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battle of the Sexes - Game Theory</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0e1a;
            color: #e0e0e0;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .back-link {
            display: inline-block;
            color: #64b5f6;
            text-decoration: none;
            margin-bottom: 20px;
            font-size: 16px;
            transition: color 0.3s;
        }

        .back-link:hover {
            color: #90caf9;
        }

        h1 {
            color: #fff;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .description {
            color: #b0b0b0;
            margin-bottom: 30px;
            line-height: 1.6;
            max-width: 800px;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
            margin-bottom: 20px;
        }

        .canvas-container {
            background: #151b2b;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #2a3f5f;
        }

        canvas {
            display: block;
            width: 100%;
            background: #0a0e1a;
            border-radius: 5px;
        }

        .controls-panel {
            background: #151b2b;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #2a3f5f;
        }

        .payoff-matrix {
            background: #0f1520;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .payoff-matrix h3 {
            color: #64b5f6;
            margin-bottom: 10px;
            font-size: 14px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 10px;
            text-align: center;
            border: 1px solid #2a3f5f;
        }

        th {
            background: #1a2332;
            color: #90caf9;
            font-weight: 600;
        }

        td {
            background: #151b2b;
            color: #e0e0e0;
        }

        .nash-equilibrium {
            background: #1565c0 !important;
        }

        .choice-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .choice-btn {
            flex: 1;
            padding: 20px;
            background: #1a2332;
            border: 2px solid #2a3f5f;
            border-radius: 8px;
            color: #e0e0e0;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            text-align: center;
        }

        .choice-btn:hover {
            border-color: #64b5f6;
            background: #1e2939;
        }

        .choice-btn.opera {
            border-color: #9c27b0;
        }

        .choice-btn.opera:hover {
            background: #7b1fa2;
        }

        .choice-btn.football {
            border-color: #ff5722;
        }

        .choice-btn.football:hover {
            background: #e64a19;
        }

        .choice-btn .icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        button {
            width: 100%;
            padding: 12px;
            background: #1976d2;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background 0.3s;
            margin-bottom: 10px;
        }

        button:hover {
            background: #1565c0;
        }

        .result-display {
            background: #0f1520;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }

        .result-display h3 {
            color: #64b5f6;
            margin-bottom: 10px;
        }

        .result-outcome {
            font-size: 1.3em;
            font-weight: bold;
            margin: 10px 0;
        }

        .result-outcome.coordinated {
            color: #4caf50;
        }

        .result-outcome.failed {
            color: #e57373;
        }

        .stats-box {
            background: #0f1520;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .stats-box h3 {
            color: #64b5f6;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #2a3f5f;
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #b0b0b0;
        }

        .stat-value {
            color: #81c784;
            font-weight: 600;
        }

        .info-box {
            background: #1a2332;
            border-left: 4px solid #64b5f6;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
        }

        .info-box h3 {
            color: #64b5f6;
            margin-bottom: 10px;
        }

        .info-box p {
            line-height: 1.6;
            color: #b0b0b0;
            margin-bottom: 8px;
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê Back to Game Theory</a>

        <h1>Battle of the Sexes</h1>
        <p class="description">
            A coordination game where both players want to coordinate, but prefer different outcomes.
            Two Nash equilibria exist, but which one will emerge? Communication and conventions matter.
        </p>

        <div class="main-grid">
            <div class="canvas-container">
                <canvas id="canvas"></canvas>
            </div>

            <div class="controls-panel">
                <div class="payoff-matrix">
                    <h3>Payoff Matrix (Player 1, Player 2)</h3>
                    <table>
                        <tr>
                            <th></th>
                            <th>üé≠ Opera</th>
                            <th>üèà Football</th>
                        </tr>
                        <tr>
                            <th>üé≠ Opera</th>
                            <td class="nash-equilibrium">3, 2</td>
                            <td>0, 0</td>
                        </tr>
                        <tr>
                            <th>üèà Football</th>
                            <td>0, 0</td>
                            <td class="nash-equilibrium">2, 3</td>
                        </tr>
                    </table>
                    <p style="margin-top: 10px; font-size: 12px; color: #b0b0b0;">
                        Mixed Strategy: 60% Opera, 40% Football
                    </p>
                </div>

                <div class="choice-buttons">
                    <button class="choice-btn opera" onclick="makeChoice('opera')">
                        <div class="icon">üé≠</div>
                        <div><strong>Opera</strong></div>
                        <div style="font-size: 0.9em; margin-top: 5px;">You prefer this</div>
                    </button>
                    <button class="choice-btn football" onclick="makeChoice('football')">
                        <div class="icon">üèà</div>
                        <div><strong>Football</strong></div>
                        <div style="font-size: 0.9em; margin-top: 5px;">Partner prefers</div>
                    </button>
                </div>

                <div id="resultDisplay"></div>

                <button onclick="runSimulation()">Run Simulation (100 rounds)</button>
                <button onclick="reset()">Reset</button>

                <div class="stats-box">
                    <h3>Game Statistics</h3>
                    <div class="stat-row">
                        <span class="stat-label">Rounds Played</span>
                        <span class="stat-value" id="roundsPlayed">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Both Opera</span>
                        <span class="stat-value" id="bothOpera">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Both Football</span>
                        <span class="stat-value" id="bothFootball">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Miscoordination</span>
                        <span class="stat-value" id="miscoord">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Coordination Rate</span>
                        <span class="stat-value" id="coordRate">0%</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="info-box">
            <h3>About the Battle of the Sexes</h3>
            <p><strong>The Scenario:</strong> A couple wants to spend the evening together. One prefers the opera (and gets payoff 3), the other prefers football (and gets payoff 3). Being together at either event is better than being apart.</p>
            <p><strong>The Dilemma:</strong> Both want to coordinate, but on different outcomes. Going to different events gives both players 0.</p>
            <p><strong>Nash Equilibria:</strong></p>
            <p>‚Ä¢ (Opera, Opera): Player 1 gets 3, Player 2 gets 2 - Both coordinate, but Player 1 is happier</p>
            <p>‚Ä¢ (Football, Football): Player 1 gets 2, Player 2 gets 3 - Both coordinate, but Player 2 is happier</p>
            <p>‚Ä¢ Mixed Strategy: Player 1 plays Opera 60%, Player 2 plays Football 60%</p>
            <p><strong>The Challenge:</strong> Which equilibrium should we select? This requires communication, social norms, or conventions. Real-world analogies include:</p>
            <p>‚Ä¢ Technology standards (VHS vs Beta, Blu-ray vs HD-DVD)</p>
            <p>‚Ä¢ Driving on left vs right side of road</p>
            <p>‚Ä¢ Language choice in bilingual relationships</p>
            <p>‚Ä¢ Meeting point selection when communication fails</p>
            <p><strong>Solution Concepts:</strong> Focal points, pre-play communication, alternating, fairness norms, or power dynamics can resolve which equilibrium is selected.</p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth - 40;
            canvas.height = 500;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Game state
        let history = [];
        let stats = {
            rounds: 0,
            bothOpera: 0,
            bothFootball: 0,
            miscoord: 0
        };

        // Payoff matrix
        const payoffs = {
            'opera-opera': [3, 2],
            'opera-football': [0, 0],
            'football-opera': [0, 0],
            'football-football': [2, 3]
        };

        // AI uses adaptive best response
        let aiOperaProb = 0.6; // Starts with mixed strategy

        function makeChoice(choice) {
            // AI responds based on learned pattern
            const aiChoice = Math.random() < aiOperaProb ? 'opera' : 'football';

            const key = `${choice}-${aiChoice}`;
            const [p1Payoff, p2Payoff] = payoffs[key];

            stats.rounds++;

            if (choice === 'opera' && aiChoice === 'opera') {
                stats.bothOpera++;
                // If coordinating on opera, AI more likely to do it again
                aiOperaProb = Math.min(0.9, aiOperaProb + 0.05);
            } else if (choice === 'football' && aiChoice === 'football') {
                stats.bothFootball++;
                // If coordinating on football, AI less likely to play opera
                aiOperaProb = Math.max(0.1, aiOperaProb - 0.05);
            } else {
                stats.miscoord++;
                // Miscoordination - adjust toward mixed strategy
                aiOperaProb = 0.6;
            }

            history.push({
                player: choice,
                ai: aiChoice,
                p1Payoff,
                p2Payoff,
                coordinated: choice === aiChoice
            });

            if (history.length > 50) history.shift();

            showResult(choice, aiChoice, p1Payoff, p2Payoff);
            updateStats();
            draw();
        }

        function showResult(player, ai, p1, p2) {
            const resultDiv = document.getElementById('resultDisplay');
            const coordinated = player === ai;

            resultDiv.innerHTML = `
                <div class="result-display">
                    <h3>Round Result</h3>
                    <div style="display: flex; justify-content: space-around; margin: 15px 0;">
                        <div>
                            <div>${player === 'opera' ? 'üé≠ Opera' : 'üèà Football'}</div>
                            <div style="font-size: 1.2em; color: #64b5f6; margin-top: 5px;">You: ${p1}</div>
                        </div>
                        <div>
                            <div>${ai === 'opera' ? 'üé≠ Opera' : 'üèà Football'}</div>
                            <div style="font-size: 1.2em; color: #90caf9; margin-top: 5px;">Partner: ${p2}</div>
                        </div>
                    </div>
                    <div class="result-outcome ${coordinated ? 'coordinated' : 'failed'}">
                        ${coordinated ? '‚úì Successfully Coordinated!' : '‚úó Failed to Coordinate'}
                    </div>
                </div>
            `;
        }

        function runSimulation() {
            // Reset AI
            aiOperaProb = 0.6;
            let p1OperaProb = 0.6;

            for (let i = 0; i < 100; i++) {
                const p1Choice = Math.random() < p1OperaProb ? 'opera' : 'football';
                const p2Choice = Math.random() < aiOperaProb ? 'opera' : 'football';

                const key = `${p1Choice}-${p2Choice}`;
                const [p1Payoff, p2Payoff] = payoffs[key];

                stats.rounds++;

                if (p1Choice === 'opera' && p2Choice === 'opera') {
                    stats.bothOpera++;
                    // Both learn to coordinate on opera
                    p1OperaProb = Math.min(0.95, p1OperaProb + 0.03);
                    aiOperaProb = Math.min(0.95, aiOperaProb + 0.03);
                } else if (p1Choice === 'football' && p2Choice === 'football') {
                    stats.bothFootball++;
                    // Both learn to coordinate on football
                    p1OperaProb = Math.max(0.05, p1OperaProb - 0.03);
                    aiOperaProb = Math.max(0.05, aiOperaProb - 0.03);
                } else {
                    stats.miscoord++;
                    // Miscoordination - slight adjustment
                    p1OperaProb += (Math.random() - 0.5) * 0.1;
                    aiOperaProb += (Math.random() - 0.5) * 0.1;
                }

                history.push({
                    player: p1Choice,
                    ai: p2Choice,
                    p1Payoff,
                    p2Payoff,
                    coordinated: p1Choice === p2Choice
                });
            }

            while (history.length > 50) history.shift();

            updateStats();
            draw();
        }

        function updateStats() {
            document.getElementById('roundsPlayed').textContent = stats.rounds;
            document.getElementById('bothOpera').textContent = stats.bothOpera;
            document.getElementById('bothFootball').textContent = stats.bothFootball;
            document.getElementById('miscoord').textContent = stats.miscoord;

            const coordRate = stats.rounds > 0 ?
                ((stats.bothOpera + stats.bothFootball) / stats.rounds * 100).toFixed(1) : '0';
            document.getElementById('coordRate').textContent = coordRate + '%';
        }

        function reset() {
            history = [];
            stats = {
                rounds: 0,
                bothOpera: 0,
                bothFootball: 0,
                miscoord: 0
            };
            aiOperaProb = 0.6;
            document.getElementById('resultDisplay').innerHTML = '';
            updateStats();
            draw();
        }

        function draw() {
            ctx.fillStyle = '#0a0e1a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            if (history.length === 0) {
                ctx.fillStyle = '#64b5f6';
                ctx.font = '20px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Make a choice to see coordination patterns', canvas.width / 2, canvas.height / 2);
                return;
            }

            const margin = 60;
            const barWidth = Math.max(10, (canvas.width - margin * 2) / history.length);

            // Title
            ctx.fillStyle = '#64b5f6';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Coordination History (Last 50 Rounds)', canvas.width / 2, 25);

            // Draw outcome bars
            history.forEach((round, i) => {
                const x = margin + i * barWidth;
                const y = 80;

                let color;
                if (round.player === 'opera' && round.ai === 'opera') {
                    color = '#9c27b0'; // Both opera
                } else if (round.player === 'football' && round.ai === 'football') {
                    color = '#ff5722'; // Both football
                } else {
                    color = '#e57373'; // Miscoordination
                }

                ctx.fillStyle = color;
                ctx.fillRect(x, y, barWidth - 2, 40);

                // Player choice indicator
                ctx.fillStyle = round.player === 'opera' ? '#ce93d8' : '#ff8a65';
                ctx.fillRect(x, y + 45, barWidth - 2, 10);

                // AI choice indicator
                ctx.fillStyle = round.ai === 'opera' ? '#ce93d8' : '#ff8a65';
                ctx.fillRect(x, y + 58, barWidth - 2, 10);
            });

            // Legend
            const legendY = 180;
            ctx.fillStyle = '#e0e0e0';
            ctx.font = '12px Arial';
            ctx.textAlign = 'left';

            ctx.fillStyle = '#9c27b0';
            ctx.fillRect(margin, legendY, 25, 20);
            ctx.fillStyle = '#e0e0e0';
            ctx.fillText('Both Opera (3,2)', margin + 35, legendY + 14);

            ctx.fillStyle = '#ff5722';
            ctx.fillRect(margin + 180, legendY, 25, 20);
            ctx.fillStyle = '#e0e0e0';
            ctx.fillText('Both Football (2,3)', margin + 215, legendY + 14);

            ctx.fillStyle = '#e57373';
            ctx.fillRect(margin, legendY + 30, 25, 20);
            ctx.fillStyle = '#e0e0e0';
            ctx.fillText('Miscoordination (0,0)', margin + 35, legendY + 44);

            // Draw convergence chart
            const chartY = 250;
            const chartHeight = 200;

            ctx.fillStyle = '#64b5f6';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Choice Distribution Over Time', canvas.width / 2, chartY - 10);

            // Calculate rolling averages
            const windowSize = 10;
            const operaRates = [];
            for (let i = windowSize; i <= history.length; i++) {
                const window = history.slice(i - windowSize, i);
                const operaCount = window.filter(h => h.player === 'opera' && h.ai === 'opera').length;
                operaRates.push(operaCount / windowSize);
            }

            if (operaRates.length > 1) {
                const xStep = (canvas.width - margin * 2) / (operaRates.length - 1);

                // Opera coordination line
                ctx.strokeStyle = '#9c27b0';
                ctx.lineWidth = 3;
                ctx.beginPath();
                operaRates.forEach((rate, i) => {
                    const x = margin + i * xStep;
                    const y = chartY + chartHeight - rate * chartHeight;
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                });
                ctx.stroke();

                // Axes
                ctx.strokeStyle = '#2a3f5f';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(margin, chartY);
                ctx.lineTo(margin, chartY + chartHeight);
                ctx.lineTo(canvas.width - margin, chartY + chartHeight);
                ctx.stroke();

                // Y-axis labels
                ctx.fillStyle = '#b0b0b0';
                ctx.font = '11px Arial';
                ctx.textAlign = 'right';
                ctx.fillText('100%', margin - 5, chartY + 5);
                ctx.fillText('50%', margin - 5, chartY + chartHeight / 2 + 5);
                ctx.fillText('0%', margin - 5, chartY + chartHeight + 5);
            }
        }

        window.makeChoice = makeChoice;
        window.runSimulation = runSimulation;
        window.reset = reset;

        draw();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
