<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auction Mechanisms | Game Theory</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 10px; color: #4fc3f7; }
        .subtitle { text-align: center; color: #888; margin-bottom: 20px; }

        .auction-types {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;
            margin-bottom: 20px;
        }
        @media (max-width: 700px) { .auction-types { grid-template-columns: repeat(2, 1fr); } }

        .auction-type {
            padding: 15px; text-align: center; border-radius: 10px;
            background: rgba(79, 195, 247, 0.1);
            border: 2px solid rgba(79, 195, 247, 0.3);
            cursor: pointer; transition: all 0.3s;
        }
        .auction-type.active {
            background: rgba(79, 195, 247, 0.3);
            border-color: #4fc3f7;
        }
        .auction-type:hover { background: rgba(79, 195, 247, 0.2); }
        .auction-type h3 { color: #4fc3f7; margin-bottom: 5px; }
        .auction-type p { font-size: 0.8em; color: #888; }

        .main-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 800px) { .main-grid { grid-template-columns: 1fr; } }

        .panel {
            background: rgba(255,255,255,0.05);
            border-radius: 15px; padding: 20px;
            border: 1px solid rgba(79, 195, 247, 0.2);
        }
        .panel h2 { color: #4fc3f7; margin-bottom: 15px; }

        .item-display {
            text-align: center; padding: 20px;
            background: rgba(0,0,0,0.3); border-radius: 15px;
            margin-bottom: 20px;
        }
        .item-icon { font-size: 4em; margin-bottom: 10px; }
        .item-value { font-size: 1.2em; }
        .true-value { color: #4caf50; }

        .bidders-list {
            max-height: 250px; overflow-y: auto;
        }
        .bidder {
            display: flex; justify-content: space-between;
            align-items: center; padding: 10px;
            margin: 5px 0; border-radius: 8px;
            background: rgba(0,0,0,0.2);
        }
        .bidder.winner {
            background: rgba(76, 175, 80, 0.3);
            border: 1px solid #4caf50;
        }
        .bidder.you {
            border: 1px solid #4fc3f7;
        }
        .bidder-name { font-weight: bold; }
        .bidder-bid { color: #ffd700; }
        .bidder-value { color: #888; font-size: 0.85em; }

        .bid-input {
            display: flex; gap: 10px; margin: 15px 0;
        }
        .bid-input input {
            flex: 1; padding: 12px; border-radius: 8px;
            border: 1px solid #4fc3f7; background: #1a1a2e;
            color: #e0e0e0; font-size: 1.1em;
        }
        button {
            padding: 12px 25px; border: none; border-radius: 8px;
            background: #4fc3f7; color: #1a1a2e; font-weight: bold;
            cursor: pointer; transition: all 0.3s;
        }
        button:hover { background: #81d4fa; }

        .result-panel {
            padding: 15px; border-radius: 10px;
            margin-top: 15px; display: none;
        }
        .result-win {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid #4caf50;
        }
        .result-lose {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid #f44336;
        }

        canvas { width: 100%; border-radius: 10px; background: rgba(0,0,0,0.2); }

        .stat-row {
            display: flex; justify-content: space-between;
            padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .explanation {
            background: rgba(79, 195, 247, 0.1);
            padding: 15px; border-radius: 10px;
            font-size: 0.85em; line-height: 1.6;
            margin-top: 15px;
        }

        .controls { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }

        a.back-link {
            display: inline-block; margin-bottom: 20px;
            color: #4fc3f7; text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê Back to Game Theory</a>
        <h1>Auction Mechanisms</h1>
        <p class="subtitle">Compare different auction formats and bidding strategies</p>

        <div class="auction-types">
            <div class="auction-type active" data-type="first-price">
                <h3>First-Price Sealed</h3>
                <p>Highest bid wins, pays their bid</p>
            </div>
            <div class="auction-type" data-type="second-price">
                <h3>Second-Price (Vickrey)</h3>
                <p>Highest bid wins, pays 2nd highest</p>
            </div>
            <div class="auction-type" data-type="english">
                <h3>English (Ascending)</h3>
                <p>Open outcry, price rises until one left</p>
            </div>
            <div class="auction-type" data-type="dutch">
                <h3>Dutch (Descending)</h3>
                <p>Price falls until someone accepts</p>
            </div>
        </div>

        <div class="main-grid">
            <div class="panel">
                <h2>Auction</h2>

                <div class="item-display">
                    <div class="item-icon">üé®</div>
                    <div>Rare Painting</div>
                    <div class="item-value">Your valuation: <span class="true-value" id="yourValue">$0</span></div>
                </div>

                <div class="controls">
                    <button id="newAuction">New Auction</button>
                    <button id="runMany">Run 100 Auctions</button>
                </div>

                <h3 id="auctionTitle">First-Price Sealed Bid</h3>
                <p id="auctionDesc" style="color:#888; margin:10px 0; font-size:0.9em;">
                    Submit your bid. Highest bidder wins and pays their bid.
                </p>

                <div class="bid-input" id="bidInput">
                    <input type="number" id="bidAmount" placeholder="Your bid ($)" min="0">
                    <button id="submitBid">Submit Bid</button>
                </div>

                <div id="englishControls" style="display:none;">
                    <div>Current price: <span id="currentPrice">$0</span></div>
                    <button id="bidEnglish">Bid</button>
                    <button id="passEnglish">Pass</button>
                </div>

                <div id="dutchControls" style="display:none;">
                    <div>Current price: <span id="dutchPrice">$100</span></div>
                    <button id="acceptDutch">Accept!</button>
                </div>

                <div class="result-panel" id="resultPanel"></div>

                <h3 style="margin-top:20px;">Bidders</h3>
                <div class="bidders-list" id="biddersList"></div>
            </div>

            <div class="panel">
                <h2>Statistics</h2>

                <div class="stat-row">
                    <span>Auctions Played</span>
                    <span id="auctionsPlayed">0</span>
                </div>
                <div class="stat-row">
                    <span>Your Wins</span>
                    <span id="yourWins">0</span>
                </div>
                <div class="stat-row">
                    <span>Your Profit</span>
                    <span id="yourProfit">$0</span>
                </div>
                <div class="stat-row">
                    <span>Seller Revenue (Avg)</span>
                    <span id="avgRevenue">$0</span>
                </div>

                <h2 style="margin-top:20px;">Revenue by Auction Type</h2>
                <canvas id="revenueChart" height="200"></canvas>

                <div class="explanation" id="explanation">
                    <strong>First-Price Sealed Bid:</strong><br>
                    ‚Ä¢ Strategic bidding: Bid below your value to profit<br>
                    ‚Ä¢ Risk: Bid too low and lose<br>
                    ‚Ä¢ Optimal: Shade bid based on competition
                </div>
            </div>
        </div>
    </div>

    <script>
        const revenueCanvas = document.getElementById('revenueChart');
        const revenueCtx = revenueCanvas.getContext('2d');

        let auctionType = 'first-price';
        let yourValue = 0;
        let bidders = [];
        let stats = {
            played: 0,
            wins: 0,
            profit: 0,
            revenues: {
                'first-price': [],
                'second-price': [],
                'english': [],
                'dutch': []
            }
        };

        // English/Dutch auction state
        let englishPrice = 0;
        let englishActive = [];
        let dutchPrice = 0;
        let dutchInterval = null;

        function generateBidders() {
            bidders = [];
            const numBidders = 4 + Math.floor(Math.random() * 4);

            // Generate values from uniform distribution
            for (let i = 0; i < numBidders; i++) {
                const value = 20 + Math.floor(Math.random() * 80);
                bidders.push({
                    name: `Bidder ${i + 1}`,
                    value: value,
                    bid: 0,
                    active: true
                });
            }

            // Your value
            yourValue = 20 + Math.floor(Math.random() * 80);
            document.getElementById('yourValue').textContent = '$' + yourValue;

            renderBidders();
        }

        function renderBidders() {
            const list = document.getElementById('biddersList');
            list.innerHTML = '';

            // Add "You"
            const youDiv = document.createElement('div');
            youDiv.className = 'bidder you';
            youDiv.innerHTML = `
                <div>
                    <span class="bidder-name">You</span>
                    <span class="bidder-value">(value: $${yourValue})</span>
                </div>
                <span class="bidder-bid" id="yourBidDisplay">-</span>
            `;
            list.appendChild(youDiv);

            // Add AI bidders
            for (const bidder of bidders) {
                const div = document.createElement('div');
                div.className = 'bidder' + (bidder.winner ? ' winner' : '');
                div.innerHTML = `
                    <div>
                        <span class="bidder-name">${bidder.name}</span>
                        <span class="bidder-value">${bidder.showValue ? `(value: $${bidder.value})` : ''}</span>
                    </div>
                    <span class="bidder-bid">${bidder.bid > 0 ? '$' + bidder.bid : '-'}</span>
                `;
                list.appendChild(div);
            }
        }

        function setAuctionType(type) {
            auctionType = type;

            document.querySelectorAll('.auction-type').forEach(el => {
                el.classList.toggle('active', el.dataset.type === type);
            });

            // Show/hide controls
            document.getElementById('bidInput').style.display =
                (type === 'first-price' || type === 'second-price') ? 'flex' : 'none';
            document.getElementById('englishControls').style.display =
                type === 'english' ? 'block' : 'none';
            document.getElementById('dutchControls').style.display =
                type === 'dutch' ? 'block' : 'none';

            // Update title and description
            const titles = {
                'first-price': 'First-Price Sealed Bid',
                'second-price': 'Second-Price (Vickrey) Auction',
                'english': 'English Ascending Auction',
                'dutch': 'Dutch Descending Auction'
            };

            const descs = {
                'first-price': 'Submit your bid. Highest bidder wins and pays their bid.',
                'second-price': 'Submit your bid truthfully! Winner pays the second-highest bid.',
                'english': 'Price increases. Stay in or pass. Last bidder wins.',
                'dutch': 'Price decreases. First to accept wins at current price.'
            };

            const explanations = {
                'first-price': `<strong>First-Price Sealed Bid:</strong><br>
                    ‚Ä¢ Strategic bidding: Bid below your value to profit<br>
                    ‚Ä¢ Risk: Bid too low and lose<br>
                    ‚Ä¢ Optimal: Shade bid based on competition`,
                'second-price': `<strong>Second-Price (Vickrey) Auction:</strong><br>
                    ‚Ä¢ Truthful bidding is optimal!<br>
                    ‚Ä¢ Bid exactly your value - you only pay 2nd highest<br>
                    ‚Ä¢ Named after William Vickrey (Nobel Prize 1996)`,
                'english': `<strong>English Ascending Auction:</strong><br>
                    ‚Ä¢ Most common format (eBay, Christie's)<br>
                    ‚Ä¢ Stay in until price exceeds your value<br>
                    ‚Ä¢ Strategically equivalent to Vickrey`,
                'dutch': `<strong>Dutch Descending Auction:</strong><br>
                    ‚Ä¢ Price starts high and decreases<br>
                    ‚Ä¢ First to accept wins at current price<br>
                    ‚Ä¢ Used for flowers, fish, IPOs`
            };

            document.getElementById('auctionTitle').textContent = titles[type];
            document.getElementById('auctionDesc').textContent = descs[type];
            document.getElementById('explanation').innerHTML = explanations[type];

            generateBidders();
            document.getElementById('resultPanel').style.display = 'none';

            if (type === 'english') startEnglish();
            if (type === 'dutch') startDutch();
        }

        function submitBid() {
            const yourBid = parseInt(document.getElementById('bidAmount').value) || 0;

            // AI bids based on auction type
            for (const bidder of bidders) {
                if (auctionType === 'first-price') {
                    // Shade bid (bid less than value)
                    bidder.bid = Math.floor(bidder.value * (0.6 + Math.random() * 0.3));
                } else {
                    // Second-price: bid true value (dominant strategy)
                    bidder.bid = bidder.value;
                }
                bidder.showValue = true;
            }

            // Find winner
            const allBids = [...bidders.map(b => ({ ...b, isYou: false })), { name: 'You', value: yourValue, bid: yourBid, isYou: true }];
            allBids.sort((a, b) => b.bid - a.bid);

            const winner = allBids[0];
            const secondHighest = allBids[1]?.bid || 0;

            // Payment
            const payment = auctionType === 'first-price' ? winner.bid : secondHighest;

            // Update results
            const resultPanel = document.getElementById('resultPanel');
            resultPanel.style.display = 'block';

            if (winner.isYou) {
                const profit = yourValue - payment;
                stats.wins++;
                stats.profit += profit;

                resultPanel.className = 'result-panel result-win';
                resultPanel.innerHTML = `
                    <strong>üéâ You Win!</strong><br>
                    Your bid: $${yourBid}<br>
                    Payment: $${payment}<br>
                    Profit: $${profit}
                `;
            } else {
                resultPanel.className = 'result-panel result-lose';
                resultPanel.innerHTML = `
                    <strong>You lost</strong><br>
                    Winner: ${winner.name} ($${winner.bid})<br>
                    ${auctionType === 'second-price' ? `Payment: $${payment}` : ''}
                `;
            }

            // Mark winner
            for (const b of bidders) {
                b.winner = (b.name === winner.name && !winner.isYou);
            }

            document.getElementById('yourBidDisplay').textContent = '$' + yourBid;
            renderBidders();

            stats.played++;
            stats.revenues[auctionType].push(payment);
            updateStats();
        }

        function startEnglish() {
            englishPrice = 10;
            englishActive = [...bidders.map(b => ({ ...b })), { name: 'You', value: yourValue, isYou: true }];

            document.getElementById('currentPrice').textContent = '$' + englishPrice;
        }

        function bidEnglish() {
            englishPrice += 5;
            document.getElementById('currentPrice').textContent = '$' + englishPrice;

            // AI decisions
            englishActive = englishActive.filter(b => {
                if (b.isYou) return true;
                return b.value >= englishPrice + Math.random() * 10;
            });

            checkEnglishEnd();
        }

        function passEnglish() {
            englishActive = englishActive.filter(b => !b.isYou);
            checkEnglishEnd(true);
        }

        function checkEnglishEnd(youPassed = false) {
            if (englishActive.length <= 1 || youPassed) {
                const winner = englishActive.find(b => !b.isYou) || (youPassed ? null : englishActive[0]);
                const resultPanel = document.getElementById('resultPanel');
                resultPanel.style.display = 'block';

                if (winner?.isYou) {
                    const profit = yourValue - englishPrice;
                    stats.wins++;
                    stats.profit += profit;
                    resultPanel.className = 'result-panel result-win';
                    resultPanel.innerHTML = `<strong>üéâ You Win!</strong><br>Price: $${englishPrice}<br>Profit: $${profit}`;
                } else {
                    resultPanel.className = 'result-panel result-lose';
                    resultPanel.innerHTML = `<strong>You lost</strong><br>Winner: ${winner?.name || 'No one'} at $${englishPrice}`;
                }

                stats.played++;
                stats.revenues['english'].push(englishPrice);
                updateStats();
            }
        }

        function startDutch() {
            dutchPrice = 100;
            document.getElementById('dutchPrice').textContent = '$' + dutchPrice;

            if (dutchInterval) clearInterval(dutchInterval);

            dutchInterval = setInterval(() => {
                dutchPrice -= 2;
                document.getElementById('dutchPrice').textContent = '$' + dutchPrice;

                // AI accepts?
                for (const bidder of bidders) {
                    if (bidder.value >= dutchPrice && Math.random() < 0.3) {
                        clearInterval(dutchInterval);
                        endDutch(bidder);
                        return;
                    }
                }

                if (dutchPrice <= 0) {
                    clearInterval(dutchInterval);
                    endDutch(null);
                }
            }, 500);
        }

        function acceptDutch() {
            clearInterval(dutchInterval);
            endDutch({ name: 'You', isYou: true });
        }

        function endDutch(winner) {
            const resultPanel = document.getElementById('resultPanel');
            resultPanel.style.display = 'block';

            if (winner?.isYou) {
                const profit = yourValue - dutchPrice;
                stats.wins++;
                stats.profit += profit;
                resultPanel.className = 'result-panel result-win';
                resultPanel.innerHTML = `<strong>üéâ You Win!</strong><br>Price: $${dutchPrice}<br>Profit: $${profit}`;
            } else if (winner) {
                resultPanel.className = 'result-panel result-lose';
                resultPanel.innerHTML = `<strong>You lost</strong><br>Winner: ${winner.name} at $${dutchPrice}`;
            } else {
                resultPanel.className = 'result-panel result-lose';
                resultPanel.innerHTML = `<strong>No winner</strong>`;
            }

            stats.played++;
            stats.revenues['dutch'].push(dutchPrice);
            updateStats();
        }

        async function runMany() {
            for (let i = 0; i < 100; i++) {
                generateBidders();
                const yourBid = auctionType === 'second-price' ? yourValue :
                    Math.floor(yourValue * (0.6 + Math.random() * 0.3));
                document.getElementById('bidAmount').value = yourBid;
                submitBid();
                await new Promise(r => setTimeout(r, 10));
            }
        }

        function updateStats() {
            document.getElementById('auctionsPlayed').textContent = stats.played;
            document.getElementById('yourWins').textContent = stats.wins;
            document.getElementById('yourProfit').textContent = '$' + stats.profit;

            const allRevenues = Object.values(stats.revenues).flat();
            const avgRev = allRevenues.length > 0 ?
                allRevenues.reduce((a, b) => a + b, 0) / allRevenues.length : 0;
            document.getElementById('avgRevenue').textContent = '$' + avgRev.toFixed(0);

            drawRevenueChart();
        }

        function drawRevenueChart() {
            const dpr = window.devicePixelRatio || 1;
            revenueCanvas.width = revenueCanvas.offsetWidth * dpr;
            revenueCanvas.height = 200 * dpr;
            revenueCtx.scale(dpr, dpr);

            const w = revenueCanvas.offsetWidth;
            const h = 200;

            revenueCtx.fillStyle = 'rgba(0,0,0,0.2)';
            revenueCtx.fillRect(0, 0, w, h);

            const types = ['first-price', 'second-price', 'english', 'dutch'];
            const colors = ['#4fc3f7', '#4caf50', '#ffd700', '#ff9800'];
            const labels = ['1st Price', '2nd Price', 'English', 'Dutch'];

            const avgs = types.map(t => {
                const revs = stats.revenues[t];
                return revs.length > 0 ? revs.reduce((a, b) => a + b, 0) / revs.length : 0;
            });

            const maxAvg = Math.max(...avgs, 1);
            const barWidth = (w - 60) / 4;

            for (let i = 0; i < 4; i++) {
                const barHeight = (avgs[i] / maxAvg) * (h - 50);
                const x = 30 + i * barWidth;
                const y = h - barHeight - 30;

                revenueCtx.fillStyle = colors[i];
                revenueCtx.fillRect(x + 5, y, barWidth - 10, barHeight);

                revenueCtx.fillStyle = '#e0e0e0';
                revenueCtx.font = '10px sans-serif';
                revenueCtx.textAlign = 'center';
                revenueCtx.fillText(labels[i], x + barWidth/2, h - 10);
                revenueCtx.fillText('$' + avgs[i].toFixed(0), x + barWidth/2, y - 5);
            }
        }

        // Event listeners
        document.querySelectorAll('.auction-type').forEach(el => {
            el.onclick = () => setAuctionType(el.dataset.type);
        });

        document.getElementById('submitBid').onclick = submitBid;
        document.getElementById('newAuction').onclick = () => setAuctionType(auctionType);
        document.getElementById('runMany').onclick = runMany;
        document.getElementById('bidEnglish').onclick = bidEnglish;
        document.getElementById('passEnglish').onclick = passEnglish;
        document.getElementById('acceptDutch').onclick = acceptDutch;

        // Initialize
        generateBidders();
        updateStats();
    </script>
</body>
</html>
