<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hawk-Dove Game - Game Theory</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #eee;
            min-height: 100vh;
            padding: 20px;
        }
        .back-link {
            position: fixed; top: 20px; left: 20px; color: #4ade80; text-decoration: none;
            font-weight: 600; padding: 8px 16px; background: rgba(0,0,0,0.3); border-radius: 20px;
            z-index: 100;
        }
        h1 { text-align: center; margin: 40px 0 10px; font-size: 2.2em; color: #4ade80; }
        .subtitle { text-align: center; opacity: 0.8; margin-bottom: 20px; }
        .container { max-width: 1100px; margin: 0 auto; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .panel { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 25px; }
        .info-box { background: rgba(74, 222, 128, 0.1); border: 1px solid rgba(74, 222, 128, 0.3); border-radius: 8px; padding: 15px; margin-bottom: 20px; font-size: 0.9em; line-height: 1.6; }
        h3 { color: #4ade80; margin-bottom: 15px; }
        .matrix-table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        .matrix-table th, .matrix-table td { border: 1px solid rgba(255,255,255,0.2); padding: 12px; text-align: center; }
        .matrix-table th { background: rgba(74, 222, 128, 0.2); }
        canvas { width: 100%; border-radius: 8px; background: #0a0a15; margin: 15px 0; }
        .control-group { margin: 15px 0; }
        .control-group label { display: block; margin-bottom: 5px; }
        .control-group input { width: 100%; }
        .value-display { color: #4ade80; font-family: monospace; font-weight: 600; }
        button { width: 100%; padding: 12px; margin: 8px 0; border: none; border-radius: 8px; font-size: 1em; font-weight: 600; cursor: pointer; }
        .btn-primary { background: #4ade80; color: #1a1a2e; }
        .btn-secondary { background: rgba(255,255,255,0.1); color: #fff; }
        .population-bar { height: 40px; display: flex; border-radius: 8px; overflow: hidden; margin: 15px 0; }
        .hawk-portion { background: linear-gradient(135deg, #f87171, #dc2626); display: flex; align-items: center; justify-content: center; font-weight: 600; transition: width 0.3s; }
        .dove-portion { background: linear-gradient(135deg, #4ade80, #22c55e); display: flex; align-items: center; justify-content: center; font-weight: 600; transition: width 0.3s; }
        .ess-indicator { background: rgba(250, 204, 21, 0.2); border: 2px solid #facc15; border-radius: 8px; padding: 15px; margin: 15px 0; text-align: center; }
        .ess-value { font-size: 2em; color: #facc15; }
        .generation-display { text-align: center; font-size: 1.3em; color: #22d3ee; margin: 10px 0; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        .stat-box { background: rgba(0,0,0,0.3); padding: 12px; border-radius: 8px; text-align: center; }
        .stat-value { font-size: 1.5em; color: #4ade80; }
        .stat-label { font-size: 0.8em; opacity: 0.7; }
        @media (max-width: 800px) { .container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back</a>
    <h1>Hawk-Dove Game</h1>
    <p class="subtitle">Evolutionary Stable Strategies (ESS)</p>

    <div class="container">
        <div class="panel">
            <div class="info-box">
                <strong>Hawk-Dove Game:</strong> Two strategies compete for resources. Hawks fight (costly if both fight),
                Doves share peacefully. Neither pure strategy is evolutionarily stable - the population evolves to a mixed equilibrium (ESS).
            </div>

            <h3>Payoff Matrix</h3>
            <table class="matrix-table">
                <tr>
                    <th></th>
                    <th>Hawk</th>
                    <th>Dove</th>
                </tr>
                <tr>
                    <th>Hawk</th>
                    <td id="hh">(V-C)/2</td>
                    <td id="hd">V</td>
                </tr>
                <tr>
                    <th>Dove</th>
                    <td id="dh">0</td>
                    <td id="dd">V/2</td>
                </tr>
            </table>

            <div class="control-group">
                <label>Resource Value (V): <span class="value-display" id="vVal">10</span></label>
                <input type="range" id="vSlider" min="1" max="20" value="10" oninput="updateParams()">
            </div>

            <div class="control-group">
                <label>Fighting Cost (C): <span class="value-display" id="cVal">15</span></label>
                <input type="range" id="cSlider" min="1" max="30" value="15" oninput="updateParams()">
            </div>

            <div class="ess-indicator">
                <div>Predicted ESS (Hawk proportion)</div>
                <div class="ess-value" id="essValue">V/C = 67%</div>
            </div>

            <h3>Current Population</h3>
            <div class="population-bar">
                <div class="hawk-portion" id="hawkBar" style="width: 50%;">Hawks: 50%</div>
                <div class="dove-portion" id="doveBar" style="width: 50%;">Doves: 50%</div>
            </div>

            <div class="generation-display">Generation: <span id="generation">0</span></div>

            <button class="btn-primary" onclick="runEvolution()">Run Evolution</button>
            <button class="btn-secondary" onclick="stepGeneration()">Step</button>
            <button class="btn-secondary" onclick="resetSimulation()">Reset</button>
        </div>

        <div class="panel">
            <h3>Population Dynamics</h3>
            <canvas id="canvas" width="500" height="300"></canvas>

            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-value" id="hawkFitness">0</div>
                    <div class="stat-label">Hawk Avg Fitness</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="doveFitness">0</div>
                    <div class="stat-label">Dove Avg Fitness</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="hawkCount">50</div>
                    <div class="stat-label">Hawks</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="doveCount">50</div>
                    <div class="stat-label">Doves</div>
                </div>
            </div>

            <h3>Phase Portrait</h3>
            <canvas id="phaseCanvas" width="500" height="200"></canvas>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const phaseCanvas = document.getElementById('phaseCanvas');
        const phaseCtx = phaseCanvas.getContext('2d');

        let V = 10, C = 15;
        let hawkProp = 0.5;
        let generation = 0;
        let history = [];
        let running = false;

        function updateParams() {
            V = parseInt(document.getElementById('vSlider').value);
            C = parseInt(document.getElementById('cSlider').value);

            document.getElementById('vVal').textContent = V;
            document.getElementById('cVal').textContent = C;

            // Update matrix display
            const hh = ((V - C) / 2).toFixed(1);
            document.getElementById('hh').textContent = hh;
            document.getElementById('hd').textContent = V;
            document.getElementById('dh').textContent = '0';
            document.getElementById('dd').textContent = (V / 2).toFixed(1);

            // Calculate ESS
            const ess = Math.min(1, Math.max(0, V / C));
            document.getElementById('essValue').textContent = `V/C = ${Math.round(ess * 100)}%`;

            updateDisplay();
            drawPhasePortrait();
        }

        function calculateFitness(hawkProp) {
            const p = hawkProp;
            // Hawk fitness: p * (V-C)/2 + (1-p) * V
            const hawkFit = p * (V - C) / 2 + (1 - p) * V;
            // Dove fitness: p * 0 + (1-p) * V/2
            const doveFit = (1 - p) * V / 2;
            return { hawk: hawkFit, dove: doveFit };
        }

        function stepGeneration() {
            const fit = calculateFitness(hawkProp);

            // Replicator dynamics: dp/dt = p * (fitness_hawk - avg_fitness)
            const avgFit = hawkProp * fit.hawk + (1 - hawkProp) * fit.dove;
            const delta = hawkProp * (fit.hawk - avgFit) * 0.1;

            hawkProp = Math.min(0.99, Math.max(0.01, hawkProp + delta));
            generation++;

            history.push({
                gen: generation,
                hawk: hawkProp,
                hawkFit: fit.hawk,
                doveFit: fit.dove
            });

            updateDisplay();
            drawChart();
            drawPhasePortrait();
        }

        function updateDisplay() {
            const fit = calculateFitness(hawkProp);

            document.getElementById('generation').textContent = generation;
            document.getElementById('hawkBar').style.width = (hawkProp * 100) + '%';
            document.getElementById('hawkBar').textContent = `Hawks: ${Math.round(hawkProp * 100)}%`;
            document.getElementById('doveBar').style.width = ((1 - hawkProp) * 100) + '%';
            document.getElementById('doveBar').textContent = `Doves: ${Math.round((1 - hawkProp) * 100)}%`;

            document.getElementById('hawkFitness').textContent = fit.hawk.toFixed(2);
            document.getElementById('doveFitness').textContent = fit.dove.toFixed(2);
            document.getElementById('hawkCount').textContent = Math.round(hawkProp * 100);
            document.getElementById('doveCount').textContent = Math.round((1 - hawkProp) * 100);
        }

        function drawChart() {
            ctx.fillStyle = '#0a0a15';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            if (history.length < 2) return;

            const margin = { top: 20, right: 20, bottom: 30, left: 50 };
            const w = canvas.width - margin.left - margin.right;
            const h = canvas.height - margin.top - margin.bottom;

            // Draw ESS line
            const ess = Math.min(1, V / C);
            const essY = margin.top + h * (1 - ess);
            ctx.strokeStyle = 'rgba(250, 204, 21, 0.5)';
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(margin.left, essY);
            ctx.lineTo(margin.left + w, essY);
            ctx.stroke();
            ctx.setLineDash([]);

            // Draw hawk proportion
            ctx.strokeStyle = '#f87171';
            ctx.lineWidth = 2;
            ctx.beginPath();
            history.forEach((h, i) => {
                const x = margin.left + (i / Math.max(history.length - 1, 1)) * w;
                const y = margin.top + (1 - h.hawk) * (canvas.height - margin.top - margin.bottom);
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            ctx.stroke();

            // Labels
            ctx.fillStyle = '#fff';
            ctx.font = '11px sans-serif';
            ctx.fillText('100%', 10, margin.top + 5);
            ctx.fillText('0%', 10, margin.top + h);
            ctx.fillStyle = '#facc15';
            ctx.fillText('ESS: ' + Math.round(ess * 100) + '%', canvas.width - 70, essY - 5);

            // Title
            ctx.fillStyle = '#f87171';
            ctx.font = 'bold 12px sans-serif';
            ctx.fillText('Hawk Proportion Over Time', margin.left, 15);
        }

        function drawPhasePortrait() {
            phaseCtx.fillStyle = '#0a0a15';
            phaseCtx.fillRect(0, 0, phaseCanvas.width, phaseCanvas.height);

            const margin = 40;
            const w = phaseCanvas.width - 2 * margin;
            const h = phaseCanvas.height - 2 * margin;

            // Draw axes
            phaseCtx.strokeStyle = 'rgba(255,255,255,0.3)';
            phaseCtx.beginPath();
            phaseCtx.moveTo(margin, margin);
            phaseCtx.lineTo(margin, margin + h);
            phaseCtx.lineTo(margin + w, margin + h);
            phaseCtx.stroke();

            // Draw fitness curves
            phaseCtx.lineWidth = 2;

            // Hawk fitness
            phaseCtx.strokeStyle = '#f87171';
            phaseCtx.beginPath();
            for (let p = 0; p <= 1; p += 0.01) {
                const fit = calculateFitness(p);
                const x = margin + p * w;
                const y = margin + h - (fit.hawk / V) * h;
                if (p === 0) phaseCtx.moveTo(x, y);
                else phaseCtx.lineTo(x, y);
            }
            phaseCtx.stroke();

            // Dove fitness
            phaseCtx.strokeStyle = '#4ade80';
            phaseCtx.beginPath();
            for (let p = 0; p <= 1; p += 0.01) {
                const fit = calculateFitness(p);
                const x = margin + p * w;
                const y = margin + h - (fit.dove / V) * h;
                if (p === 0) phaseCtx.moveTo(x, y);
                else phaseCtx.lineTo(x, y);
            }
            phaseCtx.stroke();

            // Mark current position
            const currentFit = calculateFitness(hawkProp);
            phaseCtx.fillStyle = '#fff';
            phaseCtx.beginPath();
            phaseCtx.arc(margin + hawkProp * w, margin + h - (currentFit.hawk / V) * h, 6, 0, Math.PI * 2);
            phaseCtx.fill();

            // ESS point
            const ess = Math.min(1, V / C);
            if (ess > 0 && ess < 1) {
                const essFit = calculateFitness(ess);
                phaseCtx.fillStyle = '#facc15';
                phaseCtx.beginPath();
                phaseCtx.arc(margin + ess * w, margin + h - (essFit.hawk / V) * h, 8, 0, Math.PI * 2);
                phaseCtx.fill();
            }

            // Labels
            phaseCtx.fillStyle = '#fff';
            phaseCtx.font = '10px sans-serif';
            phaseCtx.fillText('Hawk %', margin + w / 2, phaseCanvas.height - 5);
            phaseCtx.fillStyle = '#f87171';
            phaseCtx.fillText('Hawk Fit', margin + 5, 15);
            phaseCtx.fillStyle = '#4ade80';
            phaseCtx.fillText('Dove Fit', margin + 70, 15);
        }

        async function runEvolution() {
            if (running) {
                running = false;
                return;
            }
            running = true;

            for (let i = 0; i < 100 && running; i++) {
                stepGeneration();
                await new Promise(r => setTimeout(r, 50));
            }
            running = false;
        }

        function resetSimulation() {
            running = false;
            hawkProp = 0.5;
            generation = 0;
            history = [];
            updateDisplay();
            drawChart();
            drawPhasePortrait();
        }

        updateParams();
        resetSimulation();
    </script>
</body>
</html>
