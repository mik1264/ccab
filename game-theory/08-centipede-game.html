<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Centipede Game - Game Theory</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0e1a;
            color: #e0e0e0;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .back-link {
            display: inline-block;
            color: #64b5f6;
            text-decoration: none;
            margin-bottom: 20px;
            font-size: 16px;
            transition: color 0.3s;
        }

        .back-link:hover {
            color: #90caf9;
        }

        h1 {
            color: #fff;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .description {
            color: #b0b0b0;
            margin-bottom: 30px;
            line-height: 1.6;
            max-width: 800px;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
            margin-bottom: 20px;
        }

        .game-area {
            background: #151b2b;
            border-radius: 10px;
            padding: 30px;
            border: 1px solid #2a3f5f;
        }

        canvas {
            display: block;
            width: 100%;
            background: #0a0e1a;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .controls-panel {
            background: #151b2b;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #2a3f5f;
        }

        .game-status {
            background: #0f1520;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .game-status h3 {
            color: #64b5f6;
            margin-bottom: 15px;
        }

        .pot-display {
            font-size: 3em;
            color: #ffd54f;
            font-weight: bold;
            margin: 15px 0;
        }

        .turn-indicator {
            font-size: 1.2em;
            color: #90caf9;
            margin-bottom: 10px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .action-btn {
            flex: 1;
            padding: 20px;
            background: #1a2332;
            border: 2px solid;
            border-radius: 8px;
            color: #e0e0e0;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            text-align: center;
            font-weight: 600;
        }

        .action-btn.pass {
            border-color: #4caf50;
        }

        .action-btn.pass:hover {
            background: #2e7d32;
            color: #fff;
        }

        .action-btn.take {
            border-color: #f44336;
        }

        .action-btn.take:hover {
            background: #c62828;
            color: #fff;
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        button {
            width: 100%;
            padding: 12px;
            background: #1976d2;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background 0.3s;
            margin-bottom: 10px;
        }

        button:hover {
            background: #1565c0;
        }

        .stats-box {
            background: #0f1520;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .stats-box h3 {
            color: #64b5f6;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #2a3f5f;
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #b0b0b0;
        }

        .stat-value {
            color: #81c784;
            font-weight: 600;
        }

        .game-over {
            background: #1a2332;
            border: 2px solid #64b5f6;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
        }

        .game-over h3 {
            color: #64b5f6;
            margin-bottom: 10px;
            font-size: 1.5em;
        }

        .final-payoffs {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            font-size: 1.3em;
        }

        .payoff-item {
            padding: 15px 25px;
            background: #0f1520;
            border-radius: 8px;
        }

        .payoff-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #ffd54f;
        }

        .info-box {
            background: #1a2332;
            border-left: 4px solid #64b5f6;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
        }

        .info-box h3 {
            color: #64b5f6;
            margin-bottom: 10px;
        }

        .info-box p {
            line-height: 1.6;
            color: #b0b0b0;
            margin-bottom: 8px;
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">← Back to Game Theory</a>

        <h1>Centipede Game</h1>
        <p class="description">
            A sequential game where players alternate deciding to take the current pot or pass it to the opponent (who grows it).
            Backward induction predicts immediate defection, but cooperation yields much higher payoffs.
        </p>

        <div class="main-grid">
            <div class="game-area">
                <canvas id="canvas" height="300"></canvas>

                <div class="game-status">
                    <h3 id="statusTitle">Your Turn</h3>
                    <div class="turn-indicator" id="turnText">Round <span id="roundNum">1</span> of 6</div>
                    <div class="pot-display">$<span id="potAmount">4</span></div>
                    <div style="color: #b0b0b0; margin-top: 10px;">
                        If you take: You get $<span id="takeYou">1</span>, AI gets $<span id="takeAI">0</span><br>
                        If you pass: Pot grows to $<span id="passGrow">8</span>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="action-btn pass" id="passBtn" onclick="playerAction('pass')">
                        <div style="font-size: 1.5em; margin-bottom: 5px;">✓</div>
                        <div>PASS</div>
                        <div style="font-size: 0.9em; margin-top: 5px;">Continue & Grow Pot</div>
                    </button>
                    <button class="action-btn take" id="takeBtn" onclick="playerAction('take')">
                        <div style="font-size: 1.5em; margin-bottom: 5px;">✋</div>
                        <div>TAKE</div>
                        <div style="font-size: 0.9em; margin-top: 5px;">End Game Now</div>
                    </button>
                </div>

                <div id="gameOverDisplay"></div>
            </div>

            <div class="controls-panel">
                <button onclick="newGame()">New Game</button>
                <button onclick="runSimulation()">Run AI vs AI (20 games)</button>

                <div class="stats-box">
                    <h3>Current Game</h3>
                    <div class="stat-row">
                        <span class="stat-label">Round</span>
                        <span class="stat-value" id="currentRound">1 / 6</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Current Pot</span>
                        <span class="stat-value" id="currentPot">$4</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Max Possible</span>
                        <span class="stat-value" id="maxPossible">$256</span>
                    </div>
                </div>

                <div class="stats-box">
                    <h3>Session Statistics</h3>
                    <div class="stat-row">
                        <span class="stat-label">Games Played</span>
                        <span class="stat-value" id="gamesPlayed">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Avg Rounds</span>
                        <span class="stat-value" id="avgRounds">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Reached Final Round</span>
                        <span class="stat-value" id="finalReached">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Avg Total Payoff</span>
                        <span class="stat-value" id="avgPayoff">-</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="info-box">
            <h3>About the Centipede Game</h3>
            <p><strong>The Setup:</strong> Two players alternate turns. On each turn, a player can either "take" the current pot (ending the game) or "pass" to the other player. When passed, the pot grows (typically doubles).</p>
            <p><strong>Example Sequence:</strong></p>
            <p>• Round 1 (P1): Pot = $4. Take → (P1: $1, P2: $0). Pass → Pot grows to $8</p>
            <p>• Round 2 (P2): Pot = $8. Take → (P1: $0, P2: $2). Pass → Pot grows to $16</p>
            <p>• Round 3 (P1): Pot = $16. Take → (P1: $4, P2: $0). Pass → Pot grows to $32</p>
            <p>• ... continues until final round or someone takes</p>
            <p><strong>Backward Induction Paradox:</strong> Game theory predicts Player 1 should take immediately in Round 1, because:</p>
            <p>• In the final round, the last player will always take</p>
            <p>• Knowing this, the second-to-last player should take on their turn</p>
            <p>• Working backward, Player 1 should take immediately</p>
            <p><strong>Experimental Reality:</strong> People rarely take immediately! Most pass multiple rounds, achieving much higher total payoffs. This demonstrates limits of backward induction and importance of trust and bounded rationality.</p>
            <p><strong>Applications:</strong> Sequential bargaining, investment decisions, contract negotiations, and any situation requiring trust in future reciprocity.</p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            canvas.width = canvas.parentElement.clientWidth;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Game state
        const MAX_ROUNDS = 6;
        let round = 1;
        let pot = 4;
        let isPlayerTurn = true;
        let gameActive = true;
        let gameHistory = [];

        // Session stats
        let sessionStats = {
            games: 0,
            totalRounds: 0,
            finalReached: 0,
            totalPayoff: 0
        };

        function updateUI() {
            document.getElementById('roundNum').textContent = round;
            document.getElementById('potAmount').textContent = pot;
            document.getElementById('currentRound').textContent = `${round} / ${MAX_ROUNDS}`;
            document.getElementById('currentPot').textContent = `$${pot}`;

            // Calculate payoffs if taken
            const playerShare = isPlayerTurn ? Math.floor(pot / 4) : 0;
            const aiShare = isPlayerTurn ? 0 : Math.floor(pot / 2);

            document.getElementById('takeYou').textContent = playerShare;
            document.getElementById('takeAI').textContent = aiShare;

            // Calculate if passed
            const nextPot = pot * 2;
            document.getElementById('passGrow').textContent = nextPot;

            // Max possible
            const roundsLeft = MAX_ROUNDS - round + 1;
            const maxPot = pot * Math.pow(2, roundsLeft - 1);
            document.getElementById('maxPossible').textContent = `$${maxPot}`;

            // Turn indicator
            if (isPlayerTurn) {
                document.getElementById('statusTitle').textContent = 'Your Turn';
                document.getElementById('statusTitle').style.color = '#64b5f6';
                document.getElementById('passBtn').disabled = false;
                document.getElementById('takeBtn').disabled = false;
            } else {
                document.getElementById('statusTitle').textContent = "AI's Turn";
                document.getElementById('statusTitle').style.color = '#ff9800';
                document.getElementById('passBtn').disabled = true;
                document.getElementById('takeBtn').disabled = true;
            }

            drawGame();
        }

        function playerAction(action) {
            if (!gameActive || !isPlayerTurn) return;

            if (action === 'take') {
                endGame(true, isPlayerTurn);
            } else {
                round++;
                pot *= 2;

                if (round > MAX_ROUNDS) {
                    endGame(false, false);
                } else {
                    isPlayerTurn = false;
                    updateUI();
                    // AI turn
                    setTimeout(aiAction, 1000);
                }
            }
        }

        function aiAction() {
            if (!gameActive) return;

            // AI uses probabilistic strategy - more likely to pass early, take late
            const passProb = Math.max(0.1, 1 - (round / MAX_ROUNDS) * 0.7);
            const willPass = Math.random() < passProb;

            if (willPass && round < MAX_ROUNDS) {
                round++;
                pot *= 2;
                isPlayerTurn = true;
                updateUI();
            } else {
                endGame(true, isPlayerTurn);
            }
        }

        function endGame(taken, byPlayer) {
            gameActive = false;
            document.getElementById('passBtn').disabled = true;
            document.getElementById('takeBtn').disabled = true;

            let playerPayoff, aiPayoff;

            if (taken) {
                if (byPlayer) {
                    playerPayoff = Math.floor(pot / 4);
                    aiPayoff = 0;
                } else {
                    playerPayoff = 0;
                    aiPayoff = Math.floor(pot / 2);
                }
            } else {
                // Reached final round
                playerPayoff = Math.floor(pot / 2);
                aiPayoff = Math.floor(pot / 2);
            }

            const gameOverDiv = document.getElementById('gameOverDisplay');
            gameOverDiv.innerHTML = `
                <div class="game-over">
                    <h3>${taken ? (byPlayer ? 'You Took the Pot!' : 'AI Took the Pot!') : 'Final Round Reached!'}</h3>
                    <div class="final-payoffs">
                        <div class="payoff-item">
                            <div style="color: #b0b0b0;">You</div>
                            <div class="payoff-value">$${playerPayoff}</div>
                        </div>
                        <div class="payoff-item">
                            <div style="color: #b0b0b0;">AI</div>
                            <div class="payoff-value">$${aiPayoff}</div>
                        </div>
                    </div>
                    <div style="color: #b0b0b0;">
                        Game ended at round ${round} of ${MAX_ROUNDS}<br>
                        Total pot was $${pot}
                    </div>
                </div>
            `;

            // Update session stats
            sessionStats.games++;
            sessionStats.totalRounds += round;
            sessionStats.totalPayoff += (playerPayoff + aiPayoff);
            if (round >= MAX_ROUNDS) sessionStats.finalReached++;

            updateSessionStats();
            drawGame();
        }

        function updateSessionStats() {
            document.getElementById('gamesPlayed').textContent = sessionStats.games;
            if (sessionStats.games > 0) {
                document.getElementById('avgRounds').textContent =
                    (sessionStats.totalRounds / sessionStats.games).toFixed(1);
                document.getElementById('avgPayoff').textContent =
                    '$' + (sessionStats.totalPayoff / sessionStats.games).toFixed(0);
            }
            document.getElementById('finalReached').textContent = sessionStats.finalReached;
        }

        function newGame() {
            round = 1;
            pot = 4;
            isPlayerTurn = true;
            gameActive = true;
            document.getElementById('gameOverDisplay').innerHTML = '';
            updateUI();
        }

        function runSimulation() {
            for (let i = 0; i < 20; i++) {
                let simRound = 1;
                let simPot = 4;
                let p1Turn = true;

                while (simRound <= MAX_ROUNDS) {
                    // Both use probabilistic strategies
                    const passProb = Math.max(0.2, 1 - (simRound / MAX_ROUNDS) * 0.6);
                    const willPass = Math.random() < passProb;

                    if (!willPass || simRound === MAX_ROUNDS) {
                        // Someone takes
                        const p1Payoff = p1Turn ? Math.floor(simPot / 4) : 0;
                        const p2Payoff = p1Turn ? 0 : Math.floor(simPot / 2);

                        sessionStats.games++;
                        sessionStats.totalRounds += simRound;
                        sessionStats.totalPayoff += (p1Payoff + p2Payoff);
                        if (simRound >= MAX_ROUNDS) sessionStats.finalReached++;
                        break;
                    }

                    simRound++;
                    simPot *= 2;
                    p1Turn = !p1Turn;
                }
            }

            updateSessionStats();
        }

        function drawGame() {
            ctx.fillStyle = '#0a0e1a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw game tree
            const margin = 40;
            const nodeRadius = 25;
            const levelHeight = 40;

            ctx.fillStyle = '#64b5f6';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Centipede Game Tree', canvas.width / 2, 20);

            // Draw rounds
            for (let r = 1; r <= MAX_ROUNDS; r++) {
                const x = margin + (r - 1) * (canvas.width - margin * 2) / (MAX_ROUNDS - 1);
                const y = 60 + (r - 1) * levelHeight;

                // Node
                const isCurrentRound = r === round && gameActive;
                const isPastRound = r < round;

                ctx.fillStyle = isCurrentRound ? '#ffd54f' : (isPastRound ? '#4caf50' : '#2a3f5f');
                ctx.beginPath();
                ctx.arc(x, y, nodeRadius, 0, Math.PI * 2);
                ctx.fill();

                // Label
                ctx.fillStyle = isCurrentRound ? '#000' : '#fff';
                ctx.font = 'bold 12px Arial';
                ctx.fillText('R' + r, x, y - 8);

                const roundPot = 4 * Math.pow(2, r - 1);
                ctx.font = '11px Arial';
                ctx.fillText('$' + roundPot, x, y + 6);

                // Connection to next
                if (r < MAX_ROUNDS) {
                    const nextX = margin + r * (canvas.width - margin * 2) / (MAX_ROUNDS - 1);
                    const nextY = 60 + r * levelHeight;

                    ctx.strokeStyle = isPastRound ? '#4caf50' : '#2a3f5f';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(x + nodeRadius, y);
                    ctx.lineTo(nextX - nodeRadius, nextY);
                    ctx.stroke();
                }

                // Player indicator
                const player = r % 2 === 1 ? 'You' : 'AI';
                ctx.fillStyle = '#b0b0b0';
                ctx.font = '10px Arial';
                ctx.fillText(player, x, y + 45);
            }

            // Draw current pot highlight
            if (gameActive && round <= MAX_ROUNDS) {
                const x = margin + (round - 1) * (canvas.width - margin * 2) / (MAX_ROUNDS - 1);
                const y = 60 + (round - 1) * levelHeight;

                ctx.strokeStyle = '#ffd54f';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(x, y, nodeRadius + 5, 0, Math.PI * 2);
                ctx.stroke();
            }
        }

        window.playerAction = playerAction;
        window.newGame = newGame;
        window.runSimulation = runSimulation;

        // Initialize
        updateUI();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
