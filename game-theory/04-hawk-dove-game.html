<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hawk-Dove Game | Game Theory</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 10px; color: #4fc3f7; }
        .subtitle { text-align: center; color: #888; margin-bottom: 20px; }

        .controls {
            display: flex; gap: 15px; flex-wrap: wrap;
            justify-content: center; margin-bottom: 20px; align-items: center;
        }
        button {
            padding: 10px 20px; border: none; border-radius: 8px;
            background: #4fc3f7; color: #1a1a2e; font-weight: bold;
            cursor: pointer; transition: all 0.3s;
        }
        button:hover { background: #81d4fa; }
        label { display: flex; align-items: center; gap: 8px; }
        input[type="range"] { width: 100px; }

        .main-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 20px;
        }
        @media (max-width: 900px) { .main-grid { grid-template-columns: 1fr; } }

        .panel {
            background: rgba(255,255,255,0.05);
            border-radius: 15px; padding: 20px;
            border: 1px solid rgba(79, 195, 247, 0.2);
        }
        .panel h2 { color: #4fc3f7; margin-bottom: 15px; font-size: 1.1em; }

        .payoff-matrix {
            display: grid; grid-template-columns: auto 1fr 1fr; gap: 3px;
            margin-bottom: 20px;
        }
        .payoff-cell {
            padding: 15px; text-align: center;
            background: rgba(79, 195, 247, 0.1);
            border-radius: 5px;
        }
        .payoff-cell.header {
            background: rgba(79, 195, 247, 0.25);
            font-weight: bold;
        }
        .payoff-cell.hawk { color: #f44336; }
        .payoff-cell.dove { color: #4caf50; }

        .population-display {
            display: flex; justify-content: space-around;
            margin: 20px 0;
        }
        .pop-item {
            text-align: center;
        }
        .pop-count {
            font-size: 3em; font-weight: bold;
        }
        .hawk-color { color: #f44336; }
        .dove-color { color: #4caf50; }

        .bar-chart {
            height: 40px; display: flex;
            border-radius: 10px; overflow: hidden;
            margin: 15px 0;
        }
        .bar-hawk {
            background: linear-gradient(90deg, #f44336, #d32f2f);
            transition: width 0.3s;
        }
        .bar-dove {
            background: linear-gradient(90deg, #4caf50, #388e3c);
            transition: width 0.3s;
        }

        canvas { width: 100%; border-radius: 10px; }

        .encounter-display {
            display: flex; justify-content: center; align-items: center;
            gap: 30px; padding: 20px;
            background: rgba(0,0,0,0.2); border-radius: 10px;
            margin: 15px 0;
        }
        .encounter-player {
            text-align: center;
        }
        .encounter-icon {
            font-size: 4em;
        }
        .encounter-result {
            text-align: center; padding: 10px;
            background: rgba(79, 195, 247, 0.1);
            border-radius: 8px; margin-top: 10px;
        }

        .param-display {
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
            margin-bottom: 15px;
        }
        .param-item {
            background: rgba(0,0,0,0.2);
            padding: 10px; border-radius: 8px;
            text-align: center;
        }
        .param-value { font-size: 1.5em; font-weight: bold; color: #4fc3f7; }
        .param-label { font-size: 0.8em; color: #888; }

        a.back-link {
            display: inline-block; margin-bottom: 20px;
            color: #4fc3f7; text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê Back to Game Theory</a>
        <h1>Hawk-Dove Game</h1>
        <p class="subtitle">Evolutionary game theory: aggression vs. sharing</p>

        <div class="controls">
            <button id="startBtn">Start Evolution</button>
            <button id="stepBtn">Single Step</button>
            <button id="resetBtn">Reset</button>
            <label>
                V (Resource):
                <input type="range" id="valueV" min="1" max="10" value="4">
                <span id="vDisplay">4</span>
            </label>
            <label>
                C (Fight Cost):
                <input type="range" id="costC" min="1" max="20" value="10">
                <span id="cDisplay">10</span>
            </label>
            <label>
                Population:
                <input type="range" id="popSize" min="50" max="500" step="50" value="200">
                <span id="popDisplay">200</span>
            </label>
        </div>

        <div class="main-grid">
            <div class="panel">
                <h2>Payoff Matrix</h2>
                <div class="payoff-matrix">
                    <div class="payoff-cell header"></div>
                    <div class="payoff-cell header hawk">Hawk</div>
                    <div class="payoff-cell header dove">Dove</div>
                    <div class="payoff-cell header hawk">Hawk</div>
                    <div class="payoff-cell" id="payoffHH">(V-C)/2, (V-C)/2</div>
                    <div class="payoff-cell" id="payoffHD">V, 0</div>
                    <div class="payoff-cell header dove">Dove</div>
                    <div class="payoff-cell" id="payoffDH">0, V</div>
                    <div class="payoff-cell" id="payoffDD">V/2, V/2</div>
                </div>

                <div class="param-display">
                    <div class="param-item">
                        <div class="param-value" id="essHawk">0%</div>
                        <div class="param-label">ESS Hawk %</div>
                    </div>
                    <div class="param-item">
                        <div class="param-value" id="essDove">0%</div>
                        <div class="param-label">ESS Dove %</div>
                    </div>
                </div>

                <h2>Current Population</h2>
                <div class="population-display">
                    <div class="pop-item">
                        <div class="pop-count hawk-color" id="hawkCount">0</div>
                        <div>Hawks ü¶Ö</div>
                    </div>
                    <div class="pop-item">
                        <div class="pop-count dove-color" id="doveCount">0</div>
                        <div>Doves üïäÔ∏è</div>
                    </div>
                </div>

                <div class="bar-chart">
                    <div class="bar-hawk" id="barHawk" style="width:50%;"></div>
                    <div class="bar-dove" id="barDove" style="width:50%;"></div>
                </div>

                <h2>Last Encounter</h2>
                <div class="encounter-display">
                    <div class="encounter-player">
                        <div class="encounter-icon" id="player1Icon">ü¶Ö</div>
                        <div id="player1Type">Hawk</div>
                    </div>
                    <div style="font-size:2em;">VS</div>
                    <div class="encounter-player">
                        <div class="encounter-icon" id="player2Icon">üïäÔ∏è</div>
                        <div id="player2Type">Dove</div>
                    </div>
                </div>
                <div class="encounter-result" id="encounterResult">
                    Player 1: +0 | Player 2: +0
                </div>
            </div>

            <div class="panel">
                <h2>Population Dynamics</h2>
                <canvas id="dynamicsChart" height="250"></canvas>

                <h2 style="margin-top:20px;">Fitness Distribution</h2>
                <canvas id="fitnessChart" height="150"></canvas>

                <h2 style="margin-top:20px;">Generation: <span id="generation">0</span></h2>
                <div style="margin-top:10px; font-size:0.85em; color:#aaa; line-height:1.6;">
                    <strong>Hawk vs Hawk:</strong> Both fight. Each gets (V-C)/2. If C>V, both lose.<br>
                    <strong>Hawk vs Dove:</strong> Hawk takes all (V). Dove retreats (0).<br>
                    <strong>Dove vs Dove:</strong> Share resource. Each gets V/2.<br><br>
                    <strong>ESS (Evolutionarily Stable Strategy):</strong> When V < C, the ESS is a mixed population with Hawk frequency = V/C.
                </div>
            </div>
        </div>
    </div>

    <script>
        const dynamicsCanvas = document.getElementById('dynamicsChart');
        const dynamicsCtx = dynamicsCanvas.getContext('2d');
        const fitnessCanvas = document.getElementById('fitnessChart');
        const fitnessCtx = fitnessCanvas.getContext('2d');

        let population = [];
        let generation = 0;
        let history = [];
        let running = false;
        let animationId = null;

        let V = 4;  // Value of resource
        let C = 10; // Cost of fighting

        function getPayoff(type1, type2) {
            if (type1 === 'hawk' && type2 === 'hawk') {
                return (V - C) / 2;
            } else if (type1 === 'hawk' && type2 === 'dove') {
                return V;
            } else if (type1 === 'dove' && type2 === 'hawk') {
                return 0;
            } else {
                return V / 2;
            }
        }

        function updatePayoffMatrix() {
            const hh = ((V - C) / 2).toFixed(1);
            document.getElementById('payoffHH').textContent = `${hh}, ${hh}`;
            document.getElementById('payoffHD').textContent = `${V}, 0`;
            document.getElementById('payoffDH').textContent = `0, ${V}`;
            document.getElementById('payoffDD').textContent = `${V/2}, ${V/2}`;

            // Calculate ESS
            let essHawk, essDove;
            if (V >= C) {
                essHawk = 100;
                essDove = 0;
            } else {
                essHawk = (V / C) * 100;
                essDove = 100 - essHawk;
            }
            document.getElementById('essHawk').textContent = essHawk.toFixed(0) + '%';
            document.getElementById('essDove').textContent = essDove.toFixed(0) + '%';
        }

        function initPopulation() {
            const size = parseInt(document.getElementById('popSize').value);
            population = [];
            generation = 0;
            history = [];

            // Start with 50-50 split
            for (let i = 0; i < size; i++) {
                population.push({
                    type: i < size / 2 ? 'hawk' : 'dove',
                    fitness: 0
                });
            }

            updateDisplay();
            updatePayoffMatrix();
        }

        function runGeneration() {
            const n = population.length;

            // Reset fitness
            for (const p of population) {
                p.fitness = 0;
            }

            // Random encounters
            const encounters = Math.floor(n * 2);
            let lastEncounter = null;

            for (let i = 0; i < encounters; i++) {
                const idx1 = Math.floor(Math.random() * n);
                let idx2 = Math.floor(Math.random() * n);
                while (idx2 === idx1) idx2 = Math.floor(Math.random() * n);

                const p1 = population[idx1];
                const p2 = population[idx2];

                const payoff1 = getPayoff(p1.type, p2.type);
                const payoff2 = getPayoff(p2.type, p1.type);

                p1.fitness += payoff1;
                p2.fitness += payoff2;

                lastEncounter = { p1, p2, payoff1, payoff2 };
            }

            // Update encounter display
            if (lastEncounter) {
                document.getElementById('player1Icon').textContent = lastEncounter.p1.type === 'hawk' ? 'ü¶Ö' : 'üïäÔ∏è';
                document.getElementById('player2Icon').textContent = lastEncounter.p2.type === 'hawk' ? 'ü¶Ö' : 'üïäÔ∏è';
                document.getElementById('player1Type').textContent = lastEncounter.p1.type.charAt(0).toUpperCase() + lastEncounter.p1.type.slice(1);
                document.getElementById('player2Type').textContent = lastEncounter.p2.type.charAt(0).toUpperCase() + lastEncounter.p2.type.slice(1);
                document.getElementById('encounterResult').textContent =
                    `Player 1: ${lastEncounter.payoff1 >= 0 ? '+' : ''}${lastEncounter.payoff1.toFixed(1)} | Player 2: ${lastEncounter.payoff2 >= 0 ? '+' : ''}${lastEncounter.payoff2.toFixed(1)}`;
            }

            // Selection - reproduce based on fitness
            const minFitness = Math.min(...population.map(p => p.fitness));
            const adjustedFitness = population.map(p => p.fitness - minFitness + 1);
            const totalFitness = adjustedFitness.reduce((a, b) => a + b, 0);

            const newPopulation = [];
            for (let i = 0; i < n; i++) {
                // Roulette wheel selection
                let r = Math.random() * totalFitness;
                let sum = 0;
                for (let j = 0; j < n; j++) {
                    sum += adjustedFitness[j];
                    if (sum >= r) {
                        // Small mutation chance
                        let type = population[j].type;
                        if (Math.random() < 0.01) {
                            type = type === 'hawk' ? 'dove' : 'hawk';
                        }
                        newPopulation.push({ type, fitness: 0 });
                        break;
                    }
                }
            }

            population = newPopulation;
            generation++;

            // Record history
            const hawkCount = population.filter(p => p.type === 'hawk').length;
            history.push(hawkCount / n);
            if (history.length > 200) history.shift();

            updateDisplay();
        }

        function updateDisplay() {
            const n = population.length;
            const hawkCount = population.filter(p => p.type === 'hawk').length;
            const doveCount = n - hawkCount;

            document.getElementById('hawkCount').textContent = hawkCount;
            document.getElementById('doveCount').textContent = doveCount;
            document.getElementById('generation').textContent = generation;

            const hawkPct = (hawkCount / n) * 100;
            document.getElementById('barHawk').style.width = hawkPct + '%';
            document.getElementById('barDove').style.width = (100 - hawkPct) + '%';

            drawCharts();
        }

        function drawCharts() {
            // Dynamics chart
            const w1 = dynamicsCanvas.width = dynamicsCanvas.offsetWidth * 2;
            const h1 = dynamicsCanvas.height = 250 * 2;
            dynamicsCtx.scale(2, 2);

            const cw1 = dynamicsCanvas.offsetWidth;
            const ch1 = 250;

            dynamicsCtx.fillStyle = 'rgba(0,0,0,0.2)';
            dynamicsCtx.fillRect(0, 0, cw1, ch1);

            // ESS line
            const essHawk = V >= C ? 1 : V / C;
            dynamicsCtx.strokeStyle = 'rgba(255,255,255,0.3)';
            dynamicsCtx.setLineDash([5, 5]);
            dynamicsCtx.beginPath();
            const essY = ch1 - essHawk * (ch1 - 40) - 20;
            dynamicsCtx.moveTo(0, essY);
            dynamicsCtx.lineTo(cw1, essY);
            dynamicsCtx.stroke();
            dynamicsCtx.setLineDash([]);

            dynamicsCtx.fillStyle = 'rgba(255,255,255,0.5)';
            dynamicsCtx.font = '10px sans-serif';
            dynamicsCtx.fillText('ESS', 5, essY - 5);

            if (history.length > 1) {
                // Hawk population line
                dynamicsCtx.strokeStyle = '#f44336';
                dynamicsCtx.lineWidth = 2;
                dynamicsCtx.beginPath();
                for (let i = 0; i < history.length; i++) {
                    const x = (i / (history.length - 1)) * cw1;
                    const y = ch1 - history[i] * (ch1 - 40) - 20;
                    if (i === 0) dynamicsCtx.moveTo(x, y);
                    else dynamicsCtx.lineTo(x, y);
                }
                dynamicsCtx.stroke();

                // Dove population line
                dynamicsCtx.strokeStyle = '#4caf50';
                dynamicsCtx.beginPath();
                for (let i = 0; i < history.length; i++) {
                    const x = (i / (history.length - 1)) * cw1;
                    const y = ch1 - (1 - history[i]) * (ch1 - 40) - 20;
                    if (i === 0) dynamicsCtx.moveTo(x, y);
                    else dynamicsCtx.lineTo(x, y);
                }
                dynamicsCtx.stroke();
            }

            // Labels
            dynamicsCtx.fillStyle = '#f44336';
            dynamicsCtx.fillText('Hawk %', 5, 15);
            dynamicsCtx.fillStyle = '#4caf50';
            dynamicsCtx.fillText('Dove %', 60, 15);

            // Fitness distribution
            const w2 = fitnessCanvas.width = fitnessCanvas.offsetWidth * 2;
            const h2 = fitnessCanvas.height = 150 * 2;
            fitnessCtx.scale(2, 2);

            const cw2 = fitnessCanvas.offsetWidth;
            const ch2 = 150;

            fitnessCtx.fillStyle = 'rgba(0,0,0,0.2)';
            fitnessCtx.fillRect(0, 0, cw2, ch2);

            const hawks = population.filter(p => p.type === 'hawk');
            const doves = population.filter(p => p.type === 'dove');

            const hawkAvg = hawks.length > 0 ? hawks.reduce((s, p) => s + p.fitness, 0) / hawks.length : 0;
            const doveAvg = doves.length > 0 ? doves.reduce((s, p) => s + p.fitness, 0) / doves.length : 0;

            const maxFit = Math.max(hawkAvg, doveAvg, 1);

            // Bars
            const barWidth = 60;
            const hawkHeight = (hawkAvg / maxFit) * (ch2 - 40);
            const doveHeight = (doveAvg / maxFit) * (ch2 - 40);

            fitnessCtx.fillStyle = '#f44336';
            fitnessCtx.fillRect(cw2/2 - barWidth - 20, ch2 - hawkHeight - 20, barWidth, hawkHeight);

            fitnessCtx.fillStyle = '#4caf50';
            fitnessCtx.fillRect(cw2/2 + 20, ch2 - doveHeight - 20, barWidth, doveHeight);

            // Labels
            fitnessCtx.fillStyle = '#e0e0e0';
            fitnessCtx.font = '12px sans-serif';
            fitnessCtx.textAlign = 'center';
            fitnessCtx.fillText('Hawk', cw2/2 - barWidth/2 - 20, ch2 - 5);
            fitnessCtx.fillText('Dove', cw2/2 + barWidth/2 + 20, ch2 - 5);
            fitnessCtx.fillText(hawkAvg.toFixed(1), cw2/2 - barWidth/2 - 20, ch2 - hawkHeight - 25);
            fitnessCtx.fillText(doveAvg.toFixed(1), cw2/2 + barWidth/2 + 20, ch2 - doveHeight - 25);
        }

        function animate() {
            if (!running) return;
            runGeneration();
            setTimeout(() => {
                animationId = requestAnimationFrame(animate);
            }, 100);
        }

        // Event listeners
        document.getElementById('startBtn').onclick = () => {
            running = !running;
            document.getElementById('startBtn').textContent = running ? 'Pause' : 'Start Evolution';
            if (running) animate();
        };

        document.getElementById('stepBtn').onclick = () => {
            if (!running) runGeneration();
        };

        document.getElementById('resetBtn').onclick = initPopulation;

        document.getElementById('valueV').oninput = (e) => {
            V = parseInt(e.target.value);
            document.getElementById('vDisplay').textContent = V;
            updatePayoffMatrix();
        };

        document.getElementById('costC').oninput = (e) => {
            C = parseInt(e.target.value);
            document.getElementById('cDisplay').textContent = C;
            updatePayoffMatrix();
        };

        document.getElementById('popSize').oninput = (e) => {
            document.getElementById('popDisplay').textContent = e.target.value;
        };

        // Initialize
        initPopulation();
    </script>
</body>
</html>
