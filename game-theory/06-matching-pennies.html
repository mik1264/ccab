<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matching Pennies - Game Theory</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0e1a;
            color: #e0e0e0;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .back-link {
            display: inline-block;
            color: #64b5f6;
            text-decoration: none;
            margin-bottom: 20px;
            font-size: 16px;
            transition: color 0.3s;
        }

        .back-link:hover {
            color: #90caf9;
        }

        h1 {
            color: #fff;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .description {
            color: #b0b0b0;
            margin-bottom: 30px;
            line-height: 1.6;
            max-width: 800px;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
            margin-bottom: 20px;
        }

        .canvas-container {
            background: #151b2b;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #2a3f5f;
        }

        canvas {
            display: block;
            width: 100%;
            background: #0a0e1a;
            border-radius: 5px;
        }

        .controls-panel {
            background: #151b2b;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #2a3f5f;
        }

        .payoff-matrix {
            background: #0f1520;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .payoff-matrix h3 {
            color: #64b5f6;
            margin-bottom: 10px;
            font-size: 14px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 10px;
            text-align: center;
            border: 1px solid #2a3f5f;
        }

        th {
            background: #1a2332;
            color: #90caf9;
            font-weight: 600;
        }

        td {
            background: #151b2b;
            color: #e0e0e0;
        }

        .coin-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .coin-btn {
            flex: 1;
            padding: 30px 20px;
            background: #1a2332;
            border: 3px solid #2a3f5f;
            border-radius: 50%;
            color: #e0e0e0;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 48px;
            text-align: center;
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .coin-btn:hover {
            border-color: #64b5f6;
            transform: scale(1.05);
        }

        .coin-btn.heads {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #333;
        }

        .coin-btn.tails {
            background: linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 100%);
            color: #333;
        }

        button {
            width: 100%;
            padding: 12px;
            background: #1976d2;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background 0.3s;
            margin-bottom: 10px;
        }

        button:hover {
            background: #1565c0;
        }

        .result-display {
            background: #0f1520;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }

        .result-display h3 {
            color: #64b5f6;
            margin-bottom: 10px;
        }

        .coin-reveal {
            display: flex;
            justify-content: space-around;
            margin: 15px 0;
        }

        .coin-display {
            text-align: center;
        }

        .coin-display .coin {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            margin: 0 auto 10px;
        }

        .coin-display .coin.heads {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #333;
        }

        .coin-display .coin.tails {
            background: linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 100%);
            color: #333;
        }

        .result-outcome {
            font-size: 1.5em;
            font-weight: bold;
            margin: 10px 0;
        }

        .result-outcome.win {
            color: #4caf50;
        }

        .result-outcome.lose {
            color: #e57373;
        }

        .stats-box {
            background: #0f1520;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .stats-box h3 {
            color: #64b5f6;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #2a3f5f;
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #b0b0b0;
        }

        .stat-value {
            color: #81c784;
            font-weight: 600;
        }

        .info-box {
            background: #1a2332;
            border-left: 4px solid #64b5f6;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
        }

        .info-box h3 {
            color: #64b5f6;
            margin-bottom: 10px;
        }

        .info-box p {
            line-height: 1.6;
            color: #b0b0b0;
            margin-bottom: 8px;
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">← Back to Game Theory</a>

        <h1>Matching Pennies</h1>
        <p class="description">
            A classic zero-sum game with no pure strategy Nash equilibrium. You win if the coins match,
            your opponent wins if they don't. Both players must randomize to achieve equilibrium.
        </p>

        <div class="main-grid">
            <div class="canvas-container">
                <canvas id="canvas"></canvas>
            </div>

            <div class="controls-panel">
                <div class="payoff-matrix">
                    <h3>Payoff Matrix (You are Row Player)</h3>
                    <table>
                        <tr>
                            <th></th>
                            <th>H</th>
                            <th>T</th>
                        </tr>
                        <tr>
                            <th>H</th>
                            <td style="background: #2e7d32; color: #fff;">+1, -1</td>
                            <td style="background: #c62828; color: #fff;">-1, +1</td>
                        </tr>
                        <tr>
                            <th>T</th>
                            <td style="background: #c62828; color: #fff;">-1, +1</td>
                            <td style="background: #2e7d32; color: #fff;">+1, -1</td>
                        </tr>
                    </table>
                    <p style="margin-top: 10px; font-size: 12px; color: #b0b0b0; text-align: center;">
                        Mixed Strategy Equilibrium: 50% H, 50% T
                    </p>
                </div>

                <div class="coin-buttons">
                    <button class="coin-btn heads" onclick="playRound('H')">H</button>
                    <button class="coin-btn tails" onclick="playRound('T')">T</button>
                </div>

                <div id="resultDisplay"></div>

                <button onclick="runSimulation()">Run AI Simulation (100 rounds)</button>
                <button onclick="reset()">Reset</button>

                <div class="stats-box">
                    <h3>Game Statistics</h3>
                    <div class="stat-row">
                        <span class="stat-label">Rounds Played</span>
                        <span class="stat-value" id="roundsPlayed">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Your Wins</span>
                        <span class="stat-value" id="playerWins">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Opponent Wins</span>
                        <span class="stat-value" id="opponentWins">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Your Score</span>
                        <span class="stat-value" id="playerScore">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Your H%</span>
                        <span class="stat-value" id="playerHPercent">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Opponent H%</span>
                        <span class="stat-value" id="opponentHPercent">-</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="info-box">
            <h3>About Matching Pennies</h3>
            <p><strong>The Game:</strong> Two players simultaneously choose Heads or Tails. If the choices match, you win. If they don't match, your opponent wins.</p>
            <p><strong>Zero-Sum:</strong> Your gain is exactly your opponent's loss. The sum of payoffs is always zero.</p>
            <p><strong>No Pure Strategy Equilibrium:</strong> If your opponent thinks you'll play H, they should play T. But then you should play T too. But then they should play H... There's no stable pure strategy.</p>
            <p><strong>Mixed Strategy Nash Equilibrium:</strong> Both players randomize 50-50 between H and T. This makes the opponent indifferent to their choice, and neither player can gain by deviating.</p>
            <p><strong>Von Neumann's Minimax Theorem:</strong> This game demonstrates that in zero-sum games, players should randomize to guarantee the best worst-case outcome.</p>
            <p><strong>Real Applications:</strong> Penalty kicks in soccer, tennis serves, poker bluffing, military strategy - any situation where unpredictability is advantageous.</p>
            <p><strong>Try it:</strong> Can you beat the AI? Or will both of you converge to 50-50 randomization?</p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth - 40;
            canvas.height = 500;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Game state
        let history = [];
        let stats = {
            rounds: 0,
            playerWins: 0,
            opponentWins: 0,
            playerScore: 0,
            playerHeads: 0,
            opponentHeads: 0
        };

        // AI uses adaptive strategy
        let aiStrategy = 0.5; // Start at 50-50

        function playRound(playerChoice) {
            // AI chooses based on adaptive strategy (tries to exploit patterns)
            const opponentChoice = Math.random() < aiStrategy ? 'H' : 'T';

            // Determine winner
            const match = playerChoice === opponentChoice;
            const playerPayoff = match ? 1 : -1;

            // Update stats
            stats.rounds++;
            stats.playerScore += playerPayoff;
            if (match) stats.playerWins++;
            else stats.opponentWins++;

            if (playerChoice === 'H') stats.playerHeads++;
            if (opponentChoice === 'H') stats.opponentHeads++;

            // AI adapts: if player plays H a lot, AI should play T
            const playerHRate = stats.playerHeads / stats.rounds;
            // AI wants to mismatch, so play opposite of player's tendency
            aiStrategy = 1 - playerHRate + (Math.random() - 0.5) * 0.2; // Add some noise
            aiStrategy = Math.max(0.2, Math.min(0.8, aiStrategy));

            // Store history
            history.push({
                player: playerChoice,
                opponent: opponentChoice,
                match: match,
                playerPayoff: playerPayoff
            });

            if (history.length > 100) history.shift();

            // Display result
            showResult(playerChoice, opponentChoice, match, playerPayoff);
            updateStats();
            draw();
        }

        function showResult(player, opponent, match, payoff) {
            const resultDiv = document.getElementById('resultDisplay');

            resultDiv.innerHTML = `
                <div class="result-display">
                    <h3>Round Result</h3>
                    <div class="coin-reveal">
                        <div class="coin-display">
                            <div class="coin ${player === 'H' ? 'heads' : 'tails'}">${player}</div>
                            <div>You</div>
                        </div>
                        <div class="coin-display">
                            <div class="coin ${opponent === 'H' ? 'heads' : 'tails'}">${opponent}</div>
                            <div>Opponent</div>
                        </div>
                    </div>
                    <div class="result-outcome ${payoff > 0 ? 'win' : 'lose'}">
                        ${match ? '✓ Match! You Win +1' : '✗ No Match! You Lose -1'}
                    </div>
                </div>
            `;
        }

        function runSimulation() {
            // Reset AI strategy
            aiStrategy = 0.5;

            for (let i = 0; i < 100; i++) {
                // Both players use mixed strategy close to equilibrium
                const playerChoice = Math.random() < 0.5 ? 'H' : 'T';
                const opponentChoice = Math.random() < 0.5 ? 'H' : 'T';

                const match = playerChoice === opponentChoice;
                const playerPayoff = match ? 1 : -1;

                stats.rounds++;
                stats.playerScore += playerPayoff;
                if (match) stats.playerWins++;
                else stats.opponentWins++;

                if (playerChoice === 'H') stats.playerHeads++;
                if (opponentChoice === 'H') stats.opponentHeads++;

                history.push({
                    player: playerChoice,
                    opponent: opponentChoice,
                    match: match,
                    playerPayoff: playerPayoff
                });
            }

            while (history.length > 100) history.shift();

            updateStats();
            draw();
        }

        function updateStats() {
            document.getElementById('roundsPlayed').textContent = stats.rounds;
            document.getElementById('playerWins').textContent = stats.playerWins;
            document.getElementById('opponentWins').textContent = stats.opponentWins;
            document.getElementById('playerScore').textContent = stats.playerScore > 0 ? '+' + stats.playerScore : stats.playerScore;

            const playerHPct = stats.rounds > 0 ? ((stats.playerHeads / stats.rounds) * 100).toFixed(1) : '-';
            const opponentHPct = stats.rounds > 0 ? ((stats.opponentHeads / stats.rounds) * 100).toFixed(1) : '-';

            document.getElementById('playerHPercent').textContent = playerHPct + (playerHPct !== '-' ? '%' : '');
            document.getElementById('opponentHPercent').textContent = opponentHPct + (opponentHPct !== '-' ? '%' : '');
        }

        function reset() {
            history = [];
            stats = {
                rounds: 0,
                playerWins: 0,
                opponentWins: 0,
                playerScore: 0,
                playerHeads: 0,
                opponentHeads: 0
            };
            aiStrategy = 0.5;
            document.getElementById('resultDisplay').innerHTML = '';
            updateStats();
            draw();
        }

        function draw() {
            ctx.fillStyle = '#0a0e1a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            if (history.length === 0) {
                ctx.fillStyle = '#64b5f6';
                ctx.font = '20px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Choose Heads or Tails to play', canvas.width / 2, canvas.height / 2);
                return;
            }

            // Draw cumulative score over time
            const margin = 60;
            const graphHeight = 200;
            const graphY = 50;

            ctx.fillStyle = '#64b5f6';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Your Cumulative Score Over Time', canvas.width / 2, 30);

            // Axes
            ctx.strokeStyle = '#2a3f5f';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(margin, graphY + graphHeight / 2);
            ctx.lineTo(canvas.width - margin, graphY + graphHeight / 2);
            ctx.stroke();

            // Calculate cumulative scores
            let cumulative = 0;
            const cumulativeScores = history.map(h => {
                cumulative += h.playerPayoff;
                return cumulative;
            });

            const maxAbs = Math.max(Math.abs(Math.max(...cumulativeScores)), Math.abs(Math.min(...cumulativeScores)), 5);

            // Draw score line
            if (history.length > 1) {
                const xStep = (canvas.width - margin * 2) / (history.length - 1);

                ctx.strokeStyle = '#4fc3f7';
                ctx.lineWidth = 3;
                ctx.beginPath();

                cumulativeScores.forEach((score, i) => {
                    const x = margin + i * xStep;
                    const y = graphY + graphHeight / 2 - (score / maxAbs) * (graphHeight / 2 - 20);

                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                });
                ctx.stroke();

                // Draw points
                ctx.fillStyle = '#4fc3f7';
                cumulativeScores.forEach((score, i) => {
                    const x = margin + i * xStep;
                    const y = graphY + graphHeight / 2 - (score / maxAbs) * (graphHeight / 2 - 20);
                    ctx.beginPath();
                    ctx.arc(x, y, 3, 0, Math.PI * 2);
                    ctx.fill();
                });
            }

            // Y-axis labels
            ctx.fillStyle = '#b0b0b0';
            ctx.font = '12px Arial';
            ctx.textAlign = 'right';
            ctx.fillText('+' + Math.round(maxAbs), margin - 10, graphY + 20);
            ctx.fillText('0', margin - 10, graphY + graphHeight / 2 + 4);
            ctx.fillText('-' + Math.round(maxAbs), margin - 10, graphY + graphHeight - 10);

            // Draw choice pattern visualization
            const patternY = graphY + graphHeight + 80;
            ctx.fillStyle = '#64b5f6';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Recent Choice Pattern (Last 50)', canvas.width / 2, patternY - 20);

            const displayHistory = history.slice(-50);
            const cellWidth = (canvas.width - margin * 2) / 50;

            displayHistory.forEach((h, i) => {
                const x = margin + i * cellWidth;

                // Player choice
                ctx.fillStyle = h.player === 'H' ? '#ffd700' : '#c0c0c0';
                ctx.fillRect(x, patternY, cellWidth - 1, 15);

                // Opponent choice
                ctx.fillStyle = h.opponent === 'H' ? '#ffd700' : '#c0c0c0';
                ctx.fillRect(x, patternY + 18, cellWidth - 1, 15);

                // Outcome
                ctx.fillStyle = h.match ? '#4caf50' : '#e57373';
                ctx.fillRect(x, patternY + 36, cellWidth - 1, 4);
            });

            // Legend
            ctx.fillStyle = '#e0e0e0';
            ctx.font = '11px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('You:', margin, patternY - 5);
            ctx.fillText('Opp:', margin, patternY + 13);

            ctx.fillStyle = '#ffd700';
            ctx.fillRect(margin + 40, patternY + 50, 15, 15);
            ctx.fillStyle = '#e0e0e0';
            ctx.fillText('= Heads', margin + 60, patternY + 62);

            ctx.fillStyle = '#c0c0c0';
            ctx.fillRect(margin + 140, patternY + 50, 15, 15);
            ctx.fillStyle = '#e0e0e0';
            ctx.fillText('= Tails', margin + 160, patternY + 62);

            ctx.fillStyle = '#4caf50';
            ctx.fillRect(margin + 240, patternY + 50, 15, 15);
            ctx.fillStyle = '#e0e0e0';
            ctx.fillText('= Match', margin + 260, patternY + 62);
        }

        window.playRound = playRound;
        window.runSimulation = runSimulation;
        window.reset = reset;

        draw();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
