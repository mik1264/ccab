<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stag Hunt - Game Theory</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0e1a;
            color: #e0e0e0;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .back-link {
            display: inline-block;
            color: #64b5f6;
            text-decoration: none;
            margin-bottom: 20px;
            font-size: 16px;
            transition: color 0.3s;
        }

        .back-link:hover {
            color: #90caf9;
        }

        h1 {
            color: #fff;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .description {
            color: #b0b0b0;
            margin-bottom: 30px;
            line-height: 1.6;
            max-width: 800px;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
            margin-bottom: 20px;
        }

        .canvas-container {
            background: #151b2b;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #2a3f5f;
        }

        canvas {
            display: block;
            width: 100%;
            background: #0a0e1a;
            border-radius: 5px;
        }

        .controls-panel {
            background: #151b2b;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #2a3f5f;
        }

        .payoff-matrix {
            background: #0f1520;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .payoff-matrix h3 {
            color: #64b5f6;
            margin-bottom: 10px;
            font-size: 14px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 10px;
            text-align: center;
            border: 1px solid #2a3f5f;
        }

        th {
            background: #1a2332;
            color: #90caf9;
            font-weight: 600;
        }

        td {
            background: #151b2b;
            color: #e0e0e0;
            font-size: 14px;
        }

        .nash-equilibrium {
            background: #1565c0 !important;
        }

        .choice-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .choice-btn {
            flex: 1;
            padding: 20px;
            background: #1a2332;
            border: 2px solid #2a3f5f;
            border-radius: 8px;
            color: #e0e0e0;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            text-align: center;
        }

        .choice-btn:hover {
            border-color: #64b5f6;
            background: #1e2939;
        }

        .choice-btn.stag {
            border-color: #4caf50;
        }

        .choice-btn.stag:hover {
            background: #2e7d32;
        }

        .choice-btn.hare {
            border-color: #ff9800;
        }

        .choice-btn.hare:hover {
            background: #f57c00;
        }

        .choice-btn .icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        button {
            width: 100%;
            padding: 12px;
            background: #1976d2;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background 0.3s;
            margin-bottom: 10px;
        }

        button:hover {
            background: #1565c0;
        }

        .result-display {
            background: #0f1520;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }

        .result-display h3 {
            color: #64b5f6;
            margin-bottom: 10px;
        }

        .result-outcome {
            font-size: 1.5em;
            font-weight: bold;
            margin: 10px 0;
        }

        .result-outcome.success {
            color: #4caf50;
        }

        .result-outcome.failure {
            color: #ff9800;
        }

        .stats-box {
            background: #0f1520;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .stats-box h3 {
            color: #64b5f6;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #2a3f5f;
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #b0b0b0;
        }

        .stat-value {
            color: #81c784;
            font-weight: 600;
        }

        .info-box {
            background: #1a2332;
            border-left: 4px solid #64b5f6;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
        }

        .info-box h3 {
            color: #64b5f6;
            margin-bottom: 10px;
        }

        .info-box p {
            line-height: 1.6;
            color: #b0b0b0;
            margin-bottom: 8px;
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê Back to Game Theory</a>

        <h1>Stag Hunt</h1>
        <p class="description">
            A coordination game with two Nash equilibria. Hunt stag together for a big reward, or hunt hare alone
            for a smaller but guaranteed payoff. Risk-dominance vs payoff-dominance in action.
        </p>

        <div class="main-grid">
            <div class="canvas-container">
                <canvas id="canvas"></canvas>
            </div>

            <div class="controls-panel">
                <div class="payoff-matrix">
                    <h3>Payoff Matrix (Nash Equilibria Highlighted)</h3>
                    <table>
                        <tr>
                            <th></th>
                            <th>ü¶å Stag</th>
                            <th>üêá Hare</th>
                        </tr>
                        <tr>
                            <th>ü¶å Stag</th>
                            <td class="nash-equilibrium">5, 5</td>
                            <td>0, 3</td>
                        </tr>
                        <tr>
                            <th>üêá Hare</th>
                            <td>3, 0</td>
                            <td class="nash-equilibrium">3, 3</td>
                        </tr>
                    </table>
                </div>

                <div class="choice-buttons">
                    <button class="choice-btn stag" onclick="makeChoice('stag')">
                        <div class="icon">ü¶å</div>
                        <div><strong>Hunt Stag</strong></div>
                        <div style="font-size: 0.9em; margin-top: 5px;">Risky, High Reward</div>
                    </button>
                    <button class="choice-btn hare" onclick="makeChoice('hare')">
                        <div class="icon">üêá</div>
                        <div><strong>Hunt Hare</strong></div>
                        <div style="font-size: 0.9em; margin-top: 5px;">Safe, Low Reward</div>
                    </button>
                </div>

                <div id="resultDisplay"></div>

                <button onclick="runSimulation()">Run AI Simulation (100 rounds)</button>
                <button onclick="reset()">Reset</button>

                <div class="stats-box">
                    <h3>Game Statistics</h3>
                    <div class="stat-row">
                        <span class="stat-label">Rounds Played</span>
                        <span class="stat-value" id="roundsPlayed">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Both Hunt Stag</span>
                        <span class="stat-value" id="bothStag">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Both Hunt Hare</span>
                        <span class="stat-value" id="bothHare">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Miscoordination</span>
                        <span class="stat-value" id="miscoord">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Avg Payoff</span>
                        <span class="stat-value" id="avgPayoff">0</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="info-box">
            <h3>About the Stag Hunt</h3>
            <p><strong>The Scenario:</strong> Two hunters can cooperate to hunt a stag (large reward) or hunt hare alone (smaller, guaranteed reward). Success in hunting stag requires both hunters to participate.</p>
            <p><strong>Nash Equilibria:</strong> This game has two pure strategy Nash equilibria:</p>
            <p>‚Ä¢ (Stag, Stag): Both hunt stag ‚Üí (5, 5) - <em>Payoff-dominant</em> (best outcome)</p>
            <p>‚Ä¢ (Hare, Hare): Both hunt hare ‚Üí (3, 3) - <em>Risk-dominant</em> (safer choice)</p>
            <p><strong>The Dilemma:</strong> Hunting stag gives the best payoff if both cooperate, but if your partner hunts hare, you get nothing. Hunting hare is safer - you always get 3.</p>
            <p><strong>Trust vs Safety:</strong> This models social contracts, teamwork, and coordination problems. Do you trust your partner to cooperate for the better outcome, or play it safe?</p>
            <p><strong>Real-world Applications:</strong> Technology standards adoption, business partnerships, international climate agreements, and any situation requiring mutual cooperation with asymmetric risk.</p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth - 40;
            canvas.height = 500;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Game state
        let history = [];
        let stats = {
            rounds: 0,
            bothStag: 0,
            bothHare: 0,
            miscoord: 0,
            totalPayoff: 0
        };

        // Payoff matrix
        const payoffs = {
            'stag-stag': [5, 5],
            'stag-hare': [0, 3],
            'hare-stag': [3, 0],
            'hare-hare': [3, 3]
        };

        function makeChoice(choice) {
            // AI opponent uses mixed strategy based on trust level
            const aiChoice = Math.random() > 0.4 ? 'stag' : 'hare';

            const key = `${choice}-${aiChoice}`;
            const [playerPayoff, aiPayoff] = payoffs[key];

            // Update stats
            stats.rounds++;
            stats.totalPayoff += playerPayoff;

            if (choice === 'stag' && aiChoice === 'stag') stats.bothStag++;
            else if (choice === 'hare' && aiChoice === 'hare') stats.bothHare++;
            else stats.miscoord++;

            // Store history
            history.push({
                player: choice,
                ai: aiChoice,
                playerPayoff,
                aiPayoff
            });

            if (history.length > 50) history.shift();

            // Display result
            showResult(choice, aiChoice, playerPayoff, aiPayoff);
            updateStats();
            draw();
        }

        function showResult(player, ai, playerPayoff, aiPayoff) {
            const resultDiv = document.getElementById('resultDisplay');
            const coordinated = (player === 'stag' && ai === 'stag') || (player === 'hare' && ai === 'hare');

            resultDiv.innerHTML = `
                <div class="result-display">
                    <h3>Round Result</h3>
                    <div style="display: flex; justify-content: space-around; margin: 15px 0;">
                        <div>
                            <div>You chose: ${player === 'stag' ? 'ü¶å Stag' : 'üêá Hare'}</div>
                            <div style="font-size: 1.2em; color: #64b5f6; margin-top: 5px;">+${playerPayoff} points</div>
                        </div>
                        <div>
                            <div>AI chose: ${ai === 'stag' ? 'ü¶å Stag' : 'üêá Hare'}</div>
                            <div style="font-size: 1.2em; color: #90caf9; margin-top: 5px;">+${aiPayoff} points</div>
                        </div>
                    </div>
                    <div class="result-outcome ${coordinated ? 'success' : 'failure'}">
                        ${coordinated ? '‚úì Coordination Success!' : '‚úó Miscoordination'}
                    </div>
                </div>
            `;
        }

        function runSimulation() {
            // Run 100 rounds with adaptive AI
            let trustLevel = 0.5; // AI starts neutral

            for (let i = 0; i < 100; i++) {
                // AI adapts based on recent success
                const aiChoice = Math.random() < trustLevel ? 'stag' : 'hare';
                // Simulated player uses similar adaptive strategy
                const playerChoice = Math.random() < trustLevel ? 'stag' : 'hare';

                const key = `${playerChoice}-${aiChoice}`;
                const [playerPayoff, aiPayoff] = payoffs[key];

                stats.rounds++;
                stats.totalPayoff += playerPayoff;

                if (playerChoice === 'stag' && aiChoice === 'stag') {
                    stats.bothStag++;
                    trustLevel = Math.min(0.9, trustLevel + 0.05); // Increase trust
                } else if (playerChoice === 'hare' && aiChoice === 'hare') {
                    stats.bothHare++;
                    trustLevel = Math.max(0.3, trustLevel - 0.02); // Slight decrease
                } else {
                    stats.miscoord++;
                    trustLevel = Math.max(0.1, trustLevel - 0.1); // Sharp decrease
                }

                history.push({
                    player: playerChoice,
                    ai: aiChoice,
                    playerPayoff,
                    aiPayoff
                });
            }

            // Keep only last 50
            while (history.length > 50) history.shift();

            updateStats();
            draw();
        }

        function updateStats() {
            document.getElementById('roundsPlayed').textContent = stats.rounds;
            document.getElementById('bothStag').textContent = stats.bothStag;
            document.getElementById('bothHare').textContent = stats.bothHare;
            document.getElementById('miscoord').textContent = stats.miscoord;
            document.getElementById('avgPayoff').textContent =
                stats.rounds > 0 ? (stats.totalPayoff / stats.rounds).toFixed(2) : '0';
        }

        function reset() {
            history = [];
            stats = {
                rounds: 0,
                bothStag: 0,
                bothHare: 0,
                miscoord: 0,
                totalPayoff: 0
            };
            document.getElementById('resultDisplay').innerHTML = '';
            updateStats();
            draw();
        }

        function draw() {
            ctx.fillStyle = '#0a0e1a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            if (history.length === 0) {
                ctx.fillStyle = '#64b5f6';
                ctx.font = '20px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Make a choice or run simulation to see results', canvas.width / 2, canvas.height / 2);
                return;
            }

            const margin = 60;
            const barWidth = Math.max(10, (canvas.width - margin * 2) / history.length);

            // Draw title
            ctx.fillStyle = '#64b5f6';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Choice History (Last 50 Rounds)', canvas.width / 2, 25);

            // Draw bars
            history.forEach((round, i) => {
                const x = margin + i * barWidth;
                const y = 100;

                // Determine color based on outcome
                let color;
                if (round.player === 'stag' && round.ai === 'stag') {
                    color = '#4caf50'; // Both stag - success
                } else if (round.player === 'hare' && round.ai === 'hare') {
                    color = '#ff9800'; // Both hare - safe
                } else {
                    color = '#e57373'; // Miscoordination - failure
                }

                ctx.fillStyle = color;
                ctx.fillRect(x, y, barWidth - 2, 30);

                // Player choice
                ctx.fillStyle = round.player === 'stag' ? '#64b5f6' : '#ffd54f';
                ctx.fillRect(x, y + 35, barWidth - 2, 15);

                // AI choice
                ctx.fillStyle = round.ai === 'stag' ? '#64b5f6' : '#ffd54f';
                ctx.fillRect(x, y + 52, barWidth - 2, 15);
            });

            // Legend
            const legendY = 180;
            ctx.fillStyle = '#b0b0b0';
            ctx.font = '12px Arial';
            ctx.textAlign = 'left';

            ctx.fillStyle = '#4caf50';
            ctx.fillRect(margin, legendY, 20, 20);
            ctx.fillStyle = '#e0e0e0';
            ctx.fillText('Both Hunt Stag (5, 5)', margin + 30, legendY + 14);

            ctx.fillStyle = '#ff9800';
            ctx.fillRect(margin, legendY + 30, 20, 20);
            ctx.fillStyle = '#e0e0e0';
            ctx.fillText('Both Hunt Hare (3, 3)', margin + 30, legendY + 44);

            ctx.fillStyle = '#e57373';
            ctx.fillRect(margin, legendY + 60, 20, 20);
            ctx.fillStyle = '#e0e0e0';
            ctx.fillText('Miscoordination', margin + 30, legendY + 74);

            ctx.fillStyle = '#64b5f6';
            ctx.fillRect(margin + 250, legendY, 20, 20);
            ctx.fillStyle = '#e0e0e0';
            ctx.fillText('Stag Choice', margin + 280, legendY + 14);

            ctx.fillStyle = '#ffd54f';
            ctx.fillRect(margin + 250, legendY + 30, 20, 20);
            ctx.fillStyle = '#e0e0e0';
            ctx.fillText('Hare Choice', margin + 280, legendY + 44);

            // Draw outcome distribution pie chart
            if (stats.rounds > 0) {
                const pieX = canvas.width / 2;
                const pieY = 380;
                const radius = 80;

                const stagAngle = (stats.bothStag / stats.rounds) * Math.PI * 2;
                const hareAngle = (stats.bothHare / stats.rounds) * Math.PI * 2;

                // Both stag
                ctx.fillStyle = '#4caf50';
                ctx.beginPath();
                ctx.moveTo(pieX, pieY);
                ctx.arc(pieX, pieY, radius, 0, stagAngle);
                ctx.closePath();
                ctx.fill();

                // Both hare
                ctx.fillStyle = '#ff9800';
                ctx.beginPath();
                ctx.moveTo(pieX, pieY);
                ctx.arc(pieX, pieY, radius, stagAngle, stagAngle + hareAngle);
                ctx.closePath();
                ctx.fill();

                // Miscoordination
                ctx.fillStyle = '#e57373';
                ctx.beginPath();
                ctx.moveTo(pieX, pieY);
                ctx.arc(pieX, pieY, radius, stagAngle + hareAngle, Math.PI * 2);
                ctx.closePath();
                ctx.fill();

                // Title
                ctx.fillStyle = '#64b5f6';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Outcome Distribution', pieX, 280);

                // Percentages
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 12px Arial';
                const stagPct = ((stats.bothStag / stats.rounds) * 100).toFixed(0);
                const harePct = ((stats.bothHare / stats.rounds) * 100).toFixed(0);
                const misPct = ((stats.miscoord / stats.rounds) * 100).toFixed(0);

                if (stats.bothStag > 0) {
                    const angle = stagAngle / 2;
                    const x = pieX + Math.cos(angle) * radius * 0.6;
                    const y = pieY + Math.sin(angle) * radius * 0.6;
                    ctx.fillText(stagPct + '%', x, y);
                }
            }
        }

        window.makeChoice = makeChoice;
        window.runSimulation = runSimulation;
        window.reset = reset;

        draw();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
