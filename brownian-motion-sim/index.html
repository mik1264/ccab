<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Brownian Motion Simulation</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
canvas { display: block; }
.title-overlay {
    position: fixed; top: 50px; left: 50%; transform: translateX(-50%);
    color: #fbbf24; font-size: 20px; font-weight: 600; z-index: 998;
    text-shadow: 0 0 10px rgba(251,191,36,0.5); pointer-events: none;
    font-family: 'Segoe UI', sans-serif;
}
.controls {
    position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
    display: flex; gap: 20px; align-items: center; z-index: 999;
    background: rgba(0,0,0,0.7); padding: 12px 24px; border-radius: 12px;
    border: 1px solid rgba(251,191,36,0.3);
}
.controls label { color: #ccc; font-size: 13px; }
.controls input[type=range] { width: 140px; accent-color: #fbbf24; }
.controls span { color: #fbbf24; font-size: 13px; min-width: 30px; }
.controls button {
    background: rgba(251,191,36,0.2); color: #fbbf24; border: 1px solid rgba(251,191,36,0.5);
    padding: 6px 14px; border-radius: 6px; cursor: pointer; font-size: 13px;
}
.controls button:hover { background: rgba(251,191,36,0.4); }
.stats {
    position: fixed; top: 80px; right: 20px; color: #8892a8; font-size: 12px;
    z-index: 998; text-align: right; line-height: 1.8;
}
</style>
</head>
<body>
<a href="../index.html" style="position:fixed;top:10px;left:10px;padding:8px 16px;background:rgba(0,0,0,0.7);color:#fbbf24;text-decoration:none;border-radius:6px;font-size:14px;z-index:999;font-family:sans-serif;">‚Üê Back to Gallery</a>
<div class="title-overlay">Brownian Motion Simulation</div>
<div class="stats" id="stats"></div>
<div class="controls">
    <label>Temperature: <input type="range" id="tempSlider" min="1" max="100" value="50"> <span id="tempVal">50</span></label>
    <label>Molecules: <input type="range" id="molSlider" min="50" max="500" value="200"> <span id="molVal">200</span></label>
    <button id="clearTrail">Clear Trail</button>
    <button id="resetBtn">Reset</button>
</div>
<canvas id="canvas"></canvas>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let W, H;

function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
}
resize();
window.addEventListener('resize', resize);

let temperature = 50;
let numMolecules = 200;
let trail = [];
const maxTrail = 2000;

const bigParticle = { x: 0, y: 0, vx: 0, vy: 0, r: 18, mass: 50 };
let molecules = [];

function initBigParticle() {
    bigParticle.x = W / 2;
    bigParticle.y = H / 2;
    bigParticle.vx = 0;
    bigParticle.vy = 0;
}

function createMolecules(n) {
    molecules = [];
    for (let i = 0; i < n; i++) {
        const angle = Math.random() * Math.PI * 2;
        const speed = (1 + Math.random() * 3) * (temperature / 25);
        molecules.push({
            x: Math.random() * W,
            y: Math.random() * H,
            vx: Math.cos(angle) * speed,
            vy: Math.sin(angle) * speed,
            r: 2 + Math.random() * 1.5,
            mass: 1
        });
    }
}

function init() {
    initBigParticle();
    createMolecules(numMolecules);
    trail = [];
}
init();

document.getElementById('tempSlider').addEventListener('input', function() {
    temperature = +this.value;
    document.getElementById('tempVal').textContent = this.value;
    molecules.forEach(m => {
        const angle = Math.atan2(m.vy, m.vx);
        const speed = (1 + Math.random() * 3) * (temperature / 25);
        m.vx = Math.cos(angle) * speed;
        m.vy = Math.sin(angle) * speed;
    });
});

document.getElementById('molSlider').addEventListener('input', function() {
    numMolecules = +this.value;
    document.getElementById('molVal').textContent = this.value;
    createMolecules(numMolecules);
});

document.getElementById('clearTrail').addEventListener('click', () => { trail = []; });
document.getElementById('resetBtn').addEventListener('click', init);

function dist(a, b) {
    return Math.sqrt((a.x - b.x) ** 2 + (a.y - b.y) ** 2);
}

function collide(a, b) {
    const dx = b.x - a.x;
    const dy = b.y - a.y;
    const d = Math.sqrt(dx * dx + dy * dy);
    if (d < a.r + b.r && d > 0) {
        const nx = dx / d;
        const ny = dy / d;
        const dvx = a.vx - b.vx;
        const dvy = a.vy - b.vy;
        const dvn = dvx * nx + dvy * ny;
        if (dvn > 0) {
            const m = 2 / (a.mass + b.mass);
            a.vx -= m * b.mass * dvn * nx;
            a.vy -= m * b.mass * dvn * ny;
            b.vx += m * a.mass * dvn * nx;
            b.vy += m * a.mass * dvn * ny;
            const overlap = (a.r + b.r - d) / 2;
            a.x -= overlap * nx;
            a.y -= overlap * ny;
            b.x += overlap * nx;
            b.y += overlap * ny;
        }
    }
}

function update() {
    // Update molecules
    for (let m of molecules) {
        m.x += m.vx;
        m.y += m.vy;
        if (m.x < m.r) { m.x = m.r; m.vx *= -1; }
        if (m.x > W - m.r) { m.x = W - m.r; m.vx *= -1; }
        if (m.y < m.r) { m.y = m.r; m.vy *= -1; }
        if (m.y > H - m.r) { m.y = H - m.r; m.vy *= -1; }
    }

    // Collide molecules with big particle
    for (let m of molecules) {
        collide(bigParticle, m);
    }

    // Update big particle
    bigParticle.x += bigParticle.vx;
    bigParticle.y += bigParticle.vy;
    bigParticle.vx *= 0.998;
    bigParticle.vy *= 0.998;

    if (bigParticle.x < bigParticle.r) { bigParticle.x = bigParticle.r; bigParticle.vx *= -0.8; }
    if (bigParticle.x > W - bigParticle.r) { bigParticle.x = W - bigParticle.r; bigParticle.vx *= -0.8; }
    if (bigParticle.y < bigParticle.r) { bigParticle.y = bigParticle.r; bigParticle.vy *= -0.8; }
    if (bigParticle.y > H - bigParticle.r) { bigParticle.y = H - bigParticle.r; bigParticle.vy *= -0.8; }

    // Record trail
    trail.push({ x: bigParticle.x, y: bigParticle.y });
    if (trail.length > maxTrail) trail.shift();
}

function draw() {
    ctx.fillStyle = 'rgba(10, 14, 26, 0.15)';
    ctx.fillRect(0, 0, W, H);

    // Draw trail
    if (trail.length > 1) {
        ctx.beginPath();
        ctx.moveTo(trail[0].x, trail[0].y);
        for (let i = 1; i < trail.length; i++) {
            const alpha = i / trail.length;
            ctx.strokeStyle = `rgba(251, 191, 36, ${alpha * 0.6})`;
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            ctx.moveTo(trail[i - 1].x, trail[i - 1].y);
            ctx.lineTo(trail[i].x, trail[i].y);
            ctx.stroke();
        }
    }

    // Draw molecules
    for (let m of molecules) {
        const speed = Math.sqrt(m.vx * m.vx + m.vy * m.vy);
        const hue = Math.min(speed * 15, 60);
        ctx.beginPath();
        ctx.arc(m.x, m.y, m.r, 0, Math.PI * 2);
        ctx.fillStyle = `hsla(${200 + hue}, 70%, 60%, 0.7)`;
        ctx.fill();
    }

    // Draw big particle
    const grd = ctx.createRadialGradient(bigParticle.x, bigParticle.y, 0, bigParticle.x, bigParticle.y, bigParticle.r);
    grd.addColorStop(0, '#fbbf24');
    grd.addColorStop(0.7, '#f59e0b');
    grd.addColorStop(1, 'rgba(245, 158, 11, 0.3)');
    ctx.beginPath();
    ctx.arc(bigParticle.x, bigParticle.y, bigParticle.r, 0, Math.PI * 2);
    ctx.fillStyle = grd;
    ctx.fill();

    // Glow
    ctx.beginPath();
    ctx.arc(bigParticle.x, bigParticle.y, bigParticle.r + 6, 0, Math.PI * 2);
    ctx.strokeStyle = 'rgba(251, 191, 36, 0.3)';
    ctx.lineWidth = 3;
    ctx.stroke();

    // Stats
    const speed = Math.sqrt(bigParticle.vx ** 2 + bigParticle.vy ** 2);
    const displacement = dist(bigParticle, { x: W / 2, y: H / 2 });
    document.getElementById('stats').innerHTML =
        `Particle Speed: ${speed.toFixed(2)}<br>
         Displacement: ${displacement.toFixed(1)}px<br>
         Trail Length: ${trail.length}<br>
         Molecules: ${molecules.length}<br>
         Temperature: ${temperature}`;
}

function animate() {
    update();
    draw();
    requestAnimationFrame(animate);
}
animate();
</script>
</body>
</html>
