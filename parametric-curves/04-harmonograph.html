<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Harmonograph - Pendulum Drawing Machine</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: 'Segoe UI', Arial, sans-serif; }
canvas { display: block; }
a.back { position: fixed; top: 20px; left: 20px; color: #8af; text-decoration: none; z-index: 100; font-size: 1.2em; }
a.back:hover { color: #bdf; }
#controls {
    position: fixed; top: 20px; right: 20px; background: rgba(10,14,30,0.7);
    backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(138,170,255,0.15); border-radius: 12px;
    padding: 18px; color: #cde; z-index: 100; width: 250px; font-size: 13px;
    max-height: calc(100vh - 40px); overflow-y: auto;
}
#controls h3 { margin-bottom: 10px; color: #8af; font-size: 15px; }
.ctrl-row { margin-bottom: 7px; display: flex; justify-content: space-between; align-items: center; }
.ctrl-row label { flex: 0 0 75px; }
.ctrl-row input[type=range] { flex: 1; margin: 0 8px; accent-color: #8af; }
.ctrl-row .val { flex: 0 0 40px; text-align: right; color: #8af; font-size: 12px; }
button {
    background: rgba(138,170,255,0.15); color: #8af; border: 1px solid rgba(138,170,255,0.3);
    border-radius: 6px; padding: 5px 10px; cursor: pointer; font-size: 12px; margin: 2px;
}
button:hover { background: rgba(138,170,255,0.3); }
.presets { display: flex; flex-wrap: wrap; margin-top: 8px; }
select { background: #1a1e2a; color: #cde; border: 1px solid rgba(138,170,255,0.3); border-radius: 4px; padding: 3px; font-size: 12px; }
.section { border-top: 1px solid rgba(138,170,255,0.1); padding-top: 8px; margin-top: 8px; }
.section-title { font-size: 11px; color: #89a; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 1px; }
#pendulums { position: fixed; bottom: 20px; left: 20px; display: flex; gap: 20px; }
.pend-box {
    width: 100px; height: 100px; background: rgba(10,14,30,0.5);
    backdrop-filter: blur(5px); border: 1px solid rgba(138,170,255,0.15);
    border-radius: 8px; overflow: hidden;
}
.pend-label { color: #89a; font-size: 10px; text-align: center; padding: 2px; font-family: 'Segoe UI', sans-serif; }
</style>
</head>
<body>
<a href="index.html" class="back">&#8592; Back</a>
<canvas id="canvas"></canvas>

<div id="controls">
    <h3>Harmonograph</h3>
    <div class="ctrl-row"><label>Freq X</label><input type="range" id="f1" min="100" max="500" value="200"><span class="val" id="f1v">2.00</span></div>
    <div class="ctrl-row"><label>Freq Y</label><input type="range" id="f2" min="100" max="500" value="300"><span class="val" id="f2v">3.00</span></div>
    <div class="ctrl-row"><label>Phase Y</label><input type="range" id="p2" min="0" max="628" value="157"><span class="val" id="p2v">1.57</span></div>
    <div class="ctrl-row"><label>Damping</label><input type="range" id="damp" min="1" max="80" value="8"><span class="val" id="dampv">0.008</span></div>
    <div class="ctrl-row"><label>Amp X</label><input type="range" id="a1" min="50" max="300" value="200"><span class="val" id="a1v">200</span></div>
    <div class="ctrl-row"><label>Amp Y</label><input type="range" id="a2" min="50" max="300" value="200"><span class="val" id="a2v">200</span></div>
    <div class="section">
        <div class="section-title">Appearance</div>
        <div class="ctrl-row"><label>Speed</label><input type="range" id="speed" min="1" max="40" value="15"><span class="val" id="speedv">15</span></div>
        <div class="ctrl-row"><label>Width</label><input type="range" id="lw" min="0.5" max="4" value="1.5" step="0.5"><span class="val" id="lwv">1.5</span></div>
        <div class="ctrl-row"><label>Color</label><select id="colorMode"><option value="rainbow">Rainbow</option><option value="ink">Ink</option><option value="copper">Copper</option><option value="neon">Neon</option></select></div>
    </div>
    <div class="presets">
        <button onclick="preset(2,3,1.57,8)">2:3</button>
        <button onclick="preset(1,1,1.57,5)">Circle</button>
        <button onclick="preset(3,4,0.5,6)">3:4</button>
        <button onclick="preset(1.618,1,0.78,4)">Golden</button>
        <button onclick="preset(2,3,0,12)">Star</button>
    </div>
</div>

<div id="pendulums">
    <div class="pend-box"><canvas id="pendX" width="100" height="90"></canvas><div class="pend-label">X pendulum</div></div>
    <div class="pend-box"><canvas id="pendY" width="100" height="90"></canvas><div class="pend-label">Y pendulum</div></div>
</div>

<canvas id="trail"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const trail = document.getElementById('trail');
const tCtx = trail.getContext('2d');
trail.style.cssText = 'position:absolute;top:0;left:0;pointer-events:none;';

const pendXCanvas = document.getElementById('pendX');
const pendYCanvas = document.getElementById('pendY');
const pxCtx = pendXCanvas.getContext('2d');
const pyCtx = pendYCanvas.getContext('2d');

let W, H, cx, cy;
function resize() {
    W = canvas.width = trail.width = window.innerWidth;
    H = canvas.height = trail.height = window.innerHeight;
    cx = W / 2; cy = H / 2;
    redrawTrail();
}

const params = { f1: 200, f2: 300, p2: 157, damp: 8, a1: 200, a2: 200, speed: 15, lw: 1.5 };
const displayFn = {
    f1: v => (v/100).toFixed(2), f2: v => (v/100).toFixed(2),
    p2: v => (v/100).toFixed(2), damp: v => (v/1000).toFixed(3),
    a1: v => v, a2: v => v, speed: v => v, lw: v => v
};
const ids = ['f1','f2','p2','damp','a1','a2','speed','lw'];
const els = {};
ids.forEach(k => {
    els[k] = document.getElementById(k);
    els[k].oninput = () => {
        params[k] = parseFloat(els[k].value);
        document.getElementById(k+'v').textContent = displayFn[k](params[k]);
    };
});

let colorMode = 'rainbow';
document.getElementById('colorMode').onchange = e => colorMode = e.target.value;

let t = 0;
let points = [];
let paused = false;

function harmonograph(t, f1, f2, p1, p2, d1, d2, a1, a2) {
    const decay1 = Math.exp(-d1 * t);
    const decay2 = Math.exp(-d2 * t);
    return {
        x: a1 * Math.sin(f1 * t) * decay1,
        y: a2 * Math.sin(f2 * t + p2) * decay2
    };
}

function getColor(t) {
    if (colorMode === 'ink') {
        const a = Math.max(0.3, 0.9 - t * 0.005);
        return `rgba(40,60,100,${a})`;
    }
    if (colorMode === 'copper') {
        const l = 45 + 15 * Math.sin(t * 0.3);
        return `hsl(25, 65%, ${l}%)`;
    }
    if (colorMode === 'neon') {
        const hue = (t * 8) % 360;
        return `hsl(${hue}, 100%, 65%)`;
    }
    return `hsl(${(t * 6) % 360}, 75%, 58%)`;
}

function preset(f1, f2, p2, damp) {
    params.f1 = f1 * 100; params.f2 = f2 * 100;
    params.p2 = Math.round(p2 * 100); params.damp = damp;
    els.f1.value = params.f1; els.f2.value = params.f2;
    els.p2.value = params.p2; els.damp.value = params.damp;
    document.getElementById('f1v').textContent = f1.toFixed(2);
    document.getElementById('f2v').textContent = f2.toFixed(2);
    document.getElementById('p2v').textContent = p2.toFixed(2);
    document.getElementById('dampv').textContent = (damp/1000).toFixed(3);
    resetAnim();
}

function resetAnim() {
    t = 0; points = [];
    tCtx.clearRect(0, 0, W, H);
}

function redrawTrail() {
    tCtx.clearRect(0, 0, W, H);
    if (points.length < 2) return;
    for (let i = 1; i < points.length; i++) {
        tCtx.beginPath();
        tCtx.moveTo(points[i-1].sx, points[i-1].sy);
        tCtx.lineTo(points[i].sx, points[i].sy);
        tCtx.strokeStyle = points[i].color;
        tCtx.lineWidth = params.lw + Math.sin(i * 0.05) * 0.3;
        tCtx.stroke();
    }
}

function drawPendulums() {
    const f1 = params.f1 / 100;
    const f2 = params.f2 / 100;
    const p2 = params.p2 / 100;
    const d = params.damp / 1000;
    const decay = Math.exp(-d * t);

    // X pendulum
    pxCtx.clearRect(0, 0, 100, 90);
    const xVal = Math.sin(f1 * t) * decay;
    const px = 50 + xVal * 35;
    pxCtx.beginPath();
    pxCtx.moveTo(50, 10);
    pxCtx.lineTo(px, 55);
    pxCtx.strokeStyle = 'rgba(138,170,255,0.5)';
    pxCtx.lineWidth = 1.5;
    pxCtx.stroke();
    pxCtx.beginPath();
    pxCtx.arc(px, 55, 6, 0, Math.PI * 2);
    pxCtx.fillStyle = '#8af';
    pxCtx.shadowBlur = 8;
    pxCtx.shadowColor = '#8af';
    pxCtx.fill();
    pxCtx.shadowBlur = 0;

    // Y pendulum
    pyCtx.clearRect(0, 0, 100, 90);
    const yVal = Math.sin(f2 * t + p2) * decay;
    const py = 50 + yVal * 35;
    pyCtx.beginPath();
    pyCtx.moveTo(50, 10);
    pyCtx.lineTo(py, 55);
    pyCtx.strokeStyle = 'rgba(255,140,100,0.5)';
    pyCtx.lineWidth = 1.5;
    pyCtx.stroke();
    pyCtx.beginPath();
    pyCtx.arc(py, 55, 6, 0, Math.PI * 2);
    pyCtx.fillStyle = '#f84';
    pyCtx.shadowBlur = 8;
    pyCtx.shadowColor = '#f84';
    pyCtx.fill();
    pyCtx.shadowBlur = 0;
}

function animate() {
    requestAnimationFrame(animate);
    ctx.clearRect(0, 0, W, H);

    const f1 = params.f1 / 100;
    const f2 = params.f2 / 100;
    const p2 = params.p2 / 100;
    const d = params.damp / 1000;
    const dt = params.speed * 0.003;
    const maxT = 600;

    if (!paused && t < maxT) {
        for (let i = 0; i < 4; i++) {
            if (t >= maxT) break;
            t += dt;
            const p = harmonograph(t, f1, f2, 0, p2, d, d, params.a1, params.a2);
            const sx = p.x + cx;
            const sy = p.y + cy;
            const color = getColor(t);
            const lwVar = params.lw + Math.sin(t * 0.8) * 0.3;
            points.push({ sx, sy, color });

            if (points.length > 1) {
                const prev = points[points.length - 2];
                tCtx.beginPath();
                tCtx.moveTo(prev.sx, prev.sy);
                tCtx.lineTo(sx, sy);
                tCtx.strokeStyle = color;
                tCtx.lineWidth = lwVar;
                if (colorMode === 'neon') {
                    tCtx.shadowBlur = 10;
                    tCtx.shadowColor = color;
                }
                tCtx.stroke();
                tCtx.shadowBlur = 0;
            }
        }
    }

    // Draw current pen position
    if (points.length > 0) {
        const last = points[points.length - 1];
        ctx.beginPath();
        ctx.arc(last.sx, last.sy, 4, 0, Math.PI * 2);
        ctx.fillStyle = '#fff';
        ctx.shadowBlur = 15;
        ctx.shadowColor = '#fff';
        ctx.fill();
        ctx.shadowBlur = 0;

        // Crosshair
        ctx.strokeStyle = 'rgba(255,255,255,0.15)';
        ctx.lineWidth = 0.5;
        ctx.beginPath();
        ctx.moveTo(last.sx, 0); ctx.lineTo(last.sx, H);
        ctx.moveTo(0, last.sy); ctx.lineTo(W, last.sy);
        ctx.stroke();
    }

    drawPendulums();
}

window.reset = function() {
    resetAnim();
};

window.addEventListener('resize', resize);
resize();
animate();
</script>
<script src="../assets/js/enhance.js"></script>
</body>
</html>
