<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Curve Morphing</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: 'Segoe UI', system-ui, sans-serif; }
canvas { display: block; }
a { position: fixed; top: 20px; left: 20px; color: #8af; text-decoration: none; z-index: 100; font-size: 1.2em; }
a:hover { color: #bdf; }
#controls {
    position: fixed; top: 20px; right: 20px; background: rgba(10,14,26,0.85);
    backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(138,170,255,0.15); border-radius: 12px;
    padding: 16px; color: #cde; z-index: 100; width: 240px; font-size: 13px;
}
#controls h3 { color: #8af; margin-bottom: 10px; font-size: 14px; }
.ctrl-group { margin-bottom: 10px; }
.ctrl-group label { display: block; margin-bottom: 3px; color: #9ab; font-size: 12px; }
.ctrl-group select, .ctrl-group input[type=range] { width: 100%; }
select { background: rgba(30,40,70,0.8); color: #cde; border: 1px solid rgba(138,170,255,0.2); border-radius: 6px; padding: 4px; }
.btn-row { display: flex; gap: 6px; margin-top: 8px; }
.btn-row button {
    flex: 1; padding: 5px 8px; background: rgba(60,80,140,0.4);
    color: #8af; border: 1px solid rgba(138,170,255,0.2); border-radius: 6px;
    cursor: pointer; font-size: 11px;
}
.btn-row button:hover { background: rgba(80,100,180,0.5); }
.btn-row button.active { background: rgba(100,140,255,0.3); border-color: #8af; }
#morphLabel {
    position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
    color: #8af; font-size: 16px; z-index: 100;
    background: rgba(10,14,26,0.7); backdrop-filter: blur(10px);
    padding: 10px 24px; border-radius: 20px; border: 1px solid rgba(138,170,255,0.1);
    text-align: center;
}
#morphLabel .pct { color: #6d9; font-size: 14px; }
#morphBar {
    position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
    width: 300px; height: 4px; background: rgba(138,170,255,0.1);
    border-radius: 2px; z-index: 100; overflow: hidden;
}
#morphFill { height: 100%; background: linear-gradient(90deg, #8af, #6d9); width: 0%; border-radius: 2px; transition: width 0.05s; }
</style>
</head>
<body>
<a href="index.html">&#8592; Back</a>
<canvas id="canvas"></canvas>
<div id="controls">
    <h3>Curve Morphing</h3>
    <div class="ctrl-group">
        <label>Source Curve</label>
        <select id="source">
            <option value="circle">Circle</option>
            <option value="cardioid">Cardioid</option>
            <option value="rose">Rose (k=5)</option>
            <option value="astroid">Astroid</option>
            <option value="butterfly">Butterfly</option>
            <option value="superellipse">Superellipse</option>
            <option value="lissajous">Lissajous</option>
        </select>
    </div>
    <div class="ctrl-group">
        <label>Target Curve</label>
        <select id="target">
            <option value="circle">Circle</option>
            <option value="cardioid" selected>Cardioid</option>
            <option value="rose">Rose (k=5)</option>
            <option value="astroid">Astroid</option>
            <option value="butterfly">Butterfly</option>
            <option value="superellipse">Superellipse</option>
            <option value="lissajous">Lissajous</option>
        </select>
    </div>
    <div class="ctrl-group">
        <label>Morph (alpha): <span id="alphaVal">0.50</span></label>
        <input type="range" id="alpha" min="0" max="1" step="0.005" value="0.5">
    </div>
    <div class="ctrl-group">
        <label>Speed: <span id="speedVal">1.0</span></label>
        <input type="range" id="speed" min="0.2" max="3" step="0.1" value="1">
    </div>
    <div class="btn-row">
        <button id="autoBtn">Auto Morph</button>
        <button id="cycleBtn">Cycle All</button>
    </div>
</div>
<div id="morphBar"><div id="morphFill"></div></div>
<div id="morphLabel">Circle <span class="pct">50%</span> Cardioid</div>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let W, H, cx, cy;
let autoMorph = false;
let autoCycle = false;
let alpha = 0.5;
let cycleIndex = 0;
let cycleAlpha = 0;
let paused = false;

const curveNames = ['circle', 'cardioid', 'rose', 'astroid', 'butterfly', 'superellipse', 'lissajous'];
const curveLabels = { circle: 'Circle', cardioid: 'Cardioid', rose: 'Rose (k=5)', astroid: 'Astroid', butterfly: 'Butterfly', superellipse: 'Superellipse', lissajous: 'Lissajous' };

function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
    cx = W / 2;
    cy = H / 2;
}
resize();
window.addEventListener('resize', resize);

const N = 600;

function sampleCurve(type) {
    const pts = [];
    const R = Math.min(W, H) * 0.3;
    for (let i = 0; i < N; i++) {
        const t = (i / N) * Math.PI * 2;
        let x, y;
        switch (type) {
            case 'circle':
                x = R * Math.cos(t);
                y = R * Math.sin(t);
                break;
            case 'cardioid': {
                const r = R * 0.5 * (1 + Math.cos(t));
                x = r * Math.cos(t);
                y = r * Math.sin(t);
                break;
            }
            case 'rose': {
                const k = 5;
                const r = R * Math.cos(k * t);
                x = r * Math.cos(t);
                y = r * Math.sin(t);
                break;
            }
            case 'astroid':
                x = R * Math.pow(Math.cos(t), 3);
                y = R * Math.pow(Math.sin(t), 3);
                break;
            case 'butterfly': {
                const r = R * 0.35 * (Math.exp(Math.cos(t)) - 2 * Math.cos(4 * t) + Math.pow(Math.sin(t / 12), 5));
                x = r * Math.cos(t);
                y = r * Math.sin(t);
                break;
            }
            case 'superellipse': {
                const n = 4;
                const ct = Math.cos(t), st = Math.sin(t);
                x = R * Math.sign(ct) * Math.pow(Math.abs(ct), 2 / n);
                y = R * Math.sign(st) * Math.pow(Math.abs(st), 2 / n);
                break;
            }
            case 'lissajous':
                x = R * Math.sin(3 * t + Math.PI / 4);
                y = R * Math.sin(2 * t);
                break;
        }
        pts.push({ x, y });
    }
    return pts;
}

function morphPoints(a, b, alpha) {
    const pts = [];
    for (let i = 0; i < N; i++) {
        pts.push({
            x: (1 - alpha) * a[i].x + alpha * b[i].x,
            y: (1 - alpha) * a[i].y + alpha * b[i].y
        });
    }
    return pts;
}

function hsl(h, s, l, a) { return `hsla(${h},${s}%,${l}%,${a !== undefined ? a : 1})`; }

function draw() {
    ctx.fillStyle = '#0a0e1a';
    ctx.fillRect(0, 0, W, H);

    // Grid
    ctx.strokeStyle = 'rgba(138,170,255,0.03)';
    ctx.lineWidth = 1;
    for (let r = 50; r < Math.max(W, H); r += 80) {
        ctx.beginPath();
        ctx.arc(cx, cy, r, 0, Math.PI * 2);
        ctx.stroke();
    }

    const speed = parseFloat(document.getElementById('speed').value);
    let srcName, tgtName, currentAlpha;

    if (autoCycle && !paused) {
        cycleAlpha += 0.003 * speed;
        if (cycleAlpha >= 1) {
            cycleAlpha = 0;
            cycleIndex = (cycleIndex + 1) % curveNames.length;
        }
        srcName = curveNames[cycleIndex];
        tgtName = curveNames[(cycleIndex + 1) % curveNames.length];
        currentAlpha = cycleAlpha;
        document.getElementById('alpha').value = currentAlpha;
        document.getElementById('alphaVal').textContent = currentAlpha.toFixed(2);
    } else if (autoMorph && !paused) {
        alpha += 0.004 * speed;
        if (alpha > 1) alpha = 0;
        currentAlpha = alpha;
        srcName = document.getElementById('source').value;
        tgtName = document.getElementById('target').value;
        document.getElementById('alpha').value = currentAlpha;
        document.getElementById('alphaVal').textContent = currentAlpha.toFixed(2);
    } else {
        currentAlpha = parseFloat(document.getElementById('alpha').value);
        srcName = document.getElementById('source').value;
        tgtName = document.getElementById('target').value;
    }

    const srcPts = sampleCurve(srcName);
    const tgtPts = sampleCurve(tgtName);
    const morphed = morphPoints(srcPts, tgtPts, currentAlpha);

    // Ghost source
    ctx.beginPath();
    ctx.moveTo(cx + srcPts[0].x, cy + srcPts[0].y);
    for (let i = 1; i < N; i++) ctx.lineTo(cx + srcPts[i].x, cy + srcPts[i].y);
    ctx.closePath();
    ctx.strokeStyle = 'rgba(138,170,255,0.08)';
    ctx.lineWidth = 1;
    ctx.stroke();

    // Ghost target
    ctx.beginPath();
    ctx.moveTo(cx + tgtPts[0].x, cy + tgtPts[0].y);
    for (let i = 1; i < N; i++) ctx.lineTo(cx + tgtPts[i].x, cy + tgtPts[i].y);
    ctx.closePath();
    ctx.strokeStyle = 'rgba(100,221,153,0.08)';
    ctx.lineWidth = 1;
    ctx.stroke();

    // Morphed curve with rainbow glow
    for (let i = 0; i < N; i++) {
        const j = (i + 1) % N;
        const t = i / N;
        ctx.beginPath();
        ctx.moveTo(cx + morphed[i].x, cy + morphed[i].y);
        ctx.lineTo(cx + morphed[j].x, cy + morphed[j].y);
        const h = t * 360;
        ctx.strokeStyle = hsl(h, 80, 60);
        ctx.lineWidth = 3;
        ctx.shadowColor = hsl(h, 80, 60);
        ctx.shadowBlur = 12;
        ctx.stroke();
    }
    ctx.shadowBlur = 0;

    // Morphing lines (a few sample correspondences)
    if (currentAlpha > 0.01 && currentAlpha < 0.99) {
        for (let i = 0; i < N; i += Math.floor(N / 30)) {
            ctx.beginPath();
            ctx.moveTo(cx + srcPts[i].x, cy + srcPts[i].y);
            ctx.lineTo(cx + morphed[i].x, cy + morphed[i].y);
            ctx.strokeStyle = 'rgba(138,170,255,0.06)';
            ctx.lineWidth = 0.5;
            ctx.stroke();
        }
    }

    // Center dot
    ctx.beginPath();
    ctx.arc(cx, cy, 3, 0, Math.PI * 2);
    ctx.fillStyle = 'rgba(138,170,255,0.3)';
    ctx.fill();

    // Label
    const pct = Math.round(currentAlpha * 100);
    const srcLabel = curveLabels[srcName] || srcName;
    const tgtLabel = curveLabels[tgtName] || tgtName;
    document.getElementById('morphLabel').innerHTML = srcLabel + ' <span class="pct">' + pct + '%</span> ' + tgtLabel;
    document.getElementById('morphFill').style.width = pct + '%';

    requestAnimationFrame(draw);
}

document.getElementById('alpha').addEventListener('input', e => {
    document.getElementById('alphaVal').textContent = parseFloat(e.target.value).toFixed(2);
    autoMorph = false;
    autoCycle = false;
    document.getElementById('autoBtn').classList.remove('active');
    document.getElementById('cycleBtn').classList.remove('active');
});
document.getElementById('speed').addEventListener('input', e => {
    document.getElementById('speedVal').textContent = parseFloat(e.target.value).toFixed(1);
});
document.getElementById('autoBtn').addEventListener('click', function() {
    autoMorph = !autoMorph;
    autoCycle = false;
    if (autoMorph) alpha = 0;
    this.classList.toggle('active', autoMorph);
    document.getElementById('cycleBtn').classList.remove('active');
});
document.getElementById('cycleBtn').addEventListener('click', function() {
    autoCycle = !autoCycle;
    autoMorph = false;
    if (autoCycle) { cycleIndex = 0; cycleAlpha = 0; }
    this.classList.toggle('active', autoCycle);
    document.getElementById('autoBtn').classList.remove('active');
});

window.reset = function() {
    autoMorph = false;
    autoCycle = false;
    paused = false;
    alpha = 0.5;
    cycleIndex = 0;
    cycleAlpha = 0;
    document.getElementById('source').value = 'circle';
    document.getElementById('target').value = 'cardioid';
    document.getElementById('alpha').value = 0.5;
    document.getElementById('alphaVal').textContent = '0.50';
    document.getElementById('speed').value = 1;
    document.getElementById('speedVal').textContent = '1.0';
    document.getElementById('autoBtn').classList.remove('active');
    document.getElementById('cycleBtn').classList.remove('active');
};

draw();
</script>
<script src="../assets/js/enhance.js"></script>
</body>
</html>