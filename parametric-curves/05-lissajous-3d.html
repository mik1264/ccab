<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lissajous 3D - Three-Frequency Curves</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: 'Segoe UI', Arial, sans-serif; }
canvas { display: block; cursor: grab; }
canvas:active { cursor: grabbing; }
a.back { position: fixed; top: 20px; left: 20px; color: #8af; text-decoration: none; z-index: 100; font-size: 1.2em; }
a.back:hover { color: #bdf; }
#controls {
    position: fixed; top: 20px; right: 20px; background: rgba(10,14,30,0.7);
    backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(138,170,255,0.15); border-radius: 12px;
    padding: 18px; color: #cde; z-index: 100; width: 250px; font-size: 13px;
    max-height: calc(100vh - 40px); overflow-y: auto;
}
#controls h3 { margin-bottom: 10px; color: #8af; font-size: 15px; }
.ctrl-row { margin-bottom: 7px; display: flex; justify-content: space-between; align-items: center; }
.ctrl-row label { flex: 0 0 70px; }
.ctrl-row input[type=range] { flex: 1; margin: 0 8px; accent-color: #8af; }
.ctrl-row .val { flex: 0 0 35px; text-align: right; color: #8af; font-size: 12px; }
button {
    background: rgba(138,170,255,0.15); color: #8af; border: 1px solid rgba(138,170,255,0.3);
    border-radius: 6px; padding: 5px 10px; cursor: pointer; font-size: 12px; margin: 2px;
}
button:hover { background: rgba(138,170,255,0.3); }
.presets { display: flex; flex-wrap: wrap; margin-top: 8px; }
select { background: #1a1e2a; color: #cde; border: 1px solid rgba(138,170,255,0.3); border-radius: 4px; padding: 3px; font-size: 12px; }
.section { border-top: 1px solid rgba(138,170,255,0.1); padding-top: 8px; margin-top: 8px; }
.section-title { font-size: 11px; color: #89a; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 1px; }
.toggle-row { margin: 6px 0; display: flex; align-items: center; gap: 8px; }
.toggle-row input { accent-color: #8af; }
</style>
</head>
<body>
<a href="index.html" class="back">&#8592; Back</a>
<canvas id="canvas"></canvas>
<div id="controls">
    <h3>Lissajous 3D</h3>
    <div class="section-title">Frequencies</div>
    <div class="ctrl-row"><label>a (X)</label><input type="range" id="freqA" min="10" max="70" value="20"><span class="val" id="freqAv">2</span></div>
    <div class="ctrl-row"><label>b (Y)</label><input type="range" id="freqB" min="10" max="70" value="30"><span class="val" id="freqBv">3</span></div>
    <div class="ctrl-row"><label>c (Z)</label><input type="range" id="freqC" min="10" max="70" value="50"><span class="val" id="freqCv">5</span></div>
    <div class="section">
        <div class="section-title">Phases</div>
        <div class="ctrl-row"><label>&delta;1</label><input type="range" id="d1" min="0" max="628" value="0"><span class="val" id="d1v">0.00</span></div>
        <div class="ctrl-row"><label>&delta;2</label><input type="range" id="d2" min="0" max="628" value="0"><span class="val" id="d2v">0.00</span></div>
        <div class="ctrl-row"><label>&delta;3</label><input type="range" id="d3" min="0" max="628" value="0"><span class="val" id="d3v">0.00</span></div>
    </div>
    <div class="section">
        <div class="section-title">Display</div>
        <div class="ctrl-row"><label>Rotate spd</label><input type="range" id="rotSpeed" min="0" max="50" value="10"><span class="val" id="rotSpeedv">10</span></div>
        <div class="ctrl-row"><label>Thickness</label><input type="range" id="thick" min="1" max="8" value="3" step="0.5"><span class="val" id="thickv">3</span></div>
        <div class="ctrl-row"><label>Scale</label><input type="range" id="scale" min="80" max="350" value="200"><span class="val" id="scalev">200</span></div>
        <div class="ctrl-row"><label>Color</label><select id="colorMode"><option value="rainbow">Rainbow</option><option value="depth">Depth</option><option value="solid">Solid</option></select></div>
        <div class="toggle-row"><input type="checkbox" id="animPhase"><label for="animPhase">Animate phase</label></div>
    </div>
    <div class="presets">
        <button onclick="preset(2,3,5,0,0,0)">Trefoil</button>
        <button onclick="preset(1,2,3,0,1.57,0)">Figure-8</button>
        <button onclick="preset(3,5,7,0.5,1.0,1.5)">Complex</button>
        <button onclick="preset(2,3,4,0,0.78,1.57)">Knot</button>
        <button onclick="preset(1,1,1,0,1.57,0)">Circle</button>
    </div>
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let W, H, cx, cy;

function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
    cx = W / 2; cy = H / 2;
}

const params = {
    freqA: 20, freqB: 30, freqC: 50,
    d1: 0, d2: 0, d3: 0,
    rotSpeed: 10, thick: 3, scale: 200
};
const displayFn = {
    freqA: v => (v/10).toFixed(0), freqB: v => (v/10).toFixed(0), freqC: v => (v/10).toFixed(0),
    d1: v => (v/100).toFixed(2), d2: v => (v/100).toFixed(2), d3: v => (v/100).toFixed(2),
    rotSpeed: v => v, thick: v => v, scale: v => v
};
const ids = ['freqA','freqB','freqC','d1','d2','d3','rotSpeed','thick','scale'];
const els = {};
ids.forEach(k => {
    els[k] = document.getElementById(k);
    els[k].oninput = () => {
        params[k] = parseFloat(els[k].value);
        document.getElementById(k+'v').textContent = displayFn[k](params[k]);
    };
});

let colorMode = 'rainbow';
document.getElementById('colorMode').onchange = e => colorMode = e.target.value;
let animPhase = false;
document.getElementById('animPhase').onchange = e => animPhase = e.target.checked;

// Mouse drag rotation
let rotX = 0.3, rotY = 0;
let dragging = false, lastMx, lastMy;
canvas.onmousedown = e => { dragging = true; lastMx = e.clientX; lastMy = e.clientY; };
canvas.onmousemove = e => {
    if (!dragging) return;
    rotY += (e.clientX - lastMx) * 0.005;
    rotX += (e.clientY - lastMy) * 0.005;
    lastMx = e.clientX; lastMy = e.clientY;
};
canvas.onmouseup = () => dragging = false;
canvas.onmouseleave = () => dragging = false;

// Touch drag
canvas.ontouchstart = e => { const t = e.touches[0]; dragging = true; lastMx = t.clientX; lastMy = t.clientY; };
canvas.ontouchmove = e => {
    e.preventDefault();
    const t = e.touches[0];
    rotY += (t.clientX - lastMx) * 0.005;
    rotX += (t.clientY - lastMy) * 0.005;
    lastMx = t.clientX; lastMy = t.clientY;
};
canvas.ontouchend = () => dragging = false;

let paused = false;
let time = 0;

function project(x, y, z) {
    // Rotate around X axis
    const cosX = Math.cos(rotX), sinX = Math.sin(rotX);
    let y1 = y * cosX - z * sinX;
    let z1 = y * sinX + z * cosX;
    // Rotate around Y axis
    const cosY = Math.cos(rotY), sinY = Math.sin(rotY);
    let x1 = x * cosY + z1 * sinY;
    let z2 = -x * sinY + z1 * cosY;
    // Perspective
    const fov = 600;
    const depth = fov / (fov + z2 + 300);
    return {
        sx: cx + x1 * depth,
        sy: cy + y1 * depth,
        depth: z2,
        scale: depth
    };
}

function animate() {
    requestAnimationFrame(animate);
    if (paused) return;

    ctx.fillStyle = 'rgba(10,14,26,1)';
    ctx.fillRect(0, 0, W, H);

    time += 0.003;

    if (!dragging) {
        rotY += params.rotSpeed * 0.0002;
    }

    const a = params.freqA / 10;
    const b = params.freqB / 10;
    const c = params.freqC / 10;
    let ph1 = params.d1 / 100;
    let ph2 = params.d2 / 100;
    let ph3 = params.d3 / 100;

    if (animPhase) {
        ph1 += time * 0.5;
        ph2 += time * 0.7;
    }

    const sc = params.scale;
    const numPoints = 2000;
    const segments = [];

    for (let i = 0; i <= numPoints; i++) {
        const t = (i / numPoints) * Math.PI * 2 * 4;
        const x = Math.sin(a * t + ph1) * sc;
        const y = Math.sin(b * t + ph2) * sc;
        const z = Math.sin(c * t + ph3) * sc;
        const p = project(x, y, z);
        segments.push({ ...p, t: i / numPoints });
    }

    // Sort by depth for proper occlusion (draw far first)
    const segPairs = [];
    for (let i = 0; i < segments.length - 1; i++) {
        segPairs.push({
            from: segments[i],
            to: segments[i+1],
            avgDepth: (segments[i].depth + segments[i+1].depth) / 2,
            t: segments[i].t
        });
    }
    segPairs.sort((a, b) => a.avgDepth - b.avgDepth);

    // Draw curve segments
    for (const seg of segPairs) {
        const { from, to, avgDepth, t: tNorm } = seg;

        let color;
        if (colorMode === 'rainbow') {
            const hue = (tNorm * 360 * 3) % 360;
            const light = 40 + 30 * from.scale;
            color = `hsl(${hue}, 80%, ${light}%)`;
        } else if (colorMode === 'depth') {
            const norm = (avgDepth + sc) / (2 * sc);
            const r = Math.round(50 + 200 * norm);
            const g = Math.round(100 + 100 * (1 - norm));
            const b2 = Math.round(200 + 55 * (1 - norm));
            color = `rgb(${r},${g},${b2})`;
        } else {
            const alpha = 0.4 + 0.6 * from.scale;
            color = `rgba(138,170,255,${alpha})`;
        }

        const lw = params.thick * from.scale;

        ctx.beginPath();
        ctx.moveTo(from.sx, from.sy);
        ctx.lineTo(to.sx, to.sy);
        ctx.strokeStyle = color;
        ctx.lineWidth = Math.max(0.5, lw);

        if (colorMode === 'rainbow') {
            ctx.shadowBlur = 6 * from.scale;
            ctx.shadowColor = color;
        }
        ctx.stroke();
        ctx.shadowBlur = 0;
    }

    // Draw axes hint
    drawAxis(0, 0, 0, 50, 0, 0, '#f44');
    drawAxis(0, 0, 0, 0, 50, 0, '#4f4');
    drawAxis(0, 0, 0, 0, 0, 50, '#44f');
}

function drawAxis(x1, y1, z1, x2, y2, z2, color) {
    const p1 = project(x1, y1, z1);
    const p2 = project(x2, y2, z2);
    ctx.beginPath();
    ctx.moveTo(p1.sx, p1.sy);
    ctx.lineTo(p2.sx, p2.sy);
    ctx.strokeStyle = color;
    ctx.globalAlpha = 0.25;
    ctx.lineWidth = 1;
    ctx.stroke();
    ctx.globalAlpha = 1;
}

function preset(a, b, c, d1, d2, d3) {
    params.freqA = a * 10; params.freqB = b * 10; params.freqC = c * 10;
    params.d1 = Math.round(d1 * 100); params.d2 = Math.round(d2 * 100); params.d3 = Math.round(d3 * 100);
    els.freqA.value = params.freqA; els.freqB.value = params.freqB; els.freqC.value = params.freqC;
    els.d1.value = params.d1; els.d2.value = params.d2; els.d3.value = params.d3;
    document.getElementById('freqAv').textContent = a;
    document.getElementById('freqBv').textContent = b;
    document.getElementById('freqCv').textContent = c;
    document.getElementById('d1v').textContent = d1.toFixed(2);
    document.getElementById('d2v').textContent = d2.toFixed(2);
    document.getElementById('d3v').textContent = d3.toFixed(2);
}

window.reset = function() {
    rotX = 0.3; rotY = 0; time = 0;
    preset(2, 3, 5, 0, 0, 0);
};

window.addEventListener('resize', resize);
resize();
animate();
</script>
<script src="../assets/js/enhance.js"></script>
</body>
</html>
