<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rose Curves</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
canvas { display: block; }
a { position: fixed; top: 20px; left: 20px; color: #8af; text-decoration: none; z-index: 100; font-size: 1.2em; }
a:hover { color: #bdf; }
#controls {
    position: fixed; top: 20px; right: 20px; background: rgba(10,14,26,0.7);
    backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(138,170,255,0.2); border-radius: 12px;
    padding: 18px; color: #cde; z-index: 100; min-width: 220px;
}
#controls h3 { margin-bottom: 12px; color: #8af; font-size: 1.1em; }
.ctrl { margin-bottom: 10px; }
.ctrl label { display: block; font-size: 0.82em; margin-bottom: 3px; color: #9ab; }
.ctrl input[type=range] { width: 100%; accent-color: #8af; }
.ctrl .val { float: right; color: #8af; font-size: 0.82em; }
.btn-row { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 8px; }
.btn-row button {
    flex: 1; min-width: 60px; padding: 5px 8px; background: rgba(138,170,255,0.15);
    border: 1px solid rgba(138,170,255,0.3); border-radius: 6px;
    color: #8af; cursor: pointer; font-size: 0.78em;
}
.btn-row button:hover { background: rgba(138,170,255,0.3); }
.toggle-row { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
.toggle-row label { font-size: 0.82em; color: #9ab; cursor: pointer; }
.toggle-row input { accent-color: #8af; }
#info {
    position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
    color: rgba(138,170,255,0.6); font-size: 0.85em; text-align: center;
}
</style>
</head>
<body>
<a href="index.html">&#8592; Back</a>
<canvas id="c"></canvas>
<div id="controls">
    <h3>Rose Curves</h3>
    <div class="ctrl">
        <label>k (petals) <span class="val" id="kVal">3</span></label>
        <input type="range" id="kSlider" min="0.5" max="10" step="0.1" value="3">
    </div>
    <div class="ctrl">
        <label>Line Width <span class="val" id="lwVal">2</span></label>
        <input type="range" id="lwSlider" min="0.5" max="6" step="0.5" value="2">
    </div>
    <div class="ctrl">
        <label>Speed <span class="val" id="spVal">3</span></label>
        <input type="range" id="spSlider" min="0.5" max="8" step="0.5" value="3">
    </div>
    <div class="toggle-row">
        <input type="checkbox" id="sinToggle"><label for="sinToggle">Use sin (vs cos)</label>
    </div>
    <div class="toggle-row">
        <input type="checkbox" id="polarGrid" checked><label for="polarGrid">Show polar grid</label>
    </div>
    <div class="btn-row">
        <button onclick="setPreset(3)">Trefoil</button>
        <button onclick="setPreset(2)">4-Leaf</button>
        <button onclick="setPreset(7)">7-Petal</button>
        <button onclick="setPreset(1.618)">Golden</button>
    </div>
</div>
<div id="info">r = cos(k&theta;) &mdash; Rose Curve (Rhodonea)</div>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let W, H, cx, cy, radius;
let theta = 0;
let points = [];
let animating = true;

function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
    cx = W / 2;
    cy = H / 2;
    radius = Math.min(W, H) * 0.38;
    resetDraw();
}

function getK() { return parseFloat(document.getElementById('kSlider').value); }
function getLW() { return parseFloat(document.getElementById('lwSlider').value); }
function getSpeed() { return parseFloat(document.getElementById('spSlider').value); }
function useSin() { return document.getElementById('sinToggle').checked; }
function showGrid() { return document.getElementById('polarGrid').checked; }

function setPreset(k) {
    document.getElementById('kSlider').value = k;
    document.getElementById('kVal').textContent = k;
    resetDraw();
}

function resetDraw() {
    theta = 0;
    points = [];
}

function getMaxTheta(k) {
    if (Number.isInteger(k)) return Math.PI * (k % 2 === 0 ? 2 : 1);
    const p = Math.round(k * 10);
    const q = 10;
    const g = gcd(p, q);
    const qr = q / g;
    return Math.PI * qr * 2;
}

function gcd(a, b) { return b === 0 ? a : gcd(b, a % b); }

function drawPolarGrid() {
    if (!showGrid()) return;
    ctx.strokeStyle = 'rgba(138,170,255,0.08)';
    ctx.lineWidth = 0.5;
    for (let i = 1; i <= 4; i++) {
        const r = radius * i / 4;
        ctx.beginPath();
        ctx.arc(cx, cy, r, 0, Math.PI * 2);
        ctx.stroke();
    }
    for (let i = 0; i < 12; i++) {
        const a = (Math.PI * 2 * i) / 12;
        ctx.beginPath();
        ctx.moveTo(cx, cy);
        ctx.lineTo(cx + Math.cos(a) * radius, cy + Math.sin(a) * radius);
        ctx.stroke();
    }
}

function hueForTheta(t, maxT) {
    return (t / maxT) * 360;
}

function draw() {
    if (!animating) { requestAnimationFrame(draw); return; }

    const k = getK();
    const lw = getLW();
    const speed = getSpeed();
    const maxTheta = getMaxTheta(k);
    const step = 0.02 * speed;

    ctx.fillStyle = 'rgba(10,14,26,0.08)';
    ctx.fillRect(0, 0, W, H);

    drawPolarGrid();

    // Advance theta
    const prevLen = points.length;
    for (let i = 0; i < 5; i++) {
        if (theta <= maxTheta + 0.1) {
            const fn = useSin() ? Math.sin : Math.cos;
            const r = fn(k * theta) * radius;
            const x = cx + r * Math.cos(theta);
            const y = cy + r * Math.sin(theta);
            points.push({ x, y, theta, hue: hueForTheta(theta, maxTheta) });
            theta += step * 0.02;
        }
    }

    // Draw curve
    if (points.length > 1) {
        for (let i = 1; i < points.length; i++) {
            const p0 = points[i - 1];
            const p1 = points[i];
            ctx.beginPath();
            ctx.moveTo(p0.x, p0.y);
            ctx.lineTo(p1.x, p1.y);
            ctx.strokeStyle = `hsla(${p1.hue}, 90%, 65%, 0.9)`;
            ctx.lineWidth = lw;
            ctx.stroke();
        }

        // Glow at drawing tip
        if (theta <= maxTheta + 0.1) {
            const tip = points[points.length - 1];
            const glow = ctx.createRadialGradient(tip.x, tip.y, 0, tip.x, tip.y, 20);
            glow.addColorStop(0, `hsla(${tip.hue}, 100%, 80%, 0.8)`);
            glow.addColorStop(1, 'transparent');
            ctx.fillStyle = glow;
            ctx.fillRect(tip.x - 20, tip.y - 20, 40, 40);
        }
    }

    // Restart if done
    if (theta > maxTheta + 2) {
        resetDraw();
    }

    requestAnimationFrame(draw);
}

// Slider updates
document.getElementById('kSlider').addEventListener('input', function() {
    document.getElementById('kVal').textContent = this.value;
    resetDraw();
});
document.getElementById('lwSlider').addEventListener('input', function() {
    document.getElementById('lwVal').textContent = this.value;
});
document.getElementById('spSlider').addEventListener('input', function() {
    document.getElementById('spVal').textContent = this.value;
});
document.getElementById('sinToggle').addEventListener('change', resetDraw);

window.addEventListener('resize', resize);

window.reset = function() {
    resetDraw();
    animating = true;
};

document.addEventListener('keydown', function(e) {
    if (e.code === 'Space') { e.preventDefault(); animating = !animating; }
});

resize();
draw();
</script>
<script src="../assets/js/enhance.js"></script>
</body>
</html>
