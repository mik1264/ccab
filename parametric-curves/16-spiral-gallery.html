<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spiral Gallery</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: 'Segoe UI', system-ui, sans-serif; }
canvas { display: block; }
a { position: fixed; top: 20px; left: 20px; color: #8af; text-decoration: none; z-index: 100; font-size: 1.2em; }
a:hover { color: #bdf; }
#controls {
    position: fixed; top: 20px; right: 20px; background: rgba(10,14,26,0.85);
    backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(138,170,255,0.15); border-radius: 12px;
    padding: 16px; color: #cde; z-index: 100; width: 240px; font-size: 13px;
}
#controls h3 { color: #8af; margin-bottom: 10px; font-size: 14px; }
.ctrl-group { margin-bottom: 10px; }
.ctrl-group label { display: block; margin-bottom: 3px; color: #9ab; font-size: 12px; }
.ctrl-group select, .ctrl-group input[type=range] { width: 100%; }
select { background: rgba(30,40,70,0.8); color: #cde; border: 1px solid rgba(138,170,255,0.2); border-radius: 6px; padding: 4px; }
.btn-row { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 8px; }
.btn-row button {
    flex: 1; min-width: 60px; padding: 5px 8px; background: rgba(60,80,140,0.4);
    color: #8af; border: 1px solid rgba(138,170,255,0.2); border-radius: 6px;
    cursor: pointer; font-size: 11px;
}
.btn-row button:hover { background: rgba(80,100,180,0.5); }
.btn-row button.active { background: rgba(100,140,255,0.3); border-color: #8af; }
#equation {
    position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
    color: #8af; font-size: 18px; font-family: 'Georgia', serif; font-style: italic;
    text-shadow: 0 0 20px rgba(138,170,255,0.5); z-index: 100;
    background: rgba(10,14,26,0.7); backdrop-filter: blur(10px);
    padding: 10px 24px; border-radius: 20px; border: 1px solid rgba(138,170,255,0.1);
}
#property {
    position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
    color: #6d9; font-size: 13px; z-index: 100; text-align: center;
    background: rgba(10,14,26,0.6); padding: 6px 16px; border-radius: 12px;
}
</style>
</head>
<body>
<a href="index.html">&#8592; Back</a>
<canvas id="canvas"></canvas>
<div id="controls">
    <h3>Spiral Gallery</h3>
    <div class="ctrl-group">
        <label>Spiral Type</label>
        <select id="spiralType">
            <option value="archimedean">Archimedean</option>
            <option value="logarithmic">Logarithmic</option>
            <option value="fermat">Fermat</option>
            <option value="hyperbolic">Hyperbolic</option>
            <option value="golden">Golden Spiral</option>
            <option value="cornu">Cornu (Euler)</option>
        </select>
    </div>
    <div class="ctrl-group">
        <label>Parameter a: <span id="aVal">1.0</span></label>
        <input type="range" id="paramA" min="0.1" max="5" step="0.1" value="1">
    </div>
    <div class="ctrl-group">
        <label>Parameter b: <span id="bVal">0.3</span></label>
        <input type="range" id="paramB" min="0.05" max="2" step="0.05" value="0.3">
    </div>
    <div class="ctrl-group">
        <label>Turns: <span id="turnsVal">8</span></label>
        <input type="range" id="turns" min="2" max="20" step="1" value="8">
    </div>
    <div class="ctrl-group">
        <label>Color Mode</label>
        <select id="colorMode">
            <option value="rainbow">Rainbow</option>
            <option value="mono">Monochrome</option>
            <option value="glow">Neon Glow</option>
        </select>
    </div>
    <div class="btn-row">
        <button id="tangentBtn">Tangent</button>
        <button id="compareBtn">Compare</button>
    </div>
</div>
<div id="equation"></div>
<div id="property"></div>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let W, H, cx, cy;
let animTheta = 0;
let showTangent = false;
let compareMode = false;
let compareType = 'archimedean';
let paused = false;

const spiralInfo = {
    archimedean: { eq: 'r = a + b\u03b8', prop: 'Constant spacing between turns' },
    logarithmic: { eq: 'r = a \u00b7 e^(b\u03b8)', prop: 'Constant angle between radius and tangent (equiangular spiral)' },
    fermat: { eq: 'r = a \u00b7 \u221a\u03b8', prop: 'Equal area between successive turns' },
    hyperbolic: { eq: 'r = a / \u03b8', prop: 'Asymptotes to a straight line' },
    golden: { eq: 'r = a \u00b7 \u03c6^(\u03b8/90\u00b0)', prop: 'Found in nautilus shells, galaxies, hurricanes' },
    cornu: { eq: '\u03ba = s (curvature \u221d arc length)', prop: 'Used in road/railway design for smooth transitions' }
};

function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
    cx = W / 2;
    cy = H / 2;
}
resize();
window.addEventListener('resize', resize);

function getSpiral(type, a, b, theta) {
    switch (type) {
        case 'archimedean': return a + b * theta;
        case 'logarithmic': return a * Math.exp(b * theta);
        case 'fermat': return a * Math.sqrt(Math.abs(theta));
        case 'hyperbolic': return theta > 0.1 ? a / theta : a / 0.1;
        case 'golden': {
            const phi = (1 + Math.sqrt(5)) / 2;
            return a * Math.pow(phi, theta / (Math.PI / 2));
        }
        case 'cornu': return null;
        default: return a + b * theta;
    }
}

function getCornuPoint(s, a) {
    const steps = 200;
    let x = 0, y = 0;
    const ds = s / steps;
    for (let i = 0; i < steps; i++) {
        const si = (i + 0.5) * ds;
        x += Math.cos(a * si * si / 2) * ds;
        y += Math.sin(a * si * si / 2) * ds;
    }
    return { x, y };
}

function hsl(h, s, l) {
    return `hsl(${h}, ${s}%, ${l}%)`;
}

function getColor(t, mode) {
    if (mode === 'rainbow') return hsl(t * 360, 80, 60);
    if (mode === 'mono') return hsl(220, 60, 50 + t * 30);
    return hsl(200 + t * 60, 90, 60);
}

function drawSpiral(type, a, b, maxTurns, maxTheta, colorMode, offsetX, offsetY, alpha) {
    const scale = Math.min(W, H) / 6;
    const steps = 2000;
    const maxT = maxTurns * Math.PI * 2;
    const drawTo = Math.min(maxTheta, maxT);

    ctx.save();
    ctx.translate(cx + offsetX, cy + offsetY);
    ctx.globalAlpha = alpha;

    if (type === 'cornu') {
        const maxS = maxTurns * 2;
        const drawS = maxS * (maxTheta / maxT);
        ctx.beginPath();
        for (let i = 0; i <= steps; i++) {
            const t = i / steps;
            const s = t * drawS;
            const pt = getCornuPoint(s, a);
            const x = pt.x * scale * 1.5;
            const y = -pt.y * scale * 1.5;
            if (i === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
        }
        ctx.strokeStyle = getColor(0.5, colorMode);
        ctx.lineWidth = 2;
        if (colorMode === 'glow') {
            ctx.shadowColor = getColor(0.5, colorMode);
            ctx.shadowBlur = 15;
        }
        ctx.stroke();
        // Negative side
        ctx.beginPath();
        for (let i = 0; i <= steps; i++) {
            const t = i / steps;
            const s = -t * drawS;
            const pt = getCornuPoint(s, a);
            const x = pt.x * scale * 1.5;
            const y = -pt.y * scale * 1.5;
            if (i === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
        }
        ctx.strokeStyle = getColor(0.7, colorMode);
        ctx.stroke();
        ctx.shadowBlur = 0;
    } else {
        let prevX, prevY;
        for (let i = 0; i <= steps; i++) {
            const t = i / steps;
            const theta = t * drawTo;
            const r = getSpiral(type, a, b, theta);
            const x = r * Math.cos(theta) * scale / (maxTurns * b + a);
            const y = -r * Math.sin(theta) * scale / (maxTurns * b + a);
            const col = getColor(t, colorMode);

            if (i > 0) {
                ctx.beginPath();
                ctx.moveTo(prevX, prevY);
                ctx.lineTo(x, y);
                ctx.strokeStyle = col;
                ctx.lineWidth = 2;
                if (colorMode === 'glow') {
                    ctx.shadowColor = col;
                    ctx.shadowBlur = 12;
                }
                ctx.stroke();
            }
            prevX = x; prevY = y;
        }
        ctx.shadowBlur = 0;

        // Tangent line
        if (showTangent && alpha === 1) {
            const thetaT = drawTo * 0.7;
            const r1 = getSpiral(type, a, b, thetaT);
            const norm = scale / (maxTurns * b + a);
            const px = r1 * Math.cos(thetaT) * norm;
            const py = -r1 * Math.sin(thetaT) * norm;

            const dt = 0.01;
            const r2 = getSpiral(type, a, b, thetaT + dt);
            const px2 = r2 * Math.cos(thetaT + dt) * norm;
            const py2 = -r2 * Math.sin(thetaT + dt) * norm;

            const dx = px2 - px, dy = py2 - py;
            const len = Math.sqrt(dx * dx + dy * dy);
            const tx = dx / len * 80, ty = dy / len * 80;

            ctx.beginPath();
            ctx.moveTo(px - tx, py - ty);
            ctx.lineTo(px + tx, py + ty);
            ctx.strokeStyle = '#ff6';
            ctx.lineWidth = 2;
            ctx.shadowColor = '#ff6';
            ctx.shadowBlur = 10;
            ctx.stroke();

            // Radial line
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.lineTo(px, py);
            ctx.strokeStyle = 'rgba(255,100,100,0.5)';
            ctx.lineWidth = 1;
            ctx.shadowBlur = 0;
            ctx.stroke();

            ctx.beginPath();
            ctx.arc(px, py, 5, 0, Math.PI * 2);
            ctx.fillStyle = '#ff6';
            ctx.shadowColor = '#ff6';
            ctx.shadowBlur = 15;
            ctx.fill();
            ctx.shadowBlur = 0;
        }

        // Fermat negative branch
        if (type === 'fermat') {
            prevX = undefined;
            for (let i = 0; i <= steps; i++) {
                const t = i / steps;
                const theta = t * drawTo;
                const r = -getSpiral(type, a, b, theta);
                const norm = scale / (maxTurns * b + a);
                const x = r * Math.cos(theta) * norm;
                const y = -r * Math.sin(theta) * norm;
                if (i > 0) {
                    ctx.beginPath();
                    ctx.moveTo(prevX, prevY);
                    ctx.lineTo(x, y);
                    ctx.strokeStyle = getColor(t, colorMode);
                    ctx.globalAlpha = alpha * 0.5;
                    ctx.lineWidth = 2;
                    ctx.stroke();
                    ctx.globalAlpha = alpha;
                }
                prevX = x; prevY = y;
            }
        }
    }
    ctx.restore();
}

function draw() {
    ctx.fillStyle = 'rgba(10,14,26,0.15)';
    ctx.fillRect(0, 0, W, H);

    if (!paused) animTheta += 0.015;
    const maxTheta = (animTheta % 1) * document.getElementById('turns').value * Math.PI * 2;
    const fullMaxTheta = document.getElementById('turns').value * Math.PI * 2;

    const type = document.getElementById('spiralType').value;
    const a = parseFloat(document.getElementById('paramA').value);
    const b = parseFloat(document.getElementById('paramB').value);
    const turns = parseInt(document.getElementById('turns').value);
    const colorMode = document.getElementById('colorMode').value;

    // Clear fully for clean draw
    ctx.fillStyle = '#0a0e1a';
    ctx.fillRect(0, 0, W, H);

    // Grid
    ctx.strokeStyle = 'rgba(138,170,255,0.05)';
    ctx.lineWidth = 1;
    for (let r = 50; r < Math.max(W, H); r += 80) {
        ctx.beginPath();
        ctx.arc(cx, cy, r, 0, Math.PI * 2);
        ctx.stroke();
    }

    if (compareMode) {
        drawSpiral(type, a, b, turns, fullMaxTheta, colorMode, 0, 0, 1);
        const types = ['archimedean', 'logarithmic', 'fermat', 'hyperbolic', 'golden', 'cornu'];
        const other = types.filter(t => t !== type)[Math.floor(animTheta) % (types.length - 1)];
        drawSpiral(other, a, b, turns, fullMaxTheta, 'mono', 0, 0, 0.4);
    } else {
        drawSpiral(type, a, b, turns, fullMaxTheta, colorMode, 0, 0, 1);
    }

    const info = spiralInfo[type];
    document.getElementById('equation').textContent = info.eq;
    document.getElementById('property').textContent = info.prop;

    requestAnimationFrame(draw);
}

document.getElementById('paramA').addEventListener('input', e => {
    document.getElementById('aVal').textContent = parseFloat(e.target.value).toFixed(1);
});
document.getElementById('paramB').addEventListener('input', e => {
    document.getElementById('bVal').textContent = parseFloat(e.target.value).toFixed(2);
});
document.getElementById('turns').addEventListener('input', e => {
    document.getElementById('turnsVal').textContent = e.target.value;
});

document.getElementById('tangentBtn').addEventListener('click', function() {
    showTangent = !showTangent;
    this.classList.toggle('active', showTangent);
});
document.getElementById('compareBtn').addEventListener('click', function() {
    compareMode = !compareMode;
    this.classList.toggle('active', compareMode);
});

window.reset = function() {
    animTheta = 0;
    showTangent = false;
    compareMode = false;
    paused = false;
    document.getElementById('spiralType').value = 'archimedean';
    document.getElementById('paramA').value = 1;
    document.getElementById('paramB').value = 0.3;
    document.getElementById('turns').value = 8;
    document.getElementById('colorMode').value = 'rainbow';
    document.getElementById('aVal').textContent = '1.0';
    document.getElementById('bVal').textContent = '0.30';
    document.getElementById('turnsVal').textContent = '8';
    document.querySelectorAll('.btn-row button').forEach(b => b.classList.remove('active'));
};

draw();
</script>
<script src="../assets/js/enhance.js"></script>
</body>
</html>