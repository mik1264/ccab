<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Maurer Rose</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
canvas { display: block; }
a { position: fixed; top: 20px; left: 20px; color: #8af; text-decoration: none; z-index: 100; font-size: 1.2em; }
a:hover { color: #bdf; }
#controls {
    position: fixed; top: 20px; right: 20px; background: rgba(10,14,26,0.7);
    backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(138,170,255,0.2); border-radius: 12px;
    padding: 18px; color: #cde; z-index: 100; min-width: 230px;
}
#controls h3 { margin-bottom: 12px; color: #8af; font-size: 1.1em; }
.ctrl { margin-bottom: 10px; }
.ctrl label { display: block; font-size: 0.82em; margin-bottom: 3px; color: #9ab; }
.ctrl input[type=range] { width: 100%; accent-color: #8af; }
.ctrl .val { float: right; color: #8af; font-size: 0.82em; }
.btn-row { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 8px; }
.btn-row button {
    flex: 1; min-width: 70px; padding: 5px 8px; background: rgba(138,170,255,0.15);
    border: 1px solid rgba(138,170,255,0.3); border-radius: 6px;
    color: #8af; cursor: pointer; font-size: 0.78em;
}
.btn-row button:hover { background: rgba(138,170,255,0.3); }
.toggle-row { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
.toggle-row label { font-size: 0.82em; color: #9ab; cursor: pointer; }
.toggle-row input { accent-color: #8af; }
select {
    width: 100%; padding: 4px; background: rgba(10,14,26,0.8); color: #8af;
    border: 1px solid rgba(138,170,255,0.3); border-radius: 4px; font-size: 0.82em;
}
#info {
    position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
    color: rgba(138,170,255,0.6); font-size: 0.85em; text-align: center;
}
</style>
</head>
<body>
<a href="index.html">&#8592; Back</a>
<canvas id="c"></canvas>
<div id="controls">
    <h3>Maurer Rose</h3>
    <div class="ctrl">
        <label>n (rose petals) <span class="val" id="nVal">6</span></label>
        <input type="range" id="nSlider" min="1" max="10" step="1" value="6">
    </div>
    <div class="ctrl">
        <label>d (step angle) <span class="val" id="dVal">71</span></label>
        <input type="range" id="dSlider" min="1" max="360" step="0.1" value="71">
    </div>
    <div class="ctrl">
        <label>Line Opacity <span class="val" id="opVal">0.4</span></label>
        <input type="range" id="opSlider" min="0.05" max="1" step="0.05" value="0.4">
    </div>
    <div class="ctrl">
        <label>Color Mode</label>
        <select id="colorMode">
            <option value="rainbow">Rainbow</option>
            <option value="single">Single Color</option>
            <option value="gradient">Gradient</option>
        </select>
    </div>
    <div class="toggle-row">
        <input type="checkbox" id="showRose" checked><label for="showRose">Show underlying rose</label>
    </div>
    <div class="toggle-row">
        <input type="checkbox" id="animateD"><label for="animateD">Animate d (morph)</label>
    </div>
    <div class="btn-row">
        <button onclick="preset(6,71)">Classic</button>
        <button onclick="preset(4,97)">Starburst</button>
        <button onclick="preset(7,121)">Web</button>
    </div>
</div>
<div id="info">Maurer Rose &mdash; r = sin(n&theta;) sampled at d&deg; steps</div>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let W, H, cx, cy, R;
let animating = true;

function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
    cx = W / 2; cy = H / 2;
    R = Math.min(W, H) * 0.4;
}

function getN() { return parseInt(document.getElementById('nSlider').value); }
function getD() { return parseFloat(document.getElementById('dSlider').value); }
function getOp() { return parseFloat(document.getElementById('opSlider').value); }
function getColorMode() { return document.getElementById('colorMode').value; }
function showRose() { return document.getElementById('showRose').checked; }
function animateD() { return document.getElementById('animateD').checked; }

function preset(n, d) {
    document.getElementById('nSlider').value = n;
    document.getElementById('nVal').textContent = n;
    document.getElementById('dSlider').value = d;
    document.getElementById('dVal').textContent = d;
}

function drawRoseCurve(n) {
    ctx.beginPath();
    for (let i = 0; i <= 3600; i++) {
        const theta = (i / 3600) * Math.PI * 2;
        const r = Math.sin(n * theta) * R;
        const x = cx + r * Math.cos(theta);
        const y = cy + r * Math.sin(theta);
        if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
    }
    ctx.strokeStyle = 'rgba(138,170,255,0.15)';
    ctx.lineWidth = 1.5;
    ctx.stroke();
}

function drawMaurerRose(n, d, opacity) {
    const mode = getColorMode();
    const totalPoints = 361;
    const pts = [];

    for (let i = 0; i <= 360; i++) {
        const thetaDeg = i * d;
        const thetaRad = (thetaDeg * Math.PI) / 180;
        const r = Math.sin(n * thetaRad) * R;
        pts.push({
            x: cx + r * Math.cos(thetaRad),
            y: cy + r * Math.sin(thetaRad)
        });
    }

    for (let i = 1; i < pts.length; i++) {
        ctx.beginPath();
        ctx.moveTo(pts[i - 1].x, pts[i - 1].y);
        ctx.lineTo(pts[i].x, pts[i].y);

        let color;
        if (mode === 'rainbow') {
            color = `hsla(${(i / pts.length) * 360}, 85%, 60%, ${opacity})`;
        } else if (mode === 'gradient') {
            const t = i / pts.length;
            const h = 200 + t * 160;
            color = `hsla(${h}, 80%, 55%, ${opacity})`;
        } else {
            color = `rgba(138,170,255,${opacity})`;
        }
        ctx.strokeStyle = color;
        ctx.lineWidth = 1;
        ctx.stroke();
    }
}

let dAnim = 71;
let dDir = 0.02;

function draw() {
    ctx.fillStyle = '#0a0e1a';
    ctx.fillRect(0, 0, W, H);

    const n = getN();
    let d = getD();

    if (animateD() && animating) {
        dAnim += dDir;
        if (dAnim > 360) dAnim = 1;
        d = dAnim;
        document.getElementById('dSlider').value = d.toFixed(1);
        document.getElementById('dVal').textContent = d.toFixed(1);
    }

    const opacity = getOp();

    if (showRose()) drawRoseCurve(n);
    drawMaurerRose(n, d, opacity);

    // Center glow
    const glow = ctx.createRadialGradient(cx, cy, 0, cx, cy, R * 0.3);
    glow.addColorStop(0, 'rgba(138,170,255,0.05)');
    glow.addColorStop(1, 'transparent');
    ctx.fillStyle = glow;
    ctx.fillRect(0, 0, W, H);

    requestAnimationFrame(draw);
}

document.getElementById('nSlider').addEventListener('input', function() {
    document.getElementById('nVal').textContent = this.value;
});
document.getElementById('dSlider').addEventListener('input', function() {
    document.getElementById('dVal').textContent = parseFloat(this.value).toFixed(1);
    dAnim = parseFloat(this.value);
});
document.getElementById('opSlider').addEventListener('input', function() {
    document.getElementById('opVal').textContent = this.value;
});

document.addEventListener('keydown', function(e) {
    if (e.code === 'Space') { e.preventDefault(); animating = !animating; }
});

window.addEventListener('resize', resize);

window.reset = function() {
    preset(6, 71);
    dAnim = 71;
    animating = true;
};

resize();
draw();
</script>
<script src="../assets/js/enhance.js"></script>
</body>
</html>
