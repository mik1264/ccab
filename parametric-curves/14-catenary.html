<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Catenary - The Hanging Chain Curve</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: 'Segoe UI', Arial, sans-serif; }
canvas { display: block; }
a.back { position: fixed; top: 20px; left: 20px; color: #8af; text-decoration: none; z-index: 100; font-size: 1.2em; }
a.back:hover { color: #bdf; }
#controls {
  position: fixed; top: 20px; right: 20px; background: rgba(10,14,26,0.8);
  backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
  padding: 18px; border-radius: 12px; color: #cde; z-index: 100;
  border: 1px solid rgba(138,170,255,0.15); min-width: 220px; font-size: 0.9em;
}
#controls h3 { margin-bottom: 10px; color: #8af; font-size: 1.05em; }
.ctrl-row { margin-bottom: 8px; }
.ctrl-row label { display: block; margin-bottom: 3px; font-size: 0.85em; color: #9ab; }
.ctrl-row input[type=range] { width: 100%; }
input[type=range] { accent-color: #8af; }
.ctrl-row .cb { display: flex; align-items: center; gap: 6px; }
.ctrl-row .cb input { accent-color: #8af; }
button { background: #1a2540; color: #8af; border: 1px solid #335; padding: 6px 14px; border-radius: 6px; cursor: pointer; width: 100%; margin-top: 4px; }
button:hover { background: #253060; }
#info {
  position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
  background: rgba(10,14,26,0.8); backdrop-filter: blur(10px);
  padding: 12px 20px; border-radius: 10px; color: #9ab; font-size: 0.82em;
  border: 1px solid rgba(138,170,255,0.1); text-align: center; max-width: 600px; z-index: 100;
}
</style>
</head>
<body>
<a href="index.html" class="back">&#8592; Back</a>
<canvas id="c"></canvas>
<div id="controls">
  <h3>Catenary</h3>
  <div class="ctrl-row">
    <label>Chain Length: <span id="lenVal">1.5</span></label>
    <input type="range" id="chainLen" min="1.05" max="3" step="0.05" value="1.5">
  </div>
  <div class="ctrl-row">
    <label>Span (drag posts): <span id="spanVal">400</span></label>
    <input type="range" id="span" min="100" max="700" step="10" value="400">
  </div>
  <div class="ctrl-row">
    <label>Gravity: <span id="gravVal">1.0</span></label>
    <input type="range" id="gravity" min="0.2" max="3" step="0.1" value="1">
  </div>
  <div class="ctrl-row">
    <div class="cb"><input type="checkbox" id="showParabola" checked><label>Show Parabola Overlay</label></div>
  </div>
  <div class="ctrl-row">
    <div class="cb"><input type="checkbox" id="showArch"><label>Show Inverted Arch</label></div>
  </div>
  <div class="ctrl-row">
    <div class="cb"><input type="checkbox" id="showPhysics" checked><label>Physics Simulation</label></div>
  </div>
  <div class="ctrl-row">
    <button id="dropBtn">Drop Chain</button>
  </div>
</div>
<div id="info">
  y = a cosh(x/a) -- NOT a parabola! The Gateway Arch in St. Louis is an inverted catenary. The catenary minimizes potential energy for a hanging chain.
</div>
<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let W, H;
function resize() { W = canvas.width = innerWidth; H = canvas.height = innerHeight; }
resize();
window.addEventListener('resize', resize);

const chainLenEl = document.getElementById('chainLen');
const spanEl = document.getElementById('span');
const gravityEl = document.getElementById('gravity');
const showParabolaEl = document.getElementById('showParabola');
const showArchEl = document.getElementById('showArch');
const showPhysicsEl = document.getElementById('showPhysics');
const dropBtn = document.getElementById('dropBtn');

chainLenEl.oninput = () => { document.getElementById('lenVal').textContent = parseFloat(chainLenEl.value).toFixed(2); initChain(); };
spanEl.oninput = () => { document.getElementById('spanVal').textContent = spanEl.value; initChain(); };
gravityEl.oninput = () => document.getElementById('gravVal').textContent = parseFloat(gravityEl.value).toFixed(1);

// Chain physics
const N = 60; // segments
let particles = [];
let settled = false;

function initChain() {
  settled = false;
  const span = parseInt(spanEl.value);
  const lenMult = parseFloat(chainLenEl.value);
  const totalLen = span * lenMult;
  const segLen = totalLen / N;

  const lx = W / 2 - span / 2;
  const rx = W / 2 + span / 2;
  const postY = H * 0.3;

  particles = [];
  for (let i = 0; i <= N; i++) {
    const frac = i / N;
    particles.push({
      x: lx + frac * span,
      y: postY, // start straight
      ox: lx + frac * span,
      oy: postY,
      pinned: i === 0 || i === N,
      segLen: segLen
    });
  }
}

function simulateChain() {
  const g = parseFloat(gravityEl.value) * 0.3;
  const iterations = 15;
  const damping = 0.99;

  if (!showPhysicsEl.checked) return;

  for (let p of particles) {
    if (p.pinned) continue;
    const vx = (p.x - p.ox) * damping;
    const vy = (p.y - p.oy) * damping + g;
    p.ox = p.x;
    p.oy = p.y;
    p.x += vx;
    p.y += vy;
  }

  // Constraint solving
  for (let iter = 0; iter < iterations; iter++) {
    for (let i = 0; i < N; i++) {
      const a = particles[i], b = particles[i + 1];
      const dx = b.x - a.x, dy = b.y - a.y;
      const dist = Math.sqrt(dx * dx + dy * dy);
      const target = a.segLen;
      if (dist < 0.001) continue;
      const diff = (dist - target) / dist * 0.5;
      const ox = dx * diff, oy = dy * diff;
      if (!a.pinned) { a.x += ox; a.y += oy; }
      if (!b.pinned) { b.x -= ox; b.y -= oy; }
    }
  }
}

// Catenary math: y = a * cosh(x/a) + c
function fitCatenary(span, sag) {
  // Find parameter 'a' such that a*cosh(span/(2a)) - a = sag
  let a = span;
  for (let i = 0; i < 50; i++) {
    const f = a * Math.cosh(span / (2 * a)) - a - sag;
    const fp = Math.cosh(span / (2 * a)) - 1 - (span / (2 * a)) * Math.sinh(span / (2 * a));
    if (Math.abs(fp) < 1e-10) break;
    a -= f / fp;
    if (a < 1) a = 1;
  }
  return a;
}

function drawPost(x, y) {
  ctx.beginPath();
  ctx.moveTo(x, y);
  ctx.lineTo(x, y + 60);
  ctx.strokeStyle = '#556';
  ctx.lineWidth = 4;
  ctx.stroke();
  // Top
  ctx.beginPath();
  ctx.arc(x, y, 5, 0, Math.PI * 2);
  ctx.fillStyle = '#8af';
  ctx.fill();
}

function animate() {
  ctx.fillStyle = '#0a0e1a';
  ctx.fillRect(0, 0, W, H);

  const span = parseInt(spanEl.value);
  const lx = W / 2 - span / 2;
  const rx = W / 2 + span / 2;
  const postY = H * 0.3;

  // Simulate
  for (let s = 0; s < 3; s++) simulateChain();

  // Draw posts
  drawPost(lx, postY);
  drawPost(rx, postY);

  // Draw chain (physics)
  ctx.beginPath();
  for (let i = 0; i <= N; i++) {
    const p = particles[i];
    i === 0 ? ctx.moveTo(p.x, p.y) : ctx.lineTo(p.x, p.y);
  }
  ctx.strokeStyle = '#ffaa44';
  ctx.lineWidth = 3;
  ctx.shadowColor = '#ffaa44';
  ctx.shadowBlur = 10;
  ctx.stroke();
  ctx.shadowBlur = 0;

  // Draw chain links
  for (let i = 0; i <= N; i += 3) {
    const p = particles[i];
    ctx.beginPath();
    ctx.arc(p.x, p.y, 2.5, 0, Math.PI * 2);
    ctx.fillStyle = '#ffcc66';
    ctx.fill();
  }

  // Compute sag from physics
  let maxY = postY;
  for (const p of particles) if (p.y > maxY) maxY = p.y;
  const sag = maxY - postY;

  if (sag > 5) {
    // Mathematical catenary
    const a = fitCatenary(span, sag);
    const catY0 = postY + sag;

    ctx.beginPath();
    for (let i = 0; i <= 200; i++) {
      const x = lx + (i / 200) * span;
      const xr = x - W / 2;
      const y = a * Math.cosh(xr / a) - a + postY;
      i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
    }
    ctx.strokeStyle = 'rgba(100,200,255,0.4)';
    ctx.lineWidth = 2;
    ctx.setLineDash([6, 4]);
    ctx.stroke();
    ctx.setLineDash([]);

    // Parabola overlay
    if (showParabolaEl.checked) {
      const pA = sag / ((span / 2) ** 2);
      ctx.beginPath();
      for (let i = 0; i <= 200; i++) {
        const x = lx + (i / 200) * span;
        const xr = x - W / 2;
        const y = postY + pA * xr * xr;
        i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
      }
      ctx.strokeStyle = 'rgba(255,80,80,0.4)';
      ctx.lineWidth = 2;
      ctx.setLineDash([3, 5]);
      ctx.stroke();
      ctx.setLineDash([]);

      // Difference highlight
      ctx.beginPath();
      for (let i = 0; i <= 200; i++) {
        const x = lx + (i / 200) * span;
        const xr = x - W / 2;
        const catYi = a * Math.cosh(xr / a) - a + postY;
        const parYi = postY + pA * xr * xr;
        const diff = (parYi - catYi) * 5; // amplified
        i === 0 ? ctx.moveTo(x, H * 0.82 + diff) : ctx.lineTo(x, H * 0.82 + diff);
      }
      ctx.strokeStyle = 'rgba(255,200,100,0.4)';
      ctx.lineWidth = 1.5;
      ctx.stroke();

      // Labels
      ctx.fillStyle = 'rgba(255,80,80,0.5)';
      ctx.font = '12px "Segoe UI", sans-serif';
      ctx.textAlign = 'right';
      ctx.fillText('Parabola (red dashed)', rx + 5, postY - 10);
      ctx.fillStyle = 'rgba(100,200,255,0.5)';
      ctx.fillText('Catenary (blue dashed)', rx + 5, postY - 25);
      ctx.fillStyle = 'rgba(255,200,100,0.4)';
      ctx.textAlign = 'center';
      ctx.fillText('Difference (amplified 5x)', W / 2, H * 0.78);
    }

    // Inverted arch
    if (showArchEl.checked) {
      const archCx = W / 2;
      const archBottom = H * 0.95;
      const archScale = 0.6;

      ctx.beginPath();
      for (let i = 0; i <= 200; i++) {
        const x = lx + (i / 200) * span;
        const xr = x - W / 2;
        const y = a * Math.cosh(xr / a) - a + postY;
        const archY = archBottom - (y - postY) * archScale;
        const archX = archCx + (x - W / 2) * archScale;
        i === 0 ? ctx.moveTo(archX, archY) : ctx.lineTo(archX, archY);
      }
      ctx.strokeStyle = 'rgba(180,140,255,0.6)';
      ctx.lineWidth = 3;
      ctx.shadowColor = '#b48cff';
      ctx.shadowBlur = 10;
      ctx.stroke();
      ctx.shadowBlur = 0;

      // Ground for arch
      ctx.beginPath();
      ctx.moveTo(archCx - span * archScale / 2 - 20, archBottom);
      ctx.lineTo(archCx + span * archScale / 2 + 20, archBottom);
      ctx.strokeStyle = 'rgba(255,255,255,0.1)';
      ctx.lineWidth = 1;
      ctx.stroke();

      ctx.fillStyle = 'rgba(180,140,255,0.4)';
      ctx.font = '12px "Segoe UI", sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText('Inverted Catenary (ideal arch)', archCx, archBottom + 15);
    }
  }

  // Equation display
  ctx.fillStyle = 'rgba(200,220,240,0.4)';
  ctx.font = '15px "Segoe UI", sans-serif';
  ctx.textAlign = 'center';
  ctx.fillText('y = a \u00B7 cosh(x / a)', W / 2, 50);

  requestAnimationFrame(animate);
}

dropBtn.onclick = initChain;
window.reset = function() { initChain(); };

initChain();
animate();
</script>
<script src="../assets/js/enhance.js"></script>
</body>
</html>
