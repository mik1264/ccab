<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Astroid & Deltoid</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: 'Segoe UI', system-ui, sans-serif; }
canvas { display: block; }
a { position: fixed; top: 20px; left: 20px; color: #8af; text-decoration: none; z-index: 100; font-size: 1.2em; }
a:hover { color: #bdf; }
#controls {
    position: fixed; top: 20px; right: 20px; background: rgba(10,14,26,0.85);
    backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(138,170,255,0.15); border-radius: 12px;
    padding: 16px; color: #cde; z-index: 100; width: 240px; font-size: 13px;
}
#controls h3 { color: #8af; margin-bottom: 10px; font-size: 14px; }
.ctrl-group { margin-bottom: 10px; }
.ctrl-group label { display: block; margin-bottom: 3px; color: #9ab; font-size: 12px; }
.ctrl-group select, .ctrl-group input[type=range] { width: 100%; }
select { background: rgba(30,40,70,0.8); color: #cde; border: 1px solid rgba(138,170,255,0.2); border-radius: 6px; padding: 4px; }
.toggle-row { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
.toggle-row input { accent-color: #8af; }
.toggle-row label { color: #9ab; font-size: 12px; }
.btn-row { display: flex; gap: 6px; margin-top: 8px; }
.btn-row button {
    flex: 1; padding: 5px 8px; background: rgba(60,80,140,0.4);
    color: #8af; border: 1px solid rgba(138,170,255,0.2); border-radius: 6px;
    cursor: pointer; font-size: 11px;
}
.btn-row button:hover { background: rgba(80,100,180,0.5); }
#label {
    position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
    color: #8af; font-size: 16px; font-family: Georgia, serif; font-style: italic;
    text-shadow: 0 0 20px rgba(138,170,255,0.5); z-index: 100;
    background: rgba(10,14,26,0.7); backdrop-filter: blur(10px);
    padding: 8px 20px; border-radius: 16px; border: 1px solid rgba(138,170,255,0.1);
}
</style>
</head>
<body>
<a href="index.html">&#8592; Back</a>
<canvas id="canvas"></canvas>
<div id="controls">
    <h3>Astroid & Deltoid</h3>
    <div class="ctrl-group">
        <label>Cusps: <span id="cuspsVal">4</span></label>
        <input type="range" id="cusps" min="3" max="8" step="1" value="4">
    </div>
    <div class="ctrl-group">
        <label>Speed: <span id="speedVal">1.0</span></label>
        <input type="range" id="speed" min="0.2" max="3" step="0.1" value="1">
    </div>
    <div class="ctrl-group">
        <label>Color</label>
        <select id="colorMode">
            <option value="neon">Neon Glow</option>
            <option value="rainbow">Rainbow</option>
            <option value="fire">Fire</option>
        </select>
    </div>
    <div class="toggle-row"><input type="checkbox" id="showMech" checked><label for="showMech">Rolling circle mechanism</label></div>
    <div class="toggle-row"><input type="checkbox" id="showSlide"><label for="showSlide">Sliding line (astroid)</label></div>
    <div class="btn-row">
        <button id="resetBtn">Reset Animation</button>
    </div>
</div>
<div id="label">Astroid (4 cusps) - Hypocycloid</div>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let W, H, cx, cy;
let angle = 0;
let trail = [];
let slideTrail = [];
let paused = false;

const names = { 3: 'Deltoid', 4: 'Astroid', 5: 'Pentacycloid', 6: 'Hexacycloid', 7: 'Heptacycloid', 8: 'Octacycloid' };

function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
    cx = W / 2;
    cy = H / 2;
}
resize();
window.addEventListener('resize', () => { resize(); trail = []; slideTrail = []; });

function hsl(h, s, l, a) { return `hsla(${h},${s}%,${l}%,${a !== undefined ? a : 1})`; }

function getColor(t, mode) {
    if (mode === 'rainbow') return hsl(t * 360, 85, 60);
    if (mode === 'fire') return hsl(t * 60, 90, 50 + t * 20);
    return hsl(200 + t * 80, 90, 60);
}

function hypocycloidPoint(R, n, t) {
    const r = R / n;
    const x = (R - r) * Math.cos(t) + r * Math.cos((R - r) / r * t);
    const y = (R - r) * Math.sin(t) + r * Math.sin((R - r) / r * t);
    return { x, y };
}

function draw() {
    ctx.fillStyle = '#0a0e1a';
    ctx.fillRect(0, 0, W, H);

    const n = parseInt(document.getElementById('cusps').value);
    const speed = parseFloat(document.getElementById('speed').value);
    const colorMode = document.getElementById('colorMode').value;
    const showMech = document.getElementById('showMech').checked;
    const showSlide = document.getElementById('showSlide').checked;

    const R = Math.min(W, H) * 0.32;
    const r = R / n;

    if (!paused) angle += 0.015 * speed;

    // Outer circle
    ctx.beginPath();
    ctx.arc(cx, cy, R, 0, Math.PI * 2);
    ctx.strokeStyle = 'rgba(138,170,255,0.15)';
    ctx.lineWidth = 1;
    ctx.stroke();

    // Full curve (static)
    const fullSteps = 1000;
    ctx.beginPath();
    for (let i = 0; i <= fullSteps; i++) {
        const t = (i / fullSteps) * Math.PI * 2;
        const pt = hypocycloidPoint(R, n, t);
        if (i === 0) ctx.moveTo(cx + pt.x, cy + pt.y);
        else ctx.lineTo(cx + pt.x, cy + pt.y);
    }
    ctx.closePath();
    ctx.strokeStyle = 'rgba(138,170,255,0.08)';
    ctx.lineWidth = 1;
    ctx.stroke();

    // Animated trail
    const pt = hypocycloidPoint(R, n, angle);
    trail.push({ x: pt.x, y: pt.y, t: angle });
    if (trail.length > 2000) trail.shift();

    // Draw glowing trail
    for (let i = 1; i < trail.length; i++) {
        const alpha = i / trail.length;
        const t = i / trail.length;
        ctx.beginPath();
        ctx.moveTo(cx + trail[i - 1].x, cy + trail[i - 1].y);
        ctx.lineTo(cx + trail[i].x, cy + trail[i].y);
        ctx.strokeStyle = getColor(t, colorMode);
        ctx.lineWidth = 2.5;
        ctx.globalAlpha = alpha * 0.8;
        ctx.shadowColor = getColor(t, colorMode);
        ctx.shadowBlur = 10;
        ctx.stroke();
    }
    ctx.globalAlpha = 1;
    ctx.shadowBlur = 0;

    // Rolling circle mechanism
    if (showMech) {
        const innerCx = (R - r) * Math.cos(angle);
        const innerCy = (R - r) * Math.sin(angle);

        // Inner circle
        ctx.beginPath();
        ctx.arc(cx + innerCx, cy + innerCy, r, 0, Math.PI * 2);
        ctx.strokeStyle = 'rgba(255,200,100,0.5)';
        ctx.lineWidth = 1.5;
        ctx.stroke();

        // Center of rolling circle
        ctx.beginPath();
        ctx.arc(cx + innerCx, cy + innerCy, 3, 0, Math.PI * 2);
        ctx.fillStyle = '#fa8';
        ctx.fill();

        // Line from center to tracing point
        ctx.beginPath();
        ctx.moveTo(cx + innerCx, cy + innerCy);
        ctx.lineTo(cx + pt.x, cy + pt.y);
        ctx.strokeStyle = 'rgba(255,200,100,0.6)';
        ctx.lineWidth = 1;
        ctx.stroke();

        // Tracing point (glowing)
        ctx.beginPath();
        ctx.arc(cx + pt.x, cy + pt.y, 5, 0, Math.PI * 2);
        ctx.fillStyle = '#fff';
        ctx.shadowColor = '#fff';
        ctx.shadowBlur = 20;
        ctx.fill();
        ctx.shadowBlur = 0;
    }

    // Sliding line segment (for astroid)
    if (showSlide && n === 4) {
        const slideAngle = angle * 1.3;
        const L = R;
        const ax = L * Math.cos(slideAngle);
        const ay = 0;
        const bx = 0;
        const by = L * Math.sin(slideAngle);

        ctx.beginPath();
        ctx.moveTo(cx + ax, cy);
        ctx.lineTo(cx, cy + by);
        ctx.strokeStyle = 'rgba(100,255,200,0.6)';
        ctx.lineWidth = 2;
        ctx.shadowColor = '#6fc';
        ctx.shadowBlur = 8;
        ctx.stroke();
        ctx.shadowBlur = 0;

        // Endpoints
        ctx.beginPath();
        ctx.arc(cx + ax, cy, 4, 0, Math.PI * 2);
        ctx.fillStyle = '#6fc';
        ctx.fill();
        ctx.beginPath();
        ctx.arc(cx, cy + by, 4, 0, Math.PI * 2);
        ctx.fillStyle = '#6fc';
        ctx.fill();

        // Axes
        ctx.beginPath();
        ctx.moveTo(cx - R * 1.2, cy);
        ctx.lineTo(cx + R * 1.2, cy);
        ctx.moveTo(cx, cy - R * 1.2);
        ctx.lineTo(cx, cy + R * 1.2);
        ctx.strokeStyle = 'rgba(138,170,255,0.1)';
        ctx.lineWidth = 1;
        ctx.stroke();
    }

    // Cusp glow effects
    for (let i = 0; i < n; i++) {
        const cuspAngle = (i / n) * Math.PI * 2;
        const cpt = hypocycloidPoint(R, n, cuspAngle);
        const pulse = 0.7 + 0.3 * Math.sin(angle * 3 + i);
        ctx.beginPath();
        ctx.arc(cx + cpt.x, cy + cpt.y, 6 * pulse, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(255,140,100,${0.4 * pulse})`;
        ctx.shadowColor = '#f86';
        ctx.shadowBlur = 20 * pulse;
        ctx.fill();
        ctx.shadowBlur = 0;
    }

    // Label
    const name = names[n] || n + '-cusp Hypocycloid';
    document.getElementById('label').textContent = name + ' (' + n + ' cusps) \u2014 r = R/' + n + ' rolling inside R';

    requestAnimationFrame(draw);
}

document.getElementById('cusps').addEventListener('input', e => {
    document.getElementById('cuspsVal').textContent = e.target.value;
    trail = [];
    slideTrail = [];
    angle = 0;
});
document.getElementById('speed').addEventListener('input', e => {
    document.getElementById('speedVal').textContent = parseFloat(e.target.value).toFixed(1);
});
document.getElementById('resetBtn').addEventListener('click', () => {
    trail = [];
    slideTrail = [];
    angle = 0;
});

window.reset = function() {
    angle = 0;
    trail = [];
    slideTrail = [];
    paused = false;
    document.getElementById('cusps').value = 4;
    document.getElementById('cuspsVal').textContent = '4';
    document.getElementById('speed').value = 1;
    document.getElementById('speedVal').textContent = '1.0';
    document.getElementById('colorMode').value = 'neon';
    document.getElementById('showMech').checked = true;
    document.getElementById('showSlide').checked = false;
};

draw();
</script>
<script src="../assets/js/enhance.js"></script>
</body>
</html>