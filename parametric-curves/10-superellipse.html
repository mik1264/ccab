<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Superellipse (Lam&eacute; Curves)</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
canvas { display: block; }
a { position: fixed; top: 20px; left: 20px; color: #8af; text-decoration: none; z-index: 100; font-size: 1.2em; }
a:hover { color: #bdf; }
#controls {
    position: fixed; top: 20px; right: 20px; background: rgba(10,14,26,0.7);
    backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(138,170,255,0.2); border-radius: 12px;
    padding: 18px; color: #cde; z-index: 100; min-width: 230px;
}
#controls h3 { margin-bottom: 12px; color: #8af; font-size: 1.1em; }
.ctrl { margin-bottom: 10px; }
.ctrl label { display: block; font-size: 0.82em; margin-bottom: 3px; color: #9ab; }
.ctrl input[type=range] { width: 100%; accent-color: #8af; }
.ctrl .val { float: right; color: #8af; font-size: 0.82em; }
.toggle-row { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
.toggle-row label { font-size: 0.82em; color: #9ab; cursor: pointer; }
.toggle-row input { accent-color: #8af; }
#nDisplay {
    position: fixed; top: 50%; left: 50%; transform: translate(-50%,-50%);
    font-size: 3em; color: rgba(138,170,255,0.25); pointer-events: none;
    z-index: 50; font-weight: 300;
}
#shapeName {
    position: fixed; bottom: 70px; left: 50%; transform: translateX(-50%);
    color: rgba(138,170,255,0.5); font-size: 1.1em; z-index: 50;
}
#info {
    position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
    color: rgba(138,170,255,0.5); font-size: 0.82em; text-align: center;
    max-width: 500px;
}
</style>
</head>
<body>
<a href="index.html">&#8592; Back</a>
<canvas id="c"></canvas>
<div id="nDisplay">n = 2.5</div>
<div id="shapeName">Squircle</div>
<div id="controls">
    <h3>Superellipse</h3>
    <div class="ctrl">
        <label>n (exponent) <span class="val" id="nVal">2.5</span></label>
        <input type="range" id="nSlider" min="0.1" max="10" step="0.05" value="2.5">
    </div>
    <div class="ctrl">
        <label>a (width) <span class="val" id="aVal">1</span></label>
        <input type="range" id="aSlider" min="0.3" max="2" step="0.05" value="1">
    </div>
    <div class="ctrl">
        <label>b (height) <span class="val" id="bVal">1</span></label>
        <input type="range" id="bSlider" min="0.3" max="2" step="0.05" value="1">
    </div>
    <div class="toggle-row">
        <input type="checkbox" id="fillToggle" checked><label for="fillToggle">Fill shape</label>
    </div>
    <div class="toggle-row">
        <input type="checkbox" id="morphToggle"><label for="morphToggle">Auto-morph n</label>
    </div>
    <div class="toggle-row">
        <input type="checkbox" id="gridToggle"><label for="gridToggle">Comparison grid</label>
    </div>
</div>
<div id="info">|x/a|^n + |y/b|^n = 1 &mdash; Piet Hein used n=2.5 for Sergels Torg, Stockholm</div>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let W, H, cx, cy, R;
let animating = true;
let morphN = 2.5;
let morphDir = 0.01;
let morphMin = 0.3;
let morphMax = 5;

function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
    cx = W / 2; cy = H / 2;
    R = Math.min(W, H) * 0.32;
}

function getN() { return parseFloat(document.getElementById('nSlider').value); }
function getA() { return parseFloat(document.getElementById('aSlider').value); }
function getB() { return parseFloat(document.getElementById('bSlider').value); }
function doFill() { return document.getElementById('fillToggle').checked; }
function doMorph() { return document.getElementById('morphToggle').checked; }
function doGrid() { return document.getElementById('gridToggle').checked; }

function sgn(x) { return x > 0 ? 1 : x < 0 ? -1 : 0; }

function superellipsePoints(n, a, b, scale, ocx, ocy) {
    const pts = [];
    const steps = 500;
    for (let i = 0; i <= steps; i++) {
        const t = (i / steps) * Math.PI * 2;
        const cosT = Math.cos(t);
        const sinT = Math.sin(t);
        const x = ocx + sgn(cosT) * a * scale * Math.pow(Math.abs(cosT), 2 / n);
        const y = ocy + sgn(sinT) * b * scale * Math.pow(Math.abs(sinT), 2 / n);
        pts.push({ x, y });
    }
    return pts;
}

function getShapeName(n) {
    if (n < 0.5) return 'Concave Star';
    if (Math.abs(n - 0.667) < 0.05) return 'Astroid (n=2/3)';
    if (n < 1) return 'Concave Shape';
    if (Math.abs(n - 1) < 0.05) return 'Diamond (n=1)';
    if (n < 2) return 'Rounded Diamond';
    if (Math.abs(n - 2) < 0.05) return 'Ellipse (n=2)';
    if (Math.abs(n - 2.5) < 0.15) return 'Squircle (n\u22482.5)';
    if (n < 4) return 'Superellipse';
    return 'Near-Rectangle (n\u2192\u221e)';
}

function getColor(n) {
    if (n < 2) {
        const t = (n - 0.1) / 1.9;
        return { h: 0 + t * 60, s: 80, l: 55 }; // warm
    } else {
        const t = Math.min(1, (n - 2) / 8);
        return { h: 180 + t * 80, s: 75, l: 55 }; // cool
    }
}

function drawShape(n, a, b, scale, ocx, ocy, fill, outline, lw) {
    const pts = superellipsePoints(n, a, b, scale, ocx, ocy);
    const col = getColor(n);
    const hsl = `hsl(${col.h}, ${col.s}%, ${col.l}%)`;
    const hsla = `hsla(${col.h}, ${col.s}%, ${col.l}%, 0.2)`;

    ctx.beginPath();
    pts.forEach((p, i) => i === 0 ? ctx.moveTo(p.x, p.y) : ctx.lineTo(p.x, p.y));
    ctx.closePath();

    if (fill) {
        const grad = ctx.createRadialGradient(ocx, ocy, 0, ocx, ocy, scale);
        grad.addColorStop(0, `hsla(${col.h}, ${col.s}%, ${col.l + 20}%, 0.35)`);
        grad.addColorStop(1, `hsla(${col.h}, ${col.s}%, ${col.l}%, 0.08)`);
        ctx.fillStyle = grad;
        ctx.fill();
    }

    if (outline) {
        ctx.strokeStyle = hsl;
        ctx.lineWidth = lw || 2.5;
        ctx.shadowColor = hsl;
        ctx.shadowBlur = 10;
        ctx.stroke();
        ctx.shadowBlur = 0;
    }
}

function drawGrid() {
    const gridN = [0.5, 0.667, 1, 1.5, 2, 2.5, 3, 5, 10];
    const cols = 3;
    const rows = 3;
    const cellW = W / (cols + 0.5);
    const cellH = H / (rows + 0.5);
    const cellR = Math.min(cellW, cellH) * 0.35;

    gridN.forEach((n, idx) => {
        const col = idx % cols;
        const row = Math.floor(idx / cols);
        const gcx = cellW * (col + 0.75);
        const gcy = cellH * (row + 0.75);

        drawShape(n, 1, 1, cellR, gcx, gcy, true, true, 1.5);

        // Label
        ctx.fillStyle = 'rgba(138,170,255,0.6)';
        ctx.font = '12px Segoe UI';
        ctx.textAlign = 'center';
        ctx.fillText(`n = ${n}`, gcx, gcy + cellR + 18);
    });
}

function draw() {
    ctx.fillStyle = '#0a0e1a';
    ctx.fillRect(0, 0, W, H);

    if (doGrid()) {
        drawGrid();
        requestAnimationFrame(draw);
        return;
    }

    let n = getN();

    if (doMorph() && animating) {
        morphN += morphDir;
        if (morphN >= morphMax) morphDir = -0.01;
        if (morphN <= morphMin) morphDir = 0.01;
        n = morphN;
        document.getElementById('nSlider').value = n.toFixed(2);
        document.getElementById('nVal').textContent = n.toFixed(2);
    }

    const a = getA();
    const b = getB();

    // Update displays
    document.getElementById('nDisplay').textContent = `n = ${n.toFixed(2)}`;
    document.getElementById('shapeName').textContent = getShapeName(n);

    // Draw main shape
    drawShape(n, a, b, R, cx, cy, doFill(), true, 3);

    // Draw ghost shapes for context
    const ghostNs = [1, 2, 2.5];
    ghostNs.forEach(gn => {
        if (Math.abs(gn - n) > 0.2) {
            const pts = superellipsePoints(gn, a, b, R, cx, cy);
            ctx.beginPath();
            pts.forEach((p, i) => i === 0 ? ctx.moveTo(p.x, p.y) : ctx.lineTo(p.x, p.y));
            ctx.closePath();
            ctx.strokeStyle = 'rgba(138,170,255,0.06)';
            ctx.lineWidth = 1;
            ctx.stroke();
        }
    });

    // Center glow
    const col = getColor(n);
    const glow = ctx.createRadialGradient(cx, cy, 0, cx, cy, R * 0.5);
    glow.addColorStop(0, `hsla(${col.h}, ${col.s}%, ${col.l}%, 0.06)`);
    glow.addColorStop(1, 'transparent');
    ctx.fillStyle = glow;
    ctx.fillRect(0, 0, W, H);

    requestAnimationFrame(draw);
}

['nSlider','aSlider','bSlider'].forEach(id => {
    document.getElementById(id).addEventListener('input', function() {
        document.getElementById(id.replace('Slider','Val')).textContent = this.value;
        if (id === 'nSlider') morphN = parseFloat(this.value);
    });
});

document.addEventListener('keydown', function(e) {
    if (e.code === 'Space') { e.preventDefault(); animating = !animating; }
});

window.addEventListener('resize', resize);

window.reset = function() {
    document.getElementById('nSlider').value = 2.5;
    document.getElementById('nVal').textContent = '2.5';
    document.getElementById('aSlider').value = 1;
    document.getElementById('aVal').textContent = '1';
    document.getElementById('bSlider').value = 1;
    document.getElementById('bVal').textContent = '1';
    morphN = 2.5;
    morphDir = 0.01;
    animating = true;
};

resize();
draw();
</script>
<script src="../assets/js/enhance.js"></script>
</body>
</html>
