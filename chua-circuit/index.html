<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chua's Circuit - Double Scroll Attractor - CCAB</title>
    <meta name="description" content="Interactive visualization of Chua's circuit chaotic attractor. Explore the famous double scroll pattern discovered by Leon Chua, one of the simplest electronic circuits exhibiting chaos.">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0d0d1a 0%, #1a1a2e 100%);
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
        }

        canvas {
            display: block;
        }

        .back-link {
            position: fixed;
            top: 15px;
            left: 15px;
            padding: 10px 18px;
            background: rgba(0, 0, 0, 0.6);
            color: #ff6347;
            text-decoration: none;
            border-radius: 8px;
            font-size: 14px;
            z-index: 1000;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 99, 71, 0.3);
            transition: all 0.3s ease;
        }

        .back-link:hover {
            background: rgba(255, 99, 71, 0.2);
            transform: translateX(-4px);
        }

        #info {
            position: fixed;
            top: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.85);
            padding: 15px 20px;
            border-radius: 12px;
            color: #ff6347;
            font-size: 13px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 99, 71, 0.2);
            z-index: 1000;
            max-width: 300px;
        }

        #info h3 {
            margin-bottom: 10px;
            color: #ff7f66;
        }

        #info .stat {
            margin: 5px 0;
        }

        #info .stat-label {
            color: #888;
            font-size: 11px;
        }

        #info .stat-value {
            color: #ff6347;
            font-weight: bold;
        }

        #info p {
            font-size: 11px;
            opacity: 0.8;
            line-height: 1.5;
            margin-top: 10px;
            color: #aaa;
        }

        .equations {
            background: rgba(255, 99, 71, 0.1);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-family: 'Times New Roman', serif;
            font-size: 12px;
            color: #ff7f66;
            line-height: 1.6;
        }

        #presets {
            position: fixed;
            top: 400px;
            right: 15px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            z-index: 1000;
        }

        button {
            background: rgba(255, 99, 71, 0.15);
            border: 1px solid rgba(255, 99, 71, 0.4);
            color: #ff6347;
            padding: 8px 14px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.3s;
            text-align: left;
        }

        button:hover {
            background: rgba(255, 99, 71, 0.3);
        }

        button.active {
            background: rgba(255, 99, 71, 0.4);
            border-color: #ff6347;
        }

        #controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 12px;
            z-index: 1000;
            flex-wrap: wrap;
            justify-content: center;
        }

        .control-group {
            background: rgba(0, 0, 0, 0.7);
            padding: 12px 16px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 99, 71, 0.2);
        }

        .control-group label {
            color: #ff6347;
            font-size: 11px;
            display: block;
            margin-bottom: 5px;
        }

        .control-group input[type="range"] {
            width: 80px;
            accent-color: #ff6347;
        }

        .control-group span {
            color: #fff;
            font-size: 10px;
            margin-left: 6px;
        }

        .control-btn {
            padding: 10px 16px;
        }

        #fps-display {
            position: fixed;
            bottom: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.6);
            padding: 8px 12px;
            border-radius: 6px;
            color: #ff6347;
            font-size: 12px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <a href="../index.html" class="back-link">← Back to Gallery</a>

    <canvas id="canvas"></canvas>

    <div id="info">
        <h3>Chua's Circuit</h3>
        <div class="stat">
            <span class="stat-label">Parameter α</span>
            <span class="stat-value" id="alpha">15.6</span>
        </div>
        <div class="stat">
            <span class="stat-label">Parameter β</span>
            <span class="stat-value" id="beta">28.0</span>
        </div>
        <div class="stat">
            <span class="stat-label">Time Step</span>
            <span class="stat-value" id="dt">0.01</span>
        </div>
        <div class="stat">
            <span class="stat-label">Trail Length</span>
            <span class="stat-value" id="trail-len">5000</span>
        </div>
        <div class="equations">
            dx/dt = α(y - x - h(x))<br>
            dy/dt = x - y + z<br>
            dz/dt = -βy<br>
            h(x) = m₁x + ½(m₀-m₁)(|x+1| - |x-1|)
        </div>
        <p>Chua's circuit is one of the simplest electronic circuits exhibiting chaos. Discovered by Leon Chua in 1983, it produces the famous "double scroll" strange attractor.</p>
    </div>

    <div id="presets">
        <button class="active" data-preset="double-scroll">Double Scroll</button>
        <button data-preset="period-1">Period-1 Orbit</button>
        <button data-preset="period-2">Period-2 Orbit</button>
        <button data-preset="single-scroll">Single Scroll</button>
        <button data-preset="spiral">Spiral</button>
    </div>

    <div id="controls">
        <div class="control-group">
            <label>α: <span id="alpha-val">15.6</span></label>
            <input type="range" id="alpha-slider" min="8" max="20" step="0.1" value="15.6">
        </div>
        <div class="control-group">
            <label>β: <span id="beta-val">28.0</span></label>
            <input type="range" id="beta-slider" min="15" max="40" step="0.1" value="28">
        </div>
        <div class="control-group">
            <label>Trail: <span id="trail-val">5000</span></label>
            <input type="range" id="trail-slider" min="1000" max="20000" step="500" value="5000">
        </div>
        <div class="control-group">
            <label>Speed: <span id="speed-val">5</span></label>
            <input type="range" id="speed-slider" min="1" max="20" value="5">
        </div>
        <button class="control-btn" id="reset-btn">Reset</button>
        <button class="control-btn" id="pause-btn">Pause</button>
    </div>

    <div id="fps-display">FPS: <span id="fps">0</span></div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // Chua's circuit parameters
        let alpha = 15.6;
        let beta = 28.0;
        const m0 = -1.143;
        const m1 = -0.714;

        // State variables
        let x = 0.7, y = 0, z = 0;
        let dt = 0.01;
        let trailLength = 5000;
        let speed = 5;
        let running = true;

        // Trail storage (3D points projected to 2D)
        let trail = [];

        // View rotation
        let rotX = 0.3;
        let rotY = 0.5;
        let zoom = 100;

        // Presets
        const presets = {
            'double-scroll': { alpha: 15.6, beta: 28.0, x: 0.7, y: 0, z: 0 },
            'period-1': { alpha: 8.4, beta: 12.0, x: 0.1, y: 0.1, z: 0 },
            'period-2': { alpha: 9.5, beta: 14.3, x: 0.1, y: 0.1, z: 0 },
            'single-scroll': { alpha: 10.0, beta: 14.87, x: 0.1, y: 0, z: 0 },
            'spiral': { alpha: 12.0, beta: 17.0, x: 0.5, y: 0.5, z: 0 }
        };

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        // Chua's diode nonlinearity
        function h(x) {
            return m1 * x + 0.5 * (m0 - m1) * (Math.abs(x + 1) - Math.abs(x - 1));
        }

        // Chua's circuit equations
        function dxdt(x, y, z) {
            return alpha * (y - x - h(x));
        }

        function dydt(x, y, z) {
            return x - y + z;
        }

        function dzdt(x, y, z) {
            return -beta * y;
        }

        // Runge-Kutta 4th order integration
        function rk4Step() {
            const k1x = dt * dxdt(x, y, z);
            const k1y = dt * dydt(x, y, z);
            const k1z = dt * dzdt(x, y, z);

            const k2x = dt * dxdt(x + k1x/2, y + k1y/2, z + k1z/2);
            const k2y = dt * dydt(x + k1x/2, y + k1y/2, z + k1z/2);
            const k2z = dt * dzdt(x + k1x/2, y + k1y/2, z + k1z/2);

            const k3x = dt * dxdt(x + k2x/2, y + k2y/2, z + k2z/2);
            const k3y = dt * dydt(x + k2x/2, y + k2y/2, z + k2z/2);
            const k3z = dt * dzdt(x + k2x/2, y + k2y/2, z + k2z/2);

            const k4x = dt * dxdt(x + k3x, y + k3y, z + k3z);
            const k4y = dt * dydt(x + k3x, y + k3y, z + k3z);
            const k4z = dt * dzdt(x + k3x, y + k3y, z + k3z);

            x += (k1x + 2*k2x + 2*k3x + k4x) / 6;
            y += (k1y + 2*k2y + 2*k3y + k4y) / 6;
            z += (k1z + 2*k2z + 2*k3z + k4z) / 6;
        }

        // 3D to 2D projection with rotation
        function project(px, py, pz) {
            // Rotate around Y axis
            const cosY = Math.cos(rotY);
            const sinY = Math.sin(rotY);
            let x1 = px * cosY - pz * sinY;
            let z1 = px * sinY + pz * cosY;

            // Rotate around X axis
            const cosX = Math.cos(rotX);
            const sinX = Math.sin(rotX);
            let y1 = py * cosX - z1 * sinX;
            let z2 = py * sinX + z1 * cosX;

            // Perspective projection
            const perspective = 500;
            const scale = perspective / (perspective + z2);

            return {
                x: canvas.width / 2 + x1 * zoom * scale,
                y: canvas.height / 2 - y1 * zoom * scale,
                z: z2
            };
        }

        function render() {
            ctx.fillStyle = 'rgba(13, 13, 26, 0.15)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            if (trail.length < 2) return;

            // Draw trail with depth-based color
            for (let i = 1; i < trail.length; i++) {
                const p1 = project(trail[i-1].x, trail[i-1].y, trail[i-1].z);
                const p2 = project(trail[i].x, trail[i].y, trail[i].z);

                const alpha = i / trail.length;
                const hue = (p2.z + 5) * 20 + 10; // Color based on z depth

                ctx.beginPath();
                ctx.moveTo(p1.x, p1.y);
                ctx.lineTo(p2.x, p2.y);
                ctx.strokeStyle = `hsla(${hue}, 100%, 60%, ${alpha * 0.8})`;
                ctx.lineWidth = 1 + alpha;
                ctx.stroke();
            }

            // Draw current point
            const current = project(x, y, z);
            ctx.beginPath();
            ctx.arc(current.x, current.y, 4, 0, Math.PI * 2);
            ctx.fillStyle = '#fff';
            ctx.fill();
        }

        function updateStats() {
            document.getElementById('alpha').textContent = alpha.toFixed(1);
            document.getElementById('beta').textContent = beta.toFixed(1);
            document.getElementById('trail-len').textContent = trailLength;
        }

        // FPS tracking
        let lastTime = 0;
        let frameCount = 0;
        let fps = 0;

        function animate(currentTime) {
            requestAnimationFrame(animate);

            // FPS calculation
            frameCount++;
            if (currentTime - lastTime >= 1000) {
                fps = frameCount;
                frameCount = 0;
                lastTime = currentTime;
                document.getElementById('fps').textContent = fps;
            }

            if (!running) return;

            // Multiple integration steps per frame
            for (let i = 0; i < speed; i++) {
                rk4Step();
                trail.push({ x, y, z });
            }

            // Trim trail
            while (trail.length > trailLength) {
                trail.shift();
            }

            // Slow rotation
            rotY += 0.001;

            render();
        }

        function reset() {
            trail = [];
            x = 0.7;
            y = 0;
            z = 0;
        }

        // Event listeners
        document.getElementById('alpha-slider').addEventListener('input', (e) => {
            alpha = parseFloat(e.target.value);
            document.getElementById('alpha-val').textContent = alpha.toFixed(1);
            updateStats();
            reset();
        });

        document.getElementById('beta-slider').addEventListener('input', (e) => {
            beta = parseFloat(e.target.value);
            document.getElementById('beta-val').textContent = beta.toFixed(1);
            updateStats();
            reset();
        });

        document.getElementById('trail-slider').addEventListener('input', (e) => {
            trailLength = parseInt(e.target.value);
            document.getElementById('trail-val').textContent = trailLength;
            updateStats();
        });

        document.getElementById('speed-slider').addEventListener('input', (e) => {
            speed = parseInt(e.target.value);
            document.getElementById('speed-val').textContent = speed;
        });

        document.getElementById('reset-btn').addEventListener('click', reset);

        document.getElementById('pause-btn').addEventListener('click', () => {
            running = !running;
            document.getElementById('pause-btn').textContent = running ? 'Pause' : 'Resume';
        });

        // Preset buttons
        document.querySelectorAll('#presets button').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('#presets button').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                const preset = presets[btn.dataset.preset];
                alpha = preset.alpha;
                beta = preset.beta;
                x = preset.x;
                y = preset.y;
                z = preset.z;

                document.getElementById('alpha-slider').value = alpha;
                document.getElementById('beta-slider').value = beta;
                document.getElementById('alpha-val').textContent = alpha.toFixed(1);
                document.getElementById('beta-val').textContent = beta.toFixed(1);

                updateStats();
                reset();
            });
        });

        // Mouse drag for rotation
        let isDragging = false;
        let lastMouseX, lastMouseY;

        canvas.addEventListener('mousedown', (e) => {
            isDragging = true;
            lastMouseX = e.clientX;
            lastMouseY = e.clientY;
        });

        canvas.addEventListener('mousemove', (e) => {
            if (!isDragging) return;

            rotY += (e.clientX - lastMouseX) * 0.005;
            rotX += (e.clientY - lastMouseY) * 0.005;

            lastMouseX = e.clientX;
            lastMouseY = e.clientY;
        });

        canvas.addEventListener('mouseup', () => isDragging = false);
        canvas.addEventListener('mouseleave', () => isDragging = false);

        // Zoom with scroll
        canvas.addEventListener('wheel', (e) => {
            e.preventDefault();
            zoom *= e.deltaY > 0 ? 0.9 : 1.1;
            zoom = Math.max(20, Math.min(300, zoom));
        });

        // Initialize
        window.addEventListener('resize', resize);
        resize();
        updateStats();
        animate(0);
    </script>
</body>
</html>
