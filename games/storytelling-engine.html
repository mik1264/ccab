<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Combinatorial Storytelling Engine - CCAB</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&family=Nunito:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --sage: #8A9A5B;
            --moss: #606C38;
            --earth: #DDA15E;
            --cream: #FEFAE0;
            --terracotta: #BC6C25;
            --dark-moss: #3d4423;
            --parchment: #F5F0E1;
            --ink: #2C2416;
            --gold: #C9A227;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #FEFAE0 0%, #F4F1DE 50%, #EDE8D5 100%);
            color: var(--dark-moss);
            line-height: 1.7;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Animated organic background shapes */
        .organic-shape {
            position: fixed;
            border-radius: 63% 37% 54% 46% / 55% 48% 52% 45%;
            opacity: 0.06;
            animation: morph 30s infinite ease-in-out;
            z-index: 0;
            pointer-events: none;
        }

        .shape-1 {
            width: 600px;
            height: 600px;
            background: var(--sage);
            top: -150px;
            left: -150px;
        }

        .shape-2 {
            width: 400px;
            height: 400px;
            background: var(--earth);
            bottom: -100px;
            right: -100px;
            animation-delay: -10s;
        }

        .shape-3 {
            width: 300px;
            height: 300px;
            background: var(--terracotta);
            top: 50%;
            right: 10%;
            animation-delay: -20s;
        }

        @keyframes morph {
            0%, 100% {
                border-radius: 63% 37% 54% 46% / 55% 48% 52% 45%;
                transform: rotate(0deg) scale(1);
            }
            25% {
                border-radius: 40% 60% 70% 30% / 40% 40% 60% 60%;
                transform: rotate(90deg) scale(1.05);
            }
            50% {
                border-radius: 50% 50% 33% 67% / 55% 27% 73% 45%;
                transform: rotate(180deg) scale(1);
            }
            75% {
                border-radius: 70% 30% 50% 50% / 30% 65% 35% 70%;
                transform: rotate(270deg) scale(0.95);
            }
        }

        /* Layout */
        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 1.5rem;
            position: relative;
            z-index: 1;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 2rem 1rem;
            margin-bottom: 1.5rem;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--terracotta);
            text-decoration: none;
            font-weight: 600;
            margin-bottom: 1rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        .back-link:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateX(-5px);
        }

        h1 {
            font-family: 'Lora', serif;
            font-size: clamp(1.8rem, 4vw, 2.8rem);
            font-weight: 700;
            color: var(--moss);
            margin-bottom: 0.5rem;
        }

        .subtitle {
            font-size: 1.1rem;
            color: var(--terracotta);
            font-style: italic;
            font-family: 'Lora', serif;
        }

        /* Mode Selection */
        .mode-selector {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.75rem;
            margin-bottom: 2rem;
        }

        .mode-btn {
            padding: 0.75rem 1.25rem;
            background: rgba(255, 255, 255, 0.6);
            border: 2px solid transparent;
            border-radius: 25px;
            font-family: 'Nunito', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--moss);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mode-btn:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateY(-2px);
        }

        .mode-btn.active {
            background: linear-gradient(135deg, var(--sage), var(--moss));
            color: white;
            border-color: var(--moss);
        }

        /* Story Card */
        .story-card {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(15px);
            border-radius: 24px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            border: 2px solid rgba(138, 154, 91, 0.2);
            box-shadow: 0 10px 40px rgba(96, 108, 56, 0.1);
            min-height: 300px;
            position: relative;
            overflow: hidden;
        }

        .story-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--sage), var(--earth), var(--terracotta));
        }

        /* Character Display */
        .character-block {
            margin-bottom: 1.5rem;
            padding: 1.5rem;
            background: rgba(254, 250, 224, 0.5);
            border-radius: 16px;
            border-left: 4px solid var(--sage);
        }

        .character-name {
            font-family: 'Lora', serif;
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--moss);
            margin-bottom: 0.75rem;
        }

        .character-domain {
            font-size: 0.85rem;
            color: var(--terracotta);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
        }

        .traits-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .trait-tag {
            padding: 0.4rem 0.9rem;
            background: linear-gradient(135deg, var(--sage), var(--moss));
            color: white;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .trait-tag:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(96, 108, 56, 0.3);
        }

        .trait-tag.borrowed {
            background: linear-gradient(135deg, var(--earth), var(--terracotta));
        }

        .trait-tag.tech {
            background: linear-gradient(135deg, #4A5568, #2D3748);
        }

        .trait-tag.medical {
            background: linear-gradient(135deg, #38A169, #276749);
        }

        .trait-tag.legal {
            background: linear-gradient(135deg, #805AD5, #553C9A);
        }

        .trait-tag.outdoor {
            background: linear-gradient(135deg, #3182CE, #2B6CB0);
        }

        .trait-tag.music {
            background: linear-gradient(135deg, #D69E2E, #B7791F);
        }

        .trait-tag.writing {
            background: linear-gradient(135deg, #E53E3E, #C53030);
        }

        /* Story Prompt */
        .story-prompt {
            font-family: 'Lora', serif;
            font-size: 1.25rem;
            line-height: 1.9;
            color: var(--ink);
            padding: 1.5rem;
            background: linear-gradient(135deg, rgba(254, 250, 224, 0.8), rgba(245, 240, 225, 0.8));
            border-radius: 16px;
            border: 1px solid rgba(201, 162, 39, 0.3);
            position: relative;
        }

        .story-prompt::before {
            content: '"';
            position: absolute;
            top: -10px;
            left: 15px;
            font-size: 4rem;
            color: var(--gold);
            opacity: 0.4;
            font-family: 'Lora', serif;
        }

        .story-prompt em {
            color: var(--terracotta);
            font-style: italic;
        }

        .story-prompt strong {
            color: var(--moss);
        }

        /* Encounter Section */
        .encounter-section {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 1rem;
            align-items: center;
        }

        .vs-badge {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--earth), var(--terracotta));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Lora', serif;
            font-weight: 700;
            color: white;
            font-size: 0.9rem;
        }

        /* Fusion Display */
        .fusion-result {
            text-align: center;
            padding: 2rem;
        }

        .fusion-name {
            font-family: 'Lora', serif;
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--moss), var(--terracotta));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
        }

        .fusion-description {
            font-style: italic;
            color: var(--dark-moss);
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
        }

        /* Quest Display */
        .quest-section {
            display: grid;
            gap: 1rem;
        }

        .quest-element {
            display: flex;
            gap: 1rem;
            align-items: flex-start;
            padding: 1rem;
            background: rgba(254, 250, 224, 0.5);
            border-radius: 12px;
        }

        .quest-label {
            min-width: 100px;
            font-weight: 700;
            color: var(--terracotta);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .quest-value {
            font-family: 'Lora', serif;
            color: var(--dark-moss);
            font-size: 1.05rem;
        }

        /* Controls */
        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .generate-btn {
            padding: 1rem 2rem;
            background: linear-gradient(135deg, var(--sage), var(--moss));
            border: none;
            border-radius: 30px;
            font-family: 'Nunito', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            color: white;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 4px 20px rgba(96, 108, 56, 0.3);
        }

        .generate-btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 30px rgba(96, 108, 56, 0.4);
        }

        .generate-btn:active {
            transform: translateY(-1px);
        }

        .secondary-btn {
            padding: 0.75rem 1.5rem;
            background: rgba(255, 255, 255, 0.7);
            border: 2px solid var(--sage);
            border-radius: 25px;
            font-family: 'Nunito', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--moss);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .secondary-btn:hover {
            background: rgba(255, 255, 255, 0.95);
            border-color: var(--moss);
        }

        /* Domain Filter */
        .domain-filter {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 16px;
        }

        .domain-chip {
            padding: 0.4rem 0.8rem;
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid var(--sage);
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--moss);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .domain-chip:hover {
            background: rgba(138, 154, 91, 0.2);
        }

        .domain-chip.active {
            background: var(--sage);
            color: white;
            border-color: var(--sage);
        }

        /* Stats */
        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 2rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 12px;
            margin-bottom: 1.5rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-family: 'Lora', serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--moss);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--terracotta);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* History */
        .history-section {
            margin-top: 2rem;
        }

        .history-title {
            font-family: 'Lora', serif;
            font-size: 1.2rem;
            color: var(--moss);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid rgba(138, 154, 91, 0.3);
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .history-item {
            padding: 1rem;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 12px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 3px solid var(--sage);
        }

        .history-item:hover {
            background: rgba(255, 255, 255, 0.8);
            transform: translateX(5px);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 2rem;
            color: var(--moss);
            opacity: 0.7;
            font-size: 0.85rem;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .story-card {
                padding: 1.5rem;
            }

            .encounter-section {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .vs-badge {
                margin: 0 auto;
            }

            .mode-selector {
                gap: 0.5rem;
            }

            .mode-btn {
                padding: 0.6rem 1rem;
                font-size: 0.85rem;
            }

            .stats-bar {
                gap: 1rem;
            }

            .domain-filter {
                gap: 0.4rem;
            }
        }
    </style>
</head>
<body>
    <div class="organic-shape shape-1"></div>
    <div class="organic-shape shape-2"></div>
    <div class="organic-shape shape-3"></div>

    <div class="container">
        <header class="header">
            <a href="index.html" class="back-link">← Back to Games</a>
            <h1>Combinatorial Storytelling Engine</h1>
            <p class="subtitle">Where characters meet, traits merge, and stories emerge</p>
        </header>

        <!-- Stats -->
        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-number" id="character-count">0</div>
                <div class="stat-label">Characters</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="trait-count">0</div>
                <div class="stat-label">Traits</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="combination-count">0</div>
                <div class="stat-label">Combinations</div>
            </div>
        </div>

        <!-- Mode Selection -->
        <div class="mode-selector">
            <button class="mode-btn active" data-mode="portrait">Character Portrait</button>
            <button class="mode-btn" data-mode="encounter">Chance Encounter</button>
            <button class="mode-btn" data-mode="fusion">Trait Fusion</button>
            <button class="mode-btn" data-mode="quest">Quest Generator</button>
            <button class="mode-btn" data-mode="dialogue">Inner Dialogue</button>
        </div>

        <!-- Domain Filter -->
        <div class="domain-filter" id="domain-filter"></div>

        <!-- Story Card -->
        <div class="story-card" id="story-card">
            <div id="story-content">
                <p style="text-align: center; color: var(--moss); font-style: italic;">
                    Click "Generate" to begin your story...
                </p>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <button class="generate-btn" id="generate-btn">Generate Story</button>
            <button class="secondary-btn" id="copy-btn">Copy to Clipboard</button>
            <button class="secondary-btn" id="save-btn">Save to History</button>
        </div>

        <!-- History -->
        <div class="history-section">
            <h3 class="history-title">Story History</h3>
            <div class="history-list" id="history-list">
                <p style="color: var(--moss); opacity: 0.6; font-style: italic; padding: 1rem;">
                    Your saved stories will appear here...
                </p>
            </div>
        </div>

        <footer class="footer">
            <p>Part of CCAB - Creative Code and Algorithmic Beauty</p>
        </footer>
    </div>

    <script>
        // ========================================
        // DATA: All characters and their traits
        // ========================================
        const storyData = {
            intellectuals: {
                name: "Scholars & Thinkers",
                color: "sage",
                characters: [
                    { name: "The Scholar", traits: ["Book-dweller", "Footnote-haunter", "Deadline-ignorer"] },
                    { name: "The Monk", traits: ["Silence-keeper", "Dawn-prayer", "Patience-master"] },
                    { name: "The Scribe", traits: ["Ink-servant", "Word-preserver", "Candle-burner"] },
                    { name: "The Poet", traits: ["Metaphor-weaver", "Suffering-merchant", "Deadline-stranger"] },
                    { name: "The Philosopher", traits: ["Question-hoarder", "Answer-avoider", "Beard-cultivator"] },
                    { name: "The Historian", traits: ["Past-excavator", "Pattern-seeker", "Footnote-obsessed"] },
                    { name: "The Astronomer", traits: ["Star-counter", "Night-worker", "Distance-measurer"] },
                    { name: "The Mathematician", traits: ["Pattern-hunter", "Proof-seeker", "Elegance-worshipper"] },
                    { name: "The Cartographer", traits: ["World-shrinker", "Edge-finder", "Here-be-dragons-writer"] },
                    { name: "The Alchemist", traits: ["Gold-chaser", "Lead-optimist", "Secret-keeper"] },
                    { name: "The Librarian", traits: ["Silence-enforcer", "Knowledge-guardian", "Dewey-devotee"] },
                    { name: "The Archivist", traits: ["Dust-friend", "Memory-tender", "Time-cataloguer"] },
                    { name: "The Translator", traits: ["Bridge-builder", "Meaning-carrier", "Nuance-wrestler"] },
                    { name: "The Editor", traits: ["Word-surgeon"] }
                ]
            },
            artisans: {
                name: "Craftspeople",
                color: "earth",
                characters: [
                    { name: "The Sculptor", traits: ["Stone-liberator", "Form-finder", "Chisel-dancer"] },
                    { name: "The Painter", traits: ["Light-catcher", "Canvas-stainer", "Vision-translator"] },
                    { name: "The Weaver", traits: ["Thread-commander", "Pattern-maker", "Loom-servant"] },
                    { name: "The Potter", traits: ["Clay-spinner", "Wheel-master", "Fire-finisher"] },
                    { name: "The Glassblower", traits: ["Breath-shaper", "Heat-dancer", "Sand-transformer"] },
                    { name: "The Jeweler", traits: ["Stone-setter", "Light-trapper", "Loupe-squinter"] },
                    { name: "The Carpenter", traits: ["Wood-whisperer", "Joint-maker", "Measure-twice-cutter"] },
                    { name: "The Mason", traits: ["Stone-stacker", "Wall-builder", "Level-obsessed"] },
                    { name: "The Clockmaker", traits: ["Time-assembler", "Gear-arranger", "Precision-priest"] },
                    { name: "The Tailor", traits: ["Fabric-sculptor", "Measurement-keeper", "Needle-dancer"] },
                    { name: "The Cobbler", traits: ["Sole-saver", "Leather-stitcher", "Heel-fixer"] },
                    { name: "The Tanner", traits: ["Hide-transformer", "Smell-endurer"] },
                    { name: "The Chandler", traits: ["Wax-worker", "Wick-dipper"] },
                    { name: "The Brewer", traits: ["Grain-alchemist", "Patience-practitioner", "Yeast-herder"] }
                ]
            },
            technology: {
                name: "Digital Realm",
                color: "tech",
                characters: [
                    { name: "The Keyboard", traits: ["Finger-field", "Thought-translator", "Click-chorus"] },
                    { name: "The Mouse", traits: ["Hand-extension", "Cursor-commander", "Scroll-wheel-spinner"] },
                    { name: "The Monitor", traits: ["Eye-destination", "Pixel-grid", "Posture-destroyer"] },
                    { name: "The Laptop", traits: ["Lap-warmer", "Portability-promise", "Battery-anxiety"] },
                    { name: "The Server", traits: ["Data-dungeon", "Heat-generator", "Uptime-prayer"] },
                    { name: "The Cloud", traits: ["Elsewhere-storage", "Someone-else-computer", "Sync-magic"] },
                    { name: "The Browser", traits: ["Tab-accumulator", "Memory-devourer", "History-keeper"] },
                    { name: "The Bookmark", traits: ["Intention-graveyard", "Read-later-lie"] },
                    { name: "The Download", traits: ["Patience-bar", "Bandwidth-race"] },
                    { name: "The Cache", traits: ["Speed-secret", "Memory-shortcut"] },
                    { name: "The Cookie", traits: ["Tracking-crumb", "Privacy-nibbler"] },
                    { name: "The Firewall", traits: ["Gate-keeper", "Intrusion-blocker"] },
                    { name: "The VPN", traits: ["Location-liar", "Tunnel-digger"] },
                    { name: "The Backup", traits: ["Paranoia-reward", "Disaster-insurance", "Set-and-forget"] },
                    { name: "The Crash", traits: ["Work-eraser", "Profanity-trigger"] },
                    { name: "The Blue Screen", traits: ["Hope-crusher", "Reboot-demand"] }
                ]
            },
            medical: {
                name: "Healers & Health",
                color: "medical",
                characters: [
                    { name: "The Dentist", traits: ["Cavity-hunter", "Floss-shamer", "Drill-wielder"] },
                    { name: "The Doctor", traits: ["Symptom-translator", "Waiting-room-ruler", "Handwriting-mystery"] },
                    { name: "The Nurse", traits: ["Care-giver", "Vein-finder", "Patience-saint"] },
                    { name: "The Pharmacist", traits: ["Pill-counter", "Label-printer", "Interaction-checker"] },
                    { name: "The Optometrist", traits: ["Letter-chart-pointer", "Lens-flipper", "Better-or-worse-asker"] },
                    { name: "The Therapist", traits: ["Thought-untangler", "Pattern-mirror", "Silence-comfortable"] },
                    { name: "The Surgeon", traits: ["Body-mechanic", "Precision-cutter", "Steady-hand"] },
                    { name: "The Anesthesiologist", traits: ["Sleep-bringer", "Pain-preventer", "Consciousness-dimmer"] },
                    { name: "The Radiologist", traits: ["Shadow-reader", "Bone-viewer", "Image-interpreter"] },
                    { name: "The Physical Therapist", traits: ["Movement-restorer", "Exercise-assigner", "Pain-through-gain"] },
                    { name: "The Waiting Room", traits: ["Magazine-museum", "Anxiety-incubator", "Phone-dead-zone"] },
                    { name: "The Prescription", traits: ["Handwriting-puzzle", "Refill-countdown"] },
                    { name: "The Insurance Form", traits: ["Bureaucracy-maze", "Patience-destroyer"] },
                    { name: "The Co-pay", traits: ["Wallet-nibbler"] },
                    { name: "The Diagnosis", traits: ["Answer-relief", "Google-confirmer"] }
                ]
            },
            legal: {
                name: "Law & Justice",
                color: "legal",
                characters: [
                    { name: "The Jury", traits: ["Fate-committee", "Peer-panel", "Deliberation-room-dweller"] },
                    { name: "The Judge", traits: ["Gavel-wielder", "Robe-wearer", "Order-keeper"] },
                    { name: "The Lawyer", traits: ["Loophole-finder", "Argument-crafter", "Billable-hour-counter"] },
                    { name: "The Witness", traits: ["Truth-swearer", "Memory-miner", "Cross-examination-survivor"] },
                    { name: "The Contract", traits: ["Promise-paper", "Fine-print-hider", "Lawyer-employment"] },
                    { name: "The Subpoena", traits: ["Appearance-demand", "Calendar-disruptor"] },
                    { name: "The Verdict", traits: ["Waiting-end", "Fate-word"] },
                    { name: "The Appeal", traits: ["Second-chance-seeker", "Decision-challenger"] },
                    { name: "The Statute", traits: ["Rule-fossil", "Interpretation-battleground"] },
                    { name: "The Precedent", traits: ["Past-authority", "Judge-guide"] },
                    { name: "The Loophole", traits: ["Escape-route", "Lawyer-treasure"] },
                    { name: "The Fine Print", traits: ["Secret-keeper", "Magnifying-glass-demand"] },
                    { name: "The Gavel", traits: ["Silence-hammer", "Decision-punctuation"] },
                    { name: "The Oath", traits: ["Truth-promise", "Perjury-preventer"] },
                    { name: "The Evidence", traits: ["Proof-fragment", "Story-piece"] },
                    { name: "The Alibi", traits: ["Elsewhere-proof", "Timeline-anchor"] },
                    { name: "The Bail", traits: ["Freedom-price", "Flight-risk-bet"] },
                    { name: "The Parole", traits: ["Second-chance-leash"] }
                ]
            },
            outdoor: {
                name: "Trail & Wilderness",
                color: "outdoor",
                characters: [
                    { name: "The Mountain Path", traits: ["Breath-stealer", "Switchback-snake", "Summit-promise"] },
                    { name: "The Tent", traits: ["Portable-shelter", "Rain-drum", "Zipper-struggle"] },
                    { name: "The Sleeping Bag", traits: ["Warmth-cocoon", "Roll-up-nightmare", "Ground-buffer"] },
                    { name: "The Campfire", traits: ["Story-circle", "Marshmallow-altar", "Smoke-follows-beauty"] },
                    { name: "The Compass", traits: ["Direction-finder", "Battery-free-guide"] },
                    { name: "The Trail Marker", traits: ["Path-confirmation", "Lost-preventer"] },
                    { name: "The Backpack", traits: ["Burden-carrier", "Snack-vault", "Weight-regret"] },
                    { name: "The Hiking Boot", traits: ["Blister-maker", "Ankle-guardian", "Mud-collector"] },
                    { name: "The Summit", traits: ["Effort-reward", "Photo-opportunity", "Turnaround-point"] },
                    { name: "The Switchback", traits: ["Patience-path", "Gradient-gentler"] },
                    { name: "The Creek Crossing", traits: ["Wet-foot-risk", "Balance-test"] },
                    { name: "The Wilderness", traits: ["Civilization-absence", "Phone-signal-void"] },
                    { name: "The Wildlife", traits: ["Distance-respect", "Camera-scramble"] },
                    { name: "The Blister", traits: ["Friction-lesson", "Sock-regret"] },
                    { name: "The Trekking Pole", traits: ["Third-leg", "Knee-saver"] },
                    { name: "The Cairn", traits: ["Stone-guide", "Hiker-handshake"] },
                    { name: "The Treeline", traits: ["Altitude-marker"] }
                ]
            },
            music: {
                name: "Symphony & Sound",
                color: "music",
                characters: [
                    { name: "The Symphony", traits: ["Instrument-conversation", "Silence-to-sound", "Conductor-obedient"] },
                    { name: "The Conductor", traits: ["Baton-dancer", "Tempo-keeper", "Orchestra-unifier"] },
                    { name: "The Violin", traits: ["String-voice", "Horsehair-singer", "Shoulder-percher"] },
                    { name: "The Cello", traits: ["Baritone-box", "Floor-anchor", "Embrace-instrument"] },
                    { name: "The Piano", traits: ["Hammer-harp", "Key-meadow", "Room-dominator"] },
                    { name: "The Drum", traits: ["Rhythm-heart", "Skin-striker", "Noise-complaint-source"] },
                    { name: "The Flute", traits: ["Breath-to-melody", "Finger-dancer", "Air-column"] },
                    { name: "The Trumpet", traits: ["Brass-herald", "Lip-buzzer", "Attention-getter"] },
                    { name: "The Guitar", traits: ["Six-string", "Campfire-companion", "Fret-board-maze"] },
                    { name: "The Saxophone", traits: ["Jazz-voice", "Reed-breather", "Cool-incarnate"] },
                    { name: "The Bagpipe", traits: ["Drone-maker", "Lung-challenger", "Love-or-hate-instrument"] },
                    { name: "The Metronome", traits: ["Time-tyrant", "Tempo-enforcer", "Patience-tick"] },
                    { name: "The Sheet Music", traits: ["Composer-ghost", "Note-map"] },
                    { name: "The Encore", traits: ["Applause-reward", "Exit-delay"] }
                ]
            },
            writing: {
                name: "Writers & Words",
                color: "writing",
                characters: [
                    { name: "The Novelist", traits: ["World-builder", "Deadline-misser", "Coffee-dependent"] },
                    { name: "The Playwright", traits: ["Dialogue-crafter", "Stage-imaginer", "Actor-supplier"] },
                    { name: "The Screenwriter", traits: ["Scene-setter", "Revision-survivor", "Credit-fighter"] },
                    { name: "The Journalist", traits: ["Truth-chaser", "Deadline-slave", "Source-protector"] },
                    { name: "The Biographer", traits: ["Life-chronicler", "Research-obsessed", "Subject-haunted"] },
                    { name: "The Critic", traits: ["Taste-arbiter", "Flaw-finder", "Opinion-professional"] },
                    { name: "The Publisher", traits: ["Gatekeeper-old", "Rejection-sender", "Risk-assessor"] },
                    { name: "The Agent", traits: ["Middle-person", "Deal-maker", "Percentage-taker"] },
                    { name: "The Manuscript", traits: ["Hope-bundle", "Rejection-collector", "Drawer-dweller"] },
                    { name: "The Deadline", traits: ["Panic-parent", "Creativity-compressor", "Extension-seeker"] },
                    { name: "The Writers Block", traits: ["Cursor-blinker", "Doubt-symptom", "Procrastination-excuse"] },
                    { name: "The First Draft", traits: ["Permission-to-fail", "Editing-fuel"] },
                    { name: "The Rejection Letter", traits: ["Form-response", "Wallpaper-material"] },
                    { name: "The Bestseller", traits: ["Lightning-bottle", "Marketing-miracle"] },
                    { name: "The Blurb", traits: ["Praise-inflation"] }
                ]
            }
        };

        // ========================================
        // STORY TEMPLATES
        // ========================================
        const storyTemplates = {
            encounter: [
                "In the liminal space between {domain1} and {domain2}, {char1} meets {char2}. The {trait1} recognizes something familiar in the {trait2}—perhaps they are not so different after all.",
                "When {char1}, the {trait1}, stumbles upon {char2}, the {trait2}, neither knows what to say. The silence speaks volumes about the gulf between {domain1} and {domain2}.",
                "{char1} has spent a lifetime as a {trait1}. But nothing prepared them for {char2}, whose gift as a {trait2} challenges everything they believed.",
                "They say opposites attract. {char1} the {trait1} and {char2} the {trait2} prove this true in ways that shake both {domain1} and {domain2}.",
                "The {trait1} looks up from their work. Standing in the doorway is {char2}—a {trait2} from the realm of {domain2}. Neither moves. Neither breathes.",
                "At the crossroads where {domain1} meets {domain2}, two figures pause. {char1}, forever the {trait1}, and {char2}, eternally the {trait2}, begin to speak."
            ],
            quest: [
                "{char1}, known across the land as the {trait1}, must journey to {location} to {objective}. But standing in their way is {obstacle}—and only {ally}, the {trait2}, can help.",
                "The prophecy spoke of a {trait1} who would rise when {event} threatened the realm. {char1} never believed they were that hero—until {ally} appeared with news of {objective}.",
                "In {location}, {char1} discovers that being a {trait1} is not enough. To {objective}, they must embrace the ways of {ally} and become something new entirely.",
                "Three things {char1} needs: the courage of a {trait1}, the wisdom of {ally}, and a path through {location} to {objective}. They have only one.",
                "When {event} strikes {location}, only {char1} the {trait1} has the skills to {objective}. But the price is steep: they must leave behind everything that made them who they are."
            ],
            fusion: [
                "What emerges when you combine the {trait1} with the {trait2}? A new archetype is born: {fusion_name}, who walks between worlds.",
                "Neither fully {trait1} nor completely {trait2}, this hybrid creature—{fusion_name}—possesses powers unknown to either parent realm.",
                "The alchemists whispered of such a creation. The {trait1} and {trait2}, merged into one: {fusion_name}. The world has never seen its like.",
                "In the {fusion_name}, we see the union of seemingly opposite forces: the discipline of the {trait1} and the passion of the {trait2}."
            ],
            dialogue: [
                "\"{intro1}\" says {char1}, the {trait1}.\n\n\"{response1}\" replies the inner voice.\n\n\"{intro2}\"\n\n\"{response2}\"",
                "The {trait1} sits alone. Inside, two voices war:\n\n\"{intro1}\"\n\n\"{response1}\"\n\nThe {trait2} within has always known the truth.",
                "\"I am the {trait1},\" {char1} whispers to the mirror. \"But what if I could also be a {trait2}?\"\n\nThe reflection has no answer. Or perhaps it has too many."
            ]
        };

        const questLocations = [
            "the Library of Unwritten Books",
            "the Forge of First Light",
            "the Court of Final Appeals",
            "the Summit of Broken Promises",
            "the Archive of Lost Memories",
            "the Theater of Shadows",
            "the Hospital of Last Hopes",
            "the Server Room of Forgotten Data",
            "the Crossroads of If and When"
        ];

        const questObjectives = [
            "recover what was lost",
            "mend what was broken",
            "speak what was silenced",
            "remember what was forgotten",
            "create what was never imagined",
            "destroy what should not exist",
            "protect what remains",
            "translate the untranslatable"
        ];

        const questObstacles = [
            "their own doubt",
            "an ancient curse",
            "the weight of tradition",
            "the passage of time itself",
            "a rival who knows their secret",
            "a choice with no good options"
        ];

        const questEvents = [
            "the Great Silence",
            "the Breaking of the Pattern",
            "the Last Deadline",
            "the Forgetting",
            "the Final Audit"
        ];

        const dialogueIntros = [
            "I have spent so long being this one thing",
            "What if everything I believed was wrong",
            "The work is never finished",
            "They do not understand what we sacrifice",
            "Every day, the same ritual",
            "I remember when this meant something"
        ];

        const dialogueResponses = [
            "Perhaps that is exactly the problem",
            "Wrong and right are words for others to judge",
            "Finished is just another word for dead",
            "Understanding was never the point",
            "But are you the same",
            "Did it ever? Or did you just hope"
        ];

        // ========================================
        // STATE
        // ========================================
        let currentMode = 'portrait';
        let activeDomains = Object.keys(storyData);
        let currentStory = null;
        let history = [];

        // ========================================
        // UTILITIES
        // ========================================
        function random(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        function getRandomCharacter(excludeDomains = []) {
            const availableDomains = activeDomains.filter(d => !excludeDomains.includes(d));
            if (availableDomains.length === 0) return null;
            const domain = random(availableDomains);
            const character = random(storyData[domain].characters);
            return { ...character, domain, domainName: storyData[domain].name, color: storyData[domain].color };
        }

        function getRandomTrait(character) {
            return random(character.traits);
        }

        function generateFusionName(trait1, trait2) {
            const part1 = trait1.split('-')[0];
            const part2 = trait2.split('-')[1] || trait2.split('-')[0];
            return `The ${part1}-${part2}`;
        }

        function formatTemplate(template, replacements) {
            let result = template;
            for (const [key, value] of Object.entries(replacements)) {
                result = result.replace(new RegExp(`{${key}}`, 'g'), value);
            }
            return result;
        }

        // ========================================
        // GENERATORS
        // ========================================
        function generatePortrait() {
            const char = getRandomCharacter();
            if (!char) return '<p>Please select at least one domain.</p>';

            return `
                <div class="character-block fade-in">
                    <div class="character-domain">${char.domainName}</div>
                    <div class="character-name">${char.name}</div>
                    <div class="traits-list">
                        ${char.traits.map(t => `<span class="trait-tag ${char.color}">${t}</span>`).join('')}
                    </div>
                </div>
                <div class="story-prompt fade-in">
                    ${generatePortraitStory(char)}
                </div>
            `;
        }

        function generatePortraitStory(char) {
            const trait = random(char.traits);
            const stories = [
                `<strong>${char.name}</strong> moves through the world as a <em>${trait}</em>. Some call it a gift. Others, a curse. The truth, as always, lies somewhere in between.`,
                `They say you can recognize <strong>${char.name}</strong> by the way they ${trait.toLowerCase().replace('-', ' ')}. It is not a profession. It is a calling.`,
                `To be a <em>${trait}</em> is to carry a weight that others cannot see. <strong>${char.name}</strong> has borne it for so long, they have forgotten what lightness feels like.`,
                `In the realm of <em>${char.domainName}</em>, <strong>${char.name}</strong> stands apart. The <em>${trait}</em> has made them both legend and exile.`
            ];
            return random(stories);
        }

        function generateEncounter() {
            const char1 = getRandomCharacter();
            if (!char1) return '<p>Please select at least one domain.</p>';

            const char2 = getRandomCharacter([char1.domain]) || getRandomCharacter();

            const template = random(storyTemplates.encounter);
            const story = formatTemplate(template, {
                char1: char1.name,
                char2: char2.name,
                trait1: random(char1.traits),
                trait2: random(char2.traits),
                domain1: char1.domainName,
                domain2: char2.domainName
            });

            return `
                <div class="encounter-section fade-in">
                    <div class="character-block">
                        <div class="character-domain">${char1.domainName}</div>
                        <div class="character-name">${char1.name}</div>
                        <div class="traits-list">
                            ${char1.traits.map(t => `<span class="trait-tag ${char1.color}">${t}</span>`).join('')}
                        </div>
                    </div>
                    <div class="vs-badge">meets</div>
                    <div class="character-block">
                        <div class="character-domain">${char2.domainName}</div>
                        <div class="character-name">${char2.name}</div>
                        <div class="traits-list">
                            ${char2.traits.map(t => `<span class="trait-tag ${char2.color}">${t}</span>`).join('')}
                        </div>
                    </div>
                </div>
                <div class="story-prompt fade-in" style="margin-top: 1.5rem;">
                    ${story}
                </div>
            `;
        }

        function generateFusion() {
            const char1 = getRandomCharacter();
            if (!char1) return '<p>Please select at least one domain.</p>';

            const char2 = getRandomCharacter([char1.domain]) || getRandomCharacter();

            const trait1 = random(char1.traits);
            const trait2 = random(char2.traits);
            const fusionName = generateFusionName(trait1, trait2);

            const template = random(storyTemplates.fusion);
            const story = formatTemplate(template, {
                trait1,
                trait2,
                fusion_name: fusionName
            });

            // Get borrowed traits
            const borrowedTraits = [
                random(char1.traits.filter(t => t !== trait1)),
                random(char2.traits.filter(t => t !== trait2))
            ].filter(Boolean);

            return `
                <div class="fusion-result fade-in">
                    <div class="fusion-name">${fusionName}</div>
                    <div class="fusion-description">Born of ${char1.name} and ${char2.name}</div>
                    <div class="traits-list" style="justify-content: center;">
                        <span class="trait-tag ${char1.color}">${trait1}</span>
                        <span class="trait-tag" style="background: linear-gradient(135deg, #C9A227, #A78B00);">+</span>
                        <span class="trait-tag ${char2.color}">${trait2}</span>
                    </div>
                    ${borrowedTraits.length > 0 ? `
                        <div style="margin-top: 1rem;">
                            <small style="color: var(--terracotta);">Inherited Traits:</small>
                            <div class="traits-list" style="justify-content: center; margin-top: 0.5rem;">
                                ${borrowedTraits.map(t => `<span class="trait-tag borrowed">${t}</span>`).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>
                <div class="story-prompt fade-in" style="margin-top: 1.5rem;">
                    ${story}
                </div>
            `;
        }

        function generateQuest() {
            const hero = getRandomCharacter();
            if (!hero) return '<p>Please select at least one domain.</p>';

            const ally = getRandomCharacter([hero.domain]) || getRandomCharacter();

            const location = random(questLocations);
            const objective = random(questObjectives);
            const obstacle = random(questObstacles);
            const event = random(questEvents);

            const template = random(storyTemplates.quest);
            const story = formatTemplate(template, {
                char1: hero.name,
                trait1: random(hero.traits),
                ally: ally.name,
                trait2: random(ally.traits),
                location,
                objective,
                obstacle,
                event
            });

            return `
                <div class="quest-section fade-in">
                    <div class="quest-element">
                        <span class="quest-label">Hero</span>
                        <span class="quest-value">${hero.name} <small style="color: var(--terracotta);">(${random(hero.traits)})</small></span>
                    </div>
                    <div class="quest-element">
                        <span class="quest-label">Ally</span>
                        <span class="quest-value">${ally.name} <small style="color: var(--terracotta);">(${random(ally.traits)})</small></span>
                    </div>
                    <div class="quest-element">
                        <span class="quest-label">Location</span>
                        <span class="quest-value">${location}</span>
                    </div>
                    <div class="quest-element">
                        <span class="quest-label">Objective</span>
                        <span class="quest-value">${objective}</span>
                    </div>
                    <div class="quest-element">
                        <span class="quest-label">Obstacle</span>
                        <span class="quest-value">${obstacle}</span>
                    </div>
                </div>
                <div class="story-prompt fade-in" style="margin-top: 1.5rem;">
                    ${story}
                </div>
            `;
        }

        function generateDialogue() {
            const char = getRandomCharacter();
            if (!char) return '<p>Please select at least one domain.</p>';

            const trait1 = random(char.traits);
            const trait2 = random(char.traits.filter(t => t !== trait1)) || trait1;

            const intro1 = random(dialogueIntros);
            const response1 = random(dialogueResponses);
            const intro2 = random(dialogueIntros.filter(i => i !== intro1));
            const response2 = random(dialogueResponses.filter(r => r !== response1));

            const template = random(storyTemplates.dialogue);
            const story = formatTemplate(template, {
                char1: char.name,
                trait1,
                trait2,
                intro1,
                response1,
                intro2,
                response2
            });

            return `
                <div class="character-block fade-in">
                    <div class="character-domain">${char.domainName}</div>
                    <div class="character-name">${char.name}</div>
                    <div class="traits-list">
                        ${char.traits.map(t => `<span class="trait-tag ${char.color}">${t}</span>`).join('')}
                    </div>
                </div>
                <div class="story-prompt fade-in" style="margin-top: 1.5rem; white-space: pre-wrap;">
                    ${story}
                </div>
            `;
        }

        // ========================================
        // UI FUNCTIONS
        // ========================================
        function generate() {
            const generators = {
                portrait: generatePortrait,
                encounter: generateEncounter,
                fusion: generateFusion,
                quest: generateQuest,
                dialogue: generateDialogue
            };

            const content = generators[currentMode]();
            currentStory = content;
            document.getElementById('story-content').innerHTML = content;
        }

        function copyToClipboard() {
            const content = document.getElementById('story-content');
            const text = content.innerText;
            navigator.clipboard.writeText(text).then(() => {
                const btn = document.getElementById('copy-btn');
                btn.textContent = 'Copied!';
                setTimeout(() => btn.textContent = 'Copy to Clipboard', 2000);
            });
        }

        function saveToHistory() {
            if (!currentStory) return;

            const entry = {
                mode: currentMode,
                content: document.getElementById('story-content').innerText.substring(0, 100) + '...',
                html: currentStory,
                timestamp: new Date().toLocaleTimeString()
            };

            history.unshift(entry);
            if (history.length > 10) history.pop();

            renderHistory();
        }

        function renderHistory() {
            const container = document.getElementById('history-list');
            if (history.length === 0) {
                container.innerHTML = '<p style="color: var(--moss); opacity: 0.6; font-style: italic; padding: 1rem;">Your saved stories will appear here...</p>';
                return;
            }

            container.innerHTML = history.map((entry, i) => `
                <div class="history-item" onclick="loadFromHistory(${i})">
                    <strong style="color: var(--terracotta); text-transform: capitalize;">${entry.mode}</strong>
                    <small style="float: right; opacity: 0.6;">${entry.timestamp}</small>
                    <p style="margin-top: 0.5rem; font-size: 0.85rem;">${entry.content}</p>
                </div>
            `).join('');
        }

        function loadFromHistory(index) {
            currentStory = history[index].html;
            document.getElementById('story-content').innerHTML = currentStory;
        }

        function initDomainFilter() {
            const container = document.getElementById('domain-filter');
            container.innerHTML = Object.entries(storyData).map(([key, data]) => `
                <button class="domain-chip active" data-domain="${key}">${data.name}</button>
            `).join('');

            container.addEventListener('click', (e) => {
                if (e.target.classList.contains('domain-chip')) {
                    e.target.classList.toggle('active');
                    updateActiveDomains();
                }
            });
        }

        function updateActiveDomains() {
            activeDomains = Array.from(document.querySelectorAll('.domain-chip.active'))
                .map(chip => chip.dataset.domain);
        }

        function updateStats() {
            let totalChars = 0;
            let totalTraits = 0;

            for (const domain of Object.values(storyData)) {
                totalChars += domain.characters.length;
                for (const char of domain.characters) {
                    totalTraits += char.traits.length;
                }
            }

            // Calculate approximate combinations (simplified)
            const combinations = totalChars * totalChars * totalTraits * totalTraits;

            document.getElementById('character-count').textContent = totalChars;
            document.getElementById('trait-count').textContent = totalTraits;
            document.getElementById('combination-count').textContent = combinations.toLocaleString();
        }

        // ========================================
        // INITIALIZATION
        // ========================================
        function init() {
            // Mode buttons
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentMode = btn.dataset.mode;
                });
            });

            // Control buttons
            document.getElementById('generate-btn').addEventListener('click', generate);
            document.getElementById('copy-btn').addEventListener('click', copyToClipboard);
            document.getElementById('save-btn').addEventListener('click', saveToHistory);

            // Initialize
            initDomainFilter();
            updateStats();

            // Generate initial story
            generate();
        }

        // Start
        document.addEventListener('DOMContentLoaded', init);
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
