<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vision Impact Comparison - Wealth Distribution</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            color: #fff;
            overflow: hidden;
        }
        .container {
            display: flex;
            height: 100vh;
            padding: 20px;
            gap: 20px;
        }
        .main-panel {
            flex: 2;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .canvas-row {
            display: flex;
            gap: 15px;
            height: 50%;
        }
        .canvas-panel {
            flex: 1;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
        }
        .sidebar {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 350px;
        }
        .panel {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
        }
        h1 {
            font-size: 20px;
            margin-bottom: 10px;
            color: #4fc3f7;
        }
        h2 {
            font-size: 16px;
            margin-bottom: 10px;
            color: #81c784;
        }
        canvas {
            display: block;
            background: #000;
            border-radius: 5px;
            width: 100%;
        }
        button {
            padding: 10px 20px;
            font-size: 14px;
            background: #4fc3f7;
            color: #000;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
            margin-bottom: 10px;
        }
        button:hover {
            background: #29b6f6;
        }
        .stat {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 13px;
        }
        .stat-label {
            color: #90caf9;
        }
        .stat-value {
            font-weight: bold;
        }
        .description {
            font-size: 12px;
            line-height: 1.4;
            color: #b3d9ff;
        }
        .highlight {
            color: #ffeb3b;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-panel">
            <div class="canvas-row">
                <div class="canvas-panel">
                    <h1>High Vision Agents (6 cells)</h1>
                    <canvas id="highVisionCanvas"></canvas>
                    <div id="highVisionStats" style="margin-top: 10px; font-size: 12px;"></div>
                </div>
                <div class="canvas-panel">
                    <h1>Low Vision Agents (1 cell)</h1>
                    <canvas id="lowVisionCanvas"></canvas>
                    <div id="lowVisionStats" style="margin-top: 10px; font-size: 12px;"></div>
                </div>
            </div>
            <div class="canvas-row">
                <div class="canvas-panel">
                    <h2>Wealth Distribution Comparison</h2>
                    <canvas id="comparisonCanvas"></canvas>
                </div>
            </div>
        </div>
        <div class="sidebar">
            <div class="panel">
                <h2>Controls</h2>
                <button id="resetBtn">Reset Both</button>
                <button id="pauseBtn">Pause</button>
            </div>
            <div class="panel">
                <h2>Comparison Stats</h2>
                <div id="comparisonStats"></div>
            </div>
            <div class="panel">
                <h2>About</h2>
                <p class="description">
                    Two identical environments, but agents differ only in <span class="highlight">vision range</span>.
                    High vision agents can see farther, spotting rich patches before competitors.
                    All agents have identical metabolism (2.5).
                    Watch how this single fitness difference creates massive wealth inequality.
                </p>
            </div>
        </div>
    </div>

    <script>
        const highCanvas = document.getElementById('highVisionCanvas');
        const lowCanvas = document.getElementById('lowVisionCanvas');
        const compCanvas = document.getElementById('comparisonCanvas');
        const highCtx = highCanvas.getContext('2d');
        const lowCtx = lowCanvas.getContext('2d');
        const compCtx = compCanvas.getContext('2d');

        const size = 300;
        highCanvas.width = lowCanvas.width = size;
        highCanvas.height = lowCanvas.height = size;
        compCanvas.width = compCanvas.parentElement.clientWidth - 30;
        compCanvas.height = 200;

        const GRID_SIZE = 40;
        const CELL_SIZE = size / GRID_SIZE;
        const AGENT_COUNT = 100;
        const MAX_GRAIN = 50;
        const METABOLISM = 2.5; // Fixed for fair comparison

        let paused = false;
        let tick = 0;

        class Environment {
            constructor(visionRange) {
                this.visionRange = visionRange;
                this.grainGrid = [];
                this.maxCapacity = [];
                this.agents = [];
                this.wealthHistory = [];
                this.initGrain();
                this.initAgents();
            }

            initGrain() {
                for (let y = 0; y < GRID_SIZE; y++) {
                    this.grainGrid[y] = [];
                    this.maxCapacity[y] = [];
                    for (let x = 0; x < GRID_SIZE; x++) {
                        const d = Math.sqrt((x - GRID_SIZE/2) ** 2 + (y - GRID_SIZE/2) ** 2);
                        const capacity = Math.floor(MAX_GRAIN * Math.exp(-d * d / 200));
                        this.maxCapacity[y][x] = capacity;
                        this.grainGrid[y][x] = capacity;
                    }
                }
            }

            initAgents() {
                this.agents = [];
                for (let i = 0; i < AGENT_COUNT; i++) {
                    this.agents.push({
                        x: Math.floor(Math.random() * GRID_SIZE),
                        y: Math.floor(Math.random() * GRID_SIZE),
                        wealth: 25,
                        vision: this.visionRange,
                        metabolism: METABOLISM,
                        age: 0,
                        maxAge: 80
                    });
                }
            }

            update() {
                // Grow grain
                for (let y = 0; y < GRID_SIZE; y++) {
                    for (let x = 0; x < GRID_SIZE; x++) {
                        if (this.grainGrid[y][x] < this.maxCapacity[y][x]) {
                            this.grainGrid[y][x]++;
                        }
                    }
                }

                // Agent behavior
                this.agents.forEach(agent => {
                    // Look for best patch
                    let bestX = agent.x, bestY = agent.y;
                    let bestGrain = this.grainGrid[agent.y][agent.x];

                    for (let dx = -agent.vision; dx <= agent.vision; dx++) {
                        for (let dy = -agent.vision; dy <= agent.vision; dy++) {
                            const nx = (agent.x + dx + GRID_SIZE) % GRID_SIZE;
                            const ny = (agent.y + dy + GRID_SIZE) % GRID_SIZE;
                            if (this.grainGrid[ny][nx] > bestGrain) {
                                bestGrain = this.grainGrid[ny][nx];
                                bestX = nx;
                                bestY = ny;
                            }
                        }
                    }

                    agent.x = bestX;
                    agent.y = bestY;

                    // Harvest and consume
                    agent.wealth += this.grainGrid[agent.y][agent.x];
                    this.grainGrid[agent.y][agent.x] = 0;
                    agent.wealth -= agent.metabolism;
                    agent.age++;
                });

                // Replace dead
                for (let i = this.agents.length - 1; i >= 0; i--) {
                    if (this.agents[i].wealth <= 0 || this.agents[i].age >= this.agents[i].maxAge) {
                        this.agents[i] = {
                            x: Math.floor(Math.random() * GRID_SIZE),
                            y: Math.floor(Math.random() * GRID_SIZE),
                            wealth: 25,
                            vision: this.visionRange,
                            metabolism: METABOLISM,
                            age: 0,
                            maxAge: 80
                        };
                    }
                }

                // Track wealth
                const avgWealth = this.agents.reduce((s, a) => s + a.wealth, 0) / this.agents.length;
                this.wealthHistory.push(avgWealth);
                if (this.wealthHistory.length > 200) this.wealthHistory.shift();
            }

            draw(ctx) {
                // Draw grain
                for (let y = 0; y < GRID_SIZE; y++) {
                    for (let x = 0; x < GRID_SIZE; x++) {
                        const intensity = this.grainGrid[y][x] / MAX_GRAIN;
                        ctx.fillStyle = `rgba(0, ${Math.floor(intensity * 150)}, 0, 0.7)`;
                        ctx.fillRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
                    }
                }

                // Draw agents
                this.agents.forEach(agent => {
                    const color = agent.wealth < 20 ? '#f44336' :
                                 agent.wealth < 80 ? '#ffeb3b' : '#2196f3';
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.arc(
                        agent.x * CELL_SIZE + CELL_SIZE / 2,
                        agent.y * CELL_SIZE + CELL_SIZE / 2,
                        CELL_SIZE * 0.3,
                        0, Math.PI * 2
                    );
                    ctx.fill();

                    // Draw vision range for some agents
                    if (Math.random() < 0.05) {
                        ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
                        ctx.lineWidth = 1;
                        ctx.strokeRect(
                            (agent.x - agent.vision) * CELL_SIZE,
                            (agent.y - agent.vision) * CELL_SIZE,
                            (agent.vision * 2 + 1) * CELL_SIZE,
                            (agent.vision * 2 + 1) * CELL_SIZE
                        );
                    }
                });
            }

            getStats() {
                const totalWealth = this.agents.reduce((s, a) => s + a.wealth, 0);
                const avgWealth = totalWealth / this.agents.length;
                const maxWealth = Math.max(...this.agents.map(a => a.wealth));
                const poor = this.agents.filter(a => a.wealth < 20).length;
                const rich = this.agents.filter(a => a.wealth > 80).length;
                return { avgWealth, maxWealth, poor, rich, totalWealth };
            }
        }

        let highVisionEnv = new Environment(6);
        let lowVisionEnv = new Environment(1);

        function update() {
            if (paused) return;
            highVisionEnv.update();
            lowVisionEnv.update();
            tick++;
        }

        function draw() {
            highCtx.clearRect(0, 0, size, size);
            lowCtx.clearRect(0, 0, size, size);
            highVisionEnv.draw(highCtx);
            lowVisionEnv.draw(lowCtx);

            // Stats
            const highStats = highVisionEnv.getStats();
            const lowStats = lowVisionEnv.getStats();

            document.getElementById('highVisionStats').innerHTML = `
                Avg: ${highStats.avgWealth.toFixed(1)} | Max: ${highStats.maxWealth.toFixed(0)} | Poor: ${highStats.poor} | Rich: ${highStats.rich}
            `;
            document.getElementById('lowVisionStats').innerHTML = `
                Avg: ${lowStats.avgWealth.toFixed(1)} | Max: ${lowStats.maxWealth.toFixed(0)} | Poor: ${lowStats.poor} | Rich: ${lowStats.rich}
            `;

            // Comparison chart
            compCtx.fillStyle = '#000';
            compCtx.fillRect(0, 0, compCanvas.width, compCanvas.height);

            const maxHistory = Math.max(
                Math.max(...highVisionEnv.wealthHistory),
                Math.max(...lowVisionEnv.wealthHistory)
            );

            // High vision line
            compCtx.strokeStyle = '#2196f3';
            compCtx.lineWidth = 2;
            compCtx.beginPath();
            highVisionEnv.wealthHistory.forEach((w, i) => {
                const x = (i / 200) * compCanvas.width;
                const y = compCanvas.height - (w / maxHistory) * compCanvas.height * 0.9;
                if (i === 0) compCtx.moveTo(x, y);
                else compCtx.lineTo(x, y);
            });
            compCtx.stroke();

            // Low vision line
            compCtx.strokeStyle = '#f44336';
            compCtx.beginPath();
            lowVisionEnv.wealthHistory.forEach((w, i) => {
                const x = (i / 200) * compCanvas.width;
                const y = compCanvas.height - (w / maxHistory) * compCanvas.height * 0.9;
                if (i === 0) compCtx.moveTo(x, y);
                else compCtx.lineTo(x, y);
            });
            compCtx.stroke();

            // Legend
            compCtx.fillStyle = '#2196f3';
            compCtx.fillRect(20, 20, 15, 15);
            compCtx.fillStyle = '#fff';
            compCtx.font = '12px sans-serif';
            compCtx.fillText('High Vision (6)', 40, 32);

            compCtx.fillStyle = '#f44336';
            compCtx.fillRect(20, 45, 15, 15);
            compCtx.fillStyle = '#fff';
            compCtx.fillText('Low Vision (1)', 40, 57);

            // Comparison stats
            const ratio = highStats.avgWealth / lowStats.avgWealth;
            document.getElementById('comparisonStats').innerHTML = `
                <div class="stat"><span class="stat-label">Tick:</span><span class="stat-value">${tick}</span></div>
                <div class="stat"><span class="stat-label">Wealth Ratio:</span><span class="stat-value">${ratio.toFixed(2)}x</span></div>
                <div class="stat"><span class="stat-label">High Avg:</span><span class="stat-value">${highStats.avgWealth.toFixed(1)}</span></div>
                <div class="stat"><span class="stat-label">Low Avg:</span><span class="stat-value">${lowStats.avgWealth.toFixed(1)}</span></div>
                <div class="stat"><span class="stat-label">High Rich:</span><span class="stat-value">${highStats.rich}</span></div>
                <div class="stat"><span class="stat-label">Low Rich:</span><span class="stat-value">${lowStats.rich}</span></div>
                <div class="stat"><span class="stat-label">High Poor:</span><span class="stat-value">${highStats.poor}</span></div>
                <div class="stat"><span class="stat-label">Low Poor:</span><span class="stat-value">${lowStats.poor}</span></div>
            `;
        }

        function animate() {
            update();
            draw();
            requestAnimationFrame(animate);
        }

        document.getElementById('resetBtn').addEventListener('click', () => {
            highVisionEnv = new Environment(6);
            lowVisionEnv = new Environment(1);
            tick = 0;
        });

        document.getElementById('pauseBtn').addEventListener('click', () => {
            paused = !paused;
            document.getElementById('pauseBtn').textContent = paused ? 'Resume' : 'Pause';
        });

        animate();
    </script>
</body>
</html>
