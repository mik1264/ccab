<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Island Biogeography</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: sans-serif; }
canvas { display: block; }
#title {
    position: fixed; top: 50px; left: 50%; transform: translateX(-50%);
    color: #fbbf24; font-size: 22px; font-weight: bold; text-align: center;
    text-shadow: 0 0 20px rgba(251,191,36,0.3); z-index: 10; pointer-events: none;
}
#controls {
    position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
    display: flex; gap: 20px; z-index: 10; background: rgba(0,0,0,0.7);
    padding: 12px 20px; border-radius: 10px; align-items: center;
}
.ctrl { display: flex; flex-direction: column; align-items: center; }
.ctrl label { color: #ccc; font-size: 11px; margin-bottom: 4px; }
.ctrl input[type=range] { width: 100px; accent-color: #fbbf24; }
.ctrl span { color: #fbbf24; font-size: 11px; margin-top: 2px; }
button {
    background: rgba(251,191,36,0.2); color: #fbbf24; border: 1px solid #fbbf24;
    padding: 6px 14px; border-radius: 6px; cursor: pointer; font-size: 12px;
}
button:hover { background: rgba(251,191,36,0.4); }
</style>
</head>
<body>
<a href="../index.html" style="position:fixed;top:10px;left:10px;padding:8px 16px;background:rgba(0,0,0,0.7);color:#fbbf24;text-decoration:none;border-radius:6px;font-size:14px;z-index:999;font-family:sans-serif;">‚Üê Back to Gallery</a>
<div id="title">Island Biogeography Theory</div>
<div id="controls">
    <div class="ctrl">
        <label>Colonization Rate</label>
        <input type="range" id="colonRate" min="0.005" max="0.05" step="0.005" value="0.02">
        <span id="colonVal">0.020</span>
    </div>
    <div class="ctrl">
        <label>Extinction Rate</label>
        <input type="range" id="extinctRate" min="0.005" max="0.05" step="0.005" value="0.015">
        <span id="extinctVal">0.015</span>
    </div>
    <div class="ctrl">
        <label>Speed</label>
        <input type="range" id="simSpeed" min="1" max="5" step="1" value="2">
        <span id="speedVal">2</span>
    </div>
    <button id="resetBtn">Reset</button>
</div>
<canvas id="canvas"></canvas>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
resize();
window.addEventListener('resize', resize);

let colonRate = 0.02;
let extinctRate = 0.015;
let simSpeed = 2;

document.getElementById('colonRate').oninput = function() {
    colonRate = parseFloat(this.value);
    document.getElementById('colonVal').textContent = colonRate.toFixed(3);
};
document.getElementById('extinctRate').oninput = function() {
    extinctRate = parseFloat(this.value);
    document.getElementById('extinctVal').textContent = extinctRate.toFixed(3);
};
document.getElementById('simSpeed').oninput = function() {
    simSpeed = parseInt(this.value);
    document.getElementById('speedVal').textContent = this.value;
};

const speciesColors = [];
for (let i = 0; i < 30; i++) {
    let h = (i * 37 + 20) % 360;
    speciesColors.push(`hsl(${h}, 70%, 60%)`);
}

const MAINLAND_SPECIES = 25;

class Island {
    constructor(x, y, size, name) {
        this.x = x;
        this.y = y;
        this.size = size;
        this.name = name;
        this.species = new Set();
        this.capacity = Math.floor(size / 8);
        this.history = [];
        this.particles = [];
    }

    get distanceFromMainland() {
        return this.x - 120;
    }

    colonize() {
        if (this.species.size >= this.capacity) return;
        let distFactor = 1 - Math.min(1, this.distanceFromMainland / (canvas.width * 0.8));
        let sizeFactor = this.size / 80;
        let prob = colonRate * distFactor * sizeFactor;
        if (Math.random() < prob) {
            let available = [];
            for (let i = 0; i < MAINLAND_SPECIES; i++) {
                if (!this.species.has(i)) available.push(i);
            }
            if (available.length > 0) {
                let sp = available[Math.floor(Math.random() * available.length)];
                this.species.add(sp);
                this.particles.push({
                    x: 120, y: this.y,
                    tx: this.x, ty: this.y,
                    progress: 0, species: sp
                });
            }
        }
    }

    extinction() {
        if (this.species.size === 0) return;
        let sizeFactor = 1 - (this.size / 120);
        let prob = extinctRate * sizeFactor * (this.species.size / this.capacity);
        if (Math.random() < prob) {
            let arr = Array.from(this.species);
            let idx = Math.floor(Math.random() * arr.length);
            this.species.delete(arr[idx]);
        }
    }

    draw(ctx) {
        // Island body
        let grad = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.size);
        grad.addColorStop(0, 'rgba(34, 139, 34, 0.6)');
        grad.addColorStop(0.5, 'rgba(34, 100, 34, 0.4)');
        grad.addColorStop(0.8, 'rgba(194, 178, 128, 0.3)');
        grad.addColorStop(1, 'rgba(100, 149, 237, 0)');
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fillStyle = grad;
        ctx.fill();

        // Shore glow
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size * 0.8, 0, Math.PI * 2);
        ctx.strokeStyle = 'rgba(194, 178, 128, 0.3)';
        ctx.lineWidth = 2;
        ctx.stroke();

        // Species dots on island
        let count = this.species.size;
        let arr = Array.from(this.species);
        let cols = Math.ceil(Math.sqrt(count));
        for (let i = 0; i < arr.length; i++) {
            let row = Math.floor(i / cols);
            let col = i % cols;
            let sx = this.x - (cols - 1) * 5 + col * 10;
            let sy = this.y - (Math.ceil(count / cols) - 1) * 5 + row * 10;
            ctx.beginPath();
            ctx.arc(sx, sy, 3, 0, Math.PI * 2);
            ctx.fillStyle = speciesColors[arr[i]];
            ctx.fill();
        }

        // Label
        ctx.fillStyle = '#fbbf24';
        ctx.font = 'bold 12px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText(this.name, this.x, this.y + this.size + 18);
        ctx.fillStyle = '#ccc';
        ctx.font = '10px sans-serif';
        ctx.fillText(`${this.species.size} species`, this.x, this.y + this.size + 32);

        // Traveling particles
        for (let p of this.particles) {
            p.progress += 0.03;
            let t = p.progress;
            let px = p.x + (p.tx - p.x) * t;
            let py = p.y + (p.ty - p.y) * t - Math.sin(t * Math.PI) * 30;
            ctx.beginPath();
            ctx.arc(px, py, 2, 0, Math.PI * 2);
            ctx.fillStyle = speciesColors[p.species];
            ctx.shadowColor = speciesColors[p.species];
            ctx.shadowBlur = 6;
            ctx.fill();
            ctx.shadowBlur = 0;
        }
        this.particles = this.particles.filter(p => p.progress < 1);
    }
}

let islands = [];
let speciesHistory = [];
const MAX_HISTORY = 300;
let frameCount = 0;

function init() {
    let w = canvas.width;
    let h = canvas.height;
    islands = [
        new Island(w * 0.35, h * 0.3, 55, 'Large Near'),
        new Island(w * 0.35, h * 0.7, 30, 'Small Near'),
        new Island(w * 0.6, h * 0.25, 50, 'Large Mid'),
        new Island(w * 0.6, h * 0.65, 25, 'Small Mid'),
        new Island(w * 0.82, h * 0.35, 45, 'Large Far'),
        new Island(w * 0.82, h * 0.72, 22, 'Small Far'),
    ];
    speciesHistory = [];
    frameCount = 0;
}

document.getElementById('resetBtn').onclick = init;
init();

function drawMainland(ctx) {
    let h = canvas.height;
    let grad = ctx.createLinearGradient(0, 0, 120, 0);
    grad.addColorStop(0, 'rgba(20, 80, 20, 0.8)');
    grad.addColorStop(0.7, 'rgba(34, 100, 34, 0.5)');
    grad.addColorStop(1, 'rgba(34, 139, 34, 0)');
    ctx.fillStyle = grad;
    ctx.fillRect(0, 60, 120, h - 140);

    ctx.fillStyle = '#4ade80';
    ctx.font = 'bold 13px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('MAINLAND', 55, 90);
    ctx.fillStyle = '#ccc';
    ctx.font = '10px sans-serif';
    ctx.fillText(`${MAINLAND_SPECIES} species`, 55, 105);

    // Draw mainland species
    for (let i = 0; i < MAINLAND_SPECIES; i++) {
        let row = Math.floor(i / 4);
        let col = i % 4;
        ctx.beginPath();
        ctx.arc(25 + col * 18, 125 + row * 18, 4, 0, Math.PI * 2);
        ctx.fillStyle = speciesColors[i];
        ctx.fill();
    }
}

function drawWater(ctx) {
    let t = frameCount * 0.01;
    for (let i = 0; i < 30; i++) {
        let x = (Math.sin(t + i * 1.3) * 0.5 + 0.5) * canvas.width;
        let y = (Math.cos(t + i * 0.7) * 0.5 + 0.5) * canvas.height;
        ctx.beginPath();
        ctx.arc(x, y, 1, 0, Math.PI * 2);
        ctx.fillStyle = 'rgba(100, 149, 237, 0.15)';
        ctx.fill();
    }
}

function drawGraph(ctx) {
    let gw = 260, gh = 120;
    let gx = canvas.width - gw - 20, gy = canvas.height - gh - 80;

    ctx.fillStyle = 'rgba(0,0,0,0.7)';
    ctx.strokeStyle = 'rgba(251,191,36,0.3)';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.roundRect(gx - 10, gy - 25, gw + 20, gh + 40, 8);
    ctx.fill();
    ctx.stroke();

    ctx.fillStyle = '#fbbf24';
    ctx.font = '11px sans-serif';
    ctx.textAlign = 'left';
    ctx.fillText('Species Count Over Time', gx + 5, gy - 10);

    ctx.strokeStyle = 'rgba(255,255,255,0.1)';
    ctx.beginPath();
    ctx.moveTo(gx, gy + gh); ctx.lineTo(gx + gw, gy + gh);
    ctx.moveTo(gx, gy); ctx.lineTo(gx, gy + gh);
    ctx.stroke();

    if (speciesHistory.length > 1) {
        let colors = ['#60a5fa', '#818cf8', '#34d399', '#a78bfa', '#f472b6', '#fbbf24'];
        for (let j = 0; j < islands.length; j++) {
            ctx.beginPath();
            for (let i = 0; i < speciesHistory.length; i++) {
                let x = gx + (i / MAX_HISTORY) * gw;
                let y = gy + gh - (speciesHistory[i][j] / MAINLAND_SPECIES) * gh;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.strokeStyle = colors[j];
            ctx.lineWidth = 1.5;
            ctx.stroke();
        }
    }
}

function update() {
    frameCount++;

    for (let s = 0; s < simSpeed; s++) {
        for (let island of islands) {
            island.colonize();
            island.extinction();
        }
    }

    if (frameCount % 5 === 0) {
        let counts = islands.map(i => i.species.size);
        speciesHistory.push(counts);
        if (speciesHistory.length > MAX_HISTORY) speciesHistory.shift();
    }
}

function draw() {
    ctx.fillStyle = '#0a0e1a';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Ocean gradient
    let grad = ctx.createRadialGradient(
        canvas.width / 2, canvas.height / 2, 0,
        canvas.width / 2, canvas.height / 2, canvas.width * 0.6
    );
    grad.addColorStop(0, 'rgba(15, 25, 50, 0.5)');
    grad.addColorStop(1, 'rgba(10, 14, 26, 0)');
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    drawWater(ctx);
    drawMainland(ctx);

    for (let island of islands) {
        island.draw(ctx);
    }

    drawGraph(ctx);
}

function animate() {
    update();
    draw();
    requestAnimationFrame(animate);
}
animate();
</script>
</body>
</html>
