<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Square Plate Modes - Cymatics</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: 'Segoe UI', system-ui, sans-serif; color: #c8d0e0; }
canvas { display: block; }
.back-link {
    position: fixed; top: 20px; left: 20px; z-index: 100;
    color: #8A9A5B; text-decoration: none; font-size: 14px; font-weight: 600;
    background: rgba(10,14,26,0.8); border-radius: 25px;
    border: 2px solid #8A9A5B; padding: 10px 20px;
    transition: all 0.3s ease;
}
.back-link:hover { background: #8A9A5B; color: #0a0e1a; }
.controls {
    position: fixed; top: 20px; right: 20px; z-index: 100;
    background: rgba(10,14,26,0.85); backdrop-filter: blur(10px);
    border-radius: 10px; padding: 20px; max-width: 300px;
    border: 1px solid rgba(138,154,91,0.3);
}
.controls h3 { color: #8A9A5B; margin-bottom: 12px; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }
.control-row { margin-bottom: 10px; }
.control-row label { display: block; font-size: 12px; color: #8a92a8; margin-bottom: 3px; }
.control-row input[type="range"] { width: 100%; accent-color: #8A9A5B; }
.control-row .value { float: right; color: #DDA15E; font-size: 12px; font-weight: 600; }
.control-row button {
    background: rgba(138,154,91,0.2); color: #8A9A5B; border: 1px solid rgba(138,154,91,0.4);
    padding: 6px 12px; border-radius: 5px; cursor: pointer; font-size: 12px; margin: 2px;
    transition: all 0.2s;
}
.control-row button:hover { background: rgba(138,154,91,0.4); }
.control-row button.active { background: #8A9A5B; color: #0a0e1a; }
.presets { display: flex; flex-wrap: wrap; gap: 4px; }
.presets button { font-size: 11px; padding: 4px 8px; }
.info {
    position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 100;
    background: rgba(10,14,26,0.85); backdrop-filter: blur(10px);
    border-radius: 10px; padding: 10px 20px;
    border: 1px solid rgba(138,154,91,0.3);
    font-size: 13px; color: #8a92a8; text-align: center;
}
.info span { color: #DDA15E; font-weight: 600; }
</style>
</head>
<body>
<a href="index.html" class="back-link">&larr; Cymatics</a>

<div class="controls">
    <h3>Superposed Plate Modes</h3>
    <div class="control-row">
        <label>Mode 1: n <span class="value" id="n1Val">3</span></label>
        <input type="range" id="n1Slider" min="1" max="10" value="3" step="1">
    </div>
    <div class="control-row">
        <label>Mode 1: m <span class="value" id="m1Val">1</span></label>
        <input type="range" id="m1Slider" min="1" max="10" value="1" step="1">
    </div>
    <div class="control-row">
        <label>Mode 2: p <span class="value" id="pVal">1</span></label>
        <input type="range" id="pSlider" min="1" max="10" value="1" step="1">
    </div>
    <div class="control-row">
        <label>Mode 2: q <span class="value" id="qVal">3</span></label>
        <input type="range" id="qSlider" min="1" max="10" value="3" step="1">
    </div>
    <div class="control-row">
        <label>Mixing Ratio A/B <span class="value" id="mixVal">0.50</span></label>
        <input type="range" id="mixSlider" min="0" max="100" value="50">
    </div>
    <div class="control-row">
        <label>Freq Ratio <span class="value" id="freqVal">1.00</span></label>
        <input type="range" id="freqSlider" min="50" max="200" value="100">
    </div>
    <div class="control-row">
        <label>Animation</label>
        <button id="animBtn" class="active">ON</button>
        <label style="margin-top:6px;">Speed <span class="value" id="speedVal">1.0</span></label>
        <input type="range" id="speedSlider" min="1" max="30" value="10">
    </div>
    <div class="control-row">
        <label>Presets</label>
        <div class="presets">
            <button onclick="setPreset(3,1,1,3,50)">Degenerate</button>
            <button onclick="setPreset(5,2,2,5,50)">Star</button>
            <button onclick="setPreset(4,1,1,4,50)">Diamond</button>
            <button onclick="setPreset(3,3,5,5,50)">Grid</button>
            <button onclick="setPreset(7,1,1,7,40)">Flower</button>
            <button onclick="setPreset(5,3,3,5,60)">Complex</button>
            <button onclick="setPreset(6,2,2,6,50)">Hex</button>
            <button onclick="setPreset(4,4,8,8,30)">Moir√©</button>
        </div>
    </div>
</div>

<div class="info">
    Mode 1: (<span id="in1">3</span>,<span id="im1">1</span>) + Mode 2: (<span id="ip">1</span>,<span id="iq">3</span>) | Mix: <span id="imix">0.50</span>
</div>

<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

let W, H, plateSize, plateX, plateY;
let n1 = 3, m1 = 1, p = 1, q = 3;
let mixRatio = 0.5, freqRatio = 1.0, animSpeed = 1.0;
let showAnim = true, time = 0;
let running = true;

function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
    plateSize = Math.min(W, H) * 0.75;
    plateX = (W - plateSize) / 2;
    plateY = (H - plateSize) / 2;
}
window.addEventListener('resize', resize);
resize();

function plateValue(x, y, t) {
    const A = mixRatio;
    const B = 1.0 - mixRatio;
    const mode1 = Math.cos(n1 * Math.PI * x) * Math.cos(m1 * Math.PI * y);
    const mode2 = Math.cos(p * Math.PI * x) * Math.cos(q * Math.PI * y);
    if (showAnim) {
        const omega1 = Math.sqrt(n1 * n1 + m1 * m1);
        const omega2 = Math.sqrt(p * p + q * q) * freqRatio;
        return A * mode1 * Math.cos(omega1 * t * animSpeed) + B * mode2 * Math.cos(omega2 * t * animSpeed);
    }
    return A * mode1 + B * mode2;
}

function draw() {
    ctx.fillStyle = '#0a0e1a';
    ctx.fillRect(0, 0, W, H);

    const res = Math.min(300, Math.floor(plateSize));
    const imgData = ctx.createImageData(res, res);
    const d = imgData.data;
    const inv = 1.0 / (res - 1);

    let maxVal = 0;
    const vals = new Float32Array(res * res);
    for (let j = 0; j < res; j++) {
        for (let i = 0; i < res; i++) {
            const v = plateValue(i * inv, j * inv, time);
            vals[j * res + i] = v;
            if (Math.abs(v) > maxVal) maxVal = Math.abs(v);
        }
    }
    if (maxVal < 0.001) maxVal = 1;

    for (let j = 0; j < res; j++) {
        for (let i = 0; i < res; i++) {
            const idx = j * res + i;
            const v = vals[idx] / maxVal;
            const pidx = idx * 4;
            const absV = Math.abs(v);
            const nodal = absV < 0.04;

            let cr, cg, cb;
            if (nodal) {
                // Bright white nodal lines
                const intensity = 1.0 - absV / 0.04;
                cr = Math.floor(200 + intensity * 55);
                cg = Math.floor(200 + intensity * 55);
                cb = Math.floor(220 + intensity * 35);
            } else if (v > 0) {
                const t = Math.min(v, 1);
                cr = Math.floor(30 + t * 200);
                cg = Math.floor(20 + t * 50);
                cb = Math.floor(25 + (1 - t) * 40);
            } else {
                const t = Math.min(-v, 1);
                cr = Math.floor(20 + (1 - t) * 30);
                cg = Math.floor(30 + (1 - t) * 30);
                cb = Math.floor(50 + t * 190);
            }

            d[pidx] = cr;
            d[pidx + 1] = cg;
            d[pidx + 2] = cb;
            d[pidx + 3] = 255;
        }
    }

    const offCanvas = document.createElement('canvas');
    offCanvas.width = res;
    offCanvas.height = res;
    offCanvas.getContext('2d').putImageData(imgData, 0, 0);
    ctx.drawImage(offCanvas, plateX, plateY, plateSize, plateSize);

    ctx.strokeStyle = 'rgba(138,154,91,0.3)';
    ctx.lineWidth = 2;
    ctx.strokeRect(plateX - 1, plateY - 1, plateSize + 2, plateSize + 2);
}

function animate() {
    if (running && showAnim) {
        time += 0.016;
    }
    draw();
    requestAnimationFrame(animate);
}

function setPreset(nn1, mm1, pp, qq, mix) {
    n1 = nn1; m1 = mm1; p = pp; q = qq; mixRatio = mix / 100;
    document.getElementById('n1Slider').value = n1;
    document.getElementById('m1Slider').value = m1;
    document.getElementById('pSlider').value = p;
    document.getElementById('qSlider').value = q;
    document.getElementById('mixSlider').value = mix;
    document.getElementById('n1Val').textContent = n1;
    document.getElementById('m1Val').textContent = m1;
    document.getElementById('pVal').textContent = p;
    document.getElementById('qVal').textContent = q;
    document.getElementById('mixVal').textContent = mixRatio.toFixed(2);
    updateInfo();
}

function updateInfo() {
    document.getElementById('in1').textContent = n1;
    document.getElementById('im1').textContent = m1;
    document.getElementById('ip').textContent = p;
    document.getElementById('iq').textContent = q;
    document.getElementById('imix').textContent = mixRatio.toFixed(2);
}

document.getElementById('n1Slider').addEventListener('input', function() {
    n1 = parseInt(this.value); document.getElementById('n1Val').textContent = n1; updateInfo();
});
document.getElementById('m1Slider').addEventListener('input', function() {
    m1 = parseInt(this.value); document.getElementById('m1Val').textContent = m1; updateInfo();
});
document.getElementById('pSlider').addEventListener('input', function() {
    p = parseInt(this.value); document.getElementById('pVal').textContent = p; updateInfo();
});
document.getElementById('qSlider').addEventListener('input', function() {
    q = parseInt(this.value); document.getElementById('qVal').textContent = q; updateInfo();
});
document.getElementById('mixSlider').addEventListener('input', function() {
    mixRatio = this.value / 100;
    document.getElementById('mixVal').textContent = mixRatio.toFixed(2);
    updateInfo();
});
document.getElementById('freqSlider').addEventListener('input', function() {
    freqRatio = this.value / 100;
    document.getElementById('freqVal').textContent = freqRatio.toFixed(2);
});
document.getElementById('speedSlider').addEventListener('input', function() {
    animSpeed = this.value / 10;
    document.getElementById('speedVal').textContent = animSpeed.toFixed(1);
});
document.getElementById('animBtn').addEventListener('click', function() {
    showAnim = !showAnim;
    this.textContent = showAnim ? 'ON' : 'OFF';
    this.classList.toggle('active', showAnim);
});

window.setPreset = setPreset;

window.reset = function() {
    n1 = 3; m1 = 1; p = 1; q = 3; mixRatio = 0.5; freqRatio = 1.0; animSpeed = 1.0; showAnim = true; time = 0;
    setPreset(3, 1, 1, 3, 50);
    document.getElementById('freqSlider').value = 100;
    document.getElementById('speedSlider').value = 10;
    document.getElementById('freqVal').textContent = '1.00';
    document.getElementById('speedVal').textContent = '1.0';
    document.getElementById('animBtn').textContent = 'ON';
    document.getElementById('animBtn').classList.add('active');
    resize();
};

window.togglePause = function() { running = !running; };

animate();
</script>
<script src="../assets/js/enhance.js"></script>
</body>
</html>
