<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lissajous Figures - Cymatics</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: 'Segoe UI', system-ui, sans-serif; color: #c8d0e0; }
canvas { display: block; }
.back-link {
    position: fixed; top: 20px; left: 20px; z-index: 100;
    color: #8A9A5B; text-decoration: none; font-size: 14px; font-weight: 600;
    background: rgba(10,14,26,0.8); border-radius: 25px;
    border: 2px solid #8A9A5B; padding: 10px 20px;
    transition: all 0.3s ease;
}
.back-link:hover { background: #8A9A5B; color: #0a0e1a; }
.controls {
    position: fixed; top: 20px; right: 20px; z-index: 100;
    background: rgba(10,14,26,0.85); backdrop-filter: blur(10px);
    border-radius: 10px; padding: 20px; max-width: 300px;
    border: 1px solid rgba(138,154,91,0.3);
}
.controls h3 { color: #8A9A5B; margin-bottom: 12px; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }
.control-row { margin-bottom: 10px; }
.control-row label { display: block; font-size: 12px; color: #8a92a8; margin-bottom: 3px; }
.control-row input[type="range"] { width: 100%; accent-color: #8A9A5B; }
.control-row .value { float: right; color: #DDA15E; font-size: 12px; font-weight: 600; }
.presets { display: flex; flex-wrap: wrap; gap: 4px; }
.presets button {
    background: rgba(138,154,91,0.2); color: #8A9A5B; border: 1px solid rgba(138,154,91,0.4);
    padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 11px;
    transition: all 0.2s;
}
.presets button:hover { background: rgba(138,154,91,0.4); }
.presets button.active { background: #8A9A5B; color: #0a0e1a; }
.color-row { display: flex; gap: 4px; flex-wrap: wrap; }
.color-row button {
    width: 24px; height: 24px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.2);
    cursor: pointer; transition: border-color 0.2s;
}
.color-row button.active { border-color: #fff; }
.info {
    position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 100;
    background: rgba(10,14,26,0.85); backdrop-filter: blur(10px);
    border-radius: 10px; padding: 10px 20px;
    border: 1px solid rgba(138,154,91,0.3);
    font-size: 14px; color: #8a92a8; text-align: center;
}
.info span { color: #DDA15E; font-weight: 600; }
.info .interval { color: #8A9A5B; font-weight: 700; font-size: 16px; }
</style>
</head>
<body>
<a href="index.html" class="back-link">&larr; Cymatics</a>

<div class="controls">
    <h3>Lissajous Figures</h3>
    <div class="control-row">
        <label>Frequency A <span class="value" id="freqAVal">3</span></label>
        <input type="range" id="freqASlider" min="1" max="12" value="3" step="1">
    </div>
    <div class="control-row">
        <label>Frequency B <span class="value" id="freqBVal">2</span></label>
        <input type="range" id="freqBSlider" min="1" max="12" value="2" step="1">
    </div>
    <div class="control-row">
        <label>Phase Offset <span class="value" id="phaseVal">0.00</span></label>
        <input type="range" id="phaseSlider" min="0" max="314" value="0">
    </div>
    <div class="control-row">
        <label>Trail Length <span class="value" id="trailVal">85</span></label>
        <input type="range" id="trailSlider" min="10" max="100" value="85">
    </div>
    <div class="control-row">
        <label>Line Thickness <span class="value" id="thickVal">3.0</span></label>
        <input type="range" id="thickSlider" min="10" max="80" value="30">
    </div>
    <div class="control-row">
        <label>Musical Intervals</label>
        <div class="presets" id="presetBtns">
            <button onclick="setInterval(1,1,'Unison')">1:1 Unison</button>
            <button onclick="setInterval(2,1,'Octave')">2:1 Octave</button>
            <button onclick="setInterval(3,2,'Fifth')" class="active">3:2 Fifth</button>
            <button onclick="setInterval(4,3,'Fourth')">4:3 Fourth</button>
            <button onclick="setInterval(5,4,'Maj 3rd')">5:4 Maj 3rd</button>
            <button onclick="setInterval(6,5,'Min 3rd')">6:5 Min 3rd</button>
            <button onclick="setInterval(7,5,'Tritone')">7:5 Tritone</button>
        </div>
    </div>
    <div class="control-row">
        <label>Color</label>
        <div class="color-row" id="colorBtns">
            <button style="background:#DDA15E" onclick="setColor('#DDA15E',0)" class="active"></button>
            <button style="background:#5B9A8A" onclick="setColor('#5B9A8A',1)"></button>
            <button style="background:#9A5B8A" onclick="setColor('#9A5B8A',2)"></button>
            <button style="background:#5B6F9A" onclick="setColor('#5B6F9A',3)"></button>
            <button style="background:#9A8A5B" onclick="setColor('#9A8A5B',4)"></button>
            <button style="background:#E06060" onclick="setColor('#E06060',5)"></button>
        </div>
    </div>
</div>

<div class="info">
    <span class="interval" id="intervalName">Perfect Fifth</span> &mdash; Ratio: <span id="ratioText">3:2</span>
</div>

<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

let W, H, cx, cy, scale;
let freqA = 3, freqB = 2, phaseOffset = 0, trailAlpha = 0.85;
let lineThickness = 3.0;
let lineColor = '#DDA15E';
let currentInterval = 'Perfect Fifth';
let phase = 0;
let running = true;

const intervalNames = {
    '1:1': 'Unison', '2:1': 'Octave', '3:2': 'Perfect Fifth',
    '4:3': 'Perfect Fourth', '5:4': 'Major Third', '6:5': 'Minor Third', '7:5': 'Tritone'
};

function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
    cx = W / 2;
    cy = H / 2;
    scale = Math.min(W, H) * 0.35;
    // Draw subtle grid
    drawGrid();
}
window.addEventListener('resize', resize);

function drawGrid() {
    ctx.fillStyle = '#0a0e1a';
    ctx.fillRect(0, 0, W, H);
    ctx.strokeStyle = 'rgba(138,154,91,0.06)';
    ctx.lineWidth = 1;
    const gridSpacing = 40;
    for (let x = cx % gridSpacing; x < W; x += gridSpacing) {
        ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, H); ctx.stroke();
    }
    for (let y = cy % gridSpacing; y < H; y += gridSpacing) {
        ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(W, y); ctx.stroke();
    }
    // Axes
    ctx.strokeStyle = 'rgba(138,154,91,0.12)';
    ctx.lineWidth = 1.5;
    ctx.beginPath(); ctx.moveTo(0, cy); ctx.lineTo(W, cy); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(cx, 0); ctx.lineTo(cx, H); ctx.stroke();
}

function hexToRgb(hex) {
    const r = parseInt(hex.slice(1, 3), 16);
    const g = parseInt(hex.slice(3, 5), 16);
    const b = parseInt(hex.slice(5, 7), 16);
    return { r, g, b };
}

function draw() {
    // Partial clear for trail effect
    ctx.fillStyle = `rgba(10,14,26,${1.0 - trailAlpha / 100})`;
    ctx.fillRect(0, 0, W, H);

    // Redraw grid very faintly
    ctx.strokeStyle = 'rgba(138,154,91,0.02)';
    ctx.lineWidth = 1;
    const gridSpacing = 40;
    for (let x = cx % gridSpacing; x < W; x += gridSpacing) {
        ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, H); ctx.stroke();
    }
    for (let y = cy % gridSpacing; y < H; y += gridSpacing) {
        ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(W, y); ctx.stroke();
    }

    const rgb = hexToRgb(lineColor);
    const steps = 2000;
    const dt = (Math.PI * 2) / steps;

    // Draw the curve with varying thickness for 3D tube effect
    ctx.lineCap = 'round';
    ctx.lineJoin = 'round';

    for (let i = 0; i < steps - 1; i++) {
        const t1 = i * dt;
        const t2 = (i + 1) * dt;

        const x1 = cx + Math.sin(freqA * t1 + phaseOffset + phase) * scale;
        const y1 = cy + Math.sin(freqB * t1) * scale;
        const x2 = cx + Math.sin(freqA * t2 + phaseOffset + phase) * scale;
        const y2 = cy + Math.sin(freqB * t2) * scale;

        // 3D tube effect: thickness varies with "depth" (use a third sinusoidal)
        const depth = Math.sin(t1 * 1.5 + phase * 0.3) * 0.5 + 0.5;
        const thick = lineThickness * (0.4 + depth * 0.6);

        // Brightness varies with depth
        const bright = 0.5 + depth * 0.5;
        const alpha = 0.6 + depth * 0.4;

        ctx.beginPath();
        ctx.moveTo(x1, y1);
        ctx.lineTo(x2, y2);
        ctx.strokeStyle = `rgba(${Math.floor(rgb.r * bright)},${Math.floor(rgb.g * bright)},${Math.floor(rgb.b * bright)},${alpha})`;
        ctx.lineWidth = thick;
        ctx.stroke();
    }

    // Glow effect: redraw with larger width and low alpha
    ctx.globalCompositeOperation = 'lighter';
    ctx.beginPath();
    for (let i = 0; i < steps; i++) {
        const t = i * dt;
        const x = cx + Math.sin(freqA * t + phaseOffset + phase) * scale;
        const y = cy + Math.sin(freqB * t) * scale;
        if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
    }
    ctx.strokeStyle = `rgba(${rgb.r},${rgb.g},${rgb.b},0.08)`;
    ctx.lineWidth = lineThickness * 4;
    ctx.stroke();
    ctx.globalCompositeOperation = 'source-over';
}

function animate() {
    if (running) {
        phase += 0.003;
    }
    draw();
    requestAnimationFrame(animate);
}

function setInterval(a, b, name) {
    freqA = a; freqB = b;
    currentInterval = name;
    document.getElementById('freqASlider').value = a;
    document.getElementById('freqBSlider').value = b;
    document.getElementById('freqAVal').textContent = a;
    document.getElementById('freqBVal').textContent = b;
    document.getElementById('intervalName').textContent = name;
    document.getElementById('ratioText').textContent = a + ':' + b;
    document.querySelectorAll('#presetBtns button').forEach(btn => btn.classList.remove('active'));
    // Find and activate matching button
    document.querySelectorAll('#presetBtns button').forEach(btn => {
        if (btn.textContent.includes(name)) btn.classList.add('active');
    });
    drawGrid();
}
window.setInterval = setInterval;

function setColor(color, idx) {
    lineColor = color;
    document.querySelectorAll('#colorBtns button').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('#colorBtns button')[idx].classList.add('active');
    drawGrid();
}
window.setColor = setColor;

function updateIntervalName() {
    const key = freqA + ':' + freqB;
    const name = intervalNames[key] || (freqA + ':' + freqB);
    currentInterval = name;
    document.getElementById('intervalName').textContent = name;
    document.getElementById('ratioText').textContent = freqA + ':' + freqB;
    document.querySelectorAll('#presetBtns button').forEach(btn => btn.classList.remove('active'));
}

document.getElementById('freqASlider').addEventListener('input', function() {
    freqA = parseInt(this.value);
    document.getElementById('freqAVal').textContent = freqA;
    updateIntervalName();
    drawGrid();
});

document.getElementById('freqBSlider').addEventListener('input', function() {
    freqB = parseInt(this.value);
    document.getElementById('freqBVal').textContent = freqB;
    updateIntervalName();
    drawGrid();
});

document.getElementById('phaseSlider').addEventListener('input', function() {
    phaseOffset = this.value / 100;
    document.getElementById('phaseVal').textContent = phaseOffset.toFixed(2);
});

document.getElementById('trailSlider').addEventListener('input', function() {
    trailAlpha = parseInt(this.value);
    document.getElementById('trailVal').textContent = trailAlpha;
});

document.getElementById('thickSlider').addEventListener('input', function() {
    lineThickness = this.value / 10;
    document.getElementById('thickVal').textContent = lineThickness.toFixed(1);
});

window.reset = function() {
    freqA = 3; freqB = 2; phaseOffset = 0; trailAlpha = 85; lineThickness = 3.0;
    lineColor = '#DDA15E'; phase = 0;
    document.getElementById('freqASlider').value = 3;
    document.getElementById('freqBSlider').value = 2;
    document.getElementById('phaseSlider').value = 0;
    document.getElementById('trailSlider').value = 85;
    document.getElementById('thickSlider').value = 30;
    document.getElementById('freqAVal').textContent = '3';
    document.getElementById('freqBVal').textContent = '2';
    document.getElementById('phaseVal').textContent = '0.00';
    document.getElementById('trailVal').textContent = '85';
    document.getElementById('thickVal').textContent = '3.0';
    setInterval(3, 2, 'Fifth');
    setColor('#DDA15E', 0);
    resize();
};

window.togglePause = function() { running = !running; };

resize();
animate();
</script>
<script src="../assets/js/enhance.js"></script>
</body>
</html>
