<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase Diagram Explorer - CCAB</title>
    <link rel="stylesheet" href="../assets/css/gallery-standard.css">
    <style>
        body {
            background: #f8fafc;
            color: #333;
            font-family: system-ui;
            padding: 2rem;
            text-align: center;
        }
        .container { max-width: 1000px; margin: 0 auto; display: flex; gap: 20px; justify-content: center; }
        
        .graph-area {
            position: relative;
            width: 400px;
            height: 400px;
            background: #fff;
            border: 2px solid #333;
            cursor: crosshair;
        }
        
        .sim-area {
            width: 400px;
            height: 400px;
            background: #000;
            border: 2px solid #333;
            position: relative;
            overflow: hidden;
        }
        
        .particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #fff;
            border-radius: 50%;
        }
        
        .label {
            position: absolute;
            font-weight: bold;
            color: #555;
            pointer-events: none;
        }
        
        .cursor {
            width: 10px;
            height: 10px;
            background: #ef4444;
            border-radius: 50%;
            position: absolute;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }
        
        .status {
            margin-top: 20px;
            font-size: 1.2rem;
            font-weight: bold;
        }
        
    </style>
</head>
<body>

<a href="../index.html" class="gallery-back">‚Üê Back to Gallery</a>
<h1>Phase Diagram (Water)</h1>
<p>Move mouse over graph to change Pressure and Temperature.</p>

<div class="container">
    <div class="graph-area" id="graph">
        <!-- SVG Overlay for lines -->
        <svg width="100%" height="100%" style="position:absolute; top:0; left:0;">
            <!-- Solid-Liquid Line (Melting) - Slopes left for water -->
            <path d="M100,200 L80,0" stroke="#333" stroke-width="2" fill="none" />
            <!-- Liquid-Gas Line (Boiling) -->
            <path d="M100,200 Q200,150 400,100" stroke="#333" stroke-width="2" fill="none" />
            <!-- Solid-Gas Line (Sublimation) -->
            <path d="M0,400 Q50,300 100,200" stroke="#333" stroke-width="2" fill="none" />
        </svg>
        
        <div class="label" style="top:50px; left:200px;">LIQUID</div>
        <div class="label" style="top:250px; left:200px;">GAS</div>
        <div class="label" style="top:100px; left:30px;">SOLID</div>
        
        <div class="label" style="top:190px; left:105px; font-size:0.8rem;">Triple Point</div>
        
        <div id="cursor" class="cursor" style="left:200px; top:200px;"></div>
    </div>
    
    <div class="sim-area" id="sim">
        <!-- Particles -->
    </div>
</div>

<div class="status" id="status">State: Gas</div>

<script>
    const graph = document.getElementById('graph');
    const sim = document.getElementById('sim');
    const cursor = document.getElementById('cursor');
    const statusEl = document.getElementById('status');
    
    let particles = [];
    const N = 50;
    
    // Physics State
    let temperature = 0.5; // 0 to 1
    let pressure = 0.5; // 0 to 1
    let state = 'gas'; // solid, liquid, gas
    
    // Init Particles
    for(let i=0; i<N; i++) {
        const p = document.createElement('div');
        p.className = 'particle';
        sim.appendChild(p);
        particles.push({
            el: p,
            x: Math.random() * 390,
            y: Math.random() * 390,
            vx: (Math.random()-0.5)*2,
            vy: (Math.random()-0.5)*2
        });
    }
    
    // Mouse Interaction
    graph.addEventListener('mousemove', e => {
        const rect = graph.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        cursor.style.left = x + 'px';
        cursor.style.top = y + 'px';
        
        // Map to T (x) and P (inv y)
        const T = x / 400;
        const P = 1 - (y / 400);
        
        determineState(x, y);
        temperature = T;
        pressure = P;
    });
    
    function determineState(x, y) {
        // Simple regions based on lines drawn
        // Triple point approx (100, 200)
        
        if (x < 100) {
            // Left of triple point x
            // Check sublimation curve
            // Approx curve y = 400 - 2x
            if (y > 400 - 2*x) state = 'solid';
            else state = 'gas';
        } else {
            // Right of triple point x
            // Check boiling curve
            // Approx y = 200 - (x-100)/2
            // And melting line (x < 100 is solid/liquid boundary? No, melting line is steep)
            // Water melting line slopes LEFT. 
            // So if x < 100 (actually slight slant), but we keep simple.
            
            // Let's use simple logic:
            if (y < 200 - (x-100)/3) state = 'liquid'; // Above boiling line
            else state = 'gas';
            
            // Fix Solid region extension
            // If x is just above 100, melting line goes up/left.
            // Let's simplified regions
        }
        
        // Override with simple bounding boxes for robust demo
        // Triple point 100, 200
        if (x < 100 && y < 200) state = 'solid';
        else if (x < 80 && y < 200) state = 'solid'; // Slant
        else if (y > 200 + (x-100)/2) state = 'gas'; // Bottom right
        else if (x > 100 && y < 200 + (x-100)/2) state = 'liquid'; // Top right
        else state = 'solid'; // Top left
        
        statusEl.textContent = `State: ${state.toUpperCase()} (T=${(temperature*100).toFixed(0)}, P=${(pressure*100).toFixed(0)})`;
    }
    
    function loop() {
        // Simulation Physics based on State
        const speed = temperature * 5;
        const wiggle = 1;
        
        particles.forEach(p => {
            if (state === 'solid') {
                // Vibrate in place (Crystal lattice)
                // Grid target
                const idx = particles.indexOf(p);
                const cols = Math.ceil(Math.sqrt(N));
                const row = Math.floor(idx / cols);
                const col = idx % cols;
                
                const tx = 50 + col * 40;
                const ty = 50 + row * 40;
                
                // Spring force to target
                p.vx += (tx - p.x) * 0.1;
                p.vy += (ty - p.y) * 0.1;
                p.vx *= 0.8;
                p.vy *= 0.8;
                
                // Heat vibration
                p.vx += (Math.random()-0.5) * speed * 0.5;
                p.vy += (Math.random()-0.5) * speed * 0.5;
                
            } else if (state === 'liquid') {
                // Flow, gravity, bounce
                p.vy += 0.1; // Gravity
                p.vx += (Math.random()-0.5) * speed;
                p.vy += (Math.random()-0.5) * speed;
                
                // Bounds
                if (p.y > 390) { p.y = 390; p.vy *= -0.5; }
                if (p.x < 0 || p.x > 390) p.vx *= -1;
                
                // Damp
                p.vx *= 0.95;
                p.vy *= 0.95;
                
            } else if (state === 'gas') {
                // Free fly
                // Speed depends on T
                // Pressure logic? (Bounce harder?)
                
                // Just random motion
                // Normalize velocity to speed
                const currSpeed = Math.hypot(p.vx, p.vy);
                if (currSpeed === 0) { p.vx=1; p.vy=0; }
                else {
                    const scale = (speed + 2) / currSpeed; // Min speed 2
                    p.vx *= scale;
                    p.vy *= scale;
                }
                
                if (p.x < 0 || p.x > 390) p.vx *= -1;
                if (p.y < 0 || p.y > 390) p.vy *= -1;
            }
            
            p.x += p.vx;
            p.y += p.vy;
            
            p.el.style.left = p.x + 'px';
            p.el.style.top = p.y + 'px';
        });
        
        requestAnimationFrame(loop);
    }
    
    loop();

</script>
</body>
</html>
