<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buffer Solution pH - CCAB</title>
    <link rel="stylesheet" href="../assets/css/gallery-standard.css">
    <style>
        body {
            background: #fff;
            color: #333;
            font-family: system-ui;
            padding: 2rem;
            text-align: center;
        }
        .container { max-width: 1000px; margin: 0 auto; display: flex; gap: 40px; justify-content: center; }
        
        .beaker {
            width: 200px;
            height: 300px;
            border: 4px solid #aaa;
            border-top: none;
            border-radius: 0 0 20px 20px;
            position: relative;
            background: rgba(200,200,200,0.1);
            overflow: hidden;
        }
        
        .liquid {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 200px;
            background: #ecfeff;
            transition: background 0.5s, height 0.5s;
        }
        
        .ph-meter {
            position: absolute;
            top: 20px;
            right: -60px;
            background: #333;
            color: #fcd34d;
            padding: 10px;
            font-family: monospace;
            font-size: 1.5rem;
            border-radius: 4px;
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            text-align: left;
        }
        
        button {
            padding: 10px;
            cursor: pointer;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 4px;
        }
        
        canvas {
            border: 1px solid #ccc;
            background: #fff;
        }
        
    </style>
</head>
<body>

<a href="../index.html" class="gallery-back">‚Üê Back to Gallery</a>
<h1>Buffer Solution pH</h1>
<p>Henderson-Hasselbalch Equation: \( pH = pKa + \log([A^-]/[HA]) \)</p>

<div class="container">
    <div style="position:relative;">
        <div class="beaker">
            <div class="liquid" id="liquid"></div>
        </div>
        <div class="ph-meter" id="ph-display">7.00</div>
    </div>
    
    <div class="controls">
        <h3>Add Reagents</h3>
        <button onclick="addAcid()">Add HCl (Strong Acid)</button>
        <button onclick="addBase()">Add NaOH (Strong Base)</button>
        <button onclick="reset(false)" style="background:#9ca3af">Reset (Water)</button>
        <button onclick="reset(true)" style="background:#10b981">Reset (Buffer)</button>
    </div>
    
    <div>
        <h3>Titration Curve</h3>
        <canvas id="graph" width="300" height="300"></canvas>
    </div>
</div>

<script>
    const liquid = document.getElementById('liquid');
    const phDisp = document.getElementById('ph-display');
    const canvas = document.getElementById('graph');
    const ctx = canvas.getContext('2d');
    
    // State
    let isBuffered = false;
    let addedVolume = 0; // mL of titrant (negative for acid, positive for base)
    
    // Buffer: Acetic Acid (CH3COOH) pKa = 4.76
    const pKa = 4.76;
    let ratio = 1; // [A-]/[HA]
    
    let history = [];
    
    function reset(buffered) {
        isBuffered = buffered;
        addedVolume = 0;
        history = [];
        update();
    }
    
    function addAcid() { addedVolume -= 1; update(); }
    function addBase() { addedVolume += 1; update(); }
    
    function update() {
        let pH = 7;
        
        if (isBuffered) {
            // Simple buffer simulation
            // Initial 1:1 ratio.
            // Adding Base increases [A-], decreases [HA].
            // Adding Acid decreases [A-], increases [HA].
            // Capacity limit approx +/- 10 units
            
            const capacity = 10;
            const effectiveRatio = (10 + addedVolume) / (10 - addedVolume);
            
            if (effectiveRatio <= 0 || !isFinite(effectiveRatio)) {
                // Buffer broken
                pH = addedVolume > 0 ? 13 : 1;
            } else {
                pH = pKa + Math.log10(effectiveRatio);
            }
        } else {
            // Water (Unbuffered)
            // Drastic changes
            // Neutral 7. Add acid -> 2. Add base -> 12.
            // Sigmoid-ish
            pH = 7 + (addedVolume * 0.5); // Very sensitive
            if (pH < 1) pH = 1;
            if (pH > 14) pH = 14;
        }
        
        // Render
        phDisp.textContent = pH.toFixed(2);
        
        // Color (Universal Indicator)
        // Red (Acid) -> Green (Neut) -> Purple (Base)
        let color = '#fff';
        if (pH < 4) color = '#ef4444';
        else if (pH < 6) color = '#f97316';
        else if (pH < 8) color = '#84cc16';
        else if (pH < 10) color = '#0ea5e9';
        else color = '#8b5cf6';
        
        liquid.style.backgroundColor = color;
        liquid.style.height = (200 + Math.abs(addedVolume)*2) + 'px';
        
        // Graph
        history.push({x: addedVolume, y: pH});
        drawGraph();
    }
    
    function drawGraph() {
        ctx.clearRect(0, 0, 300, 300);
        
        // Axes
        ctx.strokeStyle = '#999';
        ctx.beginPath();
        ctx.moveTo(150, 0); ctx.lineTo(150, 300); // Y axis (Vol=0)
        ctx.moveTo(0, 300); ctx.lineTo(300, 300); // X axis (pH 0? No x is vol)
        ctx.stroke();
        
        // Plot
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        ctx.beginPath();
        
        // Map: X(-20 to 20) -> 0 to 300. Center 150. Scale 7.5px/unit
        // Map: Y(0 to 14) -> 300 to 0. Scale 300/14 = 21.4px/unit
        
        history.forEach((p, i) => {
            const px = 150 + p.x * 7.5;
            const py = 300 - p.y * 21.4;
            if (i===0) ctx.moveTo(px, py);
            else ctx.lineTo(px, py);
        });
        ctx.stroke();
    }
    
    reset(false);

</script>
</body>
</html>
