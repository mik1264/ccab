<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polymerization Simulator - CCAB</title>
    <link rel="stylesheet" href="../assets/css/gallery-standard.css">
    <style>
        body {
            background: #fff;
            color: #333;
            font-family: system-ui;
            padding: 2rem;
            text-align: center;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        
        canvas {
            background: #f3f4f6;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        button {
            padding: 10px 20px;
            background: #f59e0b;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 20px;
            font-weight: bold;
        }
        
    </style>
</head>
<body>

<div class="container">
    <a href="../index.html" class="gallery-back">‚Üê Back to Gallery</a>
    <h1>Free Radical Polymerization</h1>
    <p>Initiator (Red) attacks Monomer (Blue), creating a radical chain that grows.</p>
    
    <canvas id="canvas" width="800" height="500"></canvas>
    
    <div>
        <button onclick="addInitiator()">Add Initiator (Free Radical)</button>
        <button onclick="reset()">Reset</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    let particles = [];
    
    function reset() {
        particles = [];
        // Add Monomers
        for(let i=0; i<100; i++) {
            particles.push({
                type: 'monomer',
                x: Math.random()*800,
                y: Math.random()*500,
                vx: (Math.random()-0.5),
                vy: (Math.random()-0.5),
                r: 6,
                chain: null
            });
        }
    }
    
    function addInitiator() {
        particles.push({
            type: 'radical',
            x: Math.random()*800,
            y: Math.random()*500,
            vx: (Math.random()-0.5)*3,
            vy: (Math.random()-0.5)*3,
            r: 8,
            chain: [] // List of bonded monomers
        });
    }
    
    function loop() {
        ctx.clearRect(0, 0, 800, 500);
        
        // Update
        for (let i=0; i<particles.length; i++) {
            let p = particles[i];
            
            if (p.type === 'monomer' && p.chain === null) {
                // Free monomer
                p.x += p.vx; p.y += p.vy;
                if (p.x < 0 || p.x > 800) p.vx *= -1;
                if (p.y < 0 || p.y > 500) p.vy *= -1;
            }
            else if (p.type === 'radical') {
                // Active chain end moves randomly
                // Drag the chain? Or simpler: Chain is just list of pos.
                // Let's model physical chain linkage.
                // Simplification: Radical moves, if hits monomer, monomer joins chain end, radical moves to monomer pos.
                // Monomer becomes new radical center? Yes.
                
                p.x += p.vx; p.y += p.vy;
                if (p.x < 0 || p.x > 800) p.vx *= -1;
                if (p.y < 0 || p.y > 500) p.vy *= -1;
                
                // Collision with Monomers
                for (let j=0; j<particles.length; j++) {
                    let m = particles[j];
                    if (m.type === 'monomer' && m.chain === null) {
                        const dist = Math.hypot(p.x - m.x, p.y - m.y);
                        if (dist < p.r + m.r) {
                            // Bond!
                            // Monomer is now part of chain
                            m.chain = p.chain; // Link ref (not used much visually here but logical)
                            p.chain.push({ x: m.x, y: m.y }); // Add old position to chain trail
                            
                            // Radical "jumps" to monomer's position effectively
                            // But physically, the monomer attaches.
                            // Let's make the radical stay the "Head"
                            // But the chain grows behind it.
                            
                            // Just mark monomer as consumed (remove from physics)
                            particles.splice(j, 1);
                            j--;
                            // Grow p?
                            // p is the active head. It leaves a trail.
                        }
                    }
                }
            }
        }
        
        // Draw
        particles.forEach(p => {
            if (p.type === 'monomer') {
                ctx.fillStyle = '#3b82f6';
                ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2); ctx.fill();
            } else if (p.type === 'radical') {
                // Draw Chain
                ctx.strokeStyle = '#666';
                ctx.lineWidth = 4;
                ctx.beginPath();
                if (p.chain.length > 0) {
                    ctx.moveTo(p.chain[0].x, p.chain[0].y);
                    for(let k=1; k<p.chain.length; k++) {
                        ctx.lineTo(p.chain[k].x, p.chain[k].y);
                    }
                    ctx.lineTo(p.x, p.y);
                }
                ctx.stroke();
                
                // Draw nodes on chain
                ctx.fillStyle = '#9ca3af';
                p.chain.forEach(node => {
                    ctx.beginPath(); ctx.arc(node.x, node.y, 6, 0, Math.PI*2); ctx.fill();
                });
                
                // Draw Radical Head
                ctx.fillStyle = '#ef4444';
                ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2); ctx.fill();
                // Spark
                ctx.fillStyle = '#fcd34d';
                ctx.beginPath(); ctx.arc(p.x+3, p.y-3, 3, 0, Math.PI*2); ctx.fill();
            }
        });
        
        requestAnimationFrame(loop);
    }
    
    reset();
    requestAnimationFrame(loop);

</script>
</body>
</html>
