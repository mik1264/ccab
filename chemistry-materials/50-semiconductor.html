<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Semiconductor Doping - CCAB</title>
    <link rel="stylesheet" href="../assets/css/gallery-standard.css">
    <style>
        body {
            background: #111;
            color: #ddd;
            font-family: system-ui;
            padding: 2rem;
            text-align: center;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        
        .lattice {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 5px;
            width: 500px;
            margin: 20px auto;
            background: #222;
            padding: 10px;
            border-radius: 8px;
        }
        
        .atom {
            aspect-ratio: 1;
            background: #444;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8rem;
            cursor: pointer;
            position: relative;
        }
        
        .atom.si { color: #aaa; }
        .atom.p { background: #10b981; color: #000; } /* N-type Donor */
        .atom.b { background: #ef4444; color: #fff; } /* P-type Acceptor */
        
        .carrier {
            position: absolute;
            width: 8px; height: 8px;
            border-radius: 50%;
            pointer-events: none;
            transition: all 0.2s;
        }
        .carrier.electron { background: #fcd34d; box-shadow: 0 0 5px #fcd34d; }
        .carrier.hole { border: 2px solid #fff; background: transparent; }
        
        .controls {
            margin: 20px;
        }
        button {
            padding: 10px 20px;
            margin: 0 5px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            font-weight: bold;
        }
        .btn-si { background: #666; color: white; }
        .btn-n { background: #10b981; color: black; }
        .btn-p { background: #ef4444; color: white; }
        
    </style>
</head>
<body>

<div class="container">
    <a href="../index.html" class="gallery-back">‚Üê Back to Gallery</a>
    <h1>Semiconductor Doping</h1>
    <p>Click atoms to dope the Silicon lattice.</p>
    
    <div class="controls">
        <button class="btn-si" onclick="tool='Si'">Silicon (Neutral)</button>
        <button class="btn-n" onclick="tool='P'">Phosphorus (N-Type)</button>
        <button class="btn-p" onclick="tool='B'">Boron (P-Type)</button>
    </div>
    
    <div class="lattice" id="grid"></div>
    
    <div id="stats">Carriers: 0 e-, 0 h+</div>
</div>

<script>
    const grid = document.getElementById('grid');
    let tool = 'P';
    const atoms = [];
    const carriers = [];
    
    // Init Grid
    for(let i=0; i<100; i++) {
        const div = document.createElement('div');
        div.className = 'atom si';
        div.textContent = 'Si';
        div.dataset.idx = i;
        div.onclick = handleClick;
        grid.appendChild(div);
        
        atoms.push({ type: 'Si', el: div });
    }
    
    function handleClick(e) {
        const idx = e.target.dataset.idx;
        const atom = atoms[idx];
        
        // Remove old carrier if any attached to this atom source
        // Simplified: Just clear all carriers and regenerate
        
        atom.type = tool;
        atom.el.className = `atom ${tool.toLowerCase()}`;
        atom.el.textContent = tool;
        
        spawnCarriers();
    }
    
    function spawnCarriers() {
        // Clear DOM carriers
        document.querySelectorAll('.carrier').forEach(c => c.remove());
        carriers.length = 0;
        
        let eCount = 0;
        let hCount = 0;
        
        atoms.forEach((a, i) => {
            const rect = a.el.getBoundingClientRect();
            // We need coords relative to grid? Or absolute?
            // Absolute is easier for floating particles
            
            if (a.type === 'P') {
                eCount++;
                createCarrier('electron', i);
            } else if (a.type === 'B') {
                hCount++;
                createCarrier('hole', i);
            }
        });
        
        document.getElementById('stats').textContent = `Carriers: ${eCount} e-, ${hCount} h+`;
    }
    
    function createCarrier(type, atomIdx) {
        const el = document.createElement('div');
        el.className = `carrier ${type}`;
        document.body.appendChild(el); // Append to body to float
        
        carriers.push({
            el: el,
            type: type,
            idx: atomIdx, // Current grid index location
            tx: 0, ty: 0 // Target screen coords
        });
        
        updateCarrierPos(carriers[carriers.length-1], atomIdx);
    }
    
    function updateCarrierPos(c, idx) {
        const atomEl = atoms[idx].el;
        const rect = atomEl.getBoundingClientRect();
        // Center + random offset
        c.tx = rect.left + rect.width/2 - 4;
        c.ty = rect.top + rect.height/2 - 4;
        
        c.el.style.left = c.tx + 'px';
        c.el.style.top = c.ty + 'px';
    }
    
    // Brownian Motion
    setInterval(() => {
        carriers.forEach(c => {
            // Move to neighbor
            const row = Math.floor(c.idx / 10);
            const col = c.idx % 10;
            
            const move = Math.floor(Math.random() * 4); // 0:U, 1:R, 2:D, 3:L
            let nextIdx = c.idx;
            
            if (move === 0 && row > 0) nextIdx -= 10;
            if (move === 1 && col < 9) nextIdx += 1;
            if (move === 2 && row < 9) nextIdx += 10;
            if (move === 3 && col > 0) nextIdx -= 1;
            
            // Recombination?
            // If electron meets hole...
            // For now just wander
            
            c.idx = nextIdx;
            updateCarrierPos(c, nextIdx);
        });
    }, 500);

</script>
</body>
</html>
