<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bezier Curves - WebAssembly</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #0a0a0a;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }
        canvas {
            border: 2px solid #222;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const width = canvas.width = 1200;
        const height = canvas.height = 800;

        class BezierCurve {
            constructor() {
                this.points = [];
                for (let i = 0; i < 4; i++) {
                    this.points.push({
                        x: Math.random() * width,
                        y: Math.random() * height,
                        vx: (Math.random() - 0.5) * 2,
                        vy: (Math.random() - 0.5) * 2
                    });
                }
                this.hue = Math.random() * 360;
            }

            update() {
                this.points.forEach(p => {
                    p.x += p.vx;
                    p.y += p.vy;

                    if (p.x < 0 || p.x > width) p.vx *= -1;
                    if (p.y < 0 || p.y > height) p.vy *= -1;

                    p.x = Math.max(0, Math.min(width, p.x));
                    p.y = Math.max(0, Math.min(height, p.y));
                });
            }

            bezier(t) {
                const p0 = this.points[0];
                const p1 = this.points[1];
                const p2 = this.points[2];
                const p3 = this.points[3];

                const t2 = t * t;
                const t3 = t2 * t;
                const mt = 1 - t;
                const mt2 = mt * mt;
                const mt3 = mt2 * mt;

                return {
                    x: mt3 * p0.x + 3 * mt2 * t * p1.x + 3 * mt * t2 * p2.x + t3 * p3.x,
                    y: mt3 * p0.y + 3 * mt2 * t * p1.y + 3 * mt * t2 * p2.y + t3 * p3.y
                };
            }

            draw(showPoints = false, showConstruction = false) {
                ctx.strokeStyle = `hsl(${this.hue}, 80%, 60%)`;
                ctx.lineWidth = 3;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';

                ctx.beginPath();
                for (let t = 0; t <= 1; t += 0.01) {
                    const point = this.bezier(t);
                    if (t === 0) {
                        ctx.moveTo(point.x, point.y);
                    } else {
                        ctx.lineTo(point.x, point.y);
                    }
                }
                ctx.stroke();

                if (showConstruction) {
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
                    ctx.lineWidth = 1;
                    ctx.setLineDash([5, 5]);

                    ctx.beginPath();
                    ctx.moveTo(this.points[0].x, this.points[0].y);
                    ctx.lineTo(this.points[1].x, this.points[1].y);
                    ctx.moveTo(this.points[2].x, this.points[2].y);
                    ctx.lineTo(this.points[3].x, this.points[3].y);
                    ctx.stroke();

                    ctx.setLineDash([]);
                }

                if (showPoints) {
                    this.points.forEach((p, i) => {
                        ctx.fillStyle = i === 0 || i === 3 ? '#0f0' : '#f90';
                        ctx.beginPath();
                        ctx.arc(p.x, p.y, 6, 0, Math.PI * 2);
                        ctx.fill();

                        ctx.strokeStyle = '#fff';
                        ctx.lineWidth = 2;
                        ctx.stroke();
                    });
                }
            }
        }

        const curves = [];
        for (let i = 0; i < 8; i++) {
            curves.push(new BezierCurve());
        }

        let time = 0;

        function animate() {
            time += 0.01;

            ctx.fillStyle = 'rgba(10, 10, 10, 0.1)';
            ctx.fillRect(0, 0, width, height);

            curves.forEach((curve, i) => {
                curve.update();
                curve.hue = (curve.hue + 0.5) % 360;
                curve.draw(i < 2, i < 2);
            });

            for (let i = 0; i < curves.length - 1; i++) {
                const c1 = curves[i];
                const c2 = curves[i + 1];

                for (let t = 0; t <= 1; t += 0.1) {
                    const p1 = c1.bezier(t);
                    const p2 = c2.bezier(t);

                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
                    ctx.lineWidth = 0.5;
                    ctx.beginPath();
                    ctx.moveTo(p1.x, p1.y);
                    ctx.lineTo(p2.x, p2.y);
                    ctx.stroke();
                }
            }

            requestAnimationFrame(animate);
        }

        animate();
    </script>
</body>
</html>
