<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Julia Set - WebAssembly</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }
        canvas {
            border: 2px solid #333;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const width = canvas.width = 800;
        const height = canvas.height = 800;

        // Compile WebAssembly for Julia set computation
        const wasmBytes = new Uint8Array([
            0x00, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00, 0x01, 0x0d, 0x02, 0x60,
            0x04, 0x7d, 0x7d, 0x7d, 0x7d, 0x01, 0x7f, 0x60, 0x00, 0x00, 0x03, 0x02,
            0x01, 0x00, 0x07, 0x09, 0x01, 0x05, 0x6a, 0x75, 0x6c, 0x69, 0x61, 0x00,
            0x00, 0x0a, 0x52, 0x01, 0x50, 0x01, 0x05, 0x7d, 0x20, 0x00, 0x21, 0x04,
            0x20, 0x01, 0x21, 0x05, 0x41, 0x00, 0x21, 0x06, 0x03, 0x40, 0x20, 0x04,
            0x20, 0x04, 0x94, 0x20, 0x05, 0x20, 0x05, 0x94, 0x92, 0x43, 0x00, 0x00,
            0x80, 0x40, 0x5e, 0x04, 0x40, 0x20, 0x06, 0x0f, 0x0b, 0x20, 0x04, 0x20,
            0x04, 0x94, 0x20, 0x05, 0x20, 0x05, 0x94, 0x93, 0x20, 0x02, 0x92, 0x21,
            0x07, 0x43, 0x00, 0x00, 0x00, 0x40, 0x20, 0x04, 0x94, 0x20, 0x05, 0x94,
            0x20, 0x03, 0x92, 0x21, 0x05, 0x20, 0x07, 0x21, 0x04, 0x20, 0x06, 0x41,
            0x01, 0x6a, 0x22, 0x06, 0x41, 0xff, 0x01, 0x49, 0x0d, 0x00, 0x0b, 0x41,
            0xff, 0x01, 0x0b
        ]);

        let wasm;
        let time = 0;

        async function init() {
            const module = await WebAssembly.instantiate(wasmBytes);
            wasm = module.instance;
            animate();
        }

        function animate() {
            time += 0.01;
            const cx = -0.7 + 0.3 * Math.cos(time);
            const cy = 0.27015 + 0.1 * Math.sin(time * 1.3);

            const imageData = ctx.createImageData(width, height);

            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    const zx = (x - width / 2) / (width / 4);
                    const zy = (y - height / 2) / (height / 4);

                    const iter = wasm.exports.julia(zx, zy, cx, cy);

                    const idx = (y * width + x) * 4;
                    const t = iter / 255;
                    imageData.data[idx] = Math.floor(9 * (1 - t) * t * t * t * 255);
                    imageData.data[idx + 1] = Math.floor(15 * (1 - t) * (1 - t) * t * t * 255);
                    imageData.data[idx + 2] = Math.floor(8.5 * (1 - t) * (1 - t) * (1 - t) * t * 255);
                    imageData.data[idx + 3] = 255;
                }
            }

            ctx.putImageData(imageData, 0, 0);
            requestAnimationFrame(animate);
        }

        init();
    </script>
</body>
</html>
