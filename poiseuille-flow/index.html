<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Poiseuille Flow in a Pipe</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: sans-serif; }
canvas { display: block; }
.title-overlay {
    position: fixed; top: 10px; left: 50%; transform: translateX(-50%);
    color: #fbbf24; font-size: 20px; font-weight: bold; z-index: 999;
    text-shadow: 0 0 10px rgba(0,0,0,0.8); pointer-events: none;
}
.controls {
    position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
    display: flex; gap: 20px; align-items: center; z-index: 999;
    background: rgba(0,0,0,0.7); padding: 12px 20px; border-radius: 10px;
    flex-wrap: wrap; justify-content: center;
}
.controls label { color: #ccc; font-size: 13px; }
.controls input[type=range] { width: 110px; cursor: pointer; }
.controls span { color: #fbbf24; font-size: 13px; min-width: 30px; }
.info {
    position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
    color: rgba(255,255,255,0.5); font-size: 12px; z-index: 999;
    pointer-events: none; text-align: center;
}
</style>
</head>
<body>
<a href="../index.html" style="position:fixed;top:10px;left:10px;padding:8px 16px;background:rgba(0,0,0,0.7);color:#fbbf24;text-decoration:none;border-radius:6px;font-size:14px;z-index:999;font-family:sans-serif;">‚Üê Back to Gallery</a>
<div class="title-overlay">Poiseuille Flow in a Pipe</div>
<div class="info">Parabolic velocity profile: v(r) = (dP/dL)(R^2 - r^2) / (4mu) -- fast at center, zero at walls</div>
<div class="controls">
    <label>Pressure Gradient</label>
    <input type="range" id="pressSlider" min="1" max="20" value="10" step="1">
    <span id="pressVal">10</span>
    <label>Viscosity</label>
    <input type="range" id="viscSlider" min="1" max="20" value="8" step="1">
    <span id="viscVal">8</span>
    <label>Pipe Radius</label>
    <input type="range" id="radiusSlider" min="3" max="10" value="7" step="1">
    <span id="radiusVal">7</span>
</div>
<canvas id="canvas"></canvas>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let W, H;

const NUM_PARTICLES = 800;
let particles = [];
let trails = [];

function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
    initParticles();
}

function getPipeRadius() {
    return parseInt(document.getElementById('radiusSlider').value) / 10 * (H * 0.35);
}

function getVelocity(r, R) {
    const dP = parseInt(document.getElementById('pressSlider').value) * 0.5;
    const mu = parseInt(document.getElementById('viscSlider').value) * 0.5;
    if (Math.abs(r) >= R) return 0;
    return dP * (R * R - r * r) / (4 * mu);
}

function getMaxVelocity() {
    const R = getPipeRadius();
    return getVelocity(0, R);
}

function initParticles() {
    particles = [];
    trails = [];
    const R = getPipeRadius();
    for (let i = 0; i < NUM_PARTICLES; i++) {
        const r = (Math.random() * 2 - 1) * R;
        particles.push({
            x: Math.random() * W,
            y: H / 2 + r,
            r: r,
            trail: []
        });
    }
}

function drawPipe() {
    const R = getPipeRadius();
    const centerY = H / 2;

    // Pipe walls with gradient
    const wallGrad = ctx.createLinearGradient(0, centerY - R - 30, 0, centerY - R);
    wallGrad.addColorStop(0, 'rgba(60, 70, 90, 0)');
    wallGrad.addColorStop(1, 'rgba(60, 70, 90, 1)');
    ctx.fillStyle = wallGrad;
    ctx.fillRect(0, centerY - R - 30, W, 30);

    const wallGrad2 = ctx.createLinearGradient(0, centerY + R, 0, centerY + R + 30);
    wallGrad2.addColorStop(0, 'rgba(60, 70, 90, 1)');
    wallGrad2.addColorStop(1, 'rgba(60, 70, 90, 0)');
    ctx.fillStyle = wallGrad2;
    ctx.fillRect(0, centerY + R, W, 30);

    // Wall lines
    ctx.strokeStyle = '#8899aa';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(0, centerY - R);
    ctx.lineTo(W, centerY - R);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(0, centerY + R);
    ctx.lineTo(W, centerY + R);
    ctx.stroke();

    // Wall labels
    ctx.fillStyle = '#8899aa';
    ctx.font = '12px sans-serif';
    ctx.fillText('Wall (v = 0)', 20, centerY - R - 8);
    ctx.fillText('Wall (v = 0)', 20, centerY + R + 18);
}

function drawVelocityProfile() {
    const R = getPipeRadius();
    const centerY = H / 2;
    const maxV = getMaxVelocity();
    const profileX = W - 120;
    const profileW = 80;

    // Profile background
    ctx.fillStyle = 'rgba(0,0,0,0.4)';
    ctx.fillRect(profileX - 15, centerY - R - 20, profileW + 30, 2 * R + 40);
    ctx.strokeStyle = 'rgba(255,255,255,0.2)';
    ctx.strokeRect(profileX - 15, centerY - R - 20, profileW + 30, 2 * R + 40);

    // Draw profile curve
    ctx.beginPath();
    ctx.strokeStyle = '#fbbf24';
    ctx.lineWidth = 2;
    for (let y = centerY - R; y <= centerY + R; y++) {
        const r = y - centerY;
        const v = getVelocity(r, R);
        const px = profileX + (v / maxV) * profileW;
        if (y === centerY - R) ctx.moveTo(profileX, y);
        else ctx.lineTo(px, y);
    }
    ctx.lineTo(profileX, centerY + R);
    ctx.stroke();

    // Fill the profile
    ctx.fillStyle = 'rgba(251, 191, 36, 0.15)';
    ctx.fill();

    // Labels
    ctx.fillStyle = '#fbbf24';
    ctx.font = '11px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('v(r)', profileX + profileW / 2, centerY - R - 6);
    ctx.fillText('v_max', profileX + profileW + 5, centerY + 4);
    ctx.textAlign = 'left';

    // Center line
    ctx.setLineDash([4, 4]);
    ctx.strokeStyle = 'rgba(251, 191, 36, 0.3)';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(0, centerY);
    ctx.lineTo(profileX - 20, centerY);
    ctx.stroke();
    ctx.setLineDash([]);
}

function drawEquation() {
    ctx.fillStyle = 'rgba(0,0,0,0.5)';
    ctx.fillRect(W / 2 - 160, 50, 320, 40);
    ctx.strokeStyle = 'rgba(251,191,36,0.3)';
    ctx.strokeRect(W / 2 - 160, 50, 320, 40);
    ctx.fillStyle = '#eee';
    ctx.font = '14px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('v(r) = (dP/dx)(R\u00B2 - r\u00B2) / (4\u03BC)', W / 2, 75);
    ctx.textAlign = 'left';
}

function render() {
    ctx.fillStyle = '#0a0e1a';
    ctx.fillRect(0, 0, W, H);

    const R = getPipeRadius();
    const centerY = H / 2;
    const maxV = Math.max(0.1, getMaxVelocity());

    // Background flow visualization
    const grad = ctx.createLinearGradient(0, centerY - R, 0, centerY + R);
    grad.addColorStop(0, 'rgba(20, 30, 60, 0.8)');
    grad.addColorStop(0.5, 'rgba(30, 50, 80, 0.8)');
    grad.addColorStop(1, 'rgba(20, 30, 60, 0.8)');
    ctx.fillStyle = grad;
    ctx.fillRect(0, centerY - R, W, 2 * R);

    // Update and draw particles
    for (let p of particles) {
        const r = p.y - centerY;
        const v = getVelocity(r, R);
        const speed = v / maxV;

        p.x += v * 0.3;

        // Store trail
        p.trail.push({ x: p.x, y: p.y });
        if (p.trail.length > 15) p.trail.shift();

        // Wrap around
        if (p.x > W + 10) {
            p.x = -10;
            p.trail = [];
            p.r = (Math.random() * 2 - 1) * R;
            p.y = centerY + p.r;
        }

        // Color by speed: blue (slow) -> cyan -> yellow -> red (fast)
        let hue, sat, light;
        if (speed < 0.3) {
            hue = 220; sat = 80; light = 40 + speed * 60;
        } else if (speed < 0.7) {
            hue = 180 - (speed - 0.3) * 300; sat = 90; light = 55;
        } else {
            hue = 40 - (speed - 0.7) * 100; sat = 95; light = 55;
        }

        // Draw trail
        if (p.trail.length > 1) {
            ctx.beginPath();
            ctx.moveTo(p.trail[0].x, p.trail[0].y);
            for (let i = 1; i < p.trail.length; i++) {
                ctx.lineTo(p.trail[i].x, p.trail[i].y);
            }
            ctx.strokeStyle = `hsla(${hue}, ${sat}%, ${light}%, 0.3)`;
            ctx.lineWidth = 1.5;
            ctx.stroke();
        }

        // Draw particle
        const size = 1.5 + speed * 2;
        ctx.beginPath();
        ctx.arc(p.x, p.y, size, 0, Math.PI * 2);
        ctx.fillStyle = `hsla(${hue}, ${sat}%, ${light}%, 0.9)`;
        ctx.fill();
    }

    drawPipe();
    drawVelocityProfile();
    drawEquation();

    // Speed legend
    ctx.fillStyle = 'rgba(0,0,0,0.4)';
    ctx.fillRect(15, centerY - 60, 80, 120);
    ctx.fillStyle = '#ccc';
    ctx.font = '11px sans-serif';
    ctx.fillText('Speed:', 25, centerY - 42);
    const legendColors = [
        { label: 'Fast', color: '#ff6633' },
        { label: 'Medium', color: '#33cccc' },
        { label: 'Slow', color: '#3366aa' }
    ];
    legendColors.forEach((lc, i) => {
        const ly = centerY - 25 + i * 28;
        ctx.beginPath();
        ctx.arc(32, ly, 5, 0, Math.PI * 2);
        ctx.fillStyle = lc.color;
        ctx.fill();
        ctx.fillStyle = '#aaa';
        ctx.fillText(lc.label, 44, ly + 4);
    });
}

document.getElementById('pressSlider').addEventListener('input', function() {
    document.getElementById('pressVal').textContent = this.value;
});
document.getElementById('viscSlider').addEventListener('input', function() {
    document.getElementById('viscVal').textContent = this.value;
});
document.getElementById('radiusSlider').addEventListener('input', function() {
    document.getElementById('radiusVal').textContent = this.value;
    initParticles();
});

function animate() {
    render();
    requestAnimationFrame(animate);
}

window.addEventListener('resize', resize);
resize();
animate();
</script>
</body>
</html>
