<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bacterial Growth - Biology & Ecology</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: linear-gradient(135deg, #1a2e1a 0%, #163e16 100%); color: #eee; min-height: 100vh; padding: 20px; }
        .back-link { position: fixed; top: 20px; left: 20px; color: #4ade80; text-decoration: none; font-weight: 600; padding: 8px 16px; background: rgba(0,0,0,0.3); border-radius: 20px; z-index: 100; }
        h1 { text-align: center; margin: 40px 0 10px; font-size: 2.2em; color: #4ade80; }
        .subtitle { text-align: center; opacity: 0.8; margin-bottom: 20px; }
        .container { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 1fr 300px; gap: 20px; }
        .panel { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 25px; }
        .info-box { background: rgba(74, 222, 128, 0.1); border: 1px solid rgba(74, 222, 128, 0.3); border-radius: 8px; padding: 15px; margin-bottom: 20px; font-size: 0.85em; line-height: 1.6; }
        h3 { color: #4ade80; margin-bottom: 15px; }
        canvas { width: 100%; border-radius: 8px; }
        .control-group { margin: 15px 0; }
        .control-group label { display: block; margin-bottom: 5px; }
        .control-group input, .control-group select { width: 100%; }
        .value-display { color: #4ade80; font-family: monospace; }
        button { width: 100%; padding: 12px; margin: 8px 0; border: none; border-radius: 8px; font-size: 1em; font-weight: 600; cursor: pointer; }
        .btn-primary { background: #4ade80; color: #1a2e1a; }
        .btn-secondary { background: rgba(255,255,255,0.1); color: #fff; }
        .btn-danger { background: #f87171; color: #fff; }
        .phase-indicator { display: flex; gap: 5px; margin: 15px 0; }
        .phase { flex: 1; padding: 8px 4px; text-align: center; border-radius: 8px; font-size: 0.75em; opacity: 0.4; transition: opacity 0.3s; }
        .phase.active { opacity: 1; }
        .resource-bar { height: 15px; background: rgba(255,255,255,0.1); border-radius: 8px; overflow: hidden; margin: 10px 0; }
        .resource-fill { height: 100%; transition: width 0.3s; }
        @media (max-width: 900px) { .container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back</a>
    <h1>Bacterial Growth</h1>
    <p class="subtitle">Exponential growth, lag phase, and resource limitation</p>

    <div class="container">
        <div class="panel">
            <canvas id="petriCanvas" width="400" height="400"></canvas>
            <canvas id="chartCanvas" width="800" height="180" style="margin-top: 15px;"></canvas>
        </div>

        <div class="panel">
            <div class="info-box">
                <strong>Bacterial Growth Phases:</strong><br>
                1. <b>Lag</b>: Adaptation, no growth<br>
                2. <b>Exponential</b>: Rapid doubling<br>
                3. <b>Stationary</b>: Resources depleted<br>
                4. <b>Death</b>: Population decline
            </div>

            <h3>Growth Phase</h3>
            <div class="phase-indicator">
                <div class="phase active" id="lagPhase" style="background: rgba(96, 165, 250, 0.4);">Lag</div>
                <div class="phase" id="expPhase" style="background: rgba(74, 222, 128, 0.4);">Exp</div>
                <div class="phase" id="statPhase" style="background: rgba(250, 204, 21, 0.4);">Stat</div>
                <div class="phase" id="deathPhase" style="background: rgba(248, 113, 113, 0.4);">Death</div>
            </div>

            <h3>Resources</h3>
            <div style="font-size: 0.85em; margin-bottom: 5px;">Nutrients: <span id="nutrientPct">100%</span></div>
            <div class="resource-bar">
                <div class="resource-fill" id="nutrientBar" style="width: 100%; background: #4ade80;"></div>
            </div>
            <div style="font-size: 0.85em; margin-bottom: 5px;">Oxygen: <span id="oxygenPct">100%</span></div>
            <div class="resource-bar">
                <div class="resource-fill" id="oxygenBar" style="width: 100%; background: #60a5fa;"></div>
            </div>

            <div class="control-group">
                <label>Division Rate: <span class="value-display" id="divVal">20</span> min</label>
                <input type="range" id="divSlider" min="10" max="60" value="20" oninput="updateParams()">
            </div>

            <div class="control-group">
                <label>Initial Colony Size: <span class="value-display" id="initVal">10</span></label>
                <input type="range" id="initSlider" min="1" max="50" value="10" oninput="updateParams()">
            </div>

            <div class="control-group">
                <label>Nutrient Concentration: <span class="value-display" id="nutrVal">100%</span></label>
                <input type="range" id="nutrSlider" min="20" max="100" value="100" oninput="updateParams()">
            </div>

            <div class="control-group">
                <label>Temperature: <span class="value-display" id="tempVal">37°C</span></label>
                <input type="range" id="tempSlider" min="20" max="45" value="37" oninput="updateParams()">
            </div>

            <button class="btn-primary" onclick="toggleSim()">Start/Stop</button>
            <button class="btn-danger" onclick="addAntibiotics()">Add Antibiotics</button>
            <button class="btn-secondary" onclick="resetSim()">Reset Culture</button>

            <h3 style="margin-top: 15px;">Statistics</h3>
            <div style="font-size: 0.9em;">
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Time:</span><span class="value-display" id="timeVal">0 min</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Population:</span><span class="value-display" id="popVal">0</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Generations:</span><span class="value-display" id="genVal">0</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Growth Rate:</span><span class="value-display" id="rateVal">0/min</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Doubling Time:</span><span class="value-display" id="doubVal">- min</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const petriCanvas = document.getElementById('petriCanvas');
        const pctx = petriCanvas.getContext('2d');
        const chartCanvas = document.getElementById('chartCanvas');
        const cctx = chartCanvas.getContext('2d');

        let bacteria = [];
        let divisionTime = 20; // minutes
        let initialSize = 10;
        let nutrientLevel = 100;
        let oxygenLevel = 100;
        let temperature = 37;
        let time = 0;
        let running = false;
        let history = [];
        let currentPhase = 'lag';
        let lagDuration = 0;
        let antibioticsActive = false;

        function updateParams() {
            divisionTime = parseInt(document.getElementById('divSlider').value);
            initialSize = parseInt(document.getElementById('initSlider').value);
            const nutrConc = parseInt(document.getElementById('nutrSlider').value);
            temperature = parseInt(document.getElementById('tempSlider').value);

            document.getElementById('divVal').textContent = divisionTime;
            document.getElementById('initVal').textContent = initialSize;
            document.getElementById('nutrVal').textContent = nutrConc + '%';
            document.getElementById('tempVal').textContent = temperature + '°C';

            // Temperature affects growth rate
            // Optimal at 37°C
            const tempFactor = 1 - Math.abs(temperature - 37) / 20;
            document.getElementById('divVal').textContent = Math.round(divisionTime / tempFactor);
        }

        function initBacteria() {
            bacteria = [];
            const centerX = petriCanvas.width / 2;
            const centerY = petriCanvas.height / 2;

            for (let i = 0; i < initialSize; i++) {
                const angle = Math.random() * Math.PI * 2;
                const dist = Math.random() * 30;
                bacteria.push({
                    x: centerX + Math.cos(angle) * dist,
                    y: centerY + Math.sin(angle) * dist,
                    age: 0,
                    divisionProgress: Math.random() * 0.5,
                    alive: true
                });
            }

            nutrientLevel = parseInt(document.getElementById('nutrSlider').value);
            oxygenLevel = 100;
            lagDuration = 30 + Math.random() * 30; // 30-60 min lag phase
            antibioticsActive = false;
        }

        function getGrowthPhase() {
            if (time < lagDuration) return 'lag';
            if (nutrientLevel > 20 && oxygenLevel > 10) return 'exponential';
            if (nutrientLevel > 5 || bacteria.filter(b => b.alive).length > initialSize) return 'stationary';
            return 'death';
        }

        function updateBacteria() {
            time += 1;
            currentPhase = getGrowthPhase();

            // Temperature factor (optimal at 37°C)
            const tempFactor = Math.max(0.1, 1 - Math.abs(temperature - 37) / 25);

            // Update phase indicators
            ['lag', 'exp', 'stat', 'death'].forEach(p => {
                document.getElementById(p + 'Phase').classList.remove('active');
            });
            const phaseMap = { lag: 'lag', exponential: 'exp', stationary: 'stat', death: 'death' };
            document.getElementById(phaseMap[currentPhase] + 'Phase').classList.add('active');

            const aliveBacteria = bacteria.filter(b => b.alive);

            for (const bact of aliveBacteria) {
                bact.age += 1;

                // Movement (Brownian motion)
                bact.x += (Math.random() - 0.5) * 2;
                bact.y += (Math.random() - 0.5) * 2;

                // Keep in petri dish
                const centerX = petriCanvas.width / 2;
                const centerY = petriCanvas.height / 2;
                const radius = 180;
                const dx = bact.x - centerX;
                const dy = bact.y - centerY;
                const dist = Math.sqrt(dx*dx + dy*dy);
                if (dist > radius) {
                    bact.x = centerX + dx / dist * radius;
                    bact.y = centerY + dy / dist * radius;
                }

                // Antibiotics effect
                if (antibioticsActive && Math.random() < 0.1) {
                    bact.alive = false;
                    continue;
                }

                // Division
                if (currentPhase === 'exponential' && nutrientLevel > 0) {
                    const effectiveDivTime = divisionTime / tempFactor;
                    bact.divisionProgress += 1 / effectiveDivTime;

                    if (bact.divisionProgress >= 1 && bacteria.length < 2000) {
                        // Divide
                        const angle = Math.random() * Math.PI * 2;
                        bacteria.push({
                            x: bact.x + Math.cos(angle) * 5,
                            y: bact.y + Math.sin(angle) * 5,
                            age: 0,
                            divisionProgress: 0,
                            alive: true
                        });
                        bact.divisionProgress = 0;

                        // Consume resources
                        nutrientLevel -= 0.1;
                        oxygenLevel -= 0.05;
                    }
                }

                // Death in death phase
                if (currentPhase === 'death' && Math.random() < 0.01) {
                    bact.alive = false;
                }

                // Stationary phase - occasional death
                if (currentPhase === 'stationary' && Math.random() < 0.002) {
                    bact.alive = false;
                }
            }

            // Resource regeneration (slow)
            oxygenLevel = Math.min(100, oxygenLevel + 0.01);

            // Clamp resources
            nutrientLevel = Math.max(0, nutrientLevel);
            oxygenLevel = Math.max(0, Math.min(100, oxygenLevel));

            // Record history
            const aliveCount = bacteria.filter(b => b.alive).length;
            history.push({
                t: time,
                pop: aliveCount,
                phase: currentPhase
            });
            if (history.length > 500) history.shift();

            updateDisplay();
        }

        function updateDisplay() {
            const aliveCount = bacteria.filter(b => b.alive).length;

            document.getElementById('timeVal').textContent = time + ' min';
            document.getElementById('popVal').textContent = aliveCount.toLocaleString();

            // Generations (log2 of growth)
            const generations = aliveCount > initialSize ? Math.log2(aliveCount / initialSize) : 0;
            document.getElementById('genVal').textContent = generations.toFixed(1);

            // Growth rate
            let growthRate = 0;
            if (history.length >= 10) {
                const recent = history.slice(-10);
                growthRate = (recent[recent.length-1].pop - recent[0].pop) / 10;
            }
            document.getElementById('rateVal').textContent = growthRate.toFixed(1) + '/min';

            // Doubling time
            const doublingTime = growthRate > 0 ? Math.log(2) / Math.log(1 + growthRate / aliveCount) : Infinity;
            document.getElementById('doubVal').textContent = doublingTime === Infinity ? '∞' : Math.round(doublingTime) + ' min';

            // Resource bars
            document.getElementById('nutrientPct').textContent = Math.round(nutrientLevel) + '%';
            document.getElementById('nutrientBar').style.width = nutrientLevel + '%';
            document.getElementById('nutrientBar').style.background =
                nutrientLevel > 50 ? '#4ade80' : nutrientLevel > 20 ? '#facc15' : '#f87171';

            document.getElementById('oxygenPct').textContent = Math.round(oxygenLevel) + '%';
            document.getElementById('oxygenBar').style.width = oxygenLevel + '%';
            document.getElementById('oxygenBar').style.background =
                oxygenLevel > 50 ? '#60a5fa' : oxygenLevel > 20 ? '#facc15' : '#f87171';
        }

        function drawPetri() {
            // Clear
            pctx.fillStyle = '#0a150a';
            pctx.fillRect(0, 0, petriCanvas.width, petriCanvas.height);

            const centerX = petriCanvas.width / 2;
            const centerY = petriCanvas.height / 2;
            const radius = 180;

            // Petri dish
            const gradient = pctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, radius);
            gradient.addColorStop(0, `rgba(200, 180, 150, ${0.3 + nutrientLevel/300})`);
            gradient.addColorStop(0.8, `rgba(180, 160, 130, ${0.2 + nutrientLevel/400})`);
            gradient.addColorStop(1, 'rgba(100, 90, 70, 0.3)');

            pctx.fillStyle = gradient;
            pctx.beginPath();
            pctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
            pctx.fill();

            // Dish edge
            pctx.strokeStyle = 'rgba(255,255,255,0.3)';
            pctx.lineWidth = 3;
            pctx.beginPath();
            pctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
            pctx.stroke();

            // Antibiotics effect
            if (antibioticsActive) {
                pctx.fillStyle = 'rgba(248, 113, 113, 0.1)';
                pctx.beginPath();
                pctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
                pctx.fill();
            }

            // Draw bacteria
            const phaseColors = {
                lag: '#60a5fa',
                exponential: '#4ade80',
                stationary: '#facc15',
                death: '#f87171'
            };

            for (const bact of bacteria) {
                if (!bact.alive) {
                    // Dead bacteria (gray)
                    pctx.fillStyle = 'rgba(100,100,100,0.3)';
                    pctx.beginPath();
                    pctx.arc(bact.x, bact.y, 2, 0, Math.PI * 2);
                    pctx.fill();
                } else {
                    // Live bacteria
                    const color = phaseColors[currentPhase];
                    pctx.fillStyle = color;

                    // Draw as rod shape
                    pctx.save();
                    pctx.translate(bact.x, bact.y);
                    pctx.rotate(bact.age * 0.01);

                    // Size based on division progress
                    const length = 4 + bact.divisionProgress * 4;
                    pctx.beginPath();
                    pctx.ellipse(0, 0, length, 2, 0, 0, Math.PI * 2);
                    pctx.fill();

                    // Division line when close to dividing
                    if (bact.divisionProgress > 0.7) {
                        pctx.strokeStyle = 'rgba(0,0,0,0.3)';
                        pctx.lineWidth = 1;
                        pctx.beginPath();
                        pctx.moveTo(0, -3);
                        pctx.lineTo(0, 3);
                        pctx.stroke();
                    }

                    pctx.restore();
                }
            }

            // Info overlay
            const aliveCount = bacteria.filter(b => b.alive).length;
            pctx.fillStyle = 'rgba(0,0,0,0.6)';
            pctx.fillRect(10, 10, 160, 50);
            pctx.fillStyle = '#fff';
            pctx.font = '12px sans-serif';
            pctx.fillText(`Time: ${time} min`, 20, 28);
            pctx.fillText(`Population: ${aliveCount.toLocaleString()}`, 20, 48);
        }

        function drawChart() {
            cctx.fillStyle = '#0a150a';
            cctx.fillRect(0, 0, chartCanvas.width, chartCanvas.height);

            if (history.length < 2) return;

            const maxPop = Math.max(...history.map(h => h.pop), 100);
            const scaleX = (chartCanvas.width - 70) / Math.max(history.length, 100);
            const scaleY = (chartCanvas.height - 50) / maxPop;

            // Phase backgrounds
            const phaseColors = {
                lag: 'rgba(96, 165, 250, 0.1)',
                exponential: 'rgba(74, 222, 128, 0.1)',
                stationary: 'rgba(250, 204, 21, 0.1)',
                death: 'rgba(248, 113, 113, 0.1)'
            };

            let lastPhase = history[0].phase;
            let phaseStart = 0;
            for (let i = 1; i <= history.length; i++) {
                const phase = i < history.length ? history[i].phase : null;
                if (phase !== lastPhase || i === history.length) {
                    cctx.fillStyle = phaseColors[lastPhase] || 'transparent';
                    const x1 = 50 + phaseStart * scaleX;
                    const x2 = 50 + i * scaleX;
                    cctx.fillRect(x1, 15, x2 - x1, chartCanvas.height - 40);
                    phaseStart = i;
                    lastPhase = phase;
                }
            }

            // Population curve (log scale visual)
            cctx.strokeStyle = '#4ade80';
            cctx.lineWidth = 2;
            cctx.beginPath();
            history.forEach((h, i) => {
                const x = 50 + i * scaleX;
                const y = chartCanvas.height - 25 - h.pop * scaleY;
                if (i === 0) cctx.moveTo(x, y);
                else cctx.lineTo(x, y);
            });
            cctx.stroke();

            // Axes
            cctx.strokeStyle = 'rgba(255,255,255,0.3)';
            cctx.lineWidth = 1;
            cctx.beginPath();
            cctx.moveTo(50, 15);
            cctx.lineTo(50, chartCanvas.height - 25);
            cctx.lineTo(chartCanvas.width - 20, chartCanvas.height - 25);
            cctx.stroke();

            // Labels
            cctx.fillStyle = '#aaa';
            cctx.font = '11px sans-serif';
            cctx.textAlign = 'center';
            cctx.fillText('Time (min)', chartCanvas.width / 2, chartCanvas.height - 5);

            cctx.textAlign = 'right';
            cctx.fillText('Pop', 45, 25);
            cctx.fillText(maxPop.toLocaleString(), 45, 35);
        }

        function addAntibiotics() {
            antibioticsActive = true;
            setTimeout(() => { antibioticsActive = false; }, 5000);
        }

        function toggleSim() {
            running = !running;
            if (running) animate();
        }

        function resetSim() {
            running = false;
            time = 0;
            history = [];
            initBacteria();
            updateDisplay();
            drawPetri();
            drawChart();
        }

        function animate() {
            if (!running) return;
            updateBacteria();
            drawPetri();
            drawChart();
            requestAnimationFrame(animate);
        }

        updateParams();
        resetSim();
    </script>
</body>
</html>
