<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epidemic Spread - Biology & Ecology</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: linear-gradient(135deg, #1a2e1a 0%, #163e16 100%); color: #eee; min-height: 100vh; padding: 20px; }
        .back-link { position: fixed; top: 20px; left: 20px; color: #4ade80; text-decoration: none; font-weight: 600; padding: 8px 16px; background: rgba(0,0,0,0.3); border-radius: 20px; z-index: 100; }
        h1 { text-align: center; margin: 40px 0 10px; font-size: 2.2em; color: #4ade80; }
        .subtitle { text-align: center; opacity: 0.8; margin-bottom: 20px; }
        .container { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 1fr 300px; gap: 20px; }
        .panel { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 25px; }
        .info-box { background: rgba(74, 222, 128, 0.1); border: 1px solid rgba(74, 222, 128, 0.3); border-radius: 8px; padding: 15px; margin-bottom: 20px; font-size: 0.85em; line-height: 1.6; }
        h3 { color: #4ade80; margin-bottom: 15px; }
        canvas { width: 100%; border-radius: 8px; background: #0a150a; }
        .control-group { margin: 15px 0; }
        .control-group label { display: block; margin-bottom: 5px; }
        .control-group input, .control-group select { width: 100%; }
        .value-display { color: #4ade80; font-family: monospace; }
        button { width: 100%; padding: 12px; margin: 8px 0; border: none; border-radius: 8px; font-size: 1em; font-weight: 600; cursor: pointer; }
        .btn-primary { background: #4ade80; color: #1a2e1a; }
        .btn-danger { background: #f87171; color: #fff; }
        .btn-secondary { background: rgba(255,255,255,0.1); color: #fff; }
        .status-bar { display: flex; height: 25px; border-radius: 8px; overflow: hidden; margin: 15px 0; }
        .status-segment { display: flex; align-items: center; justify-content: center; font-size: 0.75em; font-weight: 600; transition: width 0.3s; }
        .legend { display: flex; gap: 10px; flex-wrap: wrap; margin: 10px 0; font-size: 0.8em; }
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .legend-dot { width: 12px; height: 12px; border-radius: 50%; }
        @media (max-width: 900px) { .container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back</a>
    <h1>Epidemic Spread</h1>
    <p class="subtitle">SIR/SEIR disease transmission model</p>

    <div class="container">
        <div class="panel">
            <canvas id="canvas" width="500" height="400"></canvas>
            <canvas id="chartCanvas" width="800" height="150" style="margin-top: 15px;"></canvas>
        </div>

        <div class="panel">
            <div class="info-box">
                <strong>SEIR Model:</strong>
                <b>S</b>usceptible → <b>E</b>xposed → <b>I</b>nfected → <b>R</b>ecovered<br><br>
                R₀ (basic reproduction number) determines if an epidemic spreads.
                R₀ > 1 means exponential growth; R₀ < 1 means decline.
            </div>

            <div class="legend">
                <div class="legend-item"><div class="legend-dot" style="background: #60a5fa;"></div> Susceptible</div>
                <div class="legend-item"><div class="legend-dot" style="background: #facc15;"></div> Exposed</div>
                <div class="legend-item"><div class="legend-dot" style="background: #f87171;"></div> Infected</div>
                <div class="legend-item"><div class="legend-dot" style="background: #4ade80;"></div> Recovered</div>
            </div>

            <div class="status-bar">
                <div class="status-segment" id="sBar" style="width: 99%; background: #60a5fa;">S</div>
                <div class="status-segment" id="eBar" style="width: 0%; background: #facc15;">E</div>
                <div class="status-segment" id="iBar" style="width: 1%; background: #f87171;">I</div>
                <div class="status-segment" id="rBar" style="width: 0%; background: #4ade80;">R</div>
            </div>

            <h3>Disease Parameters</h3>
            <div class="control-group">
                <label>Transmission Rate (β): <span class="value-display" id="betaVal">0.3</span></label>
                <input type="range" id="betaSlider" min="10" max="80" value="30" oninput="updateParams()">
            </div>

            <div class="control-group">
                <label>Incubation Period: <span class="value-display" id="incubVal">3</span> days</label>
                <input type="range" id="incubSlider" min="1" max="14" value="3" oninput="updateParams()">
            </div>

            <div class="control-group">
                <label>Infectious Period: <span class="value-display" id="infectVal">5</span> days</label>
                <input type="range" id="infectSlider" min="2" max="20" value="5" oninput="updateParams()">
            </div>

            <div class="control-group">
                <label>Social Distancing: <span class="value-display" id="distVal">0%</span></label>
                <input type="range" id="distSlider" min="0" max="90" value="0" oninput="updateParams()">
            </div>

            <button class="btn-danger" onclick="infectRandom()">Start Outbreak</button>
            <button class="btn-primary" onclick="toggleSim()">Start/Stop</button>
            <button class="btn-secondary" onclick="resetSim()">Reset</button>

            <h3 style="margin-top: 15px;">Statistics</h3>
            <div style="font-size: 0.9em;">
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Day:</span><span class="value-display" id="dayCount">0</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>R₀:</span><span class="value-display" id="r0Val">1.50</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Peak Infected:</span><span class="value-display" id="peakVal">0</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Total Infected:</span><span class="value-display" id="totalVal">0</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const chartCanvas = document.getElementById('chartCanvas');
        const cctx = chartCanvas.getContext('2d');

        let people = [];
        let beta = 0.3;
        let incubationPeriod = 3;
        let infectiousPeriod = 5;
        let socialDistancing = 0;
        let day = 0;
        let running = false;
        let history = [];
        let peakInfected = 0;
        let totalInfected = 0;

        const SUSCEPTIBLE = 0;
        const EXPOSED = 1;
        const INFECTED = 2;
        const RECOVERED = 3;

        function updateParams() {
            beta = parseInt(document.getElementById('betaSlider').value) / 100;
            incubationPeriod = parseInt(document.getElementById('incubSlider').value);
            infectiousPeriod = parseInt(document.getElementById('infectSlider').value);
            socialDistancing = parseInt(document.getElementById('distSlider').value) / 100;

            document.getElementById('betaVal').textContent = beta.toFixed(2);
            document.getElementById('incubVal').textContent = incubationPeriod;
            document.getElementById('infectVal').textContent = infectiousPeriod;
            document.getElementById('distVal').textContent = Math.round(socialDistancing * 100) + '%';

            // Calculate R0
            const r0 = beta * infectiousPeriod * (1 - socialDistancing);
            document.getElementById('r0Val').textContent = r0.toFixed(2);
        }

        function initPeople() {
            people = [];
            const n = 200;
            for (let i = 0; i < n; i++) {
                people.push({
                    x: Math.random() * (canvas.width - 20) + 10,
                    y: Math.random() * (canvas.height - 20) + 10,
                    vx: (Math.random() - 0.5) * 2,
                    vy: (Math.random() - 0.5) * 2,
                    state: SUSCEPTIBLE,
                    daysInState: 0
                });
            }
        }

        function infectRandom() {
            const susceptible = people.filter(p => p.state === SUSCEPTIBLE);
            if (susceptible.length > 0) {
                const victim = susceptible[Math.floor(Math.random() * susceptible.length)];
                victim.state = INFECTED;
                victim.daysInState = 0;
                totalInfected++;
            }
        }

        function updatePeople() {
            // Movement
            for (const person of people) {
                // Social distancing reduces movement
                const speed = 1 - socialDistancing * 0.8;

                person.x += person.vx * speed;
                person.y += person.vy * speed;

                // Bounce off walls
                if (person.x < 10 || person.x > canvas.width - 10) person.vx *= -1;
                if (person.y < 10 || person.y > canvas.height - 10) person.vy *= -1;

                person.x = Math.max(10, Math.min(canvas.width - 10, person.x));
                person.y = Math.max(10, Math.min(canvas.height - 10, person.y));

                // Random direction changes
                if (Math.random() < 0.02) {
                    person.vx = (Math.random() - 0.5) * 2;
                    person.vy = (Math.random() - 0.5) * 2;
                }
            }

            // Disease transmission
            for (const person of people) {
                if (person.state === INFECTED) {
                    for (const other of people) {
                        if (other.state === SUSCEPTIBLE) {
                            const dx = person.x - other.x;
                            const dy = person.y - other.y;
                            const dist = Math.sqrt(dx * dx + dy * dy);

                            if (dist < 20) {
                                const transmitProb = beta * (1 - socialDistancing) * 0.1;
                                if (Math.random() < transmitProb) {
                                    other.state = EXPOSED;
                                    other.daysInState = 0;
                                    totalInfected++;
                                }
                            }
                        }
                    }
                }
            }

            // State transitions (daily)
            for (const person of people) {
                person.daysInState += 0.05; // Fraction of day per frame

                if (person.state === EXPOSED && person.daysInState >= incubationPeriod) {
                    person.state = INFECTED;
                    person.daysInState = 0;
                }

                if (person.state === INFECTED && person.daysInState >= infectiousPeriod) {
                    person.state = RECOVERED;
                    person.daysInState = 0;
                }
            }
        }

        function updateStats() {
            const counts = [0, 0, 0, 0];
            for (const person of people) {
                counts[person.state]++;
            }

            const total = people.length;
            document.getElementById('sBar').style.width = (counts[0] / total * 100) + '%';
            document.getElementById('eBar').style.width = (counts[1] / total * 100) + '%';
            document.getElementById('iBar').style.width = (counts[2] / total * 100) + '%';
            document.getElementById('rBar').style.width = (counts[3] / total * 100) + '%';

            peakInfected = Math.max(peakInfected, counts[2]);
            document.getElementById('peakVal').textContent = peakInfected;
            document.getElementById('totalVal').textContent = totalInfected;

            // Record history
            day += 0.05;
            if (Math.floor(day * 10) % 5 === 0) {
                history.push({
                    day: day,
                    s: counts[0],
                    e: counts[1],
                    i: counts[2],
                    r: counts[3]
                });
                if (history.length > 200) history.shift();
            }

            document.getElementById('dayCount').textContent = Math.floor(day);
        }

        function draw() {
            ctx.fillStyle = '#0a150a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const colors = ['#60a5fa', '#facc15', '#f87171', '#4ade80'];
            const sizes = [5, 6, 7, 5];

            for (const person of people) {
                ctx.fillStyle = colors[person.state];
                ctx.beginPath();
                ctx.arc(person.x, person.y, sizes[person.state], 0, Math.PI * 2);
                ctx.fill();

                // Infection radius for infected
                if (person.state === INFECTED) {
                    ctx.strokeStyle = 'rgba(248, 113, 113, 0.2)';
                    ctx.beginPath();
                    ctx.arc(person.x, person.y, 20, 0, Math.PI * 2);
                    ctx.stroke();
                }
            }
        }

        function drawChart() {
            cctx.fillStyle = '#0a150a';
            cctx.fillRect(0, 0, chartCanvas.width, chartCanvas.height);

            if (history.length < 2) return;

            const maxPop = people.length;
            const scaleX = (chartCanvas.width - 60) / Math.max(history[history.length - 1].day, 30);
            const scaleY = (chartCanvas.height - 40) / maxPop;

            // Stacked area chart
            const colors = ['#4ade80', '#f87171', '#facc15', '#60a5fa'];
            const labels = ['R', 'I', 'E', 'S'];

            // Draw areas from bottom up
            for (let layer = 3; layer >= 0; layer--) {
                cctx.fillStyle = colors[layer] + '80';
                cctx.beginPath();
                cctx.moveTo(50, chartCanvas.height - 25);

                history.forEach(h => {
                    const x = 50 + h.day * scaleX;
                    let y = 0;
                    if (layer === 3) y = h.s + h.e + h.i + h.r;
                    else if (layer === 2) y = h.e + h.i + h.r;
                    else if (layer === 1) y = h.i + h.r;
                    else y = h.r;

                    cctx.lineTo(x, chartCanvas.height - 25 - y * scaleY);
                });

                cctx.lineTo(50 + history[history.length - 1].day * scaleX, chartCanvas.height - 25);
                cctx.closePath();
                cctx.fill();
            }

            // Axes
            cctx.strokeStyle = 'rgba(255,255,255,0.3)';
            cctx.beginPath();
            cctx.moveTo(50, chartCanvas.height - 25);
            cctx.lineTo(chartCanvas.width - 10, chartCanvas.height - 25);
            cctx.moveTo(50, 10);
            cctx.lineTo(50, chartCanvas.height - 25);
            cctx.stroke();

            cctx.fillStyle = '#fff';
            cctx.font = '11px sans-serif';
            cctx.fillText('Days', chartCanvas.width / 2, chartCanvas.height - 5);
        }

        function toggleSim() {
            running = !running;
            if (running) animate();
        }

        function resetSim() {
            running = false;
            day = 0;
            history = [];
            peakInfected = 0;
            totalInfected = 0;
            initPeople();
            updateStats();
            draw();
            drawChart();
        }

        function animate() {
            if (!running) return;

            updatePeople();
            updateStats();
            draw();
            drawChart();

            requestAnimationFrame(animate);
        }

        updateParams();
        resetSim();
    </script>
</body>
</html>
