<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Symbiosis & Mutualism - Biology & Ecology</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: linear-gradient(135deg, #1a2e1a 0%, #163e16 100%); color: #eee; min-height: 100vh; padding: 20px; }
        .back-link { position: fixed; top: 20px; left: 20px; color: #4ade80; text-decoration: none; font-weight: 600; padding: 8px 16px; background: rgba(0,0,0,0.3); border-radius: 20px; z-index: 100; }
        h1 { text-align: center; margin: 40px 0 10px; font-size: 2.2em; color: #4ade80; }
        .subtitle { text-align: center; opacity: 0.8; margin-bottom: 20px; }
        .container { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 1fr 300px; gap: 20px; }
        .panel { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 25px; }
        .info-box { background: rgba(74, 222, 128, 0.1); border: 1px solid rgba(74, 222, 128, 0.3); border-radius: 8px; padding: 15px; margin-bottom: 20px; font-size: 0.85em; line-height: 1.6; }
        h3 { color: #4ade80; margin-bottom: 15px; }
        canvas { width: 100%; border-radius: 8px; }
        .control-group { margin: 15px 0; }
        .control-group label { display: block; margin-bottom: 5px; }
        .control-group input, .control-group select { width: 100%; }
        .value-display { color: #4ade80; font-family: monospace; }
        button { width: 100%; padding: 12px; margin: 8px 0; border: none; border-radius: 8px; font-size: 1em; font-weight: 600; cursor: pointer; }
        .btn-primary { background: #4ade80; color: #1a2e1a; }
        .btn-secondary { background: rgba(255,255,255,0.1); color: #fff; }
        .legend { display: flex; flex-wrap: wrap; gap: 10px; margin: 15px 0; font-size: 0.8em; }
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .legend-icon { width: 20px; height: 20px; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 12px; }
        .relationship-type { padding: 8px 12px; border-radius: 20px; font-size: 0.85em; text-align: center; margin: 5px 0; }
        @media (max-width: 900px) { .container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back</a>
    <h1>Symbiosis & Mutualism</h1>
    <p class="subtitle">Cooperative and parasitic species relationships</p>

    <div class="container">
        <div class="panel">
            <canvas id="canvas" width="800" height="500"></canvas>
        </div>

        <div class="panel">
            <div class="info-box">
                <strong>Symbiotic Relationships:</strong><br>
                <em>Mutualism</em>: Both species benefit (+/+)<br>
                <em>Commensalism</em>: One benefits, other unaffected (+/0)<br>
                <em>Parasitism</em>: One benefits at other's expense (+/-)<br>
                Watch how these relationships affect population dynamics!
            </div>

            <h3>Species Legend</h3>
            <div class="legend">
                <div class="legend-item"><div class="legend-icon" style="background: #60a5fa;">üå∏</div> Flowers</div>
                <div class="legend-item"><div class="legend-icon" style="background: #facc15;">üêù</div> Bees</div>
                <div class="legend-item"><div class="legend-icon" style="background: #4ade80;">üå≥</div> Trees</div>
                <div class="legend-item"><div class="legend-icon" style="background: #a78bfa;">üçÑ</div> Fungi</div>
                <div class="legend-item"><div class="legend-icon" style="background: #f87171;">ü¶†</div> Parasites</div>
            </div>

            <div class="relationship-type" style="background: rgba(74, 222, 128, 0.2);" id="relType">
                Mutualism Active (+/+)
            </div>

            <div class="control-group">
                <label>Relationship Mode:</label>
                <select id="modeSelect" onchange="changeMode()">
                    <option value="mutualism">Mutualism (Bee-Flower)</option>
                    <option value="mycorrhiza">Mycorrhiza (Tree-Fungi)</option>
                    <option value="parasitism">Parasitism (Host-Parasite)</option>
                    <option value="commensalism">Commensalism (Tree-Bird)</option>
                </select>
            </div>

            <div class="control-group">
                <label>Interaction Strength: <span class="value-display" id="strengthVal">50%</span></label>
                <input type="range" id="strengthSlider" min="10" max="100" value="50" oninput="updateParams()">
            </div>

            <div class="control-group">
                <label>Environment Richness: <span class="value-display" id="richVal">50%</span></label>
                <input type="range" id="richSlider" min="10" max="100" value="50" oninput="updateParams()">
            </div>

            <button class="btn-primary" onclick="toggleSim()">Start/Stop</button>
            <button class="btn-secondary" onclick="resetSim()">Reset</button>

            <h3 style="margin-top: 15px;">Population Stats</h3>
            <div style="font-size: 0.9em;">
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Time:</span><span class="value-display" id="timeVal">0</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Species A:</span><span class="value-display" id="popAVal">0</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Species B:</span><span class="value-display" id="popBVal">0</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Interactions:</span><span class="value-display" id="interVal">0</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Avg Fitness A:</span><span class="value-display" id="fitAVal">100%</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 3px 0;">
                    <span>Avg Fitness B:</span><span class="value-display" id="fitBVal">100%</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let speciesA = []; // Host/Provider species
        let speciesB = []; // Partner species
        let resources = [];
        let time = 0;
        let running = false;
        let mode = 'mutualism';
        let interactionStrength = 0.5;
        let environmentRichness = 0.5;
        let totalInteractions = 0;

        const modeConfig = {
            mutualism: {
                nameA: 'Flowers', iconA: 'üå∏', colorA: '#60a5fa',
                nameB: 'Bees', iconB: 'üêù', colorB: '#facc15',
                benefitA: 1, benefitB: 1,
                description: 'Mutualism Active (+/+)'
            },
            mycorrhiza: {
                nameA: 'Trees', iconA: 'üå≥', colorA: '#4ade80',
                nameB: 'Fungi', iconB: 'üçÑ', colorB: '#a78bfa',
                benefitA: 1, benefitB: 1,
                description: 'Mycorrhiza Network (+/+)'
            },
            parasitism: {
                nameA: 'Hosts', iconA: 'üêõ', colorA: '#60a5fa',
                nameB: 'Parasites', iconB: 'ü¶†', colorB: '#f87171',
                benefitA: -1, benefitB: 1,
                description: 'Parasitism Active (+/-)'
            },
            commensalism: {
                nameA: 'Trees', iconA: 'üå≥', colorA: '#4ade80',
                nameB: 'Birds', iconB: 'üê¶', colorB: '#fbbf24',
                benefitA: 0, benefitB: 1,
                description: 'Commensalism Active (+/0)'
            }
        };

        function updateParams() {
            interactionStrength = parseInt(document.getElementById('strengthSlider').value) / 100;
            environmentRichness = parseInt(document.getElementById('richSlider').value) / 100;

            document.getElementById('strengthVal').textContent = Math.round(interactionStrength * 100) + '%';
            document.getElementById('richVal').textContent = Math.round(environmentRichness * 100) + '%';
        }

        function changeMode() {
            mode = document.getElementById('modeSelect').value;
            document.getElementById('relType').textContent = modeConfig[mode].description;
            resetSim();
        }

        function initPopulations() {
            speciesA = [];
            speciesB = [];
            resources = [];

            const config = modeConfig[mode];

            // Species A (often stationary or slower)
            const numA = mode === 'mycorrhiza' ? 15 : 30;
            for (let i = 0; i < numA; i++) {
                speciesA.push({
                    x: Math.random() * (canvas.width - 40) + 20,
                    y: Math.random() * (canvas.height - 40) + 20,
                    vx: mode === 'mycorrhiza' ? 0 : (Math.random() - 0.5) * 0.5,
                    vy: mode === 'mycorrhiza' ? 0 : (Math.random() - 0.5) * 0.5,
                    energy: 100,
                    fitness: 100,
                    size: mode === 'mycorrhiza' ? 20 : 12
                });
            }

            // Species B (often mobile)
            for (let i = 0; i < 25; i++) {
                speciesB.push({
                    x: Math.random() * (canvas.width - 40) + 20,
                    y: Math.random() * (canvas.height - 40) + 20,
                    vx: (Math.random() - 0.5) * 3,
                    vy: (Math.random() - 0.5) * 3,
                    energy: 100,
                    fitness: 100,
                    target: null,
                    size: 10
                });
            }

            // Resources
            const numResources = Math.floor(20 * environmentRichness);
            for (let i = 0; i < numResources; i++) {
                resources.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    amount: 50 + Math.random() * 50
                });
            }

            totalInteractions = 0;
        }

        function updateSimulation() {
            time++;
            const config = modeConfig[mode];
            let frameInteractions = 0;

            // Update Species A
            for (const a of speciesA) {
                // Movement (if mobile)
                if (a.vx !== 0 || a.vy !== 0) {
                    a.x += a.vx;
                    a.y += a.vy;

                    if (a.x < 20 || a.x > canvas.width - 20) a.vx *= -1;
                    if (a.y < 20 || a.y > canvas.height - 20) a.vy *= -1;

                    a.x = Math.max(20, Math.min(canvas.width - 20, a.x));
                    a.y = Math.max(20, Math.min(canvas.height - 20, a.y));
                }

                // Natural energy drain
                a.energy -= 0.1;

                // Gather resources
                for (const r of resources) {
                    const dx = a.x - r.x;
                    const dy = a.y - r.y;
                    const dist = Math.sqrt(dx*dx + dy*dy);
                    if (dist < a.size + 10 && r.amount > 0) {
                        const gather = Math.min(0.5 * environmentRichness, r.amount);
                        a.energy += gather;
                        r.amount -= gather;
                    }
                }
            }

            // Update Species B
            for (const b of speciesB) {
                // Find target (closest species A)
                let closest = null;
                let minDist = Infinity;
                for (const a of speciesA) {
                    const dx = a.x - b.x;
                    const dy = a.y - b.y;
                    const dist = Math.sqrt(dx*dx + dy*dy);
                    if (dist < minDist) {
                        minDist = dist;
                        closest = a;
                    }
                }

                // Move toward target
                if (closest) {
                    const dx = closest.x - b.x;
                    const dy = closest.y - b.y;
                    const dist = Math.sqrt(dx*dx + dy*dy);
                    if (dist > 30) {
                        b.vx += dx / dist * 0.2;
                        b.vy += dy / dist * 0.2;
                    }
                }

                // Speed limit
                const speed = Math.sqrt(b.vx*b.vx + b.vy*b.vy);
                if (speed > 3) {
                    b.vx = (b.vx / speed) * 3;
                    b.vy = (b.vy / speed) * 3;
                }

                b.x += b.vx;
                b.y += b.vy;

                // Bounce
                if (b.x < 20 || b.x > canvas.width - 20) b.vx *= -1;
                if (b.y < 20 || b.y > canvas.height - 20) b.vy *= -1;

                b.x = Math.max(20, Math.min(canvas.width - 20, b.x));
                b.y = Math.max(20, Math.min(canvas.height - 20, b.y));

                // Energy drain
                b.energy -= 0.15;

                // Interaction with Species A
                for (const a of speciesA) {
                    const dx = a.x - b.x;
                    const dy = a.y - b.y;
                    const dist = Math.sqrt(dx*dx + dy*dy);

                    if (dist < a.size + b.size) {
                        const benefit = 2 * interactionStrength;

                        // Apply benefits based on relationship type
                        a.energy += benefit * config.benefitA;
                        b.energy += benefit * config.benefitB;

                        // Fitness tracking
                        a.fitness += config.benefitA * 0.5;
                        b.fitness += config.benefitB * 0.5;

                        frameInteractions++;
                    }
                }

                // Random direction changes
                if (Math.random() < 0.02) {
                    b.vx += (Math.random() - 0.5) * 1;
                    b.vy += (Math.random() - 0.5) * 1;
                }
            }

            totalInteractions += frameInteractions;

            // Clamp energy
            for (const a of speciesA) {
                a.energy = Math.max(0, Math.min(150, a.energy));
                a.fitness = Math.max(0, Math.min(200, a.fitness));
            }
            for (const b of speciesB) {
                b.energy = Math.max(0, Math.min(150, b.energy));
                b.fitness = Math.max(0, Math.min(200, b.fitness));
            }

            // Reproduction for Species A
            if (Math.random() < 0.02 && speciesA.length < 50) {
                const parent = speciesA.find(a => a.energy > 80);
                if (parent) {
                    speciesA.push({
                        x: parent.x + (Math.random() - 0.5) * 40,
                        y: parent.y + (Math.random() - 0.5) * 40,
                        vx: parent.vx,
                        vy: parent.vy,
                        energy: 60,
                        fitness: parent.fitness * 0.9,
                        size: parent.size
                    });
                    parent.energy -= 30;
                }
            }

            // Reproduction for Species B
            if (Math.random() < 0.02 && speciesB.length < 60) {
                const parent = speciesB.find(b => b.energy > 80);
                if (parent) {
                    speciesB.push({
                        x: parent.x + (Math.random() - 0.5) * 30,
                        y: parent.y + (Math.random() - 0.5) * 30,
                        vx: (Math.random() - 0.5) * 3,
                        vy: (Math.random() - 0.5) * 3,
                        energy: 60,
                        fitness: parent.fitness * 0.9,
                        size: parent.size,
                        target: null
                    });
                    parent.energy -= 30;
                }
            }

            // Death
            speciesA = speciesA.filter(a => a.energy > 5);
            speciesB = speciesB.filter(b => b.energy > 5);

            // Resource regeneration
            for (const r of resources) {
                r.amount = Math.min(100, r.amount + 0.1 * environmentRichness);
            }

            // Add new resources occasionally
            if (Math.random() < 0.01 * environmentRichness && resources.length < 30) {
                resources.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    amount: 50
                });
            }

            updateDisplay();
        }

        function updateDisplay() {
            const config = modeConfig[mode];
            const avgFitA = speciesA.length > 0 ?
                speciesA.reduce((s, a) => s + a.fitness, 0) / speciesA.length : 0;
            const avgFitB = speciesB.length > 0 ?
                speciesB.reduce((s, b) => s + b.fitness, 0) / speciesB.length : 0;

            document.getElementById('timeVal').textContent = time;
            document.getElementById('popAVal').textContent = speciesA.length + ' ' + config.iconA;
            document.getElementById('popBVal').textContent = speciesB.length + ' ' + config.iconB;
            document.getElementById('interVal').textContent = totalInteractions;
            document.getElementById('fitAVal').textContent = Math.round(avgFitA) + '%';
            document.getElementById('fitBVal').textContent = Math.round(avgFitB) + '%';
        }

        function draw() {
            const config = modeConfig[mode];

            // Background
            ctx.fillStyle = '#0f1f0f';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw resources
            for (const r of resources) {
                const alpha = r.amount / 100;
                ctx.fillStyle = `rgba(74, 222, 128, ${alpha * 0.3})`;
                ctx.beginPath();
                ctx.arc(r.x, r.y, 8 + r.amount / 10, 0, Math.PI * 2);
                ctx.fill();
            }

            // Draw mycorrhizal network if in that mode
            if (mode === 'mycorrhiza') {
                ctx.strokeStyle = 'rgba(167, 139, 250, 0.2)';
                ctx.lineWidth = 2;
                for (let i = 0; i < speciesA.length; i++) {
                    for (let j = i + 1; j < speciesA.length; j++) {
                        const a = speciesA[i];
                        const b = speciesA[j];
                        const dx = a.x - b.x;
                        const dy = a.y - b.y;
                        const dist = Math.sqrt(dx*dx + dy*dy);
                        if (dist < 150) {
                            ctx.beginPath();
                            ctx.moveTo(a.x, a.y);
                            ctx.lineTo(b.x, b.y);
                            ctx.stroke();
                        }
                    }
                }
            }

            // Draw interaction lines
            ctx.strokeStyle = 'rgba(250, 204, 21, 0.3)';
            ctx.lineWidth = 1;
            for (const b of speciesB) {
                for (const a of speciesA) {
                    const dx = a.x - b.x;
                    const dy = a.y - b.y;
                    const dist = Math.sqrt(dx*dx + dy*dy);
                    if (dist < a.size + b.size + 20) {
                        ctx.beginPath();
                        ctx.moveTo(a.x, a.y);
                        ctx.lineTo(b.x, b.y);
                        ctx.stroke();
                    }
                }
            }

            // Draw Species A
            ctx.font = '16px sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            for (const a of speciesA) {
                // Glow based on energy
                const gradient = ctx.createRadialGradient(a.x, a.y, 0, a.x, a.y, a.size + 10);
                gradient.addColorStop(0, config.colorA + '40');
                gradient.addColorStop(1, 'transparent');
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(a.x, a.y, a.size + 10, 0, Math.PI * 2);
                ctx.fill();

                ctx.fillStyle = config.colorA;
                ctx.beginPath();
                ctx.arc(a.x, a.y, a.size, 0, Math.PI * 2);
                ctx.fill();

                ctx.fillText(config.iconA, a.x, a.y);
            }

            // Draw Species B
            for (const b of speciesB) {
                ctx.fillStyle = config.colorB;
                ctx.beginPath();
                ctx.arc(b.x, b.y, b.size, 0, Math.PI * 2);
                ctx.fill();

                ctx.fillText(config.iconB, b.x, b.y);
            }

            // Info
            ctx.fillStyle = '#4ade80';
            ctx.font = '14px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText(`${config.nameA}: ${speciesA.length}  |  ${config.nameB}: ${speciesB.length}  |  Time: ${time}`, 15, 25);
        }

        function toggleSim() {
            running = !running;
            if (running) animate();
        }

        function resetSim() {
            running = false;
            time = 0;
            initPopulations();
            updateDisplay();
            draw();
        }

        function animate() {
            if (!running) return;
            updateSimulation();
            draw();
            requestAnimationFrame(animate);
        }

        updateParams();
        changeMode();
    </script>
</body>
</html>
