<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gray-Scott Labyrinth Pattern - Reaction-Diffusion</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #0a1e2e 0%, #051015 100%);
            color: #fff;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            display: flex;
            gap: 20px;
            padding: 20px;
            max-width: 1400px;
        }

        .canvas-container {
            position: relative;
            background: #000;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 255, 255, 0.3);
            overflow: hidden;
        }

        canvas {
            display: block;
            cursor: crosshair;
        }

        .info-panel {
            background: rgba(10, 30, 46, 0.95);
            border-radius: 12px;
            padding: 20px;
            width: 320px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            max-height: 90vh;
            overflow-y: auto;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #00ffff, #0080ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        h2 {
            font-size: 18px;
            margin-top: 20px;
            margin-bottom: 10px;
            color: #00ffff;
        }

        .description {
            font-size: 14px;
            line-height: 1.6;
            color: #bbb;
            margin-bottom: 20px;
        }

        .control-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: #aaa;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #333;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #00ffff;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 255, 255, 0.5);
        }

        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #00ffff;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(0, 255, 255, 0.5);
        }

        .value-display {
            display: inline-block;
            float: right;
            color: #00ffff;
            font-weight: bold;
        }

        button {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #00ffff, #0080ff);
            color: #000;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(0, 255, 255, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 255, 255, 0.5);
        }

        button:active {
            transform: translateY(0);
        }

        .stats {
            font-size: 12px;
            color: #888;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #333;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .preset-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 20px;
        }

        .preset-buttons button {
            padding: 8px;
            font-size: 12px;
        }

        .pattern-classification {
            background: #0a1a28;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 3px solid #00ffff;
        }

        .pattern-classification h3 {
            font-size: 14px;
            color: #00ffff;
            margin-bottom: 10px;
        }

        .pattern-type {
            font-size: 12px;
            color: #aaa;
            margin-bottom: 5px;
            padding-left: 10px;
        }

        .brush-size-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            margin-top: 10px;
        }

        .brush-size-buttons button {
            padding: 6px;
            font-size: 11px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="canvas-container">
            <canvas id="canvas"></canvas>
        </div>

        <div class="info-panel">
            <h1>Gray-Scott Labyrinth Pattern</h1>
            <p class="description">
                Complex maze-like patterns emerge from reaction-diffusion dynamics,
                creating intricate winding structures similar to coral growth,
                brain coral patterns, and dendritic formations in nature.
            </p>

            <h2>Pattern Presets</h2>
            <div class="preset-buttons">
                <button onclick="loadPreset('labyrinth')">Labyrinth</button>
                <button onclick="loadPreset('maze')">Maze</button>
                <button onclick="loadPreset('coral')">Coral</button>
                <button onclick="loadPreset('worms')">Worms</button>
            </div>

            <h2>Parameters</h2>
            <div class="control-group">
                <label>
                    Feed Rate (F): <span class="value-display" id="f-value">0.0290</span>
                </label>
                <input type="range" id="feed-rate" min="0.01" max="0.08" step="0.0001" value="0.0290">
            </div>

            <div class="control-group">
                <label>
                    Kill Rate (K): <span class="value-display" id="k-value">0.0570</span>
                </label>
                <input type="range" id="kill-rate" min="0.045" max="0.07" step="0.0001" value="0.0570">
            </div>

            <div class="control-group">
                <label>
                    Complexity: <span class="value-display" id="complexity-value">50</span>
                </label>
                <input type="range" id="complexity" min="10" max="200" step="10" value="50">
            </div>

            <div class="control-group">
                <label>
                    Brush Size: <span class="value-display" id="brush-value">10</span>
                </label>
                <input type="range" id="brush-size" min="3" max="30" step="1" value="10">
            </div>

            <div class="brush-size-buttons">
                <button onclick="setBrushSize(5)">Small</button>
                <button onclick="setBrushSize(10)">Medium</button>
                <button onclick="setBrushSize(20)">Large</button>
            </div>

            <h2>Controls</h2>
            <button onclick="togglePause()">Pause/Resume</button>
            <button onclick="reset()">Reset</button>
            <button onclick="randomSeeds()">Random Seeds</button>
            <button onclick="clearAll()">Clear All</button>

            <div class="stats">
                <div class="stat-row">
                    <span>FPS:</span>
                    <span id="fps">60</span>
                </div>
                <div class="stat-row">
                    <span>Iterations:</span>
                    <span id="iterations">0</span>
                </div>
                <div class="stat-row">
                    <span>Grid Size:</span>
                    <span>256×256</span>
                </div>
                <div class="stat-row">
                    <span>Brush Size:</span>
                    <span id="brush-display">10</span>
                </div>
            </div>

            <div class="pattern-classification">
                <h3>Pattern Classification</h3>
                <div class="pattern-type">• Labyrinth: F≈0.029, K≈0.057</div>
                <div class="pattern-type">• Maze: F≈0.035, K≈0.058</div>
                <div class="pattern-type">• Coral: F≈0.046, K≈0.059</div>
                <div class="pattern-type">• Worms: F≈0.058, K≈0.065</div>
            </div>

            <h2>How It Works</h2>
            <p class="description">
                Labyrinth patterns form when:<br><br>
                • Chemical V creates branching pathways<br>
                • Diffusion creates winding corridors<br>
                • F and K values favor connected structures<br>
                • Click and drag to add chemical V<br>
                <br>
                The maze self-organizes into complex, connected networks resembling
                natural coral formations and neural pathways.
            </p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        const SIZE = 256;
        canvas.width = SIZE;
        canvas.height = SIZE;

        // Chemical concentrations
        let u = new Float32Array(SIZE * SIZE);
        let v = new Float32Array(SIZE * SIZE);
        let u_next = new Float32Array(SIZE * SIZE);
        let v_next = new Float32Array(SIZE * SIZE);

        // Parameters
        let params = {
            Du: 0.16,
            Dv: 0.08,
            F: 0.0290,
            K: 0.0570,
            dt: 1.0
        };

        let paused = false;
        let iterations = 0;
        let frameCount = 0;
        let lastFpsUpdate = 0;
        let fps = 60;
        let complexity = 50;
        let brushSize = 10;

        // Initialize with random seeds
        function reset() {
            // Start with full U
            for (let i = 0; i < SIZE * SIZE; i++) {
                u[i] = 1.0;
                v[i] = 0.0;
            }

            randomSeeds();
            iterations = 0;
        }

        function randomSeeds() {
            for (let i = 0; i < complexity; i++) {
                const x = Math.floor(Math.random() * SIZE);
                const y = Math.floor(Math.random() * SIZE);
                const radius = 2 + Math.floor(Math.random() * 4);

                for (let dy = -radius; dy <= radius; dy++) {
                    for (let dx = -radius; dx <= radius; dx++) {
                        if (dx*dx + dy*dy <= radius*radius) {
                            const px = (x + dx + SIZE) % SIZE;
                            const py = (y + dy + SIZE) % SIZE;
                            const idx = py * SIZE + px;
                            v[idx] = 0.5 + Math.random() * 0.5;
                            u[idx] = 0.0;
                        }
                    }
                }
            }
        }

        function clearAll() {
            for (let i = 0; i < SIZE * SIZE; i++) {
                u[i] = 1.0;
                v[i] = 0.0;
            }
        }

        // Calculate Laplacian using 5-point stencil
        function laplacian(arr, x, y) {
            const idx = y * SIZE + x;
            const xm1 = (x - 1 + SIZE) % SIZE;
            const xp1 = (x + 1) % SIZE;
            const ym1 = (y - 1 + SIZE) % SIZE;
            const yp1 = (y + 1) % SIZE;

            const center = arr[idx];
            const left = arr[y * SIZE + xm1];
            const right = arr[y * SIZE + xp1];
            const up = arr[ym1 * SIZE + x];
            const down = arr[yp1 * SIZE + x];

            return (left + right + up + down - 4.0 * center);
        }

        // Update reaction-diffusion
        function update() {
            const { Du, Dv, F, K, dt } = params;

            for (let y = 0; y < SIZE; y++) {
                for (let x = 0; x < SIZE; x++) {
                    const idx = y * SIZE + x;
                    const u_val = u[idx];
                    const v_val = v[idx];

                    const lap_u = laplacian(u, x, y);
                    const lap_v = laplacian(v, x, y);

                    const uvv = u_val * v_val * v_val;

                    u_next[idx] = u_val + dt * (Du * lap_u - uvv + F * (1.0 - u_val));
                    v_next[idx] = v_val + dt * (Dv * lap_v + uvv - (F + K) * v_val);

                    // Clamp values
                    u_next[idx] = Math.max(0, Math.min(1, u_next[idx]));
                    v_next[idx] = Math.max(0, Math.min(1, v_next[idx]));
                }
            }

            // Swap buffers
            [u, u_next] = [u_next, u];
            [v, v_next] = [v_next, v];

            iterations++;
        }

        // Render to canvas with cyan/blue maze colors
        function render() {
            const imageData = ctx.createImageData(SIZE, SIZE);
            const data = imageData.data;

            for (let i = 0; i < SIZE * SIZE; i++) {
                const v_val = v[i];
                const u_val = u[i];

                // Cyan/blue gradient for maze
                const intensity = v_val;

                // Create cool gradient
                data[i * 4 + 0] = intensity * 50 + u_val * 10;       // R
                data[i * 4 + 1] = intensity * 200 + u_val * 20;      // G
                data[i * 4 + 2] = intensity * 255 + u_val * 30;      // B
                data[i * 4 + 3] = 255;                                // A
            }

            ctx.putImageData(imageData, 0, 0);
        }

        // Animation loop
        function animate(currentTime) {
            requestAnimationFrame(animate);

            // Update FPS
            frameCount++;
            if (currentTime - lastFpsUpdate > 1000) {
                fps = Math.round(frameCount * 1000 / (currentTime - lastFpsUpdate));
                frameCount = 0;
                lastFpsUpdate = currentTime;
                document.getElementById('fps').textContent = fps;
            }

            if (!paused) {
                // Multiple iterations per frame
                for (let i = 0; i < 10; i++) {
                    update();
                }
                render();
                document.getElementById('iterations').textContent = iterations;
            }
        }

        // Mouse interaction
        let isMouseDown = false;

        canvas.addEventListener('mousedown', (e) => {
            isMouseDown = true;
            handleMousePaint(e);
        });

        canvas.addEventListener('mousemove', (e) => {
            if (isMouseDown) {
                handleMousePaint(e);
            }
        });

        canvas.addEventListener('mouseup', () => {
            isMouseDown = false;
        });

        canvas.addEventListener('mouseleave', () => {
            isMouseDown = false;
        });

        function handleMousePaint(e) {
            const rect = canvas.getBoundingClientRect();
            const x = Math.floor((e.clientX - rect.left) * SIZE / rect.width);
            const y = Math.floor((e.clientY - rect.top) * SIZE / rect.height);

            // Paint a circle of chemical V
            for (let dy = -brushSize; dy <= brushSize; dy++) {
                for (let dx = -brushSize; dx <= brushSize; dx++) {
                    if (dx*dx + dy*dy <= brushSize*brushSize) {
                        const px = (x + dx + SIZE) % SIZE;
                        const py = (y + dy + SIZE) % SIZE;
                        const idx = py * SIZE + px;
                        const dist = Math.sqrt(dx*dx + dy*dy) / brushSize;
                        v[idx] = Math.max(v[idx], 1.0 - dist);
                        u[idx] = Math.min(u[idx], dist);
                    }
                }
            }
        }

        // Controls
        document.getElementById('feed-rate').addEventListener('input', (e) => {
            params.F = parseFloat(e.target.value);
            document.getElementById('f-value').textContent = params.F.toFixed(4);
        });

        document.getElementById('kill-rate').addEventListener('input', (e) => {
            params.K = parseFloat(e.target.value);
            document.getElementById('k-value').textContent = params.K.toFixed(4);
        });

        document.getElementById('complexity').addEventListener('input', (e) => {
            complexity = parseInt(e.target.value);
            document.getElementById('complexity-value').textContent = complexity;
        });

        document.getElementById('brush-size').addEventListener('input', (e) => {
            brushSize = parseInt(e.target.value);
            document.getElementById('brush-value').textContent = brushSize;
            document.getElementById('brush-display').textContent = brushSize;
        });

        function setBrushSize(size) {
            brushSize = size;
            document.getElementById('brush-size').value = size;
            document.getElementById('brush-value').textContent = size;
            document.getElementById('brush-display').textContent = size;
        }

        function togglePause() {
            paused = !paused;
        }

        function loadPreset(preset) {
            switch(preset) {
                case 'labyrinth':
                    params.F = 0.0290;
                    params.K = 0.0570;
                    complexity = 50;
                    break;
                case 'maze':
                    params.F = 0.0350;
                    params.K = 0.0580;
                    complexity = 70;
                    break;
                case 'coral':
                    params.F = 0.0460;
                    params.K = 0.0590;
                    complexity = 30;
                    break;
                case 'worms':
                    params.F = 0.0580;
                    params.K = 0.0650;
                    complexity = 100;
                    break;
            }

            document.getElementById('feed-rate').value = params.F;
            document.getElementById('kill-rate').value = params.K;
            document.getElementById('complexity').value = complexity;
            document.getElementById('f-value').textContent = params.F.toFixed(4);
            document.getElementById('k-value').textContent = params.K.toFixed(4);
            document.getElementById('complexity-value').textContent = complexity;
            reset();
        }

        // Initialize
        reset();
        animate(0);
    </script>
</body>
</html>
