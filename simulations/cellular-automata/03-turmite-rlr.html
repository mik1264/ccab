<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turmite (RLR Rule) - Cellular Automaton</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1e1e1e 0%, #2d2d2d 100%);
            color: #ffffff;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            width: 100%;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
            background: linear-gradient(135deg, #84fab0, #8fd3f4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .description {
            text-align: center;
            margin-bottom: 20px;
            color: #aaa;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
        }

        .canvas-container {
            background: #000;
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
        }

        canvas {
            border: 2px solid #444;
            border-radius: 5px;
            max-width: 100%;
            height: auto;
        }

        .controls {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
        }

        .control-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 600;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button.secondary {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
        }

        label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
        }

        select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #444;
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
        }

        select option {
            background: #2d2d2d;
            color: white;
        }

        input[type="range"] {
            width: 150px;
            accent-color: #84fab0;
        }

        .stats {
            display: flex;
            gap: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #84fab0;
        }

        .stat-label {
            color: #aaa;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .color-scheme-preview {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .color-preview {
            width: 30px;
            height: 30px;
            border-radius: 5px;
            border: 2px solid white;
        }

        .info {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(10px);
            line-height: 1.8;
            margin-top: 20px;
        }

        .info h2 {
            margin-bottom: 10px;
            color: #84fab0;
        }

        .info ul {
            margin-left: 20px;
            color: #ccc;
        }

        .info li {
            margin-bottom: 8px;
        }

        .info code {
            background: rgba(255, 255, 255, 0.1);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #84fab0;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }

            .control-group {
                flex-direction: column;
                align-items: stretch;
            }

            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Turmite (RLR Rule)</h1>
        <p class="description">
            A generalization of Langton's Ant with 3 states instead of 2. The RLR rule means: turn Right on state 0,
            turn Left on state 1, turn Right on state 2. This creates more complex and colorful patterns than the basic ant,
            with intricate spiral and symmetric structures emerging from simple rules.
        </p>

        <div class="canvas-container">
            <canvas id="canvas"></canvas>
        </div>

        <div class="controls">
            <div class="control-group">
                <button id="playPauseBtn">Pause</button>
                <button id="stepBtn" class="secondary">Step Forward</button>
                <button id="resetBtn" class="secondary">Reset</button>
            </div>

            <div class="control-group">
                <label>
                    Speed:
                    <input type="range" id="speedSlider" min="1" max="100" value="30">
                    <span id="speedValue">30</span> steps/frame
                </label>
            </div>

            <div class="control-group">
                <label>
                    Color Scheme:
                    <select id="colorSchemeSelect">
                        <option value="rainbow">Rainbow</option>
                        <option value="ocean">Ocean</option>
                        <option value="fire">Fire</option>
                        <option value="forest">Forest</option>
                        <option value="neon">Neon</option>
                        <option value="pastel">Pastel</option>
                    </select>
                </label>
                <div class="color-scheme-preview" id="colorPreview"></div>
            </div>
        </div>

        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="stepCount">0</div>
                <div class="stat-label">Steps</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="fps">60</div>
                <div class="stat-label">FPS</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="state0">0</div>
                <div class="stat-label">State 0 Cells</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="state1">0</div>
                <div class="stat-label">State 1 Cells</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="state2">0</div>
                <div class="stat-label">State 2 Cells</div>
            </div>
        </div>

        <div class="info">
            <h2>About Turmites</h2>
            <ul>
                <li><strong>Definition:</strong> Turmites are a generalization of Langton's Ant with multiple states</li>
                <li><strong>RLR Rule:</strong> The turmite follows different turn directions based on cell state:
                    <ul style="margin-top: 8px;">
                        <li>State 0 (color 1): Turn <code>R</code>ight, change to state 1</li>
                        <li>State 1 (color 2): Turn <code>L</code>eft, change to state 2</li>
                        <li>State 2 (color 3): Turn <code>R</code>ight, change to state 0</li>
                    </ul>
                </li>
                <li><strong>Complexity:</strong> The extra state adds significantly more complexity to the patterns</li>
                <li><strong>Emergence:</strong> Watch for symmetric structures and spiral patterns to develop</li>
                <li><strong>Turing Complete:</strong> Like Langton's Ant, turmites are capable of universal computation</li>
            </ul>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // Configuration
        const cellSize = 4;
        let gridWidth, gridHeight;
        let grid;
        let turmite;
        let isRunning = true;
        let stepsPerFrame = 30;
        let stepCount = 0;
        let stateCounts = [0, 0, 0];

        // Color schemes
        const colorSchemes = {
            rainbow: ['#ffffff', '#ff0000', '#0000ff'],
            ocean: ['#e0f7fa', '#00bcd4', '#0077be'],
            fire: ['#fff3e0', '#ff9800', '#e91e63'],
            forest: ['#e8f5e9', '#4caf50', '#1b5e20'],
            neon: ['#000000', '#00ffff', '#ff00ff'],
            pastel: ['#fce4ec', '#f8bbd0', '#f48fb1']
        };

        let currentColorScheme = 'rainbow';
        let colors = colorSchemes[currentColorScheme];

        // Directions: 0=North, 1=East, 2=South, 3=West
        const directions = [
            { dx: 0, dy: -1 },  // North
            { dx: 1, dy: 0 },   // East
            { dx: 0, dy: 1 },   // South
            { dx: -1, dy: 0 }   // West
        ];

        // RLR rule: [turn_direction, next_state]
        // 0 = left, 1 = right
        const rules = [
            { turn: 1, nextState: 1 },  // State 0: turn Right, go to state 1
            { turn: 0, nextState: 2 },  // State 1: turn Left, go to state 2
            { turn: 1, nextState: 0 }   // State 2: turn Right, go to state 0
        ];

        // FPS tracking
        let fps = 60;
        let frameCount = 0;
        let fpsUpdateTime = 0;

        function initCanvas() {
            const size = Math.min(800, window.innerWidth - 40);
            canvas.width = size;
            canvas.height = size;

            gridWidth = Math.floor(size / cellSize);
            gridHeight = Math.floor(size / cellSize);

            resetSimulation();
        }

        function resetSimulation() {
            // Initialize grid (0, 1, or 2 for three states)
            grid = Array(gridHeight).fill(null).map(() => Array(gridWidth).fill(0));

            // Place turmite in center
            turmite = {
                x: Math.floor(gridWidth / 2),
                y: Math.floor(gridHeight / 2),
                dir: 0  // Start facing north
            };

            stepCount = 0;
            stateCounts = [gridWidth * gridHeight, 0, 0];

            // Clear canvas with first color
            ctx.fillStyle = colors[0];
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            updateStats();
        }

        function step() {
            const { x, y, dir } = turmite;

            // Check if turmite is still on the grid
            if (x < 0 || x >= gridWidth || y < 0 || y >= gridHeight) {
                isRunning = false;
                document.getElementById('playPauseBtn').textContent = 'Play';
                return;
            }

            const currentState = grid[y][x];
            const rule = rules[currentState];

            // Update state counts
            stateCounts[currentState]--;
            stateCounts[rule.nextState]++;

            // Turn based on rule
            if (rule.turn === 1) {
                // Turn right
                turmite.dir = (dir + 1) % 4;
            } else {
                // Turn left
                turmite.dir = (dir + 3) % 4;
            }

            // Change cell state
            grid[y][x] = rule.nextState;

            // Draw the cell
            ctx.fillStyle = colors[rule.nextState];
            ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);

            // Move forward
            const direction = directions[turmite.dir];
            turmite.x += direction.dx;
            turmite.y += direction.dy;

            stepCount++;
        }

        function drawTurmite() {
            const { x, y } = turmite;

            if (x >= 0 && x < gridWidth && y >= 0 && y < gridHeight) {
                // Draw turmite as a bright marker
                ctx.fillStyle = '#ffff00';
                ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
            }
        }

        function animate(currentTime) {
            // FPS calculation
            frameCount++;
            const deltaTime = currentTime - fpsUpdateTime;
            if (deltaTime >= 1000) {
                fps = Math.round((frameCount * 1000) / deltaTime);
                document.getElementById('fps').textContent = fps;
                frameCount = 0;
                fpsUpdateTime = currentTime;
            }

            if (isRunning) {
                // Perform multiple steps per frame for speed
                for (let i = 0; i < stepsPerFrame; i++) {
                    step();
                }

                // Draw turmite on top
                drawTurmite();

                // Update stats periodically
                if (stepCount % 100 === 0) {
                    updateStats();
                }
            }

            requestAnimationFrame(animate);
        }

        function updateStats() {
            document.getElementById('stepCount').textContent = stepCount.toLocaleString();
            document.getElementById('state0').textContent = stateCounts[0].toLocaleString();
            document.getElementById('state1').textContent = stateCounts[1].toLocaleString();
            document.getElementById('state2').textContent = stateCounts[2].toLocaleString();
        }

        function updateColorPreview() {
            const preview = document.getElementById('colorPreview');
            preview.innerHTML = '';
            colors.forEach(color => {
                const div = document.createElement('div');
                div.className = 'color-preview';
                div.style.backgroundColor = color;
                preview.appendChild(div);
            });
        }

        function changeColorScheme(scheme) {
            currentColorScheme = scheme;
            colors = colorSchemes[scheme];
            updateColorPreview();

            // Redraw entire grid with new colors
            for (let y = 0; y < gridHeight; y++) {
                for (let x = 0; x < gridWidth; x++) {
                    const state = grid[y][x];
                    ctx.fillStyle = colors[state];
                    ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
                }
            }
            drawTurmite();
        }

        // Event listeners
        document.getElementById('playPauseBtn').addEventListener('click', () => {
            isRunning = !isRunning;
            document.getElementById('playPauseBtn').textContent = isRunning ? 'Pause' : 'Play';
        });

        document.getElementById('stepBtn').addEventListener('click', () => {
            if (!isRunning) {
                step();
                drawTurmite();
                updateStats();
            }
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            resetSimulation();
        });

        document.getElementById('speedSlider').addEventListener('input', (e) => {
            stepsPerFrame = parseInt(e.target.value);
            document.getElementById('speedValue').textContent = stepsPerFrame;
        });

        document.getElementById('colorSchemeSelect').addEventListener('change', (e) => {
            changeColorScheme(e.target.value);
        });

        // Touch support for mobile
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            isRunning = !isRunning;
            document.getElementById('playPauseBtn').textContent = isRunning ? 'Pause' : 'Play';
        });

        // Initialize and start
        window.addEventListener('resize', initCanvas);
        initCanvas();
        updateColorPreview();
        requestAnimationFrame(animate);
    </script>
    <script src="../../assets/js/enhance.js" defer></script>
</body>
</html>
