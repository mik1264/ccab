<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiple Langton's Ants - Cellular Automaton</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1e1e1e 0%, #2d2d2d 100%);
            color: #ffffff;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            width: 100%;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
            background: linear-gradient(135deg, #f093fb, #f5576c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .description {
            text-align: center;
            margin-bottom: 20px;
            color: #aaa;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
        }

        .canvas-container {
            background: #000;
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
        }

        canvas {
            border: 2px solid #444;
            border-radius: 5px;
            max-width: 100%;
            height: auto;
        }

        .controls {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
        }

        .control-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 600;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button.secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
        }

        input[type="range"] {
            width: 150px;
            accent-color: #667eea;
        }

        input[type="number"] {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #444;
            color: white;
            padding: 8px;
            border-radius: 5px;
            width: 80px;
            font-size: 14px;
        }

        .stats {
            display: flex;
            gap: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #f093fb;
        }

        .stat-label {
            color: #aaa;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .ant-legend {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .ant-color {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .color-box {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            border: 2px solid white;
        }

        .info {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(10px);
            line-height: 1.8;
            margin-top: 20px;
        }

        .info h2 {
            margin-bottom: 10px;
            color: #f093fb;
        }

        .info ul {
            margin-left: 20px;
            color: #ccc;
        }

        .info li {
            margin-bottom: 8px;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }

            .control-group {
                flex-direction: column;
                align-items: stretch;
            }

            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Multiple Langton's Ants</h1>
        <p class="description">
            Watch multiple ants interact on a shared grid! Each ant follows the same simple rules but creates unique patterns.
            When ants cross paths, they can dramatically affect each other's trajectories, leading to fascinating emergent behaviors
            and complex, colorful patterns that neither ant would create alone.
        </p>

        <div class="canvas-container">
            <canvas id="canvas"></canvas>
        </div>

        <div class="controls">
            <div class="control-group">
                <button id="playPauseBtn">Pause</button>
                <button id="stepBtn" class="secondary">Step Forward</button>
                <button id="resetBtn" class="secondary">Reset</button>
            </div>

            <div class="control-group">
                <label>
                    Number of Ants:
                    <input type="range" id="antCountSlider" min="1" max="10" value="5">
                    <span id="antCountValue">5</span>
                </label>
            </div>

            <div class="control-group">
                <label>
                    Speed:
                    <input type="range" id="speedSlider" min="1" max="100" value="25">
                    <span id="speedValue">25</span> steps/frame
                </label>
            </div>

            <div class="control-group">
                <label>
                    <input type="checkbox" id="showTrailsCheckbox" checked>
                    Show Ant Positions
                </label>
            </div>
        </div>

        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="stepCount">0</div>
                <div class="stat-label">Steps</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="fps">60</div>
                <div class="stat-label">FPS</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="blackCells">0</div>
                <div class="stat-label">Black Cells</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="activeAnts">5</div>
                <div class="stat-label">Active Ants</div>
            </div>
        </div>

        <div class="ant-legend" id="antLegend"></div>

        <div class="info">
            <h2>About Multiple Ants</h2>
            <ul>
                <li><strong>Interaction:</strong> Ants share the same grid and can affect each other's paths indirectly</li>
                <li><strong>Emergent Complexity:</strong> Multiple ants create far more complex patterns than a single ant</li>
                <li><strong>Color Coding:</strong> Each ant has a unique color to track individual contributions</li>
                <li><strong>Highway Formation:</strong> Watch as multiple "highways" may emerge and intersect</li>
                <li><strong>Boundary Behavior:</strong> Ants disappear when they leave the grid boundaries</li>
            </ul>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // Configuration
        const cellSize = 4;
        let gridWidth, gridHeight;
        let grid;
        let ants = [];
        let isRunning = true;
        let stepsPerFrame = 25;
        let stepCount = 0;
        let blackCellCount = 0;
        let showTrails = true;
        let numAnts = 5;

        // Rainbow colors for ants
        const antColors = [
            '#ff0000', // Red
            '#ff7f00', // Orange
            '#ffff00', // Yellow
            '#00ff00', // Green
            '#0000ff', // Blue
            '#4b0082', // Indigo
            '#9400d3', // Violet
            '#ff1493', // Pink
            '#00ffff', // Cyan
            '#ff00ff'  // Magenta
        ];

        // Directions: 0=North, 1=East, 2=South, 3=West
        const directions = [
            { dx: 0, dy: -1 },  // North
            { dx: 1, dy: 0 },   // East
            { dx: 0, dy: 1 },   // South
            { dx: -1, dy: 0 }   // West
        ];

        // FPS tracking
        let lastTime = performance.now();
        let fps = 60;
        let frameCount = 0;
        let fpsUpdateTime = 0;

        function initCanvas() {
            const size = Math.min(800, window.innerWidth - 40);
            canvas.width = size;
            canvas.height = size;

            gridWidth = Math.floor(size / cellSize);
            gridHeight = Math.floor(size / cellSize);

            resetSimulation();
        }

        function resetSimulation() {
            // Initialize grid (false = white, true = black)
            grid = Array(gridHeight).fill(null).map(() => Array(gridWidth).fill(false));

            // Create ants in random positions
            ants = [];
            const centerX = Math.floor(gridWidth / 2);
            const centerY = Math.floor(gridHeight / 2);
            const radius = Math.min(gridWidth, gridHeight) / 4;

            for (let i = 0; i < numAnts; i++) {
                const angle = (i / numAnts) * Math.PI * 2;
                ants.push({
                    x: Math.floor(centerX + Math.cos(angle) * radius),
                    y: Math.floor(centerY + Math.sin(angle) * radius),
                    dir: Math.floor(Math.random() * 4),
                    color: antColors[i % antColors.length],
                    active: true
                });
            }

            stepCount = 0;
            blackCellCount = 0;

            // Clear canvas
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            updateStats();
            updateLegend();
        }

        function stepAnt(ant) {
            if (!ant.active) return;

            const { x, y, dir } = ant;

            // Check if ant is still on the grid
            if (x < 0 || x >= gridWidth || y < 0 || y >= gridHeight) {
                ant.active = false;
                return;
            }

            const currentCell = grid[y][x];

            // Turn based on current cell color
            if (currentCell) {
                // Black cell: turn left
                ant.dir = (dir + 3) % 4;
                blackCellCount--;
            } else {
                // White cell: turn right
                ant.dir = (dir + 1) % 4;
                blackCellCount++;
            }

            // Flip the cell color
            grid[y][x] = !currentCell;

            // Draw the cell
            ctx.fillStyle = grid[y][x] ? '#000000' : '#ffffff';
            ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);

            // Move forward
            const direction = directions[ant.dir];
            ant.x += direction.dx;
            ant.y += direction.dy;
        }

        function drawAnts() {
            if (!showTrails) return;

            ants.forEach(ant => {
                if (!ant.active) return;

                const { x, y, color } = ant;

                if (x >= 0 && x < gridWidth && y >= 0 && y < gridHeight) {
                    ctx.fillStyle = color;
                    ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
                }
            });
        }

        function animate(currentTime) {
            // FPS calculation
            frameCount++;
            const deltaTime = currentTime - fpsUpdateTime;
            if (deltaTime >= 1000) {
                fps = Math.round((frameCount * 1000) / deltaTime);
                document.getElementById('fps').textContent = fps;
                frameCount = 0;
                fpsUpdateTime = currentTime;
            }

            if (isRunning) {
                // Perform multiple steps per frame for speed
                for (let i = 0; i < stepsPerFrame; i++) {
                    ants.forEach(ant => stepAnt(ant));
                    stepCount++;
                }

                // Draw ants on top
                drawAnts();

                // Update stats periodically
                if (stepCount % 100 === 0) {
                    updateStats();
                }

                // Stop if all ants are inactive
                const activeCount = ants.filter(ant => ant.active).length;
                if (activeCount === 0) {
                    isRunning = false;
                    document.getElementById('playPauseBtn').textContent = 'Play';
                }
            }

            requestAnimationFrame(animate);
        }

        function updateStats() {
            document.getElementById('stepCount').textContent = stepCount.toLocaleString();
            document.getElementById('blackCells').textContent = blackCellCount.toLocaleString();
            const activeCount = ants.filter(ant => ant.active).length;
            document.getElementById('activeAnts').textContent = activeCount;
        }

        function updateLegend() {
            const legend = document.getElementById('antLegend');
            legend.innerHTML = '';

            for (let i = 0; i < numAnts; i++) {
                const colorDiv = document.createElement('div');
                colorDiv.className = 'ant-color';
                colorDiv.innerHTML = `
                    <div class="color-box" style="background-color: ${antColors[i % antColors.length]}"></div>
                    <span>Ant ${i + 1}</span>
                `;
                legend.appendChild(colorDiv);
            }
        }

        // Event listeners
        document.getElementById('playPauseBtn').addEventListener('click', () => {
            isRunning = !isRunning;
            document.getElementById('playPauseBtn').textContent = isRunning ? 'Pause' : 'Play';
        });

        document.getElementById('stepBtn').addEventListener('click', () => {
            if (!isRunning) {
                ants.forEach(ant => stepAnt(ant));
                stepCount++;
                drawAnts();
                updateStats();
            }
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            resetSimulation();
        });

        document.getElementById('speedSlider').addEventListener('input', (e) => {
            stepsPerFrame = parseInt(e.target.value);
            document.getElementById('speedValue').textContent = stepsPerFrame;
        });

        document.getElementById('antCountSlider').addEventListener('input', (e) => {
            numAnts = parseInt(e.target.value);
            document.getElementById('antCountValue').textContent = numAnts;
            resetSimulation();
        });

        document.getElementById('showTrailsCheckbox').addEventListener('change', (e) => {
            showTrails = e.target.checked;
        });

        // Touch support for mobile
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            isRunning = !isRunning;
            document.getElementById('playPauseBtn').textContent = isRunning ? 'Pause' : 'Play';
        });

        // Initialize and start
        window.addEventListener('resize', initCanvas);
        initCanvas();
        requestAnimationFrame(animate);
    </script>
</body>
</html>
