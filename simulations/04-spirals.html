<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gray-Scott Spiral Waves - Reaction-Diffusion</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1a0033 0%, #0a0015 100%);
            color: #fff;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            display: flex;
            gap: 20px;
            padding: 20px;
            max-width: 1400px;
        }

        .canvas-container {
            position: relative;
            background: #000;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(255, 0, 255, 0.3);
            overflow: hidden;
        }

        canvas {
            display: block;
            cursor: crosshair;
        }

        .info-panel {
            background: rgba(26, 0, 51, 0.95);
            border-radius: 12px;
            padding: 20px;
            width: 320px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            max-height: 90vh;
            overflow-y: auto;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #ff00ff, #00ffff, #ffff00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        h2 {
            font-size: 18px;
            margin-top: 20px;
            margin-bottom: 10px;
            color: #ff00ff;
        }

        .description {
            font-size: 14px;
            line-height: 1.6;
            color: #bbb;
            margin-bottom: 20px;
        }

        .control-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: #aaa;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #333;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #ff00ff;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(255, 0, 255, 0.5);
        }

        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #ff00ff;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(255, 0, 255, 0.5);
        }

        .value-display {
            display: inline-block;
            float: right;
            color: #ff00ff;
            font-weight: bold;
        }

        button {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #ff00ff, #8000ff);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(255, 0, 255, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(255, 0, 255, 0.5);
        }

        button:active {
            transform: translateY(0);
        }

        .stats {
            font-size: 12px;
            color: #888;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #333;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .preset-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 20px;
        }

        .preset-buttons button {
            padding: 8px;
            font-size: 12px;
        }

        .spiral-info {
            background: #1a0033;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 3px solid #ff00ff;
        }

        .spiral-info h3 {
            font-size: 14px;
            color: #ff00ff;
            margin-bottom: 10px;
        }

        .spiral-fact {
            font-size: 12px;
            color: #aaa;
            margin-bottom: 5px;
            padding-left: 10px;
        }

        .wave-direction {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 15px 0;
            font-size: 30px;
            animation: rotate 3s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="canvas-container">
            <canvas id="canvas"></canvas>
        </div>

        <div class="info-panel">
            <h1>Gray-Scott Spiral Waves</h1>
            <p class="description">
                Mesmerizing rotating spiral patterns emerge from reaction-diffusion dynamics.
                These self-organizing waves are similar to spiral patterns in the
                Belousov-Zhabotinsky reaction and cardiac tissue dynamics.
            </p>

            <div class="wave-direction">ðŸŒ€</div>

            <h2>Pattern Presets</h2>
            <div class="preset-buttons">
                <button onclick="loadPreset('spirals')">Spirals</button>
                <button onclick="loadPreset('fast')">Fast Rotation</button>
                <button onclick="loadPreset('slow')">Slow Rotation</button>
                <button onclick="loadPreset('multiple')">Multi-Spiral</button>
            </div>

            <h2>Parameters</h2>
            <div class="control-group">
                <label>
                    Feed Rate (F): <span class="value-display" id="f-value">0.0180</span>
                </label>
                <input type="range" id="feed-rate" min="0.01" max="0.08" step="0.0001" value="0.0180">
            </div>

            <div class="control-group">
                <label>
                    Kill Rate (K): <span class="value-display" id="k-value">0.0510</span>
                </label>
                <input type="range" id="kill-rate" min="0.045" max="0.07" step="0.0001" value="0.0510">
            </div>

            <div class="control-group">
                <label>
                    Rotation Speed: <span class="value-display" id="speed-value">1.0</span>
                </label>
                <input type="range" id="rotation-speed" min="0.5" max="2.0" step="0.1" value="1.0">
            </div>

            <div class="control-group">
                <label>
                    Spiral Centers: <span class="value-display" id="centers-value">3</span>
                </label>
                <input type="range" id="spiral-centers" min="1" max="8" step="1" value="3">
            </div>

            <h2>Controls</h2>
            <button onclick="togglePause()">Pause/Resume</button>
            <button onclick="reset()">Reset</button>
            <button onclick="addSpiralCenter()">Add Spiral Center</button>
            <button onclick="clearAll()">Clear All</button>

            <div class="stats">
                <div class="stat-row">
                    <span>FPS:</span>
                    <span id="fps">60</span>
                </div>
                <div class="stat-row">
                    <span>Iterations:</span>
                    <span id="iterations">0</span>
                </div>
                <div class="stat-row">
                    <span>Grid Size:</span>
                    <span>256Ã—256</span>
                </div>
                <div class="stat-row">
                    <span>Active Spirals:</span>
                    <span id="active-spirals">3</span>
                </div>
            </div>

            <div class="spiral-info">
                <h3>Spiral Wave Phenomena</h3>
                <div class="spiral-fact">â€¢ Found in chemical oscillators (BZ reaction)</div>
                <div class="spiral-fact">â€¢ Occur in cardiac arrhythmias</div>
                <div class="spiral-fact">â€¢ Observed in slime mold aggregation</div>
                <div class="spiral-fact">â€¢ Appear in galaxy formations</div>
                <div class="spiral-fact">â€¢ Self-sustaining wave patterns</div>
            </div>

            <h2>How It Works</h2>
            <p class="description">
                Spiral waves form when:<br><br>
                â€¢ Wave fronts rotate around organizing centers<br>
                â€¢ Chemical V creates rotating arms<br>
                â€¢ Wavelength determined by F and K<br>
                â€¢ Multiple spirals can coexist and interact<br>
                <br>
                Click to create new spiral centers. Watch as the waves propagate
                outward in rotating patterns, creating beautiful rainbow gradients.
            </p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        const SIZE = 256;
        canvas.width = SIZE;
        canvas.height = SIZE;

        // Chemical concentrations
        let u = new Float32Array(SIZE * SIZE);
        let v = new Float32Array(SIZE * SIZE);
        let u_next = new Float32Array(SIZE * SIZE);
        let v_next = new Float32Array(SIZE * SIZE);

        // Parameters
        let params = {
            Du: 0.16,
            Dv: 0.08,
            F: 0.0180,
            K: 0.0510,
            dt: 1.0
        };

        let paused = false;
        let iterations = 0;
        let frameCount = 0;
        let lastFpsUpdate = 0;
        let fps = 60;
        let rotationSpeed = 1.0;
        let spiralCenters = 3;

        // Initialize with spiral centers
        function reset() {
            // Start with full U
            for (let i = 0; i < SIZE * SIZE; i++) {
                u[i] = 1.0;
                v[i] = 0.0;
            }

            // Create spiral centers
            createSpiralCenters(spiralCenters);
            iterations = 0;
            document.getElementById('active-spirals').textContent = spiralCenters;
        }

        function createSpiralCenters(count) {
            for (let i = 0; i < count; i++) {
                const cx = SIZE * (0.3 + 0.4 * Math.random());
                const cy = SIZE * (0.3 + 0.4 * Math.random());
                const angle = Math.random() * Math.PI * 2;

                // Create a spiral seed pattern
                for (let r = 0; r < 40; r++) {
                    const spiralAngle = angle + r * 0.3;
                    const x = Math.floor(cx + r * Math.cos(spiralAngle));
                    const y = Math.floor(cy + r * Math.sin(spiralAngle));

                    if (x >= 0 && x < SIZE && y >= 0 && y < SIZE) {
                        const idx = y * SIZE + x;
                        v[idx] = 0.5 + 0.5 * (r / 40);
                        u[idx] = 0.0;

                        // Add width to spiral arm
                        for (let w = -2; w <= 2; w++) {
                            const wx = x + w * Math.sin(spiralAngle);
                            const wy = y - w * Math.cos(spiralAngle);
                            if (wx >= 0 && wx < SIZE && wy >= 0 && wy < SIZE) {
                                const widx = Math.floor(wy) * SIZE + Math.floor(wx);
                                v[widx] = 0.5 + 0.5 * (r / 40);
                                u[widx] = 0.0;
                            }
                        }
                    }
                }
            }
        }

        function addSpiralCenter() {
            const cx = SIZE * (0.2 + 0.6 * Math.random());
            const cy = SIZE * (0.2 + 0.6 * Math.random());
            const angle = Math.random() * Math.PI * 2;

            for (let r = 0; r < 30; r++) {
                const spiralAngle = angle + r * 0.3;
                const x = Math.floor(cx + r * Math.cos(spiralAngle));
                const y = Math.floor(cy + r * Math.sin(spiralAngle));

                if (x >= 0 && x < SIZE && y >= 0 && y < SIZE) {
                    const idx = y * SIZE + x;
                    v[idx] = 0.8;
                    u[idx] = 0.0;
                }
            }

            spiralCenters++;
            document.getElementById('active-spirals').textContent = spiralCenters;
        }

        function clearAll() {
            for (let i = 0; i < SIZE * SIZE; i++) {
                u[i] = 1.0;
                v[i] = 0.0;
            }
            spiralCenters = 0;
            document.getElementById('active-spirals').textContent = spiralCenters;
        }

        // Calculate Laplacian using 5-point stencil
        function laplacian(arr, x, y) {
            const idx = y * SIZE + x;
            const xm1 = (x - 1 + SIZE) % SIZE;
            const xp1 = (x + 1) % SIZE;
            const ym1 = (y - 1 + SIZE) % SIZE;
            const yp1 = (y + 1) % SIZE;

            const center = arr[idx];
            const left = arr[y * SIZE + xm1];
            const right = arr[y * SIZE + xp1];
            const up = arr[ym1 * SIZE + x];
            const down = arr[yp1 * SIZE + x;

            return (left + right + up + down - 4.0 * center);
        }

        // Update reaction-diffusion
        function update() {
            const { Du, Dv, F, K, dt } = params;
            const adjustedDt = dt * rotationSpeed;

            for (let y = 0; y < SIZE; y++) {
                for (let x = 0; x < SIZE; x++) {
                    const idx = y * SIZE + x;
                    const u_val = u[idx];
                    const v_val = v[idx];

                    const lap_u = laplacian(u, x, y);
                    const lap_v = laplacian(v, x, y);

                    const uvv = u_val * v_val * v_val;

                    u_next[idx] = u_val + adjustedDt * (Du * lap_u - uvv + F * (1.0 - u_val));
                    v_next[idx] = v_val + adjustedDt * (Dv * lap_v + uvv - (F + K) * v_val);

                    // Clamp values
                    u_next[idx] = Math.max(0, Math.min(1, u_next[idx]));
                    v_next[idx] = Math.max(0, Math.min(1, v_next[idx]));
                }
            }

            // Swap buffers
            [u, u_next] = [u_next, u];
            [v, v_next] = [v_next, v];

            iterations++;
        }

        // Render to canvas with rainbow spiral colors
        function render() {
            const imageData = ctx.createImageData(SIZE, SIZE);
            const data = imageData.data;

            for (let i = 0; i < SIZE * SIZE; i++) {
                const v_val = v[i];
                const u_val = u[i];

                // Rainbow gradient for spirals
                const intensity = v_val;
                const hue = (v_val * 360 + iterations * 0.5) % 360;

                // Convert HSV to RGB
                const c = intensity;
                const x = c * (1 - Math.abs((hue / 60) % 2 - 1));
                const m = 0;

                let r, g, b;
                if (hue < 60) {
                    r = c; g = x; b = 0;
                } else if (hue < 120) {
                    r = x; g = c; b = 0;
                } else if (hue < 180) {
                    r = 0; g = c; b = x;
                } else if (hue < 240) {
                    r = 0; g = x; b = c;
                } else if (hue < 300) {
                    r = x; g = 0; b = c;
                } else {
                    r = c; g = 0; b = x;
                }

                data[i * 4 + 0] = (r + m) * 255 + u_val * 10;
                data[i * 4 + 1] = (g + m) * 255 + u_val * 10;
                data[i * 4 + 2] = (b + m) * 255 + u_val * 10;
                data[i * 4 + 3] = 255;
            }

            ctx.putImageData(imageData, 0, 0);
        }

        // Animation loop
        function animate(currentTime) {
            requestAnimationFrame(animate);

            // Update FPS
            frameCount++;
            if (currentTime - lastFpsUpdate > 1000) {
                fps = Math.round(frameCount * 1000 / (currentTime - lastFpsUpdate));
                frameCount = 0;
                lastFpsUpdate = currentTime;
                document.getElementById('fps').textContent = fps;
            }

            if (!paused) {
                // Multiple iterations per frame
                for (let i = 0; i < 8; i++) {
                    update();
                }
                render();
                document.getElementById('iterations').textContent = iterations;
            }
        }

        // Mouse interaction
        let isMouseDown = false;

        canvas.addEventListener('mousedown', (e) => {
            isMouseDown = true;
            handleMousePaint(e);
        });

        canvas.addEventListener('mousemove', (e) => {
            if (isMouseDown) {
                handleMousePaint(e);
            }
        });

        canvas.addEventListener('mouseup', () => {
            isMouseDown = false;
        });

        canvas.addEventListener('mouseleave', () => {
            isMouseDown = false;
        });

        function handleMousePaint(e) {
            const rect = canvas.getBoundingClientRect();
            const x = Math.floor((e.clientX - rect.left) * SIZE / rect.width);
            const y = Math.floor((e.clientY - rect.top) * SIZE / rect.height);

            // Create a small spiral seed
            const angle = Math.random() * Math.PI * 2;
            for (let r = 0; r < 15; r++) {
                const spiralAngle = angle + r * 0.4;
                const px = Math.floor(x + r * Math.cos(spiralAngle));
                const py = Math.floor(y + r * Math.sin(spiralAngle));

                if (px >= 0 && px < SIZE && py >= 0 && py < SIZE) {
                    const idx = py * SIZE + px;
                    v[idx] = 0.8;
                    u[idx] = 0.0;
                }
            }
        }

        // Controls
        document.getElementById('feed-rate').addEventListener('input', (e) => {
            params.F = parseFloat(e.target.value);
            document.getElementById('f-value').textContent = params.F.toFixed(4);
        });

        document.getElementById('kill-rate').addEventListener('input', (e) => {
            params.K = parseFloat(e.target.value);
            document.getElementById('k-value').textContent = params.K.toFixed(4);
        });

        document.getElementById('rotation-speed').addEventListener('input', (e) => {
            rotationSpeed = parseFloat(e.target.value);
            document.getElementById('speed-value').textContent = rotationSpeed.toFixed(1);
        });

        document.getElementById('spiral-centers').addEventListener('input', (e) => {
            spiralCenters = parseInt(e.target.value);
            document.getElementById('centers-value').textContent = spiralCenters;
        });

        function togglePause() {
            paused = !paused;
        }

        function loadPreset(preset) {
            switch(preset) {
                case 'spirals':
                    params.F = 0.0180;
                    params.K = 0.0510;
                    spiralCenters = 3;
                    rotationSpeed = 1.0;
                    break;
                case 'fast':
                    params.F = 0.0140;
                    params.K = 0.0470;
                    spiralCenters = 2;
                    rotationSpeed = 1.5;
                    break;
                case 'slow':
                    params.F = 0.0220;
                    params.K = 0.0530;
                    spiralCenters = 4;
                    rotationSpeed = 0.6;
                    break;
                case 'multiple':
                    params.F = 0.0180;
                    params.K = 0.0510;
                    spiralCenters = 6;
                    rotationSpeed = 1.0;
                    break;
            }

            document.getElementById('feed-rate').value = params.F;
            document.getElementById('kill-rate').value = params.K;
            document.getElementById('spiral-centers').value = spiralCenters;
            document.getElementById('rotation-speed').value = rotationSpeed;
            document.getElementById('f-value').textContent = params.F.toFixed(4);
            document.getElementById('k-value').textContent = params.K.toFixed(4);
            document.getElementById('centers-value').textContent = spiralCenters;
            document.getElementById('speed-value').textContent = rotationSpeed.toFixed(1);
            reset();
        }

        // Initialize
        reset();
        animate(0);
    </script>
</body>
</html>
