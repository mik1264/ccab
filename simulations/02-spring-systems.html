<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spring-Mass Systems - Wave Propagation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
        }

        h1 {
            margin-bottom: 10px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .description {
            text-align: center;
            max-width: 800px;
            margin-bottom: 20px;
            line-height: 1.6;
            opacity: 0.9;
        }

        .equation {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }

        canvas {
            background: #0a0a0a;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            margin-bottom: 20px;
            cursor: crosshair;
        }

        .controls {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            max-width: 1200px;
            width: 100%;
            backdrop-filter: blur(10px);
        }

        .control-group {
            display: flex;
            flex-direction: column;
        }

        label {
            margin-bottom: 5px;
            font-weight: 500;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.3);
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        button {
            padding: 12px 24px;
            background: #667eea;
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        button:hover {
            background: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button.active {
            background: #764ba2;
        }

        .button-group {
            display: flex;
            gap: 10px;
            grid-column: 1 / -1;
            justify-content: center;
            flex-wrap: wrap;
        }

        .mode-buttons {
            grid-column: 1 / -1;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .info {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            grid-column: 1 / -1;
            text-align: center;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>Spring-Mass Systems - Wave Propagation</h1>

    <div class="description">
        <p>
            <strong>Hooke's Law in Action:</strong> A chain of masses connected by springs demonstrates wave propagation,
            harmonics, and energy transfer. Click and drag to displace masses and watch waves travel through the system.
        </p>
        <div class="equation">
            F = -k(x - x₀) - c·v | k: spring constant, c: damping, x₀: rest length
        </div>
    </div>

    <canvas id="canvas"></canvas>

    <div class="controls">
        <div class="control-group">
            <label>Spring Constant: <span id="spring-value">0.5</span></label>
            <input type="range" id="spring" min="0.1" max="2.0" value="0.5" step="0.1">
        </div>
        <div class="control-group">
            <label>Damping: <span id="damping-value">0.05</span></label>
            <input type="range" id="damping" min="0" max="0.3" value="0.05" step="0.01">
        </div>
        <div class="control-group">
            <label>Mass Count: <span id="mass-count-value">30</span></label>
            <input type="range" id="mass-count" min="10" max="50" value="30" step="1">
        </div>
        <div class="control-group">
            <label>Mass Value: <span id="mass-value">1.0</span> kg</label>
            <input type="range" id="mass" min="0.5" max="3.0" value="1.0" step="0.1">
        </div>
        <div class="control-group">
            <label>Gravity: <span id="gravity-value">0.5</span> m/s²</label>
            <input type="range" id="gravity" min="0" max="2.0" value="0.5" step="0.1">
        </div>
        <div class="control-group">
            <label>Speed: <span id="speed-value">1.0</span>x</label>
            <input type="range" id="speed" min="0.1" max="3.0" value="1.0" step="0.1">
        </div>

        <div class="info">
            <strong>Interaction:</strong> Click and drag to displace masses • Springs colored by tension (blue=compressed, red=stretched)
        </div>

        <div class="mode-buttons">
            <button id="mode-fundamental" class="active">Fundamental Mode</button>
            <button id="mode-harmonic2">2nd Harmonic</button>
            <button id="mode-harmonic3">3rd Harmonic</button>
            <button id="mode-wave">Traveling Wave</button>
            <button id="mode-pulse">Single Pulse</button>
        </div>

        <div class="button-group">
            <button id="pauseBtn">Pause</button>
            <button id="resetBtn">Reset</button>
            <button id="fixedBtn">Toggle Fixed Ends</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 1200;
        canvas.height = 600;

        // System parameters
        let springConstant = 0.5;
        let damping = 0.05;
        let massCount = 30;
        let massValue = 1.0;
        let gravity = 0.5;
        let speed = 1.0;
        let fixedEnds = true;

        // Simulation state
        let paused = false;
        let masses = [];
        let springs = [];
        let draggingMass = null;

        const restLength = (canvas.width - 100) / (massCount - 1);
        const centerY = canvas.height / 2;

        // Mass class
        class Mass {
            constructor(x, y, mass, fixed = false) {
                this.x = x;
                this.y = y;
                this.mass = mass;
                this.vx = 0;
                this.vy = 0;
                this.fx = 0;
                this.fy = 0;
                this.fixed = fixed;
                this.radius = 8;
            }

            applyForce(fx, fy) {
                this.fx += fx;
                this.fy += fy;
            }

            update(dt) {
                if (this.fixed) return;

                // Apply gravity
                this.fy += this.mass * gravity;

                // Update velocity and position
                this.vx += (this.fx / this.mass) * dt;
                this.vy += (this.fy / this.mass) * dt;

                // Apply damping
                this.vx *= (1 - damping);
                this.vy *= (1 - damping);

                this.x += this.vx * dt;
                this.y += this.vy * dt;

                // Reset forces
                this.fx = 0;
                this.fy = 0;
            }

            draw() {
                const speed = Math.sqrt(this.vx * this.vx + this.vy * this.vy);
                const hue = Math.min(speed * 20, 280);

                ctx.fillStyle = this.fixed ? '#888' : `hsl(${hue}, 100%, 60%)`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();

                ctx.strokeStyle = 'white';
                ctx.lineWidth = 2;
                ctx.stroke();
            }

            contains(x, y) {
                const dx = x - this.x;
                const dy = y - this.y;
                return Math.sqrt(dx * dx + dy * dy) < this.radius;
            }
        }

        // Spring class
        class Spring {
            constructor(mass1, mass2, restLength, k) {
                this.mass1 = mass1;
                this.mass2 = mass2;
                this.restLength = restLength;
                this.k = k;
            }

            update() {
                const dx = this.mass2.x - this.mass1.x;
                const dy = this.mass2.y - this.mass1.y;
                const distance = Math.sqrt(dx * dx + dy * dy);

                // Hooke's law
                const force = this.k * (distance - this.restLength);
                const fx = (dx / distance) * force;
                const fy = (dy / distance) * force;

                this.mass1.applyForce(fx, fy);
                this.mass2.applyForce(-fx, -fy);
            }

            draw() {
                const dx = this.mass2.x - this.mass1.x;
                const dy = this.mass2.y - this.mass1.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                const tension = Math.abs(distance - this.restLength);

                // Color based on tension
                let color;
                if (distance < this.restLength) {
                    // Compressed - blue
                    const intensity = Math.min(tension / 50, 1);
                    color = `rgba(0, 150, 255, ${0.3 + intensity * 0.7})`;
                } else {
                    // Stretched - red
                    const intensity = Math.min(tension / 50, 1);
                    color = `rgba(255, 50, 0, ${0.3 + intensity * 0.7})`;
                }

                ctx.strokeStyle = color;
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(this.mass1.x, this.mass1.y);
                ctx.lineTo(this.mass2.x, this.mass2.y);
                ctx.stroke();
            }
        }

        // Initialize system
        function initSystem() {
            masses = [];
            springs = [];

            const spacing = (canvas.width - 100) / (massCount - 1);

            // Create masses
            for (let i = 0; i < massCount; i++) {
                const x = 50 + i * spacing;
                const y = centerY;
                const fixed = fixedEnds && (i === 0 || i === massCount - 1);
                masses.push(new Mass(x, y, massValue, fixed));
            }

            // Create springs
            for (let i = 0; i < massCount - 1; i++) {
                springs.push(new Spring(masses[i], masses[i + 1], spacing, springConstant));
            }
        }

        // Apply wave modes
        function applyMode(mode) {
            const amplitude = 100;

            for (let i = 0; i < masses.length; i++) {
                if (masses[i].fixed) continue;

                const t = i / (masses.length - 1);

                switch(mode) {
                    case 'fundamental':
                        masses[i].y = centerY + amplitude * Math.sin(t * Math.PI);
                        break;
                    case 'harmonic2':
                        masses[i].y = centerY + amplitude * Math.sin(t * Math.PI * 2);
                        break;
                    case 'harmonic3':
                        masses[i].y = centerY + amplitude * Math.sin(t * Math.PI * 3);
                        break;
                    case 'wave':
                        masses[i].y = centerY + amplitude * Math.sin(t * Math.PI * 2);
                        masses[i].vy = amplitude * 0.1 * Math.cos(t * Math.PI * 2);
                        break;
                    case 'pulse':
                        if (i === Math.floor(masses.length / 4)) {
                            masses[i].y = centerY + amplitude;
                        } else {
                            masses[i].y = centerY;
                        }
                        break;
                }
                masses[i].vx = 0;
            }
        }

        // Mouse interaction
        let mouseDown = false;
        let mouseX = 0;
        let mouseY = 0;

        canvas.addEventListener('mousedown', (e) => {
            const rect = canvas.getBoundingClientRect();
            mouseX = e.clientX - rect.left;
            mouseY = e.clientY - rect.top;
            mouseDown = true;

            for (const mass of masses) {
                if (mass.contains(mouseX, mouseY) && !mass.fixed) {
                    draggingMass = mass;
                    break;
                }
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            if (draggingMass) {
                const rect = canvas.getBoundingClientRect();
                mouseX = e.clientX - rect.left;
                mouseY = e.clientY - rect.top;
                draggingMass.x = mouseX;
                draggingMass.y = mouseY;
                draggingMass.vx = 0;
                draggingMass.vy = 0;
            }
        });

        canvas.addEventListener('mouseup', () => {
            mouseDown = false;
            draggingMass = null;
        });

        // Animation loop
        function animate() {
            ctx.fillStyle = '#0a0a0a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw equilibrium line
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.lineWidth = 1;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(canvas.width, centerY);
            ctx.stroke();
            ctx.setLineDash([]);

            if (!paused) {
                const dt = 0.5 * speed;

                // Update springs (apply forces)
                for (const spring of springs) {
                    spring.update();
                }

                // Update masses
                for (const mass of masses) {
                    mass.update(dt);
                }
            }

            // Draw springs
            for (const spring of springs) {
                spring.draw();
            }

            // Draw masses
            for (const mass of masses) {
                mass.draw();
            }

            requestAnimationFrame(animate);
        }

        // Controls
        document.getElementById('spring').addEventListener('input', (e) => {
            springConstant = parseFloat(e.target.value);
            document.getElementById('spring-value').textContent = springConstant.toFixed(1);
            springs.forEach(s => s.k = springConstant);
        });

        document.getElementById('damping').addEventListener('input', (e) => {
            damping = parseFloat(e.target.value);
            document.getElementById('damping-value').textContent = damping.toFixed(2);
        });

        document.getElementById('mass-count').addEventListener('input', (e) => {
            massCount = parseInt(e.target.value);
            document.getElementById('mass-count-value').textContent = massCount;
            initSystem();
        });

        document.getElementById('mass').addEventListener('input', (e) => {
            massValue = parseFloat(e.target.value);
            document.getElementById('mass-value').textContent = massValue.toFixed(1);
            masses.forEach(m => m.mass = massValue);
        });

        document.getElementById('gravity').addEventListener('input', (e) => {
            gravity = parseFloat(e.target.value);
            document.getElementById('gravity-value').textContent = gravity.toFixed(1);
        });

        document.getElementById('speed').addEventListener('input', (e) => {
            speed = parseFloat(e.target.value);
            document.getElementById('speed-value').textContent = speed.toFixed(1);
        });

        // Mode buttons
        const modeButtons = document.querySelectorAll('.mode-buttons button');
        modeButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                modeButtons.forEach(b => b.classList.remove('active'));
                button.classList.add('active');

                const mode = button.id.replace('mode-', '');
                applyMode(mode);
            });
        });

        document.getElementById('pauseBtn').addEventListener('click', () => {
            paused = !paused;
            document.getElementById('pauseBtn').textContent = paused ? 'Resume' : 'Pause';
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            initSystem();
        });

        document.getElementById('fixedBtn').addEventListener('click', () => {
            fixedEnds = !fixedEnds;
            initSystem();
            document.getElementById('fixedBtn').textContent =
                fixedEnds ? 'Toggle Fixed Ends (ON)' : 'Toggle Fixed Ends (OFF)';
        });

        // Initialize and start
        initSystem();
        applyMode('fundamental');
        animate();
    </script>
</body>
</html>