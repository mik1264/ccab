<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Turing Pattern Explorer - Reaction-Diffusion</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #1a1a2e 100%);
            color: #fff;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            display: flex;
            gap: 20px;
            padding: 20px;
            max-width: 1600px;
        }

        .canvas-container {
            position: relative;
            background: #000;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(46, 204, 113, 0.3);
            overflow: hidden;
        }

        canvas {
            display: block;
        }

        #main-canvas {
            cursor: crosshair;
        }

        .info-panel {
            background: rgba(44, 62, 80, 0.95);
            border-radius: 12px;
            padding: 20px;
            width: 380px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            max-height: 90vh;
            overflow-y: auto;
        }

        h1 {
            font-size: 26px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #2ecc71, #3498db, #9b59b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        h2 {
            font-size: 18px;
            margin-top: 20px;
            margin-bottom: 10px;
            color: #2ecc71;
        }

        .description {
            font-size: 14px;
            line-height: 1.6;
            color: #bbb;
            margin-bottom: 20px;
        }

        .control-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: #aaa;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #333;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #2ecc71;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(46, 204, 113, 0.5);
        }

        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #2ecc71;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(46, 204, 113, 0.5);
        }

        .value-display {
            display: inline-block;
            float: right;
            color: #2ecc71;
            font-weight: bold;
        }

        button {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(46, 204, 113, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(46, 204, 113, 0.5);
        }

        button:active {
            transform: translateY(0);
        }

        .stats {
            font-size: 12px;
            color: #888;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #333;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .preset-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 20px;
        }

        .preset-grid button {
            padding: 10px 8px;
            font-size: 12px;
        }

        .parameter-space {
            width: 100%;
            height: 200px;
            background: #1a1a2e;
            border-radius: 8px;
            margin-top: 10px;
            position: relative;
            border: 2px solid #2ecc71;
            cursor: pointer;
        }

        #param-canvas {
            width: 100%;
            height: 100%;
            border-radius: 8px;
        }

        .current-position {
            position: absolute;
            width: 12px;
            height: 12px;
            background: #2ecc71;
            border-radius: 50%;
            border: 2px solid white;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 10px rgba(46, 204, 113, 0.8);
            pointer-events: none;
        }

        .axis-label {
            position: absolute;
            font-size: 11px;
            color: #888;
        }

        .color-scheme-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            margin-bottom: 10px;
        }

        .color-scheme-buttons button {
            padding: 8px;
            font-size: 11px;
        }

        .brush-controls {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .brush-controls button {
            flex: 1;
            padding: 8px;
            font-size: 11px;
        }

        .turing-info {
            background: #1a2332;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 3px solid #2ecc71;
        }

        .turing-info h3 {
            font-size: 14px;
            color: #2ecc71;
            margin-bottom: 10px;
        }

        .natural-example {
            font-size: 12px;
            color: #aaa;
            margin-bottom: 5px;
            padding-left: 10px;
        }

        .pattern-indicator {
            background: #1a2332;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 15px;
            border: 2px solid #2ecc71;
        }

        .pattern-name {
            font-size: 16px;
            font-weight: bold;
            color: #2ecc71;
        }

        .save-load-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .save-load-controls button {
            padding: 8px;
            font-size: 11px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="canvas-container">
            <canvas id="main-canvas"></canvas>
        </div>

        <div class="info-panel">
            <h1>Interactive Turing Pattern Explorer</h1>
            <p class="description">
                Explore Alan Turing's morphogenesis theory through interactive reaction-diffusion
                patterns. Discover how simple chemical reactions create the spots, stripes, and
                patterns found throughout nature.
            </p>

            <div class="pattern-indicator">
                <div class="pattern-name" id="pattern-name">Spots</div>
            </div>

            <h2>Famous Patterns</h2>
            <div class="preset-grid">
                <button onclick="loadPreset('spots')">üêÜ Spots</button>
                <button onclick="loadPreset('stripes')">ü¶ì Stripes</button>
                <button onclick="loadPreset('spirals')">üåÄ Spirals</button>
                <button onclick="loadPreset('labyrinth')">üß© Labyrinth</button>
                <button onclick="loadPreset('holes')">‚ö´ Holes</button>
                <button onclick="loadPreset('chaos')">üí´ Chaos</button>
                <button onclick="loadPreset('waves')">üåä Waves</button>
                <button onclick="loadPreset('coral')">ü™∏ Coral</button>
            </div>

            <h2>Parameter Space Explorer</h2>
            <div class="parameter-space" id="param-space">
                <canvas id="param-canvas"></canvas>
                <div class="current-position" id="current-pos"></div>
                <span class="axis-label" style="bottom: 5px; left: 5px;">F: 0.01</span>
                <span class="axis-label" style="bottom: 5px; right: 5px;">F: 0.08</span>
                <span class="axis-label" style="top: 5px; left: 5px;">K: 0.070</span>
                <span class="axis-label" style="top: 5px; right: 5px;">K: 0.070</span>
                <span class="axis-label" style="bottom: 5px; left: 50%; transform: translateX(-50%);">K: 0.045</span>
            </div>
            <p style="font-size: 11px; color: #666; margin-top: 5px;">
                Click on parameter space to jump to different patterns
            </p>

            <h2>Parameters</h2>
            <div class="control-group">
                <label>
                    Feed Rate (F): <span class="value-display" id="f-value">0.0545</span>
                </label>
                <input type="range" id="feed-rate" min="0.01" max="0.08" step="0.0001" value="0.0545">
            </div>

            <div class="control-group">
                <label>
                    Kill Rate (K): <span class="value-display" id="k-value">0.0620</span>
                </label>
                <input type="range" id="kill-rate" min="0.045" max="0.07" step="0.0001" value="0.0620">
            </div>

            <h2>Color Schemes</h2>
            <div class="color-scheme-buttons">
                <button onclick="setColorScheme('scientific')">Scientific</button>
                <button onclick="setColorScheme('artistic')">Artistic</button>
                <button onclick="setColorScheme('monochrome')">Mono</button>
            </div>

            <h2>Brush Tools</h2>
            <div class="control-group">
                <label>
                    Brush Size: <span class="value-display" id="brush-value">10</span>
                </label>
                <input type="range" id="brush-size" min="3" max="30" step="1" value="10">
            </div>
            <div class="brush-controls">
                <button onclick="setBrushMode('add')">Add V</button>
                <button onclick="setBrushMode('remove')">Add U</button>
            </div>

            <h2>Controls</h2>
            <button onclick="togglePause()">Pause/Resume</button>
            <button onclick="reset()">Reset Pattern</button>
            <div class="save-load-controls">
                <button onclick="saveState()">Save State</button>
                <button onclick="loadState()">Load State</button>
            </div>

            <div class="stats">
                <div class="stat-row">
                    <span>FPS:</span>
                    <span id="fps">60</span>
                </div>
                <div class="stat-row">
                    <span>Iterations:</span>
                    <span id="iterations">0</span>
                </div>
                <div class="stat-row">
                    <span>Grid Size:</span>
                    <span>256√ó256</span>
                </div>
                <div class="stat-row">
                    <span>Color Scheme:</span>
                    <span id="color-scheme-display">Scientific</span>
                </div>
            </div>

            <div class="turing-info">
                <h3>Alan Turing's Morphogenesis</h3>
                <p class="description" style="font-size: 12px;">
                    In 1952, Alan Turing proposed that patterns in nature arise from
                    the interaction of two chemicals diffusing and reacting together.
                </p>
                <h3 style="margin-top: 15px;">Natural Examples</h3>
                <div class="natural-example">üêÜ Leopard and cheetah spots</div>
                <div class="natural-example">ü¶ì Zebra stripes</div>
                <div class="natural-example">üê† Angelfish patterns</div>
                <div class="natural-example">üêö Seashell patterns</div>
                <div class="natural-example">ü¶í Giraffe patches</div>
                <div class="natural-example">ü™∏ Coral formations</div>
            </div>
        </div>
    </div>

    <script>
        const mainCanvas = document.getElementById('main-canvas');
        const mainCtx = mainCanvas.getContext('2d');
        const paramCanvas = document.getElementById('param-canvas');
        const paramCtx = paramCanvas.getContext('2d');

        const SIZE = 256;
        mainCanvas.width = SIZE;
        mainCanvas.height = SIZE;

        paramCanvas.width = 340;
        paramCanvas.height = 200;

        // Chemical concentrations
        let u = new Float32Array(SIZE * SIZE);
        let v = new Float32Array(SIZE * SIZE);
        let u_next = new Float32Array(SIZE * SIZE);
        let v_next = new Float32Array(SIZE * SIZE);

        // Saved state for save/load
        let savedState = null;

        // Parameters
        let params = {
            Du: 0.16,
            Dv: 0.08,
            F: 0.0545,
            K: 0.0620,
            dt: 1.0
        };

        let paused = false;
        let iterations = 0;
        let frameCount = 0;
        let lastFpsUpdate = 0;
        let fps = 60;
        let brushSize = 10;
        let brushMode = 'add';
        let colorScheme = 'scientific';
        let currentPattern = 'Spots';

        // Pattern presets with names
        const presets = {
            spots: { F: 0.0545, K: 0.0620, name: 'Spots', seed: 'random' },
            stripes: { F: 0.0350, K: 0.0600, name: 'Stripes', seed: 'vertical' },
            spirals: { F: 0.0180, K: 0.0510, name: 'Spirals', seed: 'spiral' },
            labyrinth: { F: 0.0290, K: 0.0570, name: 'Labyrinth', seed: 'random' },
            holes: { F: 0.0390, K: 0.0649, name: 'Holes', seed: 'random' },
            chaos: { F: 0.0260, K: 0.0510, name: 'Chaos', seed: 'noise' },
            waves: { F: 0.0140, K: 0.0450, name: 'Waves', seed: 'horizontal' },
            coral: { F: 0.0460, K: 0.0590, name: 'Coral', seed: 'random' }
        };

        // Initialize
        function reset() {
            for (let i = 0; i < SIZE * SIZE; i++) {
                u[i] = 1.0;
                v[i] = 0.0;
            }

            // Determine seed pattern based on current parameters
            const preset = findClosestPreset();
            seedPattern(preset.seed);
            iterations = 0;
        }

        function findClosestPreset() {
            let closest = presets.spots;
            let minDist = Infinity;

            for (const key in presets) {
                const preset = presets[key];
                const dist = Math.sqrt(
                    Math.pow(preset.F - params.F, 2) +
                    Math.pow(preset.K - params.K, 2)
                );
                if (dist < minDist) {
                    minDist = dist;
                    closest = preset;
                }
            }

            currentPattern = closest.name;
            document.getElementById('pattern-name').textContent = currentPattern;
            return closest;
        }

        function seedPattern(type) {
            switch(type) {
                case 'random':
                    for (let i = 0; i < 30; i++) {
                        const x = Math.floor(Math.random() * SIZE);
                        const y = Math.floor(Math.random() * SIZE);
                        seedSpot(x, y, 3 + Math.floor(Math.random() * 5));
                    }
                    break;
                case 'vertical':
                    for (let y = 0; y < SIZE; y++) {
                        for (let x = 0; x < SIZE; x++) {
                            const idx = y * SIZE + x;
                            v[idx] = Math.sin(x * Math.PI * 2 / 8) > 0 ? 0.5 : 0;
                            u[idx] = 1.0 - v[idx];
                        }
                    }
                    break;
                case 'horizontal':
                    for (let y = 0; y < SIZE; y++) {
                        for (let x = 0; x < SIZE; x++) {
                            const idx = y * SIZE + x;
                            v[idx] = Math.sin(y * Math.PI * 2 / 8) > 0 ? 0.5 : 0;
                            u[idx] = 1.0 - v[idx];
                        }
                    }
                    break;
                case 'spiral':
                    for (let i = 0; i < 3; i++) {
                        const cx = SIZE * (0.3 + 0.4 * Math.random());
                        const cy = SIZE * (0.3 + 0.4 * Math.random());
                        const angle = Math.random() * Math.PI * 2;
                        for (let r = 0; r < 30; r++) {
                            const spiralAngle = angle + r * 0.3;
                            const x = Math.floor(cx + r * Math.cos(spiralAngle));
                            const y = Math.floor(cy + r * Math.sin(spiralAngle));
                            if (x >= 0 && x < SIZE && y >= 0 && y < SIZE) {
                                v[y * SIZE + x] = 0.8;
                                u[y * SIZE + x] = 0.0;
                            }
                        }
                    }
                    break;
                case 'noise':
                    for (let i = 0; i < SIZE * SIZE; i++) {
                        v[i] = Math.random() * 0.3;
                        u[i] = 1.0 - v[i];
                    }
                    break;
            }
        }

        function seedSpot(cx, cy, radius) {
            for (let y = -radius; y <= radius; y++) {
                for (let x = -radius; x <= radius; x++) {
                    if (x*x + y*y <= radius*radius) {
                        const px = (cx + x + SIZE) % SIZE;
                        const py = (cy + y + SIZE) % SIZE;
                        const idx = py * SIZE + px;
                        v[idx] = 1.0;
                        u[idx] = 0.0;
                    }
                }
            }
        }

        // Calculate Laplacian
        function laplacian(arr, x, y) {
            const idx = y * SIZE + x;
            const xm1 = (x - 1 + SIZE) % SIZE;
            const xp1 = (x + 1) % SIZE;
            const ym1 = (y - 1 + SIZE) % SIZE;
            const yp1 = (y + 1) % SIZE;

            const center = arr[idx];
            const left = arr[y * SIZE + xm1];
            const right = arr[y * SIZE + xp1];
            const up = arr[ym1 * SIZE + x];
            const down = arr[yp1 * SIZE + x];

            return (left + right + up + down - 4.0 * center);
        }

        // Update reaction-diffusion
        function update() {
            const { Du, Dv, F, K, dt } = params;

            for (let y = 0; y < SIZE; y++) {
                for (let x = 0; x < SIZE; x++) {
                    const idx = y * SIZE + x;
                    const u_val = u[idx];
                    const v_val = v[idx];

                    const lap_u = laplacian(u, x, y);
                    const lap_v = laplacian(v, x, y);

                    const uvv = u_val * v_val * v_val;

                    u_next[idx] = u_val + dt * (Du * lap_u - uvv + F * (1.0 - u_val));
                    v_next[idx] = v_val + dt * (Dv * lap_v + uvv - (F + K) * v_val);

                    u_next[idx] = Math.max(0, Math.min(1, u_next[idx]));
                    v_next[idx] = Math.max(0, Math.min(1, v_next[idx]));
                }
            }

            [u, u_next] = [u_next, u];
            [v, v_next] = [v_next, v];

            iterations++;
        }

        // Render with different color schemes
        function render() {
            const imageData = mainCtx.createImageData(SIZE, SIZE);
            const data = imageData.data;

            for (let i = 0; i < SIZE * SIZE; i++) {
                const v_val = v[i];
                const u_val = u[i];
                let r, g, b;

                switch(colorScheme) {
                    case 'scientific':
                        // Viridis-like colormap
                        r = 255 * Math.pow(v_val, 0.5);
                        g = 200 * v_val;
                        b = 255 * (1 - Math.pow(1 - v_val, 2));
                        break;
                    case 'artistic':
                        // Rainbow gradient
                        const hue = v_val * 300;
                        const sat = 0.8;
                        const light = 0.3 + v_val * 0.5;
                        const c = (1 - Math.abs(2 * light - 1)) * sat;
                        const x = c * (1 - Math.abs((hue / 60) % 2 - 1));
                        const m = light - c / 2;
                        if (hue < 60) { r = c; g = x; b = 0; }
                        else if (hue < 120) { r = x; g = c; b = 0; }
                        else if (hue < 180) { r = 0; g = c; b = x; }
                        else if (hue < 240) { r = 0; g = x; b = c; }
                        else if (hue < 300) { r = x; g = 0; b = c; }
                        else { r = c; g = 0; b = x; }
                        r = (r + m) * 255;
                        g = (g + m) * 255;
                        b = (b + m) * 255;
                        break;
                    case 'monochrome':
                        // Black and white
                        const intensity = v_val * 255;
                        r = intensity;
                        g = intensity;
                        b = intensity;
                        break;
                }

                data[i * 4 + 0] = r + u_val * 10;
                data[i * 4 + 1] = g + u_val * 10;
                data[i * 4 + 2] = b + u_val * 10;
                data[i * 4 + 3] = 255;
            }

            mainCtx.putImageData(imageData, 0, 0);
        }

        // Render parameter space diagram
        function renderParameterSpace() {
            const width = paramCanvas.width;
            const height = paramCanvas.height;

            // Create gradient showing different pattern regions
            const imageData = paramCtx.createImageData(width, height);
            const data = imageData.data;

            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    const F = 0.01 + (x / width) * (0.08 - 0.01);
                    const K = 0.045 + ((height - y) / height) * (0.07 - 0.045);

                    // Color regions based on known patterns
                    let r, g, b;
                    if (K > 0.064) {
                        r = 100; g = 50; b = 150; // High K - holes
                    } else if (F < 0.02) {
                        r = 150; g = 50; b = 100; // Low F - spirals/waves
                    } else if (F < 0.04 && K < 0.06) {
                        r = 50; g = 150; b = 100; // Stripes/maze
                    } else if (F > 0.05) {
                        r = 150; g = 100; b = 50; // High F - spots
                    } else {
                        r = 80; g = 80; b = 120; // Middle region
                    }

                    const idx = (y * width + x) * 4;
                    data[idx + 0] = r;
                    data[idx + 1] = g;
                    data[idx + 2] = b;
                    data[idx + 3] = 255;
                }
            }

            paramCtx.putImageData(imageData, 0, 0);
        }

        // Update parameter space indicator
        function updateParameterSpace() {
            const space = document.getElementById('param-space');
            const pos = document.getElementById('current-pos');

            const x = ((params.F - 0.01) / (0.08 - 0.01)) * space.clientWidth;
            const y = space.clientHeight - ((params.K - 0.045) / (0.07 - 0.045)) * space.clientHeight;

            pos.style.left = x + 'px';
            pos.style.top = y + 'px';
        }

        // Animation loop
        function animate(currentTime) {
            requestAnimationFrame(animate);

            frameCount++;
            if (currentTime - lastFpsUpdate > 1000) {
                fps = Math.round(frameCount * 1000 / (currentTime - lastFpsUpdate));
                frameCount = 0;
                lastFpsUpdate = currentTime;
                document.getElementById('fps').textContent = fps;
            }

            if (!paused) {
                for (let i = 0; i < 10; i++) {
                    update();
                }
                render();
                document.getElementById('iterations').textContent = iterations;
            }
        }

        // Mouse interaction on main canvas
        let isMouseDown = false;

        mainCanvas.addEventListener('mousedown', (e) => {
            isMouseDown = true;
            handleMousePaint(e);
        });

        mainCanvas.addEventListener('mousemove', (e) => {
            if (isMouseDown) {
                handleMousePaint(e);
            }
        });

        mainCanvas.addEventListener('mouseup', () => {
            isMouseDown = false;
        });

        mainCanvas.addEventListener('mouseleave', () => {
            isMouseDown = false;
        });

        function handleMousePaint(e) {
            const rect = mainCanvas.getBoundingClientRect();
            const x = Math.floor((e.clientX - rect.left) * SIZE / rect.width);
            const y = Math.floor((e.clientY - rect.top) * SIZE / rect.height);

            for (let dy = -brushSize; dy <= brushSize; dy++) {
                for (let dx = -brushSize; dx <= brushSize; dx++) {
                    if (dx*dx + dy*dy <= brushSize*brushSize) {
                        const px = (x + dx + SIZE) % SIZE;
                        const py = (y + dy + SIZE) % SIZE;
                        const idx = py * SIZE + px;

                        if (brushMode === 'add') {
                            v[idx] = 1.0;
                            u[idx] = 0.0;
                        } else {
                            v[idx] = 0.0;
                            u[idx] = 1.0;
                        }
                    }
                }
            }
        }

        // Parameter space interaction
        document.getElementById('param-space').addEventListener('click', (e) => {
            const rect = e.target.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            params.F = 0.01 + (x / rect.width) * (0.08 - 0.01);
            params.K = 0.045 + ((rect.height - y) / rect.height) * (0.07 - 0.045);

            document.getElementById('feed-rate').value = params.F;
            document.getElementById('kill-rate').value = params.K;
            document.getElementById('f-value').textContent = params.F.toFixed(4);
            document.getElementById('k-value').textContent = params.K.toFixed(4);

            updateParameterSpace();
            findClosestPreset();
            reset();
        });

        // Controls
        document.getElementById('feed-rate').addEventListener('input', (e) => {
            params.F = parseFloat(e.target.value);
            document.getElementById('f-value').textContent = params.F.toFixed(4);
            updateParameterSpace();
            findClosestPreset();
        });

        document.getElementById('kill-rate').addEventListener('input', (e) => {
            params.K = parseFloat(e.target.value);
            document.getElementById('k-value').textContent = params.K.toFixed(4);
            updateParameterSpace();
            findClosestPreset();
        });

        document.getElementById('brush-size').addEventListener('input', (e) => {
            brushSize = parseInt(e.target.value);
            document.getElementById('brush-value').textContent = brushSize;
        });

        function togglePause() {
            paused = !paused;
        }

        function loadPreset(preset) {
            const p = presets[preset];
            params.F = p.F;
            params.K = p.K;
            currentPattern = p.name;

            document.getElementById('feed-rate').value = params.F;
            document.getElementById('kill-rate').value = params.K;
            document.getElementById('f-value').textContent = params.F.toFixed(4);
            document.getElementById('k-value').textContent = params.K.toFixed(4);
            document.getElementById('pattern-name').textContent = currentPattern;

            updateParameterSpace();
            reset();
        }

        function setColorScheme(scheme) {
            colorScheme = scheme;
            const schemeName = scheme.charAt(0).toUpperCase() + scheme.slice(1);
            document.getElementById('color-scheme-display').textContent = schemeName;
        }

        function setBrushMode(mode) {
            brushMode = mode;
        }

        function saveState() {
            savedState = {
                u: new Float32Array(u),
                v: new Float32Array(v),
                params: { ...params },
                iterations: iterations
            };
            alert('Pattern state saved!');
        }

        function loadState() {
            if (savedState) {
                u.set(savedState.u);
                v.set(savedState.v);
                params = { ...savedState.params };
                iterations = savedState.iterations;

                document.getElementById('feed-rate').value = params.F;
                document.getElementById('kill-rate').value = params.K;
                document.getElementById('f-value').textContent = params.F.toFixed(4);
                document.getElementById('k-value').textContent = params.K.toFixed(4);

                updateParameterSpace();
                render();
                alert('Pattern state loaded!');
            } else {
                alert('No saved state found!');
            }
        }

        // Initialize
        renderParameterSpace();
        reset();
        updateParameterSpace();
        animate(0);
    </script>
</body>
</html>
