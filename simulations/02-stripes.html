<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gray-Scott Stripes Pattern - Reaction-Diffusion</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #2c1810 0%, #1a0f0a 100%);
            color: #fff;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            display: flex;
            gap: 20px;
            padding: 20px;
            max-width: 1400px;
        }

        .canvas-container {
            position: relative;
            background: #000;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(255, 140, 0, 0.3);
            overflow: hidden;
        }

        canvas {
            display: block;
            cursor: crosshair;
        }

        .info-panel {
            background: rgba(44, 24, 16, 0.95);
            border-radius: 12px;
            padding: 20px;
            width: 320px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            max-height: 90vh;
            overflow-y: auto;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #ff8c00, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        h2 {
            font-size: 18px;
            margin-top: 20px;
            margin-bottom: 10px;
            color: #ff8c00;
        }

        .description {
            font-size: 14px;
            line-height: 1.6;
            color: #bbb;
            margin-bottom: 20px;
        }

        .control-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: #aaa;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #333;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #ff8c00;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(255, 140, 0, 0.5);
        }

        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #ff8c00;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(255, 140, 0, 0.5);
        }

        .value-display {
            display: inline-block;
            float: right;
            color: #ff8c00;
            font-weight: bold;
        }

        button {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #ff8c00, #ff6b00);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(255, 140, 0, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(255, 140, 0, 0.5);
        }

        button:active {
            transform: translateY(0);
        }

        .stats {
            font-size: 12px;
            color: #888;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #333;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .preset-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 20px;
        }

        .preset-buttons button {
            padding: 8px;
            font-size: 12px;
        }

        .orientation-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            margin-bottom: 20px;
        }

        .orientation-buttons button {
            padding: 8px;
            font-size: 11px;
        }

        .example-images {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .example-box {
            background: #1a1a1a;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-size: 11px;
            color: #888;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="canvas-container">
            <canvas id="canvas"></canvas>
        </div>

        <div class="info-panel">
            <h1>Gray-Scott Stripes Pattern</h1>
            <p class="description">
                Parallel stripe patterns emerge naturally from reaction-diffusion dynamics.
                These patterns are analogous to zebra stripes, fish patterns, and other
                striped patterns found throughout nature.
            </p>

            <h2>Stripe Orientation</h2>
            <div class="orientation-buttons">
                <button onclick="initStripes('vertical')">Vertical</button>
                <button onclick="initStripes('horizontal')">Horizontal</button>
                <button onclick="initStripes('diagonal')">Diagonal</button>
            </div>

            <h2>Pattern Presets</h2>
            <div class="preset-buttons">
                <button onclick="loadPreset('stripes')">Stripes</button>
                <button onclick="loadPreset('thick')">Thick</button>
                <button onclick="loadPreset('thin')">Thin</button>
                <button onclick="loadPreset('wavy')">Wavy</button>
            </div>

            <h2>Parameters</h2>
            <div class="control-group">
                <label>
                    Feed Rate (F): <span class="value-display" id="f-value">0.0350</span>
                </label>
                <input type="range" id="feed-rate" min="0.01" max="0.08" step="0.0001" value="0.0350">
            </div>

            <div class="control-group">
                <label>
                    Kill Rate (K): <span class="value-display" id="k-value">0.0600</span>
                </label>
                <input type="range" id="kill-rate" min="0.045" max="0.07" step="0.0001" value="0.0600">
            </div>

            <div class="control-group">
                <label>
                    Pattern Density: <span class="value-display" id="density-value">8</span>
                </label>
                <input type="range" id="pattern-density" min="4" max="32" step="1" value="8">
            </div>

            <div class="control-group">
                <label>
                    Noise Level: <span class="value-display" id="noise-value">0.05</span>
                </label>
                <input type="range" id="noise-level" min="0" max="0.2" step="0.01" value="0.05">
            </div>

            <h2>Controls</h2>
            <button onclick="togglePause()">Pause/Resume</button>
            <button onclick="reset()">Reset</button>
            <button onclick="randomNoise()">Add Noise</button>

            <div class="stats">
                <div class="stat-row">
                    <span>FPS:</span>
                    <span id="fps">60</span>
                </div>
                <div class="stat-row">
                    <span>Iterations:</span>
                    <span id="iterations">0</span>
                </div>
                <div class="stat-row">
                    <span>Grid Size:</span>
                    <span>256×256</span>
                </div>
                <div class="stat-row">
                    <span>Current Orientation:</span>
                    <span id="orientation">Vertical</span>
                </div>
            </div>

            <h2>Natural Examples</h2>
            <div class="example-images">
                <div class="example-box">
                    <strong>Zebra Stripes</strong><br>
                    Natural camouflage and thermoregulation
                </div>
                <div class="example-box">
                    <strong>Angelfish</strong><br>
                    Vertical bands for species recognition
                </div>
                <div class="example-box">
                    <strong>Tiger Skin</strong><br>
                    Stripe patterns for camouflage
                </div>
                <div class="example-box">
                    <strong>Plant Leaves</strong><br>
                    Variegated patterns
                </div>
            </div>

            <h2>How It Works</h2>
            <p class="description">
                Stripe formation occurs when:<br><br>
                • Initial perturbations align in one direction<br>
                • Chemical V forms alternating bands<br>
                • Diffusion maintains stripe separation<br>
                • F and K values favor linear patterns<br>
                <br>
                Click and drag to disrupt existing stripes or create new patterns.
            </p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        const SIZE = 256;
        canvas.width = SIZE;
        canvas.height = SIZE;

        // Chemical concentrations
        let u = new Float32Array(SIZE * SIZE);
        let v = new Float32Array(SIZE * SIZE);
        let u_next = new Float32Array(SIZE * SIZE);
        let v_next = new Float32Array(SIZE * SIZE);

        // Parameters
        let params = {
            Du: 0.16,
            Dv: 0.08,
            F: 0.0350,
            K: 0.0600,
            dt: 1.0
        };

        let paused = false;
        let iterations = 0;
        let frameCount = 0;
        let lastFpsUpdate = 0;
        let fps = 60;
        let currentOrientation = 'vertical';
        let density = 8;
        let noiseLevel = 0.05;

        // Initialize with stripes
        function reset() {
            initStripes(currentOrientation);
            iterations = 0;
        }

        function initStripes(orientation) {
            currentOrientation = orientation;
            document.getElementById('orientation').textContent =
                orientation.charAt(0).toUpperCase() + orientation.slice(1);

            // Start with full U
            for (let i = 0; i < SIZE * SIZE; i++) {
                u[i] = 1.0;
                v[i] = 0.0;
            }

            // Create initial stripe pattern
            for (let y = 0; y < SIZE; y++) {
                for (let x = 0; x < SIZE; x++) {
                    const idx = y * SIZE + x;
                    let stripeValue = 0;

                    switch(orientation) {
                        case 'vertical':
                            stripeValue = Math.sin(x * Math.PI * 2 / density) > 0 ? 1 : 0;
                            break;
                        case 'horizontal':
                            stripeValue = Math.sin(y * Math.PI * 2 / density) > 0 ? 1 : 0;
                            break;
                        case 'diagonal':
                            stripeValue = Math.sin((x + y) * Math.PI * 2 / density) > 0 ? 1 : 0;
                            break;
                    }

                    // Add noise
                    const noise = (Math.random() - 0.5) * noiseLevel;
                    v[idx] = stripeValue * 0.5 + noise;
                    u[idx] = 1.0 - v[idx];
                }
            }
        }

        function randomNoise() {
            for (let i = 0; i < 500; i++) {
                const x = Math.floor(Math.random() * SIZE);
                const y = Math.floor(Math.random() * SIZE);
                const idx = y * SIZE + x;
                v[idx] = Math.random() * 0.5;
            }
        }

        // Calculate Laplacian using 5-point stencil
        function laplacian(arr, x, y) {
            const idx = y * SIZE + x;
            const xm1 = (x - 1 + SIZE) % SIZE;
            const xp1 = (x + 1) % SIZE;
            const ym1 = (y - 1 + SIZE) % SIZE;
            const yp1 = (y + 1) % SIZE;

            const center = arr[idx];
            const left = arr[y * SIZE + xm1];
            const right = arr[y * SIZE + xp1];
            const up = arr[ym1 * SIZE + x];
            const down = arr[yp1 * SIZE + x];

            return (left + right + up + down - 4.0 * center);
        }

        // Update reaction-diffusion
        function update() {
            const { Du, Dv, F, K, dt } = params;

            for (let y = 0; y < SIZE; y++) {
                for (let x = 0; x < SIZE; x++) {
                    const idx = y * SIZE + x;
                    const u_val = u[idx];
                    const v_val = v[idx];

                    const lap_u = laplacian(u, x, y);
                    const lap_v = laplacian(v, x, y);

                    const uvv = u_val * v_val * v_val;

                    u_next[idx] = u_val + dt * (Du * lap_u - uvv + F * (1.0 - u_val));
                    v_next[idx] = v_val + dt * (Dv * lap_v + uvv - (F + K) * v_val);

                    // Clamp values
                    u_next[idx] = Math.max(0, Math.min(1, u_next[idx]));
                    v_next[idx] = Math.max(0, Math.min(1, v_next[idx]));
                }
            }

            // Swap buffers
            [u, u_next] = [u_next, u];
            [v, v_next] = [v_next, v];

            iterations++;
        }

        // Render to canvas with orange/yellow gradient
        function render() {
            const imageData = ctx.createImageData(SIZE, SIZE);
            const data = imageData.data;

            for (let i = 0; i < SIZE * SIZE; i++) {
                const v_val = v[i];
                const u_val = u[i];

                // Orange/yellow gradient for stripes
                const intensity = v_val;

                // Create warm gradient
                data[i * 4 + 0] = 255 * intensity + u_val * 20;      // R
                data[i * 4 + 1] = 140 * intensity + u_val * 20;      // G
                data[i * 4 + 2] = 0 * intensity + u_val * 10;        // B
                data[i * 4 + 3] = 255;                                // A
            }

            ctx.putImageData(imageData, 0, 0);
        }

        // Animation loop
        function animate(currentTime) {
            requestAnimationFrame(animate);

            // Update FPS
            frameCount++;
            if (currentTime - lastFpsUpdate > 1000) {
                fps = Math.round(frameCount * 1000 / (currentTime - lastFpsUpdate));
                frameCount = 0;
                lastFpsUpdate = currentTime;
                document.getElementById('fps').textContent = fps;
            }

            if (!paused) {
                // Multiple iterations per frame
                for (let i = 0; i < 10; i++) {
                    update();
                }
                render();
                document.getElementById('iterations').textContent = iterations;
            }
        }

        // Mouse interaction
        let isMouseDown = false;

        canvas.addEventListener('mousedown', (e) => {
            isMouseDown = true;
            handleMousePaint(e);
        });

        canvas.addEventListener('mousemove', (e) => {
            if (isMouseDown) {
                handleMousePaint(e);
            }
        });

        canvas.addEventListener('mouseup', () => {
            isMouseDown = false;
        });

        canvas.addEventListener('mouseleave', () => {
            isMouseDown = false;
        });

        function handleMousePaint(e) {
            const rect = canvas.getBoundingClientRect();
            const x = Math.floor((e.clientX - rect.left) * SIZE / rect.width);
            const y = Math.floor((e.clientY - rect.top) * SIZE / rect.height);

            // Paint a circle of chemical V
            const radius = 8;
            for (let dy = -radius; dy <= radius; dy++) {
                for (let dx = -radius; dx <= radius; dx++) {
                    if (dx*dx + dy*dy <= radius*radius) {
                        const px = (x + dx + SIZE) % SIZE;
                        const py = (y + dy + SIZE) % SIZE;
                        const idx = py * SIZE + px;
                        v[idx] = 0.8;
                        u[idx] = 0.2;
                    }
                }
            }
        }

        // Controls
        document.getElementById('feed-rate').addEventListener('input', (e) => {
            params.F = parseFloat(e.target.value);
            document.getElementById('f-value').textContent = params.F.toFixed(4);
        });

        document.getElementById('kill-rate').addEventListener('input', (e) => {
            params.K = parseFloat(e.target.value);
            document.getElementById('k-value').textContent = params.K.toFixed(4);
        });

        document.getElementById('pattern-density').addEventListener('input', (e) => {
            density = parseFloat(e.target.value);
            document.getElementById('density-value').textContent = density;
        });

        document.getElementById('noise-level').addEventListener('input', (e) => {
            noiseLevel = parseFloat(e.target.value);
            document.getElementById('noise-value').textContent = noiseLevel.toFixed(2);
        });

        function togglePause() {
            paused = !paused;
        }

        function loadPreset(preset) {
            switch(preset) {
                case 'stripes':
                    params.F = 0.0350;
                    params.K = 0.0600;
                    density = 8;
                    break;
                case 'thick':
                    params.F = 0.0380;
                    params.K = 0.0610;
                    density = 12;
                    break;
                case 'thin':
                    params.F = 0.0320;
                    params.K = 0.0590;
                    density = 5;
                    break;
                case 'wavy':
                    params.F = 0.0300;
                    params.K = 0.0570;
                    density = 8;
                    break;
            }

            document.getElementById('feed-rate').value = params.F;
            document.getElementById('kill-rate').value = params.K;
            document.getElementById('pattern-density').value = density;
            document.getElementById('f-value').textContent = params.F.toFixed(4);
            document.getElementById('k-value').textContent = params.K.toFixed(4);
            document.getElementById('density-value').textContent = density;
            reset();
        }

        // Initialize
        reset();
        animate(0);
    </script>
</body>
</html>
