<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ant Colony Foraging Simulation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2d1b00 0%, #3d2a00 50%, #4d3800 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }

        .container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            max-width: 1400px;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
            background: linear-gradient(135deg, #f39c12 0%, #e74c3c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .description {
            text-align: center;
            margin-bottom: 20px;
            color: #aaa;
            line-height: 1.6;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .content {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        canvas {
            border: 2px solid #f39c12;
            border-radius: 10px;
            background: #1a1a0a;
            box-shadow: 0 0 30px rgba(243, 156, 18, 0.3);
            cursor: crosshair;
        }

        .controls {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            min-width: 300px;
            max-width: 350px;
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            margin-bottom: 5px;
            color: #f39c12;
            font-weight: 600;
        }

        .control-group input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
            -webkit-appearance: none;
        }

        .control-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #f39c12;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(243, 156, 18, 0.5);
        }

        .control-group input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #f39c12;
            cursor: pointer;
            border: none;
        }

        .value-display {
            display: inline-block;
            float: right;
            color: #fff;
            font-weight: bold;
        }

        button {
            width: 100%;
            padding: 12px;
            margin: 5px 0;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #f39c12 0%, #e74c3c 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(243, 156, 18, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .stats {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.9em;
        }

        .stats-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stats-row:last-child {
            border-bottom: none;
        }

        .stats-label {
            color: #aaa;
        }

        .stats-value {
            color: #f39c12;
            font-weight: bold;
        }

        .info-box {
            background: rgba(243, 156, 18, 0.1);
            border-left: 4px solid #f39c12;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .info-box h3 {
            color: #f39c12;
            margin-bottom: 10px;
        }

        .legend {
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 0.85em;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 5px 0;
        }

        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Ant Colony Foraging Simulation</h1>
        <p class="description">
            Watch collective intelligence emerge from simple ant behavior! Individual ants follow basic rules: search randomly
            for food, lay pheromone trails when carrying food home, and follow existing trails to food sources. Through
            stigmergy (environmental communication), the colony discovers and exploits food sources efficiently. Observe
            how pheromone trails strengthen with use and fade over time, creating dynamic pathways. Click to add new food!
        </p>

        <div class="content">
            <canvas id="canvas"></canvas>

            <div class="controls">
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #8b4513;"></div>
                        <span>Nest</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #4ade80;"></div>
                        <span>Food Source</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #3b82f6;"></div>
                        <span>To-Food Pheromone</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #f59e0b;"></div>
                        <span>To-Home Pheromone</span>
                    </div>
                </div>

                <div class="control-group">
                    <label>
                        Ant Count: <span class="value-display" id="antCountValue">100</span>
                    </label>
                    <input type="range" id="antCount" min="50" max="300" value="100" step="10">
                </div>

                <div class="control-group">
                    <label>
                        Ant Speed: <span class="value-display" id="antSpeedValue">1.5</span>
                    </label>
                    <input type="range" id="antSpeed" min="0.5" max="3.0" value="1.5" step="0.1">
                </div>

                <div class="control-group">
                    <label>
                        Pheromone Strength: <span class="value-display" id="pheromoneStrengthValue">100</span>
                    </label>
                    <input type="range" id="pheromoneStrength" min="50" max="200" value="100" step="10">
                </div>

                <div class="control-group">
                    <label>
                        Evaporation Rate: <span class="value-display" id="evaporationValue">0.995</span>
                    </label>
                    <input type="range" id="evaporation" min="0.98" max="0.999" value="0.995" step="0.001">
                </div>

                <div class="control-group">
                    <label>
                        Food Sources: <span class="value-display" id="foodCountValue">5</span>
                    </label>
                    <input type="range" id="foodCount" min="1" max="10" value="5" step="1">
                </div>

                <button class="btn-primary" id="pauseBtn">Pause</button>
                <button class="btn-secondary" id="resetBtn">Reset</button>

                <div class="stats">
                    <div class="stats-row">
                        <span class="stats-label">FPS:</span>
                        <span class="stats-value" id="fps">60</span>
                    </div>
                    <div class="stats-row">
                        <span class="stats-label">Active Ants:</span>
                        <span class="stats-value" id="activeAnts">100</span>
                    </div>
                    <div class="stats-row">
                        <span class="stats-label">Food Collected:</span>
                        <span class="stats-value" id="foodCollected">0</span>
                    </div>
                    <div class="stats-row">
                        <span class="stats-label">Active Trails:</span>
                        <span class="stats-value" id="activeTrails">0</span>
                    </div>
                </div>

                <div class="info-box">
                    <h3>Swarm Intelligence</h3>
                    <p><strong>Stigmergy:</strong> Communication through environment modification</p>
                    <p><strong>Trail Following:</strong> Ants prefer paths with strong pheromones</p>
                    <p><strong>Emergent Optimization:</strong> Shortest paths naturally emerge</p>
                    <p style="margin-top: 10px; font-style: italic;">
                        Click canvas to add food sources!
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        const WIDTH = 900;
        const HEIGHT = 900;
        canvas.width = WIDTH;
        canvas.height = HEIGHT;

        const GRID_SIZE = 5;
        const COLS = Math.ceil(WIDTH / GRID_SIZE);
        const ROWS = Math.ceil(HEIGHT / GRID_SIZE);

        let params = {
            antCount: 100,
            antSpeed: 1.5,
            pheromoneStrength: 100,
            evaporation: 0.995,
            foodCount: 5
        };

        let paused = false;
        let foodCollected = 0;

        // Pheromone grids
        let toFoodPheromone = Array(ROWS).fill(null).map(() => Array(COLS).fill(0));
        let toHomePheromone = Array(ROWS).fill(null).map(() => Array(COLS).fill(0));

        // Nest and food
        const nest = { x: WIDTH / 2, y: HEIGHT / 2, radius: 30 };
        let foodSources = [];

        class Ant {
            constructor() {
                this.position = { x: nest.x, y: nest.y };
                this.angle = Math.random() * Math.PI * 2;
                this.hasFood = false;
                this.wanderAngle = this.angle;
            }

            update() {
                if (this.hasFood) {
                    // Return to nest
                    const dx = nest.x - this.position.x;
                    const dy = nest.y - this.position.y;
                    const targetAngle = Math.atan2(dy, dx);

                    // Also check pheromones
                    const pheromoneAngle = this.sensePheromone(toFoodPheromone);
                    if (pheromoneAngle !== null) {
                        this.angle = pheromoneAngle;
                    } else {
                        this.angle = targetAngle;
                    }

                    // Drop to-home pheromone
                    this.dropPheromone(toHomePheromone);

                    // Check if reached nest
                    const distToNest = Math.sqrt(dx * dx + dy * dy);
                    if (distToNest < nest.radius) {
                        this.hasFood = false;
                        foodCollected++;
                    }
                } else {
                    // Search for food
                    const pheromoneAngle = this.sensePheromone(toHomePheromone);

                    if (pheromoneAngle !== null) {
                        // Follow pheromone trail
                        this.angle = pheromoneAngle;
                    } else {
                        // Wander
                        this.wanderAngle += (Math.random() - 0.5) * 0.5;
                        this.angle += (this.wanderAngle - this.angle) * 0.1;
                    }

                    // Check for food
                    for (let food of foodSources) {
                        const dx = food.x - this.position.x;
                        const dy = food.y - this.position.y;
                        const dist = Math.sqrt(dx * dx + dy * dy);

                        if (dist < food.radius && food.amount > 0) {
                            this.hasFood = true;
                            food.amount--;
                            break;
                        }
                    }

                    // Drop to-food pheromone
                    this.dropPheromone(toFoodPheromone);
                }

                // Move forward
                this.position.x += Math.cos(this.angle) * params.antSpeed;
                this.position.y += Math.sin(this.angle) * params.antSpeed;

                // Boundary bouncing
                if (this.position.x < 0 || this.position.x > WIDTH) {
                    this.angle = Math.PI - this.angle;
                    this.position.x = Math.max(0, Math.min(WIDTH, this.position.x));
                }
                if (this.position.y < 0 || this.position.y > HEIGHT) {
                    this.angle = -this.angle;
                    this.position.y = Math.max(0, Math.min(HEIGHT, this.position.y));
                }
            }

            sensePheromone(grid) {
                const sensorDist = 15;
                const sensorAngle = 0.4;

                const col = Math.floor(this.position.x / GRID_SIZE);
                const row = Math.floor(this.position.y / GRID_SIZE);

                // Sample three points
                const left = this.samplePheromone(
                    grid,
                    this.position.x + Math.cos(this.angle - sensorAngle) * sensorDist,
                    this.position.y + Math.sin(this.angle - sensorAngle) * sensorDist
                );

                const forward = this.samplePheromone(
                    grid,
                    this.position.x + Math.cos(this.angle) * sensorDist,
                    this.position.y + Math.sin(this.angle) * sensorDist
                );

                const right = this.samplePheromone(
                    grid,
                    this.position.x + Math.cos(this.angle + sensorAngle) * sensorDist,
                    this.position.y + Math.sin(this.angle + sensorAngle) * sensorDist
                );

                // Turn toward strongest
                if (forward > left && forward > right) {
                    return this.angle;
                } else if (left > right) {
                    return this.angle - 0.2;
                } else if (right > left) {
                    return this.angle + 0.2;
                }

                return null;
            }

            samplePheromone(grid, x, y) {
                const col = Math.floor(x / GRID_SIZE);
                const row = Math.floor(y / GRID_SIZE);

                if (row >= 0 && row < ROWS && col >= 0 && col < COLS) {
                    return grid[row][col];
                }
                return 0;
            }

            dropPheromone(grid) {
                const col = Math.floor(this.position.x / GRID_SIZE);
                const row = Math.floor(this.position.y / GRID_SIZE);

                if (row >= 0 && row < ROWS && col >= 0 && col < COLS) {
                    grid[row][col] = Math.min(grid[row][col] + params.pheromoneStrength, 255);
                }
            }

            draw(ctx) {
                ctx.fillStyle = this.hasFood ? '#fbbf24' : '#000000';
                ctx.strokeStyle = this.hasFood ? '#f59e0b' : '#666666';
                ctx.lineWidth = 1;

                ctx.beginPath();
                ctx.arc(this.position.x, this.position.y, 3, 0, Math.PI * 2);
                ctx.fill();
                ctx.stroke();
            }
        }

        let ants = [];

        function initSimulation() {
            ants = [];
            for (let i = 0; i < params.antCount; i++) {
                ants.push(new Ant());
            }

            foodSources = [];
            for (let i = 0; i < params.foodCount; i++) {
                foodSources.push({
                    x: Math.random() * (WIDTH - 100) + 50,
                    y: Math.random() * (HEIGHT - 100) + 50,
                    radius: 20,
                    amount: 500
                });
            }

            // Clear pheromones
            toFoodPheromone = Array(ROWS).fill(null).map(() => Array(COLS).fill(0));
            toHomePheromone = Array(ROWS).fill(null).map(() => Array(COLS).fill(0));
            foodCollected = 0;
        }

        initSimulation();

        let lastTime = performance.now();
        let fps = 60;

        function updateFPS() {
            const now = performance.now();
            const delta = now - lastTime;
            fps = Math.round(1000 / delta);
            lastTime = now;
            document.getElementById('fps').textContent = fps;
        }

        function drawPheromones() {
            // Draw pheromone heatmap
            for (let row = 0; row < ROWS; row++) {
                for (let col = 0; col < COLS; col++) {
                    const toFood = toFoodPheromone[row][col];
                    const toHome = toHomePheromone[row][col];

                    if (toFood > 1) {
                        ctx.fillStyle = `rgba(59, 130, 246, ${Math.min(toFood / 255, 0.5)})`;
                        ctx.fillRect(col * GRID_SIZE, row * GRID_SIZE, GRID_SIZE, GRID_SIZE);
                    }

                    if (toHome > 1) {
                        ctx.fillStyle = `rgba(245, 158, 11, ${Math.min(toHome / 255, 0.5)})`;
                        ctx.fillRect(col * GRID_SIZE, row * GRID_SIZE, GRID_SIZE, GRID_SIZE);
                    }
                }
            }
        }

        function evaporatePheromones() {
            for (let row = 0; row < ROWS; row++) {
                for (let col = 0; col < COLS; col++) {
                    toFoodPheromone[row][col] *= params.evaporation;
                    toHomePheromone[row][col] *= params.evaporation;
                }
            }
        }

        function countActiveTrails() {
            let count = 0;
            for (let row = 0; row < ROWS; row++) {
                for (let col = 0; col < COLS; col++) {
                    if (toFoodPheromone[row][col] > 10 || toHomePheromone[row][col] > 10) {
                        count++;
                    }
                }
            }
            return count;
        }

        function animate() {
            if (!paused) {
                // Clear canvas
                ctx.fillStyle = '#1a1a0a';
                ctx.fillRect(0, 0, WIDTH, HEIGHT);

                // Draw pheromones
                drawPheromones();

                // Evaporate pheromones
                evaporatePheromones();

                // Draw nest
                ctx.fillStyle = '#8b4513';
                ctx.strokeStyle = '#654321';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(nest.x, nest.y, nest.radius, 0, Math.PI * 2);
                ctx.fill();
                ctx.stroke();

                // Draw food sources
                foodSources.forEach(food => {
                    if (food.amount > 0) {
                        ctx.fillStyle = '#4ade80';
                        ctx.strokeStyle = '#22c55e';
                        ctx.lineWidth = 2;
                        ctx.beginPath();
                        ctx.arc(food.x, food.y, food.radius, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.stroke();

                        // Show amount
                        ctx.fillStyle = '#fff';
                        ctx.font = '12px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText(food.amount, food.x, food.y + 4);
                    }
                });

                // Update and draw ants
                ants.forEach(ant => {
                    ant.update();
                    ant.draw(ctx);
                });

                // Update stats
                document.getElementById('activeAnts').textContent = ants.length;
                document.getElementById('foodCollected').textContent = foodCollected;
                document.getElementById('activeTrails').textContent = countActiveTrails();

                updateFPS();
            }

            requestAnimationFrame(animate);
        }

        // Event listeners
        document.getElementById('antCount').addEventListener('input', (e) => {
            params.antCount = parseInt(e.target.value);
            document.getElementById('antCountValue').textContent = params.antCount;

            while (ants.length < params.antCount) {
                ants.push(new Ant());
            }
            while (ants.length > params.antCount) {
                ants.pop();
            }
        });

        document.getElementById('antSpeed').addEventListener('input', (e) => {
            params.antSpeed = parseFloat(e.target.value);
            document.getElementById('antSpeedValue').textContent = params.antSpeed.toFixed(1);
        });

        document.getElementById('pheromoneStrength').addEventListener('input', (e) => {
            params.pheromoneStrength = parseInt(e.target.value);
            document.getElementById('pheromoneStrengthValue').textContent = params.pheromoneStrength;
        });

        document.getElementById('evaporation').addEventListener('input', (e) => {
            params.evaporation = parseFloat(e.target.value);
            document.getElementById('evaporationValue').textContent = params.evaporation.toFixed(3);
        });

        document.getElementById('foodCount').addEventListener('input', (e) => {
            params.foodCount = parseInt(e.target.value);
            document.getElementById('foodCountValue').textContent = params.foodCount;
        });

        document.getElementById('pauseBtn').addEventListener('click', () => {
            paused = !paused;
            document.getElementById('pauseBtn').textContent = paused ? 'Resume' : 'Pause';
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            initSimulation();
        });

        // Click to add food
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            foodSources.push({
                x: x,
                y: y,
                radius: 20,
                amount: 500
            });
        });

        animate();
    </script>
</body>
</html>
