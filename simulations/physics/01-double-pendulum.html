<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Double Pendulum - Chaos Demonstration</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
        }

        h1 {
            margin-bottom: 10px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .description {
            text-align: center;
            max-width: 800px;
            margin-bottom: 20px;
            line-height: 1.6;
            opacity: 0.9;
        }

        .equation {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }

        canvas {
            background: #0a0a0a;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            margin-bottom: 20px;
        }

        .controls {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            max-width: 1200px;
            width: 100%;
            backdrop-filter: blur(10px);
        }

        .control-group {
            display: flex;
            flex-direction: column;
        }

        label {
            margin-bottom: 5px;
            font-weight: 500;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.3);
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        button {
            padding: 12px 24px;
            background: #667eea;
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        button:hover {
            background: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .button-group {
            display: flex;
            gap: 10px;
            grid-column: 1 / -1;
            justify-content: center;
        }

        .stats {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            font-size: 14px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
        }

        .stat-label {
            opacity: 0.7;
            font-size: 12px;
        }

        .stat-value {
            font-size: 18px;
            font-weight: 600;
            margin-top: 3px;
        }
    </style>
</head>
<body>
    <h1>Double Pendulum - Chaos Demonstration</h1>

    <div class="description">
        <p>
            <strong>The Butterfly Effect in Action:</strong> Two identical pendulums starting with a 0.1% difference in initial angle
            will diverge dramatically over time, demonstrating sensitive dependence on initial conditions - a hallmark of chaotic systems.
        </p>
        <div class="equation">
            Lagrangian Mechanics: L = T - V | T = ½m₁v₁² + ½m₂v₂² | V = -m₁gy₁ - m₂gy₂
        </div>
    </div>

    <canvas id="canvas"></canvas>

    <div class="controls">
        <div class="control-group">
            <label>Length 1: <span id="length1-value">150</span> px</label>
            <input type="range" id="length1" min="50" max="250" value="150" step="10">
        </div>
        <div class="control-group">
            <label>Length 2: <span id="length2-value">150</span> px</label>
            <input type="range" id="length2" min="50" max="250" value="150" step="10">
        </div>
        <div class="control-group">
            <label>Mass 1: <span id="mass1-value">10</span> kg</label>
            <input type="range" id="mass1" min="1" max="20" value="10" step="1">
        </div>
        <div class="control-group">
            <label>Mass 2: <span id="mass2-value">10</span> kg</label>
            <input type="range" id="mass2" min="1" max="20" value="10" step="1">
        </div>
        <div class="control-group">
            <label>Gravity: <span id="gravity-value">1.0</span> m/s²</label>
            <input type="range" id="gravity" min="0.1" max="3.0" value="1.0" step="0.1">
        </div>
        <div class="control-group">
            <label>Initial Angle 1: <span id="angle1-value">90</span>°</label>
            <input type="range" id="angle1" min="0" max="180" value="90" step="1">
        </div>
        <div class="control-group">
            <label>Initial Angle 2: <span id="angle2-value">90</span>°</label>
            <input type="range" id="angle2" min="0" max="180" value="90" step="1">
        </div>
        <div class="control-group">
            <label>Speed: <span id="speed-value">1.0</span>x</label>
            <input type="range" id="speed" min="0.1" max="3.0" value="1.0" step="0.1">
        </div>

        <div class="stats">
            <div class="stat-item">
                <span class="stat-label">Total Energy (Blue)</span>
                <span class="stat-value" id="energy1">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Total Energy (Red)</span>
                <span class="stat-value" id="energy2">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Angular Divergence</span>
                <span class="stat-value" id="divergence">0°</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Time Elapsed</span>
                <span class="stat-value" id="time">0.0s</span>
            </div>
        </div>

        <div class="button-group">
            <button id="pauseBtn">Pause</button>
            <button id="resetBtn">Reset</button>
            <button id="clearBtn">Clear Trails</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 1200;
        canvas.height = 700;

        // Simulation state
        let paused = false;
        let timeElapsed = 0;
        const originX = canvas.width / 2;
        const originY = 150;

        // Pendulum 1 (Blue)
        let pendulum1 = {
            theta1: Math.PI / 2,
            theta2: Math.PI / 2,
            omega1: 0,
            omega2: 0,
            l1: 150,
            l2: 150,
            m1: 10,
            m2: 10,
            trail: [],
            color: '#00d4ff'
        };

        // Pendulum 2 (Red) - slightly different initial condition
        let pendulum2 = {
            theta1: Math.PI / 2 * 1.001, // 0.1% difference
            theta2: Math.PI / 2,
            omega1: 0,
            omega2: 0,
            l1: 150,
            l2: 150,
            m1: 10,
            m2: 10,
            trail: [],
            color: '#ff0055'
        };

        let g = 1.0; // gravity
        let speed = 1.0;

        // Trail management
        const maxTrailLength = 500;

        // Update pendulum using RK4 integration for accuracy
        function updatePendulum(p, dt) {
            const { theta1, theta2, omega1, omega2, l1, l2, m1, m2 } = p;

            // Derivatives function for double pendulum (Lagrangian mechanics)
            function derivatives(th1, th2, om1, om2) {
                const delta = th2 - th1;
                const den1 = (m1 + m2) * l1 - m2 * l1 * Math.cos(delta) * Math.cos(delta);
                const den2 = (l2 / l1) * den1;

                const dtheta1 = om1;
                const dtheta2 = om2;

                const domega1 = (m2 * l1 * om1 * om1 * Math.sin(delta) * Math.cos(delta) +
                               m2 * g * Math.sin(th2) * Math.cos(delta) +
                               m2 * l2 * om2 * om2 * Math.sin(delta) -
                               (m1 + m2) * g * Math.sin(th1)) / den1;

                const domega2 = (-m2 * l2 * om2 * om2 * Math.sin(delta) * Math.cos(delta) +
                               (m1 + m2) * (g * Math.sin(th1) * Math.cos(delta) -
                                           l1 * om1 * om1 * Math.sin(delta) -
                                           g * Math.sin(th2))) / den2;

                return [dtheta1, dtheta2, domega1, domega2];
            }

            // RK4 integration
            const k1 = derivatives(theta1, theta2, omega1, omega2);
            const k2 = derivatives(
                theta1 + 0.5 * dt * k1[0],
                theta2 + 0.5 * dt * k1[1],
                omega1 + 0.5 * dt * k1[2],
                omega2 + 0.5 * dt * k1[3]
            );
            const k3 = derivatives(
                theta1 + 0.5 * dt * k2[0],
                theta2 + 0.5 * dt * k2[1],
                omega1 + 0.5 * dt * k2[2],
                omega2 + 0.5 * dt * k2[3]
            );
            const k4 = derivatives(
                theta1 + dt * k3[0],
                theta2 + dt * k3[1],
                omega1 + dt * k3[2],
                omega2 + dt * k3[3]
            );

            p.theta1 += (dt / 6) * (k1[0] + 2 * k2[0] + 2 * k3[0] + k4[0]);
            p.theta2 += (dt / 6) * (k1[1] + 2 * k2[1] + 2 * k3[1] + k4[1]);
            p.omega1 += (dt / 6) * (k1[2] + 2 * k2[2] + 2 * k3[2] + k4[2]);
            p.omega2 += (dt / 6) * (k1[3] + 2 * k2[3] + 2 * k3[3] + k4[3]);
        }

        // Calculate positions
        function getPositions(p) {
            const x1 = originX + p.l1 * Math.sin(p.theta1);
            const y1 = originY + p.l1 * Math.cos(p.theta1);
            const x2 = x1 + p.l2 * Math.sin(p.theta2);
            const y2 = y1 + p.l2 * Math.cos(p.theta2);
            return { x1, y1, x2, y2 };
        }

        // Calculate total energy
        function calculateEnergy(p) {
            const pos = getPositions(p);
            const v1x = p.l1 * p.omega1 * Math.cos(p.theta1);
            const v1y = p.l1 * p.omega1 * Math.sin(p.theta1);
            const v2x = v1x + p.l2 * p.omega2 * Math.cos(p.theta2);
            const v2y = v1y + p.l2 * p.omega2 * Math.sin(p.theta2);

            const KE = 0.5 * p.m1 * (v1x * v1x + v1y * v1y) +
                       0.5 * p.m2 * (v2x * v2x + v2y * v2y);
            const PE = -p.m1 * g * (pos.y1 - originY) -
                       p.m2 * g * (pos.y2 - originY);

            return KE + PE;
        }

        // Draw pendulum
        function drawPendulum(p) {
            const pos = getPositions(p);

            // Draw trail
            ctx.strokeStyle = p.color;
            ctx.lineWidth = 2;
            ctx.globalAlpha = 0.6;
            ctx.beginPath();
            for (let i = 1; i < p.trail.length; i++) {
                const alpha = i / p.trail.length;
                ctx.globalAlpha = alpha * 0.6;
                ctx.moveTo(p.trail[i - 1].x, p.trail[i - 1].y);
                ctx.lineTo(p.trail[i].x, p.trail[i].y);
            }
            ctx.stroke();
            ctx.globalAlpha = 1;

            // Draw rods
            ctx.strokeStyle = p.color;
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(originX, originY);
            ctx.lineTo(pos.x1, pos.y1);
            ctx.lineTo(pos.x2, pos.y2);
            ctx.stroke();

            // Draw masses
            ctx.fillStyle = p.color;
            ctx.beginPath();
            ctx.arc(pos.x1, pos.y1, Math.sqrt(p.m1) * 3, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(pos.x2, pos.y2, Math.sqrt(p.m2) * 3, 0, Math.PI * 2);
            ctx.fill();

            // Draw origin
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(originX, originY, 5, 0, Math.PI * 2);
            ctx.fill();
        }

        // Animation loop
        function animate() {
            // Semi-transparent background for trail fade effect
            ctx.fillStyle = 'rgba(10, 10, 10, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            if (!paused) {
                const dt = 0.05 * speed;

                // Update both pendulums
                updatePendulum(pendulum1, dt);
                updatePendulum(pendulum2, dt);

                // Add to trails
                const pos1 = getPositions(pendulum1);
                const pos2 = getPositions(pendulum2);

                pendulum1.trail.push({ x: pos1.x2, y: pos1.y2 });
                pendulum2.trail.push({ x: pos2.x2, y: pos2.y2 });

                if (pendulum1.trail.length > maxTrailLength) pendulum1.trail.shift();
                if (pendulum2.trail.length > maxTrailLength) pendulum2.trail.shift();

                timeElapsed += dt;

                // Update stats
                const energy1 = calculateEnergy(pendulum1);
                const energy2 = calculateEnergy(pendulum2);
                const divergence = Math.abs(pendulum1.theta2 - pendulum2.theta2) * 180 / Math.PI;

                document.getElementById('energy1').textContent = energy1.toFixed(2);
                document.getElementById('energy2').textContent = energy2.toFixed(2);
                document.getElementById('divergence').textContent = divergence.toFixed(2) + '°';
                document.getElementById('time').textContent = timeElapsed.toFixed(1) + 's';
            }

            // Draw both pendulums
            drawPendulum(pendulum1);
            drawPendulum(pendulum2);

            requestAnimationFrame(animate);
        }

        // Controls
        document.getElementById('length1').addEventListener('input', (e) => {
            const val = parseFloat(e.target.value);
            pendulum1.l1 = pendulum2.l1 = val;
            document.getElementById('length1-value').textContent = val;
        });

        document.getElementById('length2').addEventListener('input', (e) => {
            const val = parseFloat(e.target.value);
            pendulum1.l2 = pendulum2.l2 = val;
            document.getElementById('length2-value').textContent = val;
        });

        document.getElementById('mass1').addEventListener('input', (e) => {
            const val = parseFloat(e.target.value);
            pendulum1.m1 = pendulum2.m1 = val;
            document.getElementById('mass1-value').textContent = val;
        });

        document.getElementById('mass2').addEventListener('input', (e) => {
            const val = parseFloat(e.target.value);
            pendulum1.m2 = pendulum2.m2 = val;
            document.getElementById('mass2-value').textContent = val;
        });

        document.getElementById('gravity').addEventListener('input', (e) => {
            g = parseFloat(e.target.value);
            document.getElementById('gravity-value').textContent = g.toFixed(1);
        });

        document.getElementById('angle1').addEventListener('input', (e) => {
            const val = parseFloat(e.target.value);
            const rad = val * Math.PI / 180;
            pendulum1.theta1 = rad;
            pendulum2.theta1 = rad * 1.001; // 0.1% difference
            document.getElementById('angle1-value').textContent = val;
        });

        document.getElementById('angle2').addEventListener('input', (e) => {
            const val = parseFloat(e.target.value);
            const rad = val * Math.PI / 180;
            pendulum1.theta2 = pendulum2.theta2 = rad;
            document.getElementById('angle2-value').textContent = val;
        });

        document.getElementById('speed').addEventListener('input', (e) => {
            speed = parseFloat(e.target.value);
            document.getElementById('speed-value').textContent = speed.toFixed(1);
        });

        document.getElementById('pauseBtn').addEventListener('click', () => {
            paused = !paused;
            document.getElementById('pauseBtn').textContent = paused ? 'Resume' : 'Pause';
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            const angle1 = parseFloat(document.getElementById('angle1').value) * Math.PI / 180;
            const angle2 = parseFloat(document.getElementById('angle2').value) * Math.PI / 180;

            pendulum1.theta1 = angle1;
            pendulum1.theta2 = angle2;
            pendulum1.omega1 = 0;
            pendulum1.omega2 = 0;
            pendulum1.trail = [];

            pendulum2.theta1 = angle1 * 1.001; // 0.1% difference
            pendulum2.theta2 = angle2;
            pendulum2.omega1 = 0;
            pendulum2.omega2 = 0;
            pendulum2.trail = [];

            timeElapsed = 0;
            ctx.fillStyle = 'rgba(10, 10, 10, 1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        });

        document.getElementById('clearBtn').addEventListener('click', () => {
            pendulum1.trail = [];
            pendulum2.trail = [];
            ctx.fillStyle = 'rgba(10, 10, 10, 1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        });

        // Start animation
        animate();
    </script>
</body>
</html>