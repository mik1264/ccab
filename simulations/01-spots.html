<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gray-Scott Spots Pattern - Reaction-Diffusion</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #0f0f1e 100%);
            color: #fff;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            display: flex;
            gap: 20px;
            padding: 20px;
            max-width: 1400px;
        }

        .canvas-container {
            position: relative;
            background: #000;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(138, 43, 226, 0.3);
            overflow: hidden;
        }

        canvas {
            display: block;
            cursor: crosshair;
        }

        .info-panel {
            background: rgba(26, 26, 46, 0.95);
            border-radius: 12px;
            padding: 20px;
            width: 320px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            max-height: 90vh;
            overflow-y: auto;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #9b59b6, #e74c3c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        h2 {
            font-size: 18px;
            margin-top: 20px;
            margin-bottom: 10px;
            color: #9b59b6;
        }

        .description {
            font-size: 14px;
            line-height: 1.6;
            color: #bbb;
            margin-bottom: 20px;
        }

        .control-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: #aaa;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #333;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #9b59b6;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(155, 89, 182, 0.5);
        }

        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #9b59b6;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(155, 89, 182, 0.5);
        }

        .value-display {
            display: inline-block;
            float: right;
            color: #9b59b6;
            font-weight: bold;
        }

        button {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(155, 89, 182, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(155, 89, 182, 0.5);
        }

        button:active {
            transform: translateY(0);
        }

        .stats {
            font-size: 12px;
            color: #888;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #333;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .parameter-space {
            width: 100%;
            height: 150px;
            background: #1a1a2e;
            border-radius: 8px;
            margin-top: 10px;
            position: relative;
            border: 1px solid #333;
        }

        .current-position {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #9b59b6;
            border-radius: 50%;
            border: 2px solid white;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 10px rgba(155, 89, 182, 0.8);
        }

        .axis-label {
            position: absolute;
            font-size: 11px;
            color: #888;
        }

        .preset-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 20px;
        }

        .preset-buttons button {
            padding: 8px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="canvas-container">
            <canvas id="canvas"></canvas>
        </div>

        <div class="info-panel">
            <h1>Gray-Scott Spots Pattern</h1>
            <p class="description">
                Self-organizing spot patterns emerge from the Gray-Scott reaction-diffusion system.
                These stable structures are similar to leopard spots and demonstrate Alan Turing's
                morphogenesis theory of pattern formation in nature.
            </p>

            <h2>Pattern Presets</h2>
            <div class="preset-buttons">
                <button onclick="loadPreset('spots')">Spots</button>
                <button onclick="loadPreset('solitons')">Solitons</button>
                <button onclick="loadPreset('waves')">Waves</button>
                <button onclick="loadPreset('pulsing')">Pulsing</button>
            </div>

            <h2>Parameters</h2>
            <div class="control-group">
                <label>
                    Feed Rate (F): <span class="value-display" id="f-value">0.0545</span>
                </label>
                <input type="range" id="feed-rate" min="0.01" max="0.08" step="0.0001" value="0.0545">
            </div>

            <div class="control-group">
                <label>
                    Kill Rate (K): <span class="value-display" id="k-value">0.0620</span>
                </label>
                <input type="range" id="kill-rate" min="0.045" max="0.07" step="0.0001" value="0.0620">
            </div>

            <div class="control-group">
                <label>
                    Diffusion U (Du): <span class="value-display" id="du-value">0.160</span>
                </label>
                <input type="range" id="diffusion-u" min="0.1" max="0.3" step="0.01" value="0.16">
            </div>

            <div class="control-group">
                <label>
                    Diffusion V (Dv): <span class="value-display" id="dv-value">0.080</span>
                </label>
                <input type="range" id="diffusion-v" min="0.05" max="0.15" step="0.01" value="0.08">
            </div>

            <h2>Parameter Space</h2>
            <div class="parameter-space" id="param-space">
                <span class="axis-label" style="bottom: 5px; left: 5px;">F: 0.01</span>
                <span class="axis-label" style="bottom: 5px; right: 5px;">F: 0.08</span>
                <span class="axis-label" style="top: 5px; left: 5px;">K: 0.07</span>
                <span class="axis-label" style="top: 5px; right: 5px;">K: 0.07</span>
                <span class="axis-label" style="bottom: 5px; left: 5px;">K: 0.045</span>
                <div class="current-position" id="current-pos"></div>
            </div>
            <p style="font-size: 11px; color: #666; margin-top: 5px;">
                Different F-K values produce different patterns
            </p>

            <h2>Controls</h2>
            <button onclick="togglePause()">Pause/Resume</button>
            <button onclick="reset()">Reset</button>
            <button onclick="randomSeed()">Random Seeds</button>

            <div class="stats">
                <div class="stat-row">
                    <span>FPS:</span>
                    <span id="fps">60</span>
                </div>
                <div class="stat-row">
                    <span>Iterations:</span>
                    <span id="iterations">0</span>
                </div>
                <div class="stat-row">
                    <span>Grid Size:</span>
                    <span>256×256</span>
                </div>
            </div>

            <h2>How It Works</h2>
            <p class="description">
                The Gray-Scott model simulates two chemicals U and V:
                <br><br>
                • Chemical U (prey) diffuses and feeds into the system<br>
                • Chemical V (predator) consumes U and dies off<br>
                • Purple spots show high concentration of V<br>
                • Click to seed new spots anywhere<br>
                <br>
                This demonstrates how simple rules create complex, life-like patterns.
            </p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        const SIZE = 256;
        canvas.width = SIZE;
        canvas.height = SIZE;

        // Chemical concentrations
        let u = new Float32Array(SIZE * SIZE);
        let v = new Float32Array(SIZE * SIZE);
        let u_next = new Float32Array(SIZE * SIZE);
        let v_next = new Float32Array(SIZE * SIZE);

        // Parameters
        let params = {
            Du: 0.16,
            Dv: 0.08,
            F: 0.0545,
            K: 0.0620,
            dt: 1.0
        };

        let paused = false;
        let iterations = 0;
        let lastTime = 0;
        let fps = 60;
        let frameCount = 0;
        let lastFpsUpdate = 0;

        // Initialize with full U and small random V seeds
        function reset() {
            for (let i = 0; i < SIZE * SIZE; i++) {
                u[i] = 1.0;
                v[i] = 0.0;
            }

            // Add some initial spots
            for (let i = 0; i < 20; i++) {
                const x = Math.floor(Math.random() * SIZE);
                const y = Math.floor(Math.random() * SIZE);
                seedSpot(x, y, 5);
            }

            iterations = 0;
        }

        function seedSpot(cx, cy, radius) {
            for (let y = -radius; y <= radius; y++) {
                for (let x = -radius; x <= radius; x++) {
                    if (x*x + y*y <= radius*radius) {
                        const px = (cx + x + SIZE) % SIZE;
                        const py = (cy + y + SIZE) % SIZE;
                        const idx = py * SIZE + px;
                        v[idx] = 1.0;
                        u[idx] = 0.0;
                    }
                }
            }
        }

        function randomSeed() {
            for (let i = 0; i < 10; i++) {
                const x = Math.floor(Math.random() * SIZE);
                const y = Math.floor(Math.random() * SIZE);
                seedSpot(x, y, 3 + Math.floor(Math.random() * 5));
            }
        }

        // Calculate Laplacian using 9-point stencil
        function laplacian(arr, x, y) {
            const idx = y * SIZE + x;
            const xm1 = (x - 1 + SIZE) % SIZE;
            const xp1 = (x + 1) % SIZE;
            const ym1 = (y - 1 + SIZE) % SIZE;
            const yp1 = (y + 1) % SIZE;

            const center = arr[idx];
            const left = arr[y * SIZE + xm1];
            const right = arr[y * SIZE + xp1];
            const up = arr[ym1 * SIZE + x];
            const down = arr[yp1 * SIZE + x];

            // 5-point stencil
            return (left + right + up + down - 4.0 * center);
        }

        // Update reaction-diffusion
        function update() {
            const { Du, Dv, F, K, dt } = params;

            for (let y = 0; y < SIZE; y++) {
                for (let x = 0; x < SIZE; x++) {
                    const idx = y * SIZE + x;
                    const u_val = u[idx];
                    const v_val = v[idx];

                    const lap_u = laplacian(u, x, y);
                    const lap_v = laplacian(v, x, y);

                    const uvv = u_val * v_val * v_val;

                    u_next[idx] = u_val + dt * (Du * lap_u - uvv + F * (1.0 - u_val));
                    v_next[idx] = v_val + dt * (Dv * lap_v + uvv - (F + K) * v_val);

                    // Clamp values
                    u_next[idx] = Math.max(0, Math.min(1, u_next[idx]));
                    v_next[idx] = Math.max(0, Math.min(1, v_next[idx]));
                }
            }

            // Swap buffers
            [u, u_next] = [u_next, u];
            [v, v_next] = [v_next, v];

            iterations++;
        }

        // Render to canvas
        function render() {
            const imageData = ctx.createImageData(SIZE, SIZE);
            const data = imageData.data;

            for (let i = 0; i < SIZE * SIZE; i++) {
                const v_val = v[i];
                const u_val = u[i];

                // Purple spots on black background
                const intensity = v_val;

                // Create purple gradient
                data[i * 4 + 0] = intensity * 200 + u_val * 20;  // R
                data[i * 4 + 1] = intensity * 50 + u_val * 20;   // G
                data[i * 4 + 2] = intensity * 255 + u_val * 30;  // B
                data[i * 4 + 3] = 255;                            // A
            }

            ctx.putImageData(imageData, 0, 0);
        }

        // Animation loop
        function animate(currentTime) {
            requestAnimationFrame(animate);

            // Update FPS
            frameCount++;
            if (currentTime - lastFpsUpdate > 1000) {
                fps = Math.round(frameCount * 1000 / (currentTime - lastFpsUpdate));
                frameCount = 0;
                lastFpsUpdate = currentTime;
                document.getElementById('fps').textContent = fps;
            }

            if (!paused) {
                // Multiple iterations per frame for faster evolution
                for (let i = 0; i < 10; i++) {
                    update();
                }
                render();
                document.getElementById('iterations').textContent = iterations;
            }
        }

        // Mouse interaction
        let isMouseDown = false;

        canvas.addEventListener('mousedown', (e) => {
            isMouseDown = true;
            handleMousePaint(e);
        });

        canvas.addEventListener('mousemove', (e) => {
            if (isMouseDown) {
                handleMousePaint(e);
            }
        });

        canvas.addEventListener('mouseup', () => {
            isMouseDown = false;
        });

        canvas.addEventListener('mouseleave', () => {
            isMouseDown = false;
        });

        function handleMousePaint(e) {
            const rect = canvas.getBoundingClientRect();
            const x = Math.floor((e.clientX - rect.left) * SIZE / rect.width);
            const y = Math.floor((e.clientY - rect.top) * SIZE / rect.height);
            seedSpot(x, y, 8);
        }

        // Controls
        document.getElementById('feed-rate').addEventListener('input', (e) => {
            params.F = parseFloat(e.target.value);
            document.getElementById('f-value').textContent = params.F.toFixed(4);
            updateParameterSpace();
        });

        document.getElementById('kill-rate').addEventListener('input', (e) => {
            params.K = parseFloat(e.target.value);
            document.getElementById('k-value').textContent = params.K.toFixed(4);
            updateParameterSpace();
        });

        document.getElementById('diffusion-u').addEventListener('input', (e) => {
            params.Du = parseFloat(e.target.value);
            document.getElementById('du-value').textContent = params.Du.toFixed(3);
        });

        document.getElementById('diffusion-v').addEventListener('input', (e) => {
            params.Dv = parseFloat(e.target.value);
            document.getElementById('dv-value').textContent = params.Dv.toFixed(3);
        });

        function togglePause() {
            paused = !paused;
        }

        function updateParameterSpace() {
            const space = document.getElementById('param-space');
            const pos = document.getElementById('current-pos');

            // Map F (0.01 to 0.08) and K (0.045 to 0.07) to position
            const x = ((params.F - 0.01) / (0.08 - 0.01)) * space.clientWidth;
            const y = space.clientHeight - ((params.K - 0.045) / (0.07 - 0.045)) * space.clientHeight;

            pos.style.left = x + 'px';
            pos.style.top = y + 'px';
        }

        function loadPreset(preset) {
            switch(preset) {
                case 'spots':
                    params.F = 0.0545;
                    params.K = 0.0620;
                    break;
                case 'solitons':
                    params.F = 0.0390;
                    params.K = 0.0580;
                    break;
                case 'waves':
                    params.F = 0.0140;
                    params.K = 0.0450;
                    break;
                case 'pulsing':
                    params.F = 0.0260;
                    params.K = 0.0510;
                    break;
            }

            document.getElementById('feed-rate').value = params.F;
            document.getElementById('kill-rate').value = params.K;
            document.getElementById('f-value').textContent = params.F.toFixed(4);
            document.getElementById('k-value').textContent = params.K.toFixed(4);
            updateParameterSpace();
            reset();
        }

        // Initialize
        reset();
        updateParameterSpace();
        animate(0);
    </script>
</body>
</html>
