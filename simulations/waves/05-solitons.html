<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soliton Wave Propagation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1a2a6c 0%, #b21f1f 50%, #fdbb2d 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            color: #fff;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            max-width: 1200px;
            width: 100%;
        }
        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        .description {
            text-align: center;
            margin-bottom: 20px;
            line-height: 1.6;
            opacity: 0.9;
        }
        .canvas-wrapper {
            position: relative;
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        canvas {
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            background: #000;
            cursor: pointer;
        }
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .control-group {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
        }
        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        .control-group input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }
        .control-group .value {
            text-align: right;
            opacity: 0.8;
            font-size: 0.9em;
        }
        .button-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }
        button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        .solitons-list {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }
        .soliton-item {
            padding: 8px;
            margin: 5px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .remove-btn {
            padding: 5px 10px;
            font-size: 0.8em;
            min-width: 60px;
        }
        .info {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            line-height: 1.6;
        }
        .info h3 {
            margin-bottom: 10px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        .stat-box {
            background: rgba(255, 255, 255, 0.15);
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }
        .stat-label {
            font-size: 0.85em;
            opacity: 0.8;
        }
        .stat-value {
            font-size: 1.3em;
            font-weight: bold;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Soliton Wave Propagation</h1>
        <p class="description">
            Solitons are special wave pulses that maintain their shape as they propagate.
            Unlike normal waves that disperse, solitons remain coherent and can pass through each other!
            Click canvas to add solitons with different amplitudes.
        </p>

        <div class="canvas-wrapper">
            <canvas id="canvas"></canvas>
        </div>

        <div class="controls">
            <div class="control-group">
                <label>Soliton Amplitude: <span class="value" id="ampValue">1.0</span></label>
                <input type="range" id="amplitude" min="0.2" max="3" step="0.1" value="1.0">
            </div>

            <div class="control-group">
                <label>Soliton Width: <span class="value" id="widthValue">20</span></label>
                <input type="range" id="width" min="10" max="50" step="2" value="20">
            </div>

            <div class="control-group">
                <label>Nonlinearity (α): <span class="value" id="nonlinValue">0.5</span></label>
                <input type="range" id="nonlinearity" min="0" max="1" step="0.05" value="0.5">
            </div>

            <div class="control-group">
                <label>Dispersion (β): <span class="value" id="dispValue">0.3</span></label>
                <input type="range" id="dispersion" min="0" max="1" step="0.05" value="0.3">
            </div>
        </div>

        <div class="button-group">
            <button id="clearBtn">Clear All</button>
            <button id="presetSingle">Single Soliton</button>
            <button id="presetTwo">Two Solitons</button>
            <button id="presetCollision">Collision Demo</button>
            <button id="presetOvertake">Overtake Demo</button>
        </div>

        <div class="solitons-list">
            <h3>Active Solitons (<span id="solitonCount">0</span>)</h3>
            <div id="solitonsList"></div>
            <div class="stats">
                <div class="stat-box">
                    <div class="stat-label">Time Elapsed</div>
                    <div class="stat-value" id="timeElapsed">0.0 s</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Total Energy</div>
                    <div class="stat-value" id="totalEnergy">0.0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Peak Amplitude</div>
                    <div class="stat-value" id="peakAmp">0.0</div>
                </div>
            </div>
        </div>

        <div class="info">
            <h3>Soliton Theory</h3>
            <p>
                <strong>Korteweg-de Vries (KdV) Equation:</strong><br>
                ∂u/∂t + α·u·∂u/∂x + β·∂³u/∂x³ = 0
            </p>
            <p style="margin-top: 10px;">
                Solitons arise from a delicate balance between:
            </p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li><strong>Nonlinearity (α):</strong> Causes wave steepening (amplitude dependence)</li>
                <li><strong>Dispersion (β):</strong> Causes wave spreading (frequency dependence)</li>
            </ul>
            <p style="margin-top: 10px;">
                When these effects balance, the result is a stable, non-dispersive wave packet - a soliton!
            </p>
            <p style="margin-top: 10px;">
                <strong>Key Properties:</strong>
            </p>
            <ul style="margin-left: 20px;">
                <li>Maintains shape while propagating (no dispersion)</li>
                <li>Velocity depends on amplitude: v ∝ amplitude (taller = faster)</li>
                <li>Elastic collisions: solitons pass through each other unchanged</li>
                <li>Only experience phase shift after collision</li>
            </ul>
            <p style="margin-top: 10px;">
                <strong>Applications:</strong> Fiber optic communications, tsunami waves, plasma physics,
                Bose-Einstein condensates, DNA dynamics, protein folding.
            </p>
            <p style="margin-top: 10px;">
                <strong>Discovery:</strong> First observed by John Scott Russell in 1834 on the Union Canal in Scotland.
                He followed a solitary wave on horseback for miles, noting it maintained its shape!
            </p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // Set canvas size
        const width = Math.min(900, window.innerWidth - 80);
        const height = Math.min(400, window.innerHeight - 600);
        canvas.width = width;
        canvas.height = height;

        // Grid parameters
        const gridSize = 400;
        const dx = width / gridSize;

        // Wave field
        let u = new Float32Array(gridSize);
        let u_prev = new Float32Array(gridSize);

        // Solitons
        let solitons = [];
        let nextId = 1;

        // Parameters
        let params = {
            amplitude: 1.0,
            width: 20,
            nonlinearity: 0.5,
            dispersion: 0.3
        };

        // Time
        let time = 0;

        // Add soliton
        function addSoliton(position, amplitude, width) {
            solitons.push({
                id: nextId++,
                position: position,
                amplitude: amplitude,
                width: width,
                velocity: amplitude * params.nonlinearity, // v ∝ amplitude
                createdAt: time
            });
            updateSolitonsList();
            initializeField();
        }

        // Remove soliton
        function removeSoliton(id) {
            solitons = solitons.filter(s => s.id !== id);
            updateSolitonsList();
            initializeField();
        }

        // Initialize field from solitons
        function initializeField() {
            u.fill(0);

            for (let soliton of solitons) {
                for (let i = 0; i < gridSize; i++) {
                    const x = i - soliton.position;
                    // Soliton profile: sech²(x/width)
                    const arg = x / soliton.width;
                    const sech = 1 / Math.cosh(arg);
                    u[i] += soliton.amplitude * sech * sech;
                }
            }

            u_prev = new Float32Array(u);
        }

        // Update wave equation (simplified KdV with finite differences)
        function updateWave() {
            const dt = 0.05;
            const alpha = params.nonlinearity;
            const beta = params.dispersion;

            const u_next = new Float32Array(gridSize);

            for (let i = 2; i < gridSize - 2; i++) {
                // Nonlinear term: -α·u·∂u/∂x
                const dudx = (u[i + 1] - u[i - 1]) / (2 * dx);
                const nonlinear = -alpha * u[i] * dudx;

                // Dispersion term: -β·∂³u/∂x³ (5-point stencil)
                const d3udx3 = (u[i + 2] - 2 * u[i + 1] + 2 * u[i - 1] - u[i - 2]) / (2 * dx * dx * dx);
                const dispersion_term = -beta * d3udx3;

                // Time integration (forward Euler)
                u_next[i] = u[i] + dt * (nonlinear + dispersion_term);
            }

            // Periodic boundary conditions
            u_next[0] = u_next[gridSize - 3];
            u_next[1] = u_next[gridSize - 2];
            u_next[gridSize - 1] = u_next[2];
            u_next[gridSize - 2] = u_next[1];

            // Update soliton positions (for tracking)
            for (let soliton of solitons) {
                soliton.position += soliton.velocity * dt * 10;
                // Wrap around
                if (soliton.position > gridSize) soliton.position -= gridSize;
                if (soliton.position < 0) soliton.position += gridSize;
            }

            u_prev = u;
            u = u_next;
            time += dt;
        }

        // Render
        function render() {
            // Clear
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, width, height);

            // Draw baseline
            const centerY = height / 2;
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.lineWidth = 1;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(width, centerY);
            ctx.stroke();
            ctx.setLineDash([]);

            // Draw wave field
            ctx.strokeStyle = '#00ffff';
            ctx.lineWidth = 2;
            ctx.beginPath();

            let maxU = 0;
            for (let i = 0; i < gridSize; i++) {
                maxU = Math.max(maxU, Math.abs(u[i]));
            }

            for (let i = 0; i < gridSize; i++) {
                const x = (i / gridSize) * width;
                const scale = Math.min(height * 0.4, 100);
                const y = centerY - u[i] * scale;

                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }

            ctx.stroke();

            // Fill under curve
            ctx.lineTo(width, centerY);
            ctx.lineTo(0, centerY);
            ctx.closePath();
            ctx.fillStyle = 'rgba(0, 255, 255, 0.1)';
            ctx.fill();

            // Draw soliton markers
            for (let soliton of solitons) {
                const x = (soliton.position / gridSize) * width;
                const alpha = Math.min(1, (time - soliton.createdAt) / 2);

                ctx.fillStyle = `rgba(255, 100, 100, ${alpha * 0.6})`;
                ctx.beginPath();
                ctx.arc(x, centerY + 30, 4, 0, Math.PI * 2);
                ctx.fill();

                // Label
                ctx.font = '10px sans-serif';
                ctx.fillText(`A=${soliton.amplitude.toFixed(1)}`, x + 8, centerY + 35);
            }

            // Update stats
            document.getElementById('timeElapsed').textContent = time.toFixed(1) + ' s';

            let energy = 0;
            for (let i = 0; i < gridSize; i++) {
                energy += u[i] * u[i];
            }
            document.getElementById('totalEnergy').textContent = (energy / 100).toFixed(1);
            document.getElementById('peakAmp').textContent = maxU.toFixed(2);
        }

        // Update solitons list
        function updateSolitonsList() {
            const list = document.getElementById('solitonsList');
            const count = document.getElementById('solitonCount');
            count.textContent = solitons.length;

            list.innerHTML = '';

            if (solitons.length === 0) {
                list.innerHTML = '<p style="opacity: 0.6; text-align: center; padding: 10px;">Click canvas to add solitons</p>';
            } else {
                solitons.forEach((soliton, index) => {
                    const item = document.createElement('div');
                    item.className = 'soliton-item';
                    item.innerHTML = `
                        <span>Soliton ${soliton.id}: A=${soliton.amplitude.toFixed(1)}, v=${soliton.velocity.toFixed(2)}</span>
                        <button class="remove-btn" onclick="removeSoliton(${soliton.id})">Remove</button>
                    `;
                    list.appendChild(item);
                });
            }
        }

        // Animation loop
        function animate() {
            if (solitons.length > 0) {
                updateWave();
            }
            render();
            requestAnimationFrame(animate);
        }

        // Mouse interaction
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const gridPos = (x / width) * gridSize;

            addSoliton(gridPos, params.amplitude, params.width);
        });

        // Controls
        document.getElementById('amplitude').addEventListener('input', (e) => {
            params.amplitude = parseFloat(e.target.value);
            document.getElementById('ampValue').textContent = params.amplitude.toFixed(1);
        });

        document.getElementById('width').addEventListener('input', (e) => {
            params.width = parseFloat(e.target.value);
            document.getElementById('widthValue').textContent = params.width;
        });

        document.getElementById('nonlinearity').addEventListener('input', (e) => {
            params.nonlinearity = parseFloat(e.target.value);
            document.getElementById('nonlinValue').textContent = params.nonlinearity.toFixed(2);
        });

        document.getElementById('dispersion').addEventListener('input', (e) => {
            params.dispersion = parseFloat(e.target.value);
            document.getElementById('dispValue').textContent = params.dispersion.toFixed(2);
        });

        // Buttons
        document.getElementById('clearBtn').addEventListener('click', () => {
            solitons = [];
            u.fill(0);
            u_prev.fill(0);
            time = 0;
            updateSolitonsList();
        });

        document.getElementById('presetSingle').addEventListener('click', () => {
            solitons = [];
            time = 0;
            addSoliton(gridSize * 0.3, 1.5, 20);
        });

        document.getElementById('presetTwo').addEventListener('click', () => {
            solitons = [];
            time = 0;
            addSoliton(gridSize * 0.25, 1.0, 20);
            addSoliton(gridSize * 0.75, 1.0, 20);
        });

        document.getElementById('presetCollision').addEventListener('click', () => {
            solitons = [];
            time = 0;
            addSoliton(gridSize * 0.25, 1.5, 20);
            addSoliton(gridSize * 0.75, 1.2, 18);
        });

        document.getElementById('presetOvertake').addEventListener('click', () => {
            solitons = [];
            time = 0;
            // Taller soliton overtakes shorter one
            addSoliton(gridSize * 0.2, 2.0, 15);
            addSoliton(gridSize * 0.6, 1.0, 25);
        });

        // Make removeSoliton global
        window.removeSoliton = removeSoliton;

        // Initialize
        updateSolitonsList();
        animate();
    </script>
    <script src="../../assets/js/enhance.js" defer></script>
</body>
</html>
