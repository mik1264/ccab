<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boids Parameter Playground</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
            display: flex;
        }
        #canvas {
            flex: 1;
            display: block;
            background: #1a1a2e;
        }
        .controls-panel {
            width: 350px;
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 25px;
            overflow-y: auto;
            box-shadow: -5px 0 20px rgba(0, 0, 0, 0.5);
        }
        .controls-panel h1 {
            font-size: 24px;
            margin-bottom: 20px;
            color: #667eea;
        }
        .section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .section h2 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #a0a0a0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .control-group {
            margin-bottom: 15px;
        }
        .control-group label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 13px;
            color: #ddd;
        }
        .control-group .value {
            color: #667eea;
            font-weight: bold;
        }
        .control-group input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #333;
            outline: none;
        }
        .control-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }
        .control-group input[type="checkbox"] {
            margin-right: 10px;
        }
        button {
            width: 100%;
            padding: 12px;
            margin: 5px 0;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.3s;
        }
        button:hover {
            background: #5568d3;
        }
        button.secondary {
            background: #764ba2;
        }
        button.secondary:hover {
            background: #5d3a81;
        }
        .preset-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        .preset-buttons button {
            font-size: 12px;
            padding: 8px;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>

    <div class="controls-panel">
        <h1>Boids Playground</h1>

        <div class="section">
            <h2>Population</h2>
            <div class="control-group">
                <label>
                    <span>Boid Count</span>
                    <span class="value" id="countVal">100</span>
                </label>
                <input type="range" id="boidCount" min="10" max="300" step="10" value="100">
            </div>
        </div>

        <div class="section">
            <h2>Flocking Rules</h2>
            <div class="control-group">
                <label>
                    <span>Separation</span>
                    <span class="value" id="sepVal">1.5°</span>
                </label>
                <input type="range" id="separation" min="0" max="15" step="0.1" value="1.5">
            </div>
            <div class="control-group">
                <label>
                    <span>Alignment</span>
                    <span class="value" id="alignVal">5.0°</span>
                </label>
                <input type="range" id="alignment" min="0" max="20" step="0.1" value="5.0">
            </div>
            <div class="control-group">
                <label>
                    <span>Cohesion</span>
                    <span class="value" id="cohVal">3.0°</span>
                </label>
                <input type="range" id="cohesion" min="0" max="15" step="0.1" value="3.0">
            </div>
        </div>

        <div class="section">
            <h2>Perception</h2>
            <div class="control-group">
                <label>
                    <span>Vision Radius</span>
                    <span class="value" id="visVal">80px</span>
                </label>
                <input type="range" id="vision" min="20" max="200" step="5" value="80">
            </div>
            <div class="control-group">
                <label>
                    <span>Min Separation</span>
                    <span class="value" id="minSepVal">25px</span>
                </label>
                <input type="range" id="minSep" min="5" max="80" step="1" value="25">
            </div>
        </div>

        <div class="section">
            <h2>Movement</h2>
            <div class="control-group">
                <label>
                    <span>Speed</span>
                    <span class="value" id="speedVal">2.0</span>
                </label>
                <input type="range" id="speed" min="0.5" max="6" step="0.1" value="2.0">
            </div>
            <div class="control-group">
                <label>
                    <span>Boid Size</span>
                    <span class="value" id="sizeVal">6px</span>
                </label>
                <input type="range" id="boidSize" min="3" max="15" step="1" value="6">
            </div>
        </div>

        <div class="section">
            <h2>Visualization</h2>
            <div class="control-group">
                <label>
                    <input type="checkbox" id="showTrails">
                    <span>Show Trails</span>
                </label>
            </div>
            <div class="control-group">
                <label>
                    <input type="checkbox" id="showVectors">
                    <span>Show Velocity Vectors</span>
                </label>
            </div>
            <div class="control-group">
                <label>
                    <input type="checkbox" id="showNeighborhood">
                    <span>Show Vision Radius (hover)</span>
                </label>
            </div>
        </div>

        <div class="section">
            <h2>Presets</h2>
            <div class="preset-buttons">
                <button onclick="loadPreset('classic')">Classic</button>
                <button onclick="loadPreset('aligned')">Aligned</button>
                <button onclick="loadPreset('tight')">Tight Flock</button>
                <button onclick="loadPreset('dispersed')">Dispersed</button>
            </div>
        </div>

        <button onclick="resetBoids()">Reset Boids</button>
        <button class="secondary" onclick="randomize()">Randomize Parameters</button>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            canvas.width = window.innerWidth - 350;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        const PARAMS = {
            visionRadius: 80,
            minSeparation: 25,
            maxSpeed: 2,
            maxSeparateTurn: 1.5,
            maxAlignTurn: 5.0,
            maxCohereTurn: 3.0,
            boidSize: 6,
            boidCount: 100,
            showTrails: false,
            showVectors: false,
            showNeighborhood: false
        };

        let mouseX = -1000;
        let mouseY = -1000;

        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            mouseX = e.clientX - rect.left;
            mouseY = e.clientY - rect.top;
        });

        function setupControls() {
            const controls = {
                boidCount: { elem: 'boidCount', display: 'countVal', param: 'boidCount', suffix: '' },
                separation: { elem: 'separation', display: 'sepVal', param: 'maxSeparateTurn', suffix: '°' },
                alignment: { elem: 'alignment', display: 'alignVal', param: 'maxAlignTurn', suffix: '°' },
                cohesion: { elem: 'cohesion', display: 'cohVal', param: 'maxCohereTurn', suffix: '°' },
                vision: { elem: 'vision', display: 'visVal', param: 'visionRadius', suffix: 'px' },
                minSep: { elem: 'minSep', display: 'minSepVal', param: 'minSeparation', suffix: 'px' },
                speed: { elem: 'speed', display: 'speedVal', param: 'maxSpeed', suffix: '' },
                boidSize: { elem: 'boidSize', display: 'sizeVal', param: 'boidSize', suffix: 'px' }
            };

            Object.values(controls).forEach(ctrl => {
                const elem = document.getElementById(ctrl.elem);
                const display = document.getElementById(ctrl.display);

                elem.addEventListener('input', (e) => {
                    const val = parseFloat(e.target.value);
                    PARAMS[ctrl.param] = val;
                    display.textContent = val + ctrl.suffix;

                    if (ctrl.param === 'boidCount') {
                        adjustBoidCount(val);
                    }
                });
            });

            document.getElementById('showTrails').addEventListener('change', (e) => {
                PARAMS.showTrails = e.target.checked;
            });

            document.getElementById('showVectors').addEventListener('change', (e) => {
                PARAMS.showVectors = e.target.checked;
            });

            document.getElementById('showNeighborhood').addEventListener('change', (e) => {
                PARAMS.showNeighborhood = e.target.checked;
            });
        }

        class Boid {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.heading = Math.random() * Math.PI * 2;
                this.trail = [];
            }

            update(boids) {
                if (PARAMS.showTrails) {
                    this.trail.push({ x: this.x, y: this.y });
                    if (this.trail.length > 20) this.trail.shift();
                } else {
                    this.trail = [];
                }

                const flockmates = boids.filter(other => {
                    if (other === this) return false;
                    const dist = Math.hypot(this.x - other.x, this.y - other.y);
                    return dist < PARAMS.visionRadius;
                });

                let nearest = null;
                let minDist = Infinity;
                for (const other of flockmates) {
                    const dist = Math.hypot(this.x - other.x, this.y - other.y);
                    if (dist < minDist) {
                        minDist = dist;
                        nearest = other;
                    }
                }

                if (nearest && minDist < PARAMS.minSeparation) {
                    const angle = Math.atan2(this.y - nearest.y, this.x - nearest.x);
                    this.turnToward(angle, PARAMS.maxSeparateTurn);
                } else if (flockmates.length > 0) {
                    let sumSin = 0, sumCos = 0;
                    flockmates.forEach(b => {
                        sumSin += Math.sin(b.heading);
                        sumCos += Math.cos(b.heading);
                    });
                    const avgHeading = Math.atan2(sumSin / flockmates.length, sumCos / flockmates.length);
                    this.turnToward(avgHeading, PARAMS.maxAlignTurn);

                    let sumX = 0, sumY = 0;
                    flockmates.forEach(b => {
                        sumX += b.x - this.x;
                        sumY += b.y - this.y;
                    });
                    const cohAngle = Math.atan2(sumY / flockmates.length, sumX / flockmates.length);
                    this.turnToward(cohAngle, PARAMS.maxCohereTurn);
                }

                this.x += Math.cos(this.heading) * PARAMS.maxSpeed;
                this.y += Math.sin(this.heading) * PARAMS.maxSpeed;

                if (this.x < 0) this.x = canvas.width;
                if (this.x > canvas.width) this.x = 0;
                if (this.y < 0) this.y = canvas.height;
                if (this.y > canvas.height) this.y = 0;
            }

            turnToward(targetHeading, maxTurn) {
                const maxTurnRad = (maxTurn * Math.PI) / 180;
                let diff = targetHeading - this.heading;
                while (diff > Math.PI) diff -= 2 * Math.PI;
                while (diff < -Math.PI) diff += 2 * Math.PI;
                if (Math.abs(diff) < maxTurnRad) {
                    this.heading = targetHeading;
                } else {
                    this.heading += Math.sign(diff) * maxTurnRad;
                }
            }

            isHovered() {
                return Math.hypot(this.x - mouseX, this.y - mouseY) < 15;
            }

            draw(boids) {
                const isHovered = PARAMS.showNeighborhood && this.isHovered();

                if (isHovered) {
                    ctx.strokeStyle = 'rgba(102, 126, 234, 0.3)';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, PARAMS.visionRadius, 0, Math.PI * 2);
                    ctx.stroke();
                }

                if (PARAMS.showTrails && this.trail.length > 1) {
                    for (let i = 1; i < this.trail.length; i++) {
                        const alpha = i / this.trail.length;
                        ctx.strokeStyle = `rgba(102, 126, 234, ${alpha * 0.5})`;
                        ctx.lineWidth = 2;
                        ctx.beginPath();
                        ctx.moveTo(this.trail[i - 1].x, this.trail[i - 1].y);
                        ctx.lineTo(this.trail[i].x, this.trail[i].y);
                        ctx.stroke();
                    }
                }

                if (PARAMS.showVectors) {
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.y);
                    ctx.lineTo(this.x + Math.cos(this.heading) * 20, this.y + Math.sin(this.heading) * 20);
                    ctx.stroke();
                }

                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.heading);
                ctx.beginPath();
                ctx.moveTo(PARAMS.boidSize, 0);
                ctx.lineTo(-PARAMS.boidSize, PARAMS.boidSize / 2);
                ctx.lineTo(-PARAMS.boidSize, -PARAMS.boidSize / 2);
                ctx.closePath();
                ctx.fillStyle = isHovered ? '#ffffff' : '#667eea';
                ctx.fill();
                ctx.restore();
            }
        }

        let boids = [];

        function adjustBoidCount(count) {
            const current = boids.length;
            if (count > current) {
                for (let i = 0; i < count - current; i++) {
                    boids.push(new Boid(Math.random() * canvas.width, Math.random() * canvas.height));
                }
            } else {
                boids.splice(0, current - count);
            }
        }

        function resetBoids() {
            boids = [];
            for (let i = 0; i < PARAMS.boidCount; i++) {
                boids.push(new Boid(Math.random() * canvas.width, Math.random() * canvas.height));
            }
        }

        function loadPreset(name) {
            const presets = {
                classic: { sep: 1.5, align: 5.0, coh: 3.0, vis: 80, minSep: 25, speed: 2 },
                aligned: { sep: 1.0, align: 15.0, coh: 1.0, vis: 100, minSep: 20, speed: 2.5 },
                tight: { sep: 1.5, align: 3.0, coh: 12.0, vis: 120, minSep: 20, speed: 2 },
                dispersed: { sep: 10.0, align: 2.0, coh: 1.0, vis: 80, minSep: 50, speed: 2 }
            };

            const preset = presets[name];
            if (preset) {
                document.getElementById('separation').value = preset.sep;
                document.getElementById('alignment').value = preset.align;
                document.getElementById('cohesion').value = preset.coh;
                document.getElementById('vision').value = preset.vis;
                document.getElementById('minSep').value = preset.minSep;
                document.getElementById('speed').value = preset.speed;

                PARAMS.maxSeparateTurn = preset.sep;
                PARAMS.maxAlignTurn = preset.align;
                PARAMS.maxCohereTurn = preset.coh;
                PARAMS.visionRadius = preset.vis;
                PARAMS.minSeparation = preset.minSep;
                PARAMS.maxSpeed = preset.speed;

                document.getElementById('sepVal').textContent = preset.sep + '°';
                document.getElementById('alignVal').textContent = preset.align + '°';
                document.getElementById('cohVal').textContent = preset.coh + '°';
                document.getElementById('visVal').textContent = preset.vis + 'px';
                document.getElementById('minSepVal').textContent = preset.minSep + 'px';
                document.getElementById('speedVal').textContent = preset.speed;
            }
        }

        function randomize() {
            const rand = (min, max) => min + Math.random() * (max - min);
            loadPreset('classic');
            document.getElementById('separation').value = rand(0, 10);
            document.getElementById('alignment').value = rand(0, 15);
            document.getElementById('cohesion').value = rand(0, 10);
            document.getElementById('separation').dispatchEvent(new Event('input'));
            document.getElementById('alignment').dispatchEvent(new Event('input'));
            document.getElementById('cohesion').dispatchEvent(new Event('input'));
        }

        setupControls();
        resetBoids();

        function animate() {
            ctx.fillStyle = PARAMS.showTrails ? 'rgba(26, 26, 46, 0.2)' : '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            boids.forEach(b => b.update(boids));
            boids.forEach(b => b.draw(boids));

            requestAnimationFrame(animate);
        }

        animate();
    </script>
</body>
</html>
