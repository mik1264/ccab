<!DOCTYPE html><html><head><meta charset="UTF-8"><title>WebGPU Genetic Algorithm</title><style>body{margin:0;background:#0a0a0a;display:flex;justify-content:center;align-items:center;flex-direction:column;color:#0f0;font-family:monospace}canvas{display:block;margin:20px}#info{font-size:18px}</style></head><body><div id="info">Generation: 0 | Best Fitness: 0.00</div><canvas id="c" width="800" height="600"></canvas><script>async function init(){if(!navigator.gpu){alert('WebGPU not supported');return}const adapter=await navigator.gpu.requestAdapter();const device=await adapter.requestDevice();const canvas=document.getElementById('c');const context=canvas.getContext('webgpu');const format=navigator.gpu.getPreferredCanvasFormat();context.configure({device,format});const POP_SIZE=512;const shader=`struct Individual{genes:array<f32,8>,fitness:f32,_pad:array<f32,3>,}@group(0)@binding(0)var<storage,read_write>population:array<Individual>;@group(0)@binding(1)var<uniform>params:vec4<f32>;fn hash(p:vec2<f32>)->f32{var p3=fract(vec3<f32>(p.x,p.y,p.x)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}@compute @workgroup_size(64)fn main(@builtin(global_invocation_id)id:vec3<u32>){let idx=id.x;if(idx>=${POP_SIZE}u){return;}var ind=population[idx];var fitness=0.0;for(var i=0;i<8;i++){let target=sin(f32(i)*0.5+params.x);fitness-=abs(ind.genes[i]-target);}ind.fitness=fitness;let seed=vec2<f32>(f32(idx),params.x);if(hash(seed)>0.5){let other=u32(hash(seed+1.0)*f32(${POP_SIZE}));for(var i=0;i<8;i++){if(hash(seed+f32(i))>0.5){ind.genes[i]=population[other].genes[i];}ind.genes[i]+=( hash(seed+f32(i)+10.0)-0.5)*0.1;}}population[idx]=ind;}`;const renderShader=`@group(0)@binding(0)var<storage,read>population:array<vec4<f32>>;@vertex fn vs(@builtin(vertex_index)vi:u32,@builtin(instance_index)ii:u32)->@builtin(position)vec4<f32>{let ind=population[ii*3u];let x=f32(ii)/${POP_SIZE}.0*2.0-1.0;let y=ind.z*2.0-1.0;let positions=array(vec2<f32>(-0.003,-0.003),vec2<f32>(0.003,-0.003),vec2<f32>(-0.003,0.003),vec2<f32>(0.003,0.003));return vec4<f32>(x+positions[vi].x,y+positions[vi].y,0.0,1.0);}@fragment fn fs()->@location(0)vec4<f32>{return vec4<f32>(0.0,1.0,0.3,1.0);}`;const popData=new Float32Array(POP_SIZE*12);for(let i=0;i<POP_SIZE;i++){for(let j=0;j<8;j++){popData[i*12+j]=Math.random();}}const popBuffer=device.createBuffer({size:popData.byteLength,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST});device.queue.writeBuffer(popBuffer,0,popData);const paramsBuffer=device.createBuffer({size:16,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const computePipeline=device.createComputePipeline({layout:'auto',compute:{module:device.createShaderModule({code:shader}),entryPoint:'main'}});const renderPipeline=device.createRenderPipeline({layout:'auto',vertex:{module:device.createShaderModule({code:renderShader}),entryPoint:'vs'},fragment:{module:device.createShaderModule({code:renderShader}),entryPoint:'fs',targets:[{format}]},primitive:{topology:'triangle-strip'}});let generation=0;let time=0;function frame(){time+=0.016;generation++;device.queue.writeBuffer(paramsBuffer,0,new Float32Array([time,0,0,0]));const computeBG=device.createBindGroup({layout:computePipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:popBuffer}},{binding:1,resource:{buffer:paramsBuffer}}]});const renderBG=device.createBindGroup({layout:renderPipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:popBuffer}}]});const encoder=device.createCommandEncoder();const compute=encoder.beginComputePass();compute.setPipeline(computePipeline);compute.setBindGroup(0,computeBG);compute.dispatchWorkgroups(Math.ceil(POP_SIZE/64));compute.end();const render=encoder.beginRenderPass({colorAttachments:[{view:context.getCurrentTexture().createView(),loadOp:'clear',clearValue:{r:0.02,g:0.02,b:0.02,a:1},storeOp:'store'}]});render.setPipeline(renderPipeline);render.setBindGroup(0,renderBG);render.draw(4,POP_SIZE);render.end();device.queue.submit([encoder.finish()]);document.getElementById('info').textContent=`Generation: ${generation} | Evolving...`;setTimeout(()=>requestAnimationFrame(frame),50);}frame();}init();</script></body></html>
