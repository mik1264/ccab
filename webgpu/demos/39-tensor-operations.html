<!DOCTYPE html><html><head><meta charset="UTF-8"><title>WebGPU Tensor Operations</title><style>body{margin:0;background:#000;display:flex;justify-content:center;align-items:center;flex-direction:column;color:#0f0;font-family:monospace}#info{margin:20px;font-size:18px}canvas{display:block}</style></head><body><div id="info">GPU Tensor Matrix Multiplication Benchmark</div><canvas id="c" width="800" height="600"></canvas><script>async function init(){if(!navigator.gpu){alert('WebGPU not supported');return}const adapter=await navigator.gpu.requestAdapter();const device=await adapter.requestDevice();const canvas=document.getElementById('c');const context=canvas.getContext('webgpu');const format=navigator.gpu.getPreferredCanvasFormat();context.configure({device,format});const M=128,N=128,K=128;const shader=`@group(0)@binding(0)var<storage,read>matA:array<f32>;@group(0)@binding(1)var<storage,read>matB:array<f32>;@group(0)@binding(2)var<storage,read_write>matC:array<f32>;var<workgroup>tileA:array<f32,256>;var<workgroup>tileB:array<f32,256>;@compute @workgroup_size(16,16)fn main(@builtin(global_invocation_id)global_id:vec3<u32>,@builtin(local_invocation_id)local_id:vec3<u32>){let row=global_id.y;let col=global_id.x;var sum=0.0;let numTiles=${K}u/16u;for(var t=0u;t<numTiles;t++){let tiledRow=local_id.y;let tiledCol=local_id.x;tileA[tiledRow*16u+tiledCol]=matA[row*${K}u+t*16u+tiledCol];tileB[tiledRow*16u+tiledCol]=matB[(t*16u+tiledRow)*${N}u+col];workgroupBarrier();for(var k=0u;k<16u;k++){sum+=tileA[tiledRow*16u+k]*tileB[k*16u+tiledCol];}workgroupBarrier();}matC[row*${N}u+col]=sum;}`;const renderShader=`@group(0)@binding(0)var<storage,read>matrix:array<f32>;@group(0)@binding(1)var<uniform>time:f32;@vertex fn vs(@builtin(vertex_index)i:u32)->@builtin(position)vec4<f32>{var pos=array(vec2(-1.0,-1.0),vec2(1.0,-1.0),vec2(-1.0,1.0),vec2(1.0,-1.0),vec2(1.0,1.0),vec2(-1.0,1.0));return vec4<f32>(pos[i],0.0,1.0);}@fragment fn fs(@builtin(position)pos:vec4<f32>)->@location(0)vec4<f32>{let x=u32(pos.x/800.0*f32(${N}));let y=u32(pos.y/600.0*f32(${M}));let val=matrix[y*${N}u+x];let c=abs(sin(val*10.0+time));return vec4<f32>(c*0.3,c*0.8,c*0.5,1.0);}`;const matA=new Float32Array(M*K);const matB=new Float32Array(K*N);for(let i=0;i<M*K;i++){matA[i]=Math.random();}for(let i=0;i<K*N;i++){matB[i]=Math.random();}const bufferA=device.createBuffer({size:matA.byteLength,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST});const bufferB=device.createBuffer({size:matB.byteLength,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST});const bufferC=device.createBuffer({size:M*N*4,usage:GPUBufferUsage.STORAGE});device.queue.writeBuffer(bufferA,0,matA);device.queue.writeBuffer(bufferB,0,matB);const timeBuffer=device.createBuffer({size:4,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const computePipeline=device.createComputePipeline({layout:'auto',compute:{module:device.createShaderModule({code:shader}),entryPoint:'main'}});const renderPipeline=device.createRenderPipeline({layout:'auto',vertex:{module:device.createShaderModule({code:renderShader}),entryPoint:'vs'},fragment:{module:device.createShaderModule({code:renderShader}),entryPoint:'fs',targets:[{format}]}});let time=0;function frame(){time+=0.02;for(let i=0;i<M*K;i++){matA[i]=Math.sin(time+i*0.01);}device.queue.writeBuffer(bufferA,0,matA);device.queue.writeBuffer(timeBuffer,0,new Float32Array([time]));const computeBG=device.createBindGroup({layout:computePipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:bufferA}},{binding:1,resource:{buffer:bufferB}},{binding:2,resource:{buffer:bufferC}}]});const renderBG=device.createBindGroup({layout:renderPipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:bufferC}},{binding:1,resource:{buffer:timeBuffer}}]});const encoder=device.createCommandEncoder();const compute=encoder.beginComputePass();compute.setPipeline(computePipeline);compute.setBindGroup(0,computeBG);compute.dispatchWorkgroups(M/16,N/16);compute.end();const render=encoder.beginRenderPass({colorAttachments:[{view:context.getCurrentTexture().createView(),loadOp:'clear',clearValue:{r:0.05,g:0.05,b:0.05,a:1},storeOp:'store'}]});render.setPipeline(renderPipeline);render.setBindGroup(0,renderBG);render.draw(6);render.end();device.queue.submit([encoder.finish()]);requestAnimationFrame(frame);}frame();}init();</script></body></html>
