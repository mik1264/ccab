<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radial Velocity Method - CCAB</title>
    <link rel="stylesheet" href="../assets/css/gallery-standard.css">
    <style>
        body {
            background: #000;
            color: #ddd;
            font-family: system-ui;
            padding: 2rem;
            text-align: center;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        
        .viz-split {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        canvas {
            border: 1px solid #333;
            background: #111;
            border-radius: 8px;
        }
        
        .spectrum-bar {
            height: 40px;
            background: linear-gradient(to right, #4b0082, #0000ff, #00ff00, #ffff00, #ff0000);
            position: relative;
            margin-top: 10px;
            border-radius: 4px;
        }
        
        .spec-line {
            position: absolute;
            top: 0; height: 100%; width: 2px;
            background: #000;
            left: 50%;
            transition: left 0.1s linear;
        }
        
    </style>
</head>
<body>

<div class="container">
    <a href="../index.html" class="gallery-back">‚Üê Back to Gallery</a>
    <h1>Radial Velocity (Wobble) Method</h1>
    <p>Detecting exoplanets by the Doppler shift of the star's spectrum as it wobbles around the center of mass.</p>
    
    <div class="viz-split">
        <div>
            <h3>Top-Down Orbit</h3>
            <canvas id="orbit" width="400" height="400"></canvas>
        </div>
        <div>
            <h3>Radial Velocity Graph</h3>
            <canvas id="graph" width="400" height="400"></canvas>
            
            <div style="text-align:left; margin-top:10px;">
                <strong>Observed Spectrum:</strong>
                <div class="spectrum-bar">
                    <div class="spec-line" id="line1" style="left:20%"></div>
                    <div class="spec-line" id="line2" style="left:50%"></div>
                    <div class="spec-line" id="line3" style="left:80%"></div>
                </div>
                <div style="display:flex; justify-content:space-between; color:#888;">
                    <span>Blue Shift (Towards)</span>
                    <span>Red Shift (Away)</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const ctx1 = document.getElementById('orbit').getContext('2d');
    const ctx2 = document.getElementById('graph').getContext('2d');
    
    // Physics
    // Star Mass M, Planet Mass m
    // Radii R_star = a * (m / (M+m)), R_planet = a * (M / (M+m))
    // For visual, we exaggerate wobble.
    
    const cx = 200, cy = 200;
    const R_star = 30; // Orbit radius of star
    const R_planet = 120; // Orbit radius of planet
    
    let angle = 0;
    let history = []; // Radial velocity history
    
    function loop() {
        angle += 0.03;
        
        // 1. Orbit View
        ctx1.clearRect(0, 0, 400, 400);
        
        // Center of Mass (+)
        ctx1.strokeStyle = '#555';
        ctx1.setLineDash([5,5]);
        ctx1.beginPath(); ctx1.moveTo(cx-10, cy); ctx1.lineTo(cx+10, cy); ctx1.stroke();
        ctx1.beginPath(); ctx1.moveTo(cx, cy-10); ctx1.lineTo(cx, cy+10); ctx1.stroke();
        ctx1.setLineDash([]);
        
        // Star Position
        const sx = cx + R_star * Math.cos(angle);
        const sy = cy + R_star * Math.sin(angle);
        
        // Planet Position (Opposite)
        const px = cx + R_planet * Math.cos(angle + Math.PI);
        const py = cy + R_planet * Math.sin(angle + Math.PI);
        
        // Draw Orbits
        ctx1.strokeStyle = '#333';
        ctx1.beginPath(); ctx1.arc(cx, cy, R_star, 0, Math.PI*2); ctx1.stroke();
        ctx1.beginPath(); ctx1.arc(cx, cy, R_planet, 0, Math.PI*2); ctx1.stroke();
        
        // Draw Bodies
        ctx1.fillStyle = '#fcd34d'; // Star
        ctx1.beginPath(); ctx1.arc(sx, sy, 15, 0, Math.PI*2); ctx1.fill();
        
        ctx1.fillStyle = '#3b82f6'; // Planet
        ctx1.beginPath(); ctx1.arc(px, py, 8, 0, Math.PI*2); ctx1.fill();
        
        // Observer is at Bottom (y+) looking up? Or Right?
        // Let's say observer is at Bottom (y = 1000).
        // Radial velocity = dy/dt of star.
        // y = R * sin(angle). vy = R * cos(angle) * omega.
        // Actually positive Y is down in canvas. Observer at bottom.
        // Star moving down (increasing y) = moving TOWARDS observer? No, away?
        // If observer is at y=1000, and star y increases, dist decreases -> Towards -> Blue shift.
        // Wait, y increases -> moving towards bottom. Yes.
        
        // Velocity vector
        const vx = -R_star * Math.sin(angle);
        const vy = R_star * Math.cos(angle);
        
        // Draw velocity vector on star
        ctx1.strokeStyle = '#ef4444';
        ctx1.beginPath(); ctx1.moveTo(sx, sy); ctx1.lineTo(sx + vx*2, sy + vy*2); ctx1.stroke();
        
        // Radial Velocity (Component along Y)
        // RV > 0 (Moving down/Towards) -> Blue Shift
        // RV < 0 (Moving up/Away) -> Red Shift
        const rv = vy; 
        
        // Update Spectrum
        // Shift lines proportional to rv
        const shift = rv * 0.5; // pixels
        document.getElementById('line1').style.transform = `translateX(${-shift}px)`;
        document.getElementById('line2').style.transform = `translateX(${-shift}px)`;
        document.getElementById('line3').style.transform = `translateX(${-shift}px)`;
        
        // 2. Graph
        history.push(rv);
        if (history.length > 200) history.shift();
        
        ctx2.clearRect(0, 0, 400, 400);
        ctx2.strokeStyle = '#555';
        ctx2.beginPath(); ctx2.moveTo(0, 200); ctx2.lineTo(400, 200); ctx2.stroke(); // Zero line
        
        ctx2.strokeStyle = '#fcd34d'; // Star curve
        ctx2.lineWidth = 2;
        ctx2.beginPath();
        history.forEach((v, i) => {
            const x = i * 2;
            const y = 200 - v * 2; // Flip so + is up on graph
            if (i===0) ctx2.moveTo(x, y);
            else ctx2.lineTo(x, y);
        });
        ctx2.stroke();
        
        // Labels
        ctx2.fillStyle = '#fff';
        ctx2.fillText("Away (Red Shift)", 10, 50);
        ctx2.fillText("Towards (Blue Shift)", 10, 350);
        
        requestAnimationFrame(loop);
    }
    
    requestAnimationFrame(loop);

</script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
