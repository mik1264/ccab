<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exoplanet Transit - CCAB</title>
    <link rel="stylesheet" href="../assets/css/gallery-standard.css">
    <style>
        body {
            background: #000;
            color: #ddd;
            font-family: system-ui;
            padding: 2rem;
            text-align: center;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        
        .viz-split {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        canvas {
            border: 1px solid #333;
            background: #111;
            border-radius: 8px;
        }
        
        .controls {
            background: #222;
            padding: 20px;
            border-radius: 8px;
            display: inline-block;
        }
        
        label { margin-right: 10px; font-weight: bold; }
        input[type=range] { vertical-align: middle; }
        
    </style>
</head>
<body>

<div class="container">
    <a href="../index.html" class="gallery-back">‚Üê Back to Gallery</a>
    <h1>Exoplanet Transit Method</h1>
    <p>Detecting planets by the dip in brightness as they cross their star.</p>
    
    <div class="viz-split">
        <div>
            <h3>Star View</h3>
            <canvas id="star-view" width="400" height="400"></canvas>
        </div>
        <div>
            <h3>Light Curve (Flux)</h3>
            <canvas id="graph-view" width="400" height="400"></canvas>
        </div>
    </div>
    
    <div class="controls">
        <label>Planet Size</label>
        <input type="range" id="size" min="5" max="50" value="20">
        
        <label>Orbital Speed</label>
        <input type="range" id="speed" min="1" max="10" value="3">
        
        <label>Impact Parameter (Y-offset)</label>
        <input type="range" id="impact" min="0" max="150" value="0">
    </div>
</div>

<script>
    const cvsStar = document.getElementById('star-view');
    const ctxStar = cvsStar.getContext('2d');
    const cvsGraph = document.getElementById('graph-view');
    const ctxGraph = cvsGraph.getContext('2d');
    
    // Config
    const STAR_R = 150;
    
    // State
    let planetR = 20;
    let speed = 3;
    let impactY = 0;
    
    let planetX = -200;
    let fluxHistory = [];
    
    function update() {
        planetR = parseInt(document.getElementById('size').value);
        speed = parseInt(document.getElementById('speed').value);
        impactY = parseInt(document.getElementById('impact').value);
    }
    
    ['size', 'speed', 'impact'].forEach(id => document.getElementById(id).addEventListener('input', update));
    
    function loop() {
        // 1. Star View
        ctxStar.clearRect(0, 0, 400, 400);
        
        // Draw Star
        ctxStar.fillStyle = '#fcd34d'; // Yellow
        ctxStar.beginPath(); ctxStar.arc(200, 200, STAR_R, 0, Math.PI*2); ctxStar.fill();
        
        // Limb Darkening (Gradient)
        const grad = ctxStar.createRadialGradient(200, 200, STAR_R*0.5, 200, 200, STAR_R);
        grad.addColorStop(0, 'rgba(0,0,0,0)');
        grad.addColorStop(1, 'rgba(0,0,0,0.3)');
        ctxStar.fillStyle = grad;
        ctxStar.fill();
        
        // Update Planet
        planetX += speed;
        if (planetX > 600) {
            planetX = -200;
            fluxHistory = []; // Reset graph on loop?
        }
        
        // Draw Planet
        const py = 200 + impactY;
        ctxStar.fillStyle = '#000';
        ctxStar.beginPath(); ctxStar.arc(planetX, py, planetR, 0, Math.PI*2); ctxStar.fill();
        
        // 2. Calculate Flux
        // Area overlap
        const d = Math.hypot(planetX - 200, py - 200);
        let blocked = 0;
        
        if (d >= STAR_R + planetR) {
            blocked = 0;
        } else if (d <= STAR_R - planetR) {
            // Fully inside
            blocked = Math.PI * planetR * planetR;
        } else {
            // Partial overlap (Circle-Circle Intersection)
            const r1 = STAR_R;
            const r2 = planetR;
            const d2 = d*d;
            const r1sq = r1*r1;
            const r2sq = r2*r2;
            
            const angle1 = Math.acos((r1sq + d2 - r2sq) / (2 * r1 * d));
            const angle2 = Math.acos((r2sq + d2 - r1sq) / (2 * r2 * d));
            
            const area1 = r1sq * angle1 - 0.5 * r1sq * Math.sin(2 * angle1);
            const area2 = r2sq * angle2 - 0.5 * r2sq * Math.sin(2 * angle2);
            
            blocked = area1 + area2;
        }
        
        const totalArea = Math.PI * STAR_R * STAR_R;
        const flux = 1.0 - (blocked / totalArea);
        
        // Record
        fluxHistory.push({x: planetX, y: flux});
        if (fluxHistory.length > 800) fluxHistory.shift(); // Keep buffer
        
        // 3. Graph View
        ctxGraph.clearRect(0, 0, 400, 400);
        
        // Axes
        ctxGraph.strokeStyle = '#555';
        ctxGraph.beginPath();
        ctxGraph.moveTo(0, 350); ctxGraph.lineTo(400, 350); // X (Time)
        ctxGraph.moveTo(50, 0); ctxGraph.lineTo(50, 400); // Y (Flux)
        ctxGraph.stroke();
        
        // Base line 1.0
        const baseY = 50; 
        const scaleY = 2000; // Amplify dip
        
        ctxGraph.strokeStyle = '#fff';
        ctxGraph.setLineDash([5,5]);
        ctxGraph.beginPath(); ctxGraph.moveTo(0, baseY); ctxGraph.lineTo(400, baseY); ctxGraph.stroke();
        ctxGraph.setLineDash([]);
        
        // Plot
        ctxGraph.strokeStyle = '#fcd34d';
        ctxGraph.lineWidth = 2;
        ctxGraph.beginPath();
        
        // Map planetX (-200 to 600) to graph X (0 to 400) -> scale 0.5
        fluxHistory.forEach((p, i) => {
            const gx = (p.x + 200) * 0.5;
            const gy = baseY + (1.0 - p.y) * scaleY;
            
            if (i===0) ctxGraph.moveTo(gx, gy);
            else ctxGraph.lineTo(gx, gy);
        });
        ctxGraph.stroke();
        
        // Current point
        const cx = (planetX + 200) * 0.5;
        const cy = baseY + (1.0 - flux) * scaleY;
        ctxGraph.fillStyle = '#ef4444';
        ctxGraph.beginPath(); ctxGraph.arc(cx, cy, 4, 0, Math.PI*2); ctxGraph.fill();
        
        // Label
        ctxGraph.fillStyle = '#fff';
        ctxGraph.fillText(`Flux: ${(flux*100).toFixed(2)}%`, 300, 30);
        
        requestAnimationFrame(loop);
    }
    
    requestAnimationFrame(loop);

</script>
</body>
</html>
