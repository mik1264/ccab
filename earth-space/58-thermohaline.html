<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ocean Circulation - CCAB</title>
    <link rel="stylesheet" href="../assets/css/gallery-standard.css">
    <style>
        body {
            background: #0f172a;
            color: #ddd;
            font-family: system-ui;
            padding: 2rem;
            text-align: center;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        
        .map-container {
            position: relative;
            width: 800px;
            height: 400px;
            margin: 20px auto;
            background: #1e293b; /* Ocean base */
            border: 2px solid #334155;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .land {
            position: absolute;
            background: #3f3f46; /* Grey Land */
            border-radius: 4px;
        }
        
        canvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
        }
        .line { width: 30px; height: 4px; display: inline-block; vertical-align: middle; margin-right: 5px; }
        
    </style>
</head>
<body>

<div class="container">
    <a href="../index.html" class="gallery-back">‚Üê Back to Gallery</a>
    <h1>Thermohaline Circulation</h1>
    <p>The Global Ocean Conveyor Belt driven by temperature and salinity.</p>
    
    <div class="map-container">
        <!-- Crude World Map -->
        <div class="land" style="top:50px; left:50px; width:150px; height:100px;">North America</div>
        <div class="land" style="top:200px; left:100px; width:100px; height:150px;">South America</div>
        <div class="land" style="top:50px; left:350px; width:150px; height:100px;">Europe</div>
        <div class="land" style="top:150px; left:350px; width:150px; height:150px;">Africa</div>
        <div class="land" style="top:50px; left:550px; width:200px; height:150px;">Asia</div>
        <div class="land" style="top:300px; left:600px; width:100px; height:80px;">Australia</div>
        <div class="land" style="bottom:0px; left:100px; width:600px; height:40px;">Antarctica</div>
        
        <canvas id="canvas" width="800" height="400"></canvas>
    </div>
    
    <div class="legend">
        <span><div class="line" style="background:#ef4444"></div> Surface (Warm)</span>
        <span><div class="line" style="background:#3b82f6"></div> Deep (Cold/Salty)</span>
    </div>
    
    <button onclick="toggleFlow()" style="padding:10px 20px; margin-top:20px; cursor:pointer;">Toggle Flow</button>
</div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    let particles = [];
    let flowing = true;
    
    // Path points (Approximate Conveyor Belt)
    // Gulf Stream -> N. Atlantic -> Sink -> Deep South -> Antarctic Circumpolar -> Indian/Pacific -> Upwell -> Surface Return
    
    // Coordinates
    const path = [
        // Surface
        {x: 200, y: 250, type: 'surface'}, // Pacific start
        {x: 100, y: 200, type: 'surface'},
        {x: 250, y: 150, type: 'surface'}, // Atlantic
        {x: 300, y: 50, type: 'surface'}, // North Atlantic (Sink point)
        
        // Deep (Reverse)
        {x: 300, y: 50, type: 'deep'},
        {x: 280, y: 200, type: 'deep'}, // Atlantic Deep
        {x: 300, y: 350, type: 'deep'}, // Antarctic
        {x: 500, y: 350, type: 'deep'}, // Indian Ocean
        {x: 700, y: 350, type: 'deep'}, // Pacific
        
        // Upwell
        {x: 700, y: 200, type: 'surface'}, // Pacific Surface
        {x: 500, y: 250, type: 'surface'}, // Indian Surface
        {x: 300, y: 350, type: 'surface'}, // Back to loop start?
        // Loop back to start
        {x: 200, y: 250, type: 'surface'} 
    ];
    
    // Interpolate points for smoother path
    // Or just move particle towards next target
    
    function init() {
        for(let i=0; i<100; i++) {
            particles.push({
                x: path[0].x,
                y: path[0].y,
                targetIdx: 1,
                type: 'surface',
                offset: Math.random() * 10
            });
            
            // Scatter start positions along path?
            // Actually simpler to just let them flow from start
            // To fill the loop, randomize initial targetIdx
            const p = particles[i];
            p.targetIdx = Math.floor(Math.random() * (path.length-1));
            p.x = path[p.targetIdx].x;
            p.y = path[p.targetIdx].y;
            p.type = path[p.targetIdx].type;
        }
        requestAnimationFrame(loop);
    }
    
    function toggleFlow() { flowing = !flowing; }
    
    function loop() {
        ctx.clearRect(0, 0, 800, 400);
        
        // Draw Path Line (Background)
        ctx.lineWidth = 2;
        // Surface
        ctx.strokeStyle = 'rgba(239, 68, 68, 0.3)';
        ctx.beginPath();
        let penDown = false;
        path.forEach(pt => {
            if (pt.type === 'surface') {
                if(!penDown) { ctx.moveTo(pt.x, pt.y); penDown = true; }
                else ctx.lineTo(pt.x, pt.y);
            } else {
                penDown = false;
            }
        });
        ctx.stroke();
        
        // Deep
        ctx.strokeStyle = 'rgba(59, 130, 246, 0.3)';
        ctx.beginPath();
        penDown = false;
        path.forEach(pt => {
            if (pt.type === 'deep') {
                if(!penDown) { ctx.moveTo(pt.x, pt.y); penDown = true; }
                else ctx.lineTo(pt.x, pt.y);
            } else {
                penDown = false;
            }
        });
        ctx.stroke();
        
        // Particles
        particles.forEach(p => {
            if (flowing) {
                const target = path[p.targetIdx];
                const dx = target.x - p.x;
                const dy = target.y - p.y;
                const dist = Math.hypot(dx, dy);
                
                if (dist < 2) {
                    // Reached target
                    p.x = target.x;
                    p.y = target.y;
                    p.targetIdx = (p.targetIdx + 1) % path.length;
                    p.type = path[p.targetIdx].type; // Update type for next segment
                } else {
                    // Move
                    const speed = 1.0;
                    p.x += (dx/dist) * speed;
                    p.y += (dy/dist) * speed;
                }
            }
            
            // Draw
            ctx.fillStyle = p.type === 'surface' ? '#ef4444' : '#3b82f6';
            ctx.beginPath(); 
            // Jiggle
            const jx = p.x + Math.sin(Date.now()*0.01 + p.offset)*2;
            const jy = p.y + Math.cos(Date.now()*0.01 + p.offset)*2;
            ctx.arc(jx, jy, 3, 0, Math.PI*2); 
            ctx.fill();
        });
        
        // Sinking/Upwelling markers
        // North Atlantic Sink
        ctx.fillStyle = '#fff';
        ctx.font = '12px Arial';
        ctx.fillText("Sink (Cooling)", 310, 50);
        
        requestAnimationFrame(loop);
    }
    
    init();

</script>
</body>
</html>
