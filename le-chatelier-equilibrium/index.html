<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Le Chatelier's Principle</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
canvas { display: block; }
.title-overlay {
    position: fixed; top: 50px; left: 50%; transform: translateX(-50%);
    color: #fbbf24; font-size: 20px; font-weight: 600; z-index: 998;
    text-shadow: 0 0 10px rgba(251,191,36,0.5); pointer-events: none;
}
.controls {
    position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
    display: flex; gap: 10px; align-items: center; z-index: 999;
    background: rgba(0,0,0,0.7); padding: 12px 20px; border-radius: 12px;
    border: 1px solid rgba(251,191,36,0.3); flex-wrap: wrap; justify-content: center;
}
.controls button {
    background: rgba(251,191,36,0.15); color: #fbbf24; border: 1px solid rgba(251,191,36,0.4);
    padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;
    transition: all 0.2s;
}
.controls button:hover { background: rgba(251,191,36,0.4); }
.controls button.reactant { color: #4a9eff; border-color: rgba(74,158,255,0.5); background: rgba(74,158,255,0.15); }
.controls button.product { color: #22c55e; border-color: rgba(34,197,94,0.5); background: rgba(34,197,94,0.15); }
.controls button.temp { color: #ff4a6a; border-color: rgba(255,74,106,0.5); background: rgba(255,74,106,0.15); }
.controls span { color: #555; font-size: 12px; }
</style>
</head>
<body>
<a href="../index.html" style="position:fixed;top:10px;left:10px;padding:8px 16px;background:rgba(0,0,0,0.7);color:#fbbf24;text-decoration:none;border-radius:6px;font-size:14px;z-index:999;font-family:sans-serif;">← Back to Gallery</a>
<div class="title-overlay">Le Chatelier's Principle: Dynamic Equilibrium</div>
<div class="controls">
    <button class="reactant" id="addReactant">+5 Reactants</button>
    <button class="reactant" id="removeReactant">-5 Reactants</button>
    <span>|</span>
    <button class="product" id="addProduct">+5 Products</button>
    <button class="product" id="removeProduct">-5 Products</button>
    <span>|</span>
    <button class="temp" id="heatUp">Heat ↑</button>
    <button class="temp" id="coolDown">Cool ↓</button>
    <span>|</span>
    <button id="resetBtn">Reset</button>
</div>
<canvas id="canvas"></canvas>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let W, H;

function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
    dividerX = W / 2;
    wellW = W / 2;
}
resize();
window.addEventListener('resize', resize);

let dividerX;
let wellW;
let temperature = 50;
let particles = [];
let kForward = 0.003;
let kReverse = 0.003;
let Keq = 1;
let keqHistory = [];
let reactantHistory = [];
let productHistory = [];
let frame = 0;
let disturbance = '';
let disturbanceTimer = 0;

class Particle {
    constructor(side) {
        this.side = side; // 'reactant' or 'product'
        if (side === 'reactant') {
            this.x = Math.random() * (dividerX - 40) + 20;
        } else {
            this.x = dividerX + Math.random() * (W - dividerX - 40) + 20;
        }
        this.y = 100 + Math.random() * (H - 250);
        const speed = 1.5 + Math.random() * 2 * (temperature / 50);
        const angle = Math.random() * Math.PI * 2;
        this.vx = Math.cos(angle) * speed;
        this.vy = Math.sin(angle) * speed;
        this.r = 7;
        this.flash = 0;
        this.wobble = Math.random() * Math.PI * 2;
    }

    get color() {
        return this.side === 'reactant' ? '#4a9eff' : '#22c55e';
    }
}

function init() {
    particles = [];
    temperature = 50;
    keqHistory = [];
    reactantHistory = [];
    productHistory = [];
    disturbance = '';
    disturbanceTimer = 0;

    for (let i = 0; i < 30; i++) particles.push(new Particle('reactant'));
    for (let i = 0; i < 30; i++) particles.push(new Particle('product'));
}
init();

function addParticles(side, count) {
    for (let i = 0; i < Math.abs(count); i++) {
        if (count > 0) {
            particles.push(new Particle(side));
        } else {
            const idx = particles.findIndex(p => p.side === side);
            if (idx > -1) particles.splice(idx, 1);
        }
    }
}

document.getElementById('addReactant').addEventListener('click', () => {
    addParticles('reactant', 5);
    disturbance = 'Added reactants - system shifts RIGHT toward products';
    disturbanceTimer = 180;
});
document.getElementById('removeReactant').addEventListener('click', () => {
    addParticles('reactant', -5);
    disturbance = 'Removed reactants - system shifts LEFT toward reactants';
    disturbanceTimer = 180;
});
document.getElementById('addProduct').addEventListener('click', () => {
    addParticles('product', 5);
    disturbance = 'Added products - system shifts LEFT toward reactants';
    disturbanceTimer = 180;
});
document.getElementById('removeProduct').addEventListener('click', () => {
    addParticles('product', -5);
    disturbance = 'Removed products - system shifts RIGHT toward products';
    disturbanceTimer = 180;
});
document.getElementById('heatUp').addEventListener('click', () => {
    temperature = Math.min(100, temperature + 15);
    for (let p of particles) {
        p.vx *= 1.3;
        p.vy *= 1.3;
    }
    disturbance = 'Temperature increased - endothermic direction favored';
    disturbanceTimer = 180;
});
document.getElementById('coolDown').addEventListener('click', () => {
    temperature = Math.max(10, temperature - 15);
    for (let p of particles) {
        p.vx *= 0.7;
        p.vy *= 0.7;
    }
    disturbance = 'Temperature decreased - exothermic direction favored';
    disturbanceTimer = 180;
});
document.getElementById('resetBtn').addEventListener('click', init);

function update() {
    frame++;
    if (disturbanceTimer > 0) disturbanceTimer--;

    const speedFactor = temperature / 50;
    kForward = 0.002 * speedFactor;
    kReverse = 0.002 * speedFactor;

    // Temperature affects equilibrium (endothermic forward)
    if (temperature > 50) {
        kForward *= 1 + (temperature - 50) / 100;
    } else {
        kReverse *= 1 + (50 - temperature) / 100;
    }

    for (let p of particles) {
        p.wobble += 0.05;
        p.x += p.vx;
        p.y += p.vy;
        if (p.flash > 0) p.flash *= 0.92;

        const leftBound = p.side === 'reactant' ? 10 : dividerX + 10;
        const rightBound = p.side === 'reactant' ? dividerX - 10 : W - 10;

        if (p.x < leftBound + p.r) { p.x = leftBound + p.r; p.vx *= -1; }
        if (p.x > rightBound - p.r) { p.x = rightBound - p.r; p.vx *= -1; }
        if (p.y < 80 + p.r) { p.y = 80 + p.r; p.vy *= -1; }
        if (p.y > H - 100 - p.r) { p.y = H - 100 - p.r; p.vy *= -1; }

        // Conversion at the barrier (near divider)
        if (p.side === 'reactant' && p.x > dividerX - 30) {
            if (Math.random() < kForward) {
                p.side = 'product';
                p.x = dividerX + 30;
                p.flash = 1;
            }
        } else if (p.side === 'product' && p.x < dividerX + 30) {
            if (Math.random() < kReverse) {
                p.side = 'reactant';
                p.x = dividerX - 30;
                p.flash = 1;
            }
        }
    }

    // Record history
    if (frame % 5 === 0) {
        const rCount = particles.filter(p => p.side === 'reactant').length;
        const pCount = particles.filter(p => p.side === 'product').length;
        Keq = rCount > 0 ? pCount / rCount : Infinity;
        keqHistory.push(Keq);
        reactantHistory.push(rCount);
        productHistory.push(pCount);
        if (keqHistory.length > 200) {
            keqHistory.shift();
            reactantHistory.shift();
            productHistory.shift();
        }
    }
}

function drawEnergyWell() {
    // Left well (reactants)
    ctx.fillStyle = 'rgba(74, 158, 255, 0.03)';
    ctx.fillRect(0, 80, dividerX, H - 180);

    // Right well (products)
    ctx.fillStyle = 'rgba(34, 197, 94, 0.03)';
    ctx.fillRect(dividerX, 80, W - dividerX, H - 180);

    // Energy barrier (divider)
    const barrierGrad = ctx.createLinearGradient(dividerX - 20, 0, dividerX + 20, 0);
    barrierGrad.addColorStop(0, 'rgba(251,191,36,0)');
    barrierGrad.addColorStop(0.5, 'rgba(251,191,36,0.15)');
    barrierGrad.addColorStop(1, 'rgba(251,191,36,0)');
    ctx.fillStyle = barrierGrad;
    ctx.fillRect(dividerX - 20, 80, 40, H - 180);

    // Barrier line
    ctx.strokeStyle = 'rgba(251,191,36,0.3)';
    ctx.lineWidth = 2;
    ctx.setLineDash([6, 6]);
    ctx.beginPath();
    ctx.moveTo(dividerX, 80);
    ctx.lineTo(dividerX, H - 100);
    ctx.stroke();
    ctx.setLineDash([]);

    // Labels
    ctx.fillStyle = 'rgba(74, 158, 255, 0.5)';
    ctx.font = 'bold 18px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('REACTANTS', dividerX / 2, H - 115);

    ctx.fillStyle = 'rgba(34, 197, 94, 0.5)';
    ctx.fillText('PRODUCTS', dividerX + (W - dividerX) / 2, H - 115);

    ctx.fillStyle = 'rgba(251,191,36,0.4)';
    ctx.font = '11px sans-serif';
    ctx.fillText('⇌ Barrier', dividerX, H - 115);

    // Arrows showing equilibrium direction
    const rCount = particles.filter(p => p.side === 'reactant').length;
    const pCount = particles.filter(p => p.side === 'product').length;
    const forwardSize = Math.min(30, Math.max(8, rCount * 0.5));
    const reverseSize = Math.min(30, Math.max(8, pCount * 0.5));

    // Forward arrow
    ctx.fillStyle = `rgba(34, 197, 94, ${0.3 + forwardSize / 60})`;
    ctx.beginPath();
    ctx.moveTo(dividerX + 5, H / 2 - 30);
    ctx.lineTo(dividerX + 5 + forwardSize, H / 2 - 30);
    ctx.lineTo(dividerX + 5 + forwardSize, H / 2 - 35);
    ctx.lineTo(dividerX + 15 + forwardSize, H / 2 - 25);
    ctx.lineTo(dividerX + 5 + forwardSize, H / 2 - 15);
    ctx.lineTo(dividerX + 5 + forwardSize, H / 2 - 20);
    ctx.lineTo(dividerX + 5, H / 2 - 20);
    ctx.closePath();
    ctx.fill();

    // Reverse arrow
    ctx.fillStyle = `rgba(74, 158, 255, ${0.3 + reverseSize / 60})`;
    ctx.beginPath();
    ctx.moveTo(dividerX - 5, H / 2 + 20);
    ctx.lineTo(dividerX - 5 - reverseSize, H / 2 + 20);
    ctx.lineTo(dividerX - 5 - reverseSize, H / 2 + 15);
    ctx.lineTo(dividerX - 15 - reverseSize, H / 2 + 25);
    ctx.lineTo(dividerX - 5 - reverseSize, H / 2 + 35);
    ctx.lineTo(dividerX - 5 - reverseSize, H / 2 + 30);
    ctx.lineTo(dividerX - 5, H / 2 + 30);
    ctx.closePath();
    ctx.fill();
}

function drawGraph() {
    const gx = 20, gy = 80, gw = 240, gh = 120;

    ctx.fillStyle = 'rgba(0,0,0,0.6)';
    ctx.beginPath();
    ctx.roundRect(gx, gy, gw, gh + 30, 10);
    ctx.fill();
    ctx.strokeStyle = 'rgba(255,255,255,0.15)';
    ctx.stroke();

    ctx.fillStyle = '#aaa';
    ctx.font = '11px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('Concentrations Over Time', gx + gw / 2, gy + 14);

    if (reactantHistory.length > 1) {
        const maxVal = Math.max(Math.max(...reactantHistory), Math.max(...productHistory), 1);

        // Reactants
        ctx.beginPath();
        ctx.strokeStyle = '#4a9eff';
        ctx.lineWidth = 2;
        for (let i = 0; i < reactantHistory.length; i++) {
            const x = gx + 10 + (i / 200) * (gw - 20);
            const y = gy + gh + 5 - (reactantHistory[i] / maxVal) * (gh - 20);
            if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
        }
        ctx.stroke();

        // Products
        ctx.beginPath();
        ctx.strokeStyle = '#22c55e';
        ctx.lineWidth = 2;
        for (let i = 0; i < productHistory.length; i++) {
            const x = gx + 10 + (i / 200) * (gw - 20);
            const y = gy + gh + 5 - (productHistory[i] / maxVal) * (gh - 20);
            if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
        }
        ctx.stroke();
    }

    ctx.font = '10px sans-serif';
    ctx.textAlign = 'left';
    ctx.fillStyle = '#4a9eff'; ctx.fillText('— Reactants', gx + 10, gy + gh + 22);
    ctx.fillStyle = '#22c55e'; ctx.fillText('— Products', gx + 110, gy + gh + 22);
}

function draw() {
    ctx.fillStyle = 'rgba(10, 14, 26, 0.25)';
    ctx.fillRect(0, 0, W, H);

    drawEnergyWell();

    // Draw particles
    for (let p of particles) {
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
        ctx.fillStyle = p.color;
        ctx.fill();

        if (p.flash > 0.1) {
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.r + 10 * p.flash, 0, Math.PI * 2);
            ctx.strokeStyle = `rgba(251, 191, 36, ${p.flash * 0.6})`;
            ctx.lineWidth = 2;
            ctx.stroke();
        }
    }

    drawGraph();

    // Keq display
    const rCount = particles.filter(p => p.side === 'reactant').length;
    const pCount = particles.filter(p => p.side === 'product').length;

    ctx.fillStyle = 'rgba(0,0,0,0.6)';
    ctx.beginPath();
    ctx.roundRect(W - 200, 80, 180, 80, 10);
    ctx.fill();
    ctx.strokeStyle = 'rgba(255,255,255,0.15)';
    ctx.stroke();

    ctx.fillStyle = '#fbbf24';
    ctx.font = 'bold 14px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('Equilibrium', W - 110, 100);

    ctx.font = '13px sans-serif';
    ctx.fillStyle = '#ccc';
    ctx.fillText(`Keq = [P]/[R] = ${Keq === Infinity ? '∞' : Keq.toFixed(2)}`, W - 110, 120);
    ctx.fillText(`R: ${rCount}  P: ${pCount}  T: ${temperature.toFixed(0)}`, W - 110, 140);

    // Temperature indicator
    const tempBarX = W - 200, tempBarY = 170, tempBarW = 180, tempBarH = 10;
    ctx.fillStyle = 'rgba(0,0,0,0.5)';
    ctx.fillRect(tempBarX, tempBarY, tempBarW, tempBarH);
    const tempFrac = temperature / 100;
    const tempGrad = ctx.createLinearGradient(tempBarX, 0, tempBarX + tempBarW, 0);
    tempGrad.addColorStop(0, '#4a9eff');
    tempGrad.addColorStop(0.5, '#fbbf24');
    tempGrad.addColorStop(1, '#ff4a6a');
    ctx.fillStyle = tempGrad;
    ctx.fillRect(tempBarX, tempBarY, tempBarW * tempFrac, tempBarH);
    ctx.fillStyle = '#888';
    ctx.font = '10px sans-serif';
    ctx.textAlign = 'left';
    ctx.fillText('Cold', tempBarX, tempBarY + 22);
    ctx.textAlign = 'right';
    ctx.fillText('Hot', tempBarX + tempBarW, tempBarY + 22);

    // Disturbance message
    if (disturbanceTimer > 0) {
        const alpha = Math.min(1, disturbanceTimer / 60);
        ctx.fillStyle = `rgba(251, 191, 36, ${alpha * 0.9})`;
        ctx.font = 'bold 14px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText(disturbance, W / 2, 78);
    }
}

function animate() {
    update();
    draw();
    requestAnimationFrame(animate);
}
animate();
</script>
</body>
</html>
