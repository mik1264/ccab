<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temperature Gradient Tree - Autumn Leaf Visualizations</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: linear-gradient(180deg, #1e3a5f 0%, #2a5298 50%, #4a7ba7 100%);
            font-family: 'Arial', sans-serif;
        }
        canvas {
            display: block;
        }
        .controls {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        h3 {
            margin-top: 0;
            color: #2a5298;
        }
        .temp-display {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin: 15px 0;
            padding: 10px;
            background: linear-gradient(90deg, #3498db, #e74c3c);
            color: white;
            border-radius: 5px;
        }
        button {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
        }
        .btn-cold {
            background: #3498db;
            color: white;
        }
        .btn-cold:hover {
            background: #2980b9;
        }
        .btn-warm {
            background: #e74c3c;
            color: white;
        }
        .btn-warm:hover {
            background: #c0392b;
        }
    </style>
</head>
<body>
<!--
# Goal
Visualize how temperature gradients affect different parts of a tree,
showing that leaves in different positions experience different temperatures
and thus change color at different rates.

# Approach
- Create a tree with leaves at various heights and positions
- Apply temperature gradient: colder at top, warmer at bottom
- Each leaf's chemistry responds to local temperature
- Visual heat map overlay showing temperature zones
- Higher/outer leaves turn color first (colder)
- Lower/inner leaves remain green longer (warmer)
- User can adjust base temperature to see effects

# Technical Implementation
- Canvas 2D with procedural tree generation
- Temperature as a function of height and distance from trunk
- Individual leaf agents with position-dependent temperature exposure
- Color heat map visualization for temperature zones
- Real-time update of all leaf colors based on local conditions
-->

<canvas id="canvas"></canvas>
<div class="controls">
    <h3>Temperature Gradient</h3>
    <div class="temp-display" id="temp-display">15°C</div>
    <button class="btn-cold" id="btn-cold">Make Colder (-5°C)</button>
    <button class="btn-warm" id="btn-warm">Make Warmer (+5°C)</button>
    <button id="btn-toggle-heatmap" style="background: #9b59b6; color: white;">Toggle Heat Map</button>
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let baseTemperature = 15;
let showHeatMap = false;

class Leaf {
    constructor(x, y, height) {
        this.x = x;
        this.y = y;
        this.height = height; // Distance from ground
        this.distanceFromCenter = Math.abs(x - canvas.width / 2);
        this.size = 5 + Math.random() * 3;

        this.chlorophyll = 80 + Math.random() * 20;
        this.carotene = 50 + Math.random() * 40;
        this.anthocyanin = 0;
        this.sugar = 30 + Math.random() * 40;
        this.water = 70 + Math.random() * 20;
    }

    getLocalTemperature() {
        // Temperature decreases with height (higher = colder)
        const heightFactor = (canvas.height - this.y) / canvas.height;
        const heightEffect = heightFactor * 10; // Up to 10°C colder at top

        // Temperature decreases with distance from trunk (outer = colder due to wind exposure)
        const distanceFactor = this.distanceFromCenter / (canvas.width / 2);
        const distanceEffect = distanceFactor * 5; // Up to 5°C colder at edges

        return baseTemperature - heightEffect - distanceEffect;
    }

    update() {
        const localTemp = this.getLocalTemperature();

        // Chlorophyll degrades in cold
        if (localTemp < 15) {
            this.chlorophyll -= (15 - localTemp) * 0.15;
        } else if (localTemp > 15) {
            // Regenerates in warmth
            this.chlorophyll += 0.1;
        }

        // Anthocyanin production in cold with sugar and water
        if (localTemp < 15 && this.sugar > 5 && this.water > 5) {
            const production = (15 - localTemp) * 0.1;
            this.anthocyanin += production;
            this.sugar -= production * 0.3;
            this.water -= production * 0.3;
        }

        // Natural decay
        this.sugar = Math.max(0, this.sugar - 0.05);
        this.water = Math.max(0, this.water - 0.02);

        // Clamp values
        this.chlorophyll = Math.max(0, Math.min(100, this.chlorophyll));
        this.anthocyanin = Math.max(0, Math.min(100, this.anthocyanin));
        this.sugar = Math.max(0, Math.min(100, this.sugar));
        this.water = Math.max(0, Math.min(100, this.water));
    }

    getColor() {
        const chloroRatio = this.chlorophyll / 100;
        const caroteRatio = this.carotene / 100;
        const anthocRatio = this.anthocyanin / 100;

        if (chloroRatio > 0.5) {
            // Green
            const intensity = 50 + chloroRatio * 150;
            return `rgb(${intensity * 0.3}, ${intensity}, ${intensity * 0.3})`;
        } else {
            // Autumn colors
            const yellowInfluence = (1 - chloroRatio) * caroteRatio;
            const redInfluence = anthocRatio;

            let r, g, b;
            if (redInfluence > yellowInfluence + 0.2) {
                r = 180 + redInfluence * 75;
                g = 20 + yellowInfluence * 100;
                b = 20;
            } else if (yellowInfluence > redInfluence + 0.2) {
                r = 200 + yellowInfluence * 55;
                g = 180 + yellowInfluence * 75;
                b = 20;
            } else {
                r = 255;
                g = 100 + yellowInfluence * 100;
                b = 20;
            }

            return `rgb(${Math.floor(r)}, ${Math.floor(g)}, ${Math.floor(b)})`;
        }
    }

    draw() {
        ctx.fillStyle = this.getColor();
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();

        // Outline
        ctx.strokeStyle = 'rgba(0, 0, 0, 0.2)';
        ctx.lineWidth = 1;
        ctx.stroke();
    }
}

// Generate tree
const leaves = [];
const branches = [];

function createBranch(x, y, angle, length, depth) {
    if (depth > 9) return;
    if (length < 3) return;

    const endX = x + Math.cos(angle) * length;
    const endY = y + Math.sin(angle) * length;

    branches.push({ x1: x, y1: y, x2: endX, y2: endY, depth });

    // Add leaves at branch tips
    if (depth > 5) {
        const numLeaves = Math.floor(Math.random() * 2) + 1;
        for (let i = 0; i < numLeaves; i++) {
            const leafX = endX + (Math.random() - 0.5) * 12;
            const leafY = endY + (Math.random() - 0.5) * 12;
            const height = canvas.height - leafY;
            leaves.push(new Leaf(leafX, leafY, height));
        }
    }

    // Create child branches
    if (depth < 9) {
        const numChildren = depth < 2 ? 2 : (Math.random() > 0.6 ? 2 : 1);
        for (let i = 0; i < numChildren; i++) {
            const angleVariation = (Math.random() - 0.5) * Math.PI / 2.5;
            const newAngle = angle + angleVariation;
            const newLength = length * (0.65 + Math.random() * 0.15);
            createBranch(endX, endY, newAngle, newLength, depth + 1);
        }
    }
}

const trunkX = canvas.width / 2;
const trunkY = canvas.height - 50;
createBranch(trunkX, trunkY, -Math.PI / 2, 120, 0);

// Temperature color mapping
function getTempColor(temp) {
    if (temp < 5) return 'rgba(0, 0, 255, 0.3)'; // Very cold - blue
    if (temp < 10) return 'rgba(100, 150, 255, 0.3)'; // Cold - light blue
    if (temp < 15) return 'rgba(150, 200, 255, 0.2)'; // Cool - very light blue
    if (temp < 20) return 'rgba(255, 255, 150, 0.2)'; // Mild - light yellow
    if (temp < 25) return 'rgba(255, 200, 100, 0.3)'; // Warm - orange
    return 'rgba(255, 100, 0, 0.3)'; // Hot - red-orange
}

// Draw heat map
function drawHeatMap() {
    const gridSize = 40;

    for (let y = 0; y < canvas.height; y += gridSize) {
        for (let x = 0; x < canvas.width; x += gridSize) {
            // Calculate temperature at this position
            const heightFactor = (canvas.height - y) / canvas.height;
            const heightEffect = heightFactor * 10;
            const distanceFromCenter = Math.abs(x - canvas.width / 2);
            const distanceFactor = distanceFromCenter / (canvas.width / 2);
            const distanceEffect = distanceFactor * 5;
            const localTemp = baseTemperature - heightEffect - distanceEffect;

            ctx.fillStyle = getTempColor(localTemp);
            ctx.fillRect(x, y, gridSize, gridSize);

            // Draw temperature text
            if (x % (gridSize * 3) === 0 && y % (gridSize * 3) === 0) {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.font = '10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(`${Math.round(localTemp)}°`, x + gridSize / 2, y + gridSize / 2);
            }
        }
    }
}

// Controls
document.getElementById('btn-cold').addEventListener('click', () => {
    baseTemperature -= 5;
    baseTemperature = Math.max(-10, baseTemperature);
    updateTempDisplay();
});

document.getElementById('btn-warm').addEventListener('click', () => {
    baseTemperature += 5;
    baseTemperature = Math.min(35, baseTemperature);
    updateTempDisplay();
});

document.getElementById('btn-toggle-heatmap').addEventListener('click', () => {
    showHeatMap = !showHeatMap;
});

function updateTempDisplay() {
    document.getElementById('temp-display').textContent = `${baseTemperature}°C`;
}

// Animation
function animate() {
    // Sky gradient
    const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
    gradient.addColorStop(0, '#1e3a5f');
    gradient.addColorStop(0.5, '#2a5298');
    gradient.addColorStop(1, '#4a7ba7');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Draw heat map if enabled
    if (showHeatMap) {
        drawHeatMap();
    }

    // Ground
    ctx.fillStyle = '#5d4e37';
    ctx.fillRect(0, canvas.height - 50, canvas.width, 50);

    // Draw branches
    ctx.strokeStyle = '#3e2723';
    ctx.lineCap = 'round';
    branches.forEach(branch => {
        ctx.lineWidth = Math.max(1, 10 - branch.depth * 1.2);
        ctx.beginPath();
        ctx.moveTo(branch.x1, branch.y1);
        ctx.lineTo(branch.x2, branch.y2);
        ctx.stroke();
    });

    // Update and draw leaves
    leaves.forEach(leaf => {
        leaf.update();
        leaf.draw();
    });

    // Draw legend if heat map is shown
    if (showHeatMap) {
        ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
        ctx.fillRect(canvas.width - 180, 20, 160, 150);

        ctx.fillStyle = 'white';
        ctx.font = 'bold 14px Arial';
        ctx.textAlign = 'left';
        ctx.fillText('Temperature Zones', canvas.width - 170, 40);

        const zones = [
            { temp: '< 5°C', color: 'rgba(0, 0, 255, 0.8)' },
            { temp: '5-10°C', color: 'rgba(100, 150, 255, 0.8)' },
            { temp: '10-15°C', color: 'rgba(150, 200, 255, 0.8)' },
            { temp: '15-20°C', color: 'rgba(255, 255, 150, 0.8)' },
            { temp: '20-25°C', color: 'rgba(255, 200, 100, 0.8)' },
            { temp: '> 25°C', color: 'rgba(255, 100, 0, 0.8)' }
        ];

        ctx.font = '12px Arial';
        zones.forEach((zone, i) => {
            ctx.fillStyle = zone.color;
            ctx.fillRect(canvas.width - 170, 55 + i * 20, 20, 15);

            ctx.fillStyle = 'white';
            ctx.fillText(zone.temp, canvas.width - 145, 67 + i * 20);
        });
    }

    // Title
    ctx.fillStyle = 'white';
    ctx.font = 'bold 24px Arial';
    ctx.textAlign = 'center';
    ctx.shadowColor = 'rgba(0, 0, 0, 0.7)';
    ctx.shadowBlur = 10;
    ctx.fillText('Temperature Gradient Effect on Autumn Colors', canvas.width / 2, 40);
    ctx.shadowBlur = 0;

    requestAnimationFrame(animate);
}

animate();

window.addEventListener('resize', () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
});
</script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
