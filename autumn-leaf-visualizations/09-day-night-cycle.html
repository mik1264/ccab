<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day/Night Cycle - Autumn Leaf Visualizations</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            font-family: 'Arial', sans-serif;
        }
        canvas {
            display: block;
        }
        .controls {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(255, 255, 255, 0.1);
            color: white;
            min-width: 200px;
        }
        h3 {
            margin-top: 0;
            color: #ffd700;
        }
        .time-display {
            font-size: 28px;
            font-weight: bold;
            text-align: center;
            margin: 15px 0;
            color: #ffa500;
        }
        .phase-display {
            text-align: center;
            font-size: 16px;
            margin: 10px 0;
            color: #87ceeb;
        }
        .control-group {
            margin: 15px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }
        input[type="range"] {
            width: 100%;
        }
        .value {
            text-align: right;
            color: #ffa500;
            font-weight: bold;
        }
    </style>
</head>
<body>
<!--
# Goal
Simulate a complete 24-hour day/night cycle showing how leaves respond differently
to changing light, temperature, and time of day throughout autumn.

# Approach
- Full day/night cycle with dynamic sky colors
- Sun and moon movement across sky
- Temperature varies: cold at night, warmer during day
- Sunlight intensity affects chlorophyll production (day) and degradation (night)
- Stars visible at night
- Leaves respond to light/dark cycles
- Cold nights accelerate anthocyanin production
- Time progression with adjustable speed

# Technical Implementation
- Canvas 2D with time-based sky rendering
- Celestial body (sun/moon) position calculated from time of day
- Dynamic color gradients for sky based on time
- Star field generation for night sky
- Leaf chemistry responds to current time, temperature, and light
- Real-time clock display showing current simulated time
-->

<canvas id="canvas"></canvas>
<div class="controls">
    <h3>üçÇ Day/Night Cycle</h3>
    <div class="time-display" id="time-display">12:00</div>
    <div class="phase-display" id="phase-display">Noon</div>

    <div class="control-group">
        <label>Time Speed: <span class="value" id="speed-value">60</span>x</label>
        <input type="range" id="time-speed" min="1" max="300" value="60" step="1">
    </div>
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// Time simulation (0-24 hours)
let currentHour = 6; // Start at dawn
let timeSpeed = 60; // 60x real time

// Star field
const stars = [];
for (let i = 0; i < 200; i++) {
    stars.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height * 0.7,
        size: Math.random() * 2,
        twinkle: Math.random() * Math.PI * 2
    });
}

class Leaf {
    constructor(x, y) {
        this.x = x;
        this.y = y;
        this.size = 6 + Math.random() * 4;
        this.chlorophyll = 60 + Math.random() * 30;
        this.carotene = 50 + Math.random() * 40;
        this.anthocyanin = 10 + Math.random() * 20;
        this.sugar = 30 + Math.random() * 40;
        this.water = 60 + Math.random() * 30;
    }

    update(hour, sunIntensity, temperature) {
        // During day: produce chlorophyll and sugar (photosynthesis)
        if (hour >= 6 && hour <= 18 && sunIntensity > 20) {
            this.chlorophyll += 0.1;
            this.sugar += 0.15;
        }

        // During night and cold: degrade chlorophyll
        if (hour < 6 || hour > 18 || temperature < 10) {
            this.chlorophyll -= 0.08;
        }

        // Cold nights: produce anthocyanin
        if ((hour < 6 || hour > 20) && temperature < 10 && this.sugar > 10 && this.water > 10) {
            const production = Math.min(this.sugar, this.water) * 0.05;
            this.anthocyanin += production;
            this.sugar -= production * 0.3;
            this.water -= production * 0.3;
        }

        // Night respiration: consume sugar
        if (hour < 6 || hour > 18) {
            this.sugar -= 0.05;
        }

        // Clamp values
        this.chlorophyll = Math.max(0, Math.min(100, this.chlorophyll));
        this.anthocyanin = Math.max(0, Math.min(100, this.anthocyanin));
        this.sugar = Math.max(0, Math.min(100, this.sugar));
        this.water = Math.max(0, Math.min(100, this.water));
    }

    getColor() {
        const chloroRatio = this.chlorophyll / 100;
        const caroteRatio = this.carotene / 100;
        const anthocRatio = this.anthocyanin / 100;

        if (chloroRatio > 0.5) {
            const intensity = 50 + chloroRatio * 150;
            return `rgb(${intensity * 0.3}, ${intensity}, ${intensity * 0.3})`;
        } else {
            const yellowInfluence = (1 - chloroRatio) * caroteRatio;
            const redInfluence = anthocRatio;

            let r, g, b;
            if (redInfluence > yellowInfluence + 0.2) {
                r = 180 + redInfluence * 75;
                g = 20 + yellowInfluence * 100;
                b = 20;
            } else if (yellowInfluence > redInfluence + 0.2) {
                r = 200 + yellowInfluence * 55;
                g = 180 + yellowInfluence * 75;
                b = 20;
            } else {
                r = 255;
                g = 100 + yellowInfluence * 100;
                b = 20;
            }
            return `rgb(${Math.floor(r)}, ${Math.floor(g)}, ${Math.floor(b)})`;
        }
    }

    draw(isDark) {
        ctx.fillStyle = this.getColor();

        // Leaves appear darker at night
        if (isDark) {
            ctx.globalAlpha = 0.3 + (Math.max(0, currentHour - 18) / 6) * 0.3;
        }

        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();

        ctx.globalAlpha = 1.0;
    }
}

// Create tree
const leaves = [];
const branches = [];

function createBranch(x, y, angle, length, depth) {
    if (depth > 8) return;

    const endX = x + Math.cos(angle) * length;
    const endY = y + Math.sin(angle) * length;

    branches.push({ x1: x, y1: y, x2: endX, y2: endY, depth });

    if (depth > 5) {
        for (let i = 0; i < 2; i++) {
            leaves.push(new Leaf(
                endX + (Math.random() - 0.5) * 10,
                endY + (Math.random() - 0.5) * 10
            ));
        }
    }

    if (depth < 8) {
        const numChildren = depth < 2 ? 2 : (Math.random() > 0.5 ? 2 : 1);
        for (let i = 0; i < numChildren; i++) {
            const newAngle = angle + (Math.random() - 0.5) * Math.PI / 2.5;
            const newLength = length * (0.65 + Math.random() * 0.15);
            createBranch(endX, endY, newAngle, newLength, depth + 1);
        }
    }
}

createBranch(canvas.width / 2, canvas.height - 80, -Math.PI / 2, 110, 0);

// Get environmental parameters based on time of day
function getEnvironment(hour) {
    let temperature, sunIntensity, phase;

    if (hour >= 0 && hour < 6) {
        // Night
        temperature = 5 + hour;
        sunIntensity = 0;
        phase = 'Night';
    } else if (hour >= 6 && hour < 8) {
        // Dawn
        temperature = 11 + (hour - 6) * 2;
        sunIntensity = (hour - 6) / 2 * 50;
        phase = 'Dawn';
    } else if (hour >= 8 && hour < 12) {
        // Morning
        temperature = 15 + (hour - 8);
        sunIntensity = 50 + (hour - 8) / 4 * 30;
        phase = 'Morning';
    } else if (hour >= 12 && hour < 15) {
        // Noon
        temperature = 20;
        sunIntensity = 80;
        phase = 'Noon';
    } else if (hour >= 15 && hour < 18) {
        // Afternoon
        temperature = 20 - (hour - 15);
        sunIntensity = 80 - (hour - 15) / 3 * 30;
        phase = 'Afternoon';
    } else if (hour >= 18 && hour < 20) {
        // Dusk
        temperature = 15 - (hour - 18) * 2;
        sunIntensity = 50 - (hour - 18) / 2 * 50;
        phase = 'Dusk';
    } else {
        // Evening/Night
        temperature = 11 - (hour - 20);
        sunIntensity = 0;
        phase = 'Evening';
    }

    return { temperature, sunIntensity, phase };
}

// Get sky gradient based on time
function getSkyGradient(hour) {
    const canvas = document.createElement('canvas');
    const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);

    if (hour >= 0 && hour < 5) {
        // Deep night
        gradient.addColorStop(0, '#000428');
        gradient.addColorStop(1, '#004e92');
    } else if (hour >= 5 && hour < 7) {
        // Dawn
        const t = (hour - 5) / 2;
        gradient.addColorStop(0, `rgb(${t * 135}, ${t * 120}, ${100 + t * 106})`);
        gradient.addColorStop(1, `rgb(${255 * t}, ${140 + t * 40}, ${t * 100})`);
    } else if (hour >= 7 && hour < 9) {
        // Early morning
        gradient.addColorStop(0, '#87CEEB');
        gradient.addColorStop(1, '#FFE4B5');
    } else if (hour >= 9 && hour < 17) {
        // Day
        gradient.addColorStop(0, '#87CEEB');
        gradient.addColorStop(1, '#B0E0E6');
    } else if (hour >= 17 && hour < 19) {
        // Dusk
        const t = (hour - 17) / 2;
        gradient.addColorStop(0, `rgb(${255 - t * 120}, ${140 - t * 40}, ${100 - t * 100})`);
        gradient.addColorStop(1, `rgb(${255 - t * 55}, ${100 - t * 40}, ${50 - t * 50})`);
    } else {
        // Evening
        gradient.addColorStop(0, '#1e3a5f');
        gradient.addColorStop(1, '#2a4a7f');
    }

    return gradient;
}

// Draw celestial body (sun or moon)
function drawCelestialBody(hour) {
    const progress = (hour % 24) / 24;
    const angle = progress * Math.PI * 2 - Math.PI / 2;
    const radius = canvas.width * 0.4;
    const centerX = canvas.width / 2;
    const centerY = canvas.height - 50;

    const x = centerX + Math.cos(angle) * radius;
    const y = centerY + Math.sin(angle) * radius;

    if (hour >= 6 && hour < 18) {
        // Sun
        const sunSize = 40;
        const gradient = ctx.createRadialGradient(x, y, sunSize * 0.5, x, y, sunSize);
        gradient.addColorStop(0, '#FFF');
        gradient.addColorStop(0.5, '#FFD700');
        gradient.addColorStop(1, 'rgba(255, 215, 0, 0)');

        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.arc(x, y, sunSize, 0, Math.PI * 2);
        ctx.fill();
    } else {
        // Moon
        ctx.fillStyle = '#F0E68C';
        ctx.beginPath();
        ctx.arc(x, y, 30, 0, Math.PI * 2);
        ctx.fill();

        // Moon craters
        ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
        ctx.beginPath();
        ctx.arc(x - 8, y - 5, 8, 0, Math.PI * 2);
        ctx.fill();
        ctx.beginPath();
        ctx.arc(x + 6, y + 4, 5, 0, Math.PI * 2);
        ctx.fill();
    }
}

// Controls
document.getElementById('time-speed').addEventListener('input', (e) => {
    timeSpeed = parseInt(e.target.value);
    document.getElementById('speed-value').textContent = timeSpeed;
});

// Animation
let lastTime = Date.now();

function animate() {
    const now = Date.now();
    const deltaSeconds = (now - lastTime) / 1000;
    lastTime = now;

    // Advance time
    currentHour += (deltaSeconds * timeSpeed) / 3600; // Convert to hours
    if (currentHour >= 24) currentHour -= 24;

    const env = getEnvironment(currentHour);
    const isDark = currentHour < 6 || currentHour >= 18;

    // Sky
    ctx.fillStyle = getSkyGradient(currentHour);
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Stars (only visible at night)
    if (isDark) {
        const starOpacity = currentHour < 6 ?
            Math.min(1, (6 - currentHour) / 2) :
            Math.min(1, (currentHour - 18) / 2);

        stars.forEach(star => {
            star.twinkle += 0.05;
            const twinkleValue = (Math.sin(star.twinkle) + 1) / 2;
            ctx.fillStyle = `rgba(255, 255, 255, ${starOpacity * twinkleValue})`;
            ctx.beginPath();
            ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
            ctx.fill();
        });
    }

    // Celestial body
    drawCelestialBody(currentHour);

    // Ground
    ctx.fillStyle = isDark ? '#2F4F2F' : '#8B7355';
    ctx.fillRect(0, canvas.height - 80, canvas.width, 80);

    // Tree branches
    ctx.strokeStyle = '#3e2723';
    ctx.lineCap = 'round';
    if (isDark) ctx.globalAlpha = 0.5;

    branches.forEach(branch => {
        ctx.lineWidth = Math.max(1, 10 - branch.depth * 1.2);
        ctx.beginPath();
        ctx.moveTo(branch.x1, branch.y1);
        ctx.lineTo(branch.x2, branch.y2);
        ctx.stroke();
    });

    ctx.globalAlpha = 1.0;

    // Update and draw leaves
    leaves.forEach(leaf => {
        leaf.update(currentHour, env.sunIntensity, env.temperature);
        leaf.draw(isDark);
    });

    // Update UI
    const hours = Math.floor(currentHour);
    const minutes = Math.floor((currentHour - hours) * 60);
    const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
    document.getElementById('time-display').textContent = timeString;
    document.getElementById('phase-display').textContent = `${env.phase} | ${Math.round(env.temperature)}¬∞C`;

    requestAnimationFrame(animate);
}

animate();

window.addEventListener('resize', () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
});
</script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
