<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microscopic Cell View - Autumn Leaf Visualizations</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            font-family: 'Arial', sans-serif;
        }
        canvas {
            display: block;
        }
        .microscope-ui {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border-radius: 15px;
            color: #00ff00;
            border: 3px solid #00ff00;
            font-family: 'Courier New', monospace;
        }
        h3 {
            margin-top: 0;
            color: #00ff00;
            text-transform: uppercase;
        }
        .stat-row {
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            gap: 20px;
        }
        .stat-label {
            color: #00ff00;
        }
        .stat-bar {
            flex: 1;
            height: 15px;
            background: #001a00;
            border: 1px solid #00ff00;
            border-radius: 3px;
            overflow: hidden;
        }
        .stat-fill {
            height: 100%;
            transition: width 0.3s;
        }
        .zoom-control {
            margin: 15px 0;
            text-align: center;
        }
        button {
            background: #003300;
            color: #00ff00;
            border: 2px solid #00ff00;
            padding: 8px 15px;
            margin: 0 5px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
        }
        button:hover {
            background: #00ff00;
            color: #000;
        }
    </style>
</head>
<body>
<!--
# Goal
Zoom into microscopic cellular level of an autumn leaf, showing individual
cells, chloroplasts, vacuoles, and pigment molecules at work.

# Approach
- Cellular grid representing leaf tissue
- Each cell contains: chloroplasts (green), vacuoles (with anthocyanin), cell wall
- Visualize chloroplast degradation over time
- Show anthocyanin accumulation in vacuoles
- Microscope-style interface with zoom levels
- Molecules visible as particles within cells
- Real-time chemical reactions at cellular level
- Scientific/educational visualization style

# Technical Implementation
- Canvas 2D with cellular grid rendering
- Cell class with organelles
- Particle system for molecules
- Multiple zoom levels
- Microscope aesthetic (green phosphor display style)
- Realistic cellular structures
-->

<canvas id="canvas"></canvas>
<div class="microscope-ui">
    <h3>ðŸ”¬ Microscope View</h3>
    <div class="stat-row">
        <span class="stat-label">Chlorophyll:</span>
        <div class="stat-bar">
            <div class="stat-fill" id="chloro-bar" style="width: 80%; background: #00ff00;"></div>
        </div>
    </div>
    <div class="stat-row">
        <span class="stat-label">Anthocyanin:</span>
        <div class="stat-bar">
            <div class="stat-fill" id="antho-bar" style="width: 20%; background: #ff0000;"></div>
        </div>
    </div>
    <div class="stat-row">
        <span class="stat-label">Cell Integrity:</span>
        <div class="stat-bar">
            <div class="stat-fill" id="integrity-bar" style="width: 95%; background: #00ffff;"></div>
        </div>
    </div>
    <div class="zoom-control">
        <button id="btn-zoom-in">Zoom In (+)</button>
        <button id="btn-zoom-out">Zoom Out (-)</button>
        <button id="btn-toggle-labels">Toggle Labels</button>
    </div>
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let zoomLevel = 1;
let showLabels = true;
let time = 0;

// Cell class
class LeafCell {
    constructor(x, y, size) {
        this.x = x;
        this.y = y;
        this.size = size;

        // Organelles
        this.chloroplasts = [];
        this.numChloroplasts = 5 + Math.floor(Math.random() * 5);
        for (let i = 0; i < this.numChloroplasts; i++) {
            this.chloroplasts.push({
                x: this.x + (Math.random() - 0.5) * this.size * 0.6,
                y: this.y + (Math.random() - 0.5) * this.size * 0.6,
                size: 3 + Math.random() * 2,
                chlorophyll: 80 + Math.random() * 20,
                phase: Math.random() * Math.PI * 2
            });
        }

        // Vacuole (central)
        this.vacuole = {
            x: this.x,
            y: this.y,
            size: this.size * 0.4,
            anthocyanin: 10 + Math.random() * 20,
            water: 80
        };

        this.cellWallIntegrity = 100;
    }

    update(temperature) {
        // Chloroplast degradation in cold
        this.chloroplasts.forEach(cp => {
            if (temperature < 15) {
                cp.chlorophyll -= (15 - temperature) * 0.01;
            }
            cp.chlorophyll = Math.max(0, Math.min(100, cp.chlorophyll));
        });

        // Anthocyanin production
        if (temperature < 12) {
            this.vacuole.anthocyanin += 0.05;
            this.vacuole.anthocyanin = Math.min(100, this.vacuole.anthocyanin);
        }

        // Cell wall weakens in cold
        if (temperature < 5) {
            this.cellWallIntegrity -= 0.02;
        }

        this.cellWallIntegrity = Math.max(0, Math.min(100, this.cellWallIntegrity));
    }

    draw(zoom) {
        const displaySize = this.size * zoom;

        // Cell wall
        ctx.strokeStyle = `rgba(0, 255, 0, ${this.cellWallIntegrity / 100})`;
        ctx.lineWidth = 2 * zoom;
        ctx.strokeRect(
            this.x * zoom - displaySize / 2,
            this.y * zoom - displaySize / 2,
            displaySize,
            displaySize
        );

        // Nucleus (small, always present)
        ctx.fillStyle = 'rgba(0, 200, 255, 0.6)';
        ctx.beginPath();
        ctx.arc(this.x * zoom, this.y * zoom, 4 * zoom, 0, Math.PI * 2);
        ctx.fill();

        // Vacuole
        const anthocColor = this.vacuole.anthocyanin / 100;
        ctx.fillStyle = `rgba(255, ${(1 - anthocColor) * 50}, ${(1 - anthocColor) * 50}, ${0.3 + anthocColor * 0.4})`;
        ctx.beginPath();
        ctx.arc(
            this.vacuole.x * zoom,
            this.vacuole.y * zoom,
            this.vacuole.size * zoom,
            0,
            Math.PI * 2
        );
        ctx.fill();

        // Chloroplasts
        this.chloroplasts.forEach(cp => {
            const chloroIntensity = cp.chlorophyll / 100;

            // Chloroplast body
            ctx.fillStyle = `rgba(0, ${chloroIntensity * 255}, 0, 0.7)`;
            ctx.beginPath();
            ctx.ellipse(
                cp.x * zoom,
                cp.y * zoom,
                cp.size * zoom,
                cp.size * zoom * 0.7,
                cp.phase,
                0,
                Math.PI * 2
            );
            ctx.fill();

            // Grana (internal structure)
            if (zoom > 1.5) {
                ctx.strokeStyle = `rgba(0, ${chloroIntensity * 200}, 0, 0.5)`;
                ctx.lineWidth = 0.5 * zoom;
                for (let i = 0; i < 3; i++) {
                    ctx.beginPath();
                    ctx.moveTo((cp.x - cp.size * 0.5) * zoom, cp.y * zoom);
                    ctx.lineTo((cp.x + cp.size * 0.5) * zoom, cp.y * zoom);
                    ctx.stroke();
                }
            }
        });

        // Labels (if enabled and zoomed in)
        if (showLabels && zoom > 1.5) {
            ctx.fillStyle = '#00ff00';
            ctx.font = `${10 * zoom}px Courier New`;
            ctx.fillText('Vacuole', (this.vacuole.x + 10) * zoom, this.vacuole.y * zoom);

            if (this.chloroplasts.length > 0) {
                ctx.fillText('Chloroplast', (this.chloroplasts[0].x + 5) * zoom, this.chloroplasts[0].y * zoom);
            }

            ctx.fillText('Nucleus', (this.x + 5) * zoom, this.y * zoom);
        }
    }
}

// Create cell grid
const cells = [];
const cellSize = 50;
const gridCols = Math.ceil(canvas.width / cellSize) + 2;
const gridRows = Math.ceil(canvas.height / cellSize) + 2;

for (let row = 0; row < gridRows; row++) {
    for (let col = 0; col < gridCols; col++) {
        cells.push(new LeafCell(
            col * cellSize,
            row * cellSize,
            cellSize
        ));
    }
}

// Environmental parameters
let temperature = 15;
temperature -= time * 0.01; // Slowly cooling

// Controls
document.getElementById('btn-zoom-in').addEventListener('click', () => {
    zoomLevel = Math.min(4, zoomLevel * 1.5);
});

document.getElementById('btn-zoom-out').addEventListener('click', () => {
    zoomLevel = Math.max(0.5, zoomLevel / 1.5);
});

document.getElementById('btn-toggle-labels').addEventListener('click', () => {
    showLabels = !showLabels;
});

// Animation
function animate() {
    time += 1;
    temperature = Math.max(0, 15 - time * 0.002);

    // Black background
    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Draw grid lines (microscope style)
    ctx.strokeStyle = 'rgba(0, 255, 0, 0.1)';
    ctx.lineWidth = 1;
    for (let x = 0; x < canvas.width; x += 50 * zoomLevel) {
        ctx.beginPath();
        ctx.moveTo(x, 0);
        ctx.lineTo(x, canvas.height);
        ctx.stroke();
    }
    for (let y = 0; y < canvas.height; y += 50 * zoomLevel) {
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(canvas.width, y);
        ctx.stroke();
    }

    // Update and draw cells
    cells.forEach(cell => {
        cell.update(temperature);
        cell.draw(zoomLevel);
    });

    // Update UI bars
    const avgChlorophyll = cells.reduce((sum, cell) =>
        sum + cell.chloroplasts.reduce((s, cp) => s + cp.chlorophyll, 0) / cell.chloroplasts.length, 0
    ) / cells.length;

    const avgAnthocyanin = cells.reduce((sum, cell) =>
        sum + cell.vacuole.anthocyanin, 0) / cells.length;

    const avgIntegrity = cells.reduce((sum, cell) =>
        sum + cell.cellWallIntegrity, 0) / cells.length;

    document.getElementById('chloro-bar').style.width = `${avgChlorophyll}%`;
    document.getElementById('antho-bar').style.width = `${avgAnthocyanin}%`;
    document.getElementById('integrity-bar').style.width = `${avgIntegrity}%`;

    // Microscope overlay (circular vignette)
    const gradient = ctx.createRadialGradient(
        canvas.width / 2, canvas.height / 2, canvas.height * 0.3,
        canvas.width / 2, canvas.height / 2, canvas.height * 0.6
    );
    gradient.addColorStop(0, 'rgba(0, 0, 0, 0)');
    gradient.addColorStop(1, 'rgba(0, 0, 0, 0.8)');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Draw info
    ctx.fillStyle = '#00ff00';
    ctx.font = '16px Courier New';
    ctx.textAlign = 'right';
    ctx.fillText(`Temperature: ${temperature.toFixed(1)}Â°C`, canvas.width - 20, canvas.height - 60);
    ctx.fillText(`Zoom: ${zoomLevel.toFixed(1)}x`, canvas.width - 20, canvas.height - 40);
    ctx.fillText(`Cells Visible: ${cells.length}`, canvas.width - 20, canvas.height - 20);

    requestAnimationFrame(animate);
}

animate();

window.addEventListener('resize', () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
});
</script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
