<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forest Canopy View - Autumn Leaf Visualizations</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #87CEEB;
            font-family: 'Arial', sans-serif;
        }
        canvas {
            display: block;
        }
        .controls {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        h3 {
            margin-top: 0;
            color: #2F4F2F;
        }
        .info {
            margin: 10px 0;
            font-size: 13px;
        }
        button {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: none;
            border-radius: 5px;
            background: #228B22;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }
        button:hover {
            background: #1a6b1a;
        }
    </style>
</head>
<body>
<!--
# Goal
Bird's eye view of an entire forest canopy showing the wave of autumn color
change spreading across the landscape, with elevation and microclimate effects.

# Approach
- Top-down view of forest as a collection of tree crowns
- Color change propagates based on elevation (higher = colder = earlier change)
- Microclimate effects (sunny vs shaded areas)
- Different tree species change at different rates
- Wave effect spreading from north to south, high to low elevation
- Distance perspective with atmospheric haze
- Large scale showing ecosystem-level patterns

# Technical Implementation
- Canvas 2D with isometric/top-down view
- Grid of tree crowns with elevation data
- Perlin noise for terrain variation
- Progressive color change algorithm
- Species distribution map
- Atmospheric perspective for depth
-->

<canvas id="canvas"></canvas>
<div class="controls">
    <h3>ðŸŒ² Forest Canopy</h3>
    <div class="info">Watch autumn spread across the forest</div>
    <div class="info" id="progress-text">Progress: 0%</div>
    <button id="btn-restart">Restart Autumn</button>
    <button id="btn-speed">Toggle Speed</button>
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// Noise function for terrain
class SimplexNoise {
    constructor() {
        this.seed = Math.random() * 1000;
    }

    noise(x, y) {
        // Simplified noise function
        const X = Math.floor(x) & 255;
        const Y = Math.floor(y) & 255;
        x -= Math.floor(x);
        y -= Math.floor(y);

        const hash = (x, y) => {
            const h = (x * 374761393 + y * 668265263) & 0xffffffff;
            return ((h ^ (h >> 16)) & 0xff) / 255;
        };

        const a = hash(X, Y);
        const b = hash(X + 1, Y);
        const c = hash(X, Y + 1);
        const d = hash(X + 1, Y + 1);

        const u = x * x * (3 - 2 * x);
        const v = y * y * (3 - 2 * y);

        return a * (1 - u) * (1 - v) +
               b * u * (1 - v) +
               c * (1 - u) * v +
               d * u * v;
    }
}

const noise = new SimplexNoise();

// Tree crown in forest
class TreeCrown {
    constructor(x, y, species, elevation) {
        this.x = x;
        this.y = y;
        this.species = species; // 'maple', 'oak', 'birch'
        this.elevation = elevation; // 0-1 (low to high)
        this.size = 20 + Math.random() * 15;

        // Species-specific properties
        switch (species) {
            case 'maple':
                this.baseChlorophyll = 70;
                this.changeSensitivity = 1.5;
                this.peakColor = '#DC143C'; // Red
                break;
            case 'oak':
                this.baseChlorophyll = 75;
                this.changeSensitivity = 1.0;
                this.peakColor = '#D2691E'; // Brown
                break;
            case 'birch':
                this.baseChlorophyll = 80;
                this.changeSensitivity = 1.2;
                this.peakColor = '#FFD700'; // Yellow
                break;
        }

        this.chlorophyll = this.baseChlorophyll;
        this.autumnProgress = 0;
    }

    update(globalProgress) {
        // Trees at higher elevation change first
        const elevationFactor = this.elevation * 0.5;

        // Distance from north (top of screen) affects timing
        const latitudeFactor = (this.y / canvas.height) * 0.3;

        // Calculate local autumn progress
        const localTrigger = elevationFactor + latitudeFactor;
        this.autumnProgress = Math.max(0, (globalProgress - localTrigger) * this.changeSensitivity);
        this.autumnProgress = Math.min(1, this.autumnProgress);

        // Update chlorophyll
        this.chlorophyll = this.baseChlorophyll * (1 - this.autumnProgress);
    }

    getColor() {
        const progress = this.autumnProgress;

        if (progress < 0.1) {
            // Still green
            return '#228B22';
        } else if (progress < 0.4) {
            // Transitioning to yellow-green
            return '#9ACD32';
        } else if (progress < 0.7) {
            // Peak autumn color (species-specific)
            return this.peakColor;
        } else {
            // Fading to brown
            return '#8B4513';
        }
    }

    draw() {
        // Atmospheric perspective (distance fog)
        const distanceFactor = this.y / canvas.height;
        const fogAmount = distanceFactor * 0.5;

        ctx.save();
        ctx.globalAlpha = 1 - fogAmount;

        // Tree crown shadow
        ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
        ctx.beginPath();
        ctx.ellipse(this.x + 3, this.y + 3, this.size * 0.8, this.size * 0.6, 0, 0, Math.PI * 2);
        ctx.fill();

        // Tree crown
        ctx.fillStyle = this.getColor();
        ctx.beginPath();
        ctx.ellipse(this.x, this.y, this.size * 0.8, this.size * 0.6, 0, 0, Math.PI * 2);
        ctx.fill();

        // Highlight for dimension
        ctx.fillStyle = 'rgba(255, 255, 255, 0.2)';
        ctx.beginPath();
        ctx.ellipse(
            this.x - this.size * 0.2,
            this.y - this.size * 0.2,
            this.size * 0.3,
            this.size * 0.2,
            0, 0, Math.PI * 2
        );
        ctx.fill();

        ctx.restore();
    }
}

// Generate forest
const trees = [];
const density = 80; // Trees per 10000 sq pixels
const numTrees = Math.floor((canvas.width * canvas.height / 10000) * density);

for (let i = 0; i < numTrees; i++) {
    const x = Math.random() * canvas.width;
    const y = Math.random() * canvas.height;

    // Elevation based on position and noise
    const baseElevation = (canvas.height - y) / canvas.height;
    const noiseElevation = noise.noise(x * 0.01, y * 0.01);
    const elevation = (baseElevation * 0.7 + noiseElevation * 0.3);

    // Species distribution
    const speciesRand = Math.random();
    let species;
    if (speciesRand < 0.4) species = 'maple';
    else if (speciesRand < 0.7) species = 'oak';
    else species = 'birch';

    trees.push(new TreeCrown(x, y, species, elevation));
}

// Sort by Y for proper layering
trees.sort((a, b) => a.y - b.y);

// Animation state
let globalProgress = 0;
let animationSpeed = 0.002;
let isPaused = false;

// Controls
document.getElementById('btn-restart').addEventListener('click', () => {
    globalProgress = 0;
    trees.forEach(tree => tree.autumnProgress = 0);
});

document.getElementById('btn-speed').addEventListener('click', function() {
    animationSpeed = animationSpeed === 0.002 ? 0.01 : 0.002;
    this.textContent = animationSpeed === 0.002 ? 'Speed: Normal' : 'Speed: Fast';
});

// Animation
function animate() {
    // Progress autumn
    globalProgress += animationSpeed;
    if (globalProgress > 1.5) globalProgress = 1.5; // Allow extra time for southern trees

    // Sky gradient
    const skyGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
    skyGradient.addColorStop(0, '#87CEEB');
    skyGradient.addColorStop(1, '#E0F6FF');
    ctx.fillStyle = skyGradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Update and draw trees
    trees.forEach(tree => {
        tree.update(globalProgress);
        tree.draw();
    });

    // Draw elevation lines (topographic effect)
    ctx.strokeStyle = 'rgba(0, 0, 0, 0.05)';
    ctx.lineWidth = 1;
    for (let elevation = 0; elevation < 1; elevation += 0.1) {
        const y = canvas.height * (1 - elevation);
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(canvas.width, y);
        ctx.stroke();
    }

    // Update progress text
    const percentage = Math.min(100, Math.round((globalProgress / 1.5) * 100));
    document.getElementById('progress-text').textContent = `Progress: ${percentage}%`;

    // Title
    ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
    ctx.font = 'bold 32px Arial';
    ctx.textAlign = 'center';
    ctx.shadowColor = 'rgba(255, 255, 255, 0.8)';
    ctx.shadowBlur = 10;
    ctx.fillText('Autumn Spreading Across the Forest', canvas.width / 2, 50);
    ctx.shadowBlur = 0;

    ctx.font = '16px Arial';
    ctx.fillText('Higher elevations and northern areas change first', canvas.width / 2, 80);

    requestAnimationFrame(animate);
}

animate();

window.addEventListener('resize', () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
});
</script>
</body>
</html>
