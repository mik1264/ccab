<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Leaf Chemistry - Autumn Leaf Visualizations</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Arial', sans-serif;
        }
        canvas {
            display: block;
        }
        .info-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            max-width: 300px;
        }
        h3 {
            margin-top: 0;
            color: #2a5298;
        }
        .chemical-bar {
            margin: 10px 0;
        }
        .bar-label {
            font-weight: bold;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }
        .bar {
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        .bar-fill {
            height: 100%;
            transition: width 0.3s;
            border-radius: 10px;
        }
        .chlorophyll-bar { background: linear-gradient(90deg, #90EE90, #228B22); }
        .carotene-bar { background: linear-gradient(90deg, #FFE135, #FFD700); }
        .anthocyanin-bar { background: linear-gradient(90deg, #FF6B6B, #C0392B); }
        .water-bar { background: linear-gradient(90deg, #85C1E9, #2E86C1); }
        .sugar-bar { background: linear-gradient(90deg, #F9E79F, #F39C12); }
        .instruction {
            margin-top: 15px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 5px;
            font-size: 14px;
        }
    </style>
</head>
<body>
<!--
# Goal
Create an interactive visualization where users can directly manipulate chemical
levels in a leaf and observe real-time color changes based on pigment interactions.

# Approach
- Large interactive leaf that responds to mouse clicks
- Click different areas to inject chemicals (chlorophyll, carotene, anthocyanin)
- Visual bars showing current chemical concentrations
- Leaf color updates in real-time based on pigment mixing rules
- Educational tooltips explaining the chemistry
- Mouse position determines which chemical is added

# Technical Implementation
- Canvas 2D with mouse event handling
- Hit detection for different leaf regions
- Real-time color calculation from chemical ratios
- Smooth transitions using requestAnimationFrame
- UI bars synchronized with leaf state
- Particle effects when chemicals are added
-->

<canvas id="canvas"></canvas>
<div class="info-panel">
    <h3>Leaf Chemistry Lab</h3>
    <div class="instruction">
        Click on the leaf to add chemicals:<br>
        <strong>Top</strong>: Chlorophyll (green)<br>
        <strong>Left</strong>: Carotene (yellow)<br>
        <strong>Right</strong>: Anthocyanin (red)<br>
        <strong>Bottom Left</strong>: Water<br>
        <strong>Bottom Right</strong>: Sugar
    </div>

    <div class="chemical-bar">
        <div class="bar-label">
            <span>Chlorophyll</span>
            <span id="chlorophyll-val">50%</span>
        </div>
        <div class="bar">
            <div class="bar-fill chlorophyll-bar" id="chlorophyll-bar" style="width: 50%"></div>
        </div>
    </div>

    <div class="chemical-bar">
        <div class="bar-label">
            <span>Carotene</span>
            <span id="carotene-val">60%</span>
        </div>
        <div class="bar">
            <div class="bar-fill carotene-bar" id="carotene-bar" style="width: 60%"></div>
        </div>
    </div>

    <div class="chemical-bar">
        <div class="bar-label">
            <span>Anthocyanin</span>
            <span id="anthocyanin-val">10%</span>
        </div>
        <div class="bar">
            <div class="bar-fill anthocyanin-bar" id="anthocyanin-bar" style="width: 10%"></div>
        </div>
    </div>

    <div class="chemical-bar">
        <div class="bar-label">
            <span>Water</span>
            <span id="water-val">70%</span>
        </div>
        <div class="bar">
            <div class="bar-fill water-bar" id="water-bar" style="width: 70%"></div>
        </div>
    </div>

    <div class="chemical-bar">
        <div class="bar-label">
            <span>Sugar</span>
            <span id="sugar-val">40%</span>
        </div>
        <div class="bar">
            <div class="bar-fill sugar-bar" id="sugar-bar" style="width: 40%"></div>
        </div>
    </div>
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// Leaf chemistry state
const leaf = {
    x: canvas.width * 0.6,
    y: canvas.height * 0.5,
    width: 300,
    height: 400,
    chlorophyll: 50,
    carotene: 60,
    anthocyanin: 10,
    water: 70,
    sugar: 40
};

// Particle effects
class ChemicalParticle {
    constructor(x, y, color, type) {
        this.x = x;
        this.y = y;
        this.color = color;
        this.type = type;
        this.size = 3 + Math.random() * 5;
        this.vx = (Math.random() - 0.5) * 4;
        this.vy = (Math.random() - 0.5) * 4;
        this.life = 1.0;
        this.opacity = 1.0;
    }

    update() {
        this.x += this.vx;
        this.y += this.vy;
        this.vx *= 0.95;
        this.vy *= 0.95;
        this.life -= 0.02;
        this.opacity = this.life;
    }

    draw() {
        ctx.save();
        ctx.globalAlpha = this.opacity;
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
    }
}

const particles = [];

// Calculate leaf color based on chemistry
function getLeafColor() {
    const chloroRatio = leaf.chlorophyll / 100;
    const caroteRatio = leaf.carotene / 100;
    const anthocRatio = leaf.anthocyanin / 100;

    // Chlorophyll dominates when above 50%
    if (chloroRatio > 0.5) {
        const greenIntensity = 50 + chloroRatio * 150;
        const r = Math.floor(greenIntensity * 0.3);
        const g = Math.floor(greenIntensity);
        const b = Math.floor(greenIntensity * 0.3);
        return `rgb(${r}, ${g}, ${b})`;
    }

    // Below 50% chlorophyll, carotene and anthocyanin show
    const yellowInfluence = (1 - chloroRatio) * caroteRatio;
    const redInfluence = anthocRatio;

    let r, g, b;

    if (redInfluence > yellowInfluence + 0.2) {
        // Red dominates
        r = 180 + redInfluence * 75;
        g = 20 + yellowInfluence * 100 + chloroRatio * 80;
        b = 20 + chloroRatio * 30;
    } else if (yellowInfluence > redInfluence + 0.2) {
        // Yellow dominates
        r = 200 + yellowInfluence * 55;
        g = 180 + yellowInfluence * 75;
        b = 20 + chloroRatio * 50;
    } else {
        // Orange (balanced)
        r = 255;
        g = 100 + yellowInfluence * 100;
        b = 20 + chloroRatio * 30;
    }

    return `rgb(${Math.floor(r)}, ${Math.floor(g)}, ${Math.floor(b)})`;
}

// Draw the leaf
function drawLeaf() {
    ctx.save();
    ctx.translate(leaf.x, leaf.y);

    // Leaf body
    ctx.fillStyle = getLeafColor();
    ctx.beginPath();
    ctx.ellipse(0, 0, leaf.width / 2, leaf.height / 2, Math.PI / 4, 0, Math.PI * 2);
    ctx.fill();

    // Leaf outline
    ctx.strokeStyle = 'rgba(0, 0, 0, 0.3)';
    ctx.lineWidth = 3;
    ctx.stroke();

    // Central vein
    ctx.strokeStyle = 'rgba(0, 0, 0, 0.2)';
    ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.moveTo(-leaf.width * 0.3, -leaf.height * 0.3);
    ctx.lineTo(leaf.width * 0.3, leaf.height * 0.3);
    ctx.stroke();

    // Side veins
    ctx.lineWidth = 2;
    for (let i = -3; i <= 3; i++) {
        const t = i / 3;
        const startX = -leaf.width * 0.3 * (1 - Math.abs(t) * 0.5);
        const startY = -leaf.height * 0.3 * (1 - Math.abs(t) * 0.5);
        const angle = i > 0 ? -Math.PI / 6 : Math.PI / 6;
        const length = leaf.width * 0.15;

        ctx.beginPath();
        ctx.moveTo(startX, startY);
        ctx.lineTo(
            startX + Math.cos(angle) * length,
            startY + Math.sin(angle) * length
        );
        ctx.stroke();
    }

    // Add click zones (invisible, just for reference)
    // These help users understand where to click

    ctx.restore();
}

// Update UI bars
function updateUI() {
    document.getElementById('chlorophyll-val').textContent = `${Math.round(leaf.chlorophyll)}%`;
    document.getElementById('chlorophyll-bar').style.width = `${leaf.chlorophyll}%`;

    document.getElementById('carotene-val').textContent = `${Math.round(leaf.carotene)}%`;
    document.getElementById('carotene-bar').style.width = `${leaf.carotene}%`;

    document.getElementById('anthocyanin-val').textContent = `${Math.round(leaf.anthocyanin)}%`;
    document.getElementById('anthocyanin-bar').style.width = `${leaf.anthocyanin}%`;

    document.getElementById('water-val').textContent = `${Math.round(leaf.water)}%`;
    document.getElementById('water-bar').style.width = `${leaf.water}%`;

    document.getElementById('sugar-val').textContent = `${Math.round(leaf.sugar)}%`;
    document.getElementById('sugar-bar').style.width = `${leaf.sugar}%`;
}

// Handle clicks
canvas.addEventListener('click', (e) => {
    const rect = canvas.getBoundingClientRect();
    const clickX = e.clientX - rect.left;
    const clickY = e.clientY - rect.top;

    // Transform to leaf coordinate system
    const dx = clickX - leaf.x;
    const dy = clickY - leaf.y;

    // Rotate by -45 degrees to match leaf rotation
    const angle = -Math.PI / 4;
    const rotX = dx * Math.cos(angle) - dy * Math.sin(angle);
    const rotY = dx * Math.sin(angle) + dy * Math.cos(angle);

    // Check if inside leaf ellipse
    if ((rotX * rotX) / ((leaf.width / 2) ** 2) + (rotY * rotY) / ((leaf.height / 2) ** 2) > 1) {
        return; // Outside leaf
    }

    // Determine which chemical to add based on position
    const normalizedX = rotX / (leaf.width / 2);
    const normalizedY = rotY / (leaf.height / 2);

    let chemical = '';
    let color = '';
    let amount = 5;

    if (normalizedY < -0.3) {
        // Top: Chlorophyll
        leaf.chlorophyll = Math.min(100, leaf.chlorophyll + amount);
        chemical = 'chlorophyll';
        color = '#228B22';
    } else if (normalizedY > 0.3 && normalizedX < 0) {
        // Bottom left: Water
        leaf.water = Math.min(100, leaf.water + amount);
        chemical = 'water';
        color = '#2E86C1';
    } else if (normalizedY > 0.3 && normalizedX > 0) {
        // Bottom right: Sugar
        leaf.sugar = Math.min(100, leaf.sugar + amount);
        chemical = 'sugar';
        color = '#F39C12';
    } else if (normalizedX < -0.2) {
        // Left: Carotene
        leaf.carotene = Math.min(100, leaf.carotene + amount);
        chemical = 'carotene';
        color = '#FFD700';
    } else if (normalizedX > 0.2) {
        // Right: Anthocyanin
        leaf.anthocyanin = Math.min(100, leaf.anthocyanin + amount);
        chemical = 'anthocyanin';
        color = '#C0392B';
    }

    // Create particle effect
    if (chemical) {
        for (let i = 0; i < 15; i++) {
            particles.push(new ChemicalParticle(clickX, clickY, color, chemical));
        }
    }

    updateUI();
});

// Auto-decay over time (simulating natural processes)
function autoDecay() {
    leaf.chlorophyll = Math.max(0, leaf.chlorophyll - 0.02);
    leaf.water = Math.max(0, leaf.water - 0.03);
    leaf.sugar = Math.max(0, leaf.sugar - 0.01);

    // Anthocyanin production from sugar + water when cold
    // (simulate cold environment)
    if (leaf.sugar > 10 && leaf.water > 10) {
        const production = Math.min(leaf.sugar, leaf.water) * 0.001;
        leaf.anthocyanin = Math.min(100, leaf.anthocyanin + production);
    }
}

// Animation loop
function animate() {
    // Background gradient
    const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
    gradient.addColorStop(0, '#667eea');
    gradient.addColorStop(1, '#764ba2');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Update auto-decay
    autoDecay();

    // Update and draw particles
    for (let i = particles.length - 1; i >= 0; i--) {
        particles[i].update();
        particles[i].draw();

        if (particles[i].life <= 0) {
            particles.splice(i, 1);
        }
    }

    // Draw leaf
    drawLeaf();

    // Update UI
    updateUI();

    // Title
    ctx.fillStyle = 'white';
    ctx.font = 'bold 28px Arial';
    ctx.textAlign = 'center';
    ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
    ctx.shadowBlur = 10;
    ctx.fillText('Interactive Leaf Chemistry', canvas.width / 2, 50);
    ctx.shadowBlur = 0;

    requestAnimationFrame(animate);
}

animate();

window.addEventListener('resize', () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    leaf.x = canvas.width * 0.6;
    leaf.y = canvas.height * 0.5;
});
</script>
</body>
</html>
