<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Ecosystem - Autumn Leaf Visualizations</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            font-family: 'Arial', sans-serif;
        }
        canvas {
            display: block;
        }
        .dashboard {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-size: 12px;
            max-width: 250px;
            border: 2px solid #4CAF50;
        }
        h3 {
            margin: 0 0 10px 0;
            color: #4CAF50;
            font-size: 16px;
        }
        .stat {
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
        }
        .stat-label {
            color: #aaa;
        }
        .stat-value {
            color: #4CAF50;
            font-weight: bold;
        }
        .controls {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #444;
        }
        button {
            width: 100%;
            padding: 8px;
            margin: 3px 0;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 11px;
        }
        button:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
<!--
# Goal
Create a comprehensive ecosystem simulation combining all aspects of autumn:
trees, weather, wildlife, decomposition, and the complete nutrient cycle.

# Approach
- Multiple interacting systems:
  * Trees changing color and dropping leaves
  * Weather system (rain, wind, temperature, sun)
  * Falling and accumulating leaves
  * Wildlife (birds migrating, squirrels gathering)
  * Decomposition process (ground leaves breaking down)
  * Nutrient cycling back to soil
- All systems interact and affect each other
- Complete autumn experience in one visualization
- Day/night cycle
- Real ecosystem dynamics

# Technical Implementation
- Canvas 2D with multiple layered systems
- Particle systems for leaves, rain, wildlife
- State machines for weather and time
- Chemical and biological process simulation
- Performance optimization for complex scene
- Dashboard showing all active systems
-->

<canvas id="canvas"></canvas>
<div class="dashboard">
    <h3>üçÇ Ecosystem Monitor</h3>

    <div class="stat">
        <span class="stat-label">Temperature:</span>
        <span class="stat-value" id="temp">12¬∞C</span>
    </div>
    <div class="stat">
        <span class="stat-label">Time:</span>
        <span class="stat-value" id="time">12:00</span>
    </div>
    <div class="stat">
        <span class="stat-label">Season Day:</span>
        <span class="stat-value" id="day">15</span>
    </div>
    <div class="stat">
        <span class="stat-label">Leaves on Trees:</span>
        <span class="stat-value" id="leaves-tree">0</span>
    </div>
    <div class="stat">
        <span class="stat-label">Falling Leaves:</span>
        <span class="stat-value" id="leaves-falling">0</span>
    </div>
    <div class="stat">
        <span class="stat-label">Ground Leaves:</span>
        <span class="stat-value" id="leaves-ground">0</span>
    </div>
    <div class="stat">
        <span class="stat-label">Wildlife:</span>
        <span class="stat-value" id="wildlife">0</span>
    </div>
    <div class="stat">
        <span class="stat-label">Weather:</span>
        <span class="stat-value" id="weather">Clear</span>
    </div>

    <div class="controls">
        <button id="btn-reset">üîÑ Reset Ecosystem</button>
        <button id="btn-speed">‚è© Speed 1x</button>
        <button id="btn-weather">üåßÔ∏è Change Weather</button>
    </div>
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const GROUND_Y = canvas.height - 80;

// Time and weather system
let timeOfDay = 6; // Hours (0-24)
let dayOfAutumn = 1;
let temperature = 15;
let weatherState = 'clear'; // clear, rainy, windy
let timeSpeed = 1;

// Ecosystem entities
const trees = [];
const fallingLeaves = [];
const groundLeaves = [];
const raindrops = [];
const wildlife = []; // Birds and squirrels

// Autumn colors
const autumnColors = ['#228B22', '#9ACD32', '#FFD700', '#FFA500', '#FF8C00', '#FF6347', '#DC143C'];

// Simple leaf entity
class EcoLeaf {
    constructor(x, y, onTree = true) {
        this.x = x;
        this.y = y;
        this.onTree = onTree;
        this.vx = 0;
        this.vy = onTree ? 0 : 1;
        this.size = 4 + Math.random() * 4;
        this.color = autumnColors[Math.floor(Math.random() * autumnColors.length)];
        this.rotation = Math.random() * Math.PI * 2;
        this.rotSpeed = (Math.random() - 0.5) * 0.1;
        this.age = 0;
    }

    update(wind) {
        if (this.onTree) return;

        this.vy += 0.03;
        this.vx += wind * 0.05;
        this.vx *= 0.99;
        this.vy *= 0.99;

        this.x += this.vx;
        this.y += this.vy;
        this.rotation += this.rotSpeed;

        return this.y >= GROUND_Y;
    }

    draw() {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.rotation);
        ctx.fillStyle = this.color;
        ctx.fillRect(-this.size / 2, -this.size / 2, this.size, this.size * 1.3);
        ctx.restore();
    }
}

// Wildlife entity (birds/squirrels)
class WildlifeEntity {
    constructor(type) {
        this.type = type; // 'bird' or 'squirrel'
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * (GROUND_Y - 100) + 50;
        this.vx = (Math.random() - 0.5) * 2;
        this.vy = this.type === 'bird' ? (Math.random() - 0.5) * 2 : 0;
        this.size = this.type === 'bird' ? 8 : 6;
    }

    update() {
        this.x += this.vx;
        this.y += this.vy;

        // Wrap around
        if (this.x < -10) this.x = canvas.width + 10;
        if (this.x > canvas.width + 10) this.x = -10;

        // Keep birds in air
        if (this.type === 'bird') {
            if (this.y < 50) this.vy = Math.abs(this.vy);
            if (this.y > GROUND_Y - 50) this.vy = -Math.abs(this.vy);
        }
    }

    draw() {
        ctx.fillStyle = this.type === 'bird' ? '#654321' : '#8B4513';

        if (this.type === 'bird') {
            // Simple bird shape
            ctx.beginPath();
            ctx.moveTo(this.x, this.y);
            ctx.lineTo(this.x - this.size, this.y + 3);
            ctx.lineTo(this.x + this.size, this.y + 3);
            ctx.closePath();
            ctx.fill();
        } else {
            // Squirrel (simple circle)
            ctx.beginPath();
            ctx.arc(this.x, GROUND_Y - 5, this.size, 0, Math.PI * 2);
            ctx.fill();
        }
    }
}

// Rain
class Rain {
    constructor() {
        this.x = Math.random() * canvas.width;
        this.y = -10;
        this.vy = 5 + Math.random() * 5;
    }

    update() {
        this.y += this.vy;
        return this.y > canvas.height;
    }

    draw() {
        ctx.strokeStyle = 'rgba(174, 214, 241, 0.6)';
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(this.x, this.y);
        ctx.lineTo(this.x, this.y + 10);
        ctx.stroke();
    }
}

// Initialize trees
for (let i = 0; i < 5; i++) {
    const treeX = (canvas.width / 6) * (i + 1);
    for (let j = 0; j < 30; j++) {
        const leaf = new EcoLeaf(
            treeX + (Math.random() - 0.5) * 60,
            GROUND_Y - 50 - Math.random() * 100,
            true
        );
        trees.push(leaf);
    }
}

// Initialize some wildlife
for (let i = 0; i < 5; i++) {
    wildlife.push(new WildlifeEntity(i < 3 ? 'bird' : 'squirrel'));
}

// Weather control
function changeWeather() {
    const states = ['clear', 'rainy', 'windy'];
    const currentIndex = states.indexOf(weatherState);
    weatherState = states[(currentIndex + 1) % states.length];
}

// Get sky color based on time
function getSkyColor(hour) {
    if (hour >= 6 && hour < 7) return'#FFB366'; // Dawn
    if (hour >= 7 && hour < 17) return '#87CEEB'; // Day
    if (hour >= 17 && hour < 19) return '#FF6B35'; // Dusk
    return '#1a1a2e'; // Night
}

// Controls
document.getElementById('btn-reset').addEventListener('click', () => {
    location.reload();
});

document.getElementById('btn-speed').addEventListener('click', function() {
    timeSpeed = timeSpeed === 1 ? 5 : (timeSpeed === 5 ? 10 : 1);
    this.textContent = `‚è© Speed ${timeSpeed}x`;
});

document.getElementById('btn-weather').addEventListener('click', changeWeather);

let lastTime = Date.now();
let frameCount = 0;

// Main loop
function animate() {
    frameCount++;
    const now = Date.now();
    const deltaTime = (now - lastTime) / 1000;
    lastTime = now;

    // Advance time
    timeOfDay += (deltaTime * timeSpeed) / 3600;
    if (timeOfDay >= 24) {
        timeOfDay = 0;
        dayOfAutumn++;
    }

    // Temperature varies with time and season
    const baseTemp = 20 - dayOfAutumn * 0.3;
    const timeFactor = timeOfDay < 6 || timeOfDay > 18 ? -5 : 0;
    temperature = Math.max(0, baseTemp + timeFactor);

    // Wind based on weather
    const windForce = weatherState === 'windy' ? 2 : 0.5;

    // Background
    ctx.fillStyle = getSkyColor(timeOfDay);
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Ground
    ctx.fillStyle = '#5d4e37';
    ctx.fillRect(0, GROUND_Y, canvas.width, canvas.height - GROUND_Y);

    // Tree trunks
    for (let i = 0; i < 5; i++) {
        const treeX = (canvas.width / 6) * (i + 1);
        ctx.fillStyle = '#3e2723';
        ctx.fillRect(treeX - 10, GROUND_Y - 100, 20, 100);
    }

    // Rain
    if (weatherState === 'rainy' && frameCount % 3 === 0) {
        raindrops.push(new Rain());
    }

    for (let i = raindrops.length - 1; i >= 0; i--) {
        const done = raindrops[i].update();
        raindrops[i].draw();
        if (done) raindrops.splice(i, 1);
    }

    // Leaves fall based on day and weather
    if (frameCount % 60 === 0 && trees.length > 0 && dayOfAutumn > 10) {
        const fallCount = Math.floor((dayOfAutumn - 10) / 5);
        for (let i = 0; i < Math.min(fallCount, trees.length); i++) {
            const leaf = trees.pop();
            leaf.onTree = false;
            fallingLeaves.push(leaf);
        }
    }

    // Update falling leaves
    for (let i = fallingLeaves.length - 1; i >= 0; i--) {
        const landed = fallingLeaves[i].update(windForce);
        if (landed) {
            groundLeaves.push(fallingLeaves[i]);
            fallingLeaves.splice(i, 1);
        }
    }

    // Draw ground leaves
    groundLeaves.forEach(leaf => {
        leaf.y = GROUND_Y;
        leaf.draw();
    });

    // Draw tree leaves
    trees.forEach(leaf => leaf.draw());

    // Draw falling leaves
    fallingLeaves.forEach(leaf => leaf.draw());

    // Update and draw wildlife
    wildlife.forEach(entity => {
        entity.update();
        entity.draw();
    });

    // Update dashboard
    document.getElementById('temp').textContent = `${Math.round(temperature)}¬∞C`;
    const hours = Math.floor(timeOfDay);
    const minutes = Math.floor((timeOfDay - hours) * 60);
    document.getElementById('time').textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
    document.getElementById('day').textContent = dayOfAutumn;
    document.getElementById('leaves-tree').textContent = trees.length;
    document.getElementById('leaves-falling').textContent = fallingLeaves.length;
    document.getElementById('leaves-ground').textContent = groundLeaves.length;
    document.getElementById('wildlife').textContent = wildlife.length;
    document.getElementById('weather').textContent = weatherState.charAt(0).toUpperCase() + weatherState.slice(1);

    requestAnimationFrame(animate);
}

animate();

window.addEventListener('resize', () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
});
</script>
</body>
</html>
