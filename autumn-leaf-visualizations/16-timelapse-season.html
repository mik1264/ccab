<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seasonal Time-lapse - Autumn Leaf Visualizations</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            font-family: 'Arial', sans-serif;
        }
        canvas {
            display: block;
        }
        .timeline {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 15px;
            color: white;
            min-width: 600px;
        }
        .timeline-bar {
            width: 100%;
            height: 40px;
            background: linear-gradient(90deg,
                #90EE90 0%,
                #FFD700 40%,
                #FF6347 70%,
                #8B4513 100%);
            border-radius: 20px;
            position: relative;
            margin: 15px 0;
        }
        .timeline-marker {
            position: absolute;
            width: 20px;
            height: 50px;
            background: white;
            border: 3px solid #333;
            border-radius: 10px;
            top: -5px;
            transition: left 0.1s linear;
        }
        .season-label {
            position: absolute;
            top: 50px;
            font-size: 12px;
        }
        .controls-row {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            background: #667eea;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }
        button:hover {
            background: #5568d3;
        }
        .info-display {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
<!--
# Goal
Create an accelerated time-lapse showing the complete progression of autumn,
from late summer through winter, compressing months into minutes.

# Approach
- Complete seasonal cycle: Late Summer → Early Autumn → Peak Autumn → Late Autumn → Early Winter
- Gradual environmental changes: temperature drops, daylight decreases, first frost
- Progressive leaf color change across entire tree
- Gradual leaf fall increasing over time
- Visual indicators: sun position, temperature, date
- User-controllable playback speed
- Timeline scrubber to jump to any point in season

# Technical Implementation
- Canvas 2D with time-based state system
- Interpolated environmental parameters over season timeline
- Progressive leaf state updates
- Timeline UI with interactive scrubbing
- Date/temperature/weather overlay
- Smooth transitions between seasonal phases
-->

<canvas id="canvas"></canvas>
<div class="timeline">
    <div class="info-display" id="info-display">Late August - 25°C</div>
    <div class="timeline-bar">
        <div class="timeline-marker" id="marker"></div>
        <div class="season-label" style="left: 0%;">Summer</div>
        <div class="season-label" style="left: 25%;">Early Autumn</div>
        <div class="season-label" style="left: 50%;">Peak Autumn</div>
        <div class="season-label" style="left: 75%;">Late Autumn</div>
        <div class="season-label" style="right: 0%;">Winter</div>
    </div>
    <div class="controls-row">
        <button id="btn-play-pause">▶ Play</button>
        <button id="btn-faster">⏩ Faster</button>
        <button id="btn-slower">⏪ Slower</button>
        <button id="btn-reset">↺ Reset</button>
    </div>
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// Seasonal timeline (0-1, where 0 = late summer, 1 = early winter)
let seasonProgress = 0;
let isPlaying = false;
let playbackSpeed = 1;

// Get environmental parameters based on season progress
function getSeasonalParams(progress) {
    // Temperature: 25°C → 0°C
    const temperature = 25 - (progress * 25);

    // Daylight hours: 14h → 8h
    const daylightHours = 14 - (progress * 6);

    // Sun intensity: 80% → 20%
    const sunIntensity = 80 - (progress * 60);

    // Wind: increases toward end
    const windSpeed = progress * 2;

    // Month names
    const months = ['Late August', 'Early September', 'Late September', 'Early October',
                    'Late October', 'Early November', 'Late November', 'Early December'];
    const monthIndex = Math.floor(progress * (months.length - 1));
    const month = months[monthIndex];

    // Sky color
    let skyColor;
    if (progress < 0.25) {
        skyColor = '#87CEEB'; // Summer blue
    } else if (progress < 0.5) {
        skyColor = '#9DB4C8'; // Pale blue
    } else if (progress < 0.75) {
        skyColor = '#B8C5D6'; // Gray-blue
    } else {
        skyColor = '#D5DFE8'; // Winter gray
    }

    return { temperature, daylightHours, sunIntensity, windSpeed, month, skyColor };
}

class SeasonalLeaf {
    constructor(x, y) {
        this.x = x;
        this.baseX = x;
        this.y = y;
        this.baseY = y;
        this.size = 5 + Math.random() * 4;

        // Initial state (summer)
        this.baseChlorophyll = 80 + Math.random() * 20;
        this.carotene = 50 + Math.random() * 40;
        this.sugar = 30 + Math.random() * 40;

        this.fallen = false;
        this.fallProgress = 0;
        this.fallX = 0;
        this.fallY = 0;
        this.fallRotation = 0;
    }

    update(seasonProgress, windSpeed) {
        // Determine when this leaf falls (staggered over season)
        const fallThreshold = 0.3 + Math.random() * 0.5;

        if (seasonProgress > fallThreshold && !this.fallen) {
            this.fallen = true;
            this.fallX = this.baseX;
            this.fallY = this.baseY;
        }

        if (this.fallen) {
            this.fallProgress += 0.01;
            this.fallY += 2;
            this.fallX += (Math.random() - 0.5) * windSpeed;
            this.fallRotation += 0.1;

            if (this.fallY > canvas.height - 100) {
                this.fallY = canvas.height - 100;
            }
        } else {
            // Sway in wind
            const sway = Math.sin(Date.now() * 0.001 + this.baseX) * windSpeed * 2;
            this.x = this.baseX + sway;
            this.y = this.baseY;
        }
    }

    getColor(seasonProgress) {
        // Color evolves with season
        const chlorophyll = Math.max(0, this.baseChlorophyll - (seasonProgress * 120));
        const anthocyanin = Math.min(100, seasonProgress * 100);

        const chloroRatio = chlorophyll / 100;
        const caroteRatio = this.carotene / 100;
        const anthocRatio = anthocyanin / 100;

        if (chloroRatio > 0.5) {
            const intensity = 50 + chloroRatio * 150;
            return `rgb(${intensity * 0.3}, ${intensity}, ${intensity * 0.3})`;
        }

        const yellowInfluence = (1 - chloroRatio) * caroteRatio;
        const redInfluence = anthocRatio;

        let r, g, b;
        if (redInfluence > yellowInfluence + 0.2) {
            r = 180 + redInfluence * 75;
            g = 20 + yellowInfluence * 100;
            b = 20;
        } else if (yellowInfluence > redInfluence + 0.2) {
            r = 200 + yellowInfluence * 55;
            g = 180 + yellowInfluence * 75;
            b = 20;
        } else {
            r = 255;
            g = 100 + yellowInfluence * 100;
            b = 20;
        }

        // Brown if on ground for a while
        if (this.fallen && this.fallY >= canvas.height - 100) {
            const brownFactor = Math.min(1, (seasonProgress - 0.5) * 2);
            r = r + (139 - r) * brownFactor;
            g = g + (69 - g) * brownFactor;
            b = b + (19 - b) * brownFactor;
        }

        return `rgb(${Math.floor(r)}, ${Math.floor(g)}, ${Math.floor(b)})`;
    }

    draw(seasonProgress) {
        const x = this.fallen ? this.fallX : this.x;
        const y = this.fallen ? this.fallY : this.y;
        const rotation = this.fallen ? this.fallRotation : 0;

        ctx.save();
        ctx.translate(x, y);
        ctx.rotate(rotation);

        ctx.fillStyle = this.getColor(seasonProgress);
        ctx.beginPath();
        ctx.arc(0, 0, this.size, 0, Math.PI * 2);
        ctx.fill();

        ctx.restore();
    }
}

// Create tree
const leaves = [];
const branches = [];

function createBranch(x, y, angle, length, depth) {
    if (depth > 7) return;

    const endX = x + Math.cos(angle) * length;
    const endY = y + Math.sin(angle) * length;

    branches.push({ x1: x, y1: y, x2: endX, y2: endY, depth });

    if (depth > 4) {
        for (let i = 0; i < 3; i++) {
            leaves.push(new SeasonalLeaf(
                endX + (Math.random() - 0.5) * 10,
                endY + (Math.random() - 0.5) * 10
            ));
        }
    }

    if (depth < 7) {
        const numChildren = depth < 2 ? 2 : (Math.random() > 0.5 ? 2 : 1);
        for (let i = 0; i < numChildren; i++) {
            const newAngle = angle + (Math.random() - 0.5) * Math.PI / 2.5;
            const newLength = length * (0.65 + Math.random() * 0.15);
            createBranch(endX, endY, newAngle, newLength, depth + 1);
        }
    }
}

createBranch(canvas.width / 2, canvas.height - 100, -Math.PI / 2, 100, 0);

// Timeline interaction
const timelineBar = document.querySelector('.timeline-bar');
const marker = document.getElementById('marker');

timelineBar.addEventListener('click', (e) => {
    const rect = timelineBar.getBoundingClientRect();
    const clickX = e.clientX - rect.left;
    seasonProgress = clickX / rect.width;
    seasonProgress = Math.max(0, Math.min(1, seasonProgress));
});

// Controls
document.getElementById('btn-play-pause').addEventListener('click', function() {
    isPlaying = !isPlaying;
    this.textContent = isPlaying ? '⏸ Pause' : '▶ Play';
});

document.getElementById('btn-faster').addEventListener('click', () => {
    playbackSpeed *= 2;
    playbackSpeed = Math.min(16, playbackSpeed);
});

document.getElementById('btn-slower').addEventListener('click', () => {
    playbackSpeed *= 0.5;
    playbackSpeed = Math.max(0.25, playbackSpeed);
});

document.getElementById('btn-reset').addEventListener('click', () => {
    seasonProgress = 0;
    leaves.forEach(leaf => {
        leaf.fallen = false;
        leaf.fallProgress = 0;
    });
});

// Animation
function animate() {
    if (isPlaying) {
        seasonProgress += 0.0001 * playbackSpeed;
        if (seasonProgress > 1) seasonProgress = 1;
    }

    const params = getSeasonalParams(seasonProgress);

    // Background
    ctx.fillStyle = params.skyColor;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Ground
    ctx.fillStyle = seasonProgress > 0.8 ? '#F0F0F0' : '#8B7355'; // Snow or dirt
    ctx.fillRect(0, canvas.height - 100, canvas.width, 100);

    // Branches
    ctx.strokeStyle = '#3e2723';
    ctx.lineCap = 'round';
    branches.forEach(branch => {
        ctx.lineWidth = Math.max(1, 8 - branch.depth);
        ctx.beginPath();
        ctx.moveTo(branch.x1, branch.y1);
        ctx.lineTo(branch.x2, branch.y2);
        ctx.stroke();
    });

    // Update and draw leaves
    leaves.forEach(leaf => {
        leaf.update(seasonProgress, params.windSpeed);
        leaf.draw(seasonProgress);
    });

    // Update timeline marker
    marker.style.left = `calc(${seasonProgress * 100}% - 10px)`;

    // Update info display
    document.getElementById('info-display').textContent =
        `${params.month} - ${Math.round(params.temperature)}°C`;

    requestAnimationFrame(animate);
}

animate();

window.addEventListener('resize', () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
});
</script>
</body>
</html>
