<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anthocyanin Production - Autumn Leaf Visualizations</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #1a1a2e;
            font-family: 'Arial', sans-serif;
            color: white;
        }
        canvas {
            display: block;
        }
        .controls {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(255, 0, 0, 0.3);
            border: 2px solid #ff4757;
        }
        .control-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #fff;
        }
        input[type="range"] {
            width: 200px;
        }
        .value {
            display: inline-block;
            width: 60px;
            text-align: right;
            color: #ffa502;
        }
        h3 {
            margin-top: 0;
            color: #ff4757;
        }
        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #ff4757;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }
        .legend-color {
            width: 30px;
            height: 20px;
            margin-right: 10px;
            border-radius: 3px;
            border: 1px solid white;
        }
    </style>
</head>
<body>
<!--
# Goal
Visualize the chemical process of anthocyanin production in autumn leaves,
showing how cold temperatures + sugar + water create the red pigments
responsible for brilliant autumn reds.

# Approach
- Display leaf as a cellular grid where each cell can produce anthocyanins
- Show chemical reaction: sugar + water + cold temp → anthocyanin
- Use particle effects to visualize molecular interactions
- Color intensity represents anthocyanin concentration
- Interactive controls for temperature, sugar, and water levels
- Real-time visualization of the chemical conversion process

# Technical Implementation
- Canvas 2D with cellular automaton-like grid
- Particle system for molecule visualization
- Color mapping from anthocyanin concentration (yellow→orange→red→deep red)
- Reaction kinetics simulation
- Visual feedback showing reagent consumption and product formation
-->

<canvas id="canvas"></canvas>
<div class="controls">
    <h3>Anthocyanin Production</h3>
    <div class="control-group">
        <label>Temperature: <span class="value" id="temp-value">5</span>°C</label>
        <input type="range" id="temperature" min="0" max="25" value="5" step="1">
    </div>
    <div class="control-group">
        <label>Sugar Level: <span class="value" id="sugar-value">60</span>%</label>
        <input type="range" id="sugar" min="0" max="100" value="60" step="1">
    </div>
    <div class="control-group">
        <label>Water Level: <span class="value" id="water-value">70</span>%</label>
        <input type="range" id="water" min="0" max="100" value="70" step="1">
    </div>
</div>

<div class="legend">
    <h4 style="margin-top: 0; color: #ff4757;">Pigment Key</h4>
    <div class="legend-item">
        <div class="legend-color" style="background: #FFD700;"></div>
        <span>Carotene (Yellow)</span>
    </div>
    <div class="legend-item">
        <div class="legend-color" style="background: #FFA500;"></div>
        <span>Low Anthocyanin</span>
    </div>
    <div class="legend-item">
        <div class="legend-color" style="background: #FF6347;"></div>
        <span>Medium Anthocyanin</span>
    </div>
    <div class="legend-item">
        <div class="legend-color" style="background: #DC143C;"></div>
        <span>High Anthocyanin</span>
    </div>
    <div class="legend-item">
        <div class="legend-color" style="background: #8B0000;"></div>
        <span>Maximum Anthocyanin</span>
    </div>
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// Cell grid for leaf structure
const CELL_SIZE = 8;
const cols = Math.floor(canvas.width / CELL_SIZE);
const rows = Math.floor(canvas.height / CELL_SIZE);

class Cell {
    constructor(x, y) {
        this.x = x;
        this.y = y;
        this.sugar = 0;
        this.water = 0;
        this.anthocyanin = 0;
        this.carotene = 60 + Math.random() * 40; // Constant yellow pigment
        this.isLeafCell = false;
    }

    update(temperature, sugarSupply, waterSupply) {
        if (!this.isLeafCell) return;

        // Receive sugar and water from environment
        this.sugar += (sugarSupply - this.sugar) * 0.01;
        this.water += (waterSupply - this.water) * 0.01;

        // Anthocyanin production requires cold temp, sugar, and water
        if (temperature < 15 && this.sugar > 10 && this.water > 10) {
            const reactionRate = (15 - temperature) / 15; // More production when colder
            const available = Math.min(this.sugar, this.water);
            const production = available * reactionRate * 0.05;

            this.anthocyanin += production;
            this.sugar -= production * 0.5;
            this.water -= production * 0.5;
        }

        // Anthocyanin degrades slowly when warm
        if (temperature > 20) {
            this.anthocyanin -= 0.1;
        }

        // Clamp values
        this.sugar = Math.max(0, Math.min(100, this.sugar));
        this.water = Math.max(0, Math.min(100, this.water));
        this.anthocyanin = Math.max(0, Math.min(100, this.anthocyanin));
    }

    getColor() {
        if (!this.isLeafCell) {
            return '#1a1a2e';
        }

        const anthocRatio = this.anthocyanin / 100;
        const caroteRatio = this.carotene / 100;

        if (anthocRatio < 0.2) {
            // Mostly yellow (carotene)
            const intensity = caroteRatio * 255;
            return `rgb(${intensity}, ${intensity * 0.85}, 0)`;
        } else if (anthocRatio < 0.4) {
            // Orange (transition)
            return `rgb(255, ${140 + anthocRatio * 100}, 0)`;
        } else if (anthocRatio < 0.7) {
            // Red
            const greenComp = Math.floor((1 - anthocRatio) * 100);
            return `rgb(255, ${greenComp}, ${greenComp * 0.5})`;
        } else {
            // Deep red
            const darkness = anthocRatio * 139;
            return `rgb(${139 + (1 - anthocRatio) * 116}, ${darkness * 0.1}, 0)`;
        }
    }

    draw() {
        ctx.fillStyle = this.getColor();
        ctx.fillRect(this.x * CELL_SIZE, this.y * CELL_SIZE, CELL_SIZE, CELL_SIZE);

        // Add slight border for cell visibility
        if (this.isLeafCell) {
            ctx.strokeStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.strokeRect(this.x * CELL_SIZE, this.y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
        }
    }
}

// Create cell grid
const cells = [];
for (let y = 0; y < rows; y++) {
    cells[y] = [];
    for (let x = 0; x < cols; x++) {
        cells[y][x] = new Cell(x, y);
    }
}

// Define leaf shape (oval in center)
const centerX = cols / 2;
const centerY = rows / 2;
const leafRadiusX = cols * 0.3;
const leafRadiusY = rows * 0.35;

for (let y = 0; y < rows; y++) {
    for (let x = 0; x < cols; x++) {
        const dx = (x - centerX) / leafRadiusX;
        const dy = (y - centerY) / leafRadiusY;
        if (dx * dx + dy * dy < 1) {
            cells[y][x].isLeafCell = true;
            cells[y][x].sugar = 20 + Math.random() * 30;
            cells[y][x].water = 40 + Math.random() * 30;
        }
    }
}

// Particle system for visual effects
class Particle {
    constructor(x, y, type) {
        this.x = x;
        this.y = y;
        this.type = type; // 'sugar', 'water', 'anthocyanin'
        this.vx = (Math.random() - 0.5) * 2;
        this.vy = (Math.random() - 0.5) * 2;
        this.life = 1.0;
        this.size = 2 + Math.random() * 3;
    }

    update() {
        this.x += this.vx;
        this.y += this.vy;
        this.life -= 0.02;
        this.vx *= 0.98;
        this.vy *= 0.98;
    }

    draw() {
        ctx.save();
        ctx.globalAlpha = this.life;

        if (this.type === 'sugar') {
            ctx.fillStyle = '#FFD700';
        } else if (this.type === 'water') {
            ctx.fillStyle = '#4169E1';
        } else {
            ctx.fillStyle = '#DC143C';
        }

        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
    }
}

const particles = [];

// Controls
let temperature = 5;
let sugarLevel = 60;
let waterLevel = 70;

document.getElementById('temperature').addEventListener('input', (e) => {
    temperature = parseFloat(e.target.value);
    document.getElementById('temp-value').textContent = temperature;
});

document.getElementById('sugar').addEventListener('input', (e) => {
    sugarLevel = parseFloat(e.target.value);
    document.getElementById('sugar-value').textContent = sugarLevel;
});

document.getElementById('water').addEventListener('input', (e) => {
    waterLevel = parseFloat(e.target.value);
    document.getElementById('water-value').textContent = waterLevel;
});

let frameCount = 0;

function animate() {
    frameCount++;

    // Clear background
    ctx.fillStyle = '#1a1a2e';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Update and draw cells
    for (let y = 0; y < rows; y++) {
        for (let x = 0; x < cols; x++) {
            cells[y][x].update(temperature, sugarLevel, waterLevel);
            cells[y][x].draw();
        }
    }

    // Spawn particles occasionally to show chemical activity
    if (frameCount % 5 === 0 && temperature < 15) {
        const randomCell = cells[Math.floor(Math.random() * rows)][Math.floor(Math.random() * cols)];
        if (randomCell.isLeafCell && randomCell.anthocyanin > 20) {
            particles.push(new Particle(
                randomCell.x * CELL_SIZE + CELL_SIZE / 2,
                randomCell.y * CELL_SIZE + CELL_SIZE / 2,
                'anthocyanin'
            ));
        }
    }

    // Update and draw particles
    for (let i = particles.length - 1; i >= 0; i--) {
        particles[i].update();
        particles[i].draw();

        if (particles[i].life <= 0) {
            particles.splice(i, 1);
        }
    }

    // Draw title and stats
    ctx.fillStyle = 'white';
    ctx.font = 'bold 20px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('Anthocyanin Synthesis: Sugar + Water + Cold → Red Pigment', canvas.width / 2, 30);

    // Calculate average anthocyanin
    let totalAnthocyanin = 0;
    let leafCellCount = 0;
    for (let y = 0; y < rows; y++) {
        for (let x = 0; x < cols; x++) {
            if (cells[y][x].isLeafCell) {
                totalAnthocyanin += cells[y][x].anthocyanin;
                leafCellCount++;
            }
        }
    }
    const avgAnthocyanin = totalAnthocyanin / leafCellCount;

    ctx.font = '14px Arial';
    ctx.fillText(`Average Anthocyanin: ${avgAnthocyanin.toFixed(1)}%`, canvas.width / 2, 55);

    requestAnimationFrame(animate);
}

animate();

window.addEventListener('resize', () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
});
</script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
