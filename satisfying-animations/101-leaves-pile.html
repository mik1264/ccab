<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaves Pile - Satisfying Animations - CCAB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0a0e1a; overflow: hidden; }
        canvas { display: block; }
        .back-link { position: fixed; top: 20px; left: 20px; padding: 10px 20px; background: rgba(254, 250, 224, 0.9); color: #606C38; text-decoration: none; border-radius: 25px; font-family: 'Segoe UI', sans-serif; font-weight: 600; font-size: 14px; z-index: 1000; }
        .back-link:hover { background: #FEFAE0; transform: translateX(-5px); }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back</a>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <script>
        let leaves = [];
        const NUM_LEAVES = 40;
        let leafSize;

        function setup() {
            createCanvas(windowWidth, windowHeight);
            colorMode(HSB, 360, 100, 100, 100);
            generateLeaves();
        }

        function generateLeaves() {
            leaves = [];
            leafSize = min(width, height) * 0.04;

            const pileX = width / 2;
            const groundY = height * 0.85;

            for (let i = 0; i < NUM_LEAVES; i++) {
                // Autumn colors
                const hue = random([15, 25, 35, 45, 10, 5]); // Orange, yellow, red tones
                const sat = random(50, 80);
                const bri = random(50, 75);

                // Target position in pile
                const pileRadius = leafSize * 3;
                const angle = random(TWO_PI);
                const r = random(pileRadius);
                const pileY = groundY - random(leafSize * 3);

                leaves.push({
                    x: random(width),
                    y: random(-height, -leafSize),
                    targetX: pileX + cos(angle) * r * (i / NUM_LEAVES),
                    targetY: pileY,
                    rotation: random(TWO_PI),
                    targetRotation: random(-0.5, 0.5),
                    rotSpeed: random(-0.02, 0.02),
                    vy: 0,
                    vx: random(-1, 1),
                    wobble: random(TWO_PI),
                    wobbleSpeed: random(0.02, 0.05),
                    hue: hue,
                    sat: sat,
                    bri: bri,
                    size: leafSize * random(0.7, 1.2),
                    delay: i * 150,
                    landed: false,
                    stemAngle: random(-0.3, 0.3)
                });
            }
        }

        function draw() {
            // Autumn sky gradient
            for (let y = 0; y < height; y++) {
                const t = y / height;
                const h = lerp(220, 230, t);
                const s = lerp(40, 30, t);
                const b = lerp(20, 10, t);
                stroke(h, s, b);
                line(0, y, width, y);
            }

            const time = millis();
            const cycleDuration = 12000;
            const cycleTime = time % cycleDuration;

            // Reset at cycle start
            if (cycleTime < 50) {
                generateLeaves();
            }

            // Draw ground
            fill(25, 40, 25);
            noStroke();
            rect(0, height * 0.85, width, height * 0.15);

            // Update and draw leaves
            for (let leaf of leaves) {
                const leafTime = cycleTime - leaf.delay;

                if (leafTime > 0) {
                    if (!leaf.landed) {
                        // Falling physics
                        leaf.vy += 0.1; // Gravity
                        leaf.y += leaf.vy;
                        leaf.x += leaf.vx + sin(time * leaf.wobbleSpeed + leaf.wobble) * 0.5;
                        leaf.rotation += leaf.rotSpeed;

                        // Wind effect
                        leaf.vx += sin(time * 0.001) * 0.05;
                        leaf.vx *= 0.99;

                        // Drift toward pile
                        const driftX = (leaf.targetX - leaf.x) * 0.01;
                        leaf.vx += driftX;

                        // Check landing
                        if (leaf.y >= leaf.targetY) {
                            leaf.y = leaf.targetY;
                            leaf.landed = true;
                            leaf.landTime = time;
                        }
                    } else {
                        // Settle into pile
                        const settleTime = time - leaf.landTime;
                        if (settleTime < 500) {
                            const settleProgress = settleTime / 500;
                            leaf.x = lerp(leaf.x, leaf.targetX, settleProgress * 0.1);
                            leaf.rotation = lerp(leaf.rotation, leaf.targetRotation, settleProgress * 0.1);
                        }

                        // Gentle breathing motion when settled
                        leaf.y = leaf.targetY + sin(time * 0.002 + leaf.wobble) * 0.5;
                    }

                    // Draw leaf
                    push();
                    translate(leaf.x, leaf.y);
                    rotate(leaf.rotation);

                    // Leaf shadow
                    fill(0, 0, 0, 20);
                    noStroke();
                    drawLeafShape(leaf.size, 2, 2);

                    // Main leaf
                    fill(leaf.hue, leaf.sat, leaf.bri);
                    stroke(leaf.hue, leaf.sat + 10, leaf.bri - 15);
                    strokeWeight(1);
                    drawLeafShape(leaf.size, 0, 0);

                    // Leaf vein
                    stroke(leaf.hue, leaf.sat - 10, leaf.bri - 10);
                    strokeWeight(1);
                    line(0, -leaf.size * 0.3, 0, leaf.size * 0.4);

                    // Side veins
                    for (let i = -2; i <= 2; i++) {
                        if (i !== 0) {
                            const vy = i * leaf.size * 0.12;
                            const vx = (i > 0 ? 1 : -1) * leaf.size * 0.25;
                            line(0, vy, vx, vy - leaf.size * 0.05);
                        }
                    }

                    pop();
                }
            }

            // Wind particles
            stroke(0, 0, 100, 20);
            strokeWeight(1);
            for (let i = 0; i < 10; i++) {
                const wx = (time * 0.1 + i * 200) % (width + 100) - 50;
                const wy = height * 0.3 + sin(time * 0.002 + i) * 100;
                line(wx, wy, wx + 20, wy + sin(time * 0.01 + i) * 5);
            }
        }

        function drawLeafShape(size, offsetX, offsetY) {
            beginShape();
            // Leaf shape using curves
            vertex(offsetX, offsetY - size * 0.4);

            bezierVertex(
                offsetX + size * 0.4, offsetY - size * 0.2,
                offsetX + size * 0.35, offsetY + size * 0.3,
                offsetX, offsetY + size * 0.5
            );

            bezierVertex(
                offsetX - size * 0.35, offsetY + size * 0.3,
                offsetX - size * 0.4, offsetY - size * 0.2,
                offsetX, offsetY - size * 0.4
            );

            endShape(CLOSE);
        }

        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
            generateLeaves();
        }
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
