<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magnet Align - Satisfying Animations - CCAB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0a0e1a; overflow: hidden; }
        canvas { display: block; }
        .back-link { position: fixed; top: 20px; left: 20px; padding: 10px 20px; background: rgba(254, 250, 224, 0.9); color: #606C38; text-decoration: none; border-radius: 25px; font-family: 'Segoe UI', sans-serif; font-weight: 600; font-size: 14px; z-index: 1000; }
        .back-link:hover { background: #FEFAE0; transform: translateX(-5px); }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back</a>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <script>
        let particles = [];
        const NUM_PARTICLES = 80;
        let particleSize;
        let fieldActive = false;

        function setup() {
            createCanvas(windowWidth, windowHeight);
            colorMode(HSB, 360, 100, 100, 100);
            generateParticles();
        }

        function generateParticles() {
            particles = [];
            particleSize = min(width, height) * 0.025;

            for (let i = 0; i < NUM_PARTICLES; i++) {
                particles.push({
                    x: random(width * 0.1, width * 0.9),
                    y: random(height * 0.1, height * 0.9),
                    angle: random(TWO_PI),
                    targetAngle: 0,
                    vx: random(-1, 1),
                    vy: random(-1, 1),
                    va: random(-0.05, 0.05), // Angular velocity
                    polarity: random() > 0.5 ? 1 : -1
                });
            }
        }

        function draw() {
            background(230, 30, 10);

            const time = millis();
            const cycleDuration = 10000;
            const cycleTime = time % cycleDuration;

            // Animation phases
            let phase, fieldStrength;

            if (cycleTime < 3000) {
                phase = 'chaos';
                fieldStrength = 0;
            } else if (cycleTime < 7000) {
                phase = 'aligning';
                fieldStrength = easeInOutCubic((cycleTime - 3000) / 4000);
            } else if (cycleTime < 8500) {
                phase = 'aligned';
                fieldStrength = 1;
            } else {
                phase = 'release';
                fieldStrength = 1 - easeInOutCubic((cycleTime - 8500) / 1500);
            }

            // Draw magnetic field lines when active
            if (fieldStrength > 0) {
                stroke(45, 40, 40, 30 * fieldStrength);
                strokeWeight(1);
                const lineSpacing = 40;

                for (let y = 0; y < height; y += lineSpacing) {
                    beginShape();
                    for (let x = 0; x < width; x += 10) {
                        const wave = sin(x * 0.01 + time * 0.002) * 10 * (1 - fieldStrength);
                        vertex(x, y + wave);
                    }
                    endShape();
                }
            }

            // Update particles
            for (let p of particles) {
                if (phase === 'chaos' || phase === 'release') {
                    // Random motion
                    p.x += p.vx;
                    p.y += p.vy;
                    p.angle += p.va;

                    // Bounce
                    if (p.x < particleSize || p.x > width - particleSize) p.vx *= -1;
                    if (p.y < particleSize || p.y > height - particleSize) p.vy *= -1;

                    p.x = constrain(p.x, particleSize, width - particleSize);
                    p.y = constrain(p.y, particleSize, height - particleSize);
                } else {
                    // Align with field (horizontal)
                    p.targetAngle = p.polarity > 0 ? 0 : PI;

                    // Smooth rotation toward target
                    let angleDiff = p.targetAngle - p.angle;
                    while (angleDiff > PI) angleDiff -= TWO_PI;
                    while (angleDiff < -PI) angleDiff += TWO_PI;

                    p.angle += angleDiff * fieldStrength * 0.1;

                    // Reduce random motion
                    p.vx *= 0.95;
                    p.vy *= 0.95;
                    p.x += p.vx * (1 - fieldStrength * 0.8);
                    p.y += p.vy * (1 - fieldStrength * 0.8);

                    // Gentle drift in field direction
                    p.x += cos(p.angle) * fieldStrength * 0.5;
                }

                // Draw particle (bar magnet shape)
                push();
                translate(p.x, p.y);
                rotate(p.angle);

                const barLength = particleSize * 2.5;
                const barHeight = particleSize * 0.8;

                // Shadow
                fill(0, 0, 0, 20);
                noStroke();
                rect(-barLength / 2 + 2, -barHeight / 2 + 2, barLength, barHeight, 3);

                // North pole (red)
                fill(0, 70, 70);
                stroke(0, 80, 50);
                strokeWeight(1);
                rect(-barLength / 2, -barHeight / 2, barLength / 2, barHeight, 3, 0, 0, 3);

                // South pole (blue)
                fill(220, 70, 70);
                stroke(220, 80, 50);
                rect(0, -barHeight / 2, barLength / 2, barHeight, 0, 3, 3, 0);

                // Center line
                stroke(0, 0, 30);
                strokeWeight(1);
                line(0, -barHeight / 2, 0, barHeight / 2);

                // Pole labels
                fill(0, 0, 100, 80);
                noStroke();
                textSize(particleSize * 0.5);
                textAlign(CENTER, CENTER);
                text('N', -barLength / 4, 0);
                text('S', barLength / 4, 0);

                pop();
            }

            // Field indicator
            if (fieldStrength > 0) {
                fill(45, 60, 80, 60 * fieldStrength);
                noStroke();
                textSize(16);
                textAlign(CENTER, TOP);
                text('← Magnetic Field →', width / 2, 30);

                // Field strength bar
                const barWidth = 100;
                fill(230, 30, 30);
                rect(width / 2 - barWidth / 2, 55, barWidth, 6, 3);
                fill(45, 60, 70);
                rect(width / 2 - barWidth / 2, 55, barWidth * fieldStrength, 6, 3);
            }
        }

        function easeInOutCubic(x) {
            return x < 0.5 ? 4 * x * x * x : 1 - pow(-2 * x + 2, 3) / 2;
        }

        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
            generateParticles();
        }
    </script>
</body>
</html>
