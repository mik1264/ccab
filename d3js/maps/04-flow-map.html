<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flow Map - Trade Routes</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #1a1a2e;
            overflow: hidden;
        }
        h1 {
            color: #eee;
            text-align: center;
            margin-bottom: 10px;
        }
        .info {
            color: #aaa;
            text-align: center;
            margin-bottom: 20px;
        }
        svg {
            display: block;
            margin: 0 auto;
            background: #16213e;
            border-radius: 10px;
        }
        .landmass {
            fill: #2d4a5a;
            stroke: #4a6fa5;
            stroke-width: 1px;
        }
        .flow-path {
            fill: none;
            stroke-opacity: 0.6;
        }
        .city {
            fill: #ffd700;
            stroke: #fff;
            stroke-width: 2px;
        }
        .city:hover {
            fill: #ffed4e;
        }
    </style>
</head>
<body>
    <h1>Global Shipping Routes</h1>
    <p class="info">Line width represents cargo volume</p>
    <svg id="map"></svg>

    <script>
        const width = window.innerWidth - 40;
        const height = window.innerHeight - 140;

        const svg = d3.select("#map")
            .attr("width", width)
            .attr("height", height);

        // Simple landmass representations
        const continents = [
            { name: "North America", x: 150, y: 150, w: 300, h: 250 },
            { name: "South America", x: 200, y: 450, w: 200, h: 300 },
            { name: "Europe", x: 550, y: 120, w: 180, h: 200 },
            { name: "Africa", x: 520, y: 350, w: 250, h: 350 },
            { name: "Asia", x: 750, y: 100, w: 350, h: 400 },
            { name: "Australia", x: 900, y: 550, w: 200, h: 150 }
        ];

        svg.append("g")
            .selectAll("rect")
            .data(continents)
            .join("rect")
            .attr("class", "landmass")
            .attr("x", d => d.x)
            .attr("y", d => d.y)
            .attr("width", d => d.w)
            .attr("height", d => d.h)
            .attr("rx", 10);

        // Major ports
        const ports = [
            { name: "Los Angeles", x: 180, y: 220, continent: "North America" },
            { name: "New York", x: 380, y: 200, continent: "North America" },
            { name: "Santos", x: 280, y: 580, continent: "South America" },
            { name: "Rotterdam", x: 590, y: 160, continent: "Europe" },
            { name: "Lagos", x: 580, y: 500, continent: "Africa" },
            { name: "Singapore", x: 920, y: 350, continent: "Asia" },
            { name: "Shanghai", x: 980, y: 220, continent: "Asia" },
            { name: "Dubai", x: 800, y: 280, continent: "Asia" },
            { name: "Sydney", x: 1000, y: 620, continent: "Australia" }
        ];

        // Trade routes
        const routes = [
            { from: 0, to: 6, volume: 80 },  // LA to Shanghai
            { from: 1, to: 3, volume: 70 },  // NY to Rotterdam
            { from: 3, to: 5, volume: 60 },  // Rotterdam to Singapore
            { from: 6, to: 5, volume: 90 },  // Shanghai to Singapore
            { from: 5, to: 8, volume: 50 },  // Singapore to Sydney
            { from: 7, to: 3, volume: 65 },  // Dubai to Rotterdam
            { from: 2, to: 1, volume: 45 },  // Santos to NY
            { from: 4, to: 3, volume: 55 },  // Lagos to Rotterdam
            { from: 0, to: 5, volume: 75 },  // LA to Singapore
            { from: 6, to: 7, volume: 70 }   // Shanghai to Dubai
        ];

        const widthScale = d3.scaleLinear()
            .domain([0, 100])
            .range([1, 10]);

        const colorScale = d3.scaleSequential(d3.interpolateWarm)
            .domain([0, 100]);

        // Draw routes
        svg.append("g")
            .selectAll("path")
            .data(routes)
            .join("path")
            .attr("class", "flow-path")
            .attr("d", d => {
                const source = ports[d.from];
                const target = ports[d.to];
                const mx = (source.x + target.x) / 2;
                const my = (source.y + target.y) / 2 - 50;
                return `M ${source.x},${source.y} Q ${mx},${my} ${target.x},${target.y}`;
            })
            .attr("stroke", d => colorScale(d.volume))
            .attr("stroke-width", d => widthScale(d.volume))
            .append("title")
            .text(d => `${ports[d.from].name} â†’ ${ports[d.to].name}\nVolume: ${d.volume}M tons/year`);

        // Draw ports
        svg.append("g")
            .selectAll("circle")
            .data(ports)
            .join("circle")
            .attr("class", "city")
            .attr("cx", d => d.x)
            .attr("cy", d => d.y)
            .attr("r", 8)
            .append("title")
            .text(d => d.name);

        // Port labels
        svg.append("g")
            .selectAll("text")
            .data(ports)
            .join("text")
            .attr("x", d => d.x)
            .attr("y", d => d.y - 15)
            .attr("text-anchor", "middle")
            .attr("fill", "#ffd700")
            .attr("font-size", "11px")
            .attr("font-weight", "bold")
            .text(d => d.name);
    </script>
    <script src="../../assets/js/enhance.js" defer></script>
</body>
</html>
