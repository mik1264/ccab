<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hexbin Density Map</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://d3js.org/d3-hexbin.v0.2.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #2d3436;
            overflow: hidden;
        }
        h1 {
            color: #dfe6e9;
            text-align: center;
            margin-bottom: 10px;
        }
        .info {
            color: #b2bec3;
            text-align: center;
            margin-bottom: 20px;
        }
        svg {
            display: block;
            margin: 0 auto;
            background: #636e72;
            border-radius: 10px;
        }
        .hexagon {
            stroke: #2d3436;
            stroke-width: 1px;
        }
        .hexagon:hover {
            stroke: #fff;
            stroke-width: 2px;
        }
    </style>
</head>
<body>
    <h1>Point Density Hexbin Map</h1>
    <p class="info">Event concentration across geographic area</p>
    <svg id="map"></svg>

    <script>
        const width = window.innerWidth - 40;
        const height = window.innerHeight - 140;

        const svg = d3.select("#map")
            .attr("width", width)
            .attr("height", height);

        // Generate random points with clustering
        const points = [];
        const clusters = [
            { cx: width * 0.3, cy: height * 0.3, n: 200 },
            { cx: width * 0.7, cy: height * 0.4, n: 300 },
            { cx: width * 0.5, cy: height * 0.7, n: 250 },
            { cx: width * 0.2, cy: height * 0.6, n: 150 },
            { cx: width * 0.8, cy: height * 0.7, n: 180 }
        ];

        clusters.forEach(cluster => {
            for (let i = 0; i < cluster.n; i++) {
                const angle = Math.random() * 2 * Math.PI;
                const radius = Math.random() * 100;
                points.push([
                    cluster.cx + Math.cos(angle) * radius,
                    cluster.cy + Math.sin(angle) * radius
                ]);
            }
        });

        // Create hexbin
        const hexbin = d3.hexbin()
            .radius(20)
            .extent([[0, 0], [width, height]]);

        const bins = hexbin(points);

        const colorScale = d3.scaleSequential(d3.interpolateYlOrRd)
            .domain([0, d3.max(bins, d => d.length)]);

        svg.append("g")
            .selectAll("path")
            .data(bins)
            .join("path")
            .attr("class", "hexagon")
            .attr("d", hexbin.hexagon())
            .attr("transform", d => `translate(${d.x},${d.y})`)
            .attr("fill", d => colorScale(d.length))
            .append("title")
            .text(d => `Count: ${d.length}`);

        // Add legend
        const legend = svg.append("g")
            .attr("transform", `translate(${width - 120}, 30)`);

        const legendScale = d3.scaleLinear()
            .domain([0, d3.max(bins, d => d.length)])
            .range([0, 150]);

        const legendAxis = d3.axisRight(legendScale)
            .ticks(5);

        const defs = svg.append("defs");
        const gradient = defs.append("linearGradient")
            .attr("id", "legend-gradient")
            .attr("x1", "0%")
            .attr("y1", "100%")
            .attr("x2", "0%")
            .attr("y2", "0%");

        gradient.selectAll("stop")
            .data(d3.range(0, 1.1, 0.1))
            .join("stop")
            .attr("offset", d => `${d * 100}%`)
            .attr("stop-color", d => colorScale(d * d3.max(bins, b => b.length)));

        legend.append("rect")
            .attr("width", 20)
            .attr("height", 150)
            .style("fill", "url(#legend-gradient)");

        legend.append("g")
            .attr("transform", "translate(20, 0)")
            .call(legendAxis)
            .selectAll("text")
            .attr("fill", "#dfe6e9");

        legend.append("text")
            .attr("x", 10)
            .attr("y", -10)
            .attr("text-anchor", "middle")
            .attr("fill", "#dfe6e9")
            .attr("font-size", "12px")
            .text("Density");
    </script>
    <script src="../../assets/js/enhance.js" defer></script>
</body>
</html>
