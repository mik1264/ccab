<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bubble Stream Visualization</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: linear-gradient(to bottom, #0f0c29, #302b63, #24243e);
            overflow: hidden;
        }
        h1 {
            color: #fff;
            text-align: center;
            margin-bottom: 10px;
        }
        .info {
            color: rgba(255,255,255,0.8);
            text-align: center;
            margin-bottom: 20px;
        }
        svg {
            display: block;
            margin: 0 auto;
        }
        .bubble {
            stroke: white;
            stroke-width: 1px;
            opacity: 0.7;
        }
        .bubble:hover {
            opacity: 1;
            stroke-width: 2px;
        }
    </style>
</head>
<body>
    <h1>Live Transaction Stream</h1>
    <p class="info">Real-time transaction monitoring (bubble size = amount)</p>
    <svg id="stream"></svg>

    <script>
        const width = window.innerWidth - 40;
        const height = window.innerHeight - 140;

        const svg = d3.select("#stream")
            .attr("width", width)
            .attr("height", height);

        const bubbles = [];
        let transactionId = 0;

        const categories = [
            { name: "Retail", color: "#e74c3c" },
            { name: "Services", color: "#3498db" },
            { name: "Digital", color: "#2ecc71" },
            { name: "Food", color: "#f39c12" },
            { name: "Entertainment", color: "#9b59b6" }
        ];

        function addBubble() {
            const category = categories[Math.floor(Math.random() * categories.length)];
            const amount = 10 + Math.random() * 290;

            bubbles.push({
                id: transactionId++,
                x: Math.random() * width,
                y: height + 50,
                vx: (Math.random() - 0.5) * 2,
                vy: -2 - Math.random() * 3,
                radius: Math.sqrt(amount) * 2,
                amount: amount,
                category: category,
                opacity: 0.7
            });
        }

        function update() {
            // Update bubble positions
            bubbles.forEach(b => {
                b.x += b.vx;
                b.y += b.vy;

                // Bounce off walls
                if (b.x < b.radius || b.x > width - b.radius) {
                    b.vx *= -0.8;
                    b.x = Math.max(b.radius, Math.min(width - b.radius, b.x));
                }

                // Fade out as they rise
                b.opacity = Math.max(0, 0.7 * (1 - (-b.y / height)));
            });

            // Remove bubbles that are off screen
            const visible = bubbles.filter(b => b.y > -100 && b.opacity > 0.1);
            bubbles.length = 0;
            bubbles.push(...visible);

            // Render bubbles
            const circles = svg.selectAll("circle")
                .data(bubbles, d => d.id);

            circles.exit().remove();

            circles.enter()
                .append("circle")
                .attr("class", "bubble")
                .merge(circles)
                .attr("cx", d => d.x)
                .attr("cy", d => d.y)
                .attr("r", d => d.radius)
                .attr("fill", d => d.category.color)
                .attr("opacity", d => d.opacity)
                .append("title")
                .text(d => `${d.category.name}\n$${d.amount.toFixed(2)}`);
        }

        // Add bubbles periodically
        setInterval(() => {
            const count = Math.floor(Math.random() * 2) + 1;
            for (let i = 0; i < count; i++) {
                addBubble();
            }
        }, 500);

        // Animation loop
        setInterval(update, 30);

        // Legend
        const legend = svg.append("g")
            .attr("transform", "translate(20, 20)");

        categories.forEach((cat, i) => {
            const g = legend.append("g")
                .attr("transform", `translate(0, ${i * 25})`);

            g.append("circle")
                .attr("r", 8)
                .attr("fill", cat.color);

            g.append("text")
                .attr("x", 15)
                .attr("y", 5)
                .attr("fill", "white")
                .attr("font-size", "12px")
                .text(cat.name);
        });
    </script>
</body>
</html>
