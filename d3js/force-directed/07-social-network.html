<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Network Graph</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #1a1a2e;
            overflow: hidden;
        }
        h1 {
            color: #eee;
            text-align: center;
            margin-bottom: 10px;
        }
        .info {
            color: #aaa;
            text-align: center;
            margin-bottom: 20px;
        }
        svg {
            display: block;
            margin: 0 auto;
            background: #16213e;
            border-radius: 10px;
        }
        .links line {
            stroke-opacity: 0.4;
        }
        .weak { stroke: #999; stroke-width: 1px; }
        .medium { stroke: #666; stroke-width: 2px; }
        .strong { stroke: #333; stroke-width: 3px; }

        .nodes circle {
            stroke: #fff;
            stroke-width: 2px;
            cursor: pointer;
        }
        .nodes circle:hover {
            stroke-width: 4px;
        }
        text {
            font-family: Arial;
            font-size: 11px;
            fill: #eee;
            pointer-events: none;
            text-shadow: 1px 1px 2px #000;
        }
        .selected {
            stroke: #ffeb3b !important;
            stroke-width: 4px !important;
        }
    </style>
</head>
<body>
    <h1>Social Network Graph</h1>
    <p class="info">Click on nodes to highlight connections â€¢ Different line widths show connection strength</p>
    <svg id="network"></svg>

    <script>
        const width = window.innerWidth - 40;
        const height = window.innerHeight - 140;

        const svg = d3.select("#network")
            .attr("width", width)
            .attr("height", height);

        // Create social network data
        const people = [
            "Alice", "Bob", "Charlie", "Diana", "Eve", "Frank",
            "Grace", "Henry", "Ivy", "Jack", "Kate", "Liam",
            "Mia", "Noah", "Olivia", "Peter", "Quinn", "Rachel",
            "Sam", "Tara", "Uma", "Victor", "Wendy", "Xander"
        ];

        const nodes = people.map((name, i) => ({
            id: i,
            name: name,
            connections: Math.floor(Math.random() * 8) + 2
        }));

        const links = [];
        const connectionStrength = ["weak", "medium", "strong"];

        // Create realistic social network connections
        nodes.forEach((node, i) => {
            const numConnections = Math.floor(Math.random() * 4) + 2;
            for (let j = 0; j < numConnections; j++) {
                const target = Math.floor(Math.random() * nodes.length);
                if (target !== i && !links.some(l =>
                    (l.source === i && l.target === target) ||
                    (l.source === target && l.target === i)
                )) {
                    links.push({
                        source: i,
                        target: target,
                        strength: connectionStrength[Math.floor(Math.random() * 3)]
                    });
                }
            }
        });

        const color = d3.scaleSequential(d3.interpolateRainbow)
            .domain([0, nodes.length]);

        const simulation = d3.forceSimulation(nodes)
            .force("link", d3.forceLink(links).id(d => d.id).distance(100))
            .force("charge", d3.forceManyBody().strength(-300))
            .force("center", d3.forceCenter(width / 2, height / 2))
            .force("collision", d3.forceCollide().radius(25));

        const link = svg.append("g")
            .attr("class", "links")
            .selectAll("line")
            .data(links)
            .enter().append("line")
            .attr("class", d => d.strength);

        const node = svg.append("g")
            .attr("class", "nodes")
            .selectAll("circle")
            .data(nodes)
            .enter().append("circle")
            .attr("r", d => 8 + d.connections)
            .attr("fill", d => color(d.id))
            .on("click", highlightConnections)
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended));

        const labels = svg.append("g")
            .selectAll("text")
            .data(nodes)
            .enter().append("text")
            .text(d => d.name)
            .attr("text-anchor", "middle")
            .attr("dy", 30);

        node.append("title")
            .text(d => `${d.name}\nConnections: ${links.filter(l => l.source.id === d.id || l.target.id === d.id).length}`);

        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);

            node
                .attr("cx", d => d.x)
                .attr("cy", d => d.y);

            labels
                .attr("x", d => d.x)
                .attr("y", d => d.y);
        });

        let selectedNode = null;

        function highlightConnections(event, d) {
            if (selectedNode === d) {
                // Deselect
                node.classed("selected", false);
                link.style("opacity", 0.4);
                selectedNode = null;
            } else {
                // Select
                selectedNode = d;

                node.classed("selected", n => n === d);

                link.style("opacity", l =>
                    l.source === d || l.target === d ? 1 : 0.1
                );
            }
        }

        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }
    </script>
    <script src="../../assets/js/enhance.js" defer></script>
</body>
</html>
