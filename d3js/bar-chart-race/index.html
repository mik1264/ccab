<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bar Chart Race - D3.js</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #1e3a5f 0%, #0d2137 100%);
            color: #fff;
            font-family: 'Segoe UI', system-ui, sans-serif;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .title-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .back-link {
            color: #64b5f6;
            text-decoration: none;
            font-size: 0.9em;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        h1 {
            font-size: 1.5em;
            font-weight: 500;
            color: #64b5f6;
        }

        .controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        label {
            font-size: 0.85em;
            color: #aaa;
        }

        select, input[type="range"] {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 0.85em;
        }

        input[type="range"] {
            width: 100px;
            accent-color: #64b5f6;
        }

        button {
            background: rgba(100, 181, 246, 0.2);
            color: #64b5f6;
            border: 1px solid rgba(100, 181, 246, 0.4);
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.2s;
        }

        button:hover {
            background: rgba(100, 181, 246, 0.3);
        }

        .chart-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .year-display {
            font-size: 4em;
            font-weight: 700;
            text-align: right;
            color: rgba(255, 255, 255, 0.15);
            margin-bottom: -50px;
            position: relative;
            z-index: 0;
        }

        svg {
            display: block;
            overflow: visible;
        }

        .bar-label {
            font-size: 12px;
            fill: #fff;
            font-weight: 500;
        }

        .bar-value {
            font-size: 11px;
            fill: rgba(255, 255, 255, 0.8);
        }

        .axis text {
            fill: #888;
            font-size: 11px;
        }

        .axis path,
        .axis line {
            stroke: #444;
        }

        .info {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            font-size: 0.85em;
            color: #aaa;
        }

        .info strong {
            color: #64b5f6;
        }

        .value-display {
            font-size: 0.75em;
            color: #64b5f6;
            min-width: 40px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title-section">
                <a href="../index.html" class="back-link">← D3.js Gallery</a>
                <h1>Bar Chart Race</h1>
            </div>
            <div class="controls">
                <div class="control-group">
                    <label>Dataset:</label>
                    <select id="dataset">
                        <option value="tech">Tech Companies</option>
                        <option value="countries">Country GDP</option>
                        <option value="brands">Global Brands</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Speed:</label>
                    <input type="range" id="speed" min="100" max="2000" value="500">
                    <span class="value-display" id="speedVal">500ms</span>
                </div>
                <button id="playBtn">▶ Play</button>
                <button id="resetBtn">↺ Reset</button>
            </div>
        </div>

        <div class="chart-container">
            <div class="year-display" id="yearDisplay">2000</div>
            <svg id="chart"></svg>
        </div>

        <div class="info">
            <strong>Bar Chart Race</strong> - A viral visualization format popularized on r/dataisbeautiful.
            Watch how rankings change over time as bars smoothly animate to their new positions.
            Data is simulated for demonstration purposes.
        </div>
    </div>

    <script>
        // Configuration
        const config = {
            width: 900,
            height: 500,
            margin: { top: 20, right: 120, bottom: 30, left: 150 },
            barPadding: 0.2,
            barsToShow: 10,
            transitionDuration: 500
        };

        // Generate sample datasets
        const datasets = {
            tech: generateTechData(),
            countries: generateCountryData(),
            brands: generateBrandData()
        };

        function generateTechData() {
            const companies = [
                { name: 'Apple', color: '#A2AAAD' },
                { name: 'Microsoft', color: '#00A4EF' },
                { name: 'Google', color: '#4285F4' },
                { name: 'Amazon', color: '#FF9900' },
                { name: 'Facebook', color: '#1877F2' },
                { name: 'Tesla', color: '#CC0000' },
                { name: 'Nvidia', color: '#76B900' },
                { name: 'Samsung', color: '#1428A0' },
                { name: 'Intel', color: '#0071C5' },
                { name: 'IBM', color: '#054ADA' },
                { name: 'Oracle', color: '#F80000' },
                { name: 'Cisco', color: '#049FD9' },
                { name: 'Adobe', color: '#FF0000' },
                { name: 'Netflix', color: '#E50914' },
                { name: 'Salesforce', color: '#00A1E0' }
            ];

            const data = {};
            for (let year = 2000; year <= 2024; year++) {
                data[year] = companies.map(c => ({
                    name: c.name,
                    value: Math.floor(50 + Math.random() * 500 + (year - 2000) * (Math.random() * 50)),
                    color: c.color
                }));
            }
            return data;
        }

        function generateCountryData() {
            const countries = [
                { name: 'USA', color: '#3C3B6E' },
                { name: 'China', color: '#DE2910' },
                { name: 'Japan', color: '#BC002D' },
                { name: 'Germany', color: '#FFCC00' },
                { name: 'UK', color: '#012169' },
                { name: 'India', color: '#FF9933' },
                { name: 'France', color: '#0055A4' },
                { name: 'Brazil', color: '#009B3A' },
                { name: 'Italy', color: '#009246' },
                { name: 'Canada', color: '#FF0000' },
                { name: 'Russia', color: '#0039A6' },
                { name: 'South Korea', color: '#003478' },
                { name: 'Australia', color: '#00008B' },
                { name: 'Spain', color: '#AA151B' },
                { name: 'Mexico', color: '#006341' }
            ];

            const data = {};
            for (let year = 2000; year <= 2024; year++) {
                data[year] = countries.map(c => ({
                    name: c.name,
                    value: Math.floor(500 + Math.random() * 2000 + (year - 2000) * (Math.random() * 100)),
                    color: c.color
                }));
            }
            return data;
        }

        function generateBrandData() {
            const brands = [
                { name: 'Coca-Cola', color: '#F40009' },
                { name: 'McDonald\'s', color: '#FFC72C' },
                { name: 'Nike', color: '#111111' },
                { name: 'Disney', color: '#113CCF' },
                { name: 'Toyota', color: '#EB0A1E' },
                { name: 'Mercedes', color: '#333333' },
                { name: 'BMW', color: '#1C69D4' },
                { name: 'Louis Vuitton', color: '#4A3728' },
                { name: 'Chanel', color: '#000000' },
                { name: 'Hermès', color: '#F37021' },
                { name: 'Gucci', color: '#006633' },
                { name: 'Starbucks', color: '#00704A' },
                { name: 'IKEA', color: '#0051BA' },
                { name: 'Zara', color: '#000000' },
                { name: 'H&M', color: '#E50010' }
            ];

            const data = {};
            for (let year = 2000; year <= 2024; year++) {
                data[year] = brands.map(c => ({
                    name: c.name,
                    value: Math.floor(20 + Math.random() * 100 + (year - 2000) * (Math.random() * 5)),
                    color: c.color
                }));
            }
            return data;
        }

        // State
        let currentDataset = 'tech';
        let currentYear = 2000;
        let isPlaying = false;
        let animationTimer = null;

        // D3 setup
        const svg = d3.select('#chart')
            .attr('width', config.width)
            .attr('height', config.height);

        const chartWidth = config.width - config.margin.left - config.margin.right;
        const chartHeight = config.height - config.margin.top - config.margin.bottom;

        const g = svg.append('g')
            .attr('transform', `translate(${config.margin.left}, ${config.margin.top})`);

        // Scales
        const x = d3.scaleLinear().range([0, chartWidth]);
        const y = d3.scaleBand().range([0, chartHeight]).padding(config.barPadding);

        // Axes
        const xAxis = g.append('g')
            .attr('class', 'axis x-axis')
            .attr('transform', `translate(0, ${chartHeight})`);

        // Update chart
        function updateChart(duration = config.transitionDuration) {
            const data = datasets[currentDataset][currentYear];

            // Sort and get top N
            const sortedData = data
                .sort((a, b) => b.value - a.value)
                .slice(0, config.barsToShow);

            // Update scales
            x.domain([0, d3.max(sortedData, d => d.value) * 1.1]);
            y.domain(sortedData.map(d => d.name));

            // Update axis
            xAxis.transition()
                .duration(duration)
                .call(d3.axisBottom(x).ticks(5).tickFormat(d => d3.format(',.0f')(d)));

            // Bars
            const bars = g.selectAll('.bar')
                .data(sortedData, d => d.name);

            // Enter
            const barsEnter = bars.enter()
                .append('g')
                .attr('class', 'bar');

            barsEnter.append('rect')
                .attr('x', 0)
                .attr('y', d => y(d.name))
                .attr('height', y.bandwidth())
                .attr('width', 0)
                .attr('fill', d => d.color)
                .attr('rx', 4);

            barsEnter.append('text')
                .attr('class', 'bar-label')
                .attr('x', -10)
                .attr('y', d => y(d.name) + y.bandwidth() / 2)
                .attr('dy', '0.35em')
                .attr('text-anchor', 'end')
                .text(d => d.name);

            barsEnter.append('text')
                .attr('class', 'bar-value')
                .attr('x', 5)
                .attr('y', d => y(d.name) + y.bandwidth() / 2)
                .attr('dy', '0.35em')
                .text(d => d3.format(',.0f')(d.value));

            // Update
            const barsUpdate = bars.merge(barsEnter);

            barsUpdate.select('rect')
                .transition()
                .duration(duration)
                .attr('y', d => y(d.name))
                .attr('width', d => x(d.value))
                .attr('fill', d => d.color);

            barsUpdate.select('.bar-label')
                .transition()
                .duration(duration)
                .attr('y', d => y(d.name) + y.bandwidth() / 2)
                .text(d => d.name);

            barsUpdate.select('.bar-value')
                .transition()
                .duration(duration)
                .attr('x', d => x(d.value) + 5)
                .attr('y', d => y(d.name) + y.bandwidth() / 2)
                .tween('text', function(d) {
                    const node = this;
                    const i = d3.interpolateNumber(parseFloat(node.textContent.replace(/,/g, '')) || 0, d.value);
                    return t => node.textContent = d3.format(',.0f')(i(t));
                });

            // Exit
            bars.exit()
                .transition()
                .duration(duration)
                .attr('opacity', 0)
                .remove();

            // Update year display
            document.getElementById('yearDisplay').textContent = currentYear;
        }

        // Play/pause animation
        function togglePlay() {
            isPlaying = !isPlaying;
            document.getElementById('playBtn').textContent = isPlaying ? '⏸ Pause' : '▶ Play';

            if (isPlaying) {
                animate();
            } else {
                clearTimeout(animationTimer);
            }
        }

        function animate() {
            if (!isPlaying) return;

            if (currentYear < 2024) {
                currentYear++;
                updateChart();
                animationTimer = setTimeout(animate, config.transitionDuration + 50);
            } else {
                isPlaying = false;
                document.getElementById('playBtn').textContent = '▶ Play';
            }
        }

        // Reset
        function reset() {
            isPlaying = false;
            document.getElementById('playBtn').textContent = '▶ Play';
            clearTimeout(animationTimer);
            currentYear = 2000;
            updateChart(0);
        }

        // Event listeners
        document.getElementById('playBtn').addEventListener('click', togglePlay);
        document.getElementById('resetBtn').addEventListener('click', reset);

        document.getElementById('dataset').addEventListener('change', (e) => {
            currentDataset = e.target.value;
            reset();
        });

        document.getElementById('speed').addEventListener('input', (e) => {
            config.transitionDuration = parseInt(e.target.value);
            document.getElementById('speedVal').textContent = e.target.value + 'ms';
        });

        // Initialize
        updateChart(0);
    </script>
</body>
</html>
