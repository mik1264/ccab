<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Octonion Multiplication & Fano Plane - CCAB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #e8e8e8;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            text-align: center;
            padding: 20px;
            margin-bottom: 20px;
        }
        h1 {
            font-size: 2.2rem;
            background: linear-gradient(90deg, #e94560, #f9a826);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        .subtitle { color: #888; font-size: 1rem; }
        .back-link {
            position: absolute;
            top: 20px;
            left: 20px;
            color: #e94560;
            text-decoration: none;
            font-weight: 500;
            transition: transform 0.3s;
        }
        .back-link:hover { transform: translateX(-5px); }
        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
        }
        .fano-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 20px;
            position: relative;
        }
        #fano-canvas {
            display: block;
            margin: 0 auto;
            cursor: pointer;
        }
        .info-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
            backdrop-filter: blur(10px);
        }
        .panel h3 {
            color: #e94560;
            font-size: 1rem;
            margin-bottom: 10px;
            border-bottom: 1px solid rgba(233, 69, 96, 0.3);
            padding-bottom: 5px;
        }
        .multiplication-display {
            font-size: 1.8rem;
            text-align: center;
            padding: 20px;
            font-family: 'Courier New', monospace;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            margin-top: 10px;
        }
        .mult-element {
            display: inline-block;
            padding: 5px 15px;
            margin: 0 5px;
            border-radius: 4px;
            transition: all 0.3s;
        }
        .mult-result { font-weight: bold; }
        .basis-list {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }
        .basis-item {
            text-align: center;
            padding: 8px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .basis-item:hover { background: rgba(233, 69, 96, 0.2); }
        .basis-item.selected { background: rgba(233, 69, 96, 0.4); border: 1px solid #e94560; }
        .basis-symbol { font-size: 1.2rem; font-weight: bold; }
        .basis-name { font-size: 0.7rem; color: #888; }
        .info-text {
            font-size: 0.9rem;
            line-height: 1.6;
            color: #aaa;
        }
        .property-list {
            font-size: 0.85rem;
            color: #ccc;
        }
        .property-list li {
            margin-bottom: 8px;
            padding-left: 15px;
            position: relative;
        }
        .property-list li::before {
            content: '•';
            position: absolute;
            left: 0;
            color: #e94560;
        }
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.75rem;
        }
        th, td {
            padding: 6px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        th {
            background: rgba(233, 69, 96, 0.2);
            color: #e94560;
        }
        td { background: rgba(0, 0, 0, 0.2); }
        .highlight-row td { background: rgba(233, 69, 96, 0.15); }
        .highlight-col { background: rgba(249, 168, 38, 0.15) !important; }
        .highlight-result { background: rgba(233, 69, 96, 0.4) !important; font-weight: bold; }
        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        button {
            padding: 8px 16px;
            background: linear-gradient(135deg, #e94560, #c62a4d);
            border: none;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
        }
        button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(233, 69, 96, 0.3); }
        @media (max-width: 900px) {
            .main-content { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Gallery</a>

    <div class="container">
        <header>
            <h1>Octonion Multiplication & Fano Plane</h1>
            <p class="subtitle">Visualizing the non-associative algebra through the Fano plane</p>
        </header>

        <div class="main-content">
            <div class="fano-container">
                <canvas id="fano-canvas" width="600" height="600"></canvas>
                <div class="controls">
                    <button onclick="resetSelection()">Reset Selection</button>
                    <button onclick="animateAllProducts()">Animate All Products</button>
                    <button onclick="showNonAssociativity()">Show Non-Associativity</button>
                </div>
            </div>

            <div class="info-panel">
                <div class="panel">
                    <h3>Multiplication Result</h3>
                    <div class="multiplication-display" id="mult-display">
                        <span class="mult-element" style="background: #444;">?</span>
                        <span>×</span>
                        <span class="mult-element" style="background: #444;">?</span>
                        <span>=</span>
                        <span class="mult-element mult-result" style="background: #444;">?</span>
                    </div>
                </div>

                <div class="panel">
                    <h3>Select Basis Elements</h3>
                    <div class="basis-list" id="basis-list"></div>
                </div>

                <div class="panel">
                    <h3>About Octonions</h3>
                    <ul class="property-list">
                        <li><strong>8-dimensional</strong> algebra over reals (1 + e₁...e₇)</li>
                        <li><strong>Non-associative:</strong> (ab)c ≠ a(bc) in general</li>
                        <li><strong>Alternative:</strong> (aa)b = a(ab) and (ab)b = a(bb)</li>
                        <li><strong>Division algebra:</strong> Every non-zero element has inverse</li>
                        <li>The <strong>Fano plane</strong> encodes all multiplication rules</li>
                    </ul>
                </div>

                <div class="panel">
                    <h3>How to Read the Fano Plane</h3>
                    <p class="info-text">
                        Each line (including the circle) contains 3 elements. Following the arrows:
                        multiplying two adjacent elements gives the third with sign determined by direction.
                        <br><br>
                        <strong>Example:</strong> e₁ × e₂ = e₃ (following arrow), but e₂ × e₁ = -e₃ (against arrow)
                    </p>
                </div>
            </div>
        </div>

        <div class="panel table-container" style="margin-top: 20px;">
            <h3>Full Multiplication Table</h3>
            <table id="mult-table"></table>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('fano-canvas');
        const ctx = canvas.getContext('2d');

        // Octonion basis elements
        const basis = ['1', 'e₁', 'e₂', 'e₃', 'e₄', 'e₅', 'e₆', 'e₇'];

        // Multiplication table (indices 0-7 for 1, e1-e7)
        // Result is [sign, index] where sign is 1 or -1
        const multTable = [
            // 1    e1      e2      e3      e4      e5      e6      e7
            [[1,0], [1,1],  [1,2],  [1,3],  [1,4],  [1,5],  [1,6],  [1,7]],  // 1
            [[1,1], [-1,0], [1,3],  [-1,2], [1,5],  [-1,4], [-1,7], [1,6]],  // e1
            [[1,2], [-1,3], [-1,0], [1,1],  [1,6],  [1,7],  [-1,4], [-1,5]], // e2
            [[1,3], [1,2],  [-1,1], [-1,0], [1,7],  [-1,6], [1,5],  [-1,4]], // e3
            [[1,4], [-1,5], [-1,6], [-1,7], [-1,0], [1,1],  [1,2],  [1,3]],  // e4
            [[1,5], [1,4],  [-1,7], [1,6],  [-1,1], [-1,0], [-1,3], [1,2]],  // e5
            [[1,6], [1,7],  [1,4],  [-1,5], [-1,2], [1,3],  [-1,0], [-1,1]], // e6
            [[1,7], [-1,6], [1,5],  [1,4],  [-1,3], [-1,2], [1,1],  [-1,0]]  // e7
        ];

        // Fano plane structure - 7 lines (including inscribed circle)
        // Each line contains indices of e1-e7 (so 0-6 mapping to e1-e7)
        const fanoLines = [
            [0, 1, 2],  // e1, e2, e3 (top line with arrow direction)
            [0, 3, 4],  // e1, e4, e5
            [1, 3, 6],  // e2, e4, e7
            [2, 4, 5],  // e3, e5, e6
            [0, 5, 6],  // e1, e6, e7
            [1, 4, 5],  // e2, e5, e6 - this seems wrong, let me recalculate
            [2, 3, 6]   // e3, e4, e7
        ];

        // Correct Fano plane lines for standard octonion multiplication
        const correctFanoLines = [
            [0, 1, 2],  // e1 → e2 → e3 → e1
            [1, 3, 5],  // e2 → e4 → e6 → e2
            [0, 3, 4],  // e1 → e4 → e5 → e1
            [2, 4, 6],  // e3 → e5 → e7 → e3
            [0, 5, 6],  // e1 → e6 → e7 → e1
            [1, 4, 6],  // e2 → e5 → e7 → e2 - inscribed circle portion
            [2, 3, 6]   // e3 → e4 → e7 → e3
        ];

        // Colors for each basis element
        const colors = [
            '#888888', // 1 (gray)
            '#e94560', // e1 (red)
            '#f9a826', // e2 (orange)
            '#4CAF50', // e3 (green)
            '#2196F3', // e4 (blue)
            '#9C27B0', // e5 (purple)
            '#00BCD4', // e6 (cyan)
            '#FF5722'  // e7 (deep orange)
        ];

        // Positions for Fano plane vertices (e1-e7)
        const centerX = 300, centerY = 300;
        const outerR = 200, innerR = 100;
        let positions = [];

        // Calculate positions
        function initPositions() {
            positions = [];
            // Outer triangle vertices (e1, e2, e3) - rotated to put e1 at top
            for (let i = 0; i < 3; i++) {
                const angle = -Math.PI/2 + (i * 2 * Math.PI / 3);
                positions.push({
                    x: centerX + outerR * Math.cos(angle),
                    y: centerY + outerR * Math.sin(angle)
                });
            }
            // Inner triangle vertices (e4, e5, e6) - opposite orientation
            for (let i = 0; i < 3; i++) {
                const angle = Math.PI/2 + (i * 2 * Math.PI / 3);
                positions.push({
                    x: centerX + innerR * Math.cos(angle),
                    y: centerY + innerR * Math.sin(angle)
                });
            }
            // Center (e7)
            positions.push({ x: centerX, y: centerY });
        }

        let selectedA = null, selectedB = null;
        let highlightedLine = null;
        let animating = false;

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw background glow
            const gradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, 300);
            gradient.addColorStop(0, 'rgba(233, 69, 96, 0.1)');
            gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw Fano plane lines
            drawFanoLines();

            // Draw inscribed circle
            drawInscribedCircle();

            // Draw vertices
            drawVertices();

            // Draw arrows on highlighted line
            if (highlightedLine !== null) {
                drawArrowsOnLine(highlightedLine);
            }
        }

        function drawFanoLines() {
            // Lines of the Fano plane (not including inscribed circle)
            const straightLines = [
                [0, 1, 2],  // outer triangle edge
                [0, 3, 6],  // from e1 through e4 to e7
                [1, 4, 6],  // from e2 through e5 to e7
                [2, 5, 6],  // from e3 through e6 to e7
            ];

            ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.lineWidth = 2;

            // Draw outer triangle
            ctx.beginPath();
            ctx.moveTo(positions[0].x, positions[0].y);
            ctx.lineTo(positions[1].x, positions[1].y);
            ctx.lineTo(positions[2].x, positions[2].y);
            ctx.closePath();
            ctx.stroke();

            // Draw lines through center
            for (let i = 0; i < 3; i++) {
                ctx.beginPath();
                ctx.moveTo(positions[i].x, positions[i].y);
                ctx.lineTo(positions[6].x, positions[6].y); // center
                ctx.stroke();
            }

            // Draw inner edges to outer vertices
            for (let i = 0; i < 3; i++) {
                const innerIdx = 3 + i;
                const outerIdx1 = (i + 1) % 3;
                const outerIdx2 = (i + 2) % 3;
                ctx.beginPath();
                ctx.moveTo(positions[innerIdx].x, positions[innerIdx].y);
                ctx.lineTo(positions[outerIdx1].x, positions[outerIdx1].y);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(positions[innerIdx].x, positions[innerIdx].y);
                ctx.lineTo(positions[outerIdx2].x, positions[outerIdx2].y);
                ctx.stroke();
            }
        }

        function drawInscribedCircle() {
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(centerX, centerY, innerR, 0, Math.PI * 2);
            ctx.stroke();
        }

        function drawVertices() {
            for (let i = 0; i < 7; i++) {
                const pos = positions[i];
                const isSelected = (selectedA === i + 1) || (selectedB === i + 1);

                // Glow effect for selected
                if (isSelected) {
                    const glow = ctx.createRadialGradient(pos.x, pos.y, 0, pos.x, pos.y, 40);
                    glow.addColorStop(0, colors[i + 1] + '80');
                    glow.addColorStop(1, 'transparent');
                    ctx.fillStyle = glow;
                    ctx.beginPath();
                    ctx.arc(pos.x, pos.y, 40, 0, Math.PI * 2);
                    ctx.fill();
                }

                // Draw circle
                ctx.beginPath();
                ctx.arc(pos.x, pos.y, isSelected ? 28 : 22, 0, Math.PI * 2);
                ctx.fillStyle = colors[i + 1];
                ctx.fill();
                ctx.strokeStyle = isSelected ? '#fff' : 'rgba(255,255,255,0.5)';
                ctx.lineWidth = isSelected ? 3 : 2;
                ctx.stroke();

                // Draw label
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(`e${i + 1}`, pos.x, pos.y);
            }
        }

        function drawArrowsOnLine(lineIdx) {
            // This would draw directional arrows on a specific line
            // to show multiplication direction
        }

        function multiply(a, b) {
            // a and b are indices 0-7 (0 = 1, 1-7 = e1-e7)
            const result = multTable[a][b];
            return { sign: result[0], index: result[1] };
        }

        function updateDisplay() {
            const display = document.getElementById('mult-display');

            if (selectedA === null && selectedB === null) {
                display.innerHTML = `
                    <span class="mult-element" style="background: #444;">?</span>
                    <span>×</span>
                    <span class="mult-element" style="background: #444;">?</span>
                    <span>=</span>
                    <span class="mult-element mult-result" style="background: #444;">?</span>
                `;
            } else if (selectedA !== null && selectedB === null) {
                display.innerHTML = `
                    <span class="mult-element" style="background: ${colors[selectedA]};">${basis[selectedA]}</span>
                    <span>×</span>
                    <span class="mult-element" style="background: #444;">?</span>
                    <span>=</span>
                    <span class="mult-element mult-result" style="background: #444;">?</span>
                `;
            } else if (selectedA !== null && selectedB !== null) {
                const result = multiply(selectedA, selectedB);
                const signStr = result.sign === 1 ? '' : '-';
                display.innerHTML = `
                    <span class="mult-element" style="background: ${colors[selectedA]};">${basis[selectedA]}</span>
                    <span>×</span>
                    <span class="mult-element" style="background: ${colors[selectedB]};">${basis[selectedB]}</span>
                    <span>=</span>
                    <span class="mult-element mult-result" style="background: ${colors[result.index]};">${signStr}${basis[result.index]}</span>
                `;
                updateTableHighlight(selectedA, selectedB);
            }
        }

        function initBasisList() {
            const list = document.getElementById('basis-list');
            list.innerHTML = '';

            for (let i = 0; i < 8; i++) {
                const item = document.createElement('div');
                item.className = 'basis-item';
                item.innerHTML = `
                    <div class="basis-symbol" style="color: ${colors[i]}">${basis[i]}</div>
                    <div class="basis-name">${i === 0 ? 'identity' : 'imaginary'}</div>
                `;
                item.onclick = () => selectBasis(i);
                list.appendChild(item);
            }
        }

        function selectBasis(idx) {
            if (selectedA === null) {
                selectedA = idx;
            } else if (selectedB === null) {
                selectedB = idx;
            } else {
                selectedA = idx;
                selectedB = null;
            }

            updateBasisSelection();
            updateDisplay();
            draw();
        }

        function updateBasisSelection() {
            const items = document.querySelectorAll('.basis-item');
            items.forEach((item, i) => {
                item.classList.toggle('selected', i === selectedA || i === selectedB);
            });
        }

        function resetSelection() {
            selectedA = null;
            selectedB = null;
            updateBasisSelection();
            updateDisplay();
            clearTableHighlight();
            draw();
        }

        function initMultTable() {
            const table = document.getElementById('mult-table');
            let html = '<tr><th>×</th>';

            // Header row
            for (let i = 0; i < 8; i++) {
                html += `<th style="color: ${colors[i]}">${basis[i]}</th>`;
            }
            html += '</tr>';

            // Data rows
            for (let i = 0; i < 8; i++) {
                html += `<tr id="row-${i}"><th style="color: ${colors[i]}">${basis[i]}</th>`;
                for (let j = 0; j < 8; j++) {
                    const result = multiply(i, j);
                    const signStr = result.sign === 1 ? '' : '-';
                    html += `<td id="cell-${i}-${j}" style="color: ${colors[result.index]}">${signStr}${basis[result.index]}</td>`;
                }
                html += '</tr>';
            }

            table.innerHTML = html;
        }

        function updateTableHighlight(row, col) {
            clearTableHighlight();

            // Highlight row
            document.getElementById(`row-${row}`)?.classList.add('highlight-row');

            // Highlight column
            for (let i = 0; i < 8; i++) {
                document.getElementById(`cell-${i}-${col}`)?.classList.add('highlight-col');
            }

            // Highlight result cell
            document.getElementById(`cell-${row}-${col}`)?.classList.add('highlight-result');
        }

        function clearTableHighlight() {
            document.querySelectorAll('.highlight-row').forEach(el => el.classList.remove('highlight-row'));
            document.querySelectorAll('.highlight-col').forEach(el => el.classList.remove('highlight-col'));
            document.querySelectorAll('.highlight-result').forEach(el => el.classList.remove('highlight-result'));
        }

        function animateAllProducts() {
            if (animating) return;
            animating = true;

            let i = 1, j = 1;
            const interval = setInterval(() => {
                selectedA = i;
                selectedB = j;
                updateBasisSelection();
                updateDisplay();
                draw();

                j++;
                if (j > 7) {
                    j = 1;
                    i++;
                }
                if (i > 7) {
                    clearInterval(interval);
                    animating = false;
                }
            }, 200);
        }

        function showNonAssociativity() {
            // Demonstrate (e1 × e2) × e4 ≠ e1 × (e2 × e4)
            const display = document.getElementById('mult-display');

            // (e1 × e2) × e4
            const ab = multiply(1, 2);  // e1 × e2 = e3
            const ab_c = multiply(ab.index, 4);  // e3 × e4
            const leftResult = ab.sign * ab_c.sign;
            const leftSign = leftResult === 1 ? '' : '-';

            // e1 × (e2 × e4)
            const bc = multiply(2, 4);  // e2 × e4
            const a_bc = multiply(1, bc.index);  // e1 × (result)
            const rightResult = bc.sign * a_bc.sign;
            const rightSign = rightResult === 1 ? '' : '-';

            display.innerHTML = `
                <div style="font-size: 1rem; margin-bottom: 10px;">
                    <span style="color: #e94560;">(e₁ × e₂)</span> × e₄ =
                    <span style="color: #4CAF50;">e₃</span> × e₄ =
                    <span style="color: ${colors[ab_c.index]};">${leftSign}${basis[ab_c.index]}</span>
                </div>
                <div style="font-size: 1rem;">
                    e₁ × <span style="color: #f9a826;">(e₂ × e₄)</span> =
                    e₁ × <span style="color: ${colors[bc.index]};">${bc.sign === -1 ? '-' : ''}${basis[bc.index]}</span> =
                    <span style="color: ${colors[a_bc.index]};">${rightSign}${basis[a_bc.index]}</span>
                </div>
                <div style="font-size: 1.2rem; margin-top: 15px; color: #e94560;">
                    ≠ Non-associative!
                </div>
            `;
        }

        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            // Check if click is on any vertex
            for (let i = 0; i < 7; i++) {
                const pos = positions[i];
                const dx = x - pos.x;
                const dy = y - pos.y;
                if (dx * dx + dy * dy < 30 * 30) {
                    selectBasis(i + 1);  // +1 because index 0 is identity '1'
                    return;
                }
            }
        });

        // Expose functions for enhance.js keyboard shortcuts
        window.reset = function() { initPositions(); initBasisList(); initMultTable(); draw(); };

        // Initialize
        initPositions();
        initBasisList();
        initMultTable();
        draw();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
