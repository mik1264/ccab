<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turmites - 2D Turing Machines - CCAB</title>
    <meta name="description" content="Interactive Turmite visualization - 2D Turing machines including Langton's Ant, Fibonacci Turmite, and custom rules. Watch emergent highways, spirals, and chaotic patterns.">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 100%);
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
        }

        canvas {
            display: block;
        }

        .back-link {
            position: fixed;
            top: 15px;
            left: 15px;
            padding: 10px 18px;
            background: rgba(0, 0, 0, 0.6);
            color: #f39c12;
            text-decoration: none;
            border-radius: 8px;
            font-size: 14px;
            z-index: 1000;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(243, 156, 18, 0.3);
            transition: all 0.3s ease;
        }

        .back-link:hover {
            background: rgba(243, 156, 18, 0.2);
            transform: translateX(-4px);
        }

        #info {
            position: fixed;
            top: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.85);
            padding: 15px 20px;
            border-radius: 12px;
            color: #f39c12;
            font-size: 13px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(243, 156, 18, 0.2);
            z-index: 1000;
            max-width: 280px;
        }

        #info h3 {
            margin-bottom: 10px;
            color: #ffeaa7;
        }

        #info .stat {
            margin: 5px 0;
        }

        #info .stat-label {
            color: #888;
            font-size: 11px;
        }

        #info .stat-value {
            color: #f39c12;
            font-weight: bold;
        }

        #info p {
            font-size: 11px;
            opacity: 0.8;
            line-height: 1.5;
            margin-top: 10px;
            color: #aaa;
        }

        #presets {
            position: fixed;
            top: 220px;
            right: 15px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            z-index: 1000;
            max-height: 55vh;
            overflow-y: auto;
        }

        button {
            background: rgba(243, 156, 18, 0.15);
            border: 1px solid rgba(243, 156, 18, 0.4);
            color: #f39c12;
            padding: 8px 14px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.3s;
            text-align: left;
        }

        button:hover {
            background: rgba(243, 156, 18, 0.3);
        }

        button.active {
            background: rgba(243, 156, 18, 0.4);
            border-color: #f39c12;
        }

        #controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 12px;
            z-index: 1000;
            flex-wrap: wrap;
            justify-content: center;
        }

        .control-group {
            background: rgba(0, 0, 0, 0.7);
            padding: 12px 16px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(243, 156, 18, 0.2);
        }

        .control-group label {
            color: #f39c12;
            font-size: 11px;
            display: block;
            margin-bottom: 5px;
        }

        .control-group input[type="range"] {
            width: 100px;
            accent-color: #f39c12;
        }

        .control-group span {
            color: #fff;
            font-size: 10px;
            margin-left: 6px;
        }

        .control-btn {
            padding: 10px 16px;
            min-width: 60px;
        }

        #fps-display {
            position: fixed;
            bottom: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.6);
            padding: 8px 12px;
            border-radius: 6px;
            color: #f39c12;
            font-size: 12px;
            z-index: 1000;
        }

        .behavior-tag {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            margin-left: 5px;
        }

        .behavior-highway { background: rgba(46, 204, 113, 0.3); color: #2ecc71; }
        .behavior-spiral { background: rgba(155, 89, 182, 0.3); color: #9b59b6; }
        .behavior-chaotic { background: rgba(231, 76, 60, 0.3); color: #e74c3c; }
        .behavior-symmetric { background: rgba(52, 152, 219, 0.3); color: #3498db; }
    </style>
</head>
<body>
    <a href="../index.html" class="back-link">← Back to Gallery</a>

    <canvas id="canvas"></canvas>

    <div id="info">
        <h3>Turmites</h3>
        <div class="stat">
            <span class="stat-label">Steps</span>
            <span class="stat-value" id="steps">0</span>
        </div>
        <div class="stat">
            <span class="stat-label">Position</span>
            <span class="stat-value" id="position">(0, 0)</span>
        </div>
        <div class="stat">
            <span class="stat-label">Direction</span>
            <span class="stat-value" id="direction">→</span>
        </div>
        <div class="stat">
            <span class="stat-label">State</span>
            <span class="stat-value" id="state">0</span>
        </div>
        <div class="stat">
            <span class="stat-label">Rule</span>
            <span class="stat-value" id="rule-name">Langton's Ant</span>
        </div>
        <p>Turmites are 2D Turing machines that move on a grid, changing cell colors and directions based on state transition rules. Named by Rudy Rucker.</p>
    </div>

    <div id="presets">
        <button class="active" data-preset="langton">
            Langton's Ant (LR)
            <span class="behavior-tag behavior-highway">highway</span>
        </button>
        <button data-preset="lrrl">
            LRRL
            <span class="behavior-tag behavior-symmetric">symmetric</span>
        </button>
        <button data-preset="llrr">
            LLRR
            <span class="behavior-tag behavior-chaotic">chaotic</span>
        </button>
        <button data-preset="rlr">
            RLR
            <span class="behavior-tag behavior-chaotic">chaotic</span>
        </button>
        <button data-preset="rllr">
            RLLR
            <span class="behavior-tag behavior-highway">highway</span>
        </button>
        <button data-preset="llrrrl">
            LLRRRL
            <span class="behavior-tag behavior-spiral">spiral</span>
        </button>
        <button data-preset="fibonacci">
            Fibonacci
            <span class="behavior-tag behavior-spiral">spiral</span>
        </button>
        <button data-preset="worm">
            Worm
            <span class="behavior-tag behavior-chaotic">chaotic</span>
        </button>
        <button data-preset="snowflake">
            Snowflake
            <span class="behavior-tag behavior-symmetric">symmetric</span>
        </button>
        <button data-preset="fractal">
            Fractal
            <span class="behavior-tag behavior-chaotic">fractal</span>
        </button>
    </div>

    <div id="controls">
        <div class="control-group">
            <label>Speed: <span id="speed-val">100</span> steps/frame</label>
            <input type="range" id="speed" min="1" max="500" value="100">
        </div>
        <div class="control-group">
            <label>Cell Size: <span id="size-val">2</span>px</label>
            <input type="range" id="size" min="1" max="6" value="2">
        </div>
        <button class="control-btn" id="pause-btn">Pause</button>
        <button class="control-btn" id="reset-btn">Reset</button>
        <button class="control-btn" id="step-btn">Step</button>
    </div>

    <div id="fps-display">FPS: <span id="fps">0</span></div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let cellSize = 2;
        let gridWidth, gridHeight;
        let grid = [];
        let turmite = { x: 0, y: 0, dir: 0, state: 0 };
        let steps = 0;
        let running = true;
        let stepsPerFrame = 100;

        // Direction vectors: right, down, left, up
        const dx = [1, 0, -1, 0];
        const dy = [0, 1, 0, -1];
        const dirSymbols = ['→', '↓', '←', '↑'];

        // Colors for different cell states
        const colors = [
            '#0f0f1a',  // 0: background
            '#f39c12',  // 1: gold
            '#e74c3c',  // 2: red
            '#3498db',  // 3: blue
            '#2ecc71',  // 4: green
            '#9b59b6',  // 5: purple
            '#1abc9c',  // 6: teal
            '#e67e22',  // 7: orange
        ];

        // Turmite presets
        // For simple ants: array of turns [L, R, etc.] where each index is a color
        // For multi-state turmites: 3D array [state][color] = {newColor, turn, newState}
        // turn: 0=N (forward), 1=R (right), 2=U (u-turn), 3=L (left)

        const presets = {
            langton: {
                name: "Langton's Ant (LR)",
                numColors: 2,
                numStates: 1,
                // Simple ant format: turn for each color (3=L, 1=R)
                simple: true,
                turns: [3, 1]  // white->L, black->R
            },
            lrrl: {
                name: "LRRL",
                numColors: 4,
                numStates: 1,
                simple: true,
                turns: [3, 1, 1, 3]  // LRRL
            },
            llrr: {
                name: "LLRR",
                numColors: 4,
                numStates: 1,
                simple: true,
                turns: [3, 3, 1, 1]
            },
            rlr: {
                name: "RLR",
                numColors: 3,
                numStates: 1,
                simple: true,
                turns: [1, 3, 1]
            },
            rllr: {
                name: "RLLR",
                numColors: 4,
                numStates: 1,
                simple: true,
                turns: [1, 3, 3, 1]
            },
            llrrrl: {
                name: "LLRRRL",
                numColors: 6,
                numStates: 1,
                simple: true,
                turns: [3, 3, 1, 1, 1, 3]
            },
            fibonacci: {
                name: "Fibonacci Turmite",
                numColors: 2,
                numStates: 2,
                simple: false,
                // rules[state][color] = {newColor, turn, newState}
                rules: [
                    [{newColor: 1, turn: 3, newState: 1}, {newColor: 1, turn: 3, newState: 1}],
                    [{newColor: 1, turn: 1, newState: 1}, {newColor: 0, turn: 0, newState: 0}]
                ]
            },
            worm: {
                name: "Worm",
                numColors: 2,
                numStates: 2,
                simple: false,
                rules: [
                    [{newColor: 1, turn: 1, newState: 0}, {newColor: 1, turn: 1, newState: 1}],
                    [{newColor: 0, turn: 0, newState: 0}, {newColor: 0, turn: 0, newState: 1}]
                ]
            },
            snowflake: {
                name: "Snowflake",
                numColors: 2,
                numStates: 3,
                simple: false,
                rules: [
                    [{newColor: 1, turn: 1, newState: 1}, {newColor: 0, turn: 2, newState: 0}],
                    [{newColor: 1, turn: 3, newState: 2}, {newColor: 1, turn: 3, newState: 0}],
                    [{newColor: 1, turn: 0, newState: 0}, {newColor: 0, turn: 0, newState: 2}]
                ]
            },
            fractal: {
                name: "Fractal",
                numColors: 2,
                numStates: 2,
                simple: false,
                rules: [
                    [{newColor: 1, turn: 1, newState: 1}, {newColor: 1, turn: 3, newState: 0}],
                    [{newColor: 1, turn: 1, newState: 0}, {newColor: 0, turn: 1, newState: 0}]
                ]
            }
        };

        let currentPreset = presets.langton;

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            initGrid();
        }

        function initGrid() {
            gridWidth = Math.floor(canvas.width / cellSize);
            gridHeight = Math.floor(canvas.height / cellSize);
            grid = new Uint8Array(gridWidth * gridHeight);
            turmite = {
                x: Math.floor(gridWidth / 2),
                y: Math.floor(gridHeight / 2),
                dir: 0,
                state: 0
            };
            steps = 0;
            ctx.fillStyle = colors[0];
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        function getCell(x, y) {
            if (x < 0 || x >= gridWidth || y < 0 || y >= gridHeight) return 0;
            return grid[y * gridWidth + x];
        }

        function setCell(x, y, value) {
            if (x < 0 || x >= gridWidth || y < 0 || y >= gridHeight) return;
            grid[y * gridWidth + x] = value;
            ctx.fillStyle = colors[value % colors.length];
            ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
        }

        function step() {
            const { x, y, dir, state } = turmite;
            const color = getCell(x, y);

            let newColor, turn, newState;

            if (currentPreset.simple) {
                // Simple ant: just turn based on color, increment color
                turn = currentPreset.turns[color];
                newColor = (color + 1) % currentPreset.numColors;
                newState = 0;
            } else {
                // Multi-state turmite
                const rule = currentPreset.rules[state][color];
                newColor = rule.newColor;
                turn = rule.turn;
                newState = rule.newState;
            }

            // Set new color
            setCell(x, y, newColor);

            // Turn: 0=forward, 1=right, 2=u-turn, 3=left
            let newDir = (dir + turn) % 4;

            // Move forward
            let newX = x + dx[newDir];
            let newY = y + dy[newDir];

            // Wrap around
            if (newX < 0) newX = gridWidth - 1;
            if (newX >= gridWidth) newX = 0;
            if (newY < 0) newY = gridHeight - 1;
            if (newY >= gridHeight) newY = 0;

            turmite.x = newX;
            turmite.y = newY;
            turmite.dir = newDir;
            turmite.state = newState;
            steps++;
        }

        function updateStats() {
            document.getElementById('steps').textContent = steps.toLocaleString();
            document.getElementById('position').textContent = `(${turmite.x}, ${turmite.y})`;
            document.getElementById('direction').textContent = dirSymbols[turmite.dir];
            document.getElementById('state').textContent = turmite.state;
            document.getElementById('rule-name').textContent = currentPreset.name;
        }

        // FPS tracking
        let lastTime = 0;
        let frameCount = 0;
        let fps = 0;

        function animate(currentTime) {
            requestAnimationFrame(animate);

            // FPS calculation
            frameCount++;
            if (currentTime - lastTime >= 1000) {
                fps = frameCount;
                frameCount = 0;
                lastTime = currentTime;
                document.getElementById('fps').textContent = fps;
            }

            if (running) {
                for (let i = 0; i < stepsPerFrame; i++) {
                    step();
                }
            }

            // Draw turmite head
            ctx.fillStyle = '#fff';
            ctx.fillRect(
                turmite.x * cellSize - 1,
                turmite.y * cellSize - 1,
                cellSize + 2,
                cellSize + 2
            );

            updateStats();
        }

        // Event listeners
        document.getElementById('speed').addEventListener('input', (e) => {
            stepsPerFrame = parseInt(e.target.value);
            document.getElementById('speed-val').textContent = stepsPerFrame;
        });

        document.getElementById('size').addEventListener('input', (e) => {
            cellSize = parseInt(e.target.value);
            document.getElementById('size-val').textContent = cellSize;
            resize();
        });

        document.getElementById('pause-btn').addEventListener('click', () => {
            running = !running;
            document.getElementById('pause-btn').textContent = running ? 'Pause' : 'Resume';
        });

        document.getElementById('reset-btn').addEventListener('click', () => {
            initGrid();
        });

        document.getElementById('step-btn').addEventListener('click', () => {
            if (!running) {
                step();
                updateStats();
            }
        });

        // Preset buttons
        document.querySelectorAll('#presets button').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('#presets button').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentPreset = presets[btn.dataset.preset];
                initGrid();
            });
        });

        // Expose for enhance.js keyboard shortcuts
        window.reset = function() { initGrid(); resize(); };

        // Initialize
        resize();
        window.addEventListener('resize', resize);
        requestAnimationFrame(animate);
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
