<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Harmonograph Simulation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            overflow: hidden;
            background: #0a0a0a;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        canvas {
            display: block;
            background: #000;
        }
        .info {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 10px;
            color: white;
            max-width: 250px;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
        }
        button:hover {
            background: #764ba2;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div class="info">
        <h2>Harmonograph</h2>
        <p>A mechanical pendulum device that creates geometric images.</p>
        <button id="new">New Pattern</button>
        <button id="toggle">Pause/Resume</button>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let t = 0;
        let running = true;
        let points = [];

        // Harmonograph parameters
        let params = {
            f1: 2.01,    // Frequency 1
            f2: 3.00,    // Frequency 2
            f3: 3.00,    // Frequency 3
            f4: 2.00,    // Frequency 4
            p1: 0,       // Phase 1
            p2: 0,       // Phase 2
            p3: Math.PI/2, // Phase 3
            p4: Math.PI/2, // Phase 4
            d1: 0.004,   // Damping 1
            d2: 0.0065,  // Damping 2
            d3: 0.008,   // Damping 3
            d4: 0.019    // Damping 4
        };

        function randomizeParams() {
            params = {
                f1: Math.random() * 4 + 1,
                f2: Math.random() * 4 + 1,
                f3: Math.random() * 4 + 1,
                f4: Math.random() * 4 + 1,
                p1: Math.random() * Math.PI * 2,
                p2: Math.random() * Math.PI * 2,
                p3: Math.random() * Math.PI * 2,
                p4: Math.random() * Math.PI * 2,
                d1: Math.random() * 0.01,
                d2: Math.random() * 0.01,
                d3: Math.random() * 0.01,
                d4: Math.random() * 0.01
            };
            reset();
        }

        function reset() {
            t = 0;
            points = [];
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        function harmonograph(t) {
            const scale = Math.min(canvas.width, canvas.height) * 0.3;

            const x = scale * (
                Math.sin(t * params.f1 + params.p1) * Math.exp(-params.d1 * t) +
                Math.sin(t * params.f2 + params.p2) * Math.exp(-params.d2 * t)
            );

            const y = scale * (
                Math.sin(t * params.f3 + params.p3) * Math.exp(-params.d3 * t) +
                Math.sin(t * params.f4 + params.p4) * Math.exp(-params.d4 * t)
            );

            return {
                x: canvas.width / 2 + x,
                y: canvas.height / 2 + y
            };
        }

        function draw() {
            if (!running) return;

            const point = harmonograph(t);
            points.push(point);

            if (points.length > 1) {
                const prev = points[points.length - 2];
                const curr = points[points.length - 1];

                // Create gradient based on time
                const alpha = Math.max(0.1, 1 - (t / 100));
                const hue = (t * 2) % 360;

                ctx.beginPath();
                ctx.strokeStyle = `hsla(${hue}, 70%, 60%, ${alpha})`;
                ctx.lineWidth = 1.5;
                ctx.moveTo(prev.x, prev.y);
                ctx.lineTo(curr.x, curr.y);
                ctx.stroke();
            }

            t += 0.01;

            // Stop after enough time has passed
            if (t > 100) {
                return;
            }
        }

        function animate() {
            draw();
            requestAnimationFrame(animate);
        }

        document.getElementById('new').addEventListener('click', randomizeParams);
        document.getElementById('toggle').addEventListener('click', () => {
            running = !running;
        });

        // Expose for enhance.js
        window.reset = reset;

        reset();
        animate();

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            reset();
        });
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>