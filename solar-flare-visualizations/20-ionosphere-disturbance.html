<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ionosphere Disturbance</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: Arial; }
        canvas { display: block; }
        .info {
            position: absolute; top: 20px; right: 20px; color: #fff;
            background: rgba(0,0,0,0.8); padding: 15px; border-radius: 5px;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div class="info">
        <h3>Ionosphere Layers</h3>
        <div style="color: #ff6600;">D-Layer: 60-90 km</div>
        <div style="color: #ffaa00;">E-Layer: 90-150 km</div>
        <div style="color: #00ff00;">F1-Layer: 150-220 km</div>
        <div style="color: #00aaff;">F2-Layer: 220-800 km</div>
        <div style="margin-top: 10px; color: #ff3333;">
            âš  Enhanced D-Layer Absorption
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const earthY = canvas.height - 100;
        const earthRadius = canvas.width / 4;

        const layers = [
            {name: 'D', altitude: 60, thickness: 30, color: '#ff6600'},
            {name: 'E', altitude: 90, thickness: 60, color: '#ffaa00'},
            {name: 'F1', altitude: 150, thickness: 70, color: '#00ff00'},
            {name: 'F2', altitude: 220, thickness: 200, color: '#00aaff'}
        ];

        let disturbanceLevel = 0;
        let phase = 'normal';
        let time = 0;

        function drawEarth() {
            ctx.save();
            ctx.translate(canvas.width / 2, earthY);

            // Earth arc
            const gradient = ctx.createLinearGradient(0, -earthRadius, 0, 0);
            gradient.addColorStop(0, '#2255aa');
            gradient.addColorStop(1, '#114488');

            ctx.beginPath();
            ctx.arc(0, 0, earthRadius, Math.PI, 0);
            ctx.fillStyle = gradient;
            ctx.fill();

            ctx.restore();
        }

        function drawLayer(layer, disturbance) {
            ctx.save();
            ctx.translate(canvas.width / 2, earthY);

            const baseRadius = earthRadius + layer.altitude * 1.5;
            const thickness = layer.thickness * 1.5;

            // Layer arc
            ctx.beginPath();
            ctx.arc(0, 0, baseRadius, Math.PI, 0);
            ctx.arc(0, 0, baseRadius + thickness, 0, Math.PI, true);
            ctx.closePath();

            const alpha = 0.3 + (layer.name === 'D' ? disturbance * 0.5 : 0);
            const gradient = ctx.createLinearGradient(0, -baseRadius, 0, -(baseRadius + thickness));
            gradient.addColorStop(0, layer.color + '00');
            gradient.addColorStop(0.5, layer.color + Math.floor(alpha * 255).toString(16).padStart(2, '0'));
            gradient.addColorStop(1, layer.color + '00');

            ctx.fillStyle = gradient;
            ctx.fill();

            // Label
            ctx.fillStyle = '#fff';
            ctx.font = '14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(layer.name + '-Layer', 0, -(baseRadius + thickness / 2));

            ctx.restore();
        }

        function drawRadioWaves(disturbance) {
            // HF radio waves
            for (let i = 0; i < 5; i++) {
                const x = 100 + i * 150;
                const startY = 100;

                ctx.beginPath();
                ctx.moveTo(x, startY);

                for (let y = startY; y < earthY - earthRadius - 100; y += 10) {
                    const waveX = x + Math.sin(y * 0.1 + time * 0.1) * 20;
                    ctx.lineTo(waveX, y);
                }

                // Absorption in D-layer
                if (disturbance > 0.5) {
                    const absorption = disturbance;
                    ctx.strokeStyle = `rgba(255, 100, 100, ${1 - absorption})`;
                } else {
                    ctx.strokeStyle = 'rgba(0, 255, 255, 0.6)';
                }

                ctx.lineWidth = 2;
                ctx.stroke();

                // X marks where absorbed
                if (disturbance > 0.5) {
                    const absY = earthY - earthRadius - 90;
                    ctx.strokeStyle = '#ff0000';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(x - 10, absY - 10);
                    ctx.lineTo(x + 10, absY + 10);
                    ctx.moveTo(x + 10, absY - 10);
                    ctx.lineTo(x - 10, absY + 10);
                    ctx.stroke();
                }
            }
        }

        function updateDisturbance() {
            if (phase === 'normal') {
                disturbanceLevel = Math.max(0, disturbanceLevel - 0.005);
                if (time % 300 === 0) phase = 'rising';
            } else if (phase === 'rising') {
                disturbanceLevel += 0.02;
                if (disturbanceLevel >= 1) phase = 'disturbed';
            } else if (phase === 'disturbed') {
                if (time % 300 === 150) phase = 'normal';
            }
        }

        function animate() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            drawEarth();

            layers.forEach(layer => {
                drawLayer(layer, disturbanceLevel);
            });

            drawRadioWaves(disturbanceLevel);

            updateDisturbance();
            time++;

            requestAnimationFrame(animate);
        }

        animate();

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
