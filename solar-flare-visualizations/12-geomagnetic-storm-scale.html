<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geomagnetic Storm Scale (G-Scale)</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #111;
            font-family: Arial, sans-serif;
        }
        canvas {
            display: block;
        }
        .legend {
            position: absolute;
            top: 20px;
            right: 20px;
            color: #fff;
            background: rgba(0,0,0,0.9);
            padding: 15px;
            border-radius: 5px;
            min-width: 200px;
        }
        .scale-item {
            margin: 8px 0;
            padding: 5px;
            border-left: 4px solid;
        }
        .g1 { border-color: #00ff00; }
        .g2 { border-color: #88ff00; }
        .g3 { border-color: #ffff00; }
        .g4 { border-color: #ff8800; }
        .g5 { border-color: #ff0000; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div class="legend">
        <h3>Geomagnetic Storm Scale</h3>
        <div class="scale-item g1"><strong>G1</strong> Minor</div>
        <div class="scale-item g2"><strong>G2</strong> Moderate</div>
        <div class="scale-item g3"><strong>G3</strong> Strong ✓</div>
        <div class="scale-item g4"><strong>G4</strong> Severe</div>
        <div class="scale-item g5"><strong>G5</strong> Extreme</div>
        <div style="margin-top: 10px; font-size: 12px; color: #888;">
            Nov 11 Event: G3 (Strong)
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const scales = [
            {name: 'G1', label: 'Minor', color: '#00ff00', kp: 5, impacts: ['Weak power fluctuations', 'Minor satellite ops impact']},
            {name: 'G2', label: 'Moderate', color: '#88ff00', kp: 6, impacts: ['High latitude power alarms', 'Satellite drag']},
            {name: 'G3', label: 'Strong', color: '#ffff00', kp: 7, impacts: ['Voltage corrections needed', 'GPS intermittent'], current: true},
            {name: 'G4', label: 'Severe', color: '#ff8800', kp: 8, impacts: ['Widespread voltage problems', 'Satellite tracking issues']},
            {name: 'G5', label: 'Extreme', color: '#ff0000', kp: 9, impacts: ['Power grid collapse possible', 'Satellite damage']}
        ];

        let currentScale = 2; // G3
        let animationProgress = 0;
        let time = 0;

        function drawScale(index, y) {
            const scale = scales[index];
            const x = 100;
            const width = canvas.width - 200;
            const height = 60;

            // Background bar
            ctx.fillStyle = scale.current ? 'rgba(255,255,255,0.1)' : 'rgba(255,255,255,0.05)';
            ctx.fillRect(x, y, width, height);

            // Intensity bar
            const intensity = index <= currentScale ? 1 : 0;
            const barWidth = width * intensity * (1 + (scale.current ? Math.sin(time * 0.1) * 0.1 : 0));

            const gradient = ctx.createLinearGradient(x, y, x + barWidth, y);
            gradient.addColorStop(0, scale.color);
            gradient.addColorStop(1, scale.color + '88');

            ctx.fillStyle = gradient;
            ctx.fillRect(x, y, barWidth, height);

            // Border
            ctx.strokeStyle = scale.current ? scale.color : '#444';
            ctx.lineWidth = scale.current ? 3 : 1;
            ctx.strokeRect(x, y, width, height);

            // Label
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 24px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(scale.name, x + 10, y + 30);

            ctx.font = '16px Arial';
            ctx.fillText(scale.label, x + 60, y + 30);

            ctx.font = '12px Arial';
            ctx.fillStyle = '#aaa';
            ctx.fillText(`Kp ${scale.kp}`, x + 10, y + 50);

            // Impacts text
            if (scale.current) {
                ctx.font = '14px Arial';
                ctx.fillStyle = scale.color;
                scale.impacts.forEach((impact, i) => {
                    ctx.fillText(`• ${impact}`, x + 150, y + 25 + i * 20);
                });
            }

            // Current indicator
            if (scale.current) {
                ctx.beginPath();
                ctx.arc(x - 20, y + height / 2, 8, 0, Math.PI * 2);
                ctx.fillStyle = scale.color;
                ctx.fill();
                ctx.shadowBlur = 15;
                ctx.shadowColor = scale.color;
                ctx.fill();
                ctx.shadowBlur = 0;
            }
        }

        function drawKpIndex() {
            // Draw Kp index chart at bottom
            const chartX = 100;
            const chartY = canvas.height - 150;
            const chartWidth = canvas.width - 200;
            const chartHeight = 100;

            ctx.fillStyle = '#222';
            ctx.fillRect(chartX, chartY, chartWidth, chartHeight);

            // Draw Kp levels
            const hours = 24;
            const barWidth = chartWidth / hours;

            for (let i = 0; i < hours; i++) {
                // Simulate Kp variation during storm
                let kp;
                if (i < 8) {
                    kp = 2 + Math.random();
                } else if (i < 12) {
                    kp = 2 + (i - 8) * 1.5 + Math.random();
                } else if (i < 16) {
                    kp = 7 + Math.random() * 2;
                } else {
                    kp = 7 - (i - 16) * 0.5 + Math.random();
                }

                kp = Math.min(9, Math.max(0, kp));

                const barHeight = (kp / 9) * chartHeight;
                const x = chartX + i * barWidth;
                const y = chartY + chartHeight - barHeight;

                // Color based on Kp
                let color;
                if (kp < 5) color = '#00ff00';
                else if (kp < 6) color = '#88ff00';
                else if (kp < 7) color = '#ffff00';
                else if (kp < 8) color = '#ff8800';
                else color = '#ff0000';

                ctx.fillStyle = color;
                ctx.fillRect(x, y, barWidth - 2, barHeight);
            }

            // Labels
            ctx.fillStyle = '#fff';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('0h', chartX, chartY + chartHeight + 20);
            ctx.fillText('12h', chartX + chartWidth / 2, chartY + chartHeight + 20);
            ctx.fillText('24h', chartX + chartWidth, chartY + chartHeight + 20);

            ctx.textAlign = 'left';
            ctx.fillText('Kp Index (24h)', chartX, chartY - 10);
        }

        function drawMagnetometerData() {
            // Simulate magnetometer deflection
            const magY = canvas.height - 250;
            const magHeight = 80;
            const magWidth = canvas.width - 200;
            const magX = 100;

            ctx.strokeStyle = '#444';
            ctx.lineWidth = 1;
            ctx.strokeRect(magX, magY, magWidth, magHeight);

            // Baseline
            ctx.beginPath();
            ctx.moveTo(magX, magY + magHeight / 2);
            ctx.lineTo(magX + magWidth, magY + magHeight / 2);
            ctx.strokeStyle = '#666';
            ctx.setLineDash([5, 5]);
            ctx.stroke();
            ctx.setLineDash([]);

            // Magnetometer signal
            ctx.beginPath();
            const points = 200;

            for (let i = 0; i < points; i++) {
                const x = magX + (i / points) * magWidth;
                const t = i / 20 + time * 0.1;

                // Simulate storm perturbation
                let deflection = Math.sin(t) * 5;
                if (i > points * 0.3 && i < points * 0.8) {
                    deflection += Math.sin(t * 3) * 20;
                }

                const y = magY + magHeight / 2 + deflection;

                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }

            ctx.strokeStyle = '#00ffff';
            ctx.lineWidth = 2;
            ctx.stroke();

            ctx.fillStyle = '#fff';
            ctx.font = '12px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('Ground Magnetometer', magX, magY - 10);
        }

        function animate() {
            ctx.fillStyle = '#111';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Title
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 32px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('NOAA Geomagnetic Storm Scale', 100, 50);

            // Draw scales
            scales.forEach((scale, index) => {
                drawScale(index, 80 + index * 80);
            });

            drawMagnetometerData();
            drawKpIndex();

            time++;
            requestAnimationFrame(animate);
        }

        animate();

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
