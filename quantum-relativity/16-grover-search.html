<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grover's Search Algorithm - CCAB</title>
    <link rel="stylesheet" href="../assets/css/gallery-standard.css">
    <style>
        body {
            background: #1e1e1e;
            color: #eee;
            font-family: 'Segoe UI', system-ui;
            padding: 2rem;
            text-align: center;
        }
        .container { max-width: 900px; margin: 0 auto; }
        
        .chart-container {
            height: 400px;
            background: #252526;
            border-radius: 8px;
            padding: 20px;
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            border-bottom: 2px solid #555;
            position: relative;
        }
        
        .bar-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 5%;
        }
        
        .bar {
            width: 100%;
            background: #0ea5e9;
            transition: height 0.5s ease, transform 0.5s ease, background 0.3s;
            border-top-left-radius: 4px;
            border-top-right-radius: 4px;
            position: relative;
        }
        
        .bar.target { background: #eab308; box-shadow: 0 0 10px #eab308; }
        .bar.negative { background: #ef4444; border-bottom-left-radius: 4px; border-bottom-right-radius: 4px; border-top-left-radius: 0; border-top-right-radius: 0; }
        
        .label {
            margin-top: 10px;
            font-family: monospace;
            font-size: 0.8rem;
            color: #888;
        }
        
        .controls {
            margin-top: 30px;
            background: #333;
            padding: 20px;
            border-radius: 8px;
            display: inline-block;
        }
        
        button {
            padding: 10px 20px;
            background: #444;
            color: white;
            border: none;
            cursor: pointer;
            margin: 0 5px;
            border-radius: 4px;
        }
        button:hover { background: #555; }
        button:disabled { background: #222; color: #555; }
        
        .baseline {
            position: absolute;
            bottom: 45px; /* Adjust for labels */
            left: 0;
            width: 100%;
            height: 1px;
            background: #666;
            z-index: 0;
        }
        
        .avg-line {
            position: absolute;
            left: 0;
            width: 100%;
            height: 2px;
            background: #10b981;
            border-top: 1px dashed #000;
            transition: bottom 0.5s ease;
            z-index: 10;
        }
    </style>
</head>
<body>

<div class="container">
    <a href="../index.html" class="gallery-back">← Back to Gallery</a>
    <h1>Grover's Search Algorithm</h1>
    <p>Searching for a marked item in \( O(\sqrt{N}) \) steps using amplitude amplification.</p>
    
    <div class="chart-container" id="chart">
        <div class="baseline"></div>
        <div class="avg-line" id="avg-line"></div>
        <!-- Bars -->
    </div>
    
    <div class="controls">
        <button onclick="reset()">Reset (Superposition)</button>
        <button onclick="oracle()" id="btn-oracle">1. Oracle (Flip Phase)</button>
        <button onclick="diffuser()" id="btn-diffuser" disabled>2. Diffuser (Reflect Mean)</button>
    </div>
    
    <p id="status-text" style="color: #aaa; margin-top: 20px;">
        State: Equal Superposition
    </p>
</div>

<script>
    const N = 16;
    const targetIndex = 11; // 1011
    let amplitudes = [];
    
    const chart = document.getElementById('chart');
    const avgLine = document.getElementById('avg-line');
    const statusText = document.getElementById('status-text');
    
    function reset() {
        amplitudes = new Array(N).fill(1 / Math.sqrt(N));
        render();
        document.getElementById('btn-oracle').disabled = false;
        document.getElementById('btn-diffuser').disabled = true;
        statusText.textContent = "State: Equal Superposition. All states have equal probability.";
    }
    
    function oracle() {
        // Flip sign of target
        amplitudes[targetIndex] = -amplitudes[targetIndex];
        render();
        document.getElementById('btn-oracle').disabled = true;
        document.getElementById('btn-diffuser').disabled = false;
        statusText.textContent = "Oracle: Phase of target state |1011⟩ flipped (negative amplitude).";
    }
    
    function diffuser() {
        // Reflection about the mean
        // Calculate mean
        const mean = amplitudes.reduce((a,b) => a+b, 0) / N;
        
        // v' = 2*mean - v
        amplitudes = amplitudes.map(v => 2*mean - v);
        
        render(mean);
        document.getElementById('btn-oracle').disabled = false;
        document.getElementById('btn-diffuser').disabled = true;
        statusText.textContent = "Diffuser: Inversion about the mean amplifies the target state.";
    }
    
    function render(meanVal = null) {
        // Clear bars (keep baseline/avgline)
        const existingBars = document.querySelectorAll('.bar-group');
        existingBars.forEach(b => b.remove());
        
        amplitudes.forEach((amp, i) => {
            const group = document.createElement('div');
            group.className = 'bar-group';
            
            const bar = document.createElement('div');
            bar.className = 'bar';
            
            // Height calc (scale for visibility)
            // Max amplitude can go up to 1.
            // Let's map 1.0 to 300px.
            const h = Math.abs(amp) * 300;
            bar.style.height = `${h}px`;
            
            if (amp < 0) {
                bar.classList.add('negative');
                bar.style.transform = `translateY(${h}px)`; // Move down from baseline
            } else {
                bar.style.transform = 'translateY(0)';
            }
            
            if (i === targetIndex) bar.classList.add('target');
            
            const label = document.createElement('div');
            label.className = 'label';
            label.textContent = i.toString(2).padStart(4, '0');
            
            group.appendChild(bar);
            group.appendChild(label);
            chart.appendChild(group);
        });
        
        // Update avg line
        if (meanVal === null) {
            meanVal = amplitudes.reduce((a,b) => a+b, 0) / N;
        }
        // Base is at 45px from bottom? 
        // Need to calculate bottom offset carefully.
        // Container padding bottom 20px + label height approx 25px = 45px baseline
        const baseOffset = 45;
        const lineH = meanVal * 300;
        avgLine.style.bottom = (baseOffset + lineH) + 'px';
    }
    
    reset();
    
</script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
