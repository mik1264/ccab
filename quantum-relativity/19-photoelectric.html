<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photoelectric Effect - CCAB</title>
    <link rel="stylesheet" href="../assets/css/gallery-standard.css">
    <style>
        body {
            background: #222;
            color: #eee;
            font-family: 'Segoe UI', system-ui;
            padding: 2rem;
            text-align: center;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        
        .simulation-area {
            position: relative;
            background: #111;
            border: 1px solid #444;
            border-radius: 8px;
            height: 400px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .plate {
            position: absolute;
            bottom: 0;
            left: 20%;
            width: 60%;
            height: 20px;
            background: #888;
            border-top: 3px solid #aaa;
        }
        
        .collector {
            position: absolute;
            top: 20px;
            left: 20%;
            width: 60%;
            height: 10px;
            background: #555;
            border-bottom: 2px solid #777;
        }
        
        .light-source {
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 70%);
            pointer-events: none;
            transition: opacity 0.2s;
        }
        
        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .controls {
            background: #333;
            padding: 20px;
            border-radius: 8px;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            text-align: left;
        }
        
        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem; }
        input[type=range] { width: 100%; }
        
        .val-display { float: right; color: #fcd34d; font-family: monospace; }
        
        .readout {
            margin-top: 10px;
            padding: 10px;
            background: #444;
            border-radius: 4px;
            font-family: monospace;
            text-align: center;
        }
        
        .ammeter {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 100px;
            height: 100px;
            border: 4px solid #666;
            border-radius: 50%;
            background: #222;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: monospace;
            font-size: 1.2rem;
            color: #10b981;
            box-shadow: inset 0 0 10px #000;
        }
    </style>
</head>
<body>

<div class="container">
    <a href="../index.html" class="gallery-back">← Back to Gallery</a>
    <h1>Photoelectric Effect</h1>
    <p>Light hitting a metal surface ejects electrons only if photon energy \( hf \) exceeds the work function \( \Phi \).</p>
    
    <div class="simulation-area">
        <div class="light-source" id="light-glow"></div>
        <div class="collector"></div>
        <div class="plate"></div>
        <canvas id="canvas" width="1000" height="400"></canvas>
        <div class="ammeter" id="current-val">0.0 mA</div>
    </div>
    
    <div class="controls">
        <div>
            <label>Light Wavelength (Color) <span id="wl-val" class="val-display">400 nm</span></label>
            <input type="range" id="wl-slider" min="200" max="800" value="400">
            <div style="height: 10px; margin-top: 5px; background: linear-gradient(to right, #b0f, #00f, #0f0, #ff0, #f00); border-radius: 2px;"></div>
        </div>
        
        <div>
            <label>Light Intensity <span id="int-val" class="val-display">50%</span></label>
            <input type="range" id="int-slider" min="0" max="100" value="50">
        </div>
        
        <div>
            <label>Voltage (Retarding Potential) <span id="v-val" class="val-display">0.0 V</span></label>
            <input type="range" id="v-slider" min="-5" max="5" step="0.1" value="0">
        </div>
        
        <div style="grid-column: span 3; text-align: center;">
            <label>Metal Work Function (\( \Phi \)): <span id="wf-val" class="val-display">2.3 eV (Potassium)</span></label>
            <input type="range" id="wf-slider" min="1.0" max="5.0" step="0.1" value="2.3">
        </div>
    </div>
    
    <div class="readout" id="energy-calc">
        Photon Energy: 3.10 eV | Max KE: 0.80 eV
    </div>
</div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    // Constants
    const h = 4.1357e-15; // eV*s
    const c = 3e8; // m/s
    // Energy E = hc / lambda = 1240 / lambda(nm) eV
    
    // State
    let wavelength = 400; // nm
    let intensity = 50; // %
    let voltage = 0; // V
    let workFunction = 2.3; // eV
    
    let photons = [];
    let electrons = [];
    
    // Elements
    const wlSlider = document.getElementById('wl-slider');
    const intSlider = document.getElementById('int-slider');
    const vSlider = document.getElementById('v-slider');
    const wfSlider = document.getElementById('wf-slider');
    const lightGlow = document.getElementById('light-glow');
    
    function update() {
        wavelength = parseInt(wlSlider.value);
        intensity = parseInt(intSlider.value);
        voltage = parseFloat(vSlider.value);
        workFunction = parseFloat(wfSlider.value);
        
        document.getElementById('wl-val').textContent = wavelength + ' nm';
        document.getElementById('int-val').textContent = intensity + '%';
        document.getElementById('v-val').textContent = voltage.toFixed(1) + ' V';
        document.getElementById('wf-val').textContent = workFunction.toFixed(1) + ' eV';
        
        // Update Calculations
        const E_photon = 1240 / wavelength; // eV
        let KE_max = E_photon - workFunction;
        
        let status = '';
        if (KE_max > 0) {
            status = `Max KE: ${KE_max.toFixed(2)} eV`;
        } else {
            status = "No Emission (E < Φ)";
            KE_max = 0;
        }
        
        document.getElementById('energy-calc').textContent = `Photon Energy: ${E_photon.toFixed(2)} eV | ${status}`;
        
        // Update Light Color
        const color = wavelengthToColor(wavelength);
        lightGlow.style.background = `radial-gradient(circle, ${color} 0%, rgba(0,0,0,0) 70%)`;
        lightGlow.style.opacity = intensity / 100;
    }
    
    // Listeners
    [wlSlider, intSlider, vSlider, wfSlider].forEach(el => el.addEventListener('input', update));
    
    // Simulation Loop
    function loop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Spawn Photons
        // Probability proportional to intensity
        if (Math.random() < (intensity / 100) * 0.5) {
            photons.push({
                x: Math.random() * 600 + 200, // Spread over plate area
                y: 0,
                vy: 5 + Math.random() * 2,
                color: wavelengthToColor(wavelength)
            });
        }
        
        // Update Photons
        for (let i = photons.length - 1; i >= 0; i--) {
            let p = photons[i];
            p.y += p.vy;
            
            // Hit Plate (y ~ 380)
            if (p.y > 380) {
                // Determine if electron ejected
                const E_photon = 1240 / wavelength;
                if (E_photon > workFunction) {
                    // Eject Electron
                    const KE = E_photon - workFunction;
                    // Initial velocity proportional to sqrt(KE)
                    // Direction: Upwards with some spread
                    const v = Math.sqrt(KE) * 3; 
                    const angle = -Math.PI/2 + (Math.random() - 0.5);
                    
                    electrons.push({
                        x: p.x,
                        y: 380,
                        vx: Math.cos(angle) * v,
                        vy: Math.sin(angle) * v,
                        ke: KE // Store initial KE for physics? No, use physics
                    });
                }
                photons.splice(i, 1);
            } else {
                // Draw Photon (Wavy line or packet)
                ctx.strokeStyle = p.color;
                ctx.lineWidth = 2;
                ctx.beginPath();
                // Draw a little wave packet
                const waveX = p.x + Math.sin(p.y * 0.1) * 5;
                ctx.moveTo(waveX, p.y);
                ctx.lineTo(waveX, p.y - 10);
                ctx.stroke();
            }
        }
        
        // Update Electrons
        let currentCount = 0;
        
        for (let i = electrons.length - 1; i >= 0; i--) {
            let e = electrons[i];
            
            // Physics: F = qE. E field depends on Voltage.
            // V > 0 (Accelerating): Pulls electrons up.
            // V < 0 (Retarding): Pushes electrons down.
            // Force factor
            const forceY = -voltage * 0.1; 
            
            e.vy += forceY;
            e.x += e.vx;
            e.y += e.vy;
            
            // Hit Collector (Top)
            if (e.y < 30) {
                currentCount++;
                electrons.splice(i, 1);
            }
            // Hit Plate again (Turned back)
            else if (e.y > 380) {
                electrons.splice(i, 1);
            }
            // Out of bounds
            else if (e.x < 0 || e.x > 1000) {
                electrons.splice(i, 1);
            }
            else {
                // Draw Electron
                ctx.fillStyle = '#38bdf8';
                ctx.beginPath();
                ctx.arc(e.x, e.y, 3, 0, Math.PI*2);
                ctx.fill();
            }
        }
        
        // Update Ammeter
        // Smooth value
        // Simple current ~ electrons reaching collector
        const current = currentCount * 10; // arbitrary scale
        const displayI = document.getElementById('current-val');
        
        // Moving average visual hack
        let val = parseFloat(displayI.textContent);
        if (isNaN(val)) val = 0;
        val = val * 0.9 + current * 0.1;
        displayI.textContent = val.toFixed(1) + " mA";
        
        requestAnimationFrame(loop);
    }
    
    function wavelengthToColor(wavelength) {
        if (wavelength < 380) return '#444'; // UV
        if (wavelength > 750) return '#444'; // IR
        
        // Simple approx
        let r, g, b;
        if (wavelength >= 380 && wavelength < 440) {
            r = -1 * (wavelength - 440) / (440 - 380);
            g = 0;
            b = 1;
        } else if (wavelength >= 440 && wavelength < 490) {
            r = 0;
            g = (wavelength - 440) / (490 - 440);
            b = 1;
        } else if (wavelength >= 490 && wavelength < 510) {
            r = 0;
            g = 1;
            b = -1 * (wavelength - 510) / (510 - 490);
        } else if (wavelength >= 510 && wavelength < 580) {
            r = (wavelength - 510) / (580 - 510);
            g = 1;
            b = 0;
        } else if (wavelength >= 580 && wavelength < 645) {
            r = 1;
            g = -1 * (wavelength - 645) / (645 - 580);
            b = 0;
        } else if (wavelength >= 645 && wavelength <= 750) {
            r = 1;
            g = 0;
            b = 0;
        }
        return `rgb(${r*255}, ${g*255}, ${b*255})`;
    }
    
    update();
    requestAnimationFrame(loop);

</script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
