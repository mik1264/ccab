<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wind Turbine Power Curve</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
canvas { display: block; }
#controls {
    position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
    background: rgba(0,0,0,0.8); border: 1px solid rgba(251,191,36,0.3);
    border-radius: 12px; padding: 16px 24px; display: flex; gap: 24px;
    align-items: center; z-index: 10; flex-wrap: wrap; justify-content: center;
}
.control-group { display: flex; flex-direction: column; align-items: center; gap: 4px; }
label { color: #fbbf24; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; }
input[type="range"] { width: 160px; accent-color: #fbbf24; }
.value-display { color: #fff; font-size: 14px; font-weight: bold; }
#title {
    position: fixed; top: 50px; left: 50%; transform: translateX(-50%);
    color: #fbbf24; font-size: 22px; font-weight: 600;
    text-shadow: 0 0 20px rgba(251,191,36,0.5); z-index: 10;
    pointer-events: none; text-align: center;
}
</style>
</head>
<body>
<a href="../index.html" style="position:fixed;top:10px;left:10px;padding:8px 16px;background:rgba(0,0,0,0.7);color:#fbbf24;text-decoration:none;border-radius:6px;font-size:14px;z-index:999;font-family:sans-serif;">&#8592; Back to Gallery</a>
<div id="title">Wind Turbine Power Curve</div>
<canvas id="canvas"></canvas>
<div id="controls">
    <div class="control-group">
        <label>Wind Speed</label>
        <input type="range" id="windSpeed" min="0" max="35" value="10" step="0.5">
        <span class="value-display" id="windVal">10 m/s</span>
    </div>
    <div class="control-group">
        <label>Blade Length</label>
        <input type="range" id="bladeLen" min="20" max="80" value="50" step="1">
        <span class="value-display" id="bladeVal">50 m</span>
    </div>
    <div class="control-group">
        <label>Air Density</label>
        <input type="range" id="airDensity" min="0.9" max="1.4" value="1.225" step="0.005">
        <span class="value-display" id="densityVal">1.225 kg/m&sup3;</span>
    </div>
</div>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let W, H;
function resize() { W = canvas.width = window.innerWidth; H = canvas.height = window.innerHeight; }
resize();
window.addEventListener('resize', resize);

const windSpeedSlider = document.getElementById('windSpeed');
const bladeLenSlider = document.getElementById('bladeLen');
const airDensitySlider = document.getElementById('airDensity');

let windSpeed = 10, bladeLength = 50, airDensity = 1.225;
let bladeAngle = 0, bladeRotSpeed = 0;
let powerHistory = [];
let windParticles = [];

const CUT_IN = 3, RATED_SPEED = 12, CUT_OUT = 25, RATED_POWER_FACTOR = 1;

windSpeedSlider.addEventListener('input', e => { windSpeed = +e.target.value; document.getElementById('windVal').textContent = windSpeed + ' m/s'; });
bladeLenSlider.addEventListener('input', e => { bladeLength = +e.target.value; document.getElementById('bladeVal').textContent = bladeLength + ' m'; });
airDensitySlider.addEventListener('input', e => { airDensity = +e.target.value; document.getElementById('densityVal').textContent = airDensity.toFixed(3) + ' kg/m\u00b3'; });

function getPower(ws) {
    if (ws < CUT_IN || ws > CUT_OUT) return 0;
    const area = Math.PI * bladeLength * bladeLength;
    const maxPower = 0.5 * airDensity * area * Math.pow(RATED_SPEED, 3) * 0.45 / 1e6;
    if (ws <= RATED_SPEED) {
        const frac = (ws - CUT_IN) / (RATED_SPEED - CUT_IN);
        return maxPower * Math.pow(frac, 3);
    }
    return maxPower;
}

function getBladePitch(ws) {
    if (ws < CUT_IN) return 90;
    if (ws <= RATED_SPEED) return 0;
    if (ws <= CUT_OUT) return Math.min(30, (ws - RATED_SPEED) / (CUT_OUT - RATED_SPEED) * 30);
    return 90;
}

function initParticles() {
    windParticles = [];
    for (let i = 0; i < 200; i++) {
        windParticles.push({
            x: Math.random() * W,
            y: Math.random() * H * 0.6,
            speed: 0.5 + Math.random() * 0.5,
            size: 1 + Math.random() * 2
        });
    }
}
initParticles();

function drawTurbine(cx, cy, scale) {
    const towerH = 180 * scale;
    const hubY = cy - towerH;
    ctx.strokeStyle = '#667788';
    ctx.lineWidth = 8 * scale;
    ctx.beginPath();
    ctx.moveTo(cx - 5 * scale, cy);
    ctx.lineTo(cx, hubY);
    ctx.lineTo(cx + 5 * scale, cy);
    ctx.stroke();
    const bLen = bladeLength * scale * 1.5;
    const pitch = getBladePitch(windSpeed) * Math.PI / 180;
    const bWidth = 12 * scale * Math.cos(pitch);
    for (let i = 0; i < 3; i++) {
        const a = bladeAngle + i * (Math.PI * 2 / 3);
        const tipX = cx + Math.cos(a) * bLen;
        const tipY = hubY + Math.sin(a) * bLen;
        ctx.beginPath();
        ctx.moveTo(cx, hubY);
        const perpX = -Math.sin(a) * bWidth;
        const perpY = Math.cos(a) * bWidth;
        ctx.lineTo(cx + perpX * 0.5, hubY + perpY * 0.5);
        ctx.lineTo(tipX, tipY);
        ctx.lineTo(cx - perpX * 0.5, hubY - perpY * 0.5);
        ctx.closePath();
        const power = getPower(windSpeed);
        const area = Math.PI * bladeLength * bladeLength;
        const maxPower = 0.5 * airDensity * area * Math.pow(RATED_SPEED, 3) * 0.45 / 1e6;
        const intensity = maxPower > 0 ? Math.min(1, power / maxPower) : 0;
        ctx.fillStyle = `rgba(${100 + intensity * 100}, ${150 + intensity * 60}, ${200}, 0.85)`;
        ctx.fill();
        ctx.strokeStyle = 'rgba(120,180,220,0.5)';
        ctx.lineWidth = 1;
        ctx.stroke();
    }
    ctx.beginPath();
    ctx.arc(cx, hubY, 8 * scale, 0, Math.PI * 2);
    ctx.fillStyle = '#556677';
    ctx.fill();
    ctx.strokeStyle = '#88aabb';
    ctx.lineWidth = 2;
    ctx.stroke();
}

function drawPowerCurve(x, y, w, h) {
    ctx.fillStyle = 'rgba(0,0,0,0.7)';
    ctx.strokeStyle = 'rgba(251,191,36,0.3)';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.roundRect(x, y, w, h, 8);
    ctx.fill();
    ctx.stroke();
    ctx.fillStyle = '#fbbf24';
    ctx.font = 'bold 12px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('Power Curve', x + w / 2, y + 18);
    const area = Math.PI * bladeLength * bladeLength;
    const maxP = 0.5 * airDensity * area * Math.pow(RATED_SPEED, 3) * 0.45 / 1e6;
    const gx = x + 40, gy = y + 30, gw = w - 55, gh = h - 55;
    ctx.strokeStyle = 'rgba(255,255,255,0.1)';
    ctx.lineWidth = 1;
    for (let i = 0; i <= 4; i++) {
        const ly = gy + gh - (i / 4) * gh;
        ctx.beginPath(); ctx.moveTo(gx, ly); ctx.lineTo(gx + gw, ly); ctx.stroke();
        ctx.fillStyle = '#666';
        ctx.font = '9px sans-serif';
        ctx.textAlign = 'right';
        ctx.fillText((maxP * i / 4).toFixed(1), gx - 4, ly + 3);
    }
    ctx.fillStyle = '#888';
    ctx.font = '9px sans-serif';
    ctx.textAlign = 'center';
    for (let s = 0; s <= 35; s += 5) {
        const sx = gx + (s / 35) * gw;
        ctx.fillText(s + '', sx, gy + gh + 14);
    }
    ctx.fillText('Wind Speed (m/s)', gx + gw / 2, gy + gh + 26);
    ctx.fillStyle = '#666';
    ctx.save();
    ctx.translate(x + 10, gy + gh / 2);
    ctx.rotate(-Math.PI / 2);
    ctx.textAlign = 'center';
    ctx.fillText('Power (MW)', 0, 0);
    ctx.restore();
    const regions = [
        { from: 0, to: CUT_IN, color: 'rgba(255,80,80,0.1)', label: 'Below\nCut-in' },
        { from: CUT_IN, to: RATED_SPEED, color: 'rgba(80,200,80,0.1)', label: 'Partial\nLoad' },
        { from: RATED_SPEED, to: CUT_OUT, color: 'rgba(80,120,255,0.1)', label: 'Rated' },
        { from: CUT_OUT, to: 35, color: 'rgba(255,80,80,0.1)', label: 'Shut\nDown' }
    ];
    regions.forEach(r => {
        const rx = gx + (r.from / 35) * gw;
        const rw = ((r.to - r.from) / 35) * gw;
        ctx.fillStyle = r.color;
        ctx.fillRect(rx, gy, rw, gh);
    });
    ctx.beginPath();
    ctx.strokeStyle = '#4af';
    ctx.lineWidth = 2.5;
    for (let s = 0; s <= 35; s += 0.5) {
        const p = getPower(s);
        const px = gx + (s / 35) * gw;
        const py = gy + gh - (maxP > 0 ? (p / maxP) * gh : 0);
        if (s === 0) ctx.moveTo(px, py);
        else ctx.lineTo(px, py);
    }
    ctx.stroke();
    const cp = getPower(windSpeed);
    const cpx = gx + (windSpeed / 35) * gw;
    const cpy = gy + gh - (maxP > 0 ? (cp / maxP) * gh : 0);
    ctx.beginPath();
    ctx.arc(cpx, cpy, 6, 0, Math.PI * 2);
    ctx.fillStyle = '#fbbf24';
    ctx.fill();
    ctx.strokeStyle = '#fff';
    ctx.lineWidth = 2;
    ctx.stroke();
    ctx.setLineDash([4, 4]);
    ctx.strokeStyle = 'rgba(251,191,36,0.4)';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(cpx, gy);
    ctx.lineTo(cpx, gy + gh);
    ctx.stroke();
    ctx.setLineDash([]);
}

function drawEfficiencyGauge(x, y, r) {
    const power = getPower(windSpeed);
    const area = Math.PI * bladeLength * bladeLength;
    const windPower = 0.5 * airDensity * area * Math.pow(windSpeed, 3) / 1e6;
    const efficiency = windPower > 0.001 ? Math.min(1, power / windPower) : 0;
    const betzLimit = 16 / 27;
    ctx.beginPath();
    ctx.arc(x, y, r, Math.PI * 0.75, Math.PI * 2.25);
    ctx.strokeStyle = 'rgba(255,255,255,0.1)';
    ctx.lineWidth = 8;
    ctx.stroke();
    const endAngle = Math.PI * 0.75 + efficiency * Math.PI * 1.5;
    ctx.beginPath();
    ctx.arc(x, y, r, Math.PI * 0.75, endAngle);
    const effColor = efficiency > betzLimit * 0.8 ? '#4f8' : efficiency > betzLimit * 0.5 ? '#fbbf24' : '#f55';
    ctx.strokeStyle = effColor;
    ctx.lineWidth = 8;
    ctx.stroke();
    const betzAngle = Math.PI * 0.75 + betzLimit * Math.PI * 1.5;
    const bx = x + Math.cos(betzAngle) * (r + 10);
    const by = y + Math.sin(betzAngle) * (r + 10);
    ctx.beginPath();
    ctx.arc(x, y, r - 6, betzAngle - 0.02, betzAngle + 0.02);
    ctx.arc(x, y, r + 6, betzAngle + 0.02, betzAngle - 0.02, true);
    ctx.fillStyle = '#f84';
    ctx.fill();
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 18px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText((efficiency * 100).toFixed(1) + '%', x, y + 5);
    ctx.font = '10px sans-serif';
    ctx.fillStyle = '#aaa';
    ctx.fillText('Cp Efficiency', x, y + 20);
    ctx.fillStyle = '#f84';
    ctx.fillText('Betz: ' + (betzLimit * 100).toFixed(1) + '%', x, y + r + 22);
}

function drawInfoPanel(x, y) {
    const power = getPower(windSpeed);
    const pitch = getBladePitch(windSpeed);
    const area = Math.PI * bladeLength * bladeLength;
    const maxP = 0.5 * airDensity * area * Math.pow(RATED_SPEED, 3) * 0.45 / 1e6;
    ctx.fillStyle = 'rgba(0,0,0,0.7)';
    ctx.strokeStyle = 'rgba(251,191,36,0.2)';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.roundRect(x, y, 190, 155, 10);
    ctx.fill();
    ctx.stroke();
    ctx.fillStyle = '#fbbf24';
    ctx.font = 'bold 13px sans-serif';
    ctx.textAlign = 'left';
    ctx.fillText('Turbine Data', x + 12, y + 22);
    const lines = [
        ['Power Output', power.toFixed(2) + ' MW'],
        ['Rated Power', maxP.toFixed(2) + ' MW'],
        ['Blade Pitch', pitch.toFixed(1) + '\u00b0'],
        ['Rotor Area', (area / 1e4).toFixed(0) + ' m\u00b2'],
        ['Wind Speed', windSpeed.toFixed(1) + ' m/s'],
        ['Status', windSpeed < CUT_IN ? 'Idle' : windSpeed > CUT_OUT ? 'SHUTDOWN' : windSpeed > RATED_SPEED ? 'Rated' : 'Partial']
    ];
    ctx.font = '11px sans-serif';
    lines.forEach((l, i) => {
        ctx.fillStyle = '#888';
        ctx.fillText(l[0], x + 12, y + 42 + i * 18);
        ctx.fillStyle = i === 5 && windSpeed > CUT_OUT ? '#f55' : '#fff';
        ctx.textAlign = 'right';
        ctx.fillText(l[1], x + 178, y + 42 + i * 18);
        ctx.textAlign = 'left';
    });
}

let lastTime = performance.now();
function animate(now) {
    const dt = (now - lastTime) / 1000;
    lastTime = now;

    let targetSpeed = 0;
    if (windSpeed >= CUT_IN && windSpeed <= CUT_OUT) {
        targetSpeed = Math.min(windSpeed / RATED_SPEED, 1) * 4;
    }
    bladeRotSpeed += (targetSpeed - bladeRotSpeed) * dt * 2;
    bladeAngle += bladeRotSpeed * dt;

    ctx.clearRect(0, 0, W, H);
    const skyGrad = ctx.createLinearGradient(0, 0, 0, H * 0.6);
    skyGrad.addColorStop(0, '#0f1a33');
    skyGrad.addColorStop(1, '#1a2844');
    ctx.fillStyle = skyGrad;
    ctx.fillRect(0, 0, W, H * 0.6);
    const groundGrad = ctx.createLinearGradient(0, H * 0.55, 0, H);
    groundGrad.addColorStop(0, '#1a2a1a');
    groundGrad.addColorStop(1, '#0d1a0d');
    ctx.fillStyle = groundGrad;
    ctx.fillRect(0, H * 0.55, W, H * 0.45);

    windParticles.forEach(p => {
        p.x += windSpeed * p.speed * 2 * dt * 30;
        if (p.x > W + 10) { p.x = -10; p.y = Math.random() * H * 0.55; }
        ctx.beginPath();
        ctx.moveTo(p.x, p.y);
        ctx.lineTo(p.x - windSpeed * p.speed * 3, p.y);
        ctx.strokeStyle = `rgba(200,220,255,${0.1 + windSpeed / 50})`;
        ctx.lineWidth = p.size;
        ctx.stroke();
    });

    const turbineX = W * 0.25;
    const turbineY = H * 0.58;
    drawTurbine(turbineX, turbineY, 0.9);

    const curveW = Math.min(400, W * 0.4);
    const curveH = 220;
    drawPowerCurve(W * 0.52, H * 0.08, curveW, curveH);
    drawEfficiencyGauge(W * 0.52 + curveW / 2, H * 0.42, 50);
    drawInfoPanel(W - 220, H * 0.08);

    if (windSpeed > CUT_OUT) {
        ctx.fillStyle = '#f55';
        ctx.font = 'bold 16px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('EMERGENCY SHUTDOWN - Wind Too High!', turbineX, turbineY - 200);
    } else if (windSpeed < CUT_IN) {
        ctx.fillStyle = '#888';
        ctx.font = '14px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('Wind below cut-in speed', turbineX, turbineY - 200);
    }

    requestAnimationFrame(animate);
}
requestAnimationFrame(animate);
</script>
</body>
</html>
