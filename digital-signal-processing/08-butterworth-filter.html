<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Butterworth Filter - Maximally Flat Response</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3e 100%);
            color: #00aaff;
            min-height: 100vh;
            padding: 20px;
        }
        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #00aaff;
            text-decoration: none;
            padding: 10px 20px;
            background: rgba(0,170,255,0.1);
            border: 1px solid #00aaff;
            border-radius: 5px;
            z-index: 100;
        }
        .back-link:hover { background: rgba(0,170,255,0.2); }
        .container {
            max-width: 1100px;
            margin: 60px auto 0;
        }
        h1 { font-size: 2rem; margin-bottom: 10px; text-align: center; }
        .subtitle { color: #888; margin-bottom: 30px; text-align: center; }
        .main-panel {
            background: rgba(0,0,0,0.5);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid #00aaff;
            margin-bottom: 30px;
        }
        canvas {
            width: 100%;
            height: 300px;
            background: rgba(0,20,40,0.5);
            border-radius: 10px;
        }
        .controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        .control-group label { display: block; color: #888; margin-bottom: 8px; }
        input[type="range"] {
            width: 100%;
            height: 8px;
            background: rgba(0,170,255,0.2);
            border-radius: 4px;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: #00aaff;
            border-radius: 50%;
            cursor: pointer;
        }
        .value { color: #00ffff; font-size: 1rem; margin-top: 5px; }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        .panel {
            background: rgba(0,0,0,0.5);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid #00aaff;
        }
        .panel h3 { color: #00ccff; margin-bottom: 15px; text-align: center; }
        .small-canvas { height: 200px; }
        .formula {
            text-align: center;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            margin: 20px 0;
            font-size: 1.1rem;
        }
        .info {
            background: rgba(0,170,255,0.05);
            padding: 20px;
            border-radius: 10px;
        }
        .info h3 { color: #00ccff; margin-bottom: 10px; }
        .info p { color: #aaa; line-height: 1.6; margin-bottom: 10px; }
        @media (max-width: 768px) {
            .controls { grid-template-columns: 1fr; }
            .comparison { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back</a>
    <div class="container">
        <h1>Butterworth Filter</h1>
        <p class="subtitle">Maximally flat magnitude response in the passband</p>

        <div class="main-panel">
            <canvas id="mainCanvas"></canvas>
            <div class="controls">
                <div class="control-group">
                    <label>Filter Order (n)</label>
                    <input type="range" id="order" min="1" max="10" value="3" step="1">
                    <div class="value" id="orderVal">Order: 3</div>
                </div>
                <div class="control-group">
                    <label>Cutoff Frequency (ωc)</label>
                    <input type="range" id="cutoff" min="0.1" max="0.9" value="0.5" step="0.05">
                    <div class="value" id="cutoffVal">ωc = 0.5π</div>
                </div>
                <div class="control-group">
                    <label>Display Mode</label>
                    <input type="range" id="mode" min="0" max="1" value="0" step="1">
                    <div class="value" id="modeVal">Linear Scale</div>
                </div>
            </div>
        </div>

        <div class="formula">
            |H(jω)|² = 1 / (1 + (ω/ωc)^(2n))
        </div>

        <div class="comparison">
            <div class="panel">
                <h3>Order Comparison</h3>
                <canvas id="orderCanvas" class="small-canvas"></canvas>
            </div>
            <div class="panel">
                <h3>Pole Locations (s-plane)</h3>
                <canvas id="poleCanvas" class="small-canvas"></canvas>
            </div>
        </div>

        <div class="info">
            <h3>Butterworth Filter Characteristics</h3>
            <p><strong>Maximally Flat:</strong> The Butterworth filter has the flattest possible passband response - all derivatives of the magnitude response are zero at ω = 0.</p>
            <p><strong>Roll-off:</strong> The attenuation is -20n dB/decade (or -6n dB/octave) where n is the filter order.</p>
            <p><strong>Pole Locations:</strong> Poles are equally spaced on the left half of a circle of radius ωc in the s-plane, ensuring stability.</p>
            <p><strong>At Cutoff:</strong> The magnitude is always -3 dB (≈ 0.707) at the cutoff frequency, regardless of order.</p>
            <p><strong>Trade-off:</strong> Higher order = sharper transition but more phase distortion and complexity.</p>
        </div>
    </div>

    <script>
        const mainCanvas = document.getElementById('mainCanvas');
        const orderCanvas = document.getElementById('orderCanvas');
        const poleCanvas = document.getElementById('poleCanvas');

        function resizeCanvas(canvas) {
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            canvas.getContext('2d').scale(dpr, dpr);
        }

        function butterworthMagnitude(omega, n, wc) {
            return 1 / Math.sqrt(1 + Math.pow(omega / wc, 2 * n));
        }

        function drawMainResponse() {
            const ctx = mainCanvas.getContext('2d');
            const w = mainCanvas.width / (window.devicePixelRatio || 1);
            const h = mainCanvas.height / (window.devicePixelRatio || 1);

            const n = parseInt(document.getElementById('order').value);
            const wc = parseFloat(document.getElementById('cutoff').value);
            const isDB = parseInt(document.getElementById('mode').value) === 1;

            ctx.fillStyle = 'rgba(0,20,40,0.5)';
            ctx.fillRect(0, 0, w, h);

            // Grid
            ctx.strokeStyle = 'rgba(0,170,255,0.1)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 10; i++) {
                ctx.beginPath();
                ctx.moveTo(0, h * i / 10);
                ctx.lineTo(w, h * i / 10);
                ctx.stroke();
            }

            // Cutoff line
            const cutoffX = wc * w;
            ctx.strokeStyle = 'rgba(255,170,0,0.5)';
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(cutoffX, 0);
            ctx.lineTo(cutoffX, h);
            ctx.stroke();
            ctx.setLineDash([]);

            // -3dB line
            const db3Y = isDB ? (-3 / -60) * h : (1 - 0.707) * h;
            ctx.strokeStyle = 'rgba(255,102,136,0.5)';
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(0, db3Y);
            ctx.lineTo(w, db3Y);
            ctx.stroke();
            ctx.setLineDash([]);

            // Response curve
            ctx.strokeStyle = '#00ffaa';
            ctx.lineWidth = 3;
            ctx.beginPath();
            for (let x = 0; x < w; x++) {
                const omega = x / w;
                let mag = butterworthMagnitude(omega, n, wc);

                let y;
                if (isDB) {
                    const db = 20 * Math.log10(mag + 1e-10);
                    y = Math.min(h, Math.max(0, (-db / 60) * h));
                } else {
                    y = (1 - mag) * h;
                }

                if (x === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();

            // Labels
            ctx.fillStyle = '#888';
            ctx.font = '12px Courier New';
            ctx.fillText('0', 5, h - 5);
            ctx.fillText('π (Nyquist)', w - 80, h - 5);
            ctx.fillText(isDB ? '0 dB' : '1.0', 5, 15);
            ctx.fillText(isDB ? '-60 dB' : '0.0', 5, h - 20);

            ctx.fillStyle = '#ffaa00';
            ctx.fillText(`ωc = ${wc.toFixed(2)}π`, cutoffX + 5, 30);

            ctx.fillStyle = '#ff6688';
            ctx.fillText('-3 dB', w - 60, db3Y - 5);
        }

        function drawOrderComparison() {
            const ctx = orderCanvas.getContext('2d');
            const w = orderCanvas.width / (window.devicePixelRatio || 1);
            const h = orderCanvas.height / (window.devicePixelRatio || 1);
            const wc = 0.5;

            ctx.fillStyle = 'rgba(0,20,40,0.5)';
            ctx.fillRect(0, 0, w, h);

            // Grid
            ctx.strokeStyle = 'rgba(0,170,255,0.1)';
            for (let i = 0; i <= 5; i++) {
                ctx.beginPath();
                ctx.moveTo(0, h * i / 5);
                ctx.lineTo(w, h * i / 5);
                ctx.stroke();
            }

            const colors = ['#ff6688', '#ffaa00', '#00ffaa', '#00aaff', '#aa88ff'];
            const orders = [1, 2, 4, 6, 10];

            orders.forEach((n, idx) => {
                ctx.strokeStyle = colors[idx];
                ctx.lineWidth = 2;
                ctx.beginPath();
                for (let x = 0; x < w; x++) {
                    const omega = x / w;
                    const mag = butterworthMagnitude(omega, n, wc);
                    const y = (1 - mag) * h;
                    if (x === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.stroke();
            });

            // Legend
            ctx.font = '11px Courier New';
            orders.forEach((n, idx) => {
                ctx.fillStyle = colors[idx];
                ctx.fillText(`n=${n}`, w - 45, 20 + idx * 15);
            });
        }

        function drawPoles() {
            const ctx = poleCanvas.getContext('2d');
            const w = poleCanvas.width / (window.devicePixelRatio || 1);
            const h = poleCanvas.height / (window.devicePixelRatio || 1);

            const n = parseInt(document.getElementById('order').value);
            const wc = parseFloat(document.getElementById('cutoff').value);

            ctx.fillStyle = 'rgba(0,20,40,0.5)';
            ctx.fillRect(0, 0, w, h);

            const cx = w / 2, cy = h / 2;
            const scale = Math.min(w, h) * 0.4;

            // Axes
            ctx.strokeStyle = 'rgba(0,170,255,0.2)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(0, cy);
            ctx.lineTo(w, cy);
            ctx.moveTo(cx, 0);
            ctx.lineTo(cx, h);
            ctx.stroke();

            // Unit circle
            ctx.strokeStyle = 'rgba(0,170,255,0.3)';
            ctx.beginPath();
            ctx.arc(cx, cy, scale, 0, Math.PI * 2);
            ctx.stroke();

            // Cutoff circle
            ctx.strokeStyle = 'rgba(255,170,0,0.5)';
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.arc(cx, cy, wc * scale, 0, Math.PI * 2);
            ctx.stroke();
            ctx.setLineDash([]);

            // Poles (on left half of circle)
            for (let k = 0; k < n; k++) {
                const theta = Math.PI / 2 + Math.PI * (2 * k + 1) / (2 * n);
                const real = wc * Math.cos(theta);
                const imag = wc * Math.sin(theta);

                if (real < 0) { // Only left half plane poles
                    const px = cx + real * scale;
                    const py = cy - imag * scale;

                    ctx.strokeStyle = '#ff6688';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(px - 8, py - 8);
                    ctx.lineTo(px + 8, py + 8);
                    ctx.moveTo(px + 8, py - 8);
                    ctx.lineTo(px - 8, py + 8);
                    ctx.stroke();
                }
            }

            // Labels
            ctx.fillStyle = '#888';
            ctx.font = '11px Courier New';
            ctx.fillText('σ', w - 15, cy - 5);
            ctx.fillText('jω', cx + 5, 15);
            ctx.fillStyle = '#ffaa00';
            ctx.fillText('ωc', cx + wc * scale + 5, cy + 15);
        }

        function update() {
            const n = document.getElementById('order').value;
            const wc = document.getElementById('cutoff').value;
            const mode = document.getElementById('mode').value;

            document.getElementById('orderVal').textContent = `Order: ${n}`;
            document.getElementById('cutoffVal').textContent = `ωc = ${parseFloat(wc).toFixed(2)}π`;
            document.getElementById('modeVal').textContent = mode === '0' ? 'Linear Scale' : 'dB Scale';

            drawMainResponse();
            drawOrderComparison();
            drawPoles();
        }

        function init() {
            [mainCanvas, orderCanvas, poleCanvas].forEach(resizeCanvas);
            update();
        }

        ['order', 'cutoff', 'mode'].forEach(id => {
            document.getElementById(id).addEventListener('input', update);
        });

        window.addEventListener('resize', init);
        init();
    </script>
</body>
</html>
