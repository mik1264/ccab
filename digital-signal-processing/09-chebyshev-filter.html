<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chebyshev Filter - Equiripple Response</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3e 100%);
            color: #00aaff;
            min-height: 100vh;
            padding: 20px;
        }
        .back-link {
            position: fixed; top: 20px; left: 20px;
            color: #00aaff; text-decoration: none;
            padding: 10px 20px; background: rgba(0,170,255,0.1);
            border: 1px solid #00aaff; border-radius: 5px; z-index: 100;
        }
        .back-link:hover { background: rgba(0,170,255,0.2); }
        .container { max-width: 1100px; margin: 60px auto 0; }
        h1 { font-size: 2rem; margin-bottom: 10px; text-align: center; }
        .subtitle { color: #888; margin-bottom: 30px; text-align: center; }
        .main-panel {
            background: rgba(0,0,0,0.5); padding: 25px;
            border-radius: 15px; border: 1px solid #00aaff; margin-bottom: 30px;
        }
        canvas { width: 100%; height: 280px; background: rgba(0,20,40,0.5); border-radius: 10px; }
        .controls {
            display: grid; grid-template-columns: repeat(4, 1fr);
            gap: 20px; margin-top: 20px;
        }
        .control-group label { display: block; color: #888; margin-bottom: 8px; }
        input[type="range"] {
            width: 100%; height: 8px; background: rgba(0,170,255,0.2); border-radius: 4px;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; width: 16px; height: 16px;
            background: #00aaff; border-radius: 50%; cursor: pointer;
        }
        .value { color: #00ffff; font-size: 0.95rem; margin-top: 5px; }
        select {
            width: 100%; padding: 8px; font-family: inherit;
            background: rgba(0,170,255,0.1); border: 1px solid #00aaff;
            color: #00aaff; border-radius: 5px;
        }
        .comparison {
            display: grid; grid-template-columns: 1fr 1fr;
            gap: 20px; margin-bottom: 30px;
        }
        .panel {
            background: rgba(0,0,0,0.5); padding: 20px;
            border-radius: 15px; border: 1px solid #00aaff;
        }
        .panel h3 { color: #00ccff; margin-bottom: 15px; text-align: center; }
        .small-canvas { height: 180px; }
        .info { background: rgba(0,170,255,0.05); padding: 20px; border-radius: 10px; }
        .info h3 { color: #00ccff; margin-bottom: 10px; }
        .info p { color: #aaa; line-height: 1.6; margin-bottom: 10px; }
        @media (max-width: 768px) {
            .controls { grid-template-columns: 1fr 1fr; }
            .comparison { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back</a>
    <div class="container">
        <h1>Chebyshev Filter</h1>
        <p class="subtitle">Equiripple passband or stopband for sharper transitions</p>

        <div class="main-panel">
            <canvas id="mainCanvas"></canvas>
            <div class="controls">
                <div class="control-group">
                    <label>Filter Type</label>
                    <select id="type">
                        <option value="1">Type I (Passband Ripple)</option>
                        <option value="2">Type II (Stopband Ripple)</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Order (n)</label>
                    <input type="range" id="order" min="1" max="8" value="4" step="1">
                    <div class="value" id="orderVal">Order: 4</div>
                </div>
                <div class="control-group">
                    <label>Ripple (ε)</label>
                    <input type="range" id="ripple" min="0.1" max="2" value="0.5" step="0.1">
                    <div class="value" id="rippleVal">ε = 0.5 (1 dB)</div>
                </div>
                <div class="control-group">
                    <label>Cutoff (ωc)</label>
                    <input type="range" id="cutoff" min="0.1" max="0.9" value="0.5" step="0.05">
                    <div class="value" id="cutoffVal">ωc = 0.5π</div>
                </div>
            </div>
        </div>

        <div class="comparison">
            <div class="panel">
                <h3>Chebyshev vs Butterworth (Same Order)</h3>
                <canvas id="compareCanvas" class="small-canvas"></canvas>
            </div>
            <div class="panel">
                <h3>Chebyshev Polynomial T_n(x)</h3>
                <canvas id="polyCanvas" class="small-canvas"></canvas>
            </div>
        </div>

        <div class="info">
            <h3>Chebyshev Filter Properties</h3>
            <p><strong>Type I:</strong> Equiripple in the passband, monotonic in the stopband. Sharper transition than Butterworth for the same order.</p>
            <p><strong>Type II (Inverse):</strong> Monotonic in the passband, equiripple in the stopband. Useful when passband flatness is critical.</p>
            <p><strong>Ripple Parameter (ε):</strong> Controls the amplitude of the ripple. Higher ε = more ripple but sharper transition.</p>
            <p><strong>Trade-off:</strong> Chebyshev achieves sharper cutoff than Butterworth but at the cost of passband ripple. The ripple has exactly n peaks for order n.</p>
        </div>
    </div>

    <script>
        const mainCanvas = document.getElementById('mainCanvas');
        const compareCanvas = document.getElementById('compareCanvas');
        const polyCanvas = document.getElementById('polyCanvas');

        function resizeCanvas(canvas) {
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            canvas.getContext('2d').scale(dpr, dpr);
        }

        function chebyshevPoly(n, x) {
            if (n === 0) return 1;
            if (n === 1) return x;
            if (Math.abs(x) <= 1) return Math.cos(n * Math.acos(x));
            return Math.cosh(n * Math.acosh(Math.abs(x))) * (x >= 0 ? 1 : (n % 2 === 0 ? 1 : -1));
        }

        function chebyshevType1(omega, n, eps, wc) {
            const x = omega / wc;
            if (x <= 1) {
                return 1 / Math.sqrt(1 + eps * eps * Math.pow(chebyshevPoly(n, x), 2));
            } else {
                return 1 / Math.sqrt(1 + eps * eps * Math.pow(chebyshevPoly(n, x), 2));
            }
        }

        function chebyshevType2(omega, n, eps, wc) {
            if (omega < 0.001) return 1;
            const x = wc / omega;
            const Tn = chebyshevPoly(n, x);
            return Math.sqrt(1 / (1 + 1 / (eps * eps * Tn * Tn)));
        }

        function butterworth(omega, n, wc) {
            return 1 / Math.sqrt(1 + Math.pow(omega / wc, 2 * n));
        }

        function drawMainResponse() {
            const ctx = mainCanvas.getContext('2d');
            const w = mainCanvas.width / (window.devicePixelRatio || 1);
            const h = mainCanvas.height / (window.devicePixelRatio || 1);

            const type = parseInt(document.getElementById('type').value);
            const n = parseInt(document.getElementById('order').value);
            const eps = parseFloat(document.getElementById('ripple').value);
            const wc = parseFloat(document.getElementById('cutoff').value);

            ctx.fillStyle = 'rgba(0,20,40,0.5)';
            ctx.fillRect(0, 0, w, h);

            // Grid
            ctx.strokeStyle = 'rgba(0,170,255,0.1)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 10; i++) {
                ctx.beginPath();
                ctx.moveTo(0, h * i / 10);
                ctx.lineTo(w, h * i / 10);
                ctx.stroke();
            }

            // Cutoff line
            ctx.strokeStyle = 'rgba(255,170,0,0.5)';
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(wc * w, 0);
            ctx.lineTo(wc * w, h);
            ctx.stroke();
            ctx.setLineDash([]);

            // Response curve
            ctx.strokeStyle = '#00ffaa';
            ctx.lineWidth = 3;
            ctx.beginPath();
            for (let x = 1; x < w; x++) {
                const omega = x / w;
                let mag = type === 1 ?
                    chebyshevType1(omega, n, eps, wc) :
                    chebyshevType2(omega, n, eps, wc);

                const db = 20 * Math.log10(mag + 1e-10);
                const y = Math.min(h, Math.max(0, (-db / 60) * h));
                if (x === 1) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();

            // Labels
            ctx.fillStyle = '#888';
            ctx.font = '12px Courier New';
            ctx.fillText('0 dB', 5, 15);
            ctx.fillText('-60 dB', 5, h - 5);
            ctx.fillText('0', 5, h - 20);
            ctx.fillText('π', w - 20, h - 20);
        }

        function drawComparison() {
            const ctx = compareCanvas.getContext('2d');
            const w = compareCanvas.width / (window.devicePixelRatio || 1);
            const h = compareCanvas.height / (window.devicePixelRatio || 1);

            const n = parseInt(document.getElementById('order').value);
            const eps = parseFloat(document.getElementById('ripple').value);
            const wc = 0.5;

            ctx.fillStyle = 'rgba(0,20,40,0.5)';
            ctx.fillRect(0, 0, w, h);

            // Chebyshev Type I
            ctx.strokeStyle = '#00ffaa';
            ctx.lineWidth = 2;
            ctx.beginPath();
            for (let x = 1; x < w; x++) {
                const omega = x / w;
                const mag = chebyshevType1(omega, n, eps, wc);
                const db = 20 * Math.log10(mag + 1e-10);
                const y = Math.min(h, Math.max(0, (-db / 60) * h));
                if (x === 1) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();

            // Butterworth
            ctx.strokeStyle = '#ff6688';
            ctx.lineWidth = 2;
            ctx.beginPath();
            for (let x = 1; x < w; x++) {
                const omega = x / w;
                const mag = butterworth(omega, n, wc);
                const db = 20 * Math.log10(mag + 1e-10);
                const y = Math.min(h, Math.max(0, (-db / 60) * h));
                if (x === 1) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();

            // Legend
            ctx.font = '11px Courier New';
            ctx.fillStyle = '#00ffaa';
            ctx.fillText('Chebyshev', w - 80, 20);
            ctx.fillStyle = '#ff6688';
            ctx.fillText('Butterworth', w - 80, 35);
        }

        function drawPolynomial() {
            const ctx = polyCanvas.getContext('2d');
            const w = polyCanvas.width / (window.devicePixelRatio || 1);
            const h = polyCanvas.height / (window.devicePixelRatio || 1);

            const n = parseInt(document.getElementById('order').value);

            ctx.fillStyle = 'rgba(0,20,40,0.5)';
            ctx.fillRect(0, 0, w, h);

            // Axes
            ctx.strokeStyle = 'rgba(0,170,255,0.2)';
            ctx.beginPath();
            ctx.moveTo(0, h / 2);
            ctx.lineTo(w, h / 2);
            ctx.moveTo(w / 2, 0);
            ctx.lineTo(w / 2, h);
            ctx.stroke();

            // Polynomial
            ctx.strokeStyle = '#ffaa00';
            ctx.lineWidth = 2;
            ctx.beginPath();
            for (let px = 0; px < w; px++) {
                const x = (px / w) * 4 - 2; // Range -2 to 2
                let y = chebyshevPoly(n, x);
                y = Math.max(-2, Math.min(2, y)); // Clamp
                const py = h / 2 - (y / 2) * (h / 2);
                if (px === 0) ctx.moveTo(px, py);
                else ctx.lineTo(px, py);
            }
            ctx.stroke();

            // Labels
            ctx.fillStyle = '#888';
            ctx.font = '11px Courier New';
            ctx.fillText(`T_${n}(x)`, 10, 20);
            ctx.fillText('-2', 5, h / 2 + 15);
            ctx.fillText('2', w - 20, h / 2 + 15);
        }

        function update() {
            const n = document.getElementById('order').value;
            const eps = document.getElementById('ripple').value;
            const wc = document.getElementById('cutoff').value;
            const rippleDb = 10 * Math.log10(1 + parseFloat(eps) * parseFloat(eps));

            document.getElementById('orderVal').textContent = `Order: ${n}`;
            document.getElementById('rippleVal').textContent = `ε = ${parseFloat(eps).toFixed(1)} (${rippleDb.toFixed(1)} dB)`;
            document.getElementById('cutoffVal').textContent = `ωc = ${parseFloat(wc).toFixed(2)}π`;

            drawMainResponse();
            drawComparison();
            drawPolynomial();
        }

        function init() {
            [mainCanvas, compareCanvas, polyCanvas].forEach(resizeCanvas);
            update();
        }

        ['type', 'order', 'ripple', 'cutoff'].forEach(id => {
            document.getElementById(id).addEventListener('input', update);
            document.getElementById(id).addEventListener('change', update);
        });

        window.addEventListener('resize', init);
        init();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
