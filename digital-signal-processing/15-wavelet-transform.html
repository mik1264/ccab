<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discrete Wavelet Transform - Multi-Resolution Analysis</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3e 100%);
            color: #00aaff; min-height: 100vh; padding: 20px;
        }
        .back-link {
            position: fixed; top: 20px; left: 20px; color: #00aaff;
            text-decoration: none; padding: 10px 20px;
            background: rgba(0,170,255,0.1); border: 1px solid #00aaff;
            border-radius: 5px; z-index: 100;
        }
        .container { max-width: 1100px; margin: 60px auto 0; }
        h1 { font-size: 2rem; margin-bottom: 10px; text-align: center; }
        .subtitle { color: #888; margin-bottom: 30px; text-align: center; }
        .signal-panel {
            background: rgba(0,0,0,0.5); padding: 20px;
            border-radius: 15px; border: 1px solid #00aaff; margin-bottom: 20px;
        }
        .signal-panel h3 { color: #00ccff; margin-bottom: 15px; text-align: center; }
        canvas { width: 100%; height: 120px; background: rgba(0,20,40,0.5); border-radius: 10px; margin-bottom: 10px; }
        .decomposition {
            display: grid; grid-template-columns: 1fr 1fr;
            gap: 15px; margin-bottom: 20px;
        }
        .level-panel {
            background: rgba(0,0,0,0.5); padding: 15px;
            border-radius: 10px; border: 1px solid #00aaff;
        }
        .level-panel h4 { color: #00ccff; margin-bottom: 10px; font-size: 0.9rem; }
        .level-canvas { height: 80px; }
        .controls {
            display: flex; gap: 15px; justify-content: center;
            margin-bottom: 20px; flex-wrap: wrap;
        }
        button {
            padding: 10px 25px; font-family: inherit;
            background: rgba(0,170,255,0.1); border: 1px solid #00aaff;
            color: #00aaff; border-radius: 5px; cursor: pointer;
        }
        button:hover { background: rgba(0,170,255,0.3); }
        button.active { background: rgba(0,170,255,0.4); border-color: #00ffff; }
        select {
            padding: 10px 20px; font-family: inherit;
            background: rgba(0,170,255,0.1); border: 1px solid #00aaff;
            color: #00aaff; border-radius: 5px;
        }
        .info { background: rgba(0,170,255,0.05); padding: 20px; border-radius: 10px; }
        .info h3 { color: #00ccff; margin-bottom: 10px; }
        .info p { color: #aaa; line-height: 1.6; margin-bottom: 10px; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back</a>
    <div class="container">
        <h1>Discrete Wavelet Transform</h1>
        <p class="subtitle">Multi-resolution analysis - see both time and frequency</p>

        <div class="controls">
            <select id="signal">
                <option value="chirp">Chirp Signal</option>
                <option value="pulse">Pulse Train</option>
                <option value="sine">Multi-Sine</option>
                <option value="step">Step Function</option>
            </select>
            <select id="wavelet">
                <option value="haar">Haar Wavelet</option>
                <option value="db4">Daubechies-4</option>
            </select>
            <button onclick="decompose()">Decompose</button>
            <button onclick="reconstruct()">Reconstruct</button>
        </div>

        <div class="signal-panel">
            <h3>Original Signal</h3>
            <canvas id="signalCanvas"></canvas>
        </div>

        <div class="decomposition">
            <div class="level-panel">
                <h4>Level 1 - Approximation (A1)</h4>
                <canvas id="a1Canvas" class="level-canvas"></canvas>
            </div>
            <div class="level-panel">
                <h4>Level 1 - Detail (D1) [High Freq]</h4>
                <canvas id="d1Canvas" class="level-canvas"></canvas>
            </div>
            <div class="level-panel">
                <h4>Level 2 - Approximation (A2)</h4>
                <canvas id="a2Canvas" class="level-canvas"></canvas>
            </div>
            <div class="level-panel">
                <h4>Level 2 - Detail (D2) [Mid Freq]</h4>
                <canvas id="d2Canvas" class="level-canvas"></canvas>
            </div>
            <div class="level-panel">
                <h4>Level 3 - Approximation (A3)</h4>
                <canvas id="a3Canvas" class="level-canvas"></canvas>
            </div>
            <div class="level-panel">
                <h4>Level 3 - Detail (D3) [Low Freq]</h4>
                <canvas id="d3Canvas" class="level-canvas"></canvas>
            </div>
        </div>

        <div class="signal-panel">
            <h3>Reconstructed Signal</h3>
            <canvas id="reconCanvas"></canvas>
        </div>

        <div class="info">
            <h3>Wavelet vs Fourier Transform</h3>
            <p><strong>Fourier:</strong> Perfect frequency resolution, no time localization. A short burst looks the same as a continuous tone in the spectrum.</p>
            <p><strong>Wavelets:</strong> Trade-off between time and frequency resolution at each scale. Short events are localized in time AND frequency.</p>
            <p><strong>Decomposition:</strong> Low-pass filter → Approximation (A), High-pass filter → Detail (D). Repeat on A for multi-level analysis.</p>
            <p><strong>Applications:</strong> Image compression (JPEG2000), denoising, feature detection, ECG analysis.</p>
        </div>
    </div>

    <script>
        const N = 256;
        let signal = [];
        let approx = [[], [], []];
        let detail = [[], [], []];

        function resizeCanvas(canvas) {
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            canvas.getContext('2d').scale(dpr, dpr);
        }

        function generateSignal(type) {
            const sig = [];
            for (let i = 0; i < N; i++) {
                const t = i / N;
                switch (type) {
                    case 'chirp':
                        sig.push(Math.sin(2 * Math.PI * (5 + 50 * t) * t));
                        break;
                    case 'pulse':
                        sig.push((i % 32 < 8) ? 1 : 0);
                        break;
                    case 'sine':
                        sig.push(Math.sin(2 * Math.PI * 5 * t) +
                                0.5 * Math.sin(2 * Math.PI * 20 * t) +
                                0.25 * Math.sin(2 * Math.PI * 50 * t));
                        break;
                    case 'step':
                        sig.push(i < N/4 ? 0 : i < N/2 ? 1 : i < 3*N/4 ? 0.5 : 0.2);
                        break;
                }
            }
            return sig;
        }

        function haarDecompose(data) {
            const n = data.length;
            const approx = [];
            const detail = [];

            for (let i = 0; i < n; i += 2) {
                approx.push((data[i] + data[i + 1]) / Math.sqrt(2));
                detail.push((data[i] - data[i + 1]) / Math.sqrt(2));
            }

            return { approx, detail };
        }

        function haarReconstruct(approxData, detailData) {
            const n = approxData.length;
            const result = [];

            for (let i = 0; i < n; i++) {
                result.push((approxData[i] + detailData[i]) / Math.sqrt(2));
                result.push((approxData[i] - detailData[i]) / Math.sqrt(2));
            }

            return result;
        }

        function drawSignal(canvas, data, color) {
            const ctx = canvas.getContext('2d');
            const w = canvas.width / (window.devicePixelRatio || 1);
            const h = canvas.height / (window.devicePixelRatio || 1);

            ctx.fillStyle = 'rgba(0,20,40,0.5)';
            ctx.fillRect(0, 0, w, h);

            ctx.strokeStyle = 'rgba(0,170,255,0.2)';
            ctx.beginPath();
            ctx.moveTo(0, h / 2);
            ctx.lineTo(w, h / 2);
            ctx.stroke();

            if (data.length === 0) return;

            const max = Math.max(...data.map(Math.abs), 0.01);

            ctx.strokeStyle = color;
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            for (let i = 0; i < data.length; i++) {
                const x = (i / data.length) * w;
                const y = h / 2 - (data[i] / max) * (h * 0.45);
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
        }

        function decompose() {
            signal = generateSignal(document.getElementById('signal').value);

            // Level 1
            const level1 = haarDecompose(signal);
            approx[0] = level1.approx;
            detail[0] = level1.detail;

            // Level 2
            const level2 = haarDecompose(approx[0]);
            approx[1] = level2.approx;
            detail[1] = level2.detail;

            // Level 3
            const level3 = haarDecompose(approx[1]);
            approx[2] = level3.approx;
            detail[2] = level3.detail;

            drawAll();
        }

        function reconstruct() {
            // Level 3 → 2
            const r2 = haarReconstruct(approx[2], detail[2]);

            // Level 2 → 1
            const r1 = haarReconstruct(r2, detail[1]);

            // Level 1 → signal
            const recon = haarReconstruct(r1, detail[0]);

            drawSignal(document.getElementById('reconCanvas'), recon, '#00ff88');
        }

        function drawAll() {
            drawSignal(document.getElementById('signalCanvas'), signal, '#00aaff');
            drawSignal(document.getElementById('a1Canvas'), approx[0], '#00ccff');
            drawSignal(document.getElementById('d1Canvas'), detail[0], '#ff6688');
            drawSignal(document.getElementById('a2Canvas'), approx[1], '#00ccff');
            drawSignal(document.getElementById('d2Canvas'), detail[1], '#ffaa00');
            drawSignal(document.getElementById('a3Canvas'), approx[2], '#00ccff');
            drawSignal(document.getElementById('d3Canvas'), detail[2], '#aa88ff');
            drawSignal(document.getElementById('reconCanvas'), [], '#00ff88');
        }

        function init() {
            ['signalCanvas', 'a1Canvas', 'd1Canvas', 'a2Canvas', 'd2Canvas',
             'a3Canvas', 'd3Canvas', 'reconCanvas'].forEach(id => {
                resizeCanvas(document.getElementById(id));
            });
            decompose();
        }

        document.getElementById('signal').addEventListener('change', decompose);
        window.addEventListener('resize', init);
        init();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
