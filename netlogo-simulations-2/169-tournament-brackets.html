<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tournament Brackets - CCAB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: #1a1a2e; color: #e8e6e1; overflow: hidden; }
        #container { display: flex; height: 100vh; }
        #canvas-container { flex: 1; position: relative; }
        canvas { display: block; width: 100%; height: 100%; }
        #controls { width: 300px; background: rgba(0,0,0,0.8); padding: 20px; overflow-y: auto; }
        h1 { font-size: 1.2rem; margin-bottom: 15px; color: #22c55e; }
        .control-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.8rem; margin-bottom: 5px; color: #aaa; }
        input[type="range"] { width: 100%; }
        select { width: 100%; padding: 8px; background: #333; color: #fff; border: none; border-radius: 5px; }
        button { width: 100%; padding: 10px; margin-bottom: 10px; background: #22c55e; color: #000; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        button:hover { opacity: 0.9; }
        .stats { background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px; font-size: 0.8rem; margin-bottom: 10px; }
        .back-link { position: fixed; top: 10px; left: 10px; padding: 8px 16px; background: rgba(0,0,0,0.7); color: #22c55e; text-decoration: none; border-radius: 6px; font-size: 14px; z-index: 999; }
        .info { background: rgba(34,197,94,0.1); padding: 10px; border-radius: 5px; font-size: 0.75rem; border-left: 3px solid #22c55e; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Gallery</a>
    <div id="container">
        <div id="canvas-container"><canvas id="canvas"></canvas></div>
        <div id="controls">
            <h1>Tournament Brackets</h1>
            <div class="control-group">
                <label>Teams:</label>
                <select id="teams">
                    <option value="8">8 Teams</option>
                    <option value="16" selected>16 Teams</option>
                    <option value="32">32 Teams</option>
                </select>
            </div>
            <div class="control-group">
                <label>Upset Probability: <span id="upsetValue">0.25</span></label>
                <input type="range" id="upset" min="0" max="0.5" step="0.05" value="0.25">
            </div>
            <div class="control-group">
                <label>Skill Variance: <span id="varianceValue">0.3</span></label>
                <input type="range" id="variance" min="0.1" max="0.5" step="0.05" value="0.3">
            </div>
            <button id="reset">New Tournament</button>
            <button id="step">Play Round</button>
            <button id="simulate">Simulate 100</button>
            <div class="stats">
                <div>Round: <span id="round">0</span></div>
                <div>Games Played: <span id="games">0</span></div>
                <div>Upsets: <span id="upsets">0</span></div>
                <div>Champion: <span id="champion">-</span></div>
            </div>
            <div class="info">
                <strong>Tournament Simulation</strong><br><br>
                ‚Ä¢ Teams seeded by skill level<br>
                ‚Ä¢ Higher seeds favored to win<br>
                ‚Ä¢ Upset = lower seed wins<br>
                ‚Ä¢ Simulate to see win rates<br><br>
                üèÜ Seeds determine matchups
            </div>
        </div>
    </div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        let params = { numTeams: 16, upsetProb: 0.25, skillVariance: 0.3 };
        let teams = [];
        let bracket = [];
        let round = 0;
        let gamesPlayed = 0;
        let upsetCount = 0;
        let champion = null;
        let championStats = {};

        function resize() {
            canvas.width = document.getElementById('canvas-container').clientWidth;
            canvas.height = document.getElementById('canvas-container').clientHeight;
        }

        function generateTeams() {
            teams = [];
            const names = ['Eagles', 'Lions', 'Tigers', 'Bears', 'Wolves', 'Hawks', 'Panthers', 'Sharks',
                          'Dragons', 'Knights', 'Warriors', 'Titans', 'Thunder', 'Storm', 'Blaze', 'Frost',
                          'Vipers', 'Cobras', 'Falcons', 'Ravens', 'Stallions', 'Bulls', 'Rams', 'Hornets',
                          'Wildcats', 'Cougars', 'Jaguars', 'Leopards', 'Grizzlies', 'Badgers', 'Wolverines', 'Huskies'];
            
            for (let i = 0; i < params.numTeams; i++) {
                teams.push({
                    name: names[i],
                    seed: i + 1,
                    skill: 1 - (i / params.numTeams) + (Math.random() - 0.5) * params.skillVariance,
                    eliminated: false,
                    wins: 0
                });
            }
        }

        function initBracket() {
            bracket = [];
            round = 0;
            gamesPlayed = 0;
            upsetCount = 0;
            champion = null;
            
            // Standard seeding (1v16, 8v9, 5v12, 4v13, 6v11, 3v14, 7v10, 2v15)
            const seedOrder = [];
            function fillBracket(size, start = 1) {
                if (size === 1) {
                    seedOrder.push(start);
                    return;
                }
                fillBracket(size / 2, start);
                fillBracket(size / 2, size + 1 - start);
            }
            fillBracket(params.numTeams);
            
            // Create initial round
            const firstRound = [];
            for (let i = 0; i < params.numTeams / 2; i++) {
                firstRound.push({
                    team1: teams[seedOrder[i * 2] - 1],
                    team2: teams[seedOrder[i * 2 + 1] - 1],
                    winner: null,
                    played: false
                });
            }
            bracket.push(firstRound);
        }

        function playGame(game) {
            if (game.played || !game.team1 || !game.team2) return;
            
            const skill1 = game.team1.skill;
            const skill2 = game.team2.skill;
            
            // Higher skill more likely to win, but upsets possible
            const baseProb = skill1 / (skill1 + skill2);
            const winProb = baseProb * (1 - params.upsetProb) + 0.5 * params.upsetProb;
            
            if (Math.random() < winProb) {
                game.winner = game.team1;
                game.team2.eliminated = true;
            } else {
                game.winner = game.team2;
                game.team1.eliminated = true;
            }
            
            game.winner.wins++;
            game.played = true;
            gamesPlayed++;
            
            // Check for upset (lower seed beating higher seed)
            if (game.winner.seed > (game.team1 === game.winner ? game.team2.seed : game.team1.seed)) {
                upsetCount++;
            }
        }

        function playRound() {
            if (champion) return;
            
            const currentRound = bracket[round];
            
            // Play all games in current round
            for (const game of currentRound) {
                playGame(game);
            }
            
            // Check if tournament over
            if (currentRound.length === 1) {
                champion = currentRound[0].winner;
                championStats[champion.seed] = (championStats[champion.seed] || 0) + 1;
                updateStats();
                return;
            }
            
            // Create next round
            const nextRound = [];
            for (let i = 0; i < currentRound.length / 2; i++) {
                nextRound.push({
                    team1: currentRound[i * 2].winner,
                    team2: currentRound[i * 2 + 1].winner,
                    winner: null,
                    played: false
                });
            }
            bracket.push(nextRound);
            round++;
            
            updateStats();
        }

        function simulateTournaments(n) {
            for (let i = 0; i < n; i++) {
                generateTeams();
                initBracket();
                while (!champion) {
                    playRound();
                }
            }
        }

        function updateStats() {
            document.getElementById('round').textContent = round + 1;
            document.getElementById('games').textContent = gamesPlayed;
            document.getElementById('upsets').textContent = upsetCount;
            document.getElementById('champion').textContent = champion ? 
                `#${champion.seed} ${champion.name}` : '-';
        }

        function draw() {
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            const numRounds = Math.log2(params.numTeams);
            const roundWidth = (canvas.width - 350) / (numRounds + 1);
            const matchHeight = 50;
            
            for (let r = 0; r <= round && r < bracket.length; r++) {
                const currentRound = bracket[r];
                const gamesInRound = currentRound.length;
                const totalHeight = gamesInRound * matchHeight * 2;
                const startY = (canvas.height - totalHeight) / 2;
                
                for (let g = 0; g < gamesInRound; g++) {
                    const game = currentRound[g];
                    const x = 30 + r * roundWidth;
                    const y = startY + g * matchHeight * 2 + matchHeight / 2;
                    
                    // Draw match box
                    ctx.fillStyle = '#2a2a4e';
                    ctx.fillRect(x, y, roundWidth - 20, matchHeight);
                    
                    // Draw teams
                    if (game.team1) {
                        ctx.fillStyle = game.winner === game.team1 ? '#22c55e' : 
                                       (game.winner === game.team2 ? '#666' : '#fff');
                        ctx.font = '11px sans-serif';
                        ctx.textAlign = 'left';
                        ctx.fillText(`${game.team1.seed}. ${game.team1.name}`, x + 5, y + 18);
                    }
                    
                    if (game.team2) {
                        ctx.fillStyle = game.winner === game.team2 ? '#22c55e' : 
                                       (game.winner === game.team1 ? '#666' : '#fff');
                        ctx.fillText(`${game.team2.seed}. ${game.team2.name}`, x + 5, y + 38);
                    }
                    
                    // Divider
                    ctx.strokeStyle = '#444';
                    ctx.beginPath();
                    ctx.moveTo(x, y + matchHeight / 2);
                    ctx.lineTo(x + roundWidth - 20, y + matchHeight / 2);
                    ctx.stroke();
                    
                    // Connector lines to next round
                    if (r < bracket.length - 1 || champion) {
                        ctx.strokeStyle = '#444';
                        ctx.beginPath();
                        ctx.moveTo(x + roundWidth - 20, y + matchHeight / 2);
                        ctx.lineTo(x + roundWidth - 10, y + matchHeight / 2);
                        ctx.stroke();
                    }
                }
            }
            
            // Draw champion
            if (champion) {
                const x = 30 + bracket.length * roundWidth;
                const y = canvas.height / 2 - 25;
                
                ctx.fillStyle = '#fbbf24';
                ctx.font = 'bold 16px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('üèÜ CHAMPION üèÜ', x + roundWidth / 2, y);
                
                ctx.fillStyle = '#22c55e';
                ctx.font = 'bold 14px sans-serif';
                ctx.fillText(`#${champion.seed} ${champion.name}`, x + roundWidth / 2, y + 25);
            }
            
            // Draw seed win stats
            if (Object.keys(championStats).length > 0) {
                ctx.fillStyle = '#888';
                ctx.font = '11px sans-serif';
                ctx.textAlign = 'left';
                ctx.fillText('Championship Wins by Seed:', 20, canvas.height - 100);
                
                let sy = canvas.height - 80;
                for (let seed = 1; seed <= Math.min(8, params.numTeams); seed++) {
                    const wins = championStats[seed] || 0;
                    ctx.fillStyle = '#666';
                    ctx.fillText(`#${seed}:`, 20, sy);
                    
                    ctx.fillStyle = '#22c55e';
                    ctx.fillRect(50, sy - 10, wins * 2, 12);
                    ctx.fillStyle = '#888';
                    ctx.fillText(wins.toString(), 55 + wins * 2, sy);
                    
                    sy += 18;
                }
            }
        }

        function animate() {
            draw();
            requestAnimationFrame(animate);
        }

        document.getElementById('teams').addEventListener('change', e => {
            params.numTeams = parseInt(e.target.value);
            championStats = {};
            generateTeams();
            initBracket();
        });

        document.getElementById('upset').addEventListener('input', e => {
            params.upsetProb = parseFloat(e.target.value);
            document.getElementById('upsetValue').textContent = params.upsetProb;
        });

        document.getElementById('variance').addEventListener('input', e => {
            params.skillVariance = parseFloat(e.target.value);
            document.getElementById('varianceValue').textContent = params.skillVariance;
        });

        document.getElementById('reset').addEventListener('click', () => {
            generateTeams();
            initBracket();
            updateStats();
        });

        document.getElementById('step').addEventListener('click', playRound);
        
        document.getElementById('simulate').addEventListener('click', () => {
            simulateTournaments(100);
            generateTeams();
            initBracket();
            updateStats();
        });

        window.addEventListener('resize', resize);

        resize();
        generateTeams();
        initBracket();
        requestAnimationFrame(animate);
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
