<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deep Sea Vents - CCAB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: #0a0a1a; color: #e8e6e1; overflow: hidden; }
        #container { display: flex; height: 100vh; }
        #canvas-container { flex: 1; position: relative; }
        canvas { display: block; width: 100%; height: 100%; }
        #controls { width: 300px; background: rgba(0,0,0,0.8); padding: 20px; overflow-y: auto; }
        h1 { font-size: 1.2rem; margin-bottom: 15px; color: #f97316; }
        .control-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.8rem; margin-bottom: 5px; color: #aaa; }
        input[type="range"] { width: 100%; }
        button { width: 100%; padding: 10px; margin-bottom: 10px; background: #f97316; color: #fff; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        button:hover { background: #ea580c; }
        .stats { background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px; font-size: 0.8rem; margin-bottom: 15px; }
        .back-link { position: fixed; top: 10px; left: 10px; padding: 8px 16px; background: rgba(0,0,0,0.7); color: #f97316; text-decoration: none; border-radius: 6px; font-size: 14px; z-index: 999; }
        .explain-btn { background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); margin-top: 10px; }
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 1000; }
        .modal-overlay.active { display: flex; align-items: center; justify-content: center; }
        .modal { background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%); border-radius: 16px; padding: 30px; max-width: 600px; max-height: 80vh; overflow-y: auto; border: 1px solid rgba(255,255,255,0.1); position: relative; }
        .modal-close { position: absolute; top: 15px; right: 20px; background: none; border: none; color: #888; font-size: 28px; cursor: pointer; width: auto; }
        .modal h2 { color: #f97316; margin-bottom: 20px; }
        .modal-body { color: #ccc; line-height: 1.8; }
        .modal-body h3 { color: #fdba74; margin: 20px 0 10px; }
        .modal-body strong { color: #f97316; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Gallery</a>
    <div id="container">
        <div id="canvas-container"><canvas id="canvas"></canvas></div>
        <div id="controls">
            <h1>Deep Sea Vents</h1>
            <div class="control-group">
                <label>Vent Activity: <span id="activityValue">0.8</span></label>
                <input type="range" id="activity" min="0.1" max="1.0" step="0.1" value="0.8">
            </div>
            <div class="control-group">
                <label>H‚ÇÇS Output: <span id="h2sValue">50</span></label>
                <input type="range" id="h2s" min="10" max="100" value="50">
            </div>
            <div class="control-group">
                <label>Dispersion Rate: <span id="disperseValue">0.05</span></label>
                <input type="range" id="disperse" min="0.01" max="0.15" step="0.01" value="0.05">
            </div>
            <button id="reset">Reset</button>
            <button id="ventDeath">Vent Dies</button>
            <button id="explainBtn" class="explain-btn">üìö Explain</button>
            <div class="stats">
                <div>Bacteria: <span id="bacteria">0</span></div>
                <div>Tube Worms: <span id="worms">0</span></div>
                <div>Crabs/Shrimp: <span id="crabs">0</span></div>
                <div>Fish: <span id="fish">0</span></div>
                <div>Vent Age: <span id="age">0</span> yrs</div>
            </div>
        </div>
    </div>
    <div id="explainModal" class="modal-overlay">
        <div class="modal">
            <button class="modal-close">&times;</button>
            <h2>üåã Hydrothermal Vent Communities</h2>
            <div class="modal-body">
                <p><strong>Hydrothermal vents</strong> are underwater hot springs where superheated, mineral-rich water emerges from the seafloor.</p>
                <h3>Chemosynthesis</h3>
                <ul>
                    <li>No sunlight - bacteria use H‚ÇÇS for energy</li>
                    <li>Primary production via chemosynthesis, not photosynthesis</li>
                    <li>Forms the base of entire food webs</li>
                </ul>
                <h3>Community Succession</h3>
                <ul>
                    <li><strong>Pioneers:</strong> Chemosynthetic bacteria colonize first</li>
                    <li><strong>Tube worms:</strong> Riftia with symbiotic bacteria</li>
                    <li><strong>Grazers:</strong> Crabs, shrimp feeding on bacterial mats</li>
                    <li><strong>Predators:</strong> Fish, octopi at mature vents</li>
                </ul>
                <h3>Vent Lifecycle</h3>
                <p>Vents are ephemeral, lasting 10-100 years. When vents die, communities collapse rapidly. Organisms must disperse to new vents.</p>
            </div>
        </div>
    </div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let params = { activity: 0.8, h2s: 50, disperse: 0.05 };
        let vent, organisms = [], particles = [], time = 0, ventActive = true;
        
        function resize() { canvas.width = document.getElementById('canvas-container').clientWidth; canvas.height = document.getElementById('canvas-container').clientHeight; }
        function init() {
            resize();
            time = 0; ventActive = true;
            vent = { x: canvas.width / 2, y: canvas.height - 100, temp: 350 };
            organisms = [];
            particles = [];
        }
        function ventDeath() {
            ventActive = false;
        }
        function update() {
            time++;
            // Emit particles from vent
            if (ventActive && Math.random() < params.activity) {
                for (let i = 0; i < 3; i++) {
                    particles.push({
                        x: vent.x + (Math.random() - 0.5) * 40,
                        y: vent.y,
                        vx: (Math.random() - 0.5) * 2,
                        vy: -2 - Math.random() * 3,
                        life: 200,
                        h2s: params.h2s / 50
                    });
                }
            }
            // Update particles
            for (let p of particles) {
                p.x += p.vx;
                p.y += p.vy;
                p.vy *= 0.99;
                p.life--;
                p.h2s *= 0.995;
            }
            particles = particles.filter(p => p.life > 0 && p.y > 0);
            // H2S concentration near vent
            const h2sNearVent = ventActive ? params.h2s * params.activity : 0;
            // Population dynamics
            const counts = { bacteria: 0, worms: 0, crabs: 0, fish: 0 };
            for (let o of organisms) counts[o.type]++;
            // Bacteria growth (chemosynthetic)
            if (h2sNearVent > 10 && counts.bacteria < 200) {
                if (Math.random() < 0.1 * (h2sNearVent / 50)) {
                    organisms.push({
                        type: 'bacteria',
                        x: vent.x + (Math.random() - 0.5) * 100,
                        y: vent.y - Math.random() * 50,
                        age: 0
                    });
                }
            }
            // Tube worm growth (need bacteria)
            if (counts.bacteria > 20 && counts.worms < 50 && time > 100) {
                if (Math.random() < 0.02 * (counts.bacteria / 100)) {
                    organisms.push({
                        type: 'worms',
                        x: vent.x + (Math.random() - 0.5) * 120,
                        y: vent.y - 20 - Math.random() * 30,
                        height: 10 + Math.random() * 20,
                        age: 0
                    });
                }
            }
            // Crabs/shrimp (need bacteria mats)
            if (counts.bacteria > 50 && counts.crabs < 30 && time > 200) {
                if (Math.random() < 0.01) {
                    organisms.push({
                        type: 'crabs',
                        x: vent.x + (Math.random() - 0.5) * 150,
                        y: vent.y - 40 - Math.random() * 60,
                        age: 0
                    });
                }
            }
            // Fish (need established community)
            if (counts.worms > 20 && counts.crabs > 10 && counts.fish < 10 && time > 500) {
                if (Math.random() < 0.005) {
                    organisms.push({
                        type: 'fish',
                        x: vent.x + (Math.random() - 0.5) * 200,
                        y: vent.y - 100 - Math.random() * 100,
                        vx: (Math.random() - 0.5) * 2,
                        age: 0
                    });
                }
            }
            // Update organisms
            for (let o of organisms) {
                o.age++;
                if (o.type === 'worms') o.height = Math.min(50, o.height + 0.01);
                if (o.type === 'crabs') {
                    o.x += (Math.random() - 0.5) * 2;
                    o.y += (Math.random() - 0.5);
                    o.x = Math.max(vent.x - 100, Math.min(vent.x + 100, o.x));
                }
                if (o.type === 'fish') {
                    o.x += o.vx;
                    if (o.x < vent.x - 150 || o.x > vent.x + 150) o.vx *= -1;
                }
            }
            // Mortality
            organisms = organisms.filter(o => {
                if (!ventActive) return Math.random() > 0.02; // Die when vent stops
                if (o.type === 'bacteria') return Math.random() > 0.01;
                if (o.type === 'worms') return Math.random() > 0.002;
                return Math.random() > 0.005;
            });
            // Dispersal to find new vents
            organisms = organisms.filter(o => {
                if (!ventActive && Math.random() < params.disperse && o.type !== 'bacteria') {
                    return false; // Dispersed
                }
                return true;
            });
        }
        function draw() {
            // Ocean gradient
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#0a1628');
            gradient.addColorStop(1, '#0f0f1a');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            // Seafloor
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, canvas.height - 60, canvas.width, 60);
            // Vent structure
            ctx.fillStyle = '#4a4a4a';
            ctx.beginPath();
            ctx.moveTo(vent.x - 30, canvas.height - 60);
            ctx.lineTo(vent.x - 20, vent.y);
            ctx.lineTo(vent.x + 20, vent.y);
            ctx.lineTo(vent.x + 30, canvas.height - 60);
            ctx.fill();
            // Vent glow
            if (ventActive) {
                const glowGrad = ctx.createRadialGradient(vent.x, vent.y, 0, vent.x, vent.y, 80);
                glowGrad.addColorStop(0, 'rgba(249, 115, 22, 0.3)');
                glowGrad.addColorStop(1, 'rgba(249, 115, 22, 0)');
                ctx.fillStyle = glowGrad;
                ctx.fillRect(vent.x - 80, vent.y - 80, 160, 160);
            }
            // Particles (hydrothermal plume)
            for (let p of particles) {
                const alpha = p.life / 200;
                ctx.beginPath();
                ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(100, 100, 100, ${alpha * 0.5})`;
                ctx.fill();
            }
            // Organisms
            const counts = { bacteria: 0, worms: 0, crabs: 0, fish: 0 };
            for (let o of organisms) {
                counts[o.type]++;
                if (o.type === 'bacteria') {
                    ctx.beginPath();
                    ctx.arc(o.x, o.y, 2, 0, Math.PI * 2);
                    ctx.fillStyle = '#fde047';
                    ctx.fill();
                } else if (o.type === 'worms') {
                    ctx.strokeStyle = '#dc2626';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(o.x, o.y);
                    ctx.lineTo(o.x, o.y - o.height);
                    ctx.stroke();
                    ctx.beginPath();
                    ctx.arc(o.x, o.y - o.height, 4, 0, Math.PI * 2);
                    ctx.fillStyle = '#fca5a5';
                    ctx.fill();
                } else if (o.type === 'crabs') {
                    ctx.fillStyle = '#fdba74';
                    ctx.fillRect(o.x - 4, o.y - 2, 8, 4);
                    ctx.fillRect(o.x - 6, o.y, 12, 2);
                } else if (o.type === 'fish') {
                    ctx.fillStyle = '#a78bfa';
                    ctx.beginPath();
                    ctx.ellipse(o.x, o.y, 10, 5, 0, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.moveTo(o.x + (o.vx > 0 ? -10 : 10), o.y);
                    ctx.lineTo(o.x + (o.vx > 0 ? -15 : 15), o.y - 5);
                    ctx.lineTo(o.x + (o.vx > 0 ? -15 : 15), o.y + 5);
                    ctx.fill();
                }
            }
            // Status text
            if (!ventActive) {
                ctx.fillStyle = 'rgba(255,0,0,0.5)';
                ctx.font = 'bold 24px sans-serif';
                ctx.fillText('VENT INACTIVE', canvas.width / 2 - 80, 50);
            }
            // Stats
            document.getElementById('bacteria').textContent = counts.bacteria;
            document.getElementById('worms').textContent = counts.worms;
            document.getElementById('crabs').textContent = counts.crabs;
            document.getElementById('fish').textContent = counts.fish;
            document.getElementById('age').textContent = Math.floor(time / 50);
        }
        function animate() { update(); draw(); requestAnimationFrame(animate); }
        document.getElementById('activity').addEventListener('input', e => { params.activity = parseFloat(e.target.value); document.getElementById('activityValue').textContent = params.activity.toFixed(1); });
        document.getElementById('h2s').addEventListener('input', e => { params.h2s = parseInt(e.target.value); document.getElementById('h2sValue').textContent = params.h2s; });
        document.getElementById('disperse').addEventListener('input', e => { params.disperse = parseFloat(e.target.value); document.getElementById('disperseValue').textContent = params.disperse.toFixed(2); });
        document.getElementById('reset').addEventListener('click', init);
        document.getElementById('ventDeath').addEventListener('click', ventDeath);
        window.addEventListener('resize', () => { resize(); });
        const modal = document.getElementById('explainModal');
        document.getElementById('explainBtn').addEventListener('click', () => modal.classList.add('active'));
        modal.querySelector('.modal-close').addEventListener('click', () => modal.classList.remove('active'));
        modal.addEventListener('click', e => { if (e.target === modal) modal.classList.remove('active'); });
        init(); animate();
    </script>
</body>
</html>
