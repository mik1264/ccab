<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Color Harmony - Palette Evolution - CCAB</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600&family=Nunito:wght@400;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Nunito', sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); color: #e8e6e1; overflow: hidden; }
        #container { display: flex; height: 100vh; }
        #canvas-container { flex: 1; position: relative; }
        canvas { display: block; width: 100%; height: 100%; }
        #controls { width: 340px; background: rgba(0,0,0,0.85); padding: 20px; overflow-y: auto; }
        h1 { font-family: 'Lora', serif; font-size: 1.3rem; margin-bottom: 15px; color: #f59e0b; }
        .section-title { font-size: 0.9rem; color: #f59e0b; margin: 15px 0 10px; border-bottom: 1px solid rgba(245,158,11,0.3); padding-bottom: 5px; }
        .control-group { margin-bottom: 12px; }
        label { display: block; font-size: 0.8rem; margin-bottom: 4px; color: #aaa; }
        input[type="range"] { width: 100%; accent-color: #f59e0b; }
        select { width: 100%; padding: 8px; background: #2d2d44; color: #fff; border: 1px solid #444; border-radius: 5px; }
        button { width: 100%; padding: 10px; margin-bottom: 8px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: #fff; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; transition: all 0.2s; }
        button:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(245,158,11,0.3); }
        .btn-secondary { background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); }
        .stats { background: rgba(255,255,255,0.08); padding: 12px; border-radius: 8px; font-size: 0.85rem; margin-top: 15px; }
        .stats div { margin: 5px 0; display: flex; justify-content: space-between; }
        .back-link { position: fixed; top: 10px; left: 10px; padding: 8px 16px; background: rgba(0,0,0,0.7); color: #f59e0b; text-decoration: none; border-radius: 6px; font-size: 14px; z-index: 999; }
        .info-panel { background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%); padding: 15px; border-radius: 10px; margin-top: 15px; border: 1px solid rgba(245,158,11,0.2); }
        .info-panel h3 { font-family: 'Lora', serif; color: #f59e0b; margin-bottom: 10px; font-size: 1rem; }
        .info-panel p { font-size: 0.8rem; line-height: 1.5; color: #ccc; }
        .palette-preview { display: flex; gap: 4px; margin: 10px 0; }
        .palette-swatch { flex: 1; height: 40px; border-radius: 6px; cursor: pointer; transition: transform 0.2s; }
        .palette-swatch:hover { transform: scale(1.1); }
        .base-color { display: flex; align-items: center; gap: 10px; margin: 10px 0; }
        .base-color-preview { width: 50px; height: 50px; border-radius: 8px; border: 2px solid #fff; }
        #colorPicker { width: 100%; height: 40px; border: none; cursor: pointer; border-radius: 5px; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Gallery</a>
    <div id="container">
        <div id="canvas-container"><canvas id="canvas"></canvas></div>
        <div id="controls">
            <h1>Color Harmony</h1>

            <div class="section-title">Base Color</div>
            <div class="base-color">
                <div id="basePreview" class="base-color-preview"></div>
                <input type="color" id="colorPicker" value="#f59e0b">
            </div>
            <div class="control-group">
                <label>Hue: <span id="hueValue">36</span>°</label>
                <input type="range" id="hue" min="0" max="360" step="1" value="36">
            </div>
            <div class="control-group">
                <label>Saturation: <span id="satValue">90</span>%</label>
                <input type="range" id="saturation" min="0" max="100" step="1" value="90">
            </div>
            <div class="control-group">
                <label>Lightness: <span id="lightValue">50</span>%</label>
                <input type="range" id="lightness" min="10" max="90" step="1" value="50">
            </div>

            <div class="section-title">Harmony Type</div>
            <div class="control-group">
                <select id="harmonyType">
                    <option value="complementary">Complementary (180°)</option>
                    <option value="analogous">Analogous (±30°)</option>
                    <option value="triadic">Triadic (120°)</option>
                    <option value="tetradic">Tetradic (90°)</option>
                    <option value="split">Split Complementary</option>
                    <option value="monochromatic">Monochromatic</option>
                </select>
            </div>
            <div class="control-group">
                <label>Variation: <span id="varValue">10</span>%</label>
                <input type="range" id="variation" min="0" max="30" step="1" value="10">
            </div>

            <div class="section-title">Generated Palette</div>
            <div id="palettePreview" class="palette-preview"></div>

            <button id="randomize">Randomize Base</button>
            <button id="export" class="btn-secondary">Copy CSS Variables</button>

            <div class="stats">
                <div><span>Colors:</span><span id="colorCount">5</span></div>
                <div><span>Hue Range:</span><span id="hueRange">0°</span></div>
                <div><span>Contrast Ratio:</span><span id="contrastRatio">-</span></div>
            </div>

            <div class="info-panel">
                <h3>Color Harmony Rules</h3>
                <p><strong>Complementary:</strong> Colors opposite on wheel (high contrast)<br>
                   <strong>Analogous:</strong> Adjacent colors (low contrast, cohesive)<br>
                   <strong>Triadic:</strong> Three colors equally spaced (balanced, vibrant)<br>
                   <strong>Tetradic:</strong> Four colors in rectangle pattern</p>
            </div>
        </div>
    </div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const dpr = window.devicePixelRatio || 1;

        let params = {
            hue: 36,
            saturation: 90,
            lightness: 50,
            harmonyType: 'complementary',
            variation: 10
        };

        let palette = [];

        function resize() {
            const container = document.getElementById('canvas-container');
            canvas.width = container.clientWidth * dpr;
            canvas.height = container.clientHeight * dpr;
            canvas.style.width = container.clientWidth + 'px';
            canvas.style.height = container.clientHeight + 'px';
            ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        }

        // HSL to RGB conversion
        function hslToRgb(h, s, l) {
            h /= 360; s /= 100; l /= 100;
            let r, g, b;

            if (s === 0) {
                r = g = b = l;
            } else {
                const hue2rgb = (p, q, t) => {
                    if (t < 0) t += 1;
                    if (t > 1) t -= 1;
                    if (t < 1/6) return p + (q - p) * 6 * t;
                    if (t < 1/2) return q;
                    if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
                    return p;
                };

                const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                const p = 2 * l - q;
                r = hue2rgb(p, q, h + 1/3);
                g = hue2rgb(p, q, h);
                b = hue2rgb(p, q, h - 1/3);
            }

            return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];
        }

        // RGB to Hex
        function rgbToHex(r, g, b) {
            return '#' + [r, g, b].map(x => x.toString(16).padStart(2, '0')).join('');
        }

        // Calculate relative luminance
        function getLuminance(r, g, b) {
            const [rs, gs, bs] = [r, g, b].map(c => {
                c = c / 255;
                return c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);
            });
            return 0.2126 * rs + 0.7152 * gs + 0.0722 * bs;
        }

        // Calculate contrast ratio
        function getContrastRatio(rgb1, rgb2) {
            const l1 = getLuminance(...rgb1);
            const l2 = getLuminance(...rgb2);
            const lighter = Math.max(l1, l2);
            const darker = Math.min(l1, l2);
            return (lighter + 0.05) / (darker + 0.05);
        }

        // Generate palette based on harmony type
        function generatePalette() {
            const { hue, saturation, lightness, harmonyType, variation } = params;
            palette = [];

            // Base color
            palette.push({ h: hue, s: saturation, l: lightness });

            switch (harmonyType) {
                case 'complementary':
                    palette.push({ h: (hue + 180) % 360, s: saturation, l: lightness });
                    // Add lighter/darker variations
                    palette.push({ h: hue, s: saturation - 20, l: Math.min(90, lightness + 20) });
                    palette.push({ h: (hue + 180) % 360, s: saturation - 20, l: Math.max(20, lightness - 15) });
                    palette.push({ h: hue, s: saturation, l: Math.max(20, lightness - 25) });
                    break;

                case 'analogous':
                    palette.push({ h: (hue - 30 + 360) % 360, s: saturation, l: lightness });
                    palette.push({ h: (hue + 30) % 360, s: saturation, l: lightness });
                    palette.push({ h: (hue - 15 + 360) % 360, s: saturation - 15, l: Math.min(85, lightness + 15) });
                    palette.push({ h: (hue + 15) % 360, s: saturation - 15, l: Math.max(25, lightness - 15) });
                    break;

                case 'triadic':
                    palette.push({ h: (hue + 120) % 360, s: saturation, l: lightness });
                    palette.push({ h: (hue + 240) % 360, s: saturation, l: lightness });
                    palette.push({ h: hue, s: saturation - 20, l: Math.min(85, lightness + 20) });
                    palette.push({ h: (hue + 120) % 360, s: saturation - 20, l: Math.max(25, lightness - 15) });
                    break;

                case 'tetradic':
                    palette.push({ h: (hue + 90) % 360, s: saturation, l: lightness });
                    palette.push({ h: (hue + 180) % 360, s: saturation, l: lightness });
                    palette.push({ h: (hue + 270) % 360, s: saturation, l: lightness });
                    palette.push({ h: hue, s: saturation - 20, l: Math.max(25, lightness - 20) });
                    break;

                case 'split':
                    palette.push({ h: (hue + 150) % 360, s: saturation, l: lightness });
                    palette.push({ h: (hue + 210) % 360, s: saturation, l: lightness });
                    palette.push({ h: hue, s: saturation - 20, l: Math.min(85, lightness + 20) });
                    palette.push({ h: (hue + 180) % 360, s: saturation - 20, l: Math.max(25, lightness - 15) });
                    break;

                case 'monochromatic':
                    palette.push({ h: hue, s: saturation, l: Math.min(90, lightness + 25) });
                    palette.push({ h: hue, s: saturation, l: Math.max(20, lightness - 25) });
                    palette.push({ h: hue, s: Math.max(20, saturation - 30), l: lightness });
                    palette.push({ h: hue, s: saturation, l: Math.max(10, lightness - 40) });
                    break;
            }

            // Apply variation
            if (variation > 0) {
                palette = palette.map((c, i) => {
                    if (i === 0) return c; // Keep base color exact
                    return {
                        h: (c.h + (Math.random() - 0.5) * variation) % 360,
                        s: Math.max(0, Math.min(100, c.s + (Math.random() - 0.5) * variation)),
                        l: Math.max(10, Math.min(90, c.l + (Math.random() - 0.5) * variation * 0.5))
                    };
                });
            }

            updatePalettePreview();
            updateStats();
        }

        // Update palette preview swatches
        function updatePalettePreview() {
            const container = document.getElementById('palettePreview');
            container.innerHTML = '';

            palette.forEach((color, i) => {
                const swatch = document.createElement('div');
                swatch.className = 'palette-swatch';
                swatch.style.background = `hsl(${color.h}, ${color.s}%, ${color.l}%)`;
                swatch.title = `HSL(${Math.round(color.h)}, ${Math.round(color.s)}%, ${Math.round(color.l)}%)`;
                swatch.onclick = () => copyColor(color);
                container.appendChild(swatch);
            });
        }

        // Copy individual color
        function copyColor(color) {
            const rgb = hslToRgb(color.h, color.s, color.l);
            const hex = rgbToHex(...rgb);
            navigator.clipboard.writeText(hex);
        }

        // Export as CSS variables
        function exportPalette() {
            let css = ':root {\n';
            palette.forEach((color, i) => {
                const rgb = hslToRgb(color.h, color.s, color.l);
                const hex = rgbToHex(...rgb);
                css += `  --color-${i + 1}: ${hex};\n`;
            });
            css += '}';
            navigator.clipboard.writeText(css);
            alert('CSS variables copied to clipboard!');
        }

        // Update stats
        function updateStats() {
            document.getElementById('colorCount').textContent = palette.length;

            const hues = palette.map(c => c.h);
            const minHue = Math.min(...hues);
            const maxHue = Math.max(...hues);
            let range = maxHue - minHue;
            if (range > 180) range = 360 - range;
            document.getElementById('hueRange').textContent = Math.round(range) + '°';

            // Calculate contrast between lightest and darkest
            const sorted = [...palette].sort((a, b) => b.l - a.l);
            const lightest = hslToRgb(sorted[0].h, sorted[0].s, sorted[0].l);
            const darkest = hslToRgb(sorted[sorted.length - 1].h, sorted[sorted.length - 1].s, sorted[sorted.length - 1].l);
            const contrast = getContrastRatio(lightest, darkest);
            document.getElementById('contrastRatio').textContent = contrast.toFixed(2) + ':1';
        }

        // Update base color preview
        function updateBasePreview() {
            const preview = document.getElementById('basePreview');
            preview.style.background = `hsl(${params.hue}, ${params.saturation}%, ${params.lightness}%)`;

            // Update color picker
            const rgb = hslToRgb(params.hue, params.saturation, params.lightness);
            document.getElementById('colorPicker').value = rgbToHex(...rgb);
        }

        // Draw visualization
        function draw() {
            const w = canvas.width / dpr;
            const h = canvas.height / dpr;

            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, w, h);

            const centerX = w / 2;
            const centerY = h / 2;
            const radius = Math.min(w, h) * 0.35;

            // Draw color wheel
            for (let angle = 0; angle < 360; angle += 1) {
                const rad = angle * Math.PI / 180;
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, rad, rad + Math.PI / 180 + 0.01);
                ctx.closePath();
                ctx.fillStyle = `hsl(${angle}, ${params.saturation}%, ${params.lightness}%)`;
                ctx.fill();
            }

            // Draw inner circle (current lightness)
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius * 0.3, 0, Math.PI * 2);
            ctx.fillStyle = `hsl(${params.hue}, ${params.saturation}%, ${params.lightness}%)`;
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Draw harmony markers
            palette.forEach((color, i) => {
                const rad = color.h * Math.PI / 180 - Math.PI / 2;
                const markerRadius = radius * 0.85;
                const x = centerX + Math.cos(rad) * markerRadius;
                const y = centerY + Math.sin(rad) * markerRadius;

                // Marker
                ctx.beginPath();
                ctx.arc(x, y, i === 0 ? 18 : 12, 0, Math.PI * 2);
                ctx.fillStyle = `hsl(${color.h}, ${color.s}%, ${color.l}%)`;
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = i === 0 ? 3 : 2;
                ctx.stroke();

                // Connection line to center
                if (i > 0) {
                    ctx.beginPath();
                    ctx.moveTo(centerX, centerY);
                    ctx.lineTo(x, y);
                    ctx.strokeStyle = 'rgba(255,255,255,0.3)';
                    ctx.lineWidth = 1;
                    ctx.stroke();
                }
            });

            // Draw palette bar at bottom
            const barHeight = 80;
            const barY = h - barHeight - 20;
            const swatchWidth = (w - 100) / palette.length;

            palette.forEach((color, i) => {
                const x = 50 + i * swatchWidth;
                ctx.fillStyle = `hsl(${color.h}, ${color.s}%, ${color.l}%)`;
                ctx.fillRect(x, barY, swatchWidth - 10, barHeight);

                // Label
                ctx.fillStyle = color.l > 50 ? '#000' : '#fff';
                ctx.font = '11px Nunito';
                ctx.textAlign = 'center';
                const rgb = hslToRgb(color.h, color.s, color.l);
                ctx.fillText(rgbToHex(...rgb), x + swatchWidth / 2 - 5, barY + barHeight / 2);
            });

            // Title
            ctx.fillStyle = '#f59e0b';
            ctx.font = 'bold 16px Lora';
            ctx.textAlign = 'center';
            ctx.fillText(`${params.harmonyType.charAt(0).toUpperCase() + params.harmonyType.slice(1)} Harmony`, centerX, 30);

            // Harmony description
            ctx.fillStyle = '#888';
            ctx.font = '12px Nunito';
            const descriptions = {
                complementary: 'Opposite colors on the wheel - maximum contrast',
                analogous: 'Adjacent colors - cohesive and harmonious',
                triadic: 'Three equally spaced colors - balanced variety',
                tetradic: 'Four colors in rectangle - rich and complex',
                split: 'Base + two adjacent to complement - softened contrast',
                monochromatic: 'Single hue, varying lightness - elegant and unified'
            };
            ctx.fillText(descriptions[params.harmonyType], centerX, 50);
        }

        function animate() {
            draw();
            requestAnimationFrame(animate);
        }

        // Event listeners
        document.getElementById('hue').addEventListener('input', e => {
            params.hue = parseInt(e.target.value);
            document.getElementById('hueValue').textContent = params.hue;
            updateBasePreview();
            generatePalette();
        });

        document.getElementById('saturation').addEventListener('input', e => {
            params.saturation = parseInt(e.target.value);
            document.getElementById('satValue').textContent = params.saturation;
            updateBasePreview();
            generatePalette();
        });

        document.getElementById('lightness').addEventListener('input', e => {
            params.lightness = parseInt(e.target.value);
            document.getElementById('lightValue').textContent = params.lightness;
            updateBasePreview();
            generatePalette();
        });

        document.getElementById('harmonyType').addEventListener('change', e => {
            params.harmonyType = e.target.value;
            generatePalette();
        });

        document.getElementById('variation').addEventListener('input', e => {
            params.variation = parseInt(e.target.value);
            document.getElementById('varValue').textContent = params.variation;
            generatePalette();
        });

        document.getElementById('colorPicker').addEventListener('input', e => {
            const hex = e.target.value;
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);

            // RGB to HSL
            const max = Math.max(r, g, b) / 255;
            const min = Math.min(r, g, b) / 255;
            let h, s, l = (max + min) / 2;

            if (max === min) {
                h = s = 0;
            } else {
                const d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                switch (max) {
                    case r / 255: h = ((g - b) / 255 / d + (g < b ? 6 : 0)); break;
                    case g / 255: h = ((b - r) / 255 / d + 2); break;
                    case b / 255: h = ((r - g) / 255 / d + 4); break;
                }
                h /= 6;
            }

            params.hue = Math.round(h * 360);
            params.saturation = Math.round(s * 100);
            params.lightness = Math.round(l * 100);

            document.getElementById('hue').value = params.hue;
            document.getElementById('hueValue').textContent = params.hue;
            document.getElementById('saturation').value = params.saturation;
            document.getElementById('satValue').textContent = params.saturation;
            document.getElementById('lightness').value = params.lightness;
            document.getElementById('lightValue').textContent = params.lightness;

            updateBasePreview();
            generatePalette();
        });

        document.getElementById('randomize').addEventListener('click', () => {
            params.hue = Math.floor(Math.random() * 360);
            params.saturation = 50 + Math.floor(Math.random() * 50);
            params.lightness = 35 + Math.floor(Math.random() * 30);

            document.getElementById('hue').value = params.hue;
            document.getElementById('hueValue').textContent = params.hue;
            document.getElementById('saturation').value = params.saturation;
            document.getElementById('satValue').textContent = params.saturation;
            document.getElementById('lightness').value = params.lightness;
            document.getElementById('lightValue').textContent = params.lightness;

            updateBasePreview();
            generatePalette();
        });

        document.getElementById('export').addEventListener('click', exportPalette);

        window.addEventListener('resize', resize);

        // Initialize
        resize();
        updateBasePreview();
        generatePalette();
        animate();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
