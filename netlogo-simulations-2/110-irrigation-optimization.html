<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Irrigation Optimization - Agricultural Simulation</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600&family=Nunito:wght@400;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #FEFAE0 0%, #F4F1DE 50%, #EDE8D5 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 20px; }
        h1 { font-family: 'Lora', serif; color: #606C38; font-size: 2rem; margin-bottom: 8px; }
        .subtitle { color: #8A9A5B; font-size: 1rem; }
        .back-link {
            position: absolute; top: 20px; left: 20px;
            text-decoration: none; color: #606C38; font-weight: 600;
            display: flex; align-items: center; gap: 5px; transition: color 0.3s;
        }
        .back-link:hover { color: #BC6C25; }
        .main-content { display: grid; grid-template-columns: 1fr 300px; gap: 20px; }
        .canvas-container {
            background: white; border-radius: 12px; padding: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        canvas { width: 100%; border-radius: 8px; display: block; }
        .controls {
            background: white; border-radius: 12px; padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08); height: fit-content;
        }
        .control-group { margin-bottom: 18px; }
        .control-group label {
            display: block; color: #606C38; font-weight: 600;
            margin-bottom: 5px; font-size: 0.9rem;
        }
        .control-group input[type="range"] { width: 100%; accent-color: #8A9A5B; }
        .control-value { text-align: right; color: #8A9A5B; font-size: 0.85rem; }
        button {
            width: 100%; padding: 10px; margin-top: 5px; border: none;
            border-radius: 8px; cursor: pointer; font-family: 'Nunito', sans-serif;
            font-weight: 600; font-size: 0.9rem; transition: all 0.3s;
        }
        .btn-primary { background: #8A9A5B; color: white; }
        .btn-primary:hover { background: #606C38; }
        .btn-secondary { background: #DDA15E; color: white; }
        .btn-secondary:hover { background: #BC6C25; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .stat-box {
            background: linear-gradient(135deg, #FEFAE0, #F4F1DE);
            padding: 10px; border-radius: 8px; text-align: center;
        }
        .stat-value { font-family: 'Lora', serif; color: #606C38; font-size: 1.2rem; font-weight: 600; }
        .stat-label { color: #8A9A5B; font-size: 0.75rem; }
        .info-panel {
            margin-top: 15px; padding: 12px; background: #F4F1DE;
            border-radius: 8px; font-size: 0.8rem; color: #606C38;
        }
        select {
            width: 100%; padding: 8px; border: 1px solid #DDA15E;
            border-radius: 6px; font-family: 'Nunito', sans-serif;
            background: white; color: #606C38;
        }
        .scenario-btn { width: 100%; padding: 8px; margin-top: 5px; font-size: 0.8rem; }
        .weather-display {
            display: flex; justify-content: space-around; padding: 10px;
            background: linear-gradient(135deg, #87CEEB, #4682B4);
            border-radius: 8px; margin-bottom: 15px; color: white;
        }
        .weather-item { text-align: center; }
        .weather-value { font-size: 1.1rem; font-weight: 600; }
        .weather-label { font-size: 0.7rem; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Gallery</a>

    <div class="container">
        <header>
            <h1>Irrigation Optimization</h1>
            <p class="subtitle">Soil moisture dynamics, crop water demand, and economic optimization</p>
        </header>

        <div class="main-content">
            <div class="canvas-container">
                <canvas id="simCanvas"></canvas>
            </div>

            <div class="controls">
                <div class="weather-display">
                    <div class="weather-item">
                        <div class="weather-value" id="tempDisplay">25°C</div>
                        <div class="weather-label">Temperature</div>
                    </div>
                    <div class="weather-item">
                        <div class="weather-value" id="rainDisplay">0mm</div>
                        <div class="weather-label">Rainfall</div>
                    </div>
                    <div class="weather-item">
                        <div class="weather-value" id="etDisplay">5mm</div>
                        <div class="weather-label">ET Demand</div>
                    </div>
                </div>

                <div class="control-group">
                    <label>Irrigation Strategy</label>
                    <select id="strategy">
                        <option value="threshold">Threshold-Based (RAW)</option>
                        <option value="deficit">Deficit Irrigation</option>
                        <option value="schedule">Fixed Schedule</option>
                        <option value="optimal" selected>Optimized (MPC)</option>
                        <option value="none">No Irrigation</option>
                    </select>
                </div>

                <div class="control-group">
                    <label>Crop Type</label>
                    <select id="cropType">
                        <option value="corn">Corn (High Demand)</option>
                        <option value="wheat" selected>Wheat (Medium Demand)</option>
                        <option value="sorghum">Sorghum (Drought Tolerant)</option>
                    </select>
                </div>

                <div class="control-group">
                    <label>Soil Water Holding Capacity</label>
                    <input type="range" id="soilCapacity" min="50" max="200" value="120">
                    <div class="control-value"><span id="soilCapacityVal">120</span> mm</div>
                </div>

                <div class="control-group">
                    <label>Water Cost ($/mm)</label>
                    <input type="range" id="waterCost" min="0.5" max="5" step="0.1" value="2">
                    <div class="control-value">$<span id="waterCostVal">2.0</span></div>
                </div>

                <div class="control-group">
                    <label>Deficit Threshold (%)</label>
                    <input type="range" id="deficitThreshold" min="30" max="80" value="50">
                    <div class="control-value"><span id="deficitThresholdVal">50</span>%</div>
                </div>

                <button class="btn-primary" onclick="startSimulation()">Start Season</button>
                <button class="btn-secondary" onclick="resetSimulation()">Reset</button>

                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="yieldVal">0</div>
                        <div class="stat-label">Yield (kg/ha)</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="waterUsed">0</div>
                        <div class="stat-label">Water (mm)</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="waterCostTotal">$0</div>
                        <div class="stat-label">Water Cost</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="netProfit">$0</div>
                        <div class="stat-label">Net Profit</div>
                    </div>
                </div>

                <div class="info-panel">
                    <strong>Model:</strong> AquaCrop-inspired with soil water balance,
                    ET-based crop demand, and economic optimization.
                    RAW = Readily Available Water threshold below which stress occurs.
                </div>

                <div class="control-group" style="margin-top:15px">
                    <label>Scenarios</label>
                    <button class="scenario-btn btn-secondary" onclick="loadPreset('normal')">Normal Season</button>
                    <button class="scenario-btn btn-secondary" onclick="loadPreset('drought')">Drought Year</button>
                    <button class="scenario-btn btn-secondary" onclick="loadPreset('wet')">Wet Season</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');

        function setupCanvas() {
            const rect = canvas.parentElement.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            canvas.width = rect.width * dpr;
            canvas.height = (rect.width * 0.65) * dpr;
            canvas.style.height = (rect.width * 0.65) + 'px';
            ctx.scale(dpr, dpr);
            return { width: rect.width, height: rect.width * 0.65 };
        }

        let dims = setupCanvas();
        window.addEventListener('resize', () => { dims = setupCanvas(); draw(); });

        // Crop parameters
        const cropParams = {
            corn: { kc: [0.3, 0.7, 1.2, 0.6], yieldMax: 12000, pricePerKg: 0.18, stressSensitivity: 0.8 },
            wheat: { kc: [0.4, 0.75, 1.15, 0.4], yieldMax: 8000, pricePerKg: 0.25, stressSensitivity: 0.6 },
            sorghum: { kc: [0.3, 0.55, 1.0, 0.55], yieldMax: 6000, pricePerKg: 0.20, stressSensitivity: 0.4 }
        };

        // Simulation state
        let state = {
            day: 0,
            soilMoisture: 0, // mm
            soilCapacity: 120,
            wilting: 30,
            growthStage: 0,
            biomass: 0,
            maxBiomass: 0,
            stressAccumulated: 0,
            waterUsed: 0,
            irrigationEvents: [],
            moistureHistory: [],
            stressHistory: [],
            etHistory: [],
            rainHistory: [],
            running: false
        };

        const seasonLength = 120; // days
        let weather = [];

        // Generate weather for season
        function generateWeather(type = 'normal') {
            weather = [];
            let rainProb = type === 'drought' ? 0.1 : type === 'wet' ? 0.4 : 0.25;
            let baseTemp = type === 'drought' ? 30 : type === 'wet' ? 22 : 25;

            for (let i = 0; i < seasonLength; i++) {
                const temp = baseTemp + Math.sin(i / 30) * 5 + (Math.random() - 0.5) * 6;
                const rain = Math.random() < rainProb ? Math.random() * (type === 'wet' ? 30 : 20) : 0;
                const et0 = 3 + temp * 0.15 + (Math.random() - 0.5); // Reference ET
                weather.push({ temp, rain, et0 });
            }
        }

        // Initialize simulation
        function initSimulation() {
            const capacity = parseInt(document.getElementById('soilCapacity').value);
            state = {
                day: 0,
                soilMoisture: capacity * 0.7,
                soilCapacity: capacity,
                wilting: capacity * 0.25,
                growthStage: 0,
                biomass: 0,
                maxBiomass: 0,
                stressAccumulated: 0,
                waterUsed: 0,
                irrigationEvents: [],
                moistureHistory: [],
                stressHistory: [],
                etHistory: [],
                rainHistory: [],
                running: false
            };
            generateWeather('normal');
        }

        // Get growth stage (0-3)
        function getGrowthStage(day) {
            if (day < 20) return 0;       // Initial
            if (day < 50) return 1;       // Development
            if (day < 90) return 2;       // Mid-season
            return 3;                      // Late
        }

        // Calculate crop ET
        function getCropET(day, et0, cropType) {
            const stage = getGrowthStage(day);
            const kc = cropParams[cropType].kc[stage];
            return et0 * kc;
        }

        // Decide irrigation based on strategy
        function decideIrrigation(strategy, soilMoisture, capacity, wilting, etCrop) {
            const raw = capacity * 0.5; // Readily available water
            const threshold = parseInt(document.getElementById('deficitThreshold').value) / 100;

            switch(strategy) {
                case 'threshold':
                    if (soilMoisture < capacity * threshold) {
                        return capacity - soilMoisture; // Refill to capacity
                    }
                    return 0;

                case 'deficit':
                    if (soilMoisture < capacity * 0.3) {
                        return capacity * 0.5 - soilMoisture; // Partial refill
                    }
                    return 0;

                case 'schedule':
                    if (state.day % 7 === 0) {
                        return 25; // Fixed 25mm weekly
                    }
                    return 0;

                case 'optimal':
                    // MPC-style: predict next 3 days and optimize
                    let predictedDeficit = 0;
                    for (let i = 0; i < 3 && state.day + i < seasonLength; i++) {
                        const futureET = weather[state.day + i] ?
                            getCropET(state.day + i, weather[state.day + i].et0,
                                document.getElementById('cropType').value) : etCrop;
                        const futureRain = weather[state.day + i] ? weather[state.day + i].rain : 0;
                        predictedDeficit += futureET - futureRain;
                    }
                    const futureMoisture = soilMoisture - predictedDeficit;
                    if (futureMoisture < capacity * threshold) {
                        const needed = capacity * 0.8 - soilMoisture;
                        return Math.max(0, needed);
                    }
                    return 0;

                case 'none':
                default:
                    return 0;
            }
        }

        // Update simulation
        function update() {
            if (!state.running || state.day >= seasonLength) {
                state.running = false;
                calculateFinalYield();
                return;
            }

            const cropType = document.getElementById('cropType').value;
            const strategy = document.getElementById('strategy').value;
            const w = weather[state.day];

            // Calculate crop ET
            const etCrop = getCropET(state.day, w.et0, cropType);

            // Decide irrigation
            const irrigation = decideIrrigation(strategy, state.soilMoisture,
                state.soilCapacity, state.wilting, etCrop);

            if (irrigation > 0) {
                state.irrigationEvents.push({ day: state.day, amount: irrigation });
                state.waterUsed += irrigation;
            }

            // Update soil moisture
            state.soilMoisture += w.rain + irrigation - etCrop;
            state.soilMoisture = Math.max(0, Math.min(state.soilCapacity, state.soilMoisture));

            // Calculate water stress
            const stressThreshold = state.soilCapacity * 0.4;
            let stress = 0;
            if (state.soilMoisture < stressThreshold) {
                stress = 1 - (state.soilMoisture / stressThreshold);
            }
            state.stressAccumulated += stress * cropParams[cropType].stressSensitivity;

            // Biomass accumulation
            const growthRate = 1 - stress * 0.8;
            state.biomass += growthRate * 100;
            state.maxBiomass = Math.max(state.maxBiomass, state.biomass);

            // Update growth stage
            state.growthStage = getGrowthStage(state.day);

            // Record history
            state.moistureHistory.push(state.soilMoisture);
            state.stressHistory.push(stress);
            state.etHistory.push(etCrop);
            state.rainHistory.push(w.rain);

            // Update weather display
            document.getElementById('tempDisplay').textContent = w.temp.toFixed(0) + '°C';
            document.getElementById('rainDisplay').textContent = w.rain.toFixed(1) + 'mm';
            document.getElementById('etDisplay').textContent = etCrop.toFixed(1) + 'mm';

            state.day++;
            draw();

            setTimeout(update, 50);
        }

        // Calculate final yield
        function calculateFinalYield() {
            const cropType = document.getElementById('cropType').value;
            const crop = cropParams[cropType];
            const waterCost = parseFloat(document.getElementById('waterCost').value);

            // Yield affected by accumulated stress
            const stressFactor = Math.max(0, 1 - state.stressAccumulated / 100);
            const yield_ = crop.yieldMax * stressFactor;

            // Economics
            const revenue = yield_ * crop.pricePerKg;
            const waterExpense = state.waterUsed * waterCost;
            const netProfit = revenue - waterExpense;

            document.getElementById('yieldVal').textContent = yield_.toFixed(0);
            document.getElementById('waterUsed').textContent = state.waterUsed.toFixed(0);
            document.getElementById('waterCostTotal').textContent = '$' + waterExpense.toFixed(0);
            document.getElementById('netProfit').textContent = '$' + netProfit.toFixed(0);
        }

        // Draw visualization
        function draw() {
            ctx.clearRect(0, 0, dims.width, dims.height);

            const fieldX = 20, fieldY = 40;
            const fieldW = dims.width * 0.4, fieldH = dims.height * 0.5;

            // Draw soil profile
            drawSoilProfile(fieldX, fieldY, fieldW, fieldH);

            // Draw plant
            drawPlant(fieldX + fieldW / 2, fieldY + fieldH,
                state.biomass / 12000, state.stressHistory[state.stressHistory.length - 1] || 0);

            // Draw charts
            const chartX = dims.width * 0.5;
            const chartW = dims.width * 0.45;
            const chartH = 70;

            drawMoistureChart(chartX, 40, chartW, chartH);
            drawStressChart(chartX, 130, chartW, chartH);
            drawWaterBalance(chartX, 220, chartW, chartH);

            // Draw irrigation events
            drawIrrigationMarkers(chartX, 40, chartW, chartH);

            // Title
            ctx.fillStyle = '#606C38';
            ctx.font = '14px Lora';
            ctx.fillText(`Day ${state.day}/${seasonLength} | Growth Stage: ${['Initial', 'Development', 'Mid-season', 'Late'][state.growthStage]}`, 20, 25);
        }

        // Draw soil profile
        function drawSoilProfile(x, y, w, h) {
            const moistureRatio = state.soilMoisture / state.soilCapacity;

            // Dry soil background
            ctx.fillStyle = '#D2B48C';
            ctx.fillRect(x, y, w, h);

            // Moist soil layer
            const moistHeight = h * moistureRatio;
            const gradient = ctx.createLinearGradient(x, y + h - moistHeight, x, y + h);
            gradient.addColorStop(0, '#8B7355');
            gradient.addColorStop(1, '#5C4033');
            ctx.fillStyle = gradient;
            ctx.fillRect(x, y + h - moistHeight, w, moistHeight);

            // Wilting point line
            ctx.strokeStyle = '#FF6347';
            ctx.setLineDash([5, 5]);
            const wiltY = y + h * (1 - state.wilting / state.soilCapacity);
            ctx.beginPath();
            ctx.moveTo(x, wiltY);
            ctx.lineTo(x + w, wiltY);
            ctx.stroke();

            // RAW threshold
            ctx.strokeStyle = '#FFD700';
            const rawY = y + h * 0.5;
            ctx.beginPath();
            ctx.moveTo(x, rawY);
            ctx.lineTo(x + w, rawY);
            ctx.stroke();
            ctx.setLineDash([]);

            // Border
            ctx.strokeStyle = '#606C38';
            ctx.strokeRect(x, y, w, h);

            // Labels
            ctx.fillStyle = '#606C38';
            ctx.font = '10px Nunito';
            ctx.fillText('Soil Moisture', x + 5, y + 15);
            ctx.fillText(`${state.soilMoisture.toFixed(0)}/${state.soilCapacity}mm`, x + 5, y + 28);
            ctx.fillStyle = '#FF6347';
            ctx.fillText('Wilting Pt', x + w + 5, wiltY + 3);
            ctx.fillStyle = '#DAA520';
            ctx.fillText('RAW', x + w + 5, rawY + 3);
        }

        // Draw plant
        function drawPlant(x, y, growth, stress) {
            const height = 60 + growth * 100;
            const greenness = Math.floor(139 - stress * 80);

            // Stem
            ctx.strokeStyle = `rgb(60, ${greenness}, 40)`;
            ctx.lineWidth = 3 + growth * 4;
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(x, y - height);
            ctx.stroke();

            // Leaves
            ctx.fillStyle = `rgb(80, ${greenness}, 50)`;
            const leafCount = Math.floor(3 + growth * 5);
            for (let i = 0; i < leafCount; i++) {
                const leafY = y - height * 0.3 - i * (height * 0.15);
                const leafSize = 15 + growth * 20 - i * 3;
                const side = i % 2 === 0 ? 1 : -1;

                ctx.beginPath();
                ctx.ellipse(x + side * leafSize * 0.5, leafY, leafSize, leafSize * 0.3,
                    side * 0.3, 0, Math.PI * 2);
                ctx.fill();
            }

            // Top (grain for wheat/corn)
            if (growth > 0.5) {
                ctx.fillStyle = '#DAA520';
                ctx.beginPath();
                ctx.ellipse(x, y - height - 10, 8 + growth * 10, 15 + growth * 20, 0, 0, Math.PI * 2);
                ctx.fill();
            }

            ctx.lineWidth = 1;
        }

        // Draw moisture chart
        function drawMoistureChart(x, y, w, h) {
            ctx.fillStyle = 'rgba(255,255,255,0.8)';
            ctx.fillRect(x, y, w, h);
            ctx.strokeStyle = '#ddd';
            ctx.strokeRect(x, y, w, h);

            ctx.fillStyle = '#606C38';
            ctx.font = '11px Nunito';
            ctx.fillText('Soil Moisture (mm)', x + 5, y - 5);

            if (state.moistureHistory.length < 2) return;

            const maxVal = state.soilCapacity;
            const step = w / Math.max(state.moistureHistory.length - 1, 1);

            // Fill area
            ctx.beginPath();
            ctx.fillStyle = 'rgba(70, 130, 180, 0.3)';
            ctx.moveTo(x, y + h);
            state.moistureHistory.forEach((val, i) => {
                const px = x + i * step;
                const py = y + h - (val / maxVal) * h;
                ctx.lineTo(px, py);
            });
            ctx.lineTo(x + (state.moistureHistory.length - 1) * step, y + h);
            ctx.closePath();
            ctx.fill();

            // Line
            ctx.beginPath();
            ctx.strokeStyle = '#4682B4';
            ctx.lineWidth = 2;
            state.moistureHistory.forEach((val, i) => {
                const px = x + i * step;
                const py = y + h - (val / maxVal) * h;
                if (i === 0) ctx.moveTo(px, py);
                else ctx.lineTo(px, py);
            });
            ctx.stroke();
            ctx.lineWidth = 1;
        }

        // Draw stress chart
        function drawStressChart(x, y, w, h) {
            ctx.fillStyle = 'rgba(255,255,255,0.8)';
            ctx.fillRect(x, y, w, h);
            ctx.strokeStyle = '#ddd';
            ctx.strokeRect(x, y, w, h);

            ctx.fillStyle = '#606C38';
            ctx.font = '11px Nunito';
            ctx.fillText('Water Stress', x + 5, y - 5);

            if (state.stressHistory.length < 2) return;

            const step = w / Math.max(state.stressHistory.length - 1, 1);

            ctx.beginPath();
            ctx.strokeStyle = '#FF6347';
            ctx.lineWidth = 2;
            state.stressHistory.forEach((val, i) => {
                const px = x + i * step;
                const py = y + h - val * h;
                if (i === 0) ctx.moveTo(px, py);
                else ctx.lineTo(px, py);
            });
            ctx.stroke();
            ctx.lineWidth = 1;
        }

        // Draw water balance
        function drawWaterBalance(x, y, w, h) {
            ctx.fillStyle = 'rgba(255,255,255,0.8)';
            ctx.fillRect(x, y, w, h);
            ctx.strokeStyle = '#ddd';
            ctx.strokeRect(x, y, w, h);

            ctx.fillStyle = '#606C38';
            ctx.font = '11px Nunito';
            ctx.fillText('Daily Rain & ET (mm)', x + 5, y - 5);

            if (state.rainHistory.length < 2) return;

            const maxVal = Math.max(...state.rainHistory, ...state.etHistory, 10);
            const step = w / Math.max(state.rainHistory.length - 1, 1);

            // Rain bars
            ctx.fillStyle = 'rgba(70, 130, 180, 0.6)';
            state.rainHistory.forEach((val, i) => {
                if (val > 0) {
                    const px = x + i * step;
                    const barH = (val / maxVal) * h;
                    ctx.fillRect(px - 1, y + h - barH, 2, barH);
                }
            });

            // ET line
            ctx.beginPath();
            ctx.strokeStyle = '#FF8C00';
            ctx.lineWidth = 1.5;
            state.etHistory.forEach((val, i) => {
                const px = x + i * step;
                const py = y + h - (val / maxVal) * h;
                if (i === 0) ctx.moveTo(px, py);
                else ctx.lineTo(px, py);
            });
            ctx.stroke();
            ctx.lineWidth = 1;
        }

        // Draw irrigation markers
        function drawIrrigationMarkers(x, y, w, h) {
            const step = w / seasonLength;
            ctx.fillStyle = '#228B22';
            state.irrigationEvents.forEach(event => {
                const px = x + event.day * step;
                ctx.beginPath();
                ctx.moveTo(px, y);
                ctx.lineTo(px - 4, y - 8);
                ctx.lineTo(px + 4, y - 8);
                ctx.closePath();
                ctx.fill();
            });
        }

        // Controls
        function startSimulation() {
            if (!state.running) {
                state.running = true;
                update();
            }
        }

        function resetSimulation() {
            initSimulation();
            draw();
            document.getElementById('yieldVal').textContent = '0';
            document.getElementById('waterUsed').textContent = '0';
            document.getElementById('waterCostTotal').textContent = '$0';
            document.getElementById('netProfit').textContent = '$0';
        }

        function loadPreset(name) {
            resetSimulation();
            if (name === 'drought') {
                generateWeather('drought');
                document.getElementById('deficitThreshold').value = 60;
            } else if (name === 'wet') {
                generateWeather('wet');
                document.getElementById('deficitThreshold').value = 40;
            } else {
                generateWeather('normal');
            }
            updateSliderDisplays();
            draw();
        }

        function updateSliderDisplays() {
            document.getElementById('soilCapacityVal').textContent = document.getElementById('soilCapacity').value;
            document.getElementById('waterCostVal').textContent = document.getElementById('waterCost').value;
            document.getElementById('deficitThresholdVal').textContent = document.getElementById('deficitThreshold').value;
        }

        document.querySelectorAll('input[type="range"]').forEach(slider => {
            slider.addEventListener('input', updateSliderDisplays);
        });

        // Initialize
        initSimulation();
        draw();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
