<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waste Management - Material Flow Simulation</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600&family=Nunito:wght@400;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Nunito', sans-serif; background: linear-gradient(135deg, #FEFAE0 0%, #F4F1DE 50%, #EDE8D5 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 20px; }
        h1 { font-family: 'Lora', serif; color: #606C38; font-size: 2rem; margin-bottom: 8px; }
        .subtitle { color: #8A9A5B; font-size: 1rem; }
        .back-link { position: absolute; top: 20px; left: 20px; text-decoration: none; color: #606C38; font-weight: 600; }
        .main-content { display: grid; grid-template-columns: 1fr 300px; gap: 20px; }
        .canvas-container { background: white; border-radius: 12px; padding: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        canvas { width: 100%; border-radius: 8px; display: block; }
        .controls { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); height: fit-content; }
        .control-group { margin-bottom: 18px; }
        .control-group label { display: block; color: #606C38; font-weight: 600; margin-bottom: 5px; font-size: 0.9rem; }
        .control-group input[type="range"] { width: 100%; accent-color: #8A9A5B; }
        .control-value { text-align: right; color: #8A9A5B; font-size: 0.85rem; }
        button { width: 100%; padding: 10px; margin-top: 5px; border: none; border-radius: 8px; cursor: pointer; font-family: 'Nunito', sans-serif; font-weight: 600; font-size: 0.9rem; transition: all 0.3s; }
        .btn-primary { background: #8A9A5B; color: white; }
        .btn-secondary { background: #DDA15E; color: white; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .stat-box { background: linear-gradient(135deg, #FEFAE0, #F4F1DE); padding: 10px; border-radius: 8px; text-align: center; }
        .stat-value { font-family: 'Lora', serif; color: #606C38; font-size: 1.1rem; font-weight: 600; }
        .stat-label { color: #8A9A5B; font-size: 0.75rem; }
        .info-panel { margin-top: 15px; padding: 12px; background: #F4F1DE; border-radius: 8px; font-size: 0.8rem; color: #606C38; }
        .legend { display: grid; grid-template-columns: repeat(2, 1fr); gap: 5px; margin-top: 10px; font-size: 0.75rem; }
        .legend-item { display: flex; align-items: center; gap: 4px; }
        .legend-color { width: 12px; height: 12px; border-radius: 2px; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Gallery</a>
    <div class="container">
        <header>
            <h1>Municipal Waste Management</h1>
            <p class="subtitle">Recycling, composting, landfill, and incineration pathways</p>
        </header>
        <div class="main-content">
            <div class="canvas-container">
                <canvas id="simCanvas"></canvas>
            </div>
            <div class="controls">
                <div class="control-group">
                    <label>Recycling Rate (%)</label>
                    <input type="range" id="recyclingRate" min="0" max="60" value="30">
                    <div class="control-value"><span id="recyclingRateVal">30</span>%</div>
                </div>
                <div class="control-group">
                    <label>Composting Rate (%)</label>
                    <input type="range" id="compostRate" min="0" max="40" value="15">
                    <div class="control-value"><span id="compostRateVal">15</span>%</div>
                </div>
                <div class="control-group">
                    <label>Incineration Rate (%)</label>
                    <input type="range" id="incinerationRate" min="0" max="50" value="20">
                    <div class="control-value"><span id="incinerationRateVal">20</span>%</div>
                </div>
                <div class="control-group">
                    <label>Waste Generation (t/day)</label>
                    <input type="range" id="wasteGen" min="100" max="1000" value="500">
                    <div class="control-value"><span id="wasteGenVal">500</span></div>
                </div>
                <button class="btn-primary" onclick="startSimulation()">Simulate Year</button>
                <button class="btn-secondary" onclick="resetSimulation()">Reset</button>
                <div class="stats-grid">
                    <div class="stat-box"><div class="stat-value" id="totalProcessed">0</div><div class="stat-label">Processed (kt)</div></div>
                    <div class="stat-box"><div class="stat-value" id="landfillUsed">0</div><div class="stat-label">Landfilled (kt)</div></div>
                    <div class="stat-box"><div class="stat-value" id="diversionRate">0%</div><div class="stat-label">Diversion Rate</div></div>
                    <div class="stat-box"><div class="stat-value" id="emissions">0</div><div class="stat-label">GHG (kt CO‚ÇÇe)</div></div>
                </div>
                <div class="legend">
                    <div class="legend-item"><div class="legend-color" style="background:#4CAF50"></div>Recycling</div>
                    <div class="legend-item"><div class="legend-color" style="background:#8B4513"></div>Composting</div>
                    <div class="legend-item"><div class="legend-color" style="background:#FF5722"></div>Incineration</div>
                    <div class="legend-item"><div class="legend-color" style="background:#9E9E9E"></div>Landfill</div>
                </div>
                <div class="info-panel">
                    <strong>Waste Hierarchy:</strong> Reduce ‚Üí Reuse ‚Üí Recycle ‚Üí Recover ‚Üí Dispose. Higher diversion = lower GHG emissions.
                </div>
            </div>
        </div>
    </div>
    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        function setupCanvas() {
            const rect = canvas.parentElement.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            canvas.width = rect.width * dpr;
            canvas.height = (rect.width * 0.6) * dpr;
            canvas.style.height = (rect.width * 0.6) + 'px';
            ctx.scale(dpr, dpr);
            return { width: rect.width, height: rect.width * 0.6 };
        }
        let dims = setupCanvas();
        window.addEventListener('resize', () => { dims = setupCanvas(); draw(); });

        let state = { day: 0, running: false, recycled: 0, composted: 0, incinerated: 0, landfilled: 0, particles: [], flowHistory: [] };

        function update() {
            if (!state.running || state.day >= 365) { state.running = false; return; }

            const recycling = parseInt(document.getElementById('recyclingRate').value) / 100;
            const compost = parseInt(document.getElementById('compostRate').value) / 100;
            const incineration = parseInt(document.getElementById('incinerationRate').value) / 100;
            const wasteGen = parseInt(document.getElementById('wasteGen').value);

            const landfillRate = Math.max(0, 1 - recycling - compost - incineration);

            const dailyRecycled = wasteGen * recycling;
            const dailyCompost = wasteGen * compost;
            const dailyIncinerated = wasteGen * incineration;
            const dailyLandfill = wasteGen * landfillRate;

            state.recycled += dailyRecycled;
            state.composted += dailyCompost;
            state.incinerated += dailyIncinerated;
            state.landfilled += dailyLandfill;

            // Add particles
            if (state.day % 3 === 0) {
                for (let i = 0; i < 8; i++) {
                    const rand = Math.random();
                    let type, color;
                    if (rand < recycling) { type = 'recycle'; color = '#4CAF50'; }
                    else if (rand < recycling + compost) { type = 'compost'; color = '#8B4513'; }
                    else if (rand < recycling + compost + incineration) { type = 'incinerate'; color = '#FF5722'; }
                    else { type = 'landfill'; color = '#9E9E9E'; }

                    state.particles.push({
                        x: dims.width * 0.15,
                        y: dims.height * 0.45 + (Math.random() - 0.5) * 20,
                        type, color, phase: 0
                    });
                }
            }

            // Update particles
            state.particles = state.particles.filter(p => p.phase < 100);
            state.particles.forEach(p => {
                p.phase++;
                const progress = p.phase / 100;
                const targets = {
                    recycle: { x: dims.width * 0.45, y: dims.height * 0.2 },
                    compost: { x: dims.width * 0.45, y: dims.height * 0.4 },
                    incinerate: { x: dims.width * 0.45, y: dims.height * 0.6 },
                    landfill: { x: dims.width * 0.45, y: dims.height * 0.8 }
                };
                const t = targets[p.type];
                p.x = dims.width * 0.15 + (t.x - dims.width * 0.15) * progress;
                p.y = dims.height * 0.45 + (t.y - dims.height * 0.45) * progress;
            });

            state.flowHistory.push({ r: state.recycled, c: state.composted, i: state.incinerated, l: state.landfilled });

            // Update stats
            const total = state.recycled + state.composted + state.incinerated + state.landfilled;
            const diverted = state.recycled + state.composted + state.incinerated * 0.5;
            const diversion = total > 0 ? (diverted / total) * 100 : 0;
            const emissions = state.landfilled * 0.5 + state.incinerated * 0.3 - state.recycled * 0.2;

            document.getElementById('totalProcessed').textContent = (total / 1000).toFixed(1);
            document.getElementById('landfillUsed').textContent = (state.landfilled / 1000).toFixed(1);
            document.getElementById('diversionRate').textContent = diversion.toFixed(0) + '%';
            document.getElementById('emissions').textContent = (emissions / 1000).toFixed(1);

            state.day++;
            draw();
            setTimeout(update, 30);
        }

        function draw() {
            ctx.clearRect(0, 0, dims.width, dims.height);

            // Sankey-style flow diagram
            const flows = [
                { name: '‚ôªÔ∏è Recycling', y: dims.height * 0.2, color: '#4CAF50', value: state.recycled },
                { name: 'üå± Composting', y: dims.height * 0.4, color: '#8B4513', value: state.composted },
                { name: 'üî• Incineration', y: dims.height * 0.6, color: '#FF5722', value: state.incinerated },
                { name: 'üóëÔ∏è Landfill', y: dims.height * 0.8, color: '#9E9E9E', value: state.landfilled }
            ];

            // Source node
            ctx.fillStyle = '#666';
            ctx.beginPath();
            ctx.arc(dims.width * 0.15, dims.height * 0.45, 30, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = 'white';
            ctx.font = '10px Nunito';
            ctx.textAlign = 'center';
            ctx.fillText('Waste', dims.width * 0.15, dims.height * 0.43);
            ctx.fillText('Input', dims.width * 0.15, dims.height * 0.48);

            // Flow paths and destinations
            const total = flows.reduce((s, f) => s + f.value, 0) || 1;
            flows.forEach(f => {
                const width = Math.max(2, (f.value / total) * 30);

                // Flow path
                ctx.strokeStyle = f.color + '80';
                ctx.lineWidth = width;
                ctx.beginPath();
                ctx.moveTo(dims.width * 0.18, dims.height * 0.45);
                ctx.quadraticCurveTo(dims.width * 0.3, f.y, dims.width * 0.4, f.y);
                ctx.stroke();

                // Destination box
                ctx.fillStyle = f.color;
                ctx.fillRect(dims.width * 0.42, f.y - 20, 100, 40);

                ctx.fillStyle = 'white';
                ctx.font = '11px Nunito';
                ctx.fillText(f.name, dims.width * 0.47, f.y - 5);
                ctx.font = '10px Nunito';
                ctx.fillText((f.value / 1000).toFixed(1) + ' kt', dims.width * 0.47, f.y + 10);
            });
            ctx.lineWidth = 1;
            ctx.textAlign = 'left';

            // Particles
            state.particles.forEach(p => {
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
                ctx.fill();
            });

            // Pie chart
            const chartX = dims.width * 0.75, chartY = dims.height * 0.4, chartR = 60;
            let angle = -Math.PI / 2;
            flows.forEach(f => {
                const slice = (f.value / total) * Math.PI * 2;
                ctx.beginPath();
                ctx.moveTo(chartX, chartY);
                ctx.arc(chartX, chartY, chartR, angle, angle + slice);
                ctx.fillStyle = f.color;
                ctx.fill();
                angle += slice;
            });
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(chartX, chartY, chartR * 0.5, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#606C38';
            ctx.font = '12px Nunito';
            ctx.textAlign = 'center';
            ctx.fillText('Day ' + state.day, chartX, chartY + 5);
            ctx.textAlign = 'left';

            // Title
            ctx.fillStyle = '#606C38';
            ctx.font = '14px Lora';
            ctx.fillText(`Waste Management | Year Progress: ${(state.day / 365 * 100).toFixed(0)}%`, 30, 25);
        }

        function startSimulation() {
            if (!state.running) { state.running = true; update(); }
        }

        function resetSimulation() {
            state = { day: 0, running: false, recycled: 0, composted: 0, incinerated: 0, landfilled: 0, particles: [], flowHistory: [] };
            draw();
        }

        function updateSliderDisplays() {
            document.getElementById('recyclingRateVal').textContent = document.getElementById('recyclingRate').value;
            document.getElementById('compostRateVal').textContent = document.getElementById('compostRate').value;
            document.getElementById('incinerationRateVal').textContent = document.getElementById('incinerationRate').value;
            document.getElementById('wasteGenVal').textContent = document.getElementById('wasteGen').value;
        }

        document.querySelectorAll('input[type="range"]').forEach(s => s.addEventListener('input', updateSliderDisplays));
        draw();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
