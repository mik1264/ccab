<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carbon Sequestration - CCS Simulation</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600&family=Nunito:wght@400;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Nunito', sans-serif; background: linear-gradient(135deg, #FEFAE0 0%, #F4F1DE 50%, #EDE8D5 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 20px; }
        h1 { font-family: 'Lora', serif; color: #606C38; font-size: 2rem; margin-bottom: 8px; }
        .subtitle { color: #8A9A5B; font-size: 1rem; }
        .back-link { position: absolute; top: 20px; left: 20px; text-decoration: none; color: #606C38; font-weight: 600; }
        .main-content { display: grid; grid-template-columns: 1fr 300px; gap: 20px; }
        .canvas-container { background: white; border-radius: 12px; padding: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        canvas { width: 100%; border-radius: 8px; display: block; }
        .controls { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); height: fit-content; }
        .control-group { margin-bottom: 18px; }
        .control-group label { display: block; color: #606C38; font-weight: 600; margin-bottom: 5px; font-size: 0.9rem; }
        .control-group input[type="range"] { width: 100%; accent-color: #8A9A5B; }
        .control-value { text-align: right; color: #8A9A5B; font-size: 0.85rem; }
        button { width: 100%; padding: 10px; margin-top: 5px; border: none; border-radius: 8px; cursor: pointer; font-family: 'Nunito', sans-serif; font-weight: 600; font-size: 0.9rem; transition: all 0.3s; }
        .btn-primary { background: #8A9A5B; color: white; }
        .btn-secondary { background: #DDA15E; color: white; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .stat-box { background: linear-gradient(135deg, #FEFAE0, #F4F1DE); padding: 10px; border-radius: 8px; text-align: center; }
        .stat-value { font-family: 'Lora', serif; color: #606C38; font-size: 1.1rem; font-weight: 600; }
        .stat-label { color: #8A9A5B; font-size: 0.75rem; }
        .info-panel { margin-top: 15px; padding: 12px; background: #F4F1DE; border-radius: 8px; font-size: 0.8rem; color: #606C38; }
        select { width: 100%; padding: 8px; border: 1px solid #DDA15E; border-radius: 6px; font-family: 'Nunito', sans-serif; background: white; color: #606C38; }
        .risk-meter { padding: 10px; border-radius: 8px; text-align: center; font-weight: 600; margin-bottom: 15px; }
        .low-risk { background: #90EE90; color: #228B22; }
        .moderate-risk { background: #FFD700; color: #8B4513; }
        .high-risk { background: #FFB6C1; color: #DC143C; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Gallery</a>
    <div class="container">
        <header>
            <h1>Carbon Sequestration</h1>
            <p class="subtitle">Geological CO₂ storage with leakage risks and monitoring</p>
        </header>
        <div class="main-content">
            <div class="canvas-container">
                <canvas id="simCanvas"></canvas>
            </div>
            <div class="controls">
                <div class="risk-meter low-risk" id="riskMeter">Leakage Risk: Low</div>
                <div class="control-group">
                    <label>Storage Formation</label>
                    <select id="formation">
                        <option value="saline">Deep Saline Aquifer</option>
                        <option value="depleted" selected>Depleted Gas Field</option>
                        <option value="coal">Unmineable Coal Seam</option>
                        <option value="basalt">Basalt Formation</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Injection Rate (Mt CO₂/yr)</label>
                    <input type="range" id="injectionRate" min="0.5" max="5" step="0.5" value="2">
                    <div class="control-value"><span id="injectionRateVal">2</span></div>
                </div>
                <div class="control-group">
                    <label>Caprock Integrity (%)</label>
                    <input type="range" id="caprockIntegrity" min="70" max="100" value="95">
                    <div class="control-value"><span id="caprockIntegrityVal">95</span>%</div>
                </div>
                <div class="control-group">
                    <label>Monitoring Intensity</label>
                    <input type="range" id="monitoring" min="1" max="10" value="5">
                    <div class="control-value"><span id="monitoringVal">5</span></div>
                </div>
                <button class="btn-primary" onclick="startSimulation()">Start Injection</button>
                <button class="btn-secondary" onclick="resetSimulation()">Reset</button>
                <div class="stats-grid">
                    <div class="stat-box"><div class="stat-value" id="totalStored">0</div><div class="stat-label">Stored (Mt CO₂)</div></div>
                    <div class="stat-box"><div class="stat-value" id="leakage">0</div><div class="stat-label">Leaked (kt)</div></div>
                    <div class="stat-box"><div class="stat-value" id="pressure">0</div><div class="stat-label">Pressure (MPa)</div></div>
                    <div class="stat-box"><div class="stat-value" id="plumeDist">0</div><div class="stat-label">Plume (km)</div></div>
                </div>
                <div class="info-panel">
                    <strong>CCS:</strong> Carbon Capture and Storage injects CO₂ into geological formations. Key risks include caprock failure, fault reactivation, and wellbore leakage.
                </div>
            </div>
        </div>
    </div>
    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        function setupCanvas() {
            const rect = canvas.parentElement.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            canvas.width = rect.width * dpr;
            canvas.height = (rect.width * 0.65) * dpr;
            canvas.style.height = (rect.width * 0.65) + 'px';
            ctx.scale(dpr, dpr);
            return { width: rect.width, height: rect.width * 0.65 };
        }
        let dims = setupCanvas();
        window.addEventListener('resize', () => { dims = setupCanvas(); draw(); });

        const formations = {
            saline: { capacity: 100, permeability: 0.8, depth: 2000, risk: 0.02 },
            depleted: { capacity: 50, permeability: 0.9, depth: 1500, risk: 0.01 },
            coal: { capacity: 30, permeability: 0.5, depth: 800, risk: 0.03 },
            basalt: { capacity: 80, permeability: 0.6, depth: 1000, risk: 0.005 }
        };

        let state = { year: 0, running: false, stored: 0, leaked: 0, pressure: 10, plumeRadius: 0, particles: [], leakEvents: [], storageHistory: [], leakHistory: [] };

        function update() {
            if (!state.running || state.year >= 50) { state.running = false; return; }

            const formation = formations[document.getElementById('formation').value];
            const rate = parseFloat(document.getElementById('injectionRate').value);
            const integrity = parseInt(document.getElementById('caprockIntegrity').value) / 100;
            const monitoring = parseInt(document.getElementById('monitoring').value);

            // Inject CO2
            state.stored += rate;
            state.plumeRadius = Math.sqrt(state.stored / formation.capacity) * 5;
            state.pressure = 10 + (state.stored / formation.capacity) * 15;

            // Leakage risk
            const leakRisk = formation.risk * (1 - integrity) * (state.pressure / 20) * (1 - monitoring / 20);
            if (Math.random() < leakRisk) {
                const leakAmount = rate * 0.01 * (1 + Math.random());
                state.leaked += leakAmount;
                state.leakEvents.push({ year: state.year, x: Math.random() * dims.width * 0.5, y: dims.height * 0.3 });
            }

            // Add CO2 particles
            if (state.year % 2 === 0) {
                for (let i = 0; i < 5; i++) {
                    state.particles.push({
                        x: dims.width * 0.25,
                        y: dims.height * 0.35,
                        vx: (Math.random() - 0.5) * 2,
                        vy: Math.random() * 2,
                        life: 100,
                        leaked: false
                    });
                }
            }

            // Update particles
            state.particles = state.particles.filter(p => p.life > 0);
            state.particles.forEach(p => {
                p.x += p.vx;
                p.y += p.vy;
                p.vy *= 0.98;
                p.vx += (Math.random() - 0.5) * 0.3;
                p.life--;
                if (p.y > dims.height * 0.75) p.vy *= -0.5;
                if (p.y < dims.height * 0.4 && !p.leaked && Math.random() < leakRisk * 0.1) {
                    p.leaked = true;
                    p.vy = -2;
                }
            });

            state.storageHistory.push(state.stored);
            state.leakHistory.push(state.leaked);

            // Update UI
            document.getElementById('totalStored').textContent = state.stored.toFixed(1);
            document.getElementById('leakage').textContent = (state.leaked * 1000).toFixed(0);
            document.getElementById('pressure').textContent = state.pressure.toFixed(1);
            document.getElementById('plumeDist').textContent = state.plumeRadius.toFixed(1);

            const risk = document.getElementById('riskMeter');
            if (leakRisk < 0.005) { risk.className = 'risk-meter low-risk'; risk.textContent = 'Leakage Risk: Low'; }
            else if (leakRisk < 0.02) { risk.className = 'risk-meter moderate-risk'; risk.textContent = 'Leakage Risk: Moderate'; }
            else { risk.className = 'risk-meter high-risk'; risk.textContent = 'Leakage Risk: High'; }

            state.year++;
            draw();
            setTimeout(update, 150);
        }

        function draw() {
            ctx.clearRect(0, 0, dims.width, dims.height);

            const formation = formations[document.getElementById('formation').value];

            // Cross-section view
            const csX = 20, csY = 40, csW = dims.width * 0.55, csH = dims.height - 60;

            // Surface
            ctx.fillStyle = '#228B22';
            ctx.fillRect(csX, csY, csW, 30);

            // Atmosphere
            ctx.fillStyle = '#87CEEB';
            ctx.fillRect(csX, csY - 20, csW, 20);

            // Geological layers
            const layers = [
                { color: '#D2B48C', name: 'Overburden', height: 0.15 },
                { color: '#A0522D', name: 'Caprock', height: 0.1 },
                { color: '#DEB887', name: 'Reservoir', height: 0.35 },
                { color: '#8B4513', name: 'Basement', height: 0.4 }
            ];

            let yOffset = csY + 30;
            layers.forEach(layer => {
                const layerH = csH * layer.height;
                ctx.fillStyle = layer.color;
                ctx.fillRect(csX, yOffset, csW, layerH);
                ctx.fillStyle = '#333';
                ctx.font = '10px Nunito';
                ctx.fillText(layer.name, csX + 5, yOffset + 15);
                yOffset += layerH;
            });

            // Injection well
            ctx.fillStyle = '#444';
            ctx.fillRect(csX + csW * 0.4 - 3, csY + 30, 6, csH * 0.6);

            // CO2 plume
            const plumeY = csY + 30 + csH * 0.25 + csH * 0.175;
            const plumeW = Math.min(state.plumeRadius * 20, csW * 0.8);
            ctx.fillStyle = 'rgba(128, 128, 128, 0.5)';
            ctx.beginPath();
            ctx.ellipse(csX + csW * 0.4, plumeY, plumeW / 2, csH * 0.15, 0, 0, Math.PI * 2);
            ctx.fill();

            // CO2 particles
            state.particles.forEach(p => {
                ctx.fillStyle = p.leaked ? 'rgba(255, 100, 100, 0.7)' : 'rgba(100, 100, 100, 0.6)';
                ctx.beginPath();
                ctx.arc(csX + p.x * 0.3, p.y, 3, 0, Math.PI * 2);
                ctx.fill();
            });

            // Leak events
            ctx.fillStyle = 'rgba(255, 0, 0, 0.3)';
            state.leakEvents.forEach(e => {
                ctx.beginPath();
                ctx.arc(csX + e.x * 0.5, csY, (state.year - e.year) * 2 + 5, 0, Math.PI * 2);
                ctx.fill();
            });

            // Monitoring sensors
            const monitoring = parseInt(document.getElementById('monitoring').value);
            ctx.fillStyle = '#4169E1';
            for (let i = 0; i < monitoring; i++) {
                const sx = csX + (i + 1) * csW / (monitoring + 1);
                ctx.beginPath();
                ctx.arc(sx, csY + 20, 5, 0, Math.PI * 2);
                ctx.fill();
            }

            // Charts
            const chartX = dims.width * 0.6, chartW = dims.width * 0.35, chartH = 70;
            drawChart(chartX, 50, chartW, chartH, state.storageHistory, '#666', 'Stored CO₂ (Mt)');
            drawChart(chartX, 140, chartW, chartH, state.leakHistory, '#FF6347', 'Cumulative Leakage (Mt)');

            // Pressure gauge
            drawGauge(chartX + chartW / 2, 250, 40, state.pressure, 25, 'Pressure');

            // Title
            ctx.fillStyle = '#606C38';
            ctx.font = '14px Lora';
            ctx.fillText(`Carbon Sequestration | Year ${state.year}/50`, 30, 25);
        }

        function drawChart(x, y, w, h, data, color, label) {
            ctx.fillStyle = 'rgba(255,255,255,0.9)';
            ctx.fillRect(x, y, w, h);
            ctx.strokeRect(x, y, w, h);
            ctx.fillStyle = '#606C38';
            ctx.font = '10px Nunito';
            ctx.fillText(label, x + 5, y - 3);
            if (data.length < 2) return;
            const maxVal = Math.max(...data, 0.1);
            const step = w / Math.max(data.length - 1, 1);
            ctx.beginPath();
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            data.forEach((val, i) => {
                const px = x + i * step, py = y + h - 5 - (val / maxVal) * (h - 10);
                if (i === 0) ctx.moveTo(px, py); else ctx.lineTo(px, py);
            });
            ctx.stroke();
            ctx.lineWidth = 1;
        }

        function drawGauge(x, y, r, value, max, label) {
            ctx.beginPath();
            ctx.arc(x, y, r, Math.PI, 2 * Math.PI);
            ctx.fillStyle = '#E0E0E0';
            ctx.fill();
            const angle = Math.PI + (value / max) * Math.PI;
            ctx.beginPath();
            ctx.arc(x, y, r, Math.PI, angle);
            ctx.fillStyle = value > max * 0.8 ? '#FF6347' : '#4CAF50';
            ctx.fill();
            ctx.fillStyle = '#333';
            ctx.font = '12px Nunito';
            ctx.textAlign = 'center';
            ctx.fillText(value.toFixed(0), x, y + 5);
            ctx.font = '9px Nunito';
            ctx.fillText(label, x, y + r + 15);
            ctx.textAlign = 'left';
        }

        function startSimulation() {
            if (!state.running) { state.running = true; update(); }
        }

        function resetSimulation() {
            state = { year: 0, running: false, stored: 0, leaked: 0, pressure: 10, plumeRadius: 0, particles: [], leakEvents: [], storageHistory: [], leakHistory: [] };
            draw();
        }

        function updateSliderDisplays() {
            document.getElementById('injectionRateVal').textContent = document.getElementById('injectionRate').value;
            document.getElementById('caprockIntegrityVal').textContent = document.getElementById('caprockIntegrity').value;
            document.getElementById('monitoringVal').textContent = document.getElementById('monitoring').value;
        }

        document.querySelectorAll('input[type="range"]').forEach(s => s.addEventListener('input', updateSliderDisplays));
        draw();
    </script>
</body>
</html>
