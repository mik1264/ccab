<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Technology Diffusion - CCAB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: #1a1a2e; color: #e8e6e1; overflow: hidden; }
        #container { display: flex; height: 100vh; }
        #canvas-container { flex: 1; position: relative; }
        canvas { display: block; width: 100%; height: 100%; }
        #controls { width: 300px; background: rgba(0,0,0,0.8); padding: 20px; overflow-y: auto; }
        h1 { font-size: 1.2rem; margin-bottom: 15px; color: #06b6d4; }
        .control-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.8rem; margin-bottom: 5px; color: #aaa; }
        input[type="range"] { width: 100%; }
        button { width: 100%; padding: 10px; margin-bottom: 10px; background: #06b6d4; color: #1a1a2e; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        button:hover { background: #0891b2; }
        .stats { background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px; font-size: 0.8rem; margin-bottom: 15px; }
        .back-link { position: fixed; top: 10px; left: 10px; padding: 8px 16px; background: rgba(0,0,0,0.7); color: #06b6d4; text-decoration: none; border-radius: 6px; font-size: 14px; z-index: 999; }
        .explain-btn { background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); margin-top: 10px; }
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 1000; }
        .modal-overlay.active { display: flex; align-items: center; justify-content: center; }
        .modal { background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%); border-radius: 16px; padding: 30px; max-width: 600px; max-height: 80vh; overflow-y: auto; border: 1px solid rgba(255,255,255,0.1); position: relative; }
        .modal-close { position: absolute; top: 15px; right: 20px; background: none; border: none; color: #888; font-size: 28px; cursor: pointer; width: auto; }
        .modal h2 { color: #06b6d4; margin-bottom: 20px; }
        .modal-body { color: #ccc; line-height: 1.8; }
        .modal-body h3 { color: #67e8f9; margin: 20px 0 10px; }
        .modal-body strong { color: #06b6d4; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Gallery</a>
    <div id="container">
        <div id="canvas-container"><canvas id="canvas"></canvas></div>
        <div id="controls">
            <h1>Technology Diffusion</h1>
            <div class="control-group">
                <label>Innovation Appeal: <span id="appealValue">0.5</span></label>
                <input type="range" id="appeal" min="0.1" max="1" step="0.1" value="0.5">
            </div>
            <div class="control-group">
                <label>Network Effects: <span id="networkValue">0.6</span></label>
                <input type="range" id="network" min="0" max="1" step="0.1" value="0.6">
            </div>
            <div class="control-group">
                <label>Adoption Threshold: <span id="threshValue">0.3</span></label>
                <input type="range" id="threshold" min="0.1" max="0.8" step="0.1" value="0.3">
            </div>
            <button id="reset">Reset</button>
            <button id="newTech">Launch New Tech</button>
            <button id="explainBtn" class="explain-btn">üìö Explain</button>
            <div class="stats">
                <div>Adoption Rate: <span id="adoption">0</span>%</div>
                <div>Phase: <span id="phase">-</span></div>
                <div>Tipped: <span id="tipped">No</span></div>
                <div>Early Adopters: <span id="early">0</span></div>
                <div>Late Majority: <span id="late">0</span></div>
            </div>
        </div>
    </div>
    <div id="explainModal" class="modal-overlay">
        <div class="modal">
            <button class="modal-close">&times;</button>
            <h2>üì± Technology Diffusion</h2>
            <div class="modal-body">
                <p>Rogers' <strong>Diffusion of Innovations</strong> describes how new technologies spread through populations.</p>
                <h3>Adopter Categories</h3>
                <ul>
                    <li><strong>Innovators (2.5%):</strong> Risk-taking, first to try</li>
                    <li><strong>Early Adopters (13.5%):</strong> Opinion leaders</li>
                    <li><strong>Early Majority (34%):</strong> Deliberate, wait and see</li>
                    <li><strong>Late Majority (34%):</strong> Skeptical, pressure-driven</li>
                    <li><strong>Laggards (16%):</strong> Traditional, resistant</li>
                </ul>
                <h3>Tipping Point</h3>
                <p>When adoption reaches ~16%, network effects can trigger rapid cascade adoption.</p>
            </div>
        </div>
    </div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let params = { appeal: 0.5, network: 0.6, threshold: 0.3 };
        let agents = [], adoptionHistory = [], hasTipped = false;

        function resize() { 
            canvas.width = document.getElementById('canvas-container').clientWidth; 
            canvas.height = document.getElementById('canvas-container').clientHeight; 
        }

        function init() {
            resize();
            adoptionHistory = [];
            hasTipped = false;
            agents = [];

            for (let i = 0; i < 150; i++) {
                // Assign adopter category based on Rogers distribution
                const r = Math.random();
                let category;
                if (r < 0.025) category = 'innovator';
                else if (r < 0.16) category = 'early_adopter';
                else if (r < 0.50) category = 'early_majority';
                else if (r < 0.84) category = 'late_majority';
                else category = 'laggard';

                agents.push({
                    x: 50 + Math.random() * (canvas.width - 400),
                    y: 50 + Math.random() * (canvas.height - 100),
                    vx: (Math.random() - 0.5) * 1.5,
                    vy: (Math.random() - 0.5) * 1.5,
                    category,
                    adopted: false,
                    adoptionTime: null,
                    threshold: getThreshold(category)
                });
            }

            // Innovators adopt immediately
            for (let a of agents.filter(a => a.category === 'innovator')) {
                a.adopted = true;
                a.adoptionTime = 0;
            }
        }

        function getThreshold(category) {
            switch(category) {
                case 'innovator': return 0;
                case 'early_adopter': return 0.05;
                case 'early_majority': return 0.20;
                case 'late_majority': return 0.50;
                case 'laggard': return 0.80;
            }
        }

        function launchNewTech() {
            // Reset adoption
            for (let a of agents) {
                a.adopted = false;
                a.adoptionTime = null;
            }
            adoptionHistory = [];
            hasTipped = false;
            // Innovators adopt
            for (let a of agents.filter(a => a.category === 'innovator')) {
                a.adopted = true;
                a.adoptionTime = 0;
            }
        }

        function update() {
            // Move agents
            for (let a of agents) {
                a.x += a.vx;
                a.y += a.vy;
                if (a.x < 50 || a.x > canvas.width - 350) a.vx *= -1;
                if (a.y < 50 || a.y > canvas.height - 50) a.vy *= -1;
            }

            // Calculate current adoption rate
            const adoptionRate = agents.filter(a => a.adopted).length / agents.length;

            // Check for tipping point
            if (!hasTipped && adoptionRate > 0.16) {
                hasTipped = true;
            }

            // Adoption decisions
            for (let a of agents) {
                if (a.adopted) continue;

                // Count adopted neighbors
                const neighbors = agents.filter(b => 
                    b !== a && Math.hypot(b.x - a.x, b.y - a.y) < 60
                );
                const adoptedNeighbors = neighbors.filter(b => b.adopted).length;
                const neighborAdoptionRate = neighbors.length > 0 ? adoptedNeighbors / neighbors.length : 0;

                // Network effects
                const networkInfluence = params.network * neighborAdoptionRate;
                const globalInfluence = (1 - params.network) * adoptionRate;
                const totalInfluence = networkInfluence + globalInfluence;

                // Adoption decision
                const adoptionPressure = totalInfluence * params.appeal;
                const effectiveThreshold = a.threshold * params.threshold;

                if (adoptionPressure > effectiveThreshold) {
                    // Higher chance if well above threshold
                    const adoptProb = (adoptionPressure - effectiveThreshold) * 0.1;
                    if (Math.random() < adoptProb) {
                        a.adopted = true;
                        a.adoptionTime = adoptionHistory.length;
                    }
                }
            }

            // Record history
            adoptionHistory.push(adoptionRate);
            if (adoptionHistory.length > 300) adoptionHistory.shift();
        }

        function getPhase() {
            const rate = agents.filter(a => a.adopted).length / agents.length;
            if (rate < 0.025) return 'Innovators';
            if (rate < 0.16) return 'Early Adopters';
            if (rate < 0.50) return 'Early Majority';
            if (rate < 0.84) return 'Late Majority';
            return 'Laggards';
        }

        function draw() {
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw agents
            for (let a of agents) {
                ctx.beginPath();
                ctx.arc(a.x, a.y, 6, 0, Math.PI * 2);

                if (a.adopted) {
                    ctx.fillStyle = '#06b6d4';
                    // Glow for early adopters
                    if (a.category === 'innovator' || a.category === 'early_adopter') {
                        ctx.save();
                        ctx.beginPath();
                        ctx.arc(a.x, a.y, 12, 0, Math.PI * 2);
                        ctx.fillStyle = 'rgba(6, 182, 212, 0.3)';
                        ctx.fill();
                        ctx.restore();
                        ctx.beginPath();
                        ctx.arc(a.x, a.y, 6, 0, Math.PI * 2);
                        ctx.fillStyle = '#06b6d4';
                    }
                } else {
                    // Color by category
                    switch(a.category) {
                        case 'innovator': ctx.fillStyle = '#a855f7'; break;
                        case 'early_adopter': ctx.fillStyle = '#3b82f6'; break;
                        case 'early_majority': ctx.fillStyle = '#6b7280'; break;
                        case 'late_majority': ctx.fillStyle = '#4b5563'; break;
                        case 'laggard': ctx.fillStyle = '#374151'; break;
                    }
                }
                ctx.fill();
            }

            // S-curve visualization
            const graphX = canvas.width - 280;
            const graphY = 50;
            const graphW = 250;
            const graphH = 120;

            ctx.fillStyle = 'rgba(0,0,0,0.5)';
            ctx.fillRect(graphX - 10, graphY - 10, graphW + 20, graphH + 30);

            ctx.fillStyle = 'white';
            ctx.font = '11px sans-serif';
            ctx.fillText('Adoption S-Curve', graphX, graphY);

            if (adoptionHistory.length > 1) {
                ctx.strokeStyle = '#06b6d4';
                ctx.lineWidth = 2;
                ctx.beginPath();

                adoptionHistory.forEach((rate, i) => {
                    const x = graphX + (i / adoptionHistory.length) * graphW;
                    const y = graphY + graphH - rate * graphH;
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                });
                ctx.stroke();

                // Tipping point line
                ctx.strokeStyle = 'rgba(239, 68, 68, 0.5)';
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(graphX, graphY + graphH - 0.16 * graphH);
                ctx.lineTo(graphX + graphW, graphY + graphH - 0.16 * graphH);
                ctx.stroke();
                ctx.setLineDash([]);
                ctx.fillStyle = 'rgba(239, 68, 68, 0.8)';
                ctx.fillText('Tipping Point (16%)', graphX + graphW - 100, graphY + graphH - 0.16 * graphH - 5);
            }

            // Legend
            ctx.fillStyle = '#a855f7'; ctx.fillRect(graphX, graphY + graphH + 35, 10, 10);
            ctx.fillStyle = 'white'; ctx.fillText('Inn', graphX + 12, graphY + graphH + 43);
            ctx.fillStyle = '#3b82f6'; ctx.fillRect(graphX + 35, graphY + graphH + 35, 10, 10);
            ctx.fillText('EA', graphX + 47, graphY + graphH + 43);
            ctx.fillStyle = '#6b7280'; ctx.fillRect(graphX + 70, graphY + graphH + 35, 10, 10);
            ctx.fillText('EM', graphX + 82, graphY + graphH + 43);
            ctx.fillStyle = '#4b5563'; ctx.fillRect(graphX + 105, graphY + graphH + 35, 10, 10);
            ctx.fillText('LM', graphX + 117, graphY + graphH + 43);
            ctx.fillStyle = '#374151'; ctx.fillRect(graphX + 140, graphY + graphH + 35, 10, 10);
            ctx.fillText('Lag', graphX + 152, graphY + graphH + 43);
            ctx.fillStyle = '#06b6d4'; ctx.fillRect(graphX + 180, graphY + graphH + 35, 10, 10);
            ctx.fillText('Adopted', graphX + 192, graphY + graphH + 43);

            // Stats
            const adoptionRate = (agents.filter(a => a.adopted).length / agents.length * 100).toFixed(0);
            const earlyAdopters = agents.filter(a => a.adopted && (a.category === 'innovator' || a.category === 'early_adopter')).length;
            const lateMajority = agents.filter(a => a.adopted && (a.category === 'late_majority' || a.category === 'laggard')).length;

            document.getElementById('adoption').textContent = adoptionRate;
            document.getElementById('phase').textContent = getPhase();
            document.getElementById('tipped').textContent = hasTipped ? 'Yes!' : 'No';
            document.getElementById('early').textContent = earlyAdopters;
            document.getElementById('late').textContent = lateMajority;
        }

        function animate() { update(); draw(); requestAnimationFrame(animate); }

        document.getElementById('appeal').addEventListener('input', e => { 
            params.appeal = parseFloat(e.target.value); 
            document.getElementById('appealValue').textContent = params.appeal.toFixed(1); 
        });
        document.getElementById('network').addEventListener('input', e => { 
            params.network = parseFloat(e.target.value); 
            document.getElementById('networkValue').textContent = params.network.toFixed(1); 
        });
        document.getElementById('threshold').addEventListener('input', e => { 
            params.threshold = parseFloat(e.target.value); 
            document.getElementById('threshValue').textContent = params.threshold.toFixed(1); 
        });

        document.getElementById('reset').addEventListener('click', init);
        document.getElementById('newTech').addEventListener('click', launchNewTech);

        window.addEventListener('resize', resize);

        const modal = document.getElementById('explainModal');
        document.getElementById('explainBtn').addEventListener('click', () => modal.classList.add('active'));
        modal.querySelector('.modal-close').addEventListener('click', () => modal.classList.remove('active'));
        modal.addEventListener('click', e => { if (e.target === modal) modal.classList.remove('active'); });

        init();
        animate();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
