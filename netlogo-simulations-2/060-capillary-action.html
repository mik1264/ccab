<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capillary Action - Jurin's Law & Meniscus Formation</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600;700&family=Nunito:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --sage: #8A9A5B;
            --moss: #606C38;
            --earth: #DDA15E;
            --cream: #FEFAE0;
            --terracotta: #BC6C25;
            --dark-moss: #3d4423;
            --water: rgba(100, 180, 255, 0.8);
            --mercury: rgba(180, 180, 190, 0.9);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, var(--cream) 0%, #F4F1DE 50%, #EDE8D5 100%);
            min-height: 100vh;
            color: var(--dark-moss);
            padding: 20px;
        }

        .organic-back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            text-decoration: none;
            color: var(--moss);
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .organic-back-link:hover {
            background: var(--moss);
            color: white;
            transform: translateX(-5px);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding-top: 60px;
        }

        h1 {
            font-family: 'Lora', serif;
            font-size: 2.5rem;
            color: var(--moss);
            text-align: center;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: var(--terracotta);
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        .simulation-area {
            display: grid;
            grid-template-columns: 280px 1fr 300px;
            gap: 20px;
        }

        .controls, .stats-panel {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            max-height: calc(100vh - 150px);
            overflow-y: auto;
        }

        .control-section {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(96, 108, 56, 0.2);
        }

        .control-section:last-child {
            border-bottom: none;
        }

        .control-section h3 {
            color: var(--moss);
            font-size: 1rem;
            margin-bottom: 12px;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            font-weight: 600;
            color: var(--moss);
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .control-group input[type="range"] {
            width: 100%;
            accent-color: var(--moss);
        }

        .control-group .value {
            text-align: right;
            font-size: 0.85rem;
            color: var(--terracotta);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .checkbox-group input[type="checkbox"],
        .checkbox-group input[type="radio"] {
            accent-color: var(--moss);
            width: 18px;
            height: 18px;
        }

        button {
            width: 100%;
            padding: 12px;
            background: var(--moss);
            color: white;
            border: none;
            border-radius: 10px;
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        button:hover {
            background: var(--dark-moss);
            transform: translateY(-2px);
        }

        button.secondary {
            background: var(--terracotta);
        }

        button.secondary:hover {
            background: #a05a1f;
        }

        .preset-btn {
            padding: 8px;
            font-size: 0.85rem;
            margin-bottom: 5px;
        }

        .canvas-container {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        canvas {
            display: block;
            width: 100%;
            border-radius: 10px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(96, 108, 56, 0.1);
        }

        .stat-label {
            font-weight: 600;
            color: var(--moss);
        }

        .stat-value {
            color: var(--terracotta);
            font-weight: 700;
        }

        .formula-box {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Georgia', serif;
            text-align: center;
        }

        .formula {
            font-size: 1.1rem;
            margin: 10px 0;
        }

        .legend {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 10px;
            font-size: 0.8rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-color {
            width: 20px;
            height: 12px;
            border-radius: 3px;
        }

        .info-box {
            background: rgba(138, 154, 91, 0.1);
            border-left: 3px solid var(--sage);
            padding: 12px;
            border-radius: 0 10px 10px 0;
            margin-top: 15px;
            font-size: 0.85rem;
            line-height: 1.5;
        }

        @media (max-width: 1200px) {
            .simulation-area {
                grid-template-columns: 1fr;
            }
            .controls, .stats-panel {
                max-height: none;
            }
        }
    </style>
</head>
<body>
    <a href="index.html" class="organic-back-link">
        <span class="back-arrow">←</span>
        <span class="back-text">Gallery</span>
    </a>

    <div class="container">
        <h1>Capillary Action Simulation</h1>
        <p class="subtitle">Jurin's Law, Contact Angles & Meniscus Formation</p>

        <div class="simulation-area">
            <div class="controls">
                <div class="control-section">
                    <h3>Simulation Controls</h3>
                    <button id="startBtn">Start Simulation</button>
                    <button id="resetBtn" class="secondary">Reset</button>
                </div>

                <div class="control-section">
                    <h3>Liquid Presets</h3>
                    <button class="preset-btn" onclick="setLiquid('water')">Water in Glass</button>
                    <button class="preset-btn secondary" onclick="setLiquid('mercury')">Mercury in Glass</button>
                    <button class="preset-btn secondary" onclick="setLiquid('ethanol')">Ethanol</button>
                    <button class="preset-btn secondary" onclick="setLiquid('oil')">Oil</button>
                </div>

                <div class="control-section">
                    <h3>Liquid Properties</h3>
                    <div class="control-group">
                        <label>Surface Tension (mN/m): <span class="value" id="tensionVal">72</span></label>
                        <input type="range" id="tension" min="20" max="500" value="72" step="1">
                    </div>
                    <div class="control-group">
                        <label>Contact Angle (°): <span class="value" id="angleVal">20</span></label>
                        <input type="range" id="angle" min="0" max="180" value="20" step="1">
                    </div>
                    <div class="control-group">
                        <label>Density (kg/m³): <span class="value" id="densityVal">1000</span></label>
                        <input type="range" id="density" min="500" max="14000" value="1000" step="100">
                    </div>
                </div>

                <div class="control-section">
                    <h3>Tube Configuration</h3>
                    <div class="control-group">
                        <label>Number of Tubes: <span class="value" id="numTubesVal">5</span></label>
                        <input type="range" id="numTubes" min="1" max="8" value="5" step="1">
                    </div>
                    <div class="control-group">
                        <label>Min Radius (mm): <span class="value" id="minRadiusVal">0.5</span></label>
                        <input type="range" id="minRadius" min="0.1" max="2" value="0.5" step="0.1">
                    </div>
                    <div class="control-group">
                        <label>Max Radius (mm): <span class="value" id="maxRadiusVal">3</span></label>
                        <input type="range" id="maxRadius" min="1" max="10" value="3" step="0.5">
                    </div>
                </div>

                <div class="control-section">
                    <h3>Visualization</h3>
                    <div class="checkbox-group">
                        <input type="checkbox" id="showForces" checked>
                        <label for="showForces">Show Force Vectors</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="showTheory" checked>
                        <label for="showTheory">Show Theoretical Height</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="showMolecules">
                        <label for="showMolecules">Show Molecular View</label>
                    </div>
                </div>
            </div>

            <div class="canvas-container">
                <canvas id="simCanvas" width="700" height="600"></canvas>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: rgba(100, 180, 255, 0.8);"></div>
                        <span>Liquid (Water-like)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: rgba(180, 180, 190, 0.9);"></div>
                        <span>Liquid (Mercury-like)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #FF6B6B;"></div>
                        <span>Surface Tension Force</span>
                    </div>
                </div>
            </div>

            <div class="stats-panel">
                <div class="control-section">
                    <h3>Jurin's Law</h3>
                    <div class="formula-box">
                        <div class="formula">h = 2γcos(θ) / ρgr</div>
                        <small>Height = (2 × Surface Tension × cos(Contact Angle)) / (Density × Gravity × Radius)</small>
                    </div>
                </div>

                <div class="control-section">
                    <h3>Tube Measurements</h3>
                    <div id="tubeMeasurements"></div>
                </div>

                <div class="control-section">
                    <h3>Physical Constants</h3>
                    <div class="stat-item">
                        <span class="stat-label">Gravity (g):</span>
                        <span class="stat-value">9.81 m/s²</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">cos(θ):</span>
                        <span class="stat-value" id="statCosTheta">0.94</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Capillary Length:</span>
                        <span class="stat-value" id="statCapLength">2.7 mm</span>
                    </div>
                </div>

                <div class="info-box">
                    <strong>Physics:</strong> Capillary action occurs when adhesive forces between liquid and tube wall exceed cohesive forces within the liquid. The liquid rises (or falls for mercury) until surface tension is balanced by gravitational force. Contact angle θ < 90° causes rise (wetting), θ > 90° causes depression (non-wetting).
                </div>
            </div>
        </div>
    </div>

    <script>
        // Capillary Action Simulation
        // Demonstrates Jurin's Law and meniscus formation

        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');

        // Physical constants
        const g = 9.81; // m/s²

        // Simulation parameters
        let params = {
            surfaceTension: 0.072, // N/m (water = 0.072)
            contactAngle: 20, // degrees
            density: 1000, // kg/m³
            numTubes: 5,
            minRadius: 0.5, // mm
            maxRadius: 3, // mm
            showForces: true,
            showTheory: true,
            showMolecules: false
        };

        // Animation state
        let tubes = [];
        let running = false;
        let animationId = null;
        let time = 0;

        // Liquid color based on contact angle
        function getLiquidColor() {
            if (params.contactAngle > 90) {
                // Mercury-like (non-wetting)
                return {
                    fill: 'rgba(180, 180, 190, 0.9)',
                    stroke: 'rgba(140, 140, 150, 1)',
                    name: 'Mercury-like'
                };
            } else {
                // Water-like (wetting)
                const alpha = 0.6 + 0.3 * (1 - params.contactAngle / 90);
                return {
                    fill: `rgba(100, 180, 255, ${alpha})`,
                    stroke: 'rgba(50, 120, 200, 1)',
                    name: 'Water-like'
                };
            }
        }

        // Calculate theoretical capillary rise using Jurin's Law
        function calculateJurinHeight(radiusM) {
            const cosTheta = Math.cos(params.contactAngle * Math.PI / 180);
            const h = (2 * params.surfaceTension * cosTheta) / (params.density * g * radiusM);
            return h; // in meters
        }

        // Calculate capillary length
        function calculateCapillaryLength() {
            return Math.sqrt(params.surfaceTension / (params.density * g));
        }

        // Initialize tubes
        function initTubes() {
            tubes = [];
            const spacing = canvas.width / (params.numTubes + 1);

            for (let i = 0; i < params.numTubes; i++) {
                const t = params.numTubes > 1 ? i / (params.numTubes - 1) : 0.5;
                const radiusMM = params.minRadius + t * (params.maxRadius - params.minRadius);
                const radiusM = radiusMM / 1000;

                const theoreticalHeight = calculateJurinHeight(radiusM);

                tubes.push({
                    x: spacing * (i + 1),
                    radiusMM,
                    radiusM,
                    theoreticalHeightM: theoreticalHeight,
                    currentHeightM: 0,
                    velocity: 0
                });
            }

            time = 0;
        }

        // Simulation step
        function simulate() {
            const dt = 0.02;
            time += dt;

            tubes.forEach(tube => {
                // Simple dynamics: liquid rises/falls toward equilibrium
                const diff = tube.theoreticalHeightM - tube.currentHeightM;

                // Damped spring-like behavior
                const damping = 5;
                const stiffness = 20;

                const acceleration = stiffness * diff - damping * tube.velocity;
                tube.velocity += acceleration * dt;
                tube.currentHeightM += tube.velocity * dt;

                // Add small oscillation for realism
                if (Math.abs(diff) < 0.0001 && Math.abs(tube.velocity) < 0.0001) {
                    tube.velocity = 0;
                }
            });
        }

        // Draw meniscus shape
        function drawMeniscus(x, tubeWidth, baseY, height, isConvex) {
            const meniscusDepth = tubeWidth * 0.3 * (isConvex ? -1 : 1);

            ctx.beginPath();
            ctx.moveTo(x - tubeWidth / 2, baseY - height);

            // Curved meniscus using quadratic bezier
            ctx.quadraticCurveTo(
                x, baseY - height + meniscusDepth,
                x + tubeWidth / 2, baseY - height
            );

            return meniscusDepth;
        }

        // Draw the simulation
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Background
            ctx.fillStyle = '#f5f5dc';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Reservoir base level
            const reservoirY = canvas.height - 100;
            const reservoirHeight = 80;

            // Scale factor: 1 mm = pixels
            const scale = 100; // pixels per mm

            const liquidColor = getLiquidColor();
            const isWetting = params.contactAngle < 90;

            // Draw tubes and liquid
            tubes.forEach((tube, idx) => {
                const tubeWidth = tube.radiusMM * 2 * scale / 3; // Scale for visibility
                const tubeHeight = 350;
                const tubeBottom = reservoirY;
                const tubeTop = tubeBottom - tubeHeight;

                // Draw tube (glass)
                ctx.strokeStyle = 'rgba(150, 150, 160, 0.8)';
                ctx.lineWidth = 2;

                // Left wall
                ctx.beginPath();
                ctx.moveTo(tube.x - tubeWidth / 2 - 2, tubeTop);
                ctx.lineTo(tube.x - tubeWidth / 2 - 2, tubeBottom + 20);
                ctx.stroke();

                // Right wall
                ctx.beginPath();
                ctx.moveTo(tube.x + tubeWidth / 2 + 2, tubeTop);
                ctx.lineTo(tube.x + tubeWidth / 2 + 2, tubeBottom + 20);
                ctx.stroke();

                // Tube label
                ctx.fillStyle = '#666';
                ctx.font = '11px Nunito';
                ctx.textAlign = 'center';
                ctx.fillText(`r = ${tube.radiusMM.toFixed(1)} mm`, tube.x, tubeTop - 10);

                // Calculate display height
                const heightMM = tube.currentHeightM * 1000;
                const displayHeight = heightMM * scale / 3;

                // Draw liquid in tube
                if (displayHeight !== 0) {
                    const startY = reservoirY;
                    const endY = reservoirY - displayHeight;

                    ctx.fillStyle = liquidColor.fill;
                    ctx.beginPath();

                    if (isWetting) {
                        // Concave meniscus (water)
                        ctx.moveTo(tube.x - tubeWidth / 2, startY);
                        ctx.lineTo(tube.x - tubeWidth / 2, endY);
                        ctx.quadraticCurveTo(
                            tube.x, endY + tubeWidth * 0.3,
                            tube.x + tubeWidth / 2, endY
                        );
                        ctx.lineTo(tube.x + tubeWidth / 2, startY);
                    } else {
                        // Convex meniscus (mercury) - depression
                        ctx.moveTo(tube.x - tubeWidth / 2, startY);
                        ctx.lineTo(tube.x - tubeWidth / 2, endY);
                        ctx.quadraticCurveTo(
                            tube.x, endY - tubeWidth * 0.3,
                            tube.x + tubeWidth / 2, endY
                        );
                        ctx.lineTo(tube.x + tubeWidth / 2, startY);
                    }

                    ctx.closePath();
                    ctx.fill();

                    // Draw meniscus line
                    ctx.strokeStyle = liquidColor.stroke;
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(tube.x - tubeWidth / 2, endY);
                    const meniscusDir = isWetting ? 1 : -1;
                    ctx.quadraticCurveTo(
                        tube.x, endY + tubeWidth * 0.3 * meniscusDir,
                        tube.x + tubeWidth / 2, endY
                    );
                    ctx.stroke();
                }

                // Draw theoretical height marker
                if (params.showTheory) {
                    const theoreticalDisplayHeight = tube.theoreticalHeightM * 1000 * scale / 3;
                    const theoreticalY = reservoirY - theoreticalDisplayHeight;

                    ctx.strokeStyle = '#4CAF50';
                    ctx.lineWidth = 1;
                    ctx.setLineDash([5, 3]);
                    ctx.beginPath();
                    ctx.moveTo(tube.x - tubeWidth / 2 - 10, theoreticalY);
                    ctx.lineTo(tube.x + tubeWidth / 2 + 10, theoreticalY);
                    ctx.stroke();
                    ctx.setLineDash([]);

                    // Height label
                    ctx.fillStyle = '#4CAF50';
                    ctx.font = '10px Nunito';
                    ctx.textAlign = 'left';
                    const heightText = (tube.theoreticalHeightM * 1000).toFixed(1) + ' mm';
                    ctx.fillText(heightText, tube.x + tubeWidth / 2 + 15, theoreticalY + 4);
                }

                // Draw force vectors
                if (params.showForces && Math.abs(tube.currentHeightM) > 0.0001) {
                    const endY = reservoirY - (tube.currentHeightM * 1000 * scale / 3);

                    // Surface tension force (along contact line)
                    ctx.strokeStyle = '#FF6B6B';
                    ctx.lineWidth = 2;

                    const forceScale = 15;
                    const angle = params.contactAngle * Math.PI / 180;
                    const cosA = Math.cos(angle);
                    const sinA = Math.sin(angle);

                    // Left side force
                    ctx.beginPath();
                    ctx.moveTo(tube.x - tubeWidth / 2, endY);
                    ctx.lineTo(tube.x - tubeWidth / 2 - sinA * forceScale, endY - cosA * forceScale);
                    ctx.stroke();
                    drawArrowHead(ctx, tube.x - tubeWidth / 2, endY,
                        tube.x - tubeWidth / 2 - sinA * forceScale, endY - cosA * forceScale);

                    // Right side force
                    ctx.beginPath();
                    ctx.moveTo(tube.x + tubeWidth / 2, endY);
                    ctx.lineTo(tube.x + tubeWidth / 2 + sinA * forceScale, endY - cosA * forceScale);
                    ctx.stroke();
                    drawArrowHead(ctx, tube.x + tubeWidth / 2, endY,
                        tube.x + tubeWidth / 2 + sinA * forceScale, endY - cosA * forceScale);
                }
            });

            // Draw reservoir
            ctx.fillStyle = liquidColor.fill;
            ctx.fillRect(30, reservoirY, canvas.width - 60, reservoirHeight);

            // Reservoir surface line
            ctx.strokeStyle = liquidColor.stroke;
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(30, reservoirY);
            ctx.lineTo(canvas.width - 30, reservoirY);
            ctx.stroke();

            // Draw molecular view if enabled
            if (params.showMolecules) {
                drawMolecularView(tubes[0]);
            }

            // Contact angle indicator
            drawContactAngleIndicator();

            updateStats();
        }

        // Draw arrowhead
        function drawArrowHead(ctx, fromX, fromY, toX, toY) {
            const angle = Math.atan2(toY - fromY, toX - fromX);
            const size = 6;

            ctx.beginPath();
            ctx.moveTo(toX, toY);
            ctx.lineTo(toX - size * Math.cos(angle - 0.4), toY - size * Math.sin(angle - 0.4));
            ctx.moveTo(toX, toY);
            ctx.lineTo(toX - size * Math.cos(angle + 0.4), toY - size * Math.sin(angle + 0.4));
            ctx.stroke();
        }

        // Draw molecular view inset
        function drawMolecularView(tube) {
            const insetX = 50;
            const insetY = 50;
            const insetSize = 120;

            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            ctx.strokeStyle = '#999';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.roundRect(insetX, insetY, insetSize, insetSize, 10);
            ctx.fill();
            ctx.stroke();

            ctx.fillStyle = '#333';
            ctx.font = 'bold 10px Nunito';
            ctx.textAlign = 'center';
            ctx.fillText('Molecular View', insetX + insetSize / 2, insetY + 15);

            // Draw glass wall (simplified)
            ctx.fillStyle = '#ddd';
            ctx.fillRect(insetX + 10, insetY + 25, 20, insetSize - 35);

            // Draw liquid molecules
            const isWetting = params.contactAngle < 90;
            const liquidColor = getLiquidColor();

            for (let i = 0; i < 20; i++) {
                const mx = insetX + 40 + Math.random() * 60;
                const my = insetY + 40 + Math.random() * 60;

                ctx.beginPath();
                ctx.arc(mx, my, 4, 0, Math.PI * 2);
                ctx.fillStyle = liquidColor.fill;
                ctx.fill();
                ctx.strokeStyle = liquidColor.stroke;
                ctx.lineWidth = 0.5;
                ctx.stroke();
            }

            // Draw adhesion/cohesion arrows
            ctx.font = '9px Nunito';
            if (isWetting) {
                ctx.fillStyle = '#4CAF50';
                ctx.fillText('Adhesion > Cohesion', insetX + insetSize / 2, insetY + insetSize - 10);
            } else {
                ctx.fillStyle = '#F44336';
                ctx.fillText('Cohesion > Adhesion', insetX + insetSize / 2, insetY + insetSize - 10);
            }
        }

        // Draw contact angle indicator
        function drawContactAngleIndicator() {
            const cx = canvas.width - 80;
            const cy = 80;
            const radius = 40;

            // Background
            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            ctx.beginPath();
            ctx.arc(cx, cy, radius + 10, 0, Math.PI * 2);
            ctx.fill();

            // Wall line
            ctx.strokeStyle = '#888';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(cx, cy - radius);
            ctx.lineTo(cx, cy + radius);
            ctx.stroke();

            // Liquid surface line at contact angle
            const angleRad = params.contactAngle * Math.PI / 180;
            ctx.strokeStyle = getLiquidColor().stroke;
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(cx, cy);
            ctx.lineTo(cx + Math.cos(Math.PI - angleRad) * radius, cy - Math.sin(Math.PI - angleRad) * radius);
            ctx.stroke();

            // Angle arc
            ctx.strokeStyle = '#FF9800';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(cx, cy, 20, -Math.PI / 2, Math.PI - angleRad - Math.PI / 2, angleRad > 90);
            ctx.stroke();

            // Label
            ctx.fillStyle = '#333';
            ctx.font = 'bold 12px Nunito';
            ctx.textAlign = 'center';
            ctx.fillText(`θ = ${params.contactAngle}°`, cx, cy + radius + 25);
        }

        // Update statistics
        function updateStats() {
            // Update cos(theta)
            const cosTheta = Math.cos(params.contactAngle * Math.PI / 180);
            document.getElementById('statCosTheta').textContent = cosTheta.toFixed(4);

            // Capillary length
            const capLength = calculateCapillaryLength() * 1000;
            document.getElementById('statCapLength').textContent = capLength.toFixed(2) + ' mm';

            // Tube measurements
            let measurementsHTML = '';
            tubes.forEach((tube, i) => {
                const height = tube.theoreticalHeightM * 1000;
                measurementsHTML += `
                    <div class="stat-item">
                        <span class="stat-label">Tube ${i + 1} (r=${tube.radiusMM.toFixed(1)}mm):</span>
                        <span class="stat-value">${height.toFixed(2)} mm</span>
                    </div>
                `;
            });
            document.getElementById('tubeMeasurements').innerHTML = measurementsHTML;
        }

        // Preset liquids
        function setLiquid(type) {
            switch (type) {
                case 'water':
                    params.surfaceTension = 0.072;
                    params.contactAngle = 20;
                    params.density = 1000;
                    break;
                case 'mercury':
                    params.surfaceTension = 0.486;
                    params.contactAngle = 140;
                    params.density = 13600;
                    break;
                case 'ethanol':
                    params.surfaceTension = 0.022;
                    params.contactAngle = 0;
                    params.density = 789;
                    break;
                case 'oil':
                    params.surfaceTension = 0.032;
                    params.contactAngle = 30;
                    params.density = 900;
                    break;
            }

            // Update UI
            document.getElementById('tension').value = params.surfaceTension * 1000;
            document.getElementById('tensionVal').textContent = (params.surfaceTension * 1000).toFixed(0);
            document.getElementById('angle').value = params.contactAngle;
            document.getElementById('angleVal').textContent = params.contactAngle;
            document.getElementById('density').value = params.density;
            document.getElementById('densityVal').textContent = params.density;

            initTubes();
            if (!running) draw();
        }
        window.setLiquid = setLiquid;

        // Animation loop
        function animate() {
            if (!running) return;

            simulate();
            draw();

            // Check if equilibrium reached
            const allSettled = tubes.every(t =>
                Math.abs(t.velocity) < 0.00001 &&
                Math.abs(t.theoreticalHeightM - t.currentHeightM) < 0.00001
            );

            if (allSettled && time > 1) {
                running = false;
                document.getElementById('startBtn').textContent = 'Restart';
            }

            animationId = requestAnimationFrame(animate);
        }

        // Event listeners
        document.getElementById('startBtn').addEventListener('click', () => {
            if (!running) {
                if (time > 0) {
                    initTubes();
                }
                running = true;
                document.getElementById('startBtn').textContent = 'Running...';
                animate();
            }
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            running = false;
            document.getElementById('startBtn').textContent = 'Start Simulation';
            if (animationId) cancelAnimationFrame(animationId);
            initTubes();
            draw();
        });

        document.getElementById('tension').addEventListener('input', function() {
            params.surfaceTension = parseFloat(this.value) / 1000;
            document.getElementById('tensionVal').textContent = this.value;
            initTubes();
            if (!running) draw();
        });

        document.getElementById('angle').addEventListener('input', function() {
            params.contactAngle = parseFloat(this.value);
            document.getElementById('angleVal').textContent = this.value;
            initTubes();
            if (!running) draw();
        });

        document.getElementById('density').addEventListener('input', function() {
            params.density = parseFloat(this.value);
            document.getElementById('densityVal').textContent = this.value;
            initTubes();
            if (!running) draw();
        });

        document.getElementById('numTubes').addEventListener('input', function() {
            params.numTubes = parseInt(this.value);
            document.getElementById('numTubesVal').textContent = this.value;
            initTubes();
            if (!running) draw();
        });

        document.getElementById('minRadius').addEventListener('input', function() {
            params.minRadius = parseFloat(this.value);
            document.getElementById('minRadiusVal').textContent = this.value;
            initTubes();
            if (!running) draw();
        });

        document.getElementById('maxRadius').addEventListener('input', function() {
            params.maxRadius = parseFloat(this.value);
            document.getElementById('maxRadiusVal').textContent = this.value;
            initTubes();
            if (!running) draw();
        });

        document.getElementById('showForces').addEventListener('change', function() {
            params.showForces = this.checked;
            if (!running) draw();
        });

        document.getElementById('showTheory').addEventListener('change', function() {
            params.showTheory = this.checked;
            if (!running) draw();
        });

        document.getElementById('showMolecules').addEventListener('change', function() {
            params.showMolecules = this.checked;
            if (!running) draw();
        });

        // Initialize
        initTubes();
        draw();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
