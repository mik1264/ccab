<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Tunneling - Wave Packet Dynamics</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600;700&family=Nunito:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --sage: #8A9A5B;
            --moss: #606C38;
            --earth: #DDA15E;
            --cream: #FEFAE0;
            --terracotta: #BC6C25;
            --dark-moss: #3d4423;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, var(--cream) 0%, #F4F1DE 50%, #EDE8D5 100%);
            min-height: 100vh;
            color: var(--dark-moss);
            padding: 20px;
        }

        .organic-back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            text-decoration: none;
            color: var(--moss);
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .organic-back-link:hover {
            background: var(--moss);
            color: white;
            transform: translateX(-5px);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding-top: 60px;
        }

        h1 {
            font-family: 'Lora', serif;
            font-size: 2.5rem;
            color: var(--moss);
            text-align: center;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: var(--terracotta);
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        .simulation-area {
            display: grid;
            grid-template-columns: 280px 1fr 280px;
            gap: 20px;
        }

        .controls, .stats-panel {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            max-height: calc(100vh - 150px);
            overflow-y: auto;
        }

        .control-section {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(96, 108, 56, 0.2);
        }

        .control-section:last-child {
            border-bottom: none;
        }

        .control-section h3 {
            color: var(--moss);
            font-size: 1rem;
            margin-bottom: 12px;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            font-weight: 600;
            color: var(--moss);
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .control-group input[type="range"] {
            width: 100%;
            accent-color: var(--moss);
        }

        .control-group .value {
            text-align: right;
            font-size: 0.85rem;
            color: var(--terracotta);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .checkbox-group input[type="checkbox"],
        .checkbox-group input[type="radio"] {
            accent-color: var(--moss);
            width: 18px;
            height: 18px;
        }

        button {
            width: 100%;
            padding: 12px;
            background: var(--moss);
            color: white;
            border: none;
            border-radius: 10px;
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        button:hover {
            background: var(--dark-moss);
            transform: translateY(-2px);
        }

        button.secondary {
            background: var(--terracotta);
        }

        button.secondary:hover {
            background: #a05a1f;
        }

        .canvas-container {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        canvas {
            display: block;
            width: 100%;
            border-radius: 10px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(96, 108, 56, 0.1);
        }

        .stat-label {
            font-weight: 600;
            color: var(--moss);
        }

        .stat-value {
            color: var(--terracotta);
            font-weight: 700;
        }

        .formula-box {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Georgia', serif;
            text-align: center;
        }

        .formula {
            font-size: 1.1rem;
            margin: 8px 0;
        }

        .legend {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
            font-size: 0.75rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .legend-color {
            width: 15px;
            height: 10px;
            border-radius: 2px;
        }

        .prob-bar {
            height: 30px;
            background: #eee;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 10px;
            display: flex;
        }

        .prob-transmitted {
            background: #4CAF50;
            transition: width 0.3s;
        }

        .prob-reflected {
            background: #F44336;
            transition: width 0.3s;
        }

        .info-box {
            background: rgba(138, 154, 91, 0.1);
            border-left: 3px solid var(--sage);
            padding: 12px;
            border-radius: 0 10px 10px 0;
            margin-top: 15px;
            font-size: 0.85rem;
            line-height: 1.5;
        }

        @media (max-width: 1200px) {
            .simulation-area {
                grid-template-columns: 1fr;
            }
            .controls, .stats-panel {
                max-height: none;
            }
        }
    </style>
</head>
<body>
    <a href="index.html" class="organic-back-link">
        <span class="back-arrow">←</span>
        <span class="back-text">Gallery</span>
    </a>

    <div class="container">
        <h1>Quantum Tunneling Simulation</h1>
        <p class="subtitle">Wave Packet Dynamics & Barrier Penetration</p>

        <div class="simulation-area">
            <div class="controls">
                <div class="control-section">
                    <h3>Simulation Controls</h3>
                    <button id="startBtn">Start</button>
                    <button id="resetBtn" class="secondary">Reset</button>
                </div>

                <div class="control-section">
                    <h3>Wave Packet</h3>
                    <div class="control-group">
                        <label>Initial Momentum (k₀): <span class="value" id="momentumVal">3.0</span></label>
                        <input type="range" id="momentum" min="1" max="8" value="3" step="0.1">
                    </div>
                    <div class="control-group">
                        <label>Packet Width (σ): <span class="value" id="widthVal">20</span></label>
                        <input type="range" id="width" min="10" max="50" value="20" step="2">
                    </div>
                </div>

                <div class="control-section">
                    <h3>Potential Barrier</h3>
                    <div class="control-group">
                        <label>Barrier Height (V₀): <span class="value" id="heightVal">5.0</span></label>
                        <input type="range" id="height" min="1" max="15" value="5" step="0.5">
                    </div>
                    <div class="control-group">
                        <label>Barrier Width: <span class="value" id="barrierWidthVal">30</span> px</label>
                        <input type="range" id="barrierWidth" min="5" max="80" value="30" step="5">
                    </div>
                </div>

                <div class="control-section">
                    <h3>Potential Type</h3>
                    <div class="checkbox-group">
                        <input type="radio" name="potential" id="potBarrier" checked>
                        <label for="potBarrier">Square Barrier</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" name="potential" id="potStep">
                        <label for="potStep">Step Potential</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" name="potential" id="potWell">
                        <label for="potWell">Potential Well</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" name="potential" id="potDouble">
                        <label for="potDouble">Double Barrier</label>
                    </div>
                </div>

                <div class="control-section">
                    <h3>Visualization</h3>
                    <div class="checkbox-group">
                        <input type="checkbox" id="showProb" checked>
                        <label for="showProb">Probability Density |ψ|²</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="showReal">
                        <label for="showReal">Real Part Re(ψ)</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="showImag">
                        <label for="showImag">Imaginary Part Im(ψ)</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="showPhase">
                        <label for="showPhase">Phase (color)</label>
                    </div>
                </div>
            </div>

            <div class="canvas-container">
                <canvas id="simCanvas" width="700" height="400"></canvas>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #4A90D9;"></div>
                        <span>|ψ|² Probability</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #E74C3C;"></div>
                        <span>Re(ψ)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #2ECC71;"></div>
                        <span>Im(ψ)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: rgba(128, 128, 128, 0.4);"></div>
                        <span>Potential V(x)</span>
                    </div>
                </div>
            </div>

            <div class="stats-panel">
                <div class="control-section">
                    <h3>Schrödinger Equation</h3>
                    <div class="formula-box">
                        <div class="formula">iℏ ∂ψ/∂t = Ĥψ</div>
                        <small>Time-dependent Schrödinger Equation</small>
                    </div>
                    <div class="formula-box">
                        <div class="formula">T = e^(-2κL)</div>
                        <small>Transmission coefficient (approx.)</small>
                    </div>
                </div>

                <div class="control-section">
                    <h3>Wave Packet Properties</h3>
                    <div class="stat-item">
                        <span class="stat-label">Energy (E):</span>
                        <span class="stat-value" id="statEnergy">--</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Wavelength (λ):</span>
                        <span class="stat-value" id="statWavelength">--</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">E/V₀ Ratio:</span>
                        <span class="stat-value" id="statRatio">--</span>
                    </div>
                </div>

                <div class="control-section">
                    <h3>Tunneling Probability</h3>
                    <div class="stat-item">
                        <span class="stat-label">Transmitted:</span>
                        <span class="stat-value" id="statTransmit">0%</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Reflected:</span>
                        <span class="stat-value" id="statReflect">0%</span>
                    </div>
                    <div class="prob-bar">
                        <div class="prob-transmitted" id="probTransBar" style="width: 0%;"></div>
                        <div class="prob-reflected" id="probRefBar" style="width: 0%;"></div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>Classical Prediction</h3>
                    <div class="stat-item">
                        <span class="stat-label">Classical Result:</span>
                        <span class="stat-value" id="statClassical">--</span>
                    </div>
                </div>

                <div class="info-box">
                    <strong>Physics:</strong> Quantum tunneling occurs when a particle penetrates a potential barrier despite having insufficient classical energy. The wave function decays exponentially inside the barrier (κ = √(2m(V₀-E))/ℏ), but if the barrier is thin enough, probability remains on the other side.
                </div>
            </div>
        </div>
    </div>

    <script>
        // Quantum Tunneling Simulation
        // Solves 1D Time-Dependent Schrödinger Equation using Split-Operator Method

        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');

        // Grid parameters
        const N = 512; // Number of spatial points
        const dx = 1.0; // Spatial step
        const dt = 0.5; // Time step
        const L = N * dx; // Domain length

        // Physical constants (in convenient units where ℏ = 2m = 1)
        const hbar = 1;
        const mass = 0.5;

        // Wave function (complex)
        let psiReal = new Float64Array(N);
        let psiImag = new Float64Array(N);

        // Potential
        let V = new Float64Array(N);

        // Parameters
        let params = {
            k0: 3.0,        // Initial momentum
            sigma: 20,      // Packet width
            V0: 5.0,        // Barrier height
            barrierWidth: 30, // Barrier width
            potentialType: 'barrier',
            showProb: true,
            showReal: false,
            showImag: false,
            showPhase: false
        };

        // Simulation state
        let running = false;
        let animationId = null;
        let time = 0;

        // Initialize wave packet (Gaussian)
        function initWavePacket() {
            const x0 = L * 0.25; // Initial position
            const k0 = params.k0;
            const sigma = params.sigma;

            for (let i = 0; i < N; i++) {
                const x = i * dx;
                const envelope = Math.exp(-((x - x0) ** 2) / (4 * sigma * sigma));
                const phase = k0 * x;

                psiReal[i] = envelope * Math.cos(phase);
                psiImag[i] = envelope * Math.sin(phase);
            }

            // Normalize
            normalize();
            time = 0;
        }

        // Normalize wave function
        function normalize() {
            let norm = 0;
            for (let i = 0; i < N; i++) {
                norm += psiReal[i] ** 2 + psiImag[i] ** 2;
            }
            norm = Math.sqrt(norm * dx);

            for (let i = 0; i < N; i++) {
                psiReal[i] /= norm;
                psiImag[i] /= norm;
            }
        }

        // Initialize potential
        function initPotential() {
            const center = N / 2;
            const halfWidth = params.barrierWidth / 2;
            const V0 = params.V0;

            for (let i = 0; i < N; i++) {
                V[i] = 0;
            }

            switch (params.potentialType) {
                case 'barrier':
                    for (let i = 0; i < N; i++) {
                        if (Math.abs(i - center) < halfWidth) {
                            V[i] = V0;
                        }
                    }
                    break;

                case 'step':
                    for (let i = Math.floor(center); i < N; i++) {
                        V[i] = V0;
                    }
                    break;

                case 'well':
                    for (let i = 0; i < N; i++) {
                        if (Math.abs(i - center) < halfWidth) {
                            V[i] = -V0;
                        }
                    }
                    break;

                case 'double':
                    const gap = 30;
                    for (let i = 0; i < N; i++) {
                        const dist1 = Math.abs(i - (center - gap / 2 - halfWidth));
                        const dist2 = Math.abs(i - (center + gap / 2 + halfWidth));
                        if (dist1 < halfWidth / 2 || dist2 < halfWidth / 2) {
                            V[i] = V0;
                        }
                    }
                    break;
            }
        }

        // Time evolution using Crank-Nicolson method (simplified)
        function evolve() {
            // Split-operator method (simplified version)
            // First half: kinetic evolution in momentum space (approximated)
            // Second half: potential evolution in position space

            // Kinetic part: free particle propagation
            const tempReal = new Float64Array(N);
            const tempImag = new Float64Array(N);

            // Laplacian for kinetic energy
            const kinFactor = hbar * dt / (4 * mass * dx * dx);

            for (let i = 1; i < N - 1; i++) {
                const laplacianReal = psiReal[i + 1] - 2 * psiReal[i] + psiReal[i - 1];
                const laplacianImag = psiImag[i + 1] - 2 * psiImag[i] + psiImag[i - 1];

                // Kinetic evolution: i*dt*(-ℏ²/2m)∇²ψ
                tempReal[i] = psiReal[i] + kinFactor * laplacianImag;
                tempImag[i] = psiImag[i] - kinFactor * laplacianReal;
            }

            // Absorbing boundaries
            const absorb = 50;
            for (let i = 0; i < absorb; i++) {
                const factor = Math.pow(Math.sin(Math.PI * i / (2 * absorb)), 2);
                tempReal[i] *= factor;
                tempImag[i] *= factor;
                tempReal[N - 1 - i] *= factor;
                tempImag[N - 1 - i] *= factor;
            }

            // Potential evolution: exp(-i*V*dt/ℏ)
            for (let i = 0; i < N; i++) {
                const phase = -V[i] * dt / hbar;
                const cosP = Math.cos(phase);
                const sinP = Math.sin(phase);

                psiReal[i] = tempReal[i] * cosP - tempImag[i] * sinP;
                psiImag[i] = tempReal[i] * sinP + tempImag[i] * cosP;
            }

            time += dt;
        }

        // Calculate probabilities in different regions
        function calculateProbabilities() {
            const center = N / 2;
            let probLeft = 0;
            let probRight = 0;
            let probTotal = 0;

            for (let i = 0; i < N; i++) {
                const prob = psiReal[i] ** 2 + psiImag[i] ** 2;
                probTotal += prob;

                if (i < center - params.barrierWidth) {
                    probLeft += prob;
                } else if (i > center + params.barrierWidth) {
                    probRight += prob;
                }
            }

            return {
                transmitted: probRight / probTotal,
                reflected: probLeft / probTotal,
                total: probTotal * dx
            };
        }

        // Draw simulation
        function draw() {
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const scaleX = canvas.width / N;
            const centerY = canvas.height / 2;
            const scaleY = canvas.height * 0.3;

            // Draw potential
            ctx.fillStyle = 'rgba(128, 128, 128, 0.4)';
            ctx.beginPath();
            ctx.moveTo(0, centerY);

            const potMax = Math.max(...V, 0.1);
            for (let i = 0; i < N; i++) {
                const x = i * scaleX;
                const y = centerY - (V[i] / potMax) * scaleY * 0.8;
                if (i === 0) {
                    ctx.moveTo(x, centerY);
                }
                ctx.lineTo(x, y);
            }
            ctx.lineTo(canvas.width, centerY);
            ctx.closePath();
            ctx.fill();

            // Draw potential outline
            ctx.strokeStyle = 'rgba(200, 200, 200, 0.8)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            for (let i = 0; i < N; i++) {
                const x = i * scaleX;
                const y = centerY - (V[i] / potMax) * scaleY * 0.8;
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();

            // Find max amplitude for scaling
            let maxProb = 0;
            for (let i = 0; i < N; i++) {
                const prob = psiReal[i] ** 2 + psiImag[i] ** 2;
                if (prob > maxProb) maxProb = prob;
            }
            maxProb = Math.max(maxProb, 0.001);

            // Draw probability density
            if (params.showProb) {
                ctx.fillStyle = 'rgba(74, 144, 217, 0.6)';
                ctx.beginPath();
                ctx.moveTo(0, centerY);

                for (let i = 0; i < N; i++) {
                    const x = i * scaleX;
                    const prob = psiReal[i] ** 2 + psiImag[i] ** 2;
                    const y = centerY - (prob / maxProb) * scaleY;
                    ctx.lineTo(x, y);
                }

                ctx.lineTo(canvas.width, centerY);
                ctx.closePath();
                ctx.fill();

                // Outline
                ctx.strokeStyle = '#4A90D9';
                ctx.lineWidth = 2;
                ctx.beginPath();
                for (let i = 0; i < N; i++) {
                    const x = i * scaleX;
                    const prob = psiReal[i] ** 2 + psiImag[i] ** 2;
                    const y = centerY - (prob / maxProb) * scaleY;
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.stroke();
            }

            // Draw real part
            if (params.showReal) {
                const maxReal = Math.sqrt(maxProb);
                ctx.strokeStyle = '#E74C3C';
                ctx.lineWidth = 1.5;
                ctx.beginPath();
                for (let i = 0; i < N; i++) {
                    const x = i * scaleX;
                    const y = centerY - (psiReal[i] / maxReal) * scaleY * 0.7;
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.stroke();
            }

            // Draw imaginary part
            if (params.showImag) {
                const maxImag = Math.sqrt(maxProb);
                ctx.strokeStyle = '#2ECC71';
                ctx.lineWidth = 1.5;
                ctx.beginPath();
                for (let i = 0; i < N; i++) {
                    const x = i * scaleX;
                    const y = centerY - (psiImag[i] / maxImag) * scaleY * 0.7;
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.stroke();
            }

            // Draw phase coloring
            if (params.showPhase) {
                for (let i = 0; i < N; i++) {
                    const prob = psiReal[i] ** 2 + psiImag[i] ** 2;
                    if (prob > maxProb * 0.01) {
                        const phase = Math.atan2(psiImag[i], psiReal[i]);
                        const hue = ((phase + Math.PI) / (2 * Math.PI)) * 360;

                        const x = i * scaleX;
                        const height = (prob / maxProb) * scaleY;

                        ctx.fillStyle = `hsla(${hue}, 100%, 50%, 0.5)`;
                        ctx.fillRect(x, centerY - height, scaleX, height);
                    }
                }
            }

            // Draw axis
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.lineWidth = 1;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(canvas.width, centerY);
            ctx.stroke();
            ctx.setLineDash([]);

            // Draw energy level
            const E = 0.5 * params.k0 * params.k0 / mass;
            const Eheight = (E / potMax) * scaleY * 0.8;
            ctx.strokeStyle = '#FFD700';
            ctx.lineWidth = 2;
            ctx.setLineDash([10, 5]);
            ctx.beginPath();
            ctx.moveTo(0, centerY - Eheight);
            ctx.lineTo(canvas.width, centerY - Eheight);
            ctx.stroke();
            ctx.setLineDash([]);

            ctx.fillStyle = '#FFD700';
            ctx.font = '12px Nunito';
            ctx.fillText('E (particle energy)', 10, centerY - Eheight - 5);

            // Labels
            ctx.fillStyle = '#fff';
            ctx.font = '12px Nunito';
            ctx.fillText('V(x)', canvas.width - 30, centerY - scaleY * 0.7);

            updateStats();
        }

        // Update statistics
        function updateStats() {
            const E = 0.5 * params.k0 * params.k0 / mass;
            const lambda = 2 * Math.PI / params.k0;
            const ratio = E / params.V0;

            document.getElementById('statEnergy').textContent = E.toFixed(2);
            document.getElementById('statWavelength').textContent = lambda.toFixed(1) + ' px';
            document.getElementById('statRatio').textContent = ratio.toFixed(2);

            // Classical prediction
            if (ratio >= 1) {
                document.getElementById('statClassical').textContent = '100% transmitted';
            } else {
                document.getElementById('statClassical').textContent = '100% reflected';
            }

            // Calculate quantum probabilities
            const probs = calculateProbabilities();
            const transmitPct = (probs.transmitted * 100).toFixed(1);
            const reflectPct = (probs.reflected * 100).toFixed(1);

            document.getElementById('statTransmit').textContent = transmitPct + '%';
            document.getElementById('statReflect').textContent = reflectPct + '%';
            document.getElementById('probTransBar').style.width = transmitPct + '%';
            document.getElementById('probRefBar').style.width = reflectPct + '%';
        }

        // Animation loop
        function animate() {
            if (!running) return;

            for (let i = 0; i < 3; i++) {
                evolve();
            }

            draw();
            animationId = requestAnimationFrame(animate);
        }

        // Event listeners
        document.getElementById('startBtn').addEventListener('click', () => {
            running = !running;
            document.getElementById('startBtn').textContent = running ? 'Pause' : 'Start';
            if (running) animate();
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            running = false;
            document.getElementById('startBtn').textContent = 'Start';
            if (animationId) cancelAnimationFrame(animationId);
            initPotential();
            initWavePacket();
            draw();
        });

        document.getElementById('momentum').addEventListener('input', function() {
            params.k0 = parseFloat(this.value);
            document.getElementById('momentumVal').textContent = this.value;
            if (!running) {
                initWavePacket();
                draw();
            }
        });

        document.getElementById('width').addEventListener('input', function() {
            params.sigma = parseFloat(this.value);
            document.getElementById('widthVal').textContent = this.value;
            if (!running) {
                initWavePacket();
                draw();
            }
        });

        document.getElementById('height').addEventListener('input', function() {
            params.V0 = parseFloat(this.value);
            document.getElementById('heightVal').textContent = this.value;
            initPotential();
            if (!running) draw();
        });

        document.getElementById('barrierWidth').addEventListener('input', function() {
            params.barrierWidth = parseInt(this.value);
            document.getElementById('barrierWidthVal').textContent = this.value;
            initPotential();
            if (!running) draw();
        });

        document.querySelectorAll('input[name="potential"]').forEach(input => {
            input.addEventListener('change', function() {
                if (this.id === 'potBarrier') params.potentialType = 'barrier';
                else if (this.id === 'potStep') params.potentialType = 'step';
                else if (this.id === 'potWell') params.potentialType = 'well';
                else params.potentialType = 'double';

                initPotential();
                initWavePacket();
                draw();
            });
        });

        document.getElementById('showProb').addEventListener('change', function() {
            params.showProb = this.checked;
            if (!running) draw();
        });

        document.getElementById('showReal').addEventListener('change', function() {
            params.showReal = this.checked;
            if (!running) draw();
        });

        document.getElementById('showImag').addEventListener('change', function() {
            params.showImag = this.checked;
            if (!running) draw();
        });

        document.getElementById('showPhase').addEventListener('change', function() {
            params.showPhase = this.checked;
            if (!running) draw();
        });

        // Initialize
        initPotential();
        initWavePacket();
        draw();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
