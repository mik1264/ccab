<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rangeland Grazing - Livestock Management Simulation</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600&family=Nunito:wght@400;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #FEFAE0 0%, #F4F1DE 50%, #EDE8D5 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 20px; }
        h1 { font-family: 'Lora', serif; color: #606C38; font-size: 2rem; margin-bottom: 8px; }
        .subtitle { color: #8A9A5B; font-size: 1rem; }
        .back-link {
            position: absolute; top: 20px; left: 20px;
            text-decoration: none; color: #606C38; font-weight: 600;
            display: flex; align-items: center; gap: 5px; transition: color 0.3s;
        }
        .back-link:hover { color: #BC6C25; }
        .main-content { display: grid; grid-template-columns: 1fr 300px; gap: 20px; }
        .canvas-container {
            background: white; border-radius: 12px; padding: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        canvas { width: 100%; border-radius: 8px; display: block; }
        .controls {
            background: white; border-radius: 12px; padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08); height: fit-content;
        }
        .control-group { margin-bottom: 18px; }
        .control-group label { display: block; color: #606C38; font-weight: 600; margin-bottom: 5px; font-size: 0.9rem; }
        .control-group input[type="range"] { width: 100%; accent-color: #8A9A5B; }
        .control-value { text-align: right; color: #8A9A5B; font-size: 0.85rem; }
        button { width: 100%; padding: 10px; margin-top: 5px; border: none; border-radius: 8px; cursor: pointer; font-family: 'Nunito', sans-serif; font-weight: 600; font-size: 0.9rem; transition: all 0.3s; }
        .btn-primary { background: #8A9A5B; color: white; }
        .btn-primary:hover { background: #606C38; }
        .btn-secondary { background: #DDA15E; color: white; }
        .btn-secondary:hover { background: #BC6C25; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .stat-box { background: linear-gradient(135deg, #FEFAE0, #F4F1DE); padding: 10px; border-radius: 8px; text-align: center; }
        .stat-value { font-family: 'Lora', serif; color: #606C38; font-size: 1.1rem; font-weight: 600; }
        .stat-label { color: #8A9A5B; font-size: 0.75rem; }
        .info-panel { margin-top: 15px; padding: 12px; background: #F4F1DE; border-radius: 8px; font-size: 0.8rem; color: #606C38; }
        select { width: 100%; padding: 8px; border: 1px solid #DDA15E; border-radius: 6px; font-family: 'Nunito', sans-serif; background: white; color: #606C38; }
        .scenario-btn { width: 100%; padding: 8px; margin-top: 5px; font-size: 0.8rem; }
        .condition-meter { margin-top: 10px; padding: 10px; border-radius: 6px; text-align: center; font-weight: 600; }
        .excellent { background: #228B22; color: white; }
        .good { background: #90EE90; color: #228B22; }
        .fair { background: #FFD700; color: #8B4513; }
        .poor { background: #FF6347; color: white; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Gallery</a>
    <div class="container">
        <header>
            <h1>Rangeland Grazing Management</h1>
            <p class="subtitle">Vegetation dynamics, carrying capacity, and rotational strategies</p>
        </header>
        <div class="main-content">
            <div class="canvas-container">
                <canvas id="simCanvas"></canvas>
            </div>
            <div class="controls">
                <div class="condition-meter good" id="conditionMeter">Range Condition: Good</div>
                <div class="control-group">
                    <label>Grazing Strategy</label>
                    <select id="strategy">
                        <option value="continuous">Continuous Grazing</option>
                        <option value="rotational" selected>Rotational Grazing</option>
                        <option value="deferred">Deferred Rotation</option>
                        <option value="rest">Rest Rotation</option>
                        <option value="intensive">Intensive Short Duration</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Stocking Rate (AU/ha)</label>
                    <input type="range" id="stockingRate" min="0.1" max="2" step="0.1" value="0.8">
                    <div class="control-value"><span id="stockingRateVal">0.8</span></div>
                </div>
                <div class="control-group">
                    <label>Number of Paddocks</label>
                    <input type="range" id="paddocks" min="1" max="8" value="4">
                    <div class="control-value"><span id="paddocksVal">4</span></div>
                </div>
                <div class="control-group">
                    <label>Annual Rainfall (mm)</label>
                    <input type="range" id="rainfall" min="200" max="800" value="450">
                    <div class="control-value"><span id="rainfallVal">450</span> mm</div>
                </div>
                <button class="btn-primary" onclick="startSimulation()">Start Season</button>
                <button class="btn-secondary" onclick="resetSimulation()">Reset</button>
                <div class="stats-grid">
                    <div class="stat-box"><div class="stat-value" id="biomass">0</div><div class="stat-label">Forage (kg/ha)</div></div>
                    <div class="stat-box"><div class="stat-value" id="animalWeight">0</div><div class="stat-label">Avg Weight (kg)</div></div>
                    <div class="stat-box"><div class="stat-value" id="utilization">0%</div><div class="stat-label">Utilization</div></div>
                    <div class="stat-box"><div class="stat-value" id="carryingCap">0</div><div class="stat-label">Carrying Cap</div></div>
                </div>
                <div class="info-panel">
                    <strong>Model:</strong> Vegetation regrowth follows logistic growth. Overgrazing depletes root reserves and reduces recovery. Rotational rest allows recovery periods.
                </div>
                <div class="control-group" style="margin-top:15px">
                    <label>Scenarios</label>
                    <button class="scenario-btn btn-secondary" onclick="loadPreset('optimal')">Optimal Rotation</button>
                    <button class="scenario-btn btn-secondary" onclick="loadPreset('overstock')">Overstocked</button>
                    <button class="scenario-btn btn-secondary" onclick="loadPreset('drought')">Drought Year</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        function setupCanvas() {
            const rect = canvas.parentElement.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            canvas.width = rect.width * dpr;
            canvas.height = (rect.width * 0.6) * dpr;
            canvas.style.height = (rect.width * 0.6) + 'px';
            ctx.scale(dpr, dpr);
            return { width: rect.width, height: rect.width * 0.6 };
        }
        let dims = setupCanvas();
        window.addEventListener('resize', () => { dims = setupCanvas(); draw(); });

        let state = { day: 0, running: false, paddocks: [], animals: [], biomassHistory: [], weightHistory: [] };
        const daysPerYear = 365;

        function initSimulation() {
            const numPaddocks = parseInt(document.getElementById('paddocks').value);
            const stockingRate = parseFloat(document.getElementById('stockingRate').value);
            state = { day: 0, running: false, paddocks: [], animals: [], biomassHistory: [], weightHistory: [], currentPaddock: 0 };

            for (let i = 0; i < numPaddocks; i++) {
                state.paddocks.push({
                    biomass: 2500 + Math.random() * 500,
                    rootReserve: 100,
                    condition: 'good',
                    grazingDays: 0
                });
            }

            const numAnimals = Math.floor(stockingRate * 20);
            for (let i = 0; i < numAnimals; i++) {
                state.animals.push({
                    x: Math.random() * 100,
                    y: Math.random() * 100,
                    weight: 350 + Math.random() * 50,
                    paddock: 0
                });
            }
        }

        function update() {
            if (!state.running || state.day >= daysPerYear) { state.running = false; return; }

            const strategy = document.getElementById('strategy').value;
            const rainfall = parseInt(document.getElementById('rainfall').value);
            const numPaddocks = state.paddocks.length;

            // Rotation logic
            const rotationPeriod = strategy === 'intensive' ? 3 : strategy === 'rotational' ? 14 : strategy === 'deferred' ? 30 : 999;
            if (state.day % rotationPeriod === 0 && strategy !== 'continuous') {
                state.currentPaddock = (state.currentPaddock + 1) % numPaddocks;
                state.animals.forEach(a => a.paddock = state.currentPaddock);
            }

            state.paddocks.forEach((p, i) => {
                const isGrazed = state.animals.some(a => a.paddock === i);
                const growthRate = (rainfall / 450) * (p.rootReserve / 100) * 15;
                const maxBiomass = 3500 * (rainfall / 450);

                if (isGrazed) {
                    const consumption = state.animals.filter(a => a.paddock === i).length * 12;
                    p.biomass = Math.max(200, p.biomass + growthRate - consumption);
                    p.grazingDays++;
                    if (p.biomass < 800) p.rootReserve = Math.max(20, p.rootReserve - 0.5);
                } else {
                    p.biomass = Math.min(maxBiomass, p.biomass + growthRate * 1.5);
                    p.rootReserve = Math.min(100, p.rootReserve + 0.3);
                }

                p.condition = p.rootReserve > 80 ? 'excellent' : p.rootReserve > 60 ? 'good' : p.rootReserve > 40 ? 'fair' : 'poor';
            });

            // Animal weight gain
            state.animals.forEach(a => {
                const paddock = state.paddocks[a.paddock];
                const availableFeed = paddock.biomass / (state.animals.filter(x => x.paddock === a.paddock).length || 1);
                const gain = availableFeed > 1500 ? 1.2 : availableFeed > 800 ? 0.6 : -0.3;
                a.weight = Math.max(250, Math.min(600, a.weight + gain));
                a.x += (Math.random() - 0.5) * 3;
                a.y += (Math.random() - 0.5) * 3;
                a.x = Math.max(0, Math.min(100, a.x));
                a.y = Math.max(0, Math.min(100, a.y));
            });

            const avgBiomass = state.paddocks.reduce((s, p) => s + p.biomass, 0) / state.paddocks.length;
            const avgWeight = state.animals.reduce((s, a) => s + a.weight, 0) / (state.animals.length || 1);
            state.biomassHistory.push(avgBiomass);
            state.weightHistory.push(avgWeight);

            state.day++;
            updateUI();
            draw();
            setTimeout(update, 40);
        }

        function updateUI() {
            const avgBiomass = state.paddocks.reduce((s, p) => s + p.biomass, 0) / state.paddocks.length;
            const avgWeight = state.animals.reduce((s, a) => s + a.weight, 0) / (state.animals.length || 1);
            const avgRoot = state.paddocks.reduce((s, p) => s + p.rootReserve, 0) / state.paddocks.length;
            const rainfall = parseInt(document.getElementById('rainfall').value);
            const carryingCap = (rainfall / 450) * 1.0;
            const utilization = (3500 - avgBiomass) / 3500 * 100;

            document.getElementById('biomass').textContent = Math.round(avgBiomass);
            document.getElementById('animalWeight').textContent = Math.round(avgWeight);
            document.getElementById('utilization').textContent = Math.round(utilization) + '%';
            document.getElementById('carryingCap').textContent = carryingCap.toFixed(1);

            const meter = document.getElementById('conditionMeter');
            if (avgRoot > 80) { meter.className = 'condition-meter excellent'; meter.textContent = 'Range Condition: Excellent'; }
            else if (avgRoot > 60) { meter.className = 'condition-meter good'; meter.textContent = 'Range Condition: Good'; }
            else if (avgRoot > 40) { meter.className = 'condition-meter fair'; meter.textContent = 'Range Condition: Fair'; }
            else { meter.className = 'condition-meter poor'; meter.textContent = 'Range Condition: Poor'; }
        }

        function draw() {
            ctx.clearRect(0, 0, dims.width, dims.height);
            const numP = state.paddocks.length;
            const cols = Math.ceil(Math.sqrt(numP));
            const rows = Math.ceil(numP / cols);
            const padW = (dims.width * 0.55 - 30) / cols;
            const padH = (dims.height - 80) / rows;

            state.paddocks.forEach((p, i) => {
                const col = i % cols, row = Math.floor(i / cols);
                const x = 20 + col * padW, y = 50 + row * padH;
                const greenness = Math.floor(100 + (p.biomass / 3500) * 155);
                ctx.fillStyle = `rgb(${100 - p.rootReserve * 0.5}, ${greenness}, ${50 + p.rootReserve * 0.3})`;
                ctx.fillRect(x, y, padW - 5, padH - 5);
                ctx.strokeStyle = i === state.currentPaddock ? '#BC6C25' : '#8B7355';
                ctx.lineWidth = i === state.currentPaddock ? 3 : 1;
                ctx.strokeRect(x, y, padW - 5, padH - 5);
                ctx.fillStyle = '#333';
                ctx.font = '10px Nunito';
                ctx.fillText(`P${i + 1}: ${Math.round(p.biomass)}kg`, x + 5, y + 15);
            });

            // Draw animals
            state.animals.forEach(a => {
                const p = a.paddock;
                const col = p % cols, row = Math.floor(p / cols);
                const baseX = 20 + col * padW, baseY = 50 + row * padH;
                const ax = baseX + (a.x / 100) * (padW - 15) + 5;
                const ay = baseY + (a.y / 100) * (padH - 15) + 5;
                ctx.fillStyle = '#8B4513';
                ctx.beginPath();
                ctx.ellipse(ax, ay, 4, 3, 0, 0, Math.PI * 2);
                ctx.fill();
            });

            // Charts
            const chartX = dims.width * 0.58, chartW = dims.width * 0.38, chartH = 60;
            drawChart(chartX, 50, chartW, chartH, state.biomassHistory, '#228B22', 'Forage Biomass');
            drawChart(chartX, 130, chartW, chartH, state.weightHistory, '#8B4513', 'Animal Weight');

            ctx.fillStyle = '#606C38';
            ctx.font = '14px Lora';
            ctx.fillText(`Day ${state.day}/${daysPerYear}`, 20, 35);
        }

        function drawChart(x, y, w, h, data, color, label) {
            ctx.fillStyle = 'rgba(255,255,255,0.9)';
            ctx.fillRect(x, y, w, h);
            ctx.strokeRect(x, y, w, h);
            ctx.fillStyle = '#606C38';
            ctx.font = '10px Nunito';
            ctx.fillText(label, x + 5, y - 3);
            if (data.length < 2) return;
            const maxVal = Math.max(...data, 1);
            const step = w / Math.max(data.length - 1, 1);
            ctx.beginPath();
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            data.forEach((val, i) => {
                const px = x + i * step, py = y + h - (val / maxVal) * h;
                if (i === 0) ctx.moveTo(px, py);
                else ctx.lineTo(px, py);
            });
            ctx.stroke();
            ctx.lineWidth = 1;
        }

        function startSimulation() { if (!state.running) { state.running = true; update(); } }
        function resetSimulation() { initSimulation(); draw(); updateUI(); }
        function loadPreset(name) {
            if (name === 'optimal') {
                document.getElementById('strategy').value = 'rotational';
                document.getElementById('stockingRate').value = 0.7;
                document.getElementById('paddocks').value = 4;
                document.getElementById('rainfall').value = 500;
            } else if (name === 'overstock') {
                document.getElementById('strategy').value = 'continuous';
                document.getElementById('stockingRate').value = 1.5;
                document.getElementById('paddocks').value = 1;
                document.getElementById('rainfall').value = 400;
            } else if (name === 'drought') {
                document.getElementById('strategy').value = 'deferred';
                document.getElementById('stockingRate').value = 0.4;
                document.getElementById('paddocks').value = 3;
                document.getElementById('rainfall').value = 250;
            }
            updateSliderDisplays();
            resetSimulation();
        }
        function updateSliderDisplays() {
            document.getElementById('stockingRateVal').textContent = document.getElementById('stockingRate').value;
            document.getElementById('paddocksVal').textContent = document.getElementById('paddocks').value;
            document.getElementById('rainfallVal').textContent = document.getElementById('rainfall').value;
        }
        document.querySelectorAll('input[type="range"]').forEach(s => s.addEventListener('input', updateSliderDisplays));
        initSimulation();
        draw();
    </script>
</body>
</html>
