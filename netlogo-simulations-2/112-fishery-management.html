<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fishery Management - MSY Simulation</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600&family=Nunito:wght@400;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #FEFAE0 0%, #F4F1DE 50%, #EDE8D5 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 20px; }
        h1 { font-family: 'Lora', serif; color: #606C38; font-size: 2rem; margin-bottom: 8px; }
        .subtitle { color: #8A9A5B; font-size: 1rem; }
        .back-link {
            position: absolute; top: 20px; left: 20px;
            text-decoration: none; color: #606C38; font-weight: 600;
            display: flex; align-items: center; gap: 5px; transition: color 0.3s;
        }
        .back-link:hover { color: #BC6C25; }
        .main-content { display: grid; grid-template-columns: 1fr 300px; gap: 20px; }
        .canvas-container {
            background: white; border-radius: 12px; padding: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        canvas { width: 100%; border-radius: 8px; display: block; }
        .controls {
            background: white; border-radius: 12px; padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08); height: fit-content;
        }
        .control-group { margin-bottom: 18px; }
        .control-group label {
            display: block; color: #606C38; font-weight: 600;
            margin-bottom: 5px; font-size: 0.9rem;
        }
        .control-group input[type="range"] { width: 100%; accent-color: #8A9A5B; }
        .control-value { text-align: right; color: #8A9A5B; font-size: 0.85rem; }
        button {
            width: 100%; padding: 10px; margin-top: 5px; border: none;
            border-radius: 8px; cursor: pointer; font-family: 'Nunito', sans-serif;
            font-weight: 600; font-size: 0.9rem; transition: all 0.3s;
        }
        .btn-primary { background: #8A9A5B; color: white; }
        .btn-primary:hover { background: #606C38; }
        .btn-secondary { background: #DDA15E; color: white; }
        .btn-secondary:hover { background: #BC6C25; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .stat-box {
            background: linear-gradient(135deg, #FEFAE0, #F4F1DE);
            padding: 10px; border-radius: 8px; text-align: center;
        }
        .stat-value { font-family: 'Lora', serif; color: #606C38; font-size: 1.1rem; font-weight: 600; }
        .stat-label { color: #8A9A5B; font-size: 0.75rem; }
        .info-panel {
            margin-top: 15px; padding: 12px; background: #F4F1DE;
            border-radius: 8px; font-size: 0.8rem; color: #606C38;
        }
        select {
            width: 100%; padding: 8px; border: 1px solid #DDA15E;
            border-radius: 6px; font-family: 'Nunito', sans-serif;
            background: white; color: #606C38;
        }
        .status-indicator {
            margin-top: 10px; padding: 10px; border-radius: 6px;
            text-align: center; font-weight: 600;
        }
        .status-healthy { background: #90EE90; color: #228B22; }
        .status-overfished { background: #FFB6C1; color: #DC143C; }
        .status-collapsed { background: #DC143C; color: white; }
        .scenario-btn { width: 100%; padding: 8px; margin-top: 5px; font-size: 0.8rem; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Gallery</a>

    <div class="container">
        <header>
            <h1>Fishery Management Simulation</h1>
            <p class="subtitle">Maximum Sustainable Yield, quota systems, and stock assessment</p>
        </header>

        <div class="main-content">
            <div class="canvas-container">
                <canvas id="simCanvas"></canvas>
            </div>

            <div class="controls">
                <div class="status-indicator status-healthy" id="stockStatus">
                    Stock Status: Healthy
                </div>

                <div class="control-group">
                    <label>Management Strategy</label>
                    <select id="strategy">
                        <option value="none">No Management (Open Access)</option>
                        <option value="fixed-quota">Fixed Quota</option>
                        <option value="msy" selected>MSY-Based Quota</option>
                        <option value="precautionary">Precautionary (80% MSY)</option>
                        <option value="effort">Effort Control</option>
                    </select>
                </div>

                <div class="control-group">
                    <label>Carrying Capacity (K)</label>
                    <input type="range" id="carryingCapacity" min="5000" max="20000" step="1000" value="10000">
                    <div class="control-value"><span id="carryingCapacityVal">10000</span> fish</div>
                </div>

                <div class="control-group">
                    <label>Intrinsic Growth Rate (r)</label>
                    <input type="range" id="growthRate" min="0.1" max="0.8" step="0.05" value="0.4">
                    <div class="control-value"><span id="growthRateVal">0.4</span></div>
                </div>

                <div class="control-group">
                    <label>Fishing Effort (for effort control)</label>
                    <input type="range" id="fishingEffort" min="0" max="100" value="30">
                    <div class="control-value"><span id="fishingEffortVal">30</span>%</div>
                </div>

                <div class="control-group">
                    <label>Assessment Uncertainty</label>
                    <input type="range" id="uncertainty" min="0" max="50" value="15">
                    <div class="control-value">±<span id="uncertaintyVal">15</span>%</div>
                </div>

                <button class="btn-primary" onclick="startSimulation()">Start Simulation</button>
                <button class="btn-secondary" onclick="resetSimulation()">Reset</button>

                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="stockSize">0</div>
                        <div class="stat-label">Stock (B)</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="bmsy">0</div>
                        <div class="stat-label">BMSY</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="currentCatch">0</div>
                        <div class="stat-label">Catch/Year</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="msyValue">0</div>
                        <div class="stat-label">MSY</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="fMortality">0</div>
                        <div class="stat-label">F Mortality</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="totalCatch">0</div>
                        <div class="stat-label">Total Catch</div>
                    </div>
                </div>

                <div class="info-panel">
                    <strong>Schaefer Model:</strong> dB/dt = rB(1-B/K) - C<br>
                    <strong>MSY</strong> = rK/4 at <strong>BMSY</strong> = K/2<br>
                    Open access leads to tragedy of commons.
                </div>

                <div class="control-group" style="margin-top:15px">
                    <label>Scenarios</label>
                    <button class="scenario-btn btn-secondary" onclick="loadPreset('sustainable')">Sustainable Fishery</button>
                    <button class="scenario-btn btn-secondary" onclick="loadPreset('collapse')">Stock Collapse</button>
                    <button class="scenario-btn btn-secondary" onclick="loadPreset('recovery')">Recovery Plan</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');

        function setupCanvas() {
            const rect = canvas.parentElement.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            canvas.width = rect.width * dpr;
            canvas.height = (rect.width * 0.65) * dpr;
            canvas.style.height = (rect.width * 0.65) + 'px';
            ctx.scale(dpr, dpr);
            return { width: rect.width, height: rect.width * 0.65 };
        }

        let dims = setupCanvas();
        window.addEventListener('resize', () => { dims = setupCanvas(); draw(); });

        // Simulation state
        let state = {
            year: 0,
            running: false,
            stock: 0,
            totalCatch: 0,
            stockHistory: [],
            catchHistory: [],
            fHistory: [],
            fish: [],
            boats: []
        };

        const simulationYears = 50;

        // Calculate MSY reference points
        function calculateReferencePoints() {
            const K = parseInt(document.getElementById('carryingCapacity').value);
            const r = parseFloat(document.getElementById('growthRate').value);
            const msy = (r * K) / 4;
            const bmsy = K / 2;
            const fmsy = r / 2;
            return { msy, bmsy, fmsy, K, r };
        }

        // Initialize
        function initSimulation() {
            const refs = calculateReferencePoints();
            state = {
                year: 0,
                running: false,
                stock: refs.K * 0.9, // Start at 90% carrying capacity
                totalCatch: 0,
                stockHistory: [],
                catchHistory: [],
                fHistory: [],
                fish: [],
                boats: []
            };

            // Initialize visual fish
            for (let i = 0; i < 100; i++) {
                state.fish.push(createFish());
            }

            // Initialize boats
            for (let i = 0; i < 5; i++) {
                state.boats.push(createBoat());
            }

            updateUI();
        }

        function createFish() {
            return {
                x: Math.random() * 400 + 50,
                y: Math.random() * 250 + 50,
                vx: (Math.random() - 0.5) * 2,
                vy: (Math.random() - 0.5) * 1,
                size: 3 + Math.random() * 3
            };
        }

        function createBoat() {
            return {
                x: 50 + Math.random() * 400,
                y: 30,
                target: null,
                returning: false
            };
        }

        // Schaefer biomass dynamics
        function updateStock() {
            const refs = calculateReferencePoints();
            const strategy = document.getElementById('strategy').value;
            const effort = parseInt(document.getElementById('fishingEffort').value) / 100;
            const uncertainty = parseInt(document.getElementById('uncertainty').value) / 100;

            // Population growth (logistic)
            const growth = refs.r * state.stock * (1 - state.stock / refs.K);

            // Determine catch based on strategy
            let targetCatch = 0;
            let actualF = 0;

            // Observed stock (with uncertainty)
            const observedStock = state.stock * (1 + (Math.random() - 0.5) * 2 * uncertainty);

            switch (strategy) {
                case 'none':
                    // Open access: catch proportional to stock, increasing effort
                    actualF = 0.1 + 0.5 * (state.year / simulationYears);
                    targetCatch = state.stock * actualF;
                    break;

                case 'fixed-quota':
                    targetCatch = refs.msy * 0.9;
                    actualF = targetCatch / Math.max(state.stock, 100);
                    break;

                case 'msy':
                    // Try to fish at FMSY
                    actualF = refs.fmsy;
                    if (observedStock < refs.bmsy) {
                        actualF *= observedStock / refs.bmsy; // Reduce effort if below BMSY
                    }
                    targetCatch = state.stock * actualF;
                    break;

                case 'precautionary':
                    // 80% of MSY-based catch
                    actualF = refs.fmsy * 0.8;
                    if (observedStock < refs.bmsy) {
                        actualF *= (observedStock / refs.bmsy) * 0.8;
                    }
                    targetCatch = state.stock * actualF;
                    break;

                case 'effort':
                    actualF = effort * refs.fmsy * 2;
                    targetCatch = state.stock * actualF;
                    break;
            }

            // Cannot catch more than available
            const actualCatch = Math.min(targetCatch, state.stock * 0.9);

            // Update stock
            state.stock = Math.max(0, state.stock + growth - actualCatch);

            // Record history
            state.stockHistory.push(state.stock);
            state.catchHistory.push(actualCatch);
            state.fHistory.push(actualF);
            state.totalCatch += actualCatch;

            return { catch_: actualCatch, f: actualF, growth };
        }

        // Update visualization agents
        function updateVisualization() {
            const refs = calculateReferencePoints();

            // Target number of visual fish
            const targetFish = Math.round((state.stock / refs.K) * 150);

            // Add or remove fish
            while (state.fish.length < targetFish && state.fish.length < 200) {
                state.fish.push(createFish());
            }
            while (state.fish.length > targetFish && state.fish.length > 0) {
                state.fish.pop();
            }

            // Update fish movement
            state.fish.forEach(fish => {
                fish.x += fish.vx;
                fish.y += fish.vy;

                // Schooling behavior
                let avgX = 0, avgY = 0, count = 0;
                state.fish.forEach(other => {
                    const dx = other.x - fish.x;
                    const dy = other.y - fish.y;
                    if (dx * dx + dy * dy < 2000) {
                        avgX += other.x;
                        avgY += other.y;
                        count++;
                    }
                });
                if (count > 0) {
                    fish.vx += (avgX / count - fish.x) * 0.01;
                    fish.vy += (avgY / count - fish.y) * 0.01;
                }

                // Bounds
                if (fish.x < 50 || fish.x > 450) fish.vx *= -1;
                if (fish.y < 50 || fish.y > 280) fish.vy *= -1;

                fish.x = Math.max(50, Math.min(450, fish.x));
                fish.y = Math.max(50, Math.min(280, fish.y));

                // Speed limit
                const speed = Math.sqrt(fish.vx * fish.vx + fish.vy * fish.vy);
                if (speed > 2) {
                    fish.vx *= 2 / speed;
                    fish.vy *= 2 / speed;
                }

                // Random perturbation
                fish.vx += (Math.random() - 0.5) * 0.2;
                fish.vy += (Math.random() - 0.5) * 0.1;
            });

            // Update boats based on fishing effort
            const currentF = state.fHistory[state.fHistory.length - 1] || 0;
            const activeBoats = Math.ceil(currentF * 10);

            state.boats.forEach((boat, i) => {
                if (i < activeBoats) {
                    // Active fishing
                    if (!boat.target && state.fish.length > 0) {
                        boat.target = state.fish[Math.floor(Math.random() * state.fish.length)];
                        boat.returning = false;
                    }

                    if (boat.target && !boat.returning) {
                        const dx = boat.target.x - boat.x;
                        const dy = boat.target.y - boat.y;
                        const dist = Math.sqrt(dx * dx + dy * dy);
                        if (dist > 5) {
                            boat.x += dx / dist * 1.5;
                            boat.y += dy / dist * 1;
                        } else {
                            boat.returning = true;
                            boat.target = null;
                        }
                    } else if (boat.returning) {
                        boat.y -= 1;
                        if (boat.y < 35) {
                            boat.returning = false;
                            boat.y = 30;
                        }
                    }
                } else {
                    // Idle at harbor
                    boat.y = 30;
                }
            });
        }

        // Update UI
        function updateUI() {
            const refs = calculateReferencePoints();
            const currentF = state.fHistory[state.fHistory.length - 1] || 0;
            const currentCatch = state.catchHistory[state.catchHistory.length - 1] || 0;

            document.getElementById('stockSize').textContent = Math.round(state.stock);
            document.getElementById('bmsy').textContent = Math.round(refs.bmsy);
            document.getElementById('currentCatch').textContent = Math.round(currentCatch);
            document.getElementById('msyValue').textContent = Math.round(refs.msy);
            document.getElementById('fMortality').textContent = currentF.toFixed(2);
            document.getElementById('totalCatch').textContent = Math.round(state.totalCatch);

            // Stock status
            const indicator = document.getElementById('stockStatus');
            const bRatio = state.stock / refs.bmsy;

            if (state.stock < refs.K * 0.1) {
                indicator.className = 'status-indicator status-collapsed';
                indicator.textContent = 'STOCK COLLAPSED!';
            } else if (bRatio < 0.5 || currentF > refs.fmsy * 1.5) {
                indicator.className = 'status-indicator status-overfished';
                indicator.textContent = 'Overfished / Overfishing';
            } else {
                indicator.className = 'status-indicator status-healthy';
                indicator.textContent = 'Stock Status: Healthy';
            }
        }

        // Main update loop
        function update() {
            if (!state.running || state.year >= simulationYears) {
                state.running = false;
                return;
            }

            state.year++;
            updateStock();
            updateUI();

            // Visual updates (multiple per year)
            let frame = 0;
            const animate = () => {
                if (frame < 30) {
                    updateVisualization();
                    draw();
                    frame++;
                    requestAnimationFrame(animate);
                } else {
                    setTimeout(update, 100);
                }
            };
            animate();
        }

        // Draw
        function draw() {
            ctx.clearRect(0, 0, dims.width, dims.height);

            const refs = calculateReferencePoints();

            // Ocean area
            const oceanX = 30, oceanY = 40;
            const oceanW = dims.width * 0.5, oceanH = dims.height - 100;

            // Gradient ocean
            const gradient = ctx.createLinearGradient(oceanX, oceanY, oceanX, oceanY + oceanH);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(0.3, '#4682B4');
            gradient.addColorStop(1, '#1a3a5c');
            ctx.fillStyle = gradient;
            ctx.fillRect(oceanX, oceanY, oceanW, oceanH);

            // Draw fish
            ctx.fillStyle = '#C0C0C0';
            state.fish.forEach(fish => {
                const x = oceanX + (fish.x - 50) * (oceanW / 400);
                const y = oceanY + (fish.y - 50) * (oceanH / 250);

                ctx.beginPath();
                ctx.ellipse(x, y, fish.size * 2, fish.size, fish.vx > 0 ? 0 : Math.PI, 0, Math.PI * 2);
                ctx.fill();

                // Tail
                ctx.beginPath();
                const tailX = fish.vx > 0 ? x - fish.size * 2 : x + fish.size * 2;
                ctx.moveTo(tailX, y);
                ctx.lineTo(tailX + (fish.vx > 0 ? -6 : 6), y - 4);
                ctx.lineTo(tailX + (fish.vx > 0 ? -6 : 6), y + 4);
                ctx.closePath();
                ctx.fill();
            });

            // Draw boats
            state.boats.forEach((boat, i) => {
                const x = oceanX + (boat.x - 50) * (oceanW / 400);
                const y = oceanY + (boat.y - 30) * (oceanH / 280);

                if (boat.y > 30) {
                    // Boat hull
                    ctx.fillStyle = '#8B4513';
                    ctx.beginPath();
                    ctx.moveTo(x - 10, y);
                    ctx.lineTo(x + 10, y);
                    ctx.lineTo(x + 7, y + 8);
                    ctx.lineTo(x - 7, y + 8);
                    ctx.closePath();
                    ctx.fill();

                    // Mast and sail
                    ctx.fillStyle = 'white';
                    ctx.beginPath();
                    ctx.moveTo(x, y - 15);
                    ctx.lineTo(x + 8, y);
                    ctx.lineTo(x, y);
                    ctx.closePath();
                    ctx.fill();
                }
            });

            // Charts on right side
            const chartX = dims.width * 0.55;
            const chartW = dims.width * 0.4;
            const chartH = 70;

            // Stock history
            drawStockChart(chartX, 50, chartW, chartH, refs);

            // Catch history
            drawCatchChart(chartX, 145, chartW, chartH, refs);

            // Fishing mortality
            drawFChart(chartX, 240, chartW, chartH, refs);

            // Title
            ctx.fillStyle = '#606C38';
            ctx.font = '14px Lora';
            ctx.fillText(`Year ${state.year}/${simulationYears} | Stock: ${Math.round(state.stock)} / K: ${refs.K}`, oceanX, 28);

            // Legend
            ctx.font = '10px Nunito';
            ctx.fillText(`MSY=${Math.round(refs.msy)} | BMSY=${Math.round(refs.bmsy)} | FMSY=${refs.fmsy.toFixed(2)}`, oceanX, dims.height - 15);
        }

        function drawStockChart(x, y, w, h, refs) {
            ctx.fillStyle = 'rgba(255,255,255,0.9)';
            ctx.fillRect(x, y, w, h);
            ctx.strokeStyle = '#ddd';
            ctx.strokeRect(x, y, w, h);

            ctx.fillStyle = '#606C38';
            ctx.font = '11px Nunito';
            ctx.fillText('Stock Biomass (B)', x + 5, y - 5);

            // BMSY reference line
            const maxVal = refs.K;
            const bmsyY = y + h - (refs.bmsy / maxVal) * h;
            ctx.strokeStyle = '#FFD700';
            ctx.setLineDash([5, 3]);
            ctx.beginPath();
            ctx.moveTo(x, bmsyY);
            ctx.lineTo(x + w, bmsyY);
            ctx.stroke();
            ctx.setLineDash([]);
            ctx.fillStyle = '#DAA520';
            ctx.fillText('BMSY', x + w + 3, bmsyY + 3);

            if (state.stockHistory.length < 2) return;

            const step = w / Math.max(state.stockHistory.length - 1, 1);

            ctx.beginPath();
            ctx.strokeStyle = '#4682B4';
            ctx.lineWidth = 2;
            state.stockHistory.forEach((val, i) => {
                const px = x + i * step;
                const py = y + h - (val / maxVal) * h;
                if (i === 0) ctx.moveTo(px, py);
                else ctx.lineTo(px, py);
            });
            ctx.stroke();
            ctx.lineWidth = 1;
        }

        function drawCatchChart(x, y, w, h, refs) {
            ctx.fillStyle = 'rgba(255,255,255,0.9)';
            ctx.fillRect(x, y, w, h);
            ctx.strokeStyle = '#ddd';
            ctx.strokeRect(x, y, w, h);

            ctx.fillStyle = '#606C38';
            ctx.font = '11px Nunito';
            ctx.fillText('Annual Catch', x + 5, y - 5);

            // MSY reference line
            const maxVal = Math.max(...state.catchHistory, refs.msy * 1.5, 1);
            const msyY = y + h - (refs.msy / maxVal) * h;
            ctx.strokeStyle = '#228B22';
            ctx.setLineDash([5, 3]);
            ctx.beginPath();
            ctx.moveTo(x, msyY);
            ctx.lineTo(x + w, msyY);
            ctx.stroke();
            ctx.setLineDash([]);
            ctx.fillStyle = '#228B22';
            ctx.fillText('MSY', x + w + 3, msyY + 3);

            if (state.catchHistory.length < 2) return;

            const step = w / Math.max(state.catchHistory.length - 1, 1);

            ctx.beginPath();
            ctx.strokeStyle = '#BC6C25';
            ctx.lineWidth = 2;
            state.catchHistory.forEach((val, i) => {
                const px = x + i * step;
                const py = y + h - (val / maxVal) * h;
                if (i === 0) ctx.moveTo(px, py);
                else ctx.lineTo(px, py);
            });
            ctx.stroke();
            ctx.lineWidth = 1;
        }

        function drawFChart(x, y, w, h, refs) {
            ctx.fillStyle = 'rgba(255,255,255,0.9)';
            ctx.fillRect(x, y, w, h);
            ctx.strokeStyle = '#ddd';
            ctx.strokeRect(x, y, w, h);

            ctx.fillStyle = '#606C38';
            ctx.font = '11px Nunito';
            ctx.fillText('Fishing Mortality (F)', x + 5, y - 5);

            // FMSY reference line
            const maxVal = Math.max(...state.fHistory, refs.fmsy * 2, 0.5);
            const fmsyY = y + h - (refs.fmsy / maxVal) * h;
            ctx.strokeStyle = '#FF6347';
            ctx.setLineDash([5, 3]);
            ctx.beginPath();
            ctx.moveTo(x, fmsyY);
            ctx.lineTo(x + w, fmsyY);
            ctx.stroke();
            ctx.setLineDash([]);
            ctx.fillStyle = '#FF6347';
            ctx.fillText('FMSY', x + w + 3, fmsyY + 3);

            if (state.fHistory.length < 2) return;

            const step = w / Math.max(state.fHistory.length - 1, 1);

            ctx.beginPath();
            ctx.strokeStyle = '#8B0000';
            ctx.lineWidth = 2;
            state.fHistory.forEach((val, i) => {
                const px = x + i * step;
                const py = y + h - (val / maxVal) * h;
                if (i === 0) ctx.moveTo(px, py);
                else ctx.lineTo(px, py);
            });
            ctx.stroke();
            ctx.lineWidth = 1;
        }

        // Controls
        function startSimulation() {
            if (!state.running) {
                state.running = true;
                update();
            }
        }

        function resetSimulation() {
            initSimulation();
            draw();
        }

        function loadPreset(name) {
            if (name === 'sustainable') {
                document.getElementById('strategy').value = 'precautionary';
                document.getElementById('growthRate').value = 0.4;
                document.getElementById('uncertainty').value = 10;
            } else if (name === 'collapse') {
                document.getElementById('strategy').value = 'none';
                document.getElementById('growthRate').value = 0.3;
                document.getElementById('uncertainty').value = 30;
            } else if (name === 'recovery') {
                document.getElementById('strategy').value = 'effort';
                document.getElementById('fishingEffort').value = 10;
                document.getElementById('growthRate').value = 0.5;
            }
            updateSliderDisplays();
            resetSimulation();
        }

        function updateSliderDisplays() {
            document.getElementById('carryingCapacityVal').textContent = document.getElementById('carryingCapacity').value;
            document.getElementById('growthRateVal').textContent = document.getElementById('growthRate').value;
            document.getElementById('fishingEffortVal').textContent = document.getElementById('fishingEffort').value;
            document.getElementById('uncertaintyVal').textContent = document.getElementById('uncertainty').value;
        }

        document.querySelectorAll('input[type="range"]').forEach(slider => {
            slider.addEventListener('input', updateSliderDisplays);
        });

        // Initialize
        initSimulation();
        draw();
    </script>
</body>
</html>
