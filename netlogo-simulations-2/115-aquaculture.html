<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aquaculture - Fish Farm Simulation</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600&family=Nunito:wght@400;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Nunito', sans-serif; background: linear-gradient(135deg, #FEFAE0 0%, #F4F1DE 50%, #EDE8D5 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 20px; }
        h1 { font-family: 'Lora', serif; color: #606C38; font-size: 2rem; margin-bottom: 8px; }
        .subtitle { color: #8A9A5B; font-size: 1rem; }
        .back-link { position: absolute; top: 20px; left: 20px; text-decoration: none; color: #606C38; font-weight: 600; display: flex; align-items: center; gap: 5px; transition: color 0.3s; }
        .back-link:hover { color: #BC6C25; }
        .main-content { display: grid; grid-template-columns: 1fr 300px; gap: 20px; }
        .canvas-container { background: white; border-radius: 12px; padding: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        canvas { width: 100%; border-radius: 8px; display: block; }
        .controls { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); height: fit-content; }
        .control-group { margin-bottom: 18px; }
        .control-group label { display: block; color: #606C38; font-weight: 600; margin-bottom: 5px; font-size: 0.9rem; }
        .control-group input[type="range"] { width: 100%; accent-color: #8A9A5B; }
        .control-value { text-align: right; color: #8A9A5B; font-size: 0.85rem; }
        button { width: 100%; padding: 10px; margin-top: 5px; border: none; border-radius: 8px; cursor: pointer; font-family: 'Nunito', sans-serif; font-weight: 600; font-size: 0.9rem; transition: all 0.3s; }
        .btn-primary { background: #8A9A5B; color: white; }
        .btn-primary:hover { background: #606C38; }
        .btn-secondary { background: #DDA15E; color: white; }
        .btn-secondary:hover { background: #BC6C25; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .stat-box { background: linear-gradient(135deg, #FEFAE0, #F4F1DE); padding: 10px; border-radius: 8px; text-align: center; }
        .stat-value { font-family: 'Lora', serif; color: #606C38; font-size: 1.1rem; font-weight: 600; }
        .stat-label { color: #8A9A5B; font-size: 0.75rem; }
        .info-panel { margin-top: 15px; padding: 12px; background: #F4F1DE; border-radius: 8px; font-size: 0.8rem; color: #606C38; }
        select { width: 100%; padding: 8px; border: 1px solid #DDA15E; border-radius: 6px; font-family: 'Nunito', sans-serif; background: white; color: #606C38; }
        .scenario-btn { width: 100%; padding: 8px; margin-top: 5px; font-size: 0.8rem; }
        .water-quality { margin-top: 10px; padding: 10px; border-radius: 6px; text-align: center; font-weight: 600; }
        .quality-good { background: #4682B4; color: white; }
        .quality-stress { background: #FFD700; color: #333; }
        .quality-critical { background: #FF6347; color: white; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Gallery</a>
    <div class="container">
        <header>
            <h1>Aquaculture Simulation</h1>
            <p class="subtitle">Fish farm management with feeding, growth, water quality, and disease dynamics</p>
        </header>
        <div class="main-content">
            <div class="canvas-container">
                <canvas id="simCanvas"></canvas>
            </div>
            <div class="controls">
                <div class="water-quality quality-good" id="qualityMeter">Water Quality: Good</div>
                <div class="control-group">
                    <label>Fish Species</label>
                    <select id="species">
                        <option value="tilapia">Tilapia (Fast Growth)</option>
                        <option value="salmon" selected>Salmon (Medium)</option>
                        <option value="catfish">Catfish (Hardy)</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Stocking Density (fish/m³)</label>
                    <input type="range" id="density" min="10" max="100" value="40">
                    <div class="control-value"><span id="densityVal">40</span></div>
                </div>
                <div class="control-group">
                    <label>Feed Rate (%BW/day)</label>
                    <input type="range" id="feedRate" min="1" max="5" step="0.5" value="3">
                    <div class="control-value"><span id="feedRateVal">3</span>%</div>
                </div>
                <div class="control-group">
                    <label>Water Exchange Rate (%/day)</label>
                    <input type="range" id="waterExchange" min="5" max="50" value="20">
                    <div class="control-value"><span id="waterExchangeVal">20</span>%</div>
                </div>
                <div class="control-group">
                    <label>Aeration Level</label>
                    <input type="range" id="aeration" min="1" max="10" value="5">
                    <div class="control-value"><span id="aerationVal">5</span></div>
                </div>
                <button class="btn-primary" onclick="startSimulation()">Start Growing Cycle</button>
                <button class="btn-secondary" onclick="resetSimulation()">Reset</button>
                <div class="stats-grid">
                    <div class="stat-box"><div class="stat-value" id="fishCount">0</div><div class="stat-label">Fish Count</div></div>
                    <div class="stat-box"><div class="stat-value" id="avgWeight">0g</div><div class="stat-label">Avg Weight</div></div>
                    <div class="stat-box"><div class="stat-value" id="oxygenLevel">0</div><div class="stat-label">O₂ (mg/L)</div></div>
                    <div class="stat-box"><div class="stat-value" id="ammoniaLevel">0</div><div class="stat-label">NH₃ (mg/L)</div></div>
                    <div class="stat-box"><div class="stat-value" id="fcr">0</div><div class="stat-label">FCR</div></div>
                    <div class="stat-box"><div class="stat-value" id="biomass">0</div><div class="stat-label">Biomass (kg)</div></div>
                </div>
                <div class="info-panel">
                    <strong>FCR:</strong> Feed Conversion Ratio (lower is better).<br>
                    <strong>Stress:</strong> High density + low O₂ + high NH₃ = disease risk.
                </div>
                <div class="control-group" style="margin-top:15px">
                    <label>Scenarios</label>
                    <button class="scenario-btn btn-secondary" onclick="loadPreset('optimal')">Optimal Setup</button>
                    <button class="scenario-btn btn-secondary" onclick="loadPreset('intensive')">Intensive</button>
                    <button class="scenario-btn btn-secondary" onclick="loadPreset('outbreak')">Disease Outbreak</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        function setupCanvas() {
            const rect = canvas.parentElement.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            canvas.width = rect.width * dpr;
            canvas.height = (rect.width * 0.6) * dpr;
            canvas.style.height = (rect.width * 0.6) + 'px';
            ctx.scale(dpr, dpr);
            return { width: rect.width, height: rect.width * 0.6 };
        }
        let dims = setupCanvas();
        window.addEventListener('resize', () => { dims = setupCanvas(); draw(); });

        const speciesParams = {
            tilapia: { growthRate: 1.5, optimalTemp: 28, diseaseRes: 0.7, maxWeight: 500 },
            salmon: { growthRate: 1.0, optimalTemp: 14, diseaseRes: 0.5, maxWeight: 4000 },
            catfish: { growthRate: 0.8, optimalTemp: 26, diseaseRes: 0.9, maxWeight: 1500 }
        };

        let state = { day: 0, running: false, fish: [], oxygen: 8, ammonia: 0.1, totalFeed: 0, biomassHistory: [], oxygenHistory: [] };
        const cycleDays = 180;

        function initSimulation() {
            const density = parseInt(document.getElementById('density').value);
            const numFish = Math.floor(density * 2);
            state = { day: 0, running: false, fish: [], oxygen: 8, ammonia: 0.1, totalFeed: 0, mortality: 0, biomassHistory: [], oxygenHistory: [], ammoniaHistory: [] };
            for (let i = 0; i < numFish; i++) {
                state.fish.push({
                    x: Math.random() * 100, y: Math.random() * 100,
                    weight: 20 + Math.random() * 10,
                    health: 100, vx: (Math.random() - 0.5) * 2, vy: (Math.random() - 0.5) * 1
                });
            }
        }

        function update() {
            if (!state.running || state.day >= cycleDays) { state.running = false; return; }

            const species = document.getElementById('species').value;
            const sp = speciesParams[species];
            const feedRate = parseFloat(document.getElementById('feedRate').value) / 100;
            const waterExchange = parseInt(document.getElementById('waterExchange').value) / 100;
            const aeration = parseInt(document.getElementById('aeration').value);
            const density = state.fish.length / 2;

            // Water quality dynamics
            const biomass = state.fish.reduce((s, f) => s + f.weight, 0) / 1000;
            const oxygenConsumption = biomass * 0.01 + density * 0.005;
            const oxygenProduction = aeration * 0.8;
            state.oxygen = Math.max(2, Math.min(10, state.oxygen - oxygenConsumption + oxygenProduction + waterExchange * 2));

            const ammoniaProduction = biomass * feedRate * 0.05;
            state.ammonia = Math.max(0, state.ammonia + ammoniaProduction - waterExchange * state.ammonia * 0.5);

            // Stress factor
            const stress = Math.max(0, (state.ammonia - 0.5) * 20 + (6 - state.oxygen) * 10 + (density - 50) * 0.5);

            // Fish growth and survival
            const deadFish = [];
            state.fish.forEach((fish, i) => {
                const growthFactor = (1 - stress / 100) * sp.growthRate;
                const feedPerFish = fish.weight * feedRate;
                state.totalFeed += feedPerFish / 1000;
                fish.weight = Math.min(sp.maxWeight, fish.weight + feedPerFish * 0.8 * growthFactor);

                // Health dynamics
                fish.health -= stress * 0.05 * (1 - sp.diseaseRes);
                if (Math.random() < 0.001 * (1 - sp.diseaseRes) * (stress / 50)) fish.health -= 20;
                if (fish.health <= 0) deadFish.push(i);

                // Movement
                fish.x += fish.vx; fish.y += fish.vy;
                if (fish.x < 0 || fish.x > 100) fish.vx *= -1;
                if (fish.y < 0 || fish.y > 100) fish.vy *= -1;
                fish.x = Math.max(0, Math.min(100, fish.x));
                fish.y = Math.max(0, Math.min(100, fish.y));
                fish.vx += (Math.random() - 0.5) * 0.3;
                fish.vy += (Math.random() - 0.5) * 0.2;
            });

            deadFish.reverse().forEach(i => { state.fish.splice(i, 1); state.mortality++; });

            state.biomassHistory.push(biomass);
            state.oxygenHistory.push(state.oxygen);
            state.ammoniaHistory.push(state.ammonia);
            state.day++;
            updateUI();
            draw();
            setTimeout(update, 50);
        }

        function updateUI() {
            const biomass = state.fish.reduce((s, f) => s + f.weight, 0) / 1000;
            const avgWeight = state.fish.length > 0 ? state.fish.reduce((s, f) => s + f.weight, 0) / state.fish.length : 0;
            const fcr = biomass > 0.5 ? state.totalFeed / biomass : 0;

            document.getElementById('fishCount').textContent = state.fish.length;
            document.getElementById('avgWeight').textContent = Math.round(avgWeight) + 'g';
            document.getElementById('oxygenLevel').textContent = state.oxygen.toFixed(1);
            document.getElementById('ammoniaLevel').textContent = state.ammonia.toFixed(2);
            document.getElementById('fcr').textContent = fcr.toFixed(2);
            document.getElementById('biomass').textContent = biomass.toFixed(1);

            const meter = document.getElementById('qualityMeter');
            if (state.oxygen > 6 && state.ammonia < 0.5) {
                meter.className = 'water-quality quality-good';
                meter.textContent = 'Water Quality: Good';
            } else if (state.oxygen > 4 || state.ammonia < 1) {
                meter.className = 'water-quality quality-stress';
                meter.textContent = 'Water Quality: Stressful';
            } else {
                meter.className = 'water-quality quality-critical';
                meter.textContent = 'Water Quality: Critical!';
            }
        }

        function draw() {
            ctx.clearRect(0, 0, dims.width, dims.height);

            // Tank
            const tankX = 20, tankY = 45, tankW = dims.width * 0.5, tankH = dims.height - 80;
            const waterGrad = ctx.createLinearGradient(tankX, tankY, tankX, tankY + tankH);
            const blueVal = Math.floor(150 + state.oxygen * 10);
            waterGrad.addColorStop(0, `rgb(100, ${blueVal}, 220)`);
            waterGrad.addColorStop(1, `rgb(30, ${blueVal - 50}, 150)`);
            ctx.fillStyle = waterGrad;
            ctx.fillRect(tankX, tankY, tankW, tankH);

            // Ammonia tint
            if (state.ammonia > 0.3) {
                ctx.fillStyle = `rgba(139, 90, 43, ${Math.min(0.4, state.ammonia * 0.2)})`;
                ctx.fillRect(tankX, tankY, tankW, tankH);
            }

            // Bubbles
            for (let i = 0; i < parseInt(document.getElementById('aeration').value) * 3; i++) {
                const bx = tankX + 30 + Math.random() * (tankW - 60);
                const by = tankY + tankH - 20 - ((state.day * 3 + i * 40) % (tankH - 40));
                ctx.fillStyle = 'rgba(255,255,255,0.5)';
                ctx.beginPath();
                ctx.arc(bx, by, 2 + Math.random() * 3, 0, Math.PI * 2);
                ctx.fill();
            }

            // Fish
            state.fish.forEach(f => {
                const fx = tankX + (f.x / 100) * tankW;
                const fy = tankY + (f.y / 100) * tankH;
                const size = 3 + (f.weight / 500) * 8;

                ctx.fillStyle = f.health > 70 ? '#C0C0C0' : f.health > 40 ? '#A0A0A0' : '#808080';
                ctx.beginPath();
                ctx.ellipse(fx, fy, size * 1.5, size, f.vx > 0 ? 0 : Math.PI, 0, Math.PI * 2);
                ctx.fill();

                // Tail
                const tailDir = f.vx > 0 ? -1 : 1;
                ctx.beginPath();
                ctx.moveTo(fx + tailDir * size * 1.5, fy);
                ctx.lineTo(fx + tailDir * (size * 2.5), fy - size * 0.8);
                ctx.lineTo(fx + tailDir * (size * 2.5), fy + size * 0.8);
                ctx.closePath();
                ctx.fill();
            });

            // Tank frame
            ctx.strokeStyle = '#555';
            ctx.lineWidth = 3;
            ctx.strokeRect(tankX, tankY, tankW, tankH);

            // Charts
            const chartX = dims.width * 0.55, chartW = dims.width * 0.4, chartH = 55;
            drawChart(chartX, 50, chartW, chartH, state.biomassHistory, '#228B22', 'Biomass (kg)');
            drawChart(chartX, 120, chartW, chartH, state.oxygenHistory, '#4682B4', 'Oxygen (mg/L)');
            drawChart(chartX, 190, chartW, chartH, state.ammoniaHistory, '#BC6C25', 'Ammonia (mg/L)');

            ctx.fillStyle = '#606C38';
            ctx.font = '14px Lora';
            ctx.fillText(`Day ${state.day}/${cycleDays} | Mortality: ${state.mortality}`, 20, 35);
        }

        function drawChart(x, y, w, h, data, color, label) {
            ctx.fillStyle = 'rgba(255,255,255,0.9)';
            ctx.fillRect(x, y, w, h);
            ctx.strokeRect(x, y, w, h);
            ctx.fillStyle = '#606C38';
            ctx.font = '10px Nunito';
            ctx.fillText(label, x + 5, y - 3);
            if (data.length < 2) return;
            const maxVal = Math.max(...data, 0.1);
            const step = w / Math.max(data.length - 1, 1);
            ctx.beginPath();
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            data.forEach((val, i) => {
                const px = x + i * step, py = y + h - 5 - (val / maxVal) * (h - 10);
                if (i === 0) ctx.moveTo(px, py); else ctx.lineTo(px, py);
            });
            ctx.stroke();
            ctx.lineWidth = 1;
        }

        function startSimulation() { if (!state.running) { state.running = true; update(); } }
        function resetSimulation() { initSimulation(); draw(); updateUI(); }
        function loadPreset(name) {
            if (name === 'optimal') {
                document.getElementById('species').value = 'salmon';
                document.getElementById('density').value = 35;
                document.getElementById('feedRate').value = 2.5;
                document.getElementById('waterExchange').value = 25;
                document.getElementById('aeration').value = 7;
            } else if (name === 'intensive') {
                document.getElementById('species').value = 'tilapia';
                document.getElementById('density').value = 80;
                document.getElementById('feedRate').value = 4;
                document.getElementById('waterExchange').value = 40;
                document.getElementById('aeration').value = 10;
            } else if (name === 'outbreak') {
                document.getElementById('species').value = 'salmon';
                document.getElementById('density').value = 70;
                document.getElementById('feedRate').value = 4;
                document.getElementById('waterExchange').value = 10;
                document.getElementById('aeration').value = 3;
            }
            updateSliderDisplays();
            resetSimulation();
        }
        function updateSliderDisplays() {
            document.getElementById('densityVal').textContent = document.getElementById('density').value;
            document.getElementById('feedRateVal').textContent = document.getElementById('feedRate').value;
            document.getElementById('waterExchangeVal').textContent = document.getElementById('waterExchange').value;
            document.getElementById('aerationVal').textContent = document.getElementById('aeration').value;
        }
        document.querySelectorAll('input[type="range"]').forEach(s => s.addEventListener('input', updateSliderDisplays));
        initSimulation();
        draw();
    </script>
</body>
</html>
