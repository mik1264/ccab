<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Niche Partitioning - Resource Competition & Coexistence</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 20px; }
        h1 { color: #4ecdc4; font-size: 1.8em; margin-bottom: 5px; }
        .subtitle { color: #888; font-size: 0.95em; }
        .main-content {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 20px;
        }
        .sim-area {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 15px;
        }
        canvas { display: block; border-radius: 8px; background: #0a0a1a; }
        .panel {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 20px;
        }
        .group { margin-bottom: 18px; }
        .group h3 {
            color: #4ecdc4;
            font-size: 0.95em;
            margin-bottom: 10px;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
        }
        .slider-row { margin-bottom: 10px; }
        .slider-row label {
            display: flex;
            justify-content: space-between;
            font-size: 0.85em;
            margin-bottom: 4px;
        }
        .slider-row span:last-child { color: #4ecdc4; font-weight: 600; }
        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #333;
            -webkit-appearance: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #4ecdc4;
            cursor: pointer;
        }
        .btn-row { display: flex; gap: 10px; }
        button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 6px;
            font-size: 0.9em;
            cursor: pointer;
        }
        .btn-primary { background: #4ecdc4; color: #1a1a2e; font-weight: 600; }
        .btn-primary:hover { background: #5fe0d7; }
        .btn-secondary { background: #333; color: #e0e0e0; }
        .btn-secondary:hover { background: #444; }
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        .stat-box {
            background: rgba(78,205,196,0.1);
            border-radius: 6px;
            padding: 10px;
            text-align: center;
        }
        .stat-value { font-size: 1.2em; font-weight: 700; color: #4ecdc4; }
        .stat-label { font-size: 0.7em; color: #888; }
        .species-legend { margin-top: 10px; }
        .species-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8em;
            margin-bottom: 6px;
        }
        .species-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }
        .info-box {
            margin-top: 12px;
            padding: 10px;
            background: rgba(78,205,196,0.1);
            border-radius: 6px;
            border-left: 3px solid #4ecdc4;
        }
        .info-box p { font-size: 0.78em; color: #aaa; line-height: 1.4; }
        .chart-container {
            background: #0a0a1a;
            border-radius: 6px;
            padding: 10px;
            margin-top: 10px;
        }
        a.back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #4ecdc4;
            text-decoration: none;
            font-size: 0.9em;
        }
        a.back-link:hover { text-decoration: underline; }
        @media (max-width: 900px) {
            .main-content { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Gallery</a>
    <div class="container">
        <header>
            <h1>Niche Partitioning & Resource Competition</h1>
            <p class="subtitle">Competitive exclusion vs. coexistence through resource differentiation</p>
        </header>
        <div class="main-content">
            <div class="sim-area">
                <canvas id="canvas" width="800" height="600"></canvas>
            </div>
            <div class="panel">
                <div class="group">
                    <h3>Controls</h3>
                    <div class="btn-row">
                        <button id="startBtn" class="btn-primary">Start</button>
                        <button id="resetBtn" class="btn-secondary">Reset</button>
                    </div>
                </div>
                <div class="group">
                    <h3>Environment</h3>
                    <div class="slider-row">
                        <label><span>Resource Types</span><span id="numResVal">3</span></label>
                        <input type="range" id="numRes" min="1" max="5" value="3">
                    </div>
                    <div class="slider-row">
                        <label><span>Resource Regeneration</span><span id="regenVal">0.05</span></label>
                        <input type="range" id="regen" min="0.01" max="0.15" step="0.01" value="0.05">
                    </div>
                    <div class="slider-row">
                        <label><span>Niche Width</span><span id="nicheVal">0.3</span></label>
                        <input type="range" id="niche" min="0.1" max="0.8" step="0.05" value="0.3">
                    </div>
                </div>
                <div class="group">
                    <h3>Species</h3>
                    <div class="slider-row">
                        <label><span>Number of Species</span><span id="numSpeciesVal">4</span></label>
                        <input type="range" id="numSpecies" min="2" max="6" value="4">
                    </div>
                    <div class="slider-row">
                        <label><span>Competition Strength</span><span id="compVal">0.5</span></label>
                        <input type="range" id="comp" min="0" max="1" step="0.1" value="0.5">
                    </div>
                </div>
                <div class="group">
                    <h3>Population Dynamics</h3>
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-value" id="genStat">0</div>
                            <div class="stat-label">Generation</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="totalPop">0</div>
                            <div class="stat-label">Total Pop</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="extinctStat">0</div>
                            <div class="stat-label">Extinctions</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="coexistStat">0</div>
                            <div class="stat-label">Coexisting</div>
                        </div>
                    </div>
                </div>
                <div class="group">
                    <h3>Species Legend</h3>
                    <div id="legend" class="species-legend"></div>
                </div>
                <div class="group">
                    <h3>Population Over Time</h3>
                    <div class="chart-container">
                        <canvas id="chartCanvas" width="280" height="100"></canvas>
                    </div>
                </div>
                <div class="info-box">
                    <p><strong>Competitive Exclusion:</strong> When species compete for the same resource, one will outcompete the other. <strong>Niche Partitioning:</strong> Species can coexist by specializing on different resources or using resources at different times/places.</p>
                </div>
            </div>
        </div>
    </div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const chartCanvas = document.getElementById('chartCanvas');
        const chartCtx = chartCanvas.getContext('2d');

        const COLORS = ['#ff6b6b', '#4ecdc4', '#ffe66d', '#95e1d3', '#f38181', '#aa96da'];
        const RES_COLORS = ['#2ecc71', '#3498db', '#e74c3c', '#f39c12', '#9b59b6'];

        let species = [];
        let resources = [];
        let generation = 0;
        let running = false;
        let animId = null;
        let history = [];

        // Parameters
        let numResourceTypes = 3;
        let regenRate = 0.05;
        let nicheWidth = 0.3;
        let numSpecies = 4;
        let competitionStrength = 0.5;

        const gridSize = 80;
        const cellSize = canvas.width / gridSize;

        class Species {
            constructor(id, niche) {
                this.id = id;
                this.color = COLORS[id % COLORS.length];
                this.niche = niche; // 0-1, which resource type preferred
                this.population = 50;
                this.agents = [];
                this.extinct = false;
            }

            initAgents() {
                this.agents = [];
                for (let i = 0; i < this.population; i++) {
                    this.agents.push({
                        x: Math.random() * gridSize,
                        y: Math.random() * gridSize,
                        energy: 50
                    });
                }
            }

            getNicheEfficiency(resourceType, numTypes) {
                const resPref = resourceType / (numTypes - 1 || 1);
                const diff = Math.abs(this.niche - resPref);
                // Gaussian-like efficiency based on niche width
                return Math.exp(-diff * diff / (2 * nicheWidth * nicheWidth));
            }
        }

        function init() {
            generation = 0;
            history = [];

            // Create resource grid
            resources = [];
            for (let x = 0; x < gridSize; x++) {
                resources[x] = [];
                for (let y = 0; y < gridSize; y++) {
                    const type = Math.floor(Math.random() * numResourceTypes);
                    resources[x][y] = { type, amount: 0.5 + Math.random() * 0.5 };
                }
            }

            // Create species with evenly distributed niches
            species = [];
            for (let i = 0; i < numSpecies; i++) {
                const niche = numSpecies > 1 ? i / (numSpecies - 1) : 0.5;
                const sp = new Species(i, niche);
                sp.initAgents();
                species.push(sp);
            }

            updateLegend();
            updateStats();
            draw();
            drawChart();
        }

        function step() {
            generation++;

            // Regenerate resources
            for (let x = 0; x < gridSize; x++) {
                for (let y = 0; y < gridSize; y++) {
                    resources[x][y].amount = Math.min(1, resources[x][y].amount + regenRate);
                }
            }

            // Process each species
            species.forEach(sp => {
                if (sp.extinct) return;

                const newAgents = [];

                sp.agents.forEach(agent => {
                    // Move randomly
                    agent.x += (Math.random() - 0.5) * 2;
                    agent.y += (Math.random() - 0.5) * 2;
                    agent.x = Math.max(0, Math.min(gridSize - 1, agent.x));
                    agent.y = Math.max(0, Math.min(gridSize - 1, agent.y));

                    const gx = Math.floor(agent.x);
                    const gy = Math.floor(agent.y);
                    const res = resources[gx][gy];

                    // Consume resource based on niche efficiency
                    const efficiency = sp.getNicheEfficiency(res.type, numResourceTypes);
                    const consumed = Math.min(res.amount, efficiency * 0.3);
                    res.amount -= consumed;
                    agent.energy += consumed * 30;

                    // Competition penalty from other species
                    species.forEach(other => {
                        if (other.id === sp.id || other.extinct) return;
                        const nearby = other.agents.filter(a =>
                            Math.abs(a.x - agent.x) < 3 && Math.abs(a.y - agent.y) < 3
                        ).length;
                        agent.energy -= nearby * competitionStrength * 0.5;
                    });

                    // Metabolism
                    agent.energy -= 2;

                    // Reproduction
                    if (agent.energy > 80) {
                        agent.energy -= 40;
                        newAgents.push({
                            x: agent.x + (Math.random() - 0.5) * 2,
                            y: agent.y + (Math.random() - 0.5) * 2,
                            energy: 40
                        });
                    }
                });

                // Filter dead agents
                sp.agents = sp.agents.filter(a => a.energy > 0);
                sp.agents.push(...newAgents);
                sp.population = sp.agents.length;

                // Check extinction
                if (sp.population === 0) {
                    sp.extinct = true;
                }
            });

            // Record history
            history.push(species.map(s => s.population));
            if (history.length > 200) history.shift();

            updateStats();
            draw();
            drawChart();
        }

        function updateLegend() {
            const legendEl = document.getElementById('legend');
            legendEl.innerHTML = '';
            species.forEach(sp => {
                const item = document.createElement('div');
                item.className = 'species-item';
                item.innerHTML = `
                    <div class="species-color" style="background:${sp.color}"></div>
                    <span>Species ${sp.id + 1} (niche: ${sp.niche.toFixed(2)})</span>
                `;
                legendEl.appendChild(item);
            });
        }

        function updateStats() {
            document.getElementById('genStat').textContent = generation;
            document.getElementById('totalPop').textContent = species.reduce((s, sp) => s + sp.population, 0);
            document.getElementById('extinctStat').textContent = species.filter(s => s.extinct).length;
            document.getElementById('coexistStat').textContent = species.filter(s => !s.extinct).length;
        }

        function draw() {
            ctx.fillStyle = '#0a0a1a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw resources
            for (let x = 0; x < gridSize; x++) {
                for (let y = 0; y < gridSize; y++) {
                    const res = resources[x][y];
                    const color = RES_COLORS[res.type % RES_COLORS.length];
                    ctx.fillStyle = color;
                    ctx.globalAlpha = res.amount * 0.4;
                    ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
                }
            }
            ctx.globalAlpha = 1;

            // Draw agents
            species.forEach(sp => {
                if (sp.extinct) return;
                ctx.fillStyle = sp.color;
                sp.agents.forEach(a => {
                    ctx.beginPath();
                    ctx.arc(a.x * cellSize, a.y * cellSize, 3, 0, Math.PI * 2);
                    ctx.fill();
                });
            });

            // Resource type legend
            ctx.fillStyle = '#888';
            ctx.font = '11px sans-serif';
            ctx.fillText('Resource Types:', 10, 20);
            for (let i = 0; i < numResourceTypes; i++) {
                ctx.fillStyle = RES_COLORS[i];
                ctx.fillRect(110 + i * 50, 10, 15, 15);
                ctx.fillStyle = '#888';
                ctx.fillText(`R${i + 1}`, 128 + i * 50, 22);
            }

            // Generation
            ctx.fillStyle = '#4ecdc4';
            ctx.font = 'bold 14px sans-serif';
            ctx.fillText(`Gen: ${generation}`, canvas.width - 80, 20);
        }

        function drawChart() {
            chartCtx.fillStyle = '#0a0a1a';
            chartCtx.fillRect(0, 0, chartCanvas.width, chartCanvas.height);

            if (history.length < 2) return;

            const maxPop = Math.max(100, ...history.flat());
            const w = chartCanvas.width;
            const h = chartCanvas.height - 10;

            species.forEach((sp, idx) => {
                chartCtx.strokeStyle = sp.color;
                chartCtx.lineWidth = 1.5;
                chartCtx.beginPath();
                history.forEach((point, i) => {
                    const x = (i / (history.length - 1)) * w;
                    const y = h - (point[idx] / maxPop) * h + 5;
                    if (i === 0) chartCtx.moveTo(x, y);
                    else chartCtx.lineTo(x, y);
                });
                chartCtx.stroke();
            });
        }

        function loop() {
            if (!running) return;
            step();
            animId = setTimeout(loop, 50);
        }

        document.getElementById('startBtn').addEventListener('click', function() {
            running = !running;
            this.textContent = running ? 'Pause' : 'Start';
            if (running) loop();
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            running = false;
            document.getElementById('startBtn').textContent = 'Start';
            clearTimeout(animId);
            init();
        });

        document.getElementById('numRes').addEventListener('input', function() {
            numResourceTypes = +this.value;
            document.getElementById('numResVal').textContent = numResourceTypes;
        });
        document.getElementById('regen').addEventListener('input', function() {
            regenRate = +this.value;
            document.getElementById('regenVal').textContent = regenRate.toFixed(2);
        });
        document.getElementById('niche').addEventListener('input', function() {
            nicheWidth = +this.value;
            document.getElementById('nicheVal').textContent = nicheWidth.toFixed(2);
        });
        document.getElementById('numSpecies').addEventListener('input', function() {
            numSpecies = +this.value;
            document.getElementById('numSpeciesVal').textContent = numSpecies;
        });
        document.getElementById('comp').addEventListener('input', function() {
            competitionStrength = +this.value;
            document.getElementById('compVal').textContent = competitionStrength.toFixed(1);
        });

        init();
    </script>
</body>
</html>
