<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Source Coding Theorem - Information Theory</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0e1a;
            color: #e0e0e0;
            overflow: hidden;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #4fc3f7;
            text-decoration: none;
            font-size: 18px;
            z-index: 1000;
            padding: 10px 20px;
            background: rgba(79, 195, 247, 0.1);
            border-radius: 8px;
            border: 1px solid #4fc3f7;
            transition: all 0.3s;
        }

        .back-link:hover {
            background: rgba(79, 195, 247, 0.2);
            transform: translateX(-5px);
        }

        #canvas {
            display: block;
            width: 100%;
            height: 100vh;
        }

        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(20, 30, 50, 0.95);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid #4fc3f7;
            max-width: 350px;
            max-height: 90vh;
            overflow-y: auto;
            z-index: 100;
        }

        .controls h2 {
            color: #4fc3f7;
            margin-bottom: 20px;
            font-size: 22px;
        }

        .slider-group {
            margin-bottom: 20px;
        }

        .slider-group label {
            display: block;
            color: #66bb6a;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .slider-group input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }

        .slider-value {
            color: #81c784;
            font-size: 16px;
            font-weight: bold;
        }

        .info-box {
            background: rgba(79, 195, 247, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 3px solid #4fc3f7;
        }

        .info-box h3 {
            color: #4fc3f7;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .info-box p {
            color: #b0bec5;
            font-size: 13px;
            line-height: 1.6;
        }

        .formula {
            font-family: 'Courier New', monospace;
            background: rgba(102, 187, 106, 0.1);
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            color: #81c784;
            font-size: 13px;
        }

        .stat {
            color: #66bb6a;
            font-weight: bold;
            margin-top: 10px;
            font-size: 14px;
        }

        button {
            width: 100%;
            padding: 12px;
            background: #4fc3f7;
            color: #0a0e1a;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 10px;
        }

        button:hover {
            background: #29b6f6;
            transform: scale(1.02);
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Gallery</a>

    <canvas id="canvas"></canvas>

    <div class="controls">
        <h2>Source Coding Theorem</h2>

        <div class="slider-group">
            <label>Symbol A Probability: <span class="slider-value" id="probA">0.50</span></label>
            <input type="range" id="sliderA" min="1" max="98" value="50">
        </div>

        <div class="slider-group">
            <label>Symbol B Probability: <span class="slider-value" id="probB">0.25</span></label>
            <input type="range" id="sliderB" min="1" max="98" value="25">
        </div>

        <div class="slider-group">
            <label>Symbol C Probability: <span class="slider-value" id="probC">0.15</span></label>
            <input type="range" id="sliderC" min="1" max="98" value="15">
        </div>

        <div class="slider-group">
            <label>Symbol D Probability: <span class="slider-value" id="probD">0.10</span></label>
            <input type="range" id="sliderD" min="1" max="98" value="10">
        </div>

        <button onclick="updateCoding()">Update Codes</button>

        <div id="stats"></div>

        <div class="info-box">
            <h3>Source Coding Theorem</h3>
            <div class="formula">H(X) ≤ L_avg < H(X) + 1</div>
            <p style="margin-top: 10px;">Shannon's source coding theorem: The average code length L_avg is bounded by the entropy H(X).</p>
            <p style="margin-top: 8px;">Variable-length codes can achieve compression, but cannot go below entropy limit.</p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let width, height;

        function resizeCanvas() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }

        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        let probs = [0.5, 0.25, 0.15, 0.1];
        const symbols = ['A', 'B', 'C', 'D'];
        const colors = ['#4fc3f7', '#66bb6a', '#ffa726', '#ab47bc'];

        const sliders = [
            document.getElementById('sliderA'),
            document.getElementById('sliderB'),
            document.getElementById('sliderC'),
            document.getElementById('sliderD')
        ];

        const probDisplays = [
            document.getElementById('probA'),
            document.getElementById('probB'),
            document.getElementById('probC'),
            document.getElementById('probD')
        ];

        function updateProbs() {
            const raw = sliders.map(s => parseInt(s.value));
            const sum = raw.reduce((a, b) => a + b, 0);

            probs = raw.map(v => v / sum);

            probDisplays.forEach((display, i) => {
                display.textContent = probs[i].toFixed(2);
            });

            updateCoding();
        }

        sliders.forEach(slider => {
            slider.addEventListener('input', updateProbs);
        });

        function calculateEntropy() {
            let entropy = 0;
            for (let p of probs) {
                if (p > 0) {
                    entropy -= p * Math.log2(p);
                }
            }
            return entropy;
        }

        function generateFixedLengthCodes() {
            // 2 bits for 4 symbols
            return ['00', '01', '10', '11'];
        }

        function generateVariableLengthCodes() {
            // Simple variable length based on probability
            // Sort by probability
            const indexed = probs.map((p, i) => ({p, i})).sort((a, b) => b.p - a.p);
            const codes = new Array(4);

            // Assign codes based on probability (simplified Huffman-like)
            if (indexed[0].p > 0.4) {
                codes[indexed[0].i] = '0';
                codes[indexed[1].i] = '10';
                codes[indexed[2].i] = '110';
                codes[indexed[3].i] = '111';
            } else {
                codes[indexed[0].i] = '00';
                codes[indexed[1].i] = '01';
                codes[indexed[2].i] = '10';
                codes[indexed[3].i] = '11';
            }

            return codes;
        }

        let fixedCodes = generateFixedLengthCodes();
        let variableCodes = generateVariableLengthCodes();

        function updateCoding() {
            fixedCodes = generateFixedLengthCodes();
            variableCodes = generateVariableLengthCodes();

            const entropy = calculateEntropy();

            // Calculate average code lengths
            const fixedAvg = 2; // Always 2 bits
            let variableAvg = 0;
            for (let i = 0; i < 4; i++) {
                variableAvg += probs[i] * variableCodes[i].length;
            }

            const efficiency = (entropy / variableAvg * 100).toFixed(1);
            const redundancy = ((variableAvg - entropy) / entropy * 100).toFixed(1);

            document.getElementById('stats').innerHTML = `
                <div class="stat">Entropy H(X): ${entropy.toFixed(3)} bits</div>
                <div class="stat">Fixed Length: ${fixedAvg.toFixed(3)} bits/symbol</div>
                <div class="stat">Variable Length: ${variableAvg.toFixed(3)} bits/symbol</div>
                <div class="stat">Efficiency: ${efficiency}%</div>
                <div class="stat">Redundancy: ${redundancy}%</div>
            `;
        }

        function drawProbabilityDistribution() {
            const startY = 80;
            const barWidth = 60;
            const barSpacing = 100;
            const maxBarHeight = 200;

            ctx.fillStyle = '#4fc3f7';
            ctx.font = 'bold 20px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('Source Probability Distribution', 50, startY - 30);

            for (let i = 0; i < 4; i++) {
                const x = 50 + i * barSpacing;
                const barHeight = probs[i] * maxBarHeight * 2;
                const y = startY + maxBarHeight - barHeight;

                // Draw bar
                ctx.fillStyle = colors[i];
                ctx.fillRect(x, y, barWidth, barHeight);

                ctx.strokeStyle = colors[i];
                ctx.lineWidth = 2;
                ctx.strokeRect(x, y, barWidth, barHeight);

                // Symbol label
                ctx.fillStyle = '#e0e0e0';
                ctx.font = 'bold 24px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(symbols[i], x + barWidth / 2, startY + maxBarHeight + 30);

                // Probability value
                ctx.fillStyle = colors[i];
                ctx.font = 'bold 16px sans-serif';
                ctx.fillText(probs[i].toFixed(2), x + barWidth / 2, y - 10);
            }
        }

        function drawCodeComparison() {
            const startX = 500;
            const startY = 80;

            ctx.fillStyle = '#4fc3f7';
            ctx.font = 'bold 20px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('Fixed vs Variable Length Coding', startX, startY - 30);

            // Table headers
            ctx.fillStyle = '#66bb6a';
            ctx.font = 'bold 16px sans-serif';
            ctx.fillText('Symbol', startX, startY + 20);
            ctx.fillText('Prob', startX + 80, startY + 20);
            ctx.fillText('Fixed', startX + 160, startY + 20);
            ctx.fillText('Variable', startX + 240, startY + 20);

            // Draw table rows
            for (let i = 0; i < 4; i++) {
                const y = startY + 55 + i * 40;

                ctx.fillStyle = colors[i];
                ctx.font = 'bold 18px sans-serif';
                ctx.fillText(symbols[i], startX + 20, y);

                ctx.fillStyle = '#e0e0e0';
                ctx.font = '16px sans-serif';
                ctx.fillText(probs[i].toFixed(2), startX + 80, y);

                // Fixed code
                ctx.fillStyle = '#4fc3f7';
                ctx.font = 'bold 16px monospace';
                ctx.fillText(fixedCodes[i], startX + 160, y);

                // Variable code
                ctx.fillStyle = '#66bb6a';
                ctx.fillText(variableCodes[i], startX + 240, y);
            }

            // Draw separator lines
            ctx.strokeStyle = 'rgba(79, 195, 247, 0.3)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 4; i++) {
                const y = startY + 35 + i * 40;
                ctx.beginPath();
                ctx.moveTo(startX, y);
                ctx.lineTo(startX + 350, y);
                ctx.stroke();
            }
        }

        function drawEncodingExample() {
            const startY = 370;
            const testString = 'AABACADA';

            ctx.fillStyle = '#66bb6a';
            ctx.font = 'bold 20px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('Example Encoding: "' + testString + '"', 50, startY - 20);

            // Fixed length encoding
            let fixedEncoding = '';
            for (let char of testString) {
                const idx = symbols.indexOf(char);
                fixedEncoding += fixedCodes[idx];
            }

            ctx.fillStyle = '#4fc3f7';
            ctx.font = '16px sans-serif';
            ctx.fillText('Fixed Length:', 50, startY + 20);
            ctx.font = 'bold 16px monospace';
            ctx.fillText(fixedEncoding + ' (' + fixedEncoding.length + ' bits)', 50, startY + 45);

            // Variable length encoding
            let variableEncoding = '';
            for (let char of testString) {
                const idx = symbols.indexOf(char);
                variableEncoding += variableCodes[idx];
            }

            ctx.fillStyle = '#66bb6a';
            ctx.font = '16px sans-serif';
            ctx.fillText('Variable Length:', 50, startY + 80);
            ctx.font = 'bold 16px monospace';
            ctx.fillText(variableEncoding + ' (' + variableEncoding.length + ' bits)', 50, startY + 105);

            // Savings
            const savings = fixedEncoding.length - variableEncoding.length;
            const savingsPercent = (savings / fixedEncoding.length * 100).toFixed(1);

            ctx.fillStyle = savings > 0 ? '#66bb6a' : '#ffa726';
            ctx.font = 'bold 16px sans-serif';
            ctx.fillText(`Savings: ${savings} bits (${savingsPercent}%)`, 50, startY + 145);
        }

        function drawEntropyBound() {
            const startY = 570;

            ctx.fillStyle = '#4fc3f7';
            ctx.font = 'bold 20px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('Source Coding Theorem Bounds', 50, startY - 20);

            const entropy = calculateEntropy();
            let variableAvg = 0;
            for (let i = 0; i < 4; i++) {
                variableAvg += probs[i] * variableCodes[i].length;
            }

            const barWidth = 500;
            const barHeight = 40;

            // Draw entropy lower bound
            const entropyWidth = (entropy / 3) * barWidth;
            ctx.fillStyle = 'rgba(255, 167, 38, 0.3)';
            ctx.fillRect(50, startY + 20, entropyWidth, barHeight);
            ctx.fillStyle = '#ffa726';
            ctx.fillRect(50, startY + 20, entropyWidth, barHeight);
            ctx.strokeStyle = '#ffa726';
            ctx.lineWidth = 2;
            ctx.strokeRect(50, startY + 20, entropyWidth, barHeight);

            ctx.fillStyle = '#e0e0e0';
            ctx.font = 'bold 14px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(`H(X) = ${entropy.toFixed(2)}`, 50 + entropyWidth / 2, startY + 45);

            // Draw variable length average
            const varWidth = (variableAvg / 3) * barWidth;
            ctx.fillStyle = 'rgba(102, 187, 106, 0.3)';
            ctx.fillRect(50, startY + 80, varWidth, barHeight);
            ctx.fillStyle = '#66bb6a';
            ctx.fillRect(50, startY + 80, varWidth, barHeight);
            ctx.strokeStyle = '#66bb6a';
            ctx.lineWidth = 2;
            ctx.strokeRect(50, startY + 80, varWidth, barHeight);

            ctx.fillStyle = '#e0e0e0';
            ctx.fillText(`L_avg = ${variableAvg.toFixed(2)}`, 50 + varWidth / 2, startY + 105);

            // Draw fixed length
            const fixedWidth = (2 / 3) * barWidth;
            ctx.fillStyle = 'rgba(79, 195, 247, 0.3)';
            ctx.fillRect(50, startY + 140, fixedWidth, barHeight);
            ctx.fillStyle = '#4fc3f7';
            ctx.fillRect(50, startY + 140, fixedWidth, barHeight);
            ctx.strokeStyle = '#4fc3f7';
            ctx.lineWidth = 2;
            ctx.strokeRect(50, startY + 140, fixedWidth, barHeight);

            ctx.fillStyle = '#e0e0e0';
            ctx.fillText('Fixed = 2.00', 50 + fixedWidth / 2, startY + 165);

            // Labels
            ctx.fillStyle = '#b0bec5';
            ctx.font = '14px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('Minimum (Entropy)', 50, startY + 15);
            ctx.fillText('Variable Length', 50, startY + 75);
            ctx.fillText('Fixed Length', 50, startY + 135);
        }

        function draw() {
            // Clear canvas
            ctx.fillStyle = '#0a0e1a';
            ctx.fillRect(0, 0, width, height);

            drawProbabilityDistribution();
            drawCodeComparison();
            drawEncodingExample();
            drawEntropyBound();

            requestAnimationFrame(draw);
        }

        // Initialize
        updateCoding();
        draw();
    </script>
</body>
</html>
