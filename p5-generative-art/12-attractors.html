<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strange Attractors - P5.js Generative Art - CCAB</title>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background: #0a0e1a; }
        .back-link {
            position: fixed; top: 10px; left: 10px; padding: 8px 16px;
            background: rgba(0, 0, 0, 0.7); color: #ec4899; text-decoration: none;
            border-radius: 6px; font-size: 14px; z-index: 999;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .back-link:hover { background: rgba(236, 72, 153, 0.2); }
        .controls {
            position: fixed; top: 10px; right: 10px; background: rgba(0, 0, 0, 0.7);
            padding: 15px; border-radius: 8px; color: #e8e6e1;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 12px; z-index: 999;
        }
        .controls select { margin-bottom: 10px; padding: 5px; }
        .controls label { display: block; margin-bottom: 8px; }
        .controls input[type="range"] { width: 100px; margin-left: 10px; }
        #loading {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: #ec4899; font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        }
        .spinner {
            width: 50px; height: 50px; border: 4px solid rgba(255, 255, 255, 0.1);
            border-top-color: #ec4899; border-radius: 50%; animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to P5.js Gallery</a>
    <div id="loading"><div class="spinner"></div><p>Loading...</p></div>
    <div class="controls">
        <select id="attractor">
            <option value="lorenz">Lorenz Attractor</option>
            <option value="rossler">Rossler Attractor</option>
            <option value="thomas">Thomas Attractor</option>
            <option value="aizawa">Aizawa Attractor</option>
        </select>
        <label>Speed: <input type="range" id="speed" min="1" max="50" value="20"></label>
        <label>Trail: <input type="range" id="trail" min="100" max="5000" value="2000"></label>
        <button onclick="reset()" style="margin-top: 10px; padding: 5px 10px; cursor: pointer;">Reset</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <script>
        let points = [];
        let x, y, z;
        let attractorType = 'lorenz';
        let speed = 20;
        let maxPoints = 2000;
        let angle = 0;

        // Attractor parameters
        const params = {
            lorenz: { sigma: 10, rho: 28, beta: 8/3, dt: 0.01, scale: 8 },
            rossler: { a: 0.2, b: 0.2, c: 5.7, dt: 0.02, scale: 15 },
            thomas: { b: 0.208186, dt: 0.05, scale: 50 },
            aizawa: { a: 0.95, b: 0.7, c: 0.6, d: 3.5, e: 0.25, f: 0.1, dt: 0.01, scale: 150 }
        };

        function reset() {
            points = [];
            if (attractorType === 'lorenz') {
                x = 0.01; y = 0; z = 0;
            } else if (attractorType === 'rossler') {
                x = 0.1; y = 0; z = 0;
            } else if (attractorType === 'thomas') {
                x = 1.1; y = 1.1; z = -0.01;
            } else if (attractorType === 'aizawa') {
                x = 0.1; y = 0; z = 0;
            }
        }

        function setup() {
            createCanvas(windowWidth, windowHeight, WEBGL);
            document.getElementById('loading').style.display = 'none';
            colorMode(HSB, 360, 100, 100, 100);

            document.getElementById('attractor').addEventListener('change', (e) => {
                attractorType = e.target.value;
                reset();
            });
            document.getElementById('speed').addEventListener('input', (e) => {
                speed = parseInt(e.target.value);
            });
            document.getElementById('trail').addEventListener('input', (e) => {
                maxPoints = parseInt(e.target.value);
            });

            reset();
        }

        function stepAttractor() {
            const p = params[attractorType];
            let dx, dy, dz;

            if (attractorType === 'lorenz') {
                dx = p.sigma * (y - x);
                dy = x * (p.rho - z) - y;
                dz = x * y - p.beta * z;
            } else if (attractorType === 'rossler') {
                dx = -y - z;
                dy = x + p.a * y;
                dz = p.b + z * (x - p.c);
            } else if (attractorType === 'thomas') {
                dx = sin(y) - p.b * x;
                dy = sin(z) - p.b * y;
                dz = sin(x) - p.b * z;
            } else if (attractorType === 'aizawa') {
                dx = (z - p.b) * x - p.d * y;
                dy = p.d * x + (z - p.b) * y;
                dz = p.c + p.a * z - (z * z * z) / 3 - (x * x + y * y) * (1 + p.e * z) + p.f * z * x * x * x;
            }

            x += dx * p.dt;
            y += dy * p.dt;
            z += dz * p.dt;

            return createVector(x * p.scale, y * p.scale, z * p.scale);
        }

        function draw() {
            background(10, 14, 26);

            // Add new points
            for (let i = 0; i < speed; i++) {
                let v = stepAttractor();
                points.push(v);
            }

            // Limit points
            while (points.length > maxPoints) {
                points.shift();
            }

            // Rotate view
            rotateY(angle);
            rotateX(angle * 0.5);
            angle += 0.003;

            // Draw attractor
            noFill();
            strokeWeight(1);
            beginShape();
            for (let i = 0; i < points.length; i++) {
                let hue = map(i, 0, points.length, 280, 340);
                let alpha = map(i, 0, points.length, 20, 100);
                stroke(hue, 80, 90, alpha);
                vertex(points[i].x, points[i].y, points[i].z);
            }
            endShape();

            // Draw current point
            if (points.length > 0) {
                let last = points[points.length - 1];
                push();
                translate(last.x, last.y, last.z);
                fill(320, 80, 100);
                noStroke();
                sphere(3);
                pop();
            }
        }

        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
        }
    </script>
</body>
</html>
