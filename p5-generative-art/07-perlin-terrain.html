<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perlin Terrain - P5.js Generative Art - CCAB</title>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background: #0a0e1a; }
        .back-link {
            position: fixed; top: 10px; left: 10px; padding: 8px 16px;
            background: rgba(0, 0, 0, 0.7); color: #ec4899; text-decoration: none;
            border-radius: 6px; font-size: 14px; z-index: 999;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .back-link:hover { background: rgba(236, 72, 153, 0.2); }
        .controls {
            position: fixed; top: 10px; right: 10px; background: rgba(0, 0, 0, 0.7);
            padding: 15px; border-radius: 8px; color: #e8e6e1;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 12px; z-index: 999;
        }
        .controls label { display: block; margin-bottom: 8px; }
        .controls input[type="range"] { width: 100px; margin-left: 10px; }
        #loading {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: #ec4899; font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        }
        .spinner {
            width: 50px; height: 50px; border: 4px solid rgba(255, 255, 255, 0.1);
            border-top-color: #ec4899; border-radius: 50%; animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to P5.js Gallery</a>
    <div id="loading"><div class="spinner"></div><p>Loading...</p></div>
    <div class="controls">
        <label>Speed: <input type="range" id="speed" min="0.01" max="0.1" step="0.01" value="0.03"></label>
        <label>Scale: <input type="range" id="scale" min="0.01" max="0.2" step="0.01" value="0.08"></label>
        <label>Height: <input type="range" id="heightMult" min="50" max="300" value="150"></label>
        <div style="margin-top: 10px;">FPS: <span id="fps">0</span></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <script>
        let cols, rows;
        let scl = 20;
        let terrain = [];
        let flying = 0;
        let flyingSpeed = 0.03;
        let noiseScale = 0.08;
        let heightMult = 150;

        function setup() {
            createCanvas(windowWidth, windowHeight, WEBGL);
            document.getElementById('loading').style.display = 'none';

            cols = floor(width / scl) + 1;
            rows = floor(height / scl) + 1;

            for (let x = 0; x < cols; x++) {
                terrain[x] = [];
                for (let y = 0; y < rows; y++) {
                    terrain[x][y] = 0;
                }
            }

            document.getElementById('speed').addEventListener('input', (e) => {
                flyingSpeed = parseFloat(e.target.value);
            });
            document.getElementById('scale').addEventListener('input', (e) => {
                noiseScale = parseFloat(e.target.value);
            });
            document.getElementById('heightMult').addEventListener('input', (e) => {
                heightMult = parseInt(e.target.value);
            });
        }

        function draw() {
            background(10, 14, 26);

            flying -= flyingSpeed;

            let yoff = flying;
            for (let y = 0; y < rows; y++) {
                let xoff = 0;
                for (let x = 0; x < cols; x++) {
                    terrain[x][y] = map(noise(xoff, yoff), 0, 1, -heightMult, heightMult);
                    xoff += noiseScale;
                }
                yoff += noiseScale;
            }

            // Camera positioning
            rotateX(PI / 3);
            translate(-width / 2, -height / 2);

            // Draw terrain
            colorMode(HSB, 360, 100, 100);

            for (let y = 0; y < rows - 1; y++) {
                beginShape(TRIANGLE_STRIP);
                for (let x = 0; x < cols; x++) {
                    let h1 = terrain[x][y];
                    let h2 = terrain[x][y + 1];

                    // Color based on height
                    let hue1 = map(h1, -heightMult, heightMult, 200, 320);
                    let hue2 = map(h2, -heightMult, heightMult, 200, 320);

                    stroke(hue1, 70, 80);
                    fill(hue1, 60, 60);
                    vertex(x * scl, y * scl, h1);

                    stroke(hue2, 70, 80);
                    fill(hue2, 60, 60);
                    vertex(x * scl, (y + 1) * scl, h2);
                }
                endShape();
            }

            document.getElementById('fps').textContent = Math.round(frameRate());
        }

        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
            cols = floor(width / scl) + 1;
            rows = floor(height / scl) + 1;

            terrain = [];
            for (let x = 0; x < cols; x++) {
                terrain[x] = [];
                for (let y = 0; y < rows; y++) {
                    terrain[x][y] = 0;
                }
            }
        }
    </script>
</body>
</html>
