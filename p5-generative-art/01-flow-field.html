<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flow Field - P5.js Generative Art - CCAB</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #0a0e1a;
        }
        .back-link {
            position: fixed;
            top: 10px;
            left: 10px;
            padding: 8px 16px;
            background: rgba(0, 0, 0, 0.7);
            color: #ec4899;
            text-decoration: none;
            border-radius: 6px;
            font-size: 14px;
            z-index: 999;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            transition: all 0.3s ease;
        }
        .back-link:hover {
            background: rgba(236, 72, 153, 0.2);
            transform: translateX(-4px);
        }
        .controls {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 8px;
            color: #e8e6e1;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 12px;
            z-index: 999;
        }
        .controls label {
            display: block;
            margin-bottom: 8px;
        }
        .controls input[type="range"] {
            width: 120px;
            margin-left: 10px;
        }
        #loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ec4899;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            z-index: 1000;
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top-color: #ec4899;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to P5.js Gallery</a>

    <div id="loading">
        <div class="spinner"></div>
        <p>Loading P5.js...</p>
    </div>

    <div class="controls">
        <label>Noise Scale: <input type="range" id="noiseScale" min="0.001" max="0.02" step="0.001" value="0.005"></label>
        <label>Particle Speed: <input type="range" id="particleSpeed" min="1" max="10" step="0.5" value="3"></label>
        <label>Trail Length: <input type="range" id="trailLength" min="1" max="50" step="1" value="10"></label>
        <div style="margin-top: 10px;">FPS: <span id="fps">0</span></div>
        <button onclick="resetParticles()" style="margin-top: 10px; padding: 5px 10px; cursor: pointer;">Reset</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <script>
        let particles = [];
        const NUM_PARTICLES = 2000;
        let noiseScale = 0.005;
        let particleSpeed = 3;
        let trailLength = 10;
        let zOffset = 0;

        class Particle {
            constructor() {
                this.pos = createVector(random(width), random(height));
                this.vel = createVector(0, 0);
                this.acc = createVector(0, 0);
                this.maxSpeed = particleSpeed;
                this.prevPos = this.pos.copy();
                this.hue = random(280, 340); // Pink to purple range
            }

            update() {
                this.prevPos = this.pos.copy();

                let angle = noise(
                    this.pos.x * noiseScale,
                    this.pos.y * noiseScale,
                    zOffset
                ) * TWO_PI * 4;

                let force = p5.Vector.fromAngle(angle);
                force.mult(0.5);
                this.acc.add(force);

                this.vel.add(this.acc);
                this.vel.limit(this.maxSpeed);
                this.pos.add(this.vel);
                this.acc.mult(0);

                this.edges();
            }

            edges() {
                if (this.pos.x > width) {
                    this.pos.x = 0;
                    this.prevPos.x = 0;
                }
                if (this.pos.x < 0) {
                    this.pos.x = width;
                    this.prevPos.x = width;
                }
                if (this.pos.y > height) {
                    this.pos.y = 0;
                    this.prevPos.y = 0;
                }
                if (this.pos.y < 0) {
                    this.pos.y = height;
                    this.prevPos.y = height;
                }
            }

            show() {
                colorMode(HSB, 360, 100, 100, 100);
                stroke(this.hue, 80, 90, trailLength);
                strokeWeight(1);
                line(this.pos.x, this.pos.y, this.prevPos.x, this.prevPos.y);
            }
        }

        function resetParticles() {
            particles = [];
            for (let i = 0; i < NUM_PARTICLES; i++) {
                particles.push(new Particle());
            }
            background(10, 14, 26);
        }

        function setup() {
            createCanvas(windowWidth, windowHeight);
            document.getElementById('loading').style.display = 'none';

            colorMode(HSB, 360, 100, 100, 100);
            background(10, 14, 26);

            for (let i = 0; i < NUM_PARTICLES; i++) {
                particles.push(new Particle());
            }

            // Control listeners
            document.getElementById('noiseScale').addEventListener('input', (e) => {
                noiseScale = parseFloat(e.target.value);
            });
            document.getElementById('particleSpeed').addEventListener('input', (e) => {
                particleSpeed = parseFloat(e.target.value);
                particles.forEach(p => p.maxSpeed = particleSpeed);
            });
            document.getElementById('trailLength').addEventListener('input', (e) => {
                trailLength = parseInt(e.target.value);
            });
        }

        function draw() {
            // Subtle fade for trails
            noStroke();
            fill(10, 14, 26, 5);
            rect(0, 0, width, height);

            zOffset += 0.002;

            for (let particle of particles) {
                particle.update();
                particle.show();
            }

            // Update FPS display
            document.getElementById('fps').textContent = Math.round(frameRate());
        }

        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
            background(10, 14, 26);
        }
    </script>
</body>
</html>
