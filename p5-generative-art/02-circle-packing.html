<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Circle Packing - P5.js Generative Art - CCAB</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #0a0e1a;
        }
        .back-link {
            position: fixed;
            top: 10px;
            left: 10px;
            padding: 8px 16px;
            background: rgba(0, 0, 0, 0.7);
            color: #ec4899;
            text-decoration: none;
            border-radius: 6px;
            font-size: 14px;
            z-index: 999;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .back-link:hover {
            background: rgba(236, 72, 153, 0.2);
        }
        .controls {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 8px;
            color: #e8e6e1;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 12px;
            z-index: 999;
        }
        #loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ec4899;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top-color: #ec4899;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to P5.js Gallery</a>

    <div id="loading">
        <div class="spinner"></div>
        <p>Loading...</p>
    </div>

    <div class="controls">
        <div>Circles: <span id="circleCount">0</span></div>
        <div>FPS: <span id="fps">0</span></div>
        <button onclick="reset()" style="margin-top: 10px; padding: 5px 10px; cursor: pointer;">Reset</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <script>
        let circles = [];
        let maxRadius = 100;
        let minRadius = 2;
        let growSpeed = 0.5;
        let attemptsPerFrame = 10;
        let finished = false;

        class Circle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.r = 1;
                this.growing = true;
                this.hue = random(280, 360);
            }

            grow() {
                if (this.growing) {
                    this.r += growSpeed;
                }
            }

            edges() {
                return (
                    this.x - this.r < 0 ||
                    this.x + this.r > width ||
                    this.y - this.r < 0 ||
                    this.y + this.r > height
                );
            }

            overlaps(other) {
                let d = dist(this.x, this.y, other.x, other.y);
                return d < this.r + other.r + 2;
            }

            show() {
                colorMode(HSB, 360, 100, 100, 100);
                stroke(this.hue, 70, 90);
                strokeWeight(2);
                noFill();
                circle(this.x, this.y, this.r * 2);

                if (this.r > 10) {
                    fill(this.hue, 60, 80, 30);
                    noStroke();
                    circle(this.x, this.y, this.r * 2);
                }
            }
        }

        function reset() {
            circles = [];
            finished = false;
            background(10, 14, 26);
        }

        function setup() {
            createCanvas(windowWidth, windowHeight);
            document.getElementById('loading').style.display = 'none';
            background(10, 14, 26);
        }

        function draw() {
            background(10, 14, 26);

            if (!finished) {
                for (let i = 0; i < attemptsPerFrame; i++) {
                    let newC = newCircle();
                    if (newC) {
                        circles.push(newC);
                    }
                }
            }

            for (let c of circles) {
                if (c.growing) {
                    if (c.r > maxRadius || c.edges()) {
                        c.growing = false;
                    } else {
                        for (let other of circles) {
                            if (c !== other && c.overlaps(other)) {
                                c.growing = false;
                                break;
                            }
                        }
                    }
                }
                c.grow();
                c.show();
            }

            document.getElementById('circleCount').textContent = circles.length;
            document.getElementById('fps').textContent = Math.round(frameRate());

            // Check if we're stuck
            let growing = circles.some(c => c.growing);
            if (circles.length > 100 && !growing) {
                finished = true;
            }
        }

        function newCircle() {
            let x = random(width);
            let y = random(height);
            let valid = true;

            for (let c of circles) {
                let d = dist(x, y, c.x, c.y);
                if (d < c.r + minRadius) {
                    valid = false;
                    break;
                }
            }

            if (valid) {
                return new Circle(x, y);
            }
            return null;
        }

        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
            reset();
        }
    </script>
</body>
</html>
