<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metaballs 2D - P5.js Generative Art - CCAB</title>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background: #0a0e1a; }
        .back-link {
            position: fixed; top: 10px; left: 10px; padding: 8px 16px;
            background: rgba(0, 0, 0, 0.7); color: #ec4899; text-decoration: none;
            border-radius: 6px; font-size: 14px; z-index: 999;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .back-link:hover { background: rgba(236, 72, 153, 0.2); }
        .controls {
            position: fixed; top: 10px; right: 10px; background: rgba(0, 0, 0, 0.7);
            padding: 15px; border-radius: 8px; color: #e8e6e1;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 12px; z-index: 999;
        }
        #loading {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: #ec4899; font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        }
        .spinner {
            width: 50px; height: 50px; border: 4px solid rgba(255, 255, 255, 0.1);
            border-top-color: #ec4899; border-radius: 50%; animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to P5.js Gallery</a>
    <div id="loading"><div class="spinner"></div><p>Loading...</p></div>
    <div class="controls">
        <div>FPS: <span id="fps">0</span></div>
        <div style="margin-top: 5px;">Blobs: 5</div>
        <div style="margin-top: 5px;">Resolution: 4px</div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <script>
        let blobs = [];
        const numBlobs = 5;
        const resolution = 4;

        class Blob {
            constructor() {
                this.x = random(width);
                this.y = random(height);
                this.r = random(100, 200);
                this.vx = random(-2, 2);
                this.vy = random(-2, 2);
                this.hue = random(280, 340);
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;

                if (this.x < 0 || this.x > width) this.vx *= -1;
                if (this.y < 0 || this.y > height) this.vy *= -1;
            }
        }

        function setup() {
            createCanvas(windowWidth, windowHeight);
            document.getElementById('loading').style.display = 'none';
            colorMode(HSB, 360, 100, 100);
            noStroke();

            for (let i = 0; i < numBlobs; i++) {
                blobs.push(new Blob());
            }
        }

        function draw() {
            background(10, 14, 26);
            loadPixels();

            for (let x = 0; x < width; x += resolution) {
                for (let y = 0; y < height; y += resolution) {
                    let sum = 0;
                    let hueSum = 0;
                    let hueWeight = 0;

                    for (let blob of blobs) {
                        let d = dist(x, y, blob.x, blob.y);
                        let influence = (blob.r * blob.r) / (d * d);
                        sum += influence;
                        hueSum += blob.hue * influence;
                        hueWeight += influence;
                    }

                    // Threshold for metaball boundary
                    if (sum > 1) {
                        let h = hueSum / hueWeight;
                        let s = 80;
                        let b = min(sum * 50, 100);

                        // Draw pixel block
                        let c = color(h, s, b);
                        fill(c);
                        rect(x, y, resolution, resolution);
                    }
                }
            }

            for (let blob of blobs) {
                blob.update();
            }

            document.getElementById('fps').textContent = Math.round(frameRate());
        }

        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
        }
    </script>
</body>
</html>
