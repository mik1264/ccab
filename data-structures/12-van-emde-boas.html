<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>van Emde Boas Tree - CCAB</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600;700&family=Nunito:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --sage: #8A9A5B;
            --moss: #606C38;
            --earth: #DDA15E;
            --cream: #FEFAE0;
            --terracotta: #BC6C25;
            --dark-moss: #3d4423;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);
            color: var(--cream);
            min-height: 100vh;
            overflow: hidden;
        }

        .organic-back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: rgba(138, 154, 91, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(138, 154, 91, 0.3);
            border-radius: 25px;
            color: var(--sage);
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .organic-back-link:hover {
            background: rgba(138, 154, 91, 0.3);
            transform: translateX(-3px);
        }

        .container {
            display: flex;
            height: 100vh;
            padding: 20px;
            gap: 20px;
        }

        .canvas-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .main-canvas-wrapper {
            flex: 2;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }

        .canvas-title {
            font-family: 'Lora', serif;
            font-size: 0.9rem;
            color: var(--earth);
            margin-bottom: 10px;
            text-align: center;
        }

        canvas {
            flex: 1;
            width: 100%;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
        }

        .comparison-row {
            flex: 1;
            display: flex;
            gap: 10px;
        }

        .comparison-wrapper {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }

        .controls {
            width: 320px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            overflow-y: auto;
        }

        h1 {
            font-family: 'Lora', serif;
            font-size: 1.5rem;
            color: var(--earth);
            margin-bottom: 8px;
        }

        .subtitle {
            font-size: 0.85rem;
            color: var(--sage);
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            font-size: 0.85rem;
            color: var(--sage);
            margin-bottom: 6px;
        }

        input[type="number"] {
            width: 100%;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(138, 154, 91, 0.3);
            border-radius: 8px;
            color: var(--cream);
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
        }

        .button-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        button {
            flex: 1;
            padding: 10px 16px;
            background: linear-gradient(135deg, var(--sage), var(--moss));
            border: none;
            border-radius: 8px;
            color: white;
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(138, 154, 91, 0.4);
        }

        button.secondary {
            background: rgba(138, 154, 91, 0.2);
            border: 1px solid var(--sage);
        }

        button.danger {
            background: rgba(188, 108, 37, 0.3);
            border: 1px solid var(--terracotta);
        }

        .info-box {
            background: rgba(138, 154, 91, 0.1);
            border: 1px solid rgba(138, 154, 91, 0.3);
            border-radius: 10px;
            padding: 12px;
            margin-top: 15px;
        }

        .info-box h3 {
            font-family: 'Lora', serif;
            font-size: 0.9rem;
            color: var(--earth);
            margin-bottom: 8px;
        }

        .info-box p {
            font-size: 0.8rem;
            line-height: 1.5;
            color: var(--cream);
            opacity: 0.9;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .stat-item {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--sage);
            margin-bottom: 4px;
        }

        .stat-value {
            font-family: 'Lora', serif;
            font-size: 1rem;
            color: var(--earth);
        }

        .operation-log {
            max-height: 150px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 10px;
            font-size: 0.75rem;
            font-family: monospace;
        }

        .log-entry {
            padding: 4px 0;
            border-bottom: 1px solid rgba(138, 154, 91, 0.1);
        }

        .log-entry.insert { color: #4CAF50; }
        .log-entry.delete { color: #f44336; }
        .log-entry.query { color: #2196F3; }

        .element-set {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 15px;
            max-height: 100px;
            overflow-y: auto;
        }

        .element-chip {
            background: rgba(138, 154, 91, 0.3);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .element-chip:hover {
            background: rgba(188, 108, 37, 0.5);
        }

        .element-chip.highlight {
            background: var(--earth);
            color: var(--dark-moss);
        }

        @media (max-width: 900px) {
            .container {
                flex-direction: column;
            }
            .controls {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <a href="index.html" class="organic-back-link">
        <span>‚Üê</span>
        <span>Gallery</span>
    </a>

    <div class="container">
        <div class="canvas-container">
            <div class="main-canvas-wrapper">
                <div class="canvas-title">van Emde Boas Tree Structure (Universe = 16)</div>
                <canvas id="treeCanvas"></canvas>
            </div>
            <div class="comparison-row">
                <div class="comparison-wrapper">
                    <div class="canvas-title">Predecessor/Successor Query</div>
                    <canvas id="queryCanvas"></canvas>
                </div>
                <div class="comparison-wrapper">
                    <div class="canvas-title">Time Complexity Comparison</div>
                    <canvas id="complexityCanvas"></canvas>
                </div>
            </div>
        </div>

        <div class="controls">
            <h1>van Emde Boas Tree</h1>
            <p class="subtitle">O(log log U) operations via recursive sqrt(U) clusters</p>

            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-label">Universe Size</div>
                    <div class="stat-value" id="universeSize">16</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Elements</div>
                    <div class="stat-value" id="elementCount">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Tree Depth</div>
                    <div class="stat-value" id="treeDepth">2</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Cluster Size</div>
                    <div class="stat-value" id="clusterSize">4</div>
                </div>
            </div>

            <div class="control-group">
                <label>Insert Element (0-15)</label>
                <input type="number" id="insertValue" min="0" max="15" value="5">
            </div>

            <div class="button-row">
                <button id="insertBtn">Insert</button>
                <button id="deleteBtn" class="danger">Delete</button>
            </div>

            <div class="control-group">
                <label>Query Value</label>
                <input type="number" id="queryValue" min="0" max="15" value="7">
            </div>

            <div class="button-row">
                <button id="predBtn" class="secondary">Predecessor</button>
                <button id="succBtn" class="secondary">Successor</button>
            </div>

            <div class="button-row">
                <button id="randomBtn" class="secondary">Random Insert</button>
                <button id="clearBtn" class="danger">Clear All</button>
            </div>

            <div class="control-group">
                <label>Current Elements</label>
                <div class="element-set" id="elementSet"></div>
            </div>

            <div class="control-group">
                <label>Operation Log</label>
                <div class="operation-log" id="operationLog"></div>
            </div>

            <div class="info-box">
                <h3>Recursive Structure</h3>
                <p>
                    For U = 16, the tree has sqrt(16) = 4 clusters, each of size 4.
                    The summary tracks which clusters are non-empty.
                    This recursion gives O(log log U) time for all operations.
                </p>
            </div>

            <div class="info-box">
                <h3>Why It's Fast</h3>
                <p>
                    Predecessor/successor only needs to check the current cluster
                    or use the summary to jump to the next non-empty cluster.
                    Each level halves the bit-length, giving log log U depth.
                </p>
            </div>
        </div>
    </div>

    <script>
        const treeCanvas = document.getElementById('treeCanvas');
        const queryCanvas = document.getElementById('queryCanvas');
        const complexityCanvas = document.getElementById('complexityCanvas');

        const treeCtx = treeCanvas.getContext('2d');
        const queryCtx = queryCanvas.getContext('2d');
        const complexCtx = complexityCanvas.getContext('2d');

        class VEBTree {
            constructor(u) {
                this.u = u;
                this.min = null;
                this.max = null;

                if (u > 2) {
                    this.sqrtU = Math.ceil(Math.sqrt(u));
                    this.lowerSqrt = Math.floor(Math.sqrt(u));
                    this.summary = new VEBTree(this.sqrtU);
                    this.clusters = [];
                    for (let i = 0; i < this.sqrtU; i++) {
                        this.clusters.push(new VEBTree(this.lowerSqrt));
                    }
                }
            }

            high(x) { return Math.floor(x / this.lowerSqrt); }
            low(x) { return x % this.lowerSqrt; }
            index(high, low) { return high * this.lowerSqrt + low; }

            member(x) {
                if (x === this.min || x === this.max) return true;
                if (this.u <= 2) return false;
                return this.clusters[this.high(x)].member(this.low(x));
            }

            insert(x) {
                if (this.min === null) {
                    this.min = this.max = x;
                    return;
                }
                if (x < this.min) [x, this.min] = [this.min, x];
                if (this.u > 2) {
                    const hi = this.high(x);
                    const lo = this.low(x);
                    if (this.clusters[hi].min === null) {
                        this.summary.insert(hi);
                    }
                    this.clusters[hi].insert(lo);
                }
                if (x > this.max) this.max = x;
            }

            predecessor(x) {
                if (this.u <= 2) {
                    if (x === 1 && this.min === 0) return 0;
                    return null;
                }
                if (this.max !== null && x > this.max) return this.max;
                const hi = this.high(x);
                const lo = this.low(x);
                const minInCluster = this.clusters[hi].min;
                if (minInCluster !== null && lo > minInCluster) {
                    const offset = this.clusters[hi].predecessor(lo);
                    return this.index(hi, offset);
                }
                const predCluster = this.summary.predecessor(hi);
                if (predCluster === null) {
                    if (this.min !== null && x > this.min) return this.min;
                    return null;
                }
                const offset = this.clusters[predCluster].max;
                return this.index(predCluster, offset);
            }

            successor(x) {
                if (this.u <= 2) {
                    if (x === 0 && this.max === 1) return 1;
                    return null;
                }
                if (this.min !== null && x < this.min) return this.min;
                const hi = this.high(x);
                const lo = this.low(x);
                const maxInCluster = this.clusters[hi].max;
                if (maxInCluster !== null && lo < maxInCluster) {
                    const offset = this.clusters[hi].successor(lo);
                    return this.index(hi, offset);
                }
                const succCluster = this.summary.successor(hi);
                if (succCluster === null) return null;
                const offset = this.clusters[succCluster].min;
                return this.index(succCluster, offset);
            }

            delete(x) {
                if (this.min === this.max) {
                    this.min = this.max = null;
                    return;
                }
                if (this.u <= 2) {
                    this.min = (x === 0) ? 1 : 0;
                    this.max = this.min;
                    return;
                }
                if (x === this.min) {
                    const firstCluster = this.summary.min;
                    x = this.index(firstCluster, this.clusters[firstCluster].min);
                    this.min = x;
                }
                const hi = this.high(x);
                const lo = this.low(x);
                this.clusters[hi].delete(lo);
                if (this.clusters[hi].min === null) {
                    this.summary.delete(hi);
                }
                if (x === this.max) {
                    if (this.summary.max === null) {
                        this.max = this.min;
                    } else {
                        const maxCluster = this.summary.max;
                        this.max = this.index(maxCluster, this.clusters[maxCluster].max);
                    }
                }
            }

            getElements() {
                const elements = [];
                if (this.min === null) return elements;
                let x = this.min;
                while (x !== null) {
                    elements.push(x);
                    x = this.successor(x);
                }
                return elements;
            }
        }

        let veb = new VEBTree(16);
        let operationLog = [];
        let highlightedElement = null;
        let queryResult = null;

        function resizeCanvases() {
            [treeCanvas, queryCanvas, complexityCanvas].forEach(canvas => {
                const wrapper = canvas.parentElement;
                const rect = wrapper.getBoundingClientRect();
                canvas.width = rect.width - 30;
                canvas.height = rect.height - 50;
            });
            draw();
        }

        function log(message, type = 'query') {
            operationLog.unshift({ message, type, time: Date.now() });
            if (operationLog.length > 20) operationLog.pop();
            updateLogDisplay();
        }

        function updateLogDisplay() {
            const logEl = document.getElementById('operationLog');
            logEl.innerHTML = operationLog.map(entry =>
                `<div class="log-entry ${entry.type}">${entry.message}</div>`
            ).join('');
        }

        function updateElementDisplay() {
            const elements = veb.getElements();
            const setEl = document.getElementById('elementSet');
            setEl.innerHTML = elements.map(e =>
                `<span class="element-chip ${e === highlightedElement ? 'highlight' : ''}"
                       onclick="selectElement(${e})">${e}</span>`
            ).join('');
            document.getElementById('elementCount').textContent = elements.length;
        }

        window.selectElement = function(e) {
            highlightedElement = e;
            document.getElementById('queryValue').value = e;
            draw();
            updateElementDisplay();
        };

        function drawTree() {
            const ctx = treeCtx;
            const w = treeCanvas.width;
            const h = treeCanvas.height;

            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, w, h);

            const elements = veb.getElements();
            const padding = 40;
            const cellWidth = (w - padding * 2) / 16;

            ctx.font = '11px Nunito';
            for (let i = 0; i < 16; i++) {
                const x = padding + i * cellWidth;
                const y = 40;
                const isPresent = elements.includes(i);

                ctx.fillStyle = isPresent ?
                    (i === highlightedElement ? '#DDA15E' : '#4CAF50') :
                    'rgba(255, 255, 255, 0.1)';
                ctx.fillRect(x, y, cellWidth - 2, 30);

                ctx.fillStyle = isPresent ? '#000' : 'rgba(255, 255, 255, 0.5)';
                ctx.textAlign = 'center';
                ctx.fillText(i.toString(), x + cellWidth / 2, y + 20);
            }

            ctx.fillStyle = 'rgba(254, 250, 224, 0.7)';
            ctx.textAlign = 'left';
            ctx.fillText('Universe [0-15]', padding, 25);

            const clusterY = 120;
            const clusterWidth = (w - padding * 2) / 4;
            const cellInCluster = clusterWidth / 4;

            ctx.fillStyle = 'rgba(254, 250, 224, 0.7)';
            ctx.fillText('Clusters (4 clusters of size 4)', padding, clusterY - 10);

            for (let c = 0; c < 4; c++) {
                const clusterX = padding + c * clusterWidth + 10;

                ctx.fillStyle = 'rgba(138, 154, 91, 0.1)';
                ctx.strokeStyle = 'rgba(138, 154, 91, 0.5)';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.roundRect(clusterX - 5, clusterY, clusterWidth - 10, 50, 8);
                ctx.fill();
                ctx.stroke();

                ctx.fillStyle = 'rgba(254, 250, 224, 0.6)';
                ctx.font = '10px Nunito';
                ctx.textAlign = 'center';
                ctx.fillText(`Cluster ${c}`, clusterX + clusterWidth / 2 - 10, clusterY + 65);

                for (let i = 0; i < 4; i++) {
                    const globalIdx = c * 4 + i;
                    const x = clusterX + i * cellInCluster;
                    const isPresent = elements.includes(globalIdx);

                    ctx.fillStyle = isPresent ?
                        (globalIdx === highlightedElement ? '#DDA15E' : '#4CAF50') :
                        'rgba(255, 255, 255, 0.1)';
                    ctx.fillRect(x, clusterY + 10, cellInCluster - 4, 25);

                    ctx.fillStyle = isPresent ? '#000' : 'rgba(255, 255, 255, 0.4)';
                    ctx.font = '10px Nunito';
                    ctx.textAlign = 'center';
                    ctx.fillText(globalIdx.toString(), x + cellInCluster / 2, clusterY + 27);
                }
            }

            const summaryY = 220;
            ctx.fillStyle = 'rgba(254, 250, 224, 0.7)';
            ctx.font = '11px Nunito';
            ctx.textAlign = 'left';
            ctx.fillText('Summary (tracks non-empty clusters)', padding, summaryY - 10);

            const summaryWidth = (w - padding * 2) / 2;
            const summaryX = padding + (w - padding * 2) / 4;
            const summaryCellWidth = summaryWidth / 4;

            ctx.fillStyle = 'rgba(188, 108, 37, 0.1)';
            ctx.strokeStyle = 'rgba(188, 108, 37, 0.5)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.roundRect(summaryX - 5, summaryY, summaryWidth + 10, 50, 8);
            ctx.fill();
            ctx.stroke();

            for (let c = 0; c < 4; c++) {
                const x = summaryX + c * summaryCellWidth;
                const clusterHasElements = elements.some(e => Math.floor(e / 4) === c);

                ctx.fillStyle = clusterHasElements ? '#DDA15E' : 'rgba(255, 255, 255, 0.1)';
                ctx.fillRect(x + 5, summaryY + 10, summaryCellWidth - 10, 25);

                ctx.fillStyle = clusterHasElements ? '#000' : 'rgba(255, 255, 255, 0.4)';
                ctx.font = '11px Nunito';
                ctx.textAlign = 'center';
                ctx.fillText(c.toString(), x + summaryCellWidth / 2, summaryY + 27);
            }

            ctx.fillStyle = 'rgba(254, 250, 224, 0.7)';
            ctx.font = '12px Nunito';
            ctx.textAlign = 'left';
            const infoY = h - 40;

            if (veb.min !== null) {
                ctx.fillText(`Min: ${veb.min}`, padding, infoY);
                ctx.fillText(`Max: ${veb.max}`, padding + 80, infoY);
            } else {
                ctx.fillText('Tree is empty', padding, infoY);
            }

            ctx.strokeStyle = 'rgba(138, 154, 91, 0.3)';
            ctx.lineWidth = 1;
            ctx.setLineDash([3, 3]);
            for (let c = 0; c < 4; c++) {
                const clusterCenterX = padding + c * clusterWidth + clusterWidth / 2;
                const summaryCenterX = summaryX + c * summaryCellWidth + summaryCellWidth / 2;

                ctx.beginPath();
                ctx.moveTo(clusterCenterX, clusterY + 70);
                ctx.lineTo(summaryCenterX, summaryY);
                ctx.stroke();
            }
            ctx.setLineDash([]);
        }

        function drawQuery() {
            const ctx = queryCtx;
            const w = queryCanvas.width;
            const h = queryCanvas.height;

            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, w, h);

            const elements = veb.getElements();
            const padding = 30;
            const cellWidth = (w - padding * 2) / 16;

            for (let i = 0; i < 16; i++) {
                const x = padding + i * cellWidth;
                const y = h / 2 - 15;
                const isPresent = elements.includes(i);

                ctx.fillStyle = isPresent ? '#4CAF50' : 'rgba(255, 255, 255, 0.1)';
                ctx.fillRect(x, y, cellWidth - 2, 30);

                ctx.fillStyle = isPresent ? '#000' : 'rgba(255, 255, 255, 0.4)';
                ctx.font = '10px Nunito';
                ctx.textAlign = 'center';
                ctx.fillText(i.toString(), x + cellWidth / 2, y + 20);
            }

            if (queryResult !== null) {
                const queryVal = parseInt(document.getElementById('queryValue').value);
                const queryX = padding + queryVal * cellWidth + cellWidth / 2;

                ctx.fillStyle = '#2196F3';
                ctx.beginPath();
                ctx.moveTo(queryX, h / 2 + 25);
                ctx.lineTo(queryX - 8, h / 2 + 40);
                ctx.lineTo(queryX + 8, h / 2 + 40);
                ctx.closePath();
                ctx.fill();

                ctx.fillStyle = 'rgba(254, 250, 224, 0.8)';
                ctx.font = '10px Nunito';
                ctx.fillText(`Query: ${queryVal}`, queryX, h / 2 + 55);

                if (queryResult.value !== null) {
                    const resultX = padding + queryResult.value * cellWidth + cellWidth / 2;

                    ctx.strokeStyle = queryResult.type === 'pred' ? '#FF5722' : '#9C27B0';
                    ctx.lineWidth = 2;
                    ctx.setLineDash([5, 3]);
                    ctx.beginPath();
                    ctx.moveTo(queryX, h / 2 - 25);
                    ctx.lineTo(resultX, h / 2 - 25);
                    ctx.lineTo(resultX, h / 2 - 15);
                    ctx.stroke();
                    ctx.setLineDash([]);

                    ctx.fillStyle = queryResult.type === 'pred' ? '#FF5722' : '#9C27B0';
                    ctx.beginPath();
                    ctx.moveTo(resultX, h / 2 - 15);
                    ctx.lineTo(resultX - 6, h / 2 - 25);
                    ctx.lineTo(resultX + 6, h / 2 - 25);
                    ctx.closePath();
                    ctx.fill();

                    ctx.fillStyle = 'rgba(254, 250, 224, 0.8)';
                    ctx.font = '11px Nunito';
                    ctx.fillText(`${queryResult.type === 'pred' ? 'Pred' : 'Succ'}: ${queryResult.value}`, resultX, 20);
                } else {
                    ctx.fillStyle = 'rgba(244, 67, 54, 0.8)';
                    ctx.font = '11px Nunito';
                    ctx.textAlign = 'center';
                    ctx.fillText(`No ${queryResult.type === 'pred' ? 'predecessor' : 'successor'} found`, w / 2, 20);
                }
            }
        }

        function drawComplexity() {
            const ctx = complexCtx;
            const w = complexityCanvas.width;
            const h = complexityCanvas.height;

            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, w, h);

            const padding = 50;
            const plotW = w - padding * 2;
            const plotH = h - padding * 1.5;

            ctx.strokeStyle = 'rgba(254, 250, 224, 0.3)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, h - padding / 2);
            ctx.lineTo(w - padding / 2, h - padding / 2);
            ctx.stroke();

            ctx.fillStyle = 'rgba(254, 250, 224, 0.7)';
            ctx.font = '10px Nunito';
            ctx.textAlign = 'center';
            ctx.fillText('Universe Size (U)', w / 2, h - 10);

            ctx.save();
            ctx.translate(15, h / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('Time', 0, 0);
            ctx.restore();

            const maxU = 1000000;
            const maxLogU = Math.log2(maxU);
            const maxLogLogU = Math.log2(maxLogU);

            ctx.strokeStyle = '#f44336';
            ctx.lineWidth = 2;
            ctx.beginPath();
            for (let i = 0; i <= 100; i++) {
                const u = Math.exp((i / 100) * Math.log(maxU));
                const x = padding + (i / 100) * plotW;
                const y = h - padding / 2 - (Math.log2(u) / maxLogU) * plotH;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();

            ctx.strokeStyle = '#4CAF50';
            ctx.lineWidth = 2;
            ctx.beginPath();
            for (let i = 0; i <= 100; i++) {
                const u = Math.exp((i / 100) * Math.log(maxU));
                const x = padding + (i / 100) * plotW;
                const logLogU = Math.log2(Math.max(2, Math.log2(u)));
                const y = h - padding / 2 - (logLogU / maxLogLogU) * (plotH * 0.4);
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();

            ctx.font = '11px Nunito';

            ctx.fillStyle = '#f44336';
            ctx.fillRect(w - 120, 20, 15, 3);
            ctx.fillStyle = 'rgba(254, 250, 224, 0.8)';
            ctx.textAlign = 'left';
            ctx.fillText('O(log U) BST', w - 100, 24);

            ctx.fillStyle = '#4CAF50';
            ctx.fillRect(w - 120, 40, 15, 3);
            ctx.fillStyle = 'rgba(254, 250, 224, 0.8)';
            ctx.fillText('O(log log U) vEB', w - 100, 44);

            ctx.fillStyle = 'rgba(254, 250, 224, 0.6)';
            ctx.font = '10px Nunito';
            ctx.textAlign = 'center';
            ctx.fillText('Current: U=16, log U=4, log log U=2', w / 2, padding - 10);
        }

        function draw() {
            drawTree();
            drawQuery();
            drawComplexity();
        }

        document.getElementById('insertBtn').addEventListener('click', () => {
            const val = parseInt(document.getElementById('insertValue').value);
            if (val >= 0 && val <= 15 && !veb.member(val)) {
                veb.insert(val);
                log(`Insert(${val})`, 'insert');
                highlightedElement = val;
                draw();
                updateElementDisplay();
            }
        });

        document.getElementById('deleteBtn').addEventListener('click', () => {
            const val = parseInt(document.getElementById('insertValue').value);
            if (val >= 0 && val <= 15 && veb.member(val)) {
                veb.delete(val);
                log(`Delete(${val})`, 'delete');
                if (highlightedElement === val) highlightedElement = null;
                draw();
                updateElementDisplay();
            }
        });

        document.getElementById('predBtn').addEventListener('click', () => {
            const val = parseInt(document.getElementById('queryValue').value);
            const result = veb.predecessor(val);
            queryResult = { value: result, type: 'pred' };
            log(`Predecessor(${val}) = ${result !== null ? result : 'null'}`, 'query');
            if (result !== null) highlightedElement = result;
            draw();
            updateElementDisplay();
        });

        document.getElementById('succBtn').addEventListener('click', () => {
            const val = parseInt(document.getElementById('queryValue').value);
            const result = veb.successor(val);
            queryResult = { value: result, type: 'succ' };
            log(`Successor(${val}) = ${result !== null ? result : 'null'}`, 'query');
            if (result !== null) highlightedElement = result;
            draw();
            updateElementDisplay();
        });

        document.getElementById('randomBtn').addEventListener('click', () => {
            let val;
            const elements = veb.getElements();
            if (elements.length >= 16) return;

            do {
                val = Math.floor(Math.random() * 16);
            } while (veb.member(val));

            veb.insert(val);
            log(`Insert(${val}) [random]`, 'insert');
            highlightedElement = val;
            draw();
            updateElementDisplay();
        });

        document.getElementById('clearBtn').addEventListener('click', () => {
            veb = new VEBTree(16);
            highlightedElement = null;
            queryResult = null;
            log('Cleared all elements', 'delete');
            draw();
            updateElementDisplay();
        });

        window.addEventListener('resize', resizeCanvases);
        resizeCanvases();

        [3, 7, 10, 14].forEach(v => veb.insert(v));
        updateElementDisplay();
        draw();
    </script>
</body>
</html>
