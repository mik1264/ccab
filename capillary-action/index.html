<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Capillary Action</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: sans-serif; }
canvas { display: block; }
.title-overlay {
    position: fixed; top: 10px; left: 50%; transform: translateX(-50%);
    color: #fbbf24; font-size: 20px; font-weight: bold; z-index: 999;
    text-shadow: 0 0 10px rgba(0,0,0,0.8); pointer-events: none;
}
.controls {
    position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
    display: flex; gap: 20px; align-items: center; z-index: 999;
    background: rgba(0,0,0,0.7); padding: 12px 20px; border-radius: 10px;
    flex-wrap: wrap; justify-content: center;
}
.controls label { color: #ccc; font-size: 13px; }
.controls input[type=range] { width: 100px; cursor: pointer; }
.controls span { color: #fbbf24; font-size: 13px; min-width: 30px; }
.controls button {
    padding: 6px 14px; background: #fbbf24; color: #0a0e1a; border: none;
    border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: bold;
}
.info {
    position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
    color: rgba(255,255,255,0.5); font-size: 12px; z-index: 999;
    pointer-events: none; text-align: center;
}
</style>
</head>
<body>
<a href="../index.html" style="position:fixed;top:10px;left:10px;padding:8px 16px;background:rgba(0,0,0,0.7);color:#fbbf24;text-decoration:none;border-radius:6px;font-size:14px;z-index:999;font-family:sans-serif;">‚Üê Back to Gallery</a>
<div class="title-overlay">Capillary Action</div>
<div class="info">h = 2&gamma; cos(&theta;) / (&rho;gR) -- Narrower tubes produce higher fluid rise</div>
<div class="controls">
    <label>Surface Tension (&gamma;)</label>
    <input type="range" id="tensionSlider" min="2" max="20" value="10" step="1">
    <span id="tensionVal">10</span>
    <label>Contact Angle (&theta;)</label>
    <input type="range" id="angleSlider" min="0" max="90" value="20" step="5">
    <span id="angleVal">20&deg;</span>
    <button id="resetBtn">Reset</button>
</div>
<canvas id="canvas"></canvas>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let W, H;
let time = 0;

const TUBES = [
    { radius: 8, color: '#ff6b6b' },
    { radius: 14, color: '#ffa94d' },
    { radius: 22, color: '#69db7c' },
    { radius: 34, color: '#4dabf7' },
    { radius: 50, color: '#cc5de8' },
];

let tubeState = [];
let animProgress = 0;

function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
    initTubes();
}

function getCapillaryHeight(radius) {
    const gamma = parseInt(document.getElementById('tensionSlider').value) * 7;
    const theta = parseInt(document.getElementById('angleSlider').value) * Math.PI / 180;
    const rho = 1;
    const g = 9.8;
    // h = 2*gamma*cos(theta) / (rho * g * R)
    return 2 * gamma * Math.cos(theta) / (rho * g * radius);
}

function initTubes() {
    tubeState = [];
    const spacing = W / (TUBES.length + 1);
    const reservoirY = H * 0.65;

    for (let i = 0; i < TUBES.length; i++) {
        const tube = TUBES[i];
        const x = spacing * (i + 1);
        const targetH = getCapillaryHeight(tube.radius);
        tubeState.push({
            x: x,
            radius: tube.radius,
            color: tube.color,
            currentHeight: 0,
            targetHeight: targetH,
            reservoirY: reservoirY,
            tubeTop: H * 0.12,
            particles: []
        });

        // Init particles for this tube
        for (let j = 0; j < 20; j++) {
            tubeState[i].particles.push({
                x: x + (Math.random() - 0.5) * tube.radius * 1.2,
                y: reservoirY + Math.random() * 50,
                vy: -Math.random() * 0.5,
                size: 1 + Math.random() * 2
            });
        }
    }
    animProgress = 0;
}

function drawReservoir() {
    const reservoirY = H * 0.65;

    // Water body
    const waterGrad = ctx.createLinearGradient(0, reservoirY, 0, H);
    waterGrad.addColorStop(0, 'rgba(30, 90, 180, 0.6)');
    waterGrad.addColorStop(0.3, 'rgba(20, 70, 160, 0.7)');
    waterGrad.addColorStop(1, 'rgba(10, 40, 100, 0.8)');
    ctx.fillStyle = waterGrad;
    ctx.fillRect(0, reservoirY, W, H - reservoirY);

    // Surface shimmer
    ctx.strokeStyle = 'rgba(100, 180, 255, 0.3)';
    ctx.lineWidth = 2;
    ctx.beginPath();
    for (let x = 0; x < W; x += 3) {
        const wave = Math.sin(x * 0.02 + time * 2) * 2 + Math.sin(x * 0.05 + time * 1.5) * 1;
        if (x === 0) ctx.moveTo(x, reservoirY + wave);
        else ctx.lineTo(x, reservoirY + wave);
    }
    ctx.stroke();

    // Label
    ctx.fillStyle = 'rgba(255,255,255,0.4)';
    ctx.font = '13px sans-serif';
    ctx.fillText('Reservoir', 30, reservoirY + 30);
}

function drawTube(ts, index) {
    const reservoirY = ts.reservoirY;
    const r = ts.radius;
    const x = ts.x;
    const tubeTop = ts.tubeTop;

    // Glass tube
    ctx.strokeStyle = 'rgba(150, 200, 255, 0.4)';
    ctx.lineWidth = 2;
    // Left wall
    ctx.beginPath();
    ctx.moveTo(x - r, tubeTop);
    ctx.lineTo(x - r, reservoirY + 30);
    ctx.stroke();
    // Right wall
    ctx.beginPath();
    ctx.moveTo(x + r, tubeTop);
    ctx.lineTo(x + r, reservoirY + 30);
    ctx.stroke();

    // Glass effect - subtle fill
    ctx.fillStyle = 'rgba(100, 150, 220, 0.05)';
    ctx.fillRect(x - r, tubeTop, r * 2, reservoirY + 30 - tubeTop);

    // Fluid in tube
    const h = ts.currentHeight;
    const fluidTop = reservoirY - h;

    if (h > 0) {
        // Fluid column
        const fluidGrad = ctx.createLinearGradient(x - r, 0, x + r, 0);
        fluidGrad.addColorStop(0, 'rgba(30, 100, 200, 0.7)');
        fluidGrad.addColorStop(0.3, 'rgba(40, 120, 220, 0.8)');
        fluidGrad.addColorStop(0.7, 'rgba(40, 120, 220, 0.8)');
        fluidGrad.addColorStop(1, 'rgba(30, 100, 200, 0.7)');
        ctx.fillStyle = fluidGrad;
        ctx.fillRect(x - r + 2, fluidTop, (r - 2) * 2, reservoirY - fluidTop);

        // Meniscus (concave for wetting fluid)
        const theta = parseInt(document.getElementById('angleSlider').value) * Math.PI / 180;
        const meniscusDepth = r * 0.6 * Math.cos(theta);

        ctx.beginPath();
        ctx.moveTo(x - r + 2, fluidTop);
        ctx.quadraticCurveTo(x, fluidTop + meniscusDepth, x + r - 2, fluidTop);
        ctx.strokeStyle = 'rgba(100, 200, 255, 0.8)';
        ctx.lineWidth = 2;
        ctx.stroke();

        // Fill meniscus
        ctx.fillStyle = 'rgba(40, 120, 220, 0.5)';
        ctx.fill();
    }

    // Animate particles rising
    for (let p of ts.particles) {
        if (h > 5) {
            p.vy -= 0.01;
            p.y += p.vy;
            if (p.y < fluidTop + 5) {
                p.y = reservoirY + Math.random() * 20;
                p.vy = -Math.random() * 0.3;
                p.x = x + (Math.random() - 0.5) * r * 1.2;
            }
            if (p.x > x - r + 3 && p.x < x + r - 3 && p.y < reservoirY && p.y > fluidTop) {
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(150, 210, 255, 0.4)';
                ctx.fill();
            }
        }
    }

    // Height label and dimension line
    if (h > 10) {
        const labelX = x + r + 10;
        ctx.setLineDash([3, 3]);
        ctx.strokeStyle = ts.color;
        ctx.lineWidth = 1;
        // Height indicator line
        ctx.beginPath();
        ctx.moveTo(labelX, reservoirY);
        ctx.lineTo(labelX, fluidTop);
        ctx.stroke();
        // Ticks
        ctx.beginPath();
        ctx.moveTo(labelX - 5, reservoirY);
        ctx.lineTo(labelX + 5, reservoirY);
        ctx.moveTo(labelX - 5, fluidTop);
        ctx.lineTo(labelX + 5, fluidTop);
        ctx.stroke();
        ctx.setLineDash([]);

        // Height text
        ctx.fillStyle = ts.color;
        ctx.font = '11px sans-serif';
        ctx.textAlign = 'center';
        const hLabel = (h / 10).toFixed(1) + ' cm';
        ctx.fillText(hLabel, labelX + 5, (reservoirY + fluidTop) / 2 + 4);

        // Radius label
        ctx.fillStyle = 'rgba(200,200,200,0.6)';
        ctx.fillText('R=' + r, x, tubeTop - 8);
        ctx.textAlign = 'left';
    }
}

function drawEquation() {
    ctx.fillStyle = 'rgba(0,0,0,0.6)';
    ctx.fillRect(W / 2 - 170, H * 0.08, 340, 50);
    ctx.strokeStyle = 'rgba(251,191,36,0.3)';
    ctx.strokeRect(W / 2 - 170, H * 0.08, 340, 50);

    ctx.fillStyle = '#eee';
    ctx.font = '15px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('h = 2\u03B3 cos(\u03B8) / (\u03C1gR)', W / 2, H * 0.08 + 22);

    ctx.fillStyle = '#aaa';
    ctx.font = '11px sans-serif';
    ctx.fillText('Height inversely proportional to tube radius', W / 2, H * 0.08 + 42);
    ctx.textAlign = 'left';
}

function render() {
    ctx.fillStyle = '#0a0e1a';
    ctx.fillRect(0, 0, W, H);
    time += 0.016;

    // Animate fluid rising
    animProgress = Math.min(1, animProgress + 0.008);
    const easeProgress = 1 - Math.pow(1 - animProgress, 3);

    for (let ts of tubeState) {
        ts.targetHeight = getCapillaryHeight(ts.radius);
        ts.currentHeight += (ts.targetHeight * easeProgress - ts.currentHeight) * 0.05;
    }

    drawReservoir();

    for (let i = 0; i < tubeState.length; i++) {
        drawTube(tubeState[i], i);
    }

    drawEquation();

    // Draw comparison text
    ctx.fillStyle = 'rgba(255,255,255,0.35)';
    ctx.font = '12px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('Narrower tubes \u2192 Higher rise', W / 2, H * 0.65 + 60);
    ctx.textAlign = 'left';
}

document.getElementById('tensionSlider').addEventListener('input', function() {
    document.getElementById('tensionVal').textContent = this.value;
});
document.getElementById('angleSlider').addEventListener('input', function() {
    document.getElementById('angleVal').textContent = this.value + '\u00B0';
});
document.getElementById('resetBtn').addEventListener('click', () => {
    animProgress = 0;
    for (let ts of tubeState) ts.currentHeight = 0;
});

function animate() {
    render();
    requestAnimationFrame(animate);
}

window.addEventListener('resize', resize);
resize();
animate();
</script>
</body>
</html>
