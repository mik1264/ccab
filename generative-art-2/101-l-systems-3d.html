<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D L-System</title>
    <style>body { margin: 0; overflow: hidden; }</style>
</head>
<body>
    <script src="../assets/js/three.min.js"></script>
    <script>
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        camera.position.z = 20;
        camera.position.y = 10;
        camera.lookAt(0, 5, 0);

        // L-System Rules
        const rules = { "F": "F[+F]F[-F][F]" };
        let axiom = "F";
        
        function generate() {
            let next = "";
            for(let c of axiom) {
                next += rules[c] || c;
            }
            axiom = next;
        }

        // Generate 3 iterations
        generate(); generate(); generate();

        // Build Geometry
        const material = new THREE.LineBasicMaterial({ color: 0x00ff00 });
        const points = [];
        const stack = [];
        let pos = new THREE.Vector3(0, 0, 0);
        let dir = new THREE.Vector3(0, 1, 0);
        const len = 2;

        for(let c of axiom) {
            if(c === "F") {
                const nextPos = pos.clone().add(dir.clone().multiplyScalar(len));
                points.push(pos.clone(), nextPos.clone());
                pos = nextPos;
            } else if(c === "[") {
                stack.push({ p: pos.clone(), d: dir.clone() });
            } else if(c === "]") {
                const state = stack.pop();
                pos = state.p;
                dir = state.d;
            } else if(c === "+") {
                dir.applyAxisAngle(new THREE.Vector3(1, 0, 0), Math.PI/4);
            } else if(c === "-") {
                dir.applyAxisAngle(new THREE.Vector3(0, 0, 1), Math.PI/4);
            }
        }

        const geometry = new THREE.BufferGeometry().setFromPoints(points);
        const line = new THREE.LineSegments(geometry, material);
        scene.add(line);

        function animate() {
            requestAnimationFrame(animate);
            line.rotation.y += 0.01;
            renderer.render(scene, camera);
        }
        animate();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
