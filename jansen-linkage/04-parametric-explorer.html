<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jansen Linkage - Parametric Explorer</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #1a1a2e;
            min-height: 100vh;
            font-family: 'Segoe UI', sans-serif;
            color: #eee;
            display: flex;
        }
        .sidebar {
            width: 320px;
            background: #16213e;
            padding: 20px;
            overflow-y: auto;
            height: 100vh;
        }
        .sidebar h2 { color: #e94560; margin-bottom: 15px; font-size: 1.1rem; }
        .param-group { margin-bottom: 15px; }
        .param-label {
            display: flex; justify-content: space-between;
            font-size: 0.85rem; margin-bottom: 3px;
        }
        .param-value { color: #e94560; font-weight: bold; }
        input[type="range"] {
            width: 100%; height: 6px;
            -webkit-appearance: none;
            background: #0f3460;
            border-radius: 3px;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px; height: 14px;
            background: #e94560;
            border-radius: 50%;
            cursor: pointer;
        }
        .main { flex: 1; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        h1 { color: #e94560; font-size: 1.4rem; margin-bottom: 10px; }
        canvas { background: #0f0f23; border-radius: 10px; }
        .buttons { display: flex; gap: 10px; margin-top: 15px; }
        button {
            background: #e94560; color: white; border: none;
            padding: 8px 16px; border-radius: 5px; cursor: pointer;
            font-size: 0.85rem;
        }
        button:hover { background: #ff6b6b; }
        a.back-link {
            position: fixed; top: 20px; right: 20px;
            color: #e94560; text-decoration: none;
        }
        .preset-btn {
            background: #0f3460; margin: 3px; padding: 6px 10px;
            font-size: 0.75rem;
        }
        .preset-btn:hover { background: #1a4070; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Gallery</a>

    <div class="sidebar">
        <h2>Holy Numbers</h2>
        <p style="font-size: 0.75rem; color: #888; margin-bottom: 15px;">
            Theo Jansen's optimized parameters. Try modifying them!
        </p>

        <div id="params"></div>

        <h2 style="margin-top: 20px;">Presets</h2>
        <button class="preset-btn" onclick="loadPreset('original')">Original</button>
        <button class="preset-btn" onclick="loadPreset('tall')">Tall Walker</button>
        <button class="preset-btn" onclick="loadPreset('compact')">Compact</button>
        <button class="preset-btn" onclick="loadPreset('wide')">Wide Stride</button>
        <button class="preset-btn" onclick="loadPreset('random')">Random</button>
    </div>

    <div class="main">
        <h1>Parametric Linkage Explorer</h1>
        <canvas id="canvas" width="700" height="550"></canvas>
        <div class="buttons">
            <button id="playPause">Pause</button>
            <button id="resetTrail">Clear Trail</button>
            <button id="resetParams">Reset to Original</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        const ORIGINAL = {
            a: 38.0, b: 41.5, c: 39.3, d: 40.1, e: 55.8,
            f: 39.4, g: 36.7, h: 65.7, i: 49.0, j: 50.0,
            k: 61.9, l: 7.8, m: 15.0
        };

        const PRESETS = {
            original: { ...ORIGINAL },
            tall: { a: 38, b: 50, c: 45, d: 48, e: 70, f: 45, g: 40, h: 80, i: 55, j: 55, k: 75, l: 8, m: 18 },
            compact: { a: 30, b: 35, c: 33, d: 34, e: 45, f: 33, g: 30, h: 55, i: 40, j: 42, k: 50, l: 6, m: 12 },
            wide: { a: 45, b: 48, c: 42, d: 44, e: 60, f: 42, g: 38, h: 70, i: 52, j: 54, k: 68, l: 10, m: 18 }
        };

        let PARAMS = { ...ORIGINAL };
        let theta = 0;
        let running = true;
        let footPath = [];

        const SCALE = 3;
        const CENTER_X = canvas.width / 2;
        const CENTER_Y = canvas.height / 2 - 50;

        // Create parameter sliders
        const paramContainer = document.getElementById('params');
        const paramNames = Object.keys(ORIGINAL);
        const paramRanges = {
            a: [20, 60], b: [25, 70], c: [25, 60], d: [25, 60], e: [35, 80],
            f: [25, 60], g: [20, 55], h: [40, 100], i: [30, 70], j: [30, 70],
            k: [40, 90], l: [0, 20], m: [5, 30]
        };

        paramNames.forEach(name => {
            const group = document.createElement('div');
            group.className = 'param-group';

            const label = document.createElement('div');
            label.className = 'param-label';
            label.innerHTML = `<span>${name}</span><span class="param-value" id="val-${name}">${PARAMS[name]}</span>`;

            const slider = document.createElement('input');
            slider.type = 'range';
            slider.id = `param-${name}`;
            slider.min = paramRanges[name][0];
            slider.max = paramRanges[name][1];
            slider.step = 0.1;
            slider.value = PARAMS[name];

            slider.addEventListener('input', function() {
                PARAMS[name] = parseFloat(this.value);
                document.getElementById(`val-${name}`).textContent = this.value;
                footPath = [];
            });

            group.appendChild(label);
            group.appendChild(slider);
            paramContainer.appendChild(group);
        });

        function loadPreset(name) {
            if (name === 'random') {
                paramNames.forEach(p => {
                    const [min, max] = paramRanges[p];
                    PARAMS[p] = Math.round((min + Math.random() * (max - min)) * 10) / 10;
                });
            } else {
                PARAMS = { ...PRESETS[name] };
            }

            paramNames.forEach(p => {
                document.getElementById(`param-${p}`).value = PARAMS[p];
                document.getElementById(`val-${p}`).textContent = PARAMS[p];
            });
            footPath = [];
        }

        function circleIntersection(x1, y1, r1, x2, y2, r2, selectUpper = true) {
            const d = Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
            if (d > r1 + r2 || d < Math.abs(r1 - r2) || d === 0) return null;
            const a = (r1 * r1 - r2 * r2 + d * d) / (2 * d);
            const h = Math.sqrt(Math.max(0, r1 * r1 - a * a));
            const px = x1 + a * (x2 - x1) / d;
            const py = y1 + a * (y2 - y1) / d;
            const ix1 = px + h * (y2 - y1) / d;
            const iy1 = py - h * (x2 - x1) / d;
            const ix2 = px - h * (y2 - y1) / d;
            const iy2 = py + h * (x2 - x1) / d;
            return selectUpper ? (iy1 < iy2 ? { x: ix1, y: iy1 } : { x: ix2, y: iy2 })
                               : (iy1 > iy2 ? { x: ix1, y: iy1 } : { x: ix2, y: iy2 });
        }

        function calculateJoints(theta) {
            const p = PARAMS;
            const O = { x: 0, y: 0 };
            const M = { x: -p.l, y: -p.m };
            const A = { x: p.a * Math.cos(theta), y: p.a * Math.sin(theta) };
            const B = circleIntersection(A.x, A.y, p.b, M.x, M.y, p.j, true);
            if (!B) return null;
            const C = circleIntersection(A.x, A.y, p.d, B.x, B.y, p.c, false);
            if (!C) return null;
            const D = circleIntersection(B.x, B.y, p.e, C.x, C.y, p.f, false);
            if (!D) return null;
            const E = circleIntersection(M.x, M.y, p.i, D.x, D.y, p.g, true);
            if (!E) return null;
            const F = circleIntersection(E.x, E.y, p.h, D.x, D.y, p.k, false);
            if (!F) return null;
            return { O, M, A, B, C, D, E, F };
        }

        function drawLinkage(joints) {
            if (!joints) {
                ctx.fillStyle = '#e94560';
                ctx.font = '16px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('Invalid configuration - adjust parameters', CENTER_X, CENTER_Y);
                return;
            }

            ctx.save();
            ctx.translate(CENTER_X, CENTER_Y);
            ctx.scale(SCALE, SCALE);

            const links = [
                [joints.O, joints.A, '#e94560'],
                [joints.A, joints.B, '#f39c12'],
                [joints.M, joints.B, '#2ecc71'],
                [joints.A, joints.C, '#3498db'],
                [joints.B, joints.C, '#9b59b6'],
                [joints.B, joints.D, '#e74c3c'],
                [joints.C, joints.D, '#1abc9c'],
                [joints.M, joints.E, '#f1c40f'],
                [joints.D, joints.E, '#e67e22'],
                [joints.E, joints.F, '#ecf0f1'],
                [joints.D, joints.F, '#95a5a6']
            ];

            links.forEach(([p1, p2, color]) => {
                ctx.strokeStyle = color;
                ctx.lineWidth = 2.5 / SCALE;
                ctx.lineCap = 'round';
                ctx.beginPath();
                ctx.moveTo(p1.x, p1.y);
                ctx.lineTo(p2.x, p2.y);
                ctx.stroke();
            });

            // Fixed joints
            [joints.O, joints.M].forEach(p => {
                ctx.fillStyle = '#e94560';
                ctx.beginPath();
                ctx.arc(p.x, p.y, 4 / SCALE, 0, Math.PI * 2);
                ctx.fill();
            });

            // Moving joints
            [joints.A, joints.B, joints.C, joints.D, joints.E].forEach(p => {
                ctx.fillStyle = '#f39c12';
                ctx.beginPath();
                ctx.arc(p.x, p.y, 3 / SCALE, 0, Math.PI * 2);
                ctx.fill();
            });

            // Foot
            ctx.fillStyle = '#2ecc71';
            ctx.beginPath();
            ctx.arc(joints.F.x, joints.F.y, 5 / SCALE, 0, Math.PI * 2);
            ctx.fill();

            ctx.restore();
        }

        function drawFootPath() {
            if (footPath.length < 2) return;

            ctx.save();
            ctx.translate(CENTER_X, CENTER_Y);
            ctx.scale(SCALE, SCALE);

            ctx.strokeStyle = 'rgba(46, 204, 113, 0.7)';
            ctx.lineWidth = 1.5 / SCALE;
            ctx.beginPath();
            ctx.moveTo(footPath[0].x, footPath[0].y);
            for (let i = 1; i < footPath.length; i++) {
                ctx.lineTo(footPath[i].x, footPath[i].y);
            }
            ctx.stroke();

            ctx.restore();
        }

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            drawFootPath();

            const joints = calculateJoints(theta);
            drawLinkage(joints);

            if (joints && joints.F) {
                footPath.push({ x: joints.F.x, y: joints.F.y });
                if (footPath.length > 400) footPath.shift();
            }

            if (running) {
                theta += 0.02;
                if (theta > Math.PI * 2) theta -= Math.PI * 2;
            }

            requestAnimationFrame(animate);
        }

        document.getElementById('playPause').addEventListener('click', function() {
            running = !running;
            this.textContent = running ? 'Pause' : 'Play';
        });

        document.getElementById('resetTrail').addEventListener('click', () => { footPath = []; });
        document.getElementById('resetParams').addEventListener('click', () => loadPreset('original'));

        animate();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
