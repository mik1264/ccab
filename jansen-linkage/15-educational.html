<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jansen Linkage - Educational Guide</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #f5f5f5;
            min-height: 100vh;
            font-family: 'Segoe UI', sans-serif;
            display: flex;
        }
        .sidebar {
            width: 350px;
            background: #fff;
            padding: 20px;
            overflow-y: auto;
            height: 100vh;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }
        .sidebar h2 { color: #2c3e50; margin-bottom: 15px; font-size: 1.1rem; }
        .sidebar p { font-size: 0.85rem; color: #666; line-height: 1.6; margin-bottom: 15px; }
        .param-table {
            width: 100%; border-collapse: collapse; font-size: 0.8rem;
            margin-bottom: 20px;
        }
        .param-table th, .param-table td {
            padding: 8px; text-align: left; border-bottom: 1px solid #eee;
        }
        .param-table th { color: #2c3e50; font-weight: 600; }
        .highlight { background: #fff3cd; padding: 10px; border-radius: 5px; margin: 15px 0; }
        .main {
            flex: 1; display: flex; flex-direction: column;
            align-items: center; padding: 20px;
        }
        h1 { color: #2c3e50; margin-bottom: 10px; font-size: 1.3rem; }
        canvas { background: #fff; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        a.back-link {
            position: fixed; top: 20px; right: 20px;
            color: #3498db; text-decoration: none;
        }
        .legend { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px; }
        .legend-item { display: flex; align-items: center; gap: 5px; font-size: 0.75rem; }
        .legend-color { width: 20px; height: 4px; border-radius: 2px; }
        .controls { margin-top: 15px; }
        button {
            background: #3498db; color: #fff; border: none;
            padding: 8px 16px; border-radius: 5px; cursor: pointer; margin: 0 5px;
        }
        .step-indicator {
            display: flex; gap: 8px; margin: 15px 0;
        }
        .step {
            width: 30px; height: 30px; border-radius: 50%;
            background: #eee; display: flex; align-items: center;
            justify-content: center; font-size: 0.8rem; cursor: pointer;
        }
        .step.active { background: #3498db; color: #fff; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Gallery</a>

    <div class="sidebar">
        <h2>Jansen Linkage Tutorial</h2>
        <p>The Jansen linkage is an 11-bar planar leg mechanism designed by Dutch artist Theo Jansen. It converts rotary motion into smooth walking motion.</p>

        <div class="highlight">
            <strong>Key Insight:</strong> The "Holy Numbers" are 13 carefully optimized link lengths that produce an ideal walking trajectory.
        </div>

        <h2>The Holy Numbers</h2>
        <table class="param-table">
            <tr><th>Parameter</th><th>Value</th><th>Description</th></tr>
            <tr><td>a</td><td>38.0</td><td>Crank radius</td></tr>
            <tr><td>b</td><td>41.5</td><td>Crank to B link</td></tr>
            <tr><td>c</td><td>39.3</td><td>B to C link</td></tr>
            <tr><td>d</td><td>40.1</td><td>Crank to C link</td></tr>
            <tr><td>e</td><td>55.8</td><td>B to D link</td></tr>
            <tr><td>f</td><td>39.4</td><td>C to D link</td></tr>
            <tr><td>g</td><td>36.7</td><td>D to E link</td></tr>
            <tr><td>h</td><td>65.7</td><td>E to foot link</td></tr>
            <tr><td>i</td><td>49.0</td><td>M to E link</td></tr>
            <tr><td>j</td><td>50.0</td><td>M to B link</td></tr>
            <tr><td>k</td><td>61.9</td><td>D to foot link</td></tr>
            <tr><td>l</td><td>7.8</td><td>X offset (O to M)</td></tr>
            <tr><td>m</td><td>15.0</td><td>Y offset (O to M)</td></tr>
        </table>

        <h2 id="stepTitle">Step 1: Fixed Points</h2>
        <p id="stepDesc">The mechanism has two fixed pivot points: O (origin) and M (offset from O by l and m).</p>
    </div>

    <div class="main">
        <h1>Interactive Linkage Construction</h1>

        <div class="step-indicator" id="steps">
            <div class="step active" data-step="1">1</div>
            <div class="step" data-step="2">2</div>
            <div class="step" data-step="3">3</div>
            <div class="step" data-step="4">4</div>
            <div class="step" data-step="5">5</div>
            <div class="step" data-step="6">6</div>
        </div>

        <canvas id="canvas" width="700" height="500"></canvas>

        <div class="legend">
            <div class="legend-item"><div class="legend-color" style="background: #e74c3c;"></div> Fixed pivots (O, M)</div>
            <div class="legend-item"><div class="legend-color" style="background: #f39c12;"></div> Crank (rotating)</div>
            <div class="legend-item"><div class="legend-color" style="background: #3498db;"></div> Upper linkage</div>
            <div class="legend-item"><div class="legend-color" style="background: #9b59b6;"></div> Lower linkage</div>
            <div class="legend-item"><div class="legend-color" style="background: #27ae60;"></div> Foot point</div>
        </div>

        <div class="controls">
            <button onclick="prevStep()">← Previous</button>
            <button onclick="toggleAnimation()">Play/Pause</button>
            <button onclick="nextStep()">Next →</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        const PARAMS = {
            a: 38.0, b: 41.5, c: 39.3, d: 40.1, e: 55.8,
            f: 39.4, g: 36.7, h: 65.7, i: 49.0, j: 50.0,
            k: 61.9, l: 7.8, m: 15.0
        };

        let theta = 0;
        let currentStep = 1;
        let animating = true;

        const STEPS = [
            { title: 'Step 1: Fixed Points', desc: 'The mechanism has two fixed pivot points: O (the main pivot) and M (offset from O). These never move.' },
            { title: 'Step 2: Crank Arm', desc: 'Point A rotates around O with radius "a". This is the input that drives the whole mechanism, like a motor shaft.' },
            { title: 'Step 3: Triangle OAB', desc: 'Point B is determined by the intersection of circles: one from A (radius b) and one from M (radius j). This creates the first triangle.' },
            { title: 'Step 4: Point C', desc: 'Point C is found at the intersection of circles from A (radius d) and B (radius c). This forms the upper linkage.' },
            { title: 'Step 5: Points D and E', desc: 'Point D connects B and C through links e and f. Point E is constrained by M (radius i) and D (radius g).' },
            { title: 'Step 6: The Foot', desc: 'Finally, point F (the foot) is at the intersection of circles from E (radius h) and D (radius k). This traces the walking path!' }
        ];

        function circleIntersection(x1, y1, r1, x2, y2, r2, selectUpper = true) {
            const d = Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
            if (d > r1 + r2 || d < Math.abs(r1 - r2) || d === 0) return null;
            const a = (r1 * r1 - r2 * r2 + d * d) / (2 * d);
            const h = Math.sqrt(Math.max(0, r1 * r1 - a * a));
            const px = x1 + a * (x2 - x1) / d;
            const py = y1 + a * (y2 - y1) / d;
            const ix1 = px + h * (y2 - y1) / d;
            const iy1 = py - h * (x2 - x1) / d;
            const ix2 = px - h * (y2 - y1) / d;
            const iy2 = py + h * (x2 - x1) / d;
            return selectUpper ? (iy1 < iy2 ? { x: ix1, y: iy1 } : { x: ix2, y: iy2 })
                               : (iy1 > iy2 ? { x: ix1, y: iy1 } : { x: ix2, y: iy2 });
        }

        function calculateJoints(theta) {
            const p = PARAMS;
            const O = { x: 0, y: 0 };
            const M = { x: -p.l, y: -p.m };
            const A = { x: p.a * Math.cos(theta), y: p.a * Math.sin(theta) };
            const B = circleIntersection(A.x, A.y, p.b, M.x, M.y, p.j, true);
            if (!B) return null;
            const C = circleIntersection(A.x, A.y, p.d, B.x, B.y, p.c, false);
            if (!C) return null;
            const D = circleIntersection(B.x, B.y, p.e, C.x, C.y, p.f, false);
            if (!D) return null;
            const E = circleIntersection(M.x, M.y, p.i, D.x, D.y, p.g, true);
            if (!E) return null;
            const F = circleIntersection(E.x, E.y, p.h, D.x, D.y, p.k, false);
            if (!F) return null;
            return { O, M, A, B, C, D, E, F };
        }

        function drawCircle(x, y, r, color) {
            ctx.strokeStyle = color;
            ctx.lineWidth = 1;
            ctx.setLineDash([3, 3]);
            ctx.beginPath();
            ctx.arc(x, y, r, 0, Math.PI * 2);
            ctx.stroke();
            ctx.setLineDash([]);
        }

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const SCALE = 2.8;
            const cx = canvas.width / 2;
            const cy = canvas.height / 2 - 30;

            const joints = calculateJoints(theta);
            if (!joints) { theta += 0.015; requestAnimationFrame(animate); return; }

            const toScreen = (p) => ({ x: cx + p.x * SCALE, y: cy + p.y * SCALE });
            const O = toScreen(joints.O);
            const M = toScreen(joints.M);
            const A = toScreen(joints.A);
            const B = toScreen(joints.B);
            const C = toScreen(joints.C);
            const D = toScreen(joints.D);
            const E = toScreen(joints.E);
            const F = toScreen(joints.F);

            // Draw foot trajectory (always visible)
            ctx.strokeStyle = 'rgba(39, 174, 96, 0.2)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            let first = true;
            for (let t = 0; t < Math.PI * 2; t += 0.05) {
                const j = calculateJoints(t);
                if (j) {
                    const p = toScreen(j.F);
                    if (first) { ctx.moveTo(p.x, p.y); first = false; }
                    else ctx.lineTo(p.x, p.y);
                }
            }
            ctx.closePath();
            ctx.stroke();

            // Step-based rendering
            if (currentStep >= 1) {
                // Fixed points
                ctx.fillStyle = '#e74c3c';
                [O, M].forEach((p, i) => {
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, 8, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.fillStyle = '#fff';
                    ctx.font = 'bold 10px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText(i === 0 ? 'O' : 'M', p.x, p.y + 4);
                    ctx.fillStyle = '#e74c3c';
                });
            }

            if (currentStep >= 2) {
                // Crank circle
                drawCircle(O.x, O.y, PARAMS.a * SCALE, 'rgba(243, 156, 18, 0.3)');

                // Crank arm OA
                ctx.strokeStyle = '#f39c12';
                ctx.lineWidth = 4;
                ctx.beginPath();
                ctx.moveTo(O.x, O.y);
                ctx.lineTo(A.x, A.y);
                ctx.stroke();

                ctx.fillStyle = '#f39c12';
                ctx.beginPath();
                ctx.arc(A.x, A.y, 6, 0, Math.PI * 2);
                ctx.fill();
            }

            if (currentStep >= 3) {
                // Construction circles for B
                drawCircle(A.x, A.y, PARAMS.b * SCALE, 'rgba(52, 152, 219, 0.3)');
                drawCircle(M.x, M.y, PARAMS.j * SCALE, 'rgba(155, 89, 182, 0.3)');

                // Links AB and MB
                ctx.strokeStyle = '#3498db';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(A.x, A.y);
                ctx.lineTo(B.x, B.y);
                ctx.stroke();

                ctx.strokeStyle = '#9b59b6';
                ctx.beginPath();
                ctx.moveTo(M.x, M.y);
                ctx.lineTo(B.x, B.y);
                ctx.stroke();

                ctx.fillStyle = '#3498db';
                ctx.beginPath();
                ctx.arc(B.x, B.y, 5, 0, Math.PI * 2);
                ctx.fill();
            }

            if (currentStep >= 4) {
                // Links AC and BC
                ctx.strokeStyle = '#3498db';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(A.x, A.y);
                ctx.lineTo(C.x, C.y);
                ctx.stroke();

                ctx.beginPath();
                ctx.moveTo(B.x, B.y);
                ctx.lineTo(C.x, C.y);
                ctx.stroke();

                ctx.fillStyle = '#3498db';
                ctx.beginPath();
                ctx.arc(C.x, C.y, 5, 0, Math.PI * 2);
                ctx.fill();
            }

            if (currentStep >= 5) {
                // Links BD, CD, ME, DE
                ctx.strokeStyle = '#9b59b6';
                ctx.lineWidth = 3;

                ctx.beginPath();
                ctx.moveTo(B.x, B.y);
                ctx.lineTo(D.x, D.y);
                ctx.stroke();

                ctx.beginPath();
                ctx.moveTo(C.x, C.y);
                ctx.lineTo(D.x, D.y);
                ctx.stroke();

                ctx.beginPath();
                ctx.moveTo(M.x, M.y);
                ctx.lineTo(E.x, E.y);
                ctx.stroke();

                ctx.beginPath();
                ctx.moveTo(D.x, D.y);
                ctx.lineTo(E.x, E.y);
                ctx.stroke();

                ctx.fillStyle = '#9b59b6';
                ctx.beginPath();
                ctx.arc(D.x, D.y, 5, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.arc(E.x, E.y, 5, 0, Math.PI * 2);
                ctx.fill();
            }

            if (currentStep >= 6) {
                // Final links to foot
                ctx.strokeStyle = '#27ae60';
                ctx.lineWidth = 3;

                ctx.beginPath();
                ctx.moveTo(E.x, E.y);
                ctx.lineTo(F.x, F.y);
                ctx.stroke();

                ctx.beginPath();
                ctx.moveTo(D.x, D.y);
                ctx.lineTo(F.x, F.y);
                ctx.stroke();

                // Foot with glow
                ctx.shadowColor = '#27ae60';
                ctx.shadowBlur = 15;
                ctx.fillStyle = '#27ae60';
                ctx.beginPath();
                ctx.arc(F.x, F.y, 8, 0, Math.PI * 2);
                ctx.fill();
                ctx.shadowBlur = 0;
            }

            if (animating) theta += 0.02;
            requestAnimationFrame(animate);
        }

        function updateStep() {
            document.querySelectorAll('.step').forEach((el, i) => {
                el.classList.toggle('active', i + 1 === currentStep);
            });
            document.getElementById('stepTitle').textContent = STEPS[currentStep - 1].title;
            document.getElementById('stepDesc').textContent = STEPS[currentStep - 1].desc;
        }

        function prevStep() {
            if (currentStep > 1) { currentStep--; updateStep(); }
        }

        function nextStep() {
            if (currentStep < 6) { currentStep++; updateStep(); }
        }

        function toggleAnimation() {
            animating = !animating;
        }

        document.querySelectorAll('.step').forEach(el => {
            el.addEventListener('click', () => {
                currentStep = parseInt(el.dataset.step);
                updateStep();
            });
        });

        animate();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
