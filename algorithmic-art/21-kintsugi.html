<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kintsugi Crack Generator - CCAB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #e8e8e8;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        header { text-align: center; padding: 20px; margin-bottom: 20px; }
        h1 {
            font-size: 2.2rem;
            background: linear-gradient(90deg, #f39c12, #d4af37);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .subtitle { color: #888; }
        .back-link { position: absolute; top: 20px; left: 20px; color: #f39c12; text-decoration: none; }
        .main-content { display: grid; grid-template-columns: 1fr 350px; gap: 20px; }
        .canvas-container { background: rgba(255,255,255,0.05); border-radius: 16px; padding: 20px; }
        canvas { display: block; margin: 0 auto; border-radius: 8px; cursor: crosshair; }
        .controls { display: flex; flex-direction: column; gap: 15px; }
        .panel { background: rgba(255,255,255,0.05); backdrop-filter: blur(10px); border-radius: 12px; padding: 15px; }
        .panel h3 { color: #f39c12; font-size: 1rem; margin-bottom: 10px; border-bottom: 1px solid rgba(243,156,18,0.3); padding-bottom: 5px; }
        button {
            padding: 10px 15px; background: rgba(243,156,18,0.2);
            border: 1px solid rgba(243,156,18,0.5); border-radius: 6px;
            color: #f39c12; cursor: pointer; width: 100%; margin-bottom: 8px;
        }
        button:hover { background: rgba(243,156,18,0.3); }
        .control-group { margin-bottom: 12px; }
        .control-group label { display: block; color: #f39c12; font-size: 0.85rem; margin-bottom: 5px; }
        input[type="range"] {
            width: 100%; height: 6px; -webkit-appearance: none;
            background: rgba(243,156,18,0.2); border-radius: 3px;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; width: 16px; height: 16px;
            background: #f39c12; border-radius: 50%; cursor: pointer;
        }
        input[type="color"] {
            width: 100%; height: 40px; border: none; border-radius: 6px;
            cursor: pointer;
        }
        select {
            width: 100%; padding: 8px; background: rgba(0,0,0,0.3);
            border: 1px solid rgba(243,156,18,0.3); border-radius: 6px;
            color: #e8e8e8; font-size: 0.85rem;
        }
        .stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }
        .stat { background: rgba(0,0,0,0.2); padding: 10px; border-radius: 6px; text-align: center; }
        .stat-value { font-size: 1rem; color: #f39c12; font-weight: bold; }
        .stat-label { font-size: 0.7rem; color: #888; }
        .info-text { font-size: 0.85rem; color: #aaa; line-height: 1.6; }
        .color-presets { display: flex; gap: 8px; margin-top: 10px; }
        .color-preset {
            width: 30px; height: 30px; border-radius: 50%;
            cursor: pointer; border: 2px solid transparent;
        }
        .color-preset:hover { border-color: #fff; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Gallery</a>
    <div class="container">
        <header>
            <h1>Kintsugi Crack Generator</h1>
            <p class="subtitle">The art of precious imperfection - golden repair</p>
        </header>
        <div class="main-content">
            <div class="canvas-container">
                <canvas id="canvas" width="900" height="600"></canvas>
            </div>
            <div class="controls">
                <div class="panel">
                    <h3>Crack Properties</h3>
                    <div class="control-group">
                        <label>Crack Density: <span id="density-val">5</span></label>
                        <input type="range" id="density" min="1" max="15" value="5">
                    </div>
                    <div class="control-group">
                        <label>Branching: <span id="branching-val">0.3</span></label>
                        <input type="range" id="branching" min="0.1" max="0.6" step="0.05" value="0.3">
                    </div>
                    <div class="control-group">
                        <label>Irregularity: <span id="irregularity-val">0.4</span></label>
                        <input type="range" id="irregularity" min="0.1" max="0.8" step="0.05" value="0.4">
                    </div>
                </div>
                <div class="panel">
                    <h3>Gold Style</h3>
                    <div class="control-group">
                        <label>Crack Width: <span id="width-val">3</span>px</label>
                        <input type="range" id="crack-width" min="1" max="8" value="3">
                    </div>
                    <div class="control-group">
                        <label>Glow Intensity: <span id="glow-val">0.5</span></label>
                        <input type="range" id="glow" min="0" max="1" step="0.1" value="0.5">
                    </div>
                    <div class="control-group">
                        <label>Gold Color:</label>
                        <input type="color" id="gold-color" value="#d4af37">
                    </div>
                    <div class="color-presets">
                        <div class="color-preset" style="background: #d4af37;" onclick="setGoldColor('#d4af37')" title="Classic Gold"></div>
                        <div class="color-preset" style="background: #c0c0c0;" onclick="setGoldColor('#c0c0c0')" title="Silver"></div>
                        <div class="color-preset" style="background: #b87333;" onclick="setGoldColor('#b87333')" title="Copper"></div>
                        <div class="color-preset" style="background: #e5e4e2;" onclick="setGoldColor('#e5e4e2')" title="Platinum"></div>
                        <div class="color-preset" style="background: #ff6b6b;" onclick="setGoldColor('#ff6b6b')" title="Rose"></div>
                    </div>
                </div>
                <div class="panel">
                    <h3>Background</h3>
                    <div class="control-group">
                        <label>Material:</label>
                        <select id="material">
                            <option value="ceramic">White Ceramic</option>
                            <option value="porcelain">Blue Porcelain</option>
                            <option value="terracotta">Terracotta</option>
                            <option value="slate">Dark Slate</option>
                            <option value="jade">Jade Green</option>
                        </select>
                    </div>
                </div>
                <div class="panel">
                    <h3>Actions</h3>
                    <button onclick="generate()">Generate New Pattern</button>
                    <button onclick="animateRepair()">Animate Repair</button>
                    <button onclick="addCrackAtClick()">Click to Add Crack</button>
                </div>
                <div class="panel">
                    <h3>Statistics</h3>
                    <div class="stats">
                        <div class="stat">
                            <div class="stat-value" id="crack-count">0</div>
                            <div class="stat-label">Crack Lines</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="branch-count">0</div>
                            <div class="stat-label">Branches</div>
                        </div>
                    </div>
                </div>
                <div class="panel">
                    <h3>About Kintsugi</h3>
                    <p class="info-text">
                        Kintsugi (金継ぎ) is the Japanese art of repairing broken pottery
                        with gold lacquer, treating breakage as part of the object's history
                        rather than something to hide. It embraces imperfection and impermanence.
                    </p>
                </div>
            </div>
        </div>
    </div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let cracks = [];
        let clickMode = false;
        let animationProgress = 1;
        let animating = false;

        const materials = {
            ceramic: { bg: '#f5f5f0', texture: true },
            porcelain: { bg: '#e8f4fc', texture: true, pattern: 'blue' },
            terracotta: { bg: '#c67b5c', texture: true },
            slate: { bg: '#3d3d3d', texture: false },
            jade: { bg: '#4a7c59', texture: true }
        };

        function generate() {
            const density = parseInt(document.getElementById('density').value);
            cracks = [];

            // Generate main cracks from center
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const numCracks = density;

            for (let i = 0; i < numCracks; i++) {
                const angle = (i / numCracks) * Math.PI * 2 + (Math.random() - 0.5) * 0.5;
                const length = 150 + Math.random() * 200;
                generateCrack(centerX, centerY, angle, length, 0);
            }

            // Add some secondary cracks
            for (let i = 0; i < density / 2; i++) {
                const x = 100 + Math.random() * (canvas.width - 200);
                const y = 100 + Math.random() * (canvas.height - 200);
                const angle = Math.random() * Math.PI * 2;
                const length = 80 + Math.random() * 120;
                generateCrack(x, y, angle, length, 0);
            }

            updateStats();
            draw();
        }

        function generateCrack(x, y, angle, length, depth) {
            if (depth > 4 || length < 10) return;

            const branching = parseFloat(document.getElementById('branching').value);
            const irregularity = parseFloat(document.getElementById('irregularity').value);

            const segments = [];
            let currentX = x;
            let currentY = y;
            let currentAngle = angle;

            const segmentCount = Math.floor(length / 15);

            for (let i = 0; i < segmentCount; i++) {
                const segLen = 10 + Math.random() * 10;
                const angleVariation = (Math.random() - 0.5) * irregularity * 1.5;
                currentAngle += angleVariation;

                const nextX = currentX + Math.cos(currentAngle) * segLen;
                const nextY = currentY + Math.sin(currentAngle) * segLen;

                // Check bounds
                if (nextX < 20 || nextX > canvas.width - 20 || nextY < 20 || nextY > canvas.height - 20) {
                    break;
                }

                segments.push({
                    x1: currentX, y1: currentY,
                    x2: nextX, y2: nextY,
                    width: 1 - depth * 0.2
                });

                // Maybe branch
                if (i > 2 && Math.random() < branching && depth < 3) {
                    const branchAngle = currentAngle + (Math.random() > 0.5 ? 1 : -1) * (0.4 + Math.random() * 0.5);
                    const branchLength = (length - i * 15) * (0.3 + Math.random() * 0.4);
                    generateCrack(currentX, currentY, branchAngle, branchLength, depth + 1);
                }

                currentX = nextX;
                currentY = nextY;
            }

            cracks.push({ segments, depth });
        }

        function setGoldColor(color) {
            document.getElementById('gold-color').value = color;
            draw();
        }

        function draw() {
            const material = materials[document.getElementById('material').value];

            // Background
            ctx.fillStyle = material.bg;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Texture
            if (material.texture) {
                ctx.globalAlpha = 0.03;
                for (let i = 0; i < 5000; i++) {
                    const x = Math.random() * canvas.width;
                    const y = Math.random() * canvas.height;
                    ctx.fillStyle = Math.random() > 0.5 ? '#000' : '#fff';
                    ctx.fillRect(x, y, 1, 1);
                }
                ctx.globalAlpha = 1;
            }

            // Blue pattern for porcelain
            if (material.pattern === 'blue') {
                ctx.strokeStyle = 'rgba(50, 100, 180, 0.1)';
                ctx.lineWidth = 1;
                for (let i = 0; i < 20; i++) {
                    ctx.beginPath();
                    ctx.arc(
                        200 + Math.random() * (canvas.width - 400),
                        200 + Math.random() * (canvas.height - 400),
                        30 + Math.random() * 50,
                        0, Math.PI * 2
                    );
                    ctx.stroke();
                }
            }

            // Draw cracks with gold
            const goldColor = document.getElementById('gold-color').value;
            const crackWidth = parseInt(document.getElementById('crack-width').value);
            const glowIntensity = parseFloat(document.getElementById('glow').value);

            // Calculate how much to draw based on animation
            const totalSegments = cracks.reduce((sum, c) => sum + c.segments.length, 0);
            const segmentsToDraw = Math.floor(totalSegments * animationProgress);
            let drawnSegments = 0;

            for (const crack of cracks) {
                for (const seg of crack.segments) {
                    if (drawnSegments >= segmentsToDraw) break;

                    const width = crackWidth * seg.width;

                    // Glow
                    if (glowIntensity > 0) {
                        ctx.shadowColor = goldColor;
                        ctx.shadowBlur = 10 * glowIntensity;
                        ctx.strokeStyle = goldColor;
                        ctx.lineWidth = width + 4;
                        ctx.lineCap = 'round';
                        ctx.beginPath();
                        ctx.moveTo(seg.x1, seg.y1);
                        ctx.lineTo(seg.x2, seg.y2);
                        ctx.stroke();
                    }

                    // Main gold line
                    ctx.shadowBlur = 0;
                    const gradient = ctx.createLinearGradient(seg.x1, seg.y1, seg.x2, seg.y2);
                    gradient.addColorStop(0, goldColor);
                    gradient.addColorStop(0.5, lightenColor(goldColor, 20));
                    gradient.addColorStop(1, goldColor);

                    ctx.strokeStyle = gradient;
                    ctx.lineWidth = width;
                    ctx.lineCap = 'round';
                    ctx.beginPath();
                    ctx.moveTo(seg.x1, seg.y1);
                    ctx.lineTo(seg.x2, seg.y2);
                    ctx.stroke();

                    // Highlight
                    ctx.strokeStyle = lightenColor(goldColor, 40);
                    ctx.lineWidth = width * 0.3;
                    ctx.beginPath();
                    ctx.moveTo(seg.x1 - 0.5, seg.y1 - 0.5);
                    ctx.lineTo(seg.x2 - 0.5, seg.y2 - 0.5);
                    ctx.stroke();

                    drawnSegments++;
                }
                if (drawnSegments >= segmentsToDraw) break;
            }
        }

        function lightenColor(color, percent) {
            const num = parseInt(color.replace('#', ''), 16);
            const amt = Math.round(2.55 * percent);
            const R = Math.min(255, (num >> 16) + amt);
            const G = Math.min(255, (num >> 8 & 0x00FF) + amt);
            const B = Math.min(255, (num & 0x0000FF) + amt);
            return '#' + (0x1000000 + R * 0x10000 + G * 0x100 + B).toString(16).slice(1);
        }

        function animateRepair() {
            if (animating) return;
            animating = true;
            animationProgress = 0;

            function step() {
                animationProgress += 0.02;
                if (animationProgress >= 1) {
                    animationProgress = 1;
                    animating = false;
                }
                draw();
                if (animating) {
                    requestAnimationFrame(step);
                }
            }

            step();
        }

        function addCrackAtClick() {
            clickMode = !clickMode;
            canvas.style.cursor = clickMode ? 'crosshair' : 'default';
        }

        canvas.addEventListener('click', e => {
            if (!clickMode) return;

            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            const numBranches = 2 + Math.floor(Math.random() * 4);
            for (let i = 0; i < numBranches; i++) {
                const angle = (i / numBranches) * Math.PI * 2 + (Math.random() - 0.5) * 0.5;
                const length = 50 + Math.random() * 100;
                generateCrack(x, y, angle, length, 0);
            }

            updateStats();
            draw();
        });

        function updateStats() {
            const totalSegments = cracks.reduce((sum, c) => sum + c.segments.length, 0);
            document.getElementById('crack-count').textContent = totalSegments;
            document.getElementById('branch-count').textContent = cracks.length;
        }

        // Event listeners
        ['density', 'branching', 'irregularity', 'crack-width', 'glow'].forEach(id => {
            document.getElementById(id).addEventListener('input', e => {
                const valId = id.replace('crack-', '') + '-val';
                document.getElementById(valId).textContent = e.target.value;
            });
        });

        document.getElementById('material').addEventListener('change', draw);
        document.getElementById('gold-color').addEventListener('input', draw);

        // Expose for enhance.js keyboard shortcuts
        window.reset = generate;
        window.init = generate;

        generate();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
