<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmology Demo - CCAB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: linear-gradient(135deg, #020210 0%, #0a0525 100%); min-height: 100vh; font-family: system-ui, sans-serif; color: #e8e8f0; overflow: hidden; }
        .back-link { position: fixed; top: 15px; left: 15px; padding: 10px 18px; background: rgba(0,0,0,0.6); color: #f472b6; text-decoration: none; border-radius: 8px; font-size: 14px; z-index: 1000; border: 1px solid rgba(244,114,182,0.3); }
        #canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; }
        #panel { position: fixed; right: 0; top: 0; width: 320px; height: 100%; background: rgba(0,0,0,0.9); padding: 70px 15px 15px; border-left: 1px solid rgba(244,114,182,0.2); overflow-y: auto; }
        h1 { font-size: 1.2rem; margin-bottom: 10px; color: #f472b6; }
        .desc { font-size: 0.8rem; line-height: 1.6; color: #888; margin-bottom: 15px; }
        .btn { padding: 8px 16px; background: linear-gradient(135deg, #f472b6, #c026d3); border: none; color: white; border-radius: 6px; cursor: pointer; font-size: 0.85rem; margin-right: 8px; margin-bottom: 8px; }
        .controls { margin-bottom: 15px; }
        .slider-group { margin-bottom: 12px; }
        .slider-group label { display: block; font-size: 0.75rem; color: #888; margin-bottom: 4px; }
        input[type="range"] { width: 100%; height: 5px; -webkit-appearance: none; background: rgba(244,114,182,0.2); border-radius: 3px; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 14px; height: 14px; background: #f472b6; border-radius: 50%; cursor: pointer; }
        .stat-row { display: flex; justify-content: space-between; margin: 15px 0; }
        .stat { text-align: center; }
        .stat-value { font-size: 1.1rem; color: #f472b6; font-weight: 600; }
        .stat-label { font-size: 0.65rem; color: #666; }
        .info-box { background: rgba(244,114,182,0.1); border: 1px solid rgba(244,114,182,0.2); border-radius: 8px; padding: 12px; margin-top: 15px; font-size: 0.8rem; line-height: 1.5; color: #aaa; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back</a>
    <canvas id="canvas"></canvas>
    <div id="panel">
        <h1 id="title">Cosmology</h1>
        <p class="desc" id="description">Interactive cosmology simulation.</p>
        <div class="controls">
            <button class="btn" id="playBtn">⏸ Pause</button>
            <button class="btn" id="resetBtn">↺ Reset</button>
        </div>
        <div class="slider-group">
            <label>Time Scale: <span id="scaleVal">1.0</span>x</label>
            <input type="range" id="scale" min="0.1" max="3" step="0.1" value="1">
        </div>
        <div class="stat-row">
            <div class="stat"><div class="stat-value" id="timeVal">0</div><div class="stat-label">Time</div></div>
            <div class="stat"><div class="stat-value" id="stateVal">-</div><div class="stat-label">State</div></div>
        </div>
        <div class="info-box" id="infoBox"></div>
    </div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        resize(); window.addEventListener('resize', resize);

        let playing = true, time = 0, scale = 1;

        const demos = {
            '01-cmb-anisotropies': { title: 'CMB Anisotropies', desc: 'Temperature fluctuations in the cosmic microwave background reveal the seeds of cosmic structure.', info: 'The CMB has temperature variations of ~1 part in 100,000. These tiny fluctuations grew into galaxies and clusters.', init: initCMB, draw: drawCMB },
            '02-hubble-expansion': { title: 'Hubble Expansion', desc: 'The universe expands, carrying galaxies away from each other at speeds proportional to their distance.', info: 'Hubble constant H₀ ≈ 70 km/s/Mpc. A galaxy 100 Mpc away recedes at 7,000 km/s.', init: initHubble, draw: drawHubble },
            '03-big-bang-timeline': { title: 'Big Bang Timeline', desc: 'From the first fraction of a second to the present day - 13.8 billion years of cosmic evolution.', info: 'Key epochs: Inflation (10⁻³⁶s), Nucleosynthesis (3 min), Recombination (380,000 yr), First Stars (200 Myr).', init: initTimeline, draw: drawTimeline },
            '04-dark-energy': { title: 'Dark Energy', desc: 'The mysterious force accelerating cosmic expansion. Dark energy makes up ~68% of the universe.', info: 'Discovered in 1998 through Type Ia supernovae. The cosmological constant Λ drives late-time acceleration.', init: initDarkEnergy, draw: drawDarkEnergy },
            '05-inflation': { title: 'Cosmic Inflation', desc: 'The universe expanded exponentially in a tiny fraction of a second after the Big Bang.', info: 'Inflation explains the flatness and horizon problems. Quantum fluctuations became cosmic structure.', init: initInflation, draw: drawInflation },
            '06-structure-formation': { title: 'Structure Formation', desc: 'Gravity amplified tiny density fluctuations into the cosmic web of galaxies we see today.', info: 'Dark matter collapsed first, creating halos. Baryons followed, forming galaxies within these halos.', init: initStructure, draw: drawStructure },
            '07-baryonic-acoustic': { title: 'Baryon Acoustic Oscillations', desc: 'Sound waves in the early universe left an imprint on galaxy clustering - a standard ruler for cosmology.', info: 'The BAO peak at ~150 Mpc comoving. Pressure waves froze at recombination.', init: initBAO, draw: drawBAO },
            '08-cosmic-microwave': { title: 'CMB Power Spectrum', desc: 'The angular power spectrum of CMB fluctuations encodes information about the universe composition.', info: 'Peaks reveal baryon density, dark matter density, geometry, and more. First peak at ~1°.', init: initPowerSpectrum, draw: drawPowerSpectrum },
            '09-nucleosynthesis': { title: 'Big Bang Nucleosynthesis', desc: 'In the first few minutes, protons and neutrons fused to form the lightest elements.', info: 'Produced: 75% H, 25% He, trace Li. Heavier elements came later from stars.', init: initNucleosynthesis, draw: drawNucleosynthesis },
            '10-recombination': { title: 'Recombination Epoch', desc: 'When the universe cooled enough for electrons to combine with nuclei, releasing the CMB.', info: 'At z≈1100, T≈3000K. The universe became transparent. This is the surface of last scattering.', init: initRecombination, draw: drawRecombination }
        };

        const filename = window.location.pathname.split('/').pop().replace('.html', '');
        const demo = demos[filename] || demos['01-cmb-anisotropies'];
        document.getElementById('title').textContent = demo.title;
        document.getElementById('description').textContent = demo.desc;
        document.getElementById('infoBox').textContent = demo.info;
        document.title = demo.title + ' - CCAB';

        let state = {};

        function initCMB() { state.noise = []; for(let i=0; i<50000; i++) state.noise.push({x:Math.random()*1000, y:Math.random()*500, t:Math.random()*0.0002-0.0001}); }
        function drawCMB() { const cx=(canvas.width-320)/2, cy=canvas.height/2, r=Math.min(cx,cy)*0.8; ctx.save(); ctx.beginPath(); ctx.ellipse(cx,cy,r,r*0.5,0,0,Math.PI*2); ctx.clip(); state.noise.forEach(n => { const x=cx-r+n.x*r*2/1000, y=cy-r*0.5+n.y*r/500; const temp=n.t; ctx.fillStyle=temp>0?`rgba(255,${200-temp*500000},${150-temp*700000},0.8)`:`rgba(${150+temp*700000},${200+temp*500000},255,0.8)`; ctx.fillRect(x,y,3,3); }); ctx.restore(); ctx.strokeStyle='#f472b6'; ctx.lineWidth=2; ctx.beginPath(); ctx.ellipse(cx,cy,r,r*0.5,0,0,Math.PI*2); ctx.stroke(); document.getElementById('stateVal').textContent='T=2.725K'; }

        function initHubble() { state.galaxies = []; for(let i=0; i<40; i++) { const a=Math.random()*Math.PI*2, d=50+Math.random()*200; state.galaxies.push({x:Math.cos(a)*d, y:Math.sin(a)*d, d, size:3+Math.random()*4}); } }
        function drawHubble() { const cx=(canvas.width-320)/2, cy=canvas.height/2; const expansion = 1 + time*0.0001*scale; state.galaxies.forEach(g => { const x=cx+g.x*expansion, y=cy+g.y*expansion; const z=g.d*0.01*expansion; const r=Math.min(255,150+z*20), gr=Math.max(0,200-z*30), b=Math.max(0,255-z*50); ctx.beginPath(); ctx.arc(x,y,g.size,0,Math.PI*2); ctx.fillStyle=`rgb(${r},${gr},${b})`; ctx.fill(); }); ctx.beginPath(); ctx.arc(cx,cy,8,0,Math.PI*2); ctx.fillStyle='#fff'; ctx.fill(); ctx.fillText('You',cx-10,cy+20); document.getElementById('stateVal').textContent=`a=${expansion.toFixed(2)}`; }

        function initTimeline() { state.epochs = [{t:0,name:'Big Bang',color:'#fff'},{t:0.001,name:'Inflation',color:'#ff0'},{t:3,name:'Nucleosynthesis',color:'#f80'},{t:380000,name:'Recombination',color:'#f44'},{t:2e8,name:'First Stars',color:'#88f'},{t:1e9,name:'Galaxies Form',color:'#a8f'},{t:1.38e10,name:'Now',color:'#8f8'}]; }
        function drawTimeline() { const cx=(canvas.width-320)/2, cy=canvas.height/2, w=cx*1.5; ctx.strokeStyle='#444'; ctx.lineWidth=4; ctx.beginPath(); ctx.moveTo(cx-w/2,cy); ctx.lineTo(cx+w/2,cy); ctx.stroke(); state.epochs.forEach((e,i) => { const x = cx-w/2 + (Math.log10(e.t+1)/10.2)*w; const active = time*1e7*scale > e.t; ctx.beginPath(); ctx.arc(x,cy,active?12:8,0,Math.PI*2); ctx.fillStyle=active?e.color:'#333'; ctx.fill(); ctx.fillStyle='#fff'; ctx.font='10px Arial'; ctx.textAlign='center'; ctx.fillText(e.name,x,cy+25); }); document.getElementById('stateVal').textContent=`${(time*scale).toFixed(1)} Gyr`; }

        function initDarkEnergy() { state.scale = 1; state.history = []; }
        function drawDarkEnergy() { const cx=(canvas.width-320)/2, cy=canvas.height/2; if(playing) { state.scale *= (1 + 0.001*scale); if(state.scale > 3) state.scale = 1; state.history.push(state.scale); if(state.history.length > 200) state.history.shift(); } const r = 50 * state.scale; ctx.strokeStyle='#f472b6'; ctx.lineWidth=2; for(let i=0; i<5; i++) { ctx.beginPath(); ctx.arc(cx,cy,r*(1+i*0.3),0,Math.PI*2); ctx.stroke(); } ctx.fillStyle='#fff'; ctx.font='12px Arial'; ctx.textAlign='center'; ctx.fillText('Λ-CDM Universe',cx,cy-r-20); document.getElementById('stateVal').textContent=`a=${state.scale.toFixed(2)}`; }

        function initInflation() { state.size = 0.01; }
        function drawInflation() { const cx=(canvas.width-320)/2, cy=canvas.height/2; if(playing && state.size < 300) state.size *= (1 + 0.1*scale); if(state.size > 300) state.size = 0.01; const grad = ctx.createRadialGradient(cx,cy,0,cx,cy,state.size); grad.addColorStop(0,'rgba(255,255,255,0.8)'); grad.addColorStop(0.5,'rgba(255,200,100,0.5)'); grad.addColorStop(1,'transparent'); ctx.fillStyle=grad; ctx.beginPath(); ctx.arc(cx,cy,state.size,0,Math.PI*2); ctx.fill(); ctx.fillStyle='#fff'; ctx.font='14px Arial'; ctx.textAlign='center'; ctx.fillText(state.size<1?'Quantum fluctuations':state.size<10?'Inflation begins':'Universe expands 10²⁶×',cx,cy+state.size+30); document.getElementById('stateVal').textContent=state.size<1?'10⁻³⁶s':state.size<10?'10⁻³²s':'10⁻³²s'; }

        function initStructure() { state.particles = []; for(let i=0; i<500; i++) state.particles.push({x:(Math.random()-0.5)*400,y:(Math.random()-0.5)*300,vx:0,vy:0}); }
        function drawStructure() { const cx=(canvas.width-320)/2, cy=canvas.height/2; if(playing) { state.particles.forEach((p,i) => { state.particles.forEach((q,j) => { if(i>=j) return; const dx=q.x-p.x, dy=q.y-p.y, d=Math.sqrt(dx*dx+dy*dy)+1; if(d<100) { const f=0.0001*scale/d; p.vx+=dx*f; p.vy+=dy*f; q.vx-=dx*f; q.vy-=dy*f; } }); p.x+=p.vx; p.y+=p.vy; p.vx*=0.99; p.vy*=0.99; }); } state.particles.forEach(p => { ctx.beginPath(); ctx.arc(cx+p.x,cy+p.y,2,0,Math.PI*2); ctx.fillStyle='rgba(200,200,255,0.7)'; ctx.fill(); }); document.getElementById('stateVal').textContent='Clustering'; }

        function initBAO() { state.rings = []; for(let i=0; i<5; i++) state.rings.push({r:50+i*30, phase:Math.random()*Math.PI*2}); }
        function drawBAO() { const cx=(canvas.width-320)/2, cy=canvas.height/2; state.rings.forEach(ring => { if(playing) ring.phase += 0.02*scale; const r = ring.r + Math.sin(ring.phase)*10; ctx.beginPath(); ctx.arc(cx,cy,r,0,Math.PI*2); ctx.strokeStyle='rgba(100,150,255,0.5)'; ctx.lineWidth=3; ctx.stroke(); }); ctx.beginPath(); ctx.arc(cx,cy,150,0,Math.PI*2); ctx.strokeStyle='#f472b6'; ctx.lineWidth=4; ctx.setLineDash([5,5]); ctx.stroke(); ctx.setLineDash([]); ctx.fillStyle='#fff'; ctx.font='12px Arial'; ctx.textAlign='center'; ctx.fillText('BAO Scale: ~150 Mpc',cx,cy+170); document.getElementById('stateVal').textContent='150 Mpc'; }

        function initPowerSpectrum() {}
        function drawPowerSpectrum() { const cx=(canvas.width-320)/2, cy=canvas.height/2, w=400, h=200; ctx.strokeStyle='#333'; ctx.lineWidth=1; for(let i=0; i<=10; i++) { ctx.beginPath(); ctx.moveTo(cx-w/2,cy-h/2+i*h/10); ctx.lineTo(cx+w/2,cy-h/2+i*h/10); ctx.stroke(); } ctx.strokeStyle='#f472b6'; ctx.lineWidth=2; ctx.beginPath(); for(let l=2; l<2000; l++) { const x=cx-w/2+(Math.log10(l/2)/3)*w; const peak1=Math.exp(-((l-220)/100)**2)*0.8; const peak2=Math.exp(-((l-540)/150)**2)*0.4; const peak3=Math.exp(-((l-800)/200)**2)*0.2; const y=cy+h/2-((peak1+peak2+peak3+0.1)*h); if(l===2) ctx.moveTo(x,y); else ctx.lineTo(x,y); } ctx.stroke(); ctx.fillStyle='#fff'; ctx.font='12px Arial'; ctx.textAlign='center'; ctx.fillText('Multipole l',cx,cy+h/2+25); document.getElementById('stateVal').textContent='Cl spectrum'; }

        function initNucleosynthesis() { state.particles = []; for(let i=0; i<100; i++) state.particles.push({x:(Math.random()-0.5)*300,y:(Math.random()-0.5)*200,type:Math.random()>0.14?'p':'n',vx:(Math.random()-0.5)*2,vy:(Math.random()-0.5)*2}); }
        function drawNucleosynthesis() { const cx=(canvas.width-320)/2, cy=canvas.height/2; if(playing) { state.particles.forEach(p => { p.x+=p.vx; p.y+=p.vy; if(Math.abs(p.x)>150) p.vx*=-1; if(Math.abs(p.y)>100) p.vy*=-1; }); } state.particles.forEach(p => { ctx.beginPath(); ctx.arc(cx+p.x,cy+p.y,p.type==='p'?4:3,0,Math.PI*2); ctx.fillStyle=p.type==='p'?'#ff6666':'#6666ff'; ctx.fill(); }); ctx.fillStyle='#fff'; ctx.font='12px Arial'; ctx.textAlign='center'; ctx.fillText('Protons (red) + Neutrons (blue) → H, He, Li',cx,cy+130); document.getElementById('stateVal').textContent='t≈3 min'; }

        function initRecombination() { state.electrons = []; state.photons = []; for(let i=0; i<50; i++) { state.electrons.push({x:(Math.random()-0.5)*400,y:(Math.random()-0.5)*300,bound:false}); state.photons.push({x:(Math.random()-0.5)*400,y:(Math.random()-0.5)*300,vx:(Math.random()-0.5)*3,vy:(Math.random()-0.5)*3}); } }
        function drawRecombination() { const cx=(canvas.width-320)/2, cy=canvas.height/2; const temp = Math.max(0, 1 - time*0.001*scale); if(playing) { state.electrons.forEach(e => { if(!e.bound && temp < 0.5) e.bound = Math.random() > temp; }); state.photons.forEach(p => { if(temp > 0.3) { p.vx = (Math.random()-0.5)*3; p.vy = (Math.random()-0.5)*3; } p.x += p.vx; p.y += p.vy; if(Math.abs(p.x)>200) p.vx*=-1; if(Math.abs(p.y)>150) p.vy*=-1; }); } state.electrons.forEach(e => { ctx.beginPath(); ctx.arc(cx+e.x,cy+e.y,3,0,Math.PI*2); ctx.fillStyle=e.bound?'#88ff88':'#ff8888'; ctx.fill(); }); state.photons.forEach(p => { ctx.beginPath(); ctx.arc(cx+p.x,cy+p.y,2,0,Math.PI*2); ctx.fillStyle=`rgba(255,${Math.floor(200*temp)},${Math.floor(100*temp)},${temp>0.3?0.3:0.8})`; ctx.fill(); }); document.getElementById('stateVal').textContent=`T=${Math.floor(3000*temp+300)}K`; }

        demo.init();

        function animate() {
            ctx.fillStyle = 'rgba(2,2,16,0.2)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            if (playing) time += 0.016;
            demo.draw();
            document.getElementById('timeVal').textContent = time.toFixed(1);
            requestAnimationFrame(animate);
        }

        document.getElementById('playBtn').onclick = () => { playing = !playing; document.getElementById('playBtn').textContent = playing ? '⏸ Pause' : '▶ Play'; };
        document.getElementById('resetBtn').onclick = () => { time = 0; demo.init(); };
        document.getElementById('scale').oninput = e => { scale = parseFloat(e.target.value); document.getElementById('scaleVal').textContent = scale.toFixed(1); };

        animate();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
