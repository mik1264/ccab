<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmology Demo - CCAB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: linear-gradient(135deg, #020210 0%, #0a0525 100%); min-height: 100vh; font-family: system-ui, sans-serif; color: #e8e8f0; overflow: hidden; }
        .back-link { position: fixed; top: 15px; left: 15px; padding: 10px 18px; background: rgba(0,0,0,0.6); color: #f472b6; text-decoration: none; border-radius: 8px; font-size: 14px; z-index: 1000; border: 1px solid rgba(244,114,182,0.3); }
        #canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; }
        #panel { position: fixed; right: 0; top: 0; width: 320px; height: 100%; background: rgba(0,0,0,0.9); padding: 70px 15px 15px; border-left: 1px solid rgba(244,114,182,0.2); overflow-y: auto; }
        h1 { font-size: 1.2rem; margin-bottom: 10px; color: #f472b6; }
        .desc { font-size: 0.8rem; line-height: 1.6; color: #888; margin-bottom: 15px; }
        .btn { padding: 8px 16px; background: linear-gradient(135deg, #f472b6, #c026d3); border: none; color: white; border-radius: 6px; cursor: pointer; font-size: 0.85rem; margin-right: 8px; margin-bottom: 8px; }
        .controls { margin-bottom: 15px; }
        .slider-group { margin-bottom: 12px; }
        .slider-group label { display: block; font-size: 0.75rem; color: #888; margin-bottom: 4px; }
        input[type="range"] { width: 100%; height: 5px; -webkit-appearance: none; background: rgba(244,114,182,0.2); border-radius: 3px; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 14px; height: 14px; background: #f472b6; border-radius: 50%; cursor: pointer; }
        .stat-row { display: flex; justify-content: space-between; margin: 15px 0; }
        .stat { text-align: center; }
        .stat-value { font-size: 1.1rem; color: #f472b6; font-weight: 600; }
        .stat-label { font-size: 0.65rem; color: #666; }
        .info-box { background: rgba(244,114,182,0.1); border: 1px solid rgba(244,114,182,0.2); border-radius: 8px; padding: 12px; margin-top: 15px; font-size: 0.8rem; line-height: 1.5; color: #aaa; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back</a>
    <canvas id="canvas"></canvas>
    <div id="panel">
        <h1 id="title">Cosmology</h1>
        <p class="desc" id="description">Interactive cosmology simulation.</p>
        <div class="controls">
            <button class="btn" id="playBtn">⏸ Pause</button>
            <button class="btn" id="resetBtn">↺ Reset</button>
        </div>
        <div class="slider-group">
            <label>Parameter: <span id="paramVal">1.0</span></label>
            <input type="range" id="param" min="0" max="2" step="0.1" value="1">
        </div>
        <div class="stat-row">
            <div class="stat"><div class="stat-value" id="stat1">-</div><div class="stat-label" id="label1">Value 1</div></div>
            <div class="stat"><div class="stat-value" id="stat2">-</div><div class="stat-label" id="label2">Value 2</div></div>
        </div>
        <div class="info-box" id="infoBox"></div>
    </div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        resize(); window.addEventListener('resize', resize);

        let playing = true, time = 0, param = 1;

        const demos = {
            '11-distance-ladder': { title: 'Cosmic Distance Ladder', desc: 'Different methods measure distances at different scales, forming a ladder to the edge of the observable universe.', info: 'Parallax → Cepheids → Type Ia SNe → Hubble Law. Each rung calibrates the next.', labels: ['Distance','Method'] },
            '12-cosmic-age': { title: 'Age of the Universe', desc: 'Multiple independent methods converge on 13.8 billion years - the time since the Big Bang.', info: 'From CMB, oldest stars, nucleocosmochronology, and Hubble parameter. All agree within uncertainties.', labels: ['Age (Gyr)','H₀'] },
            '13-flatness-problem': { title: 'Flatness Problem', desc: 'Why is the universe so precisely flat? Any deviation would have grown enormously over cosmic time.', info: 'Ω must equal 1 to 1 part in 10⁶⁰ at the Planck time. Inflation provides a natural explanation.', labels: ['Ω','Curvature'] },
            '14-horizon-problem': { title: 'Horizon Problem', desc: 'Why is the CMB the same temperature everywhere when opposite sides were never in causal contact?', info: 'Without inflation, regions >2° apart could never have communicated. Inflation solves this.', labels: ['Horizon','T (μK)'] },
            '15-matter-radiation': { title: 'Matter-Radiation Equality', desc: 'The universe transitioned from radiation-dominated to matter-dominated at z≈3400.', info: 'Before equality: ρ∝a⁻⁴. After: ρ∝a⁻³. This transition enabled structure formation.', labels: ['Epoch','Density'] },
            '16-lambda-cdm': { title: 'ΛCDM Model', desc: 'The standard model of cosmology: dark energy (Λ), cold dark matter (CDM), and ordinary matter.', info: 'Composition: 68% dark energy, 27% dark matter, 5% baryons. Fits all major observations.', labels: ['Ω_Λ','Ω_m'] },
            '17-friedmann-equations': { title: 'Friedmann Equations', desc: 'The equations governing cosmic expansion, derived from general relativity.', info: 'H² = (8πG/3)ρ - k/a² + Λ/3. Evolution depends on density, curvature, and dark energy.', labels: ['H(z)','a(t)'] },
            '18-curvature': { title: 'Cosmic Curvature', desc: 'Is the universe flat, open (hyperbolic), or closed (spherical)? Observations suggest Ω_k ≈ 0.', info: 'CMB acoustic peaks measure geometry. The first peak at l≈220 indicates flatness.', labels: ['Ω_k','Geometry'] },
            '19-multiverse': { title: 'Multiverse Concepts', desc: 'Could our universe be one of many? Various theories suggest different types of multiverses.', info: 'Level I: Beyond horizon. Level II: Other bubbles. Level III: Many-worlds. Level IV: Mathematical.', labels: ['Level','Type'] },
            '20-future-universe': { title: 'Future of the Universe', desc: 'With dark energy dominating, the universe will expand forever, growing cold and empty.', info: 'Heat death in 10¹⁰⁰ years. Black hole era ends at 10¹⁰⁶ years. Proton decay possible.', labels: ['Time','State'] }
        };

        const filename = window.location.pathname.split('/').pop().replace('.html', '');
        const demo = demos[filename] || demos['11-distance-ladder'];
        document.getElementById('title').textContent = demo.title;
        document.getElementById('description').textContent = demo.desc;
        document.getElementById('infoBox').textContent = demo.info;
        document.getElementById('label1').textContent = demo.labels[0];
        document.getElementById('label2').textContent = demo.labels[1];
        document.title = demo.title + ' - CCAB';

        function animate() {
            ctx.fillStyle = 'rgba(2,2,16,0.15)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            const cx = (canvas.width - 320) / 2, cy = canvas.height / 2;
            if (playing) time += 0.016;

            // Demo-specific visualizations
            if (filename.includes('distance') || filename.includes('11')) {
                const rungs = ['Parallax\n1-100 pc', 'Cepheids\n1-30 Mpc', 'Type Ia\n100-1000 Mpc', 'Hubble\n>1 Gpc'];
                rungs.forEach((rung, i) => {
                    const y = cy - 100 + i * 70;
                    const w = 60 + i * 80;
                    ctx.fillStyle = `hsl(${280 + i*20}, 70%, ${50 + (time*10 % 4 === i ? 20 : 0)}%)`;
                    ctx.fillRect(cx - w/2, y, w, 40);
                    ctx.fillStyle = '#fff'; ctx.font = '11px Arial'; ctx.textAlign = 'center';
                    rung.split('\n').forEach((line, j) => ctx.fillText(line, cx, y + 15 + j*12));
                });
                document.getElementById('stat1').textContent = `${Math.floor(time*100)%1000} Mpc`;
                document.getElementById('stat2').textContent = ['Par','Cep','SNe','Hub'][Math.floor(time)%4];
            } else if (filename.includes('age') || filename.includes('12')) {
                const methods = [{name:'CMB',age:13.799},{name:'Globulars',age:13.4},{name:'WD cooling',age:12.7},{name:'H₀ inverse',age:14.0}];
                methods.forEach((m, i) => {
                    const x = cx - 150 + i * 100;
                    const h = m.age * 10;
                    ctx.fillStyle = i===Math.floor(time)%4 ? '#f472b6' : '#666';
                    ctx.fillRect(x - 30, cy + 100 - h, 60, h);
                    ctx.fillStyle = '#fff'; ctx.font = '10px Arial'; ctx.textAlign = 'center';
                    ctx.fillText(m.name, x, cy + 120);
                    ctx.fillText(m.age.toFixed(1), x, cy + 95 - h);
                });
                ctx.strokeStyle = '#f472b6'; ctx.setLineDash([5,5]); ctx.beginPath();
                ctx.moveTo(cx-180, cy+100-138); ctx.lineTo(cx+180, cy+100-138); ctx.stroke(); ctx.setLineDash([]);
                document.getElementById('stat1').textContent = '13.8';
                document.getElementById('stat2').textContent = '70±2';
            } else if (filename.includes('flatness') || filename.includes('13')) {
                const omega = 1 + (param-1)*Math.sin(time);
                const deviation = Math.abs(omega - 1);
                ctx.strokeStyle = omega > 1 ? '#ff6666' : omega < 1 ? '#6666ff' : '#66ff66';
                ctx.lineWidth = 3;
                if (Math.abs(omega - 1) < 0.01) {
                    ctx.beginPath(); ctx.moveTo(cx-200, cy); ctx.lineTo(cx+200, cy); ctx.stroke();
                } else if (omega > 1) {
                    ctx.beginPath(); ctx.arc(cx, cy + 500, 520, -Math.PI*0.7, -Math.PI*0.3); ctx.stroke();
                } else {
                    ctx.beginPath(); ctx.arc(cx, cy - 500, 520, Math.PI*0.3, Math.PI*0.7); ctx.stroke();
                }
                ctx.fillStyle = '#fff'; ctx.font = '14px Arial'; ctx.textAlign = 'center';
                ctx.fillText(omega > 1.01 ? 'Closed (Ω > 1)' : omega < 0.99 ? 'Open (Ω < 1)' : 'Flat (Ω = 1)', cx, cy + 150);
                document.getElementById('stat1').textContent = omega.toFixed(3);
                document.getElementById('stat2').textContent = omega > 1.01 ? '+' : omega < 0.99 ? '-' : '0';
            } else if (filename.includes('horizon') || filename.includes('14')) {
                const t = time * 0.5;
                ctx.strokeStyle = '#f472b6'; ctx.lineWidth = 2;
                ctx.beginPath(); ctx.arc(cx, cy, 100, 0, Math.PI*2); ctx.stroke();
                for (let i = 0; i < 8; i++) {
                    const a = i * Math.PI / 4 + t;
                    const x = cx + Math.cos(a) * 100, y = cy + Math.sin(a) * 100;
                    ctx.beginPath(); ctx.arc(x, y, 5, 0, Math.PI*2);
                    ctx.fillStyle = `hsl(${(i*45+t*50)%360}, 50%, 50%)`; ctx.fill();
                }
                ctx.fillStyle = '#888'; ctx.font = '12px Arial'; ctx.textAlign = 'center';
                ctx.fillText('CMB: Same T everywhere', cx, cy + 130);
                ctx.fillText('But never in contact?', cx, cy + 150);
                document.getElementById('stat1').textContent = `${Math.floor(Math.cos(t)*10+90)}°`;
                document.getElementById('stat2').textContent = '2.725K';
            } else {
                // Default visualization for remaining demos
                ctx.fillStyle = '#f472b6';
                ctx.font = '20px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(demo.title, cx, cy - 50);
                ctx.fillStyle = '#888';
                ctx.font = '14px Arial';
                ctx.fillText('Interactive visualization', cx, cy);
                
                // Animated elements
                for (let i = 0; i < 20; i++) {
                    const a = i * Math.PI / 10 + time;
                    const r = 100 + Math.sin(time + i) * 30;
                    ctx.beginPath();
                    ctx.arc(cx + Math.cos(a) * r, cy + Math.sin(a) * r * 0.5, 3, 0, Math.PI*2);
                    ctx.fillStyle = `hsl(${280 + i*5}, 70%, 60%)`;
                    ctx.fill();
                }
                document.getElementById('stat1').textContent = time.toFixed(1);
                document.getElementById('stat2').textContent = param.toFixed(1);
            }

            requestAnimationFrame(animate);
        }

        document.getElementById('playBtn').onclick = () => { playing = !playing; document.getElementById('playBtn').textContent = playing ? '⏸ Pause' : '▶ Play'; };
        document.getElementById('resetBtn').onclick = () => { time = 0; };
        document.getElementById('param').oninput = e => { param = parseFloat(e.target.value); document.getElementById('paramVal').textContent = param.toFixed(1); };

        animate();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
