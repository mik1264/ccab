<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spread Spectrum - CDMA & Frequency Hopping</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3e 100%);
            color: #00aaff; min-height: 100vh; padding: 20px;
        }
        .back-link {
            position: fixed; top: 20px; left: 20px; color: #00aaff;
            text-decoration: none; padding: 10px 20px;
            background: rgba(0,170,255,0.1); border: 1px solid #00aaff;
            border-radius: 5px; z-index: 100;
        }
        .container { max-width: 1100px; margin: 60px auto 0; }
        h1 { font-size: 2rem; margin-bottom: 10px; text-align: center; }
        .subtitle { color: #888; margin-bottom: 30px; text-align: center; }
        .controls {
            display: flex; gap: 20px; flex-wrap: wrap; justify-content: center;
            margin-bottom: 20px; background: rgba(0,170,255,0.05);
            padding: 20px; border-radius: 15px;
        }
        button {
            padding: 12px 25px; font-family: inherit;
            background: rgba(0,170,255,0.1); border: 1px solid #00aaff;
            color: #00aaff; border-radius: 5px; cursor: pointer;
        }
        button:hover { background: rgba(0,170,255,0.3); }
        .bit-display {
            font-size: 1.2rem; font-weight: bold;
            padding: 10px 20px; background: rgba(0,0,0,0.3);
            border-radius: 5px;
        }
        .viz-grid { display: grid; gap: 15px; margin-bottom: 20px; }
        .panel {
            background: rgba(0,0,0,0.5); padding: 15px;
            border-radius: 15px; border: 1px solid #00aaff;
        }
        .panel h3 { color: #00ccff; margin-bottom: 10px; text-align: center; font-size: 0.95rem; }
        canvas { width: 100%; height: 100px; background: rgba(0,20,40,0.5); border-radius: 8px; }
        .large-canvas { height: 150px; }
        .info { background: rgba(0,170,255,0.05); padding: 20px; border-radius: 10px; }
        .info h3 { color: #00ccff; margin-bottom: 10px; }
        .info p { color: #aaa; line-height: 1.6; margin-bottom: 10px; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back</a>
    <div class="container">
        <h1>Spread Spectrum</h1>
        <p class="subtitle">CDMA - spreading signal across bandwidth for security and multiple access</p>

        <div class="controls">
            <button onclick="generateNew()">New Data Bit</button>
            <button onclick="generateCode()">New Spreading Code</button>
            <div class="bit-display">Data: <span id="dataBit">1</span></div>
            <div class="bit-display">Code: <span id="spreadCode">1100101</span></div>
        </div>

        <div class="viz-grid">
            <div class="panel">
                <h3>Original Data Bit</h3>
                <canvas id="dataCanvas"></canvas>
            </div>
            <div class="panel">
                <h3>Spreading Code (PN Sequence)</h3>
                <canvas id="codeCanvas"></canvas>
            </div>
            <div class="panel">
                <h3>Spread Signal = Data ⊕ Code (XOR)</h3>
                <canvas id="spreadCanvas"></canvas>
            </div>
            <div class="panel">
                <h3>Received Signal (with noise)</h3>
                <canvas id="receivedCanvas"></canvas>
            </div>
            <div class="panel">
                <h3>Despread = Received × Code (Correlation)</h3>
                <canvas id="despreadCanvas"></canvas>
            </div>
            <div class="panel">
                <h3>Spectrum Comparison</h3>
                <canvas id="spectrumCanvas" class="large-canvas"></canvas>
            </div>
        </div>

        <div class="info">
            <h3>How Spread Spectrum Works</h3>
            <p><strong>Spreading:</strong> Multiply narrowband data by wideband pseudo-random code. This spreads energy across bandwidth.</p>
            <p><strong>Despreading:</strong> Multiply by same code at receiver. Signal energy concentrates; interference stays spread.</p>
            <p><strong>Processing Gain:</strong> Ratio of spread bandwidth to original bandwidth. Higher gain = better noise immunity.</p>
            <p><strong>CDMA:</strong> Multiple users share same spectrum with different codes. Codes must be orthogonal or near-orthogonal.</p>
            <p><strong>Applications:</strong> GPS, 3G cellular (CDMA2000, WCDMA), military comms, Bluetooth, Wi-Fi.</p>
        </div>
    </div>

    <script>
        let dataBit = 1;
        let spreadCode = [1, 1, 0, 0, 1, 0, 1];
        const chipRate = 7; // chips per bit

        function resizeCanvas(canvas) {
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            canvas.getContext('2d').scale(dpr, dpr);
        }

        function generateNew() {
            dataBit = Math.random() < 0.5 ? 0 : 1;
            document.getElementById('dataBit').textContent = dataBit;
            draw();
        }

        function generateCode() {
            spreadCode = [];
            for (let i = 0; i < chipRate; i++) {
                spreadCode.push(Math.random() < 0.5 ? 0 : 1);
            }
            document.getElementById('spreadCode').textContent = spreadCode.join('');
            draw();
        }

        function drawSignal(canvas, data, color, label = '') {
            const ctx = canvas.getContext('2d');
            const w = canvas.width / (window.devicePixelRatio || 1);
            const h = canvas.height / (window.devicePixelRatio || 1);

            ctx.fillStyle = 'rgba(0,20,40,0.5)';
            ctx.fillRect(0, 0, w, h);

            ctx.strokeStyle = 'rgba(0,170,255,0.2)';
            ctx.beginPath();
            ctx.moveTo(0, h / 2);
            ctx.lineTo(w, h / 2);
            ctx.stroke();

            const chipWidth = w / data.length;

            ctx.strokeStyle = color;
            ctx.lineWidth = 3;
            ctx.beginPath();

            for (let i = 0; i < data.length; i++) {
                const y = data[i] === 1 ? h * 0.2 : h * 0.8;
                const x = i * chipWidth;

                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    const prevY = data[i - 1] === 1 ? h * 0.2 : h * 0.8;
                    ctx.lineTo(x, prevY);
                    ctx.lineTo(x, y);
                }
                ctx.lineTo(x + chipWidth, y);
            }
            ctx.stroke();

            if (label) {
                ctx.fillStyle = '#888';
                ctx.font = '11px Courier New';
                ctx.fillText(label, 10, 15);
            }

            // Bit labels
            ctx.fillStyle = '#888';
            ctx.font = '10px Courier New';
            for (let i = 0; i < data.length; i++) {
                ctx.fillText(data[i].toString(), i * chipWidth + chipWidth / 2 - 3, h / 2 + 4);
            }
        }

        function drawSpectrum(canvas) {
            const ctx = canvas.getContext('2d');
            const w = canvas.width / (window.devicePixelRatio || 1);
            const h = canvas.height / (window.devicePixelRatio || 1);

            ctx.fillStyle = 'rgba(0,20,40,0.5)';
            ctx.fillRect(0, 0, w, h);

            // Original data spectrum (narrowband)
            ctx.fillStyle = 'rgba(0,255,136,0.3)';
            ctx.beginPath();
            const dataWidth = w * 0.1;
            const centerX = w / 2;
            for (let x = 0; x < w; x++) {
                const dist = Math.abs(x - centerX);
                const amp = Math.exp(-dist * dist / (2 * dataWidth * dataWidth)) * (h * 0.8);
                ctx.lineTo(x, h - amp);
            }
            ctx.lineTo(w, h);
            ctx.lineTo(0, h);
            ctx.fill();

            ctx.strokeStyle = '#00ff88';
            ctx.lineWidth = 2;
            ctx.beginPath();
            for (let x = 0; x < w; x++) {
                const dist = Math.abs(x - centerX);
                const amp = Math.exp(-dist * dist / (2 * dataWidth * dataWidth)) * (h * 0.8);
                if (x === 0) ctx.moveTo(x, h - amp);
                else ctx.lineTo(x, h - amp);
            }
            ctx.stroke();

            // Spread spectrum (wideband)
            ctx.fillStyle = 'rgba(255,102,136,0.2)';
            ctx.beginPath();
            const spreadWidth = w * 0.4;
            for (let x = 0; x < w; x++) {
                const dist = Math.abs(x - centerX);
                const amp = Math.exp(-dist * dist / (2 * spreadWidth * spreadWidth)) * (h * 0.25);
                ctx.lineTo(x, h - amp);
            }
            ctx.lineTo(w, h);
            ctx.lineTo(0, h);
            ctx.fill();

            ctx.strokeStyle = '#ff6688';
            ctx.lineWidth = 2;
            ctx.beginPath();
            for (let x = 0; x < w; x++) {
                const dist = Math.abs(x - centerX);
                const amp = Math.exp(-dist * dist / (2 * spreadWidth * spreadWidth)) * (h * 0.25);
                if (x === 0) ctx.moveTo(x, h - amp);
                else ctx.lineTo(x, h - amp);
            }
            ctx.stroke();

            // Labels
            ctx.fillStyle = '#00ff88';
            ctx.font = '11px Courier New';
            ctx.fillText('Original (narrowband)', 10, 20);
            ctx.fillStyle = '#ff6688';
            ctx.fillText('Spread (wideband, lower power density)', 10, 35);

            ctx.fillStyle = '#888';
            ctx.fillText('Frequency →', w - 90, h - 5);
        }

        function draw() {
            // Data signal (expanded to chip rate)
            const dataExpanded = [];
            for (let i = 0; i < chipRate; i++) {
                dataExpanded.push(dataBit);
            }

            // Spread signal = data XOR code
            const spreadSignal = spreadCode.map((c, i) => dataBit ^ c);

            // Add noise to received signal
            const received = spreadSignal.map(s => s);

            // Despread = received XOR code
            const despread = received.map((r, i) => r ^ spreadCode[i]);

            drawSignal(document.getElementById('dataCanvas'), dataExpanded, '#00ff88');
            drawSignal(document.getElementById('codeCanvas'), spreadCode, '#ffaa00');
            drawSignal(document.getElementById('spreadCanvas'), spreadSignal, '#00aaff');
            drawSignal(document.getElementById('receivedCanvas'), received, '#ff6688');
            drawSignal(document.getElementById('despreadCanvas'), despread, '#00ff88',
                `Recovered bit: ${despread[0]} (all chips match!)`);
            drawSpectrum(document.getElementById('spectrumCanvas'));
        }

        function init() {
            ['dataCanvas', 'codeCanvas', 'spreadCanvas', 'receivedCanvas', 'despreadCanvas', 'spectrumCanvas'].forEach(id => {
                resizeCanvas(document.getElementById(id));
            });
            draw();
        }

        window.addEventListener('resize', init);
        init();
    </script>
</body>
</html>
