<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Birthday Paradox</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; color: #e0e0e0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden; }
canvas { display: block; }
#controls {
    position: fixed; top: 16px; right: 16px; z-index: 10;
    background: rgba(20,20,40,0.85); backdrop-filter: blur(10px);
    border: 1px solid rgba(100,140,255,0.2); border-radius: 12px;
    padding: 16px; min-width: 250px;
}
#controls h3 { color: #7aa2f7; margin-bottom: 10px; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }
#controls .stat { display: flex; justify-content: space-between; margin: 4px 0; font-size: 13px; }
#controls .stat span:last-child { color: #7aa2f7; font-weight: bold; }
#controls button {
    width: 100%; padding: 8px; margin-top: 6px; border: 1px solid rgba(100,140,255,0.3);
    background: rgba(40,50,80,0.6); color: #c0d0ff; border-radius: 6px;
    cursor: pointer; font-size: 13px; transition: background 0.2s;
}
#controls button:hover { background: rgba(60,80,140,0.7); }
#info {
    position: fixed; bottom: 16px; left: 16px; z-index: 10;
    background: rgba(20,20,40,0.85); backdrop-filter: blur(10px);
    border: 1px solid rgba(100,140,255,0.2); border-radius: 12px;
    padding: 16px; max-width: 380px; font-size: 13px; line-height: 1.5;
}
#info h3 { color: #7aa2f7; margin-bottom: 8px; }
#info em { color: #bb9af7; }
a.back { position: fixed; top: 16px; left: 16px; color: #7aa2f7; text-decoration: none; font-size: 14px; z-index: 20; }
a.back:hover { text-decoration: underline; }
</style>
</head>
<body>
<a href="index.html" class="back">&larr; Back</a>
<canvas id="c"></canvas>
<div id="controls">
    <h3>Birthday Paradox</h3>
    <div class="stat"><span>People in room:</span><span id="sPeople">0</span></div>
    <div class="stat"><span>Matches found:</span><span id="sMatches">0</span></div>
    <div class="stat"><span>Theoretical P:</span><span id="sTheory">0%</span></div>
    <div class="stat"><span>Simulated P:</span><span id="sSim">-</span></div>
    <hr style="border-color: rgba(100,140,255,0.15); margin: 8px 0;">
    <button id="btnAdd">Add Person (or click canvas)</button>
    <button id="btnAdd5">Add 5 People</button>
    <button id="btnFill23">Fill to 23 People</button>
    <button id="btnFill50">Fill to 50 People</button>
    <button id="btnSim">Run 10,000 Simulations</button>
    <button id="btnReset">Reset Room</button>
</div>
<div id="info">
    <h3>The Birthday Paradox</h3>
    <p>How many people must be in a room before there's a 50% chance two share a birthday?</p>
    <p style="margin-top:6px;">Most people guess around 180, but the answer is just <em>23 people</em>! With 70 people, the probability exceeds <em>99.9%</em>.</p>
    <p style="margin-top:6px;">The key insight: we're not checking if someone shares <em>your</em> birthday, but if <em>any two people</em> match. With n people there are n(n-1)/2 pairs to check.</p>
</div>
<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');

let W, H;
function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
}
resize();
window.addEventListener('resize', resize);

const MONTHS = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
const DAYS_IN_MONTH = [31,28,31,30,31,30,31,31,30,31,30,31];

let people = []; // {birthday: 0-364, x, y, targetX, targetY, color, matchGroup}
let matches = []; // [{i, j}]
let simResult = null;
let matchPulse = 0;

function randomBirthday() {
    return Math.floor(Math.random() * 365);
}

function birthdayToStr(b) {
    let m = 0, d = b;
    while (d >= DAYS_IN_MONTH[m]) { d -= DAYS_IN_MONTH[m]; m++; }
    return MONTHS[m] + ' ' + (d + 1);
}

function birthdayToAngle(b) {
    return (b / 365) * Math.PI * 2 - Math.PI / 2;
}

function theoreticalProbability(n) {
    if (n <= 1) return 0;
    let p = 1;
    for (let i = 1; i < n; i++) {
        p *= (365 - i) / 365;
    }
    return 1 - p;
}

function addPerson() {
    if (people.length >= 100) return;
    let b = randomBirthday();
    let angle = (people.length / 12) * Math.PI * 2;
    let r = 60 + people.length * 3;
    let person = {
        birthday: b,
        x: W / 2, y: H / 2,
        targetX: W / 2 + Math.cos(angle) * Math.min(r, H * 0.2),
        targetY: H * 0.4 + Math.sin(angle) * Math.min(r, H * 0.2),
        color: `hsl(${(b / 365) * 360}, 60%, 60%)`,
        matchGroup: -1
    };
    people.push(person);
    findMatches();
    updateUI();
}

function findMatches() {
    matches = [];
    let groupId = 0;
    people.forEach(p => p.matchGroup = -1);
    for (let i = 0; i < people.length; i++) {
        for (let j = i + 1; j < people.length; j++) {
            if (people[i].birthday === people[j].birthday) {
                matches.push({ i, j });
                if (people[i].matchGroup === -1 && people[j].matchGroup === -1) {
                    people[i].matchGroup = groupId;
                    people[j].matchGroup = groupId;
                    groupId++;
                } else if (people[i].matchGroup !== -1) {
                    people[j].matchGroup = people[i].matchGroup;
                } else {
                    people[i].matchGroup = people[j].matchGroup;
                }
            }
        }
    }
    if (matches.length > 0) matchPulse = 30;
}

function updateUI() {
    document.getElementById('sPeople').textContent = people.length;
    document.getElementById('sMatches').textContent = matches.length;
    document.getElementById('sTheory').textContent = (theoreticalProbability(people.length) * 100).toFixed(1) + '%';
}

function runSimulations() {
    let counts = new Array(101).fill(0);
    let trials = 10000;
    for (let t = 0; t < trials; t++) {
        let seen = new Set();
        let matchAt = -1;
        for (let i = 0; i < 100; i++) {
            let b = Math.floor(Math.random() * 365);
            if (seen.has(b)) { matchAt = i + 1; break; }
            seen.add(b);
        }
        if (matchAt > 0) {
            for (let n = matchAt; n <= 100; n++) counts[n]++;
        }
    }
    simResult = counts.map(c => c / trials);
    document.getElementById('sSim').textContent = people.length > 0 ? (simResult[people.length] * 100).toFixed(1) + '%' : '-';
}

function drawCalendarRing() {
    let cx = W / 2;
    let cy = H * 0.4;
    let r = Math.min(W, H) * 0.28;

    // Ring
    ctx.strokeStyle = 'rgba(80,100,160,0.3)';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(cx, cy, r, 0, Math.PI * 2);
    ctx.stroke();

    // Month labels
    ctx.fillStyle = 'rgba(120,140,200,0.5)';
    ctx.font = '10px "Segoe UI"';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    let dayAcc = 0;
    for (let m = 0; m < 12; m++) {
        let midDay = dayAcc + DAYS_IN_MONTH[m] / 2;
        let angle = birthdayToAngle(midDay);
        let lx = cx + Math.cos(angle) * (r + 18);
        let ly = cy + Math.sin(angle) * (r + 18);
        ctx.fillText(MONTHS[m], lx, ly);

        // Month tick
        let startAngle = birthdayToAngle(dayAcc);
        ctx.strokeStyle = 'rgba(80,100,160,0.2)';
        ctx.beginPath();
        ctx.moveTo(cx + Math.cos(startAngle) * (r - 5), cy + Math.sin(startAngle) * (r - 5));
        ctx.lineTo(cx + Math.cos(startAngle) * (r + 5), cy + Math.sin(startAngle) * (r + 5));
        ctx.stroke();

        dayAcc += DAYS_IN_MONTH[m];
    }

    // Birthday dots on ring
    people.forEach((p, idx) => {
        let angle = birthdayToAngle(p.birthday);
        let dx = cx + Math.cos(angle) * r;
        let dy = cy + Math.sin(angle) * r;

        ctx.beginPath();
        ctx.arc(dx, dy, p.matchGroup >= 0 ? 5 : 3.5, 0, Math.PI * 2);
        ctx.fillStyle = p.color;
        if (p.matchGroup >= 0) {
            ctx.shadowColor = p.color;
            ctx.shadowBlur = 8;
        }
        ctx.fill();
        ctx.shadowBlur = 0;
    });

    // Match lines
    let pulse = Math.sin(matchPulse * 0.1) * 0.3 + 0.7;
    matches.forEach(m => {
        let a1 = birthdayToAngle(people[m.i].birthday);
        let a2 = birthdayToAngle(people[m.j].birthday);
        let x1 = cx + Math.cos(a1) * r;
        let y1 = cy + Math.sin(a1) * r;
        let x2 = cx + Math.cos(a2) * r;
        let y2 = cy + Math.sin(a2) * r;

        ctx.strokeStyle = people[m.i].color;
        ctx.globalAlpha = 0.6 * pulse;
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(x1, y1);
        // Curve through center-ish
        let mx = cx + (Math.cos(a1) + Math.cos(a2)) * r * 0.2;
        let my = cy + (Math.sin(a1) + Math.sin(a2)) * r * 0.2;
        ctx.quadraticCurveTo(mx, my, x2, y2);
        ctx.stroke();
        ctx.globalAlpha = 1;
    });
}

function drawProbabilityChart() {
    let cx = W * 0.85;
    let cy = H * 0.55;
    let cw = W * 0.12;
    let ch = H * 0.3;

    if (cw < 60) return; // Too small to draw

    ctx.fillStyle = 'rgba(120,140,200,0.4)';
    ctx.font = '11px "Segoe UI"';
    ctx.textAlign = 'center';
    ctx.fillText('P(match) vs # People', cx, cy - ch / 2 - 8);

    // Axes
    ctx.strokeStyle = 'rgba(100,120,180,0.3)';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(cx - cw / 2, cy + ch / 2);
    ctx.lineTo(cx + cw / 2, cy + ch / 2);
    ctx.moveTo(cx - cw / 2, cy + ch / 2);
    ctx.lineTo(cx - cw / 2, cy - ch / 2);
    ctx.stroke();

    // Theoretical curve
    ctx.strokeStyle = '#7aa2f7';
    ctx.lineWidth = 1.5;
    ctx.beginPath();
    for (let n = 0; n <= 70; n++) {
        let x = cx - cw / 2 + (n / 70) * cw;
        let y = cy + ch / 2 - theoreticalProbability(n) * ch;
        n === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
    }
    ctx.stroke();

    // Simulation curve
    if (simResult) {
        ctx.strokeStyle = '#bb9af7';
        ctx.lineWidth = 1.5;
        ctx.setLineDash([3, 3]);
        ctx.beginPath();
        for (let n = 0; n <= 70; n++) {
            let x = cx - cw / 2 + (n / 70) * cw;
            let y = cy + ch / 2 - (simResult[n] || 0) * ch;
            n === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
        }
        ctx.stroke();
        ctx.setLineDash([]);
    }

    // 50% line
    ctx.strokeStyle = 'rgba(200,200,200,0.2)';
    ctx.setLineDash([4, 4]);
    ctx.beginPath();
    let y50 = cy + ch / 2 - 0.5 * ch;
    ctx.moveTo(cx - cw / 2, y50);
    ctx.lineTo(cx + cw / 2, y50);
    ctx.stroke();
    ctx.setLineDash([]);
    ctx.fillStyle = 'rgba(200,200,200,0.3)';
    ctx.font = '9px "Segoe UI"';
    ctx.textAlign = 'left';
    ctx.fillText('50%', cx + cw / 2 + 4, y50 + 3);

    // Current n marker
    if (people.length > 0 && people.length <= 70) {
        let mx = cx - cw / 2 + (people.length / 70) * cw;
        let my = cy + ch / 2 - theoreticalProbability(people.length) * ch;
        ctx.fillStyle = '#f7c948';
        ctx.beginPath();
        ctx.arc(mx, my, 4, 0, Math.PI * 2);
        ctx.fill();
    }

    // Axis labels
    ctx.fillStyle = 'rgba(150,160,200,0.5)';
    ctx.font = '9px "Segoe UI"';
    ctx.textAlign = 'center';
    ctx.fillText('0', cx - cw / 2, cy + ch / 2 + 12);
    ctx.fillText('23', cx - cw / 2 + (23 / 70) * cw, cy + ch / 2 + 12);
    ctx.fillText('70', cx + cw / 2, cy + ch / 2 + 12);

    // Legend
    ctx.fillStyle = '#7aa2f7';
    ctx.font = '9px "Segoe UI"';
    ctx.textAlign = 'left';
    ctx.fillText('- Theoretical', cx - cw / 2, cy + ch / 2 + 28);
    if (simResult) {
        ctx.fillStyle = '#bb9af7';
        ctx.fillText('-- Simulated', cx - cw / 2, cy + ch / 2 + 40);
    }
}

function drawPeopleGrid() {
    let startX = W * 0.05;
    let startY = H * 0.78;
    let size = 14;
    let cols = Math.floor((W * 0.5) / (size + 4));

    ctx.font = '9px "Segoe UI"';
    ctx.textAlign = 'center';

    people.forEach((p, i) => {
        let col = i % cols;
        let row = Math.floor(i / cols);
        let x = startX + col * (size + 4);
        let y = startY + row * (size + 14);

        // Person dot
        ctx.beginPath();
        ctx.arc(x + size / 2, y, size / 2.5, 0, Math.PI * 2);
        ctx.fillStyle = p.matchGroup >= 0 ? p.color : 'rgba(150,160,200,0.5)';
        if (p.matchGroup >= 0) {
            ctx.shadowColor = p.color;
            ctx.shadowBlur = 5;
        }
        ctx.fill();
        ctx.shadowBlur = 0;

        // Birthday label
        ctx.fillStyle = p.matchGroup >= 0 ? p.color : 'rgba(120,130,170,0.5)';
        ctx.fillText(birthdayToStr(p.birthday), x + size / 2, y + size);
    });
}

canvas.addEventListener('click', function(e) {
    // Don't add if clicking on controls
    if (e.clientX > W - 280 && e.clientY < 350) return;
    if (e.clientX < 400 && e.clientY > H - 200) return;
    addPerson();
});

document.getElementById('btnAdd').addEventListener('click', addPerson);
document.getElementById('btnAdd5').addEventListener('click', () => { for (let i = 0; i < 5; i++) addPerson(); });
document.getElementById('btnFill23').addEventListener('click', () => { while (people.length < 23) addPerson(); });
document.getElementById('btnFill50').addEventListener('click', () => { while (people.length < 50) addPerson(); });
document.getElementById('btnSim').addEventListener('click', () => {
    runSimulations();
    updateUI();
});
document.getElementById('btnReset').addEventListener('click', () => {
    people = []; matches = []; simResult = null; matchPulse = 0;
    document.getElementById('sSim').textContent = '-';
    updateUI();
});

function animate() {
    ctx.clearRect(0, 0, W, H);

    // Grid bg
    ctx.strokeStyle = 'rgba(50,60,100,0.1)';
    ctx.lineWidth = 1;
    for (let x = 0; x < W; x += 40) { ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, H); ctx.stroke(); }
    for (let y = 0; y < H; y += 40) { ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(W, y); ctx.stroke(); }

    // Title
    ctx.fillStyle = '#7aa2f7';
    ctx.font = 'bold 22px "Segoe UI"';
    ctx.textAlign = 'center';
    ctx.fillText('The Birthday Paradox', W / 2, 40);
    ctx.fillStyle = '#5a6a8a';
    ctx.font = '13px "Segoe UI"';
    ctx.fillText(people.length + ' people in the room | ' + matches.length + ' matching pair' + (matches.length !== 1 ? 's' : ''), W / 2, 62);

    drawCalendarRing();
    drawProbabilityChart();
    drawPeopleGrid();

    if (matchPulse > 0) matchPulse--;

    requestAnimationFrame(animate);
}

animate();

window.reset = function() {
    people = []; matches = []; simResult = null; matchPulse = 0;
    document.getElementById('sSim').textContent = '-';
    updateUI();
};
</script>
<script src="../assets/js/enhance.js"></script>
</body>
</html>
