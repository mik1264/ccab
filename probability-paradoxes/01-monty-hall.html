<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Monty Hall Problem</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; color: #e0e0e0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden; }
canvas { display: block; }
#controls {
    position: fixed; top: 16px; right: 16px; z-index: 10;
    background: rgba(20,20,40,0.85); backdrop-filter: blur(10px);
    border: 1px solid rgba(100,140,255,0.2); border-radius: 12px;
    padding: 16px; min-width: 240px;
}
#controls h3 { color: #7aa2f7; margin-bottom: 10px; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }
#controls .stat { display: flex; justify-content: space-between; margin: 4px 0; font-size: 13px; }
#controls .stat span:last-child { color: #7aa2f7; font-weight: bold; }
#controls button {
    width: 100%; padding: 8px; margin-top: 8px; border: 1px solid rgba(100,140,255,0.3);
    background: rgba(40,50,80,0.6); color: #c0d0ff; border-radius: 6px;
    cursor: pointer; font-size: 13px; transition: background 0.2s;
}
#controls button:hover { background: rgba(60,80,140,0.7); }
#info {
    position: fixed; bottom: 16px; left: 16px; z-index: 10;
    background: rgba(20,20,40,0.85); backdrop-filter: blur(10px);
    border: 1px solid rgba(100,140,255,0.2); border-radius: 12px;
    padding: 16px; max-width: 380px; font-size: 13px; line-height: 1.5;
}
#info h3 { color: #7aa2f7; margin-bottom: 8px; }
#info em { color: #bb9af7; }
a.back { position: fixed; top: 16px; left: 16px; color: #7aa2f7; text-decoration: none; font-size: 14px; z-index: 20; }
a.back:hover { text-decoration: underline; }
#message {
    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
    color: #c0d0ff; font-size: 18px; z-index: 5; pointer-events: none;
    text-align: center; opacity: 0; transition: opacity 0.3s;
}
</style>
</head>
<body>
<a href="index.html" class="back">&larr; Back</a>
<canvas id="c"></canvas>
<div id="message"></div>
<div id="controls">
    <h3>Monty Hall Statistics</h3>
    <div class="stat"><span>Games played:</span><span id="sGames">0</span></div>
    <div class="stat"><span>Stay wins:</span><span id="sStayWin">0</span></div>
    <div class="stat"><span>Stay rate:</span><span id="sStayRate">0%</span></div>
    <div class="stat"><span>Switch wins:</span><span id="sSwitchWin">0</span></div>
    <div class="stat"><span>Switch rate:</span><span id="sSwitchRate">0%</span></div>
    <hr style="border-color: rgba(100,140,255,0.15); margin: 10px 0;">
    <button id="btnAuto">Auto-Run 1000 Trials</button>
    <button id="btnAuto10k">Auto-Run 10,000 Trials</button>
    <button id="btnReset">Reset Statistics</button>
</div>
<div id="info">
    <h3>The Monty Hall Problem</h3>
    <p>Behind three doors: one <em>car</em> and two <em>goats</em>. You pick a door. The host (who knows what's behind them) opens another door revealing a goat. Should you <em>switch</em>?</p>
    <p style="margin-top:8px;">Intuitively it seems 50/50, but switching wins <em>2/3</em> of the time! Your initial pick has a 1/3 chance. The remaining 2/3 probability collapses onto the one unopened door.</p>
</div>
<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
const msg = document.getElementById('message');

let W, H;
function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
}
resize();
window.addEventListener('resize', resize);

// State
let stats = { games: 0, stayWins: 0, switchWins: 0 };
let phase = 'pick'; // pick, revealed, result
let carDoor = 0;
let picked = -1;
let revealedDoor = -1;
let resultMsg = '';
let resultTimer = 0;
let doorAnim = [0, 0, 0]; // 0=closed, 1=open
let doorTargetAnim = [0, 0, 0];
let particles = [];
let chartData = []; // rolling history for bar chart

// Bar chart rolling averages
let stayHistory = [];
let switchHistory = [];

function newGame() {
    phase = 'pick';
    carDoor = Math.floor(Math.random() * 3);
    picked = -1;
    revealedDoor = -1;
    resultMsg = '';
    doorTargetAnim = [0, 0, 0];
    doorAnim = [0, 0, 0];
}

function revealDoor() {
    let options = [0,1,2].filter(d => d !== picked && d !== carDoor);
    revealedDoor = options[Math.floor(Math.random() * options.length)];
    doorTargetAnim[revealedDoor] = 1;
    phase = 'revealed';
}

function makeChoice(switchDoor) {
    let finalPick = switchDoor ? [0,1,2].find(d => d !== picked && d !== revealedDoor) : picked;
    let won = finalPick === carDoor;
    stats.games++;
    if (switchDoor) {
        if (won) stats.switchWins++;
    } else {
        if (won) stats.stayWins++;
    }
    // Open all doors
    doorTargetAnim = [1, 1, 1];
    phase = 'result';
    resultMsg = won ? (switchDoor ? 'SWITCHED & WON!' : 'STAYED & WON!') : (switchDoor ? 'SWITCHED & LOST' : 'STAYED & LOST');
    resultTimer = 90;
    if (won) spawnParticles(finalPick);
    updateStats();
}

function spawnParticles(doorIdx) {
    let dx = getDoorX(doorIdx);
    let dy = H * 0.42;
    for (let i = 0; i < 30; i++) {
        particles.push({
            x: dx, y: dy,
            vx: (Math.random() - 0.5) * 6,
            vy: (Math.random() - 0.5) * 6 - 2,
            life: 60 + Math.random() * 40,
            color: `hsl(${40 + Math.random() * 30}, 80%, ${60 + Math.random() * 20}%)`
        });
    }
}

function updateStats() {
    document.getElementById('sGames').textContent = stats.games;
    document.getElementById('sStayWin').textContent = stats.stayWins;
    let stayTotal = stats.stayWins + (stats.games - stats.switchWins - stats.stayWins) + stats.stayWins;
    // Actually track stay/switch separately
    let stayGames = stats.games - stats.switchWins - (stats.games - stats.stayWins - stats.switchWins);
    document.getElementById('sStayRate').textContent = stats.games > 0 ?
        ((stats.stayWins / Math.max(1, stats.games - stats.switchWins + stats.stayWins)) * 100).toFixed(1) + '%' : '0%';
    document.getElementById('sSwitchWin').textContent = stats.switchWins;
    document.getElementById('sSwitchRate').textContent = stats.games > 0 ?
        ((stats.switchWins / Math.max(1, stats.games)) * 100).toFixed(1) + '%' : '0%';
    // Better: track stay games and switch games separately
}

// Let's redo stats tracking properly
let stayGames = 0, switchGames = 0;

function makeChoiceV2(switchDoor) {
    let finalPick = switchDoor ? [0,1,2].find(d => d !== picked && d !== revealedDoor) : picked;
    let won = finalPick === carDoor;
    stats.games++;
    if (switchDoor) {
        switchGames++;
        if (won) stats.switchWins++;
    } else {
        stayGames++;
        if (won) stats.stayWins++;
    }
    doorTargetAnim = [1, 1, 1];
    phase = 'result';
    resultMsg = won ? (switchDoor ? 'SWITCHED & WON!' : 'STAYED & WON!') : (switchDoor ? 'SWITCHED & LOST' : 'STAYED & LOST');
    resultTimer = 90;
    if (won) spawnParticles(finalPick);
    updateStatsV2();
}

function updateStatsV2() {
    document.getElementById('sGames').textContent = stats.games;
    document.getElementById('sStayWin').textContent = stats.stayWins + ' / ' + stayGames;
    document.getElementById('sStayRate').textContent = stayGames > 0 ? ((stats.stayWins / stayGames) * 100).toFixed(1) + '%' : '-';
    document.getElementById('sSwitchWin').textContent = stats.switchWins + ' / ' + switchGames;
    document.getElementById('sSwitchRate').textContent = switchGames > 0 ? ((stats.switchWins / switchGames) * 100).toFixed(1) + '%' : '-';
}

function autoRun(n) {
    for (let i = 0; i < n; i++) {
        let car = Math.floor(Math.random() * 3);
        let pick = Math.floor(Math.random() * 3);
        // Stay
        stayGames++;
        if (pick === car) stats.stayWins++;
        // Switch
        let revealed = [0,1,2].filter(d => d !== pick && d !== car);
        let revDoor = revealed[Math.floor(Math.random() * revealed.length)];
        let switchPick = [0,1,2].find(d => d !== pick && d !== revDoor);
        switchGames++;
        if (switchPick === car) stats.switchWins++;
        stats.games += 2;
    }
    updateStatsV2();
    newGame();
}

function getDoorX(i) {
    let spacing = Math.min(W * 0.25, 200);
    return W / 2 + (i - 1) * spacing;
}

function getDoorRect(i) {
    let x = getDoorX(i);
    let dw = Math.min(W * 0.12, 120);
    let dh = dw * 1.6;
    let dy = H * 0.35;
    return { x: x - dw/2, y: dy - dh/2, w: dw, h: dh };
}

// Drawing
function drawDoor(i) {
    let r = getDoorRect(i);
    let openAmount = doorAnim[i];

    // Door frame
    ctx.fillStyle = '#1a1e30';
    ctx.fillRect(r.x - 4, r.y - 4, r.w + 8, r.h + 8);

    // Behind door content
    if (openAmount > 0.3) {
        ctx.save();
        ctx.globalAlpha = Math.min(1, (openAmount - 0.3) / 0.5);
        let cx = r.x + r.w / 2;
        let cy = r.y + r.h * 0.55;
        if (i === carDoor) {
            // Car icon
            drawCar(cx, cy, r.w * 0.6);
        } else {
            // Goat icon
            drawGoat(cx, cy, r.w * 0.5);
        }
        ctx.restore();
    }

    // Door surface (slides to show opening)
    if (openAmount < 1) {
        ctx.save();
        let doorVisW = r.w * (1 - openAmount);
        ctx.fillStyle = (picked === i && phase !== 'result') ? '#3d4a7a' : '#2a3050';
        ctx.fillRect(r.x, r.y, doorVisW, r.h);
        // Door edge highlight
        ctx.strokeStyle = picked === i ? '#7aa2f7' : '#4a5070';
        ctx.lineWidth = 2;
        ctx.strokeRect(r.x, r.y, doorVisW, r.h);
        // Door number
        if (doorVisW > r.w * 0.4) {
            ctx.fillStyle = picked === i ? '#c0d0ff' : '#8090b0';
            ctx.font = `bold ${Math.min(r.w * 0.3, 32)}px 'Segoe UI'`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(String(i + 1), r.x + doorVisW / 2, r.y + r.h * 0.4);
        }
        // Doorknob
        if (doorVisW > r.w * 0.5) {
            ctx.beginPath();
            ctx.arc(r.x + doorVisW * 0.8, r.y + r.h * 0.5, 4, 0, Math.PI * 2);
            ctx.fillStyle = '#bb9af7';
            ctx.fill();
        }
        ctx.restore();
    }
}

function drawCar(x, y, size) {
    ctx.fillStyle = '#f7c948';
    // Car body
    let s = size * 0.4;
    ctx.beginPath();
    ctx.roundRect(x - s, y - s * 0.3, s * 2, s * 0.8, 4);
    ctx.fill();
    ctx.beginPath();
    ctx.roundRect(x - s * 0.6, y - s * 0.8, s * 1.2, s * 0.6, 4);
    ctx.fill();
    // Wheels
    ctx.fillStyle = '#333';
    ctx.beginPath();
    ctx.arc(x - s * 0.55, y + s * 0.5, s * 0.2, 0, Math.PI * 2);
    ctx.arc(x + s * 0.55, y + s * 0.5, s * 0.2, 0, Math.PI * 2);
    ctx.fill();
    // Star
    ctx.fillStyle = '#f7c948';
    ctx.font = `${size * 0.3}px serif`;
    ctx.textAlign = 'center';
    ctx.fillText('â˜…', x, y - s * 1.2);
    ctx.font = `${size * 0.18}px 'Segoe UI'`;
    ctx.fillStyle = '#f7c948';
    ctx.fillText('CAR', x, y + s * 1.1);
}

function drawGoat(x, y, size) {
    ctx.fillStyle = '#888';
    let s = size * 0.35;
    // Body
    ctx.beginPath();
    ctx.ellipse(x, y, s * 1.2, s * 0.7, 0, 0, Math.PI * 2);
    ctx.fill();
    // Head
    ctx.beginPath();
    ctx.arc(x + s * 0.9, y - s * 0.4, s * 0.45, 0, Math.PI * 2);
    ctx.fill();
    // Horns
    ctx.strokeStyle = '#aaa';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(x + s * 0.8, y - s * 0.8);
    ctx.lineTo(x + s * 0.6, y - s * 1.3);
    ctx.moveTo(x + s * 1.1, y - s * 0.8);
    ctx.lineTo(x + s * 1.3, y - s * 1.3);
    ctx.stroke();
    // Legs
    ctx.strokeStyle = '#888';
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(x - s * 0.6, y + s * 0.6); ctx.lineTo(x - s * 0.6, y + s * 1.3);
    ctx.moveTo(x - s * 0.1, y + s * 0.6); ctx.lineTo(x - s * 0.1, y + s * 1.3);
    ctx.moveTo(x + s * 0.3, y + s * 0.6); ctx.lineTo(x + s * 0.3, y + s * 1.3);
    ctx.moveTo(x + s * 0.7, y + s * 0.5); ctx.lineTo(x + s * 0.7, y + s * 1.3);
    ctx.stroke();
    ctx.font = `${size * 0.2}px 'Segoe UI'`;
    ctx.textAlign = 'center';
    ctx.fillStyle = '#999';
    ctx.fillText('GOAT', x, y + s * 1.8);
}

function drawBarChart() {
    let cx = W * 0.13;
    let cy = H * 0.72;
    let bw = Math.min(80, W * 0.06);
    let maxH = H * 0.18;

    let stayRate = stayGames > 0 ? stats.stayWins / stayGames : 0;
    let switchRate = switchGames > 0 ? stats.switchWins / switchGames : 0;

    if (stats.games === 0) return;

    // Title
    ctx.fillStyle = '#8090b0';
    ctx.font = '12px "Segoe UI"';
    ctx.textAlign = 'center';
    ctx.fillText('Win Rate Comparison', cx + bw * 0.75, cy - maxH - 14);

    // Bars
    let h1 = stayRate * maxH;
    let h2 = switchRate * maxH;

    // Stay bar
    ctx.fillStyle = 'rgba(255, 100, 100, 0.7)';
    ctx.fillRect(cx - bw * 0.1, cy - h1, bw, h1);
    ctx.strokeStyle = 'rgba(255, 100, 100, 0.9)';
    ctx.lineWidth = 1;
    ctx.strokeRect(cx - bw * 0.1, cy - h1, bw, h1);

    // Switch bar
    ctx.fillStyle = 'rgba(100, 200, 100, 0.7)';
    ctx.fillRect(cx + bw * 1.1, cy - h2, bw, h2);
    ctx.strokeStyle = 'rgba(100, 200, 100, 0.9)';
    ctx.strokeRect(cx + bw * 1.1, cy - h2, bw, h2);

    // Labels
    ctx.fillStyle = '#c08080';
    ctx.font = '11px "Segoe UI"';
    ctx.textAlign = 'center';
    ctx.fillText('Stay', cx + bw * 0.4, cy + 14);
    ctx.fillText((stayRate * 100).toFixed(1) + '%', cx + bw * 0.4, cy - h1 - 5);

    ctx.fillStyle = '#80c080';
    ctx.fillText('Switch', cx + bw * 1.6, cy + 14);
    ctx.fillText((switchRate * 100).toFixed(1) + '%', cx + bw * 1.6, cy - h2 - 5);

    // 33/67 reference lines
    ctx.setLineDash([4, 4]);
    ctx.strokeStyle = 'rgba(200,200,200,0.2)';
    ctx.lineWidth = 1;
    let y33 = cy - 0.333 * maxH;
    let y67 = cy - 0.667 * maxH;
    ctx.beginPath();
    ctx.moveTo(cx - bw * 0.3, y33); ctx.lineTo(cx + bw * 2.3, y33);
    ctx.moveTo(cx - bw * 0.3, y67); ctx.lineTo(cx + bw * 2.3, y67);
    ctx.stroke();
    ctx.setLineDash([]);
    ctx.fillStyle = 'rgba(200,200,200,0.3)';
    ctx.font = '9px "Segoe UI"';
    ctx.textAlign = 'left';
    ctx.fillText('33.3%', cx + bw * 2.4, y33 + 3);
    ctx.fillText('66.7%', cx + bw * 2.4, y67 + 3);

    // Baseline
    ctx.strokeStyle = 'rgba(200,200,200,0.3)';
    ctx.beginPath();
    ctx.moveTo(cx - bw * 0.3, cy);
    ctx.lineTo(cx + bw * 2.3, cy);
    ctx.stroke();
}

function drawInstructions() {
    ctx.textAlign = 'center';
    ctx.font = '15px "Segoe UI"';
    let y = H * 0.6;
    if (phase === 'pick') {
        ctx.fillStyle = 'rgba(200,220,255,0.7)';
        ctx.fillText('Click a door to make your choice', W / 2, y);
    } else if (phase === 'revealed') {
        ctx.fillStyle = 'rgba(200,220,255,0.7)';
        ctx.fillText('Door ' + (revealedDoor + 1) + ' has a goat! Click your door to STAY or the other to SWITCH', W / 2, y);
    } else if (phase === 'result' && resultTimer > 0) {
        let col = resultMsg.includes('WON') ? '#7dda58' : '#f76c6c';
        ctx.fillStyle = col;
        ctx.font = 'bold 20px "Segoe UI"';
        ctx.fillText(resultMsg, W / 2, y);
        ctx.font = '14px "Segoe UI"';
        ctx.fillStyle = 'rgba(200,220,255,0.5)';
        ctx.fillText('Click anywhere for next round', W / 2, y + 28);
    }
}

// Interaction
canvas.addEventListener('click', function(e) {
    let mx = e.clientX, my = e.clientY;

    if (phase === 'result') {
        if (resultTimer <= 0) newGame();
        else { resultTimer = 0; setTimeout(newGame, 200); }
        return;
    }

    for (let i = 0; i < 3; i++) {
        let r = getDoorRect(i);
        if (mx >= r.x && mx <= r.x + r.w && my >= r.y && my <= r.y + r.h) {
            if (phase === 'pick') {
                picked = i;
                setTimeout(revealDoor, 400);
            } else if (phase === 'revealed' && i !== revealedDoor) {
                let didSwitch = i !== picked;
                picked = i;
                makeChoiceV2(didSwitch);
            }
            break;
        }
    }
});

document.getElementById('btnAuto').addEventListener('click', () => autoRun(1000));
document.getElementById('btnAuto10k').addEventListener('click', () => autoRun(10000));
document.getElementById('btnReset').addEventListener('click', () => {
    stats = { games: 0, stayWins: 0, switchWins: 0 };
    stayGames = 0; switchGames = 0;
    updateStatsV2();
    newGame();
});

// Animation
function animate() {
    ctx.clearRect(0, 0, W, H);

    // Subtle grid background
    ctx.strokeStyle = 'rgba(50,60,100,0.15)';
    ctx.lineWidth = 1;
    let gs = 40;
    for (let x = 0; x < W; x += gs) { ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, H); ctx.stroke(); }
    for (let y = 0; y < H; y += gs) { ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(W, y); ctx.stroke(); }

    // Title
    ctx.fillStyle = '#7aa2f7';
    ctx.font = 'bold 24px "Segoe UI"';
    ctx.textAlign = 'center';
    ctx.fillText('The Monty Hall Problem', W / 2, H * 0.1);
    ctx.fillStyle = '#5a6a8a';
    ctx.font = '14px "Segoe UI"';
    ctx.fillText('Should you switch doors?', W / 2, H * 0.1 + 26);

    // Animate doors
    for (let i = 0; i < 3; i++) {
        doorAnim[i] += (doorTargetAnim[i] - doorAnim[i]) * 0.08;
        drawDoor(i);
    }

    // Particles
    particles = particles.filter(p => p.life > 0);
    particles.forEach(p => {
        p.x += p.vx; p.y += p.vy; p.vy += 0.08; p.life--;
        ctx.globalAlpha = p.life / 60;
        ctx.fillStyle = p.color;
        ctx.fillRect(p.x - 2, p.y - 2, 4, 4);
    });
    ctx.globalAlpha = 1;

    drawInstructions();
    drawBarChart();

    if (resultTimer > 0) resultTimer--;
    if (phase === 'result' && resultTimer <= 0 && resultTimer > -100) {
        // Auto-advance after a brief pause
    }

    requestAnimationFrame(animate);
}

newGame();
animate();

window.reset = function() {
    stats = { games: 0, stayWins: 0, switchWins: 0 };
    stayGames = 0; switchGames = 0;
    particles = [];
    updateStatsV2();
    newGame();
};
</script>
<script src="../assets/js/enhance.js"></script>
</body>
</html>
