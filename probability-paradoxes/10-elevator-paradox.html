<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Elevator Paradox - Why the First Elevator Always Goes the Wrong Way</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: 'Segoe UI', Arial, sans-serif; color: #cde; }
canvas { display: block; }
a.back { position: fixed; top: 20px; left: 20px; color: #8af; text-decoration: none; z-index: 100; font-size: 1.1em; }
a.back:hover { color: #bdf; }

#controls {
    position: fixed; top: 20px; right: 20px;
    background: rgba(20,20,40,0.85); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(138,170,255,0.15); border-radius: 12px;
    padding: 18px; z-index: 100; width: 250px; font-size: 13px;
}
#controls h3 { margin-bottom: 10px; color: #8af; font-size: 15px; }
.ctrl-row { margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
.ctrl-row label { flex: 0 0 90px; font-size: 12px; }
.ctrl-row input[type=range] { flex: 1; margin: 0 8px; accent-color: #8af; }
.ctrl-row .val { flex: 0 0 30px; text-align: right; color: #8af; font-size: 12px; }
button {
    background: rgba(138,170,255,0.15); color: #8af; border: 1px solid rgba(138,170,255,0.3);
    border-radius: 6px; padding: 6px 14px; cursor: pointer; font-size: 12px; margin: 2px;
}
button:hover { background: rgba(138,170,255,0.3); }

#stats-panel {
    position: fixed; bottom: 20px; left: 20px;
    background: rgba(20,20,40,0.85); backdrop-filter: blur(10px);
    border: 1px solid rgba(138,170,255,0.15); border-radius: 12px;
    padding: 16px 20px; z-index: 100; font-size: 13px; min-width: 280px;
}
#stats-panel h4 { color: #8af; margin-bottom: 8px; font-size: 14px; }
.stat-row { display: flex; justify-content: space-between; margin: 4px 0; }
.stat-row .val { font-weight: 600; }
.stat-row .up { color: #6f6; }
.stat-row .down { color: #f66; }
.stat-row .neutral { color: #8af; }
.big-stat { font-size: 22px; font-weight: 700; text-align: center; margin: 10px 0 4px; }
.big-stat .up { color: #6f6; }
.big-stat .down { color: #f66; }

#info {
    position: fixed; bottom: 20px; right: 20px;
    background: rgba(20,20,40,0.85); backdrop-filter: blur(10px);
    border: 1px solid rgba(138,170,255,0.15); border-radius: 12px;
    padding: 14px 18px; z-index: 100; font-size: 12px; max-width: 280px; line-height: 1.5;
}
#info h4 { color: #8af; margin-bottom: 6px; font-size: 14px; }
#info .key { color: #f8a; font-weight: 600; }

#floor-indicator {
    position: fixed; top: 50%; right: 300px; transform: translateY(-50%);
    z-index: 50; font-size: 12px; pointer-events: none;
}
</style>
</head>
<body>
<a href="index.html" class="back">&#8592; Back</a>
<canvas id="canvas"></canvas>

<div id="controls">
    <h3>Elevator Paradox</h3>
    <div class="ctrl-row">
        <label>Floors</label>
        <input type="range" id="numFloors" min="5" max="20" value="10">
        <span class="val" id="floorsVal">10</span>
    </div>
    <div class="ctrl-row">
        <label>Your floor</label>
        <input type="range" id="userFloor" min="1" max="10" value="7">
        <span class="val" id="userFloorVal">7</span>
    </div>
    <div class="ctrl-row">
        <label>Elevators</label>
        <input type="range" id="numElevators" min="1" max="4" value="2">
        <span class="val" id="elevVal">2</span>
    </div>
    <div class="ctrl-row">
        <label>Speed</label>
        <input type="range" id="simSpeed" min="1" max="10" value="3">
        <span class="val" id="speedVal">3</span>
    </div>
    <div style="margin-top:8px;">
        <button onclick="window.reset()">Reset Stats</button>
    </div>
</div>

<div id="stats-panel">
    <h4>First Arrival Direction</h4>
    <div class="stat-row"><span>Arrivals observed:</span><span class="val neutral" id="totalArrivals">0</span></div>
    <div class="stat-row"><span>Going UP:</span><span class="val up" id="goingUp">0</span></div>
    <div class="stat-row"><span>Going DOWN:</span><span class="val down" id="goingDown">0</span></div>
    <div class="big-stat">
        <span class="up" id="upPct">0%</span> UP &nbsp;/&nbsp; <span class="down" id="downPct">0%</span> DOWN
    </div>
    <div class="stat-row" style="margin-top:8px;border-top:1px solid rgba(138,170,255,0.15);padding-top:8px;">
        <span>Predicted (floor <span id="predFloor">7</span>/<span id="predTotal">10</span>):</span>
        <span class="val neutral" id="predicted">--</span>
    </div>
</div>

<div id="info">
    <h4>The Paradox</h4>
    <p>If you're on a <span class="key">high floor</span>, most elevators that arrive first will be going <span class="key">down</span>. On a low floor, most go up.</p>
    <p style="margin-top:6px;">Why? An elevator moving randomly spends more time on the floors <span class="key">below</span> you than above (when you're high up). So at any random moment, elevators are more likely to be below you, meaning they'll arrive going up? No -- they arrive going <span class="key">down</span> because they must first pass your floor going up, then return going down!</p>
    <p style="margin-top:6px;">On floor F of N: P(down) = (F-1)/(N-1)</p>
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let W, H;

let numFloors = 10;
let userFloor = 7;
let numElevators = 2;
let simSpeed = 3;

let elevators = [];
let totalArrivals = 0, goingUpCount = 0, goingDownCount = 0;
let lastArrivalFlash = 0;
let lastArrivalDir = '';
let animId;

function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
}

function initElevators() {
    elevators = [];
    for (let i = 0; i < numElevators; i++) {
        elevators.push({
            floor: Math.random() * (numFloors - 1) + 1,
            direction: Math.random() < 0.5 ? 1 : -1,
            speed: 0.015 + Math.random() * 0.01,
            atUserFloor: false,
            justArrived: false,
            arriveTime: 0
        });
    }
}

function updatePrediction() {
    const f = userFloor;
    const n = numFloors;
    const pDown = (f - 1) / (n - 1);
    const pUp = 1 - pDown;
    document.getElementById('predFloor').textContent = f;
    document.getElementById('predTotal').textContent = n;
    document.getElementById('predicted').textContent =
        Math.round(pUp * 100) + '% up / ' + Math.round(pDown * 100) + '% down';
}

function updateStats() {
    document.getElementById('totalArrivals').textContent = totalArrivals;
    document.getElementById('goingUp').textContent = goingUpCount;
    document.getElementById('goingDown').textContent = goingDownCount;
    if (totalArrivals > 0) {
        document.getElementById('upPct').textContent = Math.round(goingUpCount / totalArrivals * 100) + '%';
        document.getElementById('downPct').textContent = Math.round(goingDownCount / totalArrivals * 100) + '%';
    }
}

function step() {
    const speed = simSpeed * 0.012;
    let anyAtFloor = false;

    for (const elev of elevators) {
        elev.floor += elev.direction * (elev.speed + speed * 0.5);

        // Bounce at top/bottom
        if (elev.floor >= numFloors) {
            elev.floor = numFloors;
            elev.direction = -1;
        }
        if (elev.floor <= 1) {
            elev.floor = 1;
            elev.direction = 1;
        }

        // Random direction changes (simulate stopping at floors)
        if (Math.random() < 0.002 * simSpeed) {
            elev.direction *= -1;
        }

        // Check if passing user floor
        const wasAt = elev.atUserFloor;
        const isAt = Math.abs(elev.floor - userFloor) < 0.3;
        elev.atUserFloor = isAt;

        if (isAt && !wasAt && !anyAtFloor) {
            // First elevator arriving!
            anyAtFloor = true;
            totalArrivals++;
            if (elev.direction > 0) {
                goingUpCount++;
                lastArrivalDir = 'UP';
            } else {
                goingDownCount++;
                lastArrivalDir = 'DOWN';
            }
            lastArrivalFlash = 30;
            elev.arriveTime = 30;
        }

        if (elev.arriveTime > 0) elev.arriveTime--;
    }
}

function draw() {
    ctx.clearRect(0, 0, W, H);

    const buildingX = W * 0.25;
    const buildingW = W * 0.35;
    const buildingTop = H * 0.08;
    const buildingBottom = H * 0.88;
    const floorH = (buildingBottom - buildingTop) / numFloors;

    // Building outline
    ctx.strokeStyle = 'rgba(138,170,255,0.2)';
    ctx.lineWidth = 2;
    ctx.strokeRect(buildingX, buildingTop, buildingW, buildingBottom - buildingTop);

    // Floor lines and labels
    for (let f = 1; f <= numFloors; f++) {
        const y = buildingBottom - (f - 0.5) * floorH;
        const floorY = buildingBottom - f * floorH;

        // Floor line
        ctx.strokeStyle = 'rgba(138,170,255,0.08)';
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(buildingX, floorY);
        ctx.lineTo(buildingX + buildingW, floorY);
        ctx.stroke();

        // Floor number
        ctx.fillStyle = f === userFloor ? '#f8a' : 'rgba(138,170,255,0.3)';
        ctx.font = (f === userFloor ? 'bold 14px' : '12px') + ' sans-serif';
        ctx.textAlign = 'right';
        ctx.fillText('F' + f, buildingX - 10, y + 4);

        // Highlight user floor
        if (f === userFloor) {
            ctx.fillStyle = 'rgba(255,140,80,0.08)';
            ctx.fillRect(buildingX, floorY, buildingW, floorH);

            // "YOU ARE HERE" marker
            ctx.fillStyle = '#f8a';
            ctx.font = 'bold 11px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('YOU ARE HERE', buildingX + buildingW + 15, y + 4);

            // Arrow
            ctx.beginPath();
            ctx.moveTo(buildingX + buildingW + 10, y);
            ctx.lineTo(buildingX + buildingW + 5, y - 5);
            ctx.lineTo(buildingX + buildingW + 5, y + 5);
            ctx.closePath();
            ctx.fillStyle = '#f8a';
            ctx.fill();
        }
    }

    // Elevator shafts
    const shaftW = Math.min(50, buildingW / (numElevators * 2 + 1));
    const shaftGap = shaftW * 0.5;
    const shaftsTotal = numElevators * shaftW + (numElevators - 1) * shaftGap;
    const shaftsStart = buildingX + (buildingW - shaftsTotal) / 2;

    for (let i = 0; i < elevators.length; i++) {
        const elev = elevators[i];
        const sx = shaftsStart + i * (shaftW + shaftGap);

        // Shaft background
        ctx.fillStyle = 'rgba(20,25,50,0.5)';
        ctx.fillRect(sx, buildingTop, shaftW, buildingBottom - buildingTop);

        // Elevator car
        const elevY = buildingBottom - (elev.floor - 0.5) * floorH;
        const carH = floorH * 0.7;

        // Glow effect when arriving
        if (elev.arriveTime > 0) {
            const alpha = elev.arriveTime / 30 * 0.5;
            ctx.shadowColor = elev.direction > 0 ? '#6f6' : '#f66';
            ctx.shadowBlur = 20;
        }

        ctx.fillStyle = elev.arriveTime > 0
            ? (elev.direction > 0 ? 'rgba(100,255,100,0.8)' : 'rgba(255,100,100,0.8)')
            : 'rgba(138,170,255,0.6)';
        ctx.beginPath();
        ctx.roundRect(sx + 3, elevY - carH / 2, shaftW - 6, carH, 4);
        ctx.fill();
        ctx.shadowBlur = 0;

        // Direction arrow on car
        ctx.fillStyle = '#fff';
        ctx.font = 'bold 16px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText(elev.direction > 0 ? '\u25B2' : '\u25BC', sx + shaftW / 2, elevY + 5);

        // Elevator label
        ctx.fillStyle = 'rgba(138,170,255,0.5)';
        ctx.font = '11px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('E' + (i + 1), sx + shaftW / 2, buildingBottom + 16);
    }

    // Arrival flash
    if (lastArrivalFlash > 0) {
        lastArrivalFlash--;
        const alpha = lastArrivalFlash / 30;
        ctx.fillStyle = lastArrivalDir === 'UP'
            ? `rgba(100,255,100,${alpha * 0.3})`
            : `rgba(255,100,100,${alpha * 0.3})`;
        ctx.font = 'bold 28px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText(
            lastArrivalDir === 'UP' ? '\u25B2 GOING UP' : '\u25BC GOING DOWN',
            W * 0.5, H * 0.04 + 20
        );
    }

    // Direction distribution bar
    if (totalArrivals > 0) {
        const barX = buildingX;
        const barY = buildingBottom + 30;
        const barW = buildingW;
        const barH = 12;
        const upRatio = goingUpCount / totalArrivals;

        ctx.fillStyle = 'rgba(100,255,100,0.5)';
        ctx.beginPath();
        ctx.roundRect(barX, barY, barW * upRatio, barH, upRatio >= 1 ? 6 : [6, 0, 0, 6]);
        ctx.fill();

        ctx.fillStyle = 'rgba(255,100,100,0.5)';
        ctx.beginPath();
        ctx.roundRect(barX + barW * upRatio, barY, barW * (1 - upRatio), barH, upRatio <= 0 ? 6 : [0, 6, 6, 0]);
        ctx.fill();

        ctx.fillStyle = '#aaa';
        ctx.font = '10px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('UP ' + Math.round(upRatio * 100) + '% / DOWN ' + Math.round((1 - upRatio) * 100) + '%', barX + barW / 2, barY + barH + 14);
    }
}

function animate() {
    for (let i = 0; i < simSpeed; i++) step();
    draw();
    updateStats();
    animId = requestAnimationFrame(animate);
}

document.getElementById('numFloors').addEventListener('input', function() {
    numFloors = parseInt(this.value);
    document.getElementById('floorsVal').textContent = numFloors;
    document.getElementById('userFloor').max = numFloors;
    if (userFloor > numFloors) {
        userFloor = numFloors;
        document.getElementById('userFloor').value = userFloor;
        document.getElementById('userFloorVal').textContent = userFloor;
    }
    updatePrediction();
    initElevators();
});

document.getElementById('userFloor').addEventListener('input', function() {
    userFloor = parseInt(this.value);
    document.getElementById('userFloorVal').textContent = userFloor;
    updatePrediction();
});

document.getElementById('numElevators').addEventListener('input', function() {
    numElevators = parseInt(this.value);
    document.getElementById('elevVal').textContent = numElevators;
    initElevators();
});

document.getElementById('simSpeed').addEventListener('input', function() {
    simSpeed = parseInt(this.value);
    document.getElementById('speedVal').textContent = simSpeed;
});

window.addEventListener('resize', resize);

window.addEventListener('keydown', function(e) {
    if (e.code === 'Space') e.preventDefault();
});

window.reset = function() {
    totalArrivals = 0;
    goingUpCount = 0;
    goingDownCount = 0;
    lastArrivalFlash = 0;
    initElevators();
    updateStats();
    updatePrediction();
    document.getElementById('upPct').textContent = '0%';
    document.getElementById('downPct').textContent = '0%';
};

resize();
initElevators();
updatePrediction();
animate();
</script>
<script src="../assets/js/enhance.js"></script>
</body>
</html>
