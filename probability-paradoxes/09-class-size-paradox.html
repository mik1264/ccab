<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Class Size Paradox - The Inspection Paradox</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: 'Segoe UI', Arial, sans-serif; color: #cde; }
canvas { display: block; }
a.back { position: fixed; top: 20px; left: 20px; color: #8af; text-decoration: none; z-index: 100; font-size: 1.1em; }
a.back:hover { color: #bdf; }

#controls {
    position: fixed; top: 20px; right: 20px;
    background: rgba(20,20,40,0.85); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(138,170,255,0.15); border-radius: 12px;
    padding: 18px; z-index: 100; width: 280px; font-size: 13px;
}
#controls h3 { margin-bottom: 10px; color: #8af; font-size: 15px; }
.class-slider { margin: 8px 0; }
.class-slider label { display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 2px; }
.class-slider label .size-val { color: #8af; font-weight: 600; }
.class-slider input[type=range] { width: 100%; accent-color: #8af; }
button {
    background: rgba(138,170,255,0.15); color: #8af; border: 1px solid rgba(138,170,255,0.3);
    border-radius: 6px; padding: 6px 14px; cursor: pointer; font-size: 12px; margin: 3px 2px;
}
button:hover { background: rgba(138,170,255,0.3); }
.btn-row { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 10px; }

#results {
    position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
    background: rgba(20,20,40,0.9); backdrop-filter: blur(10px);
    border: 1px solid rgba(138,170,255,0.2); border-radius: 12px;
    padding: 20px 30px; z-index: 100; display: flex; gap: 50px; text-align: center;
}
.result-box h4 { font-size: 12px; opacity: 0.7; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 1px; }
.result-box .number { font-size: 42px; font-weight: 700; line-height: 1.1; }
.result-box .sub { font-size: 11px; opacity: 0.6; margin-top: 2px; }
.registrar .number { color: #6cf; }
.student .number { color: #f8a; }
.ratio .number { color: #f66; font-size: 32px; }

#info {
    position: fixed; bottom: 20px; left: 20px;
    background: rgba(20,20,40,0.85); backdrop-filter: blur(10px);
    border: 1px solid rgba(138,170,255,0.15); border-radius: 12px;
    padding: 14px 18px; z-index: 100; font-size: 12px; max-width: 280px; line-height: 1.5;
}
#info h4 { color: #8af; margin-bottom: 6px; font-size: 14px; }
#info .key { color: #f8a; font-weight: 600; }

#survey-status {
    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
    pointer-events: none; z-index: 50; text-align: center;
    font-size: 20px; color: #8af; opacity: 0;
    transition: opacity 0.3s;
}
</style>
</head>
<body>
<a href="index.html" class="back">&#8592; Back</a>
<canvas id="canvas"></canvas>

<div id="survey-status"></div>

<div id="controls">
    <h3>Class Size Paradox</h3>
    <p style="font-size:11px;opacity:0.7;margin-bottom:10px;">Adjust class sizes for 6 courses:</p>
    <div class="class-slider">
        <label><span>Intro Psych</span><span class="size-val" id="s0v">200</span></label>
        <input type="range" id="s0" min="10" max="300" value="200" step="5">
    </div>
    <div class="class-slider">
        <label><span>Organic Chemistry</span><span class="size-val" id="s1v">100</span></label>
        <input type="range" id="s1" min="10" max="300" value="100" step="5">
    </div>
    <div class="class-slider">
        <label><span>Calculus II</span><span class="size-val" id="s2v">50</span></label>
        <input type="range" id="s2" min="10" max="300" value="50" step="5">
    </div>
    <div class="class-slider">
        <label><span>Art History</span><span class="size-val" id="s3v">30</span></label>
        <input type="range" id="s3" min="10" max="300" value="30" step="5">
    </div>
    <div class="class-slider">
        <label><span>Ancient Greek</span><span class="size-val" id="s4v">15</span></label>
        <input type="range" id="s4" min="5" max="300" value="15" step="5">
    </div>
    <div class="class-slider">
        <label><span>Topology Seminar</span><span class="size-val" id="s5v">10</span></label>
        <input type="range" id="s5" min="5" max="300" value="10" step="5">
    </div>
    <div class="btn-row">
        <button onclick="runSurvey('registrar')">Survey: Registrar</button>
        <button onclick="runSurvey('student')">Survey: Students</button>
        <button onclick="window.reset()">Reset</button>
    </div>
</div>

<div id="results">
    <div class="result-box registrar">
        <h4>Registrar's Average</h4>
        <div class="number" id="regAvg">--</div>
        <div class="sub">(simple avg of class sizes)</div>
    </div>
    <div class="result-box student">
        <h4>Student's Average</h4>
        <div class="number" id="stuAvg">--</div>
        <div class="sub">(size-weighted avg)</div>
    </div>
    <div class="result-box ratio">
        <h4>Ratio</h4>
        <div class="number" id="ratioVal">--</div>
        <div class="sub">student / registrar</div>
    </div>
</div>

<div id="info">
    <h4>The Inspection Paradox</h4>
    <p>Ask the <span class="key">registrar</span> for average class size: they average all classes equally.</p>
    <p style="margin-top:4px;">Ask a <span class="key">random student</span>: they're more likely to be in a large class! Bigger classes "catch" more students.</p>
    <p style="margin-top:4px;">This same bias appears in bus wait times, hospital stays, and family size surveys.</p>
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let W, H;
let classSizes = [200, 100, 50, 30, 15, 10];
const classNames = ['Intro Psych', 'Organic Chem', 'Calculus II', 'Art History', 'Ancient Greek', 'Topology'];
const classColors = ['#6cf', '#8af', '#a8f', '#f8a', '#fa8', '#ff8'];
let surveyAnim = null;
let surveyDots = [];
let animId;

function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
}

function getSizes() {
    for (let i = 0; i < 6; i++) {
        classSizes[i] = parseInt(document.getElementById('s' + i).value);
    }
}

function computeResults() {
    getSizes();
    const n = classSizes.length;
    const regAvg = classSizes.reduce((a, b) => a + b, 0) / n;
    const totalStudents = classSizes.reduce((a, b) => a + b, 0);
    const stuAvg = classSizes.reduce((a, s) => a + s * s, 0) / totalStudents;

    document.getElementById('regAvg').textContent = regAvg.toFixed(1);
    document.getElementById('stuAvg').textContent = stuAvg.toFixed(1);
    document.getElementById('ratioVal').textContent = (stuAvg / regAvg).toFixed(2) + 'x';
}

function drawLectureHalls() {
    ctx.clearRect(0, 0, W, H);
    getSizes();

    const totalClasses = classSizes.length;
    const margin = 40;
    const gap = 20;
    const availW = W - margin * 2 - gap * (totalClasses - 1);
    const hallW = Math.min(200, availW / totalClasses);
    const startX = (W - (hallW * totalClasses + gap * (totalClasses - 1))) / 2;
    const maxSize = Math.max(...classSizes);
    const hallMaxH = H * 0.45;
    const baseY = H * 0.62;

    for (let i = 0; i < totalClasses; i++) {
        const x = startX + i * (hallW + gap);
        const size = classSizes[i];
        const hallH = (size / maxSize) * hallMaxH;
        const y = baseY - hallH;

        // Hall background
        ctx.fillStyle = 'rgba(30,35,60,0.6)';
        ctx.strokeStyle = classColors[i] + '40';
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.roundRect(x, y, hallW, hallH, [8, 8, 0, 0]);
        ctx.fill();
        ctx.stroke();

        // Students as dots
        const dotR = Math.max(2, Math.min(5, hallW / (Math.sqrt(size) * 2.5)));
        const cols = Math.floor((hallW - 8) / (dotR * 2.5));
        const rows = Math.ceil(size / cols);
        for (let s = 0; s < size; s++) {
            const col = s % cols;
            const row = Math.floor(s / cols);
            const sx = x + 6 + col * (dotR * 2.5) + dotR;
            const sy = baseY - 4 - row * (dotR * 2.5) - dotR;
            if (sy < y) continue;

            const isHighlighted = surveyDots.includes(i * 1000 + s);
            ctx.beginPath();
            ctx.arc(sx, sy, dotR, 0, Math.PI * 2);
            ctx.fillStyle = isHighlighted ? '#fff' : classColors[i] + '80';
            ctx.fill();
        }

        // Label
        ctx.fillStyle = classColors[i];
        ctx.font = 'bold 13px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText(size + ' students', x + hallW / 2, baseY + 18);
        ctx.fillStyle = '#8aa';
        ctx.font = '11px sans-serif';
        ctx.fillText(classNames[i], x + hallW / 2, baseY + 34);
    }

    // Title
    ctx.fillStyle = 'rgba(138,170,255,0.3)';
    ctx.font = '14px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('University with ' + totalClasses + ' courses', W / 2, 50);
}

function runSurvey(type) {
    getSizes();
    surveyDots = [];

    if (type === 'registrar') {
        // Flash each class
        document.getElementById('survey-status').textContent = 'Registrar survey: averaging class sizes...';
        document.getElementById('survey-status').style.opacity = '1';
        setTimeout(() => {
            document.getElementById('survey-status').style.opacity = '0';
        }, 1500);
    } else {
        // Sample random students
        document.getElementById('survey-status').textContent = 'Student survey: asking 100 random students...';
        document.getElementById('survey-status').style.opacity = '1';
        const totalStudents = classSizes.reduce((a, b) => a + b, 0);
        for (let s = 0; s < 100; s++) {
            let pick = Math.floor(Math.random() * totalStudents);
            let classIdx = 0;
            for (let i = 0; i < classSizes.length; i++) {
                if (pick < classSizes[i]) { classIdx = i; break; }
                pick -= classSizes[i];
            }
            surveyDots.push(classIdx * 1000 + pick);
        }
        setTimeout(() => {
            document.getElementById('survey-status').style.opacity = '0';
            surveyDots = [];
        }, 2000);
    }

    computeResults();
}

function animate() {
    drawLectureHalls();
    animId = requestAnimationFrame(animate);
}

for (let i = 0; i < 6; i++) {
    document.getElementById('s' + i).addEventListener('input', function() {
        document.getElementById('s' + i + 'v').textContent = this.value;
        computeResults();
    });
}

window.addEventListener('resize', resize);

window.reset = function() {
    const defaults = [200, 100, 50, 30, 15, 10];
    for (let i = 0; i < 6; i++) {
        document.getElementById('s' + i).value = defaults[i];
        document.getElementById('s' + i + 'v').textContent = defaults[i];
    }
    surveyDots = [];
    document.getElementById('regAvg').textContent = '--';
    document.getElementById('stuAvg').textContent = '--';
    document.getElementById('ratioVal').textContent = '--';
};

resize();
computeResults();
animate();
</script>
<script src="../assets/js/enhance.js"></script>
</body>
</html>
