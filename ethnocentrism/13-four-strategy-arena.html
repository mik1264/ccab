<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Four-Strategy Arena</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: #333;
        }
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 1200px;
            width: 100%;
        }
        h1 { color: #667eea; margin-bottom: 10px; font-size: 28px; }
        .description { color: #666; margin-bottom: 20px; line-height: 1.6; }
        canvas { border: 2px solid #667eea; border-radius: 8px; background: #000; display: block; margin: 0 auto 20px; }
        .controls { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 20px; align-items: center; justify-content: center; }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.3s;
        }
        button:hover { background: #5568d3; }
        .legend {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        .legend-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }
        .legend-title {
            font-weight: 700;
            margin-bottom: 5px;
            font-size: 16px;
        }
        .legend-desc {
            font-size: 12px;
            color: #666;
        }
        .green { border-left: 4px solid #00ff00; }
        .red { border-left: 4px solid #ff0000; }
        .orange { border-left: 4px solid #ffaa00; }
        .blue { border-left: 4px solid #0088ff; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Four-Strategy Arena</h1>
        <p class="description">
            Four quadrants, each starting with a different pure strategy. Watch how they compete at boundaries.
            Ethnocentric quadrant (red) typically expands into all others, altruists (green) get exploited,
            cosmopolitans (orange) fail to cooperate with each other, and egoists (blue) starve from lack of cooperation.
        </p>

        <canvas id="canvas" width="700" height="700"></canvas>

        <div class="controls">
            <button id="startBtn">Start</button>
            <button id="pauseBtn">Pause</button>
            <button id="resetBtn">Reset</button>
        </div>

        <div class="legend">
            <div class="legend-item green">
                <div class="legend-title">Altruists (Top-Left)</div>
                <div class="legend-desc">Cooperate with everyone. Highly vulnerable to exploitation.</div>
            </div>
            <div class="legend-item red">
                <div class="legend-title">Ethnocentrics (Top-Right)</div>
                <div class="legend-desc">Cooperate with same color only. Form strong clusters.</div>
            </div>
            <div class="legend-item orange">
                <div class="legend-title">Cosmopolitans (Bottom-Left)</div>
                <div class="legend-desc">Cooperate with different colors only. Cannot cluster effectively.</div>
            </div>
            <div class="legend-item blue">
                <div class="legend-title">Egoists (Bottom-Right)</div>
                <div class="legend-desc">Never cooperate. Fail to reproduce without cooperation benefits.</div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        const GRID_SIZE = 70;
        const CELL_SIZE = canvas.width / GRID_SIZE;
        const COLORS = ['#4444ff', '#ff4444', '#44ff44', '#ffff44'];

        let grid = [];
        let running = false;

        class Agent {
            constructor(color, cooperateSame, cooperateDiff) {
                this.color = color;
                this.cooperateSame = cooperateSame;
                this.cooperateDiff = cooperateDiff;
                this.ptr = 0;
            }

            shouldCooperate(otherColor) {
                return (this.color === otherColor) ? this.cooperateSame : this.cooperateDiff;
            }

            clone() {
                return new Agent(this.color, this.cooperateSame, this.cooperateDiff);
            }
        }

        function initialize() {
            grid = [];
            const mid = GRID_SIZE / 2;

            for (let i = 0; i < GRID_SIZE; i++) {
                grid[i] = [];
                for (let j = 0; j < GRID_SIZE; j++) {
                    if (Math.random() < 0.6) {
                        let color = Math.floor(Math.random() * 4);
                        let cooperateSame, cooperateDiff;

                        // Quadrants: top-left = altruist, top-right = ethnocentric
                        // bottom-left = cosmopolitan, bottom-right = egoist
                        if (i < mid && j < mid) {
                            // Top-left: Altruists
                            cooperateSame = true;
                            cooperateDiff = true;
                        } else if (i >= mid && j < mid) {
                            // Top-right: Ethnocentrics
                            cooperateSame = true;
                            cooperateDiff = false;
                        } else if (i < mid && j >= mid) {
                            // Bottom-left: Cosmopolitans
                            cooperateSame = false;
                            cooperateDiff = true;
                        } else {
                            // Bottom-right: Egoists
                            cooperateSame = false;
                            cooperateDiff = false;
                        }

                        grid[i][j] = new Agent(color, cooperateSame, cooperateDiff);
                    } else {
                        grid[i][j] = null;
                    }
                }
            }
            draw();
        }

        function getNeighbors(x, y) {
            const neighbors = [];
            const directions = [[0, -1], [1, 0], [0, 1], [-1, 0]];
            for (const [dx, dy] of directions) {
                const nx = x + dx;
                const ny = y + dy;
                if (nx >= 0 && nx < GRID_SIZE && ny >= 0 && ny < GRID_SIZE) {
                    neighbors.push({x: nx, y: ny, agent: grid[nx][ny]});
                }
            }
            return neighbors;
        }

        function step() {
            for (let i = 0; i < GRID_SIZE; i++) {
                for (let j = 0; j < GRID_SIZE; j++) {
                    if (grid[i][j]) grid[i][j].ptr = 0;
                }
            }

            for (let i = 0; i < GRID_SIZE; i++) {
                for (let j = 0; j < GRID_SIZE; j++) {
                    const agent = grid[i][j];
                    if (!agent) continue;

                    const neighbors = getNeighbors(i, j);
                    for (const {agent: neighbor} of neighbors) {
                        if (!neighbor) continue;
                        if (agent.shouldCooperate(neighbor.color)) {
                            agent.ptr -= 0.1;
                            neighbor.ptr += 0.5;
                        }
                    }
                }
            }

            const newborns = [];
            for (let i = 0; i < GRID_SIZE; i++) {
                for (let j = 0; j < GRID_SIZE; j++) {
                    const agent = grid[i][j];
                    if (!agent || agent.ptr < 1.0) continue;

                    const neighbors = getNeighbors(i, j);
                    const emptyNeighbors = neighbors.filter(n => !n.agent);

                    if (emptyNeighbors.length > 0) {
                        const target = emptyNeighbors[Math.floor(Math.random() * emptyNeighbors.length)];
                        newborns.push({x: target.x, y: target.y, agent: agent.clone()});
                        agent.ptr -= 1.0;
                    }
                }
            }

            for (const {x, y, agent} of newborns) {
                grid[x][y] = agent;
            }

            for (let i = 0; i < GRID_SIZE; i++) {
                for (let j = 0; j < GRID_SIZE; j++) {
                    if (grid[i][j] && Math.random() < 0.01) {
                        grid[i][j] = null;
                    }
                }
            }

            draw();
        }

        function draw() {
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            for (let i = 0; i < GRID_SIZE; i++) {
                for (let j = 0; j < GRID_SIZE; j++) {
                    const agent = grid[i][j];
                    if (agent) {
                        ctx.fillStyle = COLORS[agent.color];
                        ctx.fillRect(i * CELL_SIZE, j * CELL_SIZE, CELL_SIZE, CELL_SIZE);
                    }
                }
            }

            // Draw quadrant dividers
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(canvas.width / 2, 0);
            ctx.lineTo(canvas.width / 2, canvas.height);
            ctx.moveTo(0, canvas.height / 2);
            ctx.lineTo(canvas.width, canvas.height / 2);
            ctx.stroke();
            ctx.setLineDash([]);
        }

        function animate() {
            if (running) {
                step();
                setTimeout(() => requestAnimationFrame(animate), 50);
            }
        }

        document.getElementById('startBtn').addEventListener('click', () => {
            running = true;
            animate();
        });

        document.getElementById('pauseBtn').addEventListener('click', () => {
            running = false;
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            running = false;
            initialize();
        });

        initialize();
    </script>
</body>
</html>
