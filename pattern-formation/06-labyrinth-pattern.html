<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Labyrinth Pattern - Gray-Scott</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; display: flex; justify-content: center; align-items: center; }
        canvas { display: block; border: 2px solid #667eea; }
        .info { position: absolute; top: 20px; left: 20px; background: rgba(0, 0, 0, 0.8); padding: 15px; border-radius: 8px; color: white; }
        .info h3 { margin: 0 0 10px 0; color: #667eea; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div class="info">
        <h3>Labyrinth/Maze Pattern</h3>
        <p>F = 0.029, k = 0.057</p>
    </div>
    <script>
        const canvas = document.getElementById('canvas');
        const gl = canvas.getContext('webgl2');
        const width = 512, height = 512;
        canvas.width = width; canvas.height = height;

        const vs = `#version 300 es
            in vec2 position;
            out vec2 uv;
            void main() { uv = position * 0.5 + 0.5; gl_Position = vec4(position, 0.0, 1.0); }`;

        const compute = `#version 300 es
            precision highp float;
            uniform sampler2D state;
            uniform vec2 resolution;
            in vec2 uv;
            out vec4 fragColor;
            void main() {
                vec2 pixel = 1.0 / resolution;
                vec2 state_c = texture(state, uv).xy;
                vec2 lap = vec2(0.0);
                lap += texture(state, uv + vec2(-pixel.x, 0.0)).xy * 0.2;
                lap += texture(state, uv + vec2(pixel.x, 0.0)).xy * 0.2;
                lap += texture(state, uv + vec2(0.0, -pixel.y)).xy * 0.2;
                lap += texture(state, uv + vec2(0.0, pixel.y)).xy * 0.2;
                lap += texture(state, uv + vec2(-pixel.x, -pixel.y)).xy * 0.05;
                lap += texture(state, uv + vec2(pixel.x, -pixel.y)).xy * 0.05;
                lap += texture(state, uv + vec2(-pixel.x, pixel.y)).xy * 0.05;
                lap += texture(state, uv + vec2(pixel.x, pixel.y)).xy * 0.05;
                lap -= state_c * 1.0;
                float a = state_c.x, b = state_c.y;
                float feed = 0.029, kill = 0.057;
                float abb = a * b * b;
                a += (1.0 * lap.x - abb + feed * (1.0 - a)) * 1.0;
                b += (0.5 * lap.y + abb - (kill + feed) * b) * 1.0;
                fragColor = vec4(a, b, 0.0, 1.0);
            }`;

        const display = `#version 300 es
            precision highp float;
            uniform sampler2D state;
            in vec2 uv;
            out vec4 fragColor;
            void main() {
                float b = texture(state, uv).y;
                vec3 color = mix(vec3(0.0, 0.05, 0.1), vec3(0.5, 1.0, 0.5), step(0.25, b));
                fragColor = vec4(color, 1.0);
            }`;

        function compileShader(type, src) {
            const s = gl.createShader(type);
            gl.shaderSource(s, src);
            gl.compileShader(s);
            return s;
        }

        function createProgram(vs, fs) {
            const p = gl.createProgram();
            gl.attachShader(p, compileShader(gl.VERTEX_SHADER, vs));
            gl.attachShader(p, compileShader(gl.FRAGMENT_SHADER, fs));
            gl.linkProgram(p);
            return p;
        }

        const computeProg = createProgram(vs, compute);
        const displayProg = createProgram(vs, display);

        const buf = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, buf);
        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1,-1,1,-1,-1,1,1,1]), gl.STATIC_DRAW);

        function createTex() {
            const t = gl.createTexture();
            gl.bindTexture(gl.TEXTURE_2D, t);
            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RG32F, width, height, 0, gl.RG, gl.FLOAT, null);
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);
            return t;
        }

        const tex = [createTex(), createTex()];
        const fb = [gl.createFramebuffer(), gl.createFramebuffer()];
        for (let i = 0; i < 2; i++) {
            gl.bindFramebuffer(gl.FRAMEBUFFER, fb[i]);
            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, tex[i], 0);
        }

        const data = new Float32Array(width * height * 2);
        for (let i = 0; i < width * height; i++) {
            data[i * 2] = 1.0;
            data[i * 2 + 1] = Math.random() < 0.3 ? Math.random() : 0.0;
        }
        gl.bindTexture(gl.TEXTURE_2D, tex[0]);
        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RG32F, width, height, 0, gl.RG, gl.FLOAT, data);

        let curr = 0;
        function render() {
            gl.useProgram(computeProg);
            gl.bindFramebuffer(gl.FRAMEBUFFER, fb[1 - curr]);
            gl.viewport(0, 0, width, height);
            const pos = gl.getAttribLocation(computeProg, 'position');
            gl.bindBuffer(gl.ARRAY_BUFFER, buf);
            gl.enableVertexAttribArray(pos);
            gl.vertexAttribPointer(pos, 2, gl.FLOAT, false, 0, 0);
            gl.activeTexture(gl.TEXTURE0);
            gl.bindTexture(gl.TEXTURE_2D, tex[curr]);
            gl.uniform1i(gl.getUniformLocation(computeProg, 'state'), 0);
            gl.uniform2f(gl.getUniformLocation(computeProg, 'resolution'), width, height);
            gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
            curr = 1 - curr;

            gl.useProgram(displayProg);
            gl.bindFramebuffer(gl.FRAMEBUFFER, null);
            const dpos = gl.getAttribLocation(displayProg, 'position');
            gl.bindBuffer(gl.ARRAY_BUFFER, buf);
            gl.enableVertexAttribArray(dpos);
            gl.vertexAttribPointer(dpos, 2, gl.FLOAT, false, 0, 0);
            gl.activeTexture(gl.TEXTURE0);
            gl.bindTexture(gl.TEXTURE_2D, tex[curr]);
            gl.uniform1i(gl.getUniformLocation(displayProg, 'state'), 0);
            gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
            requestAnimationFrame(render);
        }
        render();
    </script>
</body>
</html>
