<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>3D Height Map Visualization</title>
<style>body{margin:0;overflow:hidden;background:#000;display:flex;justify-content:center;align-items:center}canvas{display:block}.info{position:absolute;top:20px;left:20px;background:rgba(0,0,0,0.8);padding:15px;border-radius:8px;color:#fff}.info h3{margin:0 0 10px 0;color:#667eea}</style></head>
<body><canvas id="canvas"></canvas><div class="info"><h3>3D Height Map View</h3><p>Gray-Scott patterns in 3D</p></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
const canvas=document.getElementById('canvas');
const scene=new THREE.Scene();
const camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000);
const renderer=new THREE.WebGLRenderer({canvas});
renderer.setSize(window.innerWidth,window.innerHeight);
camera.position.set(0,50,80);camera.lookAt(0,0,0);
const w=64,h=64;
const geometry=new THREE.PlaneGeometry(100,100,w-1,h-1);
const material=new THREE.MeshPhongMaterial({color:0x667eea,wireframe:false,flatShading:true});
const plane=new THREE.Mesh(geometry,material);
plane.rotation.x=-Math.PI/2;
scene.add(plane);
const light=new THREE.DirectionalLight(0xffffff,1);
light.position.set(0,50,50);
scene.add(light);
scene.add(new THREE.AmbientLight(0x404040));
const offCanvas=document.createElement('canvas');
offCanvas.width=w;offCanvas.height=h;
const gl=offCanvas.getContext('webgl2');
const vs=`#version 300 es
in vec2 position;out vec2 uv;void main(){uv=position*0.5+0.5;gl_Position=vec4(position,0.0,1.0);}`;
const cs=`#version 300 es
precision highp float;uniform sampler2D state;uniform vec2 resolution;in vec2 uv;out vec4 fragColor;
void main(){vec2 p=1.0/resolution,s=texture(state,uv).xy;vec2 l=vec2(0.0);
l+=texture(state,uv+vec2(-p.x,0.0)).xy*0.2;l+=texture(state,uv+vec2(p.x,0.0)).xy*0.2;
l+=texture(state,uv+vec2(0.0,-p.y)).xy*0.2;l+=texture(state,uv+vec2(0.0,p.y)).xy*0.2;
l+=texture(state,uv+vec2(-p.x,-p.y)).xy*0.05;l+=texture(state,uv+vec2(p.x,-p.y)).xy*0.05;
l+=texture(state,uv+vec2(-p.x,p.y)).xy*0.05;l+=texture(state,uv+vec2(p.x,p.y)).xy*0.05;l-=s;
float a=s.x,b=s.y,f=0.055,k=0.062,abb=a*b*b;
a+=(1.0*l.x-abb+f*(1.0-a));b+=(0.5*l.y+abb-(k+f)*b);fragColor=vec4(a,b,0.0,1.0);}`;
function comp(t,s){const sh=gl.createShader(t);gl.shaderSource(sh,s);gl.compileShader(sh);return sh;}
function prog(v,f){const p=gl.createProgram();gl.attachShader(p,comp(gl.VERTEX_SHADER,v));gl.attachShader(p,comp(gl.FRAGMENT_SHADER,f));gl.linkProgram(p);return p;}
const cp=prog(vs,cs),buf=gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER,buf);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),gl.STATIC_DRAW);
function createT(){const t=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,t);gl.texImage2D(gl.TEXTURE_2D,0,gl.RG32F,w,h,0,gl.RG,gl.FLOAT,null);
gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);
gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.REPEAT);return t;}
const tex=[createT(),createT()],fb=[gl.createFramebuffer(),gl.createFramebuffer()];
for(let i=0;i<2;i++){gl.bindFramebuffer(gl.FRAMEBUFFER,fb[i]);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,tex[i],0);}
const data=new Float32Array(w*h*2);for(let i=0;i<w*h;i++){data[i*2]=1.0;data[i*2+1]=Math.random()<0.1?Math.random()*0.5:0.0;}
gl.bindTexture(gl.TEXTURE_2D,tex[0]);gl.texImage2D(gl.TEXTURE_2D,0,gl.RG32F,w,h,0,gl.RG,gl.FLOAT,data);
let curr=0;
function updateHeightMap(){
const readData=new Float32Array(w*h*4);
gl.readPixels(0,0,w,h,gl.RGBA,gl.FLOAT,readData);
const pos=geometry.attributes.position;
for(let i=0;i<w*h;i++){
pos.array[i*3+2]=readData[i*4+1]*20;
}
pos.needsUpdate=true;
}
function animate(){
for(let i=0;i<5;i++){
gl.useProgram(cp);gl.bindFramebuffer(gl.FRAMEBUFFER,fb[1-curr]);gl.viewport(0,0,w,h);
const pos=gl.getAttribLocation(cp,'position');gl.bindBuffer(gl.ARRAY_BUFFER,buf);gl.enableVertexAttribArray(pos);
gl.vertexAttribPointer(pos,2,gl.FLOAT,false,0,0);gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,tex[curr]);
gl.uniform1i(gl.getUniformLocation(cp,'state'),0);gl.uniform2f(gl.getUniformLocation(cp,'resolution'),w,h);
gl.drawArrays(gl.TRIANGLE_STRIP,0,4);curr=1-curr;
}
gl.bindFramebuffer(gl.FRAMEBUFFER,fb[curr]);
updateHeightMap();
plane.rotation.z+=0.005;
renderer.render(scene,camera);
requestAnimationFrame(animate);
}
animate();
</script></body></html>
