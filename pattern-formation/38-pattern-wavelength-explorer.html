<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pattern Wavelength Explorer</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; display: flex; flex-direction: column; align-items: center; font-family: Arial, sans-serif; }
        canvas { display: block; image-rendering: pixelated; }
        .controls { position: absolute; top: 20px; left: 20px; background: rgba(0,0,0,0.8); padding: 15px; border-radius: 8px; color: white; font-size: 14px; }
        .controls h3 { margin: 0 0 10px 0; }
        .control-group { margin: 8px 0; }
        label { display: inline-block; width: 120px; }
        input[type="range"] { width: 150px; }
        button { margin: 10px 5px 0 0; padding: 8px 15px; background: #667eea; border: none; border-radius: 4px; color: white; cursor: pointer; }
        button:hover { background: #764ba2; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div class="controls">
        <h3>Pattern Wavelength</h3>
        <div class="control-group">
            <label>Wavelength:</label>
            <input type="range" id="wavelength" min="0.1" max="3" step="0.1" value="1.0">
            <span id="waveVal">1.0</span>
        </div>
        <button onclick="reset()">Reset</button>
    </div>
    <script>
        const canvas = document.getElementById('canvas');
        const gl = canvas.getContext('webgl2');
        if (!gl) alert('WebGL 2 not supported');

        const width = 512, height = 512;
        canvas.width = width; canvas.height = height;

        const vertexShaderSource = `#version 300 es
            in vec2 position;
            out vec2 uv;
            void main() {
                uv = position * 0.5 + 0.5;
                gl_Position = vec4(position, 0.0, 1.0);
            }
        `;

        const computeShaderSource = `#version 300 es
            precision highp float;
            uniform sampler2D state;
            uniform vec2 resolution;
            uniform float wavelength;
            in vec2 uv;
            out vec4 fragColor;

            void main() {
                vec2 pixel = 1.0 / resolution;
                vec2 state_c = texture(state, uv).xy;

                // Variable scale Laplacian for wavelength control
                float scale = wavelength;
                vec2 lap = vec2(0.0);
                lap += texture(state, uv + vec2(-pixel.x * scale, 0.0)).xy * 0.2;
                lap += texture(state, uv + vec2(pixel.x * scale, 0.0)).xy * 0.2;
                lap += texture(state, uv + vec2(0.0, -pixel.y * scale)).xy * 0.2;
                lap += texture(state, uv + vec2(0.0, pixel.y * scale)).xy * 0.2;
                lap += texture(state, uv + vec2(-pixel.x * scale, -pixel.y * scale)).xy * 0.05;
                lap += texture(state, uv + vec2(pixel.x * scale, -pixel.y * scale)).xy * 0.05;
                lap += texture(state, uv + vec2(-pixel.x * scale, pixel.y * scale)).xy * 0.05;
                lap += texture(state, uv + vec2(pixel.x * scale, pixel.y * scale)).xy * 0.05;
                lap -= state_c;

                float u = state_c.x;
                float v = state_c.y;

                float du = 1.0 * lap.x + u * (1.0 - u * u) - v;
                float dv = 0.5 * lap.y + u - v * 0.7;

                u += du * 0.3;
                v += dv * 0.3;

                fragColor = vec4(clamp(u, -1.0, 1.0), clamp(v, -1.0, 1.0), 0.0, 1.0);
            }
        `;

        const displayShaderSource = `#version 300 es
            precision highp float;
            uniform sampler2D state;
            in vec2 uv;
            out vec4 fragColor;

            void main() {
                float v = texture(state, uv).y;
                vec3 color = vec3(
                    0.5 + 0.5 * cos(v * 3.14 + 0.0),
                    0.5 + 0.5 * cos(v * 3.14 + 2.0),
                    0.5 + 0.5 * cos(v * 3.14 + 4.0)
                );
                fragColor = vec4(color, 1.0);
            }
        `;

        function compileShader(type, source) {
            const shader = gl.createShader(type);
            gl.shaderSource(shader, source);
            gl.compileShader(shader);
            return shader;
        }

        function createProgram(vertSource, fragSource) {
            const program = gl.createProgram();
            gl.attachShader(program, compileShader(gl.VERTEX_SHADER, vertSource));
            gl.attachShader(program, compileShader(gl.FRAGMENT_SHADER, fragSource));
            gl.linkProgram(program);
            return program;
        }

        const computeProgram = createProgram(vertexShaderSource, computeShaderSource);
        const displayProgram = createProgram(vertexShaderSource, displayShaderSource);

        const positions = new Float32Array([-1, -1, 1, -1, -1, 1, 1, 1]);
        const positionBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
        gl.bufferData(gl.ARRAY_BUFFER, positions, gl.STATIC_DRAW);

        function createTexture() {
            const texture = gl.createTexture();
            gl.bindTexture(gl.TEXTURE_2D, texture);
            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RG32F, width, height, 0, gl.RG, gl.FLOAT, null);
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);
            return texture;
        }

        const textures = [createTexture(), createTexture()];
        const framebuffers = [gl.createFramebuffer(), gl.createFramebuffer()];

        for (let i = 0; i < 2; i++) {
            gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffers[i]);
            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, textures[i], 0);
        }

        function initializeState() {
            const data = new Float32Array(width * height * 2);
            for (let i = 0; i < width * height; i++) {
                data[i * 2] = (Math.random() - 0.5) * 0.2;
                data[i * 2 + 1] = (Math.random() - 0.5) * 0.2;
            }
            gl.bindTexture(gl.TEXTURE_2D, textures[0]);
            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RG32F, width, height, 0, gl.RG, gl.FLOAT, data);
        }

        function reset() { initializeState(); }
        initializeState();

        const wavelengthSlider = document.getElementById('wavelength');
        wavelengthSlider.oninput = () => document.getElementById('waveVal').textContent = wavelengthSlider.value;

        let currentBuffer = 0;

        function render() {
            gl.useProgram(computeProgram);
            gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffers[1 - currentBuffer]);
            gl.viewport(0, 0, width, height);

            const posLoc = gl.getAttribLocation(computeProgram, 'position');
            gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
            gl.enableVertexAttribArray(posLoc);
            gl.vertexAttribPointer(posLoc, 2, gl.FLOAT, false, 0, 0);

            gl.activeTexture(gl.TEXTURE0);
            gl.bindTexture(gl.TEXTURE_2D, textures[currentBuffer]);
            gl.uniform1i(gl.getUniformLocation(computeProgram, 'state'), 0);
            gl.uniform2f(gl.getUniformLocation(computeProgram, 'resolution'), width, height);
            gl.uniform1f(gl.getUniformLocation(computeProgram, 'wavelength'), parseFloat(wavelengthSlider.value));

            gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
            currentBuffer = 1 - currentBuffer;

            gl.useProgram(displayProgram);
            gl.bindFramebuffer(gl.FRAMEBUFFER, null);

            const displayPosLoc = gl.getAttribLocation(displayProgram, 'position');
            gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
            gl.enableVertexAttribArray(displayPosLoc);
            gl.vertexAttribPointer(displayPosLoc, 2, gl.FLOAT, false, 0, 0);

            gl.activeTexture(gl.TEXTURE0);
            gl.bindTexture(gl.TEXTURE_2D, textures[currentBuffer]);
            gl.uniform1i(gl.getUniformLocation(displayProgram, 'state'), 0);

            gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
            requestAnimationFrame(render);
        }

        render();
    </script>
</body>
</html>