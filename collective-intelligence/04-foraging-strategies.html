<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foraging Strategies Comparison</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0a0e1a; overflow: hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        canvas { display: block; }
        .back-link {
            position: fixed; top: 20px; left: 20px; z-index: 100;
            color: #8A9A5B; background: rgba(10,14,26,0.8); border-radius: 25px;
            border: 2px solid #8A9A5B; padding: 10px 20px; text-decoration: none;
            font-size: 14px; transition: all 0.3s ease;
        }
        .back-link:hover { background: rgba(138,154,91,0.3); }
        .controls {
            position: fixed; top: 20px; right: 20px; z-index: 100;
            background: rgba(10,14,26,0.85); backdrop-filter: blur(10px);
            border-radius: 10px; padding: 20px; max-width: 300px;
            color: #c0c8e0; font-size: 13px;
        }
        .controls h3 { color: #8A9A5B; margin-bottom: 12px; font-size: 15px; }
        .control-group { margin-bottom: 10px; }
        .control-group label { display: block; margin-bottom: 4px; color: #9aa0b8; }
        .control-group input[type="range"] { width: 100%; accent-color: #8A9A5B; }
        .control-group .value { float: right; color: #8A9A5B; font-weight: bold; }
        .score-row { display: flex; justify-content: space-between; align-items: center; padding: 6px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .score-label { display: flex; align-items: center; gap: 6px; }
        .score-dot { width: 10px; height: 10px; border-radius: 50%; }
        .score-val { font-weight: bold; font-size: 16px; }
        .scores { margin-top: 10px; padding: 10px; background: rgba(138,154,91,0.1); border-radius: 6px; }
        .scores h4 { color: #9aa0b8; margin-bottom: 6px; font-size: 11px; }
        .btn { background: rgba(138,154,91,0.2); color: #8A9A5B; border: 1px solid #8A9A5B;
            padding: 6px 14px; border-radius: 6px; cursor: pointer; font-size: 12px; margin-top: 8px; }
        .btn:hover { background: rgba(138,154,91,0.4); }
        .graph-container { margin-top: 10px; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 8px; }
        .graph-container canvas { width: 100%; height: 80px; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">&#8592; Collective Intelligence</a>
    <div class="controls">
        <h3>Foraging Strategies</h3>
        <div class="control-group">
            <label>Food Items <span class="value" id="foodVal">40</span></label>
            <input type="range" id="foodCount" min="15" max="80" value="40" step="5">
        </div>
        <div class="control-group">
            <label>Agents per Group <span class="value" id="agentVal">15</span></label>
            <input type="range" id="agentCount" min="5" max="30" value="15" step="1">
        </div>
        <div class="control-group">
            <label>Levy Exponent <span class="value" id="levyVal">1.5</span></label>
            <input type="range" id="levyExp" min="1.1" max="2.5" value="1.5" step="0.1">
        </div>
        <div class="control-group">
            <label>Pheromone Strength <span class="value" id="pheroVal">1.0</span></label>
            <input type="range" id="pheroStr" min="0.2" max="3.0" value="1.0" step="0.1">
        </div>
        <button class="btn" id="resetBtn">Reset</button>
        <div class="scores">
            <h4>FOOD COLLECTED</h4>
            <div class="score-row">
                <div class="score-label"><div class="score-dot" style="background:#ff4060"></div> Random Walk</div>
                <div class="score-val" id="scoreRandom" style="color:#ff4060">0</div>
            </div>
            <div class="score-row">
                <div class="score-label"><div class="score-dot" style="background:#4080ff"></div> Levy Flight</div>
                <div class="score-val" id="scoreLevy" style="color:#4080ff">0</div>
            </div>
            <div class="score-row">
                <div class="score-label"><div class="score-dot" style="background:#40dd60"></div> Pheromone</div>
                <div class="score-val" id="scorePhero" style="color:#40dd60">0</div>
            </div>
        </div>
        <div class="graph-container">
            <canvas id="graph" width="260" height="80"></canvas>
        </div>
    </div>
    <canvas id="canvas"></canvas>

    <script>
    (function() {
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const graphCanvas = document.getElementById('graph');
        const gCtx = graphCanvas.getContext('2d');
        let W, H;

        function resize() {
            W = canvas.width = window.innerWidth;
            H = canvas.height = window.innerHeight;
        }
        resize();

        let food = [];
        let agents = { random: [], levy: [], phero: [] };
        let scores = { random: 0, levy: 0, phero: 0 };
        let scoreHistory = { random: [], levy: [], phero: [] };
        let pheroGrid;
        let paused = false;

        const PHERO_CELL = 8;
        let pheroCols, pheroRows;

        function initPheroGrid() {
            pheroCols = Math.ceil(W / PHERO_CELL);
            pheroRows = Math.ceil(H / PHERO_CELL);
            pheroGrid = new Float32Array(pheroCols * pheroRows);
        }

        function placeFood() {
            const count = parseInt(document.getElementById('foodCount').value);
            food = [];
            // Mix of clustered and scattered food
            const clusters = 3 + Math.floor(Math.random() * 3);
            const perCluster = Math.floor(count * 0.6 / clusters);
            const scattered = count - perCluster * clusters;

            // Clustered food
            for (let c = 0; c < clusters; c++) {
                const cx = 100 + Math.random() * (W - 200);
                const cy = 100 + Math.random() * (H - 200);
                const spread = 30 + Math.random() * 40;
                for (let i = 0; i < perCluster; i++) {
                    food.push({
                        x: cx + (Math.random() - 0.5) * spread * 2,
                        y: cy + (Math.random() - 0.5) * spread * 2,
                        alive: true,
                        radius: 5
                    });
                }
            }

            // Scattered food
            for (let i = 0; i < scattered; i++) {
                food.push({
                    x: 50 + Math.random() * (W - 100),
                    y: 50 + Math.random() * (H - 100),
                    alive: true,
                    radius: 5
                });
            }
        }

        function levyStep(exponent) {
            // Inverse CDF method for Levy distribution
            const u = Math.random();
            return Math.pow(1 - u, -1 / (exponent - 1));
        }

        class Agent {
            constructor(type) {
                this.type = type;
                this.x = W / 2 + (Math.random() - 0.5) * 100;
                this.y = H / 2 + (Math.random() - 0.5) * 100;
                this.angle = Math.random() * Math.PI * 2;
                this.speed = 2;
                this.stepsRemaining = 0;
                this.stepLength = 0;
            }
        }

        function initAgents() {
            const count = parseInt(document.getElementById('agentCount').value);
            agents = { random: [], levy: [], phero: [] };
            for (let i = 0; i < count; i++) {
                agents.random.push(new Agent('random'));
                agents.levy.push(new Agent('levy'));
                agents.phero.push(new Agent('phero'));
            }
            scores = { random: 0, levy: 0, phero: 0 };
            scoreHistory = { random: [], levy: [], phero: [] };
        }

        function depositPhero(x, y, amount) {
            const gx = Math.floor(x / PHERO_CELL);
            const gy = Math.floor(y / PHERO_CELL);
            if (gx >= 0 && gx < pheroCols && gy >= 0 && gy < pheroRows) {
                pheroGrid[gy * pheroCols + gx] = Math.min(pheroGrid[gy * pheroCols + gx] + amount, 5);
            }
        }

        function getPhero(x, y) {
            const gx = Math.floor(x / PHERO_CELL);
            const gy = Math.floor(y / PHERO_CELL);
            if (gx >= 0 && gx < pheroCols && gy >= 0 && gy < pheroRows) {
                return pheroGrid[gy * pheroCols + gx];
            }
            return 0;
        }

        function moveRandom(a) {
            a.angle += (Math.random() - 0.5) * 1.0;
            a.x += Math.cos(a.angle) * a.speed;
            a.y += Math.sin(a.angle) * a.speed;
        }

        function moveLevy(a) {
            if (a.stepsRemaining <= 0) {
                a.angle = Math.random() * Math.PI * 2;
                const exp = parseFloat(document.getElementById('levyExp').value);
                a.stepLength = Math.min(levyStep(exp) * 3, 150);
                a.stepsRemaining = Math.ceil(a.stepLength / a.speed);
            }
            a.x += Math.cos(a.angle) * a.speed;
            a.y += Math.sin(a.angle) * a.speed;
            a.stepsRemaining--;
        }

        function movePhero(a) {
            const str = parseFloat(document.getElementById('pheroStr').value);
            // Sense pheromone in 3 directions
            const senseDist = 20;
            const senseAngle = 0.5;

            const leftP = getPhero(a.x + Math.cos(a.angle - senseAngle) * senseDist,
                                   a.y + Math.sin(a.angle - senseAngle) * senseDist);
            const fwdP = getPhero(a.x + Math.cos(a.angle) * senseDist,
                                  a.y + Math.sin(a.angle) * senseDist);
            const rightP = getPhero(a.x + Math.cos(a.angle + senseAngle) * senseDist,
                                    a.y + Math.sin(a.angle + senseAngle) * senseDist);

            if (leftP > fwdP && leftP > rightP) a.angle -= 0.2;
            else if (rightP > fwdP && rightP > leftP) a.angle += 0.2;

            a.angle += (Math.random() - 0.5) * 0.8;
            a.x += Math.cos(a.angle) * a.speed;
            a.y += Math.sin(a.angle) * a.speed;
        }

        function wrap(a) {
            if (a.x < 0) a.x += W;
            if (a.x >= W) a.x -= W;
            if (a.y < 0) a.y += H;
            if (a.y >= H) a.y -= H;
        }

        function checkFood(a, type) {
            for (let i = 0; i < food.length; i++) {
                const f = food[i];
                if (!f.alive) continue;
                const dx = a.x - f.x;
                const dy = a.y - f.y;
                if (dx * dx + dy * dy < (f.radius + 5) * (f.radius + 5)) {
                    f.alive = false;
                    scores[type]++;
                    // Pheromone agents deposit trail when finding food
                    if (type === 'phero') {
                        const str = parseFloat(document.getElementById('pheroStr').value);
                        depositPhero(a.x, a.y, str * 2);
                    }
                    return;
                }
            }
        }

        let frame = 0;

        function update() {
            const allTypes = ['random', 'levy', 'phero'];
            for (const type of allTypes) {
                for (const a of agents[type]) {
                    if (type === 'random') moveRandom(a);
                    else if (type === 'levy') moveLevy(a);
                    else movePhero(a);
                    wrap(a);
                    checkFood(a, type);
                }
            }

            // Pheromone agents deposit light trail
            const str = parseFloat(document.getElementById('pheroStr').value);
            for (const a of agents.phero) {
                depositPhero(a.x, a.y, str * 0.01);
            }

            // Evaporate pheromone
            for (let i = 0; i < pheroGrid.length; i++) {
                pheroGrid[i] *= 0.995;
                if (pheroGrid[i] < 0.001) pheroGrid[i] = 0;
            }

            // Respawn food periodically if running low
            const aliveCount = food.filter(f => f.alive).length;
            if (aliveCount < 5 && frame % 60 === 0) {
                for (let i = 0; i < food.length; i++) {
                    if (!food[i].alive && Math.random() < 0.3) {
                        food[i].alive = true;
                        food[i].x = 50 + Math.random() * (W - 100);
                        food[i].y = 50 + Math.random() * (H - 100);
                    }
                }
            }

            // Record score history
            if (frame % 10 === 0) {
                scoreHistory.random.push(scores.random);
                scoreHistory.levy.push(scores.levy);
                scoreHistory.phero.push(scores.phero);
                if (scoreHistory.random.length > 200) {
                    scoreHistory.random.shift();
                    scoreHistory.levy.shift();
                    scoreHistory.phero.shift();
                }
            }
        }

        function draw() {
            ctx.fillStyle = '#0a0e1a';
            ctx.fillRect(0, 0, W, H);

            // Subtle pheromone glow
            for (let gy = 0; gy < pheroRows; gy++) {
                for (let gx = 0; gx < pheroCols; gx++) {
                    const p = pheroGrid[gy * pheroCols + gx];
                    if (p < 0.02) continue;
                    const brightness = Math.min(p / 2, 1);
                    ctx.fillStyle = `rgba(64, 221, 96, ${brightness * 0.15})`;
                    ctx.fillRect(gx * PHERO_CELL, gy * PHERO_CELL, PHERO_CELL, PHERO_CELL);
                }
            }

            // Food
            for (const f of food) {
                if (!f.alive) continue;
                ctx.save();
                ctx.shadowColor = '#DDA15E';
                ctx.shadowBlur = 8;
                ctx.beginPath();
                ctx.arc(f.x, f.y, f.radius, 0, Math.PI * 2);
                ctx.fillStyle = '#DDA15E';
                ctx.fill();
                ctx.restore();
            }

            // Agents
            const colors = { random: '#ff4060', levy: '#4080ff', phero: '#40dd60' };
            for (const type of ['random', 'levy', 'phero']) {
                ctx.fillStyle = colors[type];
                for (const a of agents[type]) {
                    ctx.beginPath();
                    ctx.arc(a.x, a.y, 3, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            // Legend in bottom-left
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'left';
            const legendY = H - 80;
            const legendItems = [
                { color: '#ff4060', label: 'Random Walk (Brownian)' },
                { color: '#4080ff', label: 'Levy Flight' },
                { color: '#40dd60', label: 'Pheromone-Guided' }
            ];
            ctx.fillStyle = 'rgba(10,14,26,0.7)';
            ctx.fillRect(15, legendY - 10, 200, 70);
            for (let i = 0; i < legendItems.length; i++) {
                ctx.fillStyle = legendItems[i].color;
                ctx.beginPath();
                ctx.arc(30, legendY + 10 + i * 20, 5, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#c0c8e0';
                ctx.fillText(legendItems[i].label, 42, legendY + 14 + i * 20);
            }

            // Scores
            document.getElementById('scoreRandom').textContent = scores.random;
            document.getElementById('scoreLevy').textContent = scores.levy;
            document.getElementById('scorePhero').textContent = scores.phero;
        }

        function drawGraph() {
            const gW = graphCanvas.width;
            const gH = graphCanvas.height;
            gCtx.fillStyle = 'rgba(0,0,0,0.3)';
            gCtx.fillRect(0, 0, gW, gH);

            if (scoreHistory.random.length < 2) return;

            const maxScore = Math.max(
                scores.random, scores.levy, scores.phero, 1
            );

            const colors = { random: '#ff4060', levy: '#4080ff', phero: '#40dd60' };
            for (const type of ['random', 'levy', 'phero']) {
                const hist = scoreHistory[type];
                gCtx.beginPath();
                gCtx.strokeStyle = colors[type];
                gCtx.lineWidth = 1.5;
                for (let i = 0; i < hist.length; i++) {
                    const x = (i / (hist.length - 1)) * gW;
                    const y = gH - (hist[i] / maxScore) * (gH - 4) - 2;
                    if (i === 0) gCtx.moveTo(x, y);
                    else gCtx.lineTo(x, y);
                }
                gCtx.stroke();
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            if (paused) return;

            frame++;
            update();
            draw();
            if (frame % 10 === 0) drawGraph();
        }

        function fullReset() {
            initPheroGrid();
            placeFood();
            initAgents();
            frame = 0;
        }

        fullReset();
        animate();

        // Controls
        document.getElementById('foodCount').oninput = function() {
            document.getElementById('foodVal').textContent = this.value;
        };
        document.getElementById('agentCount').oninput = function() {
            document.getElementById('agentVal').textContent = this.value;
        };
        document.getElementById('levyExp').oninput = function() {
            document.getElementById('levyVal').textContent = parseFloat(this.value).toFixed(1);
        };
        document.getElementById('pheroStr').oninput = function() {
            document.getElementById('pheroVal').textContent = parseFloat(this.value).toFixed(1);
        };

        document.getElementById('resetBtn').onclick = fullReset;
        window.reset = fullReset;

        window.addEventListener('resize', function() {
            resize();
            fullReset();
        });

        window.addEventListener('keydown', function(e) {
            if (e.code === 'Space' && e.target === document.body) {
                paused = !paused;
            }
        });
    })();
    </script>
    <script src="../assets/js/enhance.js"></script>
</body>
</html>
