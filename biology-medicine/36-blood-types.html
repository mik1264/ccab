<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blood Type Compatibility - CCAB</title>
    <link rel="stylesheet" href="../assets/css/gallery-standard.css">
    <style>
        body {
            background: #fff;
            color: #333;
            font-family: system-ui;
            padding: 2rem;
            text-align: center;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        
        .lab-bench {
            display: flex;
            justify-content: center;
            gap: 50px;
            margin: 30px 0;
        }
        
        .vial {
            width: 100px;
            height: 150px;
            border: 2px solid #ccc;
            border-radius: 0 0 20px 20px;
            position: relative;
            background: rgba(255, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .blood {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 80%;
            background: #ef4444;
            transition: background 0.5s;
        }
        
        .controls {
            background: #f3f4f6;
            padding: 20px;
            border-radius: 8px;
            display: inline-flex;
            gap: 20px;
        }
        
        select { padding: 8px; font-size: 1.1rem; }
        
        #result {
            font-size: 2rem;
            font-weight: bold;
            margin-top: 20px;
            height: 50px;
        }
        
        .microscope-view {
            width: 300px;
            height: 300px;
            border: 10px solid #333;
            border-radius: 50%;
            margin: 20px auto;
            position: relative;
            background: #fff;
            overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
        }
        
        .cell {
            position: absolute;
            width: 40px;
            height: 40px;
            background: #ef4444;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.8rem;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
            transition: all 0.5s;
        }
        
        .cell.clumped {
            transform: scale(0.8);
            margin: -10px; /* Overlap */
        }
        
        .shape-a { border: 2px solid blue; } /* Antigen A visual */
        .shape-b { border: 2px solid yellow; } /* Antigen B visual */
        
    </style>
</head>
<body>

<div class="container">
    <a href="../index.html" class="gallery-back">← Back to Gallery</a>
    <h1>Blood Type Compatibility</h1>
    
    <div class="controls">
        <div>
            <label>Recipient:</label>
            <select id="recipient">
                <option value="A+">A+</option>
                <option value="A-">A-</option>
                <option value="B+">B+</option>
                <option value="B-">B-</option>
                <option value="AB+">AB+</option>
                <option value="AB-">AB-</option>
                <option value="O+">O+</option>
                <option value="O-">O-</option>
            </select>
        </div>
        
        <div>
            <label>Donor:</label>
            <select id="donor">
                <option value="A+">A+</option>
                <option value="A-">A-</option>
                <option value="B+">B+</option>
                <option value="B-">B-</option>
                <option value="AB+">AB+</option>
                <option value="AB-">AB-</option>
                <option value="O+">O+</option>
                <option value="O-">O-</option>
            </select>
        </div>
        
        <button onclick="check()">Transfuse</button>
    </div>
    
    <div id="result"></div>
    
    <div class="microscope-view" id="microscope">
        <!-- Cells injected here -->
    </div>
</div>

<script>
    function check() {
        const rType = document.getElementById('recipient').value;
        const dType = document.getElementById('donor').value;
        
        const rAntigens = getAntigens(rType);
        const rAntibodies = getAntibodies(rType);
        const dAntigens = getAntigens(dType);
        
        // Check Agglutination
        // If Donor has an antigen that Recipient has an antibody for -> BAD
        
        let compatible = true;
        if (dAntigens.A && rAntibodies.antiA) compatible = false;
        if (dAntigens.B && rAntibodies.antiB) compatible = false;
        if (dAntigens.Rh && rAntibodies.antiRh) compatible = false;
        
        const resDiv = document.getElementById('result');
        if (compatible) {
            resDiv.textContent = "Compatible ✓";
            resDiv.style.color = "#10b981";
            renderCells(false, dType);
        } else {
            resDiv.textContent = "Incompatible (Agglutination) ✗";
            resDiv.style.color = "#ef4444";
            renderCells(true, dType);
        }
    }
    
    function getAntigens(type) {
        const hasA = type.includes('A');
        const hasB = type.includes('B');
        const hasRh = type.includes('+');
        return { A: hasA, B: hasB, Rh: hasRh };
    }
    
    function getAntibodies(type) {
        const hasA = type.includes('A');
        const hasB = type.includes('B');
        const hasRh = type.includes('+');
        
        // If you don't have the antigen, you have the antibody
        // Note: Rh antibody usually requires sensitization, but for compatibility check we assume risk
        return {
            antiA: !hasA,
            antiB: !hasB,
            antiRh: !hasRh
        };
    }
    
    function renderCells(clump, type) {
        const container = document.getElementById('microscope');
        container.innerHTML = '';
        
        // Center for clump
        const cx = 150 - 20;
        const cy = 150 - 20;
        
        for (let i=0; i<15; i++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.textContent = type;
            
            if (clump) {
                // Cluster in center
                const angle = Math.random() * Math.PI * 2;
                const r = Math.random() * 40;
                cell.style.left = (cx + Math.cos(angle)*r) + 'px';
                cell.style.top = (cy + Math.sin(angle)*r) + 'px';
                cell.classList.add('clumped');
            } else {
                // Free floating
                cell.style.left = (Math.random() * 260) + 'px';
                cell.style.top = (Math.random() * 260) + 'px';
            }
            
            container.appendChild(cell);
        }
    }
    
    check(); // init

</script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
