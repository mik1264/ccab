<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muscle Contraction - CCAB</title>
    <link rel="stylesheet" href="../assets/css/gallery-standard.css">
    <style>
        body {
            background: #fdf2f8;
            color: #333;
            font-family: system-ui;
            padding: 2rem;
            text-align: center;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        
        canvas {
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .controls {
            margin: 20px;
        }
        
        button {
            padding: 10px 20px;
            background: #db2777; /* Pink */
            color: white;
            border: none;
            border-radius: 4px;
            font-weight: bold;
            font-size: 1.2rem;
            cursor: pointer;
        }
        button:active { background: #be185d; transform: scale(0.98); }
        
        .meter {
            width: 300px;
            height: 20px;
            background: #ddd;
            margin: 10px auto;
            border-radius: 10px;
            overflow: hidden;
        }
        .bar {
            height: 100%;
            background: #db2777;
            width: 0%;
            transition: width 0.1s;
        }
    </style>
</head>
<body>

<div class="container">
    <a href="../index.html" class="gallery-back">‚Üê Back to Gallery</a>
    <h1>Sliding Filament Theory</h1>
    <p>Muscle contraction driven by Actin-Myosin interaction and ATP.</p>
    
    <div class="meter"><div class="bar" id="ca-bar"></div></div>
    <div>Calcium Level (Ca2+)</div>
    
    <canvas id="canvas" width="800" height="400"></canvas>
    
    <div class="controls">
        <button onmousedown="contract()" onmouseup="relax()" onmouseleave="relax()">Contract (Hold)</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    // State
    let contraction = 0; // 0 to 100%
    let target = 0;
    let cyclePhase = 0; // 0 to 2PI for head cycling
    
    // Sarcomere Geometry
    const Z_LINE_X = 100;
    const Z_LINE_W = 10;
    const ACTIN_LEN = 300;
    const MYOSIN_LEN = 300;
    const MYOSIN_X = 400; // Center
    
    function contract() { target = 100; }
    function relax() { target = 0; }
    
    function loop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Physics
        // Calcium rises fast, decays slow
        if (target > contraction) contraction += 5;
        else contraction -= 2;
        
        if (contraction < 0) contraction = 0;
        if (contraction > 100) contraction = 100;
        
        document.getElementById('ca-bar').style.width = contraction + '%';
        
        // Heads cycle if Ca present
        if (contraction > 10) {
            cyclePhase += 0.2;
        }
        
        // Draw Sarcomere
        // Scale factor: 100% contraction = overlap increases
        const shift = contraction * 1.5; // Pixels to move Z-lines in
        
        const zLeft = Z_LINE_X + shift;
        const zRight = 800 - Z_LINE_X - shift;
        
        // Z-Lines
        ctx.fillStyle = '#333';
        ctx.fillRect(zLeft - 5, 50, 10, 300);
        ctx.fillRect(zRight - 5, 50, 10, 300);
        
        // Actin (Thin Filaments) attached to Z-lines
        ctx.fillStyle = '#3b82f6';
        // Top Left
        ctx.fillRect(zLeft, 100, ACTIN_LEN, 5);
        // Bot Left
        ctx.fillRect(zLeft, 300, ACTIN_LEN, 5);
        // Top Right
        ctx.fillRect(zRight - ACTIN_LEN, 100, ACTIN_LEN, 5);
        // Bot Right
        ctx.fillRect(zRight - ACTIN_LEN, 300, ACTIN_LEN, 5);
        
        // Myosin (Thick Filament) in Center
        ctx.fillStyle = '#db2777';
        ctx.fillRect(MYOSIN_X - MYOSIN_LEN/2, 180, MYOSIN_LEN, 40);
        
        // Myosin Heads
        const heads = 10;
        for (let i=0; i<heads; i++) {
            const x = (MYOSIN_X - MYOSIN_LEN/2) + (i / (heads-1)) * MYOSIN_LEN;
            
            // Top heads reach up to y=100
            // Bot heads reach down to y=300
            
            // Cycle logic:
            // Phase 0: Detached
            // Phase 1: Attach (Cocked)
            // Phase 2: Power Stroke (Pull)
            // Phase 3: Detach
            
            // Stagger phases
            const phi = cyclePhase + i;
            const state = Math.sin(phi); // -1 to 1
            
            // Head Y position
            let headY = 180;
            let targetY = 105; // Actin y
            let reach = 0;
            
            if (state > 0) { // Attaching/Pulling
                reach = state * (180 - targetY);
            }
            
            // Head Angle (Power Stroke)
            let angle = 0;
            if (state > 0.5) angle = -Math.PI / 4; // Pulling back
            else angle = Math.PI / 4; // Reaching forward
            
            drawHead(ctx, x, 180, angle, reach, -1); // Top
            drawHead(ctx, x, 220, -angle, reach, 1); // Bot
        }
        
        requestAnimationFrame(loop);
    }
    
    function drawHead(ctx, x, y, angle, reach, dir) {
        ctx.save();
        ctx.translate(x, y);
        // Neck
        ctx.rotate(angle);
        ctx.fillStyle = '#db2777';
        ctx.fillRect(-2, 0, 4, reach * dir); // dir 1 = down, -1 = up
        
        // Head bulb
        ctx.beginPath();
        ctx.arc(0, reach * dir, 8, 0, Math.PI*2);
        ctx.fill();
        
        ctx.restore();
    }
    
    requestAnimationFrame(loop);

</script>
</body>
</html>
