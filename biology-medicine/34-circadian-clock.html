<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Circadian Rhythm Clock - CCAB</title>
    <link rel="stylesheet" href="../assets/css/gallery-standard.css">
    <style>
        body {
            background: #111827;
            color: #eee;
            font-family: system-ui;
            padding: 2rem;
            text-align: center;
            transition: background 1s;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        
        canvas {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        
        .controls {
            margin: 20px;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            display: inline-block;
        }
        
        .clock-face {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 100px;
            height: 100px;
            border: 4px solid #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            background: rgba(0,0,0,0.5);
        }
        
    </style>
</head>
<body>

<div class="container">
    <a href="../index.html" class="gallery-back">‚Üê Back to Gallery</a>
    <h1>Circadian Molecular Clock</h1>
    <p>Negative feedback loop driving the 24-hour cycle. <br> CLOCK/BMAL1 activates PER/CRY. PER/CRY accumulates and inhibits CLOCK/BMAL1.</p>
    
    <div class="clock-face" id="clock">12:00</div>
    
    <canvas id="canvas" width="800" height="400"></canvas>
    
    <div class="controls">
        <button onclick="speed = 0">Pause</button>
        <button onclick="speed = 0.5">Slow</button>
        <button onclick="speed = 2">Fast</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    // Simulation Variables
    // A = Activator (CLOCK/BMAL1) - Constitutive but inhibited by R
    // R = Repressor (PER/CRY) - Produced by A, degrades over time
    
    let A = 1.0; 
    let R = 0.0;
    let R_mRNA = 0.0;
    
    let time = 12 * 60; // Start at noon (minutes)
    let speed = 1.0;
    
    const history = [];
    const MAX_HISTORY = 800;
    
    function loop() {
        // Physics (Euler integration of simple ODEs)
        // dA/dt = 0 (Constant protein level, activity regulated by binding)
        // Actually A is activity. Activity = TotalA / (1 + k*R)
        
        // d(mRNA)/dt = k1 * Activity - d1 * mRNA
        // dR/dt = k2 * mRNA - d2 * R
        
        // Constants (Tuned for ~24h period)
        const activity = 1.0 / (1 + Math.pow(R/2, 4)); // Hill function for inhibition
        
        R_mRNA += (0.1 * activity - 0.02 * R_mRNA) * speed;
        R += (0.05 * R_mRNA - 0.01 * R) * speed;
        
        // Time
        time += speed * 5; // 5 simulated minutes per frame
        const dayTime = (time % (24 * 60));
        
        // UI Updates
        updateClock(dayTime);
        updateBackground(dayTime);
        
        // History
        history.push({
            mrna: R_mRNA,
            prot: R,
            act: activity
        });
        if (history.length > MAX_HISTORY) history.shift();
        
        drawGraph();
        
        requestAnimationFrame(loop);
    }
    
    function updateClock(mins) {
        const h = Math.floor(mins / 60);
        const m = Math.floor(mins % 60);
        document.getElementById('clock').textContent = 
            `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}`;
    }
    
    function updateBackground(mins) {
        // Day 6:00 - 18:00
        // Peak brightness at 12:00
        
        // Normalized 0-1 cycle
        // Noon = 0.5, Midnight = 0 or 1
        const t = mins / (24 * 60);
        
        // Sun cycle approx sin wave
        const brightness = Math.max(0.1, Math.sin((t - 0.25) * Math.PI * 2)); // Peak at 0.5 (12:00)
        
        // Sky color
        const r = Math.floor(10 + brightness * 50);
        const g = Math.floor(20 + brightness * 150);
        const b = Math.floor(40 + brightness * 200);
        
        document.body.style.backgroundColor = `rgb(${r},${g},${b})`;
    }
    
    function drawGraph() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Draw Axes
        ctx.strokeStyle = 'rgba(255,255,255,0.2)';
        ctx.beginPath();
        ctx.moveTo(0, 350); ctx.lineTo(800, 350);
        ctx.stroke();
        
        // Draw Lines
        drawLine(history.map(h => h.act), '#fcd34d', 'Activity (CLOCK)');
        drawLine(history.map(h => h.mrna), '#3b82f6', 'mRNA (PER)');
        drawLine(history.map(h => h.prot), '#ef4444', 'Protein (PER/CRY)');
        
        // Labels
        ctx.fillStyle = '#fcd34d'; ctx.fillText('CLOCK Activity', 10, 20);
        ctx.fillStyle = '#3b82f6'; ctx.fillText('PER mRNA', 10, 40);
        ctx.fillStyle = '#ef4444'; ctx.fillText('PER Protein', 10, 60);
    }
    
    function drawLine(data, color, label) {
        if (data.length < 2) return;
        
        ctx.strokeStyle = color;
        ctx.lineWidth = 3;
        ctx.beginPath();
        
        // Auto scale? Or fixed scale.
        // Data range approx 0 to 5.
        // Map to 0-300px height.
        const scale = 50;
        
        data.forEach((val, i) => {
            const x = i;
            const y = 350 - val * scale;
            if (i===0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
        });
        ctx.stroke();
    }
    
    requestAnimationFrame(loop);

</script>
</body>
</html>
