<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Antibody Binding - CCAB</title>
    <link rel="stylesheet" href="../assets/css/gallery-standard.css">
    <style>
        body {
            background: #fff;
            color: #333;
            font-family: system-ui;
            padding: 2rem;
            text-align: center;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        
        canvas {
            background: #fdf2f8; /* Light pink (blood-ish) */
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .controls {
            margin: 20px;
        }
        
        button {
            padding: 10px 20px;
            margin: 0 10px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            color: white;
        }
        
        .btn-virus { background: #ef4444; }
        .btn-antibody { background: #3b82f6; }
        
    </style>
</head>
<body>

<div class="container">
    <a href="../index.html" class="gallery-back">‚Üê Back to Gallery</a>
    <h1>Antibody-Antigen Binding</h1>
    <p>Antibodies (Y-shape) bind to specific Antigens (Spikes) to neutralize pathogens.</p>
    
    <canvas id="canvas" width="800" height="500"></canvas>
    
    <div class="controls">
        <button class="btn-virus" onclick="addVirus()">Add Virus</button>
        <button class="btn-antibody" onclick="addAntibody()">Add Antibody</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    const entities = [];
    
    class Entity {
        constructor(x, y) {
            this.x = x;
            this.y = y;
            this.vx = (Math.random() - 0.5) * 2;
            this.vy = (Math.random() - 0.5) * 2;
            this.angle = Math.random() * Math.PI * 2;
            this.va = (Math.random() - 0.5) * 0.1;
        }
        update() {
            this.x += this.vx;
            this.y += this.vy;
            this.angle += this.va;
            
            // Bounce
            if(this.x < 0 || this.x > canvas.width) this.vx *= -1;
            if(this.y < 0 || this.y > canvas.height) this.vy *= -1;
        }
    }
    
    class Virus extends Entity {
        constructor(x, y) {
            super(x, y);
            this.r = 20;
            this.spikes = 8;
            this.bound = new Array(8).fill(false); // Track if spike is bound
        }
        draw() {
            ctx.save();
            ctx.translate(this.x, this.y);
            ctx.rotate(this.angle);
            
            // Body
            ctx.fillStyle = '#ef4444';
            ctx.beginPath(); ctx.arc(0, 0, this.r, 0, Math.PI*2); ctx.fill();
            
            // Spikes (Antigens)
            for(let i=0; i<this.spikes; i++) {
                const a = (i/this.spikes) * Math.PI*2;
                const sx = Math.cos(a) * (this.r + 5);
                const sy = Math.sin(a) * (this.r + 5);
                
                ctx.fillStyle = this.bound[i] ? '#3b82f6' : '#ef4444'; // Turn blue if bound
                ctx.beginPath(); ctx.arc(sx, sy, 5, 0, Math.PI*2); ctx.fill();
            }
            ctx.restore();
        }
    }
    
    class Antibody extends Entity {
        constructor(x, y) {
            super(x, y);
            this.state = 'free'; // free, binding, bound
            this.target = null; // {virus, spikeIndex}
        }
        
        draw() {
            ctx.save();
            ctx.translate(this.x, this.y);
            ctx.rotate(this.angle);
            
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 4;
            ctx.lineCap = 'round';
            
            // Y shape
            ctx.beginPath();
            ctx.moveTo(0, 5);
            ctx.lineTo(0, 15); // Stem
            ctx.moveTo(0, 5);
            ctx.lineTo(-8, -5); // Left arm
            ctx.moveTo(0, 5);
            ctx.lineTo(8, -5); // Right arm
            ctx.stroke();
            
            ctx.restore();
        }
        
        update() {
            if (this.state === 'bound') {
                // Follow target spike
                // Simple: just stick to virus center for visual simplicity, maybe offset
                // Actually, let's just make bound antibodies disappear and turn virus spike blue
                return; 
            }
            
            super.update();
            
            // Check collisions with viruses
            // Binding logic: If near a free spike, bind.
            
            if (this.state === 'free') {
                for (let e of entities) {
                    if (e instanceof Virus) {
                        const dist = Math.hypot(this.x - e.x, this.y - e.y);
                        if (dist < 40) {
                            // Find free spike
                            // Just pick one random free spike
                            const freeIndices = e.bound.map((b, i) => b ? -1 : i).filter(i => i !== -1);
                            if (freeIndices.length > 0) {
                                const idx = freeIndices[0]; // Simplification
                                e.bound[idx] = true;
                                this.state = 'bound';
                                this.dead = true; // Remove from list
                                return; // Done
                            }
                        }
                    }
                }
            }
        }
    }
    
    function addVirus() {
        entities.push(new Virus(Math.random()*canvas.width, Math.random()*canvas.height));
    }
    
    function addAntibody() {
        for(let i=0; i<5; i++)
            entities.push(new Antibody(Math.random()*canvas.width, Math.random()*canvas.height));
    }
    
    function loop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        for (let i = entities.length - 1; i >= 0; i--) {
            const e = entities[i];
            e.update();
            if (e.dead) entities.splice(i, 1);
            else e.draw();
        }
        
        requestAnimationFrame(loop);
    }
    
    // Init
    addVirus();
    addAntibody();
    
    requestAnimationFrame(loop);

</script>
</body>
</html>
