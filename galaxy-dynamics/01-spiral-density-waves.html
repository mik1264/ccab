<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spiral Density Waves - Galaxy Arm Formation - CCAB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #050510; min-height: 100vh; font-family: system-ui, sans-serif; color: #e8e8f8; overflow: hidden; display: flex; }
        .back-link { position: fixed; top: 15px; left: 15px; padding: 10px 18px; background: rgba(0,0,0,0.6); color: #818cf8; text-decoration: none; border-radius: 8px; font-size: 14px; z-index: 1000; }
        #canvas { flex: 1; }
        #panel { width: 340px; background: rgba(5,5,16,0.95); padding: 70px 20px 20px; border-left: 1px solid rgba(129,140,248,0.2); overflow-y: auto; }
        h1 { font-size: 1.3rem; margin-bottom: 10px; color: #818cf8; }
        .desc { font-size: 0.82rem; line-height: 1.6; color: #aaa; margin-bottom: 15px; }
        .stats-box { background: rgba(129,140,248,0.1); border: 1px solid rgba(129,140,248,0.2); border-radius: 8px; padding: 12px; margin: 15px 0; }
        .stat { display: flex; justify-content: space-between; font-size: 0.82rem; margin: 4px 0; }
        .stat-label { color: #888; }
        .stat-value { color: #818cf8; font-weight: bold; }
        .controls { margin-top: 15px; }
        .control-group { margin-bottom: 12px; }
        .control-group label { display: flex; justify-content: space-between; font-size: 0.82rem; margin-bottom: 5px; color: #aaa; }
        input[type="range"] { width: 100%; accent-color: #818cf8; }
        .buttons { display: flex; gap: 10px; }
        button { flex: 1; background: rgba(129,140,248,0.2); border: 1px solid rgba(129,140,248,0.4); color: #818cf8; padding: 10px; border-radius: 8px; cursor: pointer; }
        button:hover { background: rgba(129,140,248,0.3); }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Gallery</a>
    <canvas id="canvas"></canvas>
    <div id="panel">
        <h1>Spiral Density Waves</h1>
        <p class="desc">Spiral arms are density waves that propagate through the galactic disk. Stars slow down as they enter the wave, creating the visible spiral pattern.</p>
        <div class="stats-box">
            <div class="stat"><span class="stat-label">Pattern Speed:</span><span class="stat-value" id="pattern-speed">20 km/s/kpc</span></div>
            <div class="stat"><span class="stat-label">Arm Count:</span><span class="stat-value" id="arm-count">2</span></div>
            <div class="stat"><span class="stat-label">Pitch Angle:</span><span class="stat-value" id="pitch">15°</span></div>
            <div class="stat"><span class="stat-label">Stars:</span><span class="stat-value" id="stars">5,000</span></div>
        </div>
        <div class="controls">
            <div class="control-group">
                <label><span>Spiral Arms</span><span id="arms-val">2</span></label>
                <input type="range" id="arms-slider" min="1" max="6" value="2" step="1">
            </div>
            <div class="control-group">
                <label><span>Pitch Angle</span><span id="pitch-val">15°</span></label>
                <input type="range" id="pitch-slider" min="5" max="45" value="15" step="1">
            </div>
            <div class="control-group">
                <label><span>Pattern Speed</span><span id="speed-val">1×</span></label>
                <input type="range" id="speed-slider" min="0.2" max="3" value="1" step="0.1">
            </div>
            <div class="control-group">
                <label><span>Star Density</span><span id="density-val">5000</span></label>
                <input type="range" id="density-slider" min="1000" max="10000" value="5000" step="500">
            </div>
        </div>
        <div class="buttons">
            <button id="play">⏸ Pause</button>
            <button id="reset">↺ Reset</button>
        </div>
    </div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let time = 0, playing = true, patternSpeed = 1, arms = 2, pitch = 15;
        let stars = [];
        let starCount = 5000;
        function resize() {
            canvas.width = (window.innerWidth - 340) * devicePixelRatio;
            canvas.height = window.innerHeight * devicePixelRatio;
            ctx.scale(devicePixelRatio, devicePixelRatio);
        }
        function initStars() {
            stars = [];
            for (let i = 0; i < starCount; i++) {
                const r = 20 + Math.random() * 200;
                const angle = Math.random() * Math.PI * 2;
                const orbitalSpeed = 1 / Math.sqrt(r) * 0.5;
                stars.push({
                    r: r,
                    baseAngle: angle,
                    orbitalSpeed: orbitalSpeed,
                    size: 0.5 + Math.random() * 1.5,
                    brightness: 0.3 + Math.random() * 0.7,
                    color: Math.random() < 0.1 ? 'blue' : Math.random() < 0.3 ? 'yellow' : 'white'
                });
            }
        }
        function densityWave(r, theta, t) {
            const pitchRad = pitch * Math.PI / 180;
            const k = arms;
            const waveAngle = k * (theta - Math.log(r / 20) / Math.tan(pitchRad)) - t * patternSpeed * 0.5;
            return 0.5 + 0.5 * Math.cos(waveAngle);
        }
        function updateUI() {
            document.getElementById('pattern-speed').textContent = (20 * patternSpeed).toFixed(0) + ' km/s/kpc';
            document.getElementById('arm-count').textContent = arms;
            document.getElementById('pitch').textContent = pitch + '°';
            document.getElementById('stars').textContent = starCount.toLocaleString();
        }
        function render(timestamp) {
            const dt = 1 / 60;
            if (playing) time += dt;
            const w = canvas.width / devicePixelRatio;
            const h = canvas.height;
            const cx = w / 2, cy = h / 2;
            ctx.fillStyle = '#050510';
            ctx.fillRect(0, 0, w, h);
            // Background stars
            for (let i = 0; i < 80; i++) {
                const x = (Math.sin(i * 1234) * 0.5 + 0.5) * w;
                const y = (Math.cos(i * 5678) * 0.5 + 0.5) * h;
                ctx.fillStyle = `rgba(255,255,255,${0.1 + Math.random() * 0.1})`;
                ctx.beginPath();
                ctx.arc(x, y, Math.random() + 0.3, 0, Math.PI * 2);
                ctx.fill();
            }
            // Draw density wave pattern (subtle background)
            for (let r = 30; r < 220; r += 10) {
                for (let theta = 0; theta < Math.PI * 2; theta += 0.1) {
                    const density = densityWave(r, theta, time);
                    if (density > 0.7) {
                        const x = cx + Math.cos(theta) * r;
                        const y = cy + Math.sin(theta) * r;
                        ctx.fillStyle = `rgba(100, 100, 200, ${(density - 0.7) * 0.1})`;
                        ctx.beginPath();
                        ctx.arc(x, y, 3, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }
            }
            // Draw galactic center
            const centerGlow = ctx.createRadialGradient(cx, cy, 0, cx, cy, 40);
            centerGlow.addColorStop(0, '#ffffcc');
            centerGlow.addColorStop(0.3, '#ffdd88');
            centerGlow.addColorStop(1, 'transparent');
            ctx.fillStyle = centerGlow;
            ctx.beginPath();
            ctx.arc(cx, cy, 40, 0, Math.PI * 2);
            ctx.fill();
            // Draw stars with density wave modulation
            stars.forEach(star => {
                const angle = star.baseAngle + time * star.orbitalSpeed;
                const density = densityWave(star.r, angle, time);
                // Stars slow down in arms (spend more time there)
                const effectiveAngle = angle - density * 0.3 * Math.sin(time * 0.5);
                const x = cx + Math.cos(effectiveAngle) * star.r;
                const y = cy + Math.sin(effectiveAngle) * star.r;
                let color;
                if (density > 0.7) {
                    // Star forming regions in arms
                    color = star.color === 'blue' ? 
                        `rgba(100, 150, 255, ${star.brightness * density})` :
                        `rgba(255, 200, 150, ${star.brightness * density})`;
                } else {
                    color = `rgba(255, 255, 255, ${star.brightness * 0.5})`;
                }
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(x, y, star.size * (0.5 + density * 0.5), 0, Math.PI * 2);
                ctx.fill();
            });
            // Labels
            ctx.fillStyle = '#818cf8';
            ctx.font = '14px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Spiral Density Wave Theory', cx, 40);
            ctx.fillStyle = '#888';
            ctx.font = '11px sans-serif';
            ctx.fillText('Stars slow in arms, creating visible spiral pattern', cx, 58);
            updateUI();
            requestAnimationFrame(render);
        }
        document.getElementById('arms-slider').addEventListener('input', (e) => {
            arms = parseInt(e.target.value);
            document.getElementById('arms-val').textContent = arms;
        });
        document.getElementById('pitch-slider').addEventListener('input', (e) => {
            pitch = parseInt(e.target.value);
            document.getElementById('pitch-val').textContent = pitch + '°';
        });
        document.getElementById('speed-slider').addEventListener('input', (e) => {
            patternSpeed = parseFloat(e.target.value);
            document.getElementById('speed-val').textContent = patternSpeed.toFixed(1) + '×';
        });
        document.getElementById('density-slider').addEventListener('input', (e) => {
            starCount = parseInt(e.target.value);
            document.getElementById('density-val').textContent = starCount;
            initStars();
        });
        document.getElementById('play').addEventListener('click', () => {
            playing = !playing;
            document.getElementById('play').textContent = playing ? '⏸ Pause' : '▶ Play';
        });
        document.getElementById('reset').addEventListener('click', () => {
            time = 0;
            initStars();
        });
        window.addEventListener('resize', resize);
        resize();
        initStars();
        requestAnimationFrame(render);
    </script>
</body>
</html>
