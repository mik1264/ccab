<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentiment Visualization - ML Visualizations - CCAB</title>
    <style>
        body { margin: 0; padding: 20px; background: #0f0f1a; color: #e8e6e1; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .back-link { display: inline-block; padding: 8px 16px; background: rgba(124, 58, 237, 0.2); color: #a78bfa; text-decoration: none; border-radius: 6px; margin-bottom: 20px; }
        .back-link:hover { background: rgba(124, 58, 237, 0.4); }
        h1 { color: #a78bfa; margin-bottom: 10px; }
        .subtitle { color: #888; margin-bottom: 20px; }
        .container { max-width: 800px; }
        textarea { width: 100%; height: 120px; background: rgba(255,255,255,0.05); border: 2px solid #7C3AED; border-radius: 8px; padding: 15px; color: #e8e6e1; font-size: 16px; resize: none; }
        textarea:focus { outline: none; border-color: #10B981; }
        button { background: #7C3AED; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; margin-top: 15px; font-size: 16px; }
        button:hover { background: #6D28D9; }
        button:disabled { background: #4a4a5a; cursor: not-allowed; }
        #loading { text-align: center; padding: 50px; }
        .spinner { width: 50px; height: 50px; border: 4px solid rgba(255,255,255,0.1); border-top-color: #7C3AED; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .results { margin-top: 30px; }
        .category { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 20px; margin-bottom: 15px; }
        .category-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .category-name { font-size: 18px; font-weight: bold; }
        .category-score { font-size: 24px; font-weight: bold; }
        .bar-container { height: 12px; background: rgba(255,255,255,0.1); border-radius: 6px; overflow: hidden; }
        .bar-fill { height: 100%; transition: width 0.5s ease; }
        .low { color: #10B981; }
        .medium { color: #F59E0B; }
        .high { color: #EF4444; }
        .examples { margin-top: 20px; padding: 15px; background: rgba(124, 58, 237, 0.1); border-radius: 8px; }
        .examples h4 { margin-top: 0; color: #a78bfa; }
        .example-btn { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #e8e6e1; padding: 8px 12px; border-radius: 4px; cursor: pointer; margin: 4px; font-size: 12px; }
        .example-btn:hover { background: rgba(124, 58, 237, 0.3); }
        .overall { font-size: 48px; text-align: center; margin: 20px 0; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to ML Gallery</a>
    <h1>Sentiment Visualization</h1>
    <p class="subtitle">Analyze text toxicity using TensorFlow.js toxicity classifier</p>

    <div id="loading">
        <div class="spinner"></div>
        <p>Loading Toxicity model...</p>
    </div>

    <div id="main" style="display: none;" class="container">
        <textarea id="input" placeholder="Enter text to analyze for toxicity..."></textarea>
        <button id="analyze" onclick="analyzeText()">Analyze Sentiment</button>

        <div class="examples">
            <h4>Try these examples:</h4>
            <button class="example-btn" onclick="setExample('I love this product! It works amazingly well.')">Positive Review</button>
            <button class="example-btn" onclick="setExample('This is absolutely terrible and I hate it.')">Negative Review</button>
            <button class="example-btn" onclick="setExample('The weather today is nice and sunny.')">Neutral Statement</button>
            <button class="example-btn" onclick="setExample('You are a wonderful person and deserve happiness.')">Compliment</button>
        </div>

        <div class="results" id="results" style="display: none;">
            <div class="overall" id="overall"></div>
            <div id="categories"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/toxicity@1.2.2/dist/toxicity.min.js"></script>
    <script>
        let model;
        const threshold = 0.7;

        const CATEGORY_INFO = {
            'identity_attack': { name: 'Identity Attack', emoji: 'üéØ' },
            'insult': { name: 'Insult', emoji: 'üò§' },
            'obscene': { name: 'Obscene', emoji: 'ü§¨' },
            'severe_toxicity': { name: 'Severe Toxicity', emoji: '‚ò¢Ô∏è' },
            'sexual_explicit': { name: 'Sexual Content', emoji: 'üîû' },
            'threat': { name: 'Threat', emoji: '‚ö†Ô∏è' },
            'toxicity': { name: 'General Toxicity', emoji: '‚ò†Ô∏è' }
        };

        async function init() {
            model = await toxicity.load(threshold);

            document.getElementById('loading').style.display = 'none';
            document.getElementById('main').style.display = 'block';
        }

        function setExample(text) {
            document.getElementById('input').value = text;
            analyzeText();
        }

        async function analyzeText() {
            const input = document.getElementById('input').value.trim();
            if (!input) {
                alert('Please enter some text to analyze.');
                return;
            }

            const analyzeBtn = document.getElementById('analyze');
            analyzeBtn.disabled = true;
            analyzeBtn.textContent = 'Analyzing...';

            try {
                const predictions = await model.classify([input]);

                let maxToxicity = 0;
                let categoriesHtml = '';

                for (let pred of predictions) {
                    const label = pred.label;
                    const info = CATEGORY_INFO[label] || { name: label, emoji: 'üìä' };
                    const match = pred.results[0].match;
                    const probabilities = pred.results[0].probabilities;
                    const toxicProb = probabilities[1]; // Index 1 is toxic probability

                    maxToxicity = Math.max(maxToxicity, toxicProb);

                    const percentage = (toxicProb * 100).toFixed(1);
                    let levelClass = 'low';
                    let barColor = '#10B981';

                    if (toxicProb > 0.7) {
                        levelClass = 'high';
                        barColor = '#EF4444';
                    } else if (toxicProb > 0.4) {
                        levelClass = 'medium';
                        barColor = '#F59E0B';
                    }

                    categoriesHtml += `
                        <div class="category">
                            <div class="category-header">
                                <span class="category-name">${info.emoji} ${info.name}</span>
                                <span class="category-score ${levelClass}">${percentage}%</span>
                            </div>
                            <div class="bar-container">
                                <div class="bar-fill" style="width: ${percentage}%; background: ${barColor};"></div>
                            </div>
                        </div>
                    `;
                }

                // Overall sentiment
                let overallEmoji, overallText, overallColor;
                if (maxToxicity < 0.3) {
                    overallEmoji = 'üòä';
                    overallText = 'Positive / Neutral';
                    overallColor = '#10B981';
                } else if (maxToxicity < 0.6) {
                    overallEmoji = 'üòê';
                    overallText = 'Mixed';
                    overallColor = '#F59E0B';
                } else {
                    overallEmoji = 'üò†';
                    overallText = 'Negative / Toxic';
                    overallColor = '#EF4444';
                }

                document.getElementById('overall').innerHTML = `
                    <div style="color: ${overallColor}">${overallEmoji}</div>
                    <div style="font-size: 18px; color: ${overallColor}">${overallText}</div>
                `;
                document.getElementById('categories').innerHTML = categoriesHtml;
                document.getElementById('results').style.display = 'block';

            } catch (err) {
                alert('Error analyzing text: ' + err.message);
            }

            analyzeBtn.disabled = false;
            analyzeBtn.textContent = 'Analyze Sentiment';
        }

        init();
    </script>
</body>
</html>
