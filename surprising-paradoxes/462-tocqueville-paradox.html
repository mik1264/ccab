<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Tocqueville Paradox - Revolutions Happen When Things Improve</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 30px; }
        .back-link {
            color: #ff6b6b;
            text-decoration: none;
            margin-bottom: 20px;
            display: inline-block;
        }
        h1 {
            font-size: 2.3rem;
            background: linear-gradient(135deg, #ff6b6b, #feca57, #48dbfb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        .subtitle {
            font-size: 1rem;
            color: #a0c4ff;
            max-width: 850px;
            margin: 0 auto;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 25px;
            margin-bottom: 30px;
        }
        @media (max-width: 900px) {
            .main-grid { grid-template-columns: 1fr; }
        }

        .panel {
            background: rgba(20, 30, 50, 0.85);
            border-radius: 15px;
            padding: 25px;
        }
        .panel h2 {
            color: #feca57;
            margin-bottom: 15px;
            font-size: 1.2rem;
            text-align: center;
        }

        /* Main simulation canvas */
        #simCanvas {
            width: 100%;
            height: 320px;
            border-radius: 10px;
            background: #0a0a1a;
            margin-bottom: 15px;
        }

        /* Controls */
        .control-group {
            margin-bottom: 20px;
        }
        .control-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            color: #a0c4ff;
            font-size: 0.9rem;
        }
        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(90deg, #2ecc71, #f39c12, #e74c3c);
            outline: none;
            -webkit-appearance: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
        }

        /* Buttons */
        .btn-row {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .sim-btn {
            flex: 1;
            padding: 12px;
            font-size: 1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #e74c3c, #f39c12);
            color: white;
        }
        .btn-secondary {
            background: rgba(100,100,100,0.3);
            color: #ccc;
        }
        .sim-btn:hover {
            transform: translateY(-2px);
        }

        /* Status display */
        .status-box {
            background: rgba(0,0,0,0.4);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }
        .status-title {
            color: #888;
            font-size: 0.85rem;
            margin-bottom: 5px;
        }
        .status-value {
            font-size: 1.5rem;
            font-weight: bold;
        }
        .status-value.stable { color: #2ecc71; }
        .status-value.tension { color: #f39c12; }
        .status-value.danger { color: #e74c3c; }
        .status-value.revolution { color: #ff0066; animation: pulse 0.5s infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Year indicator */
        .year-display {
            text-align: center;
            margin-bottom: 20px;
        }
        .year-display .year {
            font-size: 2rem;
            color: #feca57;
            font-weight: bold;
        }
        .year-display .era {
            color: #888;
            font-size: 0.9rem;
        }

        /* Scenario selector */
        .scenario-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .scenario-tab {
            flex: 1;
            padding: 10px 5px;
            font-size: 0.8rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background: rgba(100,100,100,0.3);
            color: #888;
            transition: all 0.3s;
            min-width: 100px;
        }
        .scenario-tab.active {
            background: linear-gradient(135deg, #e74c3c, #f39c12);
            color: white;
        }

        /* Side panel stats */
        .stat-box {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
        }
        .stat-label {
            color: #888;
            font-size: 0.8rem;
            margin-bottom: 5px;
        }
        .stat-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #feca57;
        }
        .stat-bar {
            height: 8px;
            background: rgba(100,100,100,0.3);
            border-radius: 4px;
            margin-top: 8px;
            overflow: hidden;
        }
        .stat-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s;
        }
        .conditions-bar { background: linear-gradient(90deg, #e74c3c, #2ecc71); }
        .expectations-bar { background: linear-gradient(90deg, #3498db, #9b59b6); }
        .gap-bar { background: linear-gradient(90deg, #2ecc71, #e74c3c); }

        /* Legend */
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            color: #a0a0a0;
        }
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        .dot-conditions { background: #2ecc71; }
        .dot-expectations { background: #9b59b6; }
        .dot-gap { background: #e74c3c; }

        /* Research section */
        .research-section {
            background: rgba(20, 30, 50, 0.85);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
        }
        .research-section h2 {
            color: #48dbfb;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        .quote {
            font-style: italic;
            color: #c0c0c0;
            border-left: 3px solid #f39c12;
            padding-left: 15px;
            margin: 15px 0;
        }
        .research-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .research-card {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 20px;
            border-left: 3px solid #48dbfb;
        }
        .research-card h3 {
            color: #feca57;
            margin-bottom: 10px;
            font-size: 1rem;
        }
        .research-card p {
            color: #a0a0a0;
            font-size: 0.9rem;
        }

        /* Timeline events */
        .event-log {
            max-height: 150px;
            overflow-y: auto;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 10px;
            margin-top: 15px;
        }
        .event-item {
            padding: 5px 0;
            border-bottom: 1px solid rgba(100,100,100,0.2);
            font-size: 0.85rem;
            color: #a0a0a0;
        }
        .event-item:last-child { border-bottom: none; }
        .event-year { color: #feca57; margin-right: 5px; }
        .event-reform { color: #2ecc71; }
        .event-unrest { color: #f39c12; }
        .event-revolution { color: #e74c3c; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-link">‚Üê Back to Gallery</a>
            <h1>The Tocqueville Paradox</h1>
            <p class="subtitle">
                Alexis de Tocqueville (1856): "The most dangerous time for a bad government is usually
                when it begins to reform." Revolutions don't happen at rock bottom‚Äîthey happen when
                things are getting BETTER. Watch expectations outrun reality.
            </p>
        </header>

        <div class="scenario-tabs">
            <button class="scenario-tab active" onclick="loadScenario('france')">üá´üá∑ French Revolution</button>
            <button class="scenario-tab" onclick="loadScenario('arab')">üåç Arab Spring</button>
            <button class="scenario-tab" onclick="loadScenario('soviet')">‚ò≠ Soviet Collapse</button>
            <button class="scenario-tab" onclick="loadScenario('custom')">‚öôÔ∏è Custom</button>
        </div>

        <div class="main-grid">
            <div class="panel">
                <h2>The Expectations Gap</h2>

                <div class="legend">
                    <div class="legend-item"><div class="legend-dot dot-conditions"></div> Actual Conditions</div>
                    <div class="legend-item"><div class="legend-dot dot-expectations"></div> Expectations</div>
                    <div class="legend-item"><div class="legend-dot dot-gap"></div> Frustration Gap</div>
                </div>

                <canvas id="simCanvas"></canvas>

                <div class="year-display">
                    <div class="year" id="currentYear">1780</div>
                    <div class="era" id="currentEra">Ancien R√©gime</div>
                </div>

                <div class="control-group" id="customControls" style="display: none;">
                    <div class="control-label">
                        <span>Reform Speed</span>
                        <span id="reformVal">50%</span>
                    </div>
                    <input type="range" id="reformSpeed" min="10" max="100" value="50"
                           oninput="document.getElementById('reformVal').textContent = this.value + '%'">

                    <div class="control-label" style="margin-top: 15px;">
                        <span>Expectation Growth</span>
                        <span id="expectVal">70%</span>
                    </div>
                    <input type="range" id="expectationGrowth" min="10" max="100" value="70"
                           oninput="document.getElementById('expectVal').textContent = this.value + '%'">
                </div>

                <div class="btn-row">
                    <button class="sim-btn btn-primary" id="runBtn" onclick="toggleSimulation()">‚ñ∂ Run Simulation</button>
                    <button class="sim-btn btn-secondary" onclick="resetSimulation()">‚Ü∫ Reset</button>
                </div>

                <div class="event-log" id="eventLog">
                    <div class="event-item"><span class="event-year">Ready</span> Select a scenario and run the simulation</div>
                </div>
            </div>

            <div class="panel">
                <h2>Current State</h2>

                <div class="status-box">
                    <div class="status-title">Social Stability</div>
                    <div class="status-value stable" id="stabilityStatus">STABLE</div>
                </div>

                <div class="stat-box">
                    <div class="stat-label">Actual Conditions</div>
                    <div class="stat-value" id="conditionsValue">35%</div>
                    <div class="stat-bar">
                        <div class="stat-bar-fill conditions-bar" id="conditionsBar" style="width: 35%"></div>
                    </div>
                </div>

                <div class="stat-box">
                    <div class="stat-label">Public Expectations</div>
                    <div class="stat-value" id="expectationsValue">30%</div>
                    <div class="stat-bar">
                        <div class="stat-bar-fill expectations-bar" id="expectationsBar" style="width: 30%"></div>
                    </div>
                </div>

                <div class="stat-box">
                    <div class="stat-label">Frustration Gap</div>
                    <div class="stat-value" id="gapValue" style="color: #2ecc71;">-5%</div>
                    <div class="stat-bar">
                        <div class="stat-bar-fill gap-bar" id="gapBar" style="width: 0%"></div>
                    </div>
                </div>

                <div style="margin-top: 20px; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 10px;">
                    <div style="color: #feca57; margin-bottom: 8px; font-weight: bold;">The Paradox</div>
                    <div style="color: #888; font-size: 0.85rem;">
                        When conditions improve, expectations rise <em>faster</em> than reality.
                        The gap between what people expect and what they have grows‚Äî
                        creating revolutionary tension precisely when things are getting better.
                    </div>
                </div>

                <div style="margin-top: 15px; padding: 15px; background: rgba(231,76,60,0.2); border-radius: 10px; border-left: 3px solid #e74c3c;">
                    <div style="color: #e74c3c; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem;">Revolution Threshold</div>
                    <div style="color: #a0a0a0; font-size: 0.8rem;">
                        When the expectations gap exceeds <strong>25%</strong>, social unrest triggers revolution.
                        Paradoxically, this rarely happens at rock bottom.
                    </div>
                </div>
            </div>
        </div>

        <div class="research-section">
            <h2>The Science of Revolution</h2>

            <div class="quote">
                "The hatred that men bear to privilege increases in proportion as privileges become fewer
                and less considerable, so that democratic passions would seem to burn most fiercely
                just when they have least fuel."
                <br>‚Äî Alexis de Tocqueville, <em>Democracy in America</em>, 1840
            </div>

            <div class="research-grid">
                <div class="research-card">
                    <h3>üìö Tocqueville's Observation (1856)</h3>
                    <p>
                        In "The Old Regime and the Revolution," Tocqueville analyzed the French Revolution.
                        France in 1789 was not at its worst‚Äîconditions had been improving for decades.
                        But reform opened the door to expectations that couldn't be met. Paradoxically,
                        the more the regime gave, the more people demanded.
                    </p>
                </div>

                <div class="research-card">
                    <h3>üìà Davies' J-Curve (1962)</h3>
                    <p>
                        Political scientist James Davies formalized this as the "J-Curve" theory:
                        revolutions occur when a period of improvement is followed by a sharp reversal.
                        The gap between expectations (still rising) and reality (now falling) creates
                        revolutionary conditions. The Russian and Egyptian revolutions fit this pattern.
                    </p>
                </div>

                <div class="research-card">
                    <h3>üåç Arab Spring (2011)</h3>
                    <p>
                        Tunisia and Egypt experienced economic growth and rising education in the 2000s.
                        But expectations grew faster‚Äîespecially among youth. When growth stalled,
                        the gap became unbearable. Revolution came not from the most oppressed,
                        but from the newly educated middle class with unfulfilled expectations.
                    </p>
                </div>

                <div class="research-card">
                    <h3>‚ò≠ Soviet Collapse (1991)</h3>
                    <p>
                        Gorbachev's reforms (glasnost, perestroika) improved conditions‚Äîbut
                        expectations exploded even faster. Citizens who had accepted the status quo
                        suddenly demanded full democracy and prosperity. The gap between what
                        reform promised and what it delivered triggered the system's collapse.
                    </p>
                </div>

                <div class="research-card">
                    <h3>‚öñÔ∏è Relative Deprivation</h3>
                    <p>
                        Ted Gurr's "relative deprivation" theory explains the psychology:
                        people don't compare their situation to the past, but to their expectations.
                        Improvement raises the reference point. You feel <em>more</em> deprived
                        when you're getting more‚Äîbecause you expected even more than that.
                    </p>
                </div>

                <div class="research-card">
                    <h3>üí° Modern Applications</h3>
                    <p>
                        The Tocqueville Paradox applies beyond politics: employee satisfaction
                        can drop after raises (expectations rise faster), customer complaints
                        increase after service improvements, and social movements intensify
                        precisely when progress is being made. Managing expectations is as
                        important as managing reality.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');

        let width, height;
        let running = false;
        let animationId = null;
        let currentScenario = 'france';

        // Simulation state
        let year = 0;
        let conditions = 35;
        let expectations = 30;
        let history = [];
        let events = [];
        let revolutionTriggered = false;

        // Scenario configurations
        const scenarios = {
            france: {
                name: 'French Revolution',
                startYear: 1750,
                endYear: 1795,
                startConditions: 30,
                startExpectations: 25,
                phases: [
                    { until: 1770, conditionDelta: 0.3, expectationDelta: 0.2, era: 'Ancien R√©gime' },
                    { until: 1780, conditionDelta: 0.5, expectationDelta: 0.4, era: 'Reform Era Begins' },
                    { until: 1788, conditionDelta: 0.7, expectationDelta: 1.2, era: 'Enlightenment Reforms' },
                    { until: 1789, conditionDelta: -0.5, expectationDelta: 1.5, era: 'Crisis of 1788' },
                    { until: 1795, conditionDelta: -0.3, expectationDelta: -0.5, era: 'Revolutionary Period' }
                ],
                events: [
                    { year: 1774, text: 'Louis XVI attempts reforms', type: 'reform' },
                    { year: 1781, text: 'Necker publishes royal accounts', type: 'reform' },
                    { year: 1787, text: 'Assembly of Notables convened', type: 'reform' },
                    { year: 1788, text: 'Bread prices spike, crops fail', type: 'unrest' },
                    { year: 1789, text: 'REVOLUTION! Bastille falls', type: 'revolution' }
                ]
            },
            arab: {
                name: 'Arab Spring',
                startYear: 2000,
                endYear: 2015,
                startConditions: 40,
                startExpectations: 35,
                phases: [
                    { until: 2005, conditionDelta: 0.6, expectationDelta: 0.5, era: 'Growth Period' },
                    { until: 2008, conditionDelta: 0.8, expectationDelta: 1.3, era: 'Social Media Era' },
                    { until: 2010, conditionDelta: 0.3, expectationDelta: 1.5, era: 'Economic Slowdown' },
                    { until: 2011, conditionDelta: -0.2, expectationDelta: 1.8, era: 'Rising Frustration' },
                    { until: 2015, conditionDelta: -0.4, expectationDelta: -0.3, era: 'Post-Revolution' }
                ],
                events: [
                    { year: 2003, text: 'Economic growth accelerates', type: 'reform' },
                    { year: 2007, text: 'Facebook reaches Middle East', type: 'reform' },
                    { year: 2009, text: 'Youth unemployment rises', type: 'unrest' },
                    { year: 2010, text: 'Food prices spike globally', type: 'unrest' },
                    { year: 2011, text: 'REVOLUTION! Arab Spring begins', type: 'revolution' }
                ]
            },
            soviet: {
                name: 'Soviet Collapse',
                startYear: 1980,
                endYear: 1995,
                startConditions: 45,
                startExpectations: 40,
                phases: [
                    { until: 1985, conditionDelta: 0.1, expectationDelta: 0.15, era: 'Late Soviet Era' },
                    { until: 1988, conditionDelta: 0.4, expectationDelta: 1.0, era: 'Glasnost & Perestroika' },
                    { until: 1990, conditionDelta: 0.3, expectationDelta: 1.5, era: 'Reform Accelerates' },
                    { until: 1991, conditionDelta: -0.5, expectationDelta: 1.8, era: 'Crisis' },
                    { until: 1995, conditionDelta: -0.6, expectationDelta: -0.4, era: 'Post-Soviet Transition' }
                ],
                events: [
                    { year: 1985, text: 'Gorbachev begins reforms', type: 'reform' },
                    { year: 1987, text: 'Political prisoners released', type: 'reform' },
                    { year: 1989, text: 'Berlin Wall falls', type: 'reform' },
                    { year: 1990, text: 'Republics declare sovereignty', type: 'unrest' },
                    { year: 1991, text: 'COLLAPSE! Soviet Union dissolves', type: 'revolution' }
                ]
            },
            custom: {
                name: 'Custom Scenario',
                startYear: 0,
                endYear: 50,
                startConditions: 30,
                startExpectations: 25,
                phases: [], // Generated dynamically
                events: []
            }
        };

        function resizeCanvas() {
            const rect = canvas.getBoundingClientRect();
            width = canvas.width = rect.width * 2;
            height = canvas.height = rect.height * 2;
            ctx.scale(2, 2);
            if (!running) drawState();
        }

        function loadScenario(name) {
            currentScenario = name;
            document.querySelectorAll('.scenario-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            document.getElementById('customControls').style.display =
                name === 'custom' ? 'block' : 'none';

            resetSimulation();
        }

        function resetSimulation() {
            running = false;
            if (animationId) cancelAnimationFrame(animationId);
            document.getElementById('runBtn').textContent = '‚ñ∂ Run Simulation';

            const scenario = scenarios[currentScenario];
            year = scenario.startYear;
            conditions = scenario.startConditions;
            expectations = scenario.startExpectations;
            history = [{ year, conditions, expectations }];
            events = [];
            revolutionTriggered = false;

            updateDisplay();
            drawState();

            document.getElementById('eventLog').innerHTML =
                '<div class="event-item"><span class="event-year">Ready</span> Click "Run Simulation" to begin</div>';
        }

        function toggleSimulation() {
            if (running) {
                running = false;
                document.getElementById('runBtn').textContent = '‚ñ∂ Run Simulation';
            } else {
                running = true;
                document.getElementById('runBtn').textContent = '‚è∏ Pause';
                simulate();
            }
        }

        function simulate() {
            if (!running) return;

            const scenario = scenarios[currentScenario];

            if (year >= scenario.endYear) {
                running = false;
                document.getElementById('runBtn').textContent = '‚ñ∂ Run Simulation';
                return;
            }

            // Find current phase
            let phase;
            if (currentScenario === 'custom') {
                const reformSpeed = parseInt(document.getElementById('reformSpeed').value) / 100;
                const expectGrowth = parseInt(document.getElementById('expectationGrowth').value) / 100;
                phase = {
                    conditionDelta: reformSpeed * 0.8,
                    expectationDelta: expectGrowth * 1.2,
                    era: year < 20 ? 'Pre-Reform' : year < 35 ? 'Reform Period' : 'Late Stage'
                };
            } else {
                phase = scenario.phases.find(p => year < p.until) || scenario.phases[scenario.phases.length - 1];
            }

            // Update values with some noise
            conditions += phase.conditionDelta + (Math.random() - 0.5) * 0.3;
            expectations += phase.expectationDelta + (Math.random() - 0.5) * 0.2;

            // Clamp values
            conditions = Math.max(5, Math.min(95, conditions));
            expectations = Math.max(5, Math.min(95, expectations));

            // Check for revolution
            const gap = expectations - conditions;
            if (gap > 25 && !revolutionTriggered) {
                revolutionTriggered = true;
                addEvent(year, 'REVOLUTION TRIGGERED!', 'revolution');
            }

            // Check for scenario events
            const scenarioEvent = scenario.events.find(e => e.year === Math.floor(year));
            if (scenarioEvent && !events.find(e => e.year === scenarioEvent.year)) {
                addEvent(scenarioEvent.year, scenarioEvent.text, scenarioEvent.type);
            }

            history.push({ year, conditions, expectations });

            // Advance year
            year += 0.2;

            updateDisplay();
            drawState();

            setTimeout(() => {
                animationId = requestAnimationFrame(simulate);
            }, 50);
        }

        function addEvent(year, text, type) {
            events.push({ year, text, type });
            const log = document.getElementById('eventLog');
            const div = document.createElement('div');
            div.className = 'event-item';
            div.innerHTML = `<span class="event-year">${Math.floor(year)}</span> <span class="event-${type}">${text}</span>`;
            log.insertBefore(div, log.firstChild);
        }

        function updateDisplay() {
            const scenario = scenarios[currentScenario];

            document.getElementById('currentYear').textContent = Math.floor(year);

            // Find current era
            let era = 'Simulation';
            if (currentScenario !== 'custom') {
                const phase = scenario.phases.find(p => year < p.until);
                era = phase ? phase.era : scenario.phases[scenario.phases.length - 1].era;
            } else {
                era = year < 20 ? 'Pre-Reform Era' : year < 35 ? 'Reform Period' : 'Late Stage';
            }
            document.getElementById('currentEra').textContent = era;

            // Update stats
            document.getElementById('conditionsValue').textContent = Math.round(conditions) + '%';
            document.getElementById('conditionsBar').style.width = conditions + '%';

            document.getElementById('expectationsValue').textContent = Math.round(expectations) + '%';
            document.getElementById('expectationsBar').style.width = expectations + '%';

            const gap = expectations - conditions;
            const gapEl = document.getElementById('gapValue');
            gapEl.textContent = (gap > 0 ? '+' : '') + Math.round(gap) + '%';
            gapEl.style.color = gap > 20 ? '#e74c3c' : gap > 10 ? '#f39c12' : '#2ecc71';
            document.getElementById('gapBar').style.width = Math.max(0, gap * 2) + '%';

            // Update stability status
            const statusEl = document.getElementById('stabilityStatus');
            if (revolutionTriggered) {
                statusEl.textContent = 'REVOLUTION!';
                statusEl.className = 'status-value revolution';
            } else if (gap > 20) {
                statusEl.textContent = 'DANGER';
                statusEl.className = 'status-value danger';
            } else if (gap > 10) {
                statusEl.textContent = 'TENSION';
                statusEl.className = 'status-value tension';
            } else {
                statusEl.textContent = 'STABLE';
                statusEl.className = 'status-value stable';
            }
        }

        function drawState() {
            const w = width / 2;
            const h = height / 2;

            ctx.fillStyle = '#0a0a1a';
            ctx.fillRect(0, 0, w, h);

            if (history.length < 2) return;

            const scenario = scenarios[currentScenario];
            const padding = { left: 50, right: 30, top: 30, bottom: 40 };
            const chartW = w - padding.left - padding.right;
            const chartH = h - padding.top - padding.bottom;

            // Draw axes
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding.left, padding.top);
            ctx.lineTo(padding.left, h - padding.bottom);
            ctx.lineTo(w - padding.right, h - padding.bottom);
            ctx.stroke();

            // Y-axis labels
            ctx.fillStyle = '#666';
            ctx.font = '10px Georgia';
            ctx.textAlign = 'right';
            [0, 25, 50, 75, 100].forEach(val => {
                const y = padding.top + chartH - (val / 100) * chartH;
                ctx.fillText(val + '%', padding.left - 5, y + 3);
                ctx.strokeStyle = '#222';
                ctx.beginPath();
                ctx.moveTo(padding.left, y);
                ctx.lineTo(w - padding.right, y);
                ctx.stroke();
            });

            // Revolution threshold line
            const thresholdY = padding.top + chartH - (25 / 100) * chartH;
            ctx.strokeStyle = 'rgba(231, 76, 60, 0.3)';
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(padding.left, thresholdY);
            ctx.lineTo(w - padding.right, thresholdY);
            ctx.stroke();
            ctx.setLineDash([]);

            // X range
            const minYear = scenario.startYear;
            const maxYear = scenario.endYear;
            const yearRange = maxYear - minYear;

            function xPos(yr) {
                return padding.left + ((yr - minYear) / yearRange) * chartW;
            }
            function yPos(val) {
                return padding.top + chartH - (val / 100) * chartH;
            }

            // Draw gap area (shaded)
            ctx.fillStyle = 'rgba(231, 76, 60, 0.15)';
            ctx.beginPath();
            history.forEach((h, i) => {
                const x = xPos(h.year);
                const gap = Math.max(0, h.expectations - h.conditions);
                if (i === 0) {
                    ctx.moveTo(x, yPos(h.conditions));
                } else {
                    ctx.lineTo(x, yPos(h.conditions));
                }
            });
            for (let i = history.length - 1; i >= 0; i--) {
                const h = history[i];
                const x = xPos(h.year);
                ctx.lineTo(x, yPos(h.expectations));
            }
            ctx.closePath();
            ctx.fill();

            // Draw conditions line
            ctx.strokeStyle = '#2ecc71';
            ctx.lineWidth = 2.5;
            ctx.beginPath();
            history.forEach((h, i) => {
                const x = xPos(h.year);
                const y = yPos(h.conditions);
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            ctx.stroke();

            // Draw expectations line
            ctx.strokeStyle = '#9b59b6';
            ctx.lineWidth = 2.5;
            ctx.beginPath();
            history.forEach((h, i) => {
                const x = xPos(h.year);
                const y = yPos(h.expectations);
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            ctx.stroke();

            // Draw event markers
            events.forEach(e => {
                const x = xPos(e.year);
                ctx.fillStyle = e.type === 'revolution' ? '#e74c3c' :
                               e.type === 'unrest' ? '#f39c12' : '#2ecc71';
                ctx.beginPath();
                ctx.arc(x, padding.top + 15, 5, 0, Math.PI * 2);
                ctx.fill();
            });

            // X-axis labels
            ctx.fillStyle = '#666';
            ctx.textAlign = 'center';
            const yearStep = yearRange > 30 ? 10 : 5;
            for (let yr = Math.ceil(minYear / yearStep) * yearStep; yr <= maxYear; yr += yearStep) {
                ctx.fillText(yr.toString(), xPos(yr), h - padding.bottom + 15);
            }

            // Current position marker
            if (history.length > 0) {
                const last = history[history.length - 1];
                const x = xPos(last.year);

                // Conditions dot
                ctx.fillStyle = '#2ecc71';
                ctx.beginPath();
                ctx.arc(x, yPos(last.conditions), 6, 0, Math.PI * 2);
                ctx.fill();

                // Expectations dot
                ctx.fillStyle = '#9b59b6';
                ctx.beginPath();
                ctx.arc(x, yPos(last.expectations), 6, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // Initialize
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        resetSimulation();
    </script>
</body>
</html>
