<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Ebbinghaus Illusion - When Context Distorts Size</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5em;
            color: #e94560;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.2em;
            color: #a0a0a0;
            font-style: italic;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #e94560;
            text-decoration: none;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 100;
            background: rgba(26, 26, 46, 0.9);
            padding: 8px 15px;
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        .back-link:hover {
            background: rgba(233, 69, 96, 0.2);
            transform: translateX(-3px);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .panel h2 {
            color: #e94560;
            margin-bottom: 20px;
            font-size: 1.4em;
        }

        .canvas-container {
            text-align: center;
            margin-bottom: 20px;
        }

        canvas {
            background: #0a0a15;
            border-radius: 10px;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-group label {
            color: #a0a0a0;
            font-size: 0.9em;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: rgba(255,255,255,0.1);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #e94560;
            cursor: pointer;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, #e94560, #0f3460);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(233, 69, 96, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .reveal-text {
            margin-top: 15px;
            padding: 15px;
            background: rgba(233, 69, 96, 0.2);
            border-radius: 10px;
            border: 1px solid #e94560;
            font-weight: bold;
            display: none;
        }

        .reveal-text.visible {
            display: block;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .explanation {
            line-height: 1.8;
        }

        .explanation p {
            margin-bottom: 15px;
        }

        .highlight {
            color: #e94560;
            font-weight: bold;
        }

        .history-box {
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 4px solid #e94560;
        }

        .history-box h3 {
            color: #e94560;
            margin-bottom: 10px;
        }

        .game-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            width: 100%;
            text-align: center;
            margin-bottom: 20px;
        }

        .stat-box {
            background: rgba(255, 255, 255, 0.08);
            padding: 15px;
            border-radius: 10px;
        }

        .stat-value {
            font-size: 2em;
            color: #e94560;
            font-weight: bold;
        }

        .stat-label {
            font-size: 0.85em;
            color: #a0a0a0;
        }

        .variants-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .variant-card {
            background: rgba(255, 255, 255, 0.08);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .variant-card h3 {
            color: #4ecdc4;
            margin-bottom: 10px;
            font-size: 1em;
        }

        .applications-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .app-card {
            background: rgba(255, 255, 255, 0.08);
            padding: 20px;
            border-radius: 10px;
        }

        .app-card h3 {
            color: #4ecdc4;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">
        <span>←</span> Back to Paradoxes
    </a>

    <div class="container">
        <header>
            <h1>The Ebbinghaus Illusion</h1>
            <p class="subtitle">Surrounding circles warp your size perception</p>
        </header>

        <div class="main-content">
            <!-- Classic Demonstration -->
            <div class="panel">
                <h2>Classic Titchener Circles</h2>
                <div class="canvas-container">
                    <canvas id="classicCanvas" width="450" height="300"></canvas>
                </div>
                <p style="text-align: center; color: #a0a0a0; margin-bottom: 15px;">
                    Which ORANGE circle is larger?
                </p>
                <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                    <button class="btn btn-secondary" onclick="guessLeft()">Left</button>
                    <button class="btn btn-secondary" onclick="guessRight()">Right</button>
                    <button class="btn btn-primary" onclick="revealClassic()">Reveal Truth</button>
                </div>
                <div id="classicReveal" class="reveal-text"></div>
            </div>

            <!-- Interactive Size Matcher -->
            <div class="panel">
                <h2>Match the Centers</h2>
                <div class="canvas-container">
                    <canvas id="matchCanvas" width="450" height="300"></canvas>
                </div>
                <div class="controls">
                    <div class="control-group">
                        <label>Adjust left center circle: <span id="matchValue">100%</span></label>
                        <input type="range" id="matchSlider" min="60" max="140" value="100" oninput="updateMatch()">
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="checkMatch()">Check Perception</button>
                        <button class="btn btn-secondary" onclick="resetMatch()">Reset</button>
                    </div>
                </div>
                <div id="matchResult" class="reveal-text"></div>
            </div>

            <!-- Surrounding Size Control -->
            <div class="panel">
                <h2>Control the Surroundings</h2>
                <div class="canvas-container">
                    <canvas id="sizeCanvas" width="450" height="300"></canvas>
                </div>
                <div class="controls">
                    <div class="control-group">
                        <label>Left surrounding circles: <span id="leftSurroundValue">50px</span></label>
                        <input type="range" id="leftSurroundSlider" min="15" max="80" value="50" oninput="updateSurroundSize()">
                    </div>
                    <div class="control-group">
                        <label>Right surrounding circles: <span id="rightSurroundValue">20px</span></label>
                        <input type="range" id="rightSurroundSlider" min="15" max="80" value="20" oninput="updateSurroundSize()">
                    </div>
                </div>
                <p style="margin-top: 15px; color: #a0a0a0; font-size: 0.9em;">
                    Make both surrounding sizes equal—watch the illusion DISAPPEAR! The center circles are always 30px.
                </p>
            </div>

            <!-- Distance Control -->
            <div class="panel">
                <h2>Surround Distance</h2>
                <div class="canvas-container">
                    <canvas id="distanceCanvas" width="450" height="300"></canvas>
                </div>
                <div class="controls">
                    <div class="control-group">
                        <label>Distance from center: <span id="distanceValue">70px</span></label>
                        <input type="range" id="distanceSlider" min="45" max="120" value="70" oninput="updateDistance()">
                    </div>
                    <div class="control-group">
                        <label>Number of circles: <span id="countValue">6</span></label>
                        <input type="range" id="countSlider" min="3" max="12" value="6" oninput="updateDistance()">
                    </div>
                </div>
            </div>

            <!-- Perception Game -->
            <div class="panel full-width">
                <h2>Size Perception Game</h2>
                <div style="display: flex; flex-direction: column; align-items: center; gap: 20px;">
                    <canvas id="gameCanvas" width="800" height="300"></canvas>
                    <div class="game-stats">
                        <div class="stat-box">
                            <div class="stat-value" id="trialNum">0</div>
                            <div class="stat-label">Trial</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="correctCount">0</div>
                            <div class="stat-label">Correct</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="accuracy">0%</div>
                            <div class="stat-label">Accuracy</div>
                        </div>
                    </div>
                    <p id="gameInstruction" style="color: #a0a0a0;">Which CENTER circle is ACTUALLY larger? Ignore the surroundings!</p>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
                        <button class="btn btn-primary" id="startBtn" onclick="startGame()">Start Game</button>
                        <button class="btn btn-secondary" id="leftBtn" onclick="gameAnswer('left')" style="display:none;">Left is Larger</button>
                        <button class="btn btn-secondary" id="sameBtn" onclick="gameAnswer('same')" style="display:none;">They're Equal</button>
                        <button class="btn btn-secondary" id="rightBtn" onclick="gameAnswer('right')" style="display:none;">Right is Larger</button>
                    </div>
                </div>
            </div>

            <!-- Animated Version -->
            <div class="panel">
                <h2>Animated Illusion</h2>
                <div class="canvas-container">
                    <canvas id="animateCanvas" width="450" height="300"></canvas>
                </div>
                <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                    <button class="btn btn-primary" id="animateBtn" onclick="toggleAnimation()">Start Animation</button>
                    <button class="btn btn-secondary" onclick="resetAnimation()">Reset</button>
                </div>
                <p style="margin-top: 15px; color: #a0a0a0; font-size: 0.9em; text-align: center;">
                    Watch the center circles appear to PULSE as the surrounding circles change size—even though centers never change!
                </p>
            </div>

            <!-- Shape Variants -->
            <div class="panel">
                <h2>Beyond Circles</h2>
                <div class="canvas-container">
                    <canvas id="variantsCanvas" width="450" height="300"></canvas>
                </div>
                <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                    <button class="btn btn-secondary" onclick="setVariant('circles')">Circles</button>
                    <button class="btn btn-secondary" onclick="setVariant('squares')">Squares</button>
                    <button class="btn btn-secondary" onclick="setVariant('triangles')">Triangles</button>
                    <button class="btn btn-secondary" onclick="setVariant('stars')">Stars</button>
                </div>
                <p style="margin-top: 15px; color: #a0a0a0; font-size: 0.9em; text-align: center;">
                    The illusion works with ANY shapes—not just circles! The brain compares relative sizes.
                </p>
            </div>

            <!-- Real-World Applications -->
            <div class="panel full-width">
                <h2>Real-World Applications</h2>
                <div class="applications-grid">
                    <div class="app-card">
                        <h3>Food & Diet</h3>
                        <p>Food on a large plate looks smaller, so you serve more. The Delboeuf illusion (related) shows that plating matters for portion control. Use smaller plates to eat less!</p>
                    </div>
                    <div class="app-card">
                        <h3>Web Design</h3>
                        <p>Buttons surrounded by whitespace look larger and more clickable. Designers use the Ebbinghaus effect to draw attention to call-to-action elements.</p>
                    </div>
                    <div class="app-card">
                        <h3>Fashion</h3>
                        <p>Wearing patterns with large elements makes the wearer look smaller relative to the pattern. Stylists use this to create slimming or enlarging effects.</p>
                    </div>
                    <div class="app-card">
                        <h3>Architecture</h3>
                        <p>Rooms with large furniture feel smaller. Interior designers balance object sizes to manipulate perceived room dimensions.</p>
                    </div>
                </div>
            </div>

            <!-- Explanation -->
            <div class="panel full-width explanation">
                <h2>The Psychology of Relative Size</h2>
                <p>
                    The <span class="highlight">Ebbinghaus Illusion</span> (also called <span class="highlight">Titchener Circles</span>)
                    was discovered by German psychologist <span class="highlight">Hermann Ebbinghaus in the 1890s</span>
                    and popularized by Edward Titchener. It demonstrates that perceived size depends heavily on context.
                </p>
                <p>
                    <strong>The "Contrast" Theory:</strong> Your visual system doesn't measure absolute size—it compares
                    objects to their surroundings. A circle surrounded by large circles looks small BY CONTRAST.
                    Surrounded by small circles, the same circle looks large. This relative encoding is efficient
                    but can be fooled.
                </p>
                <p>
                    <strong>The "Contour Interaction" Theory:</strong> Nearby contours interfere with size perception.
                    Large surrounding circles push their "influence" onto the central circle, shrinking it perceptually.
                    Small surrounding circles have less influence, allowing the center to "expand."
                </p>
                <p>
                    <strong>Cross-Cultural Differences:</strong> The Ebbinghaus illusion affects people worldwide but with
                    different strengths. Some studies show Westerners experience it more strongly than East Asians,
                    possibly due to differences in holistic vs. analytic visual processing styles.
                </p>

                <div class="history-box">
                    <h3>Historical Note</h3>
                    <p>
                        Hermann Ebbinghaus (1850-1909) is best known for discovering the "forgetting curve" and
                        pioneering experimental memory research. The size illusion bearing his name was just one of
                        many perceptual phenomena he explored. Edward Titchener later popularized it in his
                        influential textbooks, which is why it's often called "Titchener circles" in English-speaking
                        countries.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== CLASSIC ILLUSION ==========
        const classicCanvas = document.getElementById('classicCanvas');
        const classicCtx = classicCanvas.getContext('2d');

        function drawClassic(showMeasure = false) {
            classicCtx.fillStyle = '#0a0a15';
            classicCtx.fillRect(0, 0, classicCanvas.width, classicCanvas.height);

            const centerRadius = 25;
            const leftX = 130;
            const rightX = 320;
            const y = 150;

            // Left: center with large surroundings
            const largeSurround = 45;
            const largeDist = 75;
            const largeCount = 6;

            for (let i = 0; i < largeCount; i++) {
                const angle = (i / largeCount) * Math.PI * 2 - Math.PI / 2;
                const sx = leftX + Math.cos(angle) * largeDist;
                const sy = y + Math.sin(angle) * largeDist;
                classicCtx.beginPath();
                classicCtx.arc(sx, sy, largeSurround, 0, Math.PI * 2);
                classicCtx.fillStyle = '#3498db';
                classicCtx.fill();
            }

            classicCtx.beginPath();
            classicCtx.arc(leftX, y, centerRadius, 0, Math.PI * 2);
            classicCtx.fillStyle = '#e67e22';
            classicCtx.fill();

            // Right: center with small surroundings
            const smallSurround = 12;
            const smallDist = 50;
            const smallCount = 8;

            for (let i = 0; i < smallCount; i++) {
                const angle = (i / smallCount) * Math.PI * 2 - Math.PI / 2;
                const sx = rightX + Math.cos(angle) * smallDist;
                const sy = y + Math.sin(angle) * smallDist;
                classicCtx.beginPath();
                classicCtx.arc(sx, sy, smallSurround, 0, Math.PI * 2);
                classicCtx.fillStyle = '#3498db';
                classicCtx.fill();
            }

            classicCtx.beginPath();
            classicCtx.arc(rightX, y, centerRadius, 0, Math.PI * 2);
            classicCtx.fillStyle = '#e67e22';
            classicCtx.fill();

            if (showMeasure) {
                classicCtx.strokeStyle = '#e94560';
                classicCtx.lineWidth = 2;

                // Draw diameter lines
                classicCtx.beginPath();
                classicCtx.moveTo(leftX - centerRadius, y);
                classicCtx.lineTo(leftX + centerRadius, y);
                classicCtx.stroke();

                classicCtx.beginPath();
                classicCtx.moveTo(rightX - centerRadius, y);
                classicCtx.lineTo(rightX + centerRadius, y);
                classicCtx.stroke();

                // Labels
                classicCtx.fillStyle = '#e94560';
                classicCtx.font = 'bold 14px Georgia';
                classicCtx.textAlign = 'center';
                classicCtx.fillText(`${centerRadius * 2}px`, leftX, y + 50);
                classicCtx.fillText(`${centerRadius * 2}px`, rightX, y + 50);
                classicCtx.fillText('IDENTICAL!', 225, 270);
            }
        }

        function guessLeft() {
            document.getElementById('classicReveal').innerHTML =
                'You said LEFT is larger. Interesting—most people say RIGHT!';
            document.getElementById('classicReveal').classList.add('visible');
        }

        function guessRight() {
            document.getElementById('classicReveal').innerHTML =
                'You said RIGHT is larger. That\'s what most people see!';
            document.getElementById('classicReveal').classList.add('visible');
        }

        function revealClassic() {
            drawClassic(true);
            document.getElementById('classicReveal').innerHTML =
                '<strong>THEY\'RE IDENTICAL!</strong> Both orange circles have a 25-pixel radius. ' +
                'The large blue circles make the left center look SMALLER by contrast. ' +
                'The small blue circles make the right center look LARGER. Your brain was fooled!';
            document.getElementById('classicReveal').classList.add('visible');

            setTimeout(() => drawClassic(false), 5000);
        }

        // ========== SIZE MATCHER ==========
        const matchCanvas = document.getElementById('matchCanvas');
        const matchCtx = matchCanvas.getContext('2d');
        let matchRatio = 100;

        function drawMatch() {
            matchCtx.fillStyle = '#0a0a15';
            matchCtx.fillRect(0, 0, matchCanvas.width, matchCanvas.height);

            const baseRadius = 25;
            const leftRadius = baseRadius * (matchRatio / 100);
            const rightRadius = baseRadius;
            const leftX = 130;
            const rightX = 320;
            const y = 150;

            // Left: center with large surroundings (adjustable)
            const largeSurround = 45;
            const largeDist = 75;
            for (let i = 0; i < 6; i++) {
                const angle = (i / 6) * Math.PI * 2 - Math.PI / 2;
                const sx = leftX + Math.cos(angle) * largeDist;
                const sy = y + Math.sin(angle) * largeDist;
                matchCtx.beginPath();
                matchCtx.arc(sx, sy, largeSurround, 0, Math.PI * 2);
                matchCtx.fillStyle = '#3498db';
                matchCtx.fill();
            }

            matchCtx.beginPath();
            matchCtx.arc(leftX, y, leftRadius, 0, Math.PI * 2);
            matchCtx.fillStyle = '#e67e22';
            matchCtx.fill();

            // Right: center with small surroundings (fixed reference)
            const smallSurround = 12;
            const smallDist = 50;
            for (let i = 0; i < 8; i++) {
                const angle = (i / 8) * Math.PI * 2 - Math.PI / 2;
                const sx = rightX + Math.cos(angle) * smallDist;
                const sy = y + Math.sin(angle) * smallDist;
                matchCtx.beginPath();
                matchCtx.arc(sx, sy, smallSurround, 0, Math.PI * 2);
                matchCtx.fillStyle = '#3498db';
                matchCtx.fill();
            }

            matchCtx.beginPath();
            matchCtx.arc(rightX, y, rightRadius, 0, Math.PI * 2);
            matchCtx.fillStyle = '#e67e22';
            matchCtx.fill();

            // Labels
            matchCtx.fillStyle = '#a0a0a0';
            matchCtx.font = '12px Georgia';
            matchCtx.textAlign = 'center';
            matchCtx.fillText('ADJUSTABLE', leftX, y + 80);
            matchCtx.fillText('REFERENCE (fixed)', rightX, y + 80);
        }

        function updateMatch() {
            matchRatio = parseInt(document.getElementById('matchSlider').value);
            document.getElementById('matchValue').textContent = matchRatio + '%';
            drawMatch();
        }

        function checkMatch() {
            const error = matchRatio - 100;
            let message = '';

            if (Math.abs(error) <= 3) {
                message = '<strong>PERFECT!</strong> You matched them accurately despite the illusion!';
            } else if (error > 0) {
                message = `<strong>Ebbinghaus effect confirmed!</strong> You made the left circle ${error}% LARGER to compensate—because it looked smaller than it is!`;
            } else {
                message = `<strong>Unusual!</strong> You made the left circle ${Math.abs(error)}% smaller. Most people do the opposite!`;
            }

            document.getElementById('matchResult').innerHTML = message;
            document.getElementById('matchResult').classList.add('visible');
        }

        function resetMatch() {
            document.getElementById('matchSlider').value = 100;
            matchRatio = 100;
            document.getElementById('matchValue').textContent = '100%';
            document.getElementById('matchResult').classList.remove('visible');
            drawMatch();
        }

        // ========== SURROUND SIZE CONTROL ==========
        const sizeCanvas = document.getElementById('sizeCanvas');
        const sizeCtx = sizeCanvas.getContext('2d');

        function drawSurroundSize() {
            sizeCtx.fillStyle = '#0a0a15';
            sizeCtx.fillRect(0, 0, sizeCanvas.width, sizeCanvas.height);

            const centerRadius = 30;
            const leftX = 130;
            const rightX = 320;
            const y = 150;

            const leftSurround = parseInt(document.getElementById('leftSurroundSlider').value);
            const rightSurround = parseInt(document.getElementById('rightSurroundSlider').value);

            // Left
            const leftDist = Math.max(60, leftSurround + centerRadius + 10);
            for (let i = 0; i < 6; i++) {
                const angle = (i / 6) * Math.PI * 2 - Math.PI / 2;
                const sx = leftX + Math.cos(angle) * leftDist;
                const sy = y + Math.sin(angle) * leftDist;
                sizeCtx.beginPath();
                sizeCtx.arc(sx, sy, leftSurround, 0, Math.PI * 2);
                sizeCtx.fillStyle = '#3498db';
                sizeCtx.fill();
            }

            sizeCtx.beginPath();
            sizeCtx.arc(leftX, y, centerRadius, 0, Math.PI * 2);
            sizeCtx.fillStyle = '#e67e22';
            sizeCtx.fill();

            // Right
            const rightDist = Math.max(60, rightSurround + centerRadius + 10);
            for (let i = 0; i < 6; i++) {
                const angle = (i / 6) * Math.PI * 2 - Math.PI / 2;
                const sx = rightX + Math.cos(angle) * rightDist;
                const sy = y + Math.sin(angle) * rightDist;
                sizeCtx.beginPath();
                sizeCtx.arc(sx, sy, rightSurround, 0, Math.PI * 2);
                sizeCtx.fillStyle = '#3498db';
                sizeCtx.fill();
            }

            sizeCtx.beginPath();
            sizeCtx.arc(rightX, y, centerRadius, 0, Math.PI * 2);
            sizeCtx.fillStyle = '#e67e22';
            sizeCtx.fill();
        }

        function updateSurroundSize() {
            document.getElementById('leftSurroundValue').textContent = document.getElementById('leftSurroundSlider').value + 'px';
            document.getElementById('rightSurroundValue').textContent = document.getElementById('rightSurroundSlider').value + 'px';
            drawSurroundSize();
        }

        // ========== DISTANCE CONTROL ==========
        const distanceCanvas = document.getElementById('distanceCanvas');
        const distanceCtx = distanceCanvas.getContext('2d');

        function drawDistance() {
            distanceCtx.fillStyle = '#0a0a15';
            distanceCtx.fillRect(0, 0, distanceCanvas.width, distanceCanvas.height);

            const centerRadius = 25;
            const leftX = 130;
            const rightX = 320;
            const y = 150;

            const distance = parseInt(document.getElementById('distanceSlider').value);
            const count = parseInt(document.getElementById('countSlider').value);

            // Left: large surroundings
            for (let i = 0; i < count; i++) {
                const angle = (i / count) * Math.PI * 2 - Math.PI / 2;
                const sx = leftX + Math.cos(angle) * distance;
                const sy = y + Math.sin(angle) * distance;
                distanceCtx.beginPath();
                distanceCtx.arc(sx, sy, 40, 0, Math.PI * 2);
                distanceCtx.fillStyle = '#3498db';
                distanceCtx.fill();
            }

            distanceCtx.beginPath();
            distanceCtx.arc(leftX, y, centerRadius, 0, Math.PI * 2);
            distanceCtx.fillStyle = '#e67e22';
            distanceCtx.fill();

            // Right: small surroundings (same distance and count)
            for (let i = 0; i < count; i++) {
                const angle = (i / count) * Math.PI * 2 - Math.PI / 2;
                const sx = rightX + Math.cos(angle) * (distance * 0.7);
                const sy = y + Math.sin(angle) * (distance * 0.7);
                distanceCtx.beginPath();
                distanceCtx.arc(sx, sy, 12, 0, Math.PI * 2);
                distanceCtx.fillStyle = '#3498db';
                distanceCtx.fill();
            }

            distanceCtx.beginPath();
            distanceCtx.arc(rightX, y, centerRadius, 0, Math.PI * 2);
            distanceCtx.fillStyle = '#e67e22';
            distanceCtx.fill();
        }

        function updateDistance() {
            document.getElementById('distanceValue').textContent = document.getElementById('distanceSlider').value + 'px';
            document.getElementById('countValue').textContent = document.getElementById('countSlider').value;
            drawDistance();
        }

        // ========== PERCEPTION GAME ==========
        const gameCanvas = document.getElementById('gameCanvas');
        const gameCtx = gameCanvas.getContext('2d');
        let gameState = {
            active: false,
            trial: 0,
            correct: 0,
            leftRadius: 0,
            rightRadius: 0,
            correctAnswer: ''
        };

        function drawGameTrial() {
            gameCtx.fillStyle = '#0a0a15';
            gameCtx.fillRect(0, 0, gameCanvas.width, gameCanvas.height);

            const leftX = 200;
            const rightX = 600;
            const y = 150;

            // Random radii with small differences
            const baseRadius = 25;
            const diff = (Math.random() - 0.5) * 15;

            gameState.leftRadius = baseRadius + (Math.random() < 0.5 ? diff : -diff);
            gameState.rightRadius = baseRadius + (Math.random() < 0.5 ? -diff : diff);

            // Sometimes equal
            if (Math.random() < 0.2) {
                gameState.leftRadius = baseRadius;
                gameState.rightRadius = baseRadius;
            }

            // Determine answer
            const sizeDiff = gameState.leftRadius - gameState.rightRadius;
            if (Math.abs(sizeDiff) < 2) {
                gameState.correctAnswer = 'same';
            } else if (sizeDiff > 0) {
                gameState.correctAnswer = 'left';
            } else {
                gameState.correctAnswer = 'right';
            }

            // Randomize which side has large/small surroundings
            const leftLarge = Math.random() < 0.5;

            // Draw left
            const leftSurroundSize = leftLarge ? 40 : 12;
            const leftDist = leftLarge ? 75 : 50;
            const leftCount = leftLarge ? 6 : 8;

            for (let i = 0; i < leftCount; i++) {
                const angle = (i / leftCount) * Math.PI * 2 - Math.PI / 2;
                const sx = leftX + Math.cos(angle) * leftDist;
                const sy = y + Math.sin(angle) * leftDist;
                gameCtx.beginPath();
                gameCtx.arc(sx, sy, leftSurroundSize, 0, Math.PI * 2);
                gameCtx.fillStyle = '#3498db';
                gameCtx.fill();
            }

            gameCtx.beginPath();
            gameCtx.arc(leftX, y, gameState.leftRadius, 0, Math.PI * 2);
            gameCtx.fillStyle = '#e67e22';
            gameCtx.fill();

            // Draw right
            const rightSurroundSize = leftLarge ? 12 : 40;
            const rightDist = leftLarge ? 50 : 75;
            const rightCount = leftLarge ? 8 : 6;

            for (let i = 0; i < rightCount; i++) {
                const angle = (i / rightCount) * Math.PI * 2 - Math.PI / 2;
                const sx = rightX + Math.cos(angle) * rightDist;
                const sy = y + Math.sin(angle) * rightDist;
                gameCtx.beginPath();
                gameCtx.arc(sx, sy, rightSurroundSize, 0, Math.PI * 2);
                gameCtx.fillStyle = '#3498db';
                gameCtx.fill();
            }

            gameCtx.beginPath();
            gameCtx.arc(rightX, y, gameState.rightRadius, 0, Math.PI * 2);
            gameCtx.fillStyle = '#e67e22';
            gameCtx.fill();
        }

        function startGame() {
            gameState = {
                active: true,
                trial: 0,
                correct: 0,
                leftRadius: 0,
                rightRadius: 0,
                correctAnswer: ''
            };

            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('leftBtn').style.display = 'inline-block';
            document.getElementById('sameBtn').style.display = 'inline-block';
            document.getElementById('rightBtn').style.display = 'inline-block';
            document.getElementById('gameInstruction').textContent = 'Which CENTER circle is ACTUALLY larger?';

            nextGameTrial();
        }

        function nextGameTrial() {
            gameState.trial++;
            updateGameStats();
            drawGameTrial();
        }

        function gameAnswer(answer) {
            const isCorrect = answer === gameState.correctAnswer;

            if (isCorrect) {
                gameState.correct++;
            }

            gameCtx.fillStyle = isCorrect ? 'rgba(78, 205, 196, 0.3)' : 'rgba(233, 69, 96, 0.3)';
            gameCtx.fillRect(0, 0, gameCanvas.width, gameCanvas.height);

            gameCtx.fillStyle = isCorrect ? '#4ecdc4' : '#e94560';
            gameCtx.font = 'bold 20px Georgia';
            gameCtx.textAlign = 'center';

            const feedback = isCorrect ? 'CORRECT!' :
                `WRONG! L=${Math.round(gameState.leftRadius)}px, R=${Math.round(gameState.rightRadius)}px`;
            gameCtx.fillText(feedback, 400, 35);

            if (gameState.trial < 10) {
                setTimeout(nextGameTrial, 1500);
            } else {
                endGame();
            }

            updateGameStats();
        }

        function updateGameStats() {
            document.getElementById('trialNum').textContent = gameState.trial;
            document.getElementById('correctCount').textContent = gameState.correct;
            document.getElementById('accuracy').textContent = gameState.trial > 0
                ? Math.round(gameState.correct / gameState.trial * 100) + '%'
                : '0%';
        }

        function endGame() {
            gameState.active = false;

            document.getElementById('leftBtn').style.display = 'none';
            document.getElementById('sameBtn').style.display = 'none';
            document.getElementById('rightBtn').style.display = 'none';
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('startBtn').textContent = 'Play Again';

            const accuracy = Math.round(gameState.correct / 10 * 100);
            document.getElementById('gameInstruction').textContent =
                accuracy >= 80 ? `Excellent! ${accuracy}%—you've mastered the illusion!` :
                accuracy >= 50 ? `${accuracy}%—the Ebbinghaus effect tricked you sometimes!` :
                `${accuracy}%—your brain strongly fell for the surrounding context!`;
        }

        // ========== ANIMATION ==========
        const animateCanvas = document.getElementById('animateCanvas');
        const animateCtx = animateCanvas.getContext('2d');
        let animating = false;
        let animFrame;

        function drawAnimated(time) {
            animateCtx.fillStyle = '#0a0a15';
            animateCtx.fillRect(0, 0, animateCanvas.width, animateCanvas.height);

            const centerRadius = 25;
            const leftX = 130;
            const rightX = 320;
            const y = 150;

            // Oscillating surround sizes
            const phase = time * 0.002;
            const leftSurround = 30 + 20 * Math.sin(phase);
            const rightSurround = 30 + 20 * Math.sin(phase + Math.PI);

            // Left
            const leftDist = Math.max(60, leftSurround + centerRadius + 10);
            for (let i = 0; i < 6; i++) {
                const angle = (i / 6) * Math.PI * 2 - Math.PI / 2;
                const sx = leftX + Math.cos(angle) * leftDist;
                const sy = y + Math.sin(angle) * leftDist;
                animateCtx.beginPath();
                animateCtx.arc(sx, sy, leftSurround, 0, Math.PI * 2);
                animateCtx.fillStyle = '#3498db';
                animateCtx.fill();
            }

            animateCtx.beginPath();
            animateCtx.arc(leftX, y, centerRadius, 0, Math.PI * 2);
            animateCtx.fillStyle = '#e67e22';
            animateCtx.fill();

            // Right
            const rightDist = Math.max(60, rightSurround + centerRadius + 10);
            for (let i = 0; i < 6; i++) {
                const angle = (i / 6) * Math.PI * 2 - Math.PI / 2;
                const sx = rightX + Math.cos(angle) * rightDist;
                const sy = y + Math.sin(angle) * rightDist;
                animateCtx.beginPath();
                animateCtx.arc(sx, sy, rightSurround, 0, Math.PI * 2);
                animateCtx.fillStyle = '#3498db';
                animateCtx.fill();
            }

            animateCtx.beginPath();
            animateCtx.arc(rightX, y, centerRadius, 0, Math.PI * 2);
            animateCtx.fillStyle = '#e67e22';
            animateCtx.fill();

            // Show that centers are constant
            animateCtx.fillStyle = '#4ecdc4';
            animateCtx.font = '12px Georgia';
            animateCtx.textAlign = 'center';
            animateCtx.fillText('Centers NEVER change (25px each)', 225, 270);

            if (animating) {
                animFrame = requestAnimationFrame(drawAnimated);
            }
        }

        function toggleAnimation() {
            if (animating) {
                animating = false;
                cancelAnimationFrame(animFrame);
                document.getElementById('animateBtn').textContent = 'Start Animation';
                drawAnimated(0);
            } else {
                animating = true;
                document.getElementById('animateBtn').textContent = 'Stop Animation';
                animFrame = requestAnimationFrame(drawAnimated);
            }
        }

        function resetAnimation() {
            animating = false;
            cancelAnimationFrame(animFrame);
            document.getElementById('animateBtn').textContent = 'Start Animation';
            drawAnimated(0);
        }

        // ========== SHAPE VARIANTS ==========
        const variantsCanvas = document.getElementById('variantsCanvas');
        const variantsCtx = variantsCanvas.getContext('2d');
        let currentVariant = 'circles';

        function drawVariants() {
            variantsCtx.fillStyle = '#0a0a15';
            variantsCtx.fillRect(0, 0, variantsCanvas.width, variantsCanvas.height);

            const leftX = 130;
            const rightX = 320;
            const y = 150;
            const centerSize = 25;

            const drawShape = (x, y, size, color, shape) => {
                variantsCtx.fillStyle = color;

                switch(shape) {
                    case 'circles':
                        variantsCtx.beginPath();
                        variantsCtx.arc(x, y, size, 0, Math.PI * 2);
                        variantsCtx.fill();
                        break;
                    case 'squares':
                        variantsCtx.fillRect(x - size, y - size, size * 2, size * 2);
                        break;
                    case 'triangles':
                        variantsCtx.beginPath();
                        variantsCtx.moveTo(x, y - size);
                        variantsCtx.lineTo(x + size, y + size * 0.7);
                        variantsCtx.lineTo(x - size, y + size * 0.7);
                        variantsCtx.closePath();
                        variantsCtx.fill();
                        break;
                    case 'stars':
                        variantsCtx.beginPath();
                        for (let i = 0; i < 5; i++) {
                            const outerAngle = (i / 5) * Math.PI * 2 - Math.PI / 2;
                            const innerAngle = outerAngle + Math.PI / 5;
                            variantsCtx.lineTo(x + Math.cos(outerAngle) * size, y + Math.sin(outerAngle) * size);
                            variantsCtx.lineTo(x + Math.cos(innerAngle) * size * 0.4, y + Math.sin(innerAngle) * size * 0.4);
                        }
                        variantsCtx.closePath();
                        variantsCtx.fill();
                        break;
                }
            };

            // Left: large surroundings
            const largeSurround = 40;
            const largeDist = 75;
            for (let i = 0; i < 6; i++) {
                const angle = (i / 6) * Math.PI * 2 - Math.PI / 2;
                const sx = leftX + Math.cos(angle) * largeDist;
                const sy = y + Math.sin(angle) * largeDist;
                drawShape(sx, sy, largeSurround, '#3498db', currentVariant);
            }
            drawShape(leftX, y, centerSize, '#e67e22', currentVariant);

            // Right: small surroundings
            const smallSurround = 12;
            const smallDist = 50;
            for (let i = 0; i < 8; i++) {
                const angle = (i / 8) * Math.PI * 2 - Math.PI / 2;
                const sx = rightX + Math.cos(angle) * smallDist;
                const sy = y + Math.sin(angle) * smallDist;
                drawShape(sx, sy, smallSurround, '#3498db', currentVariant);
            }
            drawShape(rightX, y, centerSize, '#e67e22', currentVariant);
        }

        function setVariant(variant) {
            currentVariant = variant;
            drawVariants();
        }

        // Initialize all canvases
        drawClassic();
        drawMatch();
        drawSurroundSize();
        drawDistance();
        drawVariants();
        drawAnimated(0);

        // Initialize game canvas
        gameCtx.fillStyle = '#0a0a15';
        gameCtx.fillRect(0, 0, gameCanvas.width, gameCanvas.height);
        gameCtx.fillStyle = '#a0a0a0';
        gameCtx.font = '18px Georgia';
        gameCtx.textAlign = 'center';
        gameCtx.fillText('Click "Start Game" to test your size perception!', 400, 150);
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
