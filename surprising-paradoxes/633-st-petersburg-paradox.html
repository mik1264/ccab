<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>St. Petersburg Paradox - Infinite Expected Value</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        .back-link {
            display: inline-flex;
            align-items: center;
            color: #22c55e;
            text-decoration: none;
            margin-bottom: 15px;
            font-size: 0.95em;
        }
        .back-link:hover {
            color: #4ade80;
            text-decoration: underline;
        }
        h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
            color: #fff;
            text-shadow: 0 0 30px rgba(34, 197, 94, 0.5);
        }
        .subtitle {
            color: #4ade80;
            margin-bottom: 20px;
            font-size: 1.05em;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .main-content {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 20px;
        }
        .game-area {
            background: rgba(0,0,0,0.4);
            border-radius: 12px;
            padding: 20px;
        }
        .coin-display {
            text-align: center;
            margin-bottom: 20px;
        }
        .coin {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(145deg, #fbbf24, #d97706);
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            font-weight: bold;
            color: #1f2937;
            box-shadow: 0 8px 30px rgba(251, 191, 36, 0.3);
            transition: transform 0.3s;
        }
        .coin.flipping {
            animation: flip 0.5s ease-in-out;
        }
        @keyframes flip {
            0% { transform: rotateY(0); }
            50% { transform: rotateY(90deg); }
            100% { transform: rotateY(0); }
        }
        .flip-history {
            display: flex;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
            min-height: 40px;
            margin-bottom: 15px;
        }
        .flip-result {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            font-weight: bold;
        }
        .flip-result.tails {
            background: #64748b;
            color: white;
        }
        .flip-result.heads {
            background: #22c55e;
            color: white;
        }
        .payout-display {
            font-size: 2.5em;
            font-weight: bold;
            color: #22c55e;
            text-align: center;
            margin: 20px 0;
        }
        .payout-display.zero {
            color: #64748b;
        }
        .game-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .panel {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .panel h3 {
            font-size: 0.9em;
            color: #22c55e;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.2s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(34, 197, 94, 0.4);
        }
        .btn-primary:disabled {
            background: #475569;
            cursor: not-allowed;
            transform: none;
        }
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #e0e0e0;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .btn-secondary:hover {
            background: rgba(255,255,255,0.2);
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .stat-label {
            color: #4ade80;
            font-size: 0.85em;
        }
        .stat-value {
            color: #86efac;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.9em;
        }
        .infinity {
            color: #f87171 !important;
            font-weight: bold;
        }
        .theory-box {
            background: rgba(0,0,0,0.3);
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
        }
        .formula {
            font-family: 'Monaco', 'Consolas', monospace;
            color: #86efac;
            font-size: 0.85em;
            line-height: 1.8;
            text-align: center;
        }
        .chart-container {
            margin-top: 20px;
        }
        canvas {
            border-radius: 8px;
            background: rgba(0,0,0,0.3);
        }
        .exp-section {
            margin-top: 20px;
        }
        .exp-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }
        .exp-card {
            background: linear-gradient(135deg, rgba(34,197,94,0.1), rgba(22,163,74,0.05));
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(34,197,94,0.2);
        }
        .exp-card h4 {
            color: #22c55e;
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        .exp-card p {
            font-size: 0.85em;
            line-height: 1.6;
            color: #4ade80;
        }
        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">← Back to Paradoxes</a>
        <h1>The St. Petersburg Paradox</h1>
        <p class="subtitle">A Game Worth INFINITE Dollars... That Nobody Would Pay Much For</p>

        <div class="main-content">
            <div class="game-area">
                <div class="coin-display">
                    <div class="coin" id="coin">?</div>
                    <div class="flip-history" id="flipHistory"></div>
                </div>

                <div class="payout-display zero" id="payout">Play to win!</div>

                <div class="game-controls">
                    <button class="btn btn-primary" id="playBtn">Play ($1)</button>
                    <button class="btn btn-secondary" id="play100Btn">Play 100 games</button>
                    <button class="btn btn-secondary" id="resetBtn">Reset</button>
                </div>

                <div class="chart-container">
                    <canvas id="chart" width="700" height="250"></canvas>
                </div>
            </div>

            <div class="sidebar">
                <div class="panel">
                    <h3>The Game Rules</h3>
                    <p style="font-size: 0.85em; color: #4ade80; line-height: 1.6;">
                        1. Pay <strong>$1</strong> to play<br>
                        2. Flip a fair coin repeatedly<br>
                        3. When HEADS appears, you win <strong>$2<sup>n</sup></strong> where n = number of flips<br><br>
                        First flip heads? Win $2.<br>
                        Two tails then heads? Win $8.
                    </p>
                </div>

                <div class="panel">
                    <h3>Your Statistics</h3>
                    <div class="stat-row">
                        <span class="stat-label">Games played</span>
                        <span id="gamesPlayed" class="stat-value">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Total cost</span>
                        <span id="totalCost" class="stat-value">$0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Total winnings</span>
                        <span id="totalWin" class="stat-value">$0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Net profit</span>
                        <span id="netProfit" class="stat-value">$0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Average win</span>
                        <span id="avgWin" class="stat-value">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Biggest win</span>
                        <span id="biggestWin" class="stat-value">$0</span>
                    </div>
                </div>

                <div class="panel">
                    <h3>The Paradox</h3>
                    <div class="stat-row">
                        <span class="stat-label">Expected value</span>
                        <span class="stat-value infinity">∞ INFINITE!</span>
                    </div>
                    <div class="theory-box">
                        <div class="formula">
                            E[X] = ½×2 + ¼×4 + ⅛×8 + ...<br>
                            = 1 + 1 + 1 + 1 + ...<br>
                            = ∞
                        </div>
                    </div>
                    <p style="font-size: 0.8em; color: #64748b; margin-top: 10px;">
                        Yet most people wouldn't pay more than $10-20!
                    </p>
                </div>

                <div class="panel">
                    <h3>Bernoulli's Resolution</h3>
                    <p style="font-size: 0.8em; color: #4ade80; line-height: 1.6;">
                        Daniel Bernoulli (1738) proposed using <strong>utility</strong> instead of money: U = log(wealth). With logarithmic utility, expected utility is FINITE (~$4). But why should utility be logarithmic?
                    </p>
                </div>
            </div>
        </div>

        <div class="exp-section">
            <div class="exp-cards">
                <div class="exp-card">
                    <h4>Nicolas Bernoulli (1713)</h4>
                    <p>Swiss mathematician Nicolas Bernoulli invented this puzzle in private letters. His cousin Daniel Bernoulli published it in 1738 in the St. Petersburg Academy's journal—hence the name. It challenged the newly-formed probability theory's foundation!</p>
                </div>
                <div class="exp-card">
                    <h4>Why Infinite?</h4>
                    <p>Each term in the sum is exactly 1: (½×2) + (¼×4) + (⅛×8)... The probability halves but the payout doubles—they cancel! You're adding 1 forever. The expected value diverges to infinity, yet rare huge payouts dominate a quantity nobody experiences.</p>
                </div>
                <div class="exp-card">
                    <h4>The Utility Solution</h4>
                    <p>Bernoulli argued we don't value money linearly. The 1000th dollar means less than the 1st. If utility = log(money), expected utility converges to about $4. This was the birth of expected utility theory—foundation of modern economics!</p>
                </div>
                <div class="exp-card">
                    <h4>Still Unsolved!</h4>
                    <p>Change payoffs to 2^(2^n) and the paradox returns even with log utility! Some propose bounded utility, but why that bound? Others cite finite casino wealth, finite time, or probability weighting. After 300 years, philosophers still debate it!</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('chart');
        const ctx = canvas.getContext('2d');

        // State
        let gamesPlayed = 0;
        let totalCost = 0;
        let totalWinnings = 0;
        let biggestWin = 0;
        let winHistory = [];
        let avgHistory = [];
        let playing = false;

        // Play one game
        function playGame() {
            let flips = 0;
            let result;

            // Clear previous
            document.getElementById('flipHistory').innerHTML = '';

            // Flip until heads
            do {
                flips++;
                result = Math.random() < 0.5 ? 'heads' : 'tails';

                // Show flip
                const flipEl = document.createElement('div');
                flipEl.className = `flip-result ${result}`;
                flipEl.textContent = result === 'heads' ? 'H' : 'T';
                document.getElementById('flipHistory').appendChild(flipEl);

            } while (result === 'tails' && flips < 30); // Cap at 30 for display

            // Calculate payout
            const payout = Math.pow(2, flips);

            // Update state
            gamesPlayed++;
            totalCost += 1;
            totalWinnings += payout;
            biggestWin = Math.max(biggestWin, payout);
            winHistory.push(payout);
            avgHistory.push(totalWinnings / gamesPlayed);

            // Trim history for performance
            if (winHistory.length > 500) {
                winHistory = winHistory.slice(-500);
                avgHistory = avgHistory.slice(-500);
            }

            return payout;
        }

        function updateDisplay(payout) {
            // Coin animation
            const coin = document.getElementById('coin');
            coin.classList.add('flipping');
            setTimeout(() => {
                coin.textContent = 'H';
                coin.classList.remove('flipping');
            }, 250);

            // Payout
            const payoutEl = document.getElementById('payout');
            payoutEl.textContent = `Won $${payout.toLocaleString()}!`;
            payoutEl.classList.remove('zero');

            // Stats
            document.getElementById('gamesPlayed').textContent = gamesPlayed;
            document.getElementById('totalCost').textContent = `$${totalCost}`;
            document.getElementById('totalWin').textContent = `$${totalWinnings.toLocaleString()}`;

            const profit = totalWinnings - totalCost;
            const profitEl = document.getElementById('netProfit');
            profitEl.textContent = `$${profit.toLocaleString()}`;
            profitEl.style.color = profit >= 0 ? '#22c55e' : '#f87171';

            document.getElementById('avgWin').textContent = `$${(totalWinnings / gamesPlayed).toFixed(2)}`;
            document.getElementById('biggestWin').textContent = `$${biggestWin.toLocaleString()}`;

            drawChart();
        }

        function drawChart() {
            const w = canvas.width;
            const h = canvas.height;

            ctx.fillStyle = 'rgba(0,0,0,0.3)';
            ctx.fillRect(0, 0, w, h);

            if (avgHistory.length < 2) return;

            const padding = 40;
            const chartW = w - 2 * padding;
            const chartH = h - 2 * padding;

            // Find y range for average
            const maxAvg = Math.max(...avgHistory, 10);
            const minAvg = 0;

            // Draw axes
            ctx.strokeStyle = 'rgba(255,255,255,0.2)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, h - padding);
            ctx.lineTo(w - padding, h - padding);
            ctx.stroke();

            // Labels
            ctx.fillStyle = '#4ade80';
            ctx.font = '11px Monaco, Consolas, monospace';
            ctx.textAlign = 'right';
            ctx.fillText(maxAvg.toFixed(0), padding - 5, padding + 5);
            ctx.fillText('0', padding - 5, h - padding);
            ctx.textAlign = 'center';
            ctx.fillText('Games', w / 2, h - 10);
            ctx.fillText('Average Payout', w / 2, 15);

            // Draw "true" expected value indicator (joke - it's infinite)
            ctx.strokeStyle = 'rgba(248, 113, 113, 0.3)';
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(w - padding, padding);
            ctx.stroke();
            ctx.setLineDash([]);
            ctx.fillStyle = '#f87171';
            ctx.textAlign = 'left';
            ctx.fillText('E[X] = ∞', w - padding + 5, padding + 5);

            // Draw average line
            ctx.strokeStyle = '#22c55e';
            ctx.lineWidth = 2;
            ctx.beginPath();

            for (let i = 0; i < avgHistory.length; i++) {
                const x = padding + (i / (avgHistory.length - 1)) * chartW;
                const y = h - padding - (avgHistory[i] / maxAvg) * chartH;

                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();

            // Current average point
            if (avgHistory.length > 0) {
                const lastAvg = avgHistory[avgHistory.length - 1];
                const lastX = w - padding;
                const lastY = h - padding - (lastAvg / maxAvg) * chartH;

                ctx.fillStyle = '#22c55e';
                ctx.beginPath();
                ctx.arc(lastX, lastY, 5, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function reset() {
            gamesPlayed = 0;
            totalCost = 0;
            totalWinnings = 0;
            biggestWin = 0;
            winHistory = [];
            avgHistory = [];

            document.getElementById('flipHistory').innerHTML = '';
            document.getElementById('coin').textContent = '?';
            document.getElementById('payout').textContent = 'Play to win!';
            document.getElementById('payout').classList.add('zero');
            document.getElementById('gamesPlayed').textContent = '0';
            document.getElementById('totalCost').textContent = '$0';
            document.getElementById('totalWin').textContent = '$0';
            document.getElementById('netProfit').textContent = '$0';
            document.getElementById('netProfit').style.color = '#86efac';
            document.getElementById('avgWin').textContent = '-';
            document.getElementById('biggestWin').textContent = '$0';

            drawChart();
        }

        // Event handlers
        document.getElementById('playBtn').addEventListener('click', () => {
            const payout = playGame();
            updateDisplay(payout);
        });

        document.getElementById('play100Btn').addEventListener('click', () => {
            for (let i = 0; i < 100; i++) {
                playGame();
            }
            updateDisplay(winHistory[winHistory.length - 1]);
        });

        document.getElementById('resetBtn').addEventListener('click', reset);

        // Initial draw
        drawChart();
    </script>
</body>
</html>
