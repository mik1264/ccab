<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Friendship Paradox - Your Friends Are More Popular Than You</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #2d1f3d 0%, #1a1525 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 30px; }
        .back-link { color: #c9a0dc; text-decoration: none; margin-bottom: 20px; display: inline-block; }
        h1 {
            font-size: 2.4rem;
            background: linear-gradient(135deg, #f472b6, #a855f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        .subtitle { font-size: 1.1rem; color: #c9a0dc; max-width: 750px; margin: 0 auto; line-height: 1.6; }
        .main-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 30px; margin-bottom: 30px; }
        .panel {
            background: rgba(50, 35, 65, 0.6);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(200, 160, 220, 0.3);
        }
        .panel h2 { color: #f472b6; font-size: 1.3rem; margin-bottom: 15px; }
        canvas { width: 100%; height: 400px; background: rgba(25, 20, 35, 0.6); border-radius: 10px; }
        .controls { display: flex; gap: 15px; margin: 20px 0; justify-content: center; flex-wrap: wrap; }
        .control-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.3s;
        }
        .control-btn.primary { background: linear-gradient(135deg, #f472b6, #a855f7); color: white; }
        .control-btn.secondary { background: rgba(200, 160, 220, 0.3); color: #c9a0dc; border: 1px solid rgba(200, 160, 220, 0.5); }
        .control-btn:hover { transform: scale(1.05); }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .stat-box { background: rgba(25, 20, 35, 0.6); padding: 15px; border-radius: 10px; text-align: center; }
        .stat-value { font-size: 1.6rem; font-weight: bold; color: #f472b6; }
        .stat-label { color: #c9a0dc; font-size: 0.85rem; margin-top: 5px; }
        .person-info { margin-top: 20px; }
        .person-card {
            background: rgba(25, 20, 35, 0.6);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #f472b6;
        }
        .person-name { color: #f472b6; font-weight: bold; }
        .person-stats { color: #c9a0dc; font-size: 0.9rem; margin-top: 5px; }
        .paradox-result {
            text-align: center;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
        }
        .paradox-result.worse { background: rgba(244, 114, 182, 0.2); border: 2px solid #f472b6; }
        .insight-box {
            background: linear-gradient(135deg, rgba(244, 114, 182, 0.2), rgba(168, 85, 247, 0.1));
            border-left: 4px solid #f472b6;
            padding: 20px;
            border-radius: 0 10px 10px 0;
            margin: 25px 0;
        }
        .insight-box h3 { color: #a855f7; margin-bottom: 10px; }
        .explanation { background: rgba(50, 35, 65, 0.4); border-radius: 15px; padding: 25px; margin-top: 30px; }
        .explanation h2 { color: #f472b6; margin-bottom: 15px; }
        .explanation p { color: #d0b8e0; line-height: 1.8; margin-bottom: 15px; }
        @media (max-width: 900px) { .main-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-link">Back to Surprising Paradoxes</a>
            <h1>The Friendship Paradox</h1>
            <p class="subtitle">On average, your friends have MORE friends than you do. This is mathematically guaranteed, not bad luck!</p>
        </header>

        <div class="main-grid">
            <div class="panel">
                <h2>Social Network</h2>
                <canvas id="networkCanvas"></canvas>
                <div class="controls">
                    <button class="control-btn primary" id="generateBtn">Generate New Network</button>
                    <button class="control-btn secondary" id="highlightBtn">Highlight Random Person</button>
                </div>
            </div>
            <div class="panel">
                <h2>Statistics</h2>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="avgFriends">0</div>
                        <div class="stat-label">Avg Friends per Person</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="avgFriendsOfFriends">0</div>
                        <div class="stat-label">Avg Friends of Friends</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="paradoxPercent">0%</div>
                        <div class="stat-label">Have Fewer than Friends</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="networkSize">0</div>
                        <div class="stat-label">People in Network</div>
                    </div>
                </div>

                <div class="paradox-result worse" id="paradoxResult">
                    <div style="font-size: 1.5rem; color: #f472b6; font-weight: bold;">The Paradox is Real!</div>
                    <div style="color: #c9a0dc; margin-top: 10px;">Friends' average exceeds your average</div>
                </div>

                <div class="person-info" id="personInfo">
                    <h3 style="color: #a855f7; margin-bottom: 10px;">Click a node to see details</h3>
                </div>
            </div>
        </div>

        <div class="insight-box">
            <h3>Why Does This Happen?</h3>
            <p>Popular people (with many friends) appear in MANY friend lists. When you average your friends' friend counts, these popular people inflate the average. It's a sampling bias: you're more likely to be friends with someone who has lots of friends!</p>
        </div>

        <div class="explanation">
            <h2>The Discovery</h2>
            <p>In 1991, sociologist <strong>Scott L. Feld</strong> published "Why Your Friends Have More Friends Than You Do." Analyzing classroom surveys, he found that <strong>84% of students had fewer friends than their average friend!</strong></p>
            <p><strong>The Generalized Paradox:</strong> Your friends are also probably richer, happier, and better-looking than you on average. Popular people appear more often in your sample.</p>
            <p><strong>Applications:</strong> This paradox is used for disease surveillance (sample friends of random people to find outbreaks faster) and understanding social media dynamics (your feed seems full of successful people).</p>
            <p style="font-style: italic; color: #a090c0;">The friendship paradox explains why social media makes people feel inadequate: you're comparing yourself to a biased sample of unusually successful connections!</p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('networkCanvas');
        const ctx = canvas.getContext('2d');
        let nodes = [];
        let edges = [];
        let selectedNode = null;

        function initCanvas() {
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
        }

        function generateNetwork(numNodes) {
            nodes = [];
            edges = [];
            const width = canvas.width / (window.devicePixelRatio || 1);
            const height = canvas.height / (window.devicePixelRatio || 1);

            // Create nodes with random positions
            for (let i = 0; i < numNodes; i++) {
                nodes.push({
                    id: i,
                    x: 50 + Math.random() * (width - 100),
                    y: 50 + Math.random() * (height - 100),
                    friends: [],
                    vx: 0,
                    vy: 0
                });
            }

            // Create edges with preferential attachment (power law)
            var degrees = new Array(numNodes).fill(1);
            for (let i = 0; i < numNodes * 2; i++) {
                // Pick source randomly
                var source = Math.floor(Math.random() * numNodes);
                
                // Pick target with preferential attachment
                var totalDegree = degrees.reduce(function(a, b) { return a + b; }, 0);
                var r = Math.random() * totalDegree;
                var cumulative = 0;
                var target = 0;
                for (var j = 0; j < numNodes; j++) {
                    cumulative += degrees[j];
                    if (cumulative >= r) {
                        target = j;
                        break;
                    }
                }

                if (source !== target && !nodes[source].friends.includes(target)) {
                    nodes[source].friends.push(target);
                    nodes[target].friends.push(source);
                    edges.push([source, target]);
                    degrees[source]++;
                    degrees[target]++;
                }
            }

            // Simple force layout
            for (let iter = 0; iter < 50; iter++) {
                for (let i = 0; i < nodes.length; i++) {
                    nodes[i].vx = 0;
                    nodes[i].vy = 0;

                    // Repulsion from other nodes
                    for (let j = 0; j < nodes.length; j++) {
                        if (i !== j) {
                            var dx = nodes[i].x - nodes[j].x;
                            var dy = nodes[i].y - nodes[j].y;
                            var dist = Math.sqrt(dx * dx + dy * dy) + 1;
                            var force = 500 / (dist * dist);
                            nodes[i].vx += (dx / dist) * force;
                            nodes[i].vy += (dy / dist) * force;
                        }
                    }

                    // Attraction to friends
                    for (var k = 0; k < nodes[i].friends.length; k++) {
                        var friend = nodes[i].friends[k];
                        var dx2 = nodes[friend].x - nodes[i].x;
                        var dy2 = nodes[friend].y - nodes[i].y;
                        var dist2 = Math.sqrt(dx2 * dx2 + dy2 * dy2) + 1;
                        nodes[i].vx += dx2 * 0.01;
                        nodes[i].vy += dy2 * 0.01;
                    }
                }

                // Apply velocities
                for (let i = 0; i < nodes.length; i++) {
                    nodes[i].x += nodes[i].vx;
                    nodes[i].y += nodes[i].vy;
                    nodes[i].x = Math.max(30, Math.min(width - 30, nodes[i].x));
                    nodes[i].y = Math.max(30, Math.min(height - 30, nodes[i].y));
                }
            }

            calculateStats();
            draw();
        }

        function calculateStats() {
            var totalFriends = 0;
            var totalFriendsOfFriends = 0;
            var totalFriendsOfFriendsCount = 0;
            var lessThanAvgCount = 0;

            for (var i = 0; i < nodes.length; i++) {
                var myFriends = nodes[i].friends.length;
                totalFriends += myFriends;

                var friendsSum = 0;
                for (var j = 0; j < nodes[i].friends.length; j++) {
                    friendsSum += nodes[nodes[i].friends[j]].friends.length;
                }

                if (nodes[i].friends.length > 0) {
                    var avgFriendsOfMyFriends = friendsSum / nodes[i].friends.length;
                    totalFriendsOfFriends += avgFriendsOfMyFriends;
                    totalFriendsOfFriendsCount++;

                    if (myFriends < avgFriendsOfMyFriends) {
                        lessThanAvgCount++;
                    }
                }
            }

            var avgFriends = totalFriends / nodes.length;
            var avgFoF = totalFriendsOfFriends / totalFriendsOfFriendsCount;
            var paradoxPct = (lessThanAvgCount / totalFriendsOfFriendsCount) * 100;

            document.getElementById('avgFriends').textContent = avgFriends.toFixed(1);
            document.getElementById('avgFriendsOfFriends').textContent = avgFoF.toFixed(1);
            document.getElementById('paradoxPercent').textContent = paradoxPct.toFixed(0) + '%';
            document.getElementById('networkSize').textContent = nodes.length;
        }

        function draw() {
            var width = canvas.width / (window.devicePixelRatio || 1);
            var height = canvas.height / (window.devicePixelRatio || 1);
            ctx.clearRect(0, 0, width, height);

            // Draw edges
            ctx.strokeStyle = 'rgba(200, 160, 220, 0.3)';
            ctx.lineWidth = 1;
            for (var i = 0; i < edges.length; i++) {
                var edge = edges[i];
                ctx.beginPath();
                ctx.moveTo(nodes[edge[0]].x, nodes[edge[0]].y);
                ctx.lineTo(nodes[edge[1]].x, nodes[edge[1]].y);
                ctx.stroke();
            }

            // Draw nodes
            for (var j = 0; j < nodes.length; j++) {
                var node = nodes[j];
                var size = 5 + node.friends.length * 1.5;
                
                if (node === selectedNode) {
                    ctx.fillStyle = '#a855f7';
                    ctx.strokeStyle = '#f472b6';
                    ctx.lineWidth = 3;
                } else if (selectedNode && selectedNode.friends.includes(node.id)) {
                    ctx.fillStyle = '#f472b6';
                    ctx.strokeStyle = '#fff';
                    ctx.lineWidth = 2;
                } else {
                    ctx.fillStyle = '#c9a0dc';
                    ctx.strokeStyle = 'rgba(0,0,0,0)';
                    ctx.lineWidth = 0;
                }

                ctx.beginPath();
                ctx.arc(node.x, node.y, size, 0, Math.PI * 2);
                ctx.fill();
                if (ctx.lineWidth > 0) ctx.stroke();
            }
        }

        function showPersonInfo(node) {
            var friendsSum = 0;
            for (var i = 0; i < node.friends.length; i++) {
                friendsSum += nodes[node.friends[i]].friends.length;
            }
            var avgFoF = node.friends.length > 0 ? (friendsSum / node.friends.length).toFixed(1) : 0;
            var comparison = node.friends.length < avgFoF ? 'FEWER' : 'more';
            var color = node.friends.length < avgFoF ? '#f472b6' : '#4ecdc4';

            var html = '<div class="person-card">';
            html += '<div class="person-name">Person #' + node.id + '</div>';
            html += '<div class="person-stats">';
            html += 'Has <strong>' + node.friends.length + '</strong> friends<br>';
            html += 'Friends avg: <strong>' + avgFoF + '</strong> friends<br>';
            html += '<span style="color: ' + color + '">Has ' + comparison + ' friends than their average friend!</span>';
            html += '</div></div>';

            document.getElementById('personInfo').innerHTML = html;
        }

        canvas.addEventListener('click', function(e) {
            var rect = canvas.getBoundingClientRect();
            var x = e.clientX - rect.left;
            var y = e.clientY - rect.top;

            selectedNode = null;
            for (var i = 0; i < nodes.length; i++) {
                var dx = nodes[i].x - x;
                var dy = nodes[i].y - y;
                if (Math.sqrt(dx * dx + dy * dy) < 15) {
                    selectedNode = nodes[i];
                    break;
                }
            }

            if (selectedNode) {
                showPersonInfo(selectedNode);
            }
            draw();
        });

        document.getElementById('generateBtn').addEventListener('click', function() {
            generateNetwork(30);
        });

        document.getElementById('highlightBtn').addEventListener('click', function() {
            if (nodes.length > 0) {
                selectedNode = nodes[Math.floor(Math.random() * nodes.length)];
                showPersonInfo(selectedNode);
                draw();
            }
        });

        window.addEventListener('load', function() {
            initCanvas();
            generateNetwork(30);
        });

        window.addEventListener('resize', function() {
            initCanvas();
            draw();
        });
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
