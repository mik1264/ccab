<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Cheerios Effect - Why Floating Objects Attract</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 30px; }
        .back-link {
            color: #ff6b6b;
            text-decoration: none;
            margin-bottom: 20px;
            display: inline-block;
        }
        h1 {
            font-size: 2.3rem;
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e, #f39c12);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        .subtitle {
            font-size: 1rem;
            color: #a0c4ff;
            max-width: 850px;
            margin: 0 auto;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 340px;
            gap: 25px;
            margin-bottom: 30px;
        }
        @media (max-width: 900px) {
            .main-grid { grid-template-columns: 1fr; }
        }

        .panel {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .bowl-container {
            position: relative;
            width: 100%;
            aspect-ratio: 1;
            max-width: 600px;
            margin: 0 auto;
        }
        #bowl {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(ellipse at center, #e8f4f8 0%, #d4e9f0 40%, #b8d4e3 70%, #8fb8cc 100%);
            box-shadow: inset 0 20px 60px rgba(0,0,0,0.2), 0 10px 30px rgba(0,0,0,0.3);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        #bowlCanvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%;
            height: 100%;
        }

        .view-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .view-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: #e0e0e0;
            cursor: pointer;
            transition: all 0.3s;
        }
        .view-btn.active {
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
            color: #1a1a2e;
        }

        .control-group {
            margin-bottom: 15px;
        }
        .control-group label {
            display: block;
            margin-bottom: 5px;
            color: #a0c4ff;
            font-size: 0.9rem;
        }
        .control-group input[type="range"] {
            width: 100%;
        }
        .control-value {
            text-align: right;
            font-size: 0.85rem;
            color: #fdcb6e;
        }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            margin-bottom: 10px;
            transition: all 0.3s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
            color: #1a1a2e;
        }
        .btn-secondary {
            background: rgba(255,255,255,0.15);
            color: #e0e0e0;
        }
        .btn:hover { transform: translateY(-2px); }

        .legend {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
        }
        .legend h4 {
            color: #fdcb6e;
            margin-bottom: 10px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            font-size: 0.85rem;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .side-view-container {
            margin-top: 20px;
            height: 150px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }
        #sideCanvas {
            width: 100%;
            height: 100%;
        }

        .physics-box {
            background: linear-gradient(135deg, rgba(253,203,110,0.1), rgba(255,234,167,0.05));
            border: 1px solid rgba(253,203,110,0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }
        .physics-box h4 {
            color: #fdcb6e;
            margin-bottom: 10px;
        }
        .force-display {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        .force-value {
            color: #ffeaa7;
        }

        .research-section {
            background: rgba(255,255,255,0.03);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            border: 1px solid rgba(255,255,255,0.08);
        }
        .research-section h2 {
            color: #fdcb6e;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        .research-section h3 {
            color: #a0c4ff;
            margin: 20px 0 10px;
            font-size: 1.15rem;
        }
        .research-section p {
            margin-bottom: 12px;
            color: #c0c0c0;
        }
        .key-point {
            background: rgba(253,203,110,0.1);
            border-left: 3px solid #fdcb6e;
            padding: 10px 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        .quote {
            font-style: italic;
            border-left: 3px solid #a0c4ff;
            padding-left: 15px;
            margin: 15px 0;
            color: #b0b0b0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-link">← Back to Surprising Paradoxes</a>
            <h1>The Cheerios Effect</h1>
            <p class="subtitle">Why do floating objects attract each other? It's not magnetism—it's surface tension creating invisible "hills" and "valleys" that objects roll down toward each other!</p>
        </header>

        <div class="main-grid">
            <div class="panel">
                <div class="view-toggle">
                    <button class="view-btn active" id="topViewBtn">Top View</button>
                    <button class="view-btn" id="physicsViewBtn">Physics View</button>
                </div>

                <div class="bowl-container">
                    <div id="bowl">
                        <canvas id="bowlCanvas"></canvas>
                    </div>
                </div>

                <p style="text-align: center; margin-top: 10px; color: #a0c4ff; font-size: 0.9rem;">
                    Click in the bowl to add Cheerios. Watch them drift together!
                </p>

                <div class="side-view-container">
                    <canvas id="sideCanvas"></canvas>
                </div>
                <p style="text-align: center; margin-top: 5px; color: #888; font-size: 0.8rem;">
                    Side view: Meniscus curves around each floating object
                </p>
            </div>

            <div class="panel">
                <h3 style="color: #fdcb6e; margin-bottom: 15px;">Controls</h3>

                <div class="control-group">
                    <label>Surface Tension: <span id="tensionValue">72</span> mN/m</label>
                    <input type="range" id="tension" min="20" max="100" value="72">
                    <div class="control-value">Water ≈ 72, Milk ≈ 45</div>
                </div>

                <div class="control-group">
                    <label>Cheerio Density: <span id="densityValue">0.6</span> g/cm³</label>
                    <input type="range" id="density" min="0.3" max="0.95" value="0.6" step="0.05">
                    <div class="control-value">Light floats high, heavy sinks low</div>
                </div>

                <div class="control-group">
                    <label>Viscosity (Drag): <span id="viscosityValue">1.0</span></label>
                    <input type="range" id="viscosity" min="0.1" max="3" value="1" step="0.1">
                </div>

                <button class="btn btn-primary" id="addCheerios">Add 5 Cheerios</button>
                <button class="btn btn-secondary" id="clearBowl">Clear Bowl</button>
                <button class="btn btn-secondary" id="toggleMeniscus">Show Meniscus Lines</button>

                <div class="legend">
                    <h4>What You're Seeing</h4>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #d4a24a;"></div>
                        <span>Cheerios (create downward meniscus)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: rgba(100,180,255,0.5); border: 2px dashed #64b4ff;"></div>
                        <span>Meniscus depression zone</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(to right, #64b4ff, transparent);"></div>
                        <span>Wall meniscus (curves up)</span>
                    </div>
                </div>

                <div class="physics-box">
                    <h4>Live Physics</h4>
                    <div class="force-display">
                        <span>Objects in bowl:</span>
                        <span class="force-value" id="objectCount">0</span>
                    </div>
                    <div class="force-display">
                        <span>Avg. attraction force:</span>
                        <span class="force-value" id="avgForce">0.0 μN</span>
                    </div>
                    <div class="force-display">
                        <span>Clusters formed:</span>
                        <span class="force-value" id="clusterCount">0</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="research-section">
            <h2>The Science Behind the Cheerios Effect</h2>

            <p>Every morning, millions of people witness a fundamental physics phenomenon without realizing it: their breakfast cereal clumps together and drifts toward the bowl's edge. This is the <strong>Cheerios Effect</strong>, named in a 2005 paper by Harvard physicists Dominic Vella and L. Mahadevan.</p>

            <h3>Why It Happens: Surface Tension Geometry</h3>

            <p>When a Cheerio floats on milk, it creates a tiny depression in the liquid surface—a <em>meniscus</em>. This happens because:</p>

            <div class="key-point">
                <strong>The Key Insight:</strong> Surface tension acts like an elastic sheet. A floating object either pushes down (if denser than the liquid) or pushes up (if buoyant). Either way, it deforms the surface—and objects naturally "roll" toward each other down these curved surfaces to minimize energy.
            </div>

            <p>The milk's surface isn't flat—it curves around each floating object. Two nearby Cheerios sit in each other's "valleys," so they naturally drift together like balls rolling toward the lowest point of a curved surface.</p>

            <h3>The Wall Effect</h3>

            <p>Why do Cheerios cluster at the bowl's edge? The bowl wall creates its own meniscus. If the liquid "wets" the wall (like milk wetting ceramic), the surface curves <em>upward</em> at the edge. A floating Cheerio, riding on top of the surface, naturally slides uphill toward the wall—seemingly defying gravity!</p>

            <div class="quote">
                "The Cheerios effect is a capillary interaction that causes floating objects to attract or repel each other... Objects that deform the surface in the same direction attract; objects that deform it in opposite directions repel."<br>
                — Vella & Mahadevan, American Journal of Physics (2005)
            </div>

            <h3>Attraction vs. Repulsion</h3>

            <p>Not all floating objects attract! The rule is simple:</p>
            <ul style="margin: 10px 0 10px 30px; color: #c0c0c0;">
                <li><strong>Same sign = Attraction:</strong> Two heavy objects (both push down) or two light objects (both push up) attract</li>
                <li><strong>Opposite signs = Repulsion:</strong> A heavy object and a light object repel each other</li>
            </ul>

            <p>This is because one creates an "uphill" while the other creates a "downhill"—they have nowhere stable to meet!</p>

            <h3>Beyond Breakfast: Real-World Applications</h3>

            <p><strong>Water Striders:</strong> These insects exploit the Cheerios effect. Their legs create upward menisci, and they can sense the surface deformations caused by prey—essentially "feeling" disturbances in the water's surface tension.</p>

            <p><strong>Self-Assembly:</strong> Engineers use the Cheerios effect to make tiny particles arrange themselves into patterns without any external manipulation. This is crucial for nanotechnology and fabricating microelectronic components.</p>

            <p><strong>Oil Spill Cleanup:</strong> Understanding how floating particles cluster helps design better methods for collecting oil droplets on water surfaces.</p>

            <h3>The Mathematics</h3>

            <p>The attractive force between two floating cylinders of radius <em>r</em> at distance <em>d</em> apart is approximately:</p>

            <div class="key-point">
                F ≈ 2πγr²sin²(θ) × K₁(d/Lc) / Lc
                <br><br>
                Where γ = surface tension, θ = contact angle, K₁ = modified Bessel function, and Lc = capillary length (~2.7mm for water)
            </div>

            <p>The capillary length sets the scale: objects closer than ~3mm experience significant attraction. This is why you don't see ships pulling together in the ocean—they're far too large for capillary forces to matter!</p>

            <h3>Try This Experiment</h3>

            <p>Float two toothpicks parallel to each other in water. They'll slowly drift together. Now add a drop of dish soap between them—watch them fly apart! The soap reduces surface tension unevenly, breaking the symmetry and creating a repulsive force.</p>
        </div>
    </div>

    <script>
        const bowlCanvas = document.getElementById('bowlCanvas');
        const sideCanvas = document.getElementById('sideCanvas');
        const bowlCtx = bowlCanvas.getContext('2d');
        const sideCtx = sideCanvas.getContext('2d');

        let cheerios = [];
        let showMeniscus = false;
        let physicsView = false;

        // Parameters
        let surfaceTension = 72;
        let cheerioRadius = 15;
        let cheerioDensity = 0.6;
        let viscosity = 1.0;

        // Bowl properties
        let bowlCenterX, bowlCenterY, bowlRadius;

        function resizeCanvases() {
            const bowl = document.getElementById('bowl');
            const rect = bowl.getBoundingClientRect();
            bowlCanvas.width = rect.width;
            bowlCanvas.height = rect.height;
            bowlCenterX = bowlCanvas.width / 2;
            bowlCenterY = bowlCanvas.height / 2;
            bowlRadius = Math.min(bowlCenterX, bowlCenterY) - 10;

            const sideRect = sideCanvas.parentElement.getBoundingClientRect();
            sideCanvas.width = sideRect.width;
            sideCanvas.height = sideRect.height;
        }

        class Cheerio {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.vx = 0;
                this.vy = 0;
                this.radius = cheerioRadius + (Math.random() - 0.5) * 4;
                this.rotation = Math.random() * Math.PI * 2;
                this.density = cheerioDensity + (Math.random() - 0.5) * 0.1;
                // Meniscus depth depends on density
                this.meniscusDepth = (this.density - 0.5) * 5;
            }

            update(dt) {
                // Calculate forces
                let fx = 0, fy = 0;

                // Attraction to other cheerios (Cheerios effect!)
                for (let other of cheerios) {
                    if (other === this) continue;

                    const dx = other.x - this.x;
                    const dy = other.y - this.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    const minDist = this.radius + other.radius;

                    if (dist < minDist * 5 && dist > minDist) {
                        // Capillary attraction force (simplified)
                        // Force ~ 1/distance for close objects
                        const capillaryLength = 2.7; // mm, scaled
                        const forceMag = surfaceTension * 0.0001 * this.radius * other.radius / (dist * dist);

                        fx += forceMag * dx / dist;
                        fy += forceMag * dy / dist;
                    } else if (dist < minDist) {
                        // Collision repulsion
                        const repel = (minDist - dist) * 0.5;
                        fx -= repel * dx / dist;
                        fy -= repel * dy / dist;
                    }
                }

                // Attraction to bowl wall (meniscus effect)
                const distToCenter = Math.sqrt(
                    (this.x - bowlCenterX) ** 2 +
                    (this.y - bowlCenterY) ** 2
                );
                const distToWall = bowlRadius - distToCenter;

                if (distToWall < bowlRadius * 0.4) {
                    // Wall meniscus creates upward curve - cheerios roll toward wall
                    const wallForce = surfaceTension * 0.00002 / (distToWall * distToWall + 100);
                    const angle = Math.atan2(this.y - bowlCenterY, this.x - bowlCenterX);
                    fx += Math.cos(angle) * wallForce * bowlRadius;
                    fy += Math.sin(angle) * wallForce * bowlRadius;
                }

                // Keep inside bowl
                if (distToCenter > bowlRadius - this.radius) {
                    const angle = Math.atan2(this.y - bowlCenterY, this.x - bowlCenterX);
                    this.x = bowlCenterX + (bowlRadius - this.radius - 2) * Math.cos(angle);
                    this.y = bowlCenterY + (bowlRadius - this.radius - 2) * Math.sin(angle);

                    // Bounce softly
                    const normalX = Math.cos(angle);
                    const normalY = Math.sin(angle);
                    const dot = this.vx * normalX + this.vy * normalY;
                    this.vx -= 1.5 * dot * normalX;
                    this.vy -= 1.5 * dot * normalY;
                }

                // Apply forces with viscous drag
                const drag = 0.95 - (viscosity - 1) * 0.03;
                this.vx = (this.vx + fx * dt) * drag;
                this.vy = (this.vy + fy * dt) * drag;

                // Update position
                this.x += this.vx;
                this.y += this.vy;

                // Slow rotation
                this.rotation += (this.vx + this.vy) * 0.01;
            }

            draw(ctx) {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);

                // Draw meniscus zone if enabled
                if (showMeniscus || physicsView) {
                    const gradient = ctx.createRadialGradient(0, 0, this.radius, 0, 0, this.radius * 3);
                    gradient.addColorStop(0, 'rgba(100, 180, 255, 0.3)');
                    gradient.addColorStop(1, 'rgba(100, 180, 255, 0)');
                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.arc(0, 0, this.radius * 3, 0, Math.PI * 2);
                    ctx.fill();

                    // Dashed circle for meniscus boundary
                    ctx.strokeStyle = 'rgba(100, 180, 255, 0.5)';
                    ctx.setLineDash([4, 4]);
                    ctx.beginPath();
                    ctx.arc(0, 0, this.radius * 2.5, 0, Math.PI * 2);
                    ctx.stroke();
                    ctx.setLineDash([]);
                }

                // Cheerio outer ring
                ctx.fillStyle = '#d4a24a';
                ctx.strokeStyle = '#b8862e';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(0, 0, this.radius, 0, Math.PI * 2);
                ctx.fill();
                ctx.stroke();

                // Inner hole
                ctx.fillStyle = 'rgba(200, 220, 235, 0.8)';
                ctx.beginPath();
                ctx.arc(0, 0, this.radius * 0.4, 0, Math.PI * 2);
                ctx.fill();

                // Highlight
                ctx.fillStyle = 'rgba(255, 240, 180, 0.4)';
                ctx.beginPath();
                ctx.arc(-this.radius * 0.2, -this.radius * 0.2, this.radius * 0.3, 0, Math.PI * 2);
                ctx.fill();

                ctx.restore();
            }
        }

        function drawBowl() {
            bowlCtx.clearRect(0, 0, bowlCanvas.width, bowlCanvas.height);

            // Draw wall meniscus zone
            if (showMeniscus || physicsView) {
                const wallGradient = bowlCtx.createRadialGradient(
                    bowlCenterX, bowlCenterY, bowlRadius * 0.7,
                    bowlCenterX, bowlCenterY, bowlRadius
                );
                wallGradient.addColorStop(0, 'rgba(100, 180, 255, 0)');
                wallGradient.addColorStop(1, 'rgba(100, 180, 255, 0.3)');
                bowlCtx.fillStyle = wallGradient;
                bowlCtx.beginPath();
                bowlCtx.arc(bowlCenterX, bowlCenterY, bowlRadius, 0, Math.PI * 2);
                bowlCtx.fill();
            }

            // Draw force lines in physics view
            if (physicsView) {
                bowlCtx.strokeStyle = 'rgba(255, 200, 100, 0.3)';
                bowlCtx.lineWidth = 1;

                for (let i = 0; i < cheerios.length; i++) {
                    for (let j = i + 1; j < cheerios.length; j++) {
                        const c1 = cheerios[i];
                        const c2 = cheerios[j];
                        const dx = c2.x - c1.x;
                        const dy = c2.y - c1.y;
                        const dist = Math.sqrt(dx * dx + dy * dy);

                        if (dist < (c1.radius + c2.radius) * 4) {
                            const alpha = Math.max(0, 0.5 - dist / 200);
                            bowlCtx.strokeStyle = `rgba(255, 200, 100, ${alpha})`;
                            bowlCtx.beginPath();
                            bowlCtx.moveTo(c1.x, c1.y);
                            bowlCtx.lineTo(c2.x, c2.y);
                            bowlCtx.stroke();

                            // Arrow pointing to attraction
                            const mx = (c1.x + c2.x) / 2;
                            const my = (c1.y + c2.y) / 2;
                            const angle = Math.atan2(dy, dx);

                            bowlCtx.fillStyle = `rgba(255, 200, 100, ${alpha})`;
                            bowlCtx.beginPath();
                            bowlCtx.moveTo(mx + 5 * Math.cos(angle + Math.PI/2), my + 5 * Math.sin(angle + Math.PI/2));
                            bowlCtx.lineTo(mx + 5 * Math.cos(angle - Math.PI/2), my + 5 * Math.sin(angle - Math.PI/2));
                            bowlCtx.lineTo(mx + 10 * Math.cos(angle), my + 10 * Math.sin(angle));
                            bowlCtx.fill();
                        }
                    }
                }
            }

            // Draw cheerios
            for (let cheerio of cheerios) {
                cheerio.draw(bowlCtx);
            }
        }

        function drawSideView() {
            sideCtx.clearRect(0, 0, sideCanvas.width, sideCanvas.height);

            const baseline = sideCanvas.height * 0.5;
            const scale = sideCanvas.width / bowlCanvas.width * 0.9;
            const offsetX = sideCanvas.width * 0.05;

            // Draw liquid surface with meniscus
            sideCtx.beginPath();
            sideCtx.moveTo(0, baseline);

            // Wall meniscus left
            sideCtx.quadraticCurveTo(20, baseline - 15, 40, baseline);

            // Surface with cheerio bumps
            const sortedCheerios = [...cheerios].sort((a, b) => a.x - b.x);
            let lastX = 40;

            for (let cheerio of sortedCheerios) {
                const x = offsetX + (cheerio.x - bowlCenterX + bowlRadius) * scale;
                const r = cheerio.radius * scale * 0.8;

                // Flat section to cheerio
                if (x - r > lastX) {
                    sideCtx.lineTo(x - r, baseline);
                }

                // Meniscus dip around cheerio
                sideCtx.quadraticCurveTo(x - r/2, baseline + 8, x, baseline + 5);
                sideCtx.quadraticCurveTo(x + r/2, baseline + 8, x + r, baseline);

                lastX = x + r;
            }

            // Continue to right wall
            sideCtx.lineTo(sideCanvas.width - 40, baseline);

            // Wall meniscus right
            sideCtx.quadraticCurveTo(sideCanvas.width - 20, baseline - 15, sideCanvas.width, baseline);

            // Fill liquid
            sideCtx.lineTo(sideCanvas.width, sideCanvas.height);
            sideCtx.lineTo(0, sideCanvas.height);
            sideCtx.closePath();

            const liquidGradient = sideCtx.createLinearGradient(0, baseline, 0, sideCanvas.height);
            liquidGradient.addColorStop(0, 'rgba(200, 230, 255, 0.9)');
            liquidGradient.addColorStop(1, 'rgba(150, 200, 240, 0.9)');
            sideCtx.fillStyle = liquidGradient;
            sideCtx.fill();

            // Surface line
            sideCtx.strokeStyle = '#64b4ff';
            sideCtx.lineWidth = 2;
            sideCtx.beginPath();
            sideCtx.moveTo(0, baseline);
            sideCtx.quadraticCurveTo(20, baseline - 15, 40, baseline);

            lastX = 40;
            for (let cheerio of sortedCheerios) {
                const x = offsetX + (cheerio.x - bowlCenterX + bowlRadius) * scale;
                const r = cheerio.radius * scale * 0.8;

                if (x - r > lastX) {
                    sideCtx.lineTo(x - r, baseline);
                }
                sideCtx.quadraticCurveTo(x - r/2, baseline + 8, x, baseline + 5);
                sideCtx.quadraticCurveTo(x + r/2, baseline + 8, x + r, baseline);

                lastX = x + r;
            }

            sideCtx.lineTo(sideCanvas.width - 40, baseline);
            sideCtx.quadraticCurveTo(sideCanvas.width - 20, baseline - 15, sideCanvas.width, baseline);
            sideCtx.stroke();

            // Draw cheerio cross-sections
            for (let cheerio of cheerios) {
                const x = offsetX + (cheerio.x - bowlCenterX + bowlRadius) * scale;
                const r = cheerio.radius * scale * 0.7;

                // Cheerio body (semi-circle above water)
                sideCtx.fillStyle = '#d4a24a';
                sideCtx.beginPath();
                sideCtx.arc(x, baseline + 2, r, Math.PI, 0);
                sideCtx.fill();

                // Outline
                sideCtx.strokeStyle = '#b8862e';
                sideCtx.lineWidth = 1.5;
                sideCtx.stroke();
            }

            // Labels
            sideCtx.fillStyle = '#888';
            sideCtx.font = '11px sans-serif';
            sideCtx.fillText('Wall meniscus ↑', 5, baseline - 20);
            sideCtx.fillText('↑ Wall', sideCanvas.width - 40, baseline - 20);

            if (cheerios.length > 0) {
                sideCtx.fillText('Meniscus dips around objects', sideCanvas.width / 2 - 70, baseline + 25);
            }
        }

        function countClusters() {
            if (cheerios.length === 0) return 0;

            const visited = new Set();
            let clusters = 0;

            function dfs(idx) {
                visited.add(idx);
                for (let i = 0; i < cheerios.length; i++) {
                    if (visited.has(i)) continue;
                    const dx = cheerios[i].x - cheerios[idx].x;
                    const dy = cheerios[i].y - cheerios[idx].y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    if (dist < (cheerios[idx].radius + cheerios[i].radius) * 2.5) {
                        dfs(i);
                    }
                }
            }

            for (let i = 0; i < cheerios.length; i++) {
                if (!visited.has(i)) {
                    clusters++;
                    dfs(i);
                }
            }

            return clusters;
        }

        function updateStats() {
            document.getElementById('objectCount').textContent = cheerios.length;
            document.getElementById('clusterCount').textContent = countClusters();

            // Calculate average force
            let totalForce = 0;
            let pairs = 0;
            for (let i = 0; i < cheerios.length; i++) {
                for (let j = i + 1; j < cheerios.length; j++) {
                    const dx = cheerios[j].x - cheerios[i].x;
                    const dy = cheerios[j].y - cheerios[i].y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    if (dist < cheerios[i].radius * 5 + cheerios[j].radius * 5) {
                        const force = surfaceTension * cheerios[i].radius * cheerios[j].radius / (dist * dist);
                        totalForce += force;
                        pairs++;
                    }
                }
            }
            const avgForce = pairs > 0 ? (totalForce / pairs * 1000).toFixed(1) : '0.0';
            document.getElementById('avgForce').textContent = avgForce + ' μN';
        }

        function animate() {
            for (let cheerio of cheerios) {
                cheerio.update(1);
            }

            drawBowl();
            drawSideView();
            updateStats();

            requestAnimationFrame(animate);
        }

        function addCheerio(x, y) {
            // Check if position is inside bowl
            const dx = x - bowlCenterX;
            const dy = y - bowlCenterY;
            if (Math.sqrt(dx * dx + dy * dy) < bowlRadius - cheerioRadius) {
                cheerios.push(new Cheerio(x, y));
            }
        }

        // Event listeners
        document.getElementById('bowl').addEventListener('click', (e) => {
            const rect = bowlCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            addCheerio(x, y);
        });

        document.getElementById('addCheerios').addEventListener('click', () => {
            for (let i = 0; i < 5; i++) {
                const angle = Math.random() * Math.PI * 2;
                const r = Math.random() * (bowlRadius - cheerioRadius * 2);
                addCheerio(
                    bowlCenterX + r * Math.cos(angle),
                    bowlCenterY + r * Math.sin(angle)
                );
            }
        });

        document.getElementById('clearBowl').addEventListener('click', () => {
            cheerios = [];
        });

        document.getElementById('toggleMeniscus').addEventListener('click', function() {
            showMeniscus = !showMeniscus;
            this.textContent = showMeniscus ? 'Hide Meniscus Lines' : 'Show Meniscus Lines';
        });

        document.getElementById('topViewBtn').addEventListener('click', function() {
            physicsView = false;
            this.classList.add('active');
            document.getElementById('physicsViewBtn').classList.remove('active');
        });

        document.getElementById('physicsViewBtn').addEventListener('click', function() {
            physicsView = true;
            this.classList.add('active');
            document.getElementById('topViewBtn').classList.remove('active');
        });

        document.getElementById('tension').addEventListener('input', function() {
            surfaceTension = parseFloat(this.value);
            document.getElementById('tensionValue').textContent = this.value;
        });

        document.getElementById('density').addEventListener('input', function() {
            cheerioDensity = parseFloat(this.value);
            document.getElementById('densityValue').textContent = this.value;
        });

        document.getElementById('viscosity').addEventListener('input', function() {
            viscosity = parseFloat(this.value);
            document.getElementById('viscosityValue').textContent = this.value;
        });

        // Initialize
        window.addEventListener('resize', resizeCanvases);
        resizeCanvases();

        // Add some initial cheerios
        setTimeout(() => {
            for (let i = 0; i < 8; i++) {
                const angle = Math.random() * Math.PI * 2;
                const r = 30 + Math.random() * (bowlRadius - 60);
                addCheerio(
                    bowlCenterX + r * Math.cos(angle),
                    bowlCenterY + r * Math.sin(angle)
                );
            }
        }, 100);

        animate();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
