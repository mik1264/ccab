<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coupon Collector's Problem - The Frustration of "Almost Complete"</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #1a2040 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 30px; }
        .back-link {
            color: #ff6b6b;
            text-decoration: none;
            margin-bottom: 20px;
            display: inline-block;
        }
        h1 {
            font-size: 2.3rem;
            background: linear-gradient(135deg, #9b59b6, #3498db, #2ecc71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        .subtitle {
            font-size: 1rem;
            color: #a0c4ff;
            max-width: 850px;
            margin: 0 auto;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 340px;
            gap: 25px;
            margin-bottom: 30px;
        }
        @media (max-width: 900px) {
            .main-grid { grid-template-columns: 1fr; }
        }

        .panel {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .collection-grid {
            display: grid;
            gap: 5px;
            margin-bottom: 20px;
        }
        .coupon {
            aspect-ratio: 1;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        .coupon.uncollected {
            background: rgba(255,255,255,0.1);
            color: #555;
            border: 2px dashed rgba(255,255,255,0.2);
        }
        .coupon.collected {
            border: none;
            animation: collect 0.3s ease-out;
        }
        .coupon.just-collected {
            animation: pop 0.4s ease-out;
        }
        @keyframes collect {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .progress-bar-container {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            height: 30px;
            margin-bottom: 15px;
            overflow: hidden;
            position: relative;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #9b59b6, #2ecc71);
            transition: width 0.3s;
            border-radius: 10px;
        }
        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            color: #fff;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
        }

        .status-display {
            display: flex;
            justify-content: space-around;
            text-align: center;
            padding: 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            margin-bottom: 15px;
        }
        .status-item {
            flex: 1;
        }
        .status-label {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 5px;
        }
        .status-value {
            font-size: 1.5rem;
            font-weight: bold;
        }
        .status-value.draws { color: #3498db; }
        .status-value.collected { color: #2ecc71; }
        .status-value.remaining { color: #e74c3c; }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            margin-bottom: 10px;
            transition: all 0.3s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #3498db, #9b59b6);
            color: #fff;
        }
        .btn-fast {
            background: linear-gradient(135deg, #e67e22, #e74c3c);
            color: #fff;
        }
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #a0c4ff;
        }
        .btn:hover { transform: translateY(-2px); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

        .control-group {
            margin-bottom: 15px;
        }
        .control-group label {
            display: block;
            color: #a0c4ff;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        .control-group input[type="range"] {
            width: 100%;
        }
        .control-value {
            text-align: right;
            font-size: 0.85rem;
            color: #9b59b6;
        }

        .expected-box {
            background: linear-gradient(135deg, rgba(155,89,182,0.2), rgba(52,152,219,0.1));
            border: 1px solid rgba(155,89,182,0.4);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .expected-box h4 {
            color: #9b59b6;
            margin-bottom: 10px;
        }
        .expected-value {
            font-size: 2rem;
            color: #a0c4ff;
            text-align: center;
            font-weight: bold;
        }
        .expected-formula {
            font-size: 0.85rem;
            color: #888;
            text-align: center;
            margin-top: 5px;
            font-family: 'Courier New', monospace;
        }

        .stats-panel {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .stats-panel h4 {
            color: #3498db;
            margin-bottom: 12px;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }
        .stat-value {
            color: #a0c4ff;
            font-weight: bold;
        }

        .phase-indicator {
            background: rgba(231,76,60,0.2);
            border: 1px solid rgba(231,76,60,0.4);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }
        .phase-indicator h4 {
            color: #e74c3c;
            margin-bottom: 5px;
        }
        .phase-indicator p {
            font-size: 0.85rem;
            color: #f5b7b1;
        }

        #drawsChart {
            width: 100%;
            height: 120px;
            margin-top: 15px;
        }

        .research-section {
            background: rgba(255,255,255,0.03);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            border: 1px solid rgba(255,255,255,0.08);
        }
        .research-section h2 {
            color: #9b59b6;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        .research-section h3 {
            color: #a0c4ff;
            margin: 20px 0 10px;
            font-size: 1.15rem;
        }
        .research-section p {
            margin-bottom: 12px;
            color: #c0c0c0;
        }
        .key-point {
            background: rgba(155,89,182,0.15);
            border-left: 3px solid #9b59b6;
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        .quote {
            font-style: italic;
            border-left: 3px solid #a0c4ff;
            padding-left: 15px;
            margin: 15px 0;
            color: #a0a0a0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-link">← Back to Surprising Paradoxes</a>
            <h1>The Coupon Collector's Problem</h1>
            <p class="subtitle">Why does completing a collection take SO much longer than expected? If there are 50 coupons, you don't need 50 draws—you need ~225! The last few items are BRUTAL.</p>
        </header>

        <div class="main-grid">
            <div class="panel">
                <div class="collection-grid" id="collectionGrid">
                    <!-- Coupons generated by JS -->
                </div>

                <div class="progress-bar-container">
                    <div class="progress-bar" id="progressBar" style="width: 0%"></div>
                    <div class="progress-text" id="progressText">0 / 25</div>
                </div>

                <div class="status-display">
                    <div class="status-item">
                        <div class="status-label">Draws Made</div>
                        <div class="status-value draws" id="drawsCount">0</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">Collected</div>
                        <div class="status-value collected" id="collectedCount">0</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">Remaining</div>
                        <div class="status-value remaining" id="remainingCount">25</div>
                    </div>
                </div>

                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-primary" id="drawOne" style="flex: 1;">Draw 1 Coupon</button>
                    <button class="btn btn-fast" id="drawFast" style="flex: 1;">Fast Draw (×10)</button>
                </div>
                <button class="btn btn-secondary" id="autoComplete">Auto-Complete Collection</button>
                <button class="btn btn-secondary" id="resetCollection">Reset Collection</button>

                <canvas id="drawsChart"></canvas>
            </div>

            <div class="panel">
                <h3 style="color: #9b59b6; margin-bottom: 15px;">Collection Settings</h3>

                <div class="control-group">
                    <label>Total Coupons: <span id="totalValue">25</span></label>
                    <input type="range" id="totalCoupons" min="5" max="100" value="25" step="5">
                    <div class="control-value">More coupons = more frustration!</div>
                </div>

                <div class="expected-box">
                    <h4>Expected Draws Needed</h4>
                    <div class="expected-value" id="expectedDraws">~95</div>
                    <div class="expected-formula">n × (ln(n) + γ) ≈ n × ln(n) + 0.577n</div>
                </div>

                <div class="phase-indicator" id="phaseIndicator">
                    <h4>Current Phase</h4>
                    <p id="phaseText">Start drawing to begin collection!</p>
                </div>

                <div class="stats-panel">
                    <h4>Session Statistics</h4>
                    <div class="stat-row">
                        <span>Collections completed:</span>
                        <span class="stat-value" id="completions">0</span>
                    </div>
                    <div class="stat-row">
                        <span>Average draws needed:</span>
                        <span class="stat-value" id="avgDraws">—</span>
                    </div>
                    <div class="stat-row">
                        <span>Best run:</span>
                        <span class="stat-value" id="bestRun">—</span>
                    </div>
                    <div class="stat-row">
                        <span>Worst run:</span>
                        <span class="stat-value" id="worstRun">—</span>
                    </div>
                    <div class="stat-row">
                        <span>Efficiency vs expected:</span>
                        <span class="stat-value" id="efficiency">—</span>
                    </div>
                </div>

                <div class="stats-panel">
                    <h4>Draws Per New Coupon</h4>
                    <div class="stat-row">
                        <span>First 50%:</span>
                        <span class="stat-value" id="first50">—</span>
                    </div>
                    <div class="stat-row">
                        <span>Next 25%:</span>
                        <span class="stat-value" id="next25">—</span>
                    </div>
                    <div class="stat-row">
                        <span>Final 25%:</span>
                        <span class="stat-value" id="final25">—</span>
                    </div>
                    <div class="stat-row">
                        <span>Last coupon alone:</span>
                        <span class="stat-value" id="lastCoupon">—</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="research-section">
            <h2>The Mathematics of Frustrating Collections</h2>

            <p>Every Pokemon card collector, gacha gamer, or breakfast cereal enthusiast knows the pain: those last few items to complete a set take <em>forever</em>. The Coupon Collector's Problem explains exactly why.</p>

            <h3>The Problem</h3>

            <p>Suppose a cereal box contains one of n different coupons, each equally likely. How many boxes must you buy on average to collect all n coupons?</p>

            <div class="key-point">
                <strong>The Answer:</strong> E[T] = n × Hₙ ≈ n × (ln n + γ)
                <br><br>
                Where Hₙ is the nth Harmonic number and γ ≈ 0.577216 is the Euler-Mascheroni constant.
                <br><br>
                For 50 coupons: E[T] ≈ 50 × (ln 50 + 0.577) ≈ 225 draws!
            </div>

            <h3>Why "n × log(n)" Instead of Just "n"?</h3>

            <p>The problem is intuitive once you break it down by stages:</p>

            <ul style="margin: 10px 0 10px 30px; color: #c0c0c0;">
                <li><strong>First coupon:</strong> Guaranteed new! Expected draws = 1</li>
                <li><strong>Second coupon:</strong> (n-1)/n chance it's new. Expected draws = n/(n-1)</li>
                <li><strong>Third coupon:</strong> (n-2)/n chance it's new. Expected draws = n/(n-2)</li>
                <li>...</li>
                <li><strong>Last coupon:</strong> Only 1/n chance it's new! Expected draws = n</li>
            </ul>

            <p>The total is: 1 + n/(n-1) + n/(n-2) + ... + n/1 = n × (1 + 1/2 + 1/3 + ... + 1/n) = n × Hₙ</p>

            <h3>The "Almost Complete" Torture</h3>

            <p>This is where the frustration lives. Consider collecting 50 coupons:</p>

            <div class="key-point">
                <strong>Phase Breakdown (n=50):</strong><br>
                • First 25 coupons (50%): ~35 draws<br>
                • Next 12 coupons (75%): ~40 draws<br>
                • Next 8 coupons (90%): ~50 draws<br>
                • Final 5 coupons (100%): ~100 draws!<br><br>
                The last 10% of the collection takes nearly HALF of all draws!
            </div>

            <h3>Real-World Applications</h3>

            <p><strong>Gacha Games:</strong> Mobile games with random character draws exploit this psychology. Getting the "last few" characters is designed to be expensive.</p>

            <p><strong>McDonald's Monopoly:</strong> The famous promotion keeps certain rare pieces extremely scarce. Most players get 20 of the 22 pieces easily, but never complete a set.</p>

            <p><strong>DNA Sequencing:</strong> When sequencing a genome with random fragments, this problem predicts coverage depth needed.</p>

            <p><strong>Hash Table Collision Analysis:</strong> In computer science, this models the birthday problem and hash function distribution.</p>

            <h3>Variance: It Gets Worse</h3>

            <p>The expected value is around n × ln(n), but there's significant variance. The standard deviation is approximately:</p>

            <p style="font-family: monospace; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px;">
                σ ≈ √(π²n²/6) ≈ 1.28n
            </p>

            <p>For 50 coupons, the standard deviation is about 64 draws. So while the expected value is 225, you might need anywhere from 160 to 290 draws in typical cases—with occasional outliers needing 350+!</p>

            <div class="quote">
                "The coupon collector problem teaches us that completing any collection follows a pattern: the beginning is easy, the middle feels like progress, and the end is pure torture."<br>
                — Mathematical folklore
            </div>

            <h3>The "Birthday Problem" Connection</h3>

            <p>The Coupon Collector is closely related to the Birthday Problem. While the Birthday Problem asks "how many people until a collision?", the Coupon Collector asks "how many draws until all possibilities seen?"</p>

            <p>They're inverses: the Birthday Problem expects collisions quickly (around √n), while the Coupon Collector expects completion slowly (around n × ln n).</p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('drawsChart');
        const ctx = canvas.getContext('2d');

        // Game state
        let totalCoupons = 25;
        let collected = new Set();
        let drawsMade = 0;
        let drawHistory = []; // Draws when each new coupon was collected
        let drawsPerCoupon = [];

        // Session stats
        let completions = 0;
        let allDrawCounts = [];
        let autoPlaying = false;

        // Color palette for coupons
        const colors = [
            '#e74c3c', '#e67e22', '#f1c40f', '#2ecc71', '#1abc9c',
            '#3498db', '#9b59b6', '#34495e', '#16a085', '#27ae60',
            '#2980b9', '#8e44ad', '#c0392b', '#d35400', '#f39c12',
            '#27ae60', '#00bcd4', '#ff5722', '#795548', '#607d8b'
        ];

        function resizeCanvas() {
            const rect = canvas.parentElement.getBoundingClientRect();
            canvas.width = rect.width - 40;
            canvas.height = 120;
        }

        function getColor(index) {
            return colors[index % colors.length];
        }

        function calculateExpected(n) {
            // E[T] = n * H_n ≈ n * (ln(n) + γ)
            const gamma = 0.5772156649;
            return Math.round(n * (Math.log(n) + gamma));
        }

        function updateExpectedDisplay() {
            const expected = calculateExpected(totalCoupons);
            document.getElementById('expectedDraws').textContent = '~' + expected;
        }

        function createGrid() {
            const grid = document.getElementById('collectionGrid');
            grid.innerHTML = '';

            // Determine grid columns
            const cols = totalCoupons <= 25 ? 5 :
                        totalCoupons <= 50 ? 7 :
                        totalCoupons <= 75 ? 9 : 10;
            grid.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;

            for (let i = 0; i < totalCoupons; i++) {
                const coupon = document.createElement('div');
                coupon.className = 'coupon uncollected';
                coupon.id = `coupon-${i}`;
                coupon.textContent = i + 1;
                grid.appendChild(coupon);
            }
        }

        function drawCoupon() {
            if (collected.size >= totalCoupons) return;

            drawsMade++;
            const drawn = Math.floor(Math.random() * totalCoupons);

            if (!collected.has(drawn)) {
                collected.add(drawn);
                drawHistory.push(drawsMade);

                // Calculate draws for this coupon
                const prevDraws = drawHistory.length > 1 ? drawHistory[drawHistory.length - 2] : 0;
                drawsPerCoupon.push(drawsMade - prevDraws);

                // Update UI
                const couponEl = document.getElementById(`coupon-${drawn}`);
                couponEl.className = 'coupon collected just-collected';
                couponEl.style.background = getColor(drawn);
                couponEl.style.color = '#fff';

                setTimeout(() => {
                    couponEl.classList.remove('just-collected');
                }, 400);
            }

            updateDisplay();

            if (collected.size >= totalCoupons) {
                completeCollection();
            }
        }

        function drawMultiple(count) {
            for (let i = 0; i < count; i++) {
                if (collected.size >= totalCoupons) break;
                drawCoupon();
            }
        }

        function autoComplete() {
            if (autoPlaying) {
                autoPlaying = false;
                document.getElementById('autoComplete').textContent = 'Auto-Complete Collection';
                return;
            }

            autoPlaying = true;
            document.getElementById('autoComplete').textContent = 'Stop Auto-Draw';

            function step() {
                if (!autoPlaying || collected.size >= totalCoupons) {
                    autoPlaying = false;
                    document.getElementById('autoComplete').textContent = 'Auto-Complete Collection';
                    return;
                }

                for (let i = 0; i < 3; i++) {
                    drawCoupon();
                    if (collected.size >= totalCoupons) break;
                }

                requestAnimationFrame(step);
            }

            step();
        }

        function completeCollection() {
            completions++;
            allDrawCounts.push(drawsMade);
            autoPlaying = false;
            document.getElementById('autoComplete').textContent = 'Auto-Complete Collection';

            updateSessionStats();
        }

        function updateDisplay() {
            const remaining = totalCoupons - collected.size;
            const progress = (collected.size / totalCoupons) * 100;

            document.getElementById('drawsCount').textContent = drawsMade;
            document.getElementById('collectedCount').textContent = collected.size;
            document.getElementById('remainingCount').textContent = remaining;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressText').textContent = `${collected.size} / ${totalCoupons}`;

            // Update phase indicator
            updatePhaseIndicator();

            // Update draws per phase stats
            updatePhaseStats();

            // Draw chart
            drawChart();
        }

        function updatePhaseIndicator() {
            const progress = collected.size / totalCoupons;
            const indicator = document.getElementById('phaseIndicator');
            const text = document.getElementById('phaseText');

            if (collected.size === 0) {
                indicator.style.background = 'rgba(52,152,219,0.2)';
                indicator.style.borderColor = 'rgba(52,152,219,0.4)';
                text.style.color = '#aed6f1';
                document.querySelector('#phaseIndicator h4').style.color = '#3498db';
                text.textContent = 'Start drawing to begin!';
            } else if (progress < 0.5) {
                indicator.style.background = 'rgba(46,204,113,0.2)';
                indicator.style.borderColor = 'rgba(46,204,113,0.4)';
                text.style.color = '#a9dfbf';
                document.querySelector('#phaseIndicator h4').style.color = '#2ecc71';
                text.textContent = 'Easy phase! New coupons come quickly.';
            } else if (progress < 0.75) {
                indicator.style.background = 'rgba(241,196,15,0.2)';
                indicator.style.borderColor = 'rgba(241,196,15,0.4)';
                text.style.color = '#f9e79f';
                document.querySelector('#phaseIndicator h4').style.color = '#f1c40f';
                text.textContent = 'Middle phase. Starting to see duplicates...';
            } else if (progress < 0.9) {
                indicator.style.background = 'rgba(230,126,34,0.2)';
                indicator.style.borderColor = 'rgba(230,126,34,0.4)';
                text.style.color = '#f5cba7';
                document.querySelector('#phaseIndicator h4').style.color = '#e67e22';
                text.textContent = 'Frustration begins! Lots of duplicates.';
            } else if (progress < 1) {
                indicator.style.background = 'rgba(231,76,60,0.2)';
                indicator.style.borderColor = 'rgba(231,76,60,0.4)';
                text.style.color = '#f5b7b1';
                document.querySelector('#phaseIndicator h4').style.color = '#e74c3c';
                text.textContent = 'TORTURE ZONE! The last few take forever!';
            } else {
                indicator.style.background = 'rgba(155,89,182,0.2)';
                indicator.style.borderColor = 'rgba(155,89,182,0.4)';
                text.style.color = '#d7bde2';
                document.querySelector('#phaseIndicator h4').style.color = '#9b59b6';
                text.textContent = `COMPLETE! Took ${drawsMade} draws.`;
            }
        }

        function updatePhaseStats() {
            if (drawHistory.length === 0) return;

            const half = Math.floor(totalCoupons / 2);
            const threeQuarter = Math.floor(totalCoupons * 0.75);

            // First 50%
            if (collected.size >= half) {
                document.getElementById('first50').textContent = drawHistory[half - 1] + ' draws';
            }

            // Next 25% (50% to 75%)
            if (collected.size >= threeQuarter) {
                const first50Draws = drawHistory[half - 1];
                const at75Draws = drawHistory[threeQuarter - 1];
                document.getElementById('next25').textContent = (at75Draws - first50Draws) + ' draws';
            }

            // Final 25%
            if (collected.size >= totalCoupons) {
                const at75Draws = drawHistory[threeQuarter - 1];
                document.getElementById('final25').textContent = (drawsMade - at75Draws) + ' draws';
            }

            // Last coupon
            if (drawsPerCoupon.length > 0) {
                document.getElementById('lastCoupon').textContent =
                    drawsPerCoupon[drawsPerCoupon.length - 1] + ' draws';
            }
        }

        function updateSessionStats() {
            document.getElementById('completions').textContent = completions;

            if (allDrawCounts.length > 0) {
                const avg = Math.round(allDrawCounts.reduce((a,b) => a + b, 0) / allDrawCounts.length);
                const best = Math.min(...allDrawCounts);
                const worst = Math.max(...allDrawCounts);
                const expected = calculateExpected(totalCoupons);
                const eff = ((expected / avg) * 100).toFixed(0);

                document.getElementById('avgDraws').textContent = avg;
                document.getElementById('bestRun').textContent = best;
                document.getElementById('worstRun').textContent = worst;
                document.getElementById('efficiency').textContent = eff + '%';
            }
        }

        function drawChart() {
            resizeCanvas();
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (drawsPerCoupon.length < 2) {
                ctx.fillStyle = '#666';
                ctx.font = '12px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('Draws per new coupon will appear here', canvas.width / 2, 60);
                return;
            }

            const padding = 30;
            const graphWidth = canvas.width - 2 * padding;
            const graphHeight = canvas.height - 2 * padding;

            // Find max value for scaling
            const maxDraws = Math.max(...drawsPerCoupon);

            // Draw bars
            const barWidth = graphWidth / drawsPerCoupon.length - 2;

            for (let i = 0; i < drawsPerCoupon.length; i++) {
                const height = (drawsPerCoupon[i] / maxDraws) * graphHeight;
                const x = padding + i * (barWidth + 2);
                const y = canvas.height - padding - height;

                // Color gradient from green to red
                const progress = i / (totalCoupons - 1);
                const r = Math.round(46 + (231 - 46) * progress);
                const g = Math.round(204 + (76 - 204) * progress);
                const b = Math.round(113 + (60 - 113) * progress);

                ctx.fillStyle = `rgb(${r}, ${g}, ${b})`;
                ctx.fillRect(x, y, barWidth, height);
            }

            // Labels
            ctx.fillStyle = '#888';
            ctx.font = '10px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('Draws', 5, 12);
            ctx.textAlign = 'right';
            ctx.fillText(maxDraws, padding - 5, 20);
            ctx.fillText('1', padding - 5, canvas.height - padding);

            ctx.textAlign = 'center';
            ctx.fillText('Coupon #', canvas.width / 2, canvas.height - 5);
        }

        function resetCollection() {
            collected.clear();
            drawsMade = 0;
            drawHistory = [];
            drawsPerCoupon = [];
            autoPlaying = false;
            document.getElementById('autoComplete').textContent = 'Auto-Complete Collection';

            createGrid();
            updateDisplay();

            document.getElementById('first50').textContent = '—';
            document.getElementById('next25').textContent = '—';
            document.getElementById('final25').textContent = '—';
            document.getElementById('lastCoupon').textContent = '—';
        }

        // Event listeners
        document.getElementById('drawOne').addEventListener('click', drawCoupon);
        document.getElementById('drawFast').addEventListener('click', () => drawMultiple(10));
        document.getElementById('autoComplete').addEventListener('click', autoComplete);
        document.getElementById('resetCollection').addEventListener('click', resetCollection);

        document.getElementById('totalCoupons').addEventListener('input', function() {
            totalCoupons = parseInt(this.value);
            document.getElementById('totalValue').textContent = this.value;
            updateExpectedDisplay();
            resetCollection();
            allDrawCounts = [];
            completions = 0;
            updateSessionStats();
        });

        // Initialize
        window.addEventListener('resize', drawChart);
        createGrid();
        updateExpectedDisplay();
        updateDisplay();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
