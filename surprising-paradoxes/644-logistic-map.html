<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logistic Map - The Road to Chaos</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a0a 50%, #0a1a1a 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        .back-link {
            display: inline-flex;
            align-items: center;
            color: #f59e0b;
            text-decoration: none;
            margin-bottom: 15px;
            font-size: 0.95em;
        }
        .back-link:hover {
            color: #fbbf24;
            text-decoration: underline;
        }
        h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
            color: #fff;
            text-shadow: 0 0 30px rgba(245, 158, 11, 0.5);
        }
        .subtitle {
            color: #fbbf24;
            margin-bottom: 20px;
            font-size: 1.05em;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .main-content {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 20px;
        }
        .canvas-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .canvas-container {
            background: rgba(0,0,0,0.4);
            border-radius: 12px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        canvas {
            border-radius: 8px;
            background: #050505;
        }
        .info-text {
            margin-top: 10px;
            font-size: 0.8em;
            color: #f59e0b;
        }
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .panel {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .panel h3 {
            font-size: 0.9em;
            color: #f59e0b;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .btn {
            padding: 8px 14px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 500;
            transition: all 0.2s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
        }
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #e0e0e0;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .btn-secondary:hover {
            background: rgba(255,255,255,0.2);
        }
        .param-group {
            margin-bottom: 12px;
        }
        .param-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .param-name {
            color: #fbbf24;
            font-size: 0.85em;
        }
        .param-value {
            color: #fcd34d;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.9em;
        }
        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255,255,255,0.1);
            -webkit-appearance: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #f59e0b;
            cursor: pointer;
        }
        .equations {
            background: rgba(0,0,0,0.3);
            padding: 12px;
            border-radius: 6px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.85em;
            line-height: 1.8;
            color: #fcd34d;
            text-align: center;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .stat-label {
            color: #fbbf24;
            font-size: 0.8em;
        }
        .stat-value {
            color: #fcd34d;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.8em;
        }
        .presets {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 6px;
        }
        .preset-btn {
            padding: 6px;
            font-size: 0.7em;
        }
        .feigenbaum {
            background: linear-gradient(135deg, rgba(245,158,11,0.2), rgba(217,119,6,0.1));
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
        }
        .feigenbaum-title {
            color: #f59e0b;
            font-size: 0.75em;
            margin-bottom: 5px;
        }
        .feigenbaum-value {
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 1.1em;
            color: #fcd34d;
        }
        .exp-section {
            margin-top: 20px;
        }
        .exp-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }
        .exp-card {
            background: linear-gradient(135deg, rgba(245,158,11,0.1), rgba(217,119,6,0.05));
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(245,158,11,0.2);
        }
        .exp-card h4 {
            color: #f59e0b;
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        .exp-card p {
            font-size: 0.85em;
            line-height: 1.6;
            color: #fbbf24;
        }
        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">← Back to Paradoxes</a>
        <h1>The Logistic Map</h1>
        <p class="subtitle">Period Doubling and the Road to Chaos</p>

        <div class="main-content">
            <div class="canvas-section">
                <div class="canvas-container">
                    <canvas id="bifurcationCanvas" width="700" height="450"></canvas>
                    <p class="info-text">Click on diagram to explore behavior at any r value</p>
                </div>
                <div class="canvas-container">
                    <canvas id="cobwebCanvas" width="700" height="250"></canvas>
                    <p class="info-text">Cobweb diagram showing iteration at current r</p>
                </div>
            </div>

            <div class="sidebar">
                <div class="panel">
                    <h3>Controls</h3>
                    <div class="controls">
                        <button class="btn btn-primary" id="generateBtn">Generate</button>
                        <button class="btn btn-secondary" id="animateBtn">Animate r</button>
                    </div>
                </div>

                <div class="panel">
                    <h3>Parameter r</h3>
                    <div class="param-group">
                        <div class="param-label">
                            <span class="param-name">Growth rate (r)</span>
                            <span class="param-value" id="rValue">3.50</span>
                        </div>
                        <input type="range" id="rSlider" min="2.5" max="4.0" step="0.001" value="3.50">
                    </div>
                </div>

                <div class="panel">
                    <h3>Presets</h3>
                    <div class="presets">
                        <button class="btn btn-secondary preset-btn" data-r="2.9">Stable (r=2.9)</button>
                        <button class="btn btn-secondary preset-btn" data-r="3.2">Period 2 (r=3.2)</button>
                        <button class="btn btn-secondary preset-btn" data-r="3.5">Period 4 (r=3.5)</button>
                        <button class="btn btn-secondary preset-btn" data-r="3.56">Period 8+ (r=3.56)</button>
                        <button class="btn btn-secondary preset-btn" data-r="3.5699">Onset chaos</button>
                        <button class="btn btn-secondary preset-btn" data-r="3.83">Period 3!</button>
                        <button class="btn btn-secondary preset-btn" data-r="3.9">Full chaos</button>
                        <button class="btn btn-secondary preset-btn" data-r="4.0">Maximum</button>
                    </div>
                </div>

                <div class="panel">
                    <h3>The Map</h3>
                    <div class="equations">
                        x<sub>n+1</sub> = r · x<sub>n</sub> · (1 − x<sub>n</sub>)
                    </div>
                    <p style="font-size: 0.7em; color: #94a3b8; margin-top: 8px;">
                        Population at time n+1 depends on population at time n.
                        When r exceeds ~3.57, chaos emerges!
                    </p>
                </div>

                <div class="panel">
                    <h3>Statistics</h3>
                    <div class="stat-row">
                        <span class="stat-label">Behavior</span>
                        <span id="behavior" class="stat-value">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Period</span>
                        <span id="period" class="stat-value">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Lyapunov λ</span>
                        <span id="lyapunov" class="stat-value">-</span>
                    </div>
                    <div class="feigenbaum">
                        <div class="feigenbaum-title">FEIGENBAUM CONSTANT</div>
                        <div class="feigenbaum-value">δ = 4.669201609...</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="exp-section">
            <div class="exp-cards">
                <div class="exp-card">
                    <h4>Robert May (1976)</h4>
                    <p>Australian ecologist Robert May showed how this simple population model exhibits extraordinarily complex behavior. A population that grows proportionally but is limited by resources can oscillate, bifurcate, and become chaotic—proving that simple rules don't mean simple outcomes!</p>
                </div>
                <div class="exp-card">
                    <h4>The Feigenbaum Constant</h4>
                    <p>Mitchell Feigenbaum discovered that the ratio between successive bifurcation intervals approaches 4.669201609... This universal constant appears in ANY system with period-doubling—as fundamental as π for circles! It connects this simple map to deep mathematical structure.</p>
                </div>
                <div class="exp-card">
                    <h4>Period 3 Implies Chaos</h4>
                    <p>Mathematician Li and Yorke proved (1975) that if a system has a period-3 cycle, it must have cycles of EVERY period. At r ≈ 3.83, period-3 appears in a "window of order" within chaos. This theorem: "Period three implies chaos" is a foundational result!</p>
                </div>
                <div class="exp-card">
                    <h4>Hidden in the Mandelbrot Set</h4>
                    <p>Remarkably, the bifurcation diagram is embedded in the Mandelbrot set! The real axis of the Mandelbrot set, when properly mapped, reproduces this exact structure. Chaos theory and complex dynamics are deeply connected through these visual patterns.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const bifCanvas = document.getElementById('bifurcationCanvas');
        const bifCtx = bifCanvas.getContext('2d');
        const cobCanvas = document.getElementById('cobwebCanvas');
        const cobCtx = cobCanvas.getContext('2d');

        let r = 3.5;
        let animating = false;
        let animationId = null;

        // Bifurcation diagram parameters
        const rMin = 2.5;
        const rMax = 4.0;
        const xMin = 0;
        const xMax = 1;

        // Logistic map function
        function logistic(x, r) {
            return r * x * (1 - x);
        }

        // Generate bifurcation diagram
        function generateBifurcation() {
            const w = bifCanvas.width;
            const h = bifCanvas.height;

            bifCtx.fillStyle = '#050505';
            bifCtx.fillRect(0, 0, w, h);

            const iterations = 300;
            const plotIterations = 100;
            const samplesPerPixel = 1;

            // Create image data for efficient plotting
            const imageData = bifCtx.getImageData(0, 0, w, h);
            const data = imageData.data;

            for (let px = 0; px < w; px++) {
                const rVal = rMin + (px / w) * (rMax - rMin);

                for (let sample = 0; sample < samplesPerPixel; sample++) {
                    let x = 0.1 + Math.random() * 0.8;

                    // Iterate to reach attractor
                    for (let i = 0; i < iterations; i++) {
                        x = logistic(x, rVal);
                    }

                    // Plot attractor points
                    for (let i = 0; i < plotIterations; i++) {
                        x = logistic(x, rVal);

                        if (x >= xMin && x <= xMax) {
                            const py = Math.floor(h - (x - xMin) / (xMax - xMin) * h);

                            if (py >= 0 && py < h) {
                                const idx = (py * w + px) * 4;
                                // Amber/orange gradient
                                data[idx] = Math.min(255, data[idx] + 8);     // R
                                data[idx + 1] = Math.min(255, data[idx + 1] + 4); // G
                                data[idx + 2] = Math.min(255, data[idx + 2] + 1); // B
                                data[idx + 3] = 255; // A
                            }
                        }
                    }
                }
            }

            bifCtx.putImageData(imageData, 0, 0);

            // Draw current r line
            drawRLine();

            // Draw axes labels
            bifCtx.fillStyle = '#666';
            bifCtx.font = '11px Monaco, Consolas, monospace';
            bifCtx.fillText('r = ' + rMin.toFixed(1), 5, h - 5);
            bifCtx.fillText('r = ' + rMax.toFixed(1), w - 45, h - 5);
            bifCtx.fillText('x = 1', 5, 15);
            bifCtx.fillText('x = 0', 5, h - 20);
        }

        // Draw vertical line at current r
        function drawRLine() {
            const w = bifCanvas.width;
            const h = bifCanvas.height;

            // Redraw diagram first (quick version - just draw line on top)
            const px = Math.floor((r - rMin) / (rMax - rMin) * w);

            bifCtx.strokeStyle = 'rgba(245, 158, 11, 0.6)';
            bifCtx.lineWidth = 2;
            bifCtx.beginPath();
            bifCtx.moveTo(px, 0);
            bifCtx.lineTo(px, h);
            bifCtx.stroke();
        }

        // Draw cobweb diagram
        function drawCobweb() {
            const w = cobCanvas.width;
            const h = cobCanvas.height;

            cobCtx.fillStyle = '#050505';
            cobCtx.fillRect(0, 0, w, h);

            const margin = 40;
            const plotW = w - 2 * margin;
            const plotH = h - 2 * margin;

            // Transform functions
            const toCanvasX = x => margin + x * plotW;
            const toCanvasY = y => h - margin - y * plotH;

            // Draw parabola f(x) = rx(1-x)
            cobCtx.strokeStyle = '#f59e0b';
            cobCtx.lineWidth = 2;
            cobCtx.beginPath();
            for (let i = 0; i <= 100; i++) {
                const x = i / 100;
                const y = logistic(x, r);
                const cx = toCanvasX(x);
                const cy = toCanvasY(Math.max(0, Math.min(1, y)));
                if (i === 0) cobCtx.moveTo(cx, cy);
                else cobCtx.lineTo(cx, cy);
            }
            cobCtx.stroke();

            // Draw y = x line
            cobCtx.strokeStyle = '#666';
            cobCtx.lineWidth = 1;
            cobCtx.beginPath();
            cobCtx.moveTo(toCanvasX(0), toCanvasY(0));
            cobCtx.lineTo(toCanvasX(1), toCanvasY(1));
            cobCtx.stroke();

            // Draw axes
            cobCtx.strokeStyle = '#444';
            cobCtx.beginPath();
            cobCtx.moveTo(margin, margin);
            cobCtx.lineTo(margin, h - margin);
            cobCtx.lineTo(w - margin, h - margin);
            cobCtx.stroke();

            // Cobweb iteration
            let x = 0.1;
            const iterations = 100;

            cobCtx.strokeStyle = 'rgba(59, 130, 246, 0.6)';
            cobCtx.lineWidth = 1;
            cobCtx.beginPath();
            cobCtx.moveTo(toCanvasX(x), toCanvasY(0));

            for (let i = 0; i < iterations; i++) {
                const y = logistic(x, r);

                // Vertical line to parabola
                cobCtx.lineTo(toCanvasX(x), toCanvasY(Math.max(0, Math.min(1, y))));

                // Horizontal line to y=x
                cobCtx.lineTo(toCanvasX(Math.max(0, Math.min(1, y))), toCanvasY(Math.max(0, Math.min(1, y))));

                x = y;

                if (x < 0 || x > 1) break;
            }
            cobCtx.stroke();

            // Labels
            cobCtx.fillStyle = '#666';
            cobCtx.font = '11px Monaco, Consolas, monospace';
            cobCtx.fillText('0', margin - 15, h - margin + 5);
            cobCtx.fillText('1', w - margin - 5, h - margin + 15);
            cobCtx.fillText('x', w - margin + 10, h - margin + 5);
            cobCtx.fillText('f(x)', margin - 5, margin - 10);
        }

        // Calculate Lyapunov exponent
        function calculateLyapunov() {
            let x = 0.1;
            const warmup = 500;
            const iterations = 1000;
            let sum = 0;

            // Warmup
            for (let i = 0; i < warmup; i++) {
                x = logistic(x, r);
            }

            // Calculate
            for (let i = 0; i < iterations; i++) {
                const derivative = Math.abs(r * (1 - 2 * x));
                if (derivative > 0) {
                    sum += Math.log(derivative);
                }
                x = logistic(x, r);
            }

            return sum / iterations;
        }

        // Detect period
        function detectPeriod() {
            let x = 0.1;
            const warmup = 1000;
            const maxPeriod = 64;

            // Warmup
            for (let i = 0; i < warmup; i++) {
                x = logistic(x, r);
            }

            const startX = x;
            const tolerance = 1e-6;

            for (let p = 1; p <= maxPeriod; p++) {
                x = logistic(x, r);
                if (Math.abs(x - startX) < tolerance) {
                    return p;
                }
            }

            return -1; // Chaotic
        }

        // Update statistics
        function updateStats() {
            const lyap = calculateLyapunov();
            const period = detectPeriod();

            let behavior, periodStr;

            if (r < 1) {
                behavior = 'Extinction';
                periodStr = '0';
            } else if (r < 3) {
                behavior = 'Stable fixed point';
                periodStr = '1';
            } else if (lyap < -0.01) {
                behavior = 'Periodic';
                periodStr = period > 0 ? period.toString() : 'detecting...';
            } else {
                behavior = 'Chaotic';
                periodStr = '∞ (aperiodic)';
            }

            document.getElementById('behavior').textContent = behavior;
            document.getElementById('period').textContent = periodStr;
            document.getElementById('lyapunov').textContent = lyap.toFixed(4);
            document.getElementById('rValue').textContent = r.toFixed(3);
        }

        // Animation
        function animate() {
            if (!animating) return;

            r += 0.003;
            if (r > 4.0) r = 2.5;

            document.getElementById('rSlider').value = r;
            generateBifurcation();
            drawCobweb();
            updateStats();

            animationId = requestAnimationFrame(animate);
        }

        // Event handlers
        document.getElementById('rSlider').addEventListener('input', (e) => {
            r = parseFloat(e.target.value);
            generateBifurcation();
            drawCobweb();
            updateStats();
        });

        document.getElementById('generateBtn').addEventListener('click', () => {
            generateBifurcation();
            drawCobweb();
            updateStats();
        });

        document.getElementById('animateBtn').addEventListener('click', () => {
            if (animating) {
                animating = false;
                cancelAnimationFrame(animationId);
                document.getElementById('animateBtn').textContent = 'Animate r';
            } else {
                animating = true;
                document.getElementById('animateBtn').textContent = 'Stop';
                animate();
            }
        });

        document.querySelectorAll('.preset-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                r = parseFloat(btn.dataset.r);
                document.getElementById('rSlider').value = r;
                generateBifurcation();
                drawCobweb();
                updateStats();
            });
        });

        // Click on bifurcation diagram to select r
        bifCanvas.addEventListener('click', (e) => {
            const rect = bifCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const w = bifCanvas.width;

            r = rMin + (x / w) * (rMax - rMin);
            r = Math.max(rMin, Math.min(rMax, r));

            document.getElementById('rSlider').value = r;
            generateBifurcation();
            drawCobweb();
            updateStats();
        });

        // Initial generation
        generateBifurcation();
        drawCobweb();
        updateStats();
    </script>
</body>
</html>
