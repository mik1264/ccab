<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Banach-Tarski Paradox - Surprising Paradoxes - CCAB</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600;700&family=Nunito:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --sage: #8A9A5B;
            --moss: #606C38;
            --earth: #DDA15E;
            --cream: #FEFAE0;
            --terracotta: #BC6C25;
            --dark-moss: #3d4423;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #FEFAE0 0%, #F4F1DE 50%, #EDE8D5 100%);
            min-height: 100vh;
            color: var(--dark-moss);
            line-height: 1.7;
        }
        .organic-shape {
            position: fixed;
            border-radius: 60% 40% 50% 50% / 50% 60% 40% 50%;
            opacity: 0.12;
            z-index: 0;
            animation: morph 30s ease-in-out infinite;
        }
        .shape-1 {
            width: 600px;
            height: 600px;
            background: linear-gradient(135deg, var(--sage), var(--moss));
            top: -200px;
            right: -150px;
        }
        .shape-2 {
            width: 500px;
            height: 500px;
            background: linear-gradient(135deg, var(--earth), var(--terracotta));
            bottom: -150px;
            left: -150px;
            animation-delay: -15s;
        }
        @keyframes morph {
            0%, 100% { border-radius: 60% 40% 50% 50% / 50% 60% 40% 50%; }
            25% { border-radius: 50% 60% 40% 50% / 40% 50% 60% 50%; }
            50% { border-radius: 40% 50% 60% 50% / 50% 40% 50% 60%; }
            75% { border-radius: 50% 40% 50% 60% / 60% 50% 40% 50%; }
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px 80px;
            position: relative;
            z-index: 1;
        }
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--moss);
            text-decoration: none;
            font-weight: 500;
            margin-bottom: 30px;
            padding: 10px 20px;
            background: rgba(255,255,255,0.6);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            transition: all 0.3s ease;
        }
        .back-link:hover {
            background: rgba(255,255,255,0.9);
            transform: translateX(-5px);
        }
        h1 {
            font-family: 'Lora', serif;
            font-size: 2.8rem;
            font-weight: 600;
            color: var(--moss);
            margin-bottom: 20px;
            line-height: 1.2;
        }
        .subtitle {
            font-size: 1.3rem;
            color: var(--terracotta);
            margin-bottom: 40px;
            font-weight: 500;
        }
        .badge {
            display: inline-block;
            background: linear-gradient(135deg, #ffd700, #ffb700);
            color: #1a1a2e;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 25px;
        }
        .card {
            background: rgba(255,255,255,0.7);
            backdrop-filter: blur(15px);
            border-radius: 24px;
            padding: 35px;
            margin-bottom: 35px;
            border: 1px solid rgba(138,154,91,0.2);
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
        }
        .card h2 {
            font-family: 'Lora', serif;
            font-size: 1.6rem;
            color: var(--moss);
            margin-bottom: 20px;
        }
        .card p {
            color: #555;
            margin-bottom: 18px;
        }
        .highlight {
            background: linear-gradient(120deg, rgba(221,161,94,0.2) 0%, rgba(221,161,94,0.1) 100%);
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 600;
            color: var(--terracotta);
        }

        /* Animation Container */
        .animation-container {
            background: linear-gradient(180deg, #1a1a2e 0%, #0f0f1a 100%);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 35px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.2);
        }
        .animation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .animation-title {
            color: #fff;
            font-family: 'Lora', serif;
            font-size: 1.3rem;
        }
        #sphereCanvas {
            display: block;
            width: 100%;
            height: 400px;
            border-radius: 12px;
            background: radial-gradient(circle at 30% 30%, #2a2a4a, #0f0f1a);
        }
        .controls {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 20px;
        }
        .btn {
            background: linear-gradient(135deg, var(--earth) 0%, var(--terracotta) 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-family: 'Nunito', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(188,108,37,0.4);
        }
        .btn-secondary {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
        }
        .btn-secondary:hover {
            background: rgba(255,255,255,0.25);
            box-shadow: 0 8px 25px rgba(255,255,255,0.1);
        }
        .step-indicator {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        .step {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            transition: all 0.3s;
        }
        .step.active {
            background: #ffd700;
            transform: scale(1.3);
        }
        .step-label {
            color: rgba(255,255,255,0.7);
            text-align: center;
            margin-top: 15px;
            font-size: 0.9rem;
        }

        /* Quote */
        .quote {
            border-left: 4px solid var(--earth);
            padding-left: 25px;
            margin: 25px 0;
            font-style: italic;
            color: #666;
        }
        .quote-author {
            font-style: normal;
            font-weight: 600;
            color: var(--moss);
            margin-top: 10px;
        }

        /* Insight box */
        .insight-box {
            background: linear-gradient(135deg, rgba(138,154,91,0.15) 0%, rgba(96,108,56,0.1) 100%);
            border: 2px solid var(--sage);
            border-radius: 16px;
            padding: 25px;
            margin: 25px 0;
        }
        .insight-box h3 {
            color: var(--moss);
            font-family: 'Lora', serif;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Warning box */
        .warning-box {
            background: linear-gradient(135deg, rgba(255,107,107,0.1) 0%, rgba(255,150,150,0.05) 100%);
            border: 2px solid #ff6b6b;
            border-radius: 16px;
            padding: 25px;
            margin: 25px 0;
        }
        .warning-box h3 {
            color: #cc5555;
            font-family: 'Lora', serif;
            margin-bottom: 12px;
        }

        /* Steps visualization */
        .steps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }
        .step-card {
            background: rgba(255,255,255,0.5);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
        }
        .step-number {
            display: inline-block;
            background: linear-gradient(135deg, var(--moss), var(--sage));
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            line-height: 36px;
            font-weight: 700;
            margin-bottom: 12px;
        }
        .step-card h4 {
            color: var(--moss);
            margin-bottom: 8px;
            font-family: 'Lora', serif;
        }
        .step-card p {
            font-size: 0.9rem;
            color: #666;
        }

        /* Formula */
        .formula {
            background: rgba(0,0,0,0.03);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            color: var(--dark-moss);
        }

        /* FAQ style */
        .faq-item {
            margin-bottom: 20px;
        }
        .faq-question {
            font-weight: 600;
            color: var(--moss);
            margin-bottom: 8px;
        }
        .faq-answer {
            color: #555;
        }

        .footer {
            text-align: center;
            padding-top: 30px;
            color: #888;
            font-size: 0.85rem;
        }
        .footer a { color: var(--moss); }

        @media (max-width: 600px) {
            h1 { font-size: 2rem; }
            .card { padding: 25px; }
            .animation-container { padding: 20px; }
        }
    </style>
</head>
<body>
    <div class="organic-shape shape-1"></div>
    <div class="organic-shape shape-2"></div>

    <main class="container">
        <a href="index.html" class="back-link">&#8592; Back to Paradoxes</a>

        <span class="badge">Set Theory</span>
        <h1>The Banach-Tarski Paradox</h1>
        <p class="subtitle">A solid ball can be cut into pieces and reassembled into <em>two</em> identical copies of the original&#8212;with nothing left over.</p>

        <!-- Main Animation -->
        <div class="animation-container">
            <div class="animation-header">
                <h2 class="animation-title">Doubling a Sphere</h2>
            </div>

            <canvas id="sphereCanvas"></canvas>

            <div class="step-indicator">
                <div class="step active" data-step="0"></div>
                <div class="step" data-step="1"></div>
                <div class="step" data-step="2"></div>
                <div class="step" data-step="3"></div>
                <div class="step" data-step="4"></div>
            </div>
            <div class="step-label" id="stepLabel">Original sphere</div>

            <div class="controls">
                <button class="btn" id="nextBtn">Next Step &#8594;</button>
                <button class="btn btn-secondary" id="resetBtn">&#8635; Reset</button>
                <button class="btn btn-secondary" id="autoBtn">&#9654; Auto Play</button>
            </div>
        </div>

        <!-- The Paradox -->
        <div class="card">
            <h2>The Impossible Theorem</h2>
            <p>In 1924, Stefan Banach and Alfred Tarski proved one of the most counterintuitive results in all of mathematics:</p>

            <div class="insight-box">
                <h3>&#127873; The Theorem</h3>
                <p>A solid 3-dimensional ball can be decomposed into a <strong>finite number of pieces</strong> (as few as 5) and those pieces can be rotated and translated to form <strong>two complete balls</strong>, each the same size as the original.</p>
            </div>

            <p>No stretching. No gaps. No overlaps. Just <span class="highlight">rigid motions</span>&#8212;rotations and translations that preserve distances.</p>
            <p>This seems to violate conservation of mass, volume, and basic logic. Yet it's a proven mathematical theorem!</p>
        </div>

        <!-- How It Works -->
        <div class="card">
            <h2>How Is This Possible?</h2>
            <p>The key lies in the bizarre properties of <strong>non-measurable sets</strong>&#8212;collections of points so pathologically constructed that they have no well-defined volume.</p>

            <div class="steps-grid">
                <div class="step-card">
                    <span class="step-number">1</span>
                    <h4>Axiom of Choice</h4>
                    <p>The construction requires selecting points from infinitely many sets simultaneously&#8212;possible only with this controversial axiom.</p>
                </div>
                <div class="step-card">
                    <span class="step-number">2</span>
                    <h4>Free Group</h4>
                    <p>Rotations of the sphere form a "free group"&#8212;a structure with self-similar properties like a fractal.</p>
                </div>
                <div class="step-card">
                    <span class="step-number">3</span>
                    <h4>Paradoxical Decomposition</h4>
                    <p>Points are classified by rotation sequences, creating pieces that can reassemble in multiple ways.</p>
                </div>
                <div class="step-card">
                    <span class="step-number">4</span>
                    <h4>Non-Measurable Pieces</h4>
                    <p>The pieces have no volume in any meaningful sense&#8212;they're too "scattered" to measure.</p>
                </div>
            </div>
        </div>

        <!-- The Free Group -->
        <div class="card">
            <h2>The Free Group Trick</h2>
            <p>Consider two rotation axes through the sphere's center. Let <strong>A</strong> be a rotation around one axis, and <strong>B</strong> be a rotation around another. The key insight:</p>

            <div class="formula">
                F<sub>2</sub> = {e, A, A<sup>-1</sup>, B, B<sup>-1</sup>, AB, BA, A<sup>-1</sup>B, AB<sup>-1</sup>, ...}
            </div>

            <p>This "free group on two generators" has a magical property: it's <span class="highlight">paradoxically decomposable</span>.</p>
            <p>Imagine writing out all possible "words" using letters A, A<sup>-1</sup>, B, B<sup>-1</sup> (no cancellations like AA<sup>-1</sup>). This infinite set can be split into four pieces that, when recombined, give you <em>two copies</em> of the original set!</p>

            <div class="insight-box">
                <h3>&#128173; Self-Similarity</h3>
                <p>Words starting with A&#8230; form a subset. Add A<sup>-1</sup> to the front of each, and you get <em>all</em> words not starting with A. The structure contains copies of itself&#8212;enabling the duplication.</p>
            </div>
        </div>

        <!-- Why It Doesn't Apply -->
        <div class="card">
            <h2>Why Can't We Actually Do This?</h2>

            <div class="warning-box">
                <h3>&#9888; Physical Impossibility</h3>
                <p>Don't try this with a real ball! The paradox relies on mathematical abstractions that can't exist in physical reality:</p>
            </div>

            <div class="faq-item">
                <div class="faq-question">1. The pieces aren't solid objects</div>
                <div class="faq-answer">They're "point sets"&#8212;infinitely scattered collections of individual points with no coherent structure. You couldn't cut along any boundary.</div>
            </div>

            <div class="faq-item">
                <div class="faq-question">2. Matter is discrete, not continuous</div>
                <div class="faq-answer">Real matter is made of atoms. The theorem requires treating space as infinitely divisible with uncountably many points.</div>
            </div>

            <div class="faq-item">
                <div class="faq-question">3. The pieces have no volume</div>
                <div class="faq-answer">Non-measurable sets have undefined "size"&#8212;they're neither zero-volume nor positive-volume. Conservation laws don't apply to things with no well-defined quantity.</div>
            </div>

            <div class="faq-item">
                <div class="faq-question">4. Requires infinite precision</div>
                <div class="faq-answer">Constructing the pieces requires making infinitely many choices (via Axiom of Choice). No finite description exists.</div>
            </div>
        </div>

        <!-- Historical Context -->
        <div class="card">
            <h2>Historical Controversy</h2>

            <p>When Banach and Tarski published their result in 1924, many mathematicians were disturbed. The theorem was seen as a <strong>reductio ad absurdum</strong>&#8212;proof that something was wrong with the foundations of mathematics.</p>

            <div class="quote">
                "The axiom of choice is obviously true, the well-ordering principle obviously false, and who can tell about Zorn's lemma?"
                <div class="quote-author">&#8212; Jerry Bona (mathematical joke about equivalent axioms)</div>
            </div>

            <p>The Banach-Tarski paradox is often cited by critics of the <strong>Axiom of Choice</strong>&#8212;the controversial principle that allows selecting elements from infinitely many sets simultaneously. Without it, the paradox cannot be proven.</p>

            <p>However, most mathematicians accept the Axiom of Choice because:</p>
            <ul style="margin-left: 25px; color: #555;">
                <li>It's intuitive for finite cases</li>
                <li>Many useful theorems depend on it</li>
                <li>The "paradoxes" don't affect measurable (physically relevant) sets</li>
            </ul>
        </div>

        <!-- Variations -->
        <div class="card">
            <h2>Variations and Extensions</h2>

            <p><strong>The minimal case:</strong> It's been proven that 5 pieces suffice&#8212;and 4 pieces are not enough (for the ball; 4 suffice for the sphere surface).</p>

            <p><strong>Any dimension:</strong> The paradox works in 3D and higher. Interestingly, it <em>fails</em> in 1D and 2D! In those dimensions, the rotation group is "amenable" and doesn't permit paradoxical decompositions.</p>

            <p><strong>Different shapes:</strong> A pea can be decomposed and reassembled into a ball the size of the Sun. Or conversely, the Sun can become a pea!</p>

            <div class="insight-box">
                <h3>&#127759; The Von Neumann Paradox</h3>
                <p>For 2D, a weaker version exists: the plane can be paradoxically decomposed using <em>affine</em> transformations (including shearing)&#8212;but not with just rotations and translations.</p>
            </div>
        </div>

        <!-- Philosophical Implications -->
        <div class="card">
            <h2>What Does It Mean?</h2>

            <p>The Banach-Tarski paradox reveals deep truths about the nature of mathematics:</p>

            <p><strong>1. Mathematics &#8800; Physics</strong><br>
            Mathematical objects (like point sets) don't need to correspond to physical reality. The real number line contains "more" points than could ever be represented by atoms in the universe.</p>

            <p><strong>2. Volume isn't fundamental</strong><br>
            We usually think of volume as an intrinsic property. But it's actually a <em>measure</em> we assign to sets&#8212;and some sets resist measurement entirely.</p>

            <p><strong>3. Infinity is weird</strong><br>
            The paradox exploits the same strangeness that lets Hilbert's Hotel accommodate infinitely many new guests when already full. Infinite sets don't obey everyday intuitions.</p>

            <p><strong>4. Axiom choices matter</strong><br>
            Different foundations for mathematics (with or without Axiom of Choice) lead to different "truths." Mathematics is not a single monolithic system.</p>
        </div>

        <div class="footer">
            <p>Sources: <a href="https://en.wikipedia.org/wiki/Banach%E2%80%93Tarski_paradox" target="_blank">Wikipedia</a>,
            <a href="https://mathworld.wolfram.com/Banach-TarskiParadox.html" target="_blank">Wolfram MathWorld</a>,
            Wagon, S. (1993). "The Banach-Tarski Paradox"</p>
            <p style="margin-top: 10px;">Part of <a href="../index.html">CCAB</a> &#183; Surprising Paradoxes Collection</p>
        </div>
    </main>

    <script>
        // === SPHERE ANIMATION ===
        const canvas = document.getElementById('sphereCanvas');
        const ctx = canvas.getContext('2d');

        const dpr = window.devicePixelRatio || 1;
        let W, H;

        function resize() {
            const rect = canvas.getBoundingClientRect();
            W = rect.width;
            H = rect.height;
            canvas.width = W * dpr;
            canvas.height = H * dpr;
            ctx.scale(dpr, dpr);
        }
        resize();
        window.addEventListener('resize', resize);

        let currentStep = 0;
        let animating = false;
        let autoPlaying = false;
        let animProgress = 0;

        const pieceColors = [
            '#ff6b6b',
            '#4ecdc4',
            '#ffd93d',
            '#95e1d3',
            '#f38181'
        ];

        function drawSphere(x, y, r, pieces = null, explode = 0, alpha = 1) {
            ctx.save();
            ctx.globalAlpha = alpha;

            if (pieces === null) {
                // Draw solid sphere
                const gradient = ctx.createRadialGradient(x - r * 0.3, y - r * 0.3, 0, x, y, r);
                gradient.addColorStop(0, '#6a8cff');
                gradient.addColorStop(0.7, '#4169e1');
                gradient.addColorStop(1, '#1a1a4e');

                ctx.beginPath();
                ctx.arc(x, y, r, 0, Math.PI * 2);
                ctx.fillStyle = gradient;
                ctx.fill();

                // Highlight
                ctx.beginPath();
                ctx.arc(x - r * 0.3, y - r * 0.3, r * 0.15, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(255,255,255,0.4)';
                ctx.fill();
            } else {
                // Draw pieces
                const angleStep = Math.PI * 2 / pieces.length;
                for (let i = 0; i < pieces.length; i++) {
                    const angle = i * angleStep - Math.PI / 2;
                    const nextAngle = (i + 1) * angleStep - Math.PI / 2;

                    const explodeX = Math.cos(angle + angleStep / 2) * explode * r * 0.5;
                    const explodeY = Math.sin(angle + angleStep / 2) * explode * r * 0.5;

                    ctx.beginPath();
                    ctx.moveTo(x + explodeX, y + explodeY);
                    ctx.arc(x + explodeX, y + explodeY, r, angle, nextAngle);
                    ctx.closePath();

                    const gradient = ctx.createRadialGradient(
                        x + explodeX - r * 0.2, y + explodeY - r * 0.2, 0,
                        x + explodeX, y + explodeY, r
                    );
                    gradient.addColorStop(0, pieces[i].lightColor);
                    gradient.addColorStop(1, pieces[i].darkColor);

                    ctx.fillStyle = gradient;
                    ctx.fill();
                    ctx.strokeStyle = 'rgba(0,0,0,0.3)';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
            }

            ctx.restore();
        }

        function draw() {
            ctx.clearRect(0, 0, W, H);

            // Background
            const bg = ctx.createRadialGradient(W / 2, H / 2, 0, W / 2, H / 2, W / 2);
            bg.addColorStop(0, '#2a2a4a');
            bg.addColorStop(1, '#0f0f1a');
            ctx.fillStyle = bg;
            ctx.fillRect(0, 0, W, H);

            const baseR = Math.min(W, H) * 0.2;
            const centerY = H / 2;

            const pieces = [
                { lightColor: '#ff8a8a', darkColor: '#cc3333' },
                { lightColor: '#6ee7e7', darkColor: '#2ba3a3' },
                { lightColor: '#ffe066', darkColor: '#ccaa00' },
                { lightColor: '#aaf0e0', darkColor: '#5cc0a0' },
                { lightColor: '#f5a0a0', darkColor: '#c05050' }
            ];

            if (currentStep === 0) {
                // Original sphere
                drawSphere(W / 2, centerY, baseR);
            } else if (currentStep === 1) {
                // Decomposing
                const explode = animProgress;
                drawSphere(W / 2, centerY, baseR, pieces, explode);
            } else if (currentStep === 2) {
                // Pieces scattered
                drawSphere(W / 2, centerY, baseR, pieces, 1);
            } else if (currentStep === 3) {
                // Reassembling into two
                const leftX = W * 0.3;
                const rightX = W * 0.7;
                const collapse = animProgress;

                // Left sphere (pieces 0, 1, 2)
                const leftPieces = pieces.slice(0, 3);
                // Add more segments to make full sphere
                leftPieces.push({ lightColor: '#ff8a8a', darkColor: '#cc3333' });
                leftPieces.push({ lightColor: '#6ee7e7', darkColor: '#2ba3a3' });

                // Right sphere (pieces 2, 3, 4)
                const rightPieces = pieces.slice(2, 5);
                rightPieces.push({ lightColor: '#ffe066', darkColor: '#ccaa00' });
                rightPieces.push({ lightColor: '#aaf0e0', darkColor: '#5cc0a0' });

                drawSphere(leftX, centerY, baseR, leftPieces, 1 - collapse);
                drawSphere(rightX, centerY, baseR, rightPieces, 1 - collapse);
            } else if (currentStep === 4) {
                // Two complete spheres
                const leftX = W * 0.3;
                const rightX = W * 0.7;

                drawSphere(leftX, centerY, baseR);
                drawSphere(rightX, centerY, baseR);

                // Labels
                ctx.fillStyle = 'rgba(255,255,255,0.8)';
                ctx.font = 'bold 14px Nunito';
                ctx.textAlign = 'center';
                ctx.fillText('Copy 1', leftX, centerY + baseR + 30);
                ctx.fillText('Copy 2', rightX, centerY + baseR + 30);

                // "= 2x" indicator
                ctx.fillStyle = '#ffd700';
                ctx.font = 'bold 20px Nunito';
                ctx.fillText('1 sphere &#8594; 2 spheres!', W / 2, 40);
            }

            // Update step indicators
            document.querySelectorAll('.step').forEach((el, i) => {
                el.classList.toggle('active', i === currentStep);
            });

            const labels = [
                'Original sphere',
                'Decomposing into 5 pieces...',
                'Pieces separated (non-measurable sets)',
                'Reassembling via rotations...',
                'Two identical spheres!'
            ];
            document.getElementById('stepLabel').textContent = labels[currentStep];
        }

        function nextStep() {
            if (animating || currentStep >= 4) return;

            currentStep++;
            animating = true;
            animProgress = 0;
            const startTime = performance.now();

            function animate(time) {
                animProgress = Math.min(1, (time - startTime) / 1000);
                draw();
                if (animProgress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    animating = false;
                    if (autoPlaying && currentStep < 4) {
                        setTimeout(nextStep, 1000);
                    }
                }
            }
            requestAnimationFrame(animate);
        }

        function reset() {
            autoPlaying = false;
            animating = false;
            currentStep = 0;
            animProgress = 0;
            draw();
        }

        function autoPlay() {
            if (autoPlaying) {
                autoPlaying = false;
                return;
            }
            reset();
            autoPlaying = true;
            setTimeout(nextStep, 500);
        }

        document.getElementById('nextBtn').addEventListener('click', nextStep);
        document.getElementById('resetBtn').addEventListener('click', reset);
        document.getElementById('autoBtn').addEventListener('click', autoPlay);

        // Initialize
        draw();
    </script>
</body>
</html>
