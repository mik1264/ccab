<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The St. Petersburg Paradox - Surprising Paradoxes</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600&family=Nunito:wght@400;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #1a0a2e 0%, #2d1b4e 50%, #1a0a2e 100%);
            color: #e8e0f0;
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 {
            font-family: 'Lora', serif;
            font-size: 2.2em;
            text-align: center;
            margin-bottom: 10px;
            color: #ffd700;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.4);
        }
        .subtitle {
            text-align: center;
            color: #c0a8d8;
            margin-bottom: 25px;
            font-size: 1.1em;
        }
        .back-link {
            display: inline-block;
            color: #ffd700;
            text-decoration: none;
            margin-bottom: 20px;
            font-size: 0.95em;
        }
        .back-link:hover { text-decoration: underline; }

        .game-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .panel {
            background: rgba(45, 27, 78, 0.7);
            border-radius: 16px;
            padding: 25px;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .panel h2 {
            font-family: 'Lora', serif;
            color: #ffd700;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .coin-display {
            text-align: center;
            padding: 30px;
            background: rgba(20, 10, 40, 0.6);
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .coin {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            margin: 10px;
            transition: transform 0.3s;
        }

        .coin.heads {
            background: linear-gradient(135deg, #ffd700, #ffaa00);
            color: #4a3000;
        }

        .coin.tails {
            background: linear-gradient(135deg, #c0c0c0, #808080);
            color: #303030;
        }

        .coin.flipping {
            animation: flip 0.5s ease-in-out;
        }

        @keyframes flip {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(720deg); }
        }

        .flip-history {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            justify-content: center;
            margin-top: 15px;
            min-height: 40px;
        }

        .mini-coin {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            font-weight: bold;
        }

        .mini-coin.heads {
            background: linear-gradient(135deg, #ffd700, #ffaa00);
            color: #4a3000;
        }

        .mini-coin.tails {
            background: linear-gradient(135deg, #c0c0c0, #808080);
            color: #303030;
        }

        .result-display {
            text-align: center;
            padding: 20px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 12px;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }

        .winnings {
            font-size: 2.5em;
            font-weight: 600;
            color: #ffd700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .winnings-label {
            color: #c0a8d8;
            margin-bottom: 5px;
        }

        .formula-display {
            font-family: 'Courier New', monospace;
            color: #a8d8c0;
            margin-top: 10px;
        }

        button {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.2s;
            margin: 5px;
        }

        .btn-gold {
            background: linear-gradient(135deg, #ffd700, #ffaa00);
            color: #2d1b0e;
        }

        .btn-gold:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(255, 215, 0, 0.5);
        }

        .btn-secondary {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
            border: 1px solid rgba(255, 215, 0, 0.4);
        }

        .btn-secondary:hover {
            background: rgba(255, 215, 0, 0.3);
        }

        .expected-value-calc {
            background: rgba(20, 10, 40, 0.6);
            border-radius: 12px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            line-height: 1.8;
        }

        .ev-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 215, 0, 0.1);
        }

        .ev-prob { color: #a8c8d8; }
        .ev-payout { color: #ffd700; }
        .ev-contribution { color: #a8d8c0; }

        .ev-total {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid rgba(255, 215, 0, 0.3);
            text-align: center;
            font-size: 1.3em;
        }

        .infinity {
            font-size: 2em;
            color: #ffd700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .simulation-section {
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(20, 10, 40, 0.6);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: 600;
            color: #ffd700;
        }

        .stat-label {
            color: #c0a8d8;
            font-size: 0.9em;
        }

        canvas {
            display: block;
            width: 100%;
            background: rgba(20, 10, 40, 0.6);
            border-radius: 12px;
        }

        .explanation {
            background: rgba(45, 27, 78, 0.7);
            border-radius: 16px;
            padding: 25px;
            border: 1px solid rgba(255, 215, 0, 0.2);
            margin-bottom: 20px;
        }

        .explanation h2 {
            font-family: 'Lora', serif;
            color: #ffd700;
            margin-bottom: 15px;
        }

        .explanation p {
            line-height: 1.7;
            margin-bottom: 12px;
            color: #d0c0e0;
        }

        .highlight {
            color: #ffd700;
            font-weight: 600;
        }

        .quote-box {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(200, 150, 0, 0.1));
            border-left: 4px solid #ffd700;
            padding: 15px;
            border-radius: 0 10px 10px 0;
            margin: 15px 0;
            font-style: italic;
        }

        .quote-box .author {
            color: #a8c8d8;
            font-style: normal;
            margin-top: 10px;
            text-align: right;
        }

        .utility-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .utility-calc {
            background: rgba(20, 10, 40, 0.6);
            border-radius: 12px;
            padding: 20px;
        }

        .utility-calc h3 {
            color: #a8d8c0;
            margin-bottom: 15px;
        }

        .slider-group {
            margin-bottom: 20px;
        }

        .slider-group label {
            display: block;
            color: #c0a8d8;
            margin-bottom: 8px;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #2d1b4e;
            appearance: none;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ffd700;
            cursor: pointer;
        }

        .fair-price {
            text-align: center;
            padding: 20px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 10px;
            margin-top: 15px;
        }

        .fair-price-value {
            font-size: 2em;
            font-weight: 600;
            color: #a8d8c0;
        }

        @media (max-width: 800px) {
            .game-section, .utility-section {
                grid-template-columns: 1fr;
            }
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê Back to Paradoxes</a>

        <h1>The St. Petersburg Paradox</h1>
        <p class="subtitle">A game with infinite expected value that nobody would pay much to play</p>

        <div class="game-section">
            <div class="panel">
                <h2>üé∞ Play the Game</h2>
                <p style="margin-bottom: 15px; color: #c0a8d8;">
                    Flip a coin until it lands <strong>HEADS</strong>. You win $2<sup>n</sup> where n = number of flips.
                </p>

                <div class="coin-display">
                    <div class="coin heads" id="coin">H</div>
                    <div class="flip-history" id="flipHistory"></div>
                </div>

                <div class="result-display">
                    <div class="winnings-label">Your Winnings:</div>
                    <div class="winnings" id="winnings">$0</div>
                    <div class="formula-display" id="formula">Play to see your result!</div>
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn-gold" id="playBtn">ü™ô Play Once</button>
                    <button class="btn-secondary" id="resetGameBtn">Reset</button>
                </div>
            </div>

            <div class="panel">
                <h2>üìä Expected Value Calculation</h2>
                <p style="margin-bottom: 15px; color: #c0a8d8;">
                    Each outcome contributes $1 to the expected value:
                </p>

                <div class="expected-value-calc">
                    <div class="ev-row">
                        <span class="ev-prob">P(1 flip) = ¬Ω</span>
                        <span class="ev-payout">√ó $2</span>
                        <span class="ev-contribution">= $1</span>
                    </div>
                    <div class="ev-row">
                        <span class="ev-prob">P(2 flips) = ¬º</span>
                        <span class="ev-payout">√ó $4</span>
                        <span class="ev-contribution">= $1</span>
                    </div>
                    <div class="ev-row">
                        <span class="ev-prob">P(3 flips) = ‚Öõ</span>
                        <span class="ev-payout">√ó $8</span>
                        <span class="ev-contribution">= $1</span>
                    </div>
                    <div class="ev-row">
                        <span class="ev-prob">P(4 flips) = 1/16</span>
                        <span class="ev-payout">√ó $16</span>
                        <span class="ev-contribution">= $1</span>
                    </div>
                    <div class="ev-row">
                        <span class="ev-prob">P(n flips) = 1/2‚Åø</span>
                        <span class="ev-payout">√ó $2‚Åø</span>
                        <span class="ev-contribution">= $1</span>
                    </div>
                    <div class="ev-row">
                        <span style="color: #808080;">‚ãÆ</span>
                        <span></span>
                        <span style="color: #808080;">‚ãÆ</span>
                    </div>
                    <div class="ev-total">
                        E[X] = $1 + $1 + $1 + ... = <span class="infinity">‚àû</span>
                    </div>
                </div>

                <p style="margin-top: 15px; color: #c0a8d8; text-align: center;">
                    Yet most people wouldn't pay even <span class="highlight">$25</span> to play!
                </p>
            </div>
        </div>

        <div class="panel simulation-section">
            <h2>üî¨ Run 1,000 Simulations</h2>
            <p style="margin-bottom: 20px; color: #c0a8d8;">
                See what actually happens when you play many times:
            </p>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="simGames">0</div>
                    <div class="stat-label">Games Played</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="simAvg">$0</div>
                    <div class="stat-label">Average Winnings</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="simMedian">$0</div>
                    <div class="stat-label">Median Winnings</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="simMax">$0</div>
                    <div class="stat-label">Maximum Win</div>
                </div>
            </div>

            <canvas id="histogramCanvas" width="1100" height="300"></canvas>

            <div style="text-align: center; margin-top: 20px;">
                <button class="btn-gold" id="sim1000Btn">Run 1,000 Games</button>
                <button class="btn-secondary" id="sim10000Btn">Run 10,000 Games</button>
                <button class="btn-secondary" id="resetSimBtn">Reset</button>
            </div>

            <p style="margin-top: 15px; color: #c0a8d8; text-align: center; font-size: 0.95em;">
                Notice: The <span class="highlight">median</span> is always just $2 or $4, but rare jackpots pull the average up!
            </p>
        </div>

        <div class="explanation">
            <h2>The Paradox Explained</h2>

            <p>
                In 1713, <span class="highlight">Nicolas Bernoulli</span> posed this puzzle in a letter.
                His cousin <span class="highlight">Daniel Bernoulli</span> analyzed it while living in St. Petersburg,
                giving the paradox its name. The problem:
            </p>

            <div class="quote-box">
                "A rational gambler should enter any game where the entry fee is less than the expected value.
                Since the St. Petersburg game has <em>infinite</em> expected value, a rational player should
                pay ANY finite amount to play. Yet no reasonable person would pay even $100."
                <div class="author">‚Äî The Paradox</div>
            </div>

            <h2 style="margin-top: 25px;">Daniel Bernoulli's Resolution: Utility Theory</h2>

            <p>
                Bernoulli proposed that people don't maximize <em>money</em>‚Äîthey maximize <em>utility</em>.
                The utility of money follows a <span class="highlight">logarithmic function</span>:
                doubling your wealth doesn't double your happiness.
            </p>

            <div class="utility-section">
                <div class="utility-calc">
                    <h3>Utility Function: U(w) = ln(w)</h3>
                    <p style="color: #c0a8d8; margin-bottom: 15px;">
                        Instead of E[$] = ‚àû, we calculate E[Utility]:
                    </p>
                    <div style="font-family: 'Courier New', monospace; line-height: 2;">
                        <div>E[U] = ¬Ω¬∑ln(2) + ¬º¬∑ln(4) + ‚Öõ¬∑ln(8) + ...</div>
                        <div style="margin-top: 10px;">E[U] = Œ£ (1/2‚Åø)¬∑ln(2‚Åø)</div>
                        <div style="margin-top: 10px;">E[U] = ln(2)¬∑Œ£ (n/2‚Åø)</div>
                        <div style="margin-top: 10px; color: #a8d8c0; font-size: 1.2em;">E[U] = <strong>2¬∑ln(2) ‚âà 1.39</strong></div>
                    </div>
                </div>

                <div class="utility-calc">
                    <h3>Your Wealth & Fair Price</h3>
                    <div class="slider-group">
                        <label>Your current wealth: $<span id="wealthValue">1,000</span></label>
                        <input type="range" id="wealthSlider" min="100" max="1000000" value="1000">
                    </div>
                    <p style="color: #c0a8d8; font-size: 0.9em;">
                        With log utility, the "fair price" you'd pay depends on your starting wealth:
                    </p>
                    <div class="fair-price">
                        <div style="color: #c0a8d8;">Fair Entry Price (Log Utility):</div>
                        <div class="fair-price-value" id="fairPrice">$4</div>
                    </div>
                </div>
            </div>

            <h2 style="margin-top: 25px;">But Wait‚ÄîThe Paradox Returns!</h2>

            <p>
                Here's the twist: we can construct a <span class="highlight">"Super St. Petersburg"</span> game
                that gives infinite <em>expected utility</em> too! Just increase the payoffs to
                $e<sup>2‚Åø</sup> instead of $2‚Åø. The utility solution works for one game but not in general.
            </p>

            <p>
                Modern economists like <span class="highlight">Kenneth Arrow</span> argue that utility functions
                must be <em>bounded</em> to avoid the paradox entirely. Others point to
                <span class="highlight">finite casino wealth</span> as a practical limit‚Äîno casino can pay $2<sup>40</sup>.
            </p>

            <div class="quote-box">
                "The St. Petersburg paradox teaches us that expected value alone is insufficient for decision-making.
                Risk, utility, probability weighting, and practical constraints all matter."
                <div class="author">‚Äî Modern Decision Theory</div>
            </div>
        </div>
    </div>

    <script>
        // Game state
        let currentFlips = [];
        let simResults = [];

        // DOM elements
        const coin = document.getElementById('coin');
        const flipHistory = document.getElementById('flipHistory');
        const winningsEl = document.getElementById('winnings');
        const formulaEl = document.getElementById('formula');

        // Play single game
        function playGame() {
            currentFlips = [];
            flipHistory.innerHTML = '';

            // Flip until heads
            let isHeads = false;
            while (!isHeads) {
                isHeads = Math.random() < 0.5;
                currentFlips.push(isHeads ? 'H' : 'T');
            }

            // Animate
            animateFlips(0);
        }

        function animateFlips(index) {
            if (index >= currentFlips.length) {
                showResult();
                return;
            }

            const isHeads = currentFlips[index] === 'H';
            coin.classList.remove('heads', 'tails');
            coin.classList.add('flipping');

            setTimeout(() => {
                coin.classList.remove('flipping');
                coin.classList.add(isHeads ? 'heads' : 'tails');
                coin.textContent = isHeads ? 'H' : 'T';

                // Add to history
                const miniCoin = document.createElement('div');
                miniCoin.className = `mini-coin ${isHeads ? 'heads' : 'tails'}`;
                miniCoin.textContent = isHeads ? 'H' : 'T';
                flipHistory.appendChild(miniCoin);

                setTimeout(() => animateFlips(index + 1), 300);
            }, 400);
        }

        function showResult() {
            const n = currentFlips.length;
            const winnings = Math.pow(2, n);

            winningsEl.textContent = `$${winnings.toLocaleString()}`;
            formulaEl.textContent = `2^${n} = $${winnings.toLocaleString()}`;

            // Highlight effect
            winningsEl.style.transform = 'scale(1.2)';
            setTimeout(() => winningsEl.style.transform = 'scale(1)', 300);
        }

        function resetGame() {
            currentFlips = [];
            flipHistory.innerHTML = '';
            winningsEl.textContent = '$0';
            formulaEl.textContent = 'Play to see your result!';
            coin.classList.remove('heads', 'tails');
            coin.classList.add('heads');
            coin.textContent = 'H';
        }

        // Simulation
        function simulateGame() {
            let flips = 0;
            let isHeads = false;
            while (!isHeads) {
                flips++;
                isHeads = Math.random() < 0.5;
            }
            return Math.pow(2, flips);
        }

        function runSimulation(count) {
            for (let i = 0; i < count; i++) {
                simResults.push(simulateGame());
            }
            updateSimStats();
            drawHistogram();
        }

        function updateSimStats() {
            const n = simResults.length;
            if (n === 0) {
                document.getElementById('simGames').textContent = '0';
                document.getElementById('simAvg').textContent = '$0';
                document.getElementById('simMedian').textContent = '$0';
                document.getElementById('simMax').textContent = '$0';
                return;
            }

            const sum = simResults.reduce((a, b) => a + b, 0);
            const avg = sum / n;
            const sorted = [...simResults].sort((a, b) => a - b);
            const median = sorted[Math.floor(n / 2)];
            const max = Math.max(...simResults);

            document.getElementById('simGames').textContent = n.toLocaleString();
            document.getElementById('simAvg').textContent = `$${avg.toFixed(2)}`;
            document.getElementById('simMedian').textContent = `$${median}`;
            document.getElementById('simMax').textContent = `$${max.toLocaleString()}`;
        }

        function drawHistogram() {
            const canvas = document.getElementById('histogramCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (simResults.length === 0) return;

            const padding = { left: 60, right: 30, top: 30, bottom: 50 };
            const plotWidth = canvas.width - padding.left - padding.right;
            const plotHeight = canvas.height - padding.top - padding.bottom;

            // Count by power of 2
            const counts = {};
            simResults.forEach(r => {
                const exp = Math.log2(r);
                counts[exp] = (counts[exp] || 0) + 1;
            });

            const maxExp = Math.max(...Object.keys(counts).map(Number));
            const maxCount = Math.max(...Object.values(counts));

            // Draw bars
            const barWidth = plotWidth / (maxExp + 1) - 5;

            ctx.fillStyle = '#1a0a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Grid lines
            ctx.strokeStyle = 'rgba(255, 215, 0, 0.1)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const y = padding.top + (plotHeight / 5) * i;
                ctx.beginPath();
                ctx.moveTo(padding.left, y);
                ctx.lineTo(canvas.width - padding.right, y);
                ctx.stroke();
            }

            // Axes
            ctx.strokeStyle = '#ffd700';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding.left, padding.top);
            ctx.lineTo(padding.left, padding.top + plotHeight);
            ctx.lineTo(canvas.width - padding.right, padding.top + plotHeight);
            ctx.stroke();

            // Bars
            for (let exp = 1; exp <= maxExp; exp++) {
                const count = counts[exp] || 0;
                const x = padding.left + (exp - 0.5) * (plotWidth / (maxExp + 1));
                const barHeight = (count / maxCount) * plotHeight;
                const y = padding.top + plotHeight - barHeight;

                const gradient = ctx.createLinearGradient(x, y + barHeight, x, y);
                gradient.addColorStop(0, '#8b6914');
                gradient.addColorStop(1, '#ffd700');

                ctx.fillStyle = gradient;
                ctx.fillRect(x - barWidth / 2, y, barWidth, barHeight);

                // Labels
                ctx.fillStyle = '#c0a8d8';
                ctx.font = '11px Nunito';
                ctx.textAlign = 'center';
                ctx.fillText(`$${Math.pow(2, exp)}`, x, padding.top + plotHeight + 20);

                if (count > 0) {
                    ctx.fillStyle = '#ffd700';
                    ctx.fillText(count, x, y - 5);
                }
            }

            // Axis labels
            ctx.fillStyle = '#c0a8d8';
            ctx.font = '12px Nunito';
            ctx.textAlign = 'center';
            ctx.fillText('Payout Amount', canvas.width / 2, canvas.height - 5);

            ctx.save();
            ctx.translate(15, canvas.height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('Frequency', 0, 0);
            ctx.restore();
        }

        function resetSimulation() {
            simResults = [];
            updateSimStats();
            drawHistogram();
        }

        // Utility calculation
        function updateFairPrice() {
            const wealth = parseInt(document.getElementById('wealthSlider').value);
            document.getElementById('wealthValue').textContent = wealth.toLocaleString();

            // Calculate expected utility with log utility
            // E[U] = Œ£ (1/2^n) * ln(wealth + 2^n)
            // Fair price p satisfies: ln(wealth - p) = E[U]

            let expectedUtility = 0;
            for (let n = 1; n <= 40; n++) {
                const prob = Math.pow(0.5, n);
                const payout = Math.pow(2, n);
                expectedUtility += prob * Math.log(wealth + payout);
            }

            // Solve: ln(wealth - p) = expectedUtility
            // wealth - p = e^expectedUtility
            // p = wealth - e^expectedUtility
            const fairPrice = wealth - Math.exp(expectedUtility);

            document.getElementById('fairPrice').textContent =
                fairPrice > 0 ? `$${Math.abs(fairPrice).toFixed(2)}` : `$${Math.abs(fairPrice).toFixed(2)}`;
        }

        // Event listeners
        document.getElementById('playBtn').addEventListener('click', playGame);
        document.getElementById('resetGameBtn').addEventListener('click', resetGame);
        document.getElementById('sim1000Btn').addEventListener('click', () => runSimulation(1000));
        document.getElementById('sim10000Btn').addEventListener('click', () => runSimulation(10000));
        document.getElementById('resetSimBtn').addEventListener('click', resetSimulation);
        document.getElementById('wealthSlider').addEventListener('input', updateFairPrice);

        // Initialize
        drawHistogram();
        updateFairPrice();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
