<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>#103: The Two Generals Problem - Consensus Is Impossible</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600;700&family=Nunito:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #1a1a2e;
            --valley: #0f3460;
            --general1: #e94560;
            --general2: #0f9b0f;
            --messenger: #f39c12;
            --captured: #7f8c8d;
            --text: #eee;
            --accent: #00d9ff;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Nunito', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }
        
        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: var(--accent);
            text-decoration: none;
            font-weight: 600;
            z-index: 100;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 80px 20px 40px;
        }
        
        h1 {
            font-family: 'Lora', serif;
            font-size: 2.4rem;
            text-align: center;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--general1), var(--general2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .subtitle {
            text-align: center;
            font-size: 1.1rem;
            color: var(--accent);
            margin-bottom: 2rem;
        }
        
        .intro {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            line-height: 1.7;
        }
        
        .battlefield {
            background: linear-gradient(180deg, #0a0a1a 0%, var(--valley) 40%, #2d5016 100%);
            border-radius: 20px;
            padding: 2rem;
            position: relative;
            height: 400px;
            overflow: hidden;
            margin: 2rem 0;
        }
        
        .mountain-left, .mountain-right {
            position: absolute;
            bottom: 0;
            width: 35%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
            padding-bottom: 20px;
        }
        
        .mountain-left {
            left: 0;
            background: linear-gradient(135deg, #5c4033 0%, #3d2817 100%);
            clip-path: polygon(0 30%, 50% 0, 100% 40%, 100% 100%, 0 100%);
        }
        
        .mountain-right {
            right: 0;
            background: linear-gradient(225deg, #5c4033 0%, #3d2817 100%);
            clip-path: polygon(0 40%, 50% 0, 100% 30%, 100% 100%, 0 100%);
        }
        
        .general {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            position: relative;
            z-index: 10;
        }
        
        .general-1 {
            background: var(--general1);
            box-shadow: 0 0 30px var(--general1);
        }
        
        .general-2 {
            background: var(--general2);
            box-shadow: 0 0 30px var(--general2);
        }
        
        .general-label {
            position: absolute;
            bottom: -30px;
            font-weight: 700;
            font-size: 0.9rem;
            white-space: nowrap;
        }
        
        .valley-floor {
            position: absolute;
            bottom: 0;
            left: 35%;
            width: 30%;
            height: 60%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .enemy-territory {
            position: absolute;
            top: 50%;
            left: 35%;
            width: 30%;
            text-align: center;
            transform: translateY(-50%);
            color: rgba(255,255,255,0.3);
            font-size: 0.9rem;
        }
        
        .messengers-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .messenger {
            position: absolute;
            font-size: 1.5rem;
            transition: none;
            z-index: 5;
        }
        
        .controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin: 2rem 0;
        }
        
        .btn {
            padding: 12px 24px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-general1 {
            background: var(--general1);
            color: white;
        }
        
        .btn-general2 {
            background: var(--general2);
            color: white;
        }
        
        .btn:hover {
            transform: scale(1.05);
        }
        
        .btn-reset {
            background: rgba(255,255,255,0.1);
            color: var(--text);
            border: 2px solid var(--text);
        }
        
        .capture-rate {
            text-align: center;
            margin: 1rem 0;
        }
        
        .capture-slider {
            width: 200px;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 4px;
            background: rgba(255,255,255,0.2);
        }
        
        .capture-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--messenger);
            cursor: pointer;
        }
        
        .knowledge-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin: 2rem 0;
        }
        
        .knowledge-box {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 1.5rem;
        }
        
        .knowledge-box h3 {
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }
        
        .knowledge-box.general1 {
            border-left: 4px solid var(--general1);
        }
        
        .knowledge-box.general2 {
            border-left: 4px solid var(--general2);
        }
        
        .knowledge-list {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.8;
        }
        
        .knowledge-item {
            padding: 4px 8px;
            border-radius: 4px;
            margin: 4px 0;
            background: rgba(255,255,255,0.05);
        }
        
        .knowledge-item.confirmed {
            background: rgba(0, 217, 255, 0.2);
            border-left: 3px solid var(--accent);
        }
        
        .knowledge-item.uncertain {
            background: rgba(243, 156, 18, 0.2);
            border-left: 3px solid var(--messenger);
        }
        
        .message-log {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 1rem;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            margin: 1rem 0;
        }
        
        .log-entry {
            padding: 4px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .log-entry.captured {
            color: var(--captured);
            text-decoration: line-through;
        }
        
        .log-entry.delivered {
            color: var(--accent);
        }
        
        .paradox-explanation {
            background: linear-gradient(135deg, rgba(233,69,96,0.1) 0%, rgba(15,155,15,0.1) 100%);
            border: 2px solid var(--accent);
            border-radius: 16px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .paradox-explanation h2 {
            font-family: 'Lora', serif;
            color: var(--accent);
            margin-bottom: 1rem;
        }
        
        .infinite-regress {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
            text-align: center;
        }
        
        .regress-chain {
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
            line-height: 2;
        }
        
        .regress-level {
            opacity: 0;
            animation: fadeIn 0.5s forwards;
        }
        
        .philosophy-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        
        .philosophy-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 1.5rem;
            border-top: 3px solid var(--accent);
        }
        
        .philosophy-card h3 {
            color: var(--accent);
            margin-bottom: 0.75rem;
        }
        
        .philosophy-card p {
            line-height: 1.6;
            font-size: 0.95rem;
        }
        
        .attack-status {
            text-align: center;
            font-size: 1.5rem;
            margin: 1rem 0;
            padding: 1rem;
            border-radius: 10px;
        }
        
        .attack-status.success {
            background: rgba(15, 155, 15, 0.3);
            color: var(--general2);
        }
        
        .attack-status.failure {
            background: rgba(233, 69, 96, 0.3);
            color: var(--general1);
        }
        
        .attack-status.waiting {
            background: rgba(243, 156, 18, 0.3);
            color: var(--messenger);
        }
        
        .citation {
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 2rem;
            font-size: 0.9rem;
        }
        
        .citation a {
            color: var(--accent);
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        @keyframes runRight {
            0% { left: 15%; }
            100% { left: 80%; }
        }
        
        @keyframes runLeft {
            0% { left: 80%; }
            100% { left: 15%; }
        }
        
        @media (max-width: 768px) {
            h1 { font-size: 1.8rem; }
            .battlefield { height: 300px; }
            .general { width: 60px; height: 60px; font-size: 2rem; }
            .knowledge-display { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Paradoxes</a>
    
    <div class="container">
        <h1>The Two Generals Problem</h1>
        <p class="subtitle">Why perfect consensus over unreliable channels is mathematically IMPOSSIBLE</p>
        
        <div class="intro">
            <p><strong>The Scenario (1975):</strong> Two allied generals must coordinate a simultaneous attack on a city. They're positioned on opposite mountains, with the enemy in the valley between them. Their ONLY means of communication is sending messengers through enemy territory‚Äîand messengers can be captured.</p>
            <p style="margin-top: 1rem;"><strong>The Challenge:</strong> Both generals must attack at the same time, or the attack fails. How can they EVER be certain the other will attack?</p>
        </div>
        
        <div class="battlefield">
            <div class="mountain-left">
                <div class="general general-1">‚öîÔ∏è
                    <span class="general-label" style="color: var(--general1)">General A</span>
                </div>
            </div>
            
            <div class="enemy-territory">
                ‚ò†Ô∏è ENEMY TERRITORY ‚ò†Ô∏è<br>
                <span style="font-size: 0.8rem;">Messengers may be captured</span>
            </div>
            
            <div class="mountain-right">
                <div class="general general-2">‚öîÔ∏è
                    <span class="general-label" style="color: var(--general2)">General B</span>
                </div>
            </div>
            
            <div class="messengers-container" id="messengersContainer"></div>
        </div>
        
        <div class="attack-status waiting" id="attackStatus">
            ‚è≥ Awaiting coordination...
        </div>
        
        <div class="controls">
            <button class="btn btn-general1" id="sendFromA">üì® A sends "Attack at dawn!"</button>
            <button class="btn btn-general2" id="sendFromB">üì® B sends "Acknowledged!"</button>
            <button class="btn btn-reset" id="resetBtn">üîÑ Reset</button>
        </div>
        
        <div class="capture-rate">
            <label>Messenger capture probability: <span id="captureLabel">30%</span></label><br>
            <input type="range" class="capture-slider" id="captureSlider" min="0" max="90" value="30">
        </div>
        
        <div class="message-log" id="messageLog">
            <div style="color: rgba(255,255,255,0.5);">Message history will appear here...</div>
        </div>
        
        <div class="knowledge-display">
            <div class="knowledge-box general1">
                <h3 style="color: var(--general1);">üî¥ General A knows:</h3>
                <div class="knowledge-list" id="knowledgeA">
                    <div class="knowledge-item confirmed">‚úì I want to attack at dawn</div>
                </div>
            </div>
            <div class="knowledge-box general2">
                <h3 style="color: var(--general2);">üü¢ General B knows:</h3>
                <div class="knowledge-list" id="knowledgeB">
                    <div class="knowledge-item uncertain">? Waiting for orders...</div>
                </div>
            </div>
        </div>
        
        <div class="paradox-explanation">
            <h2>üéØ The Paradox: Infinite Regress</h2>
            <p>Suppose General A sends "Attack at dawn" and the messenger arrives. Now:</p>
            
            <div class="infinite-regress">
                <div class="regress-chain" id="regressChain">
                    <div>1. A knows the plan ‚úì</div>
                    <div>2. B knows the plan (message arrived)</div>
                    <div>3. But A doesn't know that B knows! (no confirmation)</div>
                    <div>4. So B sends confirmation... but B doesn't know if A received it!</div>
                    <div>5. So A sends "I got your confirmation"... but A doesn't know if B got THAT!</div>
                    <div style="color: var(--messenger);">‚àû This continues FOREVER. There's always uncertainty.</div>
                </div>
            </div>
            
            <p style="margin-top: 1rem;"><strong>The Proof:</strong> Any protocol requires a FINAL message that triggers the attack. But that message could be lost! If General X attacks only because the final message arrived, then losing it means X doesn't attack‚Äîwhile the other general does. Disaster.</p>
        </div>
        
        <div class="philosophy-grid">
            <div class="philosophy-card">
                <h3>First Impossibility Proof (1975)</h3>
                <p>This was the FIRST computer communication problem proven mathematically unsolvable. It established fundamental limits on distributed coordination that still apply to every networked system today.</p>
            </div>
            <div class="philosophy-card">
                <h3>Common Knowledge</h3>
                <p>The issue is "common knowledge" ‚Äî both knowing the plan isn't enough. They need to know that the other knows that they know... ad infinitum. This infinite hierarchy can't be achieved over unreliable channels.</p>
            </div>
            <div class="philosophy-card">
                <h3>Real-World Implications</h3>
                <p>This proves TCP handshakes can't guarantee delivery, Bitcoin consensus is probabilistic, and distributed databases must trade consistency for availability (CAP theorem). Perfect sync is IMPOSSIBLE.</p>
            </div>
            <div class="philosophy-card">
                <h3>Practical Workarounds</h3>
                <p>We use timeouts, retries, and probabilistic protocols (Paxos, Raft). We accept that "good enough" consensus is achievable, but PERFECT agreement over unreliable networks is forever out of reach.</p>
            </div>
        </div>
        
        <div class="citation">
            <strong>Sources:</strong><br>
            ‚Ä¢ Akkoyunlu, Ekanadham & Huber (1975). "Some Constraints and Trade-offs in the Design of Network Communications"<br>
            ‚Ä¢ Gray, J. (1978). Named it "The Two Generals Paradox" in "Notes on Data Base Operating Systems"<br>
            ‚Ä¢ <a href="https://en.wikipedia.org/wiki/Two_Generals'_Problem" target="_blank">Wikipedia: Two Generals' Problem</a>
        </div>
    </div>
    
    <script>
        const messengersContainer = document.getElementById('messengersContainer');
        const messageLog = document.getElementById('messageLog');
        const knowledgeA = document.getElementById('knowledgeA');
        const knowledgeB = document.getElementById('knowledgeB');
        const attackStatus = document.getElementById('attackStatus');
        const captureSlider = document.getElementById('captureSlider');
        const captureLabel = document.getElementById('captureLabel');
        
        let messageCount = 0;
        let aKnowledge = ['I want to attack at dawn'];
        let bKnowledge = [];
        let lastDeliveredToA = false;
        let lastDeliveredToB = false;
        
        captureSlider.addEventListener('input', (e) => {
            captureLabel.textContent = e.target.value + '%';
        });
        
        function addLogEntry(text, className = '') {
            const entry = document.createElement('div');
            entry.className = 'log-entry ' + className;
            entry.textContent = text;
            if (messageLog.firstChild.textContent.includes('will appear')) {
                messageLog.innerHTML = '';
            }
            messageLog.appendChild(entry);
            messageLog.scrollTop = messageLog.scrollHeight;
        }
        
        function updateKnowledge() {
            knowledgeA.innerHTML = aKnowledge.map((k, i) => 
                `<div class="knowledge-item ${i === 0 ? 'confirmed' : 'uncertain'}">
                    ${i === 0 ? '‚úì' : '?'} ${k}
                </div>`
            ).join('');
            
            if (bKnowledge.length === 0) {
                knowledgeB.innerHTML = '<div class="knowledge-item uncertain">? Waiting for orders...</div>';
            } else {
                knowledgeB.innerHTML = bKnowledge.map((k, i) => 
                    `<div class="knowledge-item ${i === 0 && lastDeliveredToB ? 'confirmed' : 'uncertain'}">
                        ${i === 0 && lastDeliveredToB ? '‚úì' : '?'} ${k}
                    </div>`
                ).join('');
            }
            
            updateAttackStatus();
        }
        
        function updateAttackStatus() {
            const aConfirmed = aKnowledge.length > 0;
            const bConfirmed = bKnowledge.length > 0 && lastDeliveredToB;
            
            if (!bConfirmed) {
                attackStatus.className = 'attack-status waiting';
                attackStatus.innerHTML = '‚è≥ Coordination incomplete - attack risky!';
            } else if (messageCount >= 3) {
                attackStatus.className = 'attack-status waiting';
                attackStatus.innerHTML = 'üîÑ Still uncertain! More messages needed? (But they could be lost too...)';
            } else {
                attackStatus.className = 'attack-status waiting';
                attackStatus.innerHTML = '‚ö†Ô∏è B knows the plan, but does A know that B knows?';
            }
        }
        
        function sendMessenger(fromA) {
            const captureRate = parseInt(captureSlider.value) / 100;
            const captured = Math.random() < captureRate;
            
            messageCount++;
            
            const messenger = document.createElement('div');
            messenger.className = 'messenger';
            messenger.textContent = 'üèÉ';
            messenger.style.top = '50%';
            
            const messages = [
                'Attack at dawn!',
                'Acknowledged, I will attack!',
                'Got your ACK!',
                'Confirmed your confirmation!',
                'I know you know I know!',
                'ACK of ACK of ACK...'
            ];
            
            const msgText = messages[Math.min(messageCount - 1, messages.length - 1)];
            
            if (fromA) {
                messenger.style.left = '15%';
                messenger.style.animation = 'runRight 2s linear forwards';
                addLogEntry(`[${messageCount}] A ‚Üí B: "${msgText}"`, captured ? 'captured' : '');
            } else {
                messenger.style.left = '80%';
                messenger.style.transform = 'scaleX(-1)';
                messenger.style.animation = 'runLeft 2s linear forwards';
                addLogEntry(`[${messageCount}] B ‚Üí A: "${msgText}"`, captured ? 'captured' : '');
            }
            
            messengersContainer.appendChild(messenger);
            
            setTimeout(() => {
                if (captured) {
                    messenger.textContent = 'üíÄ';
                    addLogEntry(`   ‚Ü≥ CAPTURED by enemy!`, 'captured');
                } else {
                    messenger.textContent = '‚úì';
                    if (fromA) {
                        bKnowledge.unshift('A wants to attack at dawn');
                        lastDeliveredToB = true;
                        addLogEntry(`   ‚Ü≥ Delivered to B`, 'delivered');
                    } else {
                        aKnowledge.push('B received my message');
                        lastDeliveredToA = true;
                        addLogEntry(`   ‚Ü≥ Delivered to A`, 'delivered');
                    }
                    updateKnowledge();
                }
                
                setTimeout(() => {
                    messenger.remove();
                }, 500);
            }, 2000);
        }
        
        document.getElementById('sendFromA').addEventListener('click', () => sendMessenger(true));
        document.getElementById('sendFromB').addEventListener('click', () => sendMessenger(false));
        
        document.getElementById('resetBtn').addEventListener('click', () => {
            messageCount = 0;
            aKnowledge = ['I want to attack at dawn'];
            bKnowledge = [];
            lastDeliveredToA = false;
            lastDeliveredToB = false;
            messengersContainer.innerHTML = '';
            messageLog.innerHTML = '<div style="color: rgba(255,255,255,0.5);">Message history will appear here...</div>';
            updateKnowledge();
            attackStatus.className = 'attack-status waiting';
            attackStatus.innerHTML = '‚è≥ Awaiting coordination...';
        });
        
        updateKnowledge();
    </script>
</body>
</html>
