<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buffon's Needle - Dropping Sticks to Find Pi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a2a1a 0%, #2d4e2d 50%, #0f2e0f 100%);
            min-height: 100vh;
            color: #e0e0e0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #7eea66, #4ba276, #93fb70);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #8adc8a;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
            margin-top: 20px;
        }

        .visualization {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .canvas-container {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(126, 234, 102, 0.2);
        }

        canvas {
            display: block;
            width: 100%;
            background: #0a1a0a;
            border-radius: 10px;
        }

        .controls {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(126, 234, 102, 0.2);
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            color: #7eea66;
            margin-bottom: 8px;
            font-weight: 500;
        }

        input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }

        .range-value {
            text-align: center;
            color: #93fb70;
            font-family: monospace;
        }

        .button-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        button {
            padding: 12px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .control-btn {
            background: linear-gradient(135deg, #7eea66, #4ba276);
            color: #000;
            font-size: 1rem;
        }

        .control-btn:hover {
            background: linear-gradient(135deg, #4ba276, #7eea66);
            transform: scale(1.02);
        }

        .drop-btn {
            background: linear-gradient(135deg, #2a4e1a, #3a5e2a);
            color: #e0e0e0;
            border: 1px solid rgba(126, 234, 102, 0.3);
            font-size: 0.9rem;
        }

        .drop-btn:hover {
            background: linear-gradient(135deg, #3a5e2a, #4a6e3a);
            border-color: #7eea66;
        }

        .stats {
            background: rgba(126, 234, 102, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .pi-display {
            text-align: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .pi-label {
            color: #8adc8a;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .pi-value {
            font-size: 2.5rem;
            font-family: monospace;
            color: #7eea66;
            font-weight: bold;
        }

        .pi-error {
            font-size: 0.85rem;
            color: #93fb70;
            margin-top: 5px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid rgba(126, 234, 102, 0.1);
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #8adc8a;
        }

        .stat-value {
            color: #7eea66;
            font-family: monospace;
        }

        .formula-box {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            border-left: 3px solid #4ba276;
        }

        .formula-title {
            color: #4ba276;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .formula {
            font-family: monospace;
            font-size: 1.1rem;
            color: #ddd;
            text-align: center;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }

        .quote-box {
            background: linear-gradient(135deg, rgba(126, 234, 102, 0.1), rgba(75, 162, 118, 0.1));
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            font-style: italic;
            color: #8adc8a;
            text-align: center;
        }

        .quote-author {
            margin-top: 10px;
            font-style: normal;
            color: #7eea66;
        }

        .explanation {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .exp-card {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(126, 234, 102, 0.2);
        }

        .exp-card h3 {
            color: #7eea66;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .exp-card p {
            line-height: 1.7;
            color: #bbb;
        }

        .highlight {
            color: #93fb70;
            font-weight: 500;
        }

        .back-link {
            display: inline-block;
            color: #7eea66;
            text-decoration: none;
            margin-bottom: 20px;
            transition: transform 0.3s;
        }

        .back-link:hover {
            transform: translateX(-5px);
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê Back to Paradoxes</a>

        <header>
            <h1>Buffon's Needle</h1>
            <p class="subtitle">Dropping sticks to estimate Pi - a 1777 Monte Carlo experiment</p>
        </header>

        <div class="main-content">
            <div class="visualization">
                <div class="canvas-container">
                    <canvas id="needleCanvas" width="800" height="500"></canvas>
                </div>
                <div class="canvas-container">
                    <canvas id="graphCanvas" width="800" height="180"></canvas>
                </div>
            </div>

            <div class="controls">
                <div class="pi-display">
                    <div class="pi-label">Estimated Value of Pi</div>
                    <div class="pi-value" id="piEstimate">‚Äî</div>
                    <div class="pi-error" id="piError">Drop needles to begin</div>
                </div>

                <div class="control-group">
                    <label>Drop Speed</label>
                    <input type="range" id="speedSlider" min="1" max="100" value="50">
                    <div class="range-value" id="speedValue">50 needles/sec</div>
                </div>

                <div class="control-group">
                    <div class="button-row">
                        <button class="control-btn" id="startBtn">‚ñ∂ Start</button>
                        <button class="control-btn" id="resetBtn">‚Ü∫ Reset</button>
                    </div>
                </div>

                <div class="control-group">
                    <label>Quick Drop</label>
                    <div class="button-row">
                        <button class="drop-btn" data-count="100">+100</button>
                        <button class="drop-btn" data-count="1000">+1,000</button>
                        <button class="drop-btn" data-count="10000">+10,000</button>
                        <button class="drop-btn" data-count="100000">+100,000</button>
                    </div>
                </div>

                <div class="stats">
                    <div class="stat-row">
                        <span class="stat-label">Total Needles</span>
                        <span class="stat-value" id="totalNeedles">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Crossing Lines</span>
                        <span class="stat-value" id="crossingNeedles">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Hit Rate</span>
                        <span class="stat-value" id="hitRate">‚Äî</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Actual Pi</span>
                        <span class="stat-value">3.14159265...</span>
                    </div>
                </div>

                <div class="formula-box">
                    <div class="formula-title">The Formula</div>
                    <div class="formula">œÄ ‚âà 2n / h</div>
                    <p style="color: #aaa; font-size: 0.85rem; margin-top: 10px;">
                        where n = total drops, h = hits
                    </p>
                </div>

                <div class="quote-box">
                    "In 1901, Lazzarini dropped 3,408 needles and calculated Pi to 6 decimal places!"
                    <div class="quote-author">‚Äî Mario Lazzarini's famous experiment</div>
                </div>
            </div>
        </div>

        <div class="explanation">
            <div class="exp-card">
                <h3>üìê The Setup</h3>
                <p>
                    Draw parallel lines on a floor, spaced <span class="highlight">d</span> units apart.
                    Drop a needle of length <span class="highlight">l</span> (where l ‚â§ d).
                    Count how many needles cross a line. The probability of crossing is
                    <span class="highlight">2l/(œÄd)</span>. Rearranging: œÄ = 2ln / (dh).
                </p>
            </div>

            <div class="exp-card">
                <h3>üé≤ Why Does This Work?</h3>
                <p>
                    A needle crosses a line if its center's distance to the nearest line is less than
                    <span class="highlight">¬Ωl √ó sin(Œ∏)</span>, where Œ∏ is the angle. Integrating over
                    all angles (0 to œÄ) and all distances (0 to d/2) gives the probability formula
                    involving pi‚Äîit appears naturally from the geometry!
                </p>
            </div>

            <div class="exp-card">
                <h3>üìä Monte Carlo Method</h3>
                <p>
                    This is one of history's first <span class="highlight">Monte Carlo simulations</span>‚Äî
                    using randomness to estimate mathematical constants. The same principle powers
                    modern computer graphics, financial modeling, and nuclear physics calculations.
                    Random sampling converges to truth!
                </p>
            </div>

            <div class="exp-card">
                <h3>üèõÔ∏è Historical Note</h3>
                <p>
                    Proposed by <span class="highlight">Georges-Louis Leclerc, Comte de Buffon</span>
                    in 1777. He was a naturalist who also estimated Earth's age at 75,000 years
                    (bold for his time!). The needle problem was his venture into probability
                    theory‚Äîwith spectacularly beautiful results.
                </p>
            </div>
        </div>
    </div>

    <script>
        // Main needle canvas
        const canvas = document.getElementById('needleCanvas');
        const ctx = canvas.getContext('2d');

        // Graph canvas
        const graphCanvas = document.getElementById('graphCanvas');
        const graphCtx = graphCanvas.getContext('2d');

        // High DPI support
        const dpr = window.devicePixelRatio || 1;

        function setupCanvas(cvs, context) {
            const rect = cvs.getBoundingClientRect();
            cvs.width = rect.width * dpr;
            cvs.height = rect.height * dpr;
            context.scale(dpr, dpr);
            return { w: rect.width, h: rect.height };
        }

        const { w: W, h: H } = setupCanvas(canvas, ctx);
        const { w: GW, h: GH } = setupCanvas(graphCanvas, graphCtx);

        // Simulation state
        let needles = [];
        let totalDropped = 0;
        let totalCrossing = 0;
        let isRunning = false;
        let animationId = null;
        let piHistory = [];

        // Constants
        const lineSpacing = 60; // d - distance between lines
        const needleLength = 60; // l - needle length (l = d for simplicity)
        const maxVisibleNeedles = 500;

        // Drop a single needle
        function dropNeedle() {
            const x = Math.random() * W;
            const y = Math.random() * H;
            const angle = Math.random() * Math.PI; // 0 to pi

            // Calculate endpoints
            const halfLen = needleLength / 2;
            const dx = halfLen * Math.cos(angle);
            const dy = halfLen * Math.sin(angle);

            const x1 = x - dx;
            const y1 = y - dy;
            const x2 = x + dx;
            const y2 = y + dy;

            // Check if crossing a line
            const lineY1 = Math.floor(y1 / lineSpacing) * lineSpacing;
            const lineY2 = Math.floor(y2 / lineSpacing) * lineSpacing;
            const crossing = lineY1 !== lineY2;

            totalDropped++;
            if (crossing) totalCrossing++;

            // Store for rendering (limit visible needles)
            needles.push({ x1, y1, x2, y2, crossing });
            if (needles.length > maxVisibleNeedles) {
                needles.shift();
            }

            return crossing;
        }

        // Drop multiple needles instantly
        function dropManyNeedles(count) {
            for (let i = 0; i < count; i++) {
                dropNeedle();
            }
            updateStats();
            draw();
            drawGraph();
        }

        // Calculate pi estimate
        function estimatePi() {
            if (totalCrossing === 0) return null;
            // For l = d: P = 2/œÄ, so œÄ = 2n/h
            return (2 * totalDropped) / totalCrossing;
        }

        // Update statistics display
        function updateStats() {
            document.getElementById('totalNeedles').textContent = totalDropped.toLocaleString();
            document.getElementById('crossingNeedles').textContent = totalCrossing.toLocaleString();

            if (totalDropped > 0) {
                const hitRate = (totalCrossing / totalDropped * 100).toFixed(2);
                document.getElementById('hitRate').textContent = hitRate + '%';

                const pi = estimatePi();
                if (pi) {
                    document.getElementById('piEstimate').textContent = pi.toFixed(6);
                    const error = ((pi - Math.PI) / Math.PI * 100).toFixed(3);
                    const sign = error >= 0 ? '+' : '';
                    document.getElementById('piError').textContent = `Error: ${sign}${error}%`;

                    // Record for graph
                    if (piHistory.length === 0 || totalDropped % Math.max(1, Math.floor(totalDropped / 200)) === 0) {
                        piHistory.push({ n: totalDropped, pi: pi });
                        if (piHistory.length > 200) piHistory.shift();
                    }
                }
            }
        }

        // Draw needle canvas
        function draw() {
            ctx.fillStyle = '#0a1a0a';
            ctx.fillRect(0, 0, W, H);

            // Draw parallel lines
            ctx.strokeStyle = 'rgba(126, 234, 102, 0.3)';
            ctx.lineWidth = 2;
            for (let y = lineSpacing; y < H; y += lineSpacing) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(W, y);
                ctx.stroke();
            }

            // Draw needles
            for (const needle of needles) {
                ctx.strokeStyle = needle.crossing ? '#ff6b6b' : '#7eea66';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(needle.x1, needle.y1);
                ctx.lineTo(needle.x2, needle.y2);
                ctx.stroke();

                // Small dots at endpoints
                ctx.fillStyle = needle.crossing ? '#ff6b6b' : '#7eea66';
                ctx.beginPath();
                ctx.arc(needle.x1, needle.y1, 2, 0, Math.PI * 2);
                ctx.arc(needle.x2, needle.y2, 2, 0, Math.PI * 2);
                ctx.fill();
            }

            // Legend
            ctx.fillStyle = '#7eea66';
            ctx.fillRect(10, 10, 15, 3);
            ctx.fillStyle = '#aaa';
            ctx.font = '12px sans-serif';
            ctx.fillText('No crossing', 30, 15);

            ctx.fillStyle = '#ff6b6b';
            ctx.fillRect(10, 25, 15, 3);
            ctx.fillStyle = '#aaa';
            ctx.fillText('Crossing line', 30, 30);
        }

        // Draw convergence graph
        function drawGraph() {
            graphCtx.fillStyle = '#0a1a0a';
            graphCtx.fillRect(0, 0, GW, GH);

            if (piHistory.length < 2) {
                graphCtx.fillStyle = '#666';
                graphCtx.font = '14px sans-serif';
                graphCtx.textAlign = 'center';
                graphCtx.fillText('Convergence graph will appear as needles drop', GW / 2, GH / 2);
                return;
            }

            const margin = { top: 20, right: 20, bottom: 30, left: 50 };
            const chartW = GW - margin.left - margin.right;
            const chartH = GH - margin.top - margin.bottom;

            // Find y-axis range centered on PI
            const piVals = piHistory.map(p => p.pi);
            const maxDev = Math.max(
                Math.abs(Math.max(...piVals) - Math.PI),
                Math.abs(Math.min(...piVals) - Math.PI),
                0.5
            );
            const yMin = Math.PI - maxDev * 1.2;
            const yMax = Math.PI + maxDev * 1.2;

            // X scale
            const xMin = piHistory[0].n;
            const xMax = piHistory[piHistory.length - 1].n;

            const scaleX = (n) => margin.left + (n - xMin) / (xMax - xMin) * chartW;
            const scaleY = (pi) => margin.top + (1 - (pi - yMin) / (yMax - yMin)) * chartH;

            // Draw PI reference line
            const piY = scaleY(Math.PI);
            graphCtx.strokeStyle = 'rgba(126, 234, 102, 0.5)';
            graphCtx.setLineDash([5, 5]);
            graphCtx.beginPath();
            graphCtx.moveTo(margin.left, piY);
            graphCtx.lineTo(GW - margin.right, piY);
            graphCtx.stroke();
            graphCtx.setLineDash([]);

            // Label
            graphCtx.fillStyle = '#7eea66';
            graphCtx.font = '11px sans-serif';
            graphCtx.textAlign = 'right';
            graphCtx.fillText('œÄ', margin.left - 5, piY + 4);

            // Draw estimate line
            graphCtx.strokeStyle = '#93fb70';
            graphCtx.lineWidth = 2;
            graphCtx.beginPath();
            for (let i = 0; i < piHistory.length; i++) {
                const x = scaleX(piHistory[i].n);
                const y = scaleY(piHistory[i].pi);
                if (i === 0) graphCtx.moveTo(x, y);
                else graphCtx.lineTo(x, y);
            }
            graphCtx.stroke();

            // Title
            graphCtx.fillStyle = '#aaa';
            graphCtx.font = '12px sans-serif';
            graphCtx.textAlign = 'center';
            graphCtx.fillText('Convergence to œÄ as needles increase', GW / 2, GH - 5);
        }

        // Animation loop
        let lastTime = 0;
        let dropAccumulator = 0;

        function animate(time) {
            if (!isRunning) return;

            const deltaTime = time - lastTime;
            lastTime = time;

            const speed = parseInt(document.getElementById('speedSlider').value);
            dropAccumulator += speed * deltaTime / 1000;

            while (dropAccumulator >= 1) {
                dropNeedle();
                dropAccumulator--;
            }

            updateStats();
            draw();
            drawGraph();

            animationId = requestAnimationFrame(animate);
        }

        // Event listeners
        document.getElementById('startBtn').addEventListener('click', () => {
            isRunning = !isRunning;
            document.getElementById('startBtn').textContent = isRunning ? '‚è∏ Pause' : '‚ñ∂ Start';

            if (isRunning) {
                lastTime = performance.now();
                dropAccumulator = 0;
                animationId = requestAnimationFrame(animate);
            } else if (animationId) {
                cancelAnimationFrame(animationId);
            }
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            isRunning = false;
            document.getElementById('startBtn').textContent = '‚ñ∂ Start';
            if (animationId) cancelAnimationFrame(animationId);

            needles = [];
            totalDropped = 0;
            totalCrossing = 0;
            piHistory = [];

            document.getElementById('totalNeedles').textContent = '0';
            document.getElementById('crossingNeedles').textContent = '0';
            document.getElementById('hitRate').textContent = '‚Äî';
            document.getElementById('piEstimate').textContent = '‚Äî';
            document.getElementById('piError').textContent = 'Drop needles to begin';

            draw();
            drawGraph();
        });

        document.getElementById('speedSlider').addEventListener('input', (e) => {
            document.getElementById('speedValue').textContent = e.target.value + ' needles/sec';
        });

        document.querySelectorAll('.drop-btn[data-count]').forEach(btn => {
            btn.addEventListener('click', () => {
                const count = parseInt(btn.dataset.count);
                dropManyNeedles(count);
            });
        });

        // Initial draw
        draw();
        drawGraph();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
