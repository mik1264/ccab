<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Matthew Effect - Surprising Paradoxes - CCAB</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600;700&family=Nunito:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --sage: #8A9A5B;
            --moss: #606C38;
            --earth: #DDA15E;
            --cream: #FEFAE0;
            --terracotta: #BC6C25;
            --dark-moss: #3d4423;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #FEFAE0 0%, #F4F1DE 50%, #EDE8D5 100%);
            min-height: 100vh;
            color: var(--dark-moss);
            line-height: 1.7;
        }
        .organic-shape {
            position: fixed;
            border-radius: 60% 40% 50% 50% / 50% 60% 40% 50%;
            opacity: 0.12;
            z-index: 0;
            animation: morph 30s ease-in-out infinite;
        }
        .shape-1 {
            width: 600px;
            height: 600px;
            background: linear-gradient(135deg, #f1c40f, #d4ac0d);
            top: -200px;
            right: -150px;
        }
        .shape-2 {
            width: 500px;
            height: 500px;
            background: linear-gradient(135deg, #27ae60, #1e8449);
            bottom: -150px;
            left: -150px;
            animation-delay: -15s;
        }
        @keyframes morph {
            0%, 100% { border-radius: 60% 40% 50% 50% / 50% 60% 40% 50%; }
            25% { border-radius: 50% 60% 40% 50% / 40% 50% 60% 50%; }
            50% { border-radius: 40% 50% 60% 50% / 50% 40% 50% 60%; }
            75% { border-radius: 50% 40% 50% 60% / 60% 50% 40% 50%; }
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px 80px;
            position: relative;
            z-index: 1;
        }
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--moss);
            text-decoration: none;
            font-weight: 500;
            margin-bottom: 30px;
            padding: 10px 20px;
            background: rgba(255,255,255,0.6);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            transition: all 0.3s ease;
        }
        .back-link:hover {
            background: rgba(255,255,255,0.9);
            transform: translateX(-5px);
        }
        h1 {
            font-family: 'Lora', serif;
            font-size: 2.8rem;
            font-weight: 600;
            color: var(--moss);
            margin-bottom: 20px;
            line-height: 1.2;
        }
        .subtitle {
            font-size: 1.3rem;
            color: var(--terracotta);
            margin-bottom: 40px;
            font-weight: 500;
        }
        .badge {
            display: inline-block;
            background: linear-gradient(135deg, #f1c40f, #d4ac0d);
            color: #1a1a2e;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 25px;
        }
        .card {
            background: rgba(255,255,255,0.7);
            backdrop-filter: blur(15px);
            border-radius: 24px;
            padding: 35px;
            margin-bottom: 35px;
            border: 1px solid rgba(138,154,91,0.2);
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
        }
        .card h2 {
            font-family: 'Lora', serif;
            font-size: 1.6rem;
            color: var(--moss);
            margin-bottom: 20px;
        }
        .card p {
            color: #555;
            margin-bottom: 18px;
        }
        .card p:last-child { margin-bottom: 0; }
        .highlight {
            background: linear-gradient(120deg, rgba(241,196,15,0.25) 0%, rgba(241,196,15,0.1) 100%);
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 600;
            color: #b7950b;
        }

        /* Simulation container */
        .sim-container {
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 35px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.2);
        }
        .sim-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .sim-title {
            color: #fff;
            font-family: 'Lora', serif;
            font-size: 1.3rem;
        }
        .controls {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }
        .btn {
            background: linear-gradient(135deg, #f1c40f 0%, #d4ac0d 100%);
            color: #1a1a2e;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-family: 'Nunito', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(241,196,15,0.4);
        }
        .btn-secondary {
            background: rgba(255,255,255,0.15);
            color: white;
        }
        .btn-secondary:hover {
            background: rgba(255,255,255,0.25);
            box-shadow: 0 8px 25px rgba(255,255,255,0.1);
        }
        #simCanvas {
            display: block;
            width: 100%;
            border-radius: 12px;
            background: #0f0f23;
        }

        /* Time controls */
        .time-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .time-label {
            color: rgba(255,255,255,0.7);
            font-size: 0.9rem;
        }
        .time-slider {
            flex: 1;
            min-width: 200px;
            height: 8px;
            -webkit-appearance: none;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            outline: none;
        }
        .time-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #f1c40f;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(241,196,15,0.5);
        }
        .time-value {
            color: #f1c40f;
            font-weight: 700;
            font-family: 'Courier New', monospace;
            min-width: 80px;
        }

        /* Stats display */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        .stat-box {
            background: rgba(255,255,255,0.08);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }
        .stat-box.gold { border-left: 4px solid #f1c40f; }
        .stat-box.silver { border-left: 4px solid #bdc3c7; }
        .stat-box.bronze { border-left: 4px solid #cd7f32; }
        .stat-label {
            color: rgba(255,255,255,0.6);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            font-family: 'Courier New', monospace;
        }
        .stat-box.gold .stat-value { color: #f1c40f; }
        .stat-box.silver .stat-value { color: #bdc3c7; }
        .stat-box.bronze .stat-value { color: #cd7f32; }

        /* Mode tabs */
        .mode-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .mode-tab {
            flex: 1;
            background: rgba(255,255,255,0.08);
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: rgba(255,255,255,0.7);
        }
        .mode-tab:hover {
            background: rgba(255,255,255,0.12);
        }
        .mode-tab.active {
            border-color: #f1c40f;
            background: rgba(241,196,15,0.15);
            color: #f1c40f;
        }
        .mode-tab-icon {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        .mode-tab-label {
            font-size: 0.85rem;
            font-weight: 600;
        }

        /* Quote */
        .quote {
            border-left: 4px solid #f1c40f;
            padding-left: 25px;
            margin: 25px 0;
            font-style: italic;
            color: #666;
        }
        .quote-author {
            font-style: normal;
            font-weight: 600;
            color: var(--moss);
            margin-top: 10px;
        }

        /* Research stats grid */
        .research-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }
        .research-card {
            background: rgba(241,196,15,0.1);
            border: 1px solid rgba(241,196,15,0.3);
            border-radius: 16px;
            padding: 25px;
            text-align: center;
        }
        .research-number {
            font-size: 2.2rem;
            font-weight: 700;
            color: #d4ac0d;
            font-family: 'Lora', serif;
        }
        .research-label {
            color: #666;
            font-size: 0.9rem;
            margin-top: 8px;
        }

        /* Insight box */
        .insight-box {
            background: linear-gradient(135deg, rgba(138,154,91,0.15) 0%, rgba(96,108,56,0.1) 100%);
            border: 2px solid var(--sage);
            border-radius: 16px;
            padding: 25px;
            margin: 25px 0;
        }
        .insight-box h3 {
            color: var(--moss);
            font-family: 'Lora', serif;
            margin-bottom: 12px;
        }

        /* Examples list */
        .examples-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .example-card {
            background: rgba(0,0,0,0.03);
            border-radius: 12px;
            padding: 20px;
        }
        .example-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        .example-title {
            font-weight: 600;
            color: var(--moss);
            margin-bottom: 8px;
        }
        .example-text {
            font-size: 0.9rem;
            color: #666;
        }

        .footer {
            text-align: center;
            padding-top: 30px;
            color: #888;
            font-size: 0.85rem;
        }
        .footer a { color: var(--moss); }

        @media (max-width: 600px) {
            h1 { font-size: 2rem; }
            .card { padding: 25px; }
            .stats-row { grid-template-columns: 1fr; }
            .mode-tabs { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="organic-shape shape-1"></div>
    <div class="organic-shape shape-2"></div>

    <main class="container">
        <a href="index.html" class="back-link">← Back to Paradoxes</a>

        <span class="badge">Cumulative Advantage</span>
        <h1>The Matthew Effect</h1>
        <p class="subtitle">"For to everyone who has, more will be given... but from the one who has not, even what he has will be taken away." — Matthew 25:29</p>

        <!-- Simulation -->
        <div class="sim-container">
            <div class="mode-tabs">
                <div class="mode-tab active" data-mode="citations">
                    <div class="mode-tab-icon">&#128218;</div>
                    <div class="mode-tab-label">Scientific Citations</div>
                </div>
                <div class="mode-tab" data-mode="reading">
                    <div class="mode-tab-icon">&#128214;</div>
                    <div class="mode-tab-label">Reading Gap</div>
                </div>
                <div class="mode-tab" data-mode="wealth">
                    <div class="mode-tab-icon">&#128176;</div>
                    <div class="mode-tab-label">Wealth Inequality</div>
                </div>
            </div>

            <div class="sim-header">
                <h2 class="sim-title" id="simTitle">Citation Accumulation Over Time</h2>
                <div class="controls">
                    <button class="btn" id="runBtn">Run Simulation</button>
                    <button class="btn btn-secondary" id="resetBtn">Reset</button>
                </div>
            </div>

            <canvas id="simCanvas" width="800" height="400"></canvas>

            <div class="time-controls">
                <span class="time-label">Time:</span>
                <input type="range" class="time-slider" id="timeSlider" min="0" max="100" value="0">
                <span class="time-value" id="timeValue">Year 0</span>
            </div>

            <div class="stats-row">
                <div class="stat-box gold">
                    <div class="stat-label" id="topLabel">Top Scientist</div>
                    <div class="stat-value" id="topValue">0</div>
                </div>
                <div class="stat-box silver">
                    <div class="stat-label" id="midLabel">Average</div>
                    <div class="stat-value" id="midValue">0</div>
                </div>
                <div class="stat-box bronze">
                    <div class="stat-label" id="bottomLabel">Bottom Scientist</div>
                    <div class="stat-value" id="bottomValue">0</div>
                </div>
            </div>

            <p style="color: rgba(255,255,255,0.5); text-align: center; margin-top: 20px; font-size: 0.9rem;" id="simExplanation">
                Watch how a small initial advantage compounds into an enormous gap over time.
            </p>
        </div>

        <!-- The Effect -->
        <div class="card">
            <h2>The Rich Get Richer</h2>
            <p>The Matthew Effect describes how those who begin with an advantage tend to accumulate <span class="highlight">more advantage over time</span>, while those who start behind fall further and further back.</p>
            <p>The term was coined by sociologist <strong>Robert K. Merton</strong> in 1968, based on a verse from the Gospel of Matthew. Merton observed that famous scientists receive disproportionate credit for discoveries, even when less-known researchers do equally good work.</p>
            <p>The effect is not about merit—it's about <strong>visibility, opportunity, and compounding returns</strong>. Once you have citations, you get more citations. Once you have wealth, you make more wealth. Once you can read well, you read more and get even better.</p>
        </div>

        <!-- Research Statistics -->
        <div class="card">
            <h2>The Evidence</h2>

            <div class="research-grid">
                <div class="research-card">
                    <div class="research-number">18,681</div>
                    <div class="research-label">words seen by good readers by end of 1st grade</div>
                </div>
                <div class="research-card">
                    <div class="research-number">9,975</div>
                    <div class="research-label">words seen by poor readers (47% fewer)</div>
                </div>
                <div class="research-card">
                    <div class="research-number">10 yrs</div>
                    <div class="research-label">1st grade reading predicts 11th grade outcomes</div>
                </div>
                <div class="research-card">
                    <div class="research-number">93%</div>
                    <div class="research-label">of high-scoring preschoolers read above grade level</div>
                </div>
            </div>

            <div class="quote">
                "The eminent scientists consistently received a greater share of the credit, even when producing parallel research and making the same discoveries simultaneously."
                <div class="quote-author">— Robert K. Merton, 1968</div>
            </div>
        </div>

        <!-- Reading Gap -->
        <div class="card">
            <h2>The Reading Gap: Stanovich's Discovery</h2>
            <p>Psychologist <strong>Keith Stanovich</strong> applied the Matthew Effect to education in 1986. He found that children who read well read <em>more</em>, which makes them read <em>even better</em>. Meanwhile, struggling readers avoid reading, fall further behind, and the gap widens exponentially.</p>

            <div class="insight-box">
                <h3>The Vicious Cycle</h3>
                <p>By 3rd grade—Stanovich's "pivotal point"—good readers have encountered millions more words than struggling readers. This affects not just reading ability, but vocabulary, comprehension, general knowledge, and even cognitive development. The gap becomes nearly impossible to close.</p>
            </div>

            <p>Cunningham and Stanovich (1997) tracked students from 1st to 11th grade. First-grade reading ability predicted all 11th-grade outcomes—even after controlling for IQ. Early reading advantage wasn't just maintained; it <strong>compounded</strong>.</p>
        </div>

        <!-- Domains -->
        <div class="card">
            <h2>Where the Matthew Effect Appears</h2>

            <div class="examples-list">
                <div class="example-card">
                    <div class="example-icon">&#127891;</div>
                    <div class="example-title">Education</div>
                    <div class="example-text">Early readers gain vocabulary and comprehension advantages that compound through school. The gap widens every year.</div>
                </div>
                <div class="example-card">
                    <div class="example-icon">&#128300;</div>
                    <div class="example-title">Scientific Citations</div>
                    <div class="example-text">Nobel laureates get citation boosts; famous authors get read more. Unknown researchers' equally good work goes unnoticed.</div>
                </div>
                <div class="example-card">
                    <div class="example-icon">&#128176;</div>
                    <div class="example-title">Wealth & Investment</div>
                    <div class="example-text">Compound interest favors those who already have capital. The rich can take risks that generate even more wealth.</div>
                </div>
                <div class="example-card">
                    <div class="example-icon">&#127908;</div>
                    <div class="example-title">Social Media</div>
                    <div class="example-text">Accounts with followers get shown to more people, gaining more followers. Obscure accounts stay obscure.</div>
                </div>
                <div class="example-card">
                    <div class="example-icon">&#127942;</div>
                    <div class="example-title">Sports & Skills</div>
                    <div class="example-text">Talented kids get more coaching, better teams, more practice. "Talent" is often just earlier opportunity.</div>
                </div>
                <div class="example-card">
                    <div class="example-icon">&#129309;</div>
                    <div class="example-title">Health Disparities</div>
                    <div class="example-text">Those with health and resources maintain health longer. Disadvantage in childhood compounds into lifelong inequality.</div>
                </div>
            </div>
        </div>

        <!-- Implications -->
        <div class="card">
            <h2>Why This Matters</h2>
            <p>The Matthew Effect challenges our belief in meritocracy. If small initial advantages—often due to luck, birth circumstances, or arbitrary timing—compound into enormous differences, then outcomes reflect <strong>cumulative advantage</strong> as much as individual merit.</p>

            <div class="insight-box">
                <h3>The Intervention Imperative</h3>
                <p>Understanding the Matthew Effect argues for <strong>early intervention</strong>. Catching a struggling reader in 1st grade is far more effective than waiting until 5th grade. Small early investments prevent massive later gaps.</p>
            </div>

            <p><strong>The Relative Age Effect:</strong> Children born just after sports league cutoff dates are older than peers, appear more talented, get more coaching, and are overrepresented in professional sports. The advantage wasn't talent—it was timing.</p>

            <p><strong>Policy Implications:</strong> Progressive taxation, early childhood education, affirmative action, and wealth redistribution can all be understood as attempts to counteract the Matthew Effect's natural tendency toward inequality.</p>
        </div>

        <div class="footer">
            <p>Sources: <a href="https://en.wikipedia.org/wiki/Matthew_effect" target="_blank">Wikipedia</a>,
            <a href="https://www.readingrockets.org/resources/resource-library/matthew-effects-reading-some-consequences-individual-differences" target="_blank">Reading Rockets</a>,
            <a href="https://garfield.library.upenn.edu/merton/matthew1.pdf" target="_blank">Merton (1968)</a></p>
            <p style="margin-top: 10px;">Part of <a href="../index.html">CCAB</a> &middot; Surprising Paradoxes Collection</p>
        </div>
    </main>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');

        // High DPI
        const dpr = window.devicePixelRatio || 1;
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width * dpr;
        canvas.height = rect.height * dpr;
        ctx.scale(dpr, dpr);
        canvas.style.width = rect.width + 'px';
        canvas.style.height = rect.height + 'px';

        const W = rect.width;
        const H = rect.height;

        // Simulation state
        let currentMode = 'citations';
        let time = 0;
        let isRunning = false;
        let animFrame;

        // Agents - each starts with a small random advantage
        let agents = [];

        const modeConfigs = {
            citations: {
                title: 'Citation Accumulation Over Time',
                topLabel: 'Top Scientist',
                midLabel: 'Average',
                bottomLabel: 'Bottom Scientist',
                unit: ' citations',
                timeUnit: 'Year',
                explanation: 'Scientists with more citations get cited more. Watch the gap widen exponentially.',
                colors: ['#f1c40f', '#e67e22', '#e74c3c', '#9b59b6', '#3498db', '#1abc9c', '#27ae60', '#2ecc71']
            },
            reading: {
                title: 'Reading Word Exposure Gap',
                topLabel: 'Strong Reader',
                midLabel: 'Average',
                bottomLabel: 'Struggling Reader',
                unit: ' words',
                timeUnit: 'Grade',
                explanation: 'Good readers read more books, encountering more words. By high school, the gap is enormous.',
                colors: ['#3498db', '#2980b9', '#1abc9c', '#16a085', '#27ae60', '#2ecc71', '#f39c12', '#e74c3c']
            },
            wealth: {
                title: 'Wealth Accumulation Over Time',
                topLabel: 'Top 10%',
                midLabel: 'Median',
                bottomLabel: 'Bottom 10%',
                unit: '',
                timeUnit: 'Year',
                explanation: 'Compound returns favor those with capital. Small initial differences become massive inequality.',
                colors: ['#27ae60', '#2ecc71', '#f1c40f', '#e67e22', '#e74c3c', '#c0392b', '#9b59b6', '#8e44ad']
            }
        };

        // Initialize agents
        function initAgents() {
            agents = [];
            const n = 8;

            if (currentMode === 'citations') {
                // Scientists with small initial differences
                for (let i = 0; i < n; i++) {
                    agents.push({
                        value: 10 + Math.random() * 20, // 10-30 initial citations
                        history: [],
                        color: modeConfigs[currentMode].colors[i]
                    });
                }
            } else if (currentMode === 'reading') {
                // Readers with different starting abilities
                for (let i = 0; i < n; i++) {
                    agents.push({
                        value: 1000 + (i - n/2) * 200 + Math.random() * 500,
                        history: [],
                        color: modeConfigs[currentMode].colors[i]
                    });
                }
            } else if (currentMode === 'wealth') {
                // Wealth starting conditions
                for (let i = 0; i < n; i++) {
                    agents.push({
                        value: 10000 + (i - n/2) * 5000 + Math.random() * 5000,
                        history: [],
                        color: modeConfigs[currentMode].colors[i]
                    });
                }
            }

            // Sort by initial value
            agents.sort((a, b) => b.value - a.value);

            // Record initial history
            agents.forEach(a => a.history.push(a.value));

            time = 0;
            document.getElementById('timeSlider').value = 0;
            updateStats();
            draw();
        }

        // Update simulation one step
        function update() {
            agents.forEach(agent => {
                if (currentMode === 'citations') {
                    // Rich get richer: more citations = more visibility = more citations
                    const growthRate = 0.08 + 0.12 * (agent.value / agents[0].value);
                    agent.value *= (1 + growthRate + Math.random() * 0.05);
                } else if (currentMode === 'reading') {
                    // Better readers read more words per year
                    const wordsPerYear = 5000 + 15000 * (agent.value / agents[0].value);
                    agent.value += wordsPerYear * (0.8 + Math.random() * 0.4);
                } else if (currentMode === 'wealth') {
                    // Compound returns with random variance
                    const returnRate = 0.04 + 0.08 * (agent.value / agents[0].value);
                    agent.value *= (1 + returnRate + (Math.random() - 0.3) * 0.1);
                }

                agent.history.push(agent.value);
            });

            time++;
        }

        // Draw the simulation
        function draw() {
            ctx.fillStyle = '#0f0f23';
            ctx.fillRect(0, 0, W, H);

            // Grid
            ctx.strokeStyle = 'rgba(255,255,255,0.05)';
            ctx.lineWidth = 1;
            for (let x = 0; x < W; x += 50) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, H);
                ctx.stroke();
            }
            for (let y = 0; y < H; y += 50) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(W, y);
                ctx.stroke();
            }

            if (agents.length === 0) return;

            // Find max value for scaling
            const maxVal = Math.max(...agents.map(a => Math.max(...a.history)));
            const historyLen = agents[0].history.length;

            // Draw history lines
            const padding = 50;
            const graphW = W - padding * 2;
            const graphH = H - padding * 2;

            agents.forEach((agent, i) => {
                ctx.strokeStyle = agent.color;
                ctx.lineWidth = 3;
                ctx.beginPath();

                agent.history.forEach((val, j) => {
                    const x = padding + (j / Math.max(1, historyLen - 1)) * graphW;
                    const y = H - padding - (val / maxVal) * graphH * 0.9;

                    if (j === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });

                ctx.stroke();

                // Draw endpoint
                const lastX = padding + ((historyLen - 1) / Math.max(1, historyLen - 1)) * graphW;
                const lastY = H - padding - (agent.history[agent.history.length - 1] / maxVal) * graphH * 0.9;

                ctx.beginPath();
                ctx.arc(lastX, lastY, 6, 0, Math.PI * 2);
                ctx.fillStyle = agent.color;
                ctx.fill();
            });

            // Axes
            ctx.strokeStyle = 'rgba(255,255,255,0.3)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, H - padding);
            ctx.lineTo(W - padding, H - padding);
            ctx.stroke();

            // Labels
            ctx.fillStyle = 'rgba(255,255,255,0.6)';
            ctx.font = '12px Nunito';
            ctx.textAlign = 'center';
            ctx.fillText(modeConfigs[currentMode].timeUnit, W / 2, H - 10);
            ctx.save();
            ctx.translate(15, H / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('Value', 0, 0);
            ctx.restore();
        }

        // Update statistics display
        function updateStats() {
            const config = modeConfigs[currentMode];

            document.getElementById('simTitle').textContent = config.title;
            document.getElementById('topLabel').textContent = config.topLabel;
            document.getElementById('midLabel').textContent = config.midLabel;
            document.getElementById('bottomLabel').textContent = config.bottomLabel;
            document.getElementById('simExplanation').textContent = config.explanation;

            if (agents.length === 0) return;

            const sorted = [...agents].sort((a, b) => b.value - a.value);
            const top = sorted[0].value;
            const bottom = sorted[sorted.length - 1].value;
            const mid = agents.reduce((sum, a) => sum + a.value, 0) / agents.length;

            const format = (val) => {
                if (val >= 1000000) return (val / 1000000).toFixed(1) + 'M';
                if (val >= 1000) return (val / 1000).toFixed(1) + 'K';
                return Math.round(val).toString();
            };

            document.getElementById('topValue').textContent = format(top) + config.unit;
            document.getElementById('midValue').textContent = format(mid) + config.unit;
            document.getElementById('bottomValue').textContent = format(bottom) + config.unit;

            const timeLabel = currentMode === 'reading' ? `Grade ${Math.min(12, time + 1)}` : `${config.timeUnit} ${time}`;
            document.getElementById('timeValue').textContent = timeLabel;
            document.getElementById('timeSlider').value = time;
        }

        // Animation loop
        function animate() {
            if (isRunning && time < 100) {
                update();
                updateStats();
                draw();
                animFrame = setTimeout(() => requestAnimationFrame(animate), 100);
            } else {
                isRunning = false;
                document.getElementById('runBtn').textContent = 'Run Simulation';
            }
        }

        // Event handlers
        document.getElementById('runBtn').addEventListener('click', function() {
            if (isRunning) {
                isRunning = false;
                this.textContent = 'Run Simulation';
            } else {
                isRunning = true;
                this.textContent = 'Pause';
                animate();
            }
        });

        document.getElementById('resetBtn').addEventListener('click', function() {
            isRunning = false;
            document.getElementById('runBtn').textContent = 'Run Simulation';
            initAgents();
        });

        document.getElementById('timeSlider').addEventListener('input', function() {
            const targetTime = parseInt(this.value);
            if (targetTime < time) {
                // Go back - reinitialize and run to target
                initAgents();
            }
            while (time < targetTime && time < 100) {
                update();
            }
            updateStats();
            draw();
        });

        // Mode tabs
        document.querySelectorAll('.mode-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.mode-tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                currentMode = this.dataset.mode;
                isRunning = false;
                document.getElementById('runBtn').textContent = 'Run Simulation';
                initAgents();
            });
        });

        // Initialize
        initAgents();
    </script>
</body>
</html>
