<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Devil's Staircase - Rising Without Moving</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1a0a0a 0%, #2a1020 50%, #1a0a1a 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.4em;
            background: linear-gradient(135deg, #ff3366, #ff6633, #ffcc33);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.3em;
            color: #aaa;
            font-style: italic;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #ff6633;
            text-decoration: none;
            font-size: 1.1em;
            z-index: 100;
            transition: color 0.3s;
        }

        .back-link:hover {
            color: #ffcc33;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        @media (max-width: 1000px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: rgba(40, 20, 30, 0.85);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 100, 50, 0.3);
        }

        .panel h2 {
            color: #ff6633;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .panel h3 {
            color: #ffcc33;
            margin: 15px 0 10px 0;
            font-size: 1.1em;
        }

        .canvas-container {
            position: relative;
            background: #0a0505;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #333;
        }

        canvas {
            width: 100%;
            display: block;
        }

        #functionCanvas {
            height: 350px;
        }

        #cantorCanvas {
            height: 150px;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 15px 0;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
        }

        .slider-container label {
            min-width: 100px;
            color: #aaa;
        }

        .slider-container input[type="range"] {
            flex: 1;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(90deg, #ff3366, #ff6633, #ffcc33);
            -webkit-appearance: none;
        }

        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
        }

        .slider-container .value {
            min-width: 30px;
            text-align: center;
            font-weight: bold;
            color: #ffcc33;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .stat-box {
            background: rgba(0,0,0,0.3);
            padding: 12px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-box .value {
            font-size: 1.4em;
            font-weight: bold;
            color: #ffcc33;
        }

        .stat-box .label {
            font-size: 0.75em;
            color: #888;
            margin-top: 3px;
        }

        .explanation {
            line-height: 1.8;
            color: #ccc;
        }

        .explanation p {
            margin-bottom: 15px;
        }

        .highlight {
            background: rgba(255, 100, 50, 0.2);
            padding: 2px 6px;
            border-radius: 4px;
            color: #ff9966;
        }

        .paradox-box {
            background: linear-gradient(135deg, rgba(255, 50, 100, 0.15), rgba(255, 200, 50, 0.15));
            border: 1px solid rgba(255, 100, 50, 0.4);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .paradox-box h3 {
            color: #ff6633;
            margin-bottom: 10px;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .math {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            color: #ffcc33;
        }

        .construction-steps {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 15px 0;
        }

        .step-box {
            flex: 1;
            min-width: 150px;
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .step-box .step-num {
            font-size: 1.5em;
            color: #ff6633;
            font-weight: bold;
        }

        .step-box .step-desc {
            font-size: 0.85em;
            color: #aaa;
            margin-top: 5px;
        }

        .interval-viz {
            height: 30px;
            background: #111;
            border-radius: 5px;
            margin: 10px 0;
            position: relative;
            overflow: hidden;
        }

        .removed-section {
            position: absolute;
            height: 100%;
            background: rgba(255, 50, 50, 0.3);
            border-left: 1px solid #ff3333;
            border-right: 1px solid #ff3333;
        }

        .measure-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 15px 0;
        }

        .measure-box {
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .measure-box.cantor {
            background: rgba(100, 255, 100, 0.1);
            border: 1px solid rgba(100, 255, 100, 0.3);
        }

        .measure-box.gaps {
            background: rgba(255, 100, 100, 0.1);
            border: 1px solid rgba(255, 100, 100, 0.3);
        }

        .measure-box h4 {
            margin-bottom: 10px;
        }

        .measure-box.cantor h4 {
            color: #66ff66;
        }

        .measure-box.gaps h4 {
            color: #ff6666;
        }

        .measure-value {
            font-size: 2em;
            font-weight: bold;
        }

        .measure-box.cantor .measure-value {
            color: #66ff66;
        }

        .measure-box.gaps .measure-value {
            color: #ff6666;
        }

        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
        }

        button {
            padding: 12px 25px;
            font-size: 1em;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ff6633, #ff3366);
            color: white;
        }

        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(255, 100, 50, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #666, #444);
            color: white;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            font-size: 0.85em;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-color {
            width: 20px;
            height: 10px;
            border-radius: 3px;
        }

        .property-list {
            list-style: none;
            padding: 0;
        }

        .property-list li {
            padding: 10px 15px;
            margin: 5px 0;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            border-left: 3px solid #ff6633;
        }

        .property-list li strong {
            color: #ffcc33;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Paradoxes</a>

    <div class="container">
        <header>
            <h1>The Devil's Staircase</h1>
            <p class="subtitle">A function that rises from 0 to 1 while being flat almost everywhere</p>
        </header>

        <div class="main-grid">
            <!-- Main Function Visualization -->
            <div class="panel">
                <h2>The Cantor Function</h2>

                <div class="canvas-container">
                    <canvas id="functionCanvas"></canvas>
                </div>

                <div class="slider-container">
                    <label>Iterations:</label>
                    <input type="range" id="iterSlider" min="1" max="10" value="6">
                    <span class="value" id="iterValue">6</span>
                </div>

                <div class="controls">
                    <button class="btn-primary" id="animateBtn">Animate Construction</button>
                    <button class="btn-secondary" id="resetBtn">Reset</button>
                </div>

                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="value" id="flatPercent">99.9%</div>
                        <div class="label">Flat Segments</div>
                    </div>
                    <div class="stat-box">
                        <div class="value" id="risingPercent">0.1%</div>
                        <div class="label">Rising Segments</div>
                    </div>
                    <div class="stat-box">
                        <div class="value">1</div>
                        <div class="label">Total Rise</div>
                    </div>
                </div>
            </div>

            <!-- The Paradox -->
            <div class="panel">
                <h2>The Paradox</h2>

                <div class="paradox-box">
                    <h3>How can a flat function rise?</h3>
                    <p>At every iteration, the function is constant on more and more intervals.</p>
                    <p style="margin-top: 10px;">In the limit: <span class="highlight">derivative = 0</span> on a set of measure <strong>1</strong> (almost everywhere).</p>
                    <p style="margin-top: 10px;">Yet the function still increases from <span class="math">f(0) = 0</span> to <span class="math">f(1) = 1</span>!</p>
                    <p style="margin-top: 10px;">All the "rising" happens on the <strong>Cantor set</strong> — a set of measure <strong>zero</strong>.</p>
                </div>

                <h3>The Cantor Set</h3>
                <div class="canvas-container">
                    <canvas id="cantorCanvas"></canvas>
                </div>

                <div class="measure-comparison">
                    <div class="measure-box cantor">
                        <h4>Cantor Set</h4>
                        <div class="measure-value">0</div>
                        <div class="label">Measure (length)</div>
                    </div>
                    <div class="measure-box gaps">
                        <h4>Removed Gaps</h4>
                        <div class="measure-value">1</div>
                        <div class="label">Measure (length)</div>
                    </div>
                </div>

                <p class="explanation" style="text-align: center; margin-top: 10px;">
                    Uncountably many points... with zero total length!
                </p>
            </div>

            <!-- Construction Steps -->
            <div class="panel full-width">
                <h2>Construction: Removing Middle Thirds</h2>

                <div class="construction-steps">
                    <div class="step-box">
                        <div class="step-num">Step 0</div>
                        <div class="step-desc">Start with [0, 1]</div>
                        <div class="interval-viz" id="step0"></div>
                    </div>
                    <div class="step-box">
                        <div class="step-num">Step 1</div>
                        <div class="step-desc">Remove (1/3, 2/3)</div>
                        <div class="interval-viz" id="step1"></div>
                    </div>
                    <div class="step-box">
                        <div class="step-num">Step 2</div>
                        <div class="step-desc">Remove middle thirds</div>
                        <div class="interval-viz" id="step2"></div>
                    </div>
                    <div class="step-box">
                        <div class="step-num">Step 3</div>
                        <div class="step-desc">Continue...</div>
                        <div class="interval-viz" id="step3"></div>
                    </div>
                    <div class="step-box">
                        <div class="step-num">Step ∞</div>
                        <div class="step-desc">Cantor set</div>
                        <div class="interval-viz" id="step4"></div>
                    </div>
                </div>

                <p style="text-align: center; color: #888; margin-top: 15px;">
                    At each step, we remove 1/3 of what remains. Total removed: 1/3 + 2/9 + 4/27 + ... = <span class="math">1</span>
                </p>
            </div>

            <!-- Properties -->
            <div class="panel">
                <h2>Remarkable Properties</h2>

                <ul class="property-list">
                    <li><strong>Continuous everywhere</strong> — no jumps or breaks</li>
                    <li><strong>Monotonically increasing</strong> — never goes down</li>
                    <li><strong>Derivative = 0 almost everywhere</strong> — flat on measure 1</li>
                    <li><strong>Not absolutely continuous</strong> — breaks FTC!</li>
                    <li><strong>Total variation = 1</strong> — concentrated on measure 0</li>
                    <li><strong>Arc length = 2</strong> — not the diagonal!</li>
                </ul>

                <div class="paradox-box">
                    <h3>Breaks the Fundamental Theorem</h3>
                    <p>Normally: if <span class="math">f'(x) = 0</span> for all <span class="math">x</span>, then <span class="math">f</span> is constant.</p>
                    <p style="margin-top: 10px;">But the Devil's Staircase has <span class="math">f'(x) = 0</span> almost everywhere, yet is NOT constant!</p>
                    <p style="margin-top: 10px;">The Fundamental Theorem of Calculus requires f' to be defined <em>everywhere</em>, not just almost everywhere.</p>
                </div>
            </div>

            <!-- Mathematical Details -->
            <div class="panel">
                <h2>The Mathematics</h2>

                <h3>Explicit Construction</h3>
                <div class="explanation">
                    <p>For <span class="math">x ∈ [0, 1]</span>, write <span class="math">x</span> in base 3:</p>
                    <p style="text-align: center;"><span class="math">x = 0.d₁d₂d₃...</span> (ternary)</p>

                    <p>Find the first digit 1, replace it with 2, and delete everything after:</p>
                    <p style="text-align: center;"><span class="math">x = 0.d₁...dₖ2... → 0.d₁...dₖ1</span></p>

                    <p>Replace all 2's with 1's, interpret in base 2:</p>
                    <p style="text-align: center;"><span class="math">f(x) = 0.b₁b₂b₃...</span> (binary)</p>
                </div>

                <h3>Measure Theory</h3>
                <div class="explanation">
                    <p><strong>Cantor set measure:</strong></p>
                    <p style="text-align: center;">
                        <span class="math">μ(C) = 1 - Σ(2/3)ⁿ⁻¹ · (1/3)ⁿ = 1 - 1 = 0</span>
                    </p>

                    <p><strong>Yet it has the cardinality of the continuum:</strong></p>
                    <p style="text-align: center;">
                        <span class="math">|C| = |ℝ| = 2^ℵ₀</span>
                    </p>

                    <p style="margin-top: 15px;">The Cantor set is an example of an <span class="highlight">uncountable set with measure zero</span>.</p>
                </div>
            </div>

            <!-- History & Applications -->
            <div class="panel full-width">
                <h2>History & Applications</h2>

                <div class="explanation">
                    <p><strong>1883:</strong> Georg Cantor introduces the Cantor set while studying trigonometric series.</p>
                    <p><strong>1884:</strong> Cantor defines the function now called the "Devil's Staircase" — Scheeffer identifies it as a counterexample to extensions of the Fundamental Theorem of Calculus.</p>
                    <p><strong>1904:</strong> Lebesgue's measure theory provides the framework to understand why this function is so strange.</p>
                    <p><strong>Today:</strong> The Devil's Staircase appears in physics (phase transitions, quasicrystals), dynamical systems (mode-locking), and probability theory (singular distributions).</p>
                </div>

                <div class="paradox-box">
                    <h3>The Deep Insight</h3>
                    <p>The Devil's Staircase shows that <strong>"almost everywhere" isn't everything</strong>.</p>
                    <p style="margin-top: 10px;">A set of measure zero can still carry all the action — all the increase, all the variation, all the structure.</p>
                    <p style="margin-top: 10px;">This is why modern analysis requires careful attention to null sets and singular measures.</p>
                </div>
            </div>
        </div>

        <p style="text-align: center; color: #666; margin-top: 30px; font-size: 0.9em;">
            First described by <a href="https://en.wikipedia.org/wiki/Cantor_function" style="color: #ff6633;">Georg Cantor (1884)</a>.
            See also: <a href="https://math.hmc.edu/funfacts/devils-staircase/" style="color: #ff6633;">Math Fun Facts</a>.
        </p>
    </div>

    <script>
        // State
        let currentIter = 6;
        let animating = false;

        // Cantor function computation
        function cantorFunction(x, iterations) {
            let result = 0;
            let power = 0.5;

            for (let i = 0; i < iterations; i++) {
                if (x >= 2/3) {
                    result += power;
                    x = 3 * x - 2;
                } else if (x >= 1/3) {
                    result += power;
                    return result;
                } else {
                    x = 3 * x;
                }
                power /= 2;
            }

            return result + power;
        }

        // Generate Cantor set intervals
        function getCantorIntervals(iterations) {
            let intervals = [[0, 1]];

            for (let i = 0; i < iterations; i++) {
                const newIntervals = [];
                for (const [a, b] of intervals) {
                    const third = (b - a) / 3;
                    newIntervals.push([a, a + third]);
                    newIntervals.push([b - third, b]);
                }
                intervals = newIntervals;
            }

            return intervals;
        }

        // Draw Devil's Staircase
        function drawFunction(iterations) {
            const canvas = document.getElementById('functionCanvas');
            const ctx = canvas.getContext('2d');
            const dpr = window.devicePixelRatio || 1;

            const width = canvas.offsetWidth;
            const height = canvas.offsetHeight;

            canvas.width = width * dpr;
            canvas.height = height * dpr;
            ctx.scale(dpr, dpr);

            // Background
            ctx.fillStyle = '#0a0505';
            ctx.fillRect(0, 0, width, height);

            const margin = 50;
            const plotWidth = width - 2 * margin;
            const plotHeight = height - 2 * margin;

            // Grid
            ctx.strokeStyle = '#222';
            ctx.lineWidth = 0.5;
            for (let i = 0; i <= 10; i++) {
                const x = margin + (i / 10) * plotWidth;
                const y = margin + (i / 10) * plotHeight;
                ctx.beginPath();
                ctx.moveTo(x, margin);
                ctx.lineTo(x, height - margin);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(margin, y);
                ctx.lineTo(width - margin, y);
                ctx.stroke();
            }

            // Axes
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(margin, height - margin);
            ctx.lineTo(width - margin, height - margin);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(margin, height - margin);
            ctx.lineTo(margin, margin);
            ctx.stroke();

            // Labels
            ctx.fillStyle = '#888';
            ctx.font = '12px Georgia';
            ctx.textAlign = 'center';
            ctx.fillText('0', margin, height - margin + 20);
            ctx.fillText('1', width - margin, height - margin + 20);
            ctx.fillText('x', width - margin + 20, height - margin);
            ctx.textAlign = 'right';
            ctx.fillText('0', margin - 10, height - margin + 5);
            ctx.fillText('1', margin - 10, margin + 5);
            ctx.fillText('f(x)', margin - 5, margin - 10);

            // Draw the function
            const steps = Math.pow(3, iterations);
            ctx.strokeStyle = '#ff6633';
            ctx.lineWidth = 2;
            ctx.beginPath();

            let prevX = 0, prevY = 0;
            for (let i = 0; i <= steps; i++) {
                const x = i / steps;
                const y = cantorFunction(x, iterations);

                const canvasX = margin + x * plotWidth;
                const canvasY = height - margin - y * plotHeight;

                if (i === 0) {
                    ctx.moveTo(canvasX, canvasY);
                } else {
                    ctx.lineTo(canvasX, canvasY);
                }
            }
            ctx.stroke();

            // Highlight flat segments with different color
            const intervals = getCantorIntervals(iterations);
            ctx.strokeStyle = 'rgba(255, 200, 50, 0.3)';
            ctx.lineWidth = 4;

            // Mark the gaps (flat parts)
            let prevEnd = 0;
            for (const [a, b] of intervals) {
                if (a > prevEnd + 0.001) {
                    const gapStart = prevEnd;
                    const gapEnd = a;
                    const y = cantorFunction((gapStart + gapEnd) / 2, iterations);

                    ctx.beginPath();
                    ctx.moveTo(margin + gapStart * plotWidth, height - margin - y * plotHeight);
                    ctx.lineTo(margin + gapEnd * plotWidth, height - margin - y * plotHeight);
                    ctx.stroke();
                }
                prevEnd = b;
            }

            // Update stats
            const cantorMeasure = Math.pow(2/3, iterations);
            const flatMeasure = 1 - cantorMeasure;
            document.getElementById('flatPercent').textContent = (flatMeasure * 100).toFixed(2) + '%';
            document.getElementById('risingPercent').textContent = (cantorMeasure * 100).toFixed(4) + '%';
        }

        // Draw Cantor set
        function drawCantorSet(iterations) {
            const canvas = document.getElementById('cantorCanvas');
            const ctx = canvas.getContext('2d');
            const dpr = window.devicePixelRatio || 1;

            const width = canvas.offsetWidth;
            const height = canvas.offsetHeight;

            canvas.width = width * dpr;
            canvas.height = height * dpr;
            ctx.scale(dpr, dpr);

            // Background
            ctx.fillStyle = '#0a0505';
            ctx.fillRect(0, 0, width, height);

            const margin = 20;
            const barHeight = 20;
            const startY = (height - barHeight) / 2;

            // Draw Cantor set intervals
            const intervals = getCantorIntervals(Math.min(iterations, 8));

            ctx.fillStyle = '#66ff66';
            for (const [a, b] of intervals) {
                const x = margin + a * (width - 2 * margin);
                const w = (b - a) * (width - 2 * margin);
                ctx.fillRect(x, startY, Math.max(w, 1), barHeight);
            }

            // Labels
            ctx.fillStyle = '#888';
            ctx.font = '11px Georgia';
            ctx.textAlign = 'center';
            ctx.fillText('0', margin, startY + barHeight + 15);
            ctx.fillText('1', width - margin, startY + barHeight + 15);
        }

        // Draw construction steps
        function drawConstructionSteps() {
            for (let step = 0; step <= 4; step++) {
                const container = document.getElementById('step' + step);
                if (!container) continue;

                container.innerHTML = '';

                if (step === 0) {
                    // Full interval
                    const div = document.createElement('div');
                    div.style.cssText = 'position: absolute; left: 0; right: 0; top: 0; bottom: 0; background: #66ff66;';
                    container.appendChild(div);
                    continue;
                }

                const iterations = step === 4 ? 6 : step;
                const intervals = getCantorIntervals(iterations);

                // Draw remaining intervals
                for (const [a, b] of intervals) {
                    const div = document.createElement('div');
                    div.style.cssText = `
                        position: absolute;
                        left: ${a * 100}%;
                        width: ${(b - a) * 100}%;
                        top: 0;
                        bottom: 0;
                        background: #66ff66;
                    `;
                    container.appendChild(div);
                }
            }
        }

        // Animation
        async function animateConstruction() {
            if (animating) return;
            animating = true;

            for (let i = 1; i <= 10; i++) {
                document.getElementById('iterSlider').value = i;
                document.getElementById('iterValue').textContent = i;
                currentIter = i;
                drawFunction(i);
                drawCantorSet(i);
                await new Promise(r => setTimeout(r, 400));
            }

            animating = false;
        }

        // Event listeners
        document.getElementById('iterSlider').addEventListener('input', (e) => {
            currentIter = parseInt(e.target.value);
            document.getElementById('iterValue').textContent = currentIter;
            drawFunction(currentIter);
            drawCantorSet(currentIter);
        });

        document.getElementById('animateBtn').addEventListener('click', animateConstruction);

        document.getElementById('resetBtn').addEventListener('click', () => {
            currentIter = 1;
            document.getElementById('iterSlider').value = 1;
            document.getElementById('iterValue').textContent = 1;
            drawFunction(1);
            drawCantorSet(1);
        });

        // Initialize
        window.addEventListener('load', () => {
            drawFunction(currentIter);
            drawCantorSet(currentIter);
            drawConstructionSteps();
        });

        window.addEventListener('resize', () => {
            drawFunction(currentIter);
            drawCantorSet(currentIter);
        });
    </script>
</body>
</html>
