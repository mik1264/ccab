<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Falling Slinky Paradox - Surprising Paradoxes - CCAB</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600;700&family=Nunito:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --sage: #8A9A5B;
            --moss: #606C38;
            --earth: #DDA15E;
            --cream: #FEFAE0;
            --terracotta: #BC6C25;
            --dark-moss: #3d4423;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #FEFAE0 0%, #F4F1DE 50%, #EDE8D5 100%);
            min-height: 100vh;
            color: var(--dark-moss);
            line-height: 1.7;
        }
        .organic-shape {
            position: fixed;
            border-radius: 60% 40% 50% 50% / 50% 60% 40% 50%;
            opacity: 0.12;
            z-index: 0;
            animation: morph 30s ease-in-out infinite;
        }
        .shape-1 {
            width: 600px;
            height: 600px;
            background: linear-gradient(135deg, var(--sage), var(--moss));
            top: -200px;
            right: -150px;
        }
        .shape-2 {
            width: 500px;
            height: 500px;
            background: linear-gradient(135deg, var(--earth), var(--terracotta));
            bottom: -150px;
            left: -150px;
            animation-delay: -15s;
        }
        @keyframes morph {
            0%, 100% { border-radius: 60% 40% 50% 50% / 50% 60% 40% 50%; }
            25% { border-radius: 50% 60% 40% 50% / 40% 50% 60% 50%; }
            50% { border-radius: 40% 50% 60% 50% / 50% 40% 50% 60%; }
            75% { border-radius: 50% 40% 50% 60% / 60% 50% 40% 50%; }
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px 80px;
            position: relative;
            z-index: 1;
        }
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--moss);
            text-decoration: none;
            font-weight: 500;
            margin-bottom: 30px;
            padding: 10px 20px;
            background: rgba(255,255,255,0.6);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            transition: all 0.3s ease;
        }
        .back-link:hover {
            background: rgba(255,255,255,0.9);
            transform: translateX(-5px);
        }
        h1 {
            font-family: 'Lora', serif;
            font-size: 2.8rem;
            font-weight: 600;
            color: var(--moss);
            margin-bottom: 20px;
            line-height: 1.2;
        }
        .subtitle {
            font-size: 1.3rem;
            color: var(--terracotta);
            margin-bottom: 40px;
            font-weight: 500;
        }
        .badge {
            display: inline-block;
            background: linear-gradient(135deg, #ffd700, #ffb700);
            color: #1a1a2e;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 25px;
        }
        .card {
            background: rgba(255,255,255,0.7);
            backdrop-filter: blur(15px);
            border-radius: 24px;
            padding: 35px;
            margin-bottom: 35px;
            border: 1px solid rgba(138,154,91,0.2);
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
        }
        .card h2 {
            font-family: 'Lora', serif;
            font-size: 1.6rem;
            color: var(--moss);
            margin-bottom: 20px;
        }
        .card p {
            color: #555;
            margin-bottom: 18px;
        }
        .card p:last-child {
            margin-bottom: 0;
        }
        .highlight {
            background: linear-gradient(120deg, rgba(221,161,94,0.2) 0%, rgba(221,161,94,0.1) 100%);
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 600;
            color: var(--terracotta);
        }

        /* Simulation Canvas */
        .simulation-container {
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 35px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.2);
        }
        .simulation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .simulation-title {
            color: #fff;
            font-family: 'Lora', serif;
            font-size: 1.3rem;
        }
        .controls {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        .btn {
            background: linear-gradient(135deg, var(--earth) 0%, var(--terracotta) 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-family: 'Nunito', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(188,108,37,0.4);
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .btn-secondary {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
        }
        .btn-secondary:hover {
            background: rgba(255,255,255,0.25);
            box-shadow: 0 8px 25px rgba(255,255,255,0.1);
        }
        #simCanvas {
            display: block;
            width: 100%;
            border-radius: 12px;
            background: linear-gradient(180deg, #0f0f23 0%, #1a1a2e 100%);
        }
        .simulation-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .info-box {
            background: rgba(255,255,255,0.08);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }
        .info-label {
            color: rgba(255,255,255,0.6);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }
        .info-value {
            color: #fff;
            font-size: 1.4rem;
            font-weight: 700;
            font-family: 'Courier New', monospace;
        }
        .info-value.highlight-gold {
            color: #ffd700;
        }

        /* Legend */
        .legend {
            display: flex;
            gap: 25px;
            margin-top: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: rgba(255,255,255,0.8);
            font-size: 0.85rem;
        }
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        .legend-dot.slinky { background: linear-gradient(135deg, #ff6b6b, #ffd93d); }
        .legend-dot.com { background: #00ff88; }
        .legend-dot.wave { background: #00bfff; }
        .legend-dot.ball { background: #888; }

        /* Slider controls */
        .slider-group {
            margin-top: 20px;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
        }
        .slider-row {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 12px;
        }
        .slider-row:last-child {
            margin-bottom: 0;
        }
        .slider-label {
            color: rgba(255,255,255,0.8);
            font-size: 0.85rem;
            min-width: 120px;
        }
        .slider {
            flex: 1;
            -webkit-appearance: none;
            height: 6px;
            border-radius: 3px;
            background: rgba(255,255,255,0.2);
            outline: none;
        }
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--earth);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        .slider-value {
            color: #ffd700;
            font-weight: 600;
            min-width: 50px;
            text-align: right;
            font-family: 'Courier New', monospace;
        }

        /* Quote */
        .quote {
            border-left: 4px solid var(--earth);
            padding-left: 25px;
            margin: 25px 0;
            font-style: italic;
            color: #666;
        }
        .quote-author {
            font-style: normal;
            font-weight: 600;
            color: var(--moss);
            margin-top: 10px;
        }

        /* Key insight box */
        .insight-box {
            background: linear-gradient(135deg, rgba(138,154,91,0.15) 0%, rgba(96,108,56,0.1) 100%);
            border: 2px solid var(--sage);
            border-radius: 16px;
            padding: 25px;
            margin: 25px 0;
        }
        .insight-box h3 {
            color: var(--moss);
            font-family: 'Lora', serif;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Diagram */
        .diagram {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        .diagram-item {
            text-align: center;
        }
        .diagram-visual {
            width: 120px;
            height: 200px;
            background: rgba(255,255,255,0.5);
            border-radius: 12px;
            margin-bottom: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px;
            position: relative;
        }
        .diagram-label {
            font-size: 0.9rem;
            color: var(--moss);
            font-weight: 600;
        }

        /* Application cards */
        .applications {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .app-card {
            background: rgba(255,255,255,0.5);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s ease;
        }
        .app-card:hover {
            transform: translateY(-5px);
        }
        .app-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        .app-title {
            font-weight: 600;
            color: var(--moss);
            margin-bottom: 8px;
        }
        .app-desc {
            font-size: 0.85rem;
            color: #666;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding-top: 30px;
            color: #888;
            font-size: 0.85rem;
        }
        .footer a {
            color: var(--moss);
        }

        @media (max-width: 600px) {
            h1 { font-size: 2rem; }
            .card { padding: 25px; }
            .simulation-container { padding: 20px; }
            .slider-row { flex-wrap: wrap; }
            .slider-label { min-width: 100%; }
        }
    </style>
</head>
<body>
    <div class="organic-shape shape-1"></div>
    <div class="organic-shape shape-2"></div>

    <main class="container">
        <a href="index.html" class="back-link">← Back to Paradoxes</a>

        <span class="badge">Interactive Physics</span>
        <h1>The Falling Slinky Paradox</h1>
        <p class="subtitle">The bottom of a falling Slinky <em>levitates</em> in mid-air until the collapse wave reaches it. Information travels at a finite speed through matter.</p>

        <!-- Main Simulation -->
        <div class="simulation-container">
            <div class="simulation-header">
                <h2 class="simulation-title">Interactive Simulation</h2>
                <div class="controls">
                    <button class="btn" id="dropBtn">
                        <span>&#9660;</span> Drop Slinky
                    </button>
                    <button class="btn btn-secondary" id="resetBtn">
                        <span>&#8635;</span> Reset
                    </button>
                    <button class="btn btn-secondary" id="slowmoBtn">
                        <span>&#9202;</span> Slow-Mo: OFF
                    </button>
                </div>
            </div>

            <canvas id="simCanvas" width="800" height="500"></canvas>

            <div class="simulation-info">
                <div class="info-box">
                    <div class="info-label">Time</div>
                    <div class="info-value" id="timeDisplay">0.000s</div>
                </div>
                <div class="info-box">
                    <div class="info-label">Bottom Position</div>
                    <div class="info-value highlight-gold" id="bottomDisplay">0.0 cm</div>
                </div>
                <div class="info-box">
                    <div class="info-label">Top Position</div>
                    <div class="info-value" id="topDisplay">0.0 cm</div>
                </div>
                <div class="info-box">
                    <div class="info-label">Center of Mass</div>
                    <div class="info-value" id="comDisplay">0.0 cm</div>
                </div>
            </div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-dot slinky"></div>
                    <span>Slinky</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot com"></div>
                    <span>Center of Mass</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot wave"></div>
                    <span>Collapse Wave</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot ball"></div>
                    <span>Regular Ball (comparison)</span>
                </div>
            </div>

            <div class="slider-group">
                <div class="slider-row">
                    <span class="slider-label">Spring Constant</span>
                    <input type="range" class="slider" id="springSlider" min="5" max="50" value="20">
                    <span class="slider-value" id="springValue">20 N/m</span>
                </div>
                <div class="slider-row">
                    <span class="slider-label">Slinky Mass</span>
                    <input type="range" class="slider" id="massSlider" min="50" max="300" value="150">
                    <span class="slider-value" id="massValue">150g</span>
                </div>
                <div class="slider-row">
                    <span class="slider-label">Number of Coils</span>
                    <input type="range" class="slider" id="coilsSlider" min="15" max="50" value="30">
                    <span class="slider-value" id="coilsValue">30</span>
                </div>
            </div>
        </div>

        <!-- The Paradox -->
        <div class="card">
            <h2>The Astonishing Phenomenon</h2>
            <p>Hold a Slinky from its top and let it dangle under its own weight. The coils stretch out, with the bottom hanging motionless in equilibrium. Now release the top.</p>
            <p><span class="highlight">The bottom doesn't move.</span> It hovers in mid-air, seemingly defying gravity, while the top collapses downward. Only when the compression wave traveling through the Slinky reaches the bottom does it finally begin to fall.</p>
            <p>This isn't magic or an optical illusion&mdash;it's a profound demonstration that <strong>information travels at a finite speed through matter</strong>.</p>

            <div class="quote">
                "The bottom of the Slinky doesn't know it's supposed to fall. It just sits there, seeming to defy gravity, until the very end."
                <div class="quote-author">— Robert Krulwich, NPR</div>
            </div>
        </div>

        <!-- Physics Explanation -->
        <div class="card">
            <h2>The Physics: Why It Works</h2>

            <div class="insight-box">
                <h3>&#128161; Key Insight</h3>
                <p>Before release, the bottom of the Slinky experiences two balanced forces: <strong>gravity pulling down</strong> and <strong>spring tension pulling up</strong>. These are in perfect equilibrium&mdash;that's why it hangs motionless.</p>
                <p>When you release the top, nothing changes for the bottom <em>yet</em>. The tension is still there! The "news" that the top has been released must travel down through the spring as a compression wave.</p>
            </div>

            <p><strong>Three key observations:</strong></p>

            <p><strong>1. Force balance persists:</strong> At the moment of release, the bottom coil still feels the same upward tension from the coils above it. Gravity + tension = zero net force. So it doesn't accelerate.</p>

            <p><strong>2. The compression wave:</strong> The top of the Slinky begins falling faster than <em>g</em> (gravitational acceleration) because both gravity AND the spring tension are pulling it down. This creates a compression wave that travels through the Slinky at the speed of sound in the spring material.</p>

            <p><strong>3. Center of mass falls normally:</strong> Despite the strange behavior of the ends, the Slinky's center of mass falls exactly as expected&mdash;accelerating at <em>g</em>, just like any dropped object. The green dot in the simulation confirms this!</p>
        </div>

        <!-- Surprising Fact -->
        <div class="card">
            <h2>A Universal Constant</h2>
            <p>Here's something even more surprising: the time the bottom hovers is <span class="highlight">independent of the planet's gravity</span>.</p>
            <p>Whether you drop the Slinky on Earth, the Moon, Jupiter, or Mars, the levitation time is the same! This is because both the extension of the hanging Slinky AND the wave speed through it scale with gravity in a way that cancels out.</p>
            <p>For a typical metal Slinky, the bottom hovers for approximately <strong>0.3 seconds</strong>&mdash;long enough to see clearly, especially in slow motion.</p>

            <div class="insight-box">
                <h3>&#127776; Mathematical Insight</h3>
                <p>The levitation time equals: <strong>t = 2L/c</strong></p>
                <p>Where L is the stretched length and c is the wave speed. Both depend on √(g), so the ratio is constant regardless of gravity!</p>
            </div>
        </div>

        <!-- Shock Wave -->
        <div class="card">
            <h2>Breaking the Sound Barrier</h2>
            <p>According to physicist William Unruh, something remarkable happens at the moment of impact: the compression wave <strong>exceeds the normal wave velocity</strong> in the Slinky.</p>
            <p>When the falling coils collide with the stationary bottom, they create a shock wave analogous to a sonic boom. The Slinky essentially breaks its own "sound barrier"!</p>
            <p>This is why you hear a characteristic <em>clack</em> when the Slinky collapses&mdash;it's a miniature sonic boom.</p>
        </div>

        <!-- Real-World Applications -->
        <div class="card">
            <h2>Beyond the Toy: Real-World Implications</h2>
            <p>The falling Slinky isn't just a physics curiosity&mdash;it illustrates fundamental principles that appear throughout nature:</p>

            <div class="applications">
                <div class="app-card">
                    <div class="app-icon">&#127759;</div>
                    <div class="app-title">Seismic Waves</div>
                    <div class="app-desc">Earthquake information travels through Earth at finite speeds, just like through the Slinky</div>
                </div>
                <div class="app-card">
                    <div class="app-icon">&#128165;</div>
                    <div class="app-title">Explosions</div>
                    <div class="app-desc">Blast waves propagate outward; distant objects don't "know" about the explosion yet</div>
                </div>
                <div class="app-card">
                    <div class="app-icon">&#128225;</div>
                    <div class="app-title">Signal Propagation</div>
                    <div class="app-desc">Electrical signals in cables, light in fiber optics&mdash;all travel at finite speeds</div>
                </div>
                <div class="app-card">
                    <div class="app-icon">&#9733;</div>
                    <div class="app-title">Stellar Collapse</div>
                    <div class="app-desc">When a star's core collapses, outer layers don't "know" immediately&mdash;creating supernovae</div>
                </div>
            </div>
        </div>

        <!-- Try It Yourself -->
        <div class="card">
            <h2>Try It Yourself</h2>
            <p>This is one of the easiest physics demonstrations to replicate:</p>
            <ol style="margin-left: 25px; color: #555;">
                <li style="margin-bottom: 10px;">Get a metal Slinky (plastic ones work but are less dramatic)</li>
                <li style="margin-bottom: 10px;">Hold it from the top, letting it dangle fully extended</li>
                <li style="margin-bottom: 10px;">Have a friend record with a smartphone in slow-motion mode (240fps ideal)</li>
                <li style="margin-bottom: 10px;">Release cleanly from the top</li>
                <li>Watch the bottom hover while the top collapses!</li>
            </ol>
            <p style="margin-top: 20px;">The effect is even more striking with a longer Slinky or when filmed from the side at bottom-coil level.</p>
        </div>

        <!-- Historical Note -->
        <div class="card">
            <h2>History and Discovery</h2>
            <p>The falling Slinky phenomenon gained widespread attention through a 2011 viral video by Australian science communicator Derek Muller (Veritasium). Physicist Rod Cross of the University of Sydney provided the quantitative analysis.</p>
            <p>The physics was already known to specialists, but the dramatic visual demonstration captivated millions and became a staple of physics education worldwide.</p>
            <p>The Slinky itself was invented accidentally by naval engineer Richard James in 1943 while working on anti-vibration devices for ship instruments. He watched a spring fall off a shelf and "walk" across the floor, inspiring the iconic toy.</p>
        </div>

        <div class="footer">
            <p>Sources: <a href="https://www.npr.org/sections/krulwich/2012/09/11/160933582/the-miracle-of-the-levitating-slinky" target="_blank">NPR Krulwich Wonders</a>,
            <a href="http://large.stanford.edu/courses/2007/ph210/kolkowitz1/" target="_blank">Stanford Physics</a>,
            <a href="https://jdh.hamkins.org/how-does-a-slinky-fall/" target="_blank">Joel David Hamkins</a></p>
            <p style="margin-top: 10px;">Part of <a href="../index.html">CCAB</a> &middot; Surprising Paradoxes Collection</p>
        </div>
    </main>

    <script>
        // === FALLING SLINKY SIMULATION ===
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');

        // High DPI support
        const dpr = window.devicePixelRatio || 1;
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width * dpr;
        canvas.height = rect.height * dpr;
        ctx.scale(dpr, dpr);
        canvas.style.width = rect.width + 'px';
        canvas.style.height = rect.height + 'px';

        const W = rect.width;
        const H = rect.height;

        // Physics parameters
        let springConstant = 20;  // N/m
        let totalMass = 0.15;     // kg (150g)
        let numCoils = 30;
        let g = 9.81;             // m/s²
        let slowMo = false;
        let timeScale = 1;

        // Slinky state
        let coils = [];
        let isDropping = false;
        let simulationTime = 0;
        let initialBottomY = 0;
        let ballY = 0;
        let ballVy = 0;

        // Display scaling
        const PIXELS_PER_METER = 400;
        const SLINKY_X = W * 0.35;
        const BALL_X = W * 0.7;
        const TOP_Y = 50;

        // Initialize slinky
        function initSlinky() {
            coils = [];
            const coilMass = totalMass / numCoils;
            const naturalLength = 0.02; // 2cm natural spacing

            // Calculate equilibrium positions under gravity
            // Each coil supports the weight of all coils below it
            let y = TOP_Y / PIXELS_PER_METER;

            for (let i = 0; i < numCoils; i++) {
                // Weight below this coil
                const weightBelow = (numCoils - i) * coilMass * g;
                // Extension due to this weight
                const extension = weightBelow / springConstant;

                coils.push({
                    y: y,
                    vy: 0,
                    naturalY: y,  // For drawing reference
                    mass: coilMass,
                    collapsed: false
                });

                y += naturalLength + extension / numCoils;
            }

            initialBottomY = coils[numCoils - 1].y;
            ballY = coils[Math.floor(numCoils / 2)].y;  // Start at COM position
            ballVy = 0;
            simulationTime = 0;
            isDropping = false;

            updateDisplays();
            draw();
        }

        // Physics step
        function physicsStep(dt) {
            if (!isDropping) return;

            simulationTime += dt;

            // Update ball (simple free fall)
            ballVy += g * dt;
            ballY += ballVy * dt;

            // Slinky physics using spring-mass chain
            const naturalSpacing = 0.02;
            const coilMass = totalMass / numCoils;
            const k = springConstant * numCoils; // Effective spring constant per segment

            // Calculate forces and update velocities
            for (let i = 0; i < numCoils; i++) {
                let force = coilMass * g; // Gravity

                // Spring force from coil above
                if (i > 0) {
                    const stretch = coils[i].y - coils[i-1].y - naturalSpacing;
                    if (stretch > 0) {
                        force -= k * stretch;
                    } else {
                        // Compression - coils touching
                        force -= k * stretch * 10; // Strong repulsion
                        coils[i].collapsed = true;
                    }
                }

                // Spring force from coil below
                if (i < numCoils - 1) {
                    const stretch = coils[i+1].y - coils[i].y - naturalSpacing;
                    if (stretch > 0) {
                        force += k * stretch;
                    }
                }

                // Update velocity
                coils[i].vy += (force / coilMass) * dt;
            }

            // Update positions
            for (let i = 0; i < numCoils; i++) {
                coils[i].y += coils[i].vy * dt;
            }

            // Prevent coils from passing through each other
            for (let i = 1; i < numCoils; i++) {
                if (coils[i].y < coils[i-1].y + 0.005) {
                    coils[i].y = coils[i-1].y + 0.005;
                    // Inelastic collision
                    const avgVy = (coils[i].vy + coils[i-1].vy) / 2;
                    coils[i].vy = avgVy;
                    coils[i-1].vy = avgVy;
                    coils[i].collapsed = true;
                }
            }

            updateDisplays();
        }

        // Calculate center of mass
        function getCenterOfMass() {
            let totalY = 0;
            for (let i = 0; i < numCoils; i++) {
                totalY += coils[i].y;
            }
            return totalY / numCoils;
        }

        // Drawing
        function draw() {
            ctx.clearRect(0, 0, W, H);

            // Background gradient
            const bgGrad = ctx.createLinearGradient(0, 0, 0, H);
            bgGrad.addColorStop(0, '#0f0f23');
            bgGrad.addColorStop(1, '#1a1a2e');
            ctx.fillStyle = bgGrad;
            ctx.fillRect(0, 0, W, H);

            // Grid lines
            ctx.strokeStyle = 'rgba(255,255,255,0.05)';
            ctx.lineWidth = 1;
            for (let y = 0; y < H; y += 50) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(W, y);
                ctx.stroke();
            }

            // Labels
            ctx.fillStyle = 'rgba(255,255,255,0.4)';
            ctx.font = '14px Nunito';
            ctx.textAlign = 'center';
            ctx.fillText('SLINKY', SLINKY_X, 30);
            ctx.fillText('COMPARISON BALL', BALL_X, 30);

            // Draw holding hand or release indicator
            if (!isDropping) {
                ctx.fillStyle = 'rgba(255,255,255,0.3)';
                ctx.beginPath();
                ctx.arc(SLINKY_X, TOP_Y - 15, 12, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = 'rgba(255,255,255,0.6)';
                ctx.font = '10px Nunito';
                ctx.fillText('HELD', SLINKY_X, TOP_Y - 30);
            }

            // Draw slinky
            const coilWidth = 30;
            for (let i = 0; i < numCoils; i++) {
                const py = coils[i].y * PIXELS_PER_METER;

                // Coil gradient based on position (warm colors)
                const hue = 40 - (i / numCoils) * 30; // Orange to yellow
                const lightness = coils[i].collapsed ? 70 : 55;

                ctx.strokeStyle = `hsl(${hue}, 90%, ${lightness}%)`;
                ctx.lineWidth = 3;
                ctx.lineCap = 'round';

                // Draw coil as an ellipse
                ctx.beginPath();
                ctx.ellipse(SLINKY_X, py, coilWidth, 3, 0, 0, Math.PI * 2);
                ctx.stroke();

                // Connecting line to next coil
                if (i < numCoils - 1) {
                    const nextPy = coils[i + 1].y * PIXELS_PER_METER;
                    ctx.strokeStyle = `hsla(${hue}, 80%, 50%, 0.3)`;
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(SLINKY_X - coilWidth, py);
                    ctx.lineTo(SLINKY_X - coilWidth, nextPy);
                    ctx.moveTo(SLINKY_X + coilWidth, py);
                    ctx.lineTo(SLINKY_X + coilWidth, nextPy);
                    ctx.stroke();
                }
            }

            // Highlight the wave front (collapsed region boundary)
            if (isDropping) {
                for (let i = 1; i < numCoils; i++) {
                    if (!coils[i].collapsed && coils[i-1].collapsed) {
                        const py = coils[i].y * PIXELS_PER_METER;
                        ctx.fillStyle = 'rgba(0, 191, 255, 0.3)';
                        ctx.beginPath();
                        ctx.arc(SLINKY_X, py, 40, 0, Math.PI * 2);
                        ctx.fill();

                        ctx.strokeStyle = '#00bfff';
                        ctx.lineWidth = 2;
                        ctx.setLineDash([5, 5]);
                        ctx.beginPath();
                        ctx.moveTo(SLINKY_X - 60, py);
                        ctx.lineTo(SLINKY_X + 60, py);
                        ctx.stroke();
                        ctx.setLineDash([]);

                        ctx.fillStyle = '#00bfff';
                        ctx.font = '12px Nunito';
                        ctx.textAlign = 'left';
                        ctx.fillText('← Wave front', SLINKY_X + 65, py + 4);
                        break;
                    }
                }
            }

            // Center of mass
            const comY = getCenterOfMass() * PIXELS_PER_METER;
            ctx.fillStyle = '#00ff88';
            ctx.beginPath();
            ctx.arc(SLINKY_X, comY, 8, 0, Math.PI * 2);
            ctx.fill();
            ctx.strokeStyle = 'rgba(0, 255, 136, 0.3)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(SLINKY_X, comY, 15, 0, Math.PI * 2);
            ctx.stroke();

            // COM label
            ctx.fillStyle = '#00ff88';
            ctx.font = '11px Nunito';
            ctx.textAlign = 'left';
            ctx.fillText('COM', SLINKY_X + 20, comY + 4);

            // Draw comparison ball
            const ballPy = ballY * PIXELS_PER_METER;
            ctx.fillStyle = '#666';
            ctx.beginPath();
            ctx.arc(BALL_X, ballPy, 15, 0, Math.PI * 2);
            ctx.fill();
            ctx.strokeStyle = '#888';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(BALL_X, ballPy, 15, 0, Math.PI * 2);
            ctx.stroke();

            // Ball starting position indicator
            if (isDropping) {
                ctx.strokeStyle = 'rgba(255,255,255,0.2)';
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.arc(BALL_X, coils[Math.floor(numCoils/2)].naturalY * PIXELS_PER_METER, 15, 0, Math.PI * 2);
                ctx.stroke();
                ctx.setLineDash([]);
            }

            // Bottom position indicator
            const bottomY = coils[numCoils - 1].y * PIXELS_PER_METER;
            if (isDropping && Math.abs(bottomY - initialBottomY * PIXELS_PER_METER) < 5) {
                // Still hovering!
                ctx.fillStyle = '#ffd700';
                ctx.font = 'bold 14px Nunito';
                ctx.textAlign = 'left';
                ctx.fillText('HOVERING!', SLINKY_X + 50, bottomY + 5);

                // Horizontal line showing original position
                ctx.strokeStyle = 'rgba(255, 215, 0, 0.5)';
                ctx.lineWidth = 1;
                ctx.setLineDash([3, 3]);
                ctx.beginPath();
                ctx.moveTo(SLINKY_X - 80, initialBottomY * PIXELS_PER_METER);
                ctx.lineTo(SLINKY_X + 45, initialBottomY * PIXELS_PER_METER);
                ctx.stroke();
                ctx.setLineDash([]);
            }

            // Scale indicator
            ctx.fillStyle = 'rgba(255,255,255,0.3)';
            ctx.font = '11px Nunito';
            ctx.textAlign = 'right';
            ctx.fillText('Scale: 1m', W - 20, H - 20);
            ctx.strokeStyle = 'rgba(255,255,255,0.3)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(W - 100, H - 30);
            ctx.lineTo(W - 100 + PIXELS_PER_METER * 0.25, H - 30);
            ctx.stroke();
            ctx.fillText('25cm', W - 20, H - 35);
        }

        // Update info displays
        function updateDisplays() {
            document.getElementById('timeDisplay').textContent = simulationTime.toFixed(3) + 's';

            const bottomY = coils[numCoils - 1].y;
            const topY = coils[0].y;
            const comY = getCenterOfMass();

            // Display relative to initial position
            const bottomDelta = (bottomY - initialBottomY) * 100;
            const topDelta = (topY - coils[0].naturalY) * 100;
            const comDelta = (comY - (initialBottomY + coils[0].naturalY) / 2) * 100;

            document.getElementById('bottomDisplay').textContent =
                (bottomDelta >= 0 ? '+' : '') + bottomDelta.toFixed(1) + ' cm';
            document.getElementById('topDisplay').textContent =
                (topDelta >= 0 ? '+' : '') + topDelta.toFixed(1) + ' cm';
            document.getElementById('comDisplay').textContent =
                (comDelta >= 0 ? '+' : '') + comDelta.toFixed(1) + ' cm';
        }

        // Animation loop
        let lastTime = 0;
        function animate(time) {
            const dt = Math.min((time - lastTime) / 1000, 0.05) * timeScale;
            lastTime = time;

            if (isDropping) {
                // Sub-stepping for stability
                const steps = 10;
                for (let i = 0; i < steps; i++) {
                    physicsStep(dt / steps);
                }
            }

            draw();
            requestAnimationFrame(animate);
        }

        // Event handlers
        document.getElementById('dropBtn').addEventListener('click', function() {
            if (!isDropping) {
                isDropping = true;
                this.disabled = true;
            }
        });

        document.getElementById('resetBtn').addEventListener('click', function() {
            document.getElementById('dropBtn').disabled = false;
            initSlinky();
        });

        document.getElementById('slowmoBtn').addEventListener('click', function() {
            slowMo = !slowMo;
            timeScale = slowMo ? 0.15 : 1;
            this.innerHTML = '<span>&#9202;</span> Slow-Mo: ' + (slowMo ? 'ON' : 'OFF');
        });

        // Slider handlers
        document.getElementById('springSlider').addEventListener('input', function() {
            springConstant = parseFloat(this.value);
            document.getElementById('springValue').textContent = this.value + ' N/m';
            if (!isDropping) initSlinky();
        });

        document.getElementById('massSlider').addEventListener('input', function() {
            totalMass = parseFloat(this.value) / 1000;
            document.getElementById('massValue').textContent = this.value + 'g';
            if (!isDropping) initSlinky();
        });

        document.getElementById('coilsSlider').addEventListener('input', function() {
            numCoils = parseInt(this.value);
            document.getElementById('coilsValue').textContent = this.value;
            if (!isDropping) initSlinky();
        });

        // Handle resize
        window.addEventListener('resize', function() {
            // Simplified resize handling
            location.reload();
        });

        // Start
        initSlinky();
        requestAnimationFrame(animate);
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
