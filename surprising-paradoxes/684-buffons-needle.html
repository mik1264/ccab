<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buffon's Needle - Finding œÄ with Random Drops</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e8e8e8;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 25px;
        }

        h1 {
            font-size: 2.2rem;
            background: linear-gradient(135deg, #8e44ad, #3498db, #1abc9c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #aaa;
            font-size: 1.1rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 330px;
            gap: 25px;
        }

        @media (max-width: 1100px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .viz-section {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
        }

        .canvas-container {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
        }

        canvas {
            border-radius: 8px;
            background: #f5e6d3;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
            color: #fff;
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #fff;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
        }

        .control-group label {
            font-size: 0.85rem;
            color: #aaa;
        }

        select {
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(0,0,0,0.5);
            color: #fff;
            font-size: 0.9rem;
        }

        .pi-display {
            text-align: center;
            padding: 20px;
            margin-top: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
        }

        .pi-label {
            font-size: 0.9rem;
            color: #888;
            margin-bottom: 5px;
        }

        .pi-estimate {
            font-size: 3rem;
            font-weight: bold;
            color: #9b59b6;
            font-family: 'Courier New', monospace;
        }

        .pi-actual {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #aaa;
        }

        .pi-error {
            margin-top: 5px;
            font-size: 0.85rem;
            color: #e74c3c;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .stat-box {
            background: rgba(0,0,0,0.3);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-label {
            font-size: 0.7rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 1.1rem;
            font-weight: bold;
            color: #9b59b6;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .exp-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 18px;
            border-left: 4px solid #9b59b6;
        }

        .exp-card h3 {
            color: #9b59b6;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .exp-card p {
            color: #ccc;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .formula {
            background: rgba(0,0,0,0.4);
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            color: #9b59b6;
            text-align: center;
            font-size: 0.9rem;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #9b59b6;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            opacity: 0.8;
            transition: opacity 0.3s;
            z-index: 100;
        }

        .back-link:hover {
            opacity: 1;
        }

        .highlight {
            color: #f39c12;
            font-weight: bold;
        }

        .convergence-chart {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
        }

        .convergence-chart h4 {
            color: #9b59b6;
            margin-bottom: 10px;
            font-size: 0.9rem;
            text-align: center;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Paradoxes</a>

    <div class="container">
        <header>
            <h1>Buffon's Needle</h1>
            <p class="subtitle">Comte de Buffon (1777) - Finding œÄ with Random Drops</p>
        </header>

        <div class="main-content">
            <div class="viz-section">
                <div class="canvas-container">
                    <canvas id="needleCanvas" width="700" height="400"></canvas>
                </div>

                <div class="controls">
                    <button class="btn btn-primary" id="dropBtn">Drop 1 Needle</button>
                    <button class="btn btn-secondary" id="drop10Btn">Drop 10</button>
                    <button class="btn btn-secondary" id="drop100Btn">Drop 100</button>
                    <button class="btn btn-secondary" id="drop1000Btn">Drop 1000</button>
                    <button class="btn btn-secondary" id="resetBtn">Reset</button>

                    <div class="control-group">
                        <label>Auto-drop:</label>
                        <select id="autoSelect">
                            <option value="0">Off</option>
                            <option value="10">10/sec</option>
                            <option value="50">50/sec</option>
                            <option value="100">100/sec</option>
                        </select>
                    </div>
                </div>

                <div class="pi-display">
                    <div class="pi-label">Estimated Value of œÄ</div>
                    <div class="pi-estimate" id="piEstimate">--</div>
                    <div class="pi-actual">Actual œÄ = 3.14159265...</div>
                    <div class="pi-error" id="piError">Error: --</div>
                </div>

                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-label">Needles</div>
                        <div class="stat-value" id="totalDrops">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Crossings</div>
                        <div class="stat-value" id="crossings">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Cross Rate</div>
                        <div class="stat-value" id="crossRate">--</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Expected</div>
                        <div class="stat-value" id="expected">63.7%</div>
                    </div>
                </div>

                <div class="convergence-chart">
                    <h4>œÄ Estimate Over Time</h4>
                    <canvas id="chartCanvas" width="660" height="120"></canvas>
                </div>
            </div>

            <div class="sidebar">
                <div class="exp-card">
                    <h3>üìè The Experiment</h3>
                    <p>Drop a needle of length <span class="highlight">L</span> onto a floor with parallel lines spaced <span class="highlight">D</span> apart (where L ‚â§ D). Count how many needles cross a line. The crossing probability magically involves œÄ!</p>
                </div>

                <div class="exp-card">
                    <h3>üî¢ The Formula</h3>
                    <p>Probability of crossing:</p>
                    <div class="formula">
                        P = 2L / (œÄD)
                    </div>
                    <p>Rearranging to estimate œÄ:</p>
                    <div class="formula">
                        œÄ = 2L √ó N / (D √ó C)
                    </div>
                    <p>Where N = total drops, C = crossings</p>
                </div>

                <div class="exp-card">
                    <h3>üé≤ Monte Carlo Method</h3>
                    <p>This is one of the earliest <span class="highlight">Monte Carlo</span> methods‚Äîusing randomness to solve deterministic problems! With enough drops, the estimate converges to œÄ. Mario Lazzarini got 355/113 after just 3,408 throws (1901).</p>
                </div>

                <div class="exp-card">
                    <h3>üìê Why Does œÄ Appear?</h3>
                    <p>The needle's random angle creates a <span class="highlight">uniform distribution</span> over 0 to œÄ radians. The crossing probability depends on sin(Œ∏), and integrating sin from 0 to œÄ gives 2‚Äîintroducing œÄ into the final formula!</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('needleCanvas');
        const ctx = canvas.getContext('2d');
        const chartCanvas = document.getElementById('chartCanvas');
        const chartCtx = chartCanvas.getContext('2d');

        // Needle parameters: L = needle length, D = line spacing
        const D = 60; // Line spacing
        const L = D;  // Needle length = line spacing (L/D = 1)

        let needles = [];
        let totalDrops = 0;
        let crossings = 0;
        let piHistory = [];
        let autoInterval = null;

        function drawFloor() {
            // Wood grain background
            ctx.fillStyle = '#f5e6d3';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw parallel lines
            ctx.strokeStyle = '#8b4513';
            ctx.lineWidth = 2;

            for (let x = D; x < canvas.width; x += D) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
        }

        function dropNeedle() {
            // Random center position
            const cx = Math.random() * canvas.width;
            const cy = Math.random() * canvas.height;

            // Random angle (0 to œÄ)
            const angle = Math.random() * Math.PI;

            // Calculate endpoints
            const halfL = L / 2;
            const dx = halfL * Math.cos(angle);
            const dy = halfL * Math.sin(angle);

            const x1 = cx - dx;
            const y1 = cy - dy;
            const x2 = cx + dx;
            const y2 = cy + dy;

            // Check if crosses a line
            const leftLine = Math.floor(Math.min(x1, x2) / D) * D;
            const rightLine = Math.ceil(Math.max(x1, x2) / D) * D;

            let crosses = false;
            for (let lineX = leftLine; lineX <= rightLine; lineX += D) {
                if (lineX > 0 && lineX < canvas.width) {
                    if ((x1 <= lineX && x2 >= lineX) || (x2 <= lineX && x1 >= lineX)) {
                        crosses = true;
                        break;
                    }
                }
            }

            needles.push({ x1, y1, x2, y2, crosses });
            totalDrops++;
            if (crosses) crossings++;

            // Limit visible needles for performance
            if (needles.length > 500) {
                needles.shift();
            }
        }

        function draw() {
            drawFloor();

            // Draw needles
            needles.forEach(needle => {
                ctx.strokeStyle = needle.crosses ? '#e74c3c' : '#2ecc71';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(needle.x1, needle.y1);
                ctx.lineTo(needle.x2, needle.y2);
                ctx.stroke();

                // Draw endpoints
                ctx.fillStyle = needle.crosses ? '#c0392b' : '#27ae60';
                ctx.beginPath();
                ctx.arc(needle.x1, needle.y1, 3, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.arc(needle.x2, needle.y2, 3, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function updateStats() {
            document.getElementById('totalDrops').textContent = totalDrops.toLocaleString();
            document.getElementById('crossings').textContent = crossings.toLocaleString();

            if (totalDrops > 0) {
                const rate = crossings / totalDrops;
                document.getElementById('crossRate').textContent = (rate * 100).toFixed(1) + '%';

                // œÄ = 2L * N / (D * C) = 2 * N / C (since L = D)
                if (crossings > 0) {
                    const piEst = (2 * totalDrops) / crossings;
                    document.getElementById('piEstimate').textContent = piEst.toFixed(6);

                    const error = Math.abs(piEst - Math.PI) / Math.PI * 100;
                    document.getElementById('piError').textContent = `Error: ${error.toFixed(3)}%`;

                    // Track history for chart
                    piHistory.push({ n: totalDrops, pi: piEst });
                    if (piHistory.length > 200) piHistory.shift();
                }
            }
        }

        function drawChart() {
            chartCtx.fillStyle = '#0a0a0a';
            chartCtx.fillRect(0, 0, chartCanvas.width, chartCanvas.height);

            if (piHistory.length < 2) return;

            const padding = 30;
            const width = chartCanvas.width - 2 * padding;
            const height = chartCanvas.height - 2 * padding;

            // Draw œÄ reference line
            const piY = padding + height / 2;
            chartCtx.strokeStyle = 'rgba(155, 89, 182, 0.5)';
            chartCtx.lineWidth = 1;
            chartCtx.setLineDash([5, 5]);
            chartCtx.beginPath();
            chartCtx.moveTo(padding, piY);
            chartCtx.lineTo(chartCanvas.width - padding, piY);
            chartCtx.stroke();
            chartCtx.setLineDash([]);

            chartCtx.fillStyle = '#888';
            chartCtx.font = '10px sans-serif';
            chartCtx.textAlign = 'right';
            chartCtx.fillText('œÄ', padding - 5, piY + 4);

            // Find y range
            const values = piHistory.map(p => p.pi);
            const minPi = Math.min(...values, Math.PI - 0.5);
            const maxPi = Math.max(...values, Math.PI + 0.5);
            const range = maxPi - minPi;

            // Draw estimate line
            chartCtx.strokeStyle = '#2ecc71';
            chartCtx.lineWidth = 2;
            chartCtx.beginPath();

            piHistory.forEach((point, i) => {
                const x = padding + (i / (piHistory.length - 1)) * width;
                const y = padding + height - ((point.pi - minPi) / range) * height;

                if (i === 0) {
                    chartCtx.moveTo(x, y);
                } else {
                    chartCtx.lineTo(x, y);
                }
            });

            chartCtx.stroke();

            // Labels
            chartCtx.fillStyle = '#666';
            chartCtx.textAlign = 'center';
            chartCtx.fillText('Drops', chartCanvas.width / 2, chartCanvas.height - 5);
        }

        function drop(count) {
            for (let i = 0; i < count; i++) {
                dropNeedle();
            }
            draw();
            updateStats();
            drawChart();
        }

        function reset() {
            needles = [];
            totalDrops = 0;
            crossings = 0;
            piHistory = [];

            document.getElementById('totalDrops').textContent = '0';
            document.getElementById('crossings').textContent = '0';
            document.getElementById('crossRate').textContent = '--';
            document.getElementById('piEstimate').textContent = '--';
            document.getElementById('piError').textContent = 'Error: --';

            draw();
            drawChart();
        }

        // Event listeners
        document.getElementById('dropBtn').addEventListener('click', () => drop(1));
        document.getElementById('drop10Btn').addEventListener('click', () => drop(10));
        document.getElementById('drop100Btn').addEventListener('click', () => drop(100));
        document.getElementById('drop1000Btn').addEventListener('click', () => drop(1000));
        document.getElementById('resetBtn').addEventListener('click', reset);

        document.getElementById('autoSelect').addEventListener('change', (e) => {
            if (autoInterval) {
                clearInterval(autoInterval);
                autoInterval = null;
            }

            const rate = parseInt(e.target.value);
            if (rate > 0) {
                autoInterval = setInterval(() => drop(rate / 10), 100);
            }
        });

        // Initialize
        draw();
        drawChart();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
