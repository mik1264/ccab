<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The St. Petersburg Paradox - The Infinite Expected Value Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.4em;
            background: linear-gradient(135deg, #f1c40f, #e67e22, #e74c3c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.3em;
            color: #f1c40f;
            font-style: italic;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #f1c40f;
            text-decoration: none;
            font-size: 1.1em;
            z-index: 100;
            transition: color 0.3s;
        }

        .back-link:hover {
            color: #e74c3c;
        }

        .rules-box {
            background: linear-gradient(135deg, rgba(241, 196, 15, 0.2), rgba(230, 126, 34, 0.1));
            border: 2px solid #f1c40f;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            text-align: center;
        }

        .rules-box h2 {
            color: #f1c40f;
            margin-bottom: 15px;
        }

        .rules-box p {
            font-size: 1.2em;
            line-height: 1.6;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 900px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .game-panel {
            background: rgba(20, 30, 50, 0.8);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(241, 196, 15, 0.3);
        }

        .coin-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 30px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .coin {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f1c40f, #d4ac0d);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            box-shadow: 0 10px 30px rgba(241, 196, 15, 0.3);
            transition: transform 0.1s;
            margin-bottom: 20px;
        }

        .coin.flipping {
            animation: flip 0.15s ease-in-out;
        }

        @keyframes flip {
            0% { transform: rotateY(0deg); }
            50% { transform: rotateY(90deg); }
            100% { transform: rotateY(0deg); }
        }

        .coin.heads {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }

        .flip-count {
            font-size: 1.5em;
            color: #aaa;
            margin-bottom: 10px;
        }

        .flip-count span {
            color: #f1c40f;
            font-weight: bold;
        }

        .current-prize {
            font-size: 2.5em;
            font-family: monospace;
            color: #2ecc71;
            margin: 15px 0;
        }

        .result-message {
            font-size: 1.3em;
            padding: 15px 30px;
            border-radius: 10px;
            margin-top: 15px;
            display: none;
        }

        .result-message.show {
            display: block;
            animation: pop 0.3s ease;
        }

        @keyframes pop {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .result-message.win {
            background: rgba(46, 204, 113, 0.2);
            border: 2px solid #2ecc71;
            color: #2ecc71;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .btn {
            padding: 15px 35px;
            font-size: 1.2em;
            border: 2px solid #f1c40f;
            background: transparent;
            color: #f1c40f;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
        }

        .btn:hover {
            background: rgba(241, 196, 15, 0.2);
        }

        .btn.primary {
            background: linear-gradient(135deg, #f1c40f, #e67e22);
            color: #1a1a2e;
            border: none;
            font-weight: bold;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .side-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .panel {
            background: rgba(20, 30, 50, 0.8);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(241, 196, 15, 0.3);
        }

        .panel h3 {
            color: #f1c40f;
            margin-bottom: 15px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-label {
            color: #aaa;
        }

        .stat-value {
            font-family: monospace;
            font-size: 1.2em;
        }

        .stat-value.money {
            color: #2ecc71;
        }

        .stat-value.games {
            color: #3498db;
        }

        .stat-value.infinite {
            color: #e74c3c;
            font-weight: bold;
        }

        .expected-display {
            text-align: center;
            padding: 20px;
            background: rgba(231, 76, 60, 0.1);
            border: 1px solid #e74c3c;
            border-radius: 12px;
            margin-top: 15px;
        }

        .expected-display .label {
            color: #aaa;
            margin-bottom: 5px;
        }

        .expected-display .value {
            font-size: 2.5em;
            color: #e74c3c;
            font-weight: bold;
        }

        .histogram {
            height: 150px;
            display: flex;
            align-items: flex-end;
            gap: 3px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin-top: 15px;
        }

        .hist-bar {
            flex: 1;
            background: linear-gradient(to top, #3498db, #2980b9);
            border-radius: 3px 3px 0 0;
            min-height: 2px;
            transition: height 0.3s;
            position: relative;
        }

        .hist-bar:hover::after {
            content: attr(data-label);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 11px;
            white-space: nowrap;
        }

        .hist-labels {
            display: flex;
            gap: 3px;
            padding: 5px 10px;
            font-size: 10px;
            color: #888;
        }

        .hist-labels span {
            flex: 1;
            text-align: center;
        }

        .explanation {
            background: rgba(20, 30, 50, 0.8);
            border-radius: 15px;
            padding: 30px;
            border: 1px solid rgba(241, 196, 15, 0.3);
            margin-bottom: 25px;
        }

        .explanation h2 {
            color: #f1c40f;
            margin-bottom: 20px;
        }

        .explanation p {
            line-height: 1.8;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .highlight {
            color: #e74c3c;
            font-weight: bold;
        }

        .highlight-gold {
            color: #f1c40f;
            font-weight: bold;
        }

        .highlight-green {
            color: #2ecc71;
            font-weight: bold;
        }

        .math-box {
            background: rgba(0, 0, 0, 0.4);
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            overflow-x: auto;
        }

        .math-row {
            display: flex;
            align-items: center;
            margin: 10px 0;
            flex-wrap: wrap;
            gap: 10px;
        }

        .math-term {
            background: rgba(52, 152, 219, 0.2);
            padding: 8px 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 1.1em;
        }

        .math-term .prob {
            color: #3498db;
        }

        .math-term .prize {
            color: #2ecc71;
        }

        .math-term .result {
            color: #f1c40f;
        }

        .math-equals {
            font-size: 1.5em;
            color: #888;
        }

        .insight-box {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.2), rgba(241, 196, 15, 0.1));
            border: 2px solid #e74c3c;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            text-align: center;
        }

        .insight-box h3 {
            color: #e74c3c;
            font-size: 1.4em;
            margin-bottom: 15px;
        }

        .resolution-box {
            background: rgba(46, 204, 113, 0.1);
            border: 1px solid #2ecc71;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .resolution-box h4 {
            color: #2ecc71;
            margin-bottom: 10px;
        }

        .payout-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .payout-table th, .payout-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .payout-table th {
            color: #f1c40f;
            background: rgba(0, 0, 0, 0.2);
        }

        .payout-table td.flips {
            color: #3498db;
        }

        .payout-table td.prob {
            color: #9b59b6;
        }

        .payout-table td.prize {
            color: #2ecc71;
        }

        .payout-table td.ev {
            color: #f1c40f;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }

        .speed-control label {
            color: #aaa;
        }

        input[type="range"] {
            width: 150px;
            height: 8px;
            -webkit-appearance: none;
            background: linear-gradient(90deg, #f1c40f, #e67e22);
            border-radius: 4px;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #fff;
            border-radius: 50%;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Paradoxes</a>

    <div class="container">
        <header>
            <h1>üé∞ The St. Petersburg Paradox</h1>
            <p class="subtitle">A Game Worth Infinite Money... That No One Would Play</p>
        </header>

        <div class="rules-box">
            <h2>üé≤ The Rules</h2>
            <p>
                Flip a fair coin until you get <strong style="color: #2ecc71;">HEADS</strong>.
                <br>If heads appears on flip <strong>n</strong>, you win <strong style="color: #f1c40f;">$2<sup>n</sup></strong>.
                <br><br>
                <span style="color: #aaa;">Flip 1: $2 | Flip 2: $4 | Flip 3: $8 | Flip 4: $16 | ...</span>
            </p>
        </div>

        <div class="main-grid">
            <div class="game-panel">
                <div class="coin-area">
                    <div class="flip-count">Flip #<span id="flipNum">0</span></div>
                    <div class="coin" id="coin">ü™ô</div>
                    <div class="current-prize">Prize: $<span id="currentPrize">0</span></div>
                    <div class="result-message" id="resultMsg"></div>
                </div>

                <div class="controls">
                    <button class="btn primary" id="flipBtn">ü™ô Flip Coin</button>
                    <button class="btn" id="autoBtn">‚ñ∂ Auto Play</button>
                    <button class="btn" id="resetBtn">‚Ü∫ Reset Stats</button>
                </div>

                <div class="speed-control">
                    <label>Speed:</label>
                    <input type="range" id="speedSlider" min="50" max="500" value="200">
                    <span id="speedValue">200ms</span>
                </div>
            </div>

            <div class="side-panel">
                <div class="panel">
                    <h3>üìä Your Statistics</h3>
                    <div class="stat-row">
                        <span class="stat-label">Games Played</span>
                        <span class="stat-value games" id="gamesPlayed">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Total Winnings</span>
                        <span class="stat-value money" id="totalWinnings">$0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Average Win</span>
                        <span class="stat-value money" id="avgWin">$0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Best Win</span>
                        <span class="stat-value money" id="bestWin">$0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Longest Run</span>
                        <span class="stat-value" id="longestRun">0 flips</span>
                    </div>

                    <div class="expected-display">
                        <div class="label">Theoretical Expected Value</div>
                        <div class="value">‚àû</div>
                    </div>
                </div>

                <div class="panel">
                    <h3>üìà Win Distribution</h3>
                    <div class="histogram" id="histogram"></div>
                    <div class="hist-labels" id="histLabels"></div>
                </div>
            </div>
        </div>

        <div class="explanation">
            <h2>ü§Ø Why Is This a Paradox?</h2>

            <p>
                The <span class="highlight-gold">expected value</span> of this game is the sum of
                (probability √ó prize) for each possible outcome:
            </p>

            <div class="math-box">
                <div class="math-row">
                    <span class="math-term"><span class="prob">¬Ω</span> √ó <span class="prize">$2</span> = <span class="result">$1</span></span>
                    <span class="math-term"><span class="prob">¬º</span> √ó <span class="prize">$4</span> = <span class="result">$1</span></span>
                    <span class="math-term"><span class="prob">‚Öõ</span> √ó <span class="prize">$8</span> = <span class="result">$1</span></span>
                    <span class="math-term"><span class="prob">1/16</span> √ó <span class="prize">$16</span> = <span class="result">$1</span></span>
                    <span style="font-size: 1.5em; color: #888;">...</span>
                </div>
                <div class="math-row" style="margin-top: 20px;">
                    <span style="color: #aaa;">E[X] =</span>
                    <span style="color: #f1c40f; font-size: 1.3em;">$1 + $1 + $1 + $1 + ... = </span>
                    <span style="color: #e74c3c; font-size: 2em; font-weight: bold;">‚àû</span>
                </div>
            </div>

            <p>
                Each term contributes <span class="highlight-gold">$1</span> to the expected value,
                and there are <span class="highlight">infinitely many terms</span>!
            </p>

            <div class="insight-box">
                <h3>üí∞ The Paradox</h3>
                <p style="font-size: 1.2em;">
                    If the expected value is <strong style="color: #e74c3c;">infinite</strong>,
                    a rational person should pay <em>any</em> finite amount to play.
                    <br><br>
                    But would YOU pay <strong>$1,000</strong> to play once?
                    <strong>$100</strong>? Most people wouldn't pay more than <strong>$10-20</strong>!
                </p>
            </div>

            <table class="payout-table">
                <thead>
                    <tr>
                        <th>Heads on Flip</th>
                        <th>Probability</th>
                        <th>Prize</th>
                        <th>EV Contribution</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td class="flips">1</td><td class="prob">50%</td><td class="prize">$2</td><td class="ev">$1.00</td></tr>
                    <tr><td class="flips">2</td><td class="prob">25%</td><td class="prize">$4</td><td class="ev">$1.00</td></tr>
                    <tr><td class="flips">3</td><td class="prob">12.5%</td><td class="prize">$8</td><td class="ev">$1.00</td></tr>
                    <tr><td class="flips">4</td><td class="prob">6.25%</td><td class="prize">$16</td><td class="ev">$1.00</td></tr>
                    <tr><td class="flips">5</td><td class="prob">3.125%</td><td class="prize">$32</td><td class="ev">$1.00</td></tr>
                    <tr><td class="flips">10</td><td class="prob">0.098%</td><td class="prize">$1,024</td><td class="ev">$1.00</td></tr>
                    <tr><td class="flips">20</td><td class="prob">0.0001%</td><td class="prize">$1,048,576</td><td class="ev">$1.00</td></tr>
                </tbody>
            </table>

            <div class="resolution-box">
                <h4>üéì Bernoulli's Resolution (1738): Utility Theory</h4>
                <p style="color: #ccc; line-height: 1.7;">
                    Daniel Bernoulli proposed that we don't value money linearly‚Äîwe value its <strong>utility</strong>.
                    The <span class="highlight-green">marginal utility</span> of money decreases as wealth increases:
                    winning $100 when you're broke means more than winning $100 when you're a billionaire.
                    <br><br>
                    With <strong>logarithmic utility</strong> (U = ln(wealth)), the expected utility becomes finite:
                    <br>
                    <code style="color: #2ecc71;">E[U] ‚âà ln(2) + ln(2)/2 + ln(2)/4 + ... = 2¬∑ln(2) ‚âà 1.39</code>
                    <br><br>
                    This explains why people won't pay infinite amounts‚Äîthey're maximizing
                    <em>expected utility</em>, not expected money!
                </p>
            </div>

            <p>
                The St. Petersburg Paradox, posed by <span class="highlight-gold">Nicolaus Bernoulli</span> in 1713
                and analyzed by his cousin <span class="highlight-gold">Daniel Bernoulli</span> in 1738,
                helped establish the foundations of modern <span class="highlight">decision theory</span>
                and <span class="highlight">behavioral economics</span>.
            </p>
        </div>
    </div>

    <script>
        // State
        let currentFlips = 0;
        let currentPrize = 0;
        let isPlaying = false;
        let gamesPlayed = 0;
        let totalWinnings = 0;
        let bestWin = 0;
        let longestRun = 0;
        let autoInterval = null;
        let winDistribution = {};

        const coin = document.getElementById('coin');
        const flipNum = document.getElementById('flipNum');
        const currentPrizeEl = document.getElementById('currentPrize');
        const resultMsg = document.getElementById('resultMsg');

        function updateStats() {
            document.getElementById('gamesPlayed').textContent = gamesPlayed;
            document.getElementById('totalWinnings').textContent = '$' + totalWinnings.toLocaleString();
            document.getElementById('avgWin').textContent = gamesPlayed > 0
                ? '$' + (totalWinnings / gamesPlayed).toFixed(2)
                : '$0';
            document.getElementById('bestWin').textContent = '$' + bestWin.toLocaleString();
            document.getElementById('longestRun').textContent = longestRun + ' flips';

            updateHistogram();
        }

        function updateHistogram() {
            const histogram = document.getElementById('histogram');
            const labels = document.getElementById('histLabels');
            histogram.innerHTML = '';
            labels.innerHTML = '';

            const maxFlips = Math.max(8, longestRun + 1);
            const counts = [];
            let maxCount = 0;

            for (let i = 1; i <= maxFlips; i++) {
                const count = winDistribution[i] || 0;
                counts.push(count);
                if (count > maxCount) maxCount = count;
            }

            for (let i = 0; i < counts.length; i++) {
                const bar = document.createElement('div');
                bar.className = 'hist-bar';
                const height = maxCount > 0 ? (counts[i] / maxCount) * 100 : 0;
                bar.style.height = height + '%';
                bar.dataset.label = `${i + 1} flips: ${counts[i]} times ($${Math.pow(2, i + 1)})`;
                histogram.appendChild(bar);

                const label = document.createElement('span');
                label.textContent = i + 1;
                labels.appendChild(label);
            }
        }

        function flipCoin() {
            if (isPlaying) return;

            isPlaying = true;
            currentFlips++;
            flipNum.textContent = currentFlips;

            coin.classList.add('flipping');

            setTimeout(() => {
                coin.classList.remove('flipping');

                // 50% chance of heads
                const isHeads = Math.random() < 0.5;

                if (isHeads) {
                    // Won!
                    currentPrize = Math.pow(2, currentFlips);
                    coin.textContent = 'üëë';
                    coin.classList.add('heads');
                    currentPrizeEl.textContent = currentPrize.toLocaleString();

                    // Update stats
                    gamesPlayed++;
                    totalWinnings += currentPrize;
                    if (currentPrize > bestWin) bestWin = currentPrize;
                    if (currentFlips > longestRun) longestRun = currentFlips;
                    winDistribution[currentFlips] = (winDistribution[currentFlips] || 0) + 1;

                    resultMsg.textContent = `üéâ HEADS! You won $${currentPrize.toLocaleString()} after ${currentFlips} flip${currentFlips > 1 ? 's' : ''}!`;
                    resultMsg.className = 'result-message show win';

                    updateStats();

                    // Reset for next game after delay
                    setTimeout(() => {
                        resetGame();
                        isPlaying = false;
                    }, 1000);
                } else {
                    // Tails - keep going
                    coin.textContent = 'ü™ô';
                    currentPrize = Math.pow(2, currentFlips + 1);
                    currentPrizeEl.textContent = currentPrize.toLocaleString();
                    resultMsg.className = 'result-message';
                    isPlaying = false;
                }
            }, 150);
        }

        function resetGame() {
            currentFlips = 0;
            currentPrize = 0;
            flipNum.textContent = '0';
            currentPrizeEl.textContent = '0';
            coin.textContent = 'ü™ô';
            coin.classList.remove('heads');
            resultMsg.className = 'result-message';
        }

        function resetStats() {
            stopAuto();
            resetGame();
            gamesPlayed = 0;
            totalWinnings = 0;
            bestWin = 0;
            longestRun = 0;
            winDistribution = {};
            updateStats();
        }

        function startAuto() {
            if (autoInterval) return;
            const speed = parseInt(document.getElementById('speedSlider').value);
            document.getElementById('autoBtn').textContent = '‚è∏ Stop';

            autoInterval = setInterval(() => {
                if (!isPlaying) {
                    flipCoin();
                }
            }, speed);
        }

        function stopAuto() {
            if (autoInterval) {
                clearInterval(autoInterval);
                autoInterval = null;
            }
            document.getElementById('autoBtn').textContent = '‚ñ∂ Auto Play';
        }

        function toggleAuto() {
            if (autoInterval) {
                stopAuto();
            } else {
                startAuto();
            }
        }

        // Event listeners
        document.getElementById('flipBtn').addEventListener('click', () => {
            if (!isPlaying && !autoInterval) {
                flipCoin();
            }
        });

        document.getElementById('autoBtn').addEventListener('click', toggleAuto);
        document.getElementById('resetBtn').addEventListener('click', resetStats);

        document.getElementById('speedSlider').addEventListener('input', (e) => {
            document.getElementById('speedValue').textContent = e.target.value + 'ms';
            if (autoInterval) {
                stopAuto();
                startAuto();
            }
        });

        // Initialize
        updateStats();
    </script>
</body>
</html>
