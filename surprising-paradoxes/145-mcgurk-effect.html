<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The McGurk Effect - Surprising Paradoxes</title>
    <style>
        :root {
            --sage: #8A9A5B;
            --moss: #606C38;
            --earth: #DDA15E;
            --cream: #FEFAE0;
            --terracotta: #BC6C25;
            --dark-moss: #3d4423;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--cream) 0%, #F4F1DE 50%, #EDE8D5 100%);
            min-height: 100vh;
            color: var(--dark-moss);
            line-height: 1.6;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            text-decoration: none;
            color: var(--moss);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 100;
            background: rgba(255,255,255,0.9);
            padding: 10px 16px;
            border-radius: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .back-link:hover {
            background: var(--moss);
            color: white;
            transform: translateX(-3px);
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 80px 20px 40px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
        }

        h1 {
            font-family: 'Lora', Georgia, serif;
            font-size: 2.8rem;
            color: var(--moss);
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2rem;
            color: var(--terracotta);
            font-style: italic;
        }

        .experiment-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .experiment-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .experiment-header h2 {
            font-family: 'Lora', Georgia, serif;
            color: var(--moss);
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        /* Mode Selector */
        .mode-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: 12px 24px;
            border: 2px solid var(--sage);
            border-radius: 25px;
            background: white;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mode-btn:hover {
            background: #f8fff8;
            border-color: var(--moss);
        }

        .mode-btn.active {
            background: var(--moss);
            border-color: var(--moss);
            color: white;
        }

        .demo-area {
            background: #1a1a2e;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            text-align: center;
        }

        /* Enhanced Face and Mouth Animation */
        .face-container {
            position: relative;
            width: 220px;
            height: 220px;
            margin: 0 auto 20px;
            background: linear-gradient(145deg, #3d3d5c, #2d2d44);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3), inset 0 -5px 15px rgba(0,0,0,0.2);
        }

        .face {
            position: relative;
            width: 180px;
            height: 200px;
        }

        .eyes {
            display: flex;
            justify-content: space-between;
            width: 110px;
            margin: 0 auto 25px;
            padding-top: 25px;
        }

        .eye {
            width: 35px;
            height: 35px;
            background: white;
            border-radius: 50%;
            position: relative;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
        }

        .pupil {
            width: 14px;
            height: 14px;
            background: #333;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.2s ease;
        }

        .pupil::after {
            content: '';
            position: absolute;
            width: 4px;
            height: 4px;
            background: white;
            border-radius: 50%;
            top: 2px;
            right: 2px;
        }

        .nose {
            width: 0;
            height: 0;
            border-left: 12px solid transparent;
            border-right: 12px solid transparent;
            border-bottom: 22px solid #e8b4a0;
            margin: 0 auto 25px;
        }

        /* Enhanced Mouth with Lip Animation */
        .mouth-wrapper {
            position: relative;
            width: 80px;
            height: 50px;
            margin: 0 auto;
        }

        .upper-lip {
            position: absolute;
            width: 70px;
            height: 12px;
            background: #b05050;
            border-radius: 35px 35px 0 0;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            transition: all 0.08s ease;
            z-index: 2;
        }

        .lower-lip {
            position: absolute;
            width: 65px;
            height: 10px;
            background: #c45555;
            border-radius: 0 0 32px 32px;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            transition: all 0.08s ease;
            z-index: 2;
        }

        .mouth-interior {
            position: absolute;
            width: 55px;
            height: 0;
            background: #4a1515;
            border-radius: 0 0 27px 27px;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            transition: all 0.08s ease;
            overflow: hidden;
        }

        .teeth {
            position: absolute;
            width: 45px;
            height: 8px;
            background: white;
            border-radius: 0 0 4px 4px;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
        }

        .tongue {
            position: absolute;
            width: 30px;
            height: 20px;
            background: #e06060;
            border-radius: 50%;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: all 0.08s ease;
        }

        /* Mouth States */
        .mouth-wrapper.closed .upper-lip { height: 8px; }
        .mouth-wrapper.closed .lower-lip { height: 8px; bottom: 20px; }
        .mouth-wrapper.closed .mouth-interior { height: 0; }

        .mouth-wrapper.ba .upper-lip { height: 6px; width: 60px; }
        .mouth-wrapper.ba .lower-lip { height: 6px; width: 55px; bottom: 22px; }
        .mouth-wrapper.ba .mouth-interior { height: 2px; }

        .mouth-wrapper.da .upper-lip { height: 10px; }
        .mouth-wrapper.da .lower-lip { height: 8px; bottom: 18px; }
        .mouth-wrapper.da .mouth-interior { height: 12px; }
        .mouth-wrapper.da .tongue { opacity: 1; bottom: -5px; }

        .mouth-wrapper.ga .upper-lip { height: 12px; }
        .mouth-wrapper.ga .lower-lip { height: 10px; bottom: 12px; }
        .mouth-wrapper.ga .mouth-interior { height: 22px; }
        .mouth-wrapper.ga .tongue { opacity: 1; bottom: 0; }

        .mouth-wrapper.pa .upper-lip { height: 5px; width: 58px; }
        .mouth-wrapper.pa .lower-lip { height: 5px; width: 53px; bottom: 23px; }
        .mouth-wrapper.pa .mouth-interior { height: 0; }

        .mouth-wrapper.ka .upper-lip { height: 14px; }
        .mouth-wrapper.ka .lower-lip { height: 12px; bottom: 10px; }
        .mouth-wrapper.ka .mouth-interior { height: 26px; }
        .mouth-wrapper.ka .tongue { opacity: 1; bottom: 2px; }

        .mouth-wrapper.ta .upper-lip { height: 11px; }
        .mouth-wrapper.ta .lower-lip { height: 9px; bottom: 16px; }
        .mouth-wrapper.ta .mouth-interior { height: 15px; }
        .mouth-wrapper.ta .tongue { opacity: 1; bottom: -3px; }

        .mouth-wrapper.va .upper-lip { height: 10px; }
        .mouth-wrapper.va .lower-lip { height: 4px; bottom: 20px; }
        .mouth-wrapper.va .mouth-interior { height: 8px; }

        .mouth-wrapper.fa .upper-lip { height: 10px; }
        .mouth-wrapper.fa .lower-lip { height: 3px; bottom: 21px; }
        .mouth-wrapper.fa .mouth-interior { height: 8px; }

        /* Syllable Display */
        .syllable-display {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .syllable-box {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 15px 20px;
            min-width: 110px;
            transition: all 0.3s ease;
        }

        .syllable-box.hidden-label {
            opacity: 0.3;
        }

        .syllable-box.hidden-label .value {
            filter: blur(8px);
        }

        .syllable-box label {
            display: block;
            color: #888;
            font-size: 0.75rem;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .syllable-box .value {
            font-size: 1.8rem;
            font-weight: 700;
            color: white;
            font-family: monospace;
            transition: filter 0.3s ease;
        }

        .audio-value { color: #60a5fa; }
        .visual-value { color: #f472b6; }
        .perceived-value { color: #4ade80; }

        /* Sync Controls */
        .sync-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .sync-label {
            color: #aaa;
            font-size: 0.85rem;
        }

        .sync-slider {
            width: 150px;
            accent-color: var(--sage);
        }

        .sync-value {
            color: #fff;
            font-family: monospace;
            min-width: 60px;
        }

        /* Play Controls */
        .play-controls {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .play-btn {
            padding: 14px 28px;
            border: none;
            border-radius: 30px;
            font-size: 0.95rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .play-btn.primary {
            background: linear-gradient(135deg, var(--moss), var(--dark-moss));
            color: white;
        }

        .play-btn.primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .play-btn.secondary {
            background: rgba(255,255,255,0.15);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
        }

        .play-btn.secondary:hover {
            background: rgba(255,255,255,0.25);
        }

        .play-btn.secondary.active {
            background: rgba(96, 165, 250, 0.3);
            border-color: #60a5fa;
        }

        .play-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Phoneme Selector */
        .phoneme-selector {
            margin-bottom: 25px;
        }

        .phoneme-selector h3 {
            color: #ccc;
            font-size: 0.9rem;
            margin-bottom: 15px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .phoneme-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            max-width: 500px;
            margin: 0 auto;
        }

        .phoneme-btn {
            padding: 12px 16px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            background: rgba(255,255,255,0.05);
            color: white;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .phoneme-btn:hover {
            border-color: var(--sage);
            background: rgba(138, 154, 91, 0.2);
        }

        .phoneme-btn.active {
            border-color: var(--sage);
            background: var(--sage);
        }

        .phoneme-btn .formula {
            font-family: monospace;
            font-size: 0.75rem;
            opacity: 0.7;
            display: block;
            margin-top: 4px;
        }

        /* A/B Comparison Mode */
        .ab-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .ab-panel {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .ab-panel.playing {
            border-color: var(--sage);
            background: rgba(138, 154, 91, 0.1);
        }

        .ab-panel h4 {
            color: #aaa;
            font-size: 0.85rem;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .ab-face {
            width: 120px;
            height: 120px;
            margin: 0 auto 15px;
            background: linear-gradient(145deg, #3d3d5c, #2d2d44);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ab-face.audio-only {
            opacity: 0.3;
        }

        .ab-face .mini-face {
            position: relative;
            width: 100px;
            height: 110px;
        }

        .ab-face .mini-eyes {
            display: flex;
            justify-content: space-between;
            width: 60px;
            margin: 0 auto 15px;
            padding-top: 15px;
        }

        .ab-face .mini-eye {
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
        }

        .ab-face .mini-mouth {
            width: 35px;
            height: 8px;
            background: #c44;
            border-radius: 4px;
            margin: 20px auto 0;
            transition: all 0.1s ease;
        }

        .ab-play-btn {
            padding: 10px 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 20px;
            background: transparent;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .ab-play-btn:hover {
            background: rgba(255,255,255,0.1);
        }

        /* Response Section */
        .response-section {
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
            border: 2px solid var(--sage);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .response-section h4 {
            color: var(--moss);
            margin-bottom: 15px;
            text-align: center;
        }

        .response-options {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .response-btn {
            padding: 12px 25px;
            border: 2px solid var(--sage);
            border-radius: 25px;
            background: white;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: monospace;
        }

        .response-btn:hover {
            background: var(--sage);
            color: white;
        }

        .response-btn.selected {
            background: var(--moss);
            border-color: var(--moss);
            color: white;
        }

        .response-btn.correct {
            background: #22c55e;
            border-color: #22c55e;
            color: white;
        }

        .response-btn.incorrect {
            background: #ef4444;
            border-color: #ef4444;
            color: white;
        }

        .result-message {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            font-weight: 600;
            display: none;
        }

        .result-message.visible {
            display: block;
        }

        .result-message.fusion {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            color: #92400e;
        }

        .result-message.correct-audio {
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            color: #1e40af;
        }

        /* Quiz Statistics */
        .quiz-stats {
            background: linear-gradient(135deg, #1e1b4b, #312e81);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .quiz-stats h4 {
            color: #a5b4fc;
            margin-bottom: 15px;
            text-align: center;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-item .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: white;
        }

        .stat-item .stat-label {
            font-size: 0.75rem;
            color: #a5b4fc;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-item.fusion .stat-value { color: #fbbf24; }
        .stat-item.audio .stat-value { color: #60a5fa; }
        .stat-item.other .stat-value { color: #f472b6; }

        .reset-stats-btn {
            display: block;
            margin: 15px auto 0;
            padding: 8px 20px;
            border: 1px solid #6366f1;
            border-radius: 20px;
            background: transparent;
            color: #a5b4fc;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .reset-stats-btn:hover {
            background: #6366f1;
            color: white;
        }

        /* Paradox Box */
        .paradox-box {
            background: linear-gradient(135deg, var(--moss) 0%, var(--dark-moss) 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .paradox-box h3 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .paradox-box p {
            opacity: 0.95;
            line-height: 1.7;
        }

        .section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
        }

        .section h2 {
            font-family: 'Lora', Georgia, serif;
            color: var(--moss);
            font-size: 1.6rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .fusion-diagram {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin: 25px 0;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 15px;
        }

        .fusion-item {
            text-align: center;
            padding: 15px;
        }

        .fusion-item .icon {
            font-size: 2.5rem;
            margin-bottom: 8px;
        }

        .fusion-item .syllable {
            font-size: 1.8rem;
            font-weight: 700;
            font-family: monospace;
            color: var(--moss);
        }

        .fusion-item .label {
            font-size: 0.8rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .fusion-plus {
            font-size: 2rem;
            color: var(--terracotta);
            font-weight: 700;
        }

        .fusion-equals {
            font-size: 2rem;
            color: var(--moss);
            font-weight: 700;
        }

        .examples-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .example-card {
            background: linear-gradient(135deg, #f8f9fa, #fff);
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .example-card:hover {
            border-color: var(--sage);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .example-card h4 {
            color: var(--terracotta);
            margin-bottom: 15px;
            font-size: 1rem;
        }

        .example-formula {
            font-family: monospace;
            font-size: 1.1rem;
            background: #e8e8e8;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .example-formula .audio { color: #2563eb; }
        .example-formula .visual { color: #db2777; }
        .example-formula .result { color: #16a34a; font-weight: 700; }

        .example-card p {
            font-size: 0.85rem;
            color: #666;
        }

        .susceptibility-section {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
        }

        .susceptibility-section h4 {
            color: #92400e;
            margin-bottom: 15px;
        }

        .susceptibility-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .susceptibility-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .susceptibility-item .group {
            font-weight: 600;
            color: var(--moss);
            margin-bottom: 5px;
        }

        .susceptibility-item .level {
            font-size: 0.85rem;
            color: #666;
        }

        .history-section {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .history-section h2 {
            color: var(--moss);
            margin-bottom: 15px;
        }

        .discovery-story {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 4px solid var(--terracotta);
        }

        .discovery-story h4 {
            color: var(--terracotta);
            margin-bottom: 10px;
        }

        .discovery-story p {
            color: #555;
            font-style: italic;
        }

        .timeline {
            position: relative;
            padding-left: 30px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--sage);
            border-radius: 3px;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 20px;
            padding-left: 20px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -26px;
            top: 5px;
            width: 14px;
            height: 14px;
            background: var(--terracotta);
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .timeline-year {
            font-weight: 700;
            color: var(--moss);
            font-size: 1.1rem;
        }

        .timeline-text {
            color: #555;
            margin-top: 5px;
        }

        .brain-section {
            background: linear-gradient(135deg, #fdf4ff, #fae8ff);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
        }

        .brain-section h4 {
            color: #86198f;
            margin-bottom: 15px;
        }

        .brain-section p {
            color: #581c87;
        }

        .quote-box {
            background: linear-gradient(135deg, var(--earth), #c9a658);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin-top: 30px;
            font-style: italic;
            font-size: 1.1rem;
        }

        .quote-box .attribution {
            margin-top: 15px;
            font-style: normal;
            font-weight: 700;
            opacity: 0.9;
        }

        .robustness-note {
            background: linear-gradient(135deg, #fee2e2, #fecaca);
            border: 2px solid #fca5a5;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .robustness-note h4 {
            color: #dc2626;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .robustness-note p {
            color: #7f1d1d;
        }

        @media (max-width: 768px) {
            h1 { font-size: 2rem; }
            .container { padding: 70px 15px 30px; }
            .face-container { width: 180px; height: 180px; }
            .syllable-box .value { font-size: 1.5rem; }
            .ab-comparison { grid-template-columns: 1fr; }
            .ab-face { width: 100px; height: 100px; }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600;700&family=Nunito:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <a href="index.html" class="back-link">Back to Paradoxes</a>

    <div class="container">
        <header>
            <h1>The McGurk Effect</h1>
            <p class="subtitle">When your eyes change what your ears hear</p>
        </header>

        <div class="experiment-container">
            <div class="experiment-header">
                <h2>Experience the Illusion</h2>
                <p>Watch the mouth and listen. What syllable do you hear?</p>
            </div>

            <!-- Mode Selector -->
            <div class="mode-selector">
                <button class="mode-btn active" data-mode="standard">Standard Demo</button>
                <button class="mode-btn" data-mode="ab">A/B Comparison</button>
                <button class="mode-btn" data-mode="quiz">Quiz Mode</button>
            </div>

            <!-- Standard Demo Mode -->
            <div id="standardMode">
                <!-- Phoneme Selector -->
                <div class="phoneme-selector">
                    <h3>Select Phoneme Combination</h3>
                    <div class="phoneme-grid">
                        <button class="phoneme-btn active" data-audio="ba" data-visual="ga" data-fusion="da">
                            Classic Fusion
                            <span class="formula">ba + ga = da</span>
                        </button>
                        <button class="phoneme-btn" data-audio="ba" data-visual="va" data-fusion="va">
                            Visual Override
                            <span class="formula">ba + va = va</span>
                        </button>
                        <button class="phoneme-btn" data-audio="ga" data-visual="ba" data-fusion="bga">
                            Combination
                            <span class="formula">ga + ba = bga</span>
                        </button>
                        <button class="phoneme-btn" data-audio="pa" data-visual="ka" data-fusion="ta">
                            Voiceless
                            <span class="formula">pa + ka = ta</span>
                        </button>
                        <button class="phoneme-btn" data-audio="ba" data-visual="fa" data-fusion="fa">
                            Fricative
                            <span class="formula">ba + fa = fa</span>
                        </button>
                    </div>
                </div>

                <div class="demo-area">
                    <div class="face-container">
                        <div class="face">
                            <div class="eyes">
                                <div class="eye"><div class="pupil"></div></div>
                                <div class="eye"><div class="pupil"></div></div>
                            </div>
                            <div class="nose"></div>
                            <div class="mouth-wrapper closed" id="mouth">
                                <div class="upper-lip"></div>
                                <div class="mouth-interior">
                                    <div class="teeth"></div>
                                    <div class="tongue"></div>
                                </div>
                                <div class="lower-lip"></div>
                            </div>
                        </div>
                    </div>

                    <div class="syllable-display" id="syllableDisplay">
                        <div class="syllable-box">
                            <label>Audio Playing</label>
                            <div class="value audio-value" id="audioDisplay">ba</div>
                        </div>
                        <div class="syllable-box">
                            <label>Lips Showing</label>
                            <div class="value visual-value" id="visualDisplay">ga</div>
                        </div>
                        <div class="syllable-box">
                            <label>Typical Perception</label>
                            <div class="value perceived-value" id="perceivedDisplay">da</div>
                        </div>
                    </div>

                    <!-- Sync Controls -->
                    <div class="sync-controls">
                        <span class="sync-label">Audio-Visual Sync:</span>
                        <input type="range" class="sync-slider" id="syncSlider" min="-200" max="200" value="0" step="10">
                        <span class="sync-value" id="syncValue">0ms</span>
                    </div>

                    <div class="play-controls">
                        <button class="play-btn primary" id="btnPlay">
                            <span>Play</span> With Video
                        </button>
                        <button class="play-btn secondary" id="btnAudioOnly">
                            Audio Only
                        </button>
                        <button class="play-btn secondary" id="btnToggleLabels">
                            Hide Labels
                        </button>
                    </div>
                </div>

                <div class="response-section">
                    <h4>What did you hear?</h4>
                    <div class="response-options" id="responseOptions">
                        <button class="response-btn" data-response="ba">ba</button>
                        <button class="response-btn" data-response="da">da</button>
                        <button class="response-btn" data-response="ga">ga</button>
                        <button class="response-btn" data-response="va">va</button>
                        <button class="response-btn" data-response="ta">ta</button>
                        <button class="response-btn" data-response="fa">fa</button>
                        <button class="response-btn" data-response="other">other</button>
                    </div>
                    <div class="result-message" id="resultMessage"></div>
                </div>
            </div>

            <!-- A/B Comparison Mode -->
            <div id="abMode" style="display: none;">
                <div class="phoneme-selector">
                    <h3>Select Phoneme Combination</h3>
                    <div class="phoneme-grid">
                        <button class="phoneme-btn ab-phoneme active" data-audio="ba" data-visual="ga" data-fusion="da">
                            Classic Fusion
                            <span class="formula">ba + ga = da</span>
                        </button>
                        <button class="phoneme-btn ab-phoneme" data-audio="ba" data-visual="va" data-fusion="va">
                            Visual Override
                            <span class="formula">ba + va = va</span>
                        </button>
                        <button class="phoneme-btn ab-phoneme" data-audio="pa" data-visual="ka" data-fusion="ta">
                            Voiceless
                            <span class="formula">pa + ka = ta</span>
                        </button>
                    </div>
                </div>

                <div class="demo-area">
                    <div class="ab-comparison">
                        <div class="ab-panel" id="abAudioOnly">
                            <h4>A: Audio Only</h4>
                            <div class="ab-face audio-only">
                                <div class="mini-face">
                                    <div class="mini-eyes">
                                        <div class="mini-eye"></div>
                                        <div class="mini-eye"></div>
                                    </div>
                                    <div class="mini-mouth"></div>
                                </div>
                            </div>
                            <p style="color: #888; font-size: 0.85rem; margin-bottom: 10px;">Close your eyes or look away</p>
                            <button class="ab-play-btn" id="btnPlayA">Play A</button>
                        </div>
                        <div class="ab-panel" id="abAudioVisual">
                            <h4>B: Audio + Visual</h4>
                            <div class="ab-face" id="abFaceB">
                                <div class="mini-face">
                                    <div class="mini-eyes">
                                        <div class="mini-eye"></div>
                                        <div class="mini-eye"></div>
                                    </div>
                                    <div class="mini-mouth" id="abMouthB"></div>
                                </div>
                            </div>
                            <p style="color: #888; font-size: 0.85rem; margin-bottom: 10px;">Watch the mouth closely</p>
                            <button class="ab-play-btn" id="btnPlayB">Play B</button>
                        </div>
                    </div>
                    <p style="color: #aaa; font-size: 0.9rem; text-align: center; margin-top: 10px;">
                        Compare what you hear in each condition. The audio is identical!
                    </p>
                </div>

                <div class="response-section">
                    <h4>What did you hear in each condition?</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <p style="text-align: center; color: var(--moss); font-weight: 600; margin-bottom: 10px;">Condition A (Audio Only)</p>
                            <div class="response-options" id="responseA">
                                <button class="response-btn ab-response" data-condition="a" data-response="ba">ba</button>
                                <button class="response-btn ab-response" data-condition="a" data-response="da">da</button>
                                <button class="response-btn ab-response" data-condition="a" data-response="ga">ga</button>
                            </div>
                        </div>
                        <div>
                            <p style="text-align: center; color: var(--moss); font-weight: 600; margin-bottom: 10px;">Condition B (Audio + Visual)</p>
                            <div class="response-options" id="responseB">
                                <button class="response-btn ab-response" data-condition="b" data-response="ba">ba</button>
                                <button class="response-btn ab-response" data-condition="b" data-response="da">da</button>
                                <button class="response-btn ab-response" data-condition="b" data-response="ga">ga</button>
                            </div>
                        </div>
                    </div>
                    <div class="result-message" id="abResultMessage"></div>
                </div>
            </div>

            <!-- Quiz Mode -->
            <div id="quizMode" style="display: none;">
                <div class="demo-area">
                    <p style="color: #aaa; margin-bottom: 20px;">Labels are hidden. Try to identify what you <em>actually</em> hear!</p>

                    <div class="face-container">
                        <div class="face">
                            <div class="eyes">
                                <div class="eye"><div class="pupil"></div></div>
                                <div class="eye"><div class="pupil"></div></div>
                            </div>
                            <div class="nose"></div>
                            <div class="mouth-wrapper closed" id="quizMouth">
                                <div class="upper-lip"></div>
                                <div class="mouth-interior">
                                    <div class="teeth"></div>
                                    <div class="tongue"></div>
                                </div>
                                <div class="lower-lip"></div>
                            </div>
                        </div>
                    </div>

                    <div class="play-controls" style="margin-top: 20px;">
                        <button class="play-btn primary" id="btnQuizPlay">
                            <span>Play</span> Random Trial
                        </button>
                        <button class="play-btn secondary" id="btnQuizAudioOnly">
                            Audio Only (Reveal)
                        </button>
                    </div>
                </div>

                <div class="response-section">
                    <h4>What did you perceive?</h4>
                    <div class="response-options" id="quizResponseOptions">
                        <button class="response-btn quiz-response" data-response="ba">ba</button>
                        <button class="response-btn quiz-response" data-response="da">da</button>
                        <button class="response-btn quiz-response" data-response="ga">ga</button>
                        <button class="response-btn quiz-response" data-response="va">va</button>
                        <button class="response-btn quiz-response" data-response="ta">ta</button>
                        <button class="response-btn quiz-response" data-response="fa">fa</button>
                        <button class="response-btn quiz-response" data-response="pa">pa</button>
                        <button class="response-btn quiz-response" data-response="ka">ka</button>
                    </div>
                    <div class="result-message" id="quizResultMessage"></div>
                </div>

                <div class="quiz-stats">
                    <h4>Your Perception Statistics</h4>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="statTrials">0</div>
                            <div class="stat-label">Trials</div>
                        </div>
                        <div class="stat-item fusion">
                            <div class="stat-value" id="statFusion">0%</div>
                            <div class="stat-label">Fusion Effect</div>
                        </div>
                        <div class="stat-item audio">
                            <div class="stat-value" id="statAudio">0%</div>
                            <div class="stat-label">Heard Audio</div>
                        </div>
                        <div class="stat-item other">
                            <div class="stat-value" id="statOther">0%</div>
                            <div class="stat-label">Other</div>
                        </div>
                    </div>
                    <button class="reset-stats-btn" id="resetStats">Reset Statistics</button>
                </div>
            </div>
        </div>

        <div class="paradox-box">
            <h3>The Paradox</h3>
            <p>
                The sound wave hitting your eardrums is objectively "ba" - but when you watch lips
                saying "ga," your brain <em>actually hears</em> "da"! This isn't a trick of attention
                or memory - your auditory cortex genuinely receives a different signal. Even
                <strong>knowing about the effect doesn't stop it</strong>. Researchers who have studied
                it for 20+ years still experience it every time.
            </p>
        </div>

        <div class="section">
            <h2>How It Works</h2>
            <p>The McGurk effect demonstrates <strong>multisensory integration</strong> - your brain
            automatically combines audio and visual information into a unified percept:</p>

            <div class="fusion-diagram">
                <div class="fusion-item">
                    <div class="icon">Sound</div>
                    <div class="syllable">ba</div>
                    <div class="label">Audio</div>
                </div>
                <span class="fusion-plus">+</span>
                <div class="fusion-item">
                    <div class="icon">Lips</div>
                    <div class="syllable">ga</div>
                    <div class="label">Visual</div>
                </div>
                <span class="fusion-equals">=</span>
                <div class="fusion-item">
                    <div class="icon">Brain</div>
                    <div class="syllable">da</div>
                    <div class="label">Perceived</div>
                </div>
            </div>

            <p style="margin-top: 15px; color: #555;">
                Your brain notices that "ba" (lips together) doesn't match what it sees (lips open for "ga").
                Rather than reporting a conflict, it <em>invents a compromise</em>: "da" - a sound made
                with the tongue touching the roof of the mouth, which visually could look like either!
            </p>

            <div class="examples-grid">
                <div class="example-card" data-audio="ba" data-visual="ga" data-fusion="da">
                    <h4>Fusion Effect</h4>
                    <div class="example-formula">
                        <span class="audio">ba</span> + <span class="visual">ga</span> = <span class="result">da</span>
                    </div>
                    <p>The brain creates a new syllable that's neither input</p>
                </div>
                <div class="example-card" data-audio="ga" data-visual="ba" data-fusion="bga">
                    <h4>Combination Effect</h4>
                    <div class="example-formula">
                        <span class="audio">ga</span> + <span class="visual">ba</span> = <span class="result">bga</span>
                    </div>
                    <p>Both sounds heard in sequence</p>
                </div>
                <div class="example-card" data-audio="ba" data-visual="va" data-fusion="va">
                    <h4>Visual Dominance</h4>
                    <div class="example-formula">
                        <span class="audio">ba</span> + <span class="visual">va</span> = <span class="result">va</span>
                    </div>
                    <p>Vision completely overrides audio</p>
                </div>
                <div class="example-card" data-audio="pa" data-visual="ka" data-fusion="ta">
                    <h4>Voiceless Version</h4>
                    <div class="example-formula">
                        <span class="audio">pa</span> + <span class="visual">ka</span> = <span class="result">ta</span>
                    </div>
                    <p>Works with unvoiced consonants too</p>
                </div>
            </div>
        </div>

        <div class="history-section">
            <h2>The Accidental Discovery</h2>

            <div class="discovery-story">
                <h4>"We were studying infant speech perception..."</h4>
                <p>
                    In 1976, Harry McGurk and John MacDonald were dubbing audio onto video of a speaker
                    for an unrelated infant study. When they played back a tape with mismatched audio and
                    video, they both heard something impossible - a syllable that wasn't on the audio track.
                    They thought the tape was broken. It wasn't. They had discovered a new window into
                    how the brain constructs reality.
                </p>
            </div>

            <div class="timeline">
                <div class="timeline-item">
                    <div class="timeline-year">1976</div>
                    <div class="timeline-text">McGurk & MacDonald publish "Hearing Lips and Seeing Voices" in Nature, introducing the effect to science.</div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-year">1980s</div>
                    <div class="timeline-text">Research reveals the effect is remarkably robust - it persists even when subjects know about it.</div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-year">1998</div>
                    <div class="timeline-text">fMRI studies identify the left posterior Superior Temporal Sulcus (pSTS) as the key integration region.</div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-year">2010s</div>
                    <div class="timeline-text">Cross-cultural studies show susceptibility varies by language - Japanese and Chinese speakers are less affected.</div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-year">2024</div>
                    <div class="timeline-text">TMS research demonstrates causal role of pSTS - temporarily disrupting it reduces the McGurk effect.</div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>Who Experiences It?</h2>
            <p>Not everyone is equally susceptible to the McGurk effect:</p>

            <div class="susceptibility-section">
                <h4>Susceptibility Varies By:</h4>
                <div class="susceptibility-grid">
                    <div class="susceptibility-item">
                        <div class="group">Women</div>
                        <div class="level">More susceptible</div>
                    </div>
                    <div class="susceptibility-item">
                        <div class="group">Men</div>
                        <div class="level">Less susceptible</div>
                    </div>
                    <div class="susceptibility-item">
                        <div class="group">Older Adults</div>
                        <div class="level">More susceptible</div>
                    </div>
                    <div class="susceptibility-item">
                        <div class="group">Children &lt;10</div>
                        <div class="level">Less susceptible</div>
                    </div>
                    <div class="susceptibility-item">
                        <div class="group">English Speakers</div>
                        <div class="level">Highly susceptible</div>
                    </div>
                    <div class="susceptibility-item">
                        <div class="group">Japanese/Chinese</div>
                        <div class="level">Less susceptible</div>
                    </div>
                </div>
            </div>

            <div class="brain-section">
                <h4>The Neuroscience</h4>
                <p>
                    The left posterior Superior Temporal Sulcus (pSTS) is where your brain merges
                    auditory and visual speech information. When researchers use Transcranial Magnetic
                    Stimulation to temporarily disrupt this region, the McGurk effect weakens - proving
                    it's truly a neural integration phenomenon, not just a cognitive quirk.
                </p>
            </div>
        </div>

        <div class="section">
            <h2>Why It Matters</h2>
            <ul style="margin: 15px 0 15px 25px; color: #555;">
                <li><strong>Speech recognition</strong> - Our brains use lip-reading more than we realize, especially in noisy environments.</li>
                <li><strong>Video conferencing</strong> - Audio-visual sync issues can impair comprehension due to McGurk-like effects.</li>
                <li><strong>Hearing aids</strong> - Understanding multisensory integration helps design better assistive devices.</li>
                <li><strong>Autism research</strong> - Some individuals with autism show reduced McGurk effects, offering insights into sensory processing differences.</li>
                <li><strong>Philosophy of perception</strong> - Demonstrates that "hearing" isn't purely auditory - perception is constructed.</li>
            </ul>

            <div class="robustness-note">
                <h4>It's Inescapable</h4>
                <p>
                    Unlike most optical illusions that break once you "see through" them, the McGurk effect
                    persists even when you know exactly what's happening. Researchers who have studied it
                    for decades still experience it. Your brain simply cannot ignore the visual information.
                </p>
            </div>
        </div>

        <div class="quote-box">
            "We hear with our eyes as well as our ears."
            <div class="attribution">- Harry McGurk & John MacDonald, 1976</div>
        </div>
    </div>

    <script>
        // State
        let currentTrial = { audio: 'ba', visual: 'ga', fusion: 'da' };
        let currentMode = 'standard';
        let labelsVisible = true;
        let isPlaying = false;
        let syncOffset = 0;

        // Quiz state
        let quizTrial = null;
        let quizStats = {
            trials: 0,
            fusion: 0,
            audio: 0,
            other: 0
        };

        // Trial options for quiz
        const trialOptions = [
            { audio: 'ba', visual: 'ga', fusion: 'da' },
            { audio: 'ba', visual: 'va', fusion: 'va' },
            { audio: 'ga', visual: 'ba', fusion: 'bga' },
            { audio: 'pa', visual: 'ka', fusion: 'ta' },
            { audio: 'ba', visual: 'fa', fusion: 'fa' }
        ];

        // Audio context for generating syllables
        let audioContext = null;

        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
        }

        // Enhanced syllable synthesis with better formants
        function playSyllable(syllable, duration = 350) {
            initAudio();

            const now = audioContext.currentTime;

            // Create nodes
            const osc1 = audioContext.createOscillator();
            const osc2 = audioContext.createOscillator();
            const noise = audioContext.createBufferSource();
            const noiseGain = audioContext.createGain();
            const oscGain = audioContext.createGain();
            const filter1 = audioContext.createBiquadFilter();
            const filter2 = audioContext.createBiquadFilter();
            const masterGain = audioContext.createGain();

            // Formant data for different syllables
            const formants = {
                'ba': { f1: 700, f2: 1100, f3: 2500, voiced: true, burst: 0.02, burstFreq: 500 },
                'da': { f1: 700, f2: 1800, f3: 2500, voiced: true, burst: 0.03, burstFreq: 1800 },
                'ga': { f1: 700, f2: 2300, f3: 3000, voiced: true, burst: 0.04, burstFreq: 2000 },
                'pa': { f1: 600, f2: 1100, f3: 2400, voiced: false, burst: 0.04, burstFreq: 500 },
                'ta': { f1: 600, f2: 1800, f3: 2400, voiced: false, burst: 0.05, burstFreq: 2000 },
                'ka': { f1: 600, f2: 2300, f3: 2800, voiced: false, burst: 0.06, burstFreq: 2500 },
                'va': { f1: 500, f2: 1500, f3: 2500, voiced: true, burst: 0.01, burstFreq: 800 },
                'fa': { f1: 500, f2: 1500, f3: 2500, voiced: false, burst: 0.02, burstFreq: 800 },
                'bga': { f1: 700, f2: 1700, f3: 2700, voiced: true, burst: 0.03, burstFreq: 1000 }
            };

            const f = formants[syllable] || formants['ba'];
            const durationSec = duration / 1000;

            // Generate noise buffer
            const noiseBuffer = audioContext.createBuffer(1, audioContext.sampleRate * durationSec, audioContext.sampleRate);
            const noiseData = noiseBuffer.getChannelData(0);
            for (let i = 0; i < noiseData.length; i++) {
                noiseData[i] = Math.random() * 2 - 1;
            }
            noise.buffer = noiseBuffer;

            // Configure oscillators
            osc1.type = 'sawtooth';
            osc1.frequency.setValueAtTime(f.voiced ? 120 : 0, now);
            osc1.frequency.linearRampToValueAtTime(f.voiced ? 100 : 0, now + durationSec);

            osc2.type = 'sawtooth';
            osc2.frequency.setValueAtTime(f.voiced ? 240 : 0, now);

            // Configure filters
            filter1.type = 'bandpass';
            filter1.frequency.setValueAtTime(f.f1, now);
            filter1.frequency.linearRampToValueAtTime(f.f2, now + durationSec * 0.3);
            filter1.Q.value = 8;

            filter2.type = 'bandpass';
            filter2.frequency.setValueAtTime(f.f2, now);
            filter2.frequency.linearRampToValueAtTime(f.f3, now + durationSec * 0.5);
            filter2.Q.value = 6;

            // Configure gains
            const attackTime = 0.02;
            const burstTime = f.burst;

            // Noise for burst
            noiseGain.gain.setValueAtTime(f.voiced ? 0.05 : 0.15, now);
            noiseGain.gain.linearRampToValueAtTime(0.02, now + burstTime);
            noiseGain.gain.linearRampToValueAtTime(0, now + durationSec);

            // Oscillator envelope
            oscGain.gain.setValueAtTime(0, now);
            oscGain.gain.linearRampToValueAtTime(f.voiced ? 0.25 : 0, now + attackTime);
            oscGain.gain.setValueAtTime(f.voiced ? 0.2 : 0, now + durationSec * 0.3);
            oscGain.gain.linearRampToValueAtTime(0, now + durationSec);

            // Master envelope
            masterGain.gain.setValueAtTime(0.7, now);
            masterGain.gain.linearRampToValueAtTime(0.5, now + durationSec * 0.5);
            masterGain.gain.linearRampToValueAtTime(0, now + durationSec);

            // Connect nodes
            osc1.connect(filter1);
            osc2.connect(filter1);
            filter1.connect(oscGain);
            oscGain.connect(masterGain);

            noise.connect(filter2);
            filter2.connect(noiseGain);
            noiseGain.connect(masterGain);

            masterGain.connect(audioContext.destination);

            // Start and stop
            osc1.start(now);
            osc2.start(now);
            noise.start(now);

            osc1.stop(now + durationSec);
            osc2.stop(now + durationSec);
            noise.stop(now + durationSec);
        }

        // Animate mouth with keyframes
        function animateMouth(syllable, mouthElement) {
            const mouth = mouthElement || document.getElementById('mouth');

            // Clear previous state
            mouth.className = 'mouth-wrapper closed';

            // Animation sequence
            setTimeout(() => {
                mouth.className = 'mouth-wrapper ' + syllable;
            }, 30);

            setTimeout(() => {
                mouth.className = 'mouth-wrapper closed';
            }, 280);
        }

        // Play full trial
        function playTrial(audioOnly = false, mouthElement = null) {
            if (isPlaying) return;
            isPlaying = true;

            const mouth = mouthElement || document.getElementById('mouth');

            // Clear previous responses
            document.querySelectorAll('.response-btn').forEach(btn => {
                btn.classList.remove('selected', 'correct', 'incorrect');
            });
            document.getElementById('resultMessage').classList.remove('visible');

            const audioDelay = syncOffset > 0 ? syncOffset : 0;
            const visualDelay = syncOffset < 0 ? Math.abs(syncOffset) : 0;

            // Play audio (possibly delayed)
            setTimeout(() => {
                playSyllable(currentTrial.audio);
            }, audioDelay);

            // Animate mouth (unless audio-only mode)
            if (!audioOnly) {
                setTimeout(() => {
                    animateMouth(currentTrial.visual, mouth);
                }, visualDelay);
            }

            setTimeout(() => {
                isPlaying = false;
            }, 400 + Math.max(audioDelay, visualDelay));
        }

        // Mode switching
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                currentMode = this.dataset.mode;

                document.getElementById('standardMode').style.display = currentMode === 'standard' ? 'block' : 'none';
                document.getElementById('abMode').style.display = currentMode === 'ab' ? 'block' : 'none';
                document.getElementById('quizMode').style.display = currentMode === 'quiz' ? 'block' : 'none';
            });
        });

        // Phoneme selection (standard mode)
        document.querySelectorAll('.phoneme-btn:not(.ab-phoneme)').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.phoneme-btn:not(.ab-phoneme)').forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                currentTrial = {
                    audio: this.dataset.audio,
                    visual: this.dataset.visual,
                    fusion: this.dataset.fusion
                };

                document.getElementById('audioDisplay').textContent = currentTrial.audio;
                document.getElementById('visualDisplay').textContent = currentTrial.visual;
                document.getElementById('perceivedDisplay').textContent = currentTrial.fusion;

                // Clear responses
                document.querySelectorAll('.response-btn').forEach(b => {
                    b.classList.remove('selected', 'correct', 'incorrect');
                });
                document.getElementById('resultMessage').classList.remove('visible');
            });
        });

        // A/B mode phoneme selection
        document.querySelectorAll('.ab-phoneme').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.ab-phoneme').forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                currentTrial = {
                    audio: this.dataset.audio,
                    visual: this.dataset.visual,
                    fusion: this.dataset.fusion
                };

                // Update A/B response buttons
                const responses = ['ba', 'da', 'ga', 'va', 'ta', 'fa', 'pa', 'ka'];
                const relevantResponses = [currentTrial.audio, currentTrial.fusion, currentTrial.visual].filter((v, i, a) => a.indexOf(v) === i);

                document.querySelectorAll('#responseA .response-btn, #responseB .response-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                document.getElementById('abResultMessage').classList.remove('visible');
            });
        });

        // Play buttons (standard mode)
        document.getElementById('btnPlay').addEventListener('click', () => playTrial(false));
        document.getElementById('btnAudioOnly').addEventListener('click', () => playTrial(true));

        // Toggle labels
        document.getElementById('btnToggleLabels').addEventListener('click', function() {
            labelsVisible = !labelsVisible;
            const boxes = document.querySelectorAll('#syllableDisplay .syllable-box');
            boxes.forEach(box => {
                box.classList.toggle('hidden-label', !labelsVisible);
            });
            this.textContent = labelsVisible ? 'Hide Labels' : 'Show Labels';
            this.classList.toggle('active', !labelsVisible);
        });

        // Sync slider
        document.getElementById('syncSlider').addEventListener('input', function() {
            syncOffset = parseInt(this.value);
            document.getElementById('syncValue').textContent = syncOffset + 'ms';
        });

        // Response buttons (standard mode)
        document.querySelectorAll('#responseOptions .response-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('#responseOptions .response-btn').forEach(b => {
                    b.classList.remove('selected', 'correct', 'incorrect');
                });

                const response = this.dataset.response;
                this.classList.add('selected');

                const resultMessage = document.getElementById('resultMessage');

                if (response === currentTrial.fusion) {
                    this.classList.add('correct');
                    resultMessage.className = 'result-message visible fusion';
                    resultMessage.innerHTML = `<strong>Classic McGurk Effect!</strong> You heard "${currentTrial.fusion}" even though the audio was "${currentTrial.audio}". Your brain fused the audio with the visual "${currentTrial.visual}" to create a perceptual compromise!`;
                } else if (response === currentTrial.audio) {
                    this.classList.add('correct');
                    resultMessage.className = 'result-message visible correct-audio';
                    resultMessage.innerHTML = `<strong>You heard the actual audio!</strong> Some people are less susceptible to the McGurk effect. Try the A/B comparison mode to clearly notice the difference vision makes.`;
                } else {
                    resultMessage.className = 'result-message visible fusion';
                    resultMessage.innerHTML = `Interesting! You perceived "${response}". The typical fusion response is "${currentTrial.fusion}", but perception varies between individuals. The audio was actually "${currentTrial.audio}".`;
                }
            });
        });

        // A/B Comparison Mode
        let abPhoneme = { audio: 'ba', visual: 'ga', fusion: 'da' };
        let abResponses = { a: null, b: null };

        document.getElementById('btnPlayA').addEventListener('click', function() {
            if (isPlaying) return;
            isPlaying = true;

            document.getElementById('abAudioOnly').classList.add('playing');

            playSyllable(currentTrial.audio);

            setTimeout(() => {
                document.getElementById('abAudioOnly').classList.remove('playing');
                isPlaying = false;
            }, 400);
        });

        document.getElementById('btnPlayB').addEventListener('click', function() {
            if (isPlaying) return;
            isPlaying = true;

            document.getElementById('abAudioVisual').classList.add('playing');

            playSyllable(currentTrial.audio);

            // Animate mini mouth
            const miniMouth = document.getElementById('abMouthB');
            miniMouth.style.height = '20px';
            miniMouth.style.borderRadius = '0 0 17px 17px';

            setTimeout(() => {
                miniMouth.style.height = '8px';
                miniMouth.style.borderRadius = '4px';
            }, 250);

            setTimeout(() => {
                document.getElementById('abAudioVisual').classList.remove('playing');
                isPlaying = false;
            }, 400);
        });

        // A/B response buttons
        document.querySelectorAll('.ab-response').forEach(btn => {
            btn.addEventListener('click', function() {
                const condition = this.dataset.condition;
                const response = this.dataset.response;

                // Clear other selections in same condition
                document.querySelectorAll(`.ab-response[data-condition="${condition}"]`).forEach(b => {
                    b.classList.remove('selected');
                });
                this.classList.add('selected');

                abResponses[condition] = response;

                // Check if both conditions have responses
                if (abResponses.a && abResponses.b) {
                    const resultMessage = document.getElementById('abResultMessage');

                    if (abResponses.a === currentTrial.audio && abResponses.b === currentTrial.fusion) {
                        resultMessage.className = 'result-message visible fusion';
                        resultMessage.innerHTML = `<strong>You demonstrated the McGurk Effect!</strong> With audio only, you correctly heard "${currentTrial.audio}". But when watching the lips say "${currentTrial.visual}", you perceived "${currentTrial.fusion}" instead. Same audio, different perception!`;
                    } else if (abResponses.a === abResponses.b) {
                        resultMessage.className = 'result-message visible correct-audio';
                        resultMessage.innerHTML = `You perceived the same sound in both conditions. You may be less susceptible to the McGurk effect, or try focusing more closely on the mouth movements in condition B.`;
                    } else {
                        resultMessage.className = 'result-message visible fusion';
                        resultMessage.innerHTML = `Interesting results! In audio-only you heard "${abResponses.a}", and with visual you heard "${abResponses.b}". The actual audio was "${currentTrial.audio}" in both cases.`;
                    }
                }
            });
        });

        // Quiz Mode
        function startQuizTrial() {
            if (isPlaying) return;

            // Pick random trial
            quizTrial = trialOptions[Math.floor(Math.random() * trialOptions.length)];

            // Clear responses
            document.querySelectorAll('.quiz-response').forEach(btn => {
                btn.classList.remove('selected', 'correct', 'incorrect');
            });
            document.getElementById('quizResultMessage').classList.remove('visible');

            // Play with visual
            isPlaying = true;

            playSyllable(quizTrial.audio);
            animateMouth(quizTrial.visual, document.getElementById('quizMouth'));

            setTimeout(() => {
                isPlaying = false;
            }, 400);
        }

        document.getElementById('btnQuizPlay').addEventListener('click', startQuizTrial);

        document.getElementById('btnQuizAudioOnly').addEventListener('click', function() {
            if (!quizTrial || isPlaying) return;
            isPlaying = true;

            playSyllable(quizTrial.audio);

            setTimeout(() => {
                isPlaying = false;
                // Show what the audio actually was
                const resultMessage = document.getElementById('quizResultMessage');
                resultMessage.className = 'result-message visible correct-audio';
                resultMessage.innerHTML = `The actual audio was "<strong>${quizTrial.audio}</strong>". The visual showed "${quizTrial.visual}", which typically creates the perception of "${quizTrial.fusion}".`;
            }, 400);
        });

        // Quiz response buttons
        document.querySelectorAll('.quiz-response').forEach(btn => {
            btn.addEventListener('click', function() {
                if (!quizTrial) return;

                document.querySelectorAll('.quiz-response').forEach(b => {
                    b.classList.remove('selected', 'correct', 'incorrect');
                });

                const response = this.dataset.response;
                this.classList.add('selected');

                // Update stats
                quizStats.trials++;

                if (response === quizTrial.fusion) {
                    quizStats.fusion++;
                    this.classList.add('correct');
                } else if (response === quizTrial.audio) {
                    quizStats.audio++;
                    this.classList.add('correct');
                } else {
                    quizStats.other++;
                }

                // Update display
                document.getElementById('statTrials').textContent = quizStats.trials;
                document.getElementById('statFusion').textContent = quizStats.trials > 0 ? Math.round(quizStats.fusion / quizStats.trials * 100) + '%' : '0%';
                document.getElementById('statAudio').textContent = quizStats.trials > 0 ? Math.round(quizStats.audio / quizStats.trials * 100) + '%' : '0%';
                document.getElementById('statOther').textContent = quizStats.trials > 0 ? Math.round(quizStats.other / quizStats.trials * 100) + '%' : '0%';

                // Show result
                const resultMessage = document.getElementById('quizResultMessage');
                if (response === quizTrial.fusion) {
                    resultMessage.className = 'result-message visible fusion';
                    resultMessage.innerHTML = `McGurk Effect! Audio was "${quizTrial.audio}", visual was "${quizTrial.visual}", you heard the fusion "${quizTrial.fusion}".`;
                } else if (response === quizTrial.audio) {
                    resultMessage.className = 'result-message visible correct-audio';
                    resultMessage.innerHTML = `You heard the actual audio "${quizTrial.audio}"! You resisted the visual influence of "${quizTrial.visual}".`;
                } else {
                    resultMessage.className = 'result-message visible fusion';
                    resultMessage.innerHTML = `You perceived "${response}". Audio was "${quizTrial.audio}", visual was "${quizTrial.visual}", typical fusion is "${quizTrial.fusion}".`;
                }
            });
        });

        // Reset stats
        document.getElementById('resetStats').addEventListener('click', function() {
            quizStats = { trials: 0, fusion: 0, audio: 0, other: 0 };
            document.getElementById('statTrials').textContent = '0';
            document.getElementById('statFusion').textContent = '0%';
            document.getElementById('statAudio').textContent = '0%';
            document.getElementById('statOther').textContent = '0%';
            document.getElementById('quizResultMessage').classList.remove('visible');
        });

        // Example cards - click to try that combination
        document.querySelectorAll('.example-card').forEach(card => {
            card.addEventListener('click', function() {
                const audio = this.dataset.audio;
                const visual = this.dataset.visual;
                const fusion = this.dataset.fusion;

                if (audio && visual && fusion) {
                    currentTrial = { audio, visual, fusion };

                    // Update standard mode
                    document.getElementById('audioDisplay').textContent = audio;
                    document.getElementById('visualDisplay').textContent = visual;
                    document.getElementById('perceivedDisplay').textContent = fusion;

                    // Update phoneme button selection
                    document.querySelectorAll('.phoneme-btn:not(.ab-phoneme)').forEach(btn => {
                        btn.classList.remove('active');
                        if (btn.dataset.audio === audio && btn.dataset.visual === visual) {
                            btn.classList.add('active');
                        }
                    });

                    // Switch to standard mode and play
                    document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                    document.querySelector('.mode-btn[data-mode="standard"]').classList.add('active');
                    document.getElementById('standardMode').style.display = 'block';
                    document.getElementById('abMode').style.display = 'none';
                    document.getElementById('quizMode').style.display = 'none';
                    currentMode = 'standard';

                    // Scroll to demo
                    document.querySelector('.experiment-container').scrollIntoView({ behavior: 'smooth' });

                    // Play after a brief delay
                    setTimeout(() => playTrial(false), 500);
                }
            });
        });
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
