<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Change Blindness - Surprising Paradoxes - CCAB</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600;700&family=Nunito:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --sage: #8A9A5B;
            --moss: #606C38;
            --earth: #DDA15E;
            --cream: #FEFAE0;
            --terracotta: #BC6C25;
            --dark-moss: #3d4423;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #FEFAE0 0%, #F4F1DE 50%, #EDE8D5 100%);
            min-height: 100vh;
            color: var(--dark-moss);
            line-height: 1.7;
        }
        .organic-shape {
            position: fixed;
            border-radius: 60% 40% 50% 50% / 50% 60% 40% 50%;
            opacity: 0.12;
            z-index: 0;
            animation: morph 30s ease-in-out infinite;
        }
        .shape-1 {
            width: 600px;
            height: 600px;
            background: linear-gradient(135deg, var(--sage), var(--moss));
            top: -200px;
            right: -150px;
        }
        .shape-2 {
            width: 500px;
            height: 500px;
            background: linear-gradient(135deg, var(--earth), var(--terracotta));
            bottom: -150px;
            left: -150px;
            animation-delay: -15s;
        }
        @keyframes morph {
            0%, 100% { border-radius: 60% 40% 50% 50% / 50% 60% 40% 50%; }
            25% { border-radius: 50% 60% 40% 50% / 40% 50% 60% 50%; }
            50% { border-radius: 40% 50% 60% 50% / 50% 40% 50% 60%; }
            75% { border-radius: 50% 40% 50% 60% / 60% 50% 40% 50%; }
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px 80px;
            position: relative;
            z-index: 1;
        }
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--moss);
            text-decoration: none;
            font-weight: 500;
            margin-bottom: 30px;
            padding: 10px 20px;
            background: rgba(255,255,255,0.6);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            transition: all 0.3s ease;
        }
        .back-link:hover {
            background: rgba(255,255,255,0.9);
            transform: translateX(-5px);
        }
        h1 {
            font-family: 'Lora', serif;
            font-size: 2.8rem;
            font-weight: 600;
            color: var(--moss);
            margin-bottom: 20px;
            line-height: 1.2;
        }
        .subtitle {
            font-size: 1.3rem;
            color: var(--terracotta);
            margin-bottom: 40px;
            font-weight: 500;
        }
        .badge {
            display: inline-block;
            background: linear-gradient(135deg, #5c6bc0, #3f51b5);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 25px;
        }
        .card {
            background: rgba(255,255,255,0.7);
            backdrop-filter: blur(15px);
            border-radius: 24px;
            padding: 35px;
            margin-bottom: 35px;
            border: 1px solid rgba(138,154,91,0.2);
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
        }
        .card h2 {
            font-family: 'Lora', serif;
            font-size: 1.6rem;
            color: var(--moss);
            margin-bottom: 20px;
        }
        .card p { color: #555; margin-bottom: 18px; }
        .card p:last-child { margin-bottom: 0; }
        .highlight {
            background: linear-gradient(120deg, rgba(92,107,192,0.2) 0%, rgba(92,107,192,0.1) 100%);
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 600;
            color: #3f51b5;
        }

        /* Simulation container */
        .simulation-container {
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 35px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);
        }
        .simulation-header {
            text-align: center;
            margin-bottom: 25px;
        }
        .simulation-title {
            color: #7986cb;
            font-family: 'Lora', serif;
            font-size: 1.4rem;
        }
        .simulation-subtitle {
            color: rgba(255,255,255,0.6);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        /* Scene canvas */
        .scene-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin: 0 auto 20px;
            aspect-ratio: 4/3;
            background: #2d3748;
            border-radius: 12px;
            overflow: hidden;
        }
        .scene-canvas {
            width: 100%;
            height: 100%;
        }
        .flicker-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #888;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.05s;
        }
        .flicker-overlay.active {
            opacity: 1;
        }

        /* Stats */
        .stats-row {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .stat-box {
            background: rgba(255,255,255,0.1);
            padding: 15px 25px;
            border-radius: 12px;
            text-align: center;
        }
        .stat-label {
            color: rgba(255,255,255,0.6);
            font-size: 0.75rem;
            text-transform: uppercase;
        }
        .stat-value {
            color: #7986cb;
            font-size: 1.5rem;
            font-weight: 700;
        }

        /* Challenge selector */
        .challenge-selector {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        .challenge-btn {
            padding: 10px 20px;
            border-radius: 20px;
            border: 2px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.05);
            color: white;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .challenge-btn:hover {
            border-color: #7986cb;
            background: rgba(121,134,203,0.2);
        }
        .challenge-btn.active {
            border-color: #7986cb;
            background: #7986cb;
            color: #1a1a2e;
        }
        .challenge-btn.completed {
            border-color: #4caf50;
        }
        .challenge-btn.completed::after {
            content: ' ‚úì';
            color: #4caf50;
        }

        /* Instructions */
        .instructions {
            background: rgba(255,255,255,0.08);
            border-radius: 12px;
            padding: 15px 20px;
            margin: 15px 0;
            text-align: center;
            color: rgba(255,255,255,0.8);
        }
        .instructions strong {
            color: #7986cb;
        }

        /* Result message */
        .result-message {
            text-align: center;
            padding: 15px;
            border-radius: 12px;
            margin: 15px 0;
            display: none;
        }
        .result-message.success {
            background: rgba(76,175,80,0.2);
            border: 2px solid #4caf50;
            color: #4caf50;
        }
        .result-message.hint {
            background: rgba(255,152,0,0.2);
            border: 2px solid #ff9800;
            color: #ff9800;
        }

        /* Controls */
        .controls {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 20px;
        }
        .btn {
            background: linear-gradient(135deg, #7986cb 0%, #5c6bc0 100%);
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 25px;
            font-family: 'Nunito', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(121,134,203,0.4);
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .btn-secondary {
            background: rgba(255,255,255,0.15);
        }
        .btn-hint {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
        }

        /* Insight box */
        .insight-box {
            background: linear-gradient(135deg, rgba(121,134,203,0.15) 0%, rgba(92,107,192,0.1) 100%);
            border: 2px solid #7986cb;
            border-radius: 16px;
            padding: 25px;
            margin: 25px 0;
        }
        .insight-box h3 {
            color: var(--moss);
            font-family: 'Lora', serif;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Quote */
        .quote {
            border-left: 4px solid var(--earth);
            padding-left: 25px;
            margin: 25px 0;
            font-style: italic;
            color: #666;
        }

        /* Famous examples */
        .examples-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .example-card {
            background: rgba(0,0,0,0.03);
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid var(--sage);
        }
        .example-card h4 {
            color: var(--moss);
            margin-bottom: 8px;
        }
        .example-card p {
            font-size: 0.9rem;
            margin-bottom: 0;
        }

        .footer {
            text-align: center;
            padding-top: 30px;
            color: #888;
            font-size: 0.85rem;
        }
        .footer a { color: var(--moss); }

        @media (max-width: 600px) {
            h1 { font-size: 2rem; }
            .card { padding: 25px; }
            .scene-container { aspect-ratio: 1/1; }
        }
    </style>
</head>
<body>
    <div class="organic-shape shape-1"></div>
    <div class="organic-shape shape-2"></div>

    <main class="container">
        <a href="index.html" class="back-link">‚Üê Back to Paradoxes</a>

        <span class="badge">Visual Perception</span>
        <h1>Change Blindness</h1>
        <p class="subtitle">Massive changes happen right before your eyes‚Äîand you <strong>completely miss them</strong>. Click on the scene below to find what changes between flickers. You'll be shocked at what you don't see!</p>

        <!-- The Setup -->
        <div class="card">
            <h2>The Invisible Obvious</h2>
            <p>In 1997, psychologist Ronald Rensink discovered something disturbing: when an image briefly flickers to gray and back, people fail to notice <strong>huge changes</strong>‚Äîeven after looking for minutes.</p>
            <p>A building disappears. A person's shirt changes color. An entire airplane engine vanishes. We see it all... and notice <em>nothing</em>.</p>
        </div>

        <!-- Interactive Simulation -->
        <div class="simulation-container">
            <div class="simulation-header">
                <h2 class="simulation-title">üëÅÔ∏è The Flicker Paradigm</h2>
                <p class="simulation-subtitle">Find what changes between flickers. Click on it when you spot it!</p>
            </div>

            <div class="challenge-selector" id="challengeSelector">
                <button class="challenge-btn active" data-level="1">Scene 1</button>
                <button class="challenge-btn" data-level="2">Scene 2</button>
                <button class="challenge-btn" data-level="3">Scene 3</button>
                <button class="challenge-btn" data-level="4">Scene 4</button>
            </div>

            <div class="scene-container" id="sceneContainer">
                <canvas class="scene-canvas" id="sceneCanvas"></canvas>
                <div class="flicker-overlay" id="flickerOverlay"></div>
            </div>

            <div class="stats-row">
                <div class="stat-box">
                    <div class="stat-label">Time</div>
                    <div class="stat-value" id="timeDisplay">0:00</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Flickers</div>
                    <div class="stat-value" id="flickerCount">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Found</div>
                    <div class="stat-value" id="foundCount">0/4</div>
                </div>
            </div>

            <div class="instructions" id="instructions">
                <strong>Watch carefully!</strong> The scene will flicker. Something changes. Click on it when you find it.
            </div>

            <div class="result-message" id="resultMessage"></div>

            <div class="controls">
                <button class="btn" id="startBtn">‚ñ∂ Start Challenge</button>
                <button class="btn btn-hint" id="hintBtn" style="display: none;">üí° Hint</button>
                <button class="btn btn-secondary" id="resetBtn">üîÑ Reset</button>
            </div>
        </div>

        <!-- Why It Happens -->
        <div class="card">
            <h2>Why We Miss the Obvious</h2>

            <div class="insight-box">
                <h3>üß† The Attention Bottleneck</h3>
                <p>Your visual system processes millions of bits per second, but consciousness can only handle about 40 bits. The brain must constantly filter what to "notice." Changes that occur during visual disruptions (flickers, blinks, saccades) bypass our change detection system.</p>
            </div>

            <p>The brief gray flash acts as a "<strong>mask</strong>" that disrupts the <em>motion signal</em> that would normally alert us to change. Without that motion cue, the brain treats each image as a fresh snapshot, never comparing them properly.</p>
        </div>

        <!-- Famous Examples -->
        <div class="card">
            <h2>Famous Demonstrations</h2>

            <div class="examples-grid">
                <div class="example-card">
                    <h4>üö™ The Door Study (1998)</h4>
                    <p>A researcher asks a stranger for directions. Workers carry a door between them, secretly swapping the researcher for a different person. <strong>47% of people continued the conversation without noticing!</strong></p>
                </div>
                <div class="example-card">
                    <h4>ü¶ç Invisible Gorilla (1999)</h4>
                    <p>Viewers counting basketball passes miss a person in a gorilla suit walking through the scene. Up to <strong>50% completely miss it</strong>‚Äîeven though it's on screen for 9 seconds.</p>
                </div>
                <div class="example-card">
                    <h4>üè• Radiologists & Gorillas</h4>
                    <p>Expert radiologists searching CT scans for lung nodules missed an image of a gorilla <strong>48 times larger</strong> than the nodules. 83% of experts failed to see it!</p>
                </div>
                <div class="example-card">
                    <h4>‚úàÔ∏è The Missing Engine</h4>
                    <p>In Rensink's classic demo, an entire jet engine disappears from an airplane photo. Viewers need <strong>10+ seconds on average</strong> to notice.</p>
                </div>
            </div>
        </div>

        <!-- Real-World Implications -->
        <div class="card">
            <h2>Dangerous Blindness</h2>
            <p>Change blindness has serious real-world consequences:</p>
            <ul style="margin-left: 25px; color: #555; margin-bottom: 20px;">
                <li><strong>Driving:</strong> Motorcycles "appear from nowhere" when drivers glance away</li>
                <li><strong>Surgery:</strong> Surgeons may miss tool movements during brief visual disruptions</li>
                <li><strong>Security:</strong> Guards miss ID photo mismatches at alarming rates</li>
                <li><strong>Eyewitness testimony:</strong> Witnesses confidently describe things that changed without their knowledge</li>
            </ul>

            <div class="quote">
                "We have a grand illusion of seeing the entire world in sharp detail. In reality, we sample tiny fragments and fill in the rest with assumptions."<br>
                ‚Äî Daniel Simons
            </div>
        </div>

        <!-- The Science -->
        <div class="card">
            <h2>2024 Research: Not Totally Blind?</h2>
            <p>Recent research from NYU and Johns Hopkins suggests we may have <em>some</em> unconscious awareness of unattended stimuli‚Äîeven when we report seeing nothing.</p>
            <p>When participants who claimed they "saw nothing" were forced to guess about an unexpected object's location, they performed <strong>above chance</strong>. This suggests a "sentinel system" that monitors the environment even when conscious attention is elsewhere.</p>
            <p>Fast-moving objects are more likely to break through inattentional blindness‚Äîevolution may have given us alarm systems for predators!</p>
        </div>

        <div class="footer">
            <p>Sources: <a href="https://en.wikipedia.org/wiki/Change_blindness" target="_blank">Wikipedia</a>,
            <a href="https://thedecisionlab.com/reference-guide/psychology/change-blindness" target="_blank">The Decision Lab</a>,
            <a href="https://pubmed.ncbi.nlm.nih.gov/10694957/" target="_blank">Simons & Chabris (1999)</a></p>
            <p style="margin-top: 10px;">Part of <a href="../index.html">CCAB</a> ¬∑ Surprising Paradoxes Collection</p>
        </div>
    </main>

    <script>
        // === CHANGE BLINDNESS SIMULATION ===
        const canvas = document.getElementById('sceneCanvas');
        const ctx = canvas.getContext('2d');
        const overlay = document.getElementById('flickerOverlay');

        // High DPI support
        function setupCanvas() {
            const container = document.getElementById('sceneContainer');
            const rect = container.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            canvas.style.width = rect.width + 'px';
            canvas.style.height = rect.height + 'px';
        }

        // Scene definitions
        const scenes = [
            {
                name: "City Scene",
                elements: [
                    { type: 'sky', color: '#87CEEB' },
                    { type: 'building', x: 50, y: 100, w: 80, h: 150, color: '#8B4513' },
                    { type: 'building', x: 150, y: 80, w: 100, h: 170, color: '#A0522D' },
                    { type: 'building', x: 270, y: 120, w: 70, h: 130, color: '#CD853F' },
                    { type: 'building', x: 360, y: 90, w: 90, h: 160, color: '#D2691E' },
                    { type: 'road', y: 250 },
                    { type: 'car', x: 100, y: 260, color: '#e53935' },
                    { type: 'car', x: 300, y: 265, color: '#1976d2' },
                    { type: 'tree', x: 470, y: 200 },
                    { type: 'sun', x: 500, y: 50 }
                ],
                change: { target: 'sun', property: 'visible', hint: 'Look at the sky...' }
            },
            {
                name: "Park Scene",
                elements: [
                    { type: 'sky', color: '#87CEEB' },
                    { type: 'grass' },
                    { type: 'tree', x: 80, y: 150 },
                    { type: 'tree', x: 200, y: 130 },
                    { type: 'tree', x: 400, y: 160 },
                    { type: 'bench', x: 250, y: 220 },
                    { type: 'person', x: 270, y: 180, color: '#e91e63' },
                    { type: 'bird', x: 350, y: 80 },
                    { type: 'bird', x: 380, y: 100 },
                    { type: 'cloud', x: 100, y: 40 },
                    { type: 'cloud', x: 300, y: 60 }
                ],
                change: { target: 'person', property: 'color', newColor: '#4caf50', hint: 'Someone changed their outfit...' }
            },
            {
                name: "Room Scene",
                elements: [
                    { type: 'wall', color: '#f5f5dc' },
                    { type: 'floor', color: '#8B4513' },
                    { type: 'window', x: 80, y: 50 },
                    { type: 'painting', x: 250, y: 60 },
                    { type: 'couch', x: 150, y: 180 },
                    { type: 'lamp', x: 400, y: 120 },
                    { type: 'table', x: 350, y: 200 },
                    { type: 'plant', x: 50, y: 180 },
                    { type: 'clock', x: 450, y: 50 }
                ],
                change: { target: 'painting', property: 'visible', hint: 'Check the wall decorations...' }
            },
            {
                name: "Beach Scene",
                elements: [
                    { type: 'sky', color: '#87CEEB' },
                    { type: 'ocean' },
                    { type: 'sand' },
                    { type: 'umbrella', x: 150, y: 180, color: '#e53935' },
                    { type: 'umbrella', x: 350, y: 170, color: '#1976d2' },
                    { type: 'towel', x: 140, y: 220 },
                    { type: 'ball', x: 280, y: 230, color: '#ffeb3b' },
                    { type: 'sun', x: 480, y: 50 },
                    { type: 'boat', x: 400, y: 100 },
                    { type: 'bird', x: 100, y: 60 }
                ],
                change: { target: 'boat', property: 'visible', hint: 'Something on the water...' }
            }
        ];

        let currentLevel = 0;
        let showAlternate = false;
        let flickerInterval = null;
        let timerInterval = null;
        let startTime = 0;
        let flickerCount = 0;
        let foundCount = 0;
        let isRunning = false;
        let completed = [false, false, false, false];

        // Draw functions
        function drawScene(alternate = false) {
            const w = canvas.width / (window.devicePixelRatio || 1);
            const h = canvas.height / (window.devicePixelRatio || 1);

            const scene = scenes[currentLevel];
            ctx.clearRect(0, 0, w, h);

            scene.elements.forEach(el => {
                let visible = true;
                let color = el.color;

                // Apply change if showing alternate
                if (alternate && scene.change.target === el.type) {
                    if (scene.change.property === 'visible') {
                        visible = false;
                    } else if (scene.change.property === 'color') {
                        color = scene.change.newColor;
                    }
                }

                if (!visible) return;

                switch (el.type) {
                    case 'sky':
                        ctx.fillStyle = el.color;
                        ctx.fillRect(0, 0, w, h * 0.6);
                        break;
                    case 'grass':
                        ctx.fillStyle = '#228B22';
                        ctx.fillRect(0, h * 0.6, w, h * 0.4);
                        break;
                    case 'ocean':
                        ctx.fillStyle = '#1e88e5';
                        ctx.fillRect(0, h * 0.4, w, h * 0.25);
                        break;
                    case 'sand':
                        ctx.fillStyle = '#f4d03f';
                        ctx.fillRect(0, h * 0.65, w, h * 0.35);
                        break;
                    case 'wall':
                        ctx.fillStyle = el.color;
                        ctx.fillRect(0, 0, w, h * 0.7);
                        break;
                    case 'floor':
                        ctx.fillStyle = el.color;
                        ctx.fillRect(0, h * 0.7, w, h * 0.3);
                        break;
                    case 'road':
                        ctx.fillStyle = '#444';
                        ctx.fillRect(0, el.y, w, 50);
                        ctx.strokeStyle = '#fff';
                        ctx.setLineDash([20, 15]);
                        ctx.beginPath();
                        ctx.moveTo(0, el.y + 25);
                        ctx.lineTo(w, el.y + 25);
                        ctx.stroke();
                        ctx.setLineDash([]);
                        break;
                    case 'building':
                        ctx.fillStyle = el.color;
                        ctx.fillRect(el.x, el.y, el.w, el.h);
                        // Windows
                        ctx.fillStyle = '#fff9c4';
                        for (let wy = el.y + 15; wy < el.y + el.h - 20; wy += 30) {
                            for (let wx = el.x + 10; wx < el.x + el.w - 15; wx += 25) {
                                ctx.fillRect(wx, wy, 15, 20);
                            }
                        }
                        break;
                    case 'car':
                        ctx.fillStyle = color;
                        ctx.fillRect(el.x, el.y, 50, 20);
                        ctx.fillRect(el.x + 10, el.y - 15, 30, 15);
                        ctx.fillStyle = '#333';
                        ctx.beginPath();
                        ctx.arc(el.x + 12, el.y + 20, 8, 0, Math.PI * 2);
                        ctx.arc(el.x + 38, el.y + 20, 8, 0, Math.PI * 2);
                        ctx.fill();
                        break;
                    case 'tree':
                        ctx.fillStyle = '#5D4037';
                        ctx.fillRect(el.x, el.y, 15, 50);
                        ctx.fillStyle = '#2E7D32';
                        ctx.beginPath();
                        ctx.arc(el.x + 7, el.y - 20, 35, 0, Math.PI * 2);
                        ctx.fill();
                        break;
                    case 'sun':
                        ctx.fillStyle = '#FFD700';
                        ctx.beginPath();
                        ctx.arc(el.x, el.y, 30, 0, Math.PI * 2);
                        ctx.fill();
                        break;
                    case 'person':
                        ctx.fillStyle = '#ffcc80';
                        ctx.beginPath();
                        ctx.arc(el.x, el.y - 25, 12, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.fillStyle = color;
                        ctx.fillRect(el.x - 10, el.y - 10, 20, 35);
                        ctx.fillStyle = '#5D4037';
                        ctx.fillRect(el.x - 5, el.y + 25, 5, 20);
                        ctx.fillRect(el.x, el.y + 25, 5, 20);
                        break;
                    case 'bench':
                        ctx.fillStyle = '#8D6E63';
                        ctx.fillRect(el.x, el.y, 80, 8);
                        ctx.fillRect(el.x, el.y + 15, 80, 8);
                        ctx.fillRect(el.x + 5, el.y + 8, 5, 20);
                        ctx.fillRect(el.x + 70, el.y + 8, 5, 20);
                        break;
                    case 'bird':
                        ctx.strokeStyle = '#333';
                        ctx.lineWidth = 2;
                        ctx.beginPath();
                        ctx.moveTo(el.x - 10, el.y);
                        ctx.quadraticCurveTo(el.x, el.y - 8, el.x + 10, el.y);
                        ctx.stroke();
                        break;
                    case 'cloud':
                        ctx.fillStyle = '#fff';
                        ctx.beginPath();
                        ctx.arc(el.x, el.y, 20, 0, Math.PI * 2);
                        ctx.arc(el.x + 25, el.y - 5, 25, 0, Math.PI * 2);
                        ctx.arc(el.x + 50, el.y, 20, 0, Math.PI * 2);
                        ctx.fill();
                        break;
                    case 'umbrella':
                        ctx.fillStyle = color;
                        ctx.beginPath();
                        ctx.arc(el.x, el.y, 40, Math.PI, 0);
                        ctx.fill();
                        ctx.fillStyle = '#5D4037';
                        ctx.fillRect(el.x - 3, el.y, 6, 60);
                        break;
                    case 'towel':
                        ctx.fillStyle = '#e91e63';
                        ctx.fillRect(el.x, el.y, 60, 30);
                        break;
                    case 'ball':
                        ctx.fillStyle = color;
                        ctx.beginPath();
                        ctx.arc(el.x, el.y, 15, 0, Math.PI * 2);
                        ctx.fill();
                        break;
                    case 'boat':
                        ctx.fillStyle = '#8D6E63';
                        ctx.beginPath();
                        ctx.moveTo(el.x, el.y + 20);
                        ctx.lineTo(el.x + 10, el.y + 35);
                        ctx.lineTo(el.x + 50, el.y + 35);
                        ctx.lineTo(el.x + 60, el.y + 20);
                        ctx.closePath();
                        ctx.fill();
                        ctx.fillStyle = '#fff';
                        ctx.beginPath();
                        ctx.moveTo(el.x + 30, el.y + 15);
                        ctx.lineTo(el.x + 30, el.y - 20);
                        ctx.lineTo(el.x + 55, el.y + 10);
                        ctx.closePath();
                        ctx.fill();
                        break;
                    case 'window':
                        ctx.fillStyle = '#87CEEB';
                        ctx.fillRect(el.x, el.y, 80, 60);
                        ctx.strokeStyle = '#fff';
                        ctx.lineWidth = 5;
                        ctx.strokeRect(el.x, el.y, 80, 60);
                        ctx.beginPath();
                        ctx.moveTo(el.x + 40, el.y);
                        ctx.lineTo(el.x + 40, el.y + 60);
                        ctx.moveTo(el.x, el.y + 30);
                        ctx.lineTo(el.x + 80, el.y + 30);
                        ctx.stroke();
                        break;
                    case 'painting':
                        ctx.fillStyle = '#8B4513';
                        ctx.fillRect(el.x - 5, el.y - 5, 90, 70);
                        ctx.fillStyle = '#87CEEB';
                        ctx.fillRect(el.x, el.y, 80, 60);
                        ctx.fillStyle = '#228B22';
                        ctx.fillRect(el.x, el.y + 40, 80, 20);
                        ctx.fillStyle = '#FFD700';
                        ctx.beginPath();
                        ctx.arc(el.x + 60, el.y + 20, 12, 0, Math.PI * 2);
                        ctx.fill();
                        break;
                    case 'couch':
                        ctx.fillStyle = '#7B1FA2';
                        ctx.fillRect(el.x, el.y, 150, 50);
                        ctx.fillRect(el.x, el.y - 30, 20, 30);
                        ctx.fillRect(el.x + 130, el.y - 30, 20, 30);
                        ctx.fillRect(el.x + 20, el.y - 20, 110, 20);
                        break;
                    case 'lamp':
                        ctx.fillStyle = '#FFD700';
                        ctx.beginPath();
                        ctx.moveTo(el.x - 20, el.y);
                        ctx.lineTo(el.x + 20, el.y);
                        ctx.lineTo(el.x + 10, el.y - 30);
                        ctx.lineTo(el.x - 10, el.y - 30);
                        ctx.closePath();
                        ctx.fill();
                        ctx.fillStyle = '#333';
                        ctx.fillRect(el.x - 3, el.y, 6, 80);
                        ctx.fillRect(el.x - 15, el.y + 80, 30, 5);
                        break;
                    case 'table':
                        ctx.fillStyle = '#5D4037';
                        ctx.fillRect(el.x, el.y, 80, 8);
                        ctx.fillRect(el.x + 5, el.y + 8, 8, 40);
                        ctx.fillRect(el.x + 67, el.y + 8, 8, 40);
                        break;
                    case 'plant':
                        ctx.fillStyle = '#5D4037';
                        ctx.fillRect(el.x, el.y + 30, 30, 40);
                        ctx.fillStyle = '#2E7D32';
                        ctx.beginPath();
                        ctx.ellipse(el.x + 15, el.y + 10, 25, 35, 0, 0, Math.PI * 2);
                        ctx.fill();
                        break;
                    case 'clock':
                        ctx.fillStyle = '#fff';
                        ctx.beginPath();
                        ctx.arc(el.x, el.y, 20, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.strokeStyle = '#333';
                        ctx.lineWidth = 2;
                        ctx.stroke();
                        ctx.beginPath();
                        ctx.moveTo(el.x, el.y);
                        ctx.lineTo(el.x, el.y - 12);
                        ctx.moveTo(el.x, el.y);
                        ctx.lineTo(el.x + 8, el.y + 5);
                        ctx.stroke();
                        break;
                }
            });
        }

        // Flicker animation
        function doFlicker() {
            overlay.classList.add('active');
            flickerCount++;
            document.getElementById('flickerCount').textContent = flickerCount;

            setTimeout(() => {
                showAlternate = !showAlternate;
                drawScene(showAlternate);
                overlay.classList.remove('active');
            }, 80);
        }

        // Start challenge
        function startChallenge() {
            if (isRunning) return;
            isRunning = true;
            flickerCount = 0;
            startTime = Date.now();
            showAlternate = false;

            document.getElementById('startBtn').disabled = true;
            document.getElementById('hintBtn').style.display = 'inline-block';
            document.getElementById('resultMessage').style.display = 'none';

            drawScene(false);
            flickerInterval = setInterval(doFlicker, 600);
            timerInterval = setInterval(updateTimer, 100);
        }

        // Update timer
        function updateTimer() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const mins = Math.floor(elapsed / 60);
            const secs = elapsed % 60;
            document.getElementById('timeDisplay').textContent =
                `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Stop challenge
        function stopChallenge(success = false) {
            isRunning = false;
            clearInterval(flickerInterval);
            clearInterval(timerInterval);

            document.getElementById('startBtn').disabled = false;
            document.getElementById('hintBtn').style.display = 'none';

            if (success) {
                completed[currentLevel] = true;
                foundCount = completed.filter(Boolean).length;
                document.getElementById('foundCount').textContent = `${foundCount}/4`;

                const msg = document.getElementById('resultMessage');
                msg.className = 'result-message success';
                msg.textContent = `‚úì Found it! The ${scenes[currentLevel].change.target} changed.`;
                msg.style.display = 'block';

                updateChallengeButtons();
            }
        }

        // Show hint
        function showHint() {
            const msg = document.getElementById('resultMessage');
            msg.className = 'result-message hint';
            msg.textContent = `üí° Hint: ${scenes[currentLevel].change.hint}`;
            msg.style.display = 'block';
        }

        // Reset
        function resetAll() {
            stopChallenge();
            flickerCount = 0;
            document.getElementById('flickerCount').textContent = '0';
            document.getElementById('timeDisplay').textContent = '0:00';
            document.getElementById('resultMessage').style.display = 'none';
            showAlternate = false;
            drawScene(false);
        }

        // Switch level
        function switchLevel(level) {
            currentLevel = level;
            resetAll();
            updateChallengeButtons();
        }

        // Update buttons
        function updateChallengeButtons() {
            document.querySelectorAll('.challenge-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i === currentLevel);
                btn.classList.toggle('completed', completed[i]);
            });
        }

        // Canvas click handler
        canvas.addEventListener('click', (e) => {
            if (!isRunning) return;

            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            // Check if click is near the changing element
            const scene = scenes[currentLevel];
            const change = scene.change;
            const target = scene.elements.find(el => el.type === change.target);

            if (target) {
                let targetX = target.x || 250;
                let targetY = target.y || 150;
                const dist = Math.sqrt((x - targetX) ** 2 + (y - targetY) ** 2);

                if (dist < 60) {
                    stopChallenge(true);
                }
            }
        });

        // Event listeners
        document.getElementById('startBtn').addEventListener('click', startChallenge);
        document.getElementById('hintBtn').addEventListener('click', showHint);
        document.getElementById('resetBtn').addEventListener('click', resetAll);

        document.querySelectorAll('.challenge-btn').forEach((btn, i) => {
            btn.addEventListener('click', () => switchLevel(i));
        });

        // Initialize
        window.addEventListener('resize', () => {
            setupCanvas();
            drawScene(showAlternate);
        });

        setupCanvas();
        drawScene(false);
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
