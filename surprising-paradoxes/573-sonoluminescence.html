<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sonoluminescence: Star in a Jar | Surprising Paradoxes</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3a 50%, #0a1a2a 100%);
            color: #e0e0e0;
            min-height: 100vh;
            overflow-x: hidden;
        }
        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #88ccff;
            text-decoration: none;
            font-size: 1rem;
            z-index: 100;
            padding: 8px 16px;
            background: rgba(0,0,0,0.5);
            border-radius: 20px;
            transition: all 0.3s ease;
        }
        .back-link:hover {
            background: rgba(136, 204, 255, 0.2);
            transform: translateX(-3px);
        }
        header {
            text-align: center;
            padding: 80px 20px 30px;
        }
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #00ccff, #88ffff, #ffffff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .subtitle {
            color: #88aacc;
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        .demo-section {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
            margin-bottom: 40px;
        }
        @media (max-width: 900px) {
            .demo-section {
                grid-template-columns: 1fr;
            }
        }
        .canvas-container {
            background: linear-gradient(145deg, #0a0a15, #151525);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        canvas {
            display: block;
            width: 100%;
            border-radius: 10px;
        }
        .controls {
            background: linear-gradient(145deg, #151525, #1a1a35);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        .control-group {
            margin-bottom: 20px;
        }
        .control-group label {
            display: block;
            margin-bottom: 8px;
            color: #88ccff;
            font-size: 0.9rem;
        }
        .control-group input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #2a2a4a;
            outline: none;
            -webkit-appearance: none;
        }
        .control-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00ccff, #0088cc);
            cursor: pointer;
        }
        .value-display {
            text-align: right;
            font-size: 0.85rem;
            color: #aaa;
            margin-top: 5px;
        }
        .stats {
            background: rgba(0, 150, 200, 0.1);
            border: 1px solid rgba(0, 200, 255, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .stats h3 {
            color: #00ccff;
            font-size: 0.95rem;
            margin-bottom: 12px;
            border-bottom: 1px solid rgba(0, 200, 255, 0.2);
            padding-bottom: 8px;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.85rem;
        }
        .stat-label { color: #88aacc; }
        .stat-value {
            color: #fff;
            font-family: 'Consolas', monospace;
        }
        .stat-value.hot { color: #ff6644; }
        .stat-value.bright { color: #ffff44; }
        .phase-indicator {
            text-align: center;
            padding: 12px;
            background: rgba(0, 100, 150, 0.2);
            border-radius: 8px;
            font-size: 0.95rem;
            margin-bottom: 15px;
        }
        .phase-indicator .phase {
            font-weight: bold;
            font-size: 1.1rem;
        }
        .phase-indicator .expansion { color: #44ff88; }
        .phase-indicator .compression { color: #ff8844; }
        .phase-indicator .collapse { color: #ffffff; text-shadow: 0 0 10px #fff; }
        .phase-indicator .flash { color: #ffff00; text-shadow: 0 0 15px #ffff00, 0 0 30px #ff8800; }
        button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, #0088cc, #006699);
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }
        button:hover {
            background: linear-gradient(135deg, #00aaee, #0088cc);
            transform: translateY(-2px);
        }
        button.active {
            background: linear-gradient(135deg, #00cc88, #009966);
        }
        .essay {
            background: linear-gradient(145deg, #0d0d1a, #151528);
            border-radius: 15px;
            padding: 40px;
            line-height: 1.8;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        .essay h2 {
            color: #00ccff;
            margin: 30px 0 15px;
            font-size: 1.5rem;
        }
        .essay h2:first-child { margin-top: 0; }
        .essay p {
            margin-bottom: 15px;
            color: #c0c0d0;
        }
        .essay strong { color: #88ddff; }
        .essay em { color: #ffcc88; font-style: italic; }
        .highlight-box {
            background: rgba(0, 200, 255, 0.1);
            border-left: 4px solid #00ccff;
            padding: 20px;
            margin: 25px 0;
            border-radius: 0 10px 10px 0;
        }
        .highlight-box.paradox {
            background: rgba(255, 200, 0, 0.1);
            border-left-color: #ffcc00;
        }
        .formula {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin: 20px 0;
            font-family: 'Times New Roman', serif;
            font-size: 1.3rem;
            color: #88ddff;
        }
        .sources {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #333;
        }
        .sources h3 {
            color: #88aacc;
            margin-bottom: 15px;
        }
        .sources ul {
            list-style: none;
        }
        .sources li {
            margin-bottom: 10px;
        }
        .sources a {
            color: #66aadd;
            text-decoration: none;
        }
        .sources a:hover {
            color: #88ccff;
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Paradoxes</a>

    <header>
        <h1>Sonoluminescence: Star in a Jar</h1>
        <p class="subtitle">Sound waves create temperatures hotter than the Sun's surface in collapsing bubbles</p>
    </header>

    <div class="container">
        <div class="demo-section">
            <div class="canvas-container">
                <canvas id="canvas"></canvas>
            </div>
            <div class="controls">
                <div class="phase-indicator">
                    <div>Phase: <span class="phase" id="phaseLabel">Expansion</span></div>
                </div>

                <div class="stats">
                    <h3>Bubble State</h3>
                    <div class="stat-row">
                        <span class="stat-label">Radius</span>
                        <span class="stat-value" id="radiusValue">50 Œºm</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Temperature</span>
                        <span class="stat-value" id="tempValue">300 K</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Pressure</span>
                        <span class="stat-value" id="pressureValue">1 atm</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Light Output</span>
                        <span class="stat-value bright" id="lightValue">0 MW</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Collapse #</span>
                        <span class="stat-value" id="collapseCount">0</span>
                    </div>
                </div>

                <div class="control-group">
                    <label>Sound Frequency (kHz)</label>
                    <input type="range" id="frequency" min="20" max="40" value="25" step="1">
                    <div class="value-display" id="freqDisplay">25 kHz</div>
                </div>

                <div class="control-group">
                    <label>Sound Amplitude</label>
                    <input type="range" id="amplitude" min="0.5" max="1.5" value="1" step="0.1">
                    <div class="value-display" id="ampDisplay">1.0 atm</div>
                </div>

                <div class="control-group">
                    <label>Time Scale</label>
                    <input type="range" id="timeScale" min="0.2" max="2" value="1" step="0.1">
                    <div class="value-display" id="timeDisplay">1.0√ó</div>
                </div>

                <button id="toggleBtn" class="active">‚è∏ Pause</button>
                <button id="showWaveBtn">üåä Toggle Sound Wave</button>
            </div>
        </div>

        <div class="essay">
            <h2>The Paradox: Sound Creates Light</h2>
            <p>
                <strong>Sonoluminescence</strong> represents one of physics' most surprising phenomena:
                <em>sound waves in water can create flashes of light</em> with temperatures exceeding
                20,000 Kelvin‚Äîhotter than the surface of the Sun (5,778 K). First discovered accidentally
                in 1934, this "star in a jar" effect continues to puzzle physicists today.
            </p>

            <div class="highlight-box paradox">
                <strong>The Counterintuitive Reality:</strong> A humble sound wave, carrying mere acoustic
                energy, focuses that energy into a collapsing bubble with such intensity that it creates
                conditions found only in stellar interiors‚Äîa trillion-fold concentration of energy in
                less than a microsecond.
            </div>

            <h2>The Mechanism: Bubble Collapse</h2>
            <p>
                When an ultrasonic standing wave (typically 20-40 kHz) passes through water, a tiny gas
                bubble trapped at the pressure antinode undergoes violent oscillation. During the
                rarefaction (low pressure) phase, the bubble expands to roughly 10√ó its equilibrium
                size‚Äîfrom about 5 micrometers to 50 micrometers.
            </p>
            <p>
                Then comes the compression phase. The bubble collapses with extraordinary speed,
                shrinking from maximum size to minimum in less than a microsecond. The collapsing
                wall can reach speeds of <strong>4√ó the speed of sound</strong> in water. At the
                moment of minimum radius, the gas is compressed to extreme densities.
            </p>

            <div class="formula">
                T ‚âà T‚ÇÄ √ó (R<sub>max</sub>/R<sub>min</sub>)<sup>3(Œ≥-1)</sup> ‚âà 10,000 - 20,000 K
            </div>

            <h2>The Flash: Picosecond Lightning</h2>
            <p>
                At maximum compression, the superheated gas becomes <em>plasma</em>‚Äîelectrons are
                stripped from atoms. This plasma emits light through <strong>bremsstrahlung radiation</strong>
                (German for "braking radiation")‚Äîfree electrons decelerating as they interact with
                ions release photons.
            </p>
            <p>
                The light pulse is astonishingly brief: only 35-300 picoseconds (trillionths of a second).
                Yet despite this brevity, peak intensities reach 1-10 megawatts. The bubble then
                rebounds and the cycle repeats with clockwork precision‚Äîup to 25,000 times per second,
                locked in phase with the driving sound wave.
            </p>

            <div class="highlight-box">
                <strong>Energy Focusing:</strong> The initial acoustic energy density of ~0.1 J/m¬≥
                becomes concentrated to ~10¬π¬π J/m¬≥ at the collapse‚Äîa trillionfold increase achieved
                by geometry alone as the sphere contracts.
            </div>

            <h2>Discovery and History</h2>
            <p>
                In 1934, Hermann Frenzel and H. Schultes at the University of Cologne discovered
                sonoluminescence accidentally while working with sonar transducers. They noticed
                unexplained dots on photographic film when ultrasound passed through developer fluid.
            </p>
            <p>
                The phenomenon remained a curiosity until 1990, when D. Felipe Gaitan achieved
                <strong>single-bubble sonoluminescence (SBSL)</strong>‚Äîtrapping a single bubble
                in a stable acoustic levitation field. This breakthrough enabled systematic study
                and revealed just how extreme the conditions inside could be.
            </p>

            <h2>Unsolved Mysteries</h2>
            <p>
                Despite decades of research, sonoluminescence retains mysteries. Over 13 different
                theories have been proposed for the emission mechanism. Most physicists favor
                thermal bremsstrahlung, but exotic hypotheses persist:
            </p>
            <p>
                Physicist <strong>Claudia Eberlein</strong> suggested the light might arise from
                the <em>dynamical Casimir effect</em>‚Äîthe bubble's rapidly moving wall converting
                virtual vacuum photons into real ones, similar to Hawking radiation from black holes.
                While not the mainstream view, this connects sonoluminescence to some of physics'
                deepest questions about the quantum vacuum.
            </p>

            <h2>Nature's Version</h2>
            <p>
                Sonoluminescence isn't purely artificial. The <strong>mantis shrimp</strong>
                generates sonoluminescence with its incredibly powerful strike‚Äîits claws
                accelerate so fast they create cavitation bubbles that collapse with a flash
                of light, briefly reaching temperatures of 4,400¬∞C. The shrimp's prey is
                hit twice: once by the claw, and once by the shockwave from the collapsing bubble.
            </p>

            <div class="sources">
                <h3>Sources & Further Reading</h3>
                <ul>
                    <li><a href="https://en.wikipedia.org/wiki/Sonoluminescence">Wikipedia: Sonoluminescence</a></li>
                    <li><a href="https://en.wikipedia.org/wiki/Mechanism_of_sonoluminescence">Wikipedia: Mechanism of Sonoluminescence</a></li>
                    <li><a href="https://www.nature.com/articles/18842">Nature: A simple explanation of light emission in sonoluminescence</a></li>
                    <li><a href="https://journals.aps.org/rmp/abstract/10.1103/RevModPhys.74.425">Rev. Mod. Phys.: Single-bubble sonoluminescence</a></li>
                    <li><a href="https://www.physics.ucla.edu/Sonoluminescence/sono2.pdf">UCLA: Star in a Jar - Physics of Sonoluminescence</a></li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // High DPI setup
        const dpr = window.devicePixelRatio || 1;
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width * dpr;
        canvas.height = rect.width * 0.75 * dpr;
        canvas.style.height = rect.width * 0.75 + 'px';
        ctx.scale(dpr, dpr);

        const width = rect.width;
        const height = rect.width * 0.75;
        const centerX = width / 2;
        const centerY = height / 2;

        // Simulation state
        let time = 0;
        let running = true;
        let showWave = true;
        let collapseCount = 0;
        let flashIntensity = 0;

        // Parameters
        let frequency = 25; // kHz
        let amplitude = 1.0;
        let timeScale = 1.0;

        // Bubble physics
        const R_equilibrium = 5; // Œºm (display scaled)
        const R_max_factor = 10;
        const R_min_factor = 0.1;

        // Controls
        const freqSlider = document.getElementById('frequency');
        const ampSlider = document.getElementById('amplitude');
        const timeSlider = document.getElementById('timeScale');
        const toggleBtn = document.getElementById('toggleBtn');
        const showWaveBtn = document.getElementById('showWaveBtn');

        freqSlider.addEventListener('input', e => {
            frequency = parseFloat(e.target.value);
            document.getElementById('freqDisplay').textContent = frequency + ' kHz';
        });

        ampSlider.addEventListener('input', e => {
            amplitude = parseFloat(e.target.value);
            document.getElementById('ampDisplay').textContent = amplitude.toFixed(1) + ' atm';
        });

        timeSlider.addEventListener('input', e => {
            timeScale = parseFloat(e.target.value);
            document.getElementById('timeDisplay').textContent = timeScale.toFixed(1) + '√ó';
        });

        toggleBtn.addEventListener('click', () => {
            running = !running;
            toggleBtn.textContent = running ? '‚è∏ Pause' : '‚ñ∂ Play';
            toggleBtn.classList.toggle('active', running);
        });

        showWaveBtn.addEventListener('click', () => {
            showWave = !showWave;
        });

        // Calculate bubble radius based on phase
        function getBubbleState(t) {
            const period = 1 / frequency; // in ms
            const phase = (t % period) / period; // 0 to 1

            // Asymmetric oscillation - slow expansion, fast collapse
            let radius, temp, pressure, light;
            let phaseName;

            if (phase < 0.7) {
                // Expansion phase (70% of cycle)
                const expandPhase = phase / 0.7;
                const eased = Math.sin(expandPhase * Math.PI / 2);
                radius = R_equilibrium * (1 + (R_max_factor - 1) * amplitude * eased);
                temp = 300;
                pressure = 1;
                light = 0;
                phaseName = 'expansion';
            } else if (phase < 0.98) {
                // Compression phase (28% of cycle)
                const compressPhase = (phase - 0.7) / 0.28;
                const eased = Math.pow(compressPhase, 2);
                radius = R_equilibrium * R_max_factor * amplitude * (1 - eased * 0.99);
                temp = 300 + 5000 * eased;
                pressure = 1 + 1000 * eased;
                light = 0;
                phaseName = 'compression';
            } else {
                // Flash/collapse phase (2% of cycle)
                const flashPhase = (phase - 0.98) / 0.02;
                radius = R_equilibrium * R_min_factor;
                temp = 20000 * amplitude;
                pressure = 10000 * amplitude;
                light = 10 * amplitude * (1 - flashPhase);
                phaseName = flashPhase < 0.5 ? 'collapse' : 'flash';

                if (flashPhase < 0.1 && flashIntensity < 0.5) {
                    collapseCount++;
                }
            }

            return { radius, temp, pressure, light, phaseName };
        }

        // Draw sound wave field
        function drawSoundWave(t) {
            if (!showWave) return;

            const wavelength = width / 3;

            ctx.save();
            for (let y = 0; y < height; y += 8) {
                for (let x = 0; x < width; x += 8) {
                    const dx = x - centerX;
                    const dy = y - centerY;
                    const dist = Math.sqrt(dx * dx + dy * dy);

                    // Standing wave pattern
                    const standing = Math.cos(dist / wavelength * Math.PI * 2);
                    const temporal = Math.sin(t * frequency * 2 * Math.PI / 1000);
                    const pressure = standing * temporal * amplitude;

                    // Color based on pressure (blue = low, red = high)
                    const alpha = Math.abs(pressure) * 0.15;
                    if (pressure > 0) {
                        ctx.fillStyle = `rgba(255, 100, 50, ${alpha})`;
                    } else {
                        ctx.fillStyle = `rgba(50, 150, 255, ${alpha})`;
                    }
                    ctx.fillRect(x - 4, y - 4, 8, 8);
                }
            }
            ctx.restore();
        }

        // Draw the water container (jar)
        function drawJar() {
            ctx.save();

            // Jar outline
            ctx.strokeStyle = 'rgba(100, 200, 255, 0.3)';
            ctx.lineWidth = 3;

            const jarWidth = width * 0.6;
            const jarHeight = height * 0.7;
            const jarX = (width - jarWidth) / 2;
            const jarY = (height - jarHeight) / 2;

            // Draw jar shape
            ctx.beginPath();
            ctx.roundRect(jarX, jarY, jarWidth, jarHeight, 20);
            ctx.stroke();

            // Water fill
            ctx.fillStyle = 'rgba(30, 80, 120, 0.3)';
            ctx.fill();

            // Jar label
            ctx.fillStyle = 'rgba(150, 200, 255, 0.5)';
            ctx.font = '12px Segoe UI';
            ctx.textAlign = 'center';
            ctx.fillText('Ultrasonic Vessel', centerX, jarY + jarHeight + 20);

            ctx.restore();
        }

        // Draw the bubble
        function drawBubble(state) {
            const displayRadius = state.radius * 3; // Scale for visibility

            ctx.save();

            // Bubble glow during flash
            if (state.light > 0) {
                flashIntensity = state.light;
                const glowRadius = displayRadius + state.light * 50;
                const gradient = ctx.createRadialGradient(
                    centerX, centerY, 0,
                    centerX, centerY, glowRadius
                );
                gradient.addColorStop(0, `rgba(255, 255, 255, ${state.light})`);
                gradient.addColorStop(0.2, `rgba(255, 255, 200, ${state.light * 0.8})`);
                gradient.addColorStop(0.5, `rgba(100, 200, 255, ${state.light * 0.4})`);
                gradient.addColorStop(1, 'rgba(0, 100, 200, 0)');

                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(centerX, centerY, glowRadius, 0, Math.PI * 2);
                ctx.fill();
            } else {
                flashIntensity *= 0.9;
            }

            // Bubble body
            const bubbleGradient = ctx.createRadialGradient(
                centerX - displayRadius * 0.3, centerY - displayRadius * 0.3, 0,
                centerX, centerY, displayRadius
            );

            // Color based on temperature
            if (state.temp > 10000) {
                bubbleGradient.addColorStop(0, '#ffffff');
                bubbleGradient.addColorStop(0.3, '#ffffaa');
                bubbleGradient.addColorStop(0.7, '#ffaa44');
                bubbleGradient.addColorStop(1, '#ff4400');
            } else if (state.temp > 2000) {
                const t = (state.temp - 300) / 5000;
                bubbleGradient.addColorStop(0, `rgba(255, ${255 - t * 100}, ${200 - t * 150}, 0.9)`);
                bubbleGradient.addColorStop(1, `rgba(200, ${100 - t * 50}, ${100 - t * 80}, 0.7)`);
            } else {
                bubbleGradient.addColorStop(0, 'rgba(150, 220, 255, 0.8)');
                bubbleGradient.addColorStop(0.5, 'rgba(100, 180, 230, 0.6)');
                bubbleGradient.addColorStop(1, 'rgba(50, 120, 180, 0.4)');
            }

            ctx.fillStyle = bubbleGradient;
            ctx.beginPath();
            ctx.arc(centerX, centerY, Math.max(displayRadius, 2), 0, Math.PI * 2);
            ctx.fill();

            // Bubble highlight
            ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
            ctx.beginPath();
            ctx.arc(
                centerX - displayRadius * 0.3,
                centerY - displayRadius * 0.3,
                displayRadius * 0.2,
                0, Math.PI * 2
            );
            ctx.fill();

            // Bubble outline
            ctx.strokeStyle = 'rgba(200, 240, 255, 0.5)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.arc(centerX, centerY, displayRadius, 0, Math.PI * 2);
            ctx.stroke();

            ctx.restore();
        }

        // Draw transducers
        function drawTransducers() {
            ctx.save();

            // Top transducer
            ctx.fillStyle = '#445566';
            ctx.fillRect(centerX - 40, 20, 80, 20);
            ctx.fillStyle = '#667788';
            ctx.fillRect(centerX - 35, 25, 70, 10);

            // Bottom transducer
            ctx.fillStyle = '#445566';
            ctx.fillRect(centerX - 40, height - 40, 80, 20);
            ctx.fillStyle = '#667788';
            ctx.fillRect(centerX - 35, height - 35, 70, 10);

            // Labels
            ctx.fillStyle = 'rgba(150, 180, 200, 0.7)';
            ctx.font = '10px Segoe UI';
            ctx.textAlign = 'center';
            ctx.fillText('Ultrasonic Transducer', centerX, 15);
            ctx.fillText('Ultrasonic Transducer', centerX, height - 5);

            ctx.restore();
        }

        // Update stats display
        function updateStats(state) {
            const phaseLabel = document.getElementById('phaseLabel');
            phaseLabel.textContent = state.phaseName.charAt(0).toUpperCase() + state.phaseName.slice(1);
            phaseLabel.className = 'phase ' + state.phaseName;

            document.getElementById('radiusValue').textContent =
                (state.radius).toFixed(1) + ' Œºm';

            const tempEl = document.getElementById('tempValue');
            tempEl.textContent = state.temp > 1000
                ? (state.temp / 1000).toFixed(1) + 'k K'
                : state.temp.toFixed(0) + ' K';
            tempEl.className = state.temp > 5000 ? 'stat-value hot' : 'stat-value';

            document.getElementById('pressureValue').textContent =
                state.pressure > 100
                    ? (state.pressure / 1000).toFixed(1) + 'k atm'
                    : state.pressure.toFixed(0) + ' atm';

            const lightEl = document.getElementById('lightValue');
            lightEl.textContent = state.light.toFixed(1) + ' MW';
            lightEl.style.textShadow = state.light > 0
                ? `0 0 ${state.light * 5}px #ffff00`
                : 'none';

            document.getElementById('collapseCount').textContent = collapseCount;
        }

        // Main animation loop
        function animate() {
            // Clear with dark background
            ctx.fillStyle = '#0a0a1a';
            ctx.fillRect(0, 0, width, height);

            // Get bubble state
            const state = getBubbleState(time);

            // Draw elements
            drawSoundWave(time);
            drawJar();
            drawTransducers();
            drawBubble(state);

            // Screen flash effect
            if (flashIntensity > 0.3) {
                ctx.fillStyle = `rgba(255, 255, 255, ${flashIntensity * 0.3})`;
                ctx.fillRect(0, 0, width, height);
            }

            // Update stats
            updateStats(state);

            // Advance time
            if (running) {
                time += 16 * timeScale; // ~60fps
            }

            requestAnimationFrame(animate);
        }

        // Handle resize
        window.addEventListener('resize', () => {
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.width * 0.75 * dpr;
            canvas.style.height = rect.width * 0.75 + 'px';
            ctx.scale(dpr, dpr);
        });

        animate();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
