<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>687 - St. Petersburg Paradox | Surprising Paradoxes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e8e8e8;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 25px;
        }

        h1 {
            font-size: 2.4rem;
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1rem;
            color: #a0a0a0;
            max-width: 800px;
            margin: 0 auto;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #ffd700;
            text-decoration: none;
            font-size: 1rem;
            opacity: 0.8;
            transition: opacity 0.3s;
            z-index: 100;
        }

        .back-link:hover {
            opacity: 1;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        @media (max-width: 1100px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 20px;
        }

        .panel-title {
            font-size: 1.2rem;
            color: #ffd700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .game-area {
            background: linear-gradient(135deg, #1a472a 0%, #0d2818 100%);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            border: 3px solid #2d5a3d;
            position: relative;
        }

        .coin-container {
            margin: 20px auto;
            perspective: 1000px;
        }

        .coin {
            width: 100px;
            height: 100px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.1s;
        }

        .coin.flipping {
            animation: coinFlip 0.5s ease-out;
        }

        @keyframes coinFlip {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(720deg); }
        }

        .coin-face {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: bold;
            backface-visibility: hidden;
        }

        .coin-heads {
            background: linear-gradient(135deg, #ffd700, #ffaa00);
            color: #8b6914;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.2), 0 5px 15px rgba(0,0,0,0.3);
        }

        .coin-tails {
            background: linear-gradient(135deg, #c0c0c0, #808080);
            color: #404040;
            transform: rotateY(180deg);
            box-shadow: inset 0 0 20px rgba(0,0,0,0.2), 0 5px 15px rgba(0,0,0,0.3);
        }

        .prize-display {
            font-size: 3rem;
            font-weight: 700;
            color: #ffd700;
            margin: 20px 0;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .flip-count {
            font-size: 1.2rem;
            color: #a0d0a0;
            margin-bottom: 15px;
        }

        .flip-history {
            display: flex;
            justify-content: center;
            gap: 5px;
            flex-wrap: wrap;
            margin: 15px 0;
            min-height: 30px;
        }

        .flip-result {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .flip-result.tails {
            background: #c0c0c0;
            color: #404040;
        }

        .flip-result.heads {
            background: #ffd700;
            color: #8b6914;
        }

        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            border: none;
            border-radius: 10px;
            color: #1a1a2e;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.3);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 15px;
        }

        .stat-box {
            background: rgba(255,255,255,0.08);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.4rem;
            font-weight: 700;
            color: #ffd700;
        }

        .stat-value.negative {
            color: #ff6b6b;
        }

        .stat-value.positive {
            color: #51cf66;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #a0a0a0;
            margin-top: 5px;
        }

        .expected-value-section {
            background: rgba(255, 215, 0, 0.1);
            border-left: 4px solid #ffd700;
            padding: 15px;
            border-radius: 0 12px 12px 0;
            margin-top: 15px;
        }

        .expected-value-section h4 {
            color: #ffd700;
            margin-bottom: 10px;
        }

        .series {
            font-family: 'Georgia', serif;
            font-size: 1rem;
            color: #e0e0e0;
            line-height: 1.8;
        }

        .series .term {
            display: inline-block;
            margin: 3px;
            padding: 5px 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
        }

        .infinity-symbol {
            font-size: 2rem;
            color: #ffd700;
            text-align: center;
            margin-top: 10px;
        }

        canvas {
            width: 100%;
            border-radius: 10px;
            background: rgba(0,0,0,0.3);
        }

        .simulation-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .simulation-controls label {
            font-size: 0.9rem;
            color: #a0a0a0;
        }

        input[type="number"] {
            width: 100px;
            padding: 8px;
            border: none;
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 0.9rem;
        }

        .histogram-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            font-size: 0.85rem;
            color: #a0a0a0;
        }

        .utility-section {
            background: rgba(100, 200, 100, 0.1);
            border-radius: 15px;
            padding: 15px;
            margin-top: 15px;
        }

        .utility-section h4 {
            color: #64c864;
            margin-bottom: 10px;
        }

        .utility-section p {
            font-size: 0.9rem;
            color: #b0b0b0;
            line-height: 1.5;
        }

        .formula {
            font-family: 'Georgia', serif;
            background: rgba(0,0,0,0.3);
            padding: 10px 15px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            font-size: 1.1rem;
            color: #64c864;
        }

        .paradox-box {
            background: rgba(255, 100, 100, 0.1);
            border: 1px solid rgba(255, 100, 100, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
        }

        .paradox-box h5 {
            color: #ff6b6b;
            margin-bottom: 8px;
        }

        .paradox-box p {
            font-size: 0.9rem;
            color: #c0c0c0;
            line-height: 1.5;
        }

        .comparison-table {
            width: 100%;
            margin-top: 15px;
            border-collapse: collapse;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 10px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .comparison-table th {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
            font-size: 0.85rem;
        }

        .comparison-table td {
            font-size: 0.9rem;
        }

        .bet-input-row {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
            margin: 15px 0;
        }

        .bet-input-row label {
            color: #a0a0a0;
        }

        .bet-input-row input {
            width: 80px;
        }

        .bankroll-display {
            font-size: 1.5rem;
            text-align: center;
            margin: 10px 0;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
        }

        .quote {
            font-style: italic;
            color: #a0a0a0;
            border-left: 3px solid #ffd700;
            padding-left: 15px;
            margin: 15px 0;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Paradoxes</a>

    <div class="container">
        <header>
            <h1>The St. Petersburg Paradox</h1>
            <p class="subtitle">A game with INFINITE expected value‚Äîyet no rational person would pay even $25 to play. Nicolas Bernoulli (1713) broke expected value theory.</p>
        </header>

        <div class="main-grid">
            <div class="panel">
                <div class="panel-title">üé∞ Play the St. Petersburg Game</div>
                <div class="game-area">
                    <p style="color: #a0d0a0; margin-bottom: 10px;">Flip until HEADS. Win $2<sup>n</sup> where n = number of flips.</p>

                    <div class="coin-container">
                        <div class="coin" id="coin">
                            <div class="coin-face coin-heads">H</div>
                            <div class="coin-face coin-tails">T</div>
                        </div>
                    </div>

                    <div class="flip-count" id="flipCount">Flip #0</div>
                    <div class="flip-history" id="flipHistory"></div>
                    <div class="prize-display" id="prizeDisplay">$0</div>

                    <div class="bet-input-row">
                        <label>Entry fee: $</label>
                        <input type="number" id="entryFee" value="10" min="1" max="1000000">
                    </div>

                    <div class="controls">
                        <button id="playBtn">Play Game ($<span id="feeDisplay">10</span>)</button>
                        <button id="autoPlayBtn">Auto-Play 100 Games</button>
                    </div>

                    <div class="bankroll-display">
                        Bankroll: $<span id="bankroll">1000</span>
                        <span id="profitLoss" style="font-size: 1rem; margin-left: 10px;"></span>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="gamesPlayed">0</div>
                        <div class="stat-label">Games Played</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="avgWin">$0</div>
                        <div class="stat-label">Avg Winnings</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="maxWin">$0</div>
                        <div class="stat-label">Max Win</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="medianWin">$0</div>
                        <div class="stat-label">Median Win</div>
                    </div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-title">‚àû Why Expected Value = Infinity</div>

                <div class="expected-value-section">
                    <h4>The Calculation</h4>
                    <div class="series">
                        <span class="term">¬Ω √ó $2</span> +
                        <span class="term">¬º √ó $4</span> +
                        <span class="term">‚Öõ √ó $8</span> +
                        <span class="term">1/16 √ó $16</span> + ...
                    </div>
                    <div class="series" style="margin-top: 10px;">
                        = <span class="term">$1</span> +
                        <span class="term">$1</span> +
                        <span class="term">$1</span> +
                        <span class="term">$1</span> + ...
                    </div>
                    <div class="infinity-symbol">= ‚àû</div>
                </div>

                <table class="comparison-table">
                    <tr>
                        <th>Flips</th>
                        <th>Probability</th>
                        <th>Prize</th>
                        <th>Contribution to EV</th>
                    </tr>
                    <tr>
                        <td>1 (H)</td>
                        <td>50%</td>
                        <td>$2</td>
                        <td>$1</td>
                    </tr>
                    <tr>
                        <td>2 (TH)</td>
                        <td>25%</td>
                        <td>$4</td>
                        <td>$1</td>
                    </tr>
                    <tr>
                        <td>3 (TTH)</td>
                        <td>12.5%</td>
                        <td>$8</td>
                        <td>$1</td>
                    </tr>
                    <tr>
                        <td>10</td>
                        <td>0.098%</td>
                        <td>$1,024</td>
                        <td>$1</td>
                    </tr>
                    <tr>
                        <td>20</td>
                        <td>0.0001%</td>
                        <td>$1,048,576</td>
                        <td>$1</td>
                    </tr>
                </table>

                <div class="paradox-box">
                    <h5>ü§Ø The Paradox</h5>
                    <p>Each row contributes exactly $1 to expected value. There are infinitely many rows. So EV = ‚àû. But would YOU pay $1,000,000 to play once? Of course not! You'd almost certainly win only $2 or $4.</p>
                </div>
            </div>

            <div class="panel">
                <div class="panel-title">üìä Monte Carlo: What Actually Happens</div>

                <div class="simulation-controls">
                    <label>Games:</label>
                    <input type="number" id="simGames" value="10000" min="100" max="1000000">
                    <button id="runSimBtn">Run Simulation</button>
                </div>

                <canvas id="histogram" height="250"></canvas>

                <div class="histogram-legend">
                    <span>Most wins: $2-$4 | Rare jackpots skew the mean</span>
                </div>

                <div class="stats-grid" style="margin-top: 15px;">
                    <div class="stat-box">
                        <div class="stat-value" id="simMean">‚Äî</div>
                        <div class="stat-label">Mean (Average)</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="simMedian">‚Äî</div>
                        <div class="stat-label">Median</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="simMax">‚Äî</div>
                        <div class="stat-label">Max Win</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="simMode">‚Äî</div>
                        <div class="stat-label">Most Common</div>
                    </div>
                </div>

                <div class="quote">
                    "The median outcome is just $2. Half of all games end on the first flip! The infinite expected value comes from astronomically rare events."
                </div>
            </div>

            <div class="panel">
                <div class="panel-title">üß† Daniel Bernoulli's Solution (1738)</div>

                <div class="utility-section">
                    <h4>Utility Theory: The Birth of Modern Economics</h4>
                    <p>Bernoulli argued we don't value money linearly. Gaining $1M when you have $100 is life-changing. Gaining $1M when you have $1B is a rounding error.</p>

                    <div class="formula">
                        U(w) = ln(w) ‚Äî "Log Utility"
                    </div>

                    <p style="margin-top: 10px;">With log utility, expected UTILITY is finite:</p>
                    <div class="formula">
                        E[U] = Œ£ (¬Ω)‚Åø √ó ln(2‚Åø) = ln(4) ‚âà 1.39
                    </div>

                    <p style="margin-top: 10px;">For someone with $1000, the "fair" entry fee using log utility is only about <strong>$4-5</strong>!</p>
                </div>

                <canvas id="utilityChart" height="200"></canvas>

                <div style="margin-top: 15px; padding: 12px; background: rgba(255, 215, 0, 0.1); border-radius: 10px;">
                    <p style="font-size: 0.85rem; color: #c0c0c0;"><strong>Historical Impact:</strong> This paradox led directly to:</p>
                    <ul style="font-size: 0.85rem; color: #a0a0a0; margin-top: 8px; padding-left: 20px;">
                        <li>Expected Utility Theory</li>
                        <li>Diminishing Marginal Utility</li>
                        <li>Risk Aversion in Economics</li>
                        <li>Modern Decision Theory</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game state
        let bankroll = 1000;
        const startingBankroll = 1000;
        let gamesPlayed = 0;
        let totalWinnings = 0;
        let allWins = [];
        let maxWin = 0;
        let isPlaying = false;

        // Elements
        const coin = document.getElementById('coin');
        const flipCount = document.getElementById('flipCount');
        const flipHistory = document.getElementById('flipHistory');
        const prizeDisplay = document.getElementById('prizeDisplay');
        const playBtn = document.getElementById('playBtn');
        const autoPlayBtn = document.getElementById('autoPlayBtn');
        const entryFeeInput = document.getElementById('entryFee');
        const feeDisplay = document.getElementById('feeDisplay');

        entryFeeInput.addEventListener('input', () => {
            feeDisplay.textContent = entryFeeInput.value;
        });

        // Play single game
        async function playGame(animate = true) {
            const entryFee = parseInt(entryFeeInput.value) || 10;

            if (bankroll < entryFee) {
                alert('Not enough bankroll!');
                return;
            }

            isPlaying = true;
            playBtn.disabled = true;
            bankroll -= entryFee;

            let flips = 0;
            let result = 'tails';
            flipHistory.innerHTML = '';

            while (result === 'tails') {
                flips++;

                // Flip coin
                result = Math.random() < 0.5 ? 'heads' : 'tails';

                if (animate) {
                    coin.classList.add('flipping');
                    await sleep(500);
                    coin.classList.remove('flipping');

                    // Show result
                    if (result === 'heads') {
                        coin.style.transform = 'rotateY(0deg)';
                    } else {
                        coin.style.transform = 'rotateY(180deg)';
                    }

                    flipCount.textContent = `Flip #${flips}`;

                    // Add to history
                    const flipEl = document.createElement('div');
                    flipEl.className = `flip-result ${result}`;
                    flipEl.textContent = result === 'heads' ? 'H' : 'T';
                    flipHistory.appendChild(flipEl);

                    await sleep(300);
                }
            }

            // Calculate prize
            const prize = Math.pow(2, flips);
            bankroll += prize;

            if (animate) {
                prizeDisplay.textContent = `$${prize.toLocaleString()}`;
                prizeDisplay.style.animation = 'none';
                prizeDisplay.offsetHeight; // Trigger reflow
                prizeDisplay.style.animation = 'pulse 0.5s';
            }

            // Update stats
            gamesPlayed++;
            totalWinnings += prize;
            allWins.push(prize);
            if (prize > maxWin) maxWin = prize;

            updateStats();
            updateBankrollDisplay();

            isPlaying = false;
            playBtn.disabled = false;

            return prize;
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        async function autoPlay() {
            autoPlayBtn.disabled = true;
            playBtn.disabled = true;

            for (let i = 0; i < 100; i++) {
                const entryFee = parseInt(entryFeeInput.value) || 10;
                if (bankroll < entryFee) break;

                await playGame(false);

                if (i % 10 === 0) {
                    await sleep(10); // Let UI update
                }
            }

            // Show final result
            prizeDisplay.textContent = `100 games played!`;

            autoPlayBtn.disabled = false;
            playBtn.disabled = false;
        }

        function updateStats() {
            document.getElementById('gamesPlayed').textContent = gamesPlayed;
            document.getElementById('avgWin').textContent = '$' + Math.round(totalWinnings / gamesPlayed).toLocaleString();
            document.getElementById('maxWin').textContent = '$' + maxWin.toLocaleString();

            // Calculate median
            if (allWins.length > 0) {
                const sorted = [...allWins].sort((a, b) => a - b);
                const mid = Math.floor(sorted.length / 2);
                const median = sorted.length % 2 ? sorted[mid] : (sorted[mid - 1] + sorted[mid]) / 2;
                document.getElementById('medianWin').textContent = '$' + median.toLocaleString();
            }
        }

        function updateBankrollDisplay() {
            document.getElementById('bankroll').textContent = bankroll.toLocaleString();

            const profit = bankroll - startingBankroll;
            const profitEl = document.getElementById('profitLoss');

            if (profit > 0) {
                profitEl.textContent = `(+$${profit.toLocaleString()})`;
                profitEl.style.color = '#51cf66';
            } else if (profit < 0) {
                profitEl.textContent = `(-$${Math.abs(profit).toLocaleString()})`;
                profitEl.style.color = '#ff6b6b';
            } else {
                profitEl.textContent = '';
            }
        }

        playBtn.addEventListener('click', () => playGame(true));
        autoPlayBtn.addEventListener('click', autoPlay);

        // Monte Carlo simulation
        const histogramCanvas = document.getElementById('histogram');
        const histCtx = histogramCanvas.getContext('2d');

        document.getElementById('runSimBtn').addEventListener('click', () => {
            const numGames = parseInt(document.getElementById('simGames').value) || 10000;
            runMonteCarloSimulation(numGames);
        });

        function runMonteCarloSimulation(numGames) {
            const results = [];
            const counts = {};

            for (let i = 0; i < numGames; i++) {
                let flips = 1;
                while (Math.random() >= 0.5) flips++;
                const prize = Math.pow(2, flips);
                results.push(prize);
                counts[prize] = (counts[prize] || 0) + 1;
            }

            // Calculate stats
            const sum = results.reduce((a, b) => a + b, 0);
            const mean = sum / numGames;
            const sorted = [...results].sort((a, b) => a - b);
            const median = sorted[Math.floor(numGames / 2)];
            const max = Math.max(...results);

            // Find mode
            let mode = 2;
            let maxCount = 0;
            for (const [prize, count] of Object.entries(counts)) {
                if (count > maxCount) {
                    maxCount = count;
                    mode = parseInt(prize);
                }
            }

            document.getElementById('simMean').textContent = '$' + Math.round(mean).toLocaleString();
            document.getElementById('simMedian').textContent = '$' + median.toLocaleString();
            document.getElementById('simMax').textContent = '$' + max.toLocaleString();
            document.getElementById('simMode').textContent = '$' + mode;

            drawHistogram(counts, numGames);
        }

        function drawHistogram(counts, total) {
            const width = histogramCanvas.width = histogramCanvas.offsetWidth * 2;
            const height = histogramCanvas.height = 250 * 2;
            histCtx.scale(2, 2);

            const w = width / 2;
            const h = height / 2;
            const padding = 40;

            histCtx.fillStyle = 'rgba(20, 30, 48, 1)';
            histCtx.fillRect(0, 0, w, h);

            // Get prizes sorted
            const prizes = Object.keys(counts).map(Number).sort((a, b) => a - b);
            const maxPrizeToShow = Math.min(Math.max(...prizes), 1024);
            const prizesToShow = prizes.filter(p => p <= maxPrizeToShow);

            const barWidth = (w - padding * 2) / prizesToShow.length - 5;
            const maxCount = Math.max(...Object.values(counts));

            prizesToShow.forEach((prize, i) => {
                const count = counts[prize] || 0;
                const barHeight = (count / maxCount) * (h - padding * 2 - 20);
                const x = padding + i * (barWidth + 5);
                const y = h - padding - barHeight;

                // Gradient bar
                const gradient = histCtx.createLinearGradient(x, y, x, h - padding);
                gradient.addColorStop(0, '#ffd700');
                gradient.addColorStop(1, '#ff8c00');
                histCtx.fillStyle = gradient;

                histCtx.fillRect(x, y, barWidth, barHeight);

                // Label
                histCtx.fillStyle = '#a0a0a0';
                histCtx.font = '10px Segoe UI';
                histCtx.textAlign = 'center';
                histCtx.fillText('$' + prize, x + barWidth / 2, h - padding + 15);

                // Percentage
                const pct = (count / total * 100).toFixed(1);
                if (barHeight > 15) {
                    histCtx.fillStyle = '#1a1a2e';
                    histCtx.font = '9px Segoe UI';
                    histCtx.fillText(pct + '%', x + barWidth / 2, y + 12);
                }
            });

            // Y axis
            histCtx.fillStyle = '#a0a0a0';
            histCtx.font = '11px Segoe UI';
            histCtx.textAlign = 'right';
            histCtx.fillText('Frequency', padding - 5, padding - 5);
        }

        // Utility chart
        const utilityCanvas = document.getElementById('utilityChart');
        const utilCtx = utilityCanvas.getContext('2d');

        function drawUtilityChart() {
            const width = utilityCanvas.width = utilityCanvas.offsetWidth * 2;
            const height = utilityCanvas.height = 200 * 2;
            utilCtx.scale(2, 2);

            const w = width / 2;
            const h = height / 2;
            const padding = 40;

            utilCtx.fillStyle = 'rgba(20, 30, 48, 1)';
            utilCtx.fillRect(0, 0, w, h);

            // Grid
            utilCtx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            utilCtx.lineWidth = 1;
            for (let i = 0; i <= 4; i++) {
                const y = padding + (h - padding * 2) * i / 4;
                utilCtx.beginPath();
                utilCtx.moveTo(padding, y);
                utilCtx.lineTo(w - padding, y);
                utilCtx.stroke();
            }

            // Linear value (dashed)
            utilCtx.strokeStyle = 'rgba(255, 215, 0, 0.3)';
            utilCtx.lineWidth = 2;
            utilCtx.setLineDash([5, 5]);
            utilCtx.beginPath();
            utilCtx.moveTo(padding, h - padding);
            utilCtx.lineTo(w - padding, padding);
            utilCtx.stroke();
            utilCtx.setLineDash([]);

            // Log utility curve
            utilCtx.strokeStyle = '#64c864';
            utilCtx.lineWidth = 3;
            utilCtx.beginPath();

            const maxX = 1000;
            const maxLogY = Math.log(maxX);

            for (let i = 0; i <= 100; i++) {
                const x = 1 + (maxX - 1) * (i / 100);
                const logY = Math.log(x);
                const px = padding + (i / 100) * (w - padding * 2);
                const py = h - padding - (logY / maxLogY) * (h - padding * 2);

                if (i === 0) utilCtx.moveTo(px, py);
                else utilCtx.lineTo(px, py);
            }
            utilCtx.stroke();

            // Labels
            utilCtx.fillStyle = '#a0a0a0';
            utilCtx.font = '11px Segoe UI';
            utilCtx.textAlign = 'center';
            utilCtx.fillText('Wealth ($)', w / 2, h - 8);
            utilCtx.fillText('$1', padding, h - padding + 15);
            utilCtx.fillText('$1000', w - padding, h - padding + 15);

            utilCtx.save();
            utilCtx.translate(12, h / 2);
            utilCtx.rotate(-Math.PI / 2);
            utilCtx.fillText('Utility', 0, 0);
            utilCtx.restore();

            // Legend
            utilCtx.fillStyle = '#ffd700';
            utilCtx.fillRect(w - 120, 15, 20, 3);
            utilCtx.fillStyle = '#a0a0a0';
            utilCtx.textAlign = 'left';
            utilCtx.fillText('Linear', w - 95, 20);

            utilCtx.fillStyle = '#64c864';
            utilCtx.fillRect(w - 120, 30, 20, 3);
            utilCtx.fillStyle = '#a0a0a0';
            utilCtx.fillText('Log', w - 95, 35);
        }

        // Initialize
        updateBankrollDisplay();
        drawUtilityChart();

        // Initial simulation
        runMonteCarloSimulation(10000);
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
