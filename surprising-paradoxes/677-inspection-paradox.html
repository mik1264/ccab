<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>677 - The Inspection Paradox | Surprising Paradoxes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e8e8e8;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 20px 0 30px;
        }

        h1 {
            font-size: 2.4rem;
            background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1rem;
            color: #a8a8a8;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .main-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.4rem;
            color: #00b894;
            margin-bottom: 20px;
            text-align: center;
        }

        .timeline-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        canvas {
            display: block;
            margin: 0 auto;
            border-radius: 8px;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .btn {
            padding: 12px 25px;
            font-size: 1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 184, 148, 0.4);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #e8e8e8;
            border: 2px solid #00b894;
        }

        .btn-secondary:hover {
            background: rgba(0, 184, 148, 0.2);
        }

        .mode-selector {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .mode-btn {
            padding: 12px 25px;
            border: 2px solid #444;
            background: rgba(0,0,0,0.2);
            color: #888;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .mode-btn:hover, .mode-btn.active {
            border-color: #00b894;
            color: #00b894;
            background: rgba(0, 184, 148, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-value.expected { color: #00b894; }
        .stat-value.actual { color: #e17055; }
        .stat-value.ratio { color: #fdcb6e; }

        .stat-label {
            color: #888;
            font-size: 0.9rem;
        }

        .comparison-box {
            background: linear-gradient(135deg, rgba(225, 112, 85, 0.2), rgba(0, 184, 148, 0.1));
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
        }

        .comparison-title {
            font-size: 1.2rem;
            color: #fdcb6e;
            margin-bottom: 15px;
        }

        .comparison-result {
            font-size: 1.1rem;
            color: #ccc;
            line-height: 1.7;
        }

        .explanation {
            background: linear-gradient(135deg, rgba(0, 184, 148, 0.1), rgba(0, 206, 201, 0.05));
            border-left: 4px solid #00b894;
            padding: 20px;
            border-radius: 0 10px 10px 0;
            margin: 25px 0;
        }

        .explanation h3 {
            color: #00b894;
            margin-bottom: 10px;
        }

        .explanation p {
            color: #ccc;
            line-height: 1.7;
        }

        .visual-demo {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .interval-box {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            min-width: 150px;
        }

        .interval-bar {
            height: 30px;
            border-radius: 5px;
            margin: 10px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .interval-bar.short {
            width: 60px;
            background: linear-gradient(90deg, #74b9ff, #0984e3);
        }

        .interval-bar.long {
            width: 150px;
            background: linear-gradient(90deg, #e17055, #d63031);
        }

        .interval-label {
            color: #888;
            font-size: 0.85rem;
        }

        .interval-prob {
            color: #fdcb6e;
            font-weight: bold;
            margin-top: 5px;
        }

        .examples-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .example-card {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 20px;
        }

        .example-card h4 {
            color: #00cec9;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .example-card p {
            color: #a8a8a8;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .histogram-container {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
        }

        .histogram-title {
            text-align: center;
            color: #00b894;
            margin-bottom: 10px;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #00b894;
            text-decoration: none;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 5px;
            z-index: 100;
            background: rgba(0,0,0,0.5);
            padding: 8px 15px;
            border-radius: 20px;
        }

        .back-link:hover {
            background: rgba(0, 184, 148, 0.2);
        }

        .bus-icon {
            font-size: 1.5rem;
        }

        .formula-box {
            background: rgba(0, 0, 0, 0.4);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
        }

        .formula {
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            color: #00b894;
        }

        @media (max-width: 768px) {
            h1 { font-size: 1.8rem; }
            .stat-value { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Paradoxes</a>

    <div class="container">
        <header>
            <h1>The Inspection Paradox</h1>
            <p class="subtitle">Why does the bus ALWAYS seem late? Why do you ALWAYS pick the slow checkout line?
            It's not bad luck ‚Äî it's mathematics. You're more likely to arrive during a LONG gap than a short one!</p>
        </header>

        <div class="main-section">
            <div class="section-title">üöå Bus Stop Simulation</div>

            <div class="mode-selector">
                <button class="mode-btn active" onclick="setMode('regular')">Regular Arrivals</button>
                <button class="mode-btn" onclick="setMode('poisson')">Random (Poisson)</button>
            </div>

            <div class="timeline-container">
                <canvas id="timeline" width="700" height="200"></canvas>
            </div>

            <div class="controls">
                <button class="btn btn-primary" onclick="simulateArrivals()">Generate Bus Schedule</button>
                <button class="btn btn-secondary" onclick="dropPassenger()">Drop Random Passenger</button>
                <button class="btn btn-secondary" onclick="runManyTrials()">Run 1000 Trials</button>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value expected" id="avg-interval">10</div>
                    <div class="stat-label">Average Interval (min)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value expected" id="expected-wait">5</div>
                    <div class="stat-label">Expected Wait (Naive)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value actual" id="actual-wait">--</div>
                    <div class="stat-label">Actual Avg Wait</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value ratio" id="paradox-ratio">--</div>
                    <div class="stat-label">Paradox Factor</div>
                </div>
            </div>

            <div class="comparison-box" id="result-box" style="display: none;">
                <div class="comparison-title">The Paradox Revealed!</div>
                <div class="comparison-result" id="result-text"></div>
            </div>
        </div>

        <div class="explanation">
            <h3>Why Does This Happen?</h3>
            <p><strong>Length-Biased Sampling:</strong> When you arrive at a random time, you're more likely
            to "land" in a longer interval than a shorter one ‚Äî simply because longer intervals take up more time!<br><br>
            <strong>Example:</strong> If half the bus intervals are 5 minutes and half are 15 minutes,
            the average interval is 10 minutes. But a random passenger is 3√ó more likely to arrive during
            a 15-minute gap! So the <em>experienced</em> average interval is much longer than the <em>scheduled</em> average.</p>
        </div>

        <div class="main-section">
            <div class="section-title">Visual Intuition</div>

            <div class="visual-demo">
                <div class="interval-box">
                    <div class="interval-label">Short Gap (5 min)</div>
                    <div class="interval-bar short">5</div>
                    <div class="interval-prob">Landing Prob: 25%</div>
                </div>
                <div class="interval-box">
                    <div class="interval-label">Long Gap (15 min)</div>
                    <div class="interval-bar long">15</div>
                    <div class="interval-prob">Landing Prob: 75%</div>
                </div>
            </div>

            <p style="text-align: center; color: #888; margin-top: 15px;">
                Even though gaps are 50/50 short vs long, you're 3√ó more likely to experience the long one!
            </p>

            <div class="formula-box">
                <div class="formula">E[Wait|Poisson] = E[Interval] = T</div>
                <div class="formula">E[Wait|Regular] = T/2</div>
                <p style="color: #888; margin-top: 10px; font-size: 0.9rem;">
                    With random (Poisson) arrivals, expected wait equals the FULL interval, not half!
                </p>
            </div>
        </div>

        <div class="main-section">
            <div class="section-title">The Paradox Everywhere</div>

            <div class="examples-grid">
                <div class="example-card">
                    <h4>üöå Bus Stops</h4>
                    <p>Buses "every 10 minutes" means you wait 10 minutes on average if arrivals are random,
                    not the 5 minutes you'd naively expect.</p>
                </div>
                <div class="example-card">
                    <h4>üõí Checkout Lines</h4>
                    <p>You're more likely to get behind someone with a FULL cart because
                    long transactions occupy the cashier longer.</p>
                </div>
                <div class="example-card">
                    <h4>üë• Class Sizes</h4>
                    <p>Survey students about class size ‚Äî large classes submit MORE responses,
                    so reported average exceeds the true average.</p>
                </div>
                <div class="example-card">
                    <h4>üèõÔ∏è Prison Sentences</h4>
                    <p>Visit a prison: most inmates have LONG sentences because
                    they're there longer to be observed!</p>
                </div>
                <div class="example-card">
                    <h4>üíî Relationship Length</h4>
                    <p>Ask people how long their current relationship has lasted ‚Äî
                    long relationships are over-sampled because they're ongoing!</p>
                </div>
                <div class="example-card">
                    <h4>‚ò¢Ô∏è Radioactive Decay</h4>
                    <p>Turn on a Geiger counter: expected time to first detection equals
                    the mean decay time, not half of it.</p>
                </div>
            </div>
        </div>

        <div class="explanation">
            <h3>The Mathematics</h3>
            <p>For a Poisson process with rate Œª (mean interarrival time T = 1/Œª):<br><br>
            ‚Ä¢ The interarrival times are exponentially distributed<br>
            ‚Ä¢ Due to the "memoryless" property, at any random moment, the time until the next arrival
            is ALSO exponentially distributed with the same mean T<br>
            ‚Ä¢ So E[Wait] = T, not T/2<br><br>
            For non-Poisson processes with variance œÉ¬≤ in intervals:<br>
            <strong>E[Experienced Interval] = E[Interval] + œÉ¬≤/E[Interval]</strong><br><br>
            The more variable the schedule, the worse your experienced wait!</p>
        </div>

        <div class="histogram-container">
            <div class="histogram-title">Wait Time Distribution (1000 trials)</div>
            <canvas id="histogram" width="700" height="150"></canvas>
        </div>
    </div>

    <script>
        const timelineCanvas = document.getElementById('timeline');
        const timelineCtx = timelineCanvas.getContext('2d');
        const histCanvas = document.getElementById('histogram');
        const histCtx = histCanvas.getContext('2d');

        let mode = 'regular';
        let busArrivals = [];
        let passengerArrivals = [];
        let waitTimes = [];
        const avgInterval = 10; // minutes

        function setMode(newMode) {
            mode = newMode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            document.getElementById('expected-wait').textContent =
                mode === 'regular' ? '5' : '10';

            simulateArrivals();
        }

        function generatePoissonArrivals(duration, rate) {
            const arrivals = [0];
            let t = 0;
            while (t < duration) {
                // Exponential interarrival time
                const interval = -Math.log(Math.random()) / rate;
                t += interval;
                if (t < duration) arrivals.push(t);
            }
            arrivals.push(duration);
            return arrivals;
        }

        function generateRegularArrivals(duration, interval) {
            const arrivals = [];
            for (let t = 0; t <= duration; t += interval) {
                arrivals.push(t);
            }
            return arrivals;
        }

        function simulateArrivals() {
            const duration = 120; // 2 hours
            const rate = 1 / avgInterval;

            if (mode === 'poisson') {
                busArrivals = generatePoissonArrivals(duration, rate);
            } else {
                busArrivals = generateRegularArrivals(duration, avgInterval);
            }

            passengerArrivals = [];
            waitTimes = [];
            drawTimeline();
            updateStats();
        }

        function dropPassenger() {
            if (busArrivals.length < 2) {
                simulateArrivals();
            }

            const duration = busArrivals[busArrivals.length - 1];
            const arrivalTime = Math.random() * duration;
            passengerArrivals.push(arrivalTime);

            // Find next bus
            let waitTime = 0;
            for (let i = 0; i < busArrivals.length; i++) {
                if (busArrivals[i] >= arrivalTime) {
                    waitTime = busArrivals[i] - arrivalTime;
                    break;
                }
            }
            waitTimes.push(waitTime);

            drawTimeline();
            updateStats();
        }

        function runManyTrials() {
            if (busArrivals.length < 2) {
                simulateArrivals();
            }

            const duration = busArrivals[busArrivals.length - 1];
            passengerArrivals = [];
            waitTimes = [];

            for (let i = 0; i < 1000; i++) {
                const arrivalTime = Math.random() * duration;
                passengerArrivals.push(arrivalTime);

                let waitTime = 0;
                for (let j = 0; j < busArrivals.length; j++) {
                    if (busArrivals[j] >= arrivalTime) {
                        waitTime = busArrivals[j] - arrivalTime;
                        break;
                    }
                }
                waitTimes.push(waitTime);
            }

            drawTimeline();
            drawHistogram();
            updateStats();
            showResult();
        }

        function drawTimeline() {
            const ctx = timelineCtx;
            const width = timelineCanvas.width;
            const height = timelineCanvas.height;
            const padding = 40;

            ctx.clearRect(0, 0, width, height);

            if (busArrivals.length < 2) return;

            const duration = busArrivals[busArrivals.length - 1];
            const scale = (width - 2 * padding) / duration;

            // Draw timeline
            ctx.strokeStyle = '#444';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, height / 2);
            ctx.lineTo(width - padding, height / 2);
            ctx.stroke();

            // Draw bus arrivals
            busArrivals.forEach((t, i) => {
                const x = padding + t * scale;

                // Draw interval shading
                if (i > 0) {
                    const prevX = padding + busArrivals[i-1] * scale;
                    const interval = t - busArrivals[i-1];
                    const intensity = Math.min(1, interval / (avgInterval * 2));
                    ctx.fillStyle = `rgba(225, 112, 85, ${intensity * 0.3})`;
                    ctx.fillRect(prevX, height/2 - 30, x - prevX, 60);
                }

                // Draw bus marker
                ctx.fillStyle = '#00b894';
                ctx.beginPath();
                ctx.moveTo(x, height/2 - 20);
                ctx.lineTo(x + 10, height/2);
                ctx.lineTo(x, height/2 + 20);
                ctx.lineTo(x - 10, height/2);
                ctx.closePath();
                ctx.fill();

                // Time label
                ctx.fillStyle = '#888';
                ctx.font = '10px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(t.toFixed(0) + 'm', x, height/2 + 35);
            });

            // Draw passenger arrivals (last 20)
            const recentPassengers = passengerArrivals.slice(-20);
            recentPassengers.forEach((t, i) => {
                const x = padding + t * scale;
                const idx = passengerArrivals.length - 20 + i;
                const wait = waitTimes[idx >= 0 ? idx : i];

                ctx.fillStyle = '#fdcb6e';
                ctx.beginPath();
                ctx.arc(x, height/2 - 40, 5, 0, Math.PI * 2);
                ctx.fill();

                // Draw wait line
                if (wait !== undefined) {
                    const busX = x + wait * scale;
                    ctx.strokeStyle = 'rgba(253, 203, 110, 0.5)';
                    ctx.lineWidth = 1;
                    ctx.setLineDash([3, 3]);
                    ctx.beginPath();
                    ctx.moveTo(x, height/2 - 40);
                    ctx.lineTo(busX, height/2 - 20);
                    ctx.stroke();
                    ctx.setLineDash([]);
                }
            });

            // Legend
            ctx.fillStyle = '#00b894';
            ctx.fillRect(width - 150, 15, 15, 15);
            ctx.fillStyle = '#888';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('Bus arrival', width - 130, 27);

            ctx.fillStyle = '#fdcb6e';
            ctx.beginPath();
            ctx.arc(width - 142, 45, 5, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#888';
            ctx.fillText('Passenger', width - 130, 50);
        }

        function drawHistogram() {
            const ctx = histCtx;
            const width = histCanvas.width;
            const height = histCanvas.height;
            const padding = 40;

            ctx.clearRect(0, 0, width, height);

            if (waitTimes.length === 0) return;

            // Create bins
            const maxWait = Math.max(...waitTimes);
            const binCount = 20;
            const binWidth = maxWait / binCount;
            const bins = new Array(binCount).fill(0);

            waitTimes.forEach(w => {
                const bin = Math.min(binCount - 1, Math.floor(w / binWidth));
                bins[bin]++;
            });

            const maxBin = Math.max(...bins);
            const barWidth = (width - 2 * padding) / binCount;

            // Draw bars
            bins.forEach((count, i) => {
                const barHeight = (count / maxBin) * (height - 2 * padding);
                const x = padding + i * barWidth;
                const y = height - padding - barHeight;

                const gradient = ctx.createLinearGradient(x, y, x, height - padding);
                gradient.addColorStop(0, '#00b894');
                gradient.addColorStop(1, '#00cec9');

                ctx.fillStyle = gradient;
                ctx.fillRect(x + 1, y, barWidth - 2, barHeight);
            });

            // Draw average line
            const avgWait = waitTimes.reduce((a, b) => a + b, 0) / waitTimes.length;
            const avgX = padding + (avgWait / maxWait) * (width - 2 * padding);

            ctx.strokeStyle = '#e17055';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(avgX, padding);
            ctx.lineTo(avgX, height - padding);
            ctx.stroke();
            ctx.setLineDash([]);

            ctx.fillStyle = '#e17055';
            ctx.font = 'bold 12px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Avg: ' + avgWait.toFixed(1) + ' min', avgX, padding - 5);

            // X-axis labels
            ctx.fillStyle = '#888';
            ctx.font = '10px sans-serif';
            ctx.fillText('0', padding, height - 25);
            ctx.fillText(maxWait.toFixed(0) + ' min', width - padding, height - 25);
        }

        function updateStats() {
            if (waitTimes.length === 0) {
                document.getElementById('actual-wait').textContent = '--';
                document.getElementById('paradox-ratio').textContent = '--';
                return;
            }

            const avgWait = waitTimes.reduce((a, b) => a + b, 0) / waitTimes.length;
            const expectedWait = mode === 'regular' ? avgInterval / 2 : avgInterval;
            const ratio = avgWait / (avgInterval / 2);

            document.getElementById('actual-wait').textContent = avgWait.toFixed(1);
            document.getElementById('paradox-ratio').textContent = ratio.toFixed(2) + '√ó';
        }

        function showResult() {
            const avgWait = waitTimes.reduce((a, b) => a + b, 0) / waitTimes.length;
            const expectedNaive = avgInterval / 2;

            document.getElementById('result-box').style.display = 'block';

            if (mode === 'poisson') {
                document.getElementById('result-text').innerHTML =
                    `With random arrivals, your average wait was <strong>${avgWait.toFixed(1)} minutes</strong> ‚Äî ` +
                    `almost <strong>${(avgWait / expectedNaive).toFixed(1)}√ó longer</strong> than the naive expectation of ${expectedNaive} minutes!<br><br>` +
                    `This is the Inspection Paradox: you're more likely to arrive during a LONG gap between buses.`;
            } else {
                document.getElementById('result-text').innerHTML =
                    `With regular arrivals, your average wait was <strong>${avgWait.toFixed(1)} minutes</strong> ‚Äî ` +
                    `close to the expected ${expectedNaive} minutes.<br><br>` +
                    `Regular schedules avoid the paradox! Try "Random (Poisson)" mode to see the difference.`;
            }
        }

        // Initialize
        simulateArrivals();
    </script>
</body>
</html>
