<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diffusion Limited Aggregation - Fractals from Random Walks</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0a1a1a 0%, #1a2a1a 50%, #0a1a0a 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        .back-link {
            display: inline-flex;
            align-items: center;
            color: #10b981;
            text-decoration: none;
            margin-bottom: 15px;
            font-size: 0.95em;
        }
        .back-link:hover {
            color: #34d399;
            text-decoration: underline;
        }
        h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
            color: #fff;
            text-shadow: 0 0 30px rgba(16, 185, 129, 0.5);
        }
        .subtitle {
            color: #34d399;
            margin-bottom: 20px;
            font-size: 1.05em;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .main-content {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 20px;
        }
        .canvas-container {
            background: rgba(0,0,0,0.4);
            border-radius: 12px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        canvas {
            border-radius: 8px;
            background: #020205;
        }
        .info-text {
            margin-top: 10px;
            font-size: 0.8em;
            color: #10b981;
        }
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .panel {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .panel h3 {
            font-size: 0.9em;
            color: #10b981;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .btn {
            padding: 8px 14px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 500;
            transition: all 0.2s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #e0e0e0;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .btn-secondary:hover {
            background: rgba(255,255,255,0.2);
        }
        .param-group {
            margin-bottom: 12px;
        }
        .param-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .param-name {
            color: #34d399;
            font-size: 0.85em;
        }
        .param-value {
            color: #6ee7b7;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.9em;
        }
        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255,255,255,0.1);
            -webkit-appearance: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #10b981;
            cursor: pointer;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .stat-label {
            color: #34d399;
            font-size: 0.8em;
        }
        .stat-value {
            color: #6ee7b7;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.8em;
        }
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            margin-top: 8px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #34d399);
            border-radius: 4px;
            transition: width 0.3s;
        }
        .formula-box {
            background: rgba(0,0,0,0.3);
            padding: 12px;
            border-radius: 6px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.85em;
            line-height: 1.6;
            color: #6ee7b7;
            text-align: center;
        }
        .exp-section {
            margin-top: 20px;
        }
        .exp-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }
        .exp-card {
            background: linear-gradient(135deg, rgba(16,185,129,0.1), rgba(5,150,105,0.05));
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(16,185,129,0.2);
        }
        .exp-card h4 {
            color: #10b981;
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        .exp-card p {
            font-size: 0.85em;
            line-height: 1.6;
            color: #34d399;
        }
        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">← Back to Paradoxes</a>
        <h1>Diffusion Limited Aggregation</h1>
        <p class="subtitle">Beautiful Fractals from Random Walks</p>

        <div class="main-content">
            <div class="canvas-container">
                <canvas id="mainCanvas" width="600" height="600"></canvas>
                <p class="info-text">Random walkers stick when they touch the cluster → branching fractal emerges</p>
            </div>

            <div class="sidebar">
                <div class="panel">
                    <h3>Controls</h3>
                    <div class="controls">
                        <button class="btn btn-primary" id="startBtn">Start</button>
                        <button class="btn btn-secondary" id="pauseBtn">Pause</button>
                        <button class="btn btn-secondary" id="resetBtn">Reset</button>
                    </div>
                </div>

                <div class="panel">
                    <h3>Parameters</h3>
                    <div class="param-group">
                        <div class="param-label">
                            <span class="param-name">Target particles</span>
                            <span class="param-value" id="targetValue">3000</span>
                        </div>
                        <input type="range" id="targetSlider" min="500" max="8000" step="100" value="3000">
                    </div>
                    <div class="param-group">
                        <div class="param-label">
                            <span class="param-name">Stickiness (%)</span>
                            <span class="param-value" id="stickinessValue">100</span>
                        </div>
                        <input type="range" id="stickinessSlider" min="10" max="100" value="100">
                    </div>
                    <div class="param-group">
                        <div class="param-label">
                            <span class="param-name">Walkers at once</span>
                            <span class="param-value" id="walkersValue">50</span>
                        </div>
                        <input type="range" id="walkersSlider" min="10" max="200" value="50">
                    </div>
                </div>

                <div class="panel">
                    <h3>Statistics</h3>
                    <div class="stat-row">
                        <span class="stat-label">Particles</span>
                        <span id="particleCount" class="stat-value">1</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Cluster radius</span>
                        <span id="clusterRadius" class="stat-value">1</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Fractal dim. (est.)</span>
                        <span id="fractalDim" class="stat-value">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Theoretical dim.</span>
                        <span class="stat-value">≈ 1.71</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                </div>

                <div class="panel">
                    <h3>The Process</h3>
                    <div class="formula-box">
                        1. Seed particle at center<br>
                        2. Random walker from edge<br>
                        3. If touches cluster → stick<br>
                        4. Repeat → fractal tree grows!
                    </div>
                </div>

                <div class="panel">
                    <h3>Color Scheme</h3>
                    <div class="controls">
                        <button class="btn btn-secondary color-btn active" data-color="time">By Time</button>
                        <button class="btn btn-secondary color-btn" data-color="distance">By Distance</button>
                        <button class="btn btn-secondary color-btn" data-color="white">White</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="exp-section">
            <div class="exp-cards">
                <div class="exp-card">
                    <h4>Witten & Sander (1981)</h4>
                    <p>Physicists Thomas Witten and Leonard Sander introduced DLA to model aggregation processes. Their Physical Review Letters paper sparked decades of research. The surprising result: purely random motion creates highly organized branching structures!</p>
                </div>
                <div class="exp-card">
                    <h4>Brownian Trees</h4>
                    <p>DLA clusters are called "Brownian trees" because they grow from random walks (Brownian motion). The branching occurs because outer tips are more likely to catch new walkers—inner regions are "screened" by the branches above them.</p>
                </div>
                <div class="exp-card">
                    <h4>Nature's DLA</h4>
                    <p>DLA appears everywhere: lightning bolts, frost on windows, electrodeposition, mineral dendrites, river networks, blood vessels, plant roots, coral growth, and even city sprawl! The same random-walk-plus-sticking rule underlies all these patterns.</p>
                </div>
                <div class="exp-card">
                    <h4>Fractal Dimension ≈ 1.71</h4>
                    <p>DLA clusters have fractal dimension about 1.71—more than a line (1D) but less than a filled circle (2D). This non-integer dimension captures how the cluster fills space: branches spread out but leave gaps. The screening effect creates this precise value!</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');

        const size = canvas.width;
        const center = size / 2;

        // Parameters
        let targetParticles = 3000;
        let stickiness = 1.0;  // 100%
        let numWalkers = 50;
        let colorScheme = 'time';

        // State
        let grid = null;
        let particles = [];
        let walkers = [];
        let maxRadius = 1;
        let running = false;
        let paused = false;

        // Initialize grid
        function initGrid() {
            grid = new Uint8Array(size * size);
            particles = [];
            walkers = [];
            maxRadius = 1;

            // Place seed at center
            const cx = Math.floor(center);
            const cy = Math.floor(center);
            grid[cy * size + cx] = 1;
            particles.push({ x: cx, y: cy, time: 0, dist: 0 });
        }

        // Check if position is adjacent to cluster
        function isAdjacentToCluster(x, y) {
            const neighbors = [
                [x-1, y], [x+1, y], [x, y-1], [x, y+1],
                [x-1, y-1], [x+1, y-1], [x-1, y+1], [x+1, y+1]
            ];

            for (let [nx, ny] of neighbors) {
                if (nx >= 0 && nx < size && ny >= 0 && ny < size) {
                    if (grid[ny * size + nx] === 1) {
                        return true;
                    }
                }
            }
            return false;
        }

        // Create new walker at edge
        function createWalker() {
            const spawnRadius = Math.min(maxRadius + 20, center - 5);
            const angle = Math.random() * Math.PI * 2;
            return {
                x: Math.floor(center + Math.cos(angle) * spawnRadius),
                y: Math.floor(center + Math.sin(angle) * spawnRadius)
            };
        }

        // Move walker randomly
        function moveWalker(walker) {
            const dx = Math.floor(Math.random() * 3) - 1;
            const dy = Math.floor(Math.random() * 3) - 1;
            walker.x += dx;
            walker.y += dy;
        }

        // Main simulation step
        function simulate() {
            if (paused || particles.length >= targetParticles) return;

            // Ensure we have enough walkers
            while (walkers.length < numWalkers) {
                walkers.push(createWalker());
            }

            // Move each walker
            for (let i = walkers.length - 1; i >= 0; i--) {
                const walker = walkers[i];

                // Move
                moveWalker(walker);

                // Check bounds - if too far, restart
                const dx = walker.x - center;
                const dy = walker.y - center;
                const dist = Math.sqrt(dx * dx + dy * dy);

                if (dist > maxRadius + 50 || walker.x < 1 || walker.x >= size - 1 ||
                    walker.y < 1 || walker.y >= size - 1) {
                    walkers[i] = createWalker();
                    continue;
                }

                // Check if adjacent to cluster
                if (isAdjacentToCluster(walker.x, walker.y)) {
                    // Stickiness check
                    if (Math.random() < stickiness) {
                        // Add to cluster
                        grid[walker.y * size + walker.x] = 1;
                        particles.push({
                            x: walker.x,
                            y: walker.y,
                            time: particles.length,
                            dist: dist
                        });

                        // Update max radius
                        if (dist > maxRadius) {
                            maxRadius = dist;
                        }

                        // Remove walker and create new one
                        walkers[i] = createWalker();
                    }
                }
            }
        }

        // Draw the cluster
        function draw() {
            ctx.fillStyle = '#020205';
            ctx.fillRect(0, 0, size, size);

            // Draw particles
            const imageData = ctx.getImageData(0, 0, size, size);
            const data = imageData.data;

            for (let p of particles) {
                let r, g, b;

                if (colorScheme === 'time') {
                    // Color by when particle joined
                    const t = p.time / Math.max(particles.length, 1);
                    const hue = 120 + t * 180;  // Green to cyan to blue
                    const rgb = hslToRgb(hue / 360, 0.8, 0.5);
                    r = rgb.r; g = rgb.g; b = rgb.b;
                } else if (colorScheme === 'distance') {
                    // Color by distance from center
                    const d = p.dist / maxRadius;
                    const hue = 120 - d * 120;  // Green to yellow to red
                    const rgb = hslToRgb(hue / 360, 0.8, 0.5);
                    r = rgb.r; g = rgb.g; b = rgb.b;
                } else {
                    r = 255; g = 255; b = 255;
                }

                const idx = (p.y * size + p.x) * 4;
                data[idx] = r;
                data[idx + 1] = g;
                data[idx + 2] = b;
                data[idx + 3] = 255;
            }

            // Draw active walkers (faint)
            for (let w of walkers) {
                if (w.x >= 0 && w.x < size && w.y >= 0 && w.y < size) {
                    const idx = (w.y * size + w.x) * 4;
                    data[idx] = Math.min(255, data[idx] + 30);
                    data[idx + 1] = Math.min(255, data[idx + 1] + 50);
                    data[idx + 2] = Math.min(255, data[idx + 2] + 30);
                    data[idx + 3] = 255;
                }
            }

            ctx.putImageData(imageData, 0, 0);

            updateStats();
        }

        function hslToRgb(h, s, l) {
            let r, g, b;
            if (s === 0) {
                r = g = b = l;
            } else {
                const hue2rgb = (p, q, t) => {
                    if (t < 0) t += 1;
                    if (t > 1) t -= 1;
                    if (t < 1/6) return p + (q - p) * 6 * t;
                    if (t < 1/2) return q;
                    if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
                    return p;
                };
                const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                const p = 2 * l - q;
                r = hue2rgb(p, q, h + 1/3);
                g = hue2rgb(p, q, h);
                b = hue2rgb(p, q, h - 1/3);
            }
            return { r: Math.round(r * 255), g: Math.round(g * 255), b: Math.round(b * 255) };
        }

        function updateStats() {
            document.getElementById('particleCount').textContent = particles.length.toLocaleString();
            document.getElementById('clusterRadius').textContent = maxRadius.toFixed(1) + ' px';

            // Estimate fractal dimension: D = log(N) / log(R)
            if (particles.length > 10 && maxRadius > 5) {
                const D = Math.log(particles.length) / Math.log(maxRadius);
                document.getElementById('fractalDim').textContent = D.toFixed(3);
            }

            // Progress
            const progress = (particles.length / targetParticles) * 100;
            document.getElementById('progressFill').style.width = Math.min(100, progress) + '%';
        }

        function animate() {
            if (running && !paused) {
                // Run multiple simulation steps per frame
                for (let i = 0; i < 10; i++) {
                    simulate();
                }
            }

            draw();
            requestAnimationFrame(animate);
        }

        function reset() {
            running = false;
            paused = false;
            document.getElementById('startBtn').textContent = 'Start';
            document.getElementById('pauseBtn').textContent = 'Pause';
            initGrid();
        }

        // Event handlers
        document.getElementById('startBtn').addEventListener('click', () => {
            if (!running) {
                running = true;
                paused = false;
                document.getElementById('startBtn').textContent = 'Running...';
            }
        });

        document.getElementById('pauseBtn').addEventListener('click', () => {
            paused = !paused;
            document.getElementById('pauseBtn').textContent = paused ? 'Resume' : 'Pause';
        });

        document.getElementById('resetBtn').addEventListener('click', reset);

        document.getElementById('targetSlider').addEventListener('input', (e) => {
            targetParticles = parseInt(e.target.value);
            document.getElementById('targetValue').textContent = targetParticles;
        });

        document.getElementById('stickinessSlider').addEventListener('input', (e) => {
            stickiness = parseInt(e.target.value) / 100;
            document.getElementById('stickinessValue').textContent = Math.round(stickiness * 100);
        });

        document.getElementById('walkersSlider').addEventListener('input', (e) => {
            numWalkers = parseInt(e.target.value);
            document.getElementById('walkersValue').textContent = numWalkers;
        });

        document.querySelectorAll('.color-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                colorScheme = btn.dataset.color;
                document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            });
        });

        // Initialize
        initGrid();
        animate();
    </script>
</body>
</html>
