<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ulam Spiral - Surprising Paradoxes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0a0a15 0%, #15152a 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5em;
            background: linear-gradient(135deg, #ffd700 0%, #ff8c00 50%, #ff4500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2em;
            color: #888;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 20px;
        }

        @media (max-width: 1000px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .canvas-container {
            background: #000;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        #spiralCanvas {
            display: block;
            width: 100%;
        }

        .info-overlay {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.85em;
            font-family: monospace;
        }

        .info-overlay span {
            color: #ffd700;
        }

        .hover-info {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9em;
            display: none;
        }

        .hover-info.visible {
            display: block;
        }

        .hover-number {
            font-size: 1.5em;
            color: #ffd700;
            font-weight: bold;
        }

        .hover-status {
            color: #4ecdc4;
            margin-top: 5px;
        }

        .controls {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
        }

        .control-section {
            margin-bottom: 25px;
        }

        .control-section h3 {
            color: #ffd700;
            margin-bottom: 15px;
            font-size: 1.1em;
            border-bottom: 1px solid rgba(255,215,0,0.3);
            padding-bottom: 8px;
        }

        .control-row {
            margin-bottom: 15px;
        }

        .control-row label {
            display: block;
            margin-bottom: 5px;
            color: #aaa;
            font-size: 0.9em;
        }

        .control-row input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }

        .control-row .value {
            text-align: right;
            font-family: monospace;
            color: #ffd700;
            font-size: 0.9em;
        }

        select {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: #e0e0e0;
            font-size: 0.95em;
        }

        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        button {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            color: #000;
            font-weight: bold;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255,215,0,0.4);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #e0e0e0;
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.2);
        }

        .preset-btn {
            flex: 1;
            min-width: 80px;
            font-size: 0.8em;
            padding: 8px 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .stat-box {
            background: rgba(0,0,0,0.3);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.1em;
            color: #ffd700;
            font-family: monospace;
        }

        .stat-label {
            font-size: 0.75em;
            color: #888;
            margin-top: 4px;
        }

        .euler-highlight {
            background: rgba(255,215,0,0.1);
            border: 1px solid rgba(255,215,0,0.3);
            border-radius: 8px;
            padding: 12px;
            margin-top: 15px;
        }

        .euler-title {
            color: #ffd700;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .euler-formula {
            font-family: 'Times New Roman', serif;
            font-size: 1.1em;
            color: #ff8c00;
        }

        .explanation {
            margin-top: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .exp-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #ffd700;
        }

        .exp-card h3 {
            color: #ffd700;
            margin-bottom: 10px;
        }

        .exp-card p {
            color: #bbb;
            line-height: 1.6;
        }

        .back-link {
            display: inline-block;
            color: #ffd700;
            text-decoration: none;
            margin-bottom: 20px;
            transition: transform 0.2s;
        }

        .back-link:hover {
            transform: translateX(-5px);
        }

        .quadratic-list {
            font-size: 0.85em;
            color: #888;
            margin-top: 10px;
        }

        .quadratic-list div {
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">← Back to Paradoxes</a>

        <header>
            <h1>The Ulam Spiral</h1>
            <p class="subtitle">When primes reveal hidden patterns</p>
        </header>

        <div class="main-content">
            <div class="canvas-container">
                <canvas id="spiralCanvas" width="700" height="700"></canvas>
                <div class="info-overlay">
                    <div>Size: <span id="spiralSize">201×201</span></div>
                    <div>Max number: <span id="maxNumber">40,401</span></div>
                    <div>Primes shown: <span id="primeCount">4,203</span></div>
                </div>
                <div class="hover-info" id="hoverInfo">
                    <div class="hover-number" id="hoverNumber">—</div>
                    <div class="hover-status" id="hoverStatus">—</div>
                </div>
            </div>

            <div class="controls">
                <div class="control-section">
                    <h3>Spiral Size</h3>
                    <div class="control-row">
                        <label>Grid dimension</label>
                        <input type="range" id="sizeSlider" min="51" max="401" step="10" value="201">
                        <div class="value"><span id="sizeValue">201</span> × <span id="sizeValue2">201</span></div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>Starting Number</h3>
                    <div class="btn-group">
                        <button class="btn-secondary preset-btn" data-start="1">1 (Classic)</button>
                        <button class="btn-secondary preset-btn" data-start="41">41 (Euler)</button>
                        <button class="btn-secondary preset-btn" data-start="2">2</button>
                        <button class="btn-secondary preset-btn" data-start="17">17</button>
                    </div>
                </div>

                <div class="control-section">
                    <h3>Highlighting</h3>
                    <select id="highlightMode">
                        <option value="primes">Prime Numbers Only</option>
                        <option value="euler">Euler's Polynomial (n²-n+41)</option>
                        <option value="twin">Twin Primes</option>
                        <option value="sophie">Sophie Germain Primes</option>
                        <option value="all">All Numbers (density)</option>
                    </select>
                </div>

                <div class="control-section">
                    <h3>Color Scheme</h3>
                    <div class="btn-group">
                        <button class="btn-secondary" data-color="gold">Gold</button>
                        <button class="btn-secondary" data-color="fire">Fire</button>
                        <button class="btn-secondary" data-color="cool">Cool</button>
                        <button class="btn-secondary" data-color="mono">Mono</button>
                    </div>
                </div>

                <div class="control-section">
                    <h3>Statistics</h3>
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-value" id="statPrimes">4,203</div>
                            <div class="stat-label">Primes</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="statDensity">10.4%</div>
                            <div class="stat-label">Density</div>
                        </div>
                    </div>
                </div>

                <div class="euler-highlight">
                    <div class="euler-title">Euler's Prime Formula (1772)</div>
                    <div class="euler-formula">n² − n + 41</div>
                    <div class="quadratic-list">
                        <div>n=0: 41 ✓</div>
                        <div>n=1: 41 ✓</div>
                        <div>n=2: 43 ✓</div>
                        <div>n=40: 1,601 ✓ (40 consecutive!)</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="explanation">
            <div class="exp-card">
                <h3>The Discovery</h3>
                <p>In 1963, mathematician Stanisław Ulam was sitting through "a long and very boring paper" at a scientific meeting. To pass the time, he began doodling—writing integers in a spiral pattern and circling the primes. To his astonishment, the primes appeared to cluster along diagonal lines!</p>
            </div>

            <div class="exp-card">
                <h3>The Paradox</h3>
                <p>Prime numbers are supposed to be randomly distributed—that's a cornerstone of number theory. Yet here they are, visibly aligning along specific diagonals! Why would numbers that are fundamentally unpredictable create such obvious visual patterns?</p>
            </div>

            <div class="exp-card">
                <h3>The Mathematical Explanation</h3>
                <p>The diagonals correspond to quadratic polynomials like n²-n+41. Euler discovered in 1772 that this formula produces 40 consecutive primes! The spiral arrangement makes these polynomial sequences appear as straight lines—revealing hidden structure in the primes.</p>
            </div>

            <div class="exp-card">
                <h3>Still Unsolved</h3>
                <p>Despite 60 years of study, no one fully understands why certain diagonals have higher prime density. The pattern connects to the Hardy-Littlewood conjectures and Landau's problems—some of the deepest unsolved questions in number theory.</p>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('spiralCanvas');
        const ctx = canvas.getContext('2d');

        let gridSize = 201;
        let startNumber = 1;
        let highlightMode = 'primes';
        let colorScheme = 'gold';

        // Sieve of Eratosthenes
        function sievePrimes(max) {
            const sieve = new Array(max + 1).fill(true);
            sieve[0] = sieve[1] = false;
            for (let i = 2; i * i <= max; i++) {
                if (sieve[i]) {
                    for (let j = i * i; j <= max; j += i) {
                        sieve[j] = false;
                    }
                }
            }
            return sieve;
        }

        // Generate spiral coordinates
        function spiralCoords(n, centerX, centerY) {
            if (n === 0) return { x: centerX, y: centerY };

            // Find which ring we're on
            let ring = Math.ceil((Math.sqrt(n + 1) - 1) / 2);
            let ringStart = (2 * ring - 1) ** 2;
            let pos = n - ringStart;
            let sideLen = 2 * ring;

            let x, y;
            if (pos < sideLen) {
                // Right side, going up
                x = ring;
                y = -ring + 1 + pos;
            } else if (pos < 2 * sideLen) {
                // Top side, going left
                x = ring - (pos - sideLen) - 1;
                y = ring;
            } else if (pos < 3 * sideLen) {
                // Left side, going down
                x = -ring;
                y = ring - (pos - 2 * sideLen) - 1;
            } else {
                // Bottom side, going right
                x = -ring + (pos - 3 * sideLen) + 1;
                y = -ring;
            }

            return { x: centerX + x, y: centerY + y };
        }

        // Check if number is from Euler's polynomial
        function isEulerPrime(num) {
            // n² - n + 41 for n = 0 to some reasonable range
            for (let n = 0; n <= 100; n++) {
                if (n * n - n + 41 === num) return true;
            }
            return false;
        }

        // Check for twin primes
        function isTwinPrime(num, primes) {
            return primes[num] && (primes[num - 2] || primes[num + 2]);
        }

        // Check for Sophie Germain primes
        function isSophieGermain(num, primes) {
            return primes[num] && primes[2 * num + 1];
        }

        const colorSchemes = {
            gold: {
                prime: '#ffd700',
                euler: '#ff4500',
                twin: '#ff69b4',
                sophie: '#00ff7f',
                bg: '#0a0a15'
            },
            fire: {
                prime: '#ff4500',
                euler: '#ffd700',
                twin: '#ff1493',
                sophie: '#ff8c00',
                bg: '#1a0a0a'
            },
            cool: {
                prime: '#00bfff',
                euler: '#9400d3',
                twin: '#00fa9a',
                sophie: '#1e90ff',
                bg: '#0a0a1a'
            },
            mono: {
                prime: '#ffffff',
                euler: '#aaaaaa',
                twin: '#dddddd',
                sophie: '#cccccc',
                bg: '#000000'
            }
        };

        function draw() {
            const colors = colorSchemes[colorScheme];
            ctx.fillStyle = colors.bg;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const maxNum = gridSize * gridSize + startNumber - 1;
            const primes = sievePrimes(maxNum + 2);

            const cellSize = Math.min(canvas.width, canvas.height) / gridSize;
            const centerX = Math.floor(gridSize / 2);
            const centerY = Math.floor(gridSize / 2);

            let primeCount = 0;

            for (let i = 0; i < gridSize * gridSize; i++) {
                const num = i + startNumber;
                const { x, y } = spiralCoords(i, centerX, centerY);

                const px = x * cellSize;
                const py = y * cellSize;

                let shouldDraw = false;
                let color = colors.prime;

                switch (highlightMode) {
                    case 'primes':
                        shouldDraw = primes[num];
                        break;
                    case 'euler':
                        shouldDraw = primes[num];
                        if (isEulerPrime(num)) {
                            color = colors.euler;
                        }
                        break;
                    case 'twin':
                        if (isTwinPrime(num, primes)) {
                            shouldDraw = true;
                            color = colors.twin;
                        }
                        break;
                    case 'sophie':
                        if (isSophieGermain(num, primes)) {
                            shouldDraw = true;
                            color = colors.sophie;
                        }
                        break;
                    case 'all':
                        shouldDraw = true;
                        if (primes[num]) {
                            color = colors.prime;
                        } else {
                            color = 'rgba(50,50,70,0.5)';
                        }
                        break;
                }

                if (shouldDraw) {
                    ctx.fillStyle = color;
                    ctx.fillRect(px, py, Math.max(1, cellSize - 0.5), Math.max(1, cellSize - 0.5));
                    if (primes[num]) primeCount++;
                }
            }

            updateStats(primeCount, maxNum);
        }

        function updateStats(primeCount, maxNum) {
            document.getElementById('spiralSize').textContent = `${gridSize}×${gridSize}`;
            document.getElementById('maxNumber').textContent = maxNum.toLocaleString();
            document.getElementById('primeCount').textContent = primeCount.toLocaleString();
            document.getElementById('statPrimes').textContent = primeCount.toLocaleString();

            const density = ((primeCount / (gridSize * gridSize)) * 100).toFixed(1);
            document.getElementById('statDensity').textContent = density + '%';
        }

        // Hover functionality
        let primeCache = null;
        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX - rect.left) * (canvas.width / rect.width);
            const y = (e.clientY - rect.top) * (canvas.height / rect.height);

            const cellSize = Math.min(canvas.width, canvas.height) / gridSize;
            const gridX = Math.floor(x / cellSize);
            const gridY = Math.floor(y / cellSize);

            const centerX = Math.floor(gridSize / 2);
            const centerY = Math.floor(gridSize / 2);

            // Find which number is at this position by searching
            const maxNum = gridSize * gridSize + startNumber - 1;
            if (!primeCache) primeCache = sievePrimes(maxNum);

            for (let i = 0; i < gridSize * gridSize; i++) {
                const { x: sx, y: sy } = spiralCoords(i, centerX, centerY);
                if (sx === gridX && sy === gridY) {
                    const num = i + startNumber;
                    const hoverInfo = document.getElementById('hoverInfo');
                    const hoverNumber = document.getElementById('hoverNumber');
                    const hoverStatus = document.getElementById('hoverStatus');

                    hoverInfo.classList.add('visible');
                    hoverNumber.textContent = num.toLocaleString();

                    if (primeCache[num]) {
                        let status = '✓ Prime';
                        if (isEulerPrime(num)) status += ' (Euler formula)';
                        if (isTwinPrime(num, primeCache)) status += ' (Twin)';
                        if (isSophieGermain(num, primeCache)) status += ' (Sophie Germain)';
                        hoverStatus.textContent = status;
                        hoverStatus.style.color = '#4ecdc4';
                    } else {
                        hoverStatus.textContent = 'Composite';
                        hoverStatus.style.color = '#888';
                    }
                    return;
                }
            }
        });

        canvas.addEventListener('mouseleave', () => {
            document.getElementById('hoverInfo').classList.remove('visible');
        });

        // Event listeners
        document.getElementById('sizeSlider').addEventListener('input', (e) => {
            gridSize = parseInt(e.target.value);
            document.getElementById('sizeValue').textContent = gridSize;
            document.getElementById('sizeValue2').textContent = gridSize;
            primeCache = null;
            draw();
        });

        document.querySelectorAll('[data-start]').forEach(btn => {
            btn.addEventListener('click', () => {
                startNumber = parseInt(btn.dataset.start);
                primeCache = null;
                draw();
            });
        });

        document.getElementById('highlightMode').addEventListener('change', (e) => {
            highlightMode = e.target.value;
            draw();
        });

        document.querySelectorAll('[data-color]').forEach(btn => {
            btn.addEventListener('click', () => {
                colorScheme = btn.dataset.color;
                draw();
            });
        });

        // Initial render
        draw();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
