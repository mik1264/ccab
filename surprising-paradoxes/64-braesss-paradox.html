<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Braess's Paradox - When Adding Roads Causes Gridlock</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600;700&family=Nunito:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --road-gray: #3d3d3d;
            --road-light: #6b6b6b;
            --car-blue: #3498db;
            --car-red: #e74c3c;
            --congested: #e74c3c;
            --flowing: #2ecc71;
            --warning: #f39c12;
            --sage: #8A9A5B;
            --moss: #606C38;
            --cream: #FEFAE0;
            --city-bg: #1a1a2e;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #ecf0f1;
            overflow-x: hidden;
        }

        /* City grid background */
        .city-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                linear-gradient(rgba(100, 100, 100, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(100, 100, 100, 0.1) 1px, transparent 1px);
            background-size: 40px 40px;
            z-index: 0;
        }

        /* Street lights effect */
        .street-light {
            position: fixed;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #f39c12;
            box-shadow: 0 0 20px #f39c12, 0 0 40px rgba(243, 156, 18, 0.5);
            animation: flicker 3s ease-in-out infinite;
            z-index: 1;
        }

        @keyframes flicker {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        .organic-back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 18px;
            background: rgba(52, 152, 219, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(52, 152, 219, 0.3);
            border-radius: 30px;
            color: var(--car-blue);
            text-decoration: none;
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .organic-back-link:hover {
            background: rgba(52, 152, 219, 0.4);
            transform: translateX(-3px);
        }

        .container {
            position: relative;
            z-index: 10;
            max-width: 1200px;
            margin: 0 auto;
            padding: 80px 20px 40px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-family: 'Lora', serif;
            font-size: 2.8rem;
            background: linear-gradient(135deg, #f39c12, #e74c3c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .header .subtitle {
            font-size: 1.2rem;
            color: #bdc3c7;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .network-panel {
            background: rgba(22, 33, 62, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(52, 152, 219, 0.3);
            border-radius: 20px;
            padding: 25px;
        }

        .network-panel h2 {
            font-family: 'Lora', serif;
            color: var(--car-blue);
            margin-bottom: 15px;
            text-align: center;
        }

        .canvas-container {
            position: relative;
            height: 350px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            overflow: hidden;
        }

        canvas {
            width: 100%;
            height: 100%;
        }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .stat-box {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .stat-value.better { color: var(--flowing); }
        .stat-value.worse { color: var(--congested); }
        .stat-value.same { color: var(--warning); }

        .stat-label {
            font-size: 0.85rem;
            color: #bdc3c7;
            margin-top: 5px;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .toggle-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .toggle-label {
            font-weight: 600;
            color: #bdc3c7;
        }

        .toggle-switch {
            position: relative;
            width: 80px;
            height: 40px;
            background: var(--congested);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-switch.active {
            background: var(--flowing);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 4px;
            left: 4px;
            width: 32px;
            height: 32px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .toggle-switch.active::after {
            left: 44px;
        }

        .slider-container {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #bdc3c7;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--car-blue);
            cursor: pointer;
        }

        .comparison-arrow {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: var(--warning);
            animation: pulse 1s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .explanation {
            background: rgba(22, 33, 62, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(52, 152, 219, 0.3);
            border-radius: 20px;
            padding: 30px;
            margin-top: 30px;
        }

        .explanation h2 {
            font-family: 'Lora', serif;
            color: var(--car-blue);
            margin-bottom: 20px;
        }

        .explanation p {
            line-height: 1.8;
            margin-bottom: 15px;
            color: #bdc3c7;
        }

        .highlight {
            color: #f39c12;
            font-weight: 600;
        }

        .paradox-box {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.2), rgba(243, 156, 18, 0.2));
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border-left: 4px solid var(--warning);
        }

        .paradox-box h3 {
            color: var(--warning);
            margin-bottom: 10px;
        }

        .math-box {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }

        .math-row {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            flex-wrap: wrap;
            gap: 10px;
        }

        .math-item {
            flex: 1;
            min-width: 200px;
            text-align: center;
        }

        .math-item .title {
            font-size: 0.8rem;
            color: #bdc3c7;
            margin-bottom: 5px;
        }

        .math-item .value {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .real-world {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .example-card {
            background: rgba(52, 152, 219, 0.1);
            border: 1px solid rgba(52, 152, 219, 0.3);
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .example-card:hover {
            transform: translateY(-5px);
            border-color: var(--car-blue);
        }

        .example-card h4 {
            color: var(--car-blue);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .example-card p {
            font-size: 0.9rem;
            color: #bdc3c7;
            line-height: 1.6;
        }

        .route-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        .route-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
        }

        .route-color {
            width: 20px;
            height: 4px;
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div class="city-grid"></div>

    <!-- Street lights -->
    <div class="street-light" style="top: 15%; left: 20%;"></div>
    <div class="street-light" style="top: 25%; left: 75%;"></div>
    <div class="street-light" style="top: 60%; left: 15%;"></div>
    <div class="street-light" style="top: 70%; left: 80%;"></div>
    <div class="street-light" style="top: 40%; left: 50%;"></div>

    <a href="index.html" class="organic-back-link">
        <span class="back-arrow">‚Üê</span>
        <span class="back-text">Gallery</span>
    </a>

    <div class="container">
        <header class="header">
            <h1>Braess's Paradox</h1>
            <p class="subtitle">When building new roads makes traffic WORSE</p>
        </header>

        <div class="main-content">
            <div class="network-panel">
                <h2>Without New Road</h2>
                <div class="canvas-container">
                    <canvas id="networkOriginal"></canvas>
                </div>
                <div class="stats-row">
                    <div class="stat-box">
                        <div class="stat-value better" id="timeOriginal">65</div>
                        <div class="stat-label">Total Travel Time (min)</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="flowOriginal">50/50</div>
                        <div class="stat-label">Route Split</div>
                    </div>
                </div>
                <div class="route-legend">
                    <div class="route-item">
                        <div class="route-color" style="background: #3498db;"></div>
                        <span>Upper Route (A‚ÜíB‚ÜíD)</span>
                    </div>
                    <div class="route-item">
                        <div class="route-color" style="background: #e74c3c;"></div>
                        <span>Lower Route (A‚ÜíC‚ÜíD)</span>
                    </div>
                </div>
            </div>

            <div class="network-panel">
                <h2>With New Road (B‚ÜíC)</h2>
                <div class="canvas-container">
                    <canvas id="networkNew"></canvas>
                </div>
                <div class="stats-row">
                    <div class="stat-box">
                        <div class="stat-value worse" id="timeNew">80</div>
                        <div class="stat-label">Total Travel Time (min)</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="flowNew">100%</div>
                        <div class="stat-label">Uses New Road</div>
                    </div>
                </div>
                <div class="route-legend">
                    <div class="route-item">
                        <div class="route-color" style="background: #f39c12;"></div>
                        <span>Everyone takes A‚ÜíB‚ÜíC‚ÜíD!</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="comparison-arrow" id="comparisonArrow">
            ‚ö†Ô∏è +15 minutes worse!
        </div>

        <div class="network-panel" style="margin-bottom: 30px;">
            <h2>Simulation Controls</h2>
            <div class="controls">
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Number of Drivers</span>
                        <span id="driverCount">4000</span>
                    </div>
                    <input type="range" id="driverSlider" min="1000" max="10000" step="500" value="4000">
                </div>
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Simulation Speed</span>
                        <span id="speedLabel">1x</span>
                    </div>
                    <input type="range" id="speedSlider" min="0.5" max="3" step="0.5" value="1">
                </div>
            </div>
        </div>

        <div class="explanation">
            <h2>The Mathematics of Congestion</h2>

            <div class="paradox-box">
                <h3>The Paradox</h3>
                <p>
                    In 1968, mathematician Dietrich Braess proved something shocking: adding extra capacity
                    to a network can make it <strong>less efficient</strong> for everyone.
                    When all drivers optimize selfishly, the equilibrium gets worse!
                </p>
            </div>

            <p>
                Consider our road network: 4,000 drivers travel from A to D.
                Each road has a travel time that depends on traffic:
            </p>

            <div class="math-box">
                <div class="math-row">
                    <div class="math-item">
                        <div class="title">Road A‚ÜíB</div>
                        <div class="value" style="color: var(--car-blue);">T/100 minutes</div>
                        <div class="title">(T = traffic)</div>
                    </div>
                    <div class="math-item">
                        <div class="title">Road B‚ÜíD</div>
                        <div class="value" style="color: var(--flowing);">45 minutes</div>
                        <div class="title">(constant)</div>
                    </div>
                </div>
                <div class="math-row">
                    <div class="math-item">
                        <div class="title">Road A‚ÜíC</div>
                        <div class="value" style="color: var(--flowing);">45 minutes</div>
                        <div class="title">(constant)</div>
                    </div>
                    <div class="math-item">
                        <div class="title">Road C‚ÜíD</div>
                        <div class="value" style="color: var(--congested);">T/100 minutes</div>
                        <div class="title">(T = traffic)</div>
                    </div>
                </div>
                <div class="math-row" style="border-top: 1px solid rgba(255,255,255,0.2); padding-top: 15px;">
                    <div class="math-item">
                        <div class="title">New Road B‚ÜíC</div>
                        <div class="value" style="color: var(--warning);">0 minutes</div>
                        <div class="title">(instant shortcut!)</div>
                    </div>
                </div>
            </div>

            <h3 style="color: var(--car-blue); margin: 20px 0;">Without the New Road:</h3>
            <p>
                Drivers split evenly: 2,000 take the upper route (A‚ÜíB‚ÜíD), 2,000 take the lower route (A‚ÜíC‚ÜíD).
                <br><br>
                <strong>Upper route:</strong> 2000/100 + 45 = <span class="highlight">65 minutes</span><br>
                <strong>Lower route:</strong> 45 + 2000/100 = <span class="highlight">65 minutes</span><br><br>
                This is a <strong>Nash equilibrium</strong>: no driver can improve by switching routes.
            </p>

            <h3 style="color: var(--congested); margin: 20px 0;">With the New Road:</h3>
            <p>
                Now there's a shortcut from B to C that takes 0 minutes. Every rational driver reasons:
                "The A‚ÜíB road is fast, and I can instantly jump to C, then take C‚ÜíD."
                <br><br>
                <strong>Result:</strong> Everyone takes A‚ÜíB‚ÜíC‚ÜíD!<br>
                <strong>Time:</strong> 4000/100 + 0 + 4000/100 = <span class="highlight">80 minutes!</span><br><br>
                The new equilibrium is <strong>15 minutes worse</strong> for everyone!
            </p>

            <div class="paradox-box" style="border-left-color: var(--car-blue);">
                <h3 style="color: var(--car-blue);">Why Does This Happen?</h3>
                <p>
                    The new road creates a <span class="highlight">dominant strategy</span>: regardless of what
                    others do, taking A‚ÜíB‚ÜíC‚ÜíD is always better for an individual driver.
                    But when <em>everyone</em> follows this logic, the congestion-sensitive roads A‚ÜíB and C‚ÜíD
                    both get overloaded. The "shortcut" becomes a trap!
                </p>
            </div>

            <h3 style="color: var(--car-blue); margin: 30px 0 20px;">Real-World Examples</h3>

            <div class="real-world">
                <div class="example-card">
                    <h4>üèôÔ∏è Seoul, South Korea (2003)</h4>
                    <p>
                        When the Cheonggyecheon highway was demolished and replaced with a park,
                        traffic flow in the city actually <strong>improved</strong>! Removing the road
                        forced drivers to use diverse routes, reducing overall congestion.
                    </p>
                </div>

                <div class="example-card">
                    <h4>üá©üá™ Stuttgart, Germany (1969)</h4>
                    <p>
                        A newly opened street had to be closed because it made traffic worse.
                        This was one of the first real-world confirmations of Braess's Paradox.
                    </p>
                </div>

                <div class="example-card">
                    <h4>üóΩ New York City (1990)</h4>
                    <p>
                        During Earth Day 1990, 42nd Street was closed to traffic. Instead of
                        gridlock, traffic throughout Midtown <strong>improved dramatically</strong>.
                    </p>
                </div>

                <div class="example-card">
                    <h4>üåê Internet Routing</h4>
                    <p>
                        The same paradox applies to computer networks! Adding bandwidth can
                        sometimes increase latency when packets are selfishly routed.
                    </p>
                </div>
            </div>

            <div class="paradox-box" style="margin-top: 30px; border-left-color: var(--flowing);">
                <h3 style="color: var(--flowing);">The Solution?</h3>
                <p>
                    <strong>Congestion pricing</strong> (like London's or Singapore's) can fix Braess's Paradox
                    by making drivers internalize the cost they impose on others. Alternatively, closing strategic
                    roads or implementing <strong>coordinated routing</strong> can restore efficiency.
                    The lesson: individual optimization ‚â† collective optimization.
                </p>
            </div>
        </div>
    </div>

    <script>
        // Canvas setup
        const canvasOriginal = document.getElementById('networkOriginal');
        const canvasNew = document.getElementById('networkNew');
        const ctxOriginal = canvasOriginal.getContext('2d');
        const ctxNew = canvasNew.getContext('2d');

        let numDrivers = 4000;
        let simSpeed = 1;
        let cars = { original: [], new: [] };
        let lastTime = 0;

        // Network nodes
        const nodes = {
            A: { x: 0.1, y: 0.5 },
            B: { x: 0.5, y: 0.2 },
            C: { x: 0.5, y: 0.8 },
            D: { x: 0.9, y: 0.5 }
        };

        // Road definitions
        const roads = {
            AB: { from: 'A', to: 'B', congested: true },
            BD: { from: 'B', to: 'D', congested: false },
            AC: { from: 'A', to: 'C', congested: false },
            CD: { from: 'C', to: 'D', congested: true },
            BC: { from: 'B', to: 'C', congested: false, isNew: true }
        };

        function resizeCanvas(canvas) {
            const rect = canvas.parentElement.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            canvas.getContext('2d').scale(dpr, dpr);
        }

        function getNodePos(nodeName, canvas) {
            const dpr = window.devicePixelRatio || 1;
            const width = canvas.width / dpr;
            const height = canvas.height / dpr;
            const node = nodes[nodeName];
            return {
                x: node.x * width,
                y: node.y * height
            };
        }

        function drawNetwork(ctx, canvas, includeNewRoad, traffic) {
            const dpr = window.devicePixelRatio || 1;
            const width = canvas.width / dpr;
            const height = canvas.height / dpr;

            ctx.clearRect(0, 0, width, height);

            // Draw roads
            Object.entries(roads).forEach(([name, road]) => {
                if (road.isNew && !includeNewRoad) return;

                const from = getNodePos(road.from, canvas);
                const to = getNodePos(road.to, canvas);

                // Road background
                ctx.strokeStyle = road.isNew ? '#f39c12' : '#4a4a4a';
                ctx.lineWidth = 15;
                ctx.lineCap = 'round';
                ctx.beginPath();
                ctx.moveTo(from.x, from.y);
                ctx.lineTo(to.x, to.y);
                ctx.stroke();

                // Road surface
                const roadTraffic = traffic[name] || 0;
                const congestionColor = road.congested ?
                    `hsl(${120 - (roadTraffic / numDrivers) * 120}, 70%, 50%)` :
                    '#555';

                ctx.strokeStyle = congestionColor;
                ctx.lineWidth = 10;
                ctx.beginPath();
                ctx.moveTo(from.x, from.y);
                ctx.lineTo(to.x, to.y);
                ctx.stroke();

                // Road label
                const midX = (from.x + to.x) / 2;
                const midY = (from.y + to.y) / 2;
                const time = road.congested ? `${Math.round(roadTraffic/100)}min` : '45min';
                if (road.isNew) {
                    ctx.fillStyle = '#f39c12';
                    ctx.font = 'bold 12px Nunito';
                } else {
                    ctx.fillStyle = 'white';
                    ctx.font = '11px Nunito';
                }
                ctx.textAlign = 'center';
                ctx.fillText(road.isNew ? '0min (NEW!)' : time, midX, midY - 15);
            });

            // Draw nodes
            Object.entries(nodes).forEach(([name, node]) => {
                const pos = getNodePos(name, canvas);

                // Node circle
                ctx.beginPath();
                ctx.arc(pos.x, pos.y, 25, 0, Math.PI * 2);
                ctx.fillStyle = name === 'A' ? '#3498db' :
                               name === 'D' ? '#2ecc71' :
                               '#34495e';
                ctx.fill();
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 2;
                ctx.stroke();

                // Node label
                ctx.fillStyle = 'white';
                ctx.font = 'bold 16px Nunito';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(name, pos.x, pos.y);
            });
        }

        function createCar(route, canvas) {
            return {
                route: route,
                progress: 0,
                segment: 0,
                color: route[0] === 'AB' ? '#3498db' :
                       route[0] === 'AC' ? '#e74c3c' : '#f39c12'
            };
        }

        function updateCars(carsArray, canvas, traffic, dt) {
            const dpr = window.devicePixelRatio || 1;

            carsArray.forEach(car => {
                if (car.segment >= car.route.length) return;

                const roadName = car.route[car.segment];
                const road = roads[roadName];
                const roadTraffic = traffic[roadName] || numDrivers / 2;

                // Speed inversely proportional to traffic for congested roads
                const baseSpeed = road.congested ? 0.3 / (1 + roadTraffic / 2000) : 0.5;
                const speed = baseSpeed * simSpeed * dt / 16;

                car.progress += speed;

                if (car.progress >= 1) {
                    car.progress = 0;
                    car.segment++;
                }
            });

            // Remove completed cars and add new ones
            const completed = carsArray.filter(c => c.segment >= c.route.length).length;
            const remaining = carsArray.filter(c => c.segment < c.route.length);

            return remaining;
        }

        function drawCars(ctx, carsArray, canvas) {
            const dpr = window.devicePixelRatio || 1;

            carsArray.forEach(car => {
                if (car.segment >= car.route.length) return;

                const roadName = car.route[car.segment];
                const road = roads[roadName];
                const from = getNodePos(road.from, canvas);
                const to = getNodePos(road.to, canvas);

                const x = from.x + (to.x - from.x) * car.progress;
                const y = from.y + (to.y - from.y) * car.progress;

                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.fillStyle = car.color;
                ctx.fill();
            });
        }

        function calculateTraffic(includeNewRoad) {
            if (includeNewRoad) {
                // Everyone takes A‚ÜíB‚ÜíC‚ÜíD
                return {
                    AB: numDrivers,
                    BC: numDrivers,
                    CD: numDrivers,
                    AC: 0,
                    BD: 0
                };
            } else {
                // Split evenly
                return {
                    AB: numDrivers / 2,
                    BD: numDrivers / 2,
                    AC: numDrivers / 2,
                    CD: numDrivers / 2
                };
            }
        }

        function calculateTravelTime(traffic, includeNewRoad) {
            if (includeNewRoad) {
                // A‚ÜíB + B‚ÜíC + C‚ÜíD
                return traffic.AB / 100 + 0 + traffic.CD / 100;
            } else {
                // Both routes same: congested + 45
                return traffic.AB / 100 + 45;
            }
        }

        function spawnCars() {
            const routesOriginal = [
                ['AB', 'BD'],  // Upper route
                ['AC', 'CD']   // Lower route
            ];

            const routesNew = [
                ['AB', 'BC', 'CD']  // Everyone takes this
            ];

            // Add a few cars at a time
            const numToAdd = Math.floor(numDrivers / 200);

            for (let i = 0; i < numToAdd; i++) {
                // Original: split evenly
                const route = routesOriginal[Math.floor(Math.random() * 2)];
                if (cars.original.length < numDrivers / 10) {
                    cars.original.push(createCar(route, canvasOriginal));
                }

                // New: everyone takes shortcut
                if (cars.new.length < numDrivers / 10) {
                    cars.new.push(createCar(routesNew[0], canvasNew));
                }
            }
        }

        function updateStats() {
            const trafficOriginal = calculateTraffic(false);
            const trafficNew = calculateTraffic(true);

            const timeOriginal = calculateTravelTime(trafficOriginal, false);
            const timeNew = calculateTravelTime(trafficNew, true);

            document.getElementById('timeOriginal').textContent = Math.round(timeOriginal);
            document.getElementById('timeNew').textContent = Math.round(timeNew);

            const diff = timeNew - timeOriginal;
            const arrow = document.getElementById('comparisonArrow');
            if (diff > 0) {
                arrow.textContent = `‚ö†Ô∏è +${Math.round(diff)} minutes worse!`;
                arrow.style.color = '#e74c3c';
            } else if (diff < 0) {
                arrow.textContent = `‚úì ${Math.round(-diff)} minutes better`;
                arrow.style.color = '#2ecc71';
            } else {
                arrow.textContent = '= Same time';
                arrow.style.color = '#f39c12';
            }
        }

        function animate(currentTime) {
            const dt = currentTime - lastTime;
            lastTime = currentTime;

            resizeCanvas(canvasOriginal);
            resizeCanvas(canvasNew);

            const trafficOriginal = calculateTraffic(false);
            const trafficNew = calculateTraffic(true);

            // Update and draw
            cars.original = updateCars(cars.original, canvasOriginal, trafficOriginal, dt);
            cars.new = updateCars(cars.new, canvasNew, trafficNew, dt);

            spawnCars();

            drawNetwork(ctxOriginal, canvasOriginal, false, trafficOriginal);
            drawNetwork(ctxNew, canvasNew, true, trafficNew);

            drawCars(ctxOriginal, cars.original, canvasOriginal);
            drawCars(ctxNew, cars.new, canvasNew);

            updateStats();

            requestAnimationFrame(animate);
        }

        // Event listeners
        document.getElementById('driverSlider').addEventListener('input', (e) => {
            numDrivers = parseInt(e.target.value);
            document.getElementById('driverCount').textContent = numDrivers;
            cars = { original: [], new: [] };
        });

        document.getElementById('speedSlider').addEventListener('input', (e) => {
            simSpeed = parseFloat(e.target.value);
            document.getElementById('speedLabel').textContent = simSpeed + 'x';
        });

        // Start animation
        requestAnimationFrame(animate);
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
