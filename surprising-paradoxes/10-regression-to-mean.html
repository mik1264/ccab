<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regression to the Mean | Surprising Mathematical Phenomena</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600;700&family=Nunito:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --sage: #8A9A5B;
            --moss: #606C38;
            --earth: #DDA15E;
            --cream: #FEFAE0;
            --terracotta: #BC6C25;
            --dark-moss: #3d4423;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, var(--cream) 0%, #F4F1DE 50%, #EDE8D5 100%);
            min-height: 100vh;
            color: var(--dark-moss);
            overflow-x: hidden;
        }

        .organic-shape {
            position: fixed;
            border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
            opacity: 0.1;
            z-index: 0;
            animation: morph 30s ease-in-out infinite;
        }

        .shape-1 {
            width: 600px;
            height: 600px;
            background: var(--sage);
            top: -200px;
            right: -200px;
        }

        .shape-2 {
            width: 400px;
            height: 400px;
            background: var(--earth);
            bottom: -100px;
            left: -100px;
            animation-delay: -10s;
        }

        @keyframes morph {
            0%, 100% { border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%; }
            25% { border-radius: 58% 42% 75% 25% / 76% 46% 54% 24%; }
            50% { border-radius: 50% 50% 33% 67% / 55% 27% 73% 45%; }
            75% { border-radius: 33% 67% 58% 42% / 63% 68% 32% 37%; }
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: rgba(255,255,255,0.7);
            backdrop-filter: blur(10px);
            border-radius: 50px;
            text-decoration: none;
            color: var(--moss);
            font-weight: 600;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .back-link:hover {
            background: var(--moss);
            color: white;
            transform: translateX(-5px);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 80px 20px 40px;
            position: relative;
            z-index: 1;
        }

        h1 {
            font-family: 'Lora', serif;
            font-size: clamp(2rem, 5vw, 3rem);
            color: var(--moss);
            text-align: center;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            font-size: 1.1rem;
            color: var(--dark-moss);
            opacity: 0.8;
            margin-bottom: 30px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        .content-section {
            background: rgba(255,255,255,0.7);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(138, 154, 91, 0.2);
        }

        .content-section h2 {
            font-family: 'Lora', serif;
            color: var(--moss);
            margin-bottom: 20px;
        }

        .paradox-highlight {
            background: linear-gradient(135deg, rgba(221, 161, 94, 0.2), rgba(188, 108, 37, 0.2));
            border-left: 4px solid var(--terracotta);
            padding: 20px;
            border-radius: 0 15px 15px 0;
            margin-bottom: 25px;
        }

        .paradox-highlight h3 {
            color: var(--terracotta);
            margin-bottom: 10px;
            font-family: 'Lora', serif;
        }

        .simulation-container {
            background: rgba(254, 250, 224, 0.5);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
        }

        .scatter-plot {
            position: relative;
            width: 100%;
            height: 400px;
            background: white;
            border-radius: 10px;
            border: 2px solid var(--moss);
        }

        .scatter-plot canvas {
            width: 100%;
            height: 100%;
        }

        .axis-label {
            position: absolute;
            font-size: 0.9rem;
            color: var(--moss);
            font-weight: 600;
        }

        .axis-label.x {
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
        }

        .axis-label.y {
            top: 50%;
            left: -40px;
            transform: rotate(-90deg) translateX(-50%);
            transform-origin: center;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--sage), var(--moss));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(96, 108, 56, 0.3);
        }

        .btn-secondary {
            background: var(--earth);
            color: white;
        }

        .scenario-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }

        .tab-btn {
            padding: 10px 20px;
            border: 2px solid var(--moss);
            border-radius: 50px;
            background: transparent;
            color: var(--moss);
            cursor: pointer;
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: var(--moss);
            color: white;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: rgba(254, 250, 224, 0.8);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--dark-moss);
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .stat-value {
            font-family: 'Lora', serif;
            font-size: 1.8rem;
            color: var(--moss);
            font-weight: 700;
        }

        .stat-value.highlight {
            color: var(--terracotta);
        }

        .explanation-box {
            background: rgba(254, 250, 224, 0.8);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
        }

        .explanation-box p {
            line-height: 1.7;
            margin-bottom: 10px;
        }

        .highlight {
            background: linear-gradient(90deg, var(--earth), var(--terracotta));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
        }

        .examples-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .example-card {
            background: rgba(255,255,255,0.7);
            border-radius: 15px;
            padding: 20px;
            border-left: 4px solid var(--sage);
        }

        .example-card h4 {
            color: var(--moss);
            margin-bottom: 10px;
        }

        .example-card .wrong {
            color: #e74c3c;
            font-weight: bold;
        }

        .example-card .right {
            color: #27ae60;
            font-weight: bold;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .slider-group {
            margin: 15px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        input[type="range"] {
            width: 200px;
            accent-color: var(--moss);
        }
    </style>
</head>
<body>
    <div class="organic-shape shape-1"></div>
    <div class="organic-shape shape-2"></div>

    <a href="index.html" class="back-link">
        <span>&larr;</span>
        <span>Back to Surprising</span>
    </a>

    <div class="container">
        <h1>Regression to the Mean</h1>
        <p class="subtitle">Extreme performances tend to be followed by less extreme ones. This isn't about skill declining - it's pure statistics, and misunderstanding it leads to costly mistakes.</p>

        <div class="content-section">
            <div class="paradox-highlight">
                <h3>The Sports Illustrated Jinx</h3>
                <p>Athletes who appear on the cover of Sports Illustrated often perform worse afterward. Superstitious fans blame the "jinx." But the real explanation? Athletes make the cover because they just had an <strong>exceptional performance</strong>. Exceptional performances, by definition, are unlikely to repeat - they regress toward average.</p>
            </div>

            <div class="scenario-tabs">
                <button class="tab-btn active" data-scenario="students">Student Test Scores</button>
                <button class="tab-btn" data-scenario="athletes">Athletic Performance</button>
                <button class="tab-btn" data-scenario="pilots">Pilot Training</button>
            </div>

            <div class="simulation-container">
                <h3 style="font-family: 'Lora', serif; color: var(--moss); margin-bottom: 15px; text-align: center;" id="chartTitle">Test 1 Score vs Test 2 Score</h3>

                <div class="scatter-plot">
                    <canvas id="scatterCanvas"></canvas>
                    <div class="axis-label x" id="xLabel">Test 1 Score</div>
                    <div class="axis-label y" id="yLabel">Test 2 Score</div>
                </div>

                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--moss);"></div>
                        <span>Individual data points</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--terracotta);"></div>
                        <span>Top/Bottom performers on Test 1</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ddd; border: 2px dashed #999;"></div>
                        <span>y = x line (no change)</span>
                    </div>
                </div>

                <div class="controls">
                    <button class="btn btn-primary" id="generateBtn">Generate New Data</button>
                    <button class="btn btn-secondary" id="highlightBtn">Highlight Extreme Performers</button>
                </div>

                <div class="slider-group">
                    <label>True Skill Variance: <span id="skillLabel">50%</span></label>
                    <input type="range" id="skillSlider" min="10" max="90" value="50">
                    <small>(Higher = more stable performance; Lower = more random)</small>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Number of Subjects</div>
                    <div class="stat-value" id="subjectCount">100</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Top 10% on Test 1</div>
                    <div class="stat-value" id="top10Avg1">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Same Group on Test 2</div>
                    <div class="stat-value highlight" id="top10Avg2">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Change</div>
                    <div class="stat-value" id="changeValue">-</div>
                </div>
            </div>

            <div class="explanation-box" id="scenarioExplanation">
                <h3 style="color: var(--moss); margin-bottom: 15px; font-family: 'Lora', serif;">What's Happening?</h3>
                <p>Students who scored highest on Test 1 tend to score lower on Test 2 (but still above average). This isn't because they got worse - it's because their Test 1 score was partly due to <span class="highlight">luck</span> (good guesses, favorable questions, good day).</p>
                <p>On Test 2, that luck doesn't repeat, so they regress toward their true ability level. Similarly, the worst performers on Test 1 tend to improve - their bad luck doesn't persist.</p>
            </div>
        </div>

        <div class="content-section">
            <h2>The Dangerous Misinterpretation</h2>

            <div class="examples-grid">
                <div class="example-card">
                    <h4>Medical Treatment Illusion</h4>
                    <p><span class="wrong">Wrong:</span> "The treatment worked! Patients felt better afterward."</p>
                    <p><span class="right">Consider:</span> People seek treatment when symptoms are worst. They'd likely improve anyway due to regression.</p>
                </div>
                <div class="example-card">
                    <h4>Praise vs Punishment</h4>
                    <p><span class="wrong">Wrong:</span> "Criticism works better than praise - performance improves after I criticize."</p>
                    <p><span class="right">Reality:</span> You criticize after bad performance, which naturally regresses up. You praise after good performance, which regresses down.</p>
                </div>
                <div class="example-card">
                    <h4>Speed Camera Effectiveness</h4>
                    <p><span class="wrong">Wrong:</span> "Accident rates dropped 30% after installing cameras!"</p>
                    <p><span class="right">Consider:</span> Cameras are installed where accidents spiked. Some regression was inevitable.</p>
                </div>
                <div class="example-card">
                    <h4>CEO Performance</h4>
                    <p><span class="wrong">Wrong:</span> "The new CEO turned things around!"</p>
                    <p><span class="right">Consider:</span> New CEOs are hired when companies are struggling. Partial recovery is statistically expected.</p>
                </div>
            </div>
        </div>

        <div class="content-section">
            <h2>The Israeli Air Force Story</h2>

            <div class="explanation-box">
                <p>Daniel Kahneman (Nobel Prize winner) tells of advising Israeli Air Force flight instructors. The instructors insisted that <span class="highlight">punishment worked better than praise</span>.</p>
                <p>Their evidence: When they praised a cadet for an exceptional maneuver, the next attempt was usually worse. When they criticized a poor maneuver, the next was usually better.</p>
                <p>Kahneman realized this was pure regression to the mean. The instructors' beliefs about teaching were shaped by a statistical artifact! Praise and criticism were equally (in)effective - the regression would happen either way.</p>
                <p>This insight was one of the seeds that led to behavioral economics and Kahneman's Nobel Prize.</p>
            </div>
        </div>

        <div class="content-section">
            <h2>How to Recognize Regression</h2>

            <div class="explanation-box">
                <p><strong>Ask yourself:</strong> Was the initial measurement selected because it was extreme?</p>
                <ul style="margin: 15px 0 0 20px; line-height: 2;">
                    <li>Did we intervene because things were especially bad/good?</li>
                    <li>Are we comparing to a selected baseline?</li>
                    <li>Is there randomness in the measurement?</li>
                </ul>
                <p style="margin-top: 15px;"><strong>The fix:</strong> Use control groups! Without a comparison group that received no intervention, you can't distinguish real effects from regression.</p>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('scatterCanvas');
        const ctx = canvas.getContext('2d');

        let data = [];
        let skillVariance = 0.5;
        let highlighted = false;

        const scenarios = {
            students: {
                title: 'Test 1 Score vs Test 2 Score',
                xLabel: 'Test 1 Score',
                yLabel: 'Test 2 Score',
                explanation: `<h3 style="color: var(--moss); margin-bottom: 15px; font-family: 'Lora', serif;">What's Happening?</h3>
                    <p>Students who scored highest on Test 1 tend to score lower on Test 2 (but still above average). This isn't because they got worse - it's because their Test 1 score was partly due to <span class="highlight">luck</span> (good guesses, favorable questions, good day).</p>
                    <p>On Test 2, that luck doesn't repeat, so they regress toward their true ability level. Similarly, the worst performers on Test 1 tend to improve - their bad luck doesn't persist.</p>`
            },
            athletes: {
                title: 'Season 1 Performance vs Season 2 Performance',
                xLabel: 'Season 1 Stats',
                yLabel: 'Season 2 Stats',
                explanation: `<h3 style="color: var(--moss); margin-bottom: 15px; font-family: 'Lora', serif;">The Sophomore Slump</h3>
                    <p>Rookie of the Year winners often underperform in year two. This "sophomore slump" is mostly regression to the mean, not pressure or burnout.</p>
                    <p>A standout rookie season requires both <span class="highlight">skill AND luck</span>. The skill persists, but the luck doesn't, leading to a statistically predictable decline.</p>`
            },
            pilots: {
                title: 'Maneuver 1 Score vs Maneuver 2 Score',
                xLabel: 'First Attempt',
                yLabel: 'Second Attempt',
                explanation: `<h3 style="color: var(--moss); margin-bottom: 15px; font-family: 'Lora', serif;">The Kahneman Insight</h3>
                    <p>Israeli flight instructors believed criticism was more effective than praise because performance improved after criticism but worsened after praise.</p>
                    <p>But this is just regression! You criticize the worst attempts (which regress up) and praise the best (which regress down). <span class="highlight">The teaching method had nothing to do with it.</span></p>`
            }
        };

        function resizeCanvas() {
            const rect = canvas.parentElement.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
        }

        function generateData(n = 100) {
            data = [];
            for (let i = 0; i < n; i++) {
                // True skill (stable component)
                const trueSkill = gaussianRandom(50, 15);

                // Test 1: true skill + random noise
                const noiseVariance = (1 - skillVariance) * 20;
                const test1 = trueSkill + gaussianRandom(0, noiseVariance);

                // Test 2: same true skill + different random noise
                const test2 = trueSkill + gaussianRandom(0, noiseVariance);

                data.push({
                    trueSkill,
                    test1: Math.max(0, Math.min(100, test1)),
                    test2: Math.max(0, Math.min(100, test2))
                });
            }
            highlighted = false;
        }

        function gaussianRandom(mean, std) {
            let u = 0, v = 0;
            while (u === 0) u = Math.random();
            while (v === 0) v = Math.random();
            return mean + std * Math.sqrt(-2 * Math.log(u)) * Math.cos(2 * Math.PI * v);
        }

        function draw() {
            resizeCanvas();
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const padding = 50;
            const plotWidth = canvas.width - padding * 2;
            const plotHeight = canvas.height - padding * 2;

            // Draw axes
            ctx.strokeStyle = '#888';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, canvas.height - padding);
            ctx.lineTo(canvas.width - padding, canvas.height - padding);
            ctx.stroke();

            // Draw y=x line (dashed)
            ctx.strokeStyle = '#ccc';
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(padding, canvas.height - padding);
            ctx.lineTo(canvas.width - padding, padding);
            ctx.stroke();
            ctx.setLineDash([]);

            // Find top and bottom 10%
            const sorted = [...data].sort((a, b) => b.test1 - a.test1);
            const topN = Math.floor(data.length * 0.1);
            const topPerformers = sorted.slice(0, topN);
            const bottomPerformers = sorted.slice(-topN);

            // Draw points
            data.forEach(d => {
                const x = padding + (d.test1 / 100) * plotWidth;
                const y = canvas.height - padding - (d.test2 / 100) * plotHeight;

                const isTop = highlighted && topPerformers.includes(d);
                const isBottom = highlighted && bottomPerformers.includes(d);

                ctx.beginPath();
                ctx.arc(x, y, isTop || isBottom ? 8 : 5, 0, Math.PI * 2);

                if (isTop) {
                    ctx.fillStyle = 'rgba(188, 108, 37, 0.8)';
                } else if (isBottom) {
                    ctx.fillStyle = 'rgba(188, 108, 37, 0.5)';
                } else {
                    ctx.fillStyle = 'rgba(96, 108, 56, 0.5)';
                }
                ctx.fill();
            });

            // Update stats
            if (highlighted) {
                const topAvg1 = topPerformers.reduce((s, d) => s + d.test1, 0) / topN;
                const topAvg2 = topPerformers.reduce((s, d) => s + d.test2, 0) / topN;
                const change = topAvg2 - topAvg1;

                document.getElementById('top10Avg1').textContent = topAvg1.toFixed(1);
                document.getElementById('top10Avg2').textContent = topAvg2.toFixed(1);
                document.getElementById('changeValue').textContent = (change >= 0 ? '+' : '') + change.toFixed(1);
                document.getElementById('changeValue').style.color = change < 0 ? '#e74c3c' : '#27ae60';
            }
        }

        function updateScenario(scenario) {
            const s = scenarios[scenario];
            document.getElementById('chartTitle').textContent = s.title;
            document.getElementById('xLabel').textContent = s.xLabel;
            document.getElementById('yLabel').textContent = s.yLabel;
            document.getElementById('scenarioExplanation').innerHTML = s.explanation;
        }

        document.getElementById('generateBtn').addEventListener('click', () => {
            generateData();
            draw();
        });

        document.getElementById('highlightBtn').addEventListener('click', () => {
            highlighted = !highlighted;
            draw();
        });

        document.getElementById('skillSlider').addEventListener('input', (e) => {
            skillVariance = parseInt(e.target.value) / 100;
            document.getElementById('skillLabel').textContent = e.target.value + '%';
            generateData();
            draw();
        });

        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                updateScenario(this.dataset.scenario);
                generateData();
                draw();
            });
        });

        window.addEventListener('resize', draw);

        generateData();
        draw();
    </script>
</body>
</html>
