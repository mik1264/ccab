<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The St. Petersburg Paradox - Surprising Paradoxes</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600;700&family=Nunito:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --sage: #8A9A5B;
            --moss: #606C38;
            --earth: #DDA15E;
            --cream: #FEFAE0;
            --terracotta: #BC6C25;
            --dark-moss: #3d4423;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #FEFAE0 0%, #F4F1DE 50%, #EDE8D5 100%);
            min-height: 100vh;
            color: var(--dark-moss);
            line-height: 1.7;
        }
        .organic-shape {
            position: fixed;
            border-radius: 60% 40% 50% 50% / 50% 60% 40% 50%;
            opacity: 0.12;
            z-index: 0;
            animation: morph 30s ease-in-out infinite;
        }
        .shape-1 { width: 600px; height: 600px; background: var(--sage); top: -200px; right: -150px; }
        .shape-2 { width: 500px; height: 500px; background: var(--earth); bottom: -150px; left: -150px; animation-delay: -15s; }
        @keyframes morph {
            0%, 100% { border-radius: 60% 40% 50% 50% / 50% 60% 40% 50%; }
            25% { border-radius: 50% 60% 40% 50% / 40% 50% 60% 50%; }
            50% { border-radius: 40% 50% 60% 50% / 50% 40% 50% 60%; }
            75% { border-radius: 50% 40% 50% 60% / 60% 50% 40% 50%; }
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px 80px;
            position: relative;
            z-index: 1;
        }
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--moss);
            text-decoration: none;
            font-weight: 500;
            margin-bottom: 30px;
            padding: 10px 20px;
            background: rgba(255,255,255,0.6);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            transition: all 0.3s ease;
        }
        .back-link:hover { background: rgba(255,255,255,0.9); transform: translateX(-5px); }
        h1 { font-family: 'Lora', serif; font-size: 2.8rem; color: var(--moss); margin-bottom: 20px; }
        .subtitle { font-size: 1.3rem; color: var(--terracotta); margin-bottom: 40px; font-weight: 500; }
        .section {
            background: rgba(255,255,255,0.6);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(138,154,91,0.2);
        }
        h2 { font-family: 'Lora', serif; font-size: 1.6rem; color: var(--moss); margin-bottom: 20px; }
        p { margin-bottom: 15px; color: #555; }
        .highlight {
            background: linear-gradient(135deg, rgba(221,161,94,0.15), rgba(138,154,91,0.15));
            border-left: 4px solid var(--earth);
            padding: 20px 25px;
            border-radius: 0 15px 15px 0;
            margin: 25px 0;
        }
        .highlight p { margin-bottom: 0; font-weight: 500; color: var(--dark-moss); }

        /* Game Container */
        .game-container {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border-radius: 20px;
            padding: 40px 30px;
            text-align: center;
            color: #e8e8f8;
        }
        .game-title {
            font-family: 'Lora', serif;
            font-size: 1.6rem;
            color: #ffd700;
            margin-bottom: 20px;
        }

        /* Coin */
        .coin-container {
            margin: 30px 0;
            perspective: 1000px;
        }
        .coin {
            width: 100px;
            height: 100px;
            margin: 0 auto;
            background: linear-gradient(135deg, #ffd700, #b8860b);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.4);
            transition: transform 0.1s ease;
        }
        .coin.flipping {
            animation: coinFlip 0.5s ease-in-out;
        }
        @keyframes coinFlip {
            0% { transform: rotateY(0deg); }
            50% { transform: rotateY(180deg); }
            100% { transform: rotateY(360deg); }
        }

        /* Stats */
        .game-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }
        .stat-box {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 12px;
        }
        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #ffd700;
        }
        .stat-label {
            font-size: 0.8rem;
            color: #a8b2d1;
            margin-top: 5px;
        }

        /* Controls */
        .game-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        .game-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 30px;
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .game-btn.primary {
            background: linear-gradient(135deg, #ffd700, #ffb700);
            color: #1a1a2e;
        }
        .game-btn.primary:hover { transform: scale(1.05); }
        .game-btn.secondary {
            background: rgba(255,255,255,0.1);
            color: #e8e8f8;
            border: 2px solid rgba(255,255,255,0.3);
        }
        .game-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        /* Flip Log */
        .flip-log {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 15px;
            margin: 20px 0;
            max-height: 150px;
            overflow-y: auto;
            text-align: left;
            font-family: monospace;
            font-size: 0.9rem;
        }
        .flip-entry { padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .flip-entry:last-child { border-bottom: none; }
        .heads { color: #4ade80; }
        .tails { color: #f87171; }

        /* Payout Table */
        .payout-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .payout-table th, .payout-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid rgba(138,154,91,0.2);
        }
        .payout-table th {
            background: rgba(138,154,91,0.1);
            color: var(--moss);
            font-weight: 600;
        }

        /* Math Box */
        .math-box {
            background: #f5f5f5;
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: center;
            overflow-x: auto;
        }
        .math-equation {
            font-family: 'Georgia', serif;
            font-size: 1.1rem;
            color: var(--dark-moss);
            margin: 10px 0;
        }

        /* History Chart */
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }
        .chart-area {
            height: 250px;
            position: relative;
        }
        canvas { width: 100%; height: 100%; }

        @media (max-width: 768px) {
            h1 { font-size: 2rem; }
            .coin { width: 80px; height: 80px; font-size: 2.5rem; }
        }
    </style>
</head>
<body>
    <div class="organic-shape shape-1"></div>
    <div class="organic-shape shape-2"></div>

    <main class="container">
        <a href="index.html" class="back-link">‚Üê Back to Paradoxes</a>

        <h1>The St. Petersburg Paradox</h1>
        <p class="subtitle">A game worth infinite money that no one would pay $20 to play</p>

        <div class="section">
            <h2>The Game</h2>
            <p>Imagine a simple gambling game: A fair coin is flipped repeatedly until it lands on tails. Your payout is $2<sup>n</sup> where n is the number of flips.</p>

            <ul style="margin: 15px 0 25px 25px; color: #555;">
                <li>Tails on flip 1: Win <strong>$2</strong></li>
                <li>Heads, then Tails: Win <strong>$4</strong></li>
                <li>Two Heads, then Tails: Win <strong>$8</strong></li>
                <li>Three Heads, then Tails: Win <strong>$16</strong></li>
                <li>...and so on, doubling each time</li>
            </ul>

            <p><strong>How much would you pay to play this game?</strong></p>

            <div class="highlight">
                <p>Mathematically, the expected value is <strong>infinite</strong>. But most people wouldn't pay more than $10-$25.</p>
            </div>
        </div>

        <div class="section">
            <h2>Play the Game</h2>

            <div class="game-container">
                <h3 class="game-title">üé∞ St. Petersburg Lottery üé∞</h3>

                <div class="coin-container">
                    <div class="coin" id="coin">ü™ô</div>
                </div>

                <div class="game-stats">
                    <div class="stat-box">
                        <div class="stat-value" id="currentFlips">0</div>
                        <div class="stat-label">Current Flips</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="potentialWin">$2</div>
                        <div class="stat-label">Potential Win</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="gamesPlayed">0</div>
                        <div class="stat-label">Games Played</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="totalWinnings">$0</div>
                        <div class="stat-label">Total Winnings</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="averageWin">$0</div>
                        <div class="stat-label">Average Win</div>
                    </div>
                </div>

                <div class="flip-log" id="flipLog">
                    <div class="flip-entry">Click "Flip Coin" to start...</div>
                </div>

                <div class="game-controls">
                    <button class="game-btn primary" id="flipBtn">ü™ô Flip Coin</button>
                    <button class="game-btn secondary" id="autoBtn">‚ö° Auto-Play 100 Games</button>
                    <button class="game-btn secondary" id="resetBtn">üîÑ Reset</button>
                </div>
            </div>

            <div class="chart-container">
                <h3 style="color: var(--moss); margin-bottom: 15px; font-family: 'Lora', serif;">Cumulative Average Winnings</h3>
                <div class="chart-area">
                    <canvas id="avgChart"></canvas>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>Why the Expected Value is Infinite</h2>

            <p>Expected value is calculated by multiplying each outcome by its probability and summing:</p>

            <table class="payout-table">
                <thead>
                    <tr>
                        <th>Flips (n)</th>
                        <th>Payout</th>
                        <th>Probability</th>
                        <th>Expected Value</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>1</td><td>$2</td><td>1/2</td><td>$1</td></tr>
                    <tr><td>2</td><td>$4</td><td>1/4</td><td>$1</td></tr>
                    <tr><td>3</td><td>$8</td><td>1/8</td><td>$1</td></tr>
                    <tr><td>4</td><td>$16</td><td>1/16</td><td>$1</td></tr>
                    <tr><td>...</td><td>...</td><td>...</td><td>$1</td></tr>
                    <tr><td>n</td><td>$2<sup>n</sup></td><td>(1/2)<sup>n</sup></td><td>$1</td></tr>
                </tbody>
            </table>

            <div class="math-box">
                <div class="math-equation">E[X] = Œ£ (payout √ó probability)</div>
                <div class="math-equation">= $1 + $1 + $1 + $1 + ... = <strong>‚àû</strong></div>
            </div>

            <p>Each flip contributes exactly $1 to the expected value. With infinitely many possible outcomes, the sum diverges to infinity!</p>
        </div>

        <div class="section">
            <h2>The Paradox</h2>

            <p>If the expected value is infinite, a rational person should pay <em>any finite amount</em> to play. But in experiments, most people refuse to pay more than $10-25. Why?</p>

            <div style="display: grid; gap: 20px; margin: 25px 0;">
                <div style="background: rgba(138,154,91,0.08); padding: 20px; border-radius: 15px; border-left: 4px solid var(--sage);">
                    <strong style="color: var(--moss);">üí° Diminishing Marginal Utility</strong>
                    <p style="margin: 10px 0 0 0;">Daniel Bernoulli (1738) proposed that the <em>utility</em> of money decreases as you get more. Winning $1 million vs $2 million doesn't feel twice as good. Using logarithmic utility, the expected utility becomes finite.</p>
                </div>

                <div style="background: rgba(138,154,91,0.08); padding: 20px; border-radius: 15px; border-left: 4px solid var(--sage);">
                    <strong style="color: var(--moss);">üè¶ Practical Constraints</strong>
                    <p style="margin: 10px 0 0 0;">No casino has infinite money. If payouts are capped at $1 billion, the expected value drops to about $30. Real-world constraints make the infinite expectation meaningless.</p>
                </div>

                <div style="background: rgba(138,154,91,0.08); padding: 20px; border-radius: 15px; border-left: 4px solid var(--sage);">
                    <strong style="color: var(--moss);">üìä Median vs Mean</strong>
                    <p style="margin: 10px 0 0 0;">The median payout is just $2 (50% chance of tails on first flip). While the mean is infinite, half the time you win only $2. Most individual experiences are disappointing.</p>
                </div>

                <div style="background: rgba(138,154,91,0.08); padding: 20px; border-radius: 15px; border-left: 4px solid var(--sage);">
                    <strong style="color: var(--moss);">üé≤ Ergodicity</strong>
                    <p style="margin: 10px 0 0 0;">The expected value assumes you can play infinitely many times. For a single player, the time-average (what you actually experience) differs from the ensemble average (the mathematical expectation).</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>Historical Context</h2>

            <p>This paradox was first proposed by Nicolas Bernoulli in 1713 and analyzed by his cousin Daniel Bernoulli in 1738. It's named after the St. Petersburg Academy where Daniel published his solution.</p>

            <p>The paradox has influenced centuries of economic thought, leading to the development of expected utility theory, risk aversion models, and modern behavioral economics.</p>

            <div class="highlight">
                <p><strong>Key Insight:</strong> Expected value alone is not sufficient for decision-making. Risk, utility, and practical constraints all matter.</p>
            </div>
        </div>
    </main>

    <script>
        // Game state
        let currentFlips = 0;
        let gamesPlayed = 0;
        let totalWinnings = 0;
        let isFlipping = false;
        let gameInProgress = false;
        let winHistory = [];

        const coin = document.getElementById('coin');
        const flipLog = document.getElementById('flipLog');

        function updateDisplay() {
            document.getElementById('currentFlips').textContent = currentFlips;
            document.getElementById('potentialWin').textContent = '$' + Math.pow(2, currentFlips + 1).toLocaleString();
            document.getElementById('gamesPlayed').textContent = gamesPlayed;
            document.getElementById('totalWinnings').textContent = '$' + totalWinnings.toLocaleString();
            document.getElementById('averageWin').textContent = gamesPlayed > 0 ?
                '$' + (totalWinnings / gamesPlayed).toFixed(2) : '$0';
        }

        function flipCoin() {
            if (isFlipping) return;

            if (!gameInProgress) {
                // Start new game
                gameInProgress = true;
                currentFlips = 0;
                flipLog.innerHTML = '';
            }

            isFlipping = true;
            coin.classList.add('flipping');

            setTimeout(() => {
                const isHeads = Math.random() < 0.5;
                coin.textContent = isHeads ? 'üëë' : 'ü¶Ö';
                coin.classList.remove('flipping');

                currentFlips++;

                const entry = document.createElement('div');
                entry.className = 'flip-entry';
                entry.innerHTML = `Flip ${currentFlips}: <span class="${isHeads ? 'heads' : 'tails'}">${isHeads ? 'HEADS' : 'TAILS'}</span>`;
                flipLog.appendChild(entry);
                flipLog.scrollTop = flipLog.scrollHeight;

                if (!isHeads) {
                    // Game over - tails
                    const winnings = Math.pow(2, currentFlips);
                    totalWinnings += winnings;
                    gamesPlayed++;
                    winHistory.push(winnings);

                    entry.innerHTML += ` - <strong style="color: #ffd700;">WIN $${winnings.toLocaleString()}!</strong>`;

                    gameInProgress = false;
                    updateChart();
                }

                updateDisplay();
                isFlipping = false;
            }, 500);
        }

        function playGame() {
            // Play a complete game automatically
            let flips = 0;
            while (true) {
                flips++;
                if (Math.random() >= 0.5) { // Tails
                    return Math.pow(2, flips);
                }
            }
        }

        function autoPlay(count) {
            document.getElementById('autoBtn').disabled = true;
            document.getElementById('flipBtn').disabled = true;

            let i = 0;
            const interval = setInterval(() => {
                const win = playGame();
                totalWinnings += win;
                gamesPlayed++;
                winHistory.push(win);

                i++;
                if (i >= count) {
                    clearInterval(interval);
                    document.getElementById('autoBtn').disabled = false;
                    document.getElementById('flipBtn').disabled = false;
                    flipLog.innerHTML = `<div class="flip-entry">Completed ${count} games automatically.</div>
                        <div class="flip-entry">Best win: $${Math.max(...winHistory.slice(-count)).toLocaleString()}</div>
                        <div class="flip-entry">Average: $${(totalWinnings / gamesPlayed).toFixed(2)}</div>`;
                    updateChart();
                }
                updateDisplay();
            }, 10);
        }

        function reset() {
            currentFlips = 0;
            gamesPlayed = 0;
            totalWinnings = 0;
            gameInProgress = false;
            winHistory = [];
            coin.textContent = 'ü™ô';
            flipLog.innerHTML = '<div class="flip-entry">Click "Flip Coin" to start...</div>';
            updateDisplay();
            updateChart();
        }

        // Chart
        const canvas = document.getElementById('avgChart');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            const rect = canvas.parentElement.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            canvas.style.width = rect.width + 'px';
            canvas.style.height = rect.height + 'px';
            updateChart();
        }

        function updateChart() {
            const rect = canvas.parentElement.getBoundingClientRect();
            const width = rect.width;
            const height = rect.height;

            ctx.clearRect(0, 0, width, height);

            if (winHistory.length < 2) {
                ctx.fillStyle = '#888';
                ctx.font = '14px Nunito';
                ctx.textAlign = 'center';
                ctx.fillText('Play some games to see the chart...', width / 2, height / 2);
                return;
            }

            const padding = { top: 20, right: 20, bottom: 40, left: 60 };
            const chartWidth = width - padding.left - padding.right;
            const chartHeight = height - padding.top - padding.bottom;

            // Calculate cumulative averages
            const cumulativeAvg = [];
            let sum = 0;
            for (let i = 0; i < winHistory.length; i++) {
                sum += winHistory[i];
                cumulativeAvg.push(sum / (i + 1));
            }

            const maxAvg = Math.max(...cumulativeAvg, 10);

            // Axes
            ctx.strokeStyle = '#ddd';
            ctx.beginPath();
            ctx.moveTo(padding.left, padding.top);
            ctx.lineTo(padding.left, height - padding.bottom);
            ctx.lineTo(width - padding.right, height - padding.bottom);
            ctx.stroke();

            // Y axis labels
            ctx.fillStyle = '#888';
            ctx.font = '11px Nunito';
            ctx.textAlign = 'right';
            for (let i = 0; i <= 4; i++) {
                const val = (maxAvg * i / 4).toFixed(0);
                const y = height - padding.bottom - (i / 4) * chartHeight;
                ctx.fillText('$' + val, padding.left - 8, y + 4);
            }

            // X axis label
            ctx.textAlign = 'center';
            ctx.fillText('Games Played', width / 2, height - 5);

            // Draw line
            ctx.beginPath();
            ctx.strokeStyle = '#606C38';
            ctx.lineWidth = 2;
            for (let i = 0; i < cumulativeAvg.length; i++) {
                const x = padding.left + (i / (cumulativeAvg.length - 1)) * chartWidth;
                const y = height - padding.bottom - (cumulativeAvg[i] / maxAvg) * chartHeight;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();

            // Expected value reference line (would be infinity, show a note)
            ctx.fillStyle = 'rgba(188,108,37,0.3)';
            ctx.fillRect(padding.left, padding.top, chartWidth, 20);
            ctx.fillStyle = '#BC6C25';
            ctx.font = 'bold 10px Nunito';
            ctx.textAlign = 'left';
            ctx.fillText('E[X] = ‚àû (expected value is infinite!)', padding.left + 10, padding.top + 14);
        }

        // Event listeners
        document.getElementById('flipBtn').addEventListener('click', flipCoin);
        document.getElementById('autoBtn').addEventListener('click', () => autoPlay(100));
        document.getElementById('resetBtn').addEventListener('click', reset);

        window.addEventListener('resize', resizeCanvas);

        // Initialize
        updateDisplay();
        resizeCanvas();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
