<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Pigeonhole Paradox - Three Particles, Two Boxes, Zero Sharing</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a0a 50%, #0a1a1a 100%);
            color: #e0e0e0;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 1px solid rgba(100, 200, 150, 0.3);
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5em;
            background: linear-gradient(135deg, #64c896, #96c864);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2em;
            color: #888;
            font-style: italic;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        @media (max-width: 1000px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .visualization-section {
            background: rgba(20, 30, 20, 0.8);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(100, 200, 150, 0.3);
        }

        canvas {
            width: 100%;
            border-radius: 10px;
            background: #050808;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }

        button {
            padding: 10px 20px;
            font-size: 14px;
            cursor: pointer;
            border: none;
            border-radius: 25px;
            background: linear-gradient(135deg, #64c896, #4a9670);
            color: white;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(100, 200, 150, 0.4);
        }

        button.active {
            background: linear-gradient(135deg, #c89664, #967048);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .stat-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 12px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-label {
            font-size: 10px;
            color: #888;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 16px;
            font-weight: bold;
            color: #64c896;
        }

        .paradox-box {
            background: linear-gradient(135deg, rgba(200, 100, 100, 0.2), rgba(200, 50, 50, 0.3));
            border: 1px solid rgba(200, 100, 100, 0.5);
        }

        .paradox-box .stat-value {
            color: #ff8866;
        }

        .phase-indicator {
            text-align: center;
            padding: 10px;
            margin-top: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            font-size: 14px;
        }

        .essay-section {
            background: rgba(20, 30, 20, 0.6);
            border-radius: 15px;
            padding: 30px;
            border: 1px solid rgba(100, 200, 150, 0.2);
            max-height: 800px;
            overflow-y: auto;
        }

        .essay-section h2 {
            color: #64c896;
            margin: 25px 0 15px 0;
            font-size: 1.4em;
        }

        .essay-section h2:first-child {
            margin-top: 0;
        }

        .essay-section p {
            line-height: 1.8;
            margin-bottom: 15px;
            text-align: justify;
        }

        .equation {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            font-size: 14px;
            overflow-x: auto;
        }

        .highlight {
            color: #96c864;
            font-weight: bold;
        }

        .warning {
            color: #ff8866;
            font-weight: bold;
        }

        .diagram {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
            white-space: pre;
            overflow-x: auto;
        }

        .sources {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(100, 200, 150, 0.3);
            font-size: 0.9em;
        }

        .sources h3 {
            color: #64c896;
            margin-bottom: 10px;
        }

        .sources ul {
            list-style: none;
            padding: 0;
        }

        .sources li {
            margin: 8px 0;
            padding-left: 15px;
            border-left: 2px solid #4a9670;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #64c896;
            text-decoration: none;
            font-size: 14px;
        }

        .back-link:hover {
            color: #96c864;
        }

        .mode-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: 8px 15px;
            font-size: 12px;
            background: rgba(100, 200, 150, 0.2);
            border: 1px solid rgba(100, 200, 150, 0.3);
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #64c896, #4a9670);
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">← Back to Paradoxes</a>

        <header>
            <h1>Quantum Pigeonhole Paradox</h1>
            <p class="subtitle">Three particles in two boxes, yet no two share a box</p>
        </header>

        <div class="main-content">
            <div class="visualization-section">
                <div class="mode-selector">
                    <button class="mode-btn active" data-mode="classical">Classical</button>
                    <button class="mode-btn" data-mode="quantum">Quantum</button>
                    <button class="mode-btn" data-mode="weak">Weak Measurement</button>
                </div>

                <canvas id="canvas" width="600" height="450"></canvas>

                <div class="phase-indicator" id="phaseIndicator">
                    Click "Run Experiment" to begin
                </div>

                <div class="controls">
                    <button id="btnRun" class="active">Run Experiment</button>
                    <button id="btnStep">Step by Step</button>
                    <button id="btnReset">Reset Stats</button>
                </div>

                <div class="stats">
                    <div class="stat-box">
                        <div class="stat-label">Experiments</div>
                        <div class="stat-value" id="totalExperiments">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Box L Pairs</div>
                        <div class="stat-value" id="pairsL">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Box R Pairs</div>
                        <div class="stat-value" id="pairsR">0</div>
                    </div>
                    <div class="stat-box paradox-box">
                        <div class="stat-label">No Pairs Found</div>
                        <div class="stat-value" id="noPairs">0</div>
                    </div>
                    <div class="stat-box paradox-box">
                        <div class="stat-label">Paradox Rate</div>
                        <div class="stat-value" id="paradoxRate">0%</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Expected Classical</div>
                        <div class="stat-value">100%</div>
                    </div>
                </div>
            </div>

            <div class="essay-section">
                <h2>Violating a "Fundamental Truth"</h2>
                <p>
                    The <span class="highlight">pigeonhole principle</span> seems self-evident: if you put
                    three pigeons into two holes, at least two pigeons must share a hole. This is not
                    just intuition—it's a cornerstone of combinatorial mathematics, used in countless proofs.
                </p>

                <p>
                    Yet in 2014, <span class="highlight">Yakir Aharonov</span> and colleagues showed that
                    quantum mechanics can violate this "fundamental truth." When three quantum particles
                    are placed in two boxes with specific pre- and post-selection, you can verify that
                    <span class="warning">no two particles share a box</span>—an apparent impossibility!
                </p>

                <h2>The Setup</h2>
                <p>
                    The experiment uses three particles (typically photons) and two "boxes"
                    (polarization states: horizontal H and vertical V). The key is the measurement protocol:
                </p>

                <div class="diagram">
    STEP 1: Pre-selection
    Prepare all 3 particles in superposition: |+⟩ = (|H⟩ + |V⟩)/√2

    STEP 2: Weak measurement
    Gently probe whether any pair shares a box
    (Minimal disturbance preserves superposition)

    STEP 3: Post-selection
    Select only cases where all particles end in |−⟩ = (|H⟩ - |V⟩)/√2
                </div>

                <h2>The Mathematics</h2>
                <p>
                    Define projection operators for "particles i and j in the same box":
                </p>

                <div class="equation">
Π_ij^(same) = |HH⟩⟨HH| + |VV⟩⟨VV|

For pre-selection |ψ_i⟩ = |+⟩ and post-selection |ψ_f⟩ = |−⟩⊗³

Weak value: ⟨Π_ij^(same)⟩_w = ⟨ψ_f|Π_ij^(same)|ψ_i⟩ / ⟨ψ_f|ψ_i⟩ = 0
                </div>

                <p>
                    The weak value is <span class="highlight">zero for ALL pairs</span>! This means
                    when you weakly measure "are particles 1 and 2 in the same box?"—NO. Particles 2 and 3?—NO.
                    Particles 1 and 3?—NO. Yet all three particles ARE somewhere!
                </p>

                <h2>Why Weak Measurements?</h2>
                <p>
                    A <span class="highlight">strong measurement</span> would collapse the superposition,
                    forcing particles into definite boxes where the pigeonhole principle holds.
                    <span class="highlight">Weak measurements</span>, invented by Aharonov in 1988,
                    extract information with minimal disturbance—revealing quantum "hidden" values.
                </p>

                <p>
                    Think of it like trying to determine if two people are in the same room by
                    listening at the door versus barging in. The gentle approach reveals a different reality.
                </p>

                <h2>Experimental Confirmation</h2>
                <p>
                    In 2019, Chen et al. experimentally demonstrated the paradox using three single photons.
                    Using weak-strength polarization measurements, they showed that in the pre/post-selected
                    ensemble, <span class="warning">no two photons occupied the same polarization state</span>.
                </p>

                <p>
                    The experiments confirmed that the paradox only survives under <span class="highlight">
                    first-order weak measurement</span>. Higher-order (stronger) measurements restore
                    classical counting—the pigeonhole principle reasserts itself when you look too hard.
                </p>

                <h2>The Deeper Meaning</h2>
                <p>
                    The quantum pigeonhole paradox reveals that quantum particles don't have definite
                    properties until measured strongly. The question "are two particles in the same box?"
                    doesn't have a classical answer in quantum superposition.
                </p>

                <p>
                    Aharonov argues this demonstrates a new kind of <span class="highlight">quantum correlation</span>,
                    complementary to entanglement. Three uncorrelated particles become "more strongly correlated
                    than classically possible" simply by being squeezed into two boxes.
                </p>

                <div class="equation">
Classical: N particles → 2 boxes → at least ⌈N/2⌉ share

Quantum: 3 particles → 2 boxes → 0 pairs (in weak regime)!
                </div>

                <h2>Implications for Reality</h2>
                <p>
                    The paradox raises profound questions: Do quantum particles exist in boxes before
                    we measure them? The weak values suggest they exist in a "suspended" state where
                    counting principles don't apply.
                </p>

                <p>
                    Critics argue the paradox relies on unusual definitions of "occupation" via weak values.
                    Supporters counter that weak values reveal genuine quantum properties hidden from
                    strong measurements.
                </p>

                <h2>Connection to Other Paradoxes</h2>
                <p>
                    The quantum pigeonhole relates to <span class="highlight">Hardy's paradox</span>
                    (which also uses pre/post-selection) and the <span class="highlight">Elitzur-Vaidman
                    bomb test</span> (interaction-free measurements). All exploit the strange boundary
                    between quantum and classical information extraction.
                </p>

                <div class="sources">
                    <h3>Sources</h3>
                    <ul>
                        <li>Aharonov, Y. et al. (2016). "Quantum violation of the pigeonhole principle and the nature of quantum correlations" - PNAS</li>
                        <li>Chen, M.C. et al. (2019). "Experimental demonstration of quantum pigeonhole paradox" - PNAS</li>
                        <li>Aharonov, Y. et al. (1988). "How the result of a measurement of a component of spin..." - Physical Review Letters</li>
                        <li>Physics World: "Paradoxical pigeons are the latest quantum conundrum" (2014)</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // High DPI support
        const dpr = window.devicePixelRatio || 1;
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width * dpr;
        canvas.height = rect.height * dpr;
        ctx.scale(dpr, dpr);
        const width = rect.width;
        const height = rect.height;

        // State
        let mode = 'classical';
        let running = false;
        let phase = 'idle'; // idle, preselect, placing, weakmeasure, postselect, result
        let phaseTime = 0;
        let resultType = '';

        let stats = { total: 0, pairsL: 0, pairsR: 0, noPairs: 0 };

        // Particles
        let particles = [];

        // Geometry
        const boxL = { x: width * 0.25, y: height * 0.5, w: 120, h: 150 };
        const boxR = { x: width * 0.75, y: height * 0.5, w: 120, h: 150 };

        const colors = ['#ff6666', '#66ff66', '#6666ff'];

        // Initialize particles
        function initParticles() {
            particles = [
                { x: width * 0.3, y: height * 0.15, color: colors[0], state: 'super', box: null, opacity: 1 },
                { x: width * 0.5, y: height * 0.15, color: colors[1], state: 'super', box: null, opacity: 1 },
                { x: width * 0.7, y: height * 0.15, color: colors[2], state: 'super', box: null, opacity: 1 }
            ];
        }

        // Draw box
        function drawBox(box, label, highlight) {
            ctx.fillStyle = highlight ? 'rgba(100, 200, 150, 0.2)' : 'rgba(50, 80, 60, 0.3)';
            ctx.fillRect(box.x - box.w/2, box.y - box.h/2, box.w, box.h);

            ctx.strokeStyle = highlight ? '#64c896' : '#4a6050';
            ctx.lineWidth = 2;
            ctx.strokeRect(box.x - box.w/2, box.y - box.h/2, box.w, box.h);

            ctx.fillStyle = '#888';
            ctx.font = '14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(label, box.x, box.y + box.h/2 + 20);
        }

        // Draw particle
        function drawParticle(p, time) {
            ctx.globalAlpha = p.opacity;

            if (p.state === 'super' && mode !== 'classical') {
                // Superposition: fuzzy/spread out
                const gradient = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, 25);
                gradient.addColorStop(0, p.color);
                gradient.addColorStop(0.5, p.color + '88');
                gradient.addColorStop(1, 'transparent');
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(p.x, p.y, 25, 0, Math.PI * 2);
                ctx.fill();

                // Wave effect
                ctx.strokeStyle = p.color + '44';
                ctx.lineWidth = 1;
                for (let r = 10; r < 30; r += 8) {
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, r + Math.sin(time * 0.005 + r) * 3, 0, Math.PI * 2);
                    ctx.stroke();
                }
            } else {
                // Classical: solid particle
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, 12, 0, Math.PI * 2);
                ctx.fill();

                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();
            }

            ctx.globalAlpha = 1;
        }

        // Draw weak measurement probe
        function drawWeakProbe(box, pairFound, time) {
            ctx.save();
            ctx.translate(box.x, box.y);

            // Probe wave
            ctx.strokeStyle = pairFound ? '#ff666688' : '#64c89688';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);

            const radius = 40 + Math.sin(time * 0.01) * 10;
            ctx.beginPath();
            ctx.arc(0, 0, radius, 0, Math.PI * 2);
            ctx.stroke();
            ctx.setLineDash([]);

            // Result indicator
            ctx.font = 'bold 24px Arial';
            ctx.textAlign = 'center';
            ctx.fillStyle = pairFound ? '#ff6666' : '#64c896';
            ctx.fillText(pairFound ? '2+' : '≤1', 0, 8);

            ctx.restore();
        }

        // Simulate experiment
        function runExperiment() {
            if (mode === 'classical') {
                // Classical: always find pairs
                const assignments = [];
                for (let i = 0; i < 3; i++) {
                    assignments.push(Math.random() < 0.5 ? 'L' : 'R');
                }

                // Count particles in each box
                const inL = assignments.filter(a => a === 'L').length;
                const inR = assignments.filter(a => a === 'R').length;

                return {
                    assignments,
                    pairInL: inL >= 2,
                    pairInR: inR >= 2,
                    noPairs: false // Always find pairs classically
                };
            } else {
                // Quantum with pre/post-selection
                // In the specific pre/post-selected ensemble, weak measurement shows no pairs

                // Post-selection succeeds ~1/8 of the time
                const postSelectSuccess = Math.random() < 0.125;

                if (mode === 'weak' && postSelectSuccess) {
                    // Weak measurement in post-selected ensemble: no pairs!
                    return {
                        assignments: ['super', 'super', 'super'],
                        pairInL: false,
                        pairInR: false,
                        noPairs: true,
                        weakMeasurement: true
                    };
                } else {
                    // Either strong measurement or failed post-selection
                    const assignments = [];
                    for (let i = 0; i < 3; i++) {
                        assignments.push(Math.random() < 0.5 ? 'L' : 'R');
                    }
                    const inL = assignments.filter(a => a === 'L').length;
                    const inR = assignments.filter(a => a === 'R').length;

                    return {
                        assignments,
                        pairInL: inL >= 2,
                        pairInR: inR >= 2,
                        noPairs: false
                    };
                }
            }
        }

        // Update phase indicator
        function updatePhaseIndicator(text) {
            document.getElementById('phaseIndicator').textContent = text;
        }

        // Main draw
        function draw(time) {
            ctx.fillStyle = '#050808';
            ctx.fillRect(0, 0, width, height);

            // Title
            ctx.fillStyle = '#64c896';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('3 Particles → 2 Boxes', width/2, 25);

            // Mode label
            ctx.fillStyle = '#888';
            ctx.font = '12px Arial';
            const modeLabel = mode === 'classical' ? 'Classical Physics' :
                             mode === 'quantum' ? 'Quantum (Strong Measurement)' :
                             'Quantum (Weak Measurement)';
            ctx.fillText(modeLabel, width/2, 45);

            // Draw boxes
            const highlightL = phase === 'weakmeasure' || phase === 'result';
            const highlightR = phase === 'weakmeasure' || phase === 'result';
            drawBox(boxL, 'Box L (|H⟩)', highlightL);
            drawBox(boxR, 'Box R (|V⟩)', highlightR);

            // Draw particles
            particles.forEach(p => drawParticle(p, time));

            // Draw weak measurement probes
            if (phase === 'weakmeasure' && mode === 'weak') {
                const pairL = resultType.pairInL;
                const pairR = resultType.pairInR;
                drawWeakProbe(boxL, pairL, time);
                drawWeakProbe(boxR, pairR, time);
            }

            // Result text
            if (phase === 'result') {
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';

                if (resultType.noPairs) {
                    ctx.fillStyle = '#ff8866';
                    ctx.fillText('PARADOX: No two particles share a box!', width/2, height - 30);
                    ctx.font = '12px Arial';
                    ctx.fillStyle = '#888';
                    ctx.fillText('(Violates pigeonhole principle)', width/2, height - 12);
                } else {
                    ctx.fillStyle = '#64c896';
                    const where = resultType.pairInL ? 'Box L' : 'Box R';
                    ctx.fillText(`Found pair in ${where}`, width/2, height - 20);
                }
            }

            // Classical expectation reminder
            if (mode !== 'classical') {
                ctx.fillStyle = '#666';
                ctx.font = '11px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('Classical: ALWAYS find 2+ in same box', 10, height - 10);
            }
        }

        // Update simulation
        function update(deltaTime) {
            phaseTime += deltaTime;

            if (phase === 'preselect') {
                updatePhaseIndicator('Pre-selection: Preparing |+⟩ superposition...');

                // Move particles to superposition display
                particles.forEach((p, i) => {
                    p.state = mode === 'classical' ? 'classical' : 'super';
                });

                if (phaseTime > 800) {
                    phase = 'placing';
                    phaseTime = 0;
                    resultType = runExperiment();
                }
            } else if (phase === 'placing') {
                updatePhaseIndicator('Placing particles in boxes...');

                // Animate particles to boxes
                const progress = Math.min(1, phaseTime / 1000);
                const ease = 1 - Math.pow(1 - progress, 3);

                particles.forEach((p, i) => {
                    const assignment = resultType.assignments[i];
                    let targetX, targetY;

                    if (assignment === 'L') {
                        targetX = boxL.x + (i - 1) * 25;
                        targetY = boxL.y;
                    } else if (assignment === 'R') {
                        targetX = boxR.x + (i - 1) * 25;
                        targetY = boxR.y;
                    } else {
                        // Superposition - show in both
                        p.state = 'super';
                        targetX = width/2 + (i - 1) * 80;
                        targetY = height * 0.5;
                    }

                    const startX = width * (0.3 + i * 0.2);
                    const startY = height * 0.15;

                    p.x = startX + (targetX - startX) * ease;
                    p.y = startY + (targetY - startY) * ease;
                });

                if (phaseTime > 1000) {
                    phase = mode === 'weak' ? 'weakmeasure' : 'result';
                    phaseTime = 0;
                }
            } else if (phase === 'weakmeasure') {
                updatePhaseIndicator('Weak measurement: Probing for pairs...');

                if (phaseTime > 1200) {
                    phase = 'result';
                    phaseTime = 0;
                }
            } else if (phase === 'result') {
                updatePhaseIndicator(resultType.noPairs ?
                    'Result: PARADOX - No pairs detected!' :
                    'Result: Pair found (classical behavior)');

                if (phaseTime > 1500 && running) {
                    // Update stats
                    stats.total++;
                    if (resultType.pairInL) stats.pairsL++;
                    if (resultType.pairInR) stats.pairsR++;
                    if (resultType.noPairs) stats.noPairs++;
                    updateStats();

                    // Reset for next run
                    phase = 'preselect';
                    phaseTime = 0;
                    initParticles();
                }
            }
        }

        // Update stats display
        function updateStats() {
            document.getElementById('totalExperiments').textContent = stats.total;
            document.getElementById('pairsL').textContent = stats.pairsL;
            document.getElementById('pairsR').textContent = stats.pairsR;
            document.getElementById('noPairs').textContent = stats.noPairs;
            const rate = stats.total > 0 ? Math.round(stats.noPairs / stats.total * 100) : 0;
            document.getElementById('paradoxRate').textContent = rate + '%';
        }

        // Animation loop
        let lastTime = 0;
        function animate(time) {
            const deltaTime = time - lastTime;
            lastTime = time;

            if (phase !== 'idle') {
                update(deltaTime);
            }
            draw(time);

            requestAnimationFrame(animate);
        }

        // Event handlers
        document.getElementById('btnRun').addEventListener('click', function() {
            running = !running;
            this.textContent = running ? 'Pause' : 'Run Experiment';
            this.classList.toggle('active', running);

            if (running && phase === 'idle') {
                phase = 'preselect';
                phaseTime = 0;
                initParticles();
            }
        });

        document.getElementById('btnStep').addEventListener('click', function() {
            running = false;
            document.getElementById('btnRun').textContent = 'Run Experiment';
            document.getElementById('btnRun').classList.remove('active');

            phase = 'preselect';
            phaseTime = 0;
            initParticles();
        });

        document.getElementById('btnReset').addEventListener('click', function() {
            stats = { total: 0, pairsL: 0, pairsR: 0, noPairs: 0 };
            updateStats();
        });

        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                mode = this.dataset.mode;

                // Reset stats when changing mode
                stats = { total: 0, pairsL: 0, pairsR: 0, noPairs: 0 };
                updateStats();

                if (phase === 'idle' || phase === 'result') {
                    phase = 'idle';
                    initParticles();
                    updatePhaseIndicator('Click "Run Experiment" to begin');
                }
            });
        });

        // Initialize
        initParticles();
        animate(0);
    </script>
</body>
</html>
