<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gambler's Ruin - Why You Will Eventually Go Broke</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d1f1f 50%, #1a1a2e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 30px; }
        .back-link {
            color: #ff6b6b;
            text-decoration: none;
            margin-bottom: 20px;
            display: inline-block;
        }
        h1 {
            font-size: 2.3rem;
            background: linear-gradient(135deg, #f1c40f, #e67e22, #e74c3c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        .subtitle {
            font-size: 1rem;
            color: #f5b7b1;
            max-width: 850px;
            margin: 0 auto;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 25px;
            margin-bottom: 30px;
        }
        @media (max-width: 900px) {
            .main-grid { grid-template-columns: 1fr; }
        }

        .panel {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .walk-display {
            background: rgba(0,0,0,0.4);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
        }
        #walkCanvas {
            width: 100%;
            height: 300px;
            border-radius: 8px;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            margin-bottom: 15px;
        }
        .balance-display {
            text-align: center;
        }
        .balance-label {
            font-size: 0.8rem;
            color: #888;
        }
        .balance-value {
            font-size: 2rem;
            font-weight: bold;
            color: #f1c40f;
        }
        .balance-value.broke {
            color: #e74c3c;
        }
        .balance-value.winning {
            color: #2ecc71;
        }

        .bet-counter {
            text-align: center;
        }
        .bet-count {
            font-size: 1.5rem;
            color: #e0e0e0;
        }

        .outcome-indicator {
            font-size: 2rem;
            animation: pulse 0.3s ease-out;
        }
        @keyframes pulse {
            0% { transform: scale(1.5); }
            100% { transform: scale(1); }
        }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            margin-bottom: 10px;
            transition: all 0.3s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #f1c40f, #e67e22);
            color: #1a1a1a;
            font-weight: bold;
        }
        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: #fff;
        }
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #e0e0e0;
        }
        .btn:hover { transform: translateY(-2px); }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .control-group {
            margin-bottom: 15px;
        }
        .control-group label {
            display: block;
            color: #f5b7b1;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        .control-group input[type="range"] {
            width: 100%;
        }
        .control-value {
            text-align: right;
            font-size: 0.85rem;
            color: #f1c40f;
        }

        .stats-panel {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .stats-panel h4 {
            color: #f1c40f;
            margin-bottom: 12px;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }
        .stat-value {
            color: #f5b7b1;
            font-weight: bold;
        }

        .probability-box {
            background: linear-gradient(135deg, rgba(231,76,60,0.2), rgba(192,57,43,0.1));
            border: 1px solid rgba(231,76,60,0.4);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .probability-box h4 {
            color: #e74c3c;
            margin-bottom: 10px;
        }
        .ruin-probability {
            font-size: 2rem;
            color: #e74c3c;
            text-align: center;
            font-weight: bold;
        }
        .ruin-explanation {
            font-size: 0.85rem;
            color: #f5b7b1;
            margin-top: 10px;
            text-align: center;
        }

        .history-panel {
            max-height: 150px;
            overflow-y: auto;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 10px;
        }
        .run-item {
            display: flex;
            justify-content: space-between;
            padding: 5px;
            font-size: 0.8rem;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .run-result.ruin { color: #e74c3c; }
        .run-result.win { color: #2ecc71; }

        .math-box {
            background: linear-gradient(135deg, rgba(52,152,219,0.15), rgba(41,128,185,0.08));
            border: 1px solid rgba(52,152,219,0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }
        .math-box h4 {
            color: #3498db;
            margin-bottom: 10px;
        }
        .formula {
            font-family: 'Courier New', monospace;
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 5px;
            font-size: 0.9rem;
            color: #aed6f1;
            text-align: center;
        }

        .research-section {
            background: rgba(255,255,255,0.03);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            border: 1px solid rgba(255,255,255,0.08);
        }
        .research-section h2 {
            color: #f1c40f;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        .research-section h3 {
            color: #f5b7b1;
            margin: 20px 0 10px;
            font-size: 1.15rem;
        }
        .research-section p {
            margin-bottom: 12px;
            color: #c0c0c0;
        }
        .key-point {
            background: rgba(241,196,15,0.15);
            border-left: 3px solid #f1c40f;
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        .quote {
            font-style: italic;
            border-left: 3px solid #f5b7b1;
            padding-left: 15px;
            margin: 15px 0;
            color: #a0a0a0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-link">‚Üê Back to Surprising Paradoxes</a>
            <h1>Gambler's Ruin</h1>
            <p class="subtitle">Even in a perfectly fair game, a gambler with finite money playing against someone with infinite money (like a casino) will INEVITABLY go broke. The only question is when.</p>
        </header>

        <div class="main-grid">
            <div class="panel">
                <div class="walk-display">
                    <canvas id="walkCanvas"></canvas>
                </div>

                <div class="status-bar">
                    <div class="balance-display">
                        <div class="balance-label">Current Balance</div>
                        <div class="balance-value" id="currentBalance">$100</div>
                    </div>
                    <div class="bet-counter">
                        <div class="balance-label">Bets Made</div>
                        <div class="bet-count" id="betCount">0</div>
                    </div>
                    <div class="outcome-indicator" id="outcomeIndicator">üé∞</div>
                </div>

                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-primary" id="betOnce" style="flex: 1;">Bet $1</button>
                    <button class="btn btn-danger" id="betAuto" style="flex: 1;">Auto-Play Until Ruin</button>
                </div>
                <button class="btn btn-secondary" id="resetGame">Reset Game</button>

                <p style="text-align: center; color: #888; font-size: 0.85rem; margin-top: 10px;">
                    Watch your random walk. When it hits $0, you're ruined!
                </p>
            </div>

            <div class="panel">
                <h3 style="color: #f1c40f; margin-bottom: 15px;">Game Settings</h3>

                <div class="control-group">
                    <label>Starting Bankroll: $<span id="bankrollValue">100</span></label>
                    <input type="range" id="bankroll" min="10" max="500" value="100" step="10">
                </div>

                <div class="control-group">
                    <label>Goal (Double Up): $<span id="goalValue">200</span></label>
                    <input type="range" id="goal" min="20" max="1000" value="200" step="10">
                </div>

                <div class="control-group">
                    <label>Win Probability: <span id="probValue">50</span>%</label>
                    <input type="range" id="winProb" min="40" max="50" value="50" step="0.5">
                    <div class="control-value">50% = Fair, 47.37% = Roulette</div>
                </div>

                <div class="probability-box">
                    <h4>Your Probability of RUIN</h4>
                    <div class="ruin-probability" id="ruinProbability">50.0%</div>
                    <div class="ruin-explanation" id="ruinExplanation">
                        Even with a fair game, you have a 50% chance of going broke before doubling up.
                    </div>
                </div>

                <div class="stats-panel">
                    <h4>Session Statistics</h4>
                    <div class="stat-row">
                        <span>Games played:</span>
                        <span class="stat-value" id="gamesPlayed">0</span>
                    </div>
                    <div class="stat-row">
                        <span>Times ruined:</span>
                        <span class="stat-value" id="timesRuined">0</span>
                    </div>
                    <div class="stat-row">
                        <span>Reached goal:</span>
                        <span class="stat-value" id="timesWon">0</span>
                    </div>
                    <div class="stat-row">
                        <span>Observed ruin rate:</span>
                        <span class="stat-value" id="observedRate">‚Äî</span>
                    </div>
                    <div class="stat-row">
                        <span>Avg. bets to ruin:</span>
                        <span class="stat-value" id="avgBetsToRuin">‚Äî</span>
                    </div>
                </div>

                <div class="math-box">
                    <h4>The Mathematics</h4>
                    <div class="formula" id="mathFormula">
                        P(ruin) = (q/p)^n - (q/p)^N / (1 - (q/p)^N)
                    </div>
                    <p style="font-size: 0.8rem; color: #aed6f1; margin-top: 8px;">
                        where p = win prob, q = 1-p, n = starting units, N = goal units
                    </p>
                </div>
            </div>
        </div>

        <div class="research-section">
            <h2>The Mathematics of Certain Doom</h2>

            <p>In 1656, Blaise Pascal wrote to Pierre Fermat about a curious problem: if two gamblers play until one goes broke, what are the odds? This simple question launched probability theory‚Äîand revealed a brutal truth about gambling.</p>

            <h3>The Basic Setup</h3>

            <p>Imagine you walk into a casino with $100, and you'll bet $1 at a time on a fair coin flip (50/50 odds). Your goal is to double your money to $200. The casino effectively has infinite money compared to you.</p>

            <div class="key-point">
                <strong>The Shocking Truth:</strong> Even with perfectly fair odds, you have a 50% chance of losing everything before reaching your goal. And if you play long enough without a goal, ruin is 100% CERTAIN.
            </div>

            <h3>Why the House Always Wins</h3>

            <p>The gambler's ruin problem explains why casinos are profitable businesses:</p>

            <ul style="margin: 10px 0 10px 30px; color: #c0c0c0;">
                <li><strong>Asymmetric resources:</strong> The casino has far more money than any individual player</li>
                <li><strong>House edge:</strong> Games like roulette (47.37% win probability) make ruin nearly certain</li>
                <li><strong>Time exposure:</strong> The longer you play, the more likely ruin becomes</li>
                <li><strong>Variance is the enemy:</strong> Even lucky streaks can't save you indefinitely</li>
            </ul>

            <h3>The Random Walk Visualization</h3>

            <p>Your bankroll performs a "random walk"‚Äîat each bet, it moves up or down by $1. This walk continues until it hits either $0 (ruin) or your goal. The walk is constrained: there's an "absorbing barrier" at zero that you can never escape.</p>

            <div class="quote">
                "This mistaken intuition‚Äîthat a series of losing bets makes a winning bet more likely‚Äîis how casinos stay in business."<br>
                ‚Äî MIT OpenCourseWare, Mathematics for Computer Science
            </div>

            <h3>The Probability Formula</h3>

            <p>For a fair game (p = q = 0.5), the probability of ruin before reaching goal N starting with n dollars is elegantly simple:</p>

            <div class="key-point">
                <strong>P(ruin) = 1 - n/N</strong>
                <br><br>
                Starting with $100 and trying to reach $200: P(ruin) = 1 - 100/200 = 0.50 = 50%
            </div>

            <p>For an unfair game (like roulette where p = 18/38 ‚âà 0.4737), the formula becomes:</p>

            <p style="font-family: monospace; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px;">
                P(ruin) = ((q/p)^n - (q/p)^N) / (1 - (q/p)^N)
            </p>

            <p>With roulette odds trying to double $100: P(ruin) ‚âà 99.99%!</p>

            <h3>Against an Infinite Opponent</h3>

            <p>If you keep playing against someone with unlimited funds (the casino), with no goal in mind:</p>

            <div class="key-point">
                <strong>P(eventual ruin) = 1</strong> (certainty!)
                <br><br>
                Even with a fair game, you WILL eventually go broke. The random walk will inevitably hit zero given enough time. The expected number of bets until ruin is infinite, but ruin itself is certain.
            </div>

            <h3>Practical Applications Beyond Gambling</h3>

            <p><strong>Bankruptcy:</strong> A company with finite capital competing against larger firms faces "corporate gambler's ruin." Random market fluctuations can eventually drain its resources.</p>

            <p><strong>Species Extinction:</strong> Small populations face genetic "gambler's ruin." Random fluctuations in births and deaths can drive a population to zero‚Äîextinction is an absorbing barrier.</p>

            <p><strong>Trading:</strong> Day traders with limited capital face the same mathematics. Even with edge, drawdowns can wipe them out before their strategy pays off.</p>

            <h3>The Lesson</h3>

            <p>The gambler's ruin teaches us that <strong>variance is dangerous when resources are finite</strong>. It's not enough to have good odds‚Äîyou need to survive long enough for the odds to work in your favor. This is why:</p>

            <ul style="margin: 10px 0 10px 30px; color: #c0c0c0;">
                <li>Casinos have table minimums and maximums (to control their own variance)</li>
                <li>Professional gamblers use strict bankroll management</li>
                <li>Investors diversify to reduce variance</li>
                <li>The "Kelly Criterion" exists to optimize bet sizing</li>
            </ul>

            <div class="quote">
                "The market can remain irrational longer than you can remain solvent."<br>
                ‚Äî John Maynard Keynes
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('walkCanvas');
        const ctx = canvas.getContext('2d');

        // Game state
        let bankroll = 100;
        let startingBankroll = 100;
        let goal = 200;
        let winProb = 0.5;
        let currentBalance = 100;
        let betsMade = 0;
        let history = [];
        let autoPlaying = false;

        // Statistics
        let gamesPlayed = 0;
        let timesRuined = 0;
        let timesWon = 0;
        let totalBetsToRuin = 0;
        let ruinCount = 0;

        function resizeCanvas() {
            const rect = canvas.parentElement.getBoundingClientRect();
            canvas.width = rect.width - 30;
            canvas.height = 280;
        }

        function calculateRuinProbability(n, N, p) {
            // n = starting units, N = goal, p = win probability
            if (p === 0.5) {
                // Fair game: simple formula
                return 1 - n / N;
            } else {
                // Unfair game: full formula
                const q = 1 - p;
                const ratio = q / p;
                const ratioN = Math.pow(ratio, n);
                const ratioGoal = Math.pow(ratio, N);

                if (ratio === 1) {
                    return 1 - n / N;
                }

                return (ratioN - ratioGoal) / (1 - ratioGoal);
            }
        }

        function updateProbabilityDisplay() {
            const prob = calculateRuinProbability(startingBankroll, goal, winProb);
            document.getElementById('ruinProbability').textContent = (prob * 100).toFixed(1) + '%';

            let explanation;
            if (winProb === 0.5) {
                explanation = `Fair game: ${(prob * 100).toFixed(0)}% chance of ruin before reaching $${goal}.`;
            } else {
                explanation = `With ${(winProb * 100).toFixed(1)}% win odds, ruin is ${prob > 0.99 ? 'virtually certain' : (prob * 100).toFixed(1) + '% likely'}.`;
            }
            document.getElementById('ruinExplanation').textContent = explanation;
        }

        function drawWalk() {
            resizeCanvas();
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const padding = 40;
            const graphWidth = canvas.width - 2 * padding;
            const graphHeight = canvas.height - 2 * padding;

            // Draw background
            ctx.fillStyle = 'rgba(0,0,0,0.3)';
            ctx.fillRect(padding, padding, graphWidth, graphHeight);

            // Draw goal line
            const goalY = padding + graphHeight * (1 - goal / (goal * 1.1));
            ctx.strokeStyle = 'rgba(46, 204, 113, 0.5)';
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(padding, goalY);
            ctx.lineTo(canvas.width - padding, goalY);
            ctx.stroke();

            // Draw ruin line (y = 0)
            const zeroY = padding + graphHeight;
            ctx.strokeStyle = 'rgba(231, 76, 60, 0.5)';
            ctx.beginPath();
            ctx.moveTo(padding, zeroY);
            ctx.lineTo(canvas.width - padding, zeroY);
            ctx.stroke();

            // Draw starting line
            const startY = padding + graphHeight * (1 - startingBankroll / (goal * 1.1));
            ctx.strokeStyle = 'rgba(241, 196, 15, 0.3)';
            ctx.beginPath();
            ctx.moveTo(padding, startY);
            ctx.lineTo(canvas.width - padding, startY);
            ctx.stroke();

            ctx.setLineDash([]);

            // Labels
            ctx.fillStyle = '#2ecc71';
            ctx.font = '11px sans-serif';
            ctx.textAlign = 'right';
            ctx.fillText('Goal: $' + goal, canvas.width - padding - 5, goalY - 5);

            ctx.fillStyle = '#e74c3c';
            ctx.fillText('RUIN: $0', canvas.width - padding - 5, zeroY - 5);

            ctx.fillStyle = '#f1c40f';
            ctx.fillText('Start: $' + startingBankroll, canvas.width - padding - 5, startY - 5);

            // Draw the random walk
            if (history.length > 1) {
                const maxPoints = Math.min(history.length, 500);
                const step = history.length > 500 ? history.length / 500 : 1;

                ctx.strokeStyle = '#f1c40f';
                ctx.lineWidth = 2;
                ctx.beginPath();

                for (let i = 0; i < maxPoints; i++) {
                    const idx = Math.floor(i * step);
                    const x = padding + (i / (maxPoints - 1)) * graphWidth;
                    const y = padding + graphHeight * (1 - history[idx] / (goal * 1.1));

                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.stroke();

                // Current position marker
                const lastIdx = history.length - 1;
                const lastX = padding + graphWidth;
                const lastY = padding + graphHeight * (1 - history[lastIdx] / (goal * 1.1));

                ctx.fillStyle = currentBalance <= 0 ? '#e74c3c' :
                               (currentBalance >= goal ? '#2ecc71' : '#f1c40f');
                ctx.beginPath();
                ctx.arc(lastX, lastY, 6, 0, Math.PI * 2);
                ctx.fill();
            }

            // Y-axis labels
            ctx.fillStyle = '#888';
            ctx.textAlign = 'right';
            for (let i = 0; i <= 4; i++) {
                const value = Math.round((goal * 1.1) * (1 - i / 4));
                const y = padding + (i / 4) * graphHeight;
                ctx.fillText('$' + value, padding - 5, y + 4);
            }
        }

        function bet() {
            if (currentBalance <= 0 || currentBalance >= goal) return;

            betsMade++;

            // Win or lose
            if (Math.random() < winProb) {
                currentBalance++;
                document.getElementById('outcomeIndicator').textContent = 'üéâ';
            } else {
                currentBalance--;
                document.getElementById('outcomeIndicator').textContent = 'üí∏';
            }

            history.push(currentBalance);
            updateDisplay();
            drawWalk();

            // Check for game end
            if (currentBalance <= 0) {
                endGame(false);
            } else if (currentBalance >= goal) {
                endGame(true);
            }
        }

        function endGame(won) {
            gamesPlayed++;

            if (won) {
                timesWon++;
                document.getElementById('outcomeIndicator').textContent = 'üèÜ';
            } else {
                timesRuined++;
                totalBetsToRuin += betsMade;
                ruinCount++;
                document.getElementById('outcomeIndicator').textContent = 'üíÄ';
            }

            autoPlaying = false;
            document.getElementById('betAuto').textContent = 'Auto-Play Until Ruin';

            updateStats();
        }

        function updateDisplay() {
            const balanceEl = document.getElementById('currentBalance');
            balanceEl.textContent = '$' + currentBalance;
            balanceEl.classList.remove('broke', 'winning');

            if (currentBalance <= 0) {
                balanceEl.classList.add('broke');
            } else if (currentBalance >= goal) {
                balanceEl.classList.add('winning');
            }

            document.getElementById('betCount').textContent = betsMade;
        }

        function updateStats() {
            document.getElementById('gamesPlayed').textContent = gamesPlayed;
            document.getElementById('timesRuined').textContent = timesRuined;
            document.getElementById('timesWon').textContent = timesWon;

            if (gamesPlayed > 0) {
                const observedRate = (timesRuined / gamesPlayed * 100).toFixed(1);
                document.getElementById('observedRate').textContent = observedRate + '%';
            }

            if (ruinCount > 0) {
                const avgBets = Math.round(totalBetsToRuin / ruinCount);
                document.getElementById('avgBetsToRuin').textContent = avgBets;
            }
        }

        function resetGame() {
            currentBalance = startingBankroll;
            betsMade = 0;
            history = [currentBalance];
            autoPlaying = false;
            document.getElementById('betAuto').textContent = 'Auto-Play Until Ruin';
            document.getElementById('outcomeIndicator').textContent = 'üé∞';
            updateDisplay();
            drawWalk();
        }

        function autoPlay() {
            if (autoPlaying) {
                autoPlaying = false;
                document.getElementById('betAuto').textContent = 'Auto-Play Until Ruin';
                return;
            }

            autoPlaying = true;
            document.getElementById('betAuto').textContent = 'Stop Auto-Play';

            function step() {
                if (!autoPlaying || currentBalance <= 0 || currentBalance >= goal) {
                    return;
                }

                // Make multiple bets per frame for speed
                for (let i = 0; i < 5; i++) {
                    bet();
                    if (currentBalance <= 0 || currentBalance >= goal) {
                        return;
                    }
                }

                requestAnimationFrame(step);
            }

            step();
        }

        // Event listeners
        document.getElementById('betOnce').addEventListener('click', bet);
        document.getElementById('betAuto').addEventListener('click', autoPlay);
        document.getElementById('resetGame').addEventListener('click', resetGame);

        document.getElementById('bankroll').addEventListener('input', function() {
            startingBankroll = parseInt(this.value);
            document.getElementById('bankrollValue').textContent = this.value;

            // Update goal to be at least 2x bankroll
            const goalSlider = document.getElementById('goal');
            if (goal < startingBankroll * 2) {
                goal = startingBankroll * 2;
                goalSlider.value = goal;
                document.getElementById('goalValue').textContent = goal;
            }

            updateProbabilityDisplay();
            resetGame();
        });

        document.getElementById('goal').addEventListener('input', function() {
            goal = parseInt(this.value);
            document.getElementById('goalValue').textContent = this.value;
            updateProbabilityDisplay();
            resetGame();
        });

        document.getElementById('winProb').addEventListener('input', function() {
            winProb = parseFloat(this.value) / 100;
            document.getElementById('probValue').textContent = this.value;
            updateProbabilityDisplay();
        });

        // Initialize
        window.addEventListener('resize', drawWalk);
        resizeCanvas();
        history = [currentBalance];
        updateProbabilityDisplay();
        drawWalk();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
