<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Attentional Blink - Surprising Paradoxes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #ff7675, #d63031);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #888;
        }

        .back-link {
            display: inline-block;
            color: #ff7675;
            text-decoration: none;
            margin-bottom: 20px;
            transition: transform 0.3s;
        }

        .back-link:hover {
            transform: translateX(-5px);
        }

        .intro-panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .intro-panel h2 {
            color: #ff7675;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }

        .intro-panel p {
            color: #ccc;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        @media (max-width: 900px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .panel h3 {
            color: #d63031;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .rsvp-display {
            background: #000;
            border-radius: 15px;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .rsvp-letter {
            font-size: 8rem;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            color: #fff;
            transition: opacity 0.05s;
        }

        .rsvp-letter.target {
            color: #ff7675;
        }

        .rsvp-letter.target2 {
            color: #74b9ff;
        }

        .rsvp-instructions {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: #666;
        }

        .target-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .indicator-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .indicator-dot.t1 {
            background: #ff7675;
        }

        .indicator-dot.t2 {
            background: #74b9ff;
        }

        .control-panel {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .control-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .control-btn.start {
            background: linear-gradient(135deg, #ff7675, #d63031);
            color: #fff;
        }

        .control-btn.start:hover {
            transform: translateY(-2px);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .response-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            display: none;
        }

        .response-section.visible {
            display: block;
        }

        .response-prompt {
            text-align: center;
            color: #888;
            margin-bottom: 15px;
        }

        .response-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .response-box {
            flex: 1;
            text-align: center;
        }

        .response-label {
            font-size: 0.85rem;
            color: #888;
            margin-bottom: 5px;
        }

        .response-input {
            width: 100%;
            padding: 15px;
            font-size: 1.5rem;
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: #fff;
            outline: none;
            text-transform: uppercase;
        }

        .response-input:focus {
            border-color: #ff7675;
        }

        .response-input.t1 {
            border-color: rgba(255, 118, 117, 0.5);
        }

        .response-input.t2 {
            border-color: rgba(116, 185, 255, 0.5);
        }

        .submit-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #ff7675, #d63031);
            border: none;
            border-radius: 10px;
            color: #fff;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
        }

        .trial-counter {
            text-align: center;
            color: #888;
            margin-bottom: 15px;
        }

        .results-section {
            display: none;
        }

        .results-section.visible {
            display: block;
        }

        .blink-graph {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            height: 250px;
            position: relative;
        }

        .graph-canvas {
            width: 100%;
            height: 100%;
        }

        .graph-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
            color: #888;
        }

        .legend-color {
            width: 15px;
            height: 3px;
            border-radius: 2px;
        }

        .legend-color.yours {
            background: #ff7675;
        }

        .legend-color.research {
            background: #74b9ff;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .stat-box {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #ff7675;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #888;
            margin-top: 5px;
        }

        .lag-explanation {
            margin-top: 20px;
        }

        .lag-bar {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .lag-label {
            width: 60px;
            font-size: 0.85rem;
            color: #888;
        }

        .lag-fill {
            flex: 1;
            height: 25px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }

        .lag-progress {
            height: 100%;
            border-radius: 5px;
            transition: width 0.5s;
        }

        .lag-progress.high {
            background: linear-gradient(90deg, #00b894, #00cec9);
        }

        .lag-progress.low {
            background: linear-gradient(90deg, #d63031, #ff7675);
        }

        .lag-percent {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.8rem;
            color: #fff;
        }

        .timeline-visual {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .timeline-row {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .timeline-label {
            width: 80px;
            font-size: 0.8rem;
            color: #888;
        }

        .timeline-bar {
            flex: 1;
            height: 40px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            position: relative;
            display: flex;
            align-items: center;
        }

        .timeline-item {
            width: 30px;
            height: 30px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            margin: 0 2px;
        }

        .timeline-item.letter {
            background: rgba(255, 255, 255, 0.1);
            color: #888;
        }

        .timeline-item.t1 {
            background: #ff7675;
            color: #fff;
        }

        .timeline-item.t2 {
            background: #74b9ff;
            color: #fff;
        }

        .timeline-item.blink {
            background: rgba(255, 0, 0, 0.2);
            border: 2px dashed #ff7675;
            color: #ff7675;
        }

        .blink-zone {
            position: absolute;
            top: 0;
            bottom: 0;
            background: rgba(255, 0, 0, 0.1);
            border-left: 2px dashed rgba(255, 118, 117, 0.5);
            border-right: 2px dashed rgba(255, 118, 117, 0.5);
        }

        .research-panel {
            background: rgba(214, 48, 49, 0.1);
            border-left: 4px solid #d63031;
            padding: 20px;
            border-radius: 0 15px 15px 0;
            margin-bottom: 25px;
        }

        .research-panel h3 {
            color: #d63031;
            margin-bottom: 15px;
        }

        .study-card {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .study-card:last-child {
            margin-bottom: 0;
        }

        .study-author {
            color: #ff7675;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .study-finding {
            color: #ccc;
            font-size: 0.95rem;
        }

        .highlight {
            color: #74b9ff;
            font-weight: bold;
        }

        .applications-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }

        .app-card {
            background: rgba(255, 118, 117, 0.1);
            border: 1px solid rgba(255, 118, 117, 0.3);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .app-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .app-title {
            color: #ff7675;
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .app-desc {
            font-size: 0.8rem;
            color: #888;
        }

        .speed-control {
            margin-bottom: 15px;
        }

        .speed-label {
            color: #888;
            font-size: 0.85rem;
            margin-bottom: 5px;
        }

        .speed-slider {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            background: linear-gradient(90deg, #00b894, #ff7675);
            border-radius: 3px;
            outline: none;
        }

        .speed-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: #fff;
            border-radius: 50%;
            cursor: pointer;
        }

        .speed-display {
            text-align: center;
            color: #ff7675;
            font-size: 0.9rem;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê Back to Surprising Paradoxes</a>

        <header>
            <h1>The Attentional Blink</h1>
            <p class="subtitle">Your attention literally blinks for 500ms after seeing something important</p>
        </header>

        <div class="intro-panel">
            <h2>üëÅÔ∏è When Your Attention Goes Blind</h2>
            <p>
                Watch a rapid stream of letters. Spot the <span style="color: #ff7675;">red digit</span>‚Äîeasy! But wait,
                there's also a <span style="color: #74b9ff;">blue digit</span> hidden 200-500ms later. Can you see both?
                Most people <em>miss the second target entirely</em>. This is the <strong>Attentional Blink</strong>:
                when you focus on one thing, your attention literally "blinks" for about half a second, rendering you
                temporarily blind to subsequent important information. Discovered by Raymond, Shapiro & Arnell in 1992,
                this reveals a fundamental bottleneck in human attention.
            </p>
        </div>

        <div class="main-grid">
            <div class="panel">
                <h3>‚ö° RSVP Stream Experiment</h3>
                <p style="color: #888; margin-bottom: 15px;">Find TWO digits hidden among the letters!</p>

                <div class="rsvp-display" id="rsvpDisplay">
                    <div class="rsvp-instructions">
                        <div class="target-indicator">
                            <span class="indicator-dot t1"></span>
                            <span>Target 1 (digit)</span>
                        </div>
                        <div class="target-indicator">
                            <span class="indicator-dot t2"></span>
                            <span>Target 2 (digit)</span>
                        </div>
                    </div>
                    <span class="rsvp-letter" id="rsvpLetter">+</span>
                </div>

                <div class="speed-control">
                    <div class="speed-label">Presentation Speed</div>
                    <input type="range" class="speed-slider" id="speedSlider" min="50" max="150" value="100">
                    <div class="speed-display"><span id="speedValue">100</span>ms per item</div>
                </div>

                <div class="trial-counter" id="trialCounter">Trial: 0 / 20</div>

                <div class="control-panel">
                    <button class="control-btn start" id="startBtn" onclick="startTrial()">Start Trial</button>
                </div>

                <div class="response-section" id="responseSection">
                    <div class="response-prompt">What digits did you see?</div>
                    <div class="response-row">
                        <div class="response-box">
                            <div class="response-label" style="color: #ff7675;">Target 1 (Red)</div>
                            <input type="text" class="response-input t1" id="t1Response" maxlength="1" placeholder="?">
                        </div>
                        <div class="response-box">
                            <div class="response-label" style="color: #74b9ff;">Target 2 (Blue)</div>
                            <input type="text" class="response-input t2" id="t2Response" maxlength="1" placeholder="?">
                        </div>
                    </div>
                    <button class="submit-btn" onclick="submitResponse()">Submit & Next Trial</button>
                </div>

                <div class="results-section" id="resultsSection">
                    <h4 style="color: #ff7675; margin-bottom: 15px;">Your Attentional Blink Profile</h4>

                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-value" id="t1Accuracy">‚Äî</div>
                            <div class="stat-label">T1 Accuracy</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="t2Accuracy">‚Äî</div>
                            <div class="stat-label">T2 Accuracy (overall)</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="blinkDepth">‚Äî</div>
                            <div class="stat-label">Blink Depth</div>
                        </div>
                    </div>

                    <div class="lag-explanation">
                        <h4 style="color: #888; margin-bottom: 10px; font-size: 0.9rem;">T2 Accuracy by Lag (position after T1)</h4>
                        <div id="lagBars"></div>
                    </div>
                </div>
            </div>

            <div class="panel">
                <h3>üìä The Blink Pattern</h3>

                <div class="blink-graph">
                    <canvas id="blinkCanvas" class="graph-canvas"></canvas>
                </div>
                <div class="graph-legend">
                    <div class="legend-item">
                        <div class="legend-color yours"></div>
                        <span>Your Data</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color research"></div>
                        <span>Research Average</span>
                    </div>
                </div>

                <div class="timeline-visual">
                    <h4 style="color: #ff7675; margin-bottom: 15px;">What Happens During an Attentional Blink</h4>

                    <div class="timeline-row">
                        <div class="timeline-label">Stream:</div>
                        <div class="timeline-bar">
                            <div class="timeline-item letter">K</div>
                            <div class="timeline-item letter">R</div>
                            <div class="timeline-item t1">7</div>
                            <div class="timeline-item letter">M</div>
                            <div class="timeline-item blink">?</div>
                            <div class="timeline-item blink">?</div>
                            <div class="timeline-item letter">P</div>
                            <div class="timeline-item t2">3</div>
                            <div class="timeline-item letter">X</div>
                        </div>
                    </div>

                    <div class="timeline-row">
                        <div class="timeline-label">Attention:</div>
                        <div class="timeline-bar" style="background: linear-gradient(90deg,
                            rgba(0,255,0,0.2) 0%,
                            rgba(0,255,0,0.4) 22%,
                            rgba(255,0,0,0.4) 33%,
                            rgba(255,0,0,0.5) 55%,
                            rgba(255,200,0,0.3) 77%,
                            rgba(0,255,0,0.2) 100%);">
                            <div class="blink-zone" style="left: 33%; width: 44%;"></div>
                        </div>
                    </div>

                    <p style="color: #888; font-size: 0.8rem; margin-top: 15px;">
                        <strong style="color: #ff7675;">The Blink Zone:</strong> After detecting Target 1, your attention
                        needs ~500ms to "reload." Targets appearing in this window are often missed entirely‚Äîeven though
                        they're right in front of you!
                    </p>
                </div>

                <div style="background: rgba(116, 185, 255, 0.1); border: 1px solid rgba(116, 185, 255, 0.3); padding: 15px; border-radius: 10px; margin-top: 15px;">
                    <h4 style="color: #74b9ff; margin-bottom: 10px;">üéØ Lag-1 Sparing</h4>
                    <p style="color: #888; font-size: 0.9rem;">
                        Strange exception: if T2 appears <em>immediately</em> after T1 (Lag 1), both are usually detected!
                        They seem to "ride together" on the same attentional episode. The blink only affects items
                        that come slightly later‚Äîa paradox within a paradox.
                    </p>
                </div>
            </div>
        </div>

        <div class="research-panel">
            <h3>üìö The Science of Attentional Blindness</h3>

            <div class="study-card">
                <div class="study-author">Raymond, Shapiro & Arnell (1992) - University of Calgary</div>
                <div class="study-finding">
                    The discovery paper. Participants watched RSVP streams at 10 items/second, detecting a white letter
                    among black letters (T1) and reporting if an "X" appeared (T2). When T2 followed T1 by
                    <span class="highlight">200-500ms (lags 2-5)</span>, detection dropped to
                    <span class="highlight">~50%</span>. At lag 1 (immediately after) or lag 7+, performance was ~90%.
                    They named it the "attentional blink" because attention literally goes blind.
                </div>
            </div>

            <div class="study-card">
                <div class="study-author">Chun & Potter (1995) - "Two-Stage Model"</div>
                <div class="study-finding">
                    Proposed that T1 detection has two stages: (1) rapid initial detection, (2) slow consolidation into
                    working memory. The blink occurs because <span class="highlight">Stage 2 creates a bottleneck</span>‚Äîwhile
                    T1 is being consolidated, T2 gets detected (Stage 1) but not consolidated, and decays before it can
                    be reported. Items at Lag 1 "slip through" because consolidation hasn't started yet.
                </div>
            </div>

            <div class="study-card">
                <div class="study-author">Olivers & Nieuwenhuis (2006) - Emotion & Music</div>
                <div class="study-finding">
                    Emotionally arousing T2 words (like "rape" or "money") <span class="highlight">resist the blink</span>‚Äîthey
                    break through! Also, <span class="highlight">listening to music or doing a secondary task</span>
                    actually REDUCES the blink. Why? "Diffuse attention" allows T2 through. Trying too hard to focus
                    on T1 creates the blindness. Relaxation helps.
                </div>
            </div>

            <div class="study-card">
                <div class="study-author">MacLean & Bhardwaj (2011) - Meditation Reduces Blink</div>
                <div class="study-finding">
                    Experienced meditators show a <span class="highlight">significantly reduced attentional blink</span>.
                    Three months of intensive meditation training improved T2 detection by 20%. Meditation may train
                    the brain to allocate attentional resources more efficiently, reducing the "stuck" processing on T1.
                </div>
            </div>
        </div>

        <div class="panel" style="margin-bottom: 25px;">
            <h3>üåç Real-World Implications</h3>
            <div class="applications-grid">
                <div class="app-card">
                    <div class="app-icon">üöó</div>
                    <div class="app-title">Driving Safety</div>
                    <div class="app-desc">After spotting one hazard, drivers may miss a second one within 500ms</div>
                </div>
                <div class="app-card">
                    <div class="app-icon">‚úàÔ∏è</div>
                    <div class="app-title">Air Traffic Control</div>
                    <div class="app-desc">Rapid target detection tasks must account for attentional refractory period</div>
                </div>
                <div class="app-card">
                    <div class="app-icon">üî¨</div>
                    <div class="app-title">Medical Imaging</div>
                    <div class="app-desc">Radiologists may miss second tumors after detecting the first</div>
                </div>
                <div class="app-card">
                    <div class="app-icon">üì∫</div>
                    <div class="app-title">Advertising</div>
                    <div class="app-desc">Rapid-fire ads may cause viewers to miss key messages</div>
                </div>
                <div class="app-card">
                    <div class="app-icon">üéÆ</div>
                    <div class="app-title">Video Games</div>
                    <div class="app-desc">Game designers space critical events to avoid the blink window</div>
                </div>
                <div class="app-card">
                    <div class="app-icon">üßò</div>
                    <div class="app-title">Meditation Training</div>
                    <div class="app-desc">Mindfulness can reduce the blink by improving attention efficiency</div>
                </div>
            </div>
        </div>

        <div class="intro-panel">
            <h2>üß† The Bottleneck of Consciousness</h2>
            <p>
                The attentional blink reveals a fundamental limit: <em>consciousness has a refresh rate</em>. When you
                focus on something important, your brain needs about 500 milliseconds to fully process it‚Äîand during
                that time, you're essentially blind to other important information, even if you're looking right at it.<br><br>
                This isn't a flaw‚Äîit's a trade-off. Deep processing requires resources, and those resources have to come
                from somewhere. The brain prioritizes <em>quality over quantity</em>: better to fully understand one
                thing than to superficially register many.<br><br>
                The paradox is that <em>trying harder makes it worse</em>. When you strain to catch T1, you tighten
                the bottleneck. Relaxed, diffuse attention‚Äîcultivated through meditation or even background music‚Äîlets
                more through. Sometimes the best way to see more is to try less hard to look.
            </p>
        </div>
    </div>

    <script>
        // Experiment state
        let trialNumber = 0;
        const totalTrials = 20;
        let currentT1 = '';
        let currentT2 = '';
        let currentLag = 0;
        let results = [];
        let isRunning = false;
        let presentationSpeed = 100;

        // Research data (typical attentional blink pattern)
        const researchData = {
            1: 85,  // Lag-1 sparing
            2: 50,  // Deepest blink
            3: 55,
            4: 65,
            5: 75,
            6: 82,
            7: 88,
            8: 90
        };

        const letters = 'ABCDEFGHJKLMNPQRSTUVWXYZ';
        const digits = '23456789';

        document.getElementById('speedSlider').addEventListener('input', function() {
            presentationSpeed = parseInt(this.value);
            document.getElementById('speedValue').textContent = presentationSpeed;
        });

        function startTrial() {
            if (isRunning) return;

            trialNumber++;
            if (trialNumber > totalTrials) {
                showFinalResults();
                return;
            }

            isRunning = true;
            document.getElementById('trialCounter').textContent = `Trial: ${trialNumber} / ${totalTrials}`;
            document.getElementById('startBtn').disabled = true;
            document.getElementById('responseSection').classList.remove('visible');

            // Generate stream
            const streamLength = 20;
            const t1Position = 5 + Math.floor(Math.random() * 3); // Position 5-7

            // Vary lag across trials (1-8)
            currentLag = (trialNumber % 8) + 1;
            const t2Position = t1Position + currentLag;

            currentT1 = digits[Math.floor(Math.random() * digits.length)];
            currentT2 = digits[Math.floor(Math.random() * digits.length)];

            // Build stream
            const stream = [];
            for (let i = 0; i < streamLength; i++) {
                if (i === t1Position) {
                    stream.push({ char: currentT1, type: 'target' });
                } else if (i === t2Position && t2Position < streamLength) {
                    stream.push({ char: currentT2, type: 'target2' });
                } else {
                    stream.push({ char: letters[Math.floor(Math.random() * letters.length)], type: 'letter' });
                }
            }

            // Present stream
            presentStream(stream);
        }

        function presentStream(stream) {
            const display = document.getElementById('rsvpLetter');
            let index = 0;

            // Fixation
            display.textContent = '+';
            display.className = 'rsvp-letter';

            setTimeout(() => {
                const interval = setInterval(() => {
                    if (index >= stream.length) {
                        clearInterval(interval);
                        display.textContent = '?';
                        display.className = 'rsvp-letter';
                        showResponseSection();
                        return;
                    }

                    const item = stream[index];
                    display.textContent = item.char;
                    display.className = 'rsvp-letter ' + item.type;
                    index++;
                }, presentationSpeed);
            }, 500);
        }

        function showResponseSection() {
            isRunning = false;
            document.getElementById('responseSection').classList.add('visible');
            document.getElementById('t1Response').value = '';
            document.getElementById('t2Response').value = '';
            document.getElementById('t1Response').focus();
        }

        function submitResponse() {
            const t1Response = document.getElementById('t1Response').value.toUpperCase();
            const t2Response = document.getElementById('t2Response').value.toUpperCase();

            const t1Correct = t1Response === currentT1;
            const t2Correct = t2Response === currentT2;

            results.push({
                trial: trialNumber,
                lag: currentLag,
                t1Actual: currentT1,
                t2Actual: currentT2,
                t1Response: t1Response,
                t2Response: t2Response,
                t1Correct: t1Correct,
                t2Correct: t2Correct,
                // T2 accuracy conditional on T1 being correct (the standard measure)
                t2GivenT1: t1Correct ? t2Correct : null
            });

            document.getElementById('responseSection').classList.remove('visible');
            document.getElementById('startBtn').disabled = false;

            // Update ongoing visualization
            updateOngoingResults();

            if (trialNumber >= totalTrials) {
                showFinalResults();
            }
        }

        function updateOngoingResults() {
            // Update graph with current data
            drawBlinkGraph();
        }

        function showFinalResults() {
            document.getElementById('startBtn').textContent = 'Experiment Complete';
            document.getElementById('startBtn').disabled = true;
            document.getElementById('resultsSection').classList.add('visible');

            // Calculate statistics
            const t1Correct = results.filter(r => r.t1Correct).length;
            const t2Correct = results.filter(r => r.t2Correct).length;

            document.getElementById('t1Accuracy').textContent = Math.round(t1Correct / results.length * 100) + '%';
            document.getElementById('t2Accuracy').textContent = Math.round(t2Correct / results.length * 100) + '%';

            // Calculate blink depth (difference between lag 1 and lag 2-3)
            const lag1Trials = results.filter(r => r.lag === 1 && r.t1Correct);
            const blinkTrials = results.filter(r => (r.lag === 2 || r.lag === 3) && r.t1Correct);

            const lag1Acc = lag1Trials.length > 0 ?
                lag1Trials.filter(r => r.t2Correct).length / lag1Trials.length : 0;
            const blinkAcc = blinkTrials.length > 0 ?
                blinkTrials.filter(r => r.t2Correct).length / blinkTrials.length : 0;

            const blinkDepth = Math.round((lag1Acc - blinkAcc) * 100);
            document.getElementById('blinkDepth').textContent = blinkDepth + '%';

            // Draw lag bars
            drawLagBars();
            drawBlinkGraph();
        }

        function drawLagBars() {
            const container = document.getElementById('lagBars');
            container.innerHTML = '';

            for (let lag = 1; lag <= 8; lag++) {
                const lagTrials = results.filter(r => r.lag === lag && r.t1Correct);
                const accuracy = lagTrials.length > 0 ?
                    lagTrials.filter(r => r.t2Correct).length / lagTrials.length * 100 : 0;

                const bar = document.createElement('div');
                bar.className = 'lag-bar';
                bar.innerHTML = `
                    <div class="lag-label">Lag ${lag}</div>
                    <div class="lag-fill">
                        <div class="lag-progress ${accuracy > 60 ? 'high' : 'low'}" style="width: ${accuracy}%;"></div>
                        <span class="lag-percent">${Math.round(accuracy)}%</span>
                    </div>
                `;
                container.appendChild(bar);
            }
        }

        function drawBlinkGraph() {
            const canvas = document.getElementById('blinkCanvas');
            const ctx = canvas.getContext('2d');

            canvas.width = canvas.offsetWidth * 2;
            canvas.height = canvas.offsetHeight * 2;
            ctx.scale(2, 2);

            const width = canvas.offsetWidth;
            const height = canvas.offsetHeight;
            const padding = 40;

            ctx.clearRect(0, 0, width, height);

            // Draw grid
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 4; i++) {
                const y = padding + (height - padding * 2) * (i / 4);
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(width - padding, y);
                ctx.stroke();

                // Y-axis labels
                ctx.fillStyle = '#888';
                ctx.font = '10px sans-serif';
                ctx.textAlign = 'right';
                ctx.fillText((100 - i * 25) + '%', padding - 5, y + 4);
            }

            // X-axis labels
            ctx.textAlign = 'center';
            for (let lag = 1; lag <= 8; lag++) {
                const x = padding + (width - padding * 2) * ((lag - 1) / 7);
                ctx.fillText('Lag ' + lag, x, height - 10);
            }

            // Draw research data line
            ctx.beginPath();
            ctx.strokeStyle = '#74b9ff';
            ctx.lineWidth = 2;
            for (let lag = 1; lag <= 8; lag++) {
                const x = padding + (width - padding * 2) * ((lag - 1) / 7);
                const y = padding + (height - padding * 2) * (1 - researchData[lag] / 100);
                if (lag === 1) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();

            // Draw user data if available
            if (results.length > 0) {
                const userData = {};
                for (let lag = 1; lag <= 8; lag++) {
                    const lagTrials = results.filter(r => r.lag === lag && r.t1Correct);
                    userData[lag] = lagTrials.length > 0 ?
                        lagTrials.filter(r => r.t2Correct).length / lagTrials.length * 100 : null;
                }

                ctx.beginPath();
                ctx.strokeStyle = '#ff7675';
                ctx.lineWidth = 3;
                let started = false;
                for (let lag = 1; lag <= 8; lag++) {
                    if (userData[lag] !== null) {
                        const x = padding + (width - padding * 2) * ((lag - 1) / 7);
                        const y = padding + (height - padding * 2) * (1 - userData[lag] / 100);
                        if (!started) {
                            ctx.moveTo(x, y);
                            started = true;
                        } else {
                            ctx.lineTo(x, y);
                        }
                    }
                }
                ctx.stroke();

                // Draw points
                for (let lag = 1; lag <= 8; lag++) {
                    if (userData[lag] !== null) {
                        const x = padding + (width - padding * 2) * ((lag - 1) / 7);
                        const y = padding + (height - padding * 2) * (1 - userData[lag] / 100);
                        ctx.fillStyle = '#ff7675';
                        ctx.beginPath();
                        ctx.arc(x, y, 5, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }
            }

            // Blink zone shading
            const blinkStart = padding + (width - padding * 2) * (1 / 7);
            const blinkEnd = padding + (width - padding * 2) * (4 / 7);
            ctx.fillStyle = 'rgba(255, 118, 117, 0.1)';
            ctx.fillRect(blinkStart, padding, blinkEnd - blinkStart, height - padding * 2);

            // Label
            ctx.fillStyle = '#ff7675';
            ctx.font = '11px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Blink Zone', (blinkStart + blinkEnd) / 2, padding + 15);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            drawBlinkGraph();

            window.addEventListener('resize', () => {
                drawBlinkGraph();
            });
        });
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
