<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lorenz Attractor - The Butterfly Effect</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a0a1a 50%, #0a0a2a 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        .back-link {
            display: inline-flex;
            align-items: center;
            color: #06b6d4;
            text-decoration: none;
            margin-bottom: 15px;
            font-size: 0.95em;
        }
        .back-link:hover {
            color: #22d3ee;
            text-decoration: underline;
        }
        h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
            color: #fff;
            text-shadow: 0 0 30px rgba(6, 182, 212, 0.5);
        }
        .subtitle {
            color: #22d3ee;
            margin-bottom: 20px;
            font-size: 1.05em;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .main-content {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 20px;
        }
        .canvas-container {
            background: rgba(0,0,0,0.4);
            border-radius: 12px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        canvas {
            border-radius: 8px;
            background: #050510;
            cursor: grab;
        }
        canvas:active {
            cursor: grabbing;
        }
        .info-text {
            margin-top: 10px;
            font-size: 0.8em;
            color: #06b6d4;
        }
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .panel {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .panel h3 {
            font-size: 0.9em;
            color: #06b6d4;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .btn {
            padding: 8px 14px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 500;
            transition: all 0.2s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(6, 182, 212, 0.4);
        }
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #e0e0e0;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .btn-secondary:hover {
            background: rgba(255,255,255,0.2);
        }
        .param-group {
            margin-bottom: 12px;
        }
        .param-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .param-name {
            color: #22d3ee;
            font-size: 0.85em;
        }
        .param-value {
            color: #67e8f9;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.9em;
        }
        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255,255,255,0.1);
            -webkit-appearance: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #06b6d4;
            cursor: pointer;
        }
        .equations {
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 6px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.75em;
            line-height: 1.8;
            color: #67e8f9;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .stat-label {
            color: #22d3ee;
            font-size: 0.8em;
        }
        .stat-value {
            color: #67e8f9;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.8em;
        }
        .butterfly-box {
            background: linear-gradient(135deg, rgba(6,182,212,0.2), rgba(8,145,178,0.1));
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            text-align: center;
        }
        .butterfly-quote {
            font-style: italic;
            font-size: 0.8em;
            color: #22d3ee;
        }
        .presets {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 6px;
        }
        .preset-btn {
            padding: 6px;
            font-size: 0.7em;
        }
        .exp-section {
            margin-top: 20px;
        }
        .exp-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }
        .exp-card {
            background: linear-gradient(135deg, rgba(6,182,212,0.1), rgba(8,145,178,0.05));
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(6,182,212,0.2);
        }
        .exp-card h4 {
            color: #06b6d4;
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        .exp-card p {
            font-size: 0.85em;
            line-height: 1.6;
            color: #22d3ee;
        }
        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">← Back to Paradoxes</a>
        <h1>The Lorenz Attractor</h1>
        <p class="subtitle">Where Weather, Chaos, and Butterflies Meet</p>

        <div class="main-content">
            <div class="canvas-container">
                <canvas id="mainCanvas" width="700" height="600"></canvas>
                <p class="info-text">Drag to rotate • Two paths start nearly identical, then diverge forever</p>
            </div>

            <div class="sidebar">
                <div class="panel">
                    <h3>Controls</h3>
                    <div class="controls">
                        <button class="btn btn-primary" id="resetBtn">Reset</button>
                        <button class="btn btn-secondary" id="pauseBtn">Pause</button>
                        <button class="btn btn-secondary" id="trailBtn">Clear Trail</button>
                    </div>
                </div>

                <div class="panel">
                    <h3>Parameters</h3>
                    <div class="param-group">
                        <div class="param-label">
                            <span class="param-name">σ (sigma - Prandtl)</span>
                            <span class="param-value" id="sigmaValue">10.0</span>
                        </div>
                        <input type="range" id="sigmaSlider" min="5" max="20" step="0.1" value="10">
                    </div>
                    <div class="param-group">
                        <div class="param-label">
                            <span class="param-name">ρ (rho - Rayleigh)</span>
                            <span class="param-value" id="rhoValue">28.0</span>
                        </div>
                        <input type="range" id="rhoSlider" min="10" max="50" step="0.1" value="28">
                    </div>
                    <div class="param-group">
                        <div class="param-label">
                            <span class="param-name">β (beta)</span>
                            <span class="param-value" id="betaValue">2.67</span>
                        </div>
                        <input type="range" id="betaSlider" min="1" max="5" step="0.01" value="2.667">
                    </div>
                </div>

                <div class="panel">
                    <h3>Presets</h3>
                    <div class="presets">
                        <button class="btn btn-secondary preset-btn" data-sigma="10" data-rho="28" data-beta="2.667">Classic (1963)</button>
                        <button class="btn btn-secondary preset-btn" data-sigma="10" data-rho="15" data-beta="2.667">Mild chaos</button>
                        <button class="btn btn-secondary preset-btn" data-sigma="16" data-rho="45" data-beta="4">Wild chaos</button>
                        <button class="btn btn-secondary preset-btn" data-sigma="10" data-rho="99.96" data-beta="2.667">Extreme</button>
                    </div>
                </div>

                <div class="panel">
                    <h3>The Equations</h3>
                    <div class="equations">
                        dx/dt = σ(y − x)<br>
                        dy/dt = x(ρ − z) − y<br>
                        dz/dt = xy − βz
                    </div>
                    <p style="font-size: 0.7em; color: #94a3b8; margin-top: 8px;">
                        Three simple equations modeling atmospheric convection.
                        They produce infinite complexity.
                    </p>
                </div>

                <div class="panel">
                    <h3>Current State</h3>
                    <div class="stat-row">
                        <span class="stat-label">Path 1 (cyan)</span>
                        <span id="pos1" class="stat-value">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Path 2 (magenta)</span>
                        <span id="pos2" class="stat-value">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Separation</span>
                        <span id="separation" class="stat-value">-</span>
                    </div>
                    <div class="butterfly-box">
                        <div class="butterfly-quote">"Does the flap of a butterfly's wings in Brazil set off a tornado in Texas?"</div>
                        <div style="font-size: 0.7em; margin-top: 5px; color: #67e8f9;">— Philip Merilees, 1972</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="exp-section">
            <div class="exp-cards">
                <div class="exp-card">
                    <h4>Edward Lorenz (1963)</h4>
                    <p>MIT meteorologist Edward Lorenz was modeling weather when his computer revealed something shocking: restarting a simulation with numbers rounded to 3 decimals instead of 6 produced wildly different results within "months." His paper "Deterministic Nonperiodic Flow" launched chaos theory!</p>
                </div>
                <div class="exp-card">
                    <h4>The Coffee Break Discovery</h4>
                    <p>In winter 1961, Lorenz took a shortcut—typing values from a printout instead of recalculating. He went for coffee, and returned to find his weather had completely diverged. That cup of coffee changed science forever! Small differences → huge consequences.</p>
                </div>
                <div class="exp-card">
                    <h4>The Strange Attractor</h4>
                    <p>Despite the chaos, the trajectory never repeats but stays on a beautiful butterfly-shaped surface. David Ruelle coined "strange attractor" in 1971. The two "wings" represent atmospheric convection cells—air rising, cooling, sinking, in unpredictable patterns.</p>
                </div>
                <div class="exp-card">
                    <h4>Why Weather Is Unpredictable</h4>
                    <p>Lorenz proved a fundamental limit on weather forecasting. Tiny measurement errors grow exponentially—roughly doubling every 5 days. After ~2 weeks, initial errors overwhelm any forecast. This isn't technological failure; it's mathematics. Chaos is inherent!</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');

        // Parameters
        let sigma = 10;
        let rho = 28;
        let beta = 8/3;

        // Two trajectories (to show sensitivity)
        let state1 = { x: 1, y: 1, z: 1 };
        let state2 = { x: 1.001, y: 1, z: 1 }; // Tiny difference!

        let trail1 = [];
        let trail2 = [];
        const maxTrail = 3000;

        // View rotation
        let rotateX = -0.3;
        let rotateY = 0.8;
        let isDragging = false;
        let lastMouse = { x: 0, y: 0 };

        let paused = false;
        const dt = 0.005;

        // Lorenz derivatives
        function lorenzDeriv(state) {
            return {
                dx: sigma * (state.y - state.x),
                dy: state.x * (rho - state.z) - state.y,
                dz: state.x * state.y - beta * state.z
            };
        }

        // RK4 integration
        function rk4Step(state) {
            const k1 = lorenzDeriv(state);

            const state2 = {
                x: state.x + k1.dx * dt/2,
                y: state.y + k1.dy * dt/2,
                z: state.z + k1.dz * dt/2
            };
            const k2 = lorenzDeriv(state2);

            const state3 = {
                x: state.x + k2.dx * dt/2,
                y: state.y + k2.dy * dt/2,
                z: state.z + k2.dz * dt/2
            };
            const k3 = lorenzDeriv(state3);

            const state4 = {
                x: state.x + k3.dx * dt,
                y: state.y + k3.dy * dt,
                z: state.z + k3.dz * dt
            };
            const k4 = lorenzDeriv(state4);

            return {
                x: state.x + (k1.dx + 2*k2.dx + 2*k3.dx + k4.dx) * dt/6,
                y: state.y + (k1.dy + 2*k2.dy + 2*k3.dy + k4.dy) * dt/6,
                z: state.z + (k1.dz + 2*k2.dz + 2*k3.dz + k4.dz) * dt/6
            };
        }

        // 3D to 2D projection
        function project(x, y, z) {
            // Center around attractor center
            const cx = 0, cy = 0, cz = 25;
            x -= cx; y -= cy; z -= cz;

            // Rotate around Y axis
            const cosY = Math.cos(rotateY);
            const sinY = Math.sin(rotateY);
            let x1 = x * cosY - z * sinY;
            let z1 = x * sinY + z * cosY;

            // Rotate around X axis
            const cosX = Math.cos(rotateX);
            const sinX = Math.sin(rotateX);
            let y1 = y * cosX - z1 * sinX;
            let z2 = y * sinX + z1 * cosX;

            // Simple perspective
            const scale = 12;
            const fov = 200;
            const depth = fov / (fov + z2);

            return {
                x: canvas.width/2 + x1 * scale * depth,
                y: canvas.height/2 - y1 * scale * depth,
                depth: z2
            };
        }

        // Draw trajectory
        function drawTrail(trail, color) {
            if (trail.length < 2) return;

            ctx.beginPath();
            for (let i = 0; i < trail.length; i++) {
                const p = project(trail[i].x, trail[i].y, trail[i].z);
                const alpha = 0.1 + 0.9 * (i / trail.length);
                ctx.strokeStyle = color.replace('1)', alpha + ')');
                ctx.lineWidth = 1 + (i / trail.length);

                if (i === 0) {
                    ctx.moveTo(p.x, p.y);
                } else {
                    ctx.lineTo(p.x, p.y);
                    ctx.stroke();
                    ctx.beginPath();
                    ctx.moveTo(p.x, p.y);
                }
            }
        }

        // Draw current point
        function drawPoint(state, color) {
            const p = project(state.x, state.y, state.z);
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.arc(p.x, p.y, 5, 0, Math.PI * 2);
            ctx.fill();
        }

        // Main animation
        function animate() {
            if (!paused) {
                // Integrate multiple steps per frame for smoothness
                for (let i = 0; i < 5; i++) {
                    state1 = rk4Step(state1);
                    state2 = rk4Step(state2);

                    trail1.push({ ...state1 });
                    trail2.push({ ...state2 });

                    if (trail1.length > maxTrail) trail1.shift();
                    if (trail2.length > maxTrail) trail2.shift();
                }
            }

            // Clear
            ctx.fillStyle = '#050510';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw trails
            drawTrail(trail1, 'rgba(6, 182, 212, 1)');   // Cyan
            drawTrail(trail2, 'rgba(236, 72, 153, 1)');  // Magenta

            // Draw current points
            drawPoint(state1, '#22d3ee');
            drawPoint(state2, '#f472b6');

            // Update stats
            document.getElementById('pos1').textContent =
                `(${state1.x.toFixed(1)}, ${state1.y.toFixed(1)}, ${state1.z.toFixed(1)})`;
            document.getElementById('pos2').textContent =
                `(${state2.x.toFixed(1)}, ${state2.y.toFixed(1)}, ${state2.z.toFixed(1)})`;

            const sep = Math.sqrt(
                Math.pow(state1.x - state2.x, 2) +
                Math.pow(state1.y - state2.y, 2) +
                Math.pow(state1.z - state2.z, 2)
            );
            document.getElementById('separation').textContent = sep.toFixed(3);

            requestAnimationFrame(animate);
        }

        // Reset simulation
        function reset() {
            state1 = { x: 1, y: 1, z: 1 };
            state2 = { x: 1.001, y: 1, z: 1 }; // 0.001 difference!
            trail1 = [];
            trail2 = [];
        }

        // Event handlers
        canvas.addEventListener('mousedown', (e) => {
            isDragging = true;
            lastMouse = { x: e.clientX, y: e.clientY };
        });

        canvas.addEventListener('mousemove', (e) => {
            if (isDragging) {
                const dx = e.clientX - lastMouse.x;
                const dy = e.clientY - lastMouse.y;
                rotateY += dx * 0.01;
                rotateX += dy * 0.01;
                lastMouse = { x: e.clientX, y: e.clientY };
            }
        });

        canvas.addEventListener('mouseup', () => isDragging = false);
        canvas.addEventListener('mouseleave', () => isDragging = false);

        document.getElementById('sigmaSlider').addEventListener('input', (e) => {
            sigma = parseFloat(e.target.value);
            document.getElementById('sigmaValue').textContent = sigma.toFixed(1);
        });

        document.getElementById('rhoSlider').addEventListener('input', (e) => {
            rho = parseFloat(e.target.value);
            document.getElementById('rhoValue').textContent = rho.toFixed(1);
        });

        document.getElementById('betaSlider').addEventListener('input', (e) => {
            beta = parseFloat(e.target.value);
            document.getElementById('betaValue').textContent = beta.toFixed(2);
        });

        document.getElementById('resetBtn').addEventListener('click', reset);

        document.getElementById('pauseBtn').addEventListener('click', () => {
            paused = !paused;
            document.getElementById('pauseBtn').textContent = paused ? 'Resume' : 'Pause';
        });

        document.getElementById('trailBtn').addEventListener('click', () => {
            trail1 = [];
            trail2 = [];
        });

        document.querySelectorAll('.preset-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                sigma = parseFloat(btn.dataset.sigma);
                rho = parseFloat(btn.dataset.rho);
                beta = parseFloat(btn.dataset.beta);
                document.getElementById('sigmaSlider').value = sigma;
                document.getElementById('rhoSlider').value = rho;
                document.getElementById('betaSlider').value = beta;
                document.getElementById('sigmaValue').textContent = sigma.toFixed(1);
                document.getElementById('rhoValue').textContent = rho.toFixed(1);
                document.getElementById('betaValue').textContent = beta.toFixed(2);
                reset();
            });
        });

        // Start
        animate();
    </script>
</body>
</html>
