<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Collatz Conjecture - The Simplest Impossible Problem</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e8e8e8;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 25px;
        }

        h1 {
            font-size: 2.2rem;
            background: linear-gradient(135deg, #e74c3c, #f39c12, #2ecc71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #aaa;
            font-size: 1.1rem;
        }

        .quote {
            font-style: italic;
            color: #e74c3c;
            margin-top: 8px;
            font-size: 0.95rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 330px;
            gap: 25px;
        }

        @media (max-width: 1100px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .viz-section {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
        }

        .canvas-container {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
        }

        canvas {
            border-radius: 8px;
            background: #111;
        }

        .sequence-display {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            max-height: 120px;
            overflow-y: auto;
        }

        .sequence-display h4 {
            color: #f39c12;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .sequence-numbers {
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            line-height: 1.8;
            word-wrap: break-word;
        }

        .seq-even { color: #3498db; }
        .seq-odd { color: #e74c3c; }
        .seq-one { color: #2ecc71; font-weight: bold; }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: #fff;
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #fff;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .input-group {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
        }

        .input-group label {
            font-size: 0.85rem;
            color: #aaa;
        }

        .input-group input {
            width: 120px;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(0,0,0,0.3);
            color: #fff;
            font-size: 1rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .stat-box {
            background: rgba(0,0,0,0.3);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-label {
            font-size: 0.7rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #f39c12;
        }

        .records-section {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
        }

        .records-section h4 {
            color: #f39c12;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .record-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            font-size: 0.85rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .record-item:last-child {
            border-bottom: none;
        }

        .record-n {
            color: #3498db;
        }

        .record-steps {
            color: #e74c3c;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .exp-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 18px;
            border-left: 4px solid #e74c3c;
        }

        .exp-card h3 {
            color: #e74c3c;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .exp-card p {
            color: #ccc;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .formula {
            background: rgba(0,0,0,0.4);
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            color: #e74c3c;
            text-align: center;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #e74c3c;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            opacity: 0.8;
            transition: opacity 0.3s;
            z-index: 100;
        }

        .back-link:hover {
            opacity: 1;
        }

        .highlight {
            color: #2ecc71;
            font-weight: bold;
        }

        .highlight-red {
            color: #e74c3c;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Paradoxes</a>

    <div class="container">
        <header>
            <h1>The Collatz Conjecture</h1>
            <p class="subtitle">Lothar Collatz (1937) - The 3n+1 Problem</p>
            <p class="quote">"Mathematics may not be ready for such problems." ‚Äî Paul Erd≈ës</p>
        </header>

        <div class="main-content">
            <div class="viz-section">
                <div class="canvas-container">
                    <canvas id="trajectoryCanvas" width="700" height="350"></canvas>
                </div>

                <div class="sequence-display">
                    <h4>Sequence:</h4>
                    <div class="sequence-numbers" id="sequenceDisplay">
                        Enter a number to see its Collatz sequence...
                    </div>
                </div>

                <div class="controls">
                    <div class="input-group">
                        <label>Starting n:</label>
                        <input type="number" id="startInput" value="27" min="1">
                    </div>

                    <button class="btn btn-primary" id="traceBtn">Trace Sequence</button>
                    <button class="btn btn-secondary" id="animateBtn">Animate</button>
                    <button class="btn btn-secondary" id="clearBtn">Clear</button>
                    <button class="btn btn-secondary" id="findRecordBtn">Find Records (1-1000)</button>
                </div>

                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-label">Starting N</div>
                        <div class="stat-value" id="startN">--</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Stopping Time</div>
                        <div class="stat-value" id="stoppingTime">--</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Max Value</div>
                        <div class="stat-value" id="maxValue">--</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Max/Start Ratio</div>
                        <div class="stat-value" id="maxRatio">--</div>
                    </div>
                </div>

                <div class="records-section">
                    <h4>Record Stopping Times:</h4>
                    <div id="recordsList">
                        <div class="record-item">
                            <span class="record-n">n = 27</span>
                            <span class="record-steps">111 steps (try it!)</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <div class="exp-card">
                    <h3>üîÑ The Simplest Rule</h3>
                    <p>Pick ANY positive integer. Apply this rule forever:</p>
                    <div class="formula">
                        n ‚Üí n/2 (if even)<br>
                        n ‚Üí 3n+1 (if odd)
                    </div>
                    <p>Conjecture: You'll <span class="highlight">ALWAYS reach 1</span>. Verified up to 2<sup>68</sup> ‚âà 10<sup>20</sup>... but <span class="highlight-red">unproven</span>!</p>
                </div>

                <div class="exp-card">
                    <h3>üèîÔ∏è The Wild Ride</h3>
                    <p>Try n = <span class="highlight">27</span>: It soars to 9,232 before eventually reaching 1 after <span class="highlight-red">111 steps</span>! The sequence seems chaotic‚Äînumbers climb and fall unpredictably. Yet somehow, they all (supposedly) reach 1.</p>
                </div>

                <div class="exp-card">
                    <h3>üèÜ Terence Tao (2019)</h3>
                    <p>Fields Medalist Tao proved that <span class="highlight">almost all</span> Collatz orbits attain almost bounded values‚Äîthe strongest result in decades! But a full proof remains elusive.</p>
                </div>

                <div class="exp-card">
                    <h3>üíÄ Undecidability Warning</h3>
                    <p>John Conway proved that generalizations of Collatz are <span class="highlight-red">formally undecidable</span>‚Äîno algorithm can solve all such problems! Is the Collatz conjecture itself undecidable? We don't know.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('trajectoryCanvas');
        const ctx = canvas.getContext('2d');

        let sequences = [];
        let animating = false;
        let animationId = null;

        const colors = [
            '#e74c3c', '#3498db', '#2ecc71', '#f39c12', '#9b59b6',
            '#1abc9c', '#e91e63', '#00bcd4', '#ff9800', '#8bc34a'
        ];

        function collatzSequence(n) {
            const seq = [n];
            while (n !== 1) {
                if (n % 2 === 0) {
                    n = n / 2;
                } else {
                    n = 3 * n + 1;
                }
                seq.push(n);
                if (seq.length > 10000) break; // Safety limit
            }
            return seq;
        }

        function drawTrajectories() {
            ctx.fillStyle = '#111';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            if (sequences.length === 0) return;

            // Find global max for scaling
            let globalMax = 0;
            let maxLen = 0;
            for (const seq of sequences) {
                globalMax = Math.max(globalMax, Math.max(...seq.values));
                maxLen = Math.max(maxLen, seq.values.length);
            }

            const padding = { left: 60, right: 20, top: 20, bottom: 40 };
            const plotWidth = canvas.width - padding.left - padding.right;
            const plotHeight = canvas.height - padding.top - padding.bottom;

            // Draw axes
            ctx.strokeStyle = '#444';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding.left, padding.top);
            ctx.lineTo(padding.left, canvas.height - padding.bottom);
            ctx.lineTo(canvas.width - padding.right, canvas.height - padding.bottom);
            ctx.stroke();

            // Y-axis labels (log scale)
            ctx.fillStyle = '#888';
            ctx.font = '10px sans-serif';
            ctx.textAlign = 'right';
            const logMax = Math.log10(globalMax);
            for (let i = 0; i <= logMax; i++) {
                const val = Math.pow(10, i);
                const y = canvas.height - padding.bottom - (i / logMax) * plotHeight;
                ctx.fillText(val.toLocaleString(), padding.left - 5, y + 3);

                ctx.strokeStyle = '#333';
                ctx.beginPath();
                ctx.moveTo(padding.left, y);
                ctx.lineTo(canvas.width - padding.right, y);
                ctx.stroke();
            }

            // X-axis label
            ctx.fillStyle = '#888';
            ctx.textAlign = 'center';
            ctx.fillText('Steps', canvas.width / 2, canvas.height - 5);

            // Draw sequences
            for (let i = 0; i < sequences.length; i++) {
                const seq = sequences[i];
                const color = colors[i % colors.length];

                ctx.strokeStyle = color;
                ctx.lineWidth = 2;
                ctx.beginPath();

                for (let j = 0; j < seq.currentLen; j++) {
                    const x = padding.left + (j / (maxLen - 1)) * plotWidth;
                    const logVal = Math.log10(seq.values[j]);
                    const y = canvas.height - padding.bottom - (logVal / logMax) * plotHeight;

                    if (j === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.stroke();

                // Label starting value
                if (seq.currentLen > 0) {
                    const lastX = padding.left + ((seq.currentLen - 1) / (maxLen - 1)) * plotWidth;
                    const lastLogVal = Math.log10(seq.values[seq.currentLen - 1]);
                    const lastY = canvas.height - padding.bottom - (lastLogVal / logMax) * plotHeight;

                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.arc(lastX, lastY, 4, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
        }

        function displaySequence(seq, n) {
            let html = '';
            for (let i = 0; i < seq.length; i++) {
                const val = seq[i];
                let cls = 'seq-even';
                if (val === 1) cls = 'seq-one';
                else if (val % 2 === 1) cls = 'seq-odd';

                html += `<span class="${cls}">${val}</span>`;
                if (i < seq.length - 1) html += ' ‚Üí ';
            }
            document.getElementById('sequenceDisplay').innerHTML = html;

            document.getElementById('startN').textContent = n.toLocaleString();
            document.getElementById('stoppingTime').textContent = (seq.length - 1).toLocaleString();
            const maxVal = Math.max(...seq);
            document.getElementById('maxValue').textContent = maxVal.toLocaleString();
            document.getElementById('maxRatio').textContent = (maxVal / n).toFixed(1) + '√ó';
        }

        function trace(n, animate = false) {
            const seq = collatzSequence(n);

            if (animate) {
                animating = true;
                let idx = 1;
                sequences.push({
                    values: seq,
                    currentLen: 1,
                    n: n
                });

                function step() {
                    if (!animating || idx >= seq.length) {
                        animating = false;
                        displaySequence(seq, n);
                        return;
                    }

                    sequences[sequences.length - 1].currentLen = idx + 1;
                    drawTrajectories();
                    idx++;

                    animationId = requestAnimationFrame(step);
                }
                step();
            } else {
                sequences.push({
                    values: seq,
                    currentLen: seq.length,
                    n: n
                });
                drawTrajectories();
                displaySequence(seq, n);
            }
        }

        function findRecords(maxN) {
            const records = [];
            let currentRecord = 0;

            for (let n = 1; n <= maxN; n++) {
                const seq = collatzSequence(n);
                const steps = seq.length - 1;

                if (steps > currentRecord) {
                    currentRecord = steps;
                    records.push({ n, steps });
                }
            }

            // Display top 5
            const top = records.slice(-5).reverse();
            let html = '';
            for (const rec of top) {
                html += `<div class="record-item">
                    <span class="record-n">n = ${rec.n}</span>
                    <span class="record-steps">${rec.steps} steps</span>
                </div>`;
            }
            document.getElementById('recordsList').innerHTML = html;
        }

        // Event listeners
        document.getElementById('traceBtn').addEventListener('click', () => {
            const n = parseInt(document.getElementById('startInput').value);
            if (n >= 1) {
                trace(n, false);
            }
        });

        document.getElementById('animateBtn').addEventListener('click', () => {
            const n = parseInt(document.getElementById('startInput').value);
            if (n >= 1) {
                trace(n, true);
            }
        });

        document.getElementById('clearBtn').addEventListener('click', () => {
            animating = false;
            if (animationId) cancelAnimationFrame(animationId);
            sequences = [];
            drawTrajectories();
            document.getElementById('sequenceDisplay').textContent = 'Enter a number to see its Collatz sequence...';
            document.getElementById('startN').textContent = '--';
            document.getElementById('stoppingTime').textContent = '--';
            document.getElementById('maxValue').textContent = '--';
            document.getElementById('maxRatio').textContent = '--';
        });

        document.getElementById('findRecordBtn').addEventListener('click', () => {
            findRecords(1000);
        });

        document.getElementById('startInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const n = parseInt(document.getElementById('startInput').value);
                if (n >= 1) {
                    trace(n, false);
                }
            }
        });

        // Initialize with example
        trace(27, false);
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
