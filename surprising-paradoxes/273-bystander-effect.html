<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Bystander Effect - More Witnesses, Less Help</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 30px; }
        .back-link {
            color: #ff6b6b;
            text-decoration: none;
            margin-bottom: 20px;
            display: inline-block;
        }
        h1 {
            font-size: 2.2rem;
            background: linear-gradient(135deg, #ff6b6b, #feca57, #48dbfb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        .subtitle {
            font-size: 1rem;
            color: #a0c4ff;
            max-width: 900px;
            margin: 0 auto;
            line-height: 1.6;
        }
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 25px;
            margin-bottom: 30px;
        }
        @media (max-width: 1000px) {
            .main-grid { grid-template-columns: 1fr; }
        }
        .simulation-panel {
            background: rgba(20, 30, 50, 0.8);
            border-radius: 15px;
            padding: 25px;
        }
        .simulation-panel h2 {
            color: #feca57;
            margin-bottom: 15px;
            font-size: 1.3rem;
            text-align: center;
        }
        #sceneCanvas {
            width: 100%;
            height: 350px;
            border-radius: 10px;
            background: #1a2a3a;
            margin-bottom: 15px;
        }
        .scene-status {
            text-align: center;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            margin-bottom: 15px;
        }
        .status-text {
            font-size: 1.1rem;
            color: #ff6b6b;
        }
        .timer {
            font-size: 2rem;
            color: #feca57;
            font-weight: bold;
            margin-top: 5px;
        }
        .decision-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        .decision-btn {
            padding: 15px 30px;
            font-size: 1.1rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        .help-btn {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
        }
        .help-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0, 184, 148, 0.4);
        }
        .wait-btn {
            background: linear-gradient(135deg, #636e72, #2d3436);
            color: white;
        }
        .wait-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(45, 52, 54, 0.4);
        }
        .decision-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .controls-panel {
            background: rgba(20, 30, 50, 0.8);
            border-radius: 15px;
            padding: 20px;
        }
        .controls-panel h3 {
            color: #48dbfb;
            margin-bottom: 15px;
            font-size: 1.1rem;
            border-bottom: 1px solid rgba(72, 219, 251, 0.3);
            padding-bottom: 10px;
        }
        .control-group {
            margin-bottom: 20px;
        }
        .control-group label {
            display: block;
            color: #a0c4ff;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        input[type="range"] {
            width: 100%;
            height: 8px;
            background: #2d3748;
            border-radius: 4px;
            outline: none;
            -webkit-appearance: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            border-radius: 50%;
            cursor: pointer;
        }
        .bystander-count {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3rem;
            color: #feca57;
            font-weight: bold;
            margin: 10px 0;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        .stat-box {
            background: rgba(0,0,0,0.3);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-value {
            color: #48dbfb;
            font-size: 1.5rem;
            font-weight: bold;
        }
        .stat-label {
            color: #a0c4ff;
            font-size: 0.75rem;
            margin-top: 3px;
        }
        .probability-chart {
            background: rgba(0,0,0,0.4);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
        }
        #probChart {
            width: 100%;
            height: 150px;
        }
        .scenario-btn {
            width: 100%;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(72, 219, 251, 0.2);
            border: 1px solid #48dbfb;
            color: #48dbfb;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        .scenario-btn:hover, .scenario-btn.active {
            background: #48dbfb;
            color: #0f3460;
        }
        .bottom-panels {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }
        .panel {
            background: rgba(20, 30, 50, 0.8);
            border-radius: 15px;
            padding: 20px;
        }
        .panel h3 {
            color: #ff6b6b;
            margin-bottom: 12px;
            font-size: 1.1rem;
        }
        .panel p {
            color: #b0c4de;
            line-height: 1.7;
            font-size: 0.95rem;
            margin-bottom: 12px;
        }
        .experiment-card {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
        }
        .experiment-card h4 {
            color: #feca57;
            font-size: 1rem;
            margin-bottom: 8px;
        }
        .experiment-card p {
            margin-bottom: 0;
            font-size: 0.9rem;
        }
        .key-insight {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.2), rgba(254, 202, 87, 0.2));
            border-left: 4px solid #feca57;
            padding: 15px;
            border-radius: 0 10px 10px 0;
            margin: 15px 0;
        }
        .key-insight strong {
            color: #feca57;
        }
        .mechanism-list {
            list-style: none;
            padding: 0;
        }
        .mechanism-list li {
            padding: 10px 0 10px 30px;
            position: relative;
            color: #b0c4de;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .mechanism-list li::before {
            content: "‚Üí";
            position: absolute;
            left: 0;
            color: #ff6b6b;
        }
        .result-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(20, 30, 50, 0.98);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            z-index: 1000;
            display: none;
            border: 2px solid #feca57;
            max-width: 500px;
        }
        .result-modal h2 {
            color: #feca57;
            margin-bottom: 15px;
        }
        .result-modal p {
            color: #b0c4de;
            margin-bottom: 15px;
        }
        .result-modal .close-btn {
            padding: 10px 25px;
            background: #48dbfb;
            border: none;
            border-radius: 8px;
            color: #0f3460;
            cursor: pointer;
            font-weight: bold;
        }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 999;
            display: none;
        }
        .trial-counter {
            text-align: center;
            color: #a0c4ff;
            margin-top: 10px;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-link">‚Üê Back to Paradoxes</a>
            <h1>The Bystander Effect</h1>
            <p class="subtitle">
                More witnesses should mean MORE help, right? Wrong! Darley & Latan√©'s shocking 1968 discovery:
                the MORE people who witness an emergency, the LESS likely anyone is to help.
                Watch the simulation‚Äîsee how diffusion of responsibility makes everyone assume
                "someone else will do it."
            </p>
        </header>

        <div class="main-grid">
            <div class="simulation-panel">
                <h2>üö® Emergency Simulation</h2>
                <canvas id="sceneCanvas"></canvas>

                <div class="scene-status">
                    <div class="status-text" id="statusText">Someone has collapsed! Will anyone help?</div>
                    <div class="timer" id="timer">0:00</div>
                </div>

                <div class="decision-buttons">
                    <button class="decision-btn help-btn" id="helpBtn">üÜò I'll Help!</button>
                    <button class="decision-btn wait-btn" id="waitBtn">‚è≥ Wait & See</button>
                </div>

                <div class="trial-counter" id="trialCounter">Trial 1 of 10</div>
            </div>

            <div class="controls-panel">
                <h3>‚öôÔ∏è Simulation Settings</h3>

                <div class="control-group">
                    <label>Number of Bystanders</label>
                    <input type="range" id="bystanderCount" min="0" max="20" value="5">
                    <div class="bystander-count" id="bystanderDisplay">5</div>
                </div>

                <h3>üìä Results</h3>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="helpRate">--</div>
                        <div class="stat-label">Help Rate</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="avgTime">--</div>
                        <div class="stat-label">Avg Response Time</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="yourHelps">0</div>
                        <div class="stat-label">Your Helps</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="trials">0</div>
                        <div class="stat-label">Trials Run</div>
                    </div>
                </div>

                <div class="probability-chart">
                    <canvas id="probChart"></canvas>
                </div>

                <h3 style="margin-top: 20px;">üé≠ Scenarios</h3>
                <button class="scenario-btn active" data-scenario="collapse">Medical Emergency</button>
                <button class="scenario-btn" data-scenario="theft">Theft in Progress</button>
                <button class="scenario-btn" data-scenario="accident">Car Accident</button>
                <button class="scenario-btn" data-scenario="fire">Smoke/Fire Alarm</button>
            </div>
        </div>

        <div class="bottom-panels">
            <div class="panel">
                <h3>üß™ The Classic Experiments</h3>

                <div class="experiment-card">
                    <h4>The Seizure Experiment (1968)</h4>
                    <p>
                        Participants in a "discussion" heard a confederate have a seizure over intercom.
                        <strong>Alone:</strong> 85% helped within 60 seconds.
                        <strong>With 4 others:</strong> Only 31% helped within 60 seconds!
                    </p>
                </div>

                <div class="experiment-card">
                    <h4>The Smoke-Filled Room (1968)</h4>
                    <p>
                        Participants filled out questionnaires as smoke poured into the room.
                        <strong>Alone:</strong> 75% reported within 2 minutes.
                        <strong>With 2 passive confederates:</strong> Only 10% reported!
                    </p>
                </div>

                <div class="experiment-card">
                    <h4>The Lady in Distress (1969)</h4>
                    <p>
                        A woman screamed and fell in the next room.
                        <strong>Alone:</strong> 70% offered help.
                        <strong>With a stranger:</strong> 40% helped.
                        <strong>With a passive confederate:</strong> Only 7% helped!
                    </p>
                </div>
            </div>

            <div class="panel">
                <h3>üß† Why Does This Happen?</h3>
                <ul class="mechanism-list">
                    <li>
                        <strong>Diffusion of Responsibility:</strong> "Someone else will help"‚Äîthe more people present, the less personal responsibility each feels.
                    </li>
                    <li>
                        <strong>Pluralistic Ignorance:</strong> Everyone looks calm, so maybe it's not really an emergency? We look to others to define the situation.
                    </li>
                    <li>
                        <strong>Evaluation Apprehension:</strong> Fear of embarrassment if we misread the situation or help "wrong."
                    </li>
                    <li>
                        <strong>Audience Inhibition:</strong> Being watched makes us self-conscious and less likely to act.
                    </li>
                </ul>
                <div class="key-insight">
                    <strong>The Paradox:</strong> The very presence of others‚Äîwhich should provide resources and support‚Äîactually PREVENTS action. Each person's inaction reinforces everyone else's!
                </div>
            </div>

            <div class="panel">
                <h3>üìà The Math of Intervention</h3>
                <p>
                    If each bystander has probability <em>p</em> of helping independently, the probability
                    that SOMEONE helps with <em>n</em> bystanders is:
                </p>
                <p style="text-align: center; font-size: 1.2rem; color: #feca57;">
                    P(help) = 1 - (1-p)<sup>n</sup>
                </p>
                <p>
                    This SHOULD increase with more bystanders! But the bystander effect means
                    each individual's <em>p</em> DECREASES with more people. Empirically:
                </p>
                <p style="text-align: center; font-size: 1.2rem; color: #ff6b6b;">
                    p(n) ‚âà p‚ÇÄ / ‚àön
                </p>
                <p>
                    This "diffusion penalty" can outweigh the benefit of more potential helpers,
                    creating a U-shaped or even declining curve!
                </p>
                <div class="key-insight">
                    <strong>Breaking the Effect:</strong> Studies show that simply KNOWING about the bystander effect
                    makes people more likely to help. Direct requests ("You in the blue shirt, call 911!")
                    eliminate the ambiguity and restore responsibility.
                </div>
            </div>
        </div>
    </div>

    <div class="overlay" id="overlay"></div>
    <div class="result-modal" id="resultModal">
        <h2 id="resultTitle">Result</h2>
        <p id="resultText"></p>
        <button class="close-btn" id="closeModal">Next Trial</button>
    </div>

    <script>
        const canvas = document.getElementById('sceneCanvas');
        const ctx = canvas.getContext('2d');

        // State
        let bystanderCount = 5;
        let scenario = 'collapse';
        let isActive = false;
        let startTime = 0;
        let timerInterval = null;
        let trial = 0;
        let results = [];
        let yourHelps = 0;

        // Bystander positions and states
        let bystanders = [];
        let victim = { x: 0, y: 0 };

        function resizeCanvas() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        function initScene() {
            bystanders = [];
            const cx = canvas.width / 2;
            const cy = canvas.height / 2;
            victim = { x: cx, y: cy };

            // Position bystanders in a rough circle
            for (let i = 0; i < bystanderCount; i++) {
                const angle = (i / bystanderCount) * Math.PI * 2 + Math.random() * 0.3;
                const dist = 80 + Math.random() * 60;
                bystanders.push({
                    x: cx + Math.cos(angle) * dist,
                    y: cy + Math.sin(angle) * dist,
                    looking: false,
                    thinking: false,
                    helping: false,
                    decision: null, // null = undecided, 'wait' or 'help'
                    decisionTime: 0
                });
            }
        }

        function drawScene() {
            ctx.fillStyle = '#1a2a3a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw ground circle
            ctx.fillStyle = 'rgba(100,100,100,0.2)';
            ctx.beginPath();
            ctx.ellipse(canvas.width/2, canvas.height/2 + 30, 150, 80, 0, 0, Math.PI * 2);
            ctx.fill();

            // Draw victim
            drawVictim();

            // Draw bystanders
            bystanders.forEach((b, i) => drawBystander(b, i));

            // Draw "you" indicator
            ctx.fillStyle = '#48dbfb';
            ctx.font = 'bold 14px Georgia';
            ctx.textAlign = 'center';
            ctx.fillText('üë§ YOU', canvas.width - 50, canvas.height - 20);
        }

        function drawVictim() {
            const x = victim.x;
            const y = victim.y;

            // Body on ground
            ctx.fillStyle = '#cc4444';
            ctx.beginPath();
            ctx.ellipse(x, y + 5, 25, 15, 0, 0, Math.PI * 2);
            ctx.fill();

            // Head
            ctx.fillStyle = '#ffcc99';
            ctx.beginPath();
            ctx.arc(x - 20, y - 5, 12, 0, Math.PI * 2);
            ctx.fill();

            // Distress indicator
            if (isActive) {
                ctx.fillStyle = '#ff0000';
                ctx.font = 'bold 20px Georgia';
                ctx.textAlign = 'center';
                ctx.fillText('‚ö†Ô∏è', x, y - 25);
            }
        }

        function drawBystander(b, index) {
            // Body
            ctx.fillStyle = b.helping ? '#00b894' : (b.looking ? '#f39c12' : '#6b7280');
            ctx.beginPath();
            ctx.arc(b.x, b.y, 15, 0, Math.PI * 2);
            ctx.fill();

            // Head
            ctx.fillStyle = '#ffcc99';
            ctx.beginPath();
            ctx.arc(b.x, b.y - 20, 10, 0, Math.PI * 2);
            ctx.fill();

            // Thought bubble
            if (b.thinking && isActive) {
                ctx.fillStyle = 'rgba(255,255,255,0.9)';
                ctx.beginPath();
                ctx.ellipse(b.x + 20, b.y - 40, 25, 15, 0, 0, Math.PI * 2);
                ctx.fill();

                ctx.fillStyle = '#333';
                ctx.font = '12px Georgia';
                ctx.textAlign = 'center';
                ctx.fillText('ü§î ?', b.x + 20, b.y - 36);
            }

            // Decision indicator
            if (b.decision === 'wait') {
                ctx.fillStyle = '#ff6b6b';
                ctx.font = '12px Georgia';
                ctx.fillText('üòê', b.x, b.y + 30);
            } else if (b.decision === 'help') {
                ctx.fillStyle = '#00b894';
                ctx.font = '12px Georgia';
                ctx.fillText('üèÉ', b.x, b.y + 30);
            }
        }

        function startTrial() {
            trial++;
            isActive = true;
            startTime = Date.now();

            document.getElementById('trialCounter').textContent = `Trial ${trial} of 10`;
            document.getElementById('helpBtn').disabled = false;
            document.getElementById('waitBtn').disabled = false;
            document.getElementById('statusText').textContent = getScenarioText();

            initScene();

            // Bystanders start looking/thinking
            bystanders.forEach((b, i) => {
                setTimeout(() => {
                    b.looking = true;
                    setTimeout(() => { b.thinking = true; }, 500);
                }, i * 200);
            });

            // Timer
            timerInterval = setInterval(() => {
                const elapsed = (Date.now() - startTime) / 1000;
                const mins = Math.floor(elapsed / 60);
                const secs = Math.floor(elapsed % 60);
                document.getElementById('timer').textContent =
                    `${mins}:${secs.toString().padStart(2, '0')}`;

                // Bystanders make decisions over time
                simulateBystanderDecisions(elapsed);

                drawScene();
            }, 100);
        }

        function simulateBystanderDecisions(elapsed) {
            // The more bystanders, the lower the individual help probability
            const baseHelpProb = 0.7;
            const adjustedProb = baseHelpProb / Math.sqrt(Math.max(1, bystanderCount));

            bystanders.forEach(b => {
                if (b.decision === null && elapsed > 1 + Math.random() * 3) {
                    // Make decision based on adjusted probability
                    if (Math.random() < adjustedProb * 0.1) { // Per-tick probability
                        b.decision = 'help';
                        b.decisionTime = elapsed;
                        b.helping = true;
                        // If a bystander helps, end the trial
                        endTrial('bystander', elapsed);
                    } else if (Math.random() < 0.05) {
                        b.decision = 'wait';
                    }
                }
            });
        }

        function getScenarioText() {
            const texts = {
                collapse: "Someone has collapsed on the ground! They may need CPR!",
                theft: "A thief is grabbing someone's bag! The victim is calling for help!",
                accident: "A cyclist has been hit by a car! They're not moving!",
                fire: "Smoke is pouring from a building! Is anyone still inside?"
            };
            return texts[scenario];
        }

        function endTrial(helper, time) {
            if (!isActive) return;

            isActive = false;
            clearInterval(timerInterval);

            document.getElementById('helpBtn').disabled = true;
            document.getElementById('waitBtn').disabled = true;

            results.push({
                bystanders: bystanderCount,
                helper: helper,
                time: time,
                scenario: scenario
            });

            if (helper === 'you') yourHelps++;

            updateStats();
            showResult(helper, time);
        }

        function showResult(helper, time) {
            const modal = document.getElementById('resultModal');
            const overlay = document.getElementById('overlay');
            const title = document.getElementById('resultTitle');
            const text = document.getElementById('resultText');

            if (helper === 'you') {
                title.textContent = 'ü¶∏ You Helped!';
                text.innerHTML = `You responded in <strong>${time.toFixed(1)}s</strong>.<br><br>
                    With ${bystanderCount} other bystanders, you overcame the diffusion of responsibility!
                    In real experiments, only ${Math.round(70 / Math.sqrt(Math.max(1, bystanderCount)))}% of people help
                    at this crowd size.`;
            } else if (helper === 'bystander') {
                title.textContent = 'üë• Someone Else Helped';
                text.innerHTML = `A bystander responded in <strong>${time.toFixed(1)}s</strong>.<br><br>
                    You waited‚Äîjust like most people do when others are present. The diffusion of responsibility
                    made you feel less personally obligated to act.`;
            } else if (helper === 'nobody') {
                title.textContent = '‚è∞ No One Helped';
                text.innerHTML = `30 seconds passed with no response.<br><br>
                    With ${bystanderCount} bystanders, everyone assumed someone else would help.
                    This is exactly what Darley & Latan√©'s research predicted!`;
            }

            modal.style.display = 'block';
            overlay.style.display = 'block';
        }

        function updateStats() {
            const helpedTrials = results.filter(r => r.helper === 'you' || r.helper === 'bystander');
            const helpRate = results.length > 0 ? (helpedTrials.length / results.length * 100) : 0;
            const avgTime = helpedTrials.length > 0 ?
                (helpedTrials.reduce((sum, r) => sum + r.time, 0) / helpedTrials.length) : 0;

            document.getElementById('helpRate').textContent = helpRate.toFixed(0) + '%';
            document.getElementById('avgTime').textContent = avgTime.toFixed(1) + 's';
            document.getElementById('yourHelps').textContent = yourHelps;
            document.getElementById('trials').textContent = results.length;

            drawProbabilityChart();
        }

        function drawProbabilityChart() {
            const chartCanvas = document.getElementById('probChart');
            const ctx2 = chartCanvas.getContext('2d');
            chartCanvas.width = chartCanvas.offsetWidth;
            chartCanvas.height = chartCanvas.offsetHeight;

            const w = chartCanvas.width;
            const h = chartCanvas.height;
            const padding = 30;

            ctx2.fillStyle = '#1a2a3a';
            ctx2.fillRect(0, 0, w, h);

            // Axes
            ctx2.strokeStyle = '#4a5568';
            ctx2.beginPath();
            ctx2.moveTo(padding, padding);
            ctx2.lineTo(padding, h - padding);
            ctx2.lineTo(w - padding, h - padding);
            ctx2.stroke();

            // Labels
            ctx2.fillStyle = '#a0c4ff';
            ctx2.font = '10px Georgia';
            ctx2.textAlign = 'center';
            ctx2.fillText('Bystanders', w/2, h - 5);
            ctx2.save();
            ctx2.translate(10, h/2);
            ctx2.rotate(-Math.PI/2);
            ctx2.fillText('Help %', 0, 0);
            ctx2.restore();

            // Theoretical curve: p = p0 / sqrt(n)
            ctx2.strokeStyle = '#ff6b6b';
            ctx2.lineWidth = 2;
            ctx2.beginPath();
            for (let n = 0; n <= 20; n++) {
                const baseProb = 0.85;
                const prob = n === 0 ? baseProb : baseProb / Math.sqrt(n);
                const x = padding + (n / 20) * (w - 2 * padding);
                const y = h - padding - prob * (h - 2 * padding);
                if (n === 0) ctx2.moveTo(x, y);
                else ctx2.lineTo(x, y);
            }
            ctx2.stroke();

            // Data points from your results
            ctx2.fillStyle = '#48dbfb';
            const grouped = {};
            results.forEach(r => {
                if (!grouped[r.bystanders]) grouped[r.bystanders] = { helped: 0, total: 0 };
                grouped[r.bystanders].total++;
                if (r.helper !== 'nobody') grouped[r.bystanders].helped++;
            });

            Object.entries(grouped).forEach(([n, data]) => {
                const x = padding + (parseInt(n) / 20) * (w - 2 * padding);
                const y = h - padding - (data.helped / data.total) * (h - 2 * padding);
                ctx2.beginPath();
                ctx2.arc(x, y, 5, 0, Math.PI * 2);
                ctx2.fill();
            });

            // Current position indicator
            const currentX = padding + (bystanderCount / 20) * (w - 2 * padding);
            ctx2.strokeStyle = '#feca57';
            ctx2.setLineDash([5, 5]);
            ctx2.beginPath();
            ctx2.moveTo(currentX, padding);
            ctx2.lineTo(currentX, h - padding);
            ctx2.stroke();
            ctx2.setLineDash([]);

            // Legend
            ctx2.fillStyle = '#ff6b6b';
            ctx2.fillRect(w - 80, 10, 10, 10);
            ctx2.fillStyle = '#a0c4ff';
            ctx2.font = '9px Georgia';
            ctx2.textAlign = 'left';
            ctx2.fillText('Theory', w - 65, 18);

            ctx2.fillStyle = '#48dbfb';
            ctx2.beginPath();
            ctx2.arc(w - 75, 30, 4, 0, Math.PI * 2);
            ctx2.fill();
            ctx2.fillText('Your data', w - 65, 33);
        }

        // Event Listeners
        document.getElementById('bystanderCount').addEventListener('input', (e) => {
            bystanderCount = parseInt(e.target.value);
            document.getElementById('bystanderDisplay').textContent = bystanderCount;
            initScene();
            drawScene();
            drawProbabilityChart();
        });

        document.getElementById('helpBtn').addEventListener('click', () => {
            const elapsed = (Date.now() - startTime) / 1000;
            endTrial('you', elapsed);
        });

        document.getElementById('waitBtn').addEventListener('click', () => {
            // Speed up time - simulate waiting
            setTimeout(() => {
                if (isActive) endTrial('nobody', 30);
            }, 1000);
        });

        document.getElementById('closeModal').addEventListener('click', () => {
            document.getElementById('resultModal').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
            if (trial < 10) {
                startTrial();
            } else {
                document.getElementById('statusText').textContent = 'Experiment complete! Adjust bystanders and try again.';
                document.getElementById('timer').textContent = '‚úì';
                trial = 0;
            }
        });

        document.querySelectorAll('.scenario-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.scenario-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                scenario = btn.dataset.scenario;
            });
        });

        // Initialize
        initScene();
        drawScene();
        drawProbabilityChart();
        startTrial();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
