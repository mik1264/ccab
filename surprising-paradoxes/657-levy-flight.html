<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lévy Flight - Nature's Optimal Search</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a0a1a 0%, #0a1a2a 50%, #1a1a0a 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        .back-link {
            display: inline-flex;
            align-items: center;
            color: #f97316;
            text-decoration: none;
            margin-bottom: 15px;
            font-size: 0.95em;
        }
        .back-link:hover {
            color: #fb923c;
            text-decoration: underline;
        }
        h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
            color: #fff;
            text-shadow: 0 0 30px rgba(249, 115, 22, 0.5);
        }
        .subtitle {
            color: #fb923c;
            margin-bottom: 20px;
            font-size: 1.05em;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .main-content {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 20px;
        }
        .canvas-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .canvas-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .canvas-container {
            background: rgba(0,0,0,0.4);
            border-radius: 12px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .canvas-title {
            color: #fb923c;
            font-size: 0.9em;
            margin-bottom: 8px;
            font-weight: 600;
        }
        canvas {
            border-radius: 8px;
            background: #050508;
        }
        .info-text {
            margin-top: 8px;
            font-size: 0.75em;
            color: #f97316;
        }
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .panel {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .panel h3 {
            font-size: 0.9em;
            color: #f97316;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .btn {
            padding: 8px 14px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 500;
            transition: all 0.2s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #f97316, #ea580c);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(249, 115, 22, 0.4);
        }
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #e0e0e0;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .btn-secondary:hover {
            background: rgba(255,255,255,0.2);
        }
        .param-group {
            margin-bottom: 12px;
        }
        .param-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .param-name {
            color: #fb923c;
            font-size: 0.85em;
        }
        .param-value {
            color: #fdba74;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.9em;
        }
        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255,255,255,0.1);
            -webkit-appearance: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #f97316;
            cursor: pointer;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .stat-label {
            color: #fb923c;
            font-size: 0.8em;
        }
        .stat-value {
            color: #fdba74;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.8em;
        }
        .formula-box {
            background: rgba(0,0,0,0.3);
            padding: 12px;
            border-radius: 6px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.85em;
            line-height: 1.6;
            color: #fdba74;
            text-align: center;
        }
        .exp-section {
            margin-top: 20px;
        }
        .exp-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }
        .exp-card {
            background: linear-gradient(135deg, rgba(249,115,22,0.1), rgba(234,88,12,0.05));
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(249,115,22,0.2);
        }
        .exp-card h4 {
            color: #f97316;
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        .exp-card p {
            font-size: 0.85em;
            line-height: 1.6;
            color: #fb923c;
        }
        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            .canvas-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">← Back to Paradoxes</a>
        <h1>Lévy Flight</h1>
        <p class="subtitle">How Albatrosses, Sharks, and Bacteria Search for Food</p>

        <div class="main-content">
            <div class="canvas-section">
                <div class="canvas-row">
                    <div class="canvas-container">
                        <div class="canvas-title">Lévy Flight (μ ≈ 2)</div>
                        <canvas id="levyCanvas" width="340" height="340"></canvas>
                        <p class="info-text">Heavy-tailed distribution → occasional long jumps</p>
                    </div>
                    <div class="canvas-container">
                        <div class="canvas-title">Brownian Motion</div>
                        <canvas id="brownianCanvas" width="340" height="340"></canvas>
                        <p class="info-text">Gaussian steps → uniform exploration</p>
                    </div>
                </div>
                <div class="canvas-container">
                    <div class="canvas-title">Step Length Distribution</div>
                    <canvas id="histCanvas" width="700" height="200"></canvas>
                    <p class="info-text">Lévy (orange) has power-law tail • Brownian (blue) is Gaussian</p>
                </div>
            </div>

            <div class="sidebar">
                <div class="panel">
                    <h3>Controls</h3>
                    <div class="controls">
                        <button class="btn btn-primary" id="startBtn">Start</button>
                        <button class="btn btn-secondary" id="pauseBtn">Pause</button>
                        <button class="btn btn-secondary" id="resetBtn">Reset</button>
                    </div>
                </div>

                <div class="panel">
                    <h3>Lévy Exponent</h3>
                    <div class="param-group">
                        <div class="param-label">
                            <span class="param-name">μ (power law exponent)</span>
                            <span class="param-value" id="muValue">2.0</span>
                        </div>
                        <input type="range" id="muSlider" min="1.1" max="2.9" step="0.1" value="2.0">
                    </div>
                    <p style="font-size: 0.7em; color: #94a3b8;">
                        μ = 2: optimal search<br>
                        μ → 1: more ballistic<br>
                        μ → 3: more Brownian
                    </p>
                </div>

                <div class="panel">
                    <h3>Statistics</h3>
                    <div class="stat-row">
                        <span class="stat-label">Steps</span>
                        <span id="steps" class="stat-value">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Lévy coverage</span>
                        <span id="levyCoverage" class="stat-value">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Brownian coverage</span>
                        <span id="brownianCoverage" class="stat-value">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Max Lévy step</span>
                        <span id="maxLevyStep" class="stat-value">0</span>
                    </div>
                </div>

                <div class="panel">
                    <h3>The Distribution</h3>
                    <div class="formula-box">
                        P(ℓ) ∼ ℓ<sup>−μ</sup><br>
                        <span style="font-size: 0.85em;">1 &lt; μ ≤ 3</span>
                    </div>
                    <p style="font-size: 0.7em; color: #94a3b8; margin-top: 8px;">
                        Heavy tail → infinite variance<br>
                        Occasional long jumps are EXPECTED
                    </p>
                </div>
            </div>
        </div>

        <div class="exp-section">
            <div class="exp-cards">
                <div class="exp-card">
                    <h4>Optimal Foraging</h4>
                    <p>When food is sparse and randomly distributed, Lévy flights with μ ≈ 2 are mathematically OPTIMAL. The occasional long jumps let animals escape depleted areas. This beats Brownian motion which over-searches nearby regions. Natural selection favors Lévy searchers!</p>
                </div>
                <div class="exp-card">
                    <h4>The Albatross Debate</h4>
                    <p>Viswanathan (1996) first claimed albatrosses use Lévy flights. Edwards (2007) disputed this with better statistics. But newer GPS data (2012) vindicated the original idea—albatrosses DO show Lévy patterns! The controversy pushed the science forward.</p>
                </div>
                <div class="exp-card">
                    <h4>Everywhere in Nature</h4>
                    <p>Sharks, bees, bacteria, T-cells, even human hunter-gatherers show Lévy-like patterns. When resources are scarce, animals switch from Brownian to Lévy search. Marine predators were tracked showing this behavior across 14 species and 12 million movements!</p>
                </div>
                <div class="exp-card">
                    <h4>Power Laws & Heavy Tails</h4>
                    <p>Unlike Gaussian distributions, power laws have "heavy tails"—extreme events aren't rare accidents but inherent features. Earthquakes, stock crashes, social media virality, and city sizes all follow power laws. Lévy flights connect random walks to this universal pattern!</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const levyCanvas = document.getElementById('levyCanvas');
        const brownianCanvas = document.getElementById('brownianCanvas');
        const histCanvas = document.getElementById('histCanvas');

        const levyCtx = levyCanvas.getContext('2d');
        const brownianCtx = brownianCanvas.getContext('2d');
        const histCtx = histCanvas.getContext('2d');

        // Parameters
        let mu = 2.0;  // Lévy exponent
        let running = false;
        let paused = false;
        let steps = 0;

        // Walker states
        let levyPos = { x: levyCanvas.width / 2, y: levyCanvas.height / 2 };
        let brownianPos = { x: brownianCanvas.width / 2, y: brownianCanvas.height / 2 };
        let levyTrail = [];
        let brownianTrail = [];
        let levySteps = [];
        let brownianSteps = [];
        let maxTrail = 1000;

        // Coverage tracking (grid-based)
        const gridSize = 10;
        let levyVisited = new Set();
        let brownianVisited = new Set();
        let maxLevyStep = 0;

        // Generate Lévy distributed step length (inverse transform)
        function levyStep() {
            // Use inverse transform: l = l_min * u^(-1/(mu-1))
            const u = Math.random();
            const lMin = 1;
            const step = lMin * Math.pow(u, -1 / (mu - 1));
            return Math.min(step, 200);  // Cap at 200 for visualization
        }

        // Generate Gaussian step
        function gaussianStep() {
            // Box-Muller
            const u1 = Math.random();
            const u2 = Math.random();
            const z = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
            return Math.abs(z * 5);  // Scale to similar average as Lévy
        }

        // Move walker
        function moveWalker(pos, stepLength, canvas) {
            const angle = Math.random() * Math.PI * 2;
            const newX = pos.x + Math.cos(angle) * stepLength;
            const newY = pos.y + Math.sin(angle) * stepLength;

            // Wrap around boundaries
            pos.x = ((newX % canvas.width) + canvas.width) % canvas.width;
            pos.y = ((newY % canvas.height) + canvas.height) % canvas.height;

            return stepLength;
        }

        // Update coverage
        function updateCoverage(pos, visited) {
            const gx = Math.floor(pos.x / gridSize);
            const gy = Math.floor(pos.y / gridSize);
            visited.add(`${gx},${gy}`);
        }

        // Simulation step
        function simulate() {
            if (paused) return;

            // Lévy step
            const lStep = levyStep();
            levySteps.push(lStep);
            if (levySteps.length > 500) levySteps.shift();
            if (lStep > maxLevyStep) maxLevyStep = lStep;

            const oldLevyPos = { ...levyPos };
            moveWalker(levyPos, lStep, levyCanvas);
            levyTrail.push({ from: oldLevyPos, to: { ...levyPos }, step: lStep });
            if (levyTrail.length > maxTrail) levyTrail.shift();
            updateCoverage(levyPos, levyVisited);

            // Brownian step
            const bStep = gaussianStep();
            brownianSteps.push(bStep);
            if (brownianSteps.length > 500) brownianSteps.shift();

            const oldBrownianPos = { ...brownianPos };
            moveWalker(brownianPos, bStep, brownianCanvas);
            brownianTrail.push({ from: oldBrownianPos, to: { ...brownianPos }, step: bStep });
            if (brownianTrail.length > maxTrail) brownianTrail.shift();
            updateCoverage(brownianPos, brownianVisited);

            steps++;
        }

        // Draw path
        function drawPath(ctx, trail, canvas, color) {
            ctx.fillStyle = '#050508';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw trail
            for (let i = 0; i < trail.length; i++) {
                const seg = trail[i];
                const alpha = 0.3 + 0.7 * (i / trail.length);
                const width = Math.min(3, 1 + seg.step / 30);

                ctx.strokeStyle = color.replace('1)', alpha + ')');
                ctx.lineWidth = width;
                ctx.beginPath();
                ctx.moveTo(seg.from.x, seg.from.y);
                ctx.lineTo(seg.to.x, seg.to.y);
                ctx.stroke();
            }

            // Draw current position
            if (trail.length > 0) {
                const current = trail[trail.length - 1].to;
                ctx.fillStyle = '#fff';
                ctx.beginPath();
                ctx.arc(current.x, current.y, 4, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // Draw histogram
        function drawHistogram() {
            histCtx.fillStyle = '#050508';
            histCtx.fillRect(0, 0, histCanvas.width, histCanvas.height);

            if (levySteps.length < 10) return;

            // Create bins
            const maxBin = 50;
            const numBins = 50;
            const binWidth = maxBin / numBins;

            const levyBins = new Array(numBins).fill(0);
            const brownianBins = new Array(numBins).fill(0);

            for (let s of levySteps) {
                const bin = Math.min(numBins - 1, Math.floor(s / binWidth));
                levyBins[bin]++;
            }

            for (let s of brownianSteps) {
                const bin = Math.min(numBins - 1, Math.floor(s / binWidth));
                brownianBins[bin]++;
            }

            const maxCount = Math.max(...levyBins, ...brownianBins, 1);
            const barWidth = histCanvas.width / numBins - 2;
            const margin = 30;
            const plotHeight = histCanvas.height - margin;

            // Draw Brownian bars (background)
            histCtx.fillStyle = 'rgba(59, 130, 246, 0.5)';
            for (let i = 0; i < numBins; i++) {
                const h = (brownianBins[i] / maxCount) * plotHeight;
                const x = i * (barWidth + 2) + 1;
                histCtx.fillRect(x, plotHeight - h, barWidth / 2, h);
            }

            // Draw Lévy bars (foreground)
            histCtx.fillStyle = 'rgba(249, 115, 22, 0.7)';
            for (let i = 0; i < numBins; i++) {
                const h = (levyBins[i] / maxCount) * plotHeight;
                const x = i * (barWidth + 2) + 1 + barWidth / 2;
                histCtx.fillRect(x, plotHeight - h, barWidth / 2, h);
            }

            // Axis labels
            histCtx.fillStyle = '#666';
            histCtx.font = '10px Monaco, Consolas, monospace';
            histCtx.fillText('Step length →', histCanvas.width - 80, plotHeight + 15);
            histCtx.fillText('0', 5, plotHeight + 15);
            histCtx.fillText(maxBin.toString(), histCanvas.width - 25, plotHeight + 15);
        }

        // Update stats
        function updateStats() {
            document.getElementById('steps').textContent = steps.toLocaleString();
            document.getElementById('levyCoverage').textContent = levyVisited.size + ' cells';
            document.getElementById('brownianCoverage').textContent = brownianVisited.size + ' cells';
            document.getElementById('maxLevyStep').textContent = maxLevyStep.toFixed(1) + ' px';
        }

        // Animation loop
        function animate() {
            if (running && !paused) {
                simulate();
            }

            drawPath(levyCtx, levyTrail, levyCanvas, 'rgba(249, 115, 22, 1)');
            drawPath(brownianCtx, brownianTrail, brownianCanvas, 'rgba(59, 130, 246, 1)');
            drawHistogram();
            updateStats();

            requestAnimationFrame(animate);
        }

        // Reset
        function reset() {
            running = false;
            paused = false;
            steps = 0;
            maxLevyStep = 0;

            levyPos = { x: levyCanvas.width / 2, y: levyCanvas.height / 2 };
            brownianPos = { x: brownianCanvas.width / 2, y: brownianCanvas.height / 2 };
            levyTrail = [];
            brownianTrail = [];
            levySteps = [];
            brownianSteps = [];
            levyVisited = new Set();
            brownianVisited = new Set();

            document.getElementById('startBtn').textContent = 'Start';
            document.getElementById('pauseBtn').textContent = 'Pause';
        }

        // Event handlers
        document.getElementById('startBtn').addEventListener('click', () => {
            running = true;
            paused = false;
            document.getElementById('startBtn').textContent = 'Running...';
        });

        document.getElementById('pauseBtn').addEventListener('click', () => {
            paused = !paused;
            document.getElementById('pauseBtn').textContent = paused ? 'Resume' : 'Pause';
        });

        document.getElementById('resetBtn').addEventListener('click', reset);

        document.getElementById('muSlider').addEventListener('input', (e) => {
            mu = parseFloat(e.target.value);
            document.getElementById('muValue').textContent = mu.toFixed(1);
        });

        // Initialize
        animate();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
