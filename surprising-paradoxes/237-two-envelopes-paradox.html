<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Two Envelopes Paradox - Should You Always Switch?</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #1a1a1a 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.4em;
            background: linear-gradient(135deg, #9b59b6, #3498db, #9b59b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2em;
            color: #aaa;
            font-style: italic;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #9b59b6;
            text-decoration: none;
            font-size: 1.1em;
            opacity: 0.8;
            transition: opacity 0.3s;
            z-index: 1000;
        }

        .back-link:hover {
            opacity: 1;
        }

        .game-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }

        @media (max-width: 900px) {
            .game-area {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(155, 89, 182, 0.3);
        }

        .panel h2 {
            color: #9b59b6;
            margin-bottom: 20px;
            font-size: 1.4em;
        }

        .envelopes-display {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 30px 0;
        }

        .envelope {
            width: 140px;
            height: 100px;
            background: linear-gradient(135deg, #d4a373, #bc6c25);
            border-radius: 10px 10px 0 0;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            color: #1a1a2e;
            font-weight: bold;
        }

        .envelope::before {
            content: '';
            position: absolute;
            top: -30px;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(135deg, #e9c46a, #dda15e);
            clip-path: polygon(0 50%, 50% 0, 100% 50%, 100% 100%, 0 100%);
            border-radius: 10px 10px 0 0;
            transition: all 0.3s;
        }

        .envelope:hover:not(.disabled) {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
        }

        .envelope.selected {
            box-shadow: 0 0 30px rgba(155, 89, 182, 0.8);
            transform: scale(1.1);
        }

        .envelope.open::before {
            clip-path: polygon(0 50%, 50% 100%, 100% 50%, 100% 100%, 0 100%);
        }

        .envelope.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .envelope .amount {
            position: absolute;
            bottom: 10px;
            font-size: 0.9em;
            color: rgba(0, 0, 0, 0.8);
        }

        .game-status {
            text-align: center;
            font-size: 1.3em;
            margin: 20px 0;
            min-height: 60px;
            color: #ccc;
        }

        .game-status .highlight {
            color: #9b59b6;
            font-weight: bold;
        }

        .game-status .money {
            color: #27ae60;
            font-weight: bold;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
            font-weight: bold;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(155, 89, 182, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #ccc;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .stat-label {
            color: #888;
            font-size: 0.85em;
            margin-bottom: 5px;
        }

        .stat-value {
            color: #9b59b6;
            font-size: 1.4em;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        .reasoning-box {
            background: rgba(155, 89, 182, 0.1);
            border-left: 4px solid #9b59b6;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 10px 10px 0;
        }

        .reasoning-box h3 {
            color: #9b59b6;
            margin-bottom: 10px;
        }

        .formula {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            text-align: center;
            margin: 10px 0;
            color: #9b59b6;
            font-size: 1.1em;
        }

        .simulation-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .simulation-controls label {
            color: #aaa;
        }

        .simulation-controls input, .simulation-controls select {
            padding: 8px;
            border: 1px solid rgba(155, 89, 182, 0.3);
            border-radius: 5px;
            background: rgba(0, 0, 0, 0.5);
            color: #9b59b6;
            font-family: 'Courier New', monospace;
        }

        canvas {
            width: 100%;
            height: 200px;
            background: #0a0a15;
            border-radius: 10px;
            margin-top: 15px;
        }

        .explanation {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            border: 1px solid rgba(155, 89, 182, 0.3);
        }

        .explanation h2 {
            color: #9b59b6;
            margin-bottom: 15px;
        }

        .explanation p {
            line-height: 1.8;
            margin-bottom: 15px;
            color: #ccc;
        }

        .error { color: #e74c3c; font-weight: bold; }
        .correct { color: #27ae60; font-weight: bold; }

        .table-container {
            overflow-x: auto;
            margin: 15px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        th {
            background: rgba(155, 89, 182, 0.2);
            color: #9b59b6;
        }

        tr:nth-child(even) {
            background: rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Paradoxes</a>

    <div class="container">
        <header>
            <h1>The Two Envelopes Paradox</h1>
            <p class="subtitle">You should ALWAYS switch... but then you should switch back...<br>and back... and back... forever?</p>
        </header>

        <div class="game-area">
            <div class="panel">
                <h2>Play the Game</h2>
                <div class="envelopes-display">
                    <div class="envelope" id="envelopeA" onclick="pickEnvelope('A')">
                        A
                        <span class="amount" id="amountA"></span>
                    </div>
                    <div class="envelope" id="envelopeB" onclick="pickEnvelope('B')">
                        B
                        <span class="amount" id="amountB"></span>
                    </div>
                </div>

                <div class="game-status" id="gameStatus">
                    Two envelopes contain money. One has <span class="highlight">TWICE</span> as much as the other.<br>
                    Click an envelope to pick it.
                </div>

                <div class="controls">
                    <button class="btn-primary" id="switchBtn" onclick="switchEnvelope()" disabled>Switch Envelopes</button>
                    <button class="btn-primary" id="keepBtn" onclick="keepEnvelope()" disabled>Keep Current</button>
                    <button class="btn-secondary" id="newGameBtn" onclick="newGame()">New Game</button>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Games Played</div>
                        <div class="stat-value" id="gamesPlayed">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Winnings</div>
                        <div class="stat-value" id="totalWinnings">$0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Switches Made</div>
                        <div class="stat-value" id="switchCount">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Switch Advantage</div>
                        <div class="stat-value" id="switchAdvantage">0%</div>
                    </div>
                </div>
            </div>

            <div class="panel">
                <h2>Monte Carlo Simulation</h2>
                <div class="simulation-controls">
                    <label>Strategy:</label>
                    <select id="strategy">
                        <option value="always-switch">Always Switch</option>
                        <option value="never-switch">Never Switch</option>
                        <option value="random">Random (50/50)</option>
                    </select>
                    <label>Games:</label>
                    <input type="number" id="simCount" value="10000" min="100" max="100000">
                    <button class="btn-primary" onclick="runSimulation()">Run</button>
                </div>

                <canvas id="simCanvas"></canvas>

                <div class="stats-grid" style="margin-top: 15px;">
                    <div class="stat-card">
                        <div class="stat-label">Simulated Games</div>
                        <div class="stat-value" id="simGames">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Average Win</div>
                        <div class="stat-value" id="simAvg">$0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Avg if Stayed</div>
                        <div class="stat-value" id="simStay">$0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Difference</div>
                        <div class="stat-value" id="simDiff">0%</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="panel">
            <h2>The "Reasoning" That Says You Should Always Switch</h2>
            <div class="reasoning-box">
                <p>You pick an envelope and see it contains <span class="highlight">$X</span>.</p>
                <p>The other envelope contains either <span class="highlight">$2X</span> or <span class="highlight">$X/2</span>, each with 50% probability.</p>
                <div class="formula">
                    E[switch] = 0.5 × (2X) + 0.5 × (X/2) = X + X/4 = <span class="error">5X/4 = 1.25X</span>
                </div>
                <p>Since <span class="error">1.25X > X</span>, you should ALWAYS switch!</p>
                <p>But wait... if switching is always better, you should switch back. And back again. Forever!</p>
                <p style="color: #e74c3c; font-weight: bold;">Something is wrong with this reasoning...</p>
            </div>
        </div>

        <div class="explanation">
            <h2>Why the Reasoning is Flawed</h2>

            <div class="reasoning-box">
                <h3>The Core Error: Mixing Two Different Scenarios</h3>
                <p>
                    The fallacy lies in using <span class="highlight">X</span> inconsistently. When you say "the other envelope
                    has 2X or X/2," you're treating X as a fixed value. But:
                </p>
                <ul style="margin-left: 20px; line-height: 2;">
                    <li>If the other has <span class="highlight">2X</span>, then X is the <em>smaller</em> amount</li>
                    <li>If the other has <span class="highlight">X/2</span>, then X is the <em>larger</em> amount</li>
                </ul>
                <p>
                    These are different values of X! You cannot combine them in one expected value calculation
                    because they come from <span class="error">mutually exclusive realities</span>.
                </p>
            </div>

            <div class="reasoning-box">
                <h3>The Correct Analysis</h3>
                <p>
                    Let's call the smaller amount <span class="highlight">S</span> and the larger amount <span class="highlight">2S</span>.
                    The total in both envelopes is always <span class="highlight">3S</span>.
                </p>
                <div class="table-container">
                    <table>
                        <tr>
                            <th>Scenario</th>
                            <th>Your Envelope</th>
                            <th>Other Envelope</th>
                            <th>Gain from Switching</th>
                        </tr>
                        <tr>
                            <td>You have smaller (50%)</td>
                            <td>S</td>
                            <td>2S</td>
                            <td class="correct">+S</td>
                        </tr>
                        <tr>
                            <td>You have larger (50%)</td>
                            <td>2S</td>
                            <td>S</td>
                            <td class="error">-S</td>
                        </tr>
                    </table>
                </div>
                <div class="formula">
                    E[gain from switch] = 0.5 × (+S) + 0.5 × (-S) = <span class="correct">0</span>
                </div>
                <p>
                    Switching has <span class="correct">zero expected advantage</span>. This matches our intuition—
                    you picked randomly, so switching is just picking the other one randomly!
                </p>
            </div>

            <div class="reasoning-box">
                <h3>Why the Fallacy is So Seductive</h3>
                <p>
                    The error is subtle because both "2X" and "X/2" are valid descriptions of what the other
                    envelope could contain. The problem is treating them as belonging to the same probability space.
                </p>
                <p>
                    It's like saying: "I have a sibling. They're either my older brother (50%) or my younger
                    sister (50%). Expected number of brothers = 0.5. Expected number of sisters = 0.5."
                    But you can't have half a brother AND half a sister as one sibling!
                </p>
            </div>

            <h2>Historical Context</h2>
            <p>
                The two envelopes paradox is a variant of the <span class="highlight">necktie paradox</span>
                and the <span class="highlight">wallet game</span>. It was popularized in the 1980s and has
                generated hundreds of academic papers with proposed resolutions.
            </p>
            <p>
                The paradox reveals how easily our probabilistic intuitions can be led astray, especially
                when dealing with conditional expectations and self-referential reasoning. It remains a
                valuable teaching tool in probability theory and decision science.
            </p>
        </div>
    </div>

    <script>
        // Game state
        let smallAmount, largeAmount;
        let selectedEnvelope = null;
        let gamePhase = 'pick'; // pick, decide, revealed
        let gamesPlayed = 0;
        let totalWinnings = 0;
        let switchCount = 0;
        let switchWins = 0;
        let stayWins = 0;

        // Canvas
        const simCanvas = document.getElementById('simCanvas');
        const simCtx = simCanvas.getContext('2d');

        function resizeCanvas() {
            const rect = simCanvas.getBoundingClientRect();
            simCanvas.width = rect.width * window.devicePixelRatio;
            simCanvas.height = rect.height * window.devicePixelRatio;
            simCtx.scale(window.devicePixelRatio, window.devicePixelRatio);
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        function newGame() {
            // Generate amounts: one is double the other
            smallAmount = Math.floor(Math.random() * 50) * 10 + 10; // $10 to $500 in $10 increments
            largeAmount = smallAmount * 2;

            // Randomly assign to envelopes
            if (Math.random() < 0.5) {
                document.getElementById('envelopeA').dataset.amount = smallAmount;
                document.getElementById('envelopeB').dataset.amount = largeAmount;
            } else {
                document.getElementById('envelopeA').dataset.amount = largeAmount;
                document.getElementById('envelopeB').dataset.amount = smallAmount;
            }

            // Reset UI
            selectedEnvelope = null;
            gamePhase = 'pick';

            document.getElementById('envelopeA').classList.remove('selected', 'open', 'disabled');
            document.getElementById('envelopeB').classList.remove('selected', 'open', 'disabled');
            document.getElementById('amountA').textContent = '';
            document.getElementById('amountB').textContent = '';

            document.getElementById('switchBtn').disabled = true;
            document.getElementById('keepBtn').disabled = true;

            document.getElementById('gameStatus').innerHTML =
                'Two envelopes contain money. One has <span class="highlight">TWICE</span> as much as the other.<br>Click an envelope to pick it.';
        }

        function pickEnvelope(envelope) {
            if (gamePhase !== 'pick') return;

            selectedEnvelope = envelope;
            gamePhase = 'decide';

            const selectedEl = document.getElementById('envelope' + envelope);
            const otherEl = document.getElementById('envelope' + (envelope === 'A' ? 'B' : 'A'));

            selectedEl.classList.add('selected', 'open');
            otherEl.classList.add('disabled');

            const amount = parseInt(selectedEl.dataset.amount);
            document.getElementById('amount' + envelope).textContent = '$' + amount;

            document.getElementById('switchBtn').disabled = false;
            document.getElementById('keepBtn').disabled = false;

            document.getElementById('gameStatus').innerHTML =
                `You picked Envelope ${envelope} containing <span class="money">$${amount}</span>.<br>` +
                `The other envelope has either <span class="highlight">$${amount * 2}</span> or <span class="highlight">$${amount / 2}</span>.<br>` +
                `Do you want to <span class="highlight">switch</span>?`;
        }

        function switchEnvelope() {
            if (gamePhase !== 'decide') return;

            const newEnvelope = selectedEnvelope === 'A' ? 'B' : 'A';
            revealAndFinish(newEnvelope, true);
        }

        function keepEnvelope() {
            if (gamePhase !== 'decide') return;
            revealAndFinish(selectedEnvelope, false);
        }

        function revealAndFinish(finalEnvelope, didSwitch) {
            gamePhase = 'revealed';

            // Reveal both envelopes
            const elA = document.getElementById('envelopeA');
            const elB = document.getElementById('envelopeB');

            elA.classList.add('open');
            elB.classList.add('open');
            elA.classList.remove('disabled');
            elB.classList.remove('disabled');

            document.getElementById('amountA').textContent = '$' + elA.dataset.amount;
            document.getElementById('amountB').textContent = '$' + elB.dataset.amount;

            // Highlight final choice
            elA.classList.remove('selected');
            elB.classList.remove('selected');
            document.getElementById('envelope' + finalEnvelope).classList.add('selected');

            const wonAmount = parseInt(document.getElementById('envelope' + finalEnvelope).dataset.amount);
            const otherAmount = parseInt(document.getElementById('envelope' + (finalEnvelope === 'A' ? 'B' : 'A')).dataset.amount);

            // Update stats
            gamesPlayed++;
            totalWinnings += wonAmount;
            if (didSwitch) {
                switchCount++;
                switchWins += wonAmount;
            } else {
                stayWins += wonAmount;
            }

            updateStats();

            document.getElementById('switchBtn').disabled = true;
            document.getElementById('keepBtn').disabled = true;

            const comparison = wonAmount > otherAmount ? 'MORE' : 'LESS';
            const compClass = wonAmount > otherAmount ? 'correct' : 'error';

            document.getElementById('gameStatus').innerHTML =
                `${didSwitch ? 'You switched to' : 'You kept'} Envelope ${finalEnvelope}.<br>` +
                `You won <span class="money">$${wonAmount}</span>! ` +
                `(The other had $${otherAmount} — you got <span class="${compClass}">${comparison}</span>)`;
        }

        function updateStats() {
            document.getElementById('gamesPlayed').textContent = gamesPlayed;
            document.getElementById('totalWinnings').textContent = '$' + totalWinnings.toLocaleString();
            document.getElementById('switchCount').textContent = switchCount;

            if (gamesPlayed > 0) {
                const switchAvg = switchCount > 0 ? switchWins / switchCount : 0;
                const stayAvg = (gamesPlayed - switchCount) > 0 ? stayWins / (gamesPlayed - switchCount) : 0;

                if (switchAvg > 0 && stayAvg > 0) {
                    const advantage = ((switchAvg - stayAvg) / stayAvg * 100).toFixed(1);
                    document.getElementById('switchAdvantage').textContent =
                        (advantage >= 0 ? '+' : '') + advantage + '%';
                }
            }
        }

        function runSimulation() {
            const count = parseInt(document.getElementById('simCount').value) || 10000;
            const strategy = document.getElementById('strategy').value;

            let results = [];
            let switchTotal = 0;
            let stayTotal = 0;

            for (let i = 0; i < count; i++) {
                const small = Math.floor(Math.random() * 100) + 1;
                const large = small * 2;

                // Random initial pick
                const pickedLarge = Math.random() < 0.5;
                const picked = pickedLarge ? large : small;
                const other = pickedLarge ? small : large;

                let willSwitch;
                if (strategy === 'always-switch') willSwitch = true;
                else if (strategy === 'never-switch') willSwitch = false;
                else willSwitch = Math.random() < 0.5;

                const won = willSwitch ? other : picked;
                results.push(won);

                if (willSwitch) switchTotal += won;
                else stayTotal += won;
            }

            // Calculate stats
            const total = results.reduce((a, b) => a + b, 0);
            const avg = total / count;

            // For comparison, calculate what each strategy would get
            let simSwitchCount = strategy === 'always-switch' ? count :
                                 strategy === 'never-switch' ? 0 :
                                 Math.round(count / 2);

            document.getElementById('simGames').textContent = count.toLocaleString();
            document.getElementById('simAvg').textContent = '$' + avg.toFixed(2);

            // Expected value for any strategy is 1.5 * small (average of small and large)
            const expectedAvg = 1.5 * 50.5; // avg small is 50.5
            document.getElementById('simStay').textContent = '$' + expectedAvg.toFixed(2);

            const diff = ((avg - expectedAvg) / expectedAvg * 100).toFixed(2);
            document.getElementById('simDiff').textContent = (diff >= 0 ? '+' : '') + diff + '%';

            drawHistogram(results);
        }

        function drawHistogram(results) {
            const width = simCanvas.width / window.devicePixelRatio;
            const height = simCanvas.height / window.devicePixelRatio;

            simCtx.clearRect(0, 0, width, height);

            // Bin the results
            const bins = {};
            results.forEach(r => {
                const bin = Math.floor(r / 20) * 20;
                bins[bin] = (bins[bin] || 0) + 1;
            });

            const binKeys = Object.keys(bins).map(Number).sort((a, b) => a - b);
            const maxCount = Math.max(...Object.values(bins));
            const barWidth = Math.min(30, (width - 60) / binKeys.length);
            const chartHeight = height - 40;

            binKeys.forEach((bin, i) => {
                const count = bins[bin];
                const barHeight = (count / maxCount) * (chartHeight - 20);
                const x = 40 + i * barWidth;
                const y = chartHeight - barHeight;

                const gradient = simCtx.createLinearGradient(x, y + barHeight, x, y);
                gradient.addColorStop(0, '#8e44ad');
                gradient.addColorStop(1, '#9b59b6');

                simCtx.fillStyle = gradient;
                simCtx.fillRect(x, y, barWidth - 2, barHeight);
            });

            // Axes
            simCtx.strokeStyle = '#555';
            simCtx.beginPath();
            simCtx.moveTo(40, 10);
            simCtx.lineTo(40, chartHeight);
            simCtx.lineTo(width - 10, chartHeight);
            simCtx.stroke();

            simCtx.fillStyle = '#888';
            simCtx.font = '10px Georgia';
            simCtx.textAlign = 'center';
            simCtx.fillText('Prize Amount', width / 2, height - 5);
        }

        // Initialize
        newGame();
        drawHistogram([50, 100, 50, 100, 50, 100]);
    </script>
</body>
</html>
