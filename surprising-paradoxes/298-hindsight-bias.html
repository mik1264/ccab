<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hindsight Bias - I Knew It All Along</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #e0e0e0;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 30px 0;
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #ffd700, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #aaa;
            font-size: 1.2rem;
            font-style: italic;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #ffd700;
            text-decoration: none;
            font-size: 1rem;
            z-index: 100;
            background: rgba(0,0,0,0.5);
            padding: 8px 15px;
            border-radius: 20px;
        }

        .back-link:hover {
            background: rgba(255, 215, 0, 0.2);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 25px;
            margin-top: 20px;
        }

        .experiment-panel {
            background: rgba(255,255,255,0.08);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .scenario-card {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .scenario-title {
            color: #ffd700;
            font-size: 1.3rem;
            margin-bottom: 15px;
        }

        .scenario-text {
            line-height: 1.7;
            margin-bottom: 20px;
            color: #ccc;
        }

        .prediction-section {
            margin: 20px 0;
        }

        .slider-container {
            margin: 15px 0;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            color: #aaa;
            font-size: 0.9rem;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(90deg, #ff6b6b, #ffd700, #4ecdc4);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: #fff;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .probability-display {
            text-align: center;
            font-size: 2rem;
            color: #ffd700;
            margin: 10px 0;
        }

        .btn {
            background: linear-gradient(135deg, #ffd700, #ff6b6b);
            color: #1a1a2e;
            border: none;
            padding: 12px 30px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 25px;
            cursor: pointer;
            margin: 10px 5px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #4ecdc4, #45b7aa);
        }

        .outcome-reveal {
            background: linear-gradient(135deg, rgba(255,107,107,0.2), rgba(255,215,0,0.2));
            border: 2px solid #ffd700;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .outcome-title {
            color: #ffd700;
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .outcome-text {
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .recall-section {
            background: rgba(78, 205, 196, 0.1);
            border: 1px solid #4ecdc4;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .recall-title {
            color: #4ecdc4;
            font-size: 1.2rem;
            margin-bottom: 15px;
        }

        .distortion-chart {
            background: rgba(0,0,0,0.4);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .chart-bar-container {
            margin: 15px 0;
        }

        .chart-label {
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .chart-bar-wrapper {
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            height: 30px;
            position: relative;
            overflow: hidden;
        }

        .chart-bar {
            height: 100%;
            border-radius: 5px;
            display: flex;
            align-items: center;
            padding-left: 10px;
            font-weight: bold;
            transition: width 0.5s ease;
        }

        .original-bar {
            background: linear-gradient(90deg, #4ecdc4, #45b7aa);
            position: absolute;
        }

        .recalled-bar {
            background: linear-gradient(90deg, #ff6b6b, #ff8c94);
            position: absolute;
        }

        .actual-line {
            position: absolute;
            height: 100%;
            width: 3px;
            background: #ffd700;
            box-shadow: 0 0 10px #ffd700;
        }

        .side-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .info-card {
            background: rgba(255,255,255,0.08);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .info-card h3 {
            color: #4ecdc4;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .stat-box {
            background: rgba(0,0,0,0.3);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            color: #ffd700;
            font-weight: bold;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #888;
            margin-top: 3px;
        }

        .phase-indicator {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .phase {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            background: rgba(255,255,255,0.1);
            color: #666;
        }

        .phase.active {
            background: linear-gradient(135deg, #ffd700, #ff6b6b);
            color: #1a1a2e;
            font-weight: bold;
        }

        .phase.completed {
            background: rgba(78, 205, 196, 0.3);
            color: #4ecdc4;
        }

        .scenario-progress {
            text-align: center;
            color: #888;
            margin-bottom: 15px;
        }

        .scenario-nav {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 15px 0;
        }

        .nav-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            cursor: pointer;
            transition: all 0.3s;
        }

        .nav-dot.active {
            background: #ffd700;
            transform: scale(1.2);
        }

        .nav-dot.completed {
            background: #4ecdc4;
        }

        .history-item {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 10px;
            margin: 8px 0;
            font-size: 0.85rem;
        }

        .history-values {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
        }

        .original-value { color: #4ecdc4; }
        .recalled-value { color: #ff6b6b; }
        .actual-value { color: #ffd700; }

        .bias-meter {
            text-align: center;
            padding: 15px;
        }

        .bias-value {
            font-size: 2.5rem;
            font-weight: bold;
        }

        .bias-positive { color: #ff6b6b; }
        .bias-negative { color: #4ecdc4; }
        .bias-neutral { color: #888; }

        .explanation-panel {
            background: linear-gradient(135deg, rgba(255,107,107,0.1), rgba(255,215,0,0.1));
            border: 1px solid rgba(255,215,0,0.3);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .explanation-panel h3 {
            color: #ffd700;
            margin-bottom: 10px;
        }

        .quote {
            font-style: italic;
            color: #ccc;
            border-left: 3px solid #ffd700;
            padding-left: 15px;
            margin: 15px 0;
        }

        .applications-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .app-item {
            background: rgba(0,0,0,0.3);
            padding: 12px;
            border-radius: 8px;
        }

        .app-title {
            color: #ffd700;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .app-desc {
            color: #888;
            font-size: 0.8rem;
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Gallery</a>

    <div class="container">
        <header>
            <h1>Hindsight Bias</h1>
            <p class="subtitle">"I Knew It All Along" - The Illusion of Predictability</p>
        </header>

        <div class="phase-indicator">
            <div class="phase active" id="phase1">1. Predict</div>
            <div class="phase" id="phase2">2. Reveal</div>
            <div class="phase" id="phase3">3. Recall</div>
            <div class="phase" id="phase4">4. Analyze</div>
        </div>

        <div class="main-content">
            <div class="experiment-panel">
                <div class="scenario-nav" id="scenarioNav"></div>
                <div class="scenario-progress" id="scenarioProgress">Scenario 1 of 5</div>

                <div id="predictionPhase">
                    <div class="scenario-card">
                        <h2 class="scenario-title" id="scenarioTitle"></h2>
                        <p class="scenario-text" id="scenarioText"></p>
                    </div>

                    <div class="prediction-section">
                        <h3>What probability do you assign to this outcome?</h3>
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Very Unlikely</span>
                                <span>Very Likely</span>
                            </div>
                            <input type="range" id="predictionSlider" min="0" max="100" value="50">
                            <div class="probability-display"><span id="predictionValue">50</span>%</div>
                        </div>
                        <div style="text-align: center;">
                            <button class="btn" id="submitPrediction">Lock In Prediction</button>
                        </div>
                    </div>
                </div>

                <div id="outcomePhase" class="hidden">
                    <div class="outcome-reveal">
                        <h2 class="outcome-title">What Actually Happened</h2>
                        <p class="outcome-text" id="outcomeText"></p>
                    </div>
                    <div style="text-align: center;">
                        <button class="btn btn-secondary" id="proceedToRecall">Continue to Recall Phase</button>
                    </div>
                </div>

                <div id="recallPhase" class="hidden">
                    <div class="recall-section">
                        <h3 class="recall-title">Now, recall your original prediction...</h3>
                        <p>Without looking back, what probability did you ORIGINALLY assign?</p>
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Very Unlikely</span>
                                <span>Very Likely</span>
                            </div>
                            <input type="range" id="recallSlider" min="0" max="100" value="50">
                            <div class="probability-display"><span id="recallValue">50</span>%</div>
                        </div>
                        <div style="text-align: center;">
                            <button class="btn" id="submitRecall">Submit Recall</button>
                        </div>
                    </div>
                </div>

                <div id="analysisPhase" class="hidden">
                    <h3 style="color: #ffd700; margin-bottom: 15px;">Memory Distortion Revealed</h3>

                    <div class="distortion-chart">
                        <div class="chart-bar-container">
                            <div class="chart-label">Your Original Prediction: <span id="originalDisplay">0%</span></div>
                            <div class="chart-bar-wrapper">
                                <div class="chart-bar original-bar" id="originalBar"></div>
                            </div>
                        </div>
                        <div class="chart-bar-container">
                            <div class="chart-label">What You Recalled: <span id="recalledDisplay">0%</span></div>
                            <div class="chart-bar-wrapper">
                                <div class="chart-bar recalled-bar" id="recalledBar"></div>
                                <div class="actual-line" id="actualLine" style="left: 0%"></div>
                            </div>
                        </div>
                        <div class="chart-bar-container">
                            <div class="chart-label" style="color: #ffd700;">Actual Outcome: <span id="outcomeProb">100%</span></div>
                        </div>
                    </div>

                    <div style="text-align: center;">
                        <p id="distortionExplanation" style="margin: 15px 0;"></p>
                        <button class="btn btn-secondary" id="nextScenario">Next Scenario →</button>
                        <button class="btn hidden" id="showFinalResults">View Final Analysis</button>
                    </div>
                </div>

                <div id="finalResults" class="hidden">
                    <h2 style="color: #ffd700; text-align: center; margin-bottom: 20px;">
                        Your Hindsight Bias Profile
                    </h2>

                    <div class="distortion-chart" id="resultsChart"></div>

                    <div class="explanation-panel">
                        <h3>Fischhoff's Discovery (1975)</h3>
                        <p>Baruch Fischhoff gave participants information about the British-Gurkha war. Some were told the British won, others that the Gurkhas won. Both groups found their given outcome "predictable" (57-58%)!</p>
                        <div class="quote">
                            "In hindsight, people consistently exaggerate what could have been anticipated in foresight. They not only tend to view what happened as having been inevitable, but also to view it as having appeared relatively inevitable before it happened."
                            <br><strong>— Baruch Fischhoff</strong>
                        </div>

                        <h3 style="margin-top: 20px;">Why This Matters</h3>
                        <div class="applications-grid">
                            <div class="app-item">
                                <div class="app-title">Legal Judgments</div>
                                <div class="app-desc">Juries think defendants "should have known" after seeing outcomes</div>
                            </div>
                            <div class="app-item">
                                <div class="app-title">Medical Malpractice</div>
                                <div class="app-desc">Diagnoses seem "obvious" only after they're known</div>
                            </div>
                            <div class="app-item">
                                <div class="app-title">Financial Crises</div>
                                <div class="app-desc">"Everyone should have seen 2008 coming" (they didn't)</div>
                            </div>
                            <div class="app-item">
                                <div class="app-title">Historical Events</div>
                                <div class="app-desc">Pearl Harbor seems "obvious" only in retrospect</div>
                            </div>
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn" id="restartExperiment">Try Again</button>
                    </div>
                </div>
            </div>

            <div class="side-panel">
                <div class="info-card">
                    <h3>Your Bias Score</h3>
                    <div class="bias-meter">
                        <div class="bias-value" id="biasScore">—</div>
                        <p id="biasLabel">Complete scenarios to calculate</p>
                    </div>
                </div>

                <div class="info-card">
                    <h3>Session Statistics</h3>
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-value" id="avgDistortion">—</div>
                            <div class="stat-label">Avg. Distortion</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="scenariosCompleted">0</div>
                            <div class="stat-label">Completed</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="shiftedToward">0</div>
                            <div class="stat-label">Shifted Toward</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="shiftedAway">0</div>
                            <div class="stat-label">Shifted Away</div>
                        </div>
                    </div>
                </div>

                <div class="info-card">
                    <h3>Response History</h3>
                    <div id="historyContainer" style="max-height: 200px; overflow-y: auto;">
                        <p style="color: #666; font-size: 0.9rem;">Complete scenarios to see history</p>
                    </div>
                </div>

                <div class="info-card">
                    <h3>The Science</h3>
                    <p style="font-size: 0.85rem; color: #aaa; line-height: 1.6;">
                        <strong>Creeping Determinism:</strong> Once we know an outcome, our memory reconstructs the past to make it seem inevitable.
                        <br><br>
                        <strong>Three Components:</strong><br>
                        1. Memory distortion (forgetting original views)<br>
                        2. Inevitability ("had to happen")<br>
                        3. Foreseeability ("was predictable")
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const scenarios = [
            {
                title: "The Nixon-China Visit (1972)",
                text: "In 1972, President Richard Nixon announced he would visit Communist China—a country the US had no diplomatic relations with for 25 years. Foreign policy experts debated: Would the visit succeed in opening relations, or would it be a diplomatic disaster? Nixon faced opposition from anti-communist hardliners in his own party.",
                outcome: "The visit was a major success. Nixon met with Mao Zedong, opened diplomatic channels, and fundamentally changed US-China relations. The 'Nixon goes to China' moment became shorthand for unexpected diplomatic breakthroughs.",
                wasSuccess: true
            },
            {
                title: "Kodak and Digital Photography (1975)",
                text: "In 1975, Kodak engineer Steven Sasson invented the first digital camera. Kodak's leadership faced a choice: invest heavily in digital technology, or continue focusing on their profitable film business? Digital images were low-quality and storage was expensive. Kodak controlled 90% of the film market.",
                outcome: "Kodak chose to protect their film business and minimized digital investment. By 2012, Kodak filed for bankruptcy. The company that invented digital photography was destroyed by it. Digital cameras and smartphones eliminated film photography almost entirely.",
                wasSuccess: false
            },
            {
                title: "The Challenger Launch Decision (1986)",
                text: "On January 27, 1986, NASA prepared to launch the Space Shuttle Challenger. Engineers at Morton Thiokol raised concerns about launching in cold weather—O-ring seals might not work below 53°F. Launch temperature would be 36°F. Management faced pressure: 7 previous launch delays had embarrassed the program.",
                outcome: "NASA launched despite engineer warnings. 73 seconds after liftoff, Challenger exploded, killing all 7 crew members. The O-rings failed exactly as engineers predicted. The disaster led to a complete overhaul of NASA's decision-making culture.",
                wasSuccess: false
            },
            {
                title: "Netflix's Streaming Pivot (2007)",
                text: "In 2007, Netflix (a DVD-by-mail company) considered pivoting to streaming video. They had 7.5 million DVD subscribers. Internet speeds were slow, content licensing expensive, and Blockbuster dominated physical rentals with 9,000 stores. Many predicted streaming was years away from mainstream adoption.",
                outcome: "Netflix's streaming bet succeeded spectacularly. By 2023, Netflix had 230+ million subscribers. Blockbuster went bankrupt in 2010. Netflix became synonymous with streaming entertainment and changed how the world watches TV and movies.",
                wasSuccess: true
            },
            {
                title: "The Cuban Missile Crisis (1962)",
                text: "In October 1962, US intelligence discovered Soviet nuclear missiles in Cuba, just 90 miles from Florida. Kennedy's advisors were divided: some urged immediate military strikes, others diplomatic pressure. Soviet ships were sailing toward the US naval blockade. The world had never been closer to nuclear war.",
                outcome: "After 13 tense days, Khrushchev agreed to remove the missiles in exchange for a US pledge not to invade Cuba (and secret removal of US missiles from Turkey). Nuclear war was avoided. The crisis led to improved US-Soviet communication channels.",
                wasSuccess: true
            }
        ];

        let currentScenario = 0;
        let predictions = [];
        let recalls = [];
        let results = [];
        let phase = 'prediction';

        const elements = {
            scenarioTitle: document.getElementById('scenarioTitle'),
            scenarioText: document.getElementById('scenarioText'),
            predictionSlider: document.getElementById('predictionSlider'),
            predictionValue: document.getElementById('predictionValue'),
            recallSlider: document.getElementById('recallSlider'),
            recallValue: document.getElementById('recallValue'),
            outcomeText: document.getElementById('outcomeText'),
            predictionPhase: document.getElementById('predictionPhase'),
            outcomePhase: document.getElementById('outcomePhase'),
            recallPhase: document.getElementById('recallPhase'),
            analysisPhase: document.getElementById('analysisPhase'),
            finalResults: document.getElementById('finalResults'),
            submitPrediction: document.getElementById('submitPrediction'),
            proceedToRecall: document.getElementById('proceedToRecall'),
            submitRecall: document.getElementById('submitRecall'),
            nextScenario: document.getElementById('nextScenario'),
            showFinalResults: document.getElementById('showFinalResults'),
            restartExperiment: document.getElementById('restartExperiment'),
            scenarioProgress: document.getElementById('scenarioProgress'),
            scenarioNav: document.getElementById('scenarioNav'),
            historyContainer: document.getElementById('historyContainer')
        };

        function init() {
            createNavDots();
            loadScenario(0);
            setupEventListeners();
        }

        function createNavDots() {
            elements.scenarioNav.innerHTML = '';
            for (let i = 0; i < scenarios.length; i++) {
                const dot = document.createElement('div');
                dot.className = 'nav-dot' + (i === 0 ? ' active' : '');
                dot.dataset.index = i;
                elements.scenarioNav.appendChild(dot);
            }
        }

        function updateNavDots() {
            const dots = elements.scenarioNav.querySelectorAll('.nav-dot');
            dots.forEach((dot, i) => {
                dot.className = 'nav-dot';
                if (i === currentScenario) dot.classList.add('active');
                if (i < currentScenario) dot.classList.add('completed');
            });
        }

        function updatePhaseIndicator(currentPhase) {
            const phases = ['phase1', 'phase2', 'phase3', 'phase4'];
            const phaseIndex = {'prediction': 0, 'outcome': 1, 'recall': 2, 'analysis': 3};

            phases.forEach((id, i) => {
                const el = document.getElementById(id);
                el.className = 'phase';
                if (i < phaseIndex[currentPhase]) el.classList.add('completed');
                if (i === phaseIndex[currentPhase]) el.classList.add('active');
            });
        }

        function loadScenario(index) {
            const scenario = scenarios[index];
            elements.scenarioTitle.textContent = scenario.title;
            elements.scenarioText.textContent = scenario.text;
            elements.scenarioProgress.textContent = `Scenario ${index + 1} of ${scenarios.length}`;

            // Reset sliders
            elements.predictionSlider.value = 50;
            elements.predictionValue.textContent = '50';
            elements.recallSlider.value = 50;
            elements.recallValue.textContent = '50';

            showPhase('prediction');
            updateNavDots();
        }

        function showPhase(phaseName) {
            phase = phaseName;
            elements.predictionPhase.classList.add('hidden');
            elements.outcomePhase.classList.add('hidden');
            elements.recallPhase.classList.add('hidden');
            elements.analysisPhase.classList.add('hidden');
            elements.finalResults.classList.add('hidden');

            switch(phaseName) {
                case 'prediction':
                    elements.predictionPhase.classList.remove('hidden');
                    break;
                case 'outcome':
                    elements.outcomePhase.classList.remove('hidden');
                    break;
                case 'recall':
                    elements.recallPhase.classList.remove('hidden');
                    break;
                case 'analysis':
                    elements.analysisPhase.classList.remove('hidden');
                    break;
                case 'final':
                    elements.finalResults.classList.remove('hidden');
                    break;
            }
            updatePhaseIndicator(phaseName);
        }

        function setupEventListeners() {
            elements.predictionSlider.addEventListener('input', (e) => {
                elements.predictionValue.textContent = e.target.value;
            });

            elements.recallSlider.addEventListener('input', (e) => {
                elements.recallValue.textContent = e.target.value;
            });

            elements.submitPrediction.addEventListener('click', () => {
                const prediction = parseInt(elements.predictionSlider.value);
                predictions[currentScenario] = prediction;

                elements.outcomeText.textContent = scenarios[currentScenario].outcome;
                showPhase('outcome');
            });

            elements.proceedToRecall.addEventListener('click', () => {
                // Set recall slider to a random position to avoid anchoring
                const randomStart = Math.floor(Math.random() * 40) + 30;
                elements.recallSlider.value = randomStart;
                elements.recallValue.textContent = randomStart;
                showPhase('recall');
            });

            elements.submitRecall.addEventListener('click', () => {
                const recall = parseInt(elements.recallSlider.value);
                recalls[currentScenario] = recall;

                analyzeResult();
            });

            elements.nextScenario.addEventListener('click', () => {
                currentScenario++;
                if (currentScenario < scenarios.length) {
                    loadScenario(currentScenario);
                }
            });

            elements.showFinalResults.addEventListener('click', showFinalAnalysis);
            elements.restartExperiment.addEventListener('click', restart);
        }

        function analyzeResult() {
            const original = predictions[currentScenario];
            const recalled = recalls[currentScenario];
            const scenario = scenarios[currentScenario];
            const actualOutcome = scenario.wasSuccess ? 100 : 0;

            results[currentScenario] = {
                original,
                recalled,
                actualOutcome,
                distortion: recalled - original,
                title: scenario.title
            };

            // Update display
            document.getElementById('originalDisplay').textContent = original + '%';
            document.getElementById('recalledDisplay').textContent = recalled + '%';
            document.getElementById('originalBar').style.width = original + '%';
            document.getElementById('recalledBar').style.width = recalled + '%';
            document.getElementById('actualLine').style.left = actualOutcome + '%';
            document.getElementById('outcomeProb').textContent = (scenario.wasSuccess ? 'Success' : 'Failure');

            const distortion = recalled - original;
            const shiftedTowardOutcome = (scenario.wasSuccess && distortion > 0) || (!scenario.wasSuccess && distortion < 0);

            let explanation;
            if (Math.abs(distortion) < 5) {
                explanation = "Your recall was quite accurate! Minimal hindsight distortion detected.";
            } else if (shiftedTowardOutcome) {
                explanation = `Your memory shifted ${Math.abs(distortion)} points TOWARD the outcome. Classic hindsight bias: knowing the result made it seem more predictable.`;
            } else {
                explanation = `Interesting! Your memory shifted ${Math.abs(distortion)} points AWAY from the outcome. This is less common but can happen with surprising results.`;
            }
            document.getElementById('distortionExplanation').textContent = explanation;

            updateStats();
            updateHistory();

            showPhase('analysis');

            // Show appropriate button
            if (currentScenario === scenarios.length - 1) {
                elements.nextScenario.classList.add('hidden');
                elements.showFinalResults.classList.remove('hidden');
            } else {
                elements.nextScenario.classList.remove('hidden');
                elements.showFinalResults.classList.add('hidden');
            }
        }

        function updateStats() {
            const completed = results.filter(r => r).length;
            document.getElementById('scenariosCompleted').textContent = completed;

            if (completed > 0) {
                const validResults = results.filter(r => r);
                const avgDist = validResults.reduce((sum, r) => sum + Math.abs(r.distortion), 0) / completed;
                document.getElementById('avgDistortion').textContent = avgDist.toFixed(1) + '%';

                let towardCount = 0, awayCount = 0;
                validResults.forEach(r => {
                    const shiftedToward = (r.actualOutcome === 100 && r.distortion > 0) ||
                                         (r.actualOutcome === 0 && r.distortion < 0);
                    if (Math.abs(r.distortion) >= 5) {
                        if (shiftedToward) towardCount++;
                        else awayCount++;
                    }
                });
                document.getElementById('shiftedToward').textContent = towardCount;
                document.getElementById('shiftedAway').textContent = awayCount;

                // Calculate bias score
                const biasScore = validResults.reduce((sum, r) => {
                    const expected = r.actualOutcome === 100 ? 1 : -1;
                    return sum + (r.distortion * expected);
                }, 0) / completed;

                const biasEl = document.getElementById('biasScore');
                const biasLabel = document.getElementById('biasLabel');

                if (biasScore > 10) {
                    biasEl.textContent = '+' + biasScore.toFixed(0);
                    biasEl.className = 'bias-value bias-positive';
                    biasLabel.textContent = 'Strong hindsight bias';
                } else if (biasScore > 3) {
                    biasEl.textContent = '+' + biasScore.toFixed(0);
                    biasEl.className = 'bias-value bias-positive';
                    biasLabel.textContent = 'Moderate hindsight bias';
                } else if (biasScore < -3) {
                    biasEl.textContent = biasScore.toFixed(0);
                    biasEl.className = 'bias-value bias-negative';
                    biasLabel.textContent = 'Reverse bias (unusual!)';
                } else {
                    biasEl.textContent = '~0';
                    biasEl.className = 'bias-value bias-neutral';
                    biasLabel.textContent = 'Minimal bias detected';
                }
            }
        }

        function updateHistory() {
            const validResults = results.filter(r => r);
            if (validResults.length === 0) return;

            elements.historyContainer.innerHTML = validResults.map(r => `
                <div class="history-item">
                    <div style="color: #ffd700; font-size: 0.8rem;">${r.title.split('(')[0].trim()}</div>
                    <div class="history-values">
                        <span class="original-value">Original: ${r.original}%</span>
                        <span class="recalled-value">Recalled: ${r.recalled}%</span>
                    </div>
                    <div style="color: ${r.distortion > 0 ? '#ff6b6b' : '#4ecdc4'}; font-size: 0.8rem;">
                        Shift: ${r.distortion > 0 ? '+' : ''}${r.distortion}%
                    </div>
                </div>
            `).join('');
        }

        function showFinalAnalysis() {
            showPhase('final');

            const resultsChart = document.getElementById('resultsChart');
            resultsChart.innerHTML = '<h4 style="color: #ffd700; margin-bottom: 15px;">All Your Scenarios</h4>';

            results.filter(r => r).forEach(r => {
                const shortTitle = r.title.split('(')[0].trim();
                resultsChart.innerHTML += `
                    <div class="chart-bar-container">
                        <div class="chart-label" style="font-size: 0.85rem;">${shortTitle}</div>
                        <div class="chart-bar-wrapper">
                            <div class="chart-bar original-bar" style="width: ${r.original}%; opacity: 0.7;"></div>
                            <div class="chart-bar recalled-bar" style="width: ${r.recalled}%; height: 50%; top: 25%;"></div>
                            <div class="actual-line" style="left: ${r.actualOutcome}%"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 0.75rem; margin-top: 3px;">
                            <span class="original-value">Original: ${r.original}%</span>
                            <span class="recalled-value">Recalled: ${r.recalled}%</span>
                            <span style="color: ${Math.abs(r.distortion) < 5 ? '#888' : (((r.actualOutcome === 100 && r.distortion > 0) || (r.actualOutcome === 0 && r.distortion < 0)) ? '#ff6b6b' : '#4ecdc4')}">
                                Shift: ${r.distortion > 0 ? '+' : ''}${r.distortion}%
                            </span>
                        </div>
                    </div>
                `;
            });

            resultsChart.innerHTML += `
                <div style="margin-top: 15px; font-size: 0.8rem;">
                    <span style="color: #4ecdc4;">■</span> Original prediction
                    <span style="color: #ff6b6b; margin-left: 10px;">■</span> Recalled
                    <span style="color: #ffd700; margin-left: 10px;">|</span> Actual outcome
                </div>
            `;
        }

        function restart() {
            currentScenario = 0;
            predictions = [];
            recalls = [];
            results = [];

            document.getElementById('biasScore').textContent = '—';
            document.getElementById('biasLabel').textContent = 'Complete scenarios to calculate';
            document.getElementById('avgDistortion').textContent = '—';
            document.getElementById('scenariosCompleted').textContent = '0';
            document.getElementById('shiftedToward').textContent = '0';
            document.getElementById('shiftedAway').textContent = '0';
            elements.historyContainer.innerHTML = '<p style="color: #666; font-size: 0.9rem;">Complete scenarios to see history</p>';

            elements.nextScenario.classList.remove('hidden');
            elements.showFinalResults.classList.add('hidden');

            loadScenario(0);
        }

        init();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
