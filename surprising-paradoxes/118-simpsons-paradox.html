<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simpson's Paradox - When Data Lies</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5em;
            background: linear-gradient(135deg, #e94560, #ffd700, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.3em;
            color: #aaa;
            font-style: italic;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #e94560;
            text-decoration: none;
            font-size: 1.1em;
            z-index: 100;
            transition: color 0.3s;
        }

        .back-link:hover {
            color: #ffd700;
        }

        .scenario-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .scenario-btn {
            padding: 12px 25px;
            font-size: 1em;
            border: 2px solid #e94560;
            background: transparent;
            color: #e94560;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
        }

        .scenario-btn:hover, .scenario-btn.active {
            background: #e94560;
            color: white;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 1000px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: rgba(30, 40, 70, 0.8);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(233, 69, 96, 0.3);
        }

        .panel h2 {
            color: #e94560;
            margin-bottom: 20px;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .verdict {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8em;
            margin-left: auto;
        }

        .verdict.bias-male {
            background: #4a90d9;
            color: white;
        }

        .verdict.bias-female {
            background: #e94560;
            color: white;
        }

        .verdict.fair {
            background: #00ff88;
            color: #000;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .data-table th, .data-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .data-table th {
            color: #ffd700;
            font-weight: normal;
            font-size: 0.9em;
        }

        .data-table tr:hover {
            background: rgba(233, 69, 96, 0.1);
        }

        .rate-bar {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .bar-container {
            flex: 1;
            height: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
        }

        .bar {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .bar.male {
            background: linear-gradient(90deg, #4a90d9, #6ab0ff);
        }

        .bar.female {
            background: linear-gradient(90deg, #e94560, #ff6b8a);
        }

        .rate-value {
            min-width: 50px;
            font-family: monospace;
            font-size: 1.1em;
        }

        .rate-value.winner {
            color: #00ff88;
            font-weight: bold;
        }

        .aggregate-box {
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.1), rgba(0, 0, 255, 0.1));
            border: 2px solid #ffd700;
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            text-align: center;
        }

        .aggregate-box h3 {
            color: #ffd700;
            margin-bottom: 20px;
        }

        .aggregate-rates {
            display: flex;
            justify-content: center;
            gap: 50px;
        }

        .aggregate-item {
            text-align: center;
        }

        .aggregate-label {
            font-size: 0.9em;
            color: #aaa;
            margin-bottom: 5px;
        }

        .aggregate-value {
            font-size: 2.5em;
            font-family: monospace;
        }

        .aggregate-value.male {
            color: #4a90d9;
        }

        .aggregate-value.female {
            color: #e94560;
        }

        .vs {
            font-size: 1.5em;
            color: #ffd700;
            align-self: center;
        }

        .explanation {
            background: rgba(30, 40, 70, 0.8);
            border-radius: 15px;
            padding: 30px;
            border: 1px solid rgba(255, 215, 0, 0.3);
            margin-bottom: 30px;
        }

        .explanation h2 {
            color: #ffd700;
            margin-bottom: 20px;
        }

        .explanation p {
            line-height: 1.8;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .highlight {
            color: #e94560;
            font-weight: bold;
        }

        .paradox-box {
            background: linear-gradient(135deg, rgba(233, 69, 96, 0.2), rgba(74, 144, 217, 0.2));
            border: 2px solid #ffd700;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            text-align: center;
        }

        .paradox-box h3 {
            color: #ffd700;
            font-size: 1.5em;
            margin-bottom: 15px;
        }

        .paradox-box p {
            font-size: 1.2em;
        }

        .lurking-variable {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid #00ff88;
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
        }

        .lurking-variable h3 {
            color: #00ff88;
            margin-bottom: 15px;
        }

        .application-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .application-card {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 12px;
        }

        .application-card h4 {
            color: #ffd700;
            margin-bottom: 10px;
        }

        .dept-difficulty {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 10px;
            font-size: 0.8em;
            margin-left: 10px;
        }

        .dept-difficulty.easy {
            background: #00ff88;
            color: #000;
        }

        .dept-difficulty.hard {
            background: #e94560;
            color: white;
        }

        .dept-difficulty.medium {
            background: #ffd700;
            color: #000;
        }

        .applicant-flow {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 20px 0;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
        }

        .flow-group {
            text-align: center;
        }

        .flow-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .flow-arrow {
            font-size: 2em;
            color: #ffd700;
        }

        .flow-depts {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .flow-dept {
            padding: 5px 15px;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .winner-badge {
            color: #00ff88;
            font-weight: bold;
        }

        canvas {
            width: 100%;
            border-radius: 10px;
            background: #0a0f1a;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Paradoxes</a>

    <div class="container">
        <header>
            <h1>üìä Simpson's Paradox</h1>
            <p class="subtitle">When Aggregated Data Tells the Opposite Story</p>
        </header>

        <div class="scenario-selector">
            <button class="scenario-btn active" data-scenario="berkeley">üéì UC Berkeley (1973)</button>
            <button class="scenario-btn" data-scenario="treatment">üíä Medical Treatment</button>
            <button class="scenario-btn" data-scenario="batting">‚öæ Batting Averages</button>
        </div>

        <div class="main-grid">
            <div class="panel">
                <h2>
                    üìã Aggregated View
                    <span class="verdict bias-male" id="aggregateVerdict">Appears biased against women!</span>
                </h2>
                <p id="aggregateDescription" style="color: #aaa; margin-bottom: 15px;">
                    Looking at overall admission rates across all departments...
                </p>
                <div class="aggregate-box">
                    <h3 id="aggregateTitle">Overall Admission Rates</h3>
                    <div class="aggregate-rates">
                        <div class="aggregate-item">
                            <div class="aggregate-label" id="groupALabel">Men</div>
                            <div class="aggregate-value male" id="aggregateA">44%</div>
                        </div>
                        <div class="vs">vs</div>
                        <div class="aggregate-item">
                            <div class="aggregate-label" id="groupBLabel">Women</div>
                            <div class="aggregate-value female" id="aggregateB">35%</div>
                        </div>
                    </div>
                    <p style="margin-top: 20px; color: #ff6b6b;" id="aggregateConclusion">
                        ‚ö†Ô∏è This looks like discrimination! Men are admitted at a 9% higher rate!
                    </p>
                </div>
            </div>

            <div class="panel">
                <h2>
                    üîç Disaggregated View
                    <span class="verdict bias-female" id="detailVerdict">Actually favors women!</span>
                </h2>
                <p id="detailDescription" style="color: #aaa; margin-bottom: 15px;">
                    Breaking down by department reveals the truth...
                </p>
                <table class="data-table" id="detailTable">
                    <thead>
                        <tr>
                            <th>Department</th>
                            <th>Men Applied</th>
                            <th>Men Rate</th>
                            <th>Women Applied</th>
                            <th>Women Rate</th>
                            <th>Winner</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <div class="panel">
            <h2>üìà Visual Comparison</h2>
            <canvas id="chartCanvas" width="800" height="300"></canvas>
        </div>

        <div class="explanation">
            <h2>ü§Ø The Mind-Bending Paradox</h2>

            <p>
                <span class="highlight">Simpson's Paradox</span> occurs when a trend that appears in aggregated data
                <span class="highlight">reverses or disappears</span> when the data is broken into subgroups.
                This isn't a statistical error‚Äîit's a warning about hidden variables!
            </p>

            <div class="paradox-box">
                <h3>üîÑ The Reversal</h3>
                <p>
                    <strong style="color: #4a90d9;">Group A</strong> can beat
                    <strong style="color: #e94560;">Group B</strong> in EVERY subgroup...<br>
                    Yet <strong style="color: #e94560;">Group B</strong> beats
                    <strong style="color: #4a90d9;">Group A</strong> when you combine them!
                </p>
            </div>

            <div class="lurking-variable">
                <h3>üïµÔ∏è The Lurking Variable</h3>
                <p style="color: #ccc; line-height: 1.8;" id="lurkingExplanation">
                    In the Berkeley case, the "lurking variable" was <strong>which department</strong> applicants chose.
                    Women applied more to competitive departments (like English) with low acceptance rates,
                    while men applied more to less competitive departments (like Engineering) with high acceptance rates.
                    <br><br>
                    When you combine departments with different acceptance rates and different gender ratios,
                    the weighted average creates an illusion of bias that doesn't exist within any single department!
                </p>
            </div>

            <div class="applicant-flow" id="flowDiagram">
                <div class="flow-group">
                    <div class="flow-icon">üë®</div>
                    <div style="color: #4a90d9;">Men mostly applied to:</div>
                    <div class="flow-depts">
                        <div class="flow-dept" style="background: #00ff88; color: #000;">Dept A (62% accept)</div>
                        <div class="flow-dept" style="background: #00ff88; color: #000;">Dept B (63% accept)</div>
                    </div>
                </div>
                <div class="flow-arrow">‚Üí 44% overall ‚Üê</div>
                <div class="flow-group">
                    <div class="flow-icon">üë©</div>
                    <div style="color: #e94560;">Women mostly applied to:</div>
                    <div class="flow-depts">
                        <div class="flow-dept" style="background: #e94560; color: white;">Dept E (24% accept)</div>
                        <div class="flow-dept" style="background: #e94560; color: white;">Dept F (7% accept)</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="panel">
            <h2>‚ö†Ô∏è Real-World Implications</h2>
            <div class="application-grid">
                <div class="application-card">
                    <h4>‚öñÔ∏è Legal Cases</h4>
                    <p>Employment discrimination lawsuits can be won or lost depending on how data is grouped. Always demand disaggregated analysis!</p>
                </div>
                <div class="application-card">
                    <h4>üíä Medical Decisions</h4>
                    <p>A treatment can be worse for men AND worse for women, yet appear better overall if more healthy patients receive it.</p>
                </div>
                <div class="application-card">
                    <h4>üìä Policy Decisions</h4>
                    <p>Education outcomes, crime statistics, and economic data can all exhibit Simpson's Paradox when improperly aggregated.</p>
                </div>
                <div class="application-card">
                    <h4>üß† Critical Thinking</h4>
                    <p>Whenever you see aggregated statistics, ask: "What subgroups exist? Could there be a lurking variable?"</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const scenarios = {
            berkeley: {
                title: "UC Berkeley Graduate Admissions (1973)",
                groupA: "Men",
                groupB: "Women",
                aggregateA: 44,
                aggregateB: 35,
                aggregateConclusion: "‚ö†Ô∏è This looks like discrimination! Men are admitted at a 9% higher rate!",
                detailConclusion: "‚úì In 4 of 6 departments, women have HIGHER admission rates!",
                aggregateVerdict: "Appears biased against women!",
                detailVerdict: "Actually slightly favors women!",
                departments: [
                    { name: "Dept A", difficulty: "easy", menApplied: 825, menRate: 62, womenApplied: 108, womenRate: 82 },
                    { name: "Dept B", difficulty: "easy", menApplied: 560, menRate: 63, womenApplied: 25, womenRate: 68 },
                    { name: "Dept C", difficulty: "medium", menApplied: 325, menRate: 37, womenApplied: 593, womenRate: 34 },
                    { name: "Dept D", difficulty: "medium", menApplied: 417, menRate: 33, womenApplied: 375, womenRate: 35 },
                    { name: "Dept E", difficulty: "hard", menApplied: 191, menRate: 28, womenApplied: 393, womenRate: 24 },
                    { name: "Dept F", difficulty: "hard", menApplied: 373, menRate: 6, womenApplied: 341, womenRate: 7 }
                ],
                lurking: "In the Berkeley case, the 'lurking variable' was <strong>which department</strong> applicants chose. Women applied more to competitive departments (like English) with low acceptance rates, while men applied more to less competitive departments (like Engineering) with high acceptance rates."
            },
            treatment: {
                title: "Kidney Stone Treatment Study",
                groupA: "Treatment A",
                groupB: "Treatment B",
                aggregateA: 78,
                aggregateB: 83,
                aggregateConclusion: "‚ö†Ô∏è Treatment B looks better with 83% vs 78% success!",
                detailConclusion: "‚úì Treatment A is actually better for BOTH small AND large stones!",
                aggregateVerdict: "Treatment B appears better!",
                detailVerdict: "Treatment A is actually better!",
                departments: [
                    { name: "Small Stones", difficulty: "easy", menApplied: 87, menRate: 93, womenApplied: 270, womenRate: 87 },
                    { name: "Large Stones", difficulty: "hard", menApplied: 263, menRate: 73, womenApplied: 80, womenRate: 69 }
                ],
                lurking: "Doctors gave Treatment A (more invasive, open surgery) to patients with <strong>larger, more difficult stones</strong>. Treatment B (less invasive) was given to patients with <strong>smaller, easier stones</strong>. The patient severity is the lurking variable that creates the paradox."
            },
            batting: {
                title: "Baseball Batting Averages",
                groupA: "Player Derek",
                groupB: "Player David",
                aggregateA: 310,
                aggregateB: 321,
                aggregateConclusion: "‚ö†Ô∏è David has a higher overall average: .321 vs .310!",
                detailConclusion: "‚úì Derek has a HIGHER average in BOTH years!",
                aggregateVerdict: "David appears better!",
                detailVerdict: "Derek is actually better!",
                departments: [
                    { name: "1995 Season", difficulty: "medium", menApplied: 48, menRate: 250, womenApplied: 411, womenRate: 238 },
                    { name: "1996 Season", difficulty: "medium", menApplied: 582, menRate: 314, womenApplied: 140, womenRate: 360 }
                ],
                lurking: "Derek had far fewer at-bats in 1995 (when averages were lower for both) and many more in 1996. David had the opposite pattern. The <strong>number of at-bats per season</strong> weights the averages differently, creating the paradox."
            }
        };

        let currentScenario = 'berkeley';

        function updateDisplay() {
            const data = scenarios[currentScenario];

            // Update aggregate section
            document.getElementById('aggregateTitle').textContent = data.title;
            document.getElementById('groupALabel').textContent = data.groupA;
            document.getElementById('groupBLabel').textContent = data.groupB;

            const unitA = currentScenario === 'batting' ? '' : '%';
            const unitB = currentScenario === 'batting' ? '' : '%';
            const displayA = currentScenario === 'batting' ? '.' + data.aggregateA : data.aggregateA + '%';
            const displayB = currentScenario === 'batting' ? '.' + data.aggregateB : data.aggregateB + '%';

            document.getElementById('aggregateA').textContent = displayA;
            document.getElementById('aggregateB').textContent = displayB;
            document.getElementById('aggregateConclusion').textContent = data.aggregateConclusion;
            document.getElementById('aggregateVerdict').textContent = data.aggregateVerdict;
            document.getElementById('detailVerdict').textContent = data.detailVerdict;
            document.getElementById('lurkingExplanation').innerHTML = data.lurking;

            // Update table
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            data.departments.forEach(dept => {
                const isBatting = currentScenario === 'batting';
                const rateA = isBatting ? '.' + dept.menRate : dept.menRate + '%';
                const rateB = isBatting ? '.' + dept.womenRate : dept.womenRate + '%';
                const winner = dept.menRate > dept.womenRate ? data.groupA : dept.womenRate > dept.menRate ? data.groupB : 'Tie';
                const winnerClass = winner === data.groupA ? 'color: #4a90d9' : winner === data.groupB ? 'color: #e94560' : 'color: #888';

                tbody.innerHTML += `
                    <tr>
                        <td>${dept.name} <span class="dept-difficulty ${dept.difficulty}">${dept.difficulty}</span></td>
                        <td>${dept.menApplied}</td>
                        <td>${rateA}</td>
                        <td>${dept.womenApplied}</td>
                        <td>${rateB}</td>
                        <td style="${winnerClass}; font-weight: bold;">${winner === data.groupB ? '‚úì ' + winner : winner}</td>
                    </tr>
                `;
            });

            // Update flow diagram visibility
            document.getElementById('flowDiagram').style.display = currentScenario === 'berkeley' ? 'flex' : 'none';

            drawChart();
        }

        function drawChart() {
            const canvas = document.getElementById('chartCanvas');
            const ctx = canvas.getContext('2d');
            const data = scenarios[currentScenario];

            const w = canvas.width;
            const h = canvas.height;
            ctx.clearRect(0, 0, w, h);

            ctx.fillStyle = '#0a0f1a';
            ctx.fillRect(0, 0, w, h);

            const padding = 60;
            const barWidth = 30;
            const groupGap = 20;
            const deptGap = 80;

            const isBatting = currentScenario === 'batting';
            const maxRate = isBatting ? 400 : 100;

            // Draw each department's comparison
            const depts = data.departments;
            const totalWidth = depts.length * (barWidth * 2 + groupGap) + (depts.length - 1) * deptGap;
            let startX = (w - totalWidth) / 2;

            // Title
            ctx.fillStyle = '#888';
            ctx.font = '14px Georgia';
            ctx.textAlign = 'center';
            ctx.fillText('Success Rate Comparison by Subgroup', w / 2, 25);

            depts.forEach((dept, i) => {
                const x = startX + i * (barWidth * 2 + groupGap + deptGap);

                // Group A bar
                const heightA = (dept.menRate / maxRate) * (h - padding * 2);
                ctx.fillStyle = '#4a90d9';
                ctx.fillRect(x, h - padding - heightA, barWidth, heightA);

                // Group B bar
                const heightB = (dept.womenRate / maxRate) * (h - padding * 2);
                ctx.fillStyle = '#e94560';
                ctx.fillRect(x + barWidth + 5, h - padding - heightB, barWidth, heightB);

                // Labels
                ctx.fillStyle = '#aaa';
                ctx.font = '12px Georgia';
                ctx.textAlign = 'center';
                ctx.fillText(dept.name, x + barWidth + 2, h - 20);

                // Rate labels
                ctx.font = '11px monospace';
                ctx.fillStyle = '#4a90d9';
                const labelA = isBatting ? '.' + dept.menRate : dept.menRate + '%';
                ctx.fillText(labelA, x + barWidth / 2, h - padding - heightA - 5);

                ctx.fillStyle = '#e94560';
                const labelB = isBatting ? '.' + dept.womenRate : dept.womenRate + '%';
                ctx.fillText(labelB, x + barWidth + 5 + barWidth / 2, h - padding - heightB - 5);

                // Winner indicator
                if (dept.womenRate > dept.menRate) {
                    ctx.fillStyle = '#00ff88';
                    ctx.font = 'bold 14px Georgia';
                    ctx.fillText('‚úì', x + barWidth + 5 + barWidth / 2, h - padding - heightB - 20);
                }
            });

            // Legend
            ctx.fillStyle = '#4a90d9';
            ctx.fillRect(w - 150, 20, 15, 15);
            ctx.fillStyle = '#ddd';
            ctx.font = '12px Georgia';
            ctx.textAlign = 'left';
            ctx.fillText(data.groupA, w - 130, 32);

            ctx.fillStyle = '#e94560';
            ctx.fillRect(w - 150, 45, 15, 15);
            ctx.fillStyle = '#ddd';
            ctx.fillText(data.groupB, w - 130, 57);
        }

        // Scenario buttons
        document.querySelectorAll('.scenario-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.scenario-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentScenario = btn.dataset.scenario;
                updateDisplay();
            });
        });

        // Initial display
        updateDisplay();
    </script>
</body>
</html>
