<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Lamb Shift - Surprising Paradoxes</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #0a0a12 0%, #1a1a2e 50%, #0f0f1a 100%);
            color: #e0e0e0;
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
        }

        .back-link {
            display: inline-block;
            color: #f4a261;
            text-decoration: none;
            margin-bottom: 20px;
            font-size: 0.95rem;
            transition: color 0.3s;
        }

        .back-link:hover { color: #e9c46a; }

        h1 {
            font-size: 2.5rem;
            color: #e9c46a;
            margin-bottom: 15px;
            text-shadow: 0 0 40px rgba(233, 196, 106, 0.3);
        }

        .subtitle {
            font-size: 1.2rem;
            color: #8ecae6;
            font-style: italic;
        }

        .visualization-container {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 40px;
            border: 1px solid rgba(233, 196, 106, 0.2);
        }

        .dual-view {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .view-panel {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 15px;
        }

        .view-panel h3 {
            color: #e9c46a;
            text-align: center;
            margin-bottom: 10px;
            font-size: 0.95rem;
        }

        canvas {
            border-radius: 8px;
            background: #000;
            display: block;
            margin: 0 auto;
        }

        .info-panel {
            background: rgba(142, 202, 230, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            text-align: center;
        }

        .shift-value {
            font-size: 2rem;
            color: #e9c46a;
            font-weight: bold;
        }

        .shift-label {
            font-size: 0.9rem;
            color: #8ecae6;
            margin-top: 5px;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .control-group {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            color: #e9c46a;
            font-size: 0.9rem;
        }

        .control-group input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }

        .control-group .value {
            text-align: right;
            font-size: 0.8rem;
            color: #8ecae6;
        }

        .mode-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .mode-btn {
            padding: 10px 18px;
            border: 1px solid rgba(233, 196, 106, 0.5);
            background: rgba(233, 196, 106, 0.1);
            color: #e9c46a;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85rem;
        }

        .mode-btn:hover {
            background: rgba(233, 196, 106, 0.2);
        }

        .mode-btn.active {
            background: rgba(233, 196, 106, 0.3);
            border-color: #e9c46a;
        }

        .essay {
            line-height: 1.9;
            font-size: 1.1rem;
        }

        .essay h2 {
            color: #e9c46a;
            margin: 40px 0 20px;
            font-size: 1.6rem;
            border-bottom: 1px solid rgba(233, 196, 106, 0.3);
            padding-bottom: 10px;
        }

        .essay h3 {
            color: #f4a261;
            margin: 30px 0 15px;
            font-size: 1.3rem;
        }

        .essay p {
            margin-bottom: 20px;
            text-align: justify;
        }

        .equation {
            background: rgba(142, 202, 230, 0.1);
            padding: 20px;
            margin: 25px 0;
            border-radius: 10px;
            text-align: center;
            font-family: 'Courier New', monospace;
            color: #8ecae6;
            font-size: 1.1rem;
            overflow-x: auto;
        }

        .highlight-box {
            background: linear-gradient(135deg, rgba(233, 196, 106, 0.1), rgba(244, 162, 97, 0.1));
            border-left: 4px solid #e9c46a;
            padding: 20px;
            margin: 25px 0;
            border-radius: 0 10px 10px 0;
        }

        .highlight-box strong {
            color: #e9c46a;
        }

        .timeline {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            margin: 25px 0;
        }

        .timeline-item {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .timeline-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .timeline-year {
            font-weight: bold;
            color: #e9c46a;
            min-width: 50px;
        }

        .sources {
            background: rgba(0, 0, 0, 0.3);
            padding: 25px;
            border-radius: 10px;
            margin-top: 40px;
        }

        .sources h3 {
            color: #e9c46a;
            margin-bottom: 15px;
        }

        .sources ul {
            list-style: none;
        }

        .sources li {
            margin-bottom: 10px;
        }

        .sources a {
            color: #8ecae6;
            text-decoration: none;
        }

        .sources a:hover {
            text-decoration: underline;
        }

        @media (max-width: 700px) {
            .dual-view {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-link">← Back to Surprising Paradoxes</a>
            <h1>The Lamb Shift</h1>
            <p class="subtitle">The quantum vacuum's fingerprint on atomic spectra</p>
        </header>

        <div class="visualization-container">
            <div class="mode-buttons">
                <button class="mode-btn active" onclick="setMode('levels')">Energy Levels</button>
                <button class="mode-btn" onclick="setMode('vacuum')">Vacuum Fluctuations</button>
                <button class="mode-btn" onclick="setMode('mechanism')">QED Mechanism</button>
            </div>

            <div class="dual-view">
                <div class="view-panel">
                    <h3>Dirac Theory (1928)</h3>
                    <canvas id="diracCanvas" width="350" height="350"></canvas>
                </div>
                <div class="view-panel">
                    <h3>QED + Lamb Shift (1947)</h3>
                    <canvas id="qedCanvas" width="350" height="350"></canvas>
                </div>
            </div>

            <div class="info-panel">
                <div class="shift-value" id="shiftValue">1057 MHz</div>
                <div class="shift-label">2S₁/₂ - 2P₁/₂ energy difference (Lamb shift)</div>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label>Vacuum Fluctuation Intensity</label>
                    <input type="range" id="vacuumIntensity" min="0" max="100" value="50">
                    <div class="value"><span id="vacuumValue">50</span>%</div>
                </div>

                <div class="control-group">
                    <label>Animation Speed</label>
                    <input type="range" id="animSpeed" min="0.2" max="2" step="0.1" value="1">
                    <div class="value"><span id="speedValue">1.0</span>x</div>
                </div>

                <div class="control-group">
                    <label>Zoom (Energy Scale)</label>
                    <input type="range" id="zoomLevel" min="1" max="10" step="0.5" value="5">
                    <div class="value"><span id="zoomValue">5</span>x</div>
                </div>
            </div>
        </div>

        <article class="essay">
            <h2>A Tiny Shift That Changed Physics</h2>

            <p>
                In 1947, Willis Lamb and Robert Retherford made one of the most precise measurements
                in physics history. Using microwave spectroscopy, they measured a tiny difference
                between two energy levels in hydrogen that—according to Dirac's equation—should be
                <strong>exactly the same</strong>. The difference was about 1057 MHz, or roughly
                four parts per billion of the total energy.
            </p>

            <p>
                This minuscule discrepancy, now called the <strong>Lamb shift</strong>, was the first
                direct evidence that the quantum vacuum isn't empty. It contains a seething sea of
                virtual particles that, while invisible, leave measurable fingerprints on real atoms.
            </p>

            <div class="highlight-box">
                <strong>The Paradox:</strong> Dirac's equation—which correctly predicted antiparticles
                and electron spin—said the 2S₁/₂ and 2P₁/₂ states of hydrogen have identical energy.
                But they don't. The electron's dance with virtual photons and electron-positron pairs
                shifts the S-state up by about 4 microelectronvolts.
            </div>

            <h2>What Dirac Predicted</h2>

            <p>
                The Dirac equation (1928) was a triumph of theoretical physics. It naturally explained
                electron spin, predicted antimatter, and gave the correct fine structure of hydrogen.
                According to Dirac, energy levels depend on two quantum numbers: the principal quantum
                number n and the total angular momentum j.
            </p>

            <div class="equation">
                E<sub>n,j</sub> = mc² [ 1 - (Zα)²/(2n²) - (Zα)⁴/(2n³) × (1/(j+½) - 3/(4n)) + ... ]
            </div>

            <p>
                For hydrogen (Z=1, n=2), both the 2S₁/₂ state (ℓ=0, s=½, j=½) and the 2P₁/₂ state
                (ℓ=1, s=½, j=½) have the same j=½. Therefore, Dirac's formula predicts they should
                be <em>degenerate</em>—having exactly the same energy.
            </p>

            <h2>The Lamb-Retherford Experiment</h2>

            <p>
                Lamb and Retherford exploited a clever fact: the 2S₁/₂ state is metastable (long-lived)
                while 2P₁/₂ decays almost instantly. By preparing hydrogen atoms in the 2S state and
                applying microwave radiation, they could induce transitions to 2P only if the frequency
                matched the energy difference.
            </p>

            <p>
                Their measurement: <strong>1057.77 MHz</strong> (modern value: 1057.8449 MHz). This
                wasn't a small correction to Dirac—it was a fundamentally new effect that required
                a new theory to explain.
            </p>

            <h2>The Quantum Vacuum Explanation</h2>

            <p>
                Hans Bethe made the first theoretical calculation of the Lamb shift within days of
                the experimental announcement. The key insight: the electron doesn't just sit in
                its orbital—it constantly emits and reabsorbs <strong>virtual photons</strong>.
            </p>

            <h3>Virtual Particle Cloud</h3>

            <p>
                Heisenberg's uncertainty principle allows energy conservation to be "violated" for
                short times: ΔE × Δt ~ ℏ. This means electron-photon pairs, electron-positron pairs,
                and other virtual particles constantly pop in and out of existence around the electron.
            </p>

            <p>
                These fluctuations don't average to zero because the electron is bound in an atom.
                The nucleus creates an electric field that slightly biases the virtual particle soup.
                S-states (ℓ=0) have a higher probability of being <em>at</em> the nucleus than P-states,
                so they experience more of this vacuum perturbation.
            </p>

            <div class="equation">
                δE<sub>Lamb</sub> ≈ (α/π) × (4/3) × mc² × (Zα)⁴ × ln(1/(Zα)²) / n³<br><br>
                ≈ 4.372 μeV for 2S₁/₂ in hydrogen
            </div>

            <h2>Three QED Contributions</h2>

            <p>
                The complete Lamb shift comes from three quantum electrodynamic effects:
            </p>

            <p>
                <strong>1. Electron Self-Energy (~97%)</strong><br>
                The electron emits and reabsorbs virtual photons, creating a "cloud" that slightly
                modifies its interaction with the nuclear Coulomb potential. This is the dominant
                contribution.
            </p>

            <p>
                <strong>2. Vacuum Polarization (~-2%)</strong><br>
                Virtual electron-positron pairs screen the nuclear charge. This effect actually pushes
                in the opposite direction but is smaller.
            </p>

            <p>
                <strong>3. Anomalous Magnetic Moment (~3%)</strong><br>
                The electron's magnetic moment differs slightly from the Dirac prediction (g = 2).
                This affects spin-orbit coupling.
            </p>

            <h2>Historical Timeline</h2>

            <div class="timeline">
                <div class="timeline-item">
                    <span class="timeline-year">1928</span>
                    <span>Dirac publishes his relativistic equation for electrons. Predicts 2S₁/₂ and 2P₁/₂ are degenerate.</span>
                </div>
                <div class="timeline-item">
                    <span class="timeline-year">1947</span>
                    <span>Lamb and Retherford measure the shift experimentally: ~1000 MHz. Physics community is stunned.</span>
                </div>
                <div class="timeline-item">
                    <span class="timeline-year">1947</span>
                    <span>Hans Bethe calculates the shift theoretically using early QED. Gets within 4%.</span>
                </div>
                <div class="timeline-item">
                    <span class="timeline-year">1948</span>
                    <span>Schwinger, Feynman, and Tomonaga independently develop renormalization, making QED calculations rigorous.</span>
                </div>
                <div class="timeline-item">
                    <span class="timeline-year">1955</span>
                    <span>Willis Lamb receives Nobel Prize "for discoveries concerning the fine structure of hydrogen spectrum."</span>
                </div>
            </div>

            <h2>Why It Matters</h2>

            <p>
                The Lamb shift was the first precision test of quantum electrodynamics and showed that
                the vacuum has real, measurable properties. Today, QED calculations of the Lamb shift
                agree with experiment to better than 10 parts per billion—making it one of the most
                precisely tested predictions in all of science.
            </p>

            <p>
                But more fundamentally, the Lamb shift changed how we think about emptiness. The
                vacuum isn't nothing—it's a dynamic arena of quantum fluctuations. Virtual particles
                affect real atoms, shift real energy levels, and leave real, measurable signatures.
            </p>

            <div class="highlight-box">
                <strong>The Deep Insight:</strong> What we call "empty space" is actually filled
                with a quantum foam of virtual particles appearing and disappearing. The Lamb shift
                proves this isn't just mathematics—the vacuum's seething activity leaves physical
                fingerprints on atomic spectra, measurable to parts per billion.
            </div>

            <div class="sources">
                <h3>Sources & Further Reading</h3>
                <ul>
                    <li><a href="https://en.wikipedia.org/wiki/Lamb_shift">Lamb shift - Wikipedia</a></li>
                    <li><a href="https://www.nobelprize.org/prizes/physics/1955/lamb/lecture/">Willis Lamb - Nobel Lecture (1955)</a></li>
                    <li><a href="https://en.wikipedia.org/wiki/Quantum_electrodynamics">Quantum electrodynamics - Wikipedia</a></li>
                    <li><a href="https://en.wikipedia.org/wiki/Vacuum_polarization">Vacuum polarization - Wikipedia</a></li>
                    <li><a href="https://journals.aps.org/pr/abstract/10.1103/PhysRev.72.241">Fine Structure of the Hydrogen Atom (Lamb & Retherford 1947)</a></li>
                </ul>
            </div>
        </article>
    </div>

    <script>
        const diracCanvas = document.getElementById('diracCanvas');
        const qedCanvas = document.getElementById('qedCanvas');
        const diracCtx = diracCanvas.getContext('2d');
        const qedCtx = qedCanvas.getContext('2d');

        // High DPI
        function setupCanvas(canvas, ctx) {
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            canvas.style.width = rect.width + 'px';
            canvas.style.height = rect.height + 'px';
            return { width: rect.width, height: rect.height };
        }

        const diracSize = setupCanvas(diracCanvas, diracCtx);
        const qedSize = setupCanvas(qedCanvas, qedCtx);

        // Parameters
        let vacuumIntensity = 50;
        let animSpeed = 1;
        let zoomLevel = 5;
        let currentMode = 'levels';
        let time = 0;

        // Virtual particles
        let virtualParticles = [];

        // Controls
        document.getElementById('vacuumIntensity').addEventListener('input', (e) => {
            vacuumIntensity = parseInt(e.target.value);
            document.getElementById('vacuumValue').textContent = vacuumIntensity;
            updateShiftDisplay();
        });

        document.getElementById('animSpeed').addEventListener('input', (e) => {
            animSpeed = parseFloat(e.target.value);
            document.getElementById('speedValue').textContent = animSpeed.toFixed(1);
        });

        document.getElementById('zoomLevel').addEventListener('input', (e) => {
            zoomLevel = parseFloat(e.target.value);
            document.getElementById('zoomValue').textContent = zoomLevel;
        });

        function setMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            virtualParticles = [];
        }

        function updateShiftDisplay() {
            const baseShift = 1057;
            const adjustedShift = baseShift * (vacuumIntensity / 50);
            document.getElementById('shiftValue').textContent = Math.round(adjustedShift) + ' MHz';
        }

        function drawEnergyLevels(ctx, size, includeShift) {
            ctx.fillStyle = '#0a0a12';
            ctx.fillRect(0, 0, size.width, size.height);

            const centerX = size.width / 2;
            const margin = 40;

            // Energy scale
            const baseY = size.height * 0.3;
            const scale = 15 * zoomLevel;

            // Draw axis
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(margin, margin);
            ctx.lineTo(margin, size.height - margin);
            ctx.stroke();

            ctx.fillStyle = '#888';
            ctx.font = '11px Georgia';
            ctx.textAlign = 'center';
            ctx.save();
            ctx.translate(15, size.height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('Energy', 0, 0);
            ctx.restore();

            // n=2 levels
            const n2BaseY = baseY + 100;

            // 2P₃/₂ (highest)
            const p32Y = n2BaseY - scale * 2;
            ctx.strokeStyle = '#ff6b6b';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(margin + 20, p32Y);
            ctx.lineTo(size.width - margin, p32Y);
            ctx.stroke();

            ctx.fillStyle = '#ff6b6b';
            ctx.textAlign = 'right';
            ctx.fillText('2P₃/₂', size.width - margin - 5, p32Y - 5);

            // 2S₁/₂ and 2P₁/₂
            if (includeShift) {
                // With Lamb shift - 2S higher than 2P
                const lambShift = scale * 0.3 * (vacuumIntensity / 50);

                const s12Y = n2BaseY - lambShift;
                const p12Y = n2BaseY;

                // 2S₁/₂ (shifted up)
                ctx.strokeStyle = '#4CAF50';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(margin + 20, s12Y);
                ctx.lineTo(size.width - margin, s12Y);
                ctx.stroke();

                ctx.fillStyle = '#4CAF50';
                ctx.fillText('2S₁/₂', size.width - margin - 5, s12Y - 5);

                // 2P₁/₂
                ctx.strokeStyle = '#2196F3';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(margin + 20, p12Y);
                ctx.lineTo(size.width - margin, p12Y);
                ctx.stroke();

                ctx.fillStyle = '#2196F3';
                ctx.fillText('2P₁/₂', size.width - margin - 5, p12Y - 5);

                // Arrow showing Lamb shift
                if (lambShift > 3) {
                    ctx.strokeStyle = '#e9c46a';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(centerX, p12Y);
                    ctx.lineTo(centerX, s12Y);
                    ctx.stroke();

                    // Arrow head
                    ctx.beginPath();
                    ctx.moveTo(centerX - 5, s12Y + 8);
                    ctx.lineTo(centerX, s12Y);
                    ctx.lineTo(centerX + 5, s12Y + 8);
                    ctx.stroke();

                    ctx.fillStyle = '#e9c46a';
                    ctx.textAlign = 'center';
                    ctx.fillText('Lamb', centerX, (s12Y + p12Y) / 2 - 5);
                    ctx.fillText('shift', centerX, (s12Y + p12Y) / 2 + 10);
                }
            } else {
                // Dirac prediction - degenerate
                const degenerateY = n2BaseY;

                ctx.strokeStyle = '#9C27B0';
                ctx.lineWidth = 4;
                ctx.beginPath();
                ctx.moveTo(margin + 20, degenerateY);
                ctx.lineTo(size.width - margin, degenerateY);
                ctx.stroke();

                ctx.fillStyle = '#9C27B0';
                ctx.fillText('2S₁/₂ = 2P₁/₂', size.width - margin - 5, degenerateY - 8);
                ctx.fillText('(degenerate)', size.width - margin - 5, degenerateY + 15);
            }

            // n=1 level
            const n1Y = size.height - margin - 30;
            ctx.strokeStyle = '#888';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(margin + 20, n1Y);
            ctx.lineTo(size.width - margin, n1Y);
            ctx.stroke();

            ctx.fillStyle = '#888';
            ctx.fillText('1S₁/₂ (ground)', size.width - margin - 5, n1Y - 5);

            // Labels
            ctx.fillStyle = '#aaa';
            ctx.textAlign = 'left';
            ctx.fillText('n = 2', margin + 5, n2BaseY + 40);
            ctx.fillText('n = 1', margin + 5, n1Y + 15);
        }

        function drawVacuumFluctuations(ctx, size) {
            ctx.fillStyle = '#0a0a12';
            ctx.fillRect(0, 0, size.width, size.height);

            const centerX = size.width / 2;
            const centerY = size.height / 2;

            // Draw nucleus
            ctx.beginPath();
            ctx.arc(centerX, centerY, 8, 0, Math.PI * 2);
            ctx.fillStyle = '#ff6b6b';
            ctx.fill();

            // Draw electron orbit (probability cloud)
            const gradient = ctx.createRadialGradient(centerX, centerY, 20, centerX, centerY, 80);
            gradient.addColorStop(0, 'rgba(76, 175, 80, 0.3)');
            gradient.addColorStop(0.5, 'rgba(76, 175, 80, 0.15)');
            gradient.addColorStop(1, 'rgba(76, 175, 80, 0)');
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(centerX, centerY, 80, 0, Math.PI * 2);
            ctx.fill();

            // Electron
            const electronAngle = time * animSpeed;
            const electronR = 50 + Math.sin(time * 3) * 10;
            const electronX = centerX + Math.cos(electronAngle) * electronR;
            const electronY = centerY + Math.sin(electronAngle) * electronR;

            ctx.beginPath();
            ctx.arc(electronX, electronY, 6, 0, Math.PI * 2);
            ctx.fillStyle = '#4CAF50';
            ctx.fill();
            ctx.strokeStyle = '#81C784';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Generate virtual particles
            const particleRate = vacuumIntensity / 500;
            if (Math.random() < particleRate * animSpeed) {
                const angle = Math.random() * Math.PI * 2;
                const dist = 20 + Math.random() * 40;
                virtualParticles.push({
                    x: electronX + Math.cos(angle) * dist,
                    y: electronY + Math.sin(angle) * dist,
                    life: 1,
                    type: Math.random() > 0.5 ? 'photon' : 'pair',
                    angle: angle
                });
            }

            // Draw and update virtual particles
            virtualParticles.forEach(p => {
                p.life -= 0.02 * animSpeed;

                if (p.type === 'photon') {
                    // Virtual photon - wavy line
                    ctx.beginPath();
                    ctx.strokeStyle = `rgba(255, 255, 100, ${p.life * 0.7})`;
                    ctx.lineWidth = 2;
                    for (let i = 0; i < 15; i++) {
                        const px = electronX + (p.x - electronX) * (i / 15);
                        const py = electronY + (p.y - electronY) * (i / 15) + Math.sin(i + time * 10) * 3;
                        if (i === 0) ctx.moveTo(px, py);
                        else ctx.lineTo(px, py);
                    }
                    ctx.stroke();
                } else {
                    // Virtual electron-positron pair
                    const sep = 8 * p.life;
                    ctx.beginPath();
                    ctx.arc(p.x - sep, p.y, 3 * p.life, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(76, 175, 80, ${p.life * 0.8})`;
                    ctx.fill();

                    ctx.beginPath();
                    ctx.arc(p.x + sep, p.y, 3 * p.life, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(255, 107, 107, ${p.life * 0.8})`;
                    ctx.fill();
                }
            });

            virtualParticles = virtualParticles.filter(p => p.life > 0);

            // Labels
            ctx.font = '11px Georgia';
            ctx.textAlign = 'center';
            ctx.fillStyle = '#ff6b6b';
            ctx.fillText('p⁺', centerX, centerY + 25);
            ctx.fillStyle = '#4CAF50';
            ctx.fillText('e⁻', electronX, electronY - 12);

            ctx.fillStyle = '#aaa';
            ctx.fillText('Virtual photon cloud', centerX, size.height - 30);
            ctx.fillText('constantly surrounds electron', centerX, size.height - 15);
        }

        function drawQEDMechanism(ctx, size) {
            ctx.fillStyle = '#0a0a12';
            ctx.fillRect(0, 0, size.width, size.height);

            const centerX = size.width / 2;
            const centerY = size.height / 2;

            // Draw Feynman diagram style
            ctx.strokeStyle = '#4CAF50';
            ctx.lineWidth = 3;

            // Incoming electron
            ctx.beginPath();
            ctx.moveTo(50, centerY);
            ctx.lineTo(centerX - 40, centerY);
            ctx.stroke();

            // Virtual photon loop
            const loopPhase = time * 2 * animSpeed;
            ctx.strokeStyle = '#e9c46a';
            ctx.lineWidth = 2;
            ctx.setLineDash([4, 4]);

            ctx.beginPath();
            for (let i = 0; i <= 30; i++) {
                const t = i / 30;
                const x = centerX - 40 + t * 80;
                const y = centerY - Math.sin(t * Math.PI) * 40 + Math.sin(loopPhase + t * 10) * 3;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
            ctx.setLineDash([]);

            // Outgoing electron
            ctx.strokeStyle = '#4CAF50';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(centerX + 40, centerY);
            ctx.lineTo(size.width - 50, centerY);
            ctx.stroke();

            // Vertex points
            ctx.fillStyle = '#fff';
            ctx.beginPath();
            ctx.arc(centerX - 40, centerY, 5, 0, Math.PI * 2);
            ctx.arc(centerX + 40, centerY, 5, 0, Math.PI * 2);
            ctx.fill();

            // Labels
            ctx.font = '12px Georgia';
            ctx.fillStyle = '#4CAF50';
            ctx.textAlign = 'center';
            ctx.fillText('e⁻', 70, centerY - 10);
            ctx.fillText('e⁻', size.width - 70, centerY - 10);

            ctx.fillStyle = '#e9c46a';
            ctx.fillText('virtual γ', centerX, centerY - 55);

            ctx.fillStyle = '#aaa';
            ctx.fillText('Self-energy diagram', centerX, centerY + 80);
            ctx.fillText('(electron emits and reabsorbs photon)', centerX, centerY + 95);

            // Energy shift indication
            ctx.fillStyle = 'rgba(233, 196, 106, 0.2)';
            ctx.fillRect(size.width - 100, centerY - 20, 40, 40);
            ctx.fillStyle = '#e9c46a';
            ctx.font = '10px Georgia';
            ctx.fillText('ΔE ≈ 4 μeV', size.width - 80, centerY + 5);
        }

        function animate() {
            time += 0.016;

            if (currentMode === 'levels') {
                drawEnergyLevels(diracCtx, diracSize, false);
                drawEnergyLevels(qedCtx, qedSize, true);
            } else if (currentMode === 'vacuum') {
                drawEnergyLevels(diracCtx, diracSize, false);
                drawVacuumFluctuations(qedCtx, qedSize);
            } else if (currentMode === 'mechanism') {
                drawEnergyLevels(diracCtx, diracSize, false);
                drawQEDMechanism(qedCtx, qedSize);
            }

            requestAnimationFrame(animate);
        }

        // Initialize
        updateShiftDisplay();
        animate();
    </script>
</body>
</html>
