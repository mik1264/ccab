<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brownian Motion - Random Dance of Atoms</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a2a 50%, #0a1a1a 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        .back-link {
            display: inline-flex;
            align-items: center;
            color: #3b82f6;
            text-decoration: none;
            margin-bottom: 15px;
            font-size: 0.95em;
        }
        .back-link:hover {
            color: #60a5fa;
            text-decoration: underline;
        }
        h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
            color: #fff;
            text-shadow: 0 0 30px rgba(59, 130, 246, 0.5);
        }
        .subtitle {
            color: #60a5fa;
            margin-bottom: 20px;
            font-size: 1.05em;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .main-content {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 20px;
        }
        .canvas-container {
            background: rgba(0,0,0,0.4);
            border-radius: 12px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        canvas {
            border-radius: 8px;
            background: #020208;
        }
        .info-text {
            margin-top: 10px;
            font-size: 0.8em;
            color: #3b82f6;
        }
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .panel {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .panel h3 {
            font-size: 0.9em;
            color: #3b82f6;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .btn {
            padding: 8px 14px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 500;
            transition: all 0.2s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #e0e0e0;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .btn-secondary:hover {
            background: rgba(255,255,255,0.2);
        }
        .param-group {
            margin-bottom: 12px;
        }
        .param-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .param-name {
            color: #60a5fa;
            font-size: 0.85em;
        }
        .param-value {
            color: #93c5fd;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.9em;
        }
        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255,255,255,0.1);
            -webkit-appearance: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .stat-label {
            color: #60a5fa;
            font-size: 0.8em;
        }
        .stat-value {
            color: #93c5fd;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.8em;
        }
        .formula-box {
            background: rgba(0,0,0,0.3);
            padding: 12px;
            border-radius: 6px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.85em;
            line-height: 1.8;
            color: #93c5fd;
            text-align: center;
        }
        .einstein-box {
            background: linear-gradient(135deg, rgba(59,130,246,0.2), rgba(37,99,235,0.1));
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            text-align: center;
        }
        .einstein-title {
            font-size: 0.75em;
            color: #3b82f6;
            margin-bottom: 5px;
        }
        .einstein-eq {
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 1em;
            color: #93c5fd;
        }
        .exp-section {
            margin-top: 20px;
        }
        .exp-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }
        .exp-card {
            background: linear-gradient(135deg, rgba(59,130,246,0.1), rgba(37,99,235,0.05));
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(59,130,246,0.2);
        }
        .exp-card h4 {
            color: #3b82f6;
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        .exp-card p {
            font-size: 0.85em;
            line-height: 1.6;
            color: #60a5fa;
        }
        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">← Back to Paradoxes</a>
        <h1>Brownian Motion</h1>
        <p class="subtitle">The Random Dance That Proved Atoms Exist</p>

        <div class="main-content">
            <div class="canvas-container">
                <canvas id="mainCanvas" width="650" height="600"></canvas>
                <p class="info-text">Particles jitter randomly as invisible molecules bombard them from all sides</p>
            </div>

            <div class="sidebar">
                <div class="panel">
                    <h3>Controls</h3>
                    <div class="controls">
                        <button class="btn btn-primary" id="pauseBtn">Pause</button>
                        <button class="btn btn-secondary" id="resetBtn">Reset</button>
                        <button class="btn btn-secondary" id="trailsBtn">Clear Trails</button>
                    </div>
                </div>

                <div class="panel">
                    <h3>Parameters</h3>
                    <div class="param-group">
                        <div class="param-label">
                            <span class="param-name">Temperature (K)</span>
                            <span class="param-value" id="tempValue">300</span>
                        </div>
                        <input type="range" id="tempSlider" min="100" max="600" value="300">
                    </div>
                    <div class="param-group">
                        <div class="param-label">
                            <span class="param-name">Particle size</span>
                            <span class="param-value" id="sizeValue">8</span>
                        </div>
                        <input type="range" id="sizeSlider" min="4" max="16" value="8">
                    </div>
                    <div class="param-group">
                        <div class="param-label">
                            <span class="param-name">Number of particles</span>
                            <span class="param-value" id="countValue">5</span>
                        </div>
                        <input type="range" id="countSlider" min="1" max="20" value="5">
                    </div>
                    <div class="param-group">
                        <div class="param-label">
                            <span class="param-name">Trail length</span>
                            <span class="param-value" id="trailValue">200</span>
                        </div>
                        <input type="range" id="trailSlider" min="50" max="500" value="200">
                    </div>
                </div>

                <div class="panel">
                    <h3>Statistics</h3>
                    <div class="stat-row">
                        <span class="stat-label">Steps</span>
                        <span id="steps" class="stat-value">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Mean displacement</span>
                        <span id="meanDisp" class="stat-value">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">√(Mean sq. disp.)</span>
                        <span id="rmsDisp" class="stat-value">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Diffusion coeff.</span>
                        <span id="diffCoeff" class="stat-value">-</span>
                    </div>
                </div>

                <div class="panel">
                    <h3>Einstein's Relation</h3>
                    <div class="formula-box">
                        ⟨x²⟩ = 2Dt<br>
                        <span style="font-size: 0.8em;">Mean square displacement ∝ time</span>
                    </div>
                    <div class="einstein-box">
                        <div class="einstein-title">DIFFUSION COEFFICIENT</div>
                        <div class="einstein-eq">D = k<sub>B</sub>T / 6πηr</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="exp-section">
            <div class="exp-cards">
                <div class="exp-card">
                    <h4>Robert Brown (1827)</h4>
                    <p>Scottish botanist Robert Brown observed pollen grains of Clarkia pulchella jittering in water. He ruled out life by showing inorganic dust did the same! For 80 years, no one could explain why. The motion was random, continuous, and affected by particle size.</p>
                </div>
                <div class="exp-card">
                    <h4>Einstein's 1905 Miracle</h4>
                    <p>In his "annus mirabilis," Einstein explained Brownian motion as bombardment by invisible water molecules. His equation let Jean Perrin (Nobel 1926) calculate Avogadro's number from observations—finally PROVING atoms exist! Skeptics like Mach were silenced.</p>
                </div>
                <div class="exp-card">
                    <h4>The Key Insight</h4>
                    <p>Mean SQUARED displacement grows linearly with time: ⟨x²⟩ = 2Dt. Not mean displacement (which is zero—motion is random in all directions). This seemingly technical detail let experimenters measure molecular reality from macroscopic observations!</p>
                </div>
                <div class="exp-card">
                    <h4>Everywhere in Nature</h4>
                    <p>Brownian motion governs diffusion in biology, stock price fluctuations (Black-Scholes model), polymer chain conformations, heat conduction, and quantum mechanics. The Wiener process (mathematical Brownian motion) is foundational to stochastic calculus!</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');

        // Parameters
        let temperature = 300;  // Kelvin
        let particleSize = 8;
        let particleCount = 5;
        let trailLength = 200;
        let paused = false;
        let steps = 0;

        // Particles
        let particles = [];

        class Particle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.startX = x;
                this.startY = y;
                this.trail = [];
                this.color = `hsl(${200 + Math.random() * 60}, 70%, 60%)`;
            }

            update() {
                // Brownian step: Gaussian random displacement
                // Step size scales with sqrt(temperature)
                const sigma = Math.sqrt(temperature / 300) * 3;

                // Box-Muller transform for Gaussian random numbers
                const u1 = Math.random();
                const u2 = Math.random();
                const z0 = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
                const z1 = Math.sqrt(-2 * Math.log(u1)) * Math.sin(2 * Math.PI * u2);

                this.x += z0 * sigma;
                this.y += z1 * sigma;

                // Record trail
                this.trail.push({ x: this.x, y: this.y });
                if (this.trail.length > trailLength) {
                    this.trail.shift();
                }

                // Bounce off walls
                if (this.x < particleSize) {
                    this.x = particleSize;
                }
                if (this.x > canvas.width - particleSize) {
                    this.x = canvas.width - particleSize;
                }
                if (this.y < particleSize) {
                    this.y = particleSize;
                }
                if (this.y > canvas.height - particleSize) {
                    this.y = canvas.height - particleSize;
                }
            }

            getDisplacement() {
                const dx = this.x - this.startX;
                const dy = this.y - this.startY;
                return Math.sqrt(dx * dx + dy * dy);
            }

            getSquaredDisplacement() {
                const dx = this.x - this.startX;
                const dy = this.y - this.startY;
                return dx * dx + dy * dy;
            }

            draw() {
                // Draw trail
                if (this.trail.length > 1) {
                    ctx.beginPath();
                    ctx.moveTo(this.trail[0].x, this.trail[0].y);

                    for (let i = 1; i < this.trail.length; i++) {
                        const alpha = i / this.trail.length;
                        ctx.strokeStyle = this.color.replace('60%)', `${60 * alpha}%)`);
                        ctx.lineWidth = 1;
                        ctx.lineTo(this.trail[i].x, this.trail[i].y);
                    }
                    ctx.stroke();
                }

                // Draw particle
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, particleSize, 0, Math.PI * 2);
                ctx.fill();

                // Highlight ring
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
                ctx.lineWidth = 1.5;
                ctx.stroke();
            }
        }

        function initParticles() {
            particles = [];
            for (let i = 0; i < particleCount; i++) {
                particles.push(new Particle(
                    canvas.width / 2 + (Math.random() - 0.5) * 100,
                    canvas.height / 2 + (Math.random() - 0.5) * 100
                ));
            }
            steps = 0;
        }

        function draw() {
            // Dark background
            ctx.fillStyle = '#020208';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw faint grid (representing medium)
            ctx.strokeStyle = 'rgba(59, 130, 246, 0.1)';
            ctx.lineWidth = 1;
            const gridSize = 50;
            for (let x = 0; x <= canvas.width; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            for (let y = 0; y <= canvas.height; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }

            // Draw particles
            for (let p of particles) {
                p.draw();
            }

            // Draw start positions
            ctx.strokeStyle = 'rgba(59, 130, 246, 0.3)';
            ctx.lineWidth = 1;
            for (let p of particles) {
                ctx.beginPath();
                ctx.arc(p.startX, p.startY, particleSize + 3, 0, Math.PI * 2);
                ctx.setLineDash([3, 3]);
                ctx.stroke();
                ctx.setLineDash([]);
            }
        }

        function updateStats() {
            document.getElementById('steps').textContent = steps.toLocaleString();

            if (particles.length > 0) {
                // Mean displacement
                let totalDisp = 0;
                let totalSqDisp = 0;

                for (let p of particles) {
                    totalDisp += p.getDisplacement();
                    totalSqDisp += p.getSquaredDisplacement();
                }

                const meanDisp = totalDisp / particles.length;
                const meanSqDisp = totalSqDisp / particles.length;
                const rmsDisp = Math.sqrt(meanSqDisp);

                document.getElementById('meanDisp').textContent = meanDisp.toFixed(1) + ' px';
                document.getElementById('rmsDisp').textContent = rmsDisp.toFixed(1) + ' px';

                // Estimate diffusion coefficient (D = <x²>/(2t))
                if (steps > 10) {
                    const D = meanSqDisp / (2 * steps);
                    document.getElementById('diffCoeff').textContent = D.toFixed(2) + ' px²/step';
                }
            }
        }

        function animate() {
            if (!paused) {
                for (let p of particles) {
                    p.update();
                }
                steps++;
            }

            draw();
            updateStats();
            requestAnimationFrame(animate);
        }

        function reset() {
            initParticles();
        }

        function clearTrails() {
            for (let p of particles) {
                p.trail = [];
            }
        }

        // Event handlers
        document.getElementById('tempSlider').addEventListener('input', (e) => {
            temperature = parseInt(e.target.value);
            document.getElementById('tempValue').textContent = temperature;
        });

        document.getElementById('sizeSlider').addEventListener('input', (e) => {
            particleSize = parseInt(e.target.value);
            document.getElementById('sizeValue').textContent = particleSize;
        });

        document.getElementById('countSlider').addEventListener('input', (e) => {
            particleCount = parseInt(e.target.value);
            document.getElementById('countValue').textContent = particleCount;
            initParticles();
        });

        document.getElementById('trailSlider').addEventListener('input', (e) => {
            trailLength = parseInt(e.target.value);
            document.getElementById('trailValue').textContent = trailLength;
        });

        document.getElementById('pauseBtn').addEventListener('click', () => {
            paused = !paused;
            document.getElementById('pauseBtn').textContent = paused ? 'Resume' : 'Pause';
        });

        document.getElementById('resetBtn').addEventListener('click', reset);
        document.getElementById('trailsBtn').addEventListener('click', clearTrails);

        // Initialize
        initParticles();
        animate();
    </script>
</body>
</html>
