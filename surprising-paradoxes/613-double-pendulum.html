<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Double Pendulum - Surprising Paradoxes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0a0a12 0%, #12121f 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5em;
            background: linear-gradient(135deg, #e74c3c 0%, #9b59b6 50%, #3498db 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2em;
            color: #888;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 20px;
        }

        @media (max-width: 1000px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .canvas-container {
            background: #000;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        #pendulumCanvas {
            display: block;
            width: 100%;
        }

        .info-overlay {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.85em;
            font-family: monospace;
        }

        .info-overlay span {
            color: #9b59b6;
        }

        .divergence-display {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.85em;
            display: none;
        }

        .divergence-display.visible {
            display: block;
        }

        .controls {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
        }

        .control-section {
            margin-bottom: 25px;
        }

        .control-section h3 {
            color: #9b59b6;
            margin-bottom: 15px;
            font-size: 1.1em;
            border-bottom: 1px solid rgba(155,89,182,0.3);
            padding-bottom: 8px;
        }

        .control-row {
            margin-bottom: 15px;
        }

        .control-row label {
            display: block;
            margin-bottom: 5px;
            color: #aaa;
            font-size: 0.9em;
        }

        .control-row input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }

        .control-row .value {
            text-align: right;
            font-family: monospace;
            color: #9b59b6;
            font-size: 0.9em;
        }

        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        button {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #9b59b6, #3498db);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(155,89,182,0.4);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #e0e0e0;
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.2);
        }

        .chaos-demo {
            background: rgba(231,76,60,0.1);
            border: 1px solid rgba(231,76,60,0.3);
            border-radius: 8px;
            padding: 12px;
            margin-top: 15px;
        }

        .chaos-title {
            color: #e74c3c;
            font-size: 0.9em;
            margin-bottom: 8px;
        }

        .chaos-status {
            font-size: 0.85em;
            color: #aaa;
        }

        .divergence-bar {
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            margin-top: 8px;
            overflow: hidden;
        }

        .divergence-fill {
            height: 100%;
            background: linear-gradient(90deg, #2ecc71, #f39c12, #e74c3c);
            border-radius: 4px;
            transition: width 0.1s;
        }

        .preset-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .preset-btn {
            padding: 8px;
            font-size: 0.8em;
        }

        .explanation {
            margin-top: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .exp-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #9b59b6;
        }

        .exp-card h3 {
            color: #9b59b6;
            margin-bottom: 10px;
        }

        .exp-card p {
            color: #bbb;
            line-height: 1.6;
        }

        .formula {
            background: rgba(0,0,0,0.3);
            padding: 12px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.9em;
            text-align: center;
            margin: 10px 0;
            color: #3498db;
        }

        .back-link {
            display: inline-block;
            color: #9b59b6;
            text-decoration: none;
            margin-bottom: 20px;
            transition: transform 0.2s;
        }

        .back-link:hover {
            transform: translateX(-5px);
        }

        .color-legend {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            font-size: 0.8em;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">← Back to Paradoxes</a>

        <header>
            <h1>The Double Pendulum</h1>
            <p class="subtitle">Chaos from Newtonian mechanics</p>
        </header>

        <div class="main-content">
            <div class="canvas-container">
                <canvas id="pendulumCanvas" width="900" height="700"></canvas>
                <div class="info-overlay">
                    <div>Time: <span id="timeDisplay">0.00</span>s</div>
                    <div>Energy: <span id="energyDisplay">—</span></div>
                </div>
                <div class="divergence-display" id="divergenceDisplay">
                    <div style="color: #e74c3c;">Divergence: <span id="divergenceValue">0</span></div>
                </div>
            </div>

            <div class="controls">
                <div class="control-section">
                    <h3>Animation</h3>
                    <div class="btn-group">
                        <button class="btn-primary" id="playBtn">▶ Play</button>
                        <button class="btn-secondary" id="resetBtn">Reset</button>
                    </div>
                </div>

                <div class="control-section">
                    <h3>Initial Angles</h3>
                    <div class="control-row">
                        <label>θ₁ (Upper pendulum)</label>
                        <input type="range" id="theta1Slider" min="-180" max="180" value="120">
                        <div class="value"><span id="theta1Value">120</span>°</div>
                    </div>
                    <div class="control-row">
                        <label>θ₂ (Lower pendulum)</label>
                        <input type="range" id="theta2Slider" min="-180" max="180" value="120">
                        <div class="value"><span id="theta2Value">120</span>°</div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>Presets</h3>
                    <div class="preset-grid">
                        <button class="btn-secondary preset-btn" data-t1="120" data-t2="120">Symmetric</button>
                        <button class="btn-secondary preset-btn" data-t1="90" data-t2="90">90° Start</button>
                        <button class="btn-secondary preset-btn" data-t1="170" data-t2="170">High Energy</button>
                        <button class="btn-secondary preset-btn" data-t1="30" data-t2="30">Low Energy</button>
                    </div>
                </div>

                <div class="control-section">
                    <h3>Chaos Demonstration</h3>
                    <div class="btn-group">
                        <button class="btn-secondary" id="chaosBtn">Compare Two Pendulums</button>
                    </div>
                    <div class="chaos-demo" id="chaosDemo" style="display:none;">
                        <div class="chaos-title">Initial difference: 0.001°</div>
                        <div class="chaos-status" id="chaosStatus">Tracking divergence...</div>
                        <div class="divergence-bar">
                            <div class="divergence-fill" id="divergenceFill" style="width: 0%"></div>
                        </div>
                        <div class="color-legend">
                            <div class="legend-item">
                                <div class="legend-dot" style="background: #e74c3c;"></div>
                                <span>Pendulum 1</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-dot" style="background: #3498db;"></div>
                                <span>Pendulum 2</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>Trail</h3>
                    <div class="btn-group">
                        <button class="btn-secondary" id="trailBtn">Toggle Trail</button>
                        <button class="btn-secondary" id="clearTrailBtn">Clear Trail</button>
                    </div>
                </div>

                <div class="control-section">
                    <h3>Physics</h3>
                    <div class="control-row">
                        <label>Gravity (g)</label>
                        <input type="range" id="gravitySlider" min="1" max="20" step="0.5" value="9.81">
                        <div class="value"><span id="gravityValue">9.81</span> m/s²</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="explanation">
            <div class="exp-card">
                <h3>Deterministic Chaos</h3>
                <p>The double pendulum follows Newton's laws exactly—no randomness involved. Yet two pendulums with imperceptibly different starting positions (differing by 0.001°) will soon move in completely different ways. The physics is deterministic, but the outcome is effectively unpredictable.</p>
            </div>

            <div class="exp-card">
                <h3>Lyapunov Exponent</h3>
                <div class="formula">|Δx(t)| ≈ |Δx₀| × e^(λt)</div>
                <p>The Lyapunov exponent λ measures how fast nearby trajectories diverge. For the double pendulum, λ ≈ 7-8 s⁻¹. This means initial differences are amplified by a factor of e ≈ 2.7 every ~0.13 seconds. After just a few seconds, tiny errors become enormous.</p>
            </div>

            <div class="exp-card">
                <h3>The Paradox</h3>
                <p>This is one of the simplest mechanical systems imaginable—just two rigid rods and gravity. Yet it exhibits the same "butterfly effect" as weather! No matter how precisely we measure the initial state, our predictions become worthless after a short time. Simplicity breeds complexity.</p>
            </div>

            <div class="exp-card">
                <h3>Order Within Chaos</h3>
                <p>Despite the chaos, the pendulum's motion is bounded—it stays on a "strange attractor" in phase space. Total energy is conserved (in the ideal case). The chaos lies not in unbounded growth, but in the exponential sensitivity to initial conditions within these bounds.</p>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('pendulumCanvas');
        const ctx = canvas.getContext('2d');

        // Physics constants
        const L1 = 150, L2 = 150; // Lengths
        const M1 = 10, M2 = 10;   // Masses
        let g = 9.81;

        // State variables
        let theta1, omega1, theta2, omega2;
        let theta1_2, omega1_2, theta2_2, omega2_2; // Second pendulum for chaos demo

        let time = 0;
        let isPlaying = false;
        let showTrail = true;
        let showChaos = false;
        let animationFrame = null;

        // Trails
        let trail1 = [];
        let trail2 = [];
        const maxTrailLength = 500;

        // Initial values
        let initTheta1 = 120 * Math.PI / 180;
        let initTheta2 = 120 * Math.PI / 180;

        function init() {
            theta1 = initTheta1;
            omega1 = 0;
            theta2 = initTheta2;
            omega2 = 0;

            // Second pendulum with tiny difference
            theta1_2 = initTheta1 + 0.001 * Math.PI / 180;
            omega1_2 = 0;
            theta2_2 = initTheta2;
            omega2_2 = 0;

            time = 0;
            trail1 = [];
            trail2 = [];
        }

        // Equations of motion using Lagrangian mechanics
        function derivatives(t1, w1, t2, w2) {
            const delta = t1 - t2;
            const den1 = (M1 + M2) * L1 - M2 * L1 * Math.cos(delta) * Math.cos(delta);
            const den2 = (L2 / L1) * den1;

            const dw1 = (M2 * L1 * w1 * w1 * Math.sin(delta) * Math.cos(delta)
                       + M2 * g * Math.sin(t2) * Math.cos(delta)
                       + M2 * L2 * w2 * w2 * Math.sin(delta)
                       - (M1 + M2) * g * Math.sin(t1)) / den1;

            const dw2 = (-M2 * L2 * w2 * w2 * Math.sin(delta) * Math.cos(delta)
                       + (M1 + M2) * g * Math.sin(t1) * Math.cos(delta)
                       - (M1 + M2) * L1 * w1 * w1 * Math.sin(delta)
                       - (M1 + M2) * g * Math.sin(t2)) / den2;

            return { dw1, dw2 };
        }

        // RK4 integration
        function rk4Step(t1, w1, t2, w2, dt) {
            const k1 = derivatives(t1, w1, t2, w2);
            const k2 = derivatives(t1 + w1*dt/2, w1 + k1.dw1*dt/2, t2 + w2*dt/2, w2 + k1.dw2*dt/2);
            const k3 = derivatives(t1 + w1*dt/2, w1 + k2.dw1*dt/2, t2 + w2*dt/2, w2 + k2.dw2*dt/2);
            const k4 = derivatives(t1 + w1*dt, w1 + k3.dw1*dt, t2 + w2*dt, w2 + k3.dw2*dt);

            const new_w1 = w1 + (k1.dw1 + 2*k2.dw1 + 2*k3.dw1 + k4.dw1) * dt / 6;
            const new_w2 = w2 + (k1.dw2 + 2*k2.dw2 + 2*k3.dw2 + k4.dw2) * dt / 6;
            const new_t1 = t1 + (w1 + new_w1) * dt / 2;
            const new_t2 = t2 + (w2 + new_w2) * dt / 2;

            return { t1: new_t1, w1: new_w1, t2: new_t2, w2: new_w2 };
        }

        function getPositions(t1, t2) {
            const cx = canvas.width / 2;
            const cy = canvas.height / 2 - 50;

            const x1 = cx + L1 * Math.sin(t1);
            const y1 = cy + L1 * Math.cos(t1);
            const x2 = x1 + L2 * Math.sin(t2);
            const y2 = y1 + L2 * Math.cos(t2);

            return { x1, y1, x2, y2, cx, cy };
        }

        function calculateEnergy(t1, w1, t2, w2) {
            const y1 = -L1 * Math.cos(t1);
            const y2 = y1 - L2 * Math.cos(t2);

            const v1sq = (L1 * w1) ** 2;
            const v2sq = (L1 * w1) ** 2 + (L2 * w2) ** 2 + 2 * L1 * L2 * w1 * w2 * Math.cos(t1 - t2);

            const KE = 0.5 * M1 * v1sq + 0.5 * M2 * v2sq;
            const PE = M1 * g * y1 + M2 * g * y2;

            return (KE + PE) / 1000; // Scale for display
        }

        function draw() {
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const pos1 = getPositions(theta1, theta2);

            // Draw trails
            if (showTrail && trail1.length > 1) {
                ctx.beginPath();
                ctx.moveTo(trail1[0].x, trail1[0].y);
                for (let i = 1; i < trail1.length; i++) {
                    const alpha = i / trail1.length;
                    ctx.strokeStyle = `rgba(231, 76, 60, ${alpha * 0.8})`;
                    ctx.lineWidth = 1 + alpha;
                    ctx.lineTo(trail1[i].x, trail1[i].y);
                }
                ctx.stroke();
            }

            if (showChaos && showTrail && trail2.length > 1) {
                ctx.beginPath();
                ctx.moveTo(trail2[0].x, trail2[0].y);
                for (let i = 1; i < trail2.length; i++) {
                    const alpha = i / trail2.length;
                    ctx.strokeStyle = `rgba(52, 152, 219, ${alpha * 0.8})`;
                    ctx.lineWidth = 1 + alpha;
                    ctx.lineTo(trail2[i].x, trail2[i].y);
                }
                ctx.stroke();
            }

            // Draw pendulum 1
            drawPendulum(pos1, '#e74c3c', '#c0392b');

            // Draw pendulum 2 if chaos mode
            if (showChaos) {
                const pos2 = getPositions(theta1_2, theta2_2);
                drawPendulum(pos2, '#3498db', '#2980b9');
            }

            // Update displays
            document.getElementById('timeDisplay').textContent = time.toFixed(2);
            document.getElementById('energyDisplay').textContent = calculateEnergy(theta1, omega1, theta2, omega2).toFixed(2);

            if (showChaos) {
                updateChaosStatus();
            }
        }

        function drawPendulum(pos, color1, color2) {
            // Rods
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(pos.cx, pos.cy);
            ctx.lineTo(pos.x1, pos.y1);
            ctx.lineTo(pos.x2, pos.y2);
            ctx.stroke();

            // Pivot
            ctx.fillStyle = '#888';
            ctx.beginPath();
            ctx.arc(pos.cx, pos.cy, 6, 0, Math.PI * 2);
            ctx.fill();

            // Mass 1
            ctx.fillStyle = color2;
            ctx.beginPath();
            ctx.arc(pos.x1, pos.y1, 15, 0, Math.PI * 2);
            ctx.fill();

            // Mass 2
            ctx.fillStyle = color1;
            ctx.beginPath();
            ctx.arc(pos.x2, pos.y2, 12, 0, Math.PI * 2);
            ctx.fill();
        }

        function updateChaosStatus() {
            const pos1 = getPositions(theta1, theta2);
            const pos2 = getPositions(theta1_2, theta2_2);

            const dx = pos1.x2 - pos2.x2;
            const dy = pos1.y2 - pos2.y2;
            const distance = Math.sqrt(dx*dx + dy*dy);

            document.getElementById('chaosStatus').textContent =
                `Separation: ${distance.toFixed(1)} pixels`;

            const maxDist = 400;
            const percent = Math.min(100, (distance / maxDist) * 100);
            document.getElementById('divergenceFill').style.width = percent + '%';

            document.getElementById('divergenceDisplay').classList.add('visible');
            document.getElementById('divergenceValue').textContent = distance.toFixed(1) + ' px';
        }

        function update() {
            if (!isPlaying) return;

            const dt = 0.01;
            const stepsPerFrame = 3;

            for (let i = 0; i < stepsPerFrame; i++) {
                const new1 = rk4Step(theta1, omega1, theta2, omega2, dt);
                theta1 = new1.t1;
                omega1 = new1.w1;
                theta2 = new1.t2;
                omega2 = new1.w2;

                if (showChaos) {
                    const new2 = rk4Step(theta1_2, omega1_2, theta2_2, omega2_2, dt);
                    theta1_2 = new2.t1;
                    omega1_2 = new2.w1;
                    theta2_2 = new2.t2;
                    omega2_2 = new2.w2;
                }

                time += dt;
            }

            // Update trails
            const pos1 = getPositions(theta1, theta2);
            trail1.push({ x: pos1.x2, y: pos1.y2 });
            if (trail1.length > maxTrailLength) trail1.shift();

            if (showChaos) {
                const pos2 = getPositions(theta1_2, theta2_2);
                trail2.push({ x: pos2.x2, y: pos2.y2 });
                if (trail2.length > maxTrailLength) trail2.shift();
            }

            draw();
            animationFrame = requestAnimationFrame(update);
        }

        function play() {
            isPlaying = true;
            document.getElementById('playBtn').textContent = '⏸ Pause';
            update();
        }

        function pause() {
            isPlaying = false;
            document.getElementById('playBtn').textContent = '▶ Play';
            if (animationFrame) cancelAnimationFrame(animationFrame);
        }

        // Event listeners
        document.getElementById('playBtn').addEventListener('click', () => {
            if (isPlaying) pause();
            else play();
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            pause();
            init();
            document.getElementById('divergenceDisplay').classList.remove('visible');
            draw();
        });

        document.getElementById('theta1Slider').addEventListener('input', (e) => {
            initTheta1 = parseFloat(e.target.value) * Math.PI / 180;
            document.getElementById('theta1Value').textContent = e.target.value;
            if (!isPlaying) {
                init();
                draw();
            }
        });

        document.getElementById('theta2Slider').addEventListener('input', (e) => {
            initTheta2 = parseFloat(e.target.value) * Math.PI / 180;
            document.getElementById('theta2Value').textContent = e.target.value;
            if (!isPlaying) {
                init();
                draw();
            }
        });

        document.getElementById('gravitySlider').addEventListener('input', (e) => {
            g = parseFloat(e.target.value);
            document.getElementById('gravityValue').textContent = g.toFixed(2);
        });

        document.getElementById('chaosBtn').addEventListener('click', () => {
            showChaos = !showChaos;
            document.getElementById('chaosDemo').style.display = showChaos ? 'block' : 'none';
            document.getElementById('chaosBtn').textContent = showChaos ? 'Single Pendulum' : 'Compare Two Pendulums';
            if (!showChaos) {
                document.getElementById('divergenceDisplay').classList.remove('visible');
            }
            init();
            draw();
        });

        document.getElementById('trailBtn').addEventListener('click', () => {
            showTrail = !showTrail;
            draw();
        });

        document.getElementById('clearTrailBtn').addEventListener('click', () => {
            trail1 = [];
            trail2 = [];
            draw();
        });

        document.querySelectorAll('.preset-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const t1 = parseFloat(btn.dataset.t1);
                const t2 = parseFloat(btn.dataset.t2);
                document.getElementById('theta1Slider').value = t1;
                document.getElementById('theta2Slider').value = t2;
                document.getElementById('theta1Value').textContent = t1;
                document.getElementById('theta2Value').textContent = t2;
                initTheta1 = t1 * Math.PI / 180;
                initTheta2 = t2 * Math.PI / 180;
                pause();
                init();
                draw();
            });
        });

        // Initialize
        init();
        draw();
    </script>
</body>
</html>
