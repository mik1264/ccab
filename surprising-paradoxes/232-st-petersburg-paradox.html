<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The St. Petersburg Paradox - Infinite Expected Value</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #1a1a1a 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.4em;
            background: linear-gradient(135deg, #ffd700, #ffaa00, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2em;
            color: #aaa;
            font-style: italic;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #ffd700;
            text-decoration: none;
            font-size: 1.1em;
            opacity: 0.8;
            transition: opacity 0.3s;
            z-index: 1000;
        }

        .back-link:hover {
            opacity: 1;
        }

        .game-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }

        @media (max-width: 900px) {
            .game-area {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .panel h2 {
            color: #ffd700;
            margin-bottom: 20px;
            font-size: 1.4em;
        }

        .coin-display {
            text-align: center;
            padding: 30px;
        }

        .coin {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 20px;
            font-size: 3em;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.1s;
            border: 5px solid #ffd700;
        }

        .coin.heads {
            background: linear-gradient(135deg, #ffd700, #daa520);
            color: #1a1a2e;
        }

        .coin.tails {
            background: linear-gradient(135deg, #c0c0c0, #808080);
            color: #1a1a2e;
        }

        .coin.flipping {
            animation: flip 0.3s ease-in-out;
        }

        @keyframes flip {
            0%, 100% { transform: rotateY(0deg); }
            50% { transform: rotateY(180deg); }
        }

        .flip-history {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 15px 0;
            min-height: 40px;
            justify-content: center;
        }

        .flip-result {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            font-weight: bold;
        }

        .flip-result.heads {
            background: #ffd700;
            color: #1a1a2e;
        }

        .flip-result.tails {
            background: #808080;
            color: white;
        }

        .current-prize {
            font-size: 2.5em;
            color: #ffd700;
            font-weight: bold;
            margin: 20px 0;
        }

        .flip-count {
            color: #aaa;
            font-size: 1.1em;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-gold {
            background: linear-gradient(135deg, #ffd700, #daa520);
            color: #1a1a2e;
            font-weight: bold;
        }

        .btn-gold:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4);
        }

        .btn-gold:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #ccc;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .stat-label {
            color: #888;
            font-size: 0.85em;
            margin-bottom: 5px;
        }

        .stat-value {
            color: #ffd700;
            font-size: 1.4em;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        .stat-value.infinite {
            background: linear-gradient(135deg, #ff6b6b, #ffd700, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3); }
        }

        canvas {
            width: 100%;
            height: 200px;
            background: #0a0a15;
            border-radius: 10px;
            margin-top: 15px;
        }

        .explanation {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .explanation h2 {
            color: #ffd700;
            margin-bottom: 15px;
        }

        .explanation p {
            line-height: 1.8;
            margin-bottom: 15px;
            color: #ccc;
        }

        .math-box {
            background: rgba(255, 215, 0, 0.1);
            border-left: 4px solid #ffd700;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 10px 10px 0;
        }

        .math-box h3 {
            color: #ffd700;
            margin-bottom: 10px;
        }

        .formula {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            color: #ffd700;
            text-align: center;
            margin: 10px 0;
            font-size: 1.1em;
            overflow-x: auto;
        }

        .series-display {
            font-size: 1.2em;
            text-align: center;
            padding: 15px;
            color: #ccc;
        }

        .term {
            display: inline-block;
            margin: 5px 10px;
            padding: 5px 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
        }

        .term-prob { color: #88ccff; }
        .term-prize { color: #ffd700; }
        .term-result { color: #90ee90; }

        .highlight { color: #ffd700; font-weight: bold; }
        .infinite { color: #ff6b6b; font-weight: bold; }

        .simulation-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .simulation-controls label {
            color: #aaa;
        }

        .simulation-controls input {
            width: 100px;
            padding: 8px;
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 5px;
            background: rgba(0, 0, 0, 0.5);
            color: #ffd700;
            font-family: 'Courier New', monospace;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.9em;
        }

        .history-table th {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
            padding: 10px;
            text-align: left;
        }

        .history-table td {
            padding: 8px 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .history-table tr:nth-child(even) {
            background: rgba(0, 0, 0, 0.2);
        }

        .jackpot {
            color: #ff6b6b;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Paradoxes</a>

    <div class="container">
        <header>
            <h1>The St. Petersburg Paradox</h1>
            <p class="subtitle">A game with <span class="infinite">INFINITE</span> expected value...<br>that you wouldn't pay $25 to play!</p>
        </header>

        <div class="game-area">
            <div class="panel">
                <h2>Play the Game</h2>
                <div class="coin-display">
                    <div class="coin heads" id="coin">H</div>
                    <div class="flip-history" id="flipHistory"></div>
                    <div class="flip-count" id="flipCount">Flip the coin until HEADS appears!</div>
                    <div class="current-prize" id="currentPrize">Potential: $2</div>
                    <div class="controls">
                        <button class="btn-gold" id="flipBtn">Flip Coin</button>
                        <button class="btn-secondary" id="resetBtn">New Game</button>
                    </div>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Games Played</div>
                        <div class="stat-value" id="gamesPlayed">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Won</div>
                        <div class="stat-value" id="totalWon">$0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Average Win</div>
                        <div class="stat-value" id="avgWin">$0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Expected Value</div>
                        <div class="stat-value infinite" id="expectedValue">∞</div>
                    </div>
                </div>
            </div>

            <div class="panel">
                <h2>Monte Carlo Simulation</h2>
                <p style="color: #aaa; margin-bottom: 15px;">Run thousands of games to see the empirical average</p>
                <div class="simulation-controls">
                    <label>Games:</label>
                    <input type="number" id="simCount" value="1000" min="100" max="100000">
                    <button class="btn-gold" id="runSimBtn">Run Simulation</button>
                </div>
                <canvas id="histogramCanvas"></canvas>
                <div class="stats-grid" style="margin-top: 15px;">
                    <div class="stat-card">
                        <div class="stat-label">Simulated Games</div>
                        <div class="stat-value" id="simGames">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Empirical Average</div>
                        <div class="stat-value" id="simAvg">$0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Max Prize</div>
                        <div class="stat-value" id="simMax">$0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Median Prize</div>
                        <div class="stat-value" id="simMedian">$0</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="panel">
            <h2>Your Game History (Last 10)</h2>
            <table class="history-table">
                <thead>
                    <tr>
                        <th>Game</th>
                        <th>Flips</th>
                        <th>Sequence</th>
                        <th>Prize</th>
                    </tr>
                </thead>
                <tbody id="historyBody">
                    <tr><td colspan="4" style="text-align: center; color: #666;">No games played yet</td></tr>
                </tbody>
            </table>
        </div>

        <div class="explanation">
            <h2>The Game Rules</h2>
            <div class="math-box">
                <h3>How It Works</h3>
                <p>A fair coin is flipped repeatedly until <span class="highlight">HEADS</span> appears:</p>
                <ul style="margin-left: 20px; line-height: 2;">
                    <li>If HEADS on flip 1: Win <span class="highlight">$2</span></li>
                    <li>If HEADS on flip 2: Win <span class="highlight">$4</span></li>
                    <li>If HEADS on flip 3: Win <span class="highlight">$8</span></li>
                    <li>If HEADS on flip n: Win <span class="highlight">$2ⁿ</span></li>
                </ul>
            </div>

            <h2>The Infinite Expected Value</h2>
            <p>
                Expected value is calculated by summing (probability × prize) for each outcome.
                Since each flip has probability ½ for tails, reaching flip n requires n-1 tails then heads:
            </p>

            <div class="series-display">
                <div class="term">
                    <span class="term-prob">(½)</span> × <span class="term-prize">$2</span> = <span class="term-result">$1</span>
                </div>
                +
                <div class="term">
                    <span class="term-prob">(¼)</span> × <span class="term-prize">$4</span> = <span class="term-result">$1</span>
                </div>
                +
                <div class="term">
                    <span class="term-prob">(⅛)</span> × <span class="term-prize">$8</span> = <span class="term-result">$1</span>
                </div>
                + ...
            </div>

            <div class="formula">
                E[X] = Σ (1/2ⁿ) × 2ⁿ = Σ 1 = 1 + 1 + 1 + 1 + ... = ∞
            </div>

            <p>
                Every term equals $1! The sum diverges to <span class="infinite">INFINITY</span>.
                By standard decision theory, you should pay ANY finite amount to play!
            </p>

            <div class="math-box">
                <h3>The Paradox</h3>
                <p>
                    Despite the infinite expected value, when Daniel Bernoulli posed this problem in 1738,
                    he noted that <em>"any fairly reasonable man would sell his chance, with great pleasure,
                    for twenty ducats."</em>
                </p>
                <p>
                    Would YOU pay $1,000,000 to play once? Of course not! Yet mathematically, that should
                    be a bargain for a game worth infinitely more.
                </p>
            </div>

            <h2>Why We Don't Pay Much</h2>
            <div class="math-box">
                <h3>1. Diminishing Marginal Utility (Bernoulli's Solution)</h3>
                <p>
                    The <em>utility</em> of money isn't linear. The 100th million dollars brings less
                    happiness than the first. Using logarithmic utility: U(x) = ln(x), the expected
                    utility converges to about <span class="highlight">$5.80</span>.
                </p>
            </div>

            <div class="math-box">
                <h3>2. The Median vs Mean</h3>
                <p>
                    The <em>median</em> outcome is only <span class="highlight">$2</span>! Half the time
                    you win just $2 or $4. The infinite expected value comes from astronomically rare
                    events. The mean is undefined (or infinite), but the median is finite.
                </p>
            </div>

            <div class="math-box">
                <h3>3. Finite Casino Wealth</h3>
                <p>
                    No casino has infinite money. If the casino has $1 trillion, the maximum prize is
                    capped at $2⁴⁰ ≈ $1 trillion. This bounds the expected value to about
                    <span class="highlight">$40</span>.
                </p>
            </div>

            <div class="math-box">
                <h3>4. Finite Time</h3>
                <p>
                    Even if the casino were infinitely wealthy, flipping a coin 100 times takes time.
                    Getting TTTTT...T (99 tails) then H has probability 2⁻¹⁰⁰ ≈ 10⁻³⁰—you'd have to
                    play for longer than the age of the universe to expect such a run.
                </p>
            </div>

            <h2>Historical Impact</h2>
            <p>
                This paradox, first described by Nicolas Bernoulli in 1713 and analyzed by his cousin
                Daniel Bernoulli in 1738, led directly to the development of <span class="highlight">expected
                utility theory</span>—the foundation of modern decision theory and economics.
            </p>
            <p>
                It remains a test case for decision theory. Any complete theory must explain why rational
                agents refuse to pay much for this game—revealing deep questions about probability,
                infinity, and human rationality.
            </p>
        </div>
    </div>

    <script>
        // Game state
        let flips = 0;
        let currentPrize = 2;
        let gameOver = false;
        let flipSequence = [];
        let gamesPlayed = 0;
        let totalWinnings = 0;
        let gameHistory = [];

        // DOM elements
        const coin = document.getElementById('coin');
        const flipHistory = document.getElementById('flipHistory');
        const flipCount = document.getElementById('flipCount');
        const currentPrizeEl = document.getElementById('currentPrize');
        const flipBtn = document.getElementById('flipBtn');
        const resetBtn = document.getElementById('resetBtn');
        const gamesPlayedEl = document.getElementById('gamesPlayed');
        const totalWonEl = document.getElementById('totalWon');
        const avgWinEl = document.getElementById('avgWin');
        const historyBody = document.getElementById('historyBody');

        // Histogram canvas
        const histCanvas = document.getElementById('histogramCanvas');
        const histCtx = histCanvas.getContext('2d');

        function resizeCanvas() {
            const rect = histCanvas.getBoundingClientRect();
            histCanvas.width = rect.width * window.devicePixelRatio;
            histCanvas.height = rect.height * window.devicePixelRatio;
            histCtx.scale(window.devicePixelRatio, window.devicePixelRatio);
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        function flipCoin() {
            if (gameOver) return;

            coin.classList.add('flipping');
            flipBtn.disabled = true;

            setTimeout(() => {
                const isHeads = Math.random() < 0.5;
                flips++;

                if (isHeads) {
                    coin.className = 'coin heads';
                    coin.textContent = 'H';
                    flipSequence.push('H');
                    gameOver = true;

                    // Record game
                    gamesPlayed++;
                    totalWinnings += currentPrize;

                    gameHistory.unshift({
                        game: gamesPlayed,
                        flips: flips,
                        sequence: flipSequence.join(''),
                        prize: currentPrize
                    });
                    if (gameHistory.length > 10) gameHistory.pop();

                    updateHistory();
                    updateStats();

                    flipCount.innerHTML = `<span style="color: #ffd700;">HEADS!</span> You won after ${flips} flip${flips > 1 ? 's' : ''}!`;
                    currentPrizeEl.innerHTML = `Won: <span style="color: #90ee90;">$${formatNumber(currentPrize)}</span>`;
                    flipBtn.textContent = 'Game Over!';
                } else {
                    coin.className = 'coin tails';
                    coin.textContent = 'T';
                    flipSequence.push('T');
                    currentPrize *= 2;

                    flipCount.textContent = `${flips} flip${flips > 1 ? 's' : ''} - all TAILS so far...`;
                    currentPrizeEl.textContent = `Potential: $${formatNumber(currentPrize)}`;
                    flipBtn.disabled = false;
                }

                // Update flip history display
                const historyHtml = flipSequence.map(f =>
                    `<div class="flip-result ${f === 'H' ? 'heads' : 'tails'}">${f}</div>`
                ).join('');
                flipHistory.innerHTML = historyHtml;

                coin.classList.remove('flipping');
            }, 300);
        }

        function resetGame() {
            flips = 0;
            currentPrize = 2;
            gameOver = false;
            flipSequence = [];

            coin.className = 'coin heads';
            coin.textContent = 'H';
            flipHistory.innerHTML = '';
            flipCount.textContent = 'Flip the coin until HEADS appears!';
            currentPrizeEl.textContent = 'Potential: $2';
            flipBtn.textContent = 'Flip Coin';
            flipBtn.disabled = false;
        }

        function updateStats() {
            gamesPlayedEl.textContent = gamesPlayed;
            totalWonEl.textContent = '$' + formatNumber(totalWinnings);
            avgWinEl.textContent = gamesPlayed > 0 ?
                '$' + formatNumber(Math.round(totalWinnings / gamesPlayed)) : '$0';
        }

        function updateHistory() {
            if (gameHistory.length === 0) {
                historyBody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: #666;">No games played yet</td></tr>';
                return;
            }

            historyBody.innerHTML = gameHistory.map(g => `
                <tr>
                    <td>#${g.game}</td>
                    <td>${g.flips}</td>
                    <td style="font-family: monospace;">${g.sequence}</td>
                    <td class="${g.prize >= 1024 ? 'jackpot' : ''}">$${formatNumber(g.prize)}</td>
                </tr>
            `).join('');
        }

        function formatNumber(n) {
            if (n >= 1e12) return (n / 1e12).toFixed(1) + 'T';
            if (n >= 1e9) return (n / 1e9).toFixed(1) + 'B';
            if (n >= 1e6) return (n / 1e6).toFixed(1) + 'M';
            if (n >= 1e3) return n.toLocaleString();
            return n.toString();
        }

        // Simulation
        function runSimulation() {
            const count = parseInt(document.getElementById('simCount').value) || 1000;
            const prizes = [];

            for (let i = 0; i < count; i++) {
                let prize = 2;
                while (Math.random() >= 0.5) {
                    prize *= 2;
                }
                prizes.push(prize);
            }

            prizes.sort((a, b) => a - b);

            const total = prizes.reduce((a, b) => a + b, 0);
            const avg = total / count;
            const max = Math.max(...prizes);
            const median = prizes[Math.floor(count / 2)];

            document.getElementById('simGames').textContent = count.toLocaleString();
            document.getElementById('simAvg').textContent = '$' + formatNumber(Math.round(avg));
            document.getElementById('simMax').textContent = '$' + formatNumber(max);
            document.getElementById('simMedian').textContent = '$' + formatNumber(median);

            drawHistogram(prizes);
        }

        function drawHistogram(prizes) {
            const width = histCanvas.width / window.devicePixelRatio;
            const height = histCanvas.height / window.devicePixelRatio;

            histCtx.clearRect(0, 0, width, height);

            // Count by prize level (log scale)
            const counts = {};
            prizes.forEach(p => {
                const level = Math.log2(p);
                counts[level] = (counts[level] || 0) + 1;
            });

            const levels = Object.keys(counts).map(Number).sort((a, b) => a - b);
            const maxCount = Math.max(...Object.values(counts));
            const maxLevel = Math.max(...levels);

            const barWidth = (width - 60) / (maxLevel + 1);
            const chartHeight = height - 40;

            // Draw bars
            levels.forEach(level => {
                const count = counts[level];
                const barHeight = (count / maxCount) * (chartHeight - 20);
                const x = 40 + level * barWidth;
                const y = chartHeight - barHeight;

                const gradient = histCtx.createLinearGradient(x, y + barHeight, x, y);
                gradient.addColorStop(0, '#daa520');
                gradient.addColorStop(1, '#ffd700');

                histCtx.fillStyle = gradient;
                histCtx.fillRect(x, y, barWidth - 2, barHeight);
            });

            // Draw axes
            histCtx.strokeStyle = '#555';
            histCtx.lineWidth = 1;
            histCtx.beginPath();
            histCtx.moveTo(40, 10);
            histCtx.lineTo(40, chartHeight);
            histCtx.lineTo(width - 10, chartHeight);
            histCtx.stroke();

            // Labels
            histCtx.fillStyle = '#888';
            histCtx.font = '10px Georgia';
            histCtx.textAlign = 'center';

            for (let i = 0; i <= maxLevel; i += Math.ceil(maxLevel / 8)) {
                const x = 40 + i * barWidth + barWidth / 2;
                histCtx.fillText('$' + Math.pow(2, i + 1), x, chartHeight + 15);
            }

            histCtx.save();
            histCtx.translate(12, chartHeight / 2);
            histCtx.rotate(-Math.PI / 2);
            histCtx.textAlign = 'center';
            histCtx.fillText('Frequency', 0, 0);
            histCtx.restore();
        }

        // Event listeners
        flipBtn.addEventListener('click', flipCoin);
        resetBtn.addEventListener('click', resetGame);
        document.getElementById('runSimBtn').addEventListener('click', runSimulation);

        // Keyboard support
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' || e.code === 'Enter') {
                e.preventDefault();
                if (gameOver) {
                    resetGame();
                } else {
                    flipCoin();
                }
            }
        });

        // Initial histogram
        drawHistogram([2, 2, 2, 4, 4, 8]);
    </script>
</body>
</html>
