<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>670 - Braess's Paradox | Surprising Paradoxes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #1f4068 100%);
            color: #e8e8e8;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 20px 0 30px;
        }

        h1 {
            font-size: 2.4rem;
            background: linear-gradient(135deg, #ff6b35 0%, #f7c59f 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1rem;
            color: #a8a8a8;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .simulation-area {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .sim-title {
            font-size: 1.3rem;
            color: #ff6b35;
            text-align: center;
            margin-bottom: 20px;
        }

        .network-container {
            display: flex;
            justify-content: center;
            gap: 50px;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .network-panel {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
            min-width: 350px;
        }

        .network-title {
            text-align: center;
            font-size: 1.1rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .network-title.good { color: #52b788; }
        .network-title.bad { color: #ef476f; }

        canvas {
            display: block;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 25px 0;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 25px;
            font-size: 1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 107, 53, 0.4);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #e8e8e8;
            border: 2px solid #ff6b35;
        }

        .btn-secondary:hover {
            background: rgba(255, 107, 53, 0.2);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef476f, #d00000);
            color: white;
        }

        .stats-comparison {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
            align-items: center;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .stat-panel {
            text-align: center;
            padding: 15px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #a8a8a8;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
        }

        .stat-value.good { color: #52b788; }
        .stat-value.bad { color: #ef476f; }

        .vs-divider {
            font-size: 1.5rem;
            color: #ff6b35;
            font-weight: bold;
        }

        .explanation-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.4rem;
            color: #ff6b35;
            margin-bottom: 20px;
            text-align: center;
        }

        .step-by-step {
            display: grid;
            gap: 20px;
        }

        .step {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid #ff6b35;
        }

        .step-number {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: #ff6b35;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            margin-right: 10px;
        }

        .step h3 {
            display: inline;
            color: #f7c59f;
        }

        .step p {
            margin-top: 10px;
            color: #ccc;
            line-height: 1.7;
        }

        .formula-box {
            background: rgba(0, 0, 0, 0.4);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            text-align: center;
        }

        .highlight { color: #ff6b35; }
        .good-text { color: #52b788; }
        .bad-text { color: #ef476f; }

        .real-world {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .case-card {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 20px;
            transition: transform 0.3s ease;
        }

        .case-card:hover {
            transform: translateY(-5px);
        }

        .case-card h4 {
            color: #ff6b35;
            margin-bottom: 10px;
        }

        .case-card p {
            color: #aaa;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .key-insight {
            background: linear-gradient(135deg, rgba(255, 107, 53, 0.1), rgba(247, 197, 159, 0.05));
            border-left: 4px solid #ff6b35;
            padding: 20px;
            border-radius: 0 10px 10px 0;
            margin: 25px 0;
        }

        .key-insight h3 {
            color: #ff6b35;
            margin-bottom: 10px;
        }

        .key-insight p {
            color: #ccc;
            line-height: 1.7;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #ff6b35;
            text-decoration: none;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 5px;
            z-index: 100;
            background: rgba(0,0,0,0.5);
            padding: 8px 15px;
            border-radius: 20px;
        }

        .back-link:hover {
            background: rgba(255, 107, 53, 0.2);
        }

        .slider-group {
            display: flex;
            align-items: center;
            gap: 15px;
            justify-content: center;
            margin: 15px 0;
        }

        .slider-group label {
            color: #a8a8a8;
        }

        .slider-group input[type="range"] {
            width: 200px;
            accent-color: #ff6b35;
        }

        @media (max-width: 768px) {
            h1 { font-size: 1.8rem; }
            .network-panel { min-width: 100%; }
            .stats-comparison { grid-template-columns: 1fr; }
            .vs-divider { display: none; }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Paradoxes</a>

    <div class="container">
        <header>
            <h1>Braess's Paradox</h1>
            <p class="subtitle">Adding a new road to a traffic network can make EVERYONE's commute WORSE!
            When selfish drivers optimize individually, the Nash equilibrium is worse for all.</p>
        </header>

        <div class="simulation-area">
            <div class="sim-title">Interactive Traffic Network Simulation</div>

            <div class="slider-group">
                <label>Number of drivers: <span id="driver-count">4000</span></label>
                <input type="range" id="drivers-slider" min="1000" max="10000" value="4000" step="500" oninput="updateDrivers()">
            </div>

            <div class="network-container">
                <div class="network-panel">
                    <div class="network-title good">Without Shortcut Road</div>
                    <canvas id="canvas-without" width="320" height="250"></canvas>
                </div>
                <div class="network-panel">
                    <div class="network-title bad">With Shortcut Road</div>
                    <canvas id="canvas-with" width="320" height="250"></canvas>
                </div>
            </div>

            <div class="controls">
                <button class="btn btn-primary" onclick="runSimulation()">Run Simulation</button>
                <button class="btn btn-secondary" onclick="stepSimulation()">Step Through</button>
                <button class="btn btn-secondary" onclick="resetSimulation()">Reset</button>
            </div>

            <div class="stats-comparison">
                <div class="stat-panel">
                    <div class="stat-label">Average Travel Time (No Shortcut)</div>
                    <div class="stat-value good" id="time-without">--</div>
                </div>
                <div class="vs-divider">VS</div>
                <div class="stat-panel">
                    <div class="stat-label">Average Travel Time (With Shortcut)</div>
                    <div class="stat-value bad" id="time-with">--</div>
                </div>
            </div>

            <div id="result-message" class="key-insight" style="display: none; margin-top: 20px;">
                <h3>The Paradox in Action!</h3>
                <p id="result-text"></p>
            </div>
        </div>

        <div class="explanation-section">
            <div class="section-title">How Does This Happen?</div>

            <div class="step-by-step">
                <div class="step">
                    <span class="step-number">1</span>
                    <h3>The Setup</h3>
                    <p>Consider 4000 drivers going from Start (S) to End (E). There are two routes:<br>
                    <strong>Route A:</strong> S ‚Üí A ‚Üí E with travel time = <span class="highlight">T/100 + 45</span> minutes<br>
                    <strong>Route B:</strong> S ‚Üí B ‚Üí E with travel time = <span class="highlight">45 + T/100</span> minutes<br>
                    Where T = number of cars on that road segment.</p>
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <h3>Equilibrium Without Shortcut</h3>
                    <p>Drivers split evenly: 2000 take Route A, 2000 take Route B.<br>
                    Each driver's time: 2000/100 + 45 = <span class="good-text">65 minutes</span><br>
                    Nobody can improve by switching routes ‚Äî this is Nash equilibrium!</p>
                    <div class="formula-box">
                        Route A: 20 + 45 = 65 min<br>
                        Route B: 45 + 20 = 65 min<br>
                        <span class="good-text">Total system time: 65 minutes per driver</span>
                    </div>
                </div>

                <div class="step">
                    <span class="step-number">3</span>
                    <h3>Add a "Free" Shortcut</h3>
                    <p>Now add a shortcut from A to B with travel time = 0 (instant!).<br>
                    New route possible: S ‚Üí A ‚Üí B ‚Üí E<br>
                    This looks like it should help, right?</p>
                </div>

                <div class="step">
                    <span class="step-number">4</span>
                    <h3>The Tragic New Equilibrium</h3>
                    <p>EVERY driver now takes S ‚Üí A ‚Üí B ‚Üí E because:<br>
                    - S‚ÜíA is faster than S‚ÜíB (variable vs. fixed)<br>
                    - A‚ÜíB is free!<br>
                    - B‚ÜíE is faster than A‚ÜíE (variable vs. fixed)<br><br>
                    New travel time: 4000/100 + 0 + 4000/100 = <span class="bad-text">80 minutes!</span></p>
                    <div class="formula-box">
                        S‚ÜíA: 40 min (4000 drivers)<br>
                        A‚ÜíB: 0 min (shortcut)<br>
                        B‚ÜíE: 40 min (4000 drivers)<br>
                        <span class="bad-text">Total: 80 minutes per driver ‚Äî 23% WORSE!</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="key-insight">
            <h3>The Game Theory Insight</h3>
            <p><strong>Nash Equilibrium ‚â† Social Optimum.</strong> Each driver makes a locally rational choice
            (taking the shortcut saves time <em>if others don't</em>), but when EVERYONE makes this choice,
            everyone is worse off. This is the <strong>Tragedy of the Commons</strong> applied to traffic.<br><br>
            The only solution? <strong>Close the shortcut</strong> or add congestion pricing to discourage its use!</p>
        </div>

        <div class="explanation-section">
            <div class="section-title">Real-World Cases</div>

            <div class="real-world">
                <div class="case-card">
                    <h4>üá∞üá∑ Seoul, South Korea (2005)</h4>
                    <p>The Cheonggyecheon Expressway was demolished and replaced with a park.
                    Traffic IMPROVED despite removing a major highway. Travel times dropped 3.4%!</p>
                </div>
                <div class="case-card">
                    <h4>üá©üá™ Stuttgart, Germany (1969)</h4>
                    <p>After new roads were built, traffic got worse. Authorities had to CLOSE
                    one of the new roads before congestion improved.</p>
                </div>
                <div class="case-card">
                    <h4>üá∫üá∏ 42nd Street, NYC (1990)</h4>
                    <p>Earth Day closure of 42nd Street reduced congestion in Manhattan.
                    In 2010, closing Broadway to cars near Times Square cut travel times 15%!</p>
                </div>
                <div class="case-card">
                    <h4>üèÄ Sports Teams</h4>
                    <p>Adding a star player can hurt team performance if everyone over-relies
                    on them! The same "selfish optimization" dynamic applies.</p>
                </div>
            </div>
        </div>

        <div class="key-insight">
            <h3>Mathematical Fact</h3>
            <p>In a random network, adding an edge causes Braess's Paradox with probability ~1/2.
            However, if travel times are linear in traffic flow, the worst-case increase is bounded
            by a factor of 4/3 (33% worse). First discovered by Dietrich Braess in 1968.</p>
        </div>
    </div>

    <script>
        const canvasWithout = document.getElementById('canvas-without');
        const canvasWidth = canvasWithout.width;
        const canvasHeight = canvasWithout.height;
        const ctxWithout = canvasWithout.getContext('2d');
        const ctxWith = document.getElementById('canvas-with').getContext('2d');

        let numDrivers = 4000;
        let animationId = null;

        // Node positions
        const nodes = {
            S: { x: 50, y: 125 },
            A: { x: 160, y: 50 },
            B: { x: 160, y: 200 },
            E: { x: 270, y: 125 }
        };

        function updateDrivers() {
            numDrivers = parseInt(document.getElementById('drivers-slider').value);
            document.getElementById('driver-count').textContent = numDrivers;
            resetSimulation();
        }

        function drawNetwork(ctx, withShortcut, flows = null) {
            ctx.clearRect(0, 0, canvasWidth, canvasHeight);

            // Draw edges
            ctx.lineWidth = 3;
            ctx.strokeStyle = '#4a5568';

            // S -> A
            drawEdge(ctx, nodes.S, nodes.A, flows?.SA || 0, numDrivers, 'T/100');
            // S -> B
            drawEdge(ctx, nodes.S, nodes.B, flows?.SB || 0, numDrivers, '45');
            // A -> E
            drawEdge(ctx, nodes.A, nodes.E, flows?.AE || 0, numDrivers, '45');
            // B -> E
            drawEdge(ctx, nodes.B, nodes.E, flows?.BE || 0, numDrivers, 'T/100');

            // Shortcut A -> B
            if (withShortcut) {
                ctx.strokeStyle = flows?.AB > 0 ? '#ef476f' : '#888';
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(nodes.A.x, nodes.A.y);
                ctx.lineTo(nodes.B.x, nodes.B.y);
                ctx.stroke();
                ctx.setLineDash([]);

                // Shortcut label
                ctx.fillStyle = '#ef476f';
                ctx.font = 'bold 12px sans-serif';
                ctx.fillText('FREE!', nodes.A.x + 10, (nodes.A.y + nodes.B.y) / 2);
            }

            // Draw nodes
            Object.entries(nodes).forEach(([name, pos]) => {
                ctx.beginPath();
                ctx.arc(pos.x, pos.y, 20, 0, Math.PI * 2);
                ctx.fillStyle = name === 'S' ? '#52b788' : name === 'E' ? '#ff6b35' : '#4a5568';
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();

                ctx.fillStyle = '#fff';
                ctx.font = 'bold 14px sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(name, pos.x, pos.y);
            });
        }

        function drawEdge(ctx, from, to, flow, maxFlow, label) {
            const intensity = flow > 0 ? Math.min(1, flow / maxFlow) : 0;
            ctx.strokeStyle = flow > 0 ?
                `rgba(255, ${Math.floor(107 - intensity * 80)}, ${Math.floor(53 - intensity * 53)}, ${0.5 + intensity * 0.5})` :
                '#4a5568';
            ctx.lineWidth = 2 + intensity * 4;

            ctx.beginPath();
            ctx.moveTo(from.x, from.y);
            ctx.lineTo(to.x, to.y);
            ctx.stroke();

            // Label
            const midX = (from.x + to.x) / 2;
            const midY = (from.y + to.y) / 2;
            const offset = from.y < to.y ? -15 : 15;

            ctx.fillStyle = '#a8a8a8';
            ctx.font = '11px sans-serif';
            ctx.textAlign = 'center';

            const timeLabel = label === 'T/100' ?
                (flow > 0 ? `${(flow/100).toFixed(0)}min` : 'T/100') :
                label + 'min';
            ctx.fillText(timeLabel, midX + (from.x < to.x ? 20 : -20), midY + offset);
        }

        function calculateEquilibrium(withShortcut) {
            if (!withShortcut) {
                // Without shortcut: drivers split evenly
                const half = numDrivers / 2;
                return {
                    SA: half, SB: half, AE: half, BE: half, AB: 0,
                    time: half / 100 + 45
                };
            } else {
                // With shortcut: everyone takes S -> A -> B -> E
                return {
                    SA: numDrivers, SB: 0, AE: 0, BE: numDrivers, AB: numDrivers,
                    time: numDrivers / 100 + numDrivers / 100
                };
            }
        }

        function runSimulation() {
            const eqWithout = calculateEquilibrium(false);
            const eqWith = calculateEquilibrium(true);

            // Animate
            let progress = 0;
            const animate = () => {
                progress += 0.02;
                if (progress > 1) progress = 1;

                const flowsWithout = {
                    SA: eqWithout.SA * progress,
                    SB: eqWithout.SB * progress,
                    AE: eqWithout.AE * progress,
                    BE: eqWithout.BE * progress,
                    AB: 0
                };

                const flowsWith = {
                    SA: eqWith.SA * progress,
                    SB: eqWith.SB * progress,
                    AE: eqWith.AE * progress,
                    BE: eqWith.BE * progress,
                    AB: eqWith.AB * progress
                };

                drawNetwork(ctxWithout, false, flowsWithout);
                drawNetwork(ctxWith, true, flowsWith);

                document.getElementById('time-without').textContent =
                    (eqWithout.time * progress).toFixed(1) + ' min';
                document.getElementById('time-with').textContent =
                    (eqWith.time * progress).toFixed(1) + ' min';

                if (progress < 1) {
                    animationId = requestAnimationFrame(animate);
                } else {
                    showResult(eqWithout.time, eqWith.time);
                }
            };

            if (animationId) cancelAnimationFrame(animationId);
            animate();
        }

        function showResult(timeWithout, timeWith) {
            const increase = ((timeWith - timeWithout) / timeWithout * 100).toFixed(1);
            document.getElementById('result-message').style.display = 'block';
            document.getElementById('result-text').innerHTML =
                `Adding the "free" shortcut increased travel time from <span class="good-text">${timeWithout.toFixed(1)} minutes</span> to
                <span class="bad-text">${timeWith.toFixed(1)} minutes</span> ‚Äî a <span class="bad-text">${increase}% increase</span>!<br><br>
                Every driver rationally chose the shortcut, but collectively everyone is worse off.
                This is the Nash equilibrium ‚Äî no individual can improve by changing their route,
                yet the social optimum (without shortcut) is better for everyone.`;
        }

        function stepSimulation() {
            // TODO: Implement step-by-step animation
            runSimulation();
        }

        function resetSimulation() {
            if (animationId) cancelAnimationFrame(animationId);
            drawNetwork(ctxWithout, false);
            drawNetwork(ctxWith, true);
            document.getElementById('time-without').textContent = '--';
            document.getElementById('time-with').textContent = '--';
            document.getElementById('result-message').style.display = 'none';
        }

        // Initialize
        resetSimulation();
    </script>
</body>
</html>
