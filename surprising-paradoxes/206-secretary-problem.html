<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Secretary Problem - The 37% Rule</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.2em;
            background: linear-gradient(135deg, #e94560, #ff6b9d, #c44569);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.3em;
            color: #aaa;
            font-style: italic;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #e94560;
            text-decoration: none;
            font-size: 1.1em;
            z-index: 100;
            transition: color 0.3s;
        }

        .back-link:hover {
            color: #ff6b9d;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        @media (max-width: 1000px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: rgba(30, 30, 50, 0.9);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(233, 69, 96, 0.3);
        }

        .panel h2 {
            color: #e94560;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .panel h3 {
            color: #ff6b9d;
            margin: 15px 0 10px 0;
            font-size: 1.1em;
        }

        .candidate-queue {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin: 20px 0;
            min-height: 80px;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
        }

        .candidate {
            width: 50px;
            height: 60px;
            background: linear-gradient(145deg, #2a2a4a, #1a1a3a);
            border: 2px solid #444;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
        }

        .candidate .rank {
            font-size: 1.2em;
            font-weight: bold;
            color: #888;
        }

        .candidate .score {
            font-size: 0.7em;
            color: #666;
        }

        .candidate.current {
            border-color: #e94560;
            box-shadow: 0 0 20px rgba(233, 69, 96, 0.5);
            transform: scale(1.1);
        }

        .candidate.rejected {
            opacity: 0.4;
            border-color: #c62828;
        }

        .candidate.explore {
            border-color: #ff9800;
            background: linear-gradient(145deg, #3a2a1a, #2a1a0a);
        }

        .candidate.selected {
            border-color: #4caf50;
            background: linear-gradient(145deg, #1a3a1a, #0a2a0a);
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.5);
        }

        .candidate.best {
            border-color: #ffd700 !important;
        }

        .candidate.best::after {
            content: '★';
            position: absolute;
            top: -10px;
            right: -5px;
            font-size: 1.2em;
            color: #ffd700;
        }

        .interview-panel {
            background: linear-gradient(145deg, rgba(233, 69, 96, 0.1), rgba(255, 107, 157, 0.1));
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            margin: 20px 0;
            min-height: 150px;
        }

        .interview-panel .candidate-large {
            width: 100px;
            height: 120px;
            background: linear-gradient(145deg, #3a3a5a, #2a2a4a);
            border: 3px solid #e94560;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 1.5em;
        }

        .interview-panel .question {
            font-size: 1.3em;
            color: #e94560;
            margin-bottom: 15px;
        }

        .interview-panel .info {
            color: #888;
            margin-bottom: 10px;
        }

        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        button {
            padding: 12px 25px;
            font-size: 1em;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .btn-accept {
            background: linear-gradient(135deg, #4caf50, #2e7d32);
            color: white;
        }

        .btn-accept:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(76, 175, 80, 0.4);
        }

        .btn-reject {
            background: linear-gradient(135deg, #f44336, #c62828);
            color: white;
        }

        .btn-reject:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(244, 67, 54, 0.4);
        }

        .btn-primary {
            background: linear-gradient(135deg, #e94560, #c44569);
            color: white;
        }

        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(233, 69, 96, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #607d8b, #455a64);
            color: white;
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .stat-box {
            background: rgba(0,0,0,0.3);
            padding: 12px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-box .value {
            font-size: 1.5em;
            font-weight: bold;
            color: #e94560;
        }

        .stat-box .label {
            font-size: 0.75em;
            color: #888;
            margin-top: 3px;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 15px 0;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
        }

        .slider-container label {
            min-width: 120px;
            color: #aaa;
        }

        .slider-container input[type="range"] {
            flex: 1;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(90deg, #e94560, #ff6b9d);
            -webkit-appearance: none;
        }

        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
        }

        .slider-container .value {
            min-width: 50px;
            text-align: center;
            font-weight: bold;
            color: #e94560;
        }

        .explanation {
            line-height: 1.8;
            color: #ccc;
        }

        .explanation p {
            margin-bottom: 15px;
        }

        .highlight {
            background: rgba(233, 69, 96, 0.2);
            padding: 2px 6px;
            border-radius: 4px;
            color: #e94560;
        }

        .paradox-box {
            background: linear-gradient(135deg, rgba(233, 69, 96, 0.1), rgba(255, 107, 157, 0.1));
            border: 1px solid rgba(233, 69, 96, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .paradox-box h3 {
            color: #ff6b9d;
            margin-bottom: 10px;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .probability-chart {
            height: 200px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 20px;
            position: relative;
            margin: 15px 0;
        }

        .chart-canvas {
            width: 100%;
            height: 100%;
        }

        .e-marker {
            position: absolute;
            bottom: 20px;
            left: 37%;
            transform: translateX(-50%);
            text-align: center;
        }

        .e-marker .line {
            width: 2px;
            height: 160px;
            background: #ffd700;
            margin: 0 auto;
        }

        .e-marker .label {
            color: #ffd700;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .big-number {
            font-size: 4em;
            font-weight: bold;
            text-align: center;
            background: linear-gradient(135deg, #e94560, #ff6b9d);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .monte-carlo {
            background: rgba(0,0,0,0.4);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }

        .mc-bar {
            height: 40px;
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
            overflow: hidden;
            margin: 15px 0;
        }

        .mc-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #000;
            transition: width 0.5s;
        }

        .strategy-comparison {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 15px 0;
        }

        .strategy-card {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .strategy-card h4 {
            color: #e94560;
            margin-bottom: 10px;
        }

        .strategy-card .rate {
            font-size: 2em;
            font-weight: bold;
            color: #ff6b9d;
        }

        .strategy-card .desc {
            font-size: 0.85em;
            color: #888;
            margin-top: 5px;
        }

        .application-card {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 4px solid #e94560;
        }

        .application-card h4 {
            color: #e94560;
            margin-bottom: 8px;
        }

        .application-card p {
            color: #aaa;
            font-size: 0.95em;
        }

        .formula-box {
            background: rgba(0,0,0,0.4);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin: 15px 0;
            font-family: 'Times New Roman', serif;
        }

        .formula-box .formula {
            font-size: 1.3em;
            color: #e94560;
            font-style: italic;
        }

        .formula-box .explanation {
            font-size: 0.9em;
            color: #888;
            margin-top: 10px;
        }

        .result-display {
            background: linear-gradient(145deg, rgba(76, 175, 80, 0.2), rgba(46, 125, 50, 0.2));
            border: 2px solid #4caf50;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin: 15px 0;
            display: none;
        }

        .result-display.show {
            display: block;
        }

        .result-display.success {
            border-color: #4caf50;
        }

        .result-display.failure {
            background: linear-gradient(145deg, rgba(244, 67, 54, 0.2), rgba(198, 40, 40, 0.2));
            border-color: #f44336;
        }

        .result-display .result-text {
            font-size: 1.5em;
            font-weight: bold;
        }

        .result-display.success .result-text {
            color: #4caf50;
        }

        .result-display.failure .result-text {
            color: #f44336;
        }

        .phase-indicator {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 15px 0;
        }

        .phase {
            padding: 10px 20px;
            border-radius: 20px;
            background: rgba(0,0,0,0.3);
            color: #888;
        }

        .phase.active {
            background: linear-gradient(135deg, #e94560, #c44569);
            color: white;
        }

        .phase.explore-phase.active {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }

        .phase.exploit-phase.active {
            background: linear-gradient(135deg, #4caf50, #2e7d32);
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Paradoxes</a>

    <div class="container">
        <header>
            <h1>The Secretary Problem</h1>
            <p class="subtitle">The 37% Rule — How the number e optimizes life decisions</p>
        </header>

        <div class="main-grid">
            <!-- Main Simulation -->
            <div class="panel">
                <h2>The Hiring Game</h2>

                <div class="slider-container">
                    <label>Candidates:</label>
                    <input type="range" id="nSlider" min="5" max="100" value="20">
                    <span class="value" id="nValue">20</span>
                </div>

                <div class="phase-indicator">
                    <div class="phase explore-phase" id="explorePhase">Explore (reject first 37%)</div>
                    <div class="phase exploit-phase" id="exploitPhase">Exploit (select if best so far)</div>
                </div>

                <div class="candidate-queue" id="candidateQueue"></div>

                <div class="interview-panel" id="interviewPanel">
                    <div class="info">Click "Start" to begin interviewing candidates</div>
                </div>

                <div class="result-display" id="resultDisplay">
                    <div class="result-text" id="resultText"></div>
                    <div id="resultDetails" style="margin-top: 10px; color: #aaa;"></div>
                </div>

                <div class="controls">
                    <button class="btn-primary" id="startBtn">Start Hiring</button>
                    <button class="btn-primary" id="autoBtn">Auto-Play Optimal</button>
                    <button class="btn-secondary" id="resetBtn">Reset</button>
                </div>

                <div class="stat-grid">
                    <div class="stat-box">
                        <div class="value" id="interviewed">0</div>
                        <div class="label">Interviewed</div>
                    </div>
                    <div class="stat-box">
                        <div class="value" id="threshold">7</div>
                        <div class="label">Threshold (n/e)</div>
                    </div>
                    <div class="stat-box">
                        <div class="value" id="bestSoFar">-</div>
                        <div class="label">Best So Far</div>
                    </div>
                    <div class="stat-box">
                        <div class="value" id="currentScore">-</div>
                        <div class="label">Current</div>
                    </div>
                </div>
            </div>

            <!-- The Paradox -->
            <div class="panel">
                <h2>The Paradox</h2>

                <div class="paradox-box">
                    <h3>The Rules</h3>
                    <ul style="margin-left: 20px; color: #ccc;">
                        <li>Interview <strong>n</strong> candidates one at a time</li>
                        <li>After each, you must <span class="highlight">immediately decide</span></li>
                        <li>If you reject, you can <strong>never recall</strong> them</li>
                        <li>Goal: Select the single <span class="highlight">BEST</span> candidate</li>
                    </ul>
                </div>

                <h3>The Dilemma</h3>
                <div class="explanation">
                    <p><strong>Too eager?</strong> You might hire someone good, missing the best who comes later.</p>
                    <p><strong>Too patient?</strong> You might reject the best, settling for a worse candidate.</p>
                </div>

                <div class="big-number">37%</div>
                <p style="text-align: center; color: #888; margin-bottom: 20px;">The magic threshold</p>

                <div class="formula-box">
                    <div class="formula">r* = n/e ≈ 0.368n</div>
                    <div class="explanation">
                        Reject the first n/e candidates, then select the first one better than all you've seen
                    </div>
                </div>
            </div>

            <!-- Monte Carlo -->
            <div class="panel">
                <h2>Monte Carlo Verification</h2>

                <div class="slider-container">
                    <label>Simulations:</label>
                    <input type="range" id="simSlider" min="100" max="10000" step="100" value="1000">
                    <span class="value" id="simValue">1000</span>
                </div>

                <div class="controls">
                    <button class="btn-primary" id="runSimBtn">Run Simulation</button>
                </div>

                <div class="monte-carlo">
                    <div style="text-align: center; margin-bottom: 10px;">Success Rate (selected the BEST)</div>
                    <div class="mc-bar">
                        <div class="mc-fill" id="mcFill" style="width: 36.8%;">36.8%</div>
                    </div>
                    <div style="text-align: center; color: #888;">
                        <span id="mcTrials">0</span> trials | Expected: 1/e ≈ 36.79%
                    </div>
                </div>

                <div class="strategy-comparison">
                    <div class="strategy-card">
                        <h4>Optimal (37%)</h4>
                        <div class="rate">36.8%</div>
                        <div class="desc">Reject n/e, then pick first best</div>
                    </div>
                    <div class="strategy-card">
                        <h4>Random</h4>
                        <div class="rate">1/n</div>
                        <div class="desc">Pick uniformly at random</div>
                    </div>
                    <div class="strategy-card">
                        <h4>First One</h4>
                        <div class="rate">1/n</div>
                        <div class="desc">Always pick first candidate</div>
                    </div>
                </div>
            </div>

            <!-- Why It Works -->
            <div class="panel">
                <h2>Why 1/e?</h2>

                <div class="probability-chart">
                    <canvas id="probChart" class="chart-canvas"></canvas>
                </div>

                <div class="explanation">
                    <p>Let P(r) = probability of success when rejecting first r candidates.</p>
                    <p>P(r) = (r/n) × [1/r + 1/(r+1) + ... + 1/(n-1)]</p>
                    <p>As n→∞, maximizing P(r) gives r = n/e</p>
                    <p>And P(n/e) → <span class="highlight">1/e ≈ 36.79%</span></p>
                </div>

                <div class="paradox-box">
                    <h3>The Beautiful Coincidence</h3>
                    <p>The optimal threshold is <strong>1/e</strong> of the candidates.</p>
                    <p>The success probability is also <strong>1/e</strong>.</p>
                    <p>The same transcendental number appears in both!</p>
                </div>
            </div>

            <!-- Real World Applications -->
            <div class="panel full-width">
                <h2>Real-World Applications</h2>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
                    <div class="application-card">
                        <h4>Dating & Marriage</h4>
                        <p>If you plan to date ~10 people seriously, the 37% rule says: date the first 3-4 without committing, then marry the next person who's better than all of them.</p>
                    </div>
                    <div class="application-card">
                        <h4>House Hunting</h4>
                        <p>Viewing 20 houses? Look at the first 7 to calibrate your expectations, then make an offer on the first one that beats them all.</p>
                    </div>
                    <div class="application-card">
                        <h4>Hiring Employees</h4>
                        <p>The original problem! With 100 applicants, interview 37 to set your benchmark, then hire the next standout.</p>
                    </div>
                    <div class="application-card">
                        <h4>Parking Spots</h4>
                        <p>Looking for parking? Pass the first 37% of spots to learn what's typical, then take the first good one.</p>
                    </div>
                    <div class="application-card">
                        <h4>Selling Your House</h4>
                        <p>Expecting 20 offers? Use the first 7 to gauge the market, then accept the first offer that beats them all.</p>
                    </div>
                    <div class="application-card">
                        <h4>When to Stop Searching</h4>
                        <p>Any optimal stopping problem! Whether it's job offers, college choices, or vacation rentals—the 37% rule applies.</p>
                    </div>
                </div>

                <div class="paradox-box" style="margin-top: 25px;">
                    <h3>The Deeper Insight</h3>
                    <p>The secretary problem reveals that <strong>gathering information has value</strong>, but so does <strong>acting on it</strong>. The 37% rule perfectly balances exploration and exploitation.</p>
                    <p style="margin-top: 10px; color: #e94560;"><em>"Look at 37% of your options, then leap at the first one that exceeds your benchmark."</em></p>
                </div>
            </div>
        </div>

        <p style="text-align: center; color: #666; margin-top: 30px; font-size: 0.9em;">
            Also known as the <a href="https://en.wikipedia.org/wiki/Secretary_problem" style="color: #e94560;">Marriage Problem, Dowry Problem, or Best Choice Problem</a>. Analyzed by Lindley (1961) and Dynkin (1963).
        </p>
    </div>

    <script>
        // State
        let n = 20;
        let candidates = [];
        let currentIndex = -1;
        let threshold = Math.floor(n / Math.E);
        let bestSoFar = 0;
        let selectedCandidate = null;
        let gameState = 'idle'; // idle, playing, finished

        // DOM elements
        const candidateQueue = document.getElementById('candidateQueue');
        const interviewPanel = document.getElementById('interviewPanel');
        const resultDisplay = document.getElementById('resultDisplay');

        function initCandidates() {
            // Create array of scores 1 to n (1 is best)
            candidates = Array.from({length: n}, (_, i) => ({
                score: i + 1,
                rank: i + 1
            }));

            // Shuffle
            for (let i = candidates.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [candidates[i], candidates[j]] = [candidates[j], candidates[i]];
            }

            threshold = Math.floor(n / Math.E);
            document.getElementById('threshold').textContent = threshold;
        }

        function renderQueue() {
            candidateQueue.innerHTML = '';
            candidates.forEach((c, i) => {
                const div = document.createElement('div');
                div.className = 'candidate';
                div.innerHTML = `<span class="rank">#${i + 1}</span>`;

                if (i < currentIndex) {
                    div.classList.add('rejected');
                    if (i < threshold) div.classList.add('explore');
                }
                if (i === currentIndex) {
                    div.classList.add('current');
                }
                if (selectedCandidate === i) {
                    div.classList.add('selected');
                }
                if (c.score === 1) {
                    div.classList.add('best');
                }

                candidateQueue.appendChild(div);
            });
        }

        function showInterview() {
            if (currentIndex < 0 || currentIndex >= n) {
                interviewPanel.innerHTML = '<div class="info">Click "Start" to begin</div>';
                return;
            }

            const c = candidates[currentIndex];
            const inExplorePhase = currentIndex < threshold;
            const isBetterThanBest = c.score < bestSoFar || bestSoFar === 0;

            let recommendation = '';
            if (inExplorePhase) {
                recommendation = '<div style="color: #ff9800; margin-top: 10px;">EXPLORE PHASE: Reject (gathering information)</div>';
            } else if (isBetterThanBest) {
                recommendation = '<div style="color: #4caf50; margin-top: 10px;">EXPLOIT PHASE: Accept! (best so far)</div>';
            } else {
                recommendation = '<div style="color: #f44336; margin-top: 10px;">EXPLOIT PHASE: Reject (not better than best)</div>';
            }

            interviewPanel.innerHTML = `
                <div class="candidate-large">
                    <span style="font-size: 0.6em; color: #888;">Candidate</span>
                    <span>${currentIndex + 1}</span>
                </div>
                <div class="question">Hire this candidate?</div>
                <div class="info">
                    Quality score: ${c.score}/${n} (lower is better)<br>
                    ${isBetterThanBest ? '✓ Better than all previous' : '✗ Not better than best seen'}
                </div>
                ${recommendation}
                <div class="controls" style="margin-top: 15px;">
                    <button class="btn-accept" onclick="accept()">Accept ✓</button>
                    <button class="btn-reject" onclick="reject()">Reject ✗</button>
                </div>
            `;

            // Update phase indicators
            document.getElementById('explorePhase').classList.toggle('active', inExplorePhase);
            document.getElementById('exploitPhase').classList.toggle('active', !inExplorePhase);
        }

        function accept() {
            if (gameState !== 'playing') return;
            selectedCandidate = currentIndex;
            finishGame();
        }

        function reject() {
            if (gameState !== 'playing') return;

            const c = candidates[currentIndex];
            if (c.score < bestSoFar || bestSoFar === 0) {
                bestSoFar = c.score;
                document.getElementById('bestSoFar').textContent = bestSoFar;
            }

            currentIndex++;
            document.getElementById('interviewed').textContent = currentIndex;

            if (currentIndex >= n) {
                // Must take the last one
                selectedCandidate = n - 1;
                finishGame();
            } else {
                renderQueue();
                showInterview();
                document.getElementById('currentScore').textContent = candidates[currentIndex].score;
            }
        }

        function finishGame() {
            gameState = 'finished';
            renderQueue();

            const selected = candidates[selectedCandidate];
            const success = selected.score === 1;

            resultDisplay.className = 'result-display show ' + (success ? 'success' : 'failure');
            document.getElementById('resultText').textContent = success ?
                'SUCCESS! You hired the BEST candidate!' :
                'You did not hire the best candidate.';
            document.getElementById('resultDetails').textContent =
                `Selected: Candidate #${selectedCandidate + 1} (score ${selected.score}/${n}). ` +
                `The best was Candidate #${candidates.findIndex(c => c.score === 1) + 1}.`;

            interviewPanel.innerHTML = '<div class="info">Game Over - Click Reset to play again</div>';
        }

        function startGame() {
            gameState = 'playing';
            currentIndex = 0;
            bestSoFar = 0;
            selectedCandidate = null;

            initCandidates();
            renderQueue();
            showInterview();

            document.getElementById('interviewed').textContent = '0';
            document.getElementById('bestSoFar').textContent = '-';
            document.getElementById('currentScore').textContent = candidates[0].score;
            resultDisplay.className = 'result-display';
        }

        function autoPlay() {
            startGame();

            const playStep = () => {
                if (gameState !== 'playing') return;

                if (currentIndex < threshold) {
                    // Explore phase: always reject
                    reject();
                    setTimeout(playStep, 200);
                } else {
                    // Exploit phase: accept if better than best
                    const c = candidates[currentIndex];
                    if (c.score < bestSoFar || bestSoFar === 0) {
                        accept();
                    } else {
                        reject();
                        if (gameState === 'playing') setTimeout(playStep, 200);
                    }
                }
            };

            setTimeout(playStep, 500);
        }

        function reset() {
            gameState = 'idle';
            currentIndex = -1;
            bestSoFar = 0;
            selectedCandidate = null;

            initCandidates();
            renderQueue();

            interviewPanel.innerHTML = '<div class="info">Click "Start" to begin interviewing candidates</div>';
            resultDisplay.className = 'result-display';
            document.getElementById('interviewed').textContent = '0';
            document.getElementById('bestSoFar').textContent = '-';
            document.getElementById('currentScore').textContent = '-';
            document.getElementById('explorePhase').classList.remove('active');
            document.getElementById('exploitPhase').classList.remove('active');
        }

        // Monte Carlo simulation
        function runSimulation() {
            const numSims = parseInt(document.getElementById('simSlider').value);
            let successes = 0;

            for (let sim = 0; sim < numSims; sim++) {
                // Generate random permutation
                const perm = Array.from({length: n}, (_, i) => i + 1);
                for (let i = perm.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [perm[i], perm[j]] = [perm[j], perm[i]];
                }

                // Apply optimal strategy
                const r = Math.floor(n / Math.E);
                let bestInExplore = Infinity;

                for (let i = 0; i < r; i++) {
                    if (perm[i] < bestInExplore) bestInExplore = perm[i];
                }

                let selected = perm[n - 1]; // Default: last one
                for (let i = r; i < n; i++) {
                    if (perm[i] < bestInExplore) {
                        selected = perm[i];
                        break;
                    }
                }

                if (selected === 1) successes++;
            }

            const rate = (successes / numSims * 100).toFixed(1);
            document.getElementById('mcFill').style.width = rate + '%';
            document.getElementById('mcFill').textContent = rate + '%';
            document.getElementById('mcTrials').textContent = numSims;
        }

        // Draw probability chart
        function drawChart() {
            const canvas = document.getElementById('probChart');
            const ctx = canvas.getContext('2d');
            const dpr = window.devicePixelRatio || 1;

            canvas.width = canvas.offsetWidth * dpr;
            canvas.height = canvas.offsetHeight * dpr;
            ctx.scale(dpr, dpr);

            const w = canvas.offsetWidth;
            const h = canvas.offsetHeight;
            const padding = 30;

            // Calculate probabilities for different thresholds
            const probs = [];
            for (let r = 0; r <= n; r++) {
                let p = 0;
                for (let k = r; k < n; k++) {
                    p += (1/n) * (r / Math.max(k, 1));
                }
                probs.push(p);
            }

            const maxP = Math.max(...probs);

            // Draw axes
            ctx.strokeStyle = '#444';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding, h - padding);
            ctx.lineTo(w - padding, h - padding);
            ctx.moveTo(padding, h - padding);
            ctx.lineTo(padding, padding);
            ctx.stroke();

            // Draw curve
            ctx.strokeStyle = '#e94560';
            ctx.lineWidth = 2;
            ctx.beginPath();
            probs.forEach((p, i) => {
                const x = padding + (i / n) * (w - 2 * padding);
                const y = h - padding - (p / maxP) * (h - 2 * padding);
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            ctx.stroke();

            // Mark optimal point
            const optR = Math.floor(n / Math.E);
            const optX = padding + (optR / n) * (w - 2 * padding);
            const optY = h - padding - (probs[optR] / maxP) * (h - 2 * padding);

            ctx.fillStyle = '#ffd700';
            ctx.beginPath();
            ctx.arc(optX, optY, 6, 0, Math.PI * 2);
            ctx.fill();

            // Labels
            ctx.fillStyle = '#888';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Threshold (r)', w/2, h - 5);
            ctx.fillText('0', padding, h - 15);
            ctx.fillText('n', w - padding, h - 15);

            ctx.save();
            ctx.translate(15, h/2);
            ctx.rotate(-Math.PI/2);
            ctx.fillText('P(success)', 0, 0);
            ctx.restore();

            // Mark 1/e
            ctx.fillStyle = '#ffd700';
            ctx.fillText('n/e ≈ 37%', optX, h - 15);
        }

        // Event listeners
        document.getElementById('startBtn').addEventListener('click', startGame);
        document.getElementById('autoBtn').addEventListener('click', autoPlay);
        document.getElementById('resetBtn').addEventListener('click', reset);
        document.getElementById('runSimBtn').addEventListener('click', runSimulation);

        document.getElementById('nSlider').addEventListener('input', (e) => {
            n = parseInt(e.target.value);
            document.getElementById('nValue').textContent = n;
            threshold = Math.floor(n / Math.E);
            document.getElementById('threshold').textContent = threshold;
            reset();
            drawChart();
        });

        document.getElementById('simSlider').addEventListener('input', (e) => {
            document.getElementById('simValue').textContent = e.target.value;
        });

        // Initialize
        initCandidates();
        renderQueue();
        drawChart();

        window.addEventListener('resize', drawChart);
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
