<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cryptomnesia - Surprising Paradoxes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5em;
            color: #e94560;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(233, 69, 96, 0.5);
        }

        .subtitle {
            font-size: 1.2em;
            color: #a0a0a0;
            max-width: 800px;
            margin: 0 auto;
        }

        .back-link {
            display: inline-block;
            color: #e94560;
            text-decoration: none;
            margin-bottom: 20px;
            padding: 8px 16px;
            border: 1px solid #e94560;
            border-radius: 20px;
            transition: all 0.3s;
        }

        .back-link:hover {
            background: #e94560;
            color: white;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .panel h2 {
            color: #e94560;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .panel h3 {
            color: #4db8ff;
            margin: 15px 0 10px;
            font-size: 1.1em;
        }

        /* Experiment Container */
        .experiment-container {
            grid-column: 1 / -1;
        }

        .phase-indicator {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 25px;
        }

        .phase-dot {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: all 0.3s;
            position: relative;
        }

        .phase-dot.active {
            background: #e94560;
            box-shadow: 0 0 15px rgba(233, 69, 96, 0.5);
        }

        .phase-dot.completed {
            background: #4ecca3;
        }

        .phase-dot::after {
            content: attr(data-label);
            position: absolute;
            top: 50px;
            white-space: nowrap;
            font-size: 0.8em;
            color: #a0a0a0;
        }

        /* Phase Content */
        .phase {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .phase.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Exposure Phase */
        .word-display {
            font-size: 2em;
            text-align: center;
            padding: 40px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin: 20px 0;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .category-label {
            text-align: center;
            font-size: 1.2em;
            color: #4db8ff;
            margin-bottom: 10px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin-top: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #e94560, #4db8ff);
            transition: width 0.3s;
        }

        /* Distraction Phase */
        .math-problem {
            font-size: 2.5em;
            text-align: center;
            padding: 30px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin: 20px 0;
        }

        .math-input {
            font-size: 1.5em;
            padding: 10px 20px;
            width: 150px;
            text-align: center;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            margin-top: 15px;
        }

        .distraction-count {
            text-align: center;
            color: #a0a0a0;
            margin-top: 10px;
        }

        /* Generation Phase */
        .generation-input {
            width: 100%;
            padding: 15px;
            font-size: 1.1em;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            margin: 10px 0;
        }

        .generation-input:focus {
            outline: 2px solid #e94560;
        }

        .word-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
            min-height: 50px;
        }

        .word-tag {
            background: rgba(77, 184, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .word-tag.plagiarized {
            background: rgba(233, 69, 96, 0.3);
            border: 1px solid #e94560;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(233, 69, 96, 0.4); }
            50% { box-shadow: 0 0 10px 3px rgba(233, 69, 96, 0.4); }
        }

        .word-tag button {
            background: none;
            border: none;
            color: #e94560;
            cursor: pointer;
            font-size: 1.2em;
        }

        /* Results Phase */
        .result-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            margin: 10px 0;
        }

        .result-stat .value {
            font-size: 1.8em;
            font-weight: bold;
            color: #e94560;
        }

        .comparison-bar {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 10px 0;
        }

        .bar-label {
            width: 120px;
            font-size: 0.9em;
        }

        .bar-container {
            flex: 1;
            height: 25px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            font-size: 0.85em;
            font-weight: bold;
            transition: width 1s ease;
        }

        .bar-fill.user {
            background: linear-gradient(90deg, #e94560, #ff6b8a);
        }

        .bar-fill.research {
            background: linear-gradient(90deg, #4db8ff, #6ec6ff);
        }

        /* Case Studies */
        .case-study {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid #e94560;
        }

        .case-study h4 {
            color: #e94560;
            margin-bottom: 10px;
        }

        .case-year {
            color: #4db8ff;
            font-size: 0.9em;
        }

        .quote {
            font-style: italic;
            color: #a0a0a0;
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
        }

        /* Music Comparison */
        .music-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }

        .song-box {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        .song-box h4 {
            color: #4db8ff;
            margin-bottom: 5px;
        }

        .song-box .artist {
            color: #a0a0a0;
            font-size: 0.9em;
        }

        .song-box .year {
            color: #e94560;
            font-size: 0.85em;
            margin-bottom: 10px;
        }

        .notes {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-top: 15px;
        }

        .note {
            width: 30px;
            height: 40px;
            background: linear-gradient(180deg, #e94560, #4db8ff);
            border-radius: 3px;
            animation: noteWave 1s ease-in-out infinite;
        }

        .note:nth-child(2) { animation-delay: 0.1s; }
        .note:nth-child(3) { animation-delay: 0.2s; }
        .note:nth-child(4) { animation-delay: 0.3s; }
        .note:nth-child(5) { animation-delay: 0.4s; }

        @keyframes noteWave {
            0%, 100% { transform: scaleY(0.5); }
            50% { transform: scaleY(1); }
        }

        /* Brain Diagram */
        .brain-diagram {
            text-align: center;
            padding: 20px;
        }

        .brain-svg {
            max-width: 250px;
            margin: 0 auto;
        }

        .brain-label {
            font-size: 0.9em;
            color: #a0a0a0;
            margin-top: 10px;
        }

        /* Buttons */
        .btn {
            background: linear-gradient(135deg, #e94560, #ff6b8a);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.1em;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
            margin: 10px 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(233, 69, 96, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #4db8ff, #6ec6ff);
        }

        .center-btn {
            text-align: center;
            margin-top: 20px;
        }

        /* Info Box */
        .info-box {
            background: rgba(77, 184, 255, 0.1);
            border: 1px solid rgba(77, 184, 255, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }

        .info-box p {
            color: #a0a0a0;
            font-size: 0.95em;
        }

        /* Research Panel */
        .research-item {
            margin: 15px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .research-item .authors {
            color: #4db8ff;
            font-weight: bold;
        }

        .research-item .finding {
            margin-top: 8px;
            color: #e0e0e0;
        }

        .stat-highlight {
            color: #e94560;
            font-weight: bold;
            font-size: 1.1em;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">← Back to Paradoxes</a>

        <header>
            <h1>Cryptomnesia</h1>
            <p class="subtitle">The Hidden Plagiarist in Your Mind: When Memory Masquerades as Originality</p>
        </header>

        <!-- Experiment Section -->
        <div class="panel experiment-container">
            <h2>Experience Cryptomnesia Yourself</h2>

            <div class="phase-indicator">
                <div class="phase-dot active" data-phase="1" data-label="Exposure">1</div>
                <div class="phase-dot" data-phase="2" data-label="Distraction">2</div>
                <div class="phase-dot" data-phase="3" data-label="Generate">3</div>
                <div class="phase-dot" data-phase="4" data-label="Reveal">4</div>
            </div>

            <!-- Phase 1: Exposure -->
            <div class="phase active" id="phase1">
                <div class="info-box">
                    <p>Watch these words carefully. Each belongs to a category. Try to remember them—but don't worry too much, this isn't a memory test...</p>
                </div>

                <div class="category-label" id="currentCategory">Category: Animals</div>
                <div class="word-display" id="wordDisplay">Ready?</div>

                <div class="progress-bar">
                    <div class="progress-fill" id="exposureProgress" style="width: 0%"></div>
                </div>

                <div class="center-btn">
                    <button class="btn" id="startExposure">Begin Exposure Phase</button>
                </div>
            </div>

            <!-- Phase 2: Distraction -->
            <div class="phase" id="phase2">
                <div class="info-box">
                    <p>Quick math break! Solve these problems as fast as you can. This clears your working memory...</p>
                </div>

                <div class="math-problem" id="mathProblem">17 × 4 = ?</div>
                <div style="text-align: center;">
                    <input type="number" class="math-input" id="mathAnswer" placeholder="?">
                </div>
                <div class="distraction-count" id="mathCount">Problem 1 of 10</div>

                <div class="progress-bar">
                    <div class="progress-fill" id="mathProgress" style="width: 0%"></div>
                </div>
            </div>

            <!-- Phase 3: Generation -->
            <div class="phase" id="phase3">
                <div class="info-box">
                    <p><strong>Now comes the real test:</strong> Generate your OWN ORIGINAL examples for each category. Be creative—come up with ideas that are truly YOUR OWN, not things you've heard before!</p>
                </div>

                <div class="category-label" id="genCategory">Category: Animals</div>
                <input type="text" class="generation-input" id="genInput" placeholder="Type an ORIGINAL example and press Enter...">

                <div class="word-tags" id="userWords"></div>

                <p style="color: #a0a0a0; font-size: 0.9em;">Add at least 4 examples per category. <span id="wordCount">0</span>/4 minimum</p>

                <div class="center-btn">
                    <button class="btn" id="nextCategory" disabled>Next Category →</button>
                    <button class="btn btn-secondary" id="finishGen" style="display: none;">See Results</button>
                </div>
            </div>

            <!-- Phase 4: Results -->
            <div class="phase" id="phase4">
                <h3>Your Cryptomnesia Results</h3>

                <div class="result-stat">
                    <span>Total "original" ideas generated:</span>
                    <span class="value" id="totalGenerated">0</span>
                </div>

                <div class="result-stat">
                    <span>Ideas that matched exposed words:</span>
                    <span class="value" id="plagiarizedCount">0</span>
                </div>

                <div class="result-stat">
                    <span>Your cryptomnesia rate:</span>
                    <span class="value" id="plagiarismRate">0%</span>
                </div>

                <h3>Comparison to Research</h3>
                <div class="comparison-bar">
                    <span class="bar-label">Your rate:</span>
                    <div class="bar-container">
                        <div class="bar-fill user" id="userBar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="comparison-bar">
                    <span class="bar-label">Brown & Murphy:</span>
                    <div class="bar-container">
                        <div class="bar-fill research" style="width: 18%">3-9%</div>
                    </div>
                </div>
                <div class="comparison-bar">
                    <span class="bar-label">Marsh & Bower:</span>
                    <div class="bar-container">
                        <div class="bar-fill research" style="width: 35%">15-25%</div>
                    </div>
                </div>

                <h3>Your Cryptomnesia Incidents</h3>
                <div id="incidentList"></div>

                <div class="center-btn">
                    <button class="btn" id="restartExp">Try Again</button>
                </div>
            </div>
        </div>

        <div class="main-content">
            <!-- Case Studies -->
            <div class="panel">
                <h2>Famous Cases of Cryptomnesia</h2>

                <div class="case-study">
                    <h4>George Harrison vs. "He's So Fine"</h4>
                    <span class="case-year">1976 Landmark Ruling</span>
                    <div class="music-comparison">
                        <div class="song-box">
                            <h4>"He's So Fine"</h4>
                            <div class="artist">The Chiffons</div>
                            <div class="year">1963</div>
                            <div class="notes">
                                <div class="note"></div>
                                <div class="note"></div>
                                <div class="note"></div>
                                <div class="note"></div>
                                <div class="note"></div>
                            </div>
                        </div>
                        <div class="song-box">
                            <h4>"My Sweet Lord"</h4>
                            <div class="artist">George Harrison</div>
                            <div class="year">1970</div>
                            <div class="notes">
                                <div class="note"></div>
                                <div class="note"></div>
                                <div class="note"></div>
                                <div class="note"></div>
                                <div class="note"></div>
                            </div>
                        </div>
                    </div>
                    <div class="quote">
                        "His subconscious knew it already had worked in a song his conscious mind did not remember."
                        <br>— Judge Richard Owen
                    </div>
                    <p>Harrison was found guilty of "subconscious plagiarism" and paid <strong>$1,599,987</strong> in damages. This case established legal precedent that cryptomnesia is no defense for copyright infringement.</p>
                </div>

                <div class="case-study">
                    <h4>Helen Keller's "The Frost King"</h4>
                    <span class="case-year">1892</span>
                    <p>At age 11, Keller wrote a short story that closely resembled "The Frost Fairies" by Margaret Canby—a story read to her three years earlier. The accusation of plagiarism devastated her.</p>
                    <div class="quote">
                        "I have ever since been tortured by the fear that what I write is not my own."
                        <br>— Helen Keller
                    </div>
                </div>

                <div class="case-study">
                    <h4>Friedrich Nietzsche</h4>
                    <span class="case-year">1881</span>
                    <p>Nietzsche unknowingly reproduced almost verbatim a passage from a book he had read in his youth. The memory resurfaced as apparent "original thought" decades later.</p>
                </div>
            </div>

            <!-- How It Works -->
            <div class="panel">
                <h2>The Mechanism: Source Monitoring Failure</h2>

                <div class="brain-diagram">
                    <svg class="brain-svg" viewBox="0 0 200 180" fill="none">
                        <!-- Brain outline -->
                        <path d="M100 20 C40 20 20 70 25 110 C30 150 60 170 100 170 C140 170 170 150 175 110 C180 70 160 20 100 20"
                              stroke="#e94560" stroke-width="3" fill="rgba(233,69,96,0.1)"/>
                        <!-- Memory region -->
                        <ellipse cx="70" cy="90" rx="35" ry="30" fill="rgba(77,184,255,0.3)" stroke="#4db8ff" stroke-width="2"/>
                        <text x="70" y="95" fill="#4db8ff" font-size="10" text-anchor="middle">Memory</text>
                        <!-- Source tag region -->
                        <ellipse cx="130" cy="80" rx="30" ry="25" fill="rgba(78,204,163,0.3)" stroke="#4ecca3" stroke-width="2"/>
                        <text x="130" y="75" fill="#4ecca3" font-size="9" text-anchor="middle">Source</text>
                        <text x="130" y="88" fill="#4ecca3" font-size="9" text-anchor="middle">Tags</text>
                        <!-- Arrow showing disconnect -->
                        <path d="M95 85 L105 85" stroke="#e94560" stroke-width="3" stroke-dasharray="5,3"/>
                        <text x="100" y="115" fill="#e94560" font-size="10" text-anchor="middle">DISCONNECT</text>
                    </svg>
                    <div class="brain-label">When source tags fade, memories feel like original thoughts</div>
                </div>

                <div class="info-box">
                    <p><strong>Why it happens:</strong> Every memory is supposed to be tagged with its source—where you learned it, when, from whom. But these source tags decay faster than the memory content itself. The idea remains, but the "I heard this somewhere" tag is gone.</p>
                </div>

                <h3>Factors That Increase Cryptomnesia</h3>
                <ul style="color: #a0a0a0; margin-left: 20px;">
                    <li><strong>Time delay</strong> — Longer gaps between exposure and recall</li>
                    <li><strong>Cognitive load</strong> — Distraction during encoding</li>
                    <li><strong>Similar sources</strong> — Hard to distinguish who said what</li>
                    <li><strong>Generation tasks</strong> — Pressure to be creative</li>
                    <li><strong>Implicit exposure</strong> — Background information you didn't consciously attend to</li>
                </ul>
            </div>

            <!-- Research Section -->
            <div class="panel">
                <h2>Scientific Research</h2>

                <div class="research-item">
                    <div class="authors">Brown & Murphy (1989)</div>
                    <div class="finding">First empirical study: In group category generation tasks, participants inadvertently plagiarized <span class="stat-highlight">3-9%</span> of the time, claiming others' ideas as their own original thoughts.</div>
                </div>

                <div class="research-item">
                    <div class="authors">Marsh & Bower (1993)</div>
                    <div class="finding">Using word-search puzzles with a "computer partner," plagiarism rates were <span class="stat-highlight">substantially higher</span>—reaching 15-25%. Longer delays and shallower encoding increased rates.</div>
                </div>

                <div class="research-item">
                    <div class="authors">Marsh, Landau & Hicks (1997)</div>
                    <div class="finding">Discovered that <span class="stat-highlight">asking people to focus on idea origins</span> before generation dramatically reduced cryptomnesia—source monitoring can be enhanced.</div>
                </div>

                <div class="research-item">
                    <div class="authors">Taylor (1965)</div>
                    <div class="finding">Coined the term "cryptomnesia" (Greek: hidden memory). First documented the phenomenon in Nietzsche's writings in 1874.</div>
                </div>
            </div>

            <!-- Legal & Implications -->
            <div class="panel">
                <h2>Real-World Implications</h2>

                <h3>Legal Consequences</h3>
                <div class="info-box">
                    <p>Since the 1976 Harrison ruling, U.S. courts treat cryptomnesia <strong>identically to deliberate plagiarism</strong>. "I didn't know I was copying" is not a legal defense. Your unconscious mind's borrowing is still your responsibility.</p>
                </div>

                <h3>Who's Most At Risk?</h3>
                <ul style="color: #a0a0a0; margin-left: 20px;">
                    <li><strong>Musicians & Composers</strong> — Exposed to thousands of melodies</li>
                    <li><strong>Writers & Academics</strong> — Immersed in others' ideas</li>
                    <li><strong>Scientists & Inventors</strong> — Building on prior work</li>
                    <li><strong>Brainstorming Groups</strong> — Ideas flow freely without attribution</li>
                </ul>

                <h3>Prevention Strategies</h3>
                <ul style="color: #a0a0a0; margin-left: 20px;">
                    <li>Meticulous source documentation</li>
                    <li>Pausing to ask "Have I seen this before?"</li>
                    <li>Checking ideas against known sources before claiming originality</li>
                    <li>Using external memory (notes, recordings)</li>
                </ul>

                <h3>The Paradox</h3>
                <div class="quote">
                    "The better your memory for content, and the worse your memory for sources, the more creative you'll feel—and the more dangerous that creativity becomes."
                </div>
            </div>
        </div>
    </div>

    <script>
        // Experiment Data
        const categories = {
            'Animals': ['dolphin', 'penguin', 'koala', 'flamingo', 'octopus', 'peacock'],
            'Fruits': ['mango', 'papaya', 'lychee', 'dragonfruit', 'pomegranate', 'starfruit'],
            'Countries': ['norway', 'peru', 'morocco', 'vietnam', 'portugal', 'argentina'],
            'Colors': ['turquoise', 'lavender', 'crimson', 'amber', 'indigo', 'coral']
        };

        // Words to expose (subset that will be shown)
        const exposedWords = {};
        const categoryOrder = Object.keys(categories);

        // Initialize exposed words (pick 3 random from each category)
        categoryOrder.forEach(cat => {
            const shuffled = [...categories[cat]].sort(() => Math.random() - 0.5);
            exposedWords[cat] = shuffled.slice(0, 3);
        });

        // State
        let currentPhase = 1;
        let exposureIndex = 0;
        let currentCategoryIndex = 0;
        let allExposedFlat = [];
        let userGeneratedWords = {};
        let mathProblems = [];
        let mathIndex = 0;

        // Flatten exposed words
        categoryOrder.forEach(cat => {
            exposedWords[cat].forEach(word => {
                allExposedFlat.push({ category: cat, word: word });
            });
        });

        // Generate math problems
        for (let i = 0; i < 10; i++) {
            const a = Math.floor(Math.random() * 20) + 5;
            const b = Math.floor(Math.random() * 10) + 2;
            const op = Math.random() > 0.5 ? '+' : '×';
            const answer = op === '+' ? a + b : a * b;
            mathProblems.push({ display: `${a} ${op} ${b} = ?`, answer: answer });
        }

        // Initialize user generated words
        categoryOrder.forEach(cat => {
            userGeneratedWords[cat] = [];
        });

        // Phase management
        function setPhase(phase) {
            currentPhase = phase;
            document.querySelectorAll('.phase').forEach(p => p.classList.remove('active'));
            document.getElementById('phase' + phase).classList.add('active');

            document.querySelectorAll('.phase-dot').forEach((dot, i) => {
                dot.classList.remove('active', 'completed');
                if (i + 1 < phase) dot.classList.add('completed');
                if (i + 1 === phase) dot.classList.add('active');
            });
        }

        // Phase 1: Exposure
        document.getElementById('startExposure').addEventListener('click', function() {
            this.style.display = 'none';
            runExposure();
        });

        function runExposure() {
            if (exposureIndex >= allExposedFlat.length) {
                // Move to distraction phase
                setTimeout(() => setPhase(2), 1000);
                return;
            }

            const item = allExposedFlat[exposureIndex];
            document.getElementById('currentCategory').textContent = 'Category: ' + item.category;
            document.getElementById('wordDisplay').textContent = item.word;
            document.getElementById('exposureProgress').style.width =
                ((exposureIndex + 1) / allExposedFlat.length * 100) + '%';

            exposureIndex++;
            setTimeout(runExposure, 2000);
        }

        // Phase 2: Distraction (Math)
        const mathInput = document.getElementById('mathAnswer');
        mathInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && this.value) {
                checkMath();
            }
        });

        function checkMath() {
            const userAnswer = parseInt(mathInput.value);
            mathIndex++;

            if (mathIndex >= mathProblems.length) {
                // Move to generation phase
                setTimeout(() => {
                    setPhase(3);
                    updateGenCategory();
                }, 500);
                return;
            }

            document.getElementById('mathProblem').textContent = mathProblems[mathIndex].display;
            document.getElementById('mathCount').textContent = `Problem ${mathIndex + 1} of 10`;
            document.getElementById('mathProgress').style.width = (mathIndex / 10 * 100) + '%';
            mathInput.value = '';
        }

        // Phase 3: Generation
        const genInput = document.getElementById('genInput');
        const userWordsContainer = document.getElementById('userWords');
        const nextCatBtn = document.getElementById('nextCategory');
        const finishBtn = document.getElementById('finishGen');

        function updateGenCategory() {
            const cat = categoryOrder[currentCategoryIndex];
            document.getElementById('genCategory').textContent = 'Category: ' + cat;
            userWordsContainer.innerHTML = '';
            updateWordCount();
        }

        function updateWordCount() {
            const cat = categoryOrder[currentCategoryIndex];
            const count = userGeneratedWords[cat].length;
            document.getElementById('wordCount').textContent = count;
            nextCatBtn.disabled = count < 4;
        }

        genInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && this.value.trim()) {
                addWord(this.value.trim().toLowerCase());
                this.value = '';
            }
        });

        function addWord(word) {
            const cat = categoryOrder[currentCategoryIndex];
            if (userGeneratedWords[cat].includes(word)) return;

            userGeneratedWords[cat].push(word);

            const tag = document.createElement('div');
            tag.className = 'word-tag';
            tag.innerHTML = `
                <span>${word}</span>
                <button onclick="removeWord('${word}')">&times;</button>
            `;
            userWordsContainer.appendChild(tag);

            updateWordCount();
        }

        window.removeWord = function(word) {
            const cat = categoryOrder[currentCategoryIndex];
            userGeneratedWords[cat] = userGeneratedWords[cat].filter(w => w !== word);
            userWordsContainer.innerHTML = '';
            userGeneratedWords[cat].forEach(w => {
                const tag = document.createElement('div');
                tag.className = 'word-tag';
                tag.innerHTML = `<span>${w}</span><button onclick="removeWord('${w}')">&times;</button>`;
                userWordsContainer.appendChild(tag);
            });
            updateWordCount();
        };

        nextCatBtn.addEventListener('click', function() {
            currentCategoryIndex++;
            if (currentCategoryIndex >= categoryOrder.length) {
                this.style.display = 'none';
                finishBtn.style.display = 'inline-block';
            } else {
                updateGenCategory();
            }
        });

        finishBtn.addEventListener('click', function() {
            calculateResults();
            setPhase(4);
        });

        // Phase 4: Results
        function calculateResults() {
            let totalGenerated = 0;
            let plagiarizedCount = 0;
            const incidents = [];

            categoryOrder.forEach(cat => {
                const exposed = exposedWords[cat];
                const generated = userGeneratedWords[cat];

                totalGenerated += generated.length;

                generated.forEach(word => {
                    if (exposed.includes(word)) {
                        plagiarizedCount++;
                        incidents.push({ category: cat, word: word });
                    }
                });
            });

            const rate = totalGenerated > 0 ? (plagiarizedCount / totalGenerated * 100).toFixed(1) : 0;

            document.getElementById('totalGenerated').textContent = totalGenerated;
            document.getElementById('plagiarizedCount').textContent = plagiarizedCount;
            document.getElementById('plagiarismRate').textContent = rate + '%';

            // Animate user bar
            setTimeout(() => {
                document.getElementById('userBar').style.width = Math.min(rate * 2, 100) + '%';
                document.getElementById('userBar').textContent = rate + '%';
            }, 500);

            // Show incidents
            const incidentList = document.getElementById('incidentList');
            if (incidents.length === 0) {
                incidentList.innerHTML = `
                    <div class="info-box">
                        <p>Impressive! You didn't reproduce any of the exposed words. Either you have excellent source monitoring, or our exposure was too brief. In real life, cryptomnesia happens with longer exposures and more time delay.</p>
                    </div>
                `;
            } else {
                incidentList.innerHTML = incidents.map(inc => `
                    <div class="result-stat">
                        <span>You said "<strong>${inc.word}</strong>" was original</span>
                        <span style="color: #e94560;">← We showed you this in "${inc.category}"</span>
                    </div>
                `).join('');
            }
        }

        // Restart
        document.getElementById('restartExp').addEventListener('click', function() {
            location.reload();
        });
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
