<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Gravity Train Paradox - Surprising Paradoxes - CCAB</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600;700&family=Nunito:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --sage: #8A9A5B;
            --moss: #606C38;
            --earth: #DDA15E;
            --cream: #FEFAE0;
            --terracotta: #BC6C25;
            --dark-moss: #3d4423;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #FEFAE0 0%, #F4F1DE 50%, #EDE8D5 100%);
            min-height: 100vh;
            color: var(--dark-moss);
            line-height: 1.7;
        }
        .organic-shape {
            position: fixed;
            border-radius: 60% 40% 50% 50% / 50% 60% 40% 50%;
            opacity: 0.12;
            z-index: 0;
            animation: morph 30s ease-in-out infinite;
        }
        .shape-1 {
            width: 600px;
            height: 600px;
            background: linear-gradient(135deg, var(--sage), var(--moss));
            top: -200px;
            right: -150px;
        }
        .shape-2 {
            width: 500px;
            height: 500px;
            background: linear-gradient(135deg, var(--earth), var(--terracotta));
            bottom: -150px;
            left: -150px;
            animation-delay: -15s;
        }
        @keyframes morph {
            0%, 100% { border-radius: 60% 40% 50% 50% / 50% 60% 40% 50%; }
            25% { border-radius: 50% 60% 40% 50% / 40% 50% 60% 50%; }
            50% { border-radius: 40% 50% 60% 50% / 50% 40% 50% 60%; }
            75% { border-radius: 50% 40% 50% 60% / 60% 50% 40% 50%; }
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px 80px;
            position: relative;
            z-index: 1;
        }
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--moss);
            text-decoration: none;
            font-weight: 500;
            margin-bottom: 30px;
            padding: 10px 20px;
            background: rgba(255,255,255,0.6);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            transition: all 0.3s ease;
        }
        .back-link:hover {
            background: rgba(255,255,255,0.9);
            transform: translateX(-5px);
        }
        h1 {
            font-family: 'Lora', serif;
            font-size: 2.8rem;
            font-weight: 600;
            color: var(--moss);
            margin-bottom: 20px;
            line-height: 1.2;
        }
        .subtitle {
            font-size: 1.3rem;
            color: var(--terracotta);
            margin-bottom: 40px;
            font-weight: 500;
        }
        .badge {
            display: inline-block;
            background: linear-gradient(135deg, #ffd700, #ffb700);
            color: #1a1a2e;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 25px;
        }
        .card {
            background: rgba(255,255,255,0.7);
            backdrop-filter: blur(15px);
            border-radius: 24px;
            padding: 35px;
            margin-bottom: 35px;
            border: 1px solid rgba(138,154,91,0.2);
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
        }
        .card h2 {
            font-family: 'Lora', serif;
            font-size: 1.6rem;
            color: var(--moss);
            margin-bottom: 20px;
        }
        .card p { color: #555; margin-bottom: 18px; }
        .card p:last-child { margin-bottom: 0; }
        .highlight {
            background: linear-gradient(120deg, rgba(221,161,94,0.2) 0%, rgba(221,161,94,0.1) 100%);
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 600;
            color: var(--terracotta);
        }

        /* Simulation */
        .simulation-container {
            background: linear-gradient(180deg, #0a0a1a 0%, #1a1a3e 100%);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 35px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);
        }
        .simulation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .simulation-title {
            color: #fff;
            font-family: 'Lora', serif;
            font-size: 1.3rem;
        }
        .controls {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        .btn {
            background: linear-gradient(135deg, var(--earth) 0%, var(--terracotta) 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-family: 'Nunito', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(188,108,37,0.4);
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .btn-secondary {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
        }
        .btn-secondary:hover {
            background: rgba(255,255,255,0.25);
        }
        #earthCanvas {
            display: block;
            width: 100%;
            border-radius: 12px;
            cursor: crosshair;
        }

        .info-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .info-box {
            background: rgba(255,255,255,0.08);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }
        .info-label {
            color: rgba(255,255,255,0.6);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }
        .info-value {
            font-size: 1.3rem;
            font-weight: 700;
            font-family: 'Courier New', monospace;
            color: #fff;
        }
        .info-value.time { color: #ffd700; }
        .info-value.distance { color: #4ecdc4; }
        .info-value.speed { color: #ff6b6b; }

        .instructions {
            color: rgba(255,255,255,0.7);
            font-size: 0.9rem;
            text-align: center;
            margin-top: 15px;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
        }

        /* Preset tunnels */
        .presets {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 15px;
        }
        .preset-btn {
            background: rgba(78, 205, 196, 0.2);
            color: #4ecdc4;
            border: 1px solid rgba(78, 205, 196, 0.4);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .preset-btn:hover {
            background: rgba(78, 205, 196, 0.4);
        }

        /* Quote */
        .quote {
            border-left: 4px solid var(--earth);
            padding-left: 25px;
            margin: 25px 0;
            font-style: italic;
            color: #666;
        }
        .quote-author {
            font-style: normal;
            font-weight: 600;
            color: var(--moss);
            margin-top: 10px;
        }

        /* Insight box */
        .insight-box {
            background: linear-gradient(135deg, rgba(138,154,91,0.15) 0%, rgba(96,108,56,0.1) 100%);
            border: 2px solid var(--sage);
            border-radius: 16px;
            padding: 25px;
            margin: 25px 0;
        }
        .insight-box h3 {
            color: var(--moss);
            font-family: 'Lora', serif;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Formula */
        .formula {
            background: rgba(0,0,0,0.03);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            color: var(--dark-moss);
        }

        /* Comparison */
        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        .comparison-item {
            background: rgba(255,255,255,0.5);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        .comparison-route {
            font-weight: 600;
            color: var(--moss);
            margin-bottom: 5px;
        }
        .comparison-distance {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
        }
        .comparison-time {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--terracotta);
        }
        .comparison-time span {
            font-size: 0.9rem;
            font-weight: 400;
        }

        /* 42 Easter egg */
        .forty-two {
            display: inline-block;
            background: linear-gradient(135deg, #00aa66, #00dd88);
            color: white;
            padding: 2px 8px;
            border-radius: 6px;
            font-weight: 700;
        }

        .footer {
            text-align: center;
            padding-top: 30px;
            color: #888;
            font-size: 0.85rem;
        }
        .footer a { color: var(--moss); }

        @media (max-width: 600px) {
            h1 { font-size: 2rem; }
            .card { padding: 25px; }
            .simulation-container { padding: 20px; }
        }
    </style>
</head>
<body>
    <div class="organic-shape shape-1"></div>
    <div class="organic-shape shape-2"></div>

    <main class="container">
        <a href="index.html" class="back-link">← Back to Paradoxes</a>

        <span class="badge">Orbital Mechanics</span>
        <h1>The Gravity Train Paradox</h1>
        <p class="subtitle">Any frictionless tunnel through Earth takes exactly <span class="forty-two">42 minutes</span> to traverse—whether through the center or just across town.</p>

        <!-- Main Simulation -->
        <div class="simulation-container">
            <div class="simulation-header">
                <h2 class="simulation-title">Build Your Tunnel</h2>
                <div class="controls">
                    <button class="btn" id="dropBtn">
                        <span>&#9660;</span> Drop Train
                    </button>
                    <button class="btn btn-secondary" id="resetBtn">
                        <span>&#8635;</span> Reset
                    </button>
                    <button class="btn btn-secondary" id="clearBtn">
                        <span>&#10005;</span> Clear Tunnel
                    </button>
                </div>
            </div>

            <canvas id="earthCanvas" width="800" height="500"></canvas>

            <div class="instructions">
                <strong>Click two points</strong> on Earth's surface to draw a tunnel. Then drop the train and watch!
            </div>

            <div class="presets">
                <button class="preset-btn" data-angle="180">Through Center</button>
                <button class="preset-btn" data-angle="90">Quarter Arc</button>
                <button class="preset-btn" data-angle="45">Short Tunnel</button>
                <button class="preset-btn" data-angle="10">Very Short</button>
            </div>

            <div class="info-panel">
                <div class="info-box">
                    <div class="info-label">Tunnel Length</div>
                    <div class="info-value distance" id="tunnelLength">—</div>
                </div>
                <div class="info-box">
                    <div class="info-label">Current Speed</div>
                    <div class="info-value speed" id="currentSpeed">0 km/s</div>
                </div>
                <div class="info-box">
                    <div class="info-label">Elapsed Time</div>
                    <div class="info-value time" id="elapsedTime">0:00</div>
                </div>
                <div class="info-box">
                    <div class="info-label">Journey Time</div>
                    <div class="info-value time" id="journeyTime">≈42 min</div>
                </div>
            </div>
        </div>

        <!-- The Paradox -->
        <div class="card">
            <h2>The Impossible Transit System</h2>
            <p>Imagine drilling a perfectly straight, frictionless tunnel between any two cities on Earth. Drop an object (or a train!) at one end. Gravity pulls it down, accelerating until the midpoint, then decelerating as it rises toward the destination.</p>
            <p>Here's the stunning result: <span class="highlight">Every such tunnel, regardless of length, takes exactly the same time to traverse!</span></p>

            <div class="comparison-grid">
                <div class="comparison-item">
                    <div class="comparison-route">New York → London</div>
                    <div class="comparison-distance">5,567 km tunnel</div>
                    <div class="comparison-time">42 <span>min</span></div>
                </div>
                <div class="comparison-item">
                    <div class="comparison-route">Through Earth's Center</div>
                    <div class="comparison-distance">12,742 km tunnel</div>
                    <div class="comparison-time">42 <span>min</span></div>
                </div>
                <div class="comparison-item">
                    <div class="comparison-route">Paris → Berlin</div>
                    <div class="comparison-distance">878 km tunnel</div>
                    <div class="comparison-time">42 <span>min</span></div>
                </div>
                <div class="comparison-item">
                    <div class="comparison-route">Any Two Points!</div>
                    <div class="comparison-distance">Any length</div>
                    <div class="comparison-time">42 <span>min</span></div>
                </div>
            </div>
        </div>

        <!-- The Physics -->
        <div class="card">
            <h2>Why It Works: Perfect Cancellation</h2>

            <div class="insight-box">
                <h3>&#128161; The Key Insight</h3>
                <p>Shorter tunnels have weaker gravitational pull (less Earth below you), but less distance to cover. Longer tunnels have stronger pull, but more distance. These effects <strong>cancel exactly</strong>, giving the same travel time for all chord lengths.</p>
            </div>

            <p><strong>The mathematics:</strong> Inside Earth, gravity at distance r from center is proportional to r (assuming uniform density). This creates a restoring force proportional to displacement—the defining feature of <strong>simple harmonic motion</strong>!</p>

            <div class="formula">
                T = 2π √(R/g) ≈ 84.4 minutes (full oscillation)<br>
                <span style="font-size: 0.9rem; color: #888;">Half period = 42.2 minutes (one-way trip)</span>
            </div>

            <p>The period depends only on Earth's radius R and surface gravity g—not on the tunnel's length or direction. Every chord, from pole-to-pole through the core to a short suburban tunnel, gives the same 42-minute journey.</p>

            <p><strong>Connection to orbits:</strong> The 42-minute transit time equals half the orbital period of a satellite grazing Earth's surface. The gravity train passenger oscillates like a pendulum with the same period as a low Earth orbit!</p>
        </div>

        <!-- Historical Context -->
        <div class="card">
            <h2>A Very Old Dream</h2>
            <p>The gravity train concept has fascinated thinkers for centuries:</p>
            <ul style="margin-left: 25px; color: #555; margin-bottom: 20px;">
                <li><strong>1679:</strong> Robert Hooke wrote to Isaac Newton about a ball falling through a tunnel in Earth</li>
                <li><strong>1893:</strong> Lewis Carroll mentioned the idea in <em>Sylvie and Bruno Concluded</em></li>
                <li><strong>1966:</strong> Paul Cooper's paper "Through the Earth in Forty Minutes" in the <em>American Journal of Physics</em> gave the definitive mathematical treatment</li>
            </ul>

            <div class="quote">
                "There's another thing we've learned from your Nation... the short way to send things. You know, at the last election a baby was voted in at the top of one hole, and came out at the bottom of another hole, three hundred miles off."
                <div class="quote-author">— Lewis Carroll, Sylvie and Bruno Concluded (1893)</div>
            </div>
        </div>

        <!-- Realistic Considerations -->
        <div class="card">
            <h2>Reality Check: 38 Minutes?</h2>
            <p>The 42-minute result assumes Earth has uniform density. In reality, Earth's core is much denser than its mantle and crust. Alexander Klotz (2015) recalculated using Earth's actual density profile:</p>

            <div class="insight-box">
                <h3>&#127757; Realistic Earth</h3>
                <p><strong>Uniform density model:</strong> 42 minutes 12 seconds<br>
                <strong>Actual Earth density:</strong> 38 minutes 11 seconds</p>
                <p>The denser core means stronger gravitational acceleration in the central regions, speeding up the journey by about 4 minutes!</p>
            </div>

            <p><strong>Other practical issues:</strong></p>
            <ul style="margin-left: 25px; color: #555;">
                <li><strong>Temperature:</strong> Earth's core is 5,400°C (as hot as the Sun's surface)</li>
                <li><strong>Pressure:</strong> 360 GPa at the center—enough to crush any known material</li>
                <li><strong>Rotation:</strong> Coriolis forces would deflect the train, requiring curved tunnels</li>
                <li><strong>Air resistance:</strong> The tunnel couldn't be evacuated easily</li>
            </ul>
        </div>

        <!-- The 42 Connection -->
        <div class="card">
            <h2>The Answer to Everything?</h2>
            <p>Fans of Douglas Adams will recognize the number 42 as the "Answer to the Ultimate Question of Life, the Universe, and Everything" from <em>The Hitchhiker's Guide to the Galaxy</em>.</p>
            <p>Is there a cosmic connection? Sadly, probably not—the 42-minute result is actually 42.2 minutes, rounded down. But it's a delightful coincidence that the time to traverse Earth matches the meaning of existence!</p>

            <div class="formula">
                T = π √(R<sub>Earth</sub> / g) = π √(6,371 km / 9.81 m/s²) ≈ 2,530 seconds ≈ <span class="forty-two">42.2 minutes</span>
            </div>
        </div>

        <!-- Real Applications -->
        <div class="card">
            <h2>Beyond Science Fiction</h2>
            <p>While we can't build Earth tunnels, the gravity train principle has inspired real proposals:</p>
            <ul style="margin-left: 25px; color: #555;">
                <li><strong>Lunar tunnels:</strong> With no atmosphere and lower gravity, tunnels through the Moon are more feasible</li>
                <li><strong>Vacuum tube transport:</strong> Hyperloop and similar concepts use partial gravity-assist on curved trajectories</li>
                <li><strong>Space elevators:</strong> Use gravitational/centrifugal balance for "free" transport to orbit</li>
                <li><strong>Planetary colonization:</strong> Tunnels through smaller bodies like asteroids could enable rapid transit</li>
            </ul>
        </div>

        <div class="footer">
            <p>Sources: <a href="https://en.wikipedia.org/wiki/Gravity_train" target="_blank">Wikipedia</a>,
            <a href="https://www.science.org/content/article/how-long-would-it-take-you-fall-through-earth" target="_blank">Science AAAS</a>,
            <a href="https://thatsmaths.com/2013/08/29/a-hole-through-the-earth/" target="_blank">ThatsMaths</a></p>
            <p style="margin-top: 10px;">Part of <a href="../index.html">CCAB</a> &middot; Surprising Paradoxes Collection</p>
        </div>
    </main>

    <script>
        // === GRAVITY TRAIN SIMULATION ===
        const canvas = document.getElementById('earthCanvas');
        const ctx = canvas.getContext('2d');

        // High DPI
        const dpr = window.devicePixelRatio || 1;
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width * dpr;
        canvas.height = rect.height * dpr;
        ctx.scale(dpr, dpr);
        canvas.style.width = rect.width + 'px';
        canvas.style.height = rect.height + 'px';

        const W = rect.width;
        const H = rect.height;

        // Earth parameters
        const earthRadius = Math.min(W, H) * 0.38;
        const centerX = W / 2;
        const centerY = H / 2;

        // Real Earth parameters (scaled)
        const EARTH_RADIUS = 6371; // km
        const GRAVITY = 9.81; // m/s²
        const PERIOD = 2 * Math.PI * Math.sqrt(EARTH_RADIUS * 1000 / GRAVITY); // seconds
        const HALF_PERIOD = PERIOD / 2; // ~2530 seconds = 42.2 minutes

        // Tunnel state
        let tunnelStart = null;
        let tunnelEnd = null;
        let clickCount = 0;

        // Train state
        let trainPos = 0; // 0 to 1 along tunnel
        let trainVel = 0;
        let isDropped = false;
        let simulationTime = 0;
        let journeyComplete = false;

        // Stars background
        const stars = [];
        for (let i = 0; i < 100; i++) {
            stars.push({
                x: Math.random() * W,
                y: Math.random() * H,
                size: Math.random() * 1.5 + 0.5,
                twinkle: Math.random() * Math.PI * 2
            });
        }

        // Draw Earth
        function drawEarth() {
            // Ocean base
            const oceanGrad = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, earthRadius);
            oceanGrad.addColorStop(0, '#1a4a6e');
            oceanGrad.addColorStop(0.7, '#0d3a5c');
            oceanGrad.addColorStop(1, '#0a2540');

            ctx.beginPath();
            ctx.arc(centerX, centerY, earthRadius, 0, Math.PI * 2);
            ctx.fillStyle = oceanGrad;
            ctx.fill();

            // Simplified continents
            ctx.fillStyle = '#2d5a3d';
            // North America
            drawContinent(-0.3, -0.4, 0.25, 0.3);
            // South America
            drawContinent(-0.2, 0.2, 0.15, 0.35);
            // Europe/Africa
            drawContinent(0.1, -0.2, 0.15, 0.5);
            // Asia
            drawContinent(0.35, -0.35, 0.3, 0.35);
            // Australia
            drawContinent(0.55, 0.35, 0.12, 0.1);

            // Atmosphere glow
            ctx.beginPath();
            ctx.arc(centerX, centerY, earthRadius + 5, 0, Math.PI * 2);
            ctx.strokeStyle = 'rgba(100, 180, 255, 0.3)';
            ctx.lineWidth = 10;
            ctx.stroke();

            // Earth outline
            ctx.beginPath();
            ctx.arc(centerX, centerY, earthRadius, 0, Math.PI * 2);
            ctx.strokeStyle = 'rgba(100, 180, 255, 0.5)';
            ctx.lineWidth = 2;
            ctx.stroke();
        }

        function drawContinent(cx, cy, w, h) {
            const x = centerX + cx * earthRadius;
            const y = centerY + cy * earthRadius;
            ctx.beginPath();
            ctx.ellipse(x, y, w * earthRadius, h * earthRadius, Math.random() * 0.3, 0, Math.PI * 2);
            ctx.fill();
        }

        // Draw tunnel
        function drawTunnel() {
            if (!tunnelStart) return;

            if (tunnelEnd) {
                // Full tunnel
                ctx.beginPath();
                ctx.moveTo(tunnelStart.x, tunnelStart.y);
                ctx.lineTo(tunnelEnd.x, tunnelEnd.y);
                ctx.strokeStyle = '#ff6b6b';
                ctx.lineWidth = 6;
                ctx.stroke();

                // Tunnel glow
                ctx.strokeStyle = 'rgba(255, 107, 107, 0.3)';
                ctx.lineWidth = 12;
                ctx.stroke();

                // Entry/exit points
                ctx.fillStyle = '#ffd700';
                ctx.beginPath();
                ctx.arc(tunnelStart.x, tunnelStart.y, 8, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.arc(tunnelEnd.x, tunnelEnd.y, 8, 0, Math.PI * 2);
                ctx.fill();
            } else {
                // Just start point
                ctx.fillStyle = '#ffd700';
                ctx.beginPath();
                ctx.arc(tunnelStart.x, tunnelStart.y, 8, 0, Math.PI * 2);
                ctx.fill();

                // Instruction
                ctx.fillStyle = 'rgba(255, 215, 0, 0.8)';
                ctx.font = '14px Nunito';
                ctx.textAlign = 'center';
                ctx.fillText('Click another point', tunnelStart.x, tunnelStart.y - 20);
            }
        }

        // Draw train
        function drawTrain() {
            if (!tunnelStart || !tunnelEnd || !isDropped) return;

            const dx = tunnelEnd.x - tunnelStart.x;
            const dy = tunnelEnd.y - tunnelStart.y;

            const trainX = tunnelStart.x + dx * trainPos;
            const trainY = tunnelStart.y + dy * trainPos;

            // Train glow
            ctx.beginPath();
            ctx.arc(trainX, trainY, 18, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(255, 215, 0, 0.3)';
            ctx.fill();

            // Train body
            ctx.beginPath();
            ctx.arc(trainX, trainY, 10, 0, Math.PI * 2);
            ctx.fillStyle = '#ffd700';
            ctx.fill();
            ctx.strokeStyle = '#b8860b';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Speed indicator
            const speed = Math.abs(trainVel);
            const maxSpeed = Math.PI / HALF_PERIOD * EARTH_RADIUS; // km/s at max

            // Velocity arrow
            const arrowLen = Math.min(50, speed * 10);
            const arrowDir = trainVel > 0 ? 1 : -1;
            const angle = Math.atan2(dy, dx);

            if (arrowLen > 5) {
                ctx.strokeStyle = '#00ff88';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(trainX, trainY);
                ctx.lineTo(
                    trainX + Math.cos(angle) * arrowLen * arrowDir,
                    trainY + Math.sin(angle) * arrowLen * arrowDir
                );
                ctx.stroke();
            }
        }

        // Draw everything
        function draw() {
            ctx.clearRect(0, 0, W, H);

            // Background
            const bgGrad = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, W);
            bgGrad.addColorStop(0, '#0a0a1a');
            bgGrad.addColorStop(1, '#000005');
            ctx.fillStyle = bgGrad;
            ctx.fillRect(0, 0, W, H);

            // Stars
            const time = Date.now() / 1000;
            stars.forEach(star => {
                const twinkle = Math.sin(time * 2 + star.twinkle) * 0.3 + 0.7;
                ctx.fillStyle = `rgba(255, 255, 255, ${twinkle})`;
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                ctx.fill();
            });

            drawEarth();
            drawTunnel();
            drawTrain();

            // Labels
            ctx.fillStyle = 'rgba(255,255,255,0.5)';
            ctx.font = '12px Nunito';
            ctx.textAlign = 'center';
            ctx.fillText('Earth (to scale)', centerX, centerY + earthRadius + 30);

            // Center marker
            ctx.fillStyle = 'rgba(255,255,255,0.3)';
            ctx.beginPath();
            ctx.arc(centerX, centerY, 3, 0, Math.PI * 2);
            ctx.fill();
        }

        // Physics update
        function updatePhysics(dt) {
            if (!isDropped || !tunnelStart || !tunnelEnd || journeyComplete) return;

            simulationTime += dt;

            // SHM: acceleration = -ω² * displacement from center
            const omega = Math.PI / HALF_PERIOD;
            const displacement = trainPos - 0.5; // -0.5 to 0.5
            const acceleration = -omega * omega * displacement;

            trainVel += acceleration * dt;
            trainPos += trainVel * dt;

            // Check if reached destination
            if (trainPos >= 1) {
                trainPos = 1;
                trainVel = 0;
                journeyComplete = true;
                document.getElementById('dropBtn').disabled = false;
            }

            updateDisplay();
        }

        // Update display
        function updateDisplay() {
            if (!tunnelStart || !tunnelEnd) {
                document.getElementById('tunnelLength').textContent = '—';
                document.getElementById('currentSpeed').textContent = '0 km/s';
                document.getElementById('elapsedTime').textContent = '0:00';
                document.getElementById('journeyTime').textContent = '≈42 min';
                return;
            }

            // Tunnel length in km
            const dx = tunnelEnd.x - tunnelStart.x;
            const dy = tunnelEnd.y - tunnelStart.y;
            const pixelLength = Math.sqrt(dx * dx + dy * dy);
            const kmLength = (pixelLength / earthRadius) * EARTH_RADIUS;
            document.getElementById('tunnelLength').textContent = kmLength.toFixed(0) + ' km';

            // Current speed
            const speedKmPerSec = Math.abs(trainVel) * EARTH_RADIUS;
            document.getElementById('currentSpeed').textContent = speedKmPerSec.toFixed(1) + ' km/s';

            // Elapsed time
            const mins = Math.floor(simulationTime / 60);
            const secs = Math.floor(simulationTime % 60);
            document.getElementById('elapsedTime').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;

            // Journey time (always ~42 min)
            if (journeyComplete) {
                document.getElementById('journeyTime').textContent = `${mins}:${secs.toString().padStart(2, '0')} ✓`;
            } else {
                document.getElementById('journeyTime').textContent = '≈42 min';
            }
        }

        // Get point on Earth's surface from angle
        function getPointOnSurface(angleDeg) {
            const angle = angleDeg * Math.PI / 180;
            return {
                x: centerX + earthRadius * Math.cos(angle),
                y: centerY + earthRadius * Math.sin(angle)
            };
        }

        // Check if point is on Earth's surface
        function isOnSurface(x, y) {
            const dx = x - centerX;
            const dy = y - centerY;
            const dist = Math.sqrt(dx * dx + dy * dy);
            return Math.abs(dist - earthRadius) < 15;
        }

        // Snap to surface
        function snapToSurface(x, y) {
            const dx = x - centerX;
            const dy = y - centerY;
            const angle = Math.atan2(dy, dx);
            return {
                x: centerX + earthRadius * Math.cos(angle),
                y: centerY + earthRadius * Math.sin(angle)
            };
        }

        // Click handler
        canvas.addEventListener('click', (e) => {
            if (isDropped && !journeyComplete) return;

            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            if (isOnSurface(x, y) || true) { // Allow clicking anywhere, snap to surface
                const point = snapToSurface(x, y);

                if (!tunnelStart || (tunnelStart && tunnelEnd)) {
                    // Start new tunnel
                    tunnelStart = point;
                    tunnelEnd = null;
                    isDropped = false;
                    journeyComplete = false;
                    simulationTime = 0;
                    document.getElementById('dropBtn').disabled = false;
                } else {
                    // Complete tunnel
                    tunnelEnd = point;
                }

                updateDisplay();
                draw();
            }
        });

        // Drop button
        document.getElementById('dropBtn').addEventListener('click', () => {
            if (!tunnelStart || !tunnelEnd) return;
            if (isDropped && !journeyComplete) return;

            isDropped = true;
            journeyComplete = false;
            trainPos = 0;
            trainVel = 0;
            simulationTime = 0;
            document.getElementById('dropBtn').disabled = true;
        });

        // Reset button
        document.getElementById('resetBtn').addEventListener('click', () => {
            if (!tunnelStart || !tunnelEnd) return;

            isDropped = false;
            journeyComplete = false;
            trainPos = 0;
            trainVel = 0;
            simulationTime = 0;
            document.getElementById('dropBtn').disabled = false;
            updateDisplay();
        });

        // Clear button
        document.getElementById('clearBtn').addEventListener('click', () => {
            tunnelStart = null;
            tunnelEnd = null;
            isDropped = false;
            journeyComplete = false;
            trainPos = 0;
            trainVel = 0;
            simulationTime = 0;
            document.getElementById('dropBtn').disabled = false;
            updateDisplay();
            draw();
        });

        // Preset buttons
        document.querySelectorAll('.preset-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const angle = parseInt(btn.dataset.angle);
                tunnelStart = getPointOnSurface(-90);
                tunnelEnd = getPointOnSurface(-90 + angle);
                isDropped = false;
                journeyComplete = false;
                trainPos = 0;
                trainVel = 0;
                simulationTime = 0;
                document.getElementById('dropBtn').disabled = false;
                updateDisplay();
                draw();
            });
        });

        // Animation loop
        let lastTime = 0;
        const timeScale = 100; // Speed up simulation

        function animate(time) {
            const dt = Math.min((time - lastTime) / 1000, 0.05) * timeScale;
            lastTime = time;

            updatePhysics(dt);
            draw();
            requestAnimationFrame(animate);
        }

        // Initialize
        draw();
        updateDisplay();
        requestAnimationFrame(animate);
    </script>
</body>
</html>
