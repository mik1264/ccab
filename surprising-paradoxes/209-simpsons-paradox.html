<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simpson's Paradox - When Data Lies</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        .back-link {
            display: inline-block;
            color: #7eb8da;
            text-decoration: none;
            margin-bottom: 20px;
            font-size: 0.95rem;
            opacity: 0.8;
            transition: opacity 0.3s;
        }

        .back-link:hover {
            opacity: 1;
        }

        h1 {
            font-size: 2.4rem;
            background: linear-gradient(135deg, #e94560, #f39c12);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1rem;
            color: #a0c4e8;
            max-width: 750px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .example-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .example-btn {
            padding: 12px 25px;
            background: rgba(233, 69, 96, 0.2);
            border: 2px solid rgba(233, 69, 96, 0.5);
            color: #e94560;
            border-radius: 30px;
            cursor: pointer;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s;
        }

        .example-btn:hover {
            background: rgba(233, 69, 96, 0.3);
        }

        .example-btn.active {
            background: #e94560;
            color: white;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .panel {
            background: rgba(30, 40, 70, 0.6);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(126, 184, 218, 0.3);
        }

        .panel h2 {
            color: #f39c12;
            font-size: 1.3rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 20px;
        }

        .bar-chart {
            display: flex;
            justify-content: space-around;
            align-items: flex-end;
            height: 250px;
            padding: 20px;
            background: rgba(20, 30, 50, 0.5);
            border-radius: 10px;
        }

        .bar-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
        }

        .bar-pair {
            display: flex;
            gap: 10px;
            align-items: flex-end;
            height: 200px;
        }

        .bar {
            width: 40px;
            border-radius: 5px 5px 0 0;
            position: relative;
            transition: height 0.8s ease-out;
            cursor: pointer;
        }

        .bar.treatment-a {
            background: linear-gradient(180deg, #e94560, #c73e54);
        }

        .bar.treatment-b {
            background: linear-gradient(180deg, #3498db, #2980b9);
        }

        .bar-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-weight: bold;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .bar-label {
            margin-top: 10px;
            font-size: 0.85rem;
            color: #a0c4e8;
            text-align: center;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .legend-color.a {
            background: #e94560;
        }

        .legend-color.b {
            background: #3498db;
        }

        .insight-box {
            background: linear-gradient(135deg, rgba(233, 69, 96, 0.2), rgba(243, 156, 18, 0.1));
            border-left: 4px solid #e94560;
            padding: 20px;
            border-radius: 0 10px 10px 0;
            margin: 20px 0;
        }

        .insight-box h3 {
            color: #f39c12;
            margin-bottom: 10px;
        }

        .insight-box p {
            color: #c0d0e0;
            line-height: 1.7;
        }

        .winner-indicator {
            font-size: 1.5rem;
            text-align: center;
            margin-top: 15px;
            padding: 15px;
            border-radius: 10px;
            transition: all 0.5s;
        }

        .winner-indicator.a-wins {
            background: rgba(233, 69, 96, 0.3);
            color: #e94560;
        }

        .winner-indicator.b-wins {
            background: rgba(52, 152, 219, 0.3);
            color: #3498db;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 0.9rem;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid rgba(126, 184, 218, 0.2);
        }

        .data-table th {
            background: rgba(20, 30, 50, 0.6);
            color: #f39c12;
        }

        .data-table td {
            color: #c0d0e0;
        }

        .highlight-a {
            color: #e94560;
            font-weight: bold;
        }

        .highlight-b {
            color: #3498db;
            font-weight: bold;
        }

        .explanation {
            background: rgba(20, 40, 70, 0.4);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            border: 1px solid rgba(126, 184, 218, 0.2);
        }

        .explanation h2 {
            color: #f39c12;
            margin-bottom: 15px;
        }

        .explanation p {
            color: #b0c8e0;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .arrow-animation {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
            font-size: 2rem;
        }

        .confound-reveal {
            background: rgba(243, 156, 18, 0.2);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .confound-reveal h3 {
            color: #f39c12;
            margin-bottom: 10px;
        }

        .toggle-view {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .toggle-btn {
            padding: 10px 20px;
            background: rgba(126, 184, 218, 0.2);
            border: 1px solid rgba(126, 184, 218, 0.5);
            color: #7eb8da;
            border-radius: 20px;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.3s;
        }

        .toggle-btn:hover {
            background: rgba(126, 184, 218, 0.3);
        }

        .toggle-btn.active {
            background: #7eb8da;
            color: #1a1a2e;
        }

        @media (max-width: 900px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-link">‚Üê Back to Surprising Paradoxes</a>
            <h1>Simpson's Paradox</h1>
            <p class="subtitle">A trend appears in every group of data‚Äîbut REVERSES when the groups are combined. How can Treatment A beat Treatment B in EVERY subgroup, yet lose overall?</p>
        </header>

        <div class="example-selector">
            <button class="example-btn active" data-example="kidney">üè• Kidney Stone Treatment</button>
            <button class="example-btn" data-example="berkeley">üéì Berkeley Admissions</button>
            <button class="example-btn" data-example="batting">‚öæ Baseball Batting</button>
        </div>

        <div class="toggle-view">
            <button class="toggle-btn active" data-view="aggregate">Aggregate View</button>
            <button class="toggle-btn" data-view="subgroups">Subgroup View</button>
        </div>

        <div class="main-grid">
            <div class="panel">
                <h2 id="chartTitle">üìä Success Rates</h2>
                <div class="chart-container">
                    <div class="bar-chart" id="barChart"></div>
                </div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color a"></div>
                        <span id="legendA">Treatment A</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color b"></div>
                        <span id="legendB">Treatment B</span>
                    </div>
                </div>
                <div class="winner-indicator" id="winner"></div>
            </div>

            <div class="panel">
                <h2>üìã The Data</h2>
                <table class="data-table" id="dataTable">
                    <thead id="tableHead"></thead>
                    <tbody id="tableBody"></tbody>
                </table>

                <div class="confound-reveal" id="confoundBox">
                    <h3>üîç The Lurking Variable</h3>
                    <p id="confoundText"></p>
                </div>
            </div>
        </div>

        <div class="insight-box">
            <h3>üé≠ The Paradox in Action</h3>
            <p id="insightText">
                In the aggregate data, one option appears superior. But when we break down by subgroups, 
                the opposite is true in EVERY category! This isn't a statistical error‚Äîit's a real phenomenon 
                caused by a hidden "confounding variable" that affects which groups get which treatment.
            </p>
        </div>

        <div class="explanation">
            <h2>Why Does This Happen?</h2>

            <p>
                <strong>Simpson's Paradox</strong> occurs when a lurking (confounding) variable creates an 
                imbalance in how data is distributed across groups. The effect disappears‚Äîor reverses‚Äîwhen 
                you control for this variable.
            </p>

            <p>
                In the kidney stone example: <span class="highlight-a">Open surgery</span> was given to the 
                harder cases (large stones), while <span class="highlight-b">percutaneous nephrolithotomy</span> 
                was given to easier cases (small stones). When you compare them fairly within each stone-size 
                category, open surgery wins. But the aggregate unfairly mixes difficult cases with easy ones.
            </p>

            <p>
                In the Berkeley admissions example: Women applied to more competitive departments (like English), 
                while men applied to less competitive departments (like Engineering). Within each department, 
                women were admitted at higher rates! But the aggregate data made it look like discrimination.
            </p>

            <p>
                <strong>The Lesson:</strong> "Correlation does not imply causation." Always look for hidden 
                variables that might explain surprising results. Aggregate statistics can be deeply misleading 
                when groups are not equally represented.
            </p>

            <p style="margin-top: 20px; font-style: italic; color: #7a9ab8;">
                Named after Edward H. Simpson, who described it in 1951 (though Karl Pearson and Udny Yule 
                had noted similar phenomena decades earlier). Also called the Yule-Simpson effect.
            </p>
        </div>
    </div>

    <script>
        // Data for different examples
        const examples = {
            kidney: {
                title: "Kidney Stone Treatment Success Rates",
                legendA: "Open Surgery",
                legendB: "Percutaneous",
                aggregate: {
                    labels: ["Overall"],
                    dataA: [78],
                    dataB: [83],
                    winner: "B"
                },
                subgroups: {
                    labels: ["Small Stones", "Large Stones"],
                    dataA: [93, 73],
                    dataB: [87, 69],
                    winners: ["A", "A"]
                },
                tableHead: ["Category", "Open Surgery", "Percutaneous", "Winner"],
                tableRows: [
                    ["Small Stones (<2cm)", "93/100 = 93%", "87/100 = 87%", "A"],
                    ["Large Stones (‚â•2cm)", "73/100 = 73%", "69/100 = 69%", "A"],
                    ["<strong>Overall</strong>", "<strong>78%</strong>", "<strong>83%</strong>", "<strong>B!</strong>"]
                ],
                confound: "Most patients with small stones got percutaneous treatment (easy cases inflate its average), while most large stone patients got open surgery (hard cases lower its average)."
            },
            berkeley: {
                title: "UC Berkeley Graduate Admissions 1973",
                legendA: "Male Applicants",
                legendB: "Female Applicants",
                aggregate: {
                    labels: ["Overall"],
                    dataA: [44],
                    dataB: [35],
                    winner: "A"
                },
                subgroups: {
                    labels: ["Dept A (Easy)", "Dept B", "Dept E (Hard)", "Dept F (Hard)"],
                    dataA: [62, 63, 28, 6],
                    dataB: [82, 68, 34, 7],
                    winners: ["B", "B", "B", "B"]
                },
                tableHead: ["Department", "Male Admit %", "Female Admit %", "Winner"],
                tableRows: [
                    ["Dept A (Easy)", "62%", "82%", "F"],
                    ["Dept B (Medium)", "63%", "68%", "F"],
                    ["Dept E (Hard)", "28%", "34%", "F"],
                    ["Dept F (Hard)", "6%", "7%", "F"],
                    ["<strong>Overall</strong>", "<strong>44%</strong>", "<strong>35%</strong>", "<strong>M!</strong>"]
                ],
                confound: "Women disproportionately applied to highly competitive departments (E, F) with low acceptance rates, while men applied more to less competitive departments (A, B). Within each department, women had equal or higher admission rates!"
            },
            batting: {
                title: "Baseball Batting Averages",
                legendA: "Player A",
                legendB: "Player B",
                aggregate: {
                    labels: ["Full Season"],
                    dataA: [26],
                    dataB: [27],
                    winner: "B"
                },
                subgroups: {
                    labels: ["First Half", "Second Half"],
                    dataA: [40, 21],
                    dataB: [35, 19],
                    winners: ["A", "A"]
                },
                tableHead: ["Period", "Player A", "Player B", "Winner"],
                tableRows: [
                    ["First Half", "40/100 = .400", "70/200 = .350", "A"],
                    ["Second Half", "160/800 = .200", "20/100 = .190", "A"],
                    ["<strong>Full Season</strong>", "<strong>200/900 = .222</strong>", "<strong>90/300 = .300</strong>", "<strong>B!</strong>"]
                ],
                confound: "Player A got most of his at-bats in the second half (when pitching was tougher), while Player B batted mostly in the easier first half. The unequal distribution of at-bats reverses the comparison."
            }
        };

        let currentExample = 'kidney';
        let currentView = 'aggregate';

        function updateChart() {
            const example = examples[currentExample];
            const data = currentView === 'aggregate' ? example.aggregate : example.subgroups;
            const chart = document.getElementById('barChart');

            chart.innerHTML = '';

            const labels = data.labels;
            const dataA = data.dataA;
            const dataB = data.dataB;
            const maxVal = Math.max(...dataA, ...dataB);

            for (let i = 0; i < labels.length; i++) {
                const group = document.createElement('div');
                group.className = 'bar-group';

                const pair = document.createElement('div');
                pair.className = 'bar-pair';

                // Bar A
                const barA = document.createElement('div');
                barA.className = 'bar treatment-a';
                barA.style.height = '0px';
                const valA = document.createElement('span');
                valA.className = 'bar-value';
                valA.textContent = dataA[i] + '%';
                barA.appendChild(valA);

                // Bar B
                const barB = document.createElement('div');
                barB.className = 'bar treatment-b';
                barB.style.height = '0px';
                const valB = document.createElement('span');
                valB.className = 'bar-value';
                valB.textContent = dataB[i] + '%';
                barB.appendChild(valB);

                pair.appendChild(barA);
                pair.appendChild(barB);

                const label = document.createElement('div');
                label.className = 'bar-label';
                label.textContent = labels[i];

                group.appendChild(pair);
                group.appendChild(label);
                chart.appendChild(group);

                // Animate bars
                setTimeout(() => {
                    barA.style.height = (dataA[i] / 100 * 180) + 'px';
                    barB.style.height = (dataB[i] / 100 * 180) + 'px';
                }, 100);
            }

            // Update winner indicator
            const winner = document.getElementById('winner');
            if (currentView === 'aggregate') {
                if (data.winner === 'A') {
                    winner.className = 'winner-indicator a-wins';
                    winner.innerHTML = `<span style="font-size:2rem">üèÜ</span> ${example.legendA} WINS overall!`;
                } else {
                    winner.className = 'winner-indicator b-wins';
                    winner.innerHTML = `<span style="font-size:2rem">üèÜ</span> ${example.legendB} WINS overall!`;
                }
            } else {
                const allAWins = data.winners.every(w => w === 'A');
                const allBWins = data.winners.every(w => w === 'B');
                if (allAWins) {
                    winner.className = 'winner-indicator a-wins';
                    winner.innerHTML = `<span style="font-size:2rem">üèÜ</span> ${example.legendA} wins EVERY subgroup!`;
                } else if (allBWins) {
                    winner.className = 'winner-indicator b-wins';
                    winner.innerHTML = `<span style="font-size:2rem">üèÜ</span> ${example.legendB} wins EVERY subgroup!`;
                }
            }

            // Update legend
            document.getElementById('legendA').textContent = example.legendA;
            document.getElementById('legendB').textContent = example.legendB;
            document.getElementById('chartTitle').innerHTML = 'üìä ' + example.title;

            // Update table
            const thead = document.getElementById('tableHead');
            const tbody = document.getElementById('tableBody');

            thead.innerHTML = '<tr>' + example.tableHead.map(h => `<th>${h}</th>`).join('') + '</tr>';
            tbody.innerHTML = example.tableRows.map(row => {
                return '<tr>' + row.map((cell, i) => {
                    let cls = '';
                    if (i === row.length - 1) {
                        cls = cell.includes('A') ? 'highlight-a' : 'highlight-b';
                    }
                    return `<td class="${cls}">${cell}</td>`;
                }).join('') + '</tr>';
            }).join('');

            // Update confound
            document.getElementById('confoundText').textContent = example.confound;

            // Update insight
            const insight = document.getElementById('insightText');
            if (currentView === 'aggregate') {
                insight.textContent = `Looking at the aggregate data, ${example.legendB.toLowerCase()} appears to be the better choice. But wait‚Äîtoggle to "Subgroup View" to see what really happens when we control for the lurking variable!`;
            } else {
                insight.textContent = `The paradox revealed! In EVERY subgroup, ${example.legendA.toLowerCase()} outperforms ${example.legendB.toLowerCase()}. Yet the aggregate tells the opposite story. This is Simpson's Paradox in action‚Äîcaused by unequal distribution across groups.`;
            }
        }

        // Event listeners
        document.querySelectorAll('.example-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.example-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentExample = btn.dataset.example;
                updateChart();
            });
        });

        document.querySelectorAll('.toggle-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentView = btn.dataset.view;
                updateChart();
            });
        });

        // Initialize
        updateChart();
    </script>
</body>
</html>
