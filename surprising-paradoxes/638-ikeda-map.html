<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ikeda Map - Chaos from Laser Light</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a0a2a 50%, #0a1a2a 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        .back-link {
            display: inline-flex;
            align-items: center;
            color: #a855f7;
            text-decoration: none;
            margin-bottom: 15px;
            font-size: 0.95em;
        }
        .back-link:hover {
            color: #c084fc;
            text-decoration: underline;
        }
        h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
            color: #fff;
            text-shadow: 0 0 30px rgba(168, 85, 247, 0.5);
        }
        .subtitle {
            color: #c084fc;
            margin-bottom: 20px;
            font-size: 1.05em;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
        }
        .canvas-container {
            background: rgba(0,0,0,0.4);
            border-radius: 12px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        canvas {
            border-radius: 8px;
            background: #050510;
        }
        .info-text {
            margin-top: 10px;
            font-size: 0.8em;
            color: #a855f7;
        }
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .panel {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .panel h3 {
            font-size: 0.9em;
            color: #a855f7;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 500;
            transition: all 0.2s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #a855f7, #7c3aed);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(168, 85, 247, 0.4);
        }
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #e0e0e0;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .btn-secondary:hover {
            background: rgba(255,255,255,0.2);
        }
        .param-group {
            margin-bottom: 12px;
        }
        .param-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .param-name {
            color: #c084fc;
            font-size: 0.85em;
        }
        .param-value {
            color: #d8b4fe;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.9em;
        }
        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255,255,255,0.1);
            -webkit-appearance: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #a855f7;
            cursor: pointer;
        }
        .equations {
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 6px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.75em;
            line-height: 1.6;
            color: #d8b4fe;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .stat-label {
            color: #c084fc;
            font-size: 0.8em;
        }
        .stat-value {
            color: #d8b4fe;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.8em;
        }
        .presets {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 6px;
        }
        .preset-btn {
            padding: 6px;
            font-size: 0.7em;
        }
        .exp-section {
            margin-top: 20px;
        }
        .exp-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }
        .exp-card {
            background: linear-gradient(135deg, rgba(168,85,247,0.1), rgba(124,58,237,0.05));
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(168,85,247,0.2);
        }
        .exp-card h4 {
            color: #a855f7;
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        .exp-card p {
            font-size: 0.85em;
            line-height: 1.6;
            color: #c084fc;
        }
        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">← Back to Paradoxes</a>
        <h1>The Ikeda Map</h1>
        <p class="subtitle">Chaos from Light Bouncing in a Laser Cavity</p>

        <div class="main-content">
            <div class="canvas-container">
                <canvas id="mainCanvas" width="650" height="600"></canvas>
                <p class="info-text">From 20,000 starting points iterating to chaos</p>
            </div>

            <div class="sidebar">
                <div class="panel">
                    <h3>Controls</h3>
                    <div class="controls">
                        <button class="btn btn-primary" id="runBtn">Generate</button>
                        <button class="btn btn-secondary" id="animateBtn">Animate u</button>
                        <button class="btn btn-secondary" id="clearBtn">Clear</button>
                    </div>
                </div>

                <div class="panel">
                    <h3>Parameters</h3>
                    <div class="param-group">
                        <div class="param-label">
                            <span class="param-name">u (dissipation)</span>
                            <span class="param-value" id="uValue">0.90</span>
                        </div>
                        <input type="range" id="uSlider" min="0.5" max="1.0" step="0.01" value="0.90">
                    </div>
                    <div class="param-group">
                        <div class="param-label">
                            <span class="param-name">κ (coupling)</span>
                            <span class="param-value" id="kValue">0.40</span>
                        </div>
                        <input type="range" id="kSlider" min="0.1" max="0.8" step="0.01" value="0.40">
                    </div>
                </div>

                <div class="panel">
                    <h3>Presets</h3>
                    <div class="presets">
                        <button class="btn btn-secondary preset-btn" data-u="0.90" data-k="0.40">Classic (u=0.9)</button>
                        <button class="btn btn-secondary preset-btn" data-u="0.70" data-k="0.40">Mild (u=0.7)</button>
                        <button class="btn btn-secondary preset-btn" data-u="0.95" data-k="0.40">Strong (u=0.95)</button>
                        <button class="btn btn-secondary preset-btn" data-u="0.85" data-k="0.60">Alt κ (0.6)</button>
                    </div>
                </div>

                <div class="panel">
                    <h3>The Map</h3>
                    <div class="equations">
                        t = κ − 6/(1 + x² + y²)<br>
                        x' = 1 + u(x·cos(t) − y·sin(t))<br>
                        y' = u(x·sin(t) + y·cos(t))
                    </div>
                    <p style="font-size: 0.7em; color: #94a3b8; margin-top: 8px;">
                        Rotation by angle t, then scaling by u, plus offset.
                    </p>
                </div>

                <div class="panel">
                    <h3>Statistics</h3>
                    <div class="stat-row">
                        <span class="stat-label">Points</span>
                        <span id="pointCount" class="stat-value">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Iterations</span>
                        <span id="iterCount" class="stat-value">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Behavior</span>
                        <span id="behavior" class="stat-value">-</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="exp-section">
            <div class="exp-cards">
                <div class="exp-card">
                    <h4>Kensuke Ikeda (1979)</h4>
                    <p>Japanese physicist Kensuke Ikeda created this map to model light bouncing inside a ring cavity with a nonlinear optical medium. The light's electric field evolves chaotically—intensity unpredictably varies despite deterministic equations! This was one of the first demonstrations of optical chaos.</p>
                </div>
                <div class="exp-card">
                    <h4>Stretch and Fold</h4>
                    <p>Like all chaotic maps, the Ikeda map "stretches" (by rotation and scaling) and "folds" (through the nonlinear term). Nearby points separate exponentially—sensitivity to initial conditions. The folding keeps the attractor bounded despite stretching!</p>
                </div>
                <div class="exp-card">
                    <h4>Parameter u Controls Chaos</h4>
                    <p>When u &lt; 0.6: stable fixed point. As u increases: period-doubling bifurcations. Near u = 0.9: full chaos with fractal strange attractor. The parameter u represents energy dissipation in the optical resonator—more dissipation = less chaos!</p>
                </div>
                <div class="exp-card">
                    <h4>Shrimp Structures</h4>
                    <p>Recent research (2024) reveals "shrimp-shaped" regions in parameter space—islands of stability within chaos. These self-similar structures appear at multiple scales, showing the intricate boundary between order and chaos in this seemingly simple system!</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');

        let u = 0.90;
        let kappa = 0.40;
        let animating = false;
        let animationId = null;

        // Ikeda map iteration
        function ikedaStep(x, y) {
            const t = kappa - 6.0 / (1 + x * x + y * y);
            const sinT = Math.sin(t);
            const cosT = Math.cos(t);

            const xNew = 1 + u * (x * cosT - y * sinT);
            const yNew = u * (x * sinT + y * cosT);

            return { x: xNew, y: yNew };
        }

        function generate() {
            const w = canvas.width;
            const h = canvas.height;

            ctx.fillStyle = '#050510';
            ctx.fillRect(0, 0, w, h);

            const numPoints = 20000;
            const iterations = 200;
            const burnIn = 100;

            // Coordinate transform
            const scale = 100;
            const offsetX = w / 2;
            const offsetY = h / 2;

            // Create image data for efficiency
            const imageData = ctx.getImageData(0, 0, w, h);
            const data = imageData.data;

            let pointsDrawn = 0;

            for (let p = 0; p < numPoints; p++) {
                // Random starting point
                let x = (Math.random() - 0.5) * 4;
                let y = (Math.random() - 0.5) * 4;

                // Burn-in iterations to reach attractor
                for (let i = 0; i < burnIn; i++) {
                    const next = ikedaStep(x, y);
                    x = next.x;
                    y = next.y;

                    // Check for divergence
                    if (Math.abs(x) > 100 || Math.abs(y) > 100) break;
                }

                // Plot iterations on attractor
                for (let i = 0; i < iterations - burnIn; i++) {
                    const next = ikedaStep(x, y);
                    x = next.x;
                    y = next.y;

                    if (Math.abs(x) > 100 || Math.abs(y) > 100) break;

                    // Transform to canvas coordinates
                    const px = Math.floor(offsetX + x * scale);
                    const py = Math.floor(offsetY - y * scale);

                    if (px >= 0 && px < w && py >= 0 && py < h) {
                        const idx = (py * w + px) * 4;
                        // Accumulate color (purple-ish)
                        data[idx] = Math.min(255, data[idx] + 3);     // R
                        data[idx + 1] = Math.min(255, data[idx + 1] + 1); // G
                        data[idx + 2] = Math.min(255, data[idx + 2] + 4); // B
                        data[idx + 3] = 255; // A
                        pointsDrawn++;
                    }
                }
            }

            ctx.putImageData(imageData, 0, 0);

            // Update stats
            document.getElementById('pointCount').textContent = numPoints.toLocaleString();
            document.getElementById('iterCount').textContent = iterations;

            // Determine behavior
            let behavior = 'Unknown';
            if (u < 0.6) behavior = 'Fixed point';
            else if (u < 0.8) behavior = 'Periodic';
            else behavior = 'Chaotic';
            document.getElementById('behavior').textContent = behavior;
        }

        function animateU() {
            if (!animating) return;

            u += 0.01;
            if (u > 1.0) u = 0.5;

            document.getElementById('uSlider').value = u;
            document.getElementById('uValue').textContent = u.toFixed(2);
            generate();

            animationId = setTimeout(() => requestAnimationFrame(animateU), 150);
        }

        // Event handlers
        document.getElementById('uSlider').addEventListener('input', (e) => {
            u = parseFloat(e.target.value);
            document.getElementById('uValue').textContent = u.toFixed(2);
        });

        document.getElementById('kSlider').addEventListener('input', (e) => {
            kappa = parseFloat(e.target.value);
            document.getElementById('kValue').textContent = kappa.toFixed(2);
        });

        document.getElementById('runBtn').addEventListener('click', generate);

        document.getElementById('clearBtn').addEventListener('click', () => {
            ctx.fillStyle = '#050510';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        });

        document.getElementById('animateBtn').addEventListener('click', () => {
            if (animating) {
                animating = false;
                clearTimeout(animationId);
                document.getElementById('animateBtn').textContent = 'Animate u';
            } else {
                animating = true;
                document.getElementById('animateBtn').textContent = 'Stop';
                animateU();
            }
        });

        document.querySelectorAll('.preset-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                u = parseFloat(btn.dataset.u);
                kappa = parseFloat(btn.dataset.k);
                document.getElementById('uSlider').value = u;
                document.getElementById('kSlider').value = kappa;
                document.getElementById('uValue').textContent = u.toFixed(2);
                document.getElementById('kValue').textContent = kappa.toFixed(2);
                generate();
            });
        });

        // Initial generation
        generate();
    </script>
</body>
</html>
