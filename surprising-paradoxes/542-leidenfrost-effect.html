<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Leidenfrost Effect - Dancing Water on Fire</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1a0500 0%, #2a1000 50%, #1a0a00 100%);
            min-height: 100vh;
            color: #f8e8e0;
            line-height: 1.9;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 12px 24px;
            background: rgba(255,150,50,0.15);
            backdrop-filter: blur(10px);
            color: #ffaa44;
            text-decoration: none;
            border-radius: 30px;
            font-size: 14px;
            z-index: 1000;
            transition: all 0.3s;
            border: 1px solid rgba(255,150,50,0.3);
        }

        .back-link:hover {
            background: rgba(255,150,50,0.3);
            transform: translateX(-5px);
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 80px 30px 60px;
        }

        header {
            text-align: center;
            margin-bottom: 60px;
        }

        h1 {
            font-size: 3.2rem;
            font-weight: 400;
            background: linear-gradient(135deg, #ff6600, #ffcc00, #ff8800);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            letter-spacing: 1px;
        }

        .subtitle {
            font-size: 1.5rem;
            color: #cc9966;
            font-style: italic;
        }

        .year-badge {
            display: inline-block;
            background: rgba(255,150,50,0.2);
            color: #ffaa44;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-top: 15px;
        }

        .paradox-statement {
            background: linear-gradient(135deg, rgba(255,100,0,0.15) 0%, rgba(255,200,0,0.1) 100%);
            border-left: 4px solid #ff6600;
            padding: 35px 45px;
            margin: 50px 0;
            border-radius: 0 20px 20px 0;
            font-size: 1.35rem;
            text-align: center;
            color: #e8d0c0;
        }

        .paradox-statement strong {
            color: #ffcc00;
        }

        h2 {
            font-size: 1.9rem;
            color: #ff8800;
            margin: 60px 0 30px;
            font-weight: 400;
            border-bottom: 1px solid rgba(255,136,0,0.2);
            padding-bottom: 15px;
        }

        h3 {
            font-size: 1.4rem;
            color: #ffaa44;
            margin: 40px 0 20px;
            font-weight: 400;
        }

        p {
            margin-bottom: 22px;
            color: #d8c0b0;
            font-size: 1.1rem;
        }

        .highlight {
            color: #ffcc00;
            font-weight: 500;
        }

        .simulation-container {
            background: rgba(30,15,5,0.8);
            border-radius: 20px;
            padding: 35px;
            margin: 50px 0;
            border: 1px solid rgba(255,136,0,0.2);
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .sim-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .sim-title {
            font-size: 1.3rem;
            color: #ff8800;
        }

        .controls {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-group label {
            font-size: 12px;
            color: #cc9966;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        input[type="range"] {
            width: 180px;
            height: 8px;
            -webkit-appearance: none;
            background: linear-gradient(90deg, #4488ff, #88ff88, #ffff44, #ff8844, #ff4444);
            border-radius: 4px;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #ffcc00;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 15px rgba(255,200,0,0.5);
        }

        button {
            background: rgba(255,136,0,0.2);
            border: 1px solid rgba(255,136,0,0.5);
            color: #ff8800;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            font-family: inherit;
        }

        button:hover {
            background: rgba(255,136,0,0.4);
            transform: translateY(-2px);
        }

        button.active {
            background: linear-gradient(135deg, #ff6600, #ffaa00);
            color: #1a0500;
            font-weight: 600;
        }

        canvas {
            width: 100%;
            border-radius: 12px;
            background: linear-gradient(180deg, #0a0500 0%, #1a0a00 100%);
        }

        .temp-display {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
        }

        .temp-value {
            font-size: 3rem;
            font-family: 'Courier New', monospace;
            font-weight: 300;
        }

        .temp-label {
            font-size: 1rem;
            color: #cc9966;
            margin-top: 8px;
        }

        .stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 20px;
            margin-top: 25px;
            padding-top: 25px;
            border-top: 1px solid rgba(255,136,0,0.2);
        }

        .stat {
            text-align: center;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
        }

        .stat-value {
            font-size: 1.6rem;
            font-weight: 300;
            color: #ffaa44;
            font-family: 'Courier New', monospace;
        }

        .stat-label {
            font-size: 11px;
            color: #cc9966;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 5px;
        }

        .curve-container {
            background: rgba(0,0,0,0.4);
            border-radius: 15px;
            padding: 20px;
            margin-top: 25px;
        }

        .curve-title {
            color: #ffaa44;
            font-size: 0.9rem;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .insight-box {
            background: linear-gradient(135deg, rgba(68,136,255,0.1) 0%, rgba(68,200,255,0.1) 100%);
            border-left: 4px solid #4488ff;
            padding: 25px 30px;
            margin: 40px 0;
            border-radius: 0 15px 15px 0;
        }

        .insight-box strong {
            color: #4488ff;
        }

        .warning-box {
            background: linear-gradient(135deg, rgba(255,100,50,0.15) 0%, rgba(255,200,50,0.1) 100%);
            border-left: 4px solid #ff6600;
            padding: 25px 30px;
            margin: 40px 0;
            border-radius: 0 15px 15px 0;
        }

        .warning-box strong {
            color: #ff6600;
        }

        .phase-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .phase-card {
            background: rgba(0,0,0,0.3);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid rgba(255,136,0,0.15);
            text-align: center;
            transition: all 0.3s;
        }

        .phase-card:hover {
            transform: translateY(-5px);
            border-color: rgba(255,200,0,0.4);
        }

        .phase-card h4 {
            color: #ff8800;
            margin-bottom: 10px;
            font-weight: 400;
        }

        .phase-card .temp-range {
            font-size: 1.3rem;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
        }

        .phase-card p {
            font-size: 0.9rem;
            color: #b09080;
            margin: 0;
        }

        .applications-list {
            list-style: none;
            margin: 20px 0;
        }

        .applications-list li {
            padding: 15px 20px;
            margin: 10px 0;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            border-left: 3px solid #ff8800;
            color: #d8c0b0;
        }

        .applications-list li strong {
            color: #ffaa44;
        }

        footer {
            text-align: center;
            margin-top: 80px;
            padding: 40px 0;
            border-top: 1px solid rgba(255,136,0,0.2);
            color: #6a5848;
            font-size: 0.9rem;
        }

        footer a {
            color: #ff8800;
            text-decoration: none;
        }

        @media (max-width: 768px) {
            h1 { font-size: 2.2rem; }
            .container { padding: 60px 20px 40px; }
            .simulation-container { padding: 20px; }
            input[type="range"] { width: 140px; }
            .temp-value { font-size: 2.2rem; }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Paradoxes</a>

    <div class="container">
        <header>
            <h1>The Leidenfrost Effect</h1>
            <p class="subtitle">When water dances on fire instead of boiling</p>
            <div class="year-badge">Discovered 1756 by Johann Gottlob Leidenfrost</div>
        </header>

        <div class="paradox-statement">
            <strong>The Paradox:</strong> Drop water on a <strong>very hot</strong> surface and it
            doesn't instantly vaporize—it <strong>hovers and dances</strong>, surviving far longer
            than on a merely hot surface. Hotter can mean <strong>slower evaporation</strong>.
        </div>

        <h2>The Kitchen Experiment</h2>

        <p>
            Heat a pan to 150°C (300°F) and drop water on it. The water sizzles violently and
            evaporates in seconds. Now heat that same pan to 250°C (480°F)—well above boiling—and
            try again.
        </p>

        <p>
            <span class="highlight">The water forms a perfect sphere and glides across the surface
            like a hovercraft, lasting for minutes instead of seconds.</span>
        </p>

        <p>
            This is the Leidenfrost effect: at extreme temperatures, the water droplet floats on
            a cushion of its own vapor, insulated from the scorching surface below.
        </p>

        <h2>Watch It Happen</h2>

        <div class="simulation-container">
            <div class="sim-header">
                <div class="sim-title">Leidenfrost Droplet Simulator</div>
                <div class="controls">
                    <div class="control-group">
                        <label>Surface Temperature</label>
                        <input type="range" id="tempSlider" min="0" max="100" value="30">
                    </div>
                    <button id="dropBtn">Drop Water</button>
                </div>
            </div>

            <div class="temp-display">
                <div class="temp-value" id="tempValue">150°C</div>
                <div class="temp-label" id="tempDesc">Contact Boiling - Rapid Evaporation</div>
            </div>

            <canvas id="mainCanvas" height="350"></canvas>

            <div class="stats-panel">
                <div class="stat">
                    <div class="stat-value" id="survivalTime">—</div>
                    <div class="stat-label">Survival Time</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="vaporGap">—</div>
                    <div class="stat-label">Vapor Gap</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="dropletSize">—</div>
                    <div class="stat-label">Droplet Size</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="regime">—</div>
                    <div class="stat-label">Boiling Regime</div>
                </div>
            </div>

            <div class="curve-container">
                <div class="curve-title">Droplet Survival Time vs. Temperature</div>
                <canvas id="curveCanvas" height="150"></canvas>
            </div>
        </div>

        <h2>The Three Regimes</h2>

        <div class="phase-grid">
            <div class="phase-card">
                <h4>Nucleate Boiling</h4>
                <div class="temp-range" style="color: #88ff88;">100-200°C</div>
                <p>Bubbles form at contact points. Vigorous boiling. Fast evaporation.</p>
            </div>
            <div class="phase-card">
                <h4>Transition Zone</h4>
                <div class="temp-range" style="color: #ffff44;">200-230°C</div>
                <p>Unstable. Partial vapor film forms and collapses. Chaotic behavior.</p>
            </div>
            <div class="phase-card">
                <h4>Leidenfrost Regime</h4>
                <div class="temp-range" style="color: #ff6644;">230°C+</div>
                <p>Stable vapor cushion. Droplet hovers. Slow, peaceful evaporation.</p>
            </div>
        </div>

        <h2>How Does It Work?</h2>

        <p>
            When a water droplet contacts an extremely hot surface, the bottom layer instantly
            vaporizes. But instead of the whole droplet evaporating, something remarkable happens:
            the vapor has nowhere to go. It forms a thin cushion—about 0.1mm thick—that
            <span class="highlight">lifts the remaining liquid off the surface</span>.
        </p>

        <div class="insight-box">
            <p><strong>The Key Insight:</strong> The vapor layer is an excellent insulator. Heat
            can't efficiently transfer through gas, so the droplet is protected from the extreme
            temperature below. The bottom evaporates slowly, replenishing the cushion, while the
            top remains relatively cool liquid water.</p>
        </div>

        <p>
            The pressure of the escaping vapor exactly balances the weight of the droplet,
            creating a stable hover. The droplet can even self-propel across the surface,
            riding asymmetric vapor jets like a tiny hovercraft.
        </p>

        <h3>The Survival Time Paradox</h3>

        <p>
            Here's the truly counterintuitive part. You'd expect hotter surfaces to evaporate
            water faster. But look at the survival curve:
        </p>

        <div class="warning-box">
            <p><strong>At 168°C:</strong> A droplet evaporates almost instantly.</p>
            <p><strong>At 202°C:</strong> The same droplet survives for <strong>152 seconds</strong>!</p>
            <p>The hotter surface keeps the water alive 100x longer because it triggers the
            protective Leidenfrost regime.</p>
        </div>

        <h2>The Leidenfrost Point</h2>

        <p>
            The critical temperature where the vapor cushion becomes stable is called the
            <span class="highlight">Leidenfrost point</span>. For water on most metal surfaces,
            it's around 200-230°C—about twice the boiling point.
        </p>

        <p>
            Below this temperature, the vapor film keeps collapsing, allowing direct liquid-surface
            contact. Above it, the film is stable and the droplet floats serenely.
        </p>

        <h2>Recent Discovery: Trampolining Droplets</h2>

        <p>
            In 2021, researchers discovered something even stranger. Leidenfrost droplets don't
            just hover—they can spontaneously start <span class="highlight">bouncing</span>,
            going higher and higher like they're on a trampoline.
        </p>

        <p>
            The mechanism: ripples form on the droplet's bottom surface. At the peaks, the liquid
            is closer to the hot surface, evaporating faster and creating pressure bursts. These
            oscillations synchronize, pumping the droplet upward with each cycle.
        </p>

        <h2>Real-World Applications</h2>

        <ul class="applications-list">
            <li><strong>Nuclear Reactor Safety:</strong> Understanding when cooling water will
            form insulating vapor layers is critical for preventing meltdowns.</li>
            <li><strong>Spray Cooling:</strong> Industrial processes must account for reduced
            heat transfer in the Leidenfrost regime.</li>
            <li><strong>Self-Propelled Drops:</strong> Researchers have created ratcheted surfaces
            that direct Leidenfrost droplets, enabling frictionless liquid transport.</li>
            <li><strong>Leidenfrost Heat Engines:</strong> Prototype engines use the near-zero
            friction of hovering droplets to generate power.</li>
            <li><strong>Hand in Molten Lead:</strong> (Don't try this!) The effect explains how
            people briefly dip wet hands into molten metal without injury—the water's vapor
            provides momentary protection.</li>
        </ul>

        <h2>The Deeper Physics</h2>

        <p>
            The Leidenfrost effect beautifully demonstrates how <span class="highlight">phase
            transitions create emergent behavior</span>. A simple system—water on hot metal—produces
            levitation, self-propulsion, and trampolining through nothing but evaporation physics.
        </p>

        <p>
            It also shows that "more extreme" doesn't always mean "more intense." The hottest
            surfaces are gentlest to the droplet because they trigger a protective mechanism.
            Nature's self-regulation at work.
        </p>

        <div class="paradox-statement">
            "Sometimes the most extreme conditions create the most delicate dance."
        </div>

        <footer>
            <p>Part of the <a href="../index.html">CCAB</a> Surprising Paradoxes collection</p>
            <p>Sources: <a href="https://en.wikipedia.org/wiki/Leidenfrost_effect">Wikipedia</a> ·
            <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC7979863/">Nature: Trampolining Droplets</a> ·
            <a href="https://news.vt.edu/articles/2024/05/eng-me-cheng-leidenfrost-limits-nature-physics.html">Virginia Tech Research</a></p>
        </footer>
    </div>

    <script>
        const mainCanvas = document.getElementById('mainCanvas');
        const mainCtx = mainCanvas.getContext('2d');
        const curveCanvas = document.getElementById('curveCanvas');
        const curveCtx = curveCanvas.getContext('2d');

        // High DPI support
        function setupCanvas(canvas, ctx) {
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            canvas.style.width = rect.width + 'px';
            canvas.style.height = rect.height + 'px';
        }

        // State
        let temperature = 150; // Celsius
        let droplets = [];
        let particles = [];
        let time = 0;

        // Temperature regimes
        function getRegime(temp) {
            if (temp < 100) return { name: 'Below Boiling', color: '#4488ff', survivalMult: 0.5 };
            if (temp < 200) return { name: 'Nucleate', color: '#88ff88', survivalMult: 0.1 };
            if (temp < 230) return { name: 'Transition', color: '#ffff44', survivalMult: 0.3 };
            return { name: 'Leidenfrost', color: '#ff6644', survivalMult: 1.0 };
        }

        // Survival time curve (peaks in Leidenfrost regime)
        function getSurvivalTime(temp) {
            if (temp < 100) return 300; // Just sits there
            if (temp < 150) return 50 - (temp - 100) * 0.8; // Decreases
            if (temp < 200) return 10 - (temp - 150) * 0.1; // Minimum around 180-200
            if (temp < 230) return 5 + (temp - 200) * 2; // Starts increasing
            // Leidenfrost regime - much longer
            return 60 + (temp - 230) * 0.5;
        }

        // Vapor gap in Leidenfrost regime
        function getVaporGap(temp) {
            if (temp < 220) return 0;
            return Math.min(0.2, (temp - 220) * 0.01);
        }

        class Droplet {
            constructor(x, y, radius) {
                this.x = x;
                this.y = y;
                this.radius = radius;
                this.initialRadius = radius;
                this.vy = 0;
                this.vx = (Math.random() - 0.5) * 0.5;
                this.age = 0;
                this.maxAge = getSurvivalTime(temperature) * 60;
                this.hovering = temperature >= 220;
                this.hoverHeight = getVaporGap(temperature) * 100;
                this.bouncePhase = Math.random() * Math.PI * 2;
                this.wobble = 0;
            }

            update(surfaceY) {
                this.age++;

                // Evaporation
                const evapRate = this.hovering ? 0.02 : 0.1;
                this.radius -= evapRate;

                if (this.radius <= 0) return false;

                // Physics
                if (this.hovering) {
                    // Leidenfrost hovering
                    const targetY = surfaceY - this.radius - this.hoverHeight;
                    this.y += (targetY - this.y) * 0.1;

                    // Trampolining effect at high temps
                    if (temperature > 280) {
                        this.bouncePhase += 0.1;
                        this.y -= Math.sin(this.bouncePhase) * 3;
                    }

                    // Drift
                    this.x += this.vx;
                    this.vx += (Math.random() - 0.5) * 0.1;
                    this.vx *= 0.99;

                    // Wobble
                    this.wobble = Math.sin(this.age * 0.1) * 0.1;
                } else {
                    // Normal boiling - stays on surface with violent motion
                    this.vy += 0.5;
                    this.y += this.vy;

                    if (this.y > surfaceY - this.radius) {
                        this.y = surfaceY - this.radius;
                        this.vy = -this.vy * 0.3;

                        // Spawn steam particles
                        for (let i = 0; i < 5; i++) {
                            particles.push(new Particle(this.x, this.y, temperature));
                        }
                    }

                    // Random jitter from boiling
                    this.x += (Math.random() - 0.5) * 2;
                }

                return true;
            }

            draw(ctx) {
                const regime = getRegime(temperature);

                // Vapor cushion glow (Leidenfrost only)
                if (this.hovering) {
                    const gradient = ctx.createRadialGradient(
                        this.x, this.y + this.radius,
                        0,
                        this.x, this.y + this.radius,
                        this.hoverHeight + 10
                    );
                    gradient.addColorStop(0, 'rgba(255, 200, 100, 0.3)');
                    gradient.addColorStop(1, 'rgba(255, 100, 50, 0)');
                    ctx.fillStyle = gradient;
                    ctx.fillRect(this.x - 30, this.y + this.radius - 5, 60, this.hoverHeight + 15);
                }

                // Droplet
                ctx.save();
                ctx.translate(this.x, this.y);

                // Slight deformation
                const scaleX = 1 + this.wobble;
                const scaleY = 1 - this.wobble;
                ctx.scale(scaleX, scaleY);

                // Water gradient
                const dropGradient = ctx.createRadialGradient(
                    -this.radius * 0.3, -this.radius * 0.3,
                    0,
                    0, 0,
                    this.radius
                );
                dropGradient.addColorStop(0, 'rgba(200, 230, 255, 0.9)');
                dropGradient.addColorStop(0.5, 'rgba(100, 180, 255, 0.8)');
                dropGradient.addColorStop(1, 'rgba(50, 120, 200, 0.7)');

                ctx.fillStyle = dropGradient;
                ctx.beginPath();
                ctx.arc(0, 0, this.radius, 0, Math.PI * 2);
                ctx.fill();

                // Highlight
                ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';
                ctx.beginPath();
                ctx.arc(-this.radius * 0.3, -this.radius * 0.3, this.radius * 0.3, 0, Math.PI * 2);
                ctx.fill();

                ctx.restore();
            }
        }

        class Particle {
            constructor(x, y, temp) {
                this.x = x + (Math.random() - 0.5) * 20;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 2;
                this.vy = -Math.random() * 3 - 1;
                this.life = 1;
                this.decay = 0.02 + Math.random() * 0.02;
                this.size = 2 + Math.random() * 3;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vy -= 0.05; // Rise
                this.life -= this.decay;
                return this.life > 0;
            }

            draw(ctx) {
                ctx.fillStyle = `rgba(255, 200, 150, ${this.life * 0.5})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size * this.life, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function drawHotSurface(ctx, w, h) {
            const surfaceY = h * 0.75;
            const regime = getRegime(temperature);

            // Surface glow
            const glowIntensity = Math.min(1, (temperature - 100) / 200);
            const gradient = ctx.createLinearGradient(0, surfaceY, 0, h);

            if (temperature < 150) {
                gradient.addColorStop(0, `rgba(80, 80, 80, 1)`);
                gradient.addColorStop(1, `rgba(40, 40, 40, 1)`);
            } else {
                const r = Math.min(255, 100 + (temperature - 150) * 1.5);
                const g = Math.max(0, 80 - (temperature - 200) * 0.5);
                gradient.addColorStop(0, `rgba(${r}, ${g}, 20, 1)`);
                gradient.addColorStop(0.5, `rgba(${r * 0.7}, ${g * 0.5}, 10, 1)`);
                gradient.addColorStop(1, `rgba(40, 20, 10, 1)`);
            }

            ctx.fillStyle = gradient;
            ctx.fillRect(0, surfaceY, w, h - surfaceY);

            // Heat waves
            if (temperature > 200) {
                ctx.strokeStyle = `rgba(255, 150, 50, ${glowIntensity * 0.2})`;
                ctx.lineWidth = 2;
                for (let i = 0; i < 5; i++) {
                    const waveY = surfaceY - 10 - i * 15 + Math.sin(time * 0.05 + i) * 3;
                    ctx.beginPath();
                    ctx.moveTo(0, waveY);
                    for (let x = 0; x < w; x += 10) {
                        ctx.lineTo(x, waveY + Math.sin(x * 0.02 + time * 0.1 + i) * 3);
                    }
                    ctx.stroke();
                }
            }

            return surfaceY;
        }

        function animate() {
            const w = mainCanvas.getBoundingClientRect().width;
            const h = mainCanvas.getBoundingClientRect().height;

            time++;

            // Clear
            mainCtx.fillStyle = '#0a0500';
            mainCtx.fillRect(0, 0, w, h);

            // Draw hot surface
            const surfaceY = drawHotSurface(mainCtx, w, h);

            // Update and draw particles
            particles = particles.filter(p => p.update());
            particles.forEach(p => p.draw(mainCtx));

            // Update and draw droplets
            droplets = droplets.filter(d => d.update(surfaceY));
            droplets.forEach(d => d.draw(mainCtx));

            // Update stats
            updateStats();

            // Draw curve
            drawSurvivalCurve();

            requestAnimationFrame(animate);
        }

        function updateStats() {
            const regime = getRegime(temperature);
            const survival = getSurvivalTime(temperature);
            const gap = getVaporGap(temperature);

            document.getElementById('survivalTime').textContent =
                survival > 100 ? Math.round(survival) + 's' : survival.toFixed(1) + 's';
            document.getElementById('vaporGap').textContent =
                gap > 0 ? (gap * 1000).toFixed(0) + ' μm' : 'None';
            document.getElementById('dropletSize').textContent =
                droplets.length > 0 ? (droplets[0].radius / droplets[0].initialRadius * 100).toFixed(0) + '%' : '—';
            document.getElementById('regime').textContent = regime.name;
            document.getElementById('regime').style.color = regime.color;
        }

        function drawSurvivalCurve() {
            const w = curveCanvas.getBoundingClientRect().width;
            const h = curveCanvas.getBoundingClientRect().height;

            curveCtx.fillStyle = 'rgba(10, 5, 0, 1)';
            curveCtx.fillRect(0, 0, w, h);

            const padding = 40;
            const graphW = w - padding * 2;
            const graphH = h - padding * 1.5;

            // Axes
            curveCtx.strokeStyle = 'rgba(255, 136, 0, 0.3)';
            curveCtx.lineWidth = 1;
            curveCtx.beginPath();
            curveCtx.moveTo(padding, padding);
            curveCtx.lineTo(padding, h - padding / 2);
            curveCtx.lineTo(w - padding, h - padding / 2);
            curveCtx.stroke();

            // Labels
            curveCtx.fillStyle = '#cc9966';
            curveCtx.font = '10px Courier New';
            curveCtx.fillText('Survival', 5, padding + 10);
            curveCtx.fillText('100°C', padding - 5, h - 5);
            curveCtx.fillText('350°C', w - padding - 20, h - 5);

            // Curve
            curveCtx.strokeStyle = '#ff8800';
            curveCtx.lineWidth = 2;
            curveCtx.beginPath();

            const minTemp = 100;
            const maxTemp = 350;
            const maxSurvival = 150;

            for (let t = minTemp; t <= maxTemp; t += 2) {
                const x = padding + ((t - minTemp) / (maxTemp - minTemp)) * graphW;
                const survival = getSurvivalTime(t);
                const y = h - padding / 2 - (survival / maxSurvival) * graphH;

                if (t === minTemp) curveCtx.moveTo(x, y);
                else curveCtx.lineTo(x, y);
            }
            curveCtx.stroke();

            // Current temperature marker
            const currentX = padding + ((temperature - minTemp) / (maxTemp - minTemp)) * graphW;
            const currentSurvival = getSurvivalTime(temperature);
            const currentY = h - padding / 2 - (currentSurvival / maxSurvival) * graphH;

            curveCtx.fillStyle = '#ffcc00';
            curveCtx.beginPath();
            curveCtx.arc(currentX, currentY, 6, 0, Math.PI * 2);
            curveCtx.fill();

            // Leidenfrost point marker
            const leidenfrostX = padding + ((220 - minTemp) / (maxTemp - minTemp)) * graphW;
            curveCtx.strokeStyle = 'rgba(255, 100, 100, 0.5)';
            curveCtx.setLineDash([4, 4]);
            curveCtx.beginPath();
            curveCtx.moveTo(leidenfrostX, padding);
            curveCtx.lineTo(leidenfrostX, h - padding / 2);
            curveCtx.stroke();
            curveCtx.setLineDash([]);

            curveCtx.fillStyle = '#ff6644';
            curveCtx.font = '9px Courier New';
            curveCtx.fillText('Leidenfrost', leidenfrostX - 25, padding + 12);
        }

        // Event listeners
        document.getElementById('tempSlider').addEventListener('input', (e) => {
            const val = parseFloat(e.target.value);
            temperature = 80 + val * 2.7; // 80-350°C range

            const tempEl = document.getElementById('tempValue');
            const descEl = document.getElementById('tempDesc');

            tempEl.textContent = Math.round(temperature) + '°C';

            const regime = getRegime(temperature);
            if (temperature < 100) {
                descEl.textContent = 'Below Boiling Point';
                tempEl.style.color = '#4488ff';
            } else if (temperature < 200) {
                descEl.textContent = 'Nucleate Boiling - Violent Evaporation';
                tempEl.style.color = '#88ff88';
            } else if (temperature < 230) {
                descEl.textContent = 'Transition Zone - Unstable';
                tempEl.style.color = '#ffff44';
            } else {
                descEl.textContent = 'Leidenfrost Regime - Hovering Droplets!';
                tempEl.style.color = '#ff6644';
            }

            // Update existing droplets
            droplets.forEach(d => {
                d.hovering = temperature >= 220;
                d.hoverHeight = getVaporGap(temperature) * 100;
            });
        });

        document.getElementById('dropBtn').addEventListener('click', () => {
            const w = mainCanvas.getBoundingClientRect().width;
            const h = mainCanvas.getBoundingClientRect().height;

            droplets.push(new Droplet(
                w / 2 + (Math.random() - 0.5) * 100,
                50,
                20 + Math.random() * 10
            ));
        });

        // Initialize
        window.addEventListener('resize', () => {
            setupCanvas(mainCanvas, mainCtx);
            setupCanvas(curveCanvas, curveCtx);
        });

        setupCanvas(mainCanvas, mainCtx);
        setupCanvas(curveCanvas, curveCtx);
        animate();

        // Start with a droplet
        setTimeout(() => {
            document.getElementById('dropBtn').click();
        }, 500);
    </script>
</body>
</html>
