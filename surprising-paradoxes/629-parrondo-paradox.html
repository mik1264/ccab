<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parrondo's Paradox - Two Losing Games That Win</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a0a2e 0%, #2d1b4e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        .back-link {
            display: inline-flex;
            align-items: center;
            color: #c084fc;
            text-decoration: none;
            margin-bottom: 15px;
            font-size: 0.95em;
        }
        .back-link:hover {
            color: #e9d5ff;
            text-decoration: underline;
        }
        h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
            color: #fff;
            text-shadow: 0 0 30px rgba(192, 132, 252, 0.5);
        }
        .subtitle {
            color: #a78bfa;
            margin-bottom: 20px;
            font-size: 1.05em;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
        }
        .canvas-container {
            background: rgba(0,0,0,0.4);
            border-radius: 12px;
            padding: 15px;
        }
        canvas {
            border-radius: 8px;
            background: #0d0416;
            display: block;
            width: 100%;
        }
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .panel {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .panel h3 {
            font-size: 0.9em;
            color: #c084fc;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 500;
            transition: all 0.2s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #c084fc, #9333ea);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(192, 132, 252, 0.4);
        }
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #e0e0e0;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .btn-secondary:hover {
            background: rgba(255,255,255,0.2);
        }
        .btn-secondary.active {
            background: rgba(192, 132, 252, 0.3);
            border-color: #c084fc;
        }
        .pattern-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 10px;
        }
        .pattern-btn {
            padding: 6px;
            font-size: 0.8em;
            font-family: monospace;
        }
        .param-group {
            margin-bottom: 15px;
        }
        .param-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .param-name {
            color: #a78bfa;
            font-size: 0.85em;
        }
        .param-value {
            color: #e9d5ff;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.9em;
        }
        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255,255,255,0.1);
            -webkit-appearance: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #c084fc;
            cursor: pointer;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .stat-label {
            color: #a78bfa;
            font-size: 0.85em;
        }
        .stat-value {
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.9em;
        }
        .losing {
            color: #f87171 !important;
        }
        .winning {
            color: #4ade80 !important;
        }
        .game-rules {
            font-size: 0.8em;
            line-height: 1.6;
            color: #a78bfa;
        }
        .game-rules strong {
            color: #e9d5ff;
        }
        .formula {
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 6px;
            font-family: 'Monaco', 'Consolas', monospace;
            margin: 8px 0;
            text-align: center;
            font-size: 0.85em;
        }
        .legend {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8em;
        }
        .legend-color {
            width: 20px;
            height: 3px;
            border-radius: 2px;
        }
        .exp-section {
            margin-top: 20px;
        }
        .exp-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }
        .exp-card {
            background: linear-gradient(135deg, rgba(192,132,252,0.1), rgba(147,51,234,0.05));
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(192,132,252,0.2);
        }
        .exp-card h4 {
            color: #c084fc;
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        .exp-card p {
            font-size: 0.85em;
            line-height: 1.6;
            color: #a78bfa;
        }
        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">← Back to Paradoxes</a>
        <h1>Parrondo's Paradox</h1>
        <p class="subtitle">Two Losing Games That Combine to Win</p>

        <div class="main-content">
            <div class="canvas-container">
                <canvas id="mainCanvas" width="800" height="500"></canvas>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #f87171;"></div>
                        <span>Game A Only</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #60a5fa;"></div>
                        <span>Game B Only</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #4ade80;"></div>
                        <span>Combined (A+B)</span>
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <div class="panel">
                    <h3>Controls</h3>
                    <div class="controls">
                        <button class="btn btn-primary" id="runBtn">Run 1000</button>
                        <button class="btn btn-secondary" id="resetBtn">Reset</button>
                        <button class="btn btn-secondary" id="animateBtn">Animate</button>
                    </div>
                    <div class="param-group" style="margin-top: 15px;">
                        <div class="param-label">
                            <span class="param-name">Speed</span>
                            <span class="param-value" id="speedValue">10</span>
                        </div>
                        <input type="range" id="speedSlider" min="1" max="50" value="10">
                    </div>
                </div>

                <div class="panel">
                    <h3>Mixing Pattern</h3>
                    <div class="pattern-buttons">
                        <button class="btn btn-secondary pattern-btn" data-pattern="AB">AB</button>
                        <button class="btn btn-secondary pattern-btn active" data-pattern="ABB">ABB</button>
                        <button class="btn btn-secondary pattern-btn" data-pattern="AABB">AABB</button>
                        <button class="btn btn-secondary pattern-btn" data-pattern="ABBB">ABBB</button>
                        <button class="btn btn-secondary pattern-btn" data-pattern="AABBB">AABBB</button>
                        <button class="btn btn-secondary pattern-btn" data-pattern="RANDOM">Random</button>
                    </div>
                </div>

                <div class="panel">
                    <h3>Results (after <span id="rounds">0</span> rounds)</h3>
                    <div class="stat-row">
                        <span class="stat-label">Game A Capital</span>
                        <span id="capitalA" class="stat-value">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Game B Capital</span>
                        <span id="capitalB" class="stat-value">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Combined Capital</span>
                        <span id="capitalC" class="stat-value">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">A Win Rate</span>
                        <span id="winRateA" class="stat-value">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">B Win Rate</span>
                        <span id="winRateB" class="stat-value">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Combined Win Rate</span>
                        <span id="winRateC" class="stat-value">-</span>
                    </div>
                </div>

                <div class="panel">
                    <h3>The Games</h3>
                    <div class="game-rules">
                        <strong>Game A (Biased Coin):</strong><br>
                        Win probability = 49.5%<br>
                        <em class="losing">Always losing!</em>
                        <br><br>
                        <strong>Game B (State-Dependent):</strong><br>
                        If capital mod 3 = 0: win = 9.5%<br>
                        Otherwise: win = 74.5%<br>
                        <em class="losing">Also losing overall!</em>
                    </div>
                </div>
            </div>
        </div>

        <div class="exp-section">
            <div class="exp-cards">
                <div class="exp-card">
                    <h4>Juan Parrondo (1996)</h4>
                    <p>Spanish physicist Juan Parrondo discovered this paradox while studying Brownian ratchets—molecular machines that seem to extract energy from random motion. The paradox shows how breaking symmetry through switching can create order from apparent chaos!</p>
                </div>
                <div class="exp-card">
                    <h4>Why Does It Work?</h4>
                    <p>Game B's state dependency is the key. Game A slowly drifts your capital, but this drift affects which coin you use in Game B. Alternating games keeps you away from the "bad" states in Game B more often than playing B alone would. The games aren't independent—they interact!</p>
                </div>
                <div class="exp-card">
                    <h4>The Brownian Ratchet Connection</h4>
                    <p>Parrondo showed this is equivalent to a "flashing ratchet"—a sawtooth potential that turns on and off. Particles diffuse randomly when off, but get pushed uphill when on. The combination extracts work from thermal noise! (Doesn't violate thermodynamics—energy comes from the switching.)</p>
                </div>
                <div class="exp-card">
                    <h4>Real-World Applications</h4>
                    <p>2025 cancer research shows alternating chemotherapy dosing (high then low) can outperform either strategy alone. In finance, switching between losing strategies at the right time can profit. In ecology, populations can thrive by switching between declining environments!</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');

        // Game parameters
        const pA = 0.495;           // Game A: always slightly unfair
        const pB_bad = 0.095;       // Game B when capital % 3 == 0 (bad)
        const pB_good = 0.745;      // Game B otherwise (good)

        // State
        let capitalA = 0, capitalB = 0, capitalC = 0;
        let historyA = [0], historyB = [0], historyC = [0];
        let winsA = 0, winsB = 0, winsC = 0;
        let roundsPlayed = 0;
        let pattern = 'ABB';
        let patternIndex = 0;
        let animating = false;
        let animationId = null;

        // Play Game A
        function playGameA() {
            return Math.random() < pA;
        }

        // Play Game B (state-dependent)
        function playGameB(capital) {
            const p = (capital % 3 === 0) ? pB_bad : pB_good;
            return Math.random() < p;
        }

        // Get next game from pattern
        function getNextGame() {
            if (pattern === 'RANDOM') {
                return Math.random() < 0.5 ? 'A' : 'B';
            }
            const game = pattern[patternIndex % pattern.length];
            patternIndex++;
            return game;
        }

        function playRound() {
            roundsPlayed++;

            // Play Game A alone
            const winA = playGameA();
            capitalA += winA ? 1 : -1;
            if (winA) winsA++;
            historyA.push(capitalA);

            // Play Game B alone
            const winB = playGameB(capitalB);
            capitalB += winB ? 1 : -1;
            if (winB) winsB++;
            historyB.push(capitalB);

            // Play combined strategy
            const game = getNextGame();
            let winC;
            if (game === 'A') {
                winC = playGameA();
            } else {
                winC = playGameB(capitalC);
            }
            capitalC += winC ? 1 : -1;
            if (winC) winsC++;
            historyC.push(capitalC);

            // Trim history if too long
            const maxHistory = 2000;
            if (historyA.length > maxHistory) {
                historyA = historyA.slice(-maxHistory);
                historyB = historyB.slice(-maxHistory);
                historyC = historyC.slice(-maxHistory);
            }
        }

        function draw() {
            const w = canvas.width;
            const h = canvas.height;
            const padding = 50;

            // Clear
            ctx.fillStyle = '#0d0416';
            ctx.fillRect(0, 0, w, h);

            if (historyA.length < 2) return;

            // Find y range
            const allValues = [...historyA, ...historyB, ...historyC];
            let minY = Math.min(...allValues);
            let maxY = Math.max(...allValues);
            const range = maxY - minY || 1;
            minY -= range * 0.1;
            maxY += range * 0.1;

            // Scale functions
            const scaleX = (i) => padding + (i / (historyA.length - 1)) * (w - 2 * padding);
            const scaleY = (v) => h - padding - ((v - minY) / (maxY - minY)) * (h - 2 * padding);

            // Draw axes
            ctx.strokeStyle = 'rgba(255,255,255,0.2)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, h - padding);
            ctx.lineTo(w - padding, h - padding);
            ctx.stroke();

            // Draw zero line
            if (minY < 0 && maxY > 0) {
                ctx.strokeStyle = 'rgba(255,255,255,0.3)';
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(padding, scaleY(0));
                ctx.lineTo(w - padding, scaleY(0));
                ctx.stroke();
                ctx.setLineDash([]);
            }

            // Draw labels
            ctx.fillStyle = '#a78bfa';
            ctx.font = '11px Monaco, Consolas, monospace';
            ctx.textAlign = 'right';
            ctx.fillText(Math.round(maxY), padding - 5, padding + 5);
            ctx.fillText(Math.round(minY), padding - 5, h - padding);
            ctx.textAlign = 'center';
            ctx.fillText('Rounds', w / 2, h - 10);
            ctx.fillText(historyA.length - 1, w - padding, h - padding + 15);

            // Draw lines
            function drawLine(history, color) {
                ctx.strokeStyle = color;
                ctx.lineWidth = 2;
                ctx.beginPath();
                for (let i = 0; i < history.length; i++) {
                    const x = scaleX(i);
                    const y = scaleY(history[i]);
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.stroke();
            }

            drawLine(historyA, '#f87171');  // Red - Game A
            drawLine(historyB, '#60a5fa');  // Blue - Game B
            drawLine(historyC, '#4ade80');  // Green - Combined

            // Update stats
            document.getElementById('rounds').textContent = roundsPlayed;

            const colorA = capitalA >= 0 ? 'winning' : 'losing';
            const colorB = capitalB >= 0 ? 'winning' : 'losing';
            const colorC = capitalC >= 0 ? 'winning' : 'losing';

            document.getElementById('capitalA').textContent = capitalA;
            document.getElementById('capitalA').className = `stat-value ${colorA}`;
            document.getElementById('capitalB').textContent = capitalB;
            document.getElementById('capitalB').className = `stat-value ${colorB}`;
            document.getElementById('capitalC').textContent = capitalC;
            document.getElementById('capitalC').className = `stat-value ${colorC}`;

            if (roundsPlayed > 0) {
                const rateA = (winsA / roundsPlayed * 100).toFixed(1) + '%';
                const rateB = (winsB / roundsPlayed * 100).toFixed(1) + '%';
                const rateC = (winsC / roundsPlayed * 100).toFixed(1) + '%';
                document.getElementById('winRateA').textContent = rateA;
                document.getElementById('winRateA').className = `stat-value ${winsA / roundsPlayed >= 0.5 ? 'winning' : 'losing'}`;
                document.getElementById('winRateB').textContent = rateB;
                document.getElementById('winRateB').className = `stat-value ${winsB / roundsPlayed >= 0.5 ? 'winning' : 'losing'}`;
                document.getElementById('winRateC').textContent = rateC;
                document.getElementById('winRateC').className = `stat-value ${winsC / roundsPlayed >= 0.5 ? 'winning' : 'losing'}`;
            }
        }

        function runRounds(n) {
            for (let i = 0; i < n; i++) {
                playRound();
            }
            draw();
        }

        function reset() {
            capitalA = capitalB = capitalC = 0;
            winsA = winsB = winsC = 0;
            roundsPlayed = 0;
            patternIndex = 0;
            historyA = [0];
            historyB = [0];
            historyC = [0];
            animating = false;
            if (animationId) cancelAnimationFrame(animationId);
            document.getElementById('animateBtn').textContent = 'Animate';
            draw();
        }

        function animate() {
            if (!animating) return;
            const speed = parseInt(document.getElementById('speedSlider').value);
            runRounds(speed);
            animationId = requestAnimationFrame(animate);
        }

        // Event listeners
        document.getElementById('runBtn').addEventListener('click', () => runRounds(1000));
        document.getElementById('resetBtn').addEventListener('click', reset);

        document.getElementById('animateBtn').addEventListener('click', () => {
            animating = !animating;
            document.getElementById('animateBtn').textContent = animating ? 'Stop' : 'Animate';
            if (animating) animate();
        });

        document.getElementById('speedSlider').addEventListener('input', (e) => {
            document.getElementById('speedValue').textContent = e.target.value;
        });

        document.querySelectorAll('.pattern-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.pattern-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                pattern = btn.dataset.pattern;
                patternIndex = 0;
                reset();
            });
        });

        // Initial draw
        draw();
    </script>
</body>
</html>
