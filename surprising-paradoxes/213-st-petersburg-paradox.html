<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The St. Petersburg Paradox - Infinite Expected Value</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #2d1b4e 0%, #1a1030 50%, #0d0820 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        .back-link {
            display: inline-block;
            color: #b39ddb;
            text-decoration: none;
            margin-bottom: 20px;
            font-size: 0.95rem;
            opacity: 0.8;
            transition: opacity 0.3s;
        }

        .back-link:hover {
            opacity: 1;
        }

        h1 {
            font-size: 2.4rem;
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1rem;
            color: #b39ddb;
            max-width: 750px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .panel {
            background: rgba(50, 30, 80, 0.6);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(179, 157, 219, 0.3);
        }

        .panel h2 {
            color: #ffd700;
            font-size: 1.3rem;
            margin-bottom: 15px;
        }

        .game-area {
            text-align: center;
            padding: 30px;
            background: rgba(30, 15, 50, 0.6);
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .coin {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            transition: transform 0.5s;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
        }

        .coin.heads {
            background: linear-gradient(135deg, #ffd700, #daa520);
        }

        .coin.tails {
            background: linear-gradient(135deg, #c0c0c0, #808080);
        }

        .coin.spinning {
            animation: spin 0.3s linear infinite;
        }

        @keyframes spin {
            from { transform: rotateY(0); }
            to { transform: rotateY(360deg); }
        }

        .flip-count {
            font-size: 1.5rem;
            color: #b39ddb;
            margin: 15px 0;
        }

        .prize-display {
            font-size: 2.5rem;
            font-weight: bold;
            color: #ffd700;
            margin: 20px 0;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .play-btn {
            padding: 15px 40px;
            font-size: 1.2rem;
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            border: none;
            border-radius: 30px;
            color: #1a1030;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
        }

        .play-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
        }

        .play-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .stat-box {
            background: rgba(30, 15, 50, 0.6);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            color: #ffd700;
            font-weight: bold;
        }

        .stat-label {
            color: #b39ddb;
            font-size: 0.85rem;
            margin-top: 5px;
        }

        .history-area {
            max-height: 200px;
            overflow-y: auto;
            background: rgba(30, 15, 50, 0.6);
            border-radius: 10px;
            padding: 15px;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(179, 157, 219, 0.2);
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .expected-value {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 140, 0, 0.1));
            border-radius: 10px;
            margin: 20px 0;
        }

        .infinity {
            font-size: 4rem;
            color: #ffd700;
        }

        .formula {
            font-family: 'Courier New', monospace;
            color: #b39ddb;
            margin: 15px 0;
            font-size: 0.95rem;
        }

        .distribution-chart {
            height: 200px;
            background: rgba(30, 15, 50, 0.6);
            border-radius: 10px;
            padding: 15px;
            position: relative;
            margin-top: 20px;
        }

        .bar-container {
            display: flex;
            align-items: flex-end;
            height: 150px;
            gap: 5px;
            justify-content: center;
        }

        .dist-bar {
            width: 30px;
            background: linear-gradient(180deg, #ffd700, #ff8c00);
            border-radius: 3px 3px 0 0;
            transition: height 0.3s;
            position: relative;
        }

        .dist-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.7rem;
            color: #b39ddb;
            white-space: nowrap;
        }

        .explanation {
            background: rgba(50, 30, 80, 0.4);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
        }

        .explanation h2 {
            color: #ffd700;
            margin-bottom: 15px;
        }

        .explanation p {
            color: #c0b0d8;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .insight-box {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 140, 0, 0.1));
            border-left: 4px solid #ffd700;
            padding: 20px;
            border-radius: 0 10px 10px 0;
            margin: 20px 0;
        }

        .insight-box h3 {
            color: #ffd700;
            margin-bottom: 10px;
        }

        .would-you-pay {
            text-align: center;
            padding: 20px;
            background: rgba(30, 15, 50, 0.6);
            border-radius: 10px;
            margin: 20px 0;
        }

        .pay-slider {
            width: 100%;
            height: 10px;
            margin: 15px 0;
            -webkit-appearance: none;
            background: rgba(179, 157, 219, 0.3);
            border-radius: 5px;
        }

        .pay-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 25px;
            height: 25px;
            background: #ffd700;
            border-radius: 50%;
            cursor: pointer;
        }

        .pay-amount {
            font-size: 2rem;
            color: #ffd700;
            font-weight: bold;
        }

        .simulation-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }

        .sim-btn {
            padding: 10px 20px;
            background: rgba(179, 157, 219, 0.3);
            border: 1px solid rgba(179, 157, 219, 0.5);
            color: #b39ddb;
            border-radius: 20px;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.3s;
        }

        .sim-btn:hover {
            background: rgba(179, 157, 219, 0.5);
        }

        @media (max-width: 900px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-link">‚Üê Back to Surprising Paradoxes</a>
            <h1>The St. Petersburg Paradox</h1>
            <p class="subtitle">A coin-flip game with INFINITE expected value... yet you wouldn't pay $100 to play it. How can infinite be worth so little?</p>
        </header>

        <div class="main-grid">
            <div class="panel">
                <h2>üé∞ Play the Game</h2>
                <div class="game-area">
                    <div class="coin heads" id="coin">üëë</div>
                    <div class="flip-count">Flips: <span id="flipCount">0</span></div>
                    <div class="prize-display">$<span id="prize">0</span></div>
                    <button class="play-btn" id="playBtn">üé≤ Flip the Coin</button>
                </div>

                <div class="game-rules" style="color: #b39ddb; font-size: 0.9rem; line-height: 1.6;">
                    <strong>The Rules:</strong><br>
                    1. Flip a fair coin<br>
                    2. If HEADS: flip again, prize doubles<br>
                    3. If TAILS: game ends, collect your prize<br>
                    4. Prize = $2<sup>n</sup> where n = number of heads
                </div>

                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="gamesPlayed">0</div>
                        <div class="stat-label">Games Played</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">$<span id="totalWon">0</span></div>
                        <div class="stat-label">Total Won</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">$<span id="averageWin">0</span></div>
                        <div class="stat-label">Average Win</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">$<span id="medianWin">2</span></div>
                        <div class="stat-label">Median Win</div>
                    </div>
                </div>
            </div>

            <div class="panel">
                <h2>üìä The Paradox</h2>
                
                <div class="expected-value">
                    <div>Expected Value:</div>
                    <div class="infinity">‚àû</div>
                    <div class="formula">
                        E[X] = ¬Ω√ó$2 + ¬º√ó$4 + ‚Öõ√ó$8 + ...<br>
                        = $1 + $1 + $1 + ... = ‚àû
                    </div>
                </div>

                <div class="would-you-pay">
                    <h3 style="color: #ffd700;">What would YOU pay to play?</h3>
                    <input type="range" class="pay-slider" id="paySlider" min="1" max="1000" value="10">
                    <div class="pay-amount">$<span id="payAmount">10</span></div>
                    <p style="color: #b39ddb; font-size: 0.9rem; margin-top: 10px;">
                        Most people say $10-20. Daniel Bernoulli (1738) called this "fairly reasonable."
                    </p>
                </div>

                <div class="simulation-controls">
                    <button class="sim-btn" id="sim100">Run 100 Games</button>
                    <button class="sim-btn" id="sim1000">Run 1,000 Games</button>
                    <button class="sim-btn" id="sim10000">Run 10,000 Games</button>
                    <button class="sim-btn" id="resetBtn">Reset</button>
                </div>

                <div class="distribution-chart">
                    <div style="color: #b39ddb; font-size: 0.85rem; margin-bottom: 10px;">Outcome Distribution:</div>
                    <div class="bar-container" id="distChart"></div>
                </div>
            </div>
        </div>

        <div class="insight-box">
            <h3>ü§î The Paradox Revealed</h3>
            <p>
                After 1,000 games, your average win will likely be around $10-15‚Äînowhere near infinity!
                The problem: while the expected value is infinite, the MEDIAN outcome is just $2 (one flip, then tails).
                Huge payoffs ($1,000,000+) are theoretically possible but vanishingly rare.
                You'd need to play <strong>2<sup>20</sup> = 1,048,576 games</strong> on average to win $1,000,000 even once!
            </p>
        </div>

        <div class="explanation">
            <h2>Why Does This Happen?</h2>

            <p>
                Nicolas Bernoulli posed this problem in 1713. His cousin <strong>Daniel Bernoulli</strong> 
                solved it in 1738 by proposing that people don't value money linearly‚Äîthey value its 
                <em>utility</em>. Doubling your wealth doesn't double your happiness.
            </p>

            <p>
                <strong>The Utility Solution:</strong> If utility = log(money), then expected utility is finite:
                E[log(prize)] = ¬Ω¬∑log(2) + ¬º¬∑log(4) + ‚Öõ¬∑log(8) + ... ‚âà 1.4 "utils"
                (equivalent to about $4 of certain money for a person with modest wealth).
            </p>

            <p>
                <strong>Other Solutions:</strong>
            </p>
            <ul style="color: #c0b0d8; margin-left: 20px; line-height: 2;">
                <li><strong>Finite wealth:</strong> No casino can pay infinite prizes</li>
                <li><strong>Finite time:</strong> Playing infinitely many games is impossible</li>
                <li><strong>Median vs Mean:</strong> Median outcome ($2) is more "typical" than the mean (‚àû)</li>
                <li><strong>Probability weighting:</strong> People underweight tiny probabilities</li>
            </ul>

            <p style="margin-top: 20px; font-style: italic; color: #9a8ab8;">
                This paradox launched the field of <strong>decision theory</strong> and the concept of 
                <strong>expected utility</strong>. It remains debated 300 years later!
            </p>
        </div>
    </div>

    <script>
        // State
        let gamesPlayed = 0;
        let totalWon = 0;
        let outcomes = [];
        let isPlaying = false;

        // DOM elements
        const coin = document.getElementById('coin');
        const flipCount = document.getElementById('flipCount');
        const prizeDisplay = document.getElementById('prize');
        const playBtn = document.getElementById('playBtn');
        const paySlider = document.getElementById('paySlider');
        const payAmount = document.getElementById('payAmount');

        // Play one game with animation
        async function playGame(animate = true) {
            if (isPlaying) return;
            isPlaying = true;
            playBtn.disabled = true;

            let flips = 0;
            let currentPrize = 1; // Will be doubled on first heads

            if (animate) {
                coin.classList.add('spinning');
            }

            while (true) {
                // Random flip
                const isHeads = Math.random() < 0.5;

                if (animate) {
                    await new Promise(r => setTimeout(r, 300));
                    coin.classList.remove('spinning');

                    if (isHeads) {
                        coin.className = 'coin heads';
                        coin.textContent = 'üëë';
                    } else {
                        coin.className = 'coin tails';
                        coin.textContent = 'ü™ô';
                    }

                    await new Promise(r => setTimeout(r, 200));
                }

                if (isHeads) {
                    flips++;
                    currentPrize *= 2;
                    if (animate) {
                        flipCount.textContent = flips;
                        prizeDisplay.textContent = currentPrize;
                        coin.classList.add('spinning');
                    }
                } else {
                    // Tails - game over
                    if (flips === 0) currentPrize = 2; // First flip tails = $2
                    break;
                }
            }

            if (animate) {
                flipCount.textContent = flips;
                prizeDisplay.textContent = currentPrize;
            }

            // Record result
            gamesPlayed++;
            totalWon += currentPrize;
            outcomes.push(currentPrize);

            updateStats();
            isPlaying = false;
            playBtn.disabled = false;

            return currentPrize;
        }

        // Run simulation (no animation)
        async function runSimulation(n) {
            playBtn.disabled = true;
            document.querySelectorAll('.sim-btn').forEach(b => b.disabled = true);

            for (let i = 0; i < n; i++) {
                let flips = 0;
                let prize = 1;

                while (Math.random() < 0.5) {
                    flips++;
                    prize *= 2;
                }

                if (flips === 0) prize = 2;

                gamesPlayed++;
                totalWon += prize;
                outcomes.push(prize);
            }

            updateStats();
            playBtn.disabled = false;
            document.querySelectorAll('.sim-btn').forEach(b => b.disabled = false);
        }

        // Update statistics display
        function updateStats() {
            document.getElementById('gamesPlayed').textContent = gamesPlayed.toLocaleString();
            document.getElementById('totalWon').textContent = totalWon.toLocaleString();

            if (gamesPlayed > 0) {
                document.getElementById('averageWin').textContent = (totalWon / gamesPlayed).toFixed(2);

                // Calculate median
                const sorted = [...outcomes].sort((a, b) => a - b);
                const mid = Math.floor(sorted.length / 2);
                const median = sorted.length % 2 ? sorted[mid] : (sorted[mid - 1] + sorted[mid]) / 2;
                document.getElementById('medianWin').textContent = median;
            }

            updateDistributionChart();
        }

        // Update distribution chart
        function updateDistributionChart() {
            const chart = document.getElementById('distChart');
            chart.innerHTML = '';

            if (outcomes.length === 0) return;

            // Count outcomes by prize level
            const counts = {};
            for (const o of outcomes) {
                counts[o] = (counts[o] || 0) + 1;
            }

            // Get the prize levels (powers of 2)
            const levels = [2, 4, 8, 16, 32, 64, 128, 256];
            const maxCount = Math.max(...levels.map(l => counts[l] || 0), 1);

            for (const level of levels) {
                const count = counts[level] || 0;
                const height = (count / maxCount) * 130;

                const bar = document.createElement('div');
                bar.className = 'dist-bar';
                bar.style.height = height + 'px';

                const label = document.createElement('span');
                label.className = 'dist-label';
                label.textContent = '$' + level;
                bar.appendChild(label);

                bar.title = `$${level}: ${count} times (${(count/outcomes.length*100).toFixed(1)}%)`;

                chart.appendChild(bar);
            }

            // Add "more" bar for higher values
            const higherCount = outcomes.filter(o => o > 256).length;
            if (higherCount > 0 || outcomes.length > 0) {
                const bar = document.createElement('div');
                bar.className = 'dist-bar';
                bar.style.height = (higherCount / maxCount) * 130 + 'px';
                bar.style.background = 'linear-gradient(180deg, #ff6b6b, #c0392b)';

                const label = document.createElement('span');
                label.className = 'dist-label';
                label.textContent = '$512+';
                bar.appendChild(label);

                bar.title = `$512+: ${higherCount} times (${(higherCount/outcomes.length*100).toFixed(2)}%)`;

                chart.appendChild(bar);
            }
        }

        // Event listeners
        playBtn.addEventListener('click', () => playGame(true));

        paySlider.addEventListener('input', () => {
            payAmount.textContent = paySlider.value;
        });

        document.getElementById('sim100').addEventListener('click', () => runSimulation(100));
        document.getElementById('sim1000').addEventListener('click', () => runSimulation(1000));
        document.getElementById('sim10000').addEventListener('click', () => runSimulation(10000));

        document.getElementById('resetBtn').addEventListener('click', () => {
            gamesPlayed = 0;
            totalWon = 0;
            outcomes = [];
            flipCount.textContent = '0';
            prizeDisplay.textContent = '0';
            coin.className = 'coin heads';
            coin.textContent = 'üëë';
            updateStats();
        });

        // Initialize
        updateStats();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
