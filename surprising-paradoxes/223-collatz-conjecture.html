<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Collatz Conjecture - The Simplest Impossible Problem</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5em;
            color: #e94560;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.2em;
            color: #a0a0a0;
            font-style: italic;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #e94560;
            text-decoration: none;
            font-size: 1.1em;
            z-index: 1000;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .panel {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .panel h2 {
            color: #e94560;
            margin-bottom: 20px;
            font-size: 1.4em;
        }

        /* Input Section */
        .input-section {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        input[type="number"] {
            flex: 1;
            min-width: 150px;
            padding: 15px;
            font-size: 1.2em;
            border: none;
            border-radius: 10px;
            background: rgba(255,255,255,0.1);
            color: #fff;
            text-align: center;
        }

        input[type="number"]:focus {
            outline: 2px solid #e94560;
        }

        button {
            background: linear-gradient(145deg, #e94560, #c73550);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1em;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(233,69,96,0.4);
        }

        button.secondary {
            background: linear-gradient(145deg, #3498db, #2980b9);
        }

        /* Trajectory Canvas */
        .canvas-container {
            position: relative;
            margin: 20px 0;
        }

        #trajectoryCanvas {
            width: 100%;
            height: 300px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
        }

        /* Sequence Display */
        .sequence-container {
            max-height: 200px;
            overflow-y: auto;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
        }

        .sequence {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .seq-num {
            padding: 5px 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .seq-num.even {
            background: rgba(52, 152, 219, 0.3);
            color: #3498db;
        }

        .seq-num.odd {
            background: rgba(231, 76, 60, 0.3);
            color: #e74c3c;
        }

        .seq-num.one {
            background: rgba(46, 204, 113, 0.5);
            color: #2ecc71;
            font-weight: bold;
        }

        .seq-arrow {
            color: #666;
            align-self: center;
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .stat-box {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #f1c40f;
        }

        .stat-label {
            font-size: 0.85em;
            color: #a0a0a0;
        }

        /* Famous Numbers */
        .famous-numbers {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }

        .famous-btn {
            padding: 8px 15px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 20px;
            color: #e0e0e0;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .famous-btn:hover {
            background: #e94560;
            border-color: #e94560;
        }

        /* Distribution Chart */
        #distributionCanvas {
            width: 100%;
            height: 250px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
        }

        /* Rules Display */
        .rules-box {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .rule {
            font-size: 1.3em;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }

        .rule-even {
            color: #3498db;
        }

        .rule-odd {
            color: #e74c3c;
        }

        /* Explanation */
        .explanation {
            line-height: 1.8;
        }

        .explanation h3 {
            color: #e94560;
            margin: 20px 0 10px 0;
        }

        .quote {
            border-left: 4px solid #e94560;
            padding-left: 20px;
            margin: 20px 0;
            font-style: italic;
            color: #b0b0b0;
        }

        .math-box {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
        }

        .highlight {
            color: #f1c40f;
            font-weight: bold;
        }

        ul {
            margin-left: 30px;
            line-height: 2;
        }

        /* Animation */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .animating {
            animation: pulse 0.3s ease-in-out;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .main-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Tree visualization */
        #treeCanvas {
            width: 100%;
            height: 300px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .tab {
            padding: 10px 20px;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 8px;
            color: #a0a0a0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab.active {
            background: #e94560;
            color: white;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Paradoxes</a>

    <div class="container">
        <header>
            <h1>The Collatz Conjecture</h1>
            <p class="subtitle">Simple rules, chaotic paths, and an unsolved 90-year mystery</p>
        </header>

        <div class="main-grid">
            <div class="panel">
                <h2>The 3n+1 Problem</h2>

                <div class="rules-box">
                    <p style="margin-bottom: 15px;">Pick any positive integer. Apply these rules:</p>
                    <div class="rule rule-even">If EVEN: n → n/2</div>
                    <div class="rule rule-odd">If ODD: n → 3n + 1</div>
                    <p style="margin-top: 15px; color: #2ecc71; font-weight: bold;">Does every number eventually reach 1?</p>
                </div>

                <div class="input-section">
                    <input type="number" id="numberInput" value="27" min="1" max="1000000000">
                    <button id="runBtn">Run Sequence</button>
                    <button id="animateBtn" class="secondary">Animate</button>
                </div>

                <h3 style="color: #a0a0a0; margin: 15px 0 10px;">Try Famous Numbers:</h3>
                <div class="famous-numbers">
                    <button class="famous-btn" data-n="7">7</button>
                    <button class="famous-btn" data-n="27">27 (111 steps!)</button>
                    <button class="famous-btn" data-n="97">97</button>
                    <button class="famous-btn" data-n="871">871</button>
                    <button class="famous-btn" data-n="6171">6171</button>
                    <button class="famous-btn" data-n="77031">77031</button>
                    <button class="famous-btn" data-n="837799">837799</button>
                    <button class="famous-btn" data-n="8400511">8.4M</button>
                </div>

                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="stepsDisplay">0</div>
                        <div class="stat-label">Steps to reach 1</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="maxDisplay">0</div>
                        <div class="stat-label">Peak value</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="ratioDisplay">0</div>
                        <div class="stat-label">Peak / Start</div>
                    </div>
                </div>

                <div class="sequence-container" id="sequenceContainer">
                    <div class="sequence" id="sequence"></div>
                </div>
            </div>

            <div class="panel">
                <h2>Trajectory Visualization</h2>

                <div class="tabs">
                    <button class="tab active" data-view="trajectory">Trajectory</button>
                    <button class="tab" data-view="log">Log Scale</button>
                    <button class="tab" data-view="distribution">Distribution</button>
                </div>

                <canvas id="trajectoryCanvas" width="600" height="300"></canvas>

                <div style="margin-top: 20px;">
                    <h3 style="color: #e94560;">Why Can't We Prove It?</h3>
                    <p style="margin-top: 10px; color: #a0a0a0;">
                        Despite being stated in 1937, no one has proven that ALL numbers reach 1.
                        Computers have verified it for all numbers up to 2<sup>68</sup> (≈ 295 quintillion),
                        yet the proof remains elusive.
                    </p>
                </div>
            </div>
        </div>

        <div class="panel">
            <h2>Stopping Time Distribution (n = 1 to 10,000)</h2>
            <canvas id="distributionCanvas" width="1200" height="250"></canvas>
            <p style="text-align: center; color: #a0a0a0; margin-top: 10px;">
                How many steps does each number take to reach 1? Notice the chaotic distribution!
            </p>
        </div>

        <div class="panel explanation">
            <h2>The Paradox Explained</h2>

            <div class="quote">
                "Mathematics may not be ready for such problems."
                <br><br>— Paul Erdős, legendary mathematician
            </div>

            <h3>The Setup</h3>
            <p>Lothar Collatz proposed this conjecture in 1937. The rules are absurdly simple:</p>

            <div class="math-box">
                <strong>The Collatz Function:</strong><br><br>
                f(n) = n/2 &nbsp;&nbsp;&nbsp; if n is even<br>
                f(n) = 3n+1 &nbsp; if n is odd<br><br>

                <strong>The Conjecture:</strong> For ALL positive integers n,<br>
                repeated application of f eventually reaches 1.
            </div>

            <h3>Why Is It So Hard?</h3>
            <p>The problem looks trivial but is deceptively complex:</p>
            <ul>
                <li><strong>Unpredictable behavior</strong> — The sequence for 27 takes 111 steps and peaks at 9,232!</li>
                <li><strong>No pattern</strong> — Nearby numbers have wildly different trajectories</li>
                <li><strong>Exponential growth</strong> — The 3n+1 rule can make numbers explode before they collapse</li>
                <li><strong>Mixing dynamics</strong> — The sequence alternates between growth (odd) and shrinkage (even) chaotically</li>
            </ul>

            <h3>The Numbers</h3>
            <div class="math-box">
                <strong>Verified range:</strong> All n ≤ 2<sup>68</sup> ≈ 2.95 × 10<sup>20</sup><br><br>
                <strong>Record holders (stopping time for n < 10<sup>8</sup>):</strong><br>
                • 63,728,127 takes <span class="highlight">949 steps</span><br>
                • 3,732,423 takes 597 steps<br>
                • 837,799 takes 524 steps<br><br>

                <strong>Record holder (maximum value):</strong><br>
                • Starting from 27, reaches peak of <span class="highlight">9,232</span> (342× starting value!)
            </div>

            <h3>The Paradox</h3>
            <p>The "paradox" is the <span class="highlight">disconnect between simplicity and difficulty</span>:</p>
            <ul>
                <li>A child can understand the rules</li>
                <li>A computer can verify billions of cases</li>
                <li>Yet the world's best mathematicians cannot prove it works for ALL numbers</li>
                <li>There might be a counter-example — a number that grows forever — but we haven't found one</li>
            </ul>

            <h3>Attempts at Proof</h3>
            <p>Mathematicians have tried many approaches:</p>
            <ul>
                <li><strong>Probabilistic arguments</strong> — On average, numbers should decrease (3/4 factor), but this doesn't guarantee convergence</li>
                <li><strong>Algebraic approaches</strong> — Studying the problem in different number systems</li>
                <li><strong>Dynamical systems</strong> — Treating it as a discrete dynamical system</li>
                <li><strong>Computational verification</strong> — Checking ever-larger ranges (but can't prove the general case)</li>
            </ul>

            <h3>Connection to Chaos</h3>
            <p>The Collatz sequence exhibits <span class="highlight">chaotic behavior</span>:</p>
            <ul>
                <li>Sensitive to initial conditions (small changes → big differences)</li>
                <li>No closed-form formula for the n-th term</li>
                <li>Mixing of growth and decay phases</li>
                <li>Statistical properties resemble random walks</li>
            </ul>

            <div class="quote">
                "The Collatz conjecture is a notorious open problem in mathematics. It is easy to state but seems completely intractable... It has been said that professional mathematicians should not waste time on it."
                <br><br>— Jeffrey Lagarias, mathematician
            </div>

            <h3>Prize</h3>
            <p>Paul Erdős offered <span class="highlight">$500</span> for a proof — and said it was beyond current mathematics. Decades later, it remains unsolved. The Clay Mathematics Institute has not added it to their Millennium Problems, perhaps because it might be undecidable!</p>
        </div>
    </div>

    <script>
        // DOM elements
        const numberInput = document.getElementById('numberInput');
        const runBtn = document.getElementById('runBtn');
        const animateBtn = document.getElementById('animateBtn');
        const sequenceEl = document.getElementById('sequence');
        const stepsDisplay = document.getElementById('stepsDisplay');
        const maxDisplay = document.getElementById('maxDisplay');
        const ratioDisplay = document.getElementById('ratioDisplay');
        const trajectoryCanvas = document.getElementById('trajectoryCanvas');
        const trajectoryCtx = trajectoryCanvas.getContext('2d');
        const distributionCanvas = document.getElementById('distributionCanvas');
        const distributionCtx = distributionCanvas.getContext('2d');

        let currentSequence = [];
        let animationId = null;
        let currentView = 'trajectory';

        // Initialize
        computeCollatz(27);
        drawDistribution();
        setupEventListeners();

        function setupEventListeners() {
            runBtn.addEventListener('click', () => {
                const n = parseInt(numberInput.value);
                if (n > 0) computeCollatz(n);
            });

            animateBtn.addEventListener('click', () => {
                const n = parseInt(numberInput.value);
                if (n > 0) animateCollatz(n);
            });

            numberInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const n = parseInt(numberInput.value);
                    if (n > 0) computeCollatz(n);
                }
            });

            document.querySelectorAll('.famous-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const n = parseInt(btn.dataset.n);
                    numberInput.value = n;
                    computeCollatz(n);
                });
            });

            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    currentView = tab.dataset.view;

                    if (currentView === 'distribution') {
                        trajectoryCanvas.style.display = 'none';
                        distributionCanvas.style.display = 'block';
                    } else {
                        trajectoryCanvas.style.display = 'block';
                        distributionCanvas.style.display = 'none';
                        drawTrajectory();
                    }
                });
            });
        }

        function collatzStep(n) {
            if (n % 2 === 0) return n / 2;
            return 3 * n + 1;
        }

        function getCollatzSequence(n) {
            const seq = [n];
            let current = n;
            let maxIter = 10000;

            while (current !== 1 && maxIter > 0) {
                current = collatzStep(current);
                seq.push(current);
                maxIter--;
            }

            return seq;
        }

        function computeCollatz(n) {
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }

            currentSequence = getCollatzSequence(n);
            displaySequence(currentSequence);
            updateStats(n, currentSequence);
            drawTrajectory();
        }

        function displaySequence(seq) {
            sequenceEl.innerHTML = '';

            seq.forEach((num, i) => {
                const span = document.createElement('span');
                span.className = 'seq-num';

                if (num === 1) {
                    span.classList.add('one');
                } else if (num % 2 === 0) {
                    span.classList.add('even');
                } else {
                    span.classList.add('odd');
                }

                span.textContent = formatNumber(num);
                sequenceEl.appendChild(span);

                if (i < seq.length - 1) {
                    const arrow = document.createElement('span');
                    arrow.className = 'seq-arrow';
                    arrow.textContent = '→';
                    sequenceEl.appendChild(arrow);
                }
            });
        }

        function formatNumber(n) {
            if (n >= 1e9) return (n / 1e9).toFixed(1) + 'B';
            if (n >= 1e6) return (n / 1e6).toFixed(1) + 'M';
            if (n >= 1e4) return (n / 1e3).toFixed(1) + 'K';
            return n.toString();
        }

        function updateStats(start, seq) {
            const steps = seq.length - 1;
            const max = Math.max(...seq);
            const ratio = (max / start).toFixed(1);

            stepsDisplay.textContent = steps;
            maxDisplay.textContent = formatNumber(max);
            ratioDisplay.textContent = ratio + '×';
        }

        function drawTrajectory() {
            const seq = currentSequence;
            if (seq.length === 0) return;

            const w = trajectoryCanvas.width;
            const h = trajectoryCanvas.height;
            trajectoryCtx.clearRect(0, 0, w, h);

            const padding = 40;
            const graphW = w - padding * 2;
            const graphH = h - padding * 2;

            // Calculate scale
            let maxVal = Math.max(...seq);
            let minVal = Math.min(...seq);

            if (currentView === 'log') {
                maxVal = Math.log10(maxVal);
                minVal = 0;
            }

            // Draw axes
            trajectoryCtx.strokeStyle = '#555';
            trajectoryCtx.lineWidth = 1;
            trajectoryCtx.beginPath();
            trajectoryCtx.moveTo(padding, padding);
            trajectoryCtx.lineTo(padding, h - padding);
            trajectoryCtx.lineTo(w - padding, h - padding);
            trajectoryCtx.stroke();

            // Labels
            trajectoryCtx.fillStyle = '#888';
            trajectoryCtx.font = '11px Georgia';
            trajectoryCtx.fillText(currentView === 'log' ? 'log₁₀(n)' : 'Value', 5, padding + 10);
            trajectoryCtx.fillText('Step', w / 2, h - 5);

            // Draw trajectory
            trajectoryCtx.beginPath();
            trajectoryCtx.strokeStyle = '#e94560';
            trajectoryCtx.lineWidth = 2;

            seq.forEach((val, i) => {
                const x = padding + (i / (seq.length - 1)) * graphW;
                let y;

                if (currentView === 'log') {
                    const logVal = val > 0 ? Math.log10(val) : 0;
                    y = h - padding - (logVal / maxVal) * graphH;
                } else {
                    y = h - padding - ((val - minVal) / (maxVal - minVal)) * graphH;
                }

                if (i === 0) trajectoryCtx.moveTo(x, y);
                else trajectoryCtx.lineTo(x, y);
            });
            trajectoryCtx.stroke();

            // Draw points for key moments
            trajectoryCtx.fillStyle = '#f1c40f';
            seq.forEach((val, i) => {
                if (val === Math.max(...seq) || val === 1 || i === 0) {
                    const x = padding + (i / (seq.length - 1)) * graphW;
                    let y;

                    if (currentView === 'log') {
                        const logVal = val > 0 ? Math.log10(val) : 0;
                        y = h - padding - (logVal / maxVal) * graphH;
                    } else {
                        y = h - padding - ((val - minVal) / (maxVal - minVal)) * graphH;
                    }

                    trajectoryCtx.beginPath();
                    trajectoryCtx.arc(x, y, 4, 0, Math.PI * 2);
                    trajectoryCtx.fill();
                }
            });

            // Peak label
            const peakIdx = seq.indexOf(Math.max(...seq));
            const peakX = padding + (peakIdx / (seq.length - 1)) * graphW;
            trajectoryCtx.fillStyle = '#f1c40f';
            trajectoryCtx.font = 'bold 12px Georgia';
            trajectoryCtx.fillText('Peak: ' + formatNumber(Math.max(...seq)), peakX - 30, padding + 20);
        }

        function animateCollatz(n) {
            if (animationId) {
                cancelAnimationFrame(animationId);
            }

            currentSequence = getCollatzSequence(n);
            let currentIdx = 0;

            sequenceEl.innerHTML = '';

            function step() {
                if (currentIdx >= currentSequence.length) {
                    animationId = null;
                    return;
                }

                const num = currentSequence[currentIdx];

                // Add number to sequence display
                const span = document.createElement('span');
                span.className = 'seq-num animating';

                if (num === 1) {
                    span.classList.add('one');
                } else if (num % 2 === 0) {
                    span.classList.add('even');
                } else {
                    span.classList.add('odd');
                }

                span.textContent = formatNumber(num);
                sequenceEl.appendChild(span);

                if (currentIdx < currentSequence.length - 1) {
                    const arrow = document.createElement('span');
                    arrow.className = 'seq-arrow';
                    arrow.textContent = '→';
                    sequenceEl.appendChild(arrow);
                }

                // Scroll to bottom
                document.getElementById('sequenceContainer').scrollTop =
                    document.getElementById('sequenceContainer').scrollHeight;

                // Draw partial trajectory
                drawPartialTrajectory(currentIdx);

                // Update stats progressively
                const partialSeq = currentSequence.slice(0, currentIdx + 1);
                stepsDisplay.textContent = currentIdx;
                maxDisplay.textContent = formatNumber(Math.max(...partialSeq));
                ratioDisplay.textContent = (Math.max(...partialSeq) / n).toFixed(1) + '×';

                currentIdx++;
                animationId = setTimeout(step, Math.max(20, 500 / Math.sqrt(currentSequence.length)));
            }

            step();
        }

        function drawPartialTrajectory(upToIdx) {
            const seq = currentSequence.slice(0, upToIdx + 1);
            if (seq.length === 0) return;

            const w = trajectoryCanvas.width;
            const h = trajectoryCanvas.height;
            trajectoryCtx.clearRect(0, 0, w, h);

            const padding = 40;
            const graphW = w - padding * 2;
            const graphH = h - padding * 2;

            // Use full sequence for scale
            const maxVal = Math.max(...currentSequence);
            const minVal = Math.min(...currentSequence);

            // Draw axes
            trajectoryCtx.strokeStyle = '#555';
            trajectoryCtx.lineWidth = 1;
            trajectoryCtx.beginPath();
            trajectoryCtx.moveTo(padding, padding);
            trajectoryCtx.lineTo(padding, h - padding);
            trajectoryCtx.lineTo(w - padding, h - padding);
            trajectoryCtx.stroke();

            // Draw trajectory so far
            trajectoryCtx.beginPath();
            trajectoryCtx.strokeStyle = '#e94560';
            trajectoryCtx.lineWidth = 2;

            seq.forEach((val, i) => {
                const x = padding + (i / (currentSequence.length - 1)) * graphW;
                const y = h - padding - ((val - minVal) / (maxVal - minVal)) * graphH;

                if (i === 0) trajectoryCtx.moveTo(x, y);
                else trajectoryCtx.lineTo(x, y);
            });
            trajectoryCtx.stroke();

            // Current point
            const lastVal = seq[seq.length - 1];
            const lastX = padding + (upToIdx / (currentSequence.length - 1)) * graphW;
            const lastY = h - padding - ((lastVal - minVal) / (maxVal - minVal)) * graphH;

            trajectoryCtx.fillStyle = '#f1c40f';
            trajectoryCtx.beginPath();
            trajectoryCtx.arc(lastX, lastY, 6, 0, Math.PI * 2);
            trajectoryCtx.fill();
        }

        function drawDistribution() {
            const w = distributionCanvas.width;
            const h = distributionCanvas.height;
            distributionCtx.clearRect(0, 0, w, h);

            const padding = 40;
            const graphW = w - padding * 2;
            const graphH = h - padding * 2;

            // Calculate stopping times for 1 to 10000
            const stoppingTimes = [];
            const maxN = 10000;

            for (let n = 1; n <= maxN; n++) {
                const seq = getCollatzSequence(n);
                stoppingTimes.push(seq.length - 1);
            }

            const maxSteps = Math.max(...stoppingTimes);

            // Draw axes
            distributionCtx.strokeStyle = '#555';
            distributionCtx.lineWidth = 1;
            distributionCtx.beginPath();
            distributionCtx.moveTo(padding, padding);
            distributionCtx.lineTo(padding, h - padding);
            distributionCtx.lineTo(w - padding, h - padding);
            distributionCtx.stroke();

            // Labels
            distributionCtx.fillStyle = '#888';
            distributionCtx.font = '11px Georgia';
            distributionCtx.fillText('Steps', 5, padding + 10);
            distributionCtx.fillText('Starting number (1 - 10,000)', w / 2 - 60, h - 5);

            // Draw points
            distributionCtx.fillStyle = 'rgba(233, 69, 96, 0.5)';

            stoppingTimes.forEach((steps, i) => {
                const x = padding + ((i + 1) / maxN) * graphW;
                const y = h - padding - (steps / maxSteps) * graphH;

                distributionCtx.beginPath();
                distributionCtx.arc(x, y, 1.5, 0, Math.PI * 2);
                distributionCtx.fill();
            });

            // Highlight record holders
            distributionCtx.fillStyle = '#f1c40f';
            let currentMax = 0;

            stoppingTimes.forEach((steps, i) => {
                if (steps > currentMax) {
                    currentMax = steps;
                    const x = padding + ((i + 1) / maxN) * graphW;
                    const y = h - padding - (steps / maxSteps) * graphH;

                    distributionCtx.beginPath();
                    distributionCtx.arc(x, y, 4, 0, Math.PI * 2);
                    distributionCtx.fill();
                }
            });

            // Add max label
            distributionCtx.fillStyle = '#f1c40f';
            distributionCtx.font = 'bold 12px Georgia';
            distributionCtx.fillText('Max: ' + maxSteps + ' steps', w - 120, padding + 20);
        }

        // Initial view setup
        distributionCanvas.style.display = 'none';
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
