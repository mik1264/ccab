<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Ames Room Illusion | Surprising Paradoxes</title>
    <style>
        :root {
            --sage: #8A9A5B;
            --moss: #606C38;
            --earth: #DDA15E;
            --cream: #FEFAE0;
            --terracotta: #BC6C25;
            --dark-moss: #3d4423;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--cream) 0%, #F4F1DE 50%, #EDE8D5 100%);
            color: var(--dark-moss);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--moss);
            text-decoration: none;
            margin-bottom: 1.5rem;
            transition: color 0.3s;
        }

        .back-link:hover {
            color: var(--terracotta);
        }

        h1 {
            font-family: 'Lora', Georgia, serif;
            font-size: 2.5rem;
            color: var(--dark-moss);
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: var(--moss);
            font-size: 1.1rem;
            margin-bottom: 2rem;
        }

        .intro-box {
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(138, 154, 91, 0.3);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
        }

        .intro-box h2 {
            font-family: 'Lora', Georgia, serif;
            color: var(--moss);
            margin-bottom: 1rem;
        }

        .intro-box p {
            margin-bottom: 1rem;
        }

        .sim-container {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(138, 154, 91, 0.3);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
        }

        .sim-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .sim-header h3 {
            font-family: 'Lora', Georgia, serif;
            color: var(--moss);
            font-size: 1.3rem;
        }

        /* View toggle */
        .view-toggle {
            display: flex;
            justify-content: center;
            gap: 0.6rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .view-btn {
            padding: 8px 16px;
            border: 2px solid var(--moss);
            border-radius: 25px;
            background: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .view-btn.active {
            background: var(--moss);
            color: white;
        }

        .view-btn:hover {
            transform: scale(1.05);
        }

        .view-btn:focus {
            outline: 2px solid var(--terracotta);
            outline-offset: 2px;
        }

        /* Canvas container */
        .canvas-container {
            display: flex;
            justify-content: center;
            margin-bottom: 1.5rem;
            position: relative;
        }

        #roomCanvas {
            background: #2d2d2d;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .peephole-frame {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 320px;
            height: 320px;
            border-radius: 50%;
            border: 20px solid #1a1a1a;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.8);
            pointer-events: none;
            display: none;
        }

        .peephole-frame.active {
            display: block;
        }

        /* Person controls */
        .person-controls {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .person-control {
            text-align: center;
        }

        .person-control label {
            display: block;
            font-weight: 600;
            color: var(--moss);
            margin-bottom: 0.5rem;
        }

        .person-control input[type="range"] {
            width: 150px;
            accent-color: var(--moss);
        }

        .person-emoji {
            font-size: 2rem;
            display: block;
            margin-bottom: 0.3rem;
        }

        /* Info display */
        .info-panel {
            background: rgba(138, 154, 91, 0.15);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .info-panel .label {
            font-size: 0.9rem;
            color: var(--moss);
        }

        .info-panel .value {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--terracotta);
        }

        /* Paradox box */
        .paradox-box {
            background: linear-gradient(135deg, rgba(188, 108, 37, 0.15), rgba(221, 161, 94, 0.1));
            border: 2px solid var(--terracotta);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .paradox-box h3 {
            font-family: 'Lora', Georgia, serif;
            color: var(--terracotta);
            margin-bottom: 1rem;
        }

        .paradox-box p {
            margin-bottom: 1rem;
        }

        /* Construction section */
        .construction-section {
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(138, 154, 91, 0.3);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .construction-section h3 {
            font-family: 'Lora', Georgia, serif;
            color: var(--moss);
            margin-bottom: 1rem;
        }

        .construction-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .construction-item {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            padding: 1rem;
            border-left: 3px solid var(--sage);
        }

        .construction-item .icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .construction-item strong {
            color: var(--moss);
        }

        /* History section */
        .history-section {
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(138, 154, 91, 0.3);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .history-section h3 {
            font-family: 'Lora', Georgia, serif;
            color: var(--moss);
            margin-bottom: 1rem;
        }

        .timeline {
            position: relative;
            padding-left: 30px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, var(--moss), var(--terracotta));
        }

        .timeline-item {
            position: relative;
            margin-bottom: 1.5rem;
            padding-left: 20px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -26px;
            top: 5px;
            width: 12px;
            height: 12px;
            background: var(--sage);
            border-radius: 50%;
            border: 2px solid white;
        }

        .timeline-item .year {
            font-weight: bold;
            color: var(--terracotta);
            margin-bottom: 0.3rem;
        }

        /* Film uses */
        .film-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .film-card {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(138, 154, 91, 0.3);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
        }

        .film-card .emoji {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .film-card .title {
            font-weight: bold;
            color: var(--moss);
            margin-bottom: 0.3rem;
        }

        .film-card .year {
            color: var(--terracotta);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        /* Psychology section */
        .psychology-section {
            background: rgba(138, 154, 91, 0.15);
            border: 1px solid var(--moss);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .psychology-section h3 {
            font-family: 'Lora', Georgia, serif;
            color: var(--moss);
            margin-bottom: 1rem;
        }

        /* Quote */
        .quote-box {
            background: rgba(96, 108, 56, 0.15);
            border-left: 4px solid var(--sage);
            padding: 1.5rem;
            margin: 2rem 0;
            font-style: italic;
        }

        .quote-box .author {
            margin-top: 0.5rem;
            text-align: right;
            color: var(--moss);
            font-style: normal;
            font-weight: bold;
        }

        /* Mobile adjustments */
        @media (max-width: 600px) {
            h1 { font-size: 1.8rem; }
            .container { padding: 1rem; }
            #roomCanvas { max-width: 100%; height: auto; }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600;700&family=Nunito:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê Back to Paradoxes</a>

        <h1>üè† The Ames Room Illusion</h1>
        <p class="subtitle">A room where giants and dwarfs are created by geometry alone</p>

        <div class="intro-box">
            <h2>The Impossible Room</h2>
            <p>
                Through a peephole, you see an ordinary rectangular room. But when two people of
                <strong>identical height</strong> stand in opposite corners, one appears to be a
                <strong>giant</strong> and the other a <strong>dwarf</strong>!
            </p>
            <p>
                The secret: the room isn't rectangular at all. It's a carefully constructed
                <strong>trapezoid</strong> that tricks your brain's size-distance calculations.
            </p>
        </div>

        <div class="sim-container">
            <div class="sim-header">
                <h3>Interactive Ames Room</h3>
                <p style="color: var(--moss); margin-top: 0.5rem;">Toggle between views to see the illusion and the reality</p>
            </div>

            <div class="view-toggle">
                <button class="view-btn active" id="btnPeephole">üëÅÔ∏è Peephole View</button>
                <button class="view-btn" id="btnReality">üîç True Shape</button>
                <button class="view-btn" id="btnTopDown">üìê Top-Down</button>
                <button class="view-btn" id="btn3D">üé≤ 3D View</button>
                <button class="view-btn" id="btnReveal">‚ú® Reveal</button>
            </div>

            <div class="canvas-container">
                <canvas id="roomCanvas" width="500" height="400"></canvas>
                <div class="peephole-frame" id="peepholeFrame"></div>
            </div>

            <div class="person-controls">
                <div class="person-control">
                    <span class="person-emoji">üßë</span>
                    <label>Person A Position</label>
                    <input type="range" id="personASlider" min="0" max="100" value="10">
                </div>
                <div class="person-control">
                    <span class="person-emoji">üßë</span>
                    <label>Person B Position</label>
                    <input type="range" id="personBSlider" min="0" max="100" value="90">
                </div>
            </div>

            <div class="info-panel">
                <div class="label">Both people are actually the SAME height!</div>
                <div class="value" id="heightInfo">Apparent size difference: 2.5√ó</div>
            </div>
        </div>

        <div class="paradox-box">
            <h3>‚ö° The Paradox</h3>
            <p>
                Your brain uses <strong>size-distance constancy</strong>: objects that are farther away
                produce smaller images on your retina, but your brain "corrects" for this, perceiving
                them as their true size.
            </p>
            <p>
                In the Ames room, the far corner is <strong>actually much farther</strong> than the near
                corner. But because the room <em>looks</em> rectangular, your brain assumes both corners
                are equidistant. When a person in the far corner projects a small image, your brain
                concludes they must be <strong>genuinely tiny</strong>!
            </p>
            <p>
                The illusion is so powerful that even knowing the trick doesn't make it go away. Your
                visual system processes the scene faster than conscious reasoning can override it.
            </p>
        </div>

        <div class="construction-section">
            <h3>How It's Built</h3>
            <div class="construction-grid">
                <div class="construction-item">
                    <div class="icon">üìê</div>
                    <strong>Trapezoidal Floor:</strong> The floor slopes upward toward the "far" corner,
                    making that corner much farther from the viewer.
                </div>
                <div class="construction-item">
                    <div class="icon">üîª</div>
                    <strong>Angled Ceiling:</strong> The ceiling slopes downward, complementing the floor's
                    angle to maintain the rectangular appearance.
                </div>
                <div class="construction-item">
                    <div class="icon">‚óá</div>
                    <strong>Slanted Walls:</strong> The back wall is diagonal (not parallel to front),
                    with one corner 2-3√ó farther from the peephole than the other.
                </div>
                <div class="construction-item">
                    <div class="icon">üëÅÔ∏è</div>
                    <strong>The Peephole:</strong> Eliminates depth cues from binocular vision. With one
                    eye, you can't triangulate true distances.
                </div>
                <div class="construction-item">
                    <div class="icon">ü™ü</div>
                    <strong>False Perspective Cues:</strong> Checkered floors, "square" windows, and
                    matching patterns reinforce the rectangular illusion.
                </div>
                <div class="construction-item">
                    <div class="icon">üìè</div>
                    <strong>Calculated Proportions:</strong> Every element is scaled to project the
                    identical retinal image as a normal room from the viewing angle.
                </div>
            </div>
        </div>

        <div class="history-section">
            <h3>A Brief History</h3>
            <div class="timeline">
                <div class="timeline-item">
                    <div class="year">1860s</div>
                    <div class="desc">Hermann von Helmholtz first conceptualized the idea of a distorted room that would appear normal, but never built one.</div>
                </div>
                <div class="timeline-item">
                    <div class="year">1934</div>
                    <div class="desc">American ophthalmologist Adelbert Ames Jr. constructs the first physical Ames room while researching depth perception.</div>
                </div>
                <div class="timeline-item">
                    <div class="year">1946</div>
                    <div class="desc">Ames patents the design and demonstrates it widely, making it famous in psychology circles.</div>
                </div>
                <div class="timeline-item">
                    <div class="year">2001-2003</div>
                    <div class="desc">Peter Jackson's <em>Lord of the Rings</em> trilogy uses Ames room sets to make hobbits appear tiny next to Gandalf.</div>
                </div>
                <div class="timeline-item">
                    <div class="year">Today</div>
                    <div class="desc">Ames rooms are featured in science museums worldwide and remain a staple of perception research.</div>
                </div>
            </div>
        </div>

        <h3 style="font-family: 'Lora', Georgia, serif; color: var(--moss); margin-bottom: 1rem;">Famous Uses in Film</h3>
        <div class="film-grid">
            <div class="film-card">
                <div class="emoji">üßô</div>
                <div class="title">Lord of the Rings</div>
                <div class="year">2001-2003</div>
                <p>Made hobbits appear 3 feet tall next to 6-foot Gandalf using moving Ames sets.</p>
            </div>
            <div class="film-card">
                <div class="emoji">üç´</div>
                <div class="title">Willy Wonka</div>
                <div class="year">1971 & 2005</div>
                <p>Created the shrinking corridor effect as characters approach the tiny door.</p>
            </div>
            <div class="film-card">
                <div class="emoji">üè†</div>
                <div class="title">Eternal Sunshine</div>
                <div class="year">2004</div>
                <p>Used to create surreal memory distortion scenes with impossible scale.</p>
            </div>
            <div class="film-card">
                <div class="emoji">üì∫</div>
                <div class="title">Science Museums</div>
                <div class="year">Worldwide</div>
                <p>Interactive exhibits let visitors experience being giants and dwarfs.</p>
            </div>
        </div>

        <div class="psychology-section">
            <h3>Why Your Brain Is Fooled</h3>
            <p>
                The Ames room exploits <strong>monocular depth cues</strong>‚Äîthe visual information
                we use to judge distance with a single eye. These include:
            </p>
            <ul style="margin-left: 1.5rem; margin-top: 0.5rem; margin-bottom: 1rem;">
                <li><strong>Linear perspective:</strong> Parallel lines converge at a vanishing point</li>
                <li><strong>Texture gradient:</strong> Patterns get denser with distance</li>
                <li><strong>Familiar size:</strong> Known objects (windows, doors) set scale expectations</li>
                <li><strong>Height in visual field:</strong> Objects higher up appear farther away</li>
            </ul>
            <p>
                The Ames room manipulates ALL of these cues to present a false but internally consistent
                scene. Your brain chooses the "simplest" interpretation: a normal room with abnormal people,
                rather than a bizarre room with normal people.
            </p>
            <p style="margin-top: 1rem;">
                This reveals a deep truth: <strong>perception is not passive recording</strong>‚Äîit's active
                construction. Your brain builds a model of reality from incomplete data, using assumptions
                that usually work. The Ames room is a case where those assumptions fail spectacularly.
            </p>
        </div>

        <div class="quote-box">
            "We do not see the world as it is; we see the world as we are‚Äîas our brains construct it to be."
            <div class="author">‚Äî Insight from perception research</div>
        </div>

        <div class="intro-box" style="background: rgba(138, 154, 91, 0.15); border-color: var(--moss);">
            <h2>The Deeper Lesson</h2>
            <p>
                The Ames room isn't just a clever trick‚Äîit's a window into how perception works. Every moment,
                your brain takes ambiguous 2D retinal images and reconstructs a 3D world using assumptions
                built over millions of years of evolution.
            </p>
            <p>
                Those assumptions work brilliantly in natural environments. But artificial constructions
                like the Ames room can exploit them, revealing the hidden machinery of sight.
            </p>
            <p>
                <strong>The paradox:</strong> You can know exactly how the illusion works, yet still be
                completely fooled by it. Perception and cognition operate on different timescales‚Äîand
                perception always wins the race.
            </p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('roomCanvas');
        const ctx = canvas.getContext('2d');
        const peepholeFrame = document.getElementById('peepholeFrame');

        let viewMode = 'peephole'; // 'peephole', 'reality', 'topdown', '3d', 'reveal'
        let personAPos = 0.1; // 0 to 1
        let personBPos = 0.9;
        let rotation3D = 0; // For 3D view rotation
        let revealProgress = 0; // 0 = illusion, 1 = reality
        let revealDirection = 1;
        let animating = false;

        // DOM elements
        const btnPeephole = document.getElementById('btnPeephole');
        const btnReality = document.getElementById('btnReality');
        const btnTopDown = document.getElementById('btnTopDown');
        const btn3D = document.getElementById('btn3D');
        const btnReveal = document.getElementById('btnReveal');
        const personASlider = document.getElementById('personASlider');
        const personBSlider = document.getElementById('personBSlider');
        const heightInfo = document.getElementById('heightInfo');

        // Colors
        const floorColor = '#8b7355';
        const wallColor = '#d4c4a8';
        const ceilingColor = '#c8b898';
        const lineColor = '#5d4e37';
        const personAColor = '#4a7c59';
        const personBColor = '#7c4a5a';

        function drawPeepholeView() {
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const cx = canvas.width / 2;
            const cy = canvas.height / 2;

            // In peephole view, room appears rectangular
            const roomWidth = 350;
            const roomHeight = 250;
            const floorHeight = 80;

            // Back wall (appears rectangular)
            ctx.fillStyle = wallColor;
            ctx.fillRect(cx - roomWidth/2, cy - roomHeight/2, roomWidth, roomHeight);

            // Floor (appears flat)
            ctx.fillStyle = floorColor;
            ctx.beginPath();
            ctx.moveTo(cx - roomWidth/2, cy + roomHeight/2 - floorHeight);
            ctx.lineTo(cx + roomWidth/2, cy + roomHeight/2 - floorHeight);
            ctx.lineTo(cx + roomWidth/2 + 50, cy + roomHeight/2 + 50);
            ctx.lineTo(cx - roomWidth/2 - 50, cy + roomHeight/2 + 50);
            ctx.closePath();
            ctx.fill();

            // Draw checkered floor pattern
            drawCheckerPattern(cx, cy, roomWidth, roomHeight, floorHeight);

            // Side walls
            ctx.fillStyle = '#c0b090';
            // Left wall
            ctx.beginPath();
            ctx.moveTo(cx - roomWidth/2, cy - roomHeight/2);
            ctx.lineTo(cx - roomWidth/2 - 50, cy - roomHeight/2 - 30);
            ctx.lineTo(cx - roomWidth/2 - 50, cy + roomHeight/2 + 50);
            ctx.lineTo(cx - roomWidth/2, cy + roomHeight/2 - floorHeight);
            ctx.closePath();
            ctx.fill();

            // Right wall
            ctx.beginPath();
            ctx.moveTo(cx + roomWidth/2, cy - roomHeight/2);
            ctx.lineTo(cx + roomWidth/2 + 50, cy - roomHeight/2 - 30);
            ctx.lineTo(cx + roomWidth/2 + 50, cy + roomHeight/2 + 50);
            ctx.lineTo(cx + roomWidth/2, cy + roomHeight/2 - floorHeight);
            ctx.closePath();
            ctx.fill();

            // Draw windows on back wall
            drawWindow(cx - 80, cy - 60, 60, 80);
            drawWindow(cx + 80, cy - 60, 60, 80);

            // Draw people - in peephole view they appear different sizes
            const personAX = cx - roomWidth/2 + 40 + personAPos * (roomWidth - 80);
            const personBX = cx - roomWidth/2 + 40 + personBPos * (roomWidth - 80);

            // Calculate apparent size based on position (illusion)
            // Left side = bigger, right side = smaller (in peephole illusion)
            const sizeA = 1.8 - personAPos * 1.2; // 1.8 at left, 0.6 at right
            const sizeB = 1.8 - personBPos * 1.2;

            const basePersonHeight = 60;
            const floorY = cy + roomHeight/2 - floorHeight;

            drawPerson(personAX, floorY, basePersonHeight * sizeA, personAColor, 'A');
            drawPerson(personBX, floorY, basePersonHeight * sizeB, personBColor, 'B');

            // Update info
            const ratio = Math.max(sizeA, sizeB) / Math.min(sizeA, sizeB);
            heightInfo.textContent = `Apparent size difference: ${ratio.toFixed(1)}√ó`;

            // Show peephole frame
            peepholeFrame.classList.add('active');
        }

        function drawRealityView() {
            ctx.fillStyle = '#f5f5dc';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const cx = canvas.width / 2;
            const cy = canvas.height / 2;

            // In reality view, show the trapezoidal room from an angle
            // Left side is closer (bigger), right side is farther (smaller)

            // Trapezoidal back wall
            ctx.fillStyle = wallColor;
            ctx.beginPath();
            ctx.moveTo(80, 80);   // top-left (close, high)
            ctx.lineTo(420, 120); // top-right (far, lower)
            ctx.lineTo(380, 320); // bottom-right
            ctx.lineTo(120, 280); // bottom-left
            ctx.closePath();
            ctx.fill();
            ctx.strokeStyle = lineColor;
            ctx.lineWidth = 2;
            ctx.stroke();

            // Floor showing slope
            ctx.fillStyle = floorColor;
            ctx.beginPath();
            ctx.moveTo(120, 280);
            ctx.lineTo(380, 320);
            ctx.lineTo(450, 380);
            ctx.lineTo(50, 340);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();

            // Labels
            ctx.fillStyle = '#3d4423';
            ctx.font = 'bold 14px Nunito';
            ctx.fillText('CLOSE (big)', 60, 310);
            ctx.fillText('FAR (small)', 360, 350);
            ctx.fillText('Floor slopes UP', 200, 360);

            // Arrows showing distance
            ctx.strokeStyle = '#BC6C25';
            ctx.lineWidth = 2;
            drawArrow(250, 400, 100, 300);
            drawArrow(250, 400, 400, 340);

            ctx.fillStyle = '#BC6C25';
            ctx.font = '12px Nunito';
            ctx.fillText('Short distance', 100, 380);
            ctx.fillText('Long distance', 340, 400);

            // Draw people - same size in reality
            const personAX = 100 + personAPos * 300;
            const personBX = 100 + personBPos * 300;

            // Y position and size adjust for perspective in this view
            const personAY = 275 + personAPos * 45;
            const personBY = 275 + personBPos * 45;
            const personASize = 70 - personAPos * 20;
            const personBSize = 70 - personBPos * 20;

            drawPerson(personAX, personAY, personASize, personAColor, 'A');
            drawPerson(personBX, personBY, personBSize, personBColor, 'B');

            heightInfo.textContent = 'Both people are the SAME actual height!';
            peepholeFrame.classList.remove('active');
        }

        function drawTopDownView() {
            ctx.fillStyle = '#f5f5dc';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const cx = canvas.width / 2;

            // Title
            ctx.fillStyle = '#3d4423';
            ctx.font = 'bold 16px Nunito';
            ctx.textAlign = 'center';
            ctx.fillText('Top-Down View of Ames Room', cx, 30);

            // Draw trapezoidal room from above
            ctx.fillStyle = floorColor;
            ctx.beginPath();
            ctx.moveTo(100, 100);  // front-left
            ctx.lineTo(400, 100);  // front-right
            ctx.lineTo(350, 350);  // back-right (closer to center - farther from viewer)
            ctx.lineTo(150, 250);  // back-left (closer corner)
            ctx.closePath();
            ctx.fill();
            ctx.strokeStyle = lineColor;
            ctx.lineWidth = 3;
            ctx.stroke();

            // Peephole position
            ctx.fillStyle = '#333';
            ctx.beginPath();
            ctx.arc(250, 80, 8, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#333';
            ctx.font = '12px Nunito';
            ctx.textAlign = 'center';
            ctx.fillText('Peephole', 250, 65);

            // Sight lines
            ctx.strokeStyle = 'rgba(188, 108, 37, 0.5)';
            ctx.lineWidth = 1;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(250, 80);
            ctx.lineTo(150, 250);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(250, 80);
            ctx.lineTo(350, 350);
            ctx.stroke();
            ctx.setLineDash([]);

            // Distance labels
            ctx.fillStyle = '#BC6C25';
            ctx.font = 'bold 14px Nunito';
            ctx.textAlign = 'left';
            ctx.fillText('SHORT', 130, 180);
            ctx.textAlign = 'right';
            ctx.fillText('LONG', 370, 250);

            // Draw people positions from above (as circles)
            const personAX = 150 + personAPos * 150;
            const personAY = 250 - personAPos * 100 + personAPos * 100;
            const personBX = 150 + personBPos * 150;
            const personBY = 250 - personBPos * 100 + personBPos * 100;

            // Interpolate positions along the back wall
            const ax = 150 + personAPos * (350 - 150);
            const ay = 250 + personAPos * (350 - 250);
            const bx = 150 + personBPos * (350 - 150);
            const by = 250 + personBPos * (350 - 250);

            ctx.fillStyle = personAColor;
            ctx.beginPath();
            ctx.arc(ax, ay, 12, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = 'white';
            ctx.font = 'bold 12px Nunito';
            ctx.textAlign = 'center';
            ctx.fillText('A', ax, ay + 4);

            ctx.fillStyle = personBColor;
            ctx.beginPath();
            ctx.arc(bx, by, 12, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = 'white';
            ctx.fillText('B', bx, by + 4);

            // Annotation
            ctx.fillStyle = '#3d4423';
            ctx.font = '13px Nunito';
            ctx.textAlign = 'center';
            ctx.fillText('The room is trapezoidal, not rectangular!', cx, 390);

            heightInfo.textContent = 'Person B is much farther from the peephole than A';
            peepholeFrame.classList.remove('active');
        }

        function draw3DView() {
            ctx.fillStyle = '#f5f5dc';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const cx = canvas.width / 2;
            const cy = canvas.height / 2;

            // Title
            ctx.fillStyle = '#3d4423';
            ctx.font = 'bold 16px Nunito';
            ctx.textAlign = 'center';
            ctx.fillText('3D Perspective - Drag to Rotate', cx, 25);

            // 3D projection of the trapezoidal room
            // Room vertices in 3D space (x, y, z) - origin at center
            const roomVerts = {
                // Front wall (viewer side) - appears as normal rectangle
                fl: { x: -100, y: -80, z: 50 },   // front-left
                fr: { x: 100, y: -80, z: 50 },    // front-right
                flt: { x: -100, y: 80, z: 50 },   // front-left-top
                frt: { x: 100, y: 80, z: 50 },    // front-right-top
                // Back wall - trapezoid (left side closer, right side farther)
                bl: { x: -80, y: -60, z: -80 },   // back-left (closer)
                br: { x: 120, y: -100, z: -200 }, // back-right (much farther)
                blt: { x: -80, y: 60, z: -80 },   // back-left-top
                brt: { x: 120, y: 100, z: -200 }, // back-right-top
            };

            // Apply rotation
            const cos = Math.cos(rotation3D);
            const sin = Math.sin(rotation3D);

            function rotateY(v) {
                return {
                    x: v.x * cos - v.z * sin,
                    y: v.y,
                    z: v.x * sin + v.z * cos
                };
            }

            function project(v) {
                const fov = 400;
                const scale = fov / (fov - v.z);
                return {
                    x: cx + v.x * scale,
                    y: cy - v.y * scale,
                    scale: scale
                };
            }

            // Rotate all vertices
            const rotated = {};
            for (let key in roomVerts) {
                rotated[key] = rotateY(roomVerts[key]);
            }

            // Project to 2D
            const projected = {};
            for (let key in rotated) {
                projected[key] = project(rotated[key]);
            }

            // Draw faces (back to front for proper occlusion)
            // Back wall
            ctx.fillStyle = wallColor;
            ctx.beginPath();
            ctx.moveTo(projected.bl.x, projected.bl.y);
            ctx.lineTo(projected.br.x, projected.br.y);
            ctx.lineTo(projected.brt.x, projected.brt.y);
            ctx.lineTo(projected.blt.x, projected.blt.y);
            ctx.closePath();
            ctx.fill();
            ctx.strokeStyle = lineColor;
            ctx.lineWidth = 2;
            ctx.stroke();

            // Floor
            ctx.fillStyle = floorColor;
            ctx.beginPath();
            ctx.moveTo(projected.fl.x, projected.fl.y);
            ctx.lineTo(projected.fr.x, projected.fr.y);
            ctx.lineTo(projected.br.x, projected.br.y);
            ctx.lineTo(projected.bl.x, projected.bl.y);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();

            // Left wall
            ctx.fillStyle = '#c0b090';
            ctx.beginPath();
            ctx.moveTo(projected.fl.x, projected.fl.y);
            ctx.lineTo(projected.bl.x, projected.bl.y);
            ctx.lineTo(projected.blt.x, projected.blt.y);
            ctx.lineTo(projected.flt.x, projected.flt.y);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();

            // Right wall
            ctx.beginPath();
            ctx.moveTo(projected.fr.x, projected.fr.y);
            ctx.lineTo(projected.br.x, projected.br.y);
            ctx.lineTo(projected.brt.x, projected.brt.y);
            ctx.lineTo(projected.frt.x, projected.frt.y);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();

            // Ceiling
            ctx.fillStyle = ceilingColor;
            ctx.beginPath();
            ctx.moveTo(projected.flt.x, projected.flt.y);
            ctx.lineTo(projected.frt.x, projected.frt.y);
            ctx.lineTo(projected.brt.x, projected.brt.y);
            ctx.lineTo(projected.blt.x, projected.blt.y);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();

            // Draw people in 3D space
            const personAZ = -80 + personAPos * (-200 - (-80));
            const personBZ = -80 + personBPos * (-200 - (-80));
            const personAX = -80 + personAPos * (120 - (-80));
            const personBX = -80 + personBPos * (120 - (-80));

            function drawPerson3D(px, pz, color, label) {
                const v = rotateY({ x: px, y: -60, z: pz });
                const p = project(v);
                const height = 50 * p.scale;
                drawPerson(p.x, p.y, height, color, label);
            }

            drawPerson3D(personAX, personAZ, personAColor, 'A');
            drawPerson3D(personBX, personBZ, personBColor, 'B');

            // Info
            ctx.fillStyle = '#3d4423';
            ctx.font = '13px Nunito';
            ctx.textAlign = 'center';
            ctx.fillText('Notice: Right corner is MUCH farther away!', cx, canvas.height - 20);

            heightInfo.textContent = 'Rotate to see the true trapezoidal shape';
            peepholeFrame.classList.remove('active');
        }

        function drawRevealView() {
            // Interpolate between illusion and reality
            const t = revealProgress;

            ctx.fillStyle = t < 0.5 ? '#1a1a1a' : `rgb(${Math.floor(26 + t * 219)}, ${Math.floor(26 + t * 219)}, ${Math.floor(26 + t * 194)})`;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const cx = canvas.width / 2;
            const cy = canvas.height / 2;

            // Room dimensions - interpolate from rectangular to trapezoidal
            const roomWidth = 350;
            const roomHeight = 250;
            const floorHeight = 80;

            // Back wall corners - interpolate
            const leftTopX = cx - roomWidth/2 + t * 100;
            const leftTopY = cy - roomHeight/2 + t * (-30);
            const rightTopX = cx + roomWidth/2 - t * 70;
            const rightTopY = cy - roomHeight/2 + t * 40;
            const leftBottomX = cx - roomWidth/2 + t * 70;
            const leftBottomY = cy + roomHeight/2 - floorHeight - t * 10;
            const rightBottomX = cx + roomWidth/2 - t * 30;
            const rightBottomY = cy + roomHeight/2 - floorHeight + t * 50;

            // Back wall
            ctx.fillStyle = wallColor;
            ctx.beginPath();
            ctx.moveTo(leftTopX, leftTopY);
            ctx.lineTo(rightTopX, rightTopY);
            ctx.lineTo(rightBottomX, rightBottomY);
            ctx.lineTo(leftBottomX, leftBottomY);
            ctx.closePath();
            ctx.fill();

            // Floor
            ctx.fillStyle = floorColor;
            ctx.beginPath();
            ctx.moveTo(leftBottomX, leftBottomY);
            ctx.lineTo(rightBottomX, rightBottomY);
            ctx.lineTo(cx + roomWidth/2 + 50 - t * 20, cy + roomHeight/2 + 50 + t * 30);
            ctx.lineTo(cx - roomWidth/2 - 50 + t * 20, cy + roomHeight/2 + 50 - t * 20);
            ctx.closePath();
            ctx.fill();

            // Draw checker pattern with distortion
            ctx.strokeStyle = 'rgba(0,0,0,0.2)';
            ctx.lineWidth = 1;

            for (let i = 0; i <= 8; i++) {
                const ratio = i / 8;
                const topX = leftBottomX + ratio * (rightBottomX - leftBottomX);
                const topY = leftBottomY + ratio * (rightBottomY - leftBottomY);
                const bottomX = (cx - roomWidth/2 - 50 + t * 20) + ratio * ((cx + roomWidth/2 + 50 - t * 20) - (cx - roomWidth/2 - 50 + t * 20));
                const bottomY = (cy + roomHeight/2 + 50 - t * 20) + ratio * ((cy + roomHeight/2 + 50 + t * 30) - (cy + roomHeight/2 + 50 - t * 20));
                ctx.beginPath();
                ctx.moveTo(topX, topY);
                ctx.lineTo(bottomX, bottomY);
                ctx.stroke();
            }

            // Windows - distorted
            const windowLeftX = leftTopX + 0.3 * (rightTopX - leftTopX);
            const windowRightX = leftTopX + 0.7 * (rightTopX - leftTopX);
            const windowLeftY = leftTopY + 0.3 * (rightTopY - leftTopY) + 20;
            const windowRightY = leftTopY + 0.7 * (rightTopY - leftTopY) + 20;
            const windowW1 = 60 - t * 15;
            const windowW2 = 60 + t * 15;

            drawWindowDistorted(windowLeftX, windowLeftY, windowW1, 80 - t * 10);
            drawWindowDistorted(windowRightX, windowRightY, windowW2, 80 + t * 10);

            // Draw people
            const personAScreenX = leftBottomX + personAPos * (rightBottomX - leftBottomX);
            const personBScreenX = leftBottomX + personBPos * (rightBottomX - leftBottomX);
            const personAScreenY = leftBottomY + personAPos * (rightBottomY - leftBottomY);
            const personBScreenY = leftBottomY + personBPos * (rightBottomY - leftBottomY);

            // Size interpolation: from illusory to real
            const illusionSizeA = 1.8 - personAPos * 1.2;
            const illusionSizeB = 1.8 - personBPos * 1.2;
            const realSize = 1.0;
            const sizeA = illusionSizeA + t * (realSize - illusionSizeA);
            const sizeB = illusionSizeB + t * (realSize - illusionSizeB);

            const basePersonHeight = 60;
            drawPerson(personAScreenX, personAScreenY, basePersonHeight * sizeA, personAColor, 'A');
            drawPerson(personBScreenX, personBScreenY, basePersonHeight * sizeB, personBColor, 'B');

            // Labels
            ctx.fillStyle = t < 0.5 ? 'white' : '#3d4423';
            ctx.font = 'bold 14px Nunito';
            ctx.textAlign = 'center';
            if (t < 0.3) {
                ctx.fillText('The Illusion: Room looks rectangular...', cx, 30);
            } else if (t < 0.7) {
                ctx.fillText('Revealing: Room is actually trapezoidal!', cx, 30);
            } else {
                ctx.fillText('Reality: Different distances cause size illusion', cx, 30);
            }

            const progressPct = Math.round(t * 100);
            heightInfo.textContent = `Reveal progress: ${progressPct}% | ${t < 0.5 ? 'Illusion' : 'Reality'}`;

            if (t < 0.5) {
                peepholeFrame.classList.add('active');
            } else {
                peepholeFrame.classList.remove('active');
            }
        }

        function drawWindowDistorted(x, y, w, h) {
            ctx.fillStyle = '#87ceeb';
            ctx.fillRect(x - w/2, y - h/2, w, h);
            ctx.strokeStyle = '#5d4e37';
            ctx.lineWidth = 3;
            ctx.strokeRect(x - w/2, y - h/2, w, h);
            ctx.beginPath();
            ctx.moveTo(x, y - h/2);
            ctx.lineTo(x, y + h/2);
            ctx.moveTo(x - w/2, y);
            ctx.lineTo(x + w/2, y);
            ctx.stroke();
        }

        function animateReveal() {
            if (viewMode !== 'reveal') return;

            revealProgress += revealDirection * 0.008;

            if (revealProgress >= 1) {
                revealProgress = 1;
                revealDirection = -1;
                setTimeout(() => {
                    if (viewMode === 'reveal') animating = true;
                }, 1500);
                animating = false;
            } else if (revealProgress <= 0) {
                revealProgress = 0;
                revealDirection = 1;
                setTimeout(() => {
                    if (viewMode === 'reveal') animating = true;
                }, 1500);
                animating = false;
            }

            drawRevealView();

            if (animating) {
                requestAnimationFrame(animateReveal);
            }
        }

        function drawCheckerPattern(cx, cy, roomWidth, roomHeight, floorHeight) {
            // Simple checker pattern on floor
            ctx.strokeStyle = 'rgba(0,0,0,0.2)';
            ctx.lineWidth = 1;

            const floorTop = cy + roomHeight/2 - floorHeight;
            const floorBottom = cy + roomHeight/2 + 50;

            for (let i = 0; i <= 8; i++) {
                const x1 = cx - roomWidth/2 + i * roomWidth/8;
                const x2 = cx - roomWidth/2 - 50 + i * (roomWidth + 100)/8;
                ctx.beginPath();
                ctx.moveTo(x1, floorTop);
                ctx.lineTo(x2, floorBottom);
                ctx.stroke();
            }

            for (let i = 0; i <= 4; i++) {
                const y = floorTop + i * (floorBottom - floorTop)/4;
                const xOffset = i * 12.5;
                ctx.beginPath();
                ctx.moveTo(cx - roomWidth/2 - xOffset, y);
                ctx.lineTo(cx + roomWidth/2 + xOffset, y);
                ctx.stroke();
            }
        }

        function drawWindow(x, y, w, h) {
            ctx.fillStyle = '#87ceeb';
            ctx.fillRect(x - w/2, y - h/2, w, h);
            ctx.strokeStyle = '#5d4e37';
            ctx.lineWidth = 3;
            ctx.strokeRect(x - w/2, y - h/2, w, h);
            // Cross
            ctx.beginPath();
            ctx.moveTo(x, y - h/2);
            ctx.lineTo(x, y + h/2);
            ctx.moveTo(x - w/2, y);
            ctx.lineTo(x + w/2, y);
            ctx.stroke();
        }

        function drawPerson(x, floorY, height, color, label) {
            // Head
            const headRadius = height * 0.15;
            const bodyTop = floorY - height + headRadius * 2;

            ctx.fillStyle = '#f4d9b0';
            ctx.beginPath();
            ctx.arc(x, floorY - height + headRadius, headRadius, 0, Math.PI * 2);
            ctx.fill();

            // Body
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.ellipse(x, floorY - height * 0.45, height * 0.12, height * 0.3, 0, 0, Math.PI * 2);
            ctx.fill();

            // Legs
            ctx.strokeStyle = color;
            ctx.lineWidth = height * 0.08;
            ctx.beginPath();
            ctx.moveTo(x - height * 0.05, floorY - height * 0.2);
            ctx.lineTo(x - height * 0.08, floorY);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x + height * 0.05, floorY - height * 0.2);
            ctx.lineTo(x + height * 0.08, floorY);
            ctx.stroke();

            // Label
            ctx.fillStyle = '#333';
            ctx.font = 'bold 14px Nunito';
            ctx.textAlign = 'center';
            ctx.fillText(label, x, floorY + 18);
        }

        function drawArrow(x1, y1, x2, y2) {
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.stroke();

            // Arrowhead
            const angle = Math.atan2(y2 - y1, x2 - x1);
            const headLen = 10;
            ctx.beginPath();
            ctx.moveTo(x2, y2);
            ctx.lineTo(x2 - headLen * Math.cos(angle - Math.PI/6), y2 - headLen * Math.sin(angle - Math.PI/6));
            ctx.lineTo(x2 - headLen * Math.cos(angle + Math.PI/6), y2 - headLen * Math.sin(angle + Math.PI/6));
            ctx.closePath();
            ctx.fillStyle = '#BC6C25';
            ctx.fill();
        }

        function draw() {
            switch(viewMode) {
                case 'peephole':
                    drawPeepholeView();
                    break;
                case 'reality':
                    drawRealityView();
                    break;
                case 'topdown':
                    drawTopDownView();
                    break;
                case '3d':
                    draw3DView();
                    break;
                case 'reveal':
                    drawRevealView();
                    break;
            }
        }

        // Event listeners
        btnPeephole.addEventListener('click', () => {
            viewMode = 'peephole';
            animating = false;
            document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
            btnPeephole.classList.add('active');
            draw();
        });

        btnReality.addEventListener('click', () => {
            viewMode = 'reality';
            animating = false;
            document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
            btnReality.classList.add('active');
            draw();
        });

        btnTopDown.addEventListener('click', () => {
            viewMode = 'topdown';
            animating = false;
            document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
            btnTopDown.classList.add('active');
            draw();
        });

        btn3D.addEventListener('click', () => {
            viewMode = '3d';
            animating = false;
            document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
            btn3D.classList.add('active');
            draw();
        });

        btnReveal.addEventListener('click', () => {
            viewMode = 'reveal';
            revealProgress = 0;
            revealDirection = 1;
            animating = true;
            document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
            btnReveal.classList.add('active');
            animateReveal();
        });

        // Drag to rotate in 3D view
        let isDragging = false;
        let lastMouseX = 0;

        canvas.addEventListener('mousedown', (e) => {
            if (viewMode === '3d') {
                isDragging = true;
                lastMouseX = e.clientX;
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            if (isDragging && viewMode === '3d') {
                const deltaX = e.clientX - lastMouseX;
                rotation3D += deltaX * 0.01;
                lastMouseX = e.clientX;
                draw();
            }
        });

        canvas.addEventListener('mouseup', () => {
            isDragging = false;
        });

        canvas.addEventListener('mouseleave', () => {
            isDragging = false;
        });

        // Touch support for 3D rotation
        canvas.addEventListener('touchstart', (e) => {
            if (viewMode === '3d') {
                isDragging = true;
                lastMouseX = e.touches[0].clientX;
            }
        });

        canvas.addEventListener('touchmove', (e) => {
            if (isDragging && viewMode === '3d') {
                const deltaX = e.touches[0].clientX - lastMouseX;
                rotation3D += deltaX * 0.01;
                lastMouseX = e.touches[0].clientX;
                draw();
                e.preventDefault();
            }
        });

        canvas.addEventListener('touchend', () => {
            isDragging = false;
        });

        personASlider.addEventListener('input', (e) => {
            personAPos = e.target.value / 100;
            draw();
        });

        personBSlider.addEventListener('input', (e) => {
            personBPos = e.target.value / 100;
            draw();
        });

        // Fix the var() usage in JS
        function getColor(varName) {
            return getComputedStyle(document.documentElement).getPropertyValue(varName).trim();
        }

        // Initialize
        draw();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
