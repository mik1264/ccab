<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ulam Spiral - Prime Numbers Form Mysterious Patterns</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        .back-link {
            display: inline-flex;
            align-items: center;
            color: #f59e0b;
            text-decoration: none;
            margin-bottom: 15px;
            font-size: 0.95em;
        }
        .back-link:hover {
            color: #fbbf24;
            text-decoration: underline;
        }
        h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
            color: #fff;
            text-shadow: 0 0 30px rgba(245, 158, 11, 0.5);
        }
        .subtitle {
            color: #fbbf24;
            margin-bottom: 20px;
            font-size: 1.05em;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
        }
        .canvas-container {
            background: rgba(0,0,0,0.4);
            border-radius: 12px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        canvas {
            border-radius: 8px;
            background: #0a0a0f;
            cursor: crosshair;
        }
        .hover-info {
            margin-top: 10px;
            font-size: 0.85em;
            color: #fbbf24;
            height: 20px;
        }
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .panel {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .panel h3 {
            font-size: 0.9em;
            color: #f59e0b;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 500;
            transition: all 0.2s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
        }
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #e0e0e0;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .btn-secondary:hover {
            background: rgba(255,255,255,0.2);
        }
        .btn-secondary.active {
            background: rgba(245, 158, 11, 0.3);
            border-color: #f59e0b;
        }
        .param-group {
            margin-bottom: 15px;
        }
        .param-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .param-name {
            color: #fbbf24;
            font-size: 0.85em;
        }
        .param-value {
            color: #fde68a;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.9em;
        }
        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255,255,255,0.1);
            -webkit-appearance: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #f59e0b;
            cursor: pointer;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .stat-label {
            color: #fbbf24;
            font-size: 0.8em;
        }
        .stat-value {
            color: #fde68a;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.8em;
        }
        .presets {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }
        .preset-btn {
            padding: 6px 8px;
            font-size: 0.75em;
        }
        .quadratic-info {
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
        }
        .quadratic-info p {
            font-size: 0.8em;
            color: #fbbf24;
            line-height: 1.5;
        }
        .quadratic-info code {
            background: rgba(245, 158, 11, 0.2);
            padding: 2px 6px;
            border-radius: 3px;
            color: #fde68a;
        }
        .exp-section {
            margin-top: 20px;
        }
        .exp-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }
        .exp-card {
            background: linear-gradient(135deg, rgba(245,158,11,0.1), rgba(217,119,6,0.05));
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(245,158,11,0.2);
        }
        .exp-card h4 {
            color: #f59e0b;
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        .exp-card p {
            font-size: 0.85em;
            line-height: 1.6;
            color: #fbbf24;
        }
        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">← Back to Paradoxes</a>
        <h1>The Ulam Spiral</h1>
        <p class="subtitle">Prime Numbers Form Mysterious Diagonal Patterns</p>

        <div class="main-content">
            <div class="canvas-container">
                <canvas id="mainCanvas" width="650" height="600"></canvas>
                <div class="hover-info" id="hoverInfo">Hover over a point to see its value</div>
            </div>

            <div class="sidebar">
                <div class="panel">
                    <h3>Size</h3>
                    <div class="param-group">
                        <div class="param-label">
                            <span class="param-name">Grid Size</span>
                            <span class="param-value" id="sizeValue">201×201</span>
                        </div>
                        <input type="range" id="sizeSlider" min="51" max="501" step="50" value="201">
                    </div>
                </div>

                <div class="panel">
                    <h3>Starting Number</h3>
                    <div class="presets">
                        <button class="btn btn-secondary preset-btn active" data-start="1">Start at 1</button>
                        <button class="btn btn-secondary preset-btn" data-start="41">Start at 41</button>
                        <button class="btn btn-secondary preset-btn" data-start="17">Start at 17</button>
                        <button class="btn btn-secondary preset-btn" data-start="0">Start at 0</button>
                    </div>
                    <div class="quadratic-info">
                        <p>Starting at <strong>41</strong> gives 40 primes in a row along the main diagonal—from Euler's famous polynomial <code>n² - n + 41</code>!</p>
                    </div>
                </div>

                <div class="panel">
                    <h3>Display</h3>
                    <div class="controls">
                        <button class="btn btn-secondary active" id="primesBtn">Primes Only</button>
                        <button class="btn btn-secondary" id="allBtn">All Numbers</button>
                    </div>
                </div>

                <div class="panel">
                    <h3>Statistics</h3>
                    <div class="stat-row">
                        <span class="stat-label">Numbers in spiral</span>
                        <span id="totalNumbers" class="stat-value">40,401</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Primes found</span>
                        <span id="primeCount" class="stat-value">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Prime density</span>
                        <span id="primeDensity" class="stat-value">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Largest prime</span>
                        <span id="largestPrime" class="stat-value">-</span>
                    </div>
                </div>

                <div class="panel">
                    <h3>Why Diagonals?</h3>
                    <p style="font-size: 0.8em; color: #fbbf24; line-height: 1.6;">
                        Diagonals in the spiral correspond to quadratic polynomials. Some polynomials (like n²−n+41) generate many primes. But WHY do primes cluster on these lines? It's related to unsolved Landau problems!
                    </p>
                </div>
            </div>
        </div>

        <div class="exp-section">
            <div class="exp-cards">
                <div class="exp-card">
                    <h4>Stanisław Ulam (1963)</h4>
                    <p>While doodling during a "long and very boring paper" at a scientific meeting, Polish-American mathematician Ulam wrote numbers in a spiral and circled the primes. He was shocked to see them form clear diagonal lines! The spiral appeared on Scientific American's cover in March 1964.</p>
                </div>
                <div class="exp-card">
                    <h4>Euler's Magic Polynomial</h4>
                    <p>The polynomial n² − n + 41 generates 40 consecutive primes (for n = 0 to 39). Starting the spiral at 41 makes this diagonal incredibly prominent. But NO polynomial generates primes forever—this is proven. Why does 41 work so well? Still mysterious!</p>
                </div>
                <div class="exp-card">
                    <h4>Quadratic Forms and Diagonals</h4>
                    <p>Any diagonal in the spiral represents numbers of form an² + bn + c. Some quadratics hit more primes than others. The visible diagonals correspond to quadratics with high "prime density"—but predicting which ones is connected to the unsolved Bunyakovsky conjecture!</p>
                </div>
                <div class="exp-card">
                    <h4>Arthur C. Clarke's Near-Miss</h4>
                    <p>In "The City and the Stars" (1956), Clarke described arranging integers in a spiral to study primes—seven years before Ulam! But Clarke never actually tried it. If he had, he would have discovered the diagonal patterns and beaten Ulam to one of math's most beautiful visualizations!</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');

        let gridSize = 201;
        let startNumber = 1;
        let showAll = false;
        let spiral = [];
        let primes = new Set();
        let gridToNumber = {};

        // Sieve of Eratosthenes
        function generatePrimes(max) {
            const sieve = new Array(max + 1).fill(true);
            sieve[0] = sieve[1] = false;
            for (let i = 2; i * i <= max; i++) {
                if (sieve[i]) {
                    for (let j = i * i; j <= max; j += i) {
                        sieve[j] = false;
                    }
                }
            }
            primes = new Set();
            for (let i = 2; i <= max; i++) {
                if (sieve[i]) primes.add(i);
            }
        }

        // Generate spiral coordinates
        function generateSpiral() {
            spiral = [];
            gridToNumber = {};
            const cx = Math.floor(gridSize / 2);
            const cy = Math.floor(gridSize / 2);

            let x = 0, y = 0;
            let dx = 1, dy = 0;
            let steps = 1, stepCount = 0, turnCount = 0;

            const total = gridSize * gridSize;

            for (let n = 0; n < total; n++) {
                const gx = cx + x;
                const gy = cy + y;
                const value = n + startNumber;
                spiral.push({ x: gx, y: gy, value });
                gridToNumber[`${gx},${gy}`] = value;

                // Move
                x += dx;
                y += dy;
                stepCount++;

                if (stepCount === steps) {
                    stepCount = 0;
                    // Turn left
                    [dx, dy] = [-dy, dx];
                    turnCount++;
                    if (turnCount === 2) {
                        turnCount = 0;
                        steps++;
                    }
                }
            }

            // Generate primes up to max value
            const maxValue = total + startNumber;
            generatePrimes(maxValue);
        }

        function draw() {
            const w = canvas.width;
            const h = canvas.height;

            ctx.fillStyle = '#0a0a0f';
            ctx.fillRect(0, 0, w, h);

            const cellSize = Math.min(w, h) / gridSize;
            const offsetX = (w - gridSize * cellSize) / 2;
            const offsetY = (h - gridSize * cellSize) / 2;

            let primeCount = 0;
            let largestPrime = 0;

            for (const point of spiral) {
                const isPrime = primes.has(point.value);
                if (isPrime) {
                    primeCount++;
                    largestPrime = Math.max(largestPrime, point.value);
                }

                if (showAll || isPrime) {
                    const px = offsetX + point.x * cellSize;
                    const py = offsetY + point.y * cellSize;

                    if (isPrime) {
                        // Color by value for visual interest
                        const hue = (point.value * 0.1) % 360;
                        ctx.fillStyle = `hsl(${hue}, 80%, 55%)`;
                    } else {
                        ctx.fillStyle = 'rgba(100, 100, 100, 0.3)';
                    }

                    const size = Math.max(1, cellSize * 0.8);
                    ctx.fillRect(px, py, size, size);
                }
            }

            // Update stats
            document.getElementById('totalNumbers').textContent = spiral.length.toLocaleString();
            document.getElementById('primeCount').textContent = primeCount.toLocaleString();
            document.getElementById('primeDensity').textContent = (primeCount / spiral.length * 100).toFixed(2) + '%';
            document.getElementById('largestPrime').textContent = largestPrime.toLocaleString();
        }

        // Mouse hover
        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            const mx = e.clientX - rect.left;
            const my = e.clientY - rect.top;

            const cellSize = Math.min(canvas.width, canvas.height) / gridSize;
            const offsetX = (canvas.width - gridSize * cellSize) / 2;
            const offsetY = (canvas.height - gridSize * cellSize) / 2;

            const gx = Math.floor((mx - offsetX) / cellSize);
            const gy = Math.floor((my - offsetY) / cellSize);

            const key = `${gx},${gy}`;
            const value = gridToNumber[key];

            if (value !== undefined) {
                const isPrime = primes.has(value);
                document.getElementById('hoverInfo').textContent =
                    `${value}${isPrime ? ' (PRIME)' : ''} at position (${gx - Math.floor(gridSize/2)}, ${gy - Math.floor(gridSize/2)})`;
            } else {
                document.getElementById('hoverInfo').textContent = 'Hover over a point to see its value';
            }
        });

        // Event handlers
        document.getElementById('sizeSlider').addEventListener('input', (e) => {
            gridSize = parseInt(e.target.value);
            document.getElementById('sizeValue').textContent = `${gridSize}×${gridSize}`;
            generateSpiral();
            draw();
        });

        document.querySelectorAll('.preset-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                startNumber = parseInt(btn.dataset.start);
                generateSpiral();
                draw();
            });
        });

        document.getElementById('primesBtn').addEventListener('click', () => {
            showAll = false;
            document.getElementById('primesBtn').classList.add('active');
            document.getElementById('allBtn').classList.remove('active');
            draw();
        });

        document.getElementById('allBtn').addEventListener('click', () => {
            showAll = true;
            document.getElementById('allBtn').classList.add('active');
            document.getElementById('primesBtn').classList.remove('active');
            draw();
        });

        // Initialize
        generateSpiral();
        draw();
    </script>
</body>
</html>
