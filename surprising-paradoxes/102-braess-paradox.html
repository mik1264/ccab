<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Braess's Paradox - When More Roads Mean More Traffic</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3a 50%, #0a1a2a 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5em;
            background: linear-gradient(135deg, #ff6b6b, #ffd700, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.3em;
            color: #aaa;
            font-style: italic;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #ff69b4;
            text-decoration: none;
            font-size: 1.1em;
            z-index: 100;
            transition: color 0.3s;
        }

        .back-link:hover {
            color: #ffd700;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 1000px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: rgba(30, 30, 60, 0.8);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 105, 180, 0.3);
        }

        .panel h2 {
            color: #ff69b4;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        canvas {
            width: 100%;
            border-radius: 10px;
            background: #0a0a15;
        }

        .controls {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .toggle-container {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        .toggle-label {
            flex: 1;
            font-size: 1.1em;
        }

        .toggle-switch {
            position: relative;
            width: 80px;
            height: 40px;
            background: #333;
            border-radius: 20px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch.active {
            background: linear-gradient(135deg, #ff6b6b, #ff4444);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 4px;
            left: 4px;
            width: 32px;
            height: 32px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        .toggle-switch.active::after {
            transform: translateX(40px);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .stat-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-label {
            font-size: 0.9em;
            color: #888;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.8em;
            font-family: monospace;
        }

        .stat-value.good {
            color: #00ff88;
        }

        .stat-value.bad {
            color: #ff6b6b;
        }

        .comparison {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 15px;
            padding: 15px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .comparison-item {
            text-align: center;
        }

        .comparison-label {
            font-size: 0.9em;
            color: #aaa;
        }

        .comparison-value {
            font-size: 1.5em;
            font-weight: bold;
        }

        .comparison-arrow {
            font-size: 2em;
            color: #ff6b6b;
        }

        .explanation {
            background: rgba(30, 30, 60, 0.8);
            border-radius: 15px;
            padding: 30px;
            border: 1px solid rgba(255, 215, 0, 0.3);
            margin-bottom: 30px;
        }

        .explanation h2 {
            color: #ffd700;
            margin-bottom: 20px;
        }

        .explanation p {
            line-height: 1.8;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .highlight {
            color: #ff69b4;
            font-weight: bold;
        }

        .paradox-box {
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.1), rgba(255, 215, 0, 0.1));
            border: 2px solid #ffd700;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            text-align: center;
        }

        .paradox-box h3 {
            color: #ffd700;
            font-size: 1.5em;
            margin-bottom: 15px;
        }

        .paradox-box p {
            font-size: 1.2em;
            color: #fff;
        }

        .route-legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .real-world {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid #00ff88;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
        }

        .real-world h2 {
            color: #00ff88;
            margin-bottom: 15px;
        }

        .example-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .example-card {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
        }

        .example-card h4 {
            color: #ffd700;
            margin-bottom: 10px;
        }

        .math-box {
            background: rgba(0, 0, 0, 0.4);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-family: 'Times New Roman', serif;
        }

        .math-box .formula {
            text-align: center;
            font-size: 1.2em;
            margin: 10px 0;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .speed-control label {
            color: #aaa;
        }

        input[type="range"] {
            flex: 1;
            height: 8px;
            -webkit-appearance: none;
            background: linear-gradient(90deg, #00ff88, #ffd700);
            border-radius: 4px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #fff;
            border-radius: 50%;
            cursor: pointer;
        }

        .game-theory {
            background: rgba(100, 100, 255, 0.1);
            border: 1px solid #6666ff;
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
        }

        .game-theory h3 {
            color: #6666ff;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Paradoxes</a>

    <div class="container">
        <header>
            <h1>üöó Braess's Paradox</h1>
            <p class="subtitle">When Building More Roads Makes Traffic WORSE</p>
        </header>

        <div class="main-grid">
            <div class="panel">
                <h2>üõ£Ô∏è Traffic Network Simulation</h2>
                <canvas id="networkCanvas" width="600" height="450"></canvas>
                <div class="route-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #00ff88;"></div>
                        <span>Top Route</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #00bfff;"></div>
                        <span>Bottom Route</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ff6b6b;"></div>
                        <span>Shortcut Route</span>
                    </div>
                </div>
                <div class="controls">
                    <div class="toggle-container">
                        <span class="toggle-label">üåâ Add Shortcut Bridge (2 min)</span>
                        <div class="toggle-switch" id="bridgeToggle"></div>
                    </div>
                    <div class="speed-control">
                        <label>Simulation Speed:</label>
                        <input type="range" id="speedSlider" min="0.5" max="3" step="0.1" value="1">
                        <span id="speedValue">1.0x</span>
                    </div>
                </div>
            </div>

            <div class="panel">
                <h2>üìä Travel Times (4,000 drivers)</h2>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-label">Without Bridge</div>
                        <div class="stat-value good" id="timeWithout">20</div>
                        <div style="font-size: 0.9em; color: #888;">minutes</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">With Bridge</div>
                        <div class="stat-value bad" id="timeWith">22</div>
                        <div style="font-size: 0.9em; color: #888;">minutes</div>
                    </div>
                </div>

                <div class="comparison">
                    <div class="comparison-item">
                        <div class="comparison-label">Current Travel Time</div>
                        <div class="comparison-value" id="currentTime" style="color: #00ff88;">20 min</div>
                    </div>
                    <div class="comparison-arrow" id="changeArrow" style="visibility: hidden;">‚Üí +2 min! üìà</div>
                </div>

                <div class="game-theory">
                    <h3>üéÆ Nash Equilibrium</h3>
                    <p style="font-size: 0.95em; line-height: 1.6; color: #ccc;">
                        Each driver selfishly picks their fastest route. When everyone does this,
                        they reach a <strong style="color: #ffd700;">Nash Equilibrium</strong>‚Äîno one can
                        improve by switching alone. But this equilibrium might be
                        <strong style="color: #ff6b6b;">worse for everyone</strong>!
                    </p>
                    <div id="equilibriumStatus" style="margin-top: 15px; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 8px; text-align: center;">
                        <strong>Without bridge:</strong> 2,000 top + 2,000 bottom = optimal split
                    </div>
                </div>

                <canvas id="graphCanvas" width="600" height="200" style="margin-top: 20px;"></canvas>
            </div>
        </div>

        <div class="explanation">
            <h2>ü§Ø The Mind-Bending Paradox</h2>

            <p>
                In 1968, German mathematician <span class="highlight">Dietrich Braess</span> discovered something
                that defies all intuition: <span class="highlight">adding a road to a traffic network can make
                everyone's commute LONGER</span>.
            </p>

            <div class="paradox-box">
                <h3>üöß The Paradox</h3>
                <p>
                    Building a "shortcut" that helps individuals can <strong style="color: #ff6b6b;">HURT</strong>
                    the collective! Each driver makes the rational choice, but together they create gridlock.
                </p>
            </div>

            <div class="math-box">
                <h4 style="color: #00ffff; margin-bottom: 15px;">The Classic Example:</h4>
                <p>4,000 cars travel from START to END. Two paths exist:</p>
                <div class="formula">
                    <strong>Top path:</strong> 15 min fixed + (cars/400) min congestion<br>
                    <strong>Bottom path:</strong> (cars/400) min congestion + 15 min fixed
                </div>
                <p style="margin-top: 15px;"><strong>Without shortcut:</strong> Cars split 50/50 ‚Üí Everyone takes <span style="color: #00ff88;">20 minutes</span></p>
                <p><strong>With shortcut:</strong> Everyone takes the "faster" route ‚Üí Everyone takes <span style="color: #ff6b6b;">22 minutes</span></p>
            </div>

            <p>
                The shortcut seems faster (only 2 minutes!), so every rational driver uses it.
                But when <em>everyone</em> uses it, the congestion-dependent roads become packed,
                and the "optimization" backfires spectacularly.
            </p>
        </div>

        <div class="real-world">
            <h2>üåç Real-World Examples</h2>
            <div class="example-grid">
                <div class="example-card">
                    <h4>üóΩ New York City (1990)</h4>
                    <p>When 42nd Street was closed on Earth Day, traffic engineers expected chaos.
                    Instead, <strong>traffic improved</strong> throughout Manhattan!</p>
                </div>
                <div class="example-card">
                    <h4>üá∞üá∑ Seoul, South Korea (1999)</h4>
                    <p>Closing one of three major tunnels led to <strong>faster travel times</strong>
                    for everyone‚Äîthe opposite of what planners expected.</p>
                </div>
                <div class="example-card">
                    <h4>üá©üá™ Stuttgart, Germany (1969)</h4>
                    <p>A new road built to reduce congestion actually <strong>increased travel times</strong>.
                    The original inspiration for Braess's research!</p>
                </div>
                <div class="example-card">
                    <h4>‚ö° Power Grids</h4>
                    <p>Adding transmission lines can destabilize electrical networks.
                    The same mathematics applies to electron flow!</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const networkCanvas = document.getElementById('networkCanvas');
        const networkCtx = networkCanvas.getContext('2d');
        const graphCanvas = document.getElementById('graphCanvas');
        const graphCtx = graphCanvas.getContext('2d');

        // State
        let bridgeEnabled = false;
        let simulationSpeed = 1;
        let cars = [];
        const TOTAL_CARS = 60; // Visual representation (scaled from 4000)

        // Network positions
        const nodes = {
            start: { x: 80, y: 225 },
            topMid: { x: 300, y: 100 },
            bottomMid: { x: 300, y: 350 },
            end: { x: 520, y: 225 }
        };

        // Road definitions
        const roads = {
            startToTop: { from: 'start', to: 'topMid', type: 'congestion' },
            startToBottom: { from: 'start', to: 'bottomMid', type: 'fixed' },
            topToEnd: { from: 'topMid', to: 'end', type: 'fixed' },
            bottomToEnd: { from: 'bottomMid', to: 'end', type: 'congestion' },
            shortcut: { from: 'topMid', to: 'bottomMid', type: 'shortcut' }
        };

        // Toggle bridge
        document.getElementById('bridgeToggle').addEventListener('click', function() {
            bridgeEnabled = !bridgeEnabled;
            this.classList.toggle('active', bridgeEnabled);
            redistributeCars();
            updateDisplay();
        });

        // Speed slider
        document.getElementById('speedSlider').addEventListener('input', function() {
            simulationSpeed = parseFloat(this.value);
            document.getElementById('speedValue').textContent = simulationSpeed.toFixed(1) + 'x';
        });

        function calculateTravelTime(route, carsOnRoute) {
            const totalCars = 4000;
            let carsTop, carsBottom, carsShortcut;

            if (!bridgeEnabled) {
                // Without bridge: split evenly
                carsTop = carsBottom = totalCars / 2;
                // Time = 15 + 2000/400 + 2000/400 + 15 = 20 for both routes
                // Actually: top = T/400 + 15, bottom = 15 + T/400
                // With 2000 each: top = 5 + 15 = 20, bottom = 15 + 5 = 20
                return 20;
            } else {
                // With bridge: everyone uses shortcut route
                // Route: start ‚Üí topMid (congestion) ‚Üí shortcut ‚Üí bottomMid ‚Üí end (congestion)
                // Time = 4000/400 + 2 + 4000/400 = 10 + 2 + 10 = 22
                return 22;
            }
        }

        function redistributeCars() {
            cars = [];
            for (let i = 0; i < TOTAL_CARS; i++) {
                let route;
                if (bridgeEnabled) {
                    // All cars use shortcut
                    route = 'shortcut';
                } else {
                    // Split between top and bottom
                    route = i < TOTAL_CARS / 2 ? 'top' : 'bottom';
                }
                cars.push({
                    route: route,
                    progress: Math.random(), // Random starting position
                    speed: 0.002 + Math.random() * 0.001
                });
            }
        }

        function updateDisplay() {
            const timeWithout = 20;
            const timeWith = 22;
            const currentTime = bridgeEnabled ? timeWith : timeWithout;

            document.getElementById('currentTime').textContent = currentTime + ' min';
            document.getElementById('currentTime').style.color = bridgeEnabled ? '#ff6b6b' : '#00ff88';

            const arrow = document.getElementById('changeArrow');
            arrow.style.visibility = bridgeEnabled ? 'visible' : 'hidden';

            const status = document.getElementById('equilibriumStatus');
            if (bridgeEnabled) {
                status.innerHTML = '<strong style="color: #ff6b6b;">With bridge:</strong> All 4,000 drivers use shortcut ‚Üí congestion!';
            } else {
                status.innerHTML = '<strong style="color: #00ff88;">Without bridge:</strong> 2,000 top + 2,000 bottom = optimal split';
            }

            drawGraph();
        }

        function getPointOnPath(route, progress) {
            let path;
            if (route === 'top') {
                // Start ‚Üí TopMid ‚Üí End
                if (progress < 0.5) {
                    const t = progress * 2;
                    return {
                        x: nodes.start.x + (nodes.topMid.x - nodes.start.x) * t,
                        y: nodes.start.y + (nodes.topMid.y - nodes.start.y) * t
                    };
                } else {
                    const t = (progress - 0.5) * 2;
                    return {
                        x: nodes.topMid.x + (nodes.end.x - nodes.topMid.x) * t,
                        y: nodes.topMid.y + (nodes.end.y - nodes.topMid.y) * t
                    };
                }
            } else if (route === 'bottom') {
                // Start ‚Üí BottomMid ‚Üí End
                if (progress < 0.5) {
                    const t = progress * 2;
                    return {
                        x: nodes.start.x + (nodes.bottomMid.x - nodes.start.x) * t,
                        y: nodes.start.y + (nodes.bottomMid.y - nodes.start.y) * t
                    };
                } else {
                    const t = (progress - 0.5) * 2;
                    return {
                        x: nodes.bottomMid.x + (nodes.end.x - nodes.bottomMid.x) * t,
                        y: nodes.bottomMid.y + (nodes.end.y - nodes.bottomMid.y) * t
                    };
                }
            } else {
                // Shortcut: Start ‚Üí TopMid ‚Üí BottomMid ‚Üí End
                if (progress < 0.33) {
                    const t = progress * 3;
                    return {
                        x: nodes.start.x + (nodes.topMid.x - nodes.start.x) * t,
                        y: nodes.start.y + (nodes.topMid.y - nodes.start.y) * t
                    };
                } else if (progress < 0.66) {
                    const t = (progress - 0.33) * 3;
                    return {
                        x: nodes.topMid.x + (nodes.bottomMid.x - nodes.topMid.x) * t,
                        y: nodes.topMid.y + (nodes.bottomMid.y - nodes.topMid.y) * t
                    };
                } else {
                    const t = (progress - 0.66) * 3;
                    return {
                        x: nodes.bottomMid.x + (nodes.end.x - nodes.bottomMid.x) * t,
                        y: nodes.bottomMid.y + (nodes.end.y - nodes.bottomMid.y) * t
                    };
                }
            }
        }

        function drawNetwork() {
            const w = networkCanvas.width;
            const h = networkCanvas.height;
            networkCtx.clearRect(0, 0, w, h);

            // Background
            const bgGrad = networkCtx.createLinearGradient(0, 0, w, h);
            bgGrad.addColorStop(0, '#0a0a15');
            bgGrad.addColorStop(1, '#151530');
            networkCtx.fillStyle = bgGrad;
            networkCtx.fillRect(0, 0, w, h);

            // Draw roads
            networkCtx.lineWidth = 12;
            networkCtx.lineCap = 'round';

            // Top route (congestion ‚Üí fixed)
            networkCtx.strokeStyle = bridgeEnabled ? '#336633' : '#00ff88';
            networkCtx.globalAlpha = bridgeEnabled ? 0.3 : 1;
            networkCtx.beginPath();
            networkCtx.moveTo(nodes.start.x, nodes.start.y);
            networkCtx.lineTo(nodes.topMid.x, nodes.topMid.y);
            networkCtx.lineTo(nodes.end.x, nodes.end.y);
            networkCtx.stroke();

            // Bottom route (fixed ‚Üí congestion)
            networkCtx.strokeStyle = bridgeEnabled ? '#336666' : '#00bfff';
            networkCtx.beginPath();
            networkCtx.moveTo(nodes.start.x, nodes.start.y);
            networkCtx.lineTo(nodes.bottomMid.x, nodes.bottomMid.y);
            networkCtx.lineTo(nodes.end.x, nodes.end.y);
            networkCtx.stroke();

            networkCtx.globalAlpha = 1;

            // Shortcut bridge (only if enabled)
            if (bridgeEnabled) {
                networkCtx.strokeStyle = '#ff6b6b';
                networkCtx.lineWidth = 8;
                networkCtx.setLineDash([10, 5]);
                networkCtx.beginPath();
                networkCtx.moveTo(nodes.topMid.x, nodes.topMid.y);
                networkCtx.lineTo(nodes.bottomMid.x, nodes.bottomMid.y);
                networkCtx.stroke();
                networkCtx.setLineDash([]);

                // Bridge label
                networkCtx.fillStyle = '#ff6b6b';
                networkCtx.font = 'bold 14px Georgia';
                networkCtx.fillText('2 min', nodes.topMid.x + 15, (nodes.topMid.y + nodes.bottomMid.y) / 2);
            }

            // Road labels
            networkCtx.font = '12px Georgia';
            networkCtx.fillStyle = '#aaa';

            // Top route labels
            networkCtx.fillText('T/400 min', (nodes.start.x + nodes.topMid.x) / 2 - 20, (nodes.start.y + nodes.topMid.y) / 2 - 15);
            networkCtx.fillText('(congestion)', (nodes.start.x + nodes.topMid.x) / 2 - 25, (nodes.start.y + nodes.topMid.y) / 2);
            networkCtx.fillText('15 min', (nodes.topMid.x + nodes.end.x) / 2, (nodes.topMid.y + nodes.end.y) / 2 - 15);
            networkCtx.fillText('(fixed)', (nodes.topMid.x + nodes.end.x) / 2 - 5, (nodes.topMid.y + nodes.end.y) / 2);

            // Bottom route labels
            networkCtx.fillText('15 min', (nodes.start.x + nodes.bottomMid.x) / 2 - 20, (nodes.start.y + nodes.bottomMid.y) / 2 + 25);
            networkCtx.fillText('(fixed)', (nodes.start.x + nodes.bottomMid.x) / 2 - 10, (nodes.start.y + nodes.bottomMid.y) / 2 + 40);
            networkCtx.fillText('T/400 min', (nodes.bottomMid.x + nodes.end.x) / 2, (nodes.bottomMid.y + nodes.end.y) / 2 + 25);
            networkCtx.fillText('(congestion)', (nodes.bottomMid.x + nodes.end.x) / 2 - 5, (nodes.bottomMid.y + nodes.end.y) / 2 + 40);

            // Draw nodes
            networkCtx.lineWidth = 3;
            for (const [name, pos] of Object.entries(nodes)) {
                networkCtx.beginPath();
                networkCtx.arc(pos.x, pos.y, 20, 0, Math.PI * 2);
                networkCtx.fillStyle = name === 'start' ? '#00ff88' : name === 'end' ? '#ff69b4' : '#ffd700';
                networkCtx.fill();
                networkCtx.strokeStyle = '#fff';
                networkCtx.stroke();

                networkCtx.fillStyle = '#000';
                networkCtx.font = 'bold 12px Georgia';
                networkCtx.textAlign = 'center';
                networkCtx.textBaseline = 'middle';
                const label = name === 'start' ? 'S' : name === 'end' ? 'E' : name === 'topMid' ? 'A' : 'B';
                networkCtx.fillText(label, pos.x, pos.y);
            }
            networkCtx.textAlign = 'left';
            networkCtx.textBaseline = 'alphabetic';

            // Draw cars
            for (const car of cars) {
                const pos = getPointOnPath(car.route, car.progress);
                networkCtx.beginPath();
                networkCtx.arc(pos.x, pos.y, 5, 0, Math.PI * 2);
                if (car.route === 'top') {
                    networkCtx.fillStyle = '#00ff88';
                } else if (car.route === 'bottom') {
                    networkCtx.fillStyle = '#00bfff';
                } else {
                    networkCtx.fillStyle = '#ff6b6b';
                }
                networkCtx.fill();
            }

            // Title
            networkCtx.fillStyle = bridgeEnabled ? '#ff6b6b' : '#00ff88';
            networkCtx.font = 'bold 16px Georgia';
            networkCtx.fillText(bridgeEnabled ? 'üåâ SHORTCUT ENABLED' : 'üõ£Ô∏è ORIGINAL NETWORK', 20, 30);
        }

        function drawGraph() {
            const w = graphCanvas.width;
            const h = graphCanvas.height;
            graphCtx.clearRect(0, 0, w, h);

            // Background
            graphCtx.fillStyle = '#0a0a15';
            graphCtx.fillRect(0, 0, w, h);

            const padding = 40;
            const graphW = w - padding * 2;
            const graphH = h - padding * 2;

            // Title
            graphCtx.fillStyle = '#888';
            graphCtx.font = '14px Georgia';
            graphCtx.fillText('Travel Time vs Shortcut Usage', padding, 25);

            // Axes
            graphCtx.strokeStyle = '#444';
            graphCtx.lineWidth = 1;
            graphCtx.beginPath();
            graphCtx.moveTo(padding, padding);
            graphCtx.lineTo(padding, h - padding);
            graphCtx.lineTo(w - padding, h - padding);
            graphCtx.stroke();

            // Y-axis labels
            graphCtx.fillStyle = '#888';
            graphCtx.font = '11px Georgia';
            graphCtx.textAlign = 'right';
            for (let t = 18; t <= 24; t += 2) {
                const y = h - padding - ((t - 18) / 6) * graphH;
                graphCtx.fillText(t + ' min', padding - 5, y + 4);
                graphCtx.strokeStyle = '#333';
                graphCtx.beginPath();
                graphCtx.moveTo(padding, y);
                graphCtx.lineTo(w - padding, y);
                graphCtx.stroke();
            }

            // X-axis labels
            graphCtx.textAlign = 'center';
            graphCtx.fillText('0%', padding, h - padding + 20);
            graphCtx.fillText('100%', w - padding, h - padding + 20);
            graphCtx.fillText('% using shortcut', w / 2, h - 10);

            // Draw the curve showing travel time as function of shortcut usage
            graphCtx.beginPath();
            graphCtx.strokeStyle = '#ffd700';
            graphCtx.lineWidth = 3;

            for (let p = 0; p <= 1; p += 0.01) {
                // p = fraction using shortcut
                // Shortcut users: T/400 + 2 + T/400 where T = 4000*p
                // Top-only: T1/400 + 15 where T1 = 4000*(1-p)/2
                // At equilibrium with shortcut available, everyone uses shortcut
                const shortcutTime = 4000 * p / 400 + 2 + 4000 * p / 400;
                const topTime = 4000 * (1 - p) / 2 / 400 + 15;

                // When shortcut exists, show the time
                const avgTime = p === 0 ? 20 : (p === 1 ? 22 : 20 + p * 2);

                const x = padding + p * graphW;
                const y = h - padding - ((avgTime - 18) / 6) * graphH;

                if (p === 0) graphCtx.moveTo(x, y);
                else graphCtx.lineTo(x, y);
            }
            graphCtx.stroke();

            // Mark current state
            const currentP = bridgeEnabled ? 1 : 0;
            const currentTime = bridgeEnabled ? 22 : 20;
            const markerX = padding + currentP * graphW;
            const markerY = h - padding - ((currentTime - 18) / 6) * graphH;

            graphCtx.beginPath();
            graphCtx.arc(markerX, markerY, 8, 0, Math.PI * 2);
            graphCtx.fillStyle = bridgeEnabled ? '#ff6b6b' : '#00ff88';
            graphCtx.fill();
            graphCtx.strokeStyle = '#fff';
            graphCtx.lineWidth = 2;
            graphCtx.stroke();

            // Labels for the two states
            graphCtx.font = 'bold 12px Georgia';
            graphCtx.fillStyle = '#00ff88';
            graphCtx.textAlign = 'left';
            graphCtx.fillText('No shortcut: 20 min', padding + 10, h - padding - ((20 - 18) / 6) * graphH - 10);

            graphCtx.fillStyle = '#ff6b6b';
            graphCtx.textAlign = 'right';
            graphCtx.fillText('All use shortcut: 22 min', w - padding - 10, h - padding - ((22 - 18) / 6) * graphH - 10);
        }

        function animate() {
            // Update car positions
            for (const car of cars) {
                car.progress += car.speed * simulationSpeed;
                if (car.progress > 1) {
                    car.progress = 0;
                }
            }

            drawNetwork();
            requestAnimationFrame(animate);
        }

        // Initialize
        redistributeCars();
        updateDisplay();
        animate();
    </script>
</body>
</html>
