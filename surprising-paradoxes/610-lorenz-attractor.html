<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lorenz Attractor - Surprising Paradoxes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0a0f15 0%, #151a25 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5em;
            background: linear-gradient(135deg, #e74c3c 0%, #f39c12 50%, #3498db 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2em;
            color: #888;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 20px;
        }

        @media (max-width: 1000px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .canvas-container {
            background: #000;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        #lorenzCanvas {
            display: block;
            width: 100%;
        }

        .info-overlay {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.85em;
            font-family: monospace;
        }

        .info-overlay span {
            color: #f39c12;
        }

        .controls {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
        }

        .control-section {
            margin-bottom: 25px;
        }

        .control-section h3 {
            color: #f39c12;
            margin-bottom: 15px;
            font-size: 1.1em;
            border-bottom: 1px solid rgba(243,156,18,0.3);
            padding-bottom: 8px;
        }

        .control-row {
            margin-bottom: 15px;
        }

        .control-row label {
            display: block;
            margin-bottom: 5px;
            color: #aaa;
            font-size: 0.9em;
        }

        .control-row input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }

        .control-row .value {
            text-align: right;
            font-family: monospace;
            color: #f39c12;
            font-size: 0.9em;
        }

        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        button {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #e74c3c, #f39c12);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(243,156,18,0.4);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #e0e0e0;
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.2);
        }

        .equations {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Times New Roman', serif;
            font-size: 0.95em;
            line-height: 1.8;
            color: #3498db;
        }

        .butterfly-demo {
            background: rgba(231,76,60,0.1);
            border: 1px solid rgba(231,76,60,0.3);
            border-radius: 8px;
            padding: 12px;
            margin-top: 15px;
        }

        .butterfly-title {
            color: #e74c3c;
            font-size: 0.9em;
            margin-bottom: 8px;
        }

        .butterfly-status {
            font-size: 0.85em;
            color: #aaa;
        }

        .divergence-meter {
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            margin-top: 8px;
            overflow: hidden;
        }

        .divergence-fill {
            height: 100%;
            background: linear-gradient(90deg, #2ecc71, #f39c12, #e74c3c);
            border-radius: 4px;
            transition: width 0.1s;
        }

        .explanation {
            margin-top: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .exp-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #f39c12;
        }

        .exp-card h3 {
            color: #f39c12;
            margin-bottom: 10px;
        }

        .exp-card p {
            color: #bbb;
            line-height: 1.6;
        }

        .back-link {
            display: inline-block;
            color: #f39c12;
            text-decoration: none;
            margin-bottom: 20px;
            transition: transform 0.2s;
        }

        .back-link:hover {
            transform: translateX(-5px);
        }

        .view-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
        }

        .view-btn {
            padding: 8px;
            font-size: 0.75em;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">← Back to Paradoxes</a>

        <header>
            <h1>The Lorenz Attractor</h1>
            <p class="subtitle">The butterfly that launched chaos theory</p>
        </header>

        <div class="main-content">
            <div class="canvas-container">
                <canvas id="lorenzCanvas" width="900" height="700"></canvas>
                <div class="info-overlay">
                    <div>Time: <span id="timeDisplay">0.00</span></div>
                    <div>Points: <span id="pointCount">0</span></div>
                    <div id="divergenceDisplay" style="display:none;">Divergence: <span id="divergence">0</span></div>
                </div>
            </div>

            <div class="controls">
                <div class="control-section">
                    <h3>Animation</h3>
                    <div class="btn-group">
                        <button class="btn-primary" id="playBtn">▶ Play</button>
                        <button class="btn-secondary" id="resetBtn">Reset</button>
                    </div>
                </div>

                <div class="control-section">
                    <h3>Parameters</h3>
                    <div class="control-row">
                        <label>σ (sigma) - Prandtl number</label>
                        <input type="range" id="sigmaSlider" min="1" max="20" step="0.5" value="10">
                        <div class="value">σ = <span id="sigmaValue">10</span></div>
                    </div>
                    <div class="control-row">
                        <label>ρ (rho) - Rayleigh number</label>
                        <input type="range" id="rhoSlider" min="1" max="50" step="0.5" value="28">
                        <div class="value">ρ = <span id="rhoValue">28</span></div>
                    </div>
                    <div class="control-row">
                        <label>β (beta) - Geometry factor</label>
                        <input type="range" id="betaSlider" min="0.5" max="5" step="0.1" value="2.667">
                        <div class="value">β = <span id="betaValue">2.667</span></div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>View Angle</h3>
                    <div class="view-buttons">
                        <button class="btn-secondary view-btn" data-view="xy">X-Y</button>
                        <button class="btn-secondary view-btn" data-view="xz">X-Z</button>
                        <button class="btn-secondary view-btn" data-view="yz">Y-Z</button>
                        <button class="btn-secondary view-btn" data-view="3d">3D Front</button>
                        <button class="btn-secondary view-btn" data-view="3dside">3D Side</button>
                        <button class="btn-secondary view-btn" data-view="3dtop">3D Top</button>
                    </div>
                </div>

                <div class="control-section">
                    <h3>Butterfly Effect Demo</h3>
                    <div class="btn-group">
                        <button class="btn-secondary" id="butterflyBtn">Show Two Trajectories</button>
                    </div>
                    <div class="butterfly-demo" id="butterflyDemo" style="display:none;">
                        <div class="butterfly-title">Initial Separation: 0.000001</div>
                        <div class="butterfly-status" id="butterflyStatus">Starting...</div>
                        <div class="divergence-meter">
                            <div class="divergence-fill" id="divergenceFill" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>Lorenz Equations</h3>
                    <div class="equations">
                        dx/dt = σ(y − x)<br>
                        dy/dt = x(ρ − z) − y<br>
                        dz/dt = xy − βz
                    </div>
                </div>
            </div>
        </div>

        <div class="explanation">
            <div class="exp-card">
                <h3>The Discovery (1961)</h3>
                <p>MIT meteorologist Edward Lorenz was running weather simulations when he tried to save time by entering conditions from a printout—rounded from 6 to 3 decimal places. The result diverged completely from the original. This tiny difference (0.0001%) led to totally different "weather." Long-term prediction was impossible!</p>
            </div>

            <div class="exp-card">
                <h3>The Butterfly Effect</h3>
                <p>"Does the flap of a butterfly's wings in Brazil set off a tornado in Texas?" Lorenz's famous 1972 title captured the essence: in chaotic systems, infinitesimal changes can cascade into enormous differences. The system is deterministic yet unpredictable—a profound paradox.</p>
            </div>

            <div class="exp-card">
                <h3>The Strange Attractor</h3>
                <p>Despite the chaos, trajectories don't fly off to infinity. They're bound to this butterfly-shaped "strange attractor"—an infinite, non-repeating path that never crosses itself. The attractor has fractal dimension ≈2.06, existing between a surface and a solid.</p>
            </div>

            <div class="exp-card">
                <h3>Why Weather is Hard</h3>
                <p>Lorenz proved that even perfect knowledge of physics can't enable long-term weather prediction. Beyond ~2 weeks, forecasts become meaningless—not due to poor models, but because chaos amplifies measurement errors exponentially. This is a fundamental limit, not a technological one.</p>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('lorenzCanvas');
        const ctx = canvas.getContext('2d');

        // Parameters
        let sigma = 10;
        let rho = 28;
        let beta = 8/3;

        // State
        let isPlaying = false;
        let showButterfly = false;
        let animationFrame = null;
        let time = 0;
        let dt = 0.005;

        // Trajectory storage
        let trail1 = [];
        let trail2 = [];
        const maxTrailLength = 8000;

        // View
        let viewMode = '3d';
        let rotationX = 0.3;
        let rotationZ = 0.7;

        // Initial conditions
        let x1, y1, z1;
        let x2, y2, z2;

        function resetTrajectories() {
            time = 0;
            trail1 = [];
            trail2 = [];

            // Initial conditions
            x1 = 1;
            y1 = 1;
            z1 = 1;

            // Slightly different initial condition for butterfly effect
            x2 = 1.000001;
            y2 = 1;
            z2 = 1;

            updateDisplay();
        }

        function lorenzDerivatives(x, y, z) {
            return {
                dx: sigma * (y - x),
                dy: x * (rho - z) - y,
                dz: x * y - beta * z
            };
        }

        function rk4Step(x, y, z, dt) {
            const k1 = lorenzDerivatives(x, y, z);
            const k2 = lorenzDerivatives(
                x + k1.dx * dt/2,
                y + k1.dy * dt/2,
                z + k1.dz * dt/2
            );
            const k3 = lorenzDerivatives(
                x + k2.dx * dt/2,
                y + k2.dy * dt/2,
                z + k2.dz * dt/2
            );
            const k4 = lorenzDerivatives(
                x + k3.dx * dt,
                y + k3.dy * dt,
                z + k3.dz * dt
            );

            return {
                x: x + (k1.dx + 2*k2.dx + 2*k3.dx + k4.dx) * dt / 6,
                y: y + (k1.dy + 2*k2.dy + 2*k3.dy + k4.dy) * dt / 6,
                z: z + (k1.dz + 2*k2.dz + 2*k3.dz + k4.dz) * dt / 6
            };
        }

        function project(x, y, z) {
            const cx = canvas.width / 2;
            const cy = canvas.height / 2;
            const scale = 12;

            if (viewMode === 'xy') {
                return { x: cx + x * scale, y: cy - y * scale };
            } else if (viewMode === 'xz') {
                return { x: cx + x * scale, y: cy - (z - 25) * scale };
            } else if (viewMode === 'yz') {
                return { x: cx + y * scale, y: cy - (z - 25) * scale };
            } else {
                // 3D projection
                let rx = rotationX;
                let rz = rotationZ;

                if (viewMode === '3dside') {
                    rz = 0;
                } else if (viewMode === '3dtop') {
                    rx = Math.PI / 2;
                }

                // Rotate around Z axis
                const x1 = x * Math.cos(rz) - y * Math.sin(rz);
                const y1 = x * Math.sin(rz) + y * Math.cos(rz);

                // Rotate around X axis
                const y2 = y1 * Math.cos(rx) - (z - 25) * Math.sin(rx);
                const z2 = y1 * Math.sin(rx) + (z - 25) * Math.cos(rx);

                return { x: cx + x1 * scale, y: cy - y2 * scale };
            }
        }

        function draw() {
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw trail 1
            if (trail1.length > 1) {
                ctx.beginPath();
                for (let i = 0; i < trail1.length - 1; i++) {
                    const p1 = project(trail1[i].x, trail1[i].y, trail1[i].z);
                    const p2 = project(trail1[i+1].x, trail1[i+1].y, trail1[i+1].z);

                    const alpha = (i / trail1.length) * 0.8 + 0.2;
                    const hue = 30 + (i / trail1.length) * 30;

                    ctx.strokeStyle = `hsla(${hue}, 80%, 55%, ${alpha})`;
                    ctx.lineWidth = 1 + (i / trail1.length);

                    ctx.beginPath();
                    ctx.moveTo(p1.x, p1.y);
                    ctx.lineTo(p2.x, p2.y);
                    ctx.stroke();
                }
            }

            // Draw trail 2 if butterfly effect mode
            if (showButterfly && trail2.length > 1) {
                for (let i = 0; i < trail2.length - 1; i++) {
                    const p1 = project(trail2[i].x, trail2[i].y, trail2[i].z);
                    const p2 = project(trail2[i+1].x, trail2[i+1].y, trail2[i+1].z);

                    const alpha = (i / trail2.length) * 0.8 + 0.2;
                    const hue = 200 + (i / trail2.length) * 30;

                    ctx.strokeStyle = `hsla(${hue}, 80%, 55%, ${alpha})`;
                    ctx.lineWidth = 1 + (i / trail2.length);

                    ctx.beginPath();
                    ctx.moveTo(p1.x, p1.y);
                    ctx.lineTo(p2.x, p2.y);
                    ctx.stroke();
                }

                // Update butterfly effect display
                updateButterflyStatus();
            }

            // Draw current points
            const p1 = project(x1, y1, z1);
            ctx.beginPath();
            ctx.arc(p1.x, p1.y, 5, 0, Math.PI * 2);
            ctx.fillStyle = '#f39c12';
            ctx.fill();

            if (showButterfly) {
                const p2 = project(x2, y2, z2);
                ctx.beginPath();
                ctx.arc(p2.x, p2.y, 5, 0, Math.PI * 2);
                ctx.fillStyle = '#3498db';
                ctx.fill();
            }
        }

        function updateButterflyStatus() {
            const distance = Math.sqrt(
                (x1 - x2) ** 2 +
                (y1 - y2) ** 2 +
                (z1 - z2) ** 2
            );

            document.getElementById('butterflyStatus').textContent =
                `Current separation: ${distance.toFixed(4)}`;

            const maxDiv = 50;
            const percent = Math.min(100, (distance / maxDiv) * 100);
            document.getElementById('divergenceFill').style.width = percent + '%';
        }

        function updateDisplay() {
            document.getElementById('timeDisplay').textContent = time.toFixed(2);
            document.getElementById('pointCount').textContent = trail1.length;
        }

        function animate() {
            if (!isPlaying) return;

            // Multiple integration steps per frame
            for (let i = 0; i < 5; i++) {
                const new1 = rk4Step(x1, y1, z1, dt);
                x1 = new1.x; y1 = new1.y; z1 = new1.z;

                trail1.push({ x: x1, y: y1, z: z1 });
                if (trail1.length > maxTrailLength) trail1.shift();

                if (showButterfly) {
                    const new2 = rk4Step(x2, y2, z2, dt);
                    x2 = new2.x; y2 = new2.y; z2 = new2.z;

                    trail2.push({ x: x2, y: y2, z: z2 });
                    if (trail2.length > maxTrailLength) trail2.shift();
                }

                time += dt;
            }

            draw();
            updateDisplay();
            animationFrame = requestAnimationFrame(animate);
        }

        function play() {
            isPlaying = true;
            document.getElementById('playBtn').textContent = '⏸ Pause';
            animate();
        }

        function pause() {
            isPlaying = false;
            document.getElementById('playBtn').textContent = '▶ Play';
            if (animationFrame) cancelAnimationFrame(animationFrame);
        }

        // Event listeners
        document.getElementById('playBtn').addEventListener('click', () => {
            if (isPlaying) pause();
            else play();
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            pause();
            resetTrajectories();
            draw();
        });

        document.getElementById('sigmaSlider').addEventListener('input', (e) => {
            sigma = parseFloat(e.target.value);
            document.getElementById('sigmaValue').textContent = sigma;
        });

        document.getElementById('rhoSlider').addEventListener('input', (e) => {
            rho = parseFloat(e.target.value);
            document.getElementById('rhoValue').textContent = rho;
        });

        document.getElementById('betaSlider').addEventListener('input', (e) => {
            beta = parseFloat(e.target.value);
            document.getElementById('betaValue').textContent = beta.toFixed(3);
        });

        document.querySelectorAll('.view-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                viewMode = btn.dataset.view;
                draw();
            });
        });

        document.getElementById('butterflyBtn').addEventListener('click', () => {
            showButterfly = !showButterfly;
            document.getElementById('butterflyDemo').style.display =
                showButterfly ? 'block' : 'none';
            document.getElementById('butterflyBtn').textContent =
                showButterfly ? 'Hide Second Trajectory' : 'Show Two Trajectories';

            if (showButterfly) {
                // Reset with slightly different initial conditions
                resetTrajectories();
            }
            draw();
        });

        // Drag to rotate (3D views)
        let isDragging = false;
        let lastMouseX, lastMouseY;

        canvas.addEventListener('mousedown', (e) => {
            if (viewMode.startsWith('3d')) {
                isDragging = true;
                lastMouseX = e.clientX;
                lastMouseY = e.clientY;
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            if (isDragging) {
                const dx = e.clientX - lastMouseX;
                const dy = e.clientY - lastMouseY;
                rotationZ += dx * 0.01;
                rotationX += dy * 0.01;
                lastMouseX = e.clientX;
                lastMouseY = e.clientY;
                draw();
            }
        });

        canvas.addEventListener('mouseup', () => isDragging = false);
        canvas.addEventListener('mouseleave', () => isDragging = false);

        // Initialize
        resetTrajectories();
        draw();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
