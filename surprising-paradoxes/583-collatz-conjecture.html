<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Collatz Conjecture - Mathematics' Simplest Impossible Problem</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a0a2e 0%, #2d1b4e 50%, #0f0f2e 100%);
            min-height: 100vh;
            color: #e0e0e0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #667eea, #764ba2, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #a08adc;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
            margin-top: 20px;
        }

        .canvas-container {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(102, 126, 234, 0.2);
        }

        canvas {
            display: block;
            width: 100%;
            background: #0a0a1a;
            border-radius: 10px;
        }

        .controls {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(102, 126, 234, 0.2);
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            color: #667eea;
            margin-bottom: 8px;
            font-weight: 500;
        }

        input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            color: #fff;
            font-size: 1.2rem;
            font-family: monospace;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
        }

        .button-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        button {
            padding: 12px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .control-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #fff;
            font-size: 1rem;
        }

        .control-btn:hover {
            background: linear-gradient(135deg, #764ba2, #667eea);
            transform: scale(1.02);
        }

        .preset-btn {
            background: linear-gradient(135deg, #2a1a4e, #3a2a5e);
            color: #e0e0e0;
            border: 1px solid rgba(102, 126, 234, 0.3);
            font-size: 0.9rem;
        }

        .preset-btn:hover {
            background: linear-gradient(135deg, #3a2a5e, #4a3a6e);
            border-color: #667eea;
        }

        .stats {
            background: rgba(102, 126, 234, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid rgba(102, 126, 234, 0.1);
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #a08adc;
        }

        .stat-value {
            color: #667eea;
            font-family: monospace;
        }

        .sequence-display {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            max-height: 150px;
            overflow-y: auto;
        }

        .sequence-title {
            color: #764ba2;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .sequence-numbers {
            font-family: monospace;
            font-size: 0.85rem;
            color: #bbb;
            word-wrap: break-word;
        }

        .sequence-numbers span.even {
            color: #667eea;
        }

        .sequence-numbers span.odd {
            color: #f093fb;
        }

        .rule-box {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            border-left: 3px solid #764ba2;
        }

        .rule-title {
            color: #764ba2;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .rule {
            font-family: monospace;
            font-size: 1rem;
            color: #ddd;
            margin: 8px 0;
            padding: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }

        .quote-box {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            font-style: italic;
            color: #a08adc;
            text-align: center;
        }

        .quote-author {
            margin-top: 10px;
            font-style: normal;
            color: #667eea;
        }

        .explanation {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .exp-card {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(102, 126, 234, 0.2);
        }

        .exp-card h3 {
            color: #667eea;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .exp-card p {
            line-height: 1.7;
            color: #bbb;
        }

        .highlight {
            color: #f093fb;
            font-weight: 500;
        }

        .back-link {
            display: inline-block;
            color: #667eea;
            text-decoration: none;
            margin-bottom: 20px;
            transition: transform 0.3s;
        }

        .back-link:hover {
            transform: translateX(-5px);
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê Back to Paradoxes</a>

        <header>
            <h1>The Collatz Conjecture</h1>
            <p class="subtitle">3n + 1: the simplest problem no one can solve</p>
        </header>

        <div class="main-content">
            <div class="canvas-container">
                <canvas id="collatzCanvas" width="800" height="550"></canvas>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label>Starting Number</label>
                    <input type="number" id="numberInput" value="27" min="1" max="1000000">
                </div>

                <div class="control-group">
                    <div class="button-row">
                        <button class="control-btn" id="runBtn">‚ñ∂ Run Sequence</button>
                        <button class="control-btn" id="animateBtn">üé¨ Animate</button>
                    </div>
                </div>

                <div class="control-group">
                    <label>Famous Numbers</label>
                    <div class="button-row">
                        <button class="preset-btn" data-num="27">27 (111 steps)</button>
                        <button class="preset-btn" data-num="97">97 (118 steps)</button>
                        <button class="preset-btn" data-num="871">871 (178 steps)</button>
                        <button class="preset-btn" data-num="6171">6171 (261 steps)</button>
                    </div>
                </div>

                <div class="stats">
                    <div class="stat-row">
                        <span class="stat-label">Starting Number</span>
                        <span class="stat-value" id="startNum">27</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Steps to Reach 1</span>
                        <span class="stat-value" id="stepCount">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Maximum Value</span>
                        <span class="stat-value" id="maxValue">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Even/Odd Operations</span>
                        <span class="stat-value" id="evenOdd">-</span>
                    </div>
                </div>

                <div class="sequence-display">
                    <div class="sequence-title">Sequence</div>
                    <div class="sequence-numbers" id="sequenceText">-</div>
                </div>

                <div class="rule-box">
                    <div class="rule-title">The Rules</div>
                    <div class="rule">If n is even: n ‚Üí n √∑ 2</div>
                    <div class="rule">If n is odd: n ‚Üí 3n + 1</div>
                </div>

                <div class="quote-box">
                    "Mathematics may not be ready for such problems."
                    <div class="quote-author">‚Äî Paul Erd≈ës</div>
                </div>
            </div>
        </div>

        <div class="explanation">
            <div class="exp-card">
                <h3>‚ùì The Problem</h3>
                <p>
                    Pick any positive integer. If even, divide by 2. If odd, multiply by 3 and add 1.
                    Repeat. <span class="highlight">Does every number eventually reach 1?</span>
                    Despite its kindergarten-level rules, this 1937 conjecture remains unsolved.
                    Verified up to 2.36√ó10¬≤¬π... but that's not a proof!
                </p>
            </div>

            <div class="exp-card">
                <h3>üé¢ Wild Journeys</h3>
                <p>
                    The number <span class="highlight">27</span> takes 111 steps and climbs to
                    9,232 before crashing down to 1. The number 77,031 takes 350 steps! Some
                    sequences soar to astronomical heights before finally descending. The chaotic
                    behavior defies pattern recognition.
                </p>
            </div>

            <div class="exp-card">
                <h3>üèÜ Terence Tao (2020)</h3>
                <p>
                    Fields Medalist Tao proved the conjecture holds for <span class="highlight">
                    "almost all"</span> integers (in a technical sense). But "almost all" isn't
                    "all"‚Äîthere could still be a counter-example hiding among the infinite
                    integers. The complete proof remains elusive.
                </p>
            </div>

            <div class="exp-card">
                <h3>üå≥ Hidden Structure</h3>
                <p>
                    Every integer connects to 1 via a tree-like graph. Odd numbers have
                    <span class="highlight">one child</span> (3n+1), while evens have multiple
                    predecessors (n√ó2, and sometimes (n-1)/3). This "inverse tree" reveals
                    beautiful fractal-like patterns‚Äîyet proves nothing about the conjecture!
                </p>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('collatzCanvas');
        const ctx = canvas.getContext('2d');

        // High DPI support
        const dpr = window.devicePixelRatio || 1;
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width * dpr;
        canvas.height = rect.height * dpr;
        ctx.scale(dpr, dpr);
        const W = rect.width;
        const H = rect.height;

        let currentSequence = [];
        let animationFrame = 0;
        let isAnimating = false;
        let animationId = null;

        // Generate Collatz sequence
        function collatz(n) {
            const seq = [n];
            let max = n;
            let evenCount = 0;
            let oddCount = 0;

            while (n !== 1 && seq.length < 10000) {
                if (n % 2 === 0) {
                    n = n / 2;
                    evenCount++;
                } else {
                    n = 3 * n + 1;
                    oddCount++;
                }
                seq.push(n);
                max = Math.max(max, n);
            }

            return { sequence: seq, max, evenCount, oddCount };
        }

        // Draw the sequence graph
        function drawGraph(seq, highlightIndex = -1) {
            ctx.fillStyle = '#0a0a1a';
            ctx.fillRect(0, 0, W, H);

            if (seq.length < 2) return;

            const margin = { top: 40, right: 30, bottom: 50, left: 70 };
            const chartW = W - margin.left - margin.right;
            const chartH = H - margin.top - margin.bottom;

            // Find max for scaling
            const maxVal = Math.max(...seq);
            const useLog = maxVal > 1000;

            // Scale function
            const scaleY = (val) => {
                if (useLog) {
                    return margin.top + chartH * (1 - Math.log10(val + 1) / Math.log10(maxVal + 1));
                }
                return margin.top + chartH * (1 - val / maxVal);
            };

            // Draw grid
            ctx.strokeStyle = 'rgba(102, 126, 234, 0.1)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const y = margin.top + (chartH * i / 5);
                ctx.beginPath();
                ctx.moveTo(margin.left, y);
                ctx.lineTo(W - margin.right, y);
                ctx.stroke();
            }

            // Y-axis labels
            ctx.fillStyle = '#666';
            ctx.font = '11px sans-serif';
            ctx.textAlign = 'right';
            for (let i = 0; i <= 5; i++) {
                const y = margin.top + (chartH * i / 5);
                let val;
                if (useLog) {
                    val = Math.pow(10, Math.log10(maxVal + 1) * (1 - i / 5)) - 1;
                } else {
                    val = maxVal * (1 - i / 5);
                }
                ctx.fillText(val >= 1000 ? (val / 1000).toFixed(1) + 'k' : Math.round(val).toString(), margin.left - 10, y + 4);
            }

            // X-axis label
            ctx.fillStyle = '#888';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Step', W / 2, H - 10);
            ctx.fillText(useLog ? 'Value (log scale)' : 'Value', margin.left - 40, margin.top - 15);

            // Draw sequence
            const stepW = chartW / (highlightIndex >= 0 ? Math.min(seq.length, highlightIndex + 2) : seq.length);
            const displayLength = highlightIndex >= 0 ? highlightIndex + 1 : seq.length;

            // Draw line
            ctx.beginPath();
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 2;
            for (let i = 0; i < displayLength; i++) {
                const x = margin.left + i * stepW;
                const y = scaleY(seq[i]);
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();

            // Draw points
            for (let i = 0; i < displayLength; i++) {
                const x = margin.left + i * stepW;
                const y = scaleY(seq[i]);

                // Color based on even/odd
                ctx.fillStyle = seq[i] % 2 === 0 ? '#667eea' : '#f093fb';
                ctx.beginPath();
                ctx.arc(x, y, seq.length < 100 ? 3 : 2, 0, Math.PI * 2);
                ctx.fill();
            }

            // Highlight current point in animation
            if (highlightIndex >= 0 && highlightIndex < seq.length) {
                const x = margin.left + highlightIndex * stepW;
                const y = scaleY(seq[highlightIndex]);

                ctx.fillStyle = '#fff';
                ctx.beginPath();
                ctx.arc(x, y, 6, 0, Math.PI * 2);
                ctx.fill();

                // Value label
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 14px monospace';
                ctx.textAlign = 'center';
                ctx.fillText(seq[highlightIndex].toLocaleString(), x, y - 15);
            }

            // Title
            ctx.fillStyle = '#fff';
            ctx.font = '16px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText(`Collatz Sequence for ${seq[0]}`, margin.left, 25);
        }

        // Update stats display
        function updateStats(result) {
            document.getElementById('startNum').textContent = result.sequence[0].toLocaleString();
            document.getElementById('stepCount').textContent = (result.sequence.length - 1).toLocaleString();
            document.getElementById('maxValue').textContent = result.max.toLocaleString();
            document.getElementById('evenOdd').textContent = `${result.evenCount} / ${result.oddCount}`;

            // Format sequence
            const seqHtml = result.sequence.slice(0, 50).map(n =>
                `<span class="${n % 2 === 0 ? 'even' : 'odd'}">${n}</span>`
            ).join(' ‚Üí ');
            document.getElementById('sequenceText').innerHTML =
                seqHtml + (result.sequence.length > 50 ? ' ‚Üí ...' : '');
        }

        // Run sequence
        function runSequence(n) {
            if (animationId) {
                cancelAnimationFrame(animationId);
                isAnimating = false;
            }

            const result = collatz(n);
            currentSequence = result.sequence;
            drawGraph(currentSequence);
            updateStats(result);
        }

        // Animate sequence
        function animateSequence(n) {
            if (animationId) {
                cancelAnimationFrame(animationId);
            }

            const result = collatz(n);
            currentSequence = result.sequence;
            updateStats(result);

            animationFrame = 0;
            isAnimating = true;

            function animate() {
                if (animationFrame < currentSequence.length) {
                    drawGraph(currentSequence, animationFrame);
                    animationFrame++;
                    const speed = Math.max(16, 100 - currentSequence.length / 10);
                    animationId = setTimeout(() => requestAnimationFrame(animate), speed);
                } else {
                    isAnimating = false;
                    drawGraph(currentSequence);
                }
            }
            animate();
        }

        // Event listeners
        document.getElementById('runBtn').addEventListener('click', () => {
            const n = parseInt(document.getElementById('numberInput').value) || 1;
            runSequence(Math.max(1, Math.min(n, 10000000)));
        });

        document.getElementById('animateBtn').addEventListener('click', () => {
            const n = parseInt(document.getElementById('numberInput').value) || 1;
            animateSequence(Math.max(1, Math.min(n, 10000000)));
        });

        document.getElementById('numberInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const n = parseInt(e.target.value) || 1;
                runSequence(Math.max(1, Math.min(n, 10000000)));
            }
        });

        document.querySelectorAll('.preset-btn[data-num]').forEach(btn => {
            btn.addEventListener('click', () => {
                const n = parseInt(btn.dataset.num);
                document.getElementById('numberInput').value = n;
                runSequence(n);
            });
        });

        // Initial render
        runSequence(27);
    </script>
</body>
</html>
