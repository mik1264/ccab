<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P√≥lya's Random Walk - The Drunk Man and the Drunk Bird</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e8e8e8;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 25px;
        }

        h1 {
            font-size: 2.2rem;
            background: linear-gradient(135deg, #9b59b6, #3498db, #2ecc71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #aaa;
            font-size: 1.1rem;
        }

        .quote {
            font-style: italic;
            color: #f39c12;
            margin-top: 10px;
            font-size: 1rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 25px;
        }

        @media (max-width: 1100px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .viz-section {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
        }

        .walk-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        @media (max-width: 800px) {
            .walk-container {
                grid-template-columns: 1fr;
            }
        }

        .walk-box {
            text-align: center;
        }

        .walk-box h3 {
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .walk-2d h3 { color: #3498db; }
        .walk-3d h3 { color: #9b59b6; }

        canvas {
            border-radius: 8px;
            background: #111;
        }

        .walk-stats {
            margin-top: 10px;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 0.85rem;
        }

        .stat-label {
            color: #888;
        }

        .stat-val-2d { color: #3498db; font-weight: bold; }
        .stat-val-3d { color: #9b59b6; font-weight: bold; }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: #fff;
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #fff;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .param-group {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
        }

        .param-group label {
            font-size: 0.85rem;
            color: #aaa;
        }

        .param-value {
            color: #9b59b6;
            font-weight: bold;
            min-width: 50px;
        }

        input[type="range"] {
            width: 100px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .result-box {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .result-box.box-2d { border-left: 4px solid #3498db; }
        .result-box.box-3d { border-left: 4px solid #9b59b6; }

        .result-title {
            font-size: 0.8rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }

        .result-value {
            font-size: 2rem;
            font-weight: bold;
        }

        .result-value.val-2d { color: #3498db; }
        .result-value.val-3d { color: #9b59b6; }

        .result-theory {
            font-size: 0.75rem;
            color: #666;
            margin-top: 5px;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .exp-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 18px;
            border-left: 4px solid #9b59b6;
        }

        .exp-card h3 {
            color: #9b59b6;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .exp-card p {
            color: #ccc;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .formula {
            background: rgba(0,0,0,0.4);
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            color: #9b59b6;
            text-align: center;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #9b59b6;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            opacity: 0.8;
            transition: opacity 0.3s;
            z-index: 100;
        }

        .back-link:hover {
            opacity: 1;
        }

        .highlight-2d {
            color: #3498db;
            font-weight: bold;
        }

        .highlight-3d {
            color: #9b59b6;
            font-weight: bold;
        }

        .dimension-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .badge-2d { background: rgba(52, 152, 219, 0.3); color: #3498db; }
        .badge-3d { background: rgba(155, 89, 182, 0.3); color: #9b59b6; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Paradoxes</a>

    <div class="container">
        <header>
            <h1>P√≥lya's Random Walk Theorem</h1>
            <p class="subtitle">George P√≥lya (1921) - Recurrence vs. Transience</p>
            <p class="quote">"A drunk man will find his way home, but a drunk bird may get lost forever." ‚Äî Shizuo Kakutani</p>
        </header>

        <div class="main-content">
            <div class="viz-section">
                <div class="walk-container">
                    <div class="walk-box walk-2d">
                        <h3>üö∂ 2D Random Walk (Drunk Man)</h3>
                        <canvas id="canvas2D" width="350" height="350"></canvas>
                        <div class="walk-stats">
                            <div class="stat-row">
                                <span class="stat-label">Steps:</span>
                                <span class="stat-val-2d" id="steps2D">0</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Returns to Origin:</span>
                                <span class="stat-val-2d" id="returns2D">0</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Max Distance:</span>
                                <span class="stat-val-2d" id="maxDist2D">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="walk-box walk-3d">
                        <h3>üê¶ 3D Random Walk (Drunk Bird)</h3>
                        <canvas id="canvas3D" width="350" height="350"></canvas>
                        <div class="walk-stats">
                            <div class="stat-row">
                                <span class="stat-label">Steps:</span>
                                <span class="stat-val-3d" id="steps3D">0</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Returns to Origin:</span>
                                <span class="stat-val-3d" id="returns3D">0</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Max Distance:</span>
                                <span class="stat-val-3d" id="maxDist3D">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="controls">
                    <button class="btn btn-primary" id="startBtn">Start Walks</button>
                    <button class="btn btn-secondary" id="pauseBtn">Pause</button>
                    <button class="btn btn-secondary" id="resetBtn">Reset</button>
                    <button class="btn btn-secondary" id="runTrialsBtn">Run 1000 Trials</button>

                    <div class="param-group">
                        <label>Speed:</label>
                        <input type="range" id="speedSlider" min="1" max="100" value="50">
                        <span class="param-value" id="speedValue">50/s</span>
                    </div>
                </div>

                <div class="results-grid">
                    <div class="result-box box-2d">
                        <div class="result-title">2D Return Rate</div>
                        <div class="result-value val-2d" id="rate2D">--</div>
                        <div class="result-theory">Theory: 100%</div>
                    </div>
                    <div class="result-box box-3d">
                        <div class="result-title">3D Return Rate</div>
                        <div class="result-value val-3d" id="rate3D">--</div>
                        <div class="result-theory">Theory: ~34.05%</div>
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <div class="exp-card">
                    <h3>üé≤ The Dimension Paradox</h3>
                    <p>Start at the origin and take random steps. In <span class="highlight-2d">1D and 2D</span>, you will return to the origin with probability <span class="highlight-2d">1</span> (certainty!). But in <span class="highlight-3d">3D and higher</span>, you'll likely never return! The extra dimension gives you <span class="highlight-3d">infinite escape routes</span>.</p>
                </div>

                <div class="exp-card">
                    <h3>üìä The Return Probability</h3>
                    <div class="formula">
                        p(d) = 1 for d ‚â§ 2<br>
                        p(3) = 0.3405373...
                    </div>
                    <p>The 3D constant involves Watson's triple integral‚Äîa beautiful but complex formula discovered in 1939.</p>
                </div>

                <div class="exp-card">
                    <h3>üîå Electric Network Proof</h3>
                    <p>Imagine the lattice as resistors. In <span class="highlight-2d">2D</span>, the effective resistance to infinity is <span class="highlight-2d">infinite</span>‚Äîcurrent must return. In <span class="highlight-3d">3D</span>, resistance to infinity is <span class="highlight-3d">finite</span>‚Äîcurrent can escape forever!</p>
                </div>

                <div class="exp-card">
                    <h3>üßÆ The Math Behind It</h3>
                    <p>The key is whether this integral converges:</p>
                    <div class="formula">
                        ‚à´ t<sup>-d/2</sup> dt
                    </div>
                    <p>It diverges for d ‚â§ 2 (recurrent) and converges for d ‚â• 3 (transient). The critical dimension is <span class="highlight-3d">d = 2</span>!</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Canvas setup
        const canvas2D = document.getElementById('canvas2D');
        const ctx2D = canvas2D.getContext('2d');
        const canvas3D = document.getElementById('canvas3D');
        const ctx3D = canvas3D.getContext('2d');

        // State
        let running = false;
        let animationId = null;
        let speed = 50;

        // 2D walk state
        let pos2D = { x: 0, y: 0 };
        let path2D = [{ x: 0, y: 0 }];
        let steps2D = 0;
        let returns2D = 0;
        let maxDist2D = 0;

        // 3D walk state
        let pos3D = { x: 0, y: 0, z: 0 };
        let path3D = [{ x: 0, y: 0, z: 0 }];
        let steps3D = 0;
        let returns3D = 0;
        let maxDist3D = 0;

        // Trial results
        let trials2D = [];
        let trials3D = [];

        // 2D directions
        const dirs2D = [
            { x: 1, y: 0 },
            { x: -1, y: 0 },
            { x: 0, y: 1 },
            { x: 0, y: -1 }
        ];

        // 3D directions
        const dirs3D = [
            { x: 1, y: 0, z: 0 },
            { x: -1, y: 0, z: 0 },
            { x: 0, y: 1, z: 0 },
            { x: 0, y: -1, z: 0 },
            { x: 0, y: 0, z: 1 },
            { x: 0, y: 0, z: -1 }
        ];

        function step2D() {
            const dir = dirs2D[Math.floor(Math.random() * 4)];
            pos2D.x += dir.x;
            pos2D.y += dir.y;
            path2D.push({ ...pos2D });
            steps2D++;

            const dist = Math.sqrt(pos2D.x * pos2D.x + pos2D.y * pos2D.y);
            if (dist > maxDist2D) maxDist2D = dist;

            if (pos2D.x === 0 && pos2D.y === 0 && steps2D > 0) {
                returns2D++;
            }

            // Keep path manageable
            if (path2D.length > 5000) {
                path2D = path2D.slice(-3000);
            }
        }

        function step3D() {
            const dir = dirs3D[Math.floor(Math.random() * 6)];
            pos3D.x += dir.x;
            pos3D.y += dir.y;
            pos3D.z += dir.z;
            path3D.push({ ...pos3D });
            steps3D++;

            const dist = Math.sqrt(pos3D.x * pos3D.x + pos3D.y * pos3D.y + pos3D.z * pos3D.z);
            if (dist > maxDist3D) maxDist3D = dist;

            if (pos3D.x === 0 && pos3D.y === 0 && pos3D.z === 0 && steps3D > 0) {
                returns3D++;
            }

            // Keep path manageable
            if (path3D.length > 5000) {
                path3D = path3D.slice(-3000);
            }
        }

        function draw2D() {
            const width = canvas2D.width;
            const height = canvas2D.height;
            const cx = width / 2;
            const cy = height / 2;

            ctx2D.fillStyle = '#111';
            ctx2D.fillRect(0, 0, width, height);

            // Auto-scale
            let maxCoord = Math.max(
                Math.abs(pos2D.x),
                Math.abs(pos2D.y),
                10
            );
            const scale = Math.min(width, height) / (maxCoord * 3);

            // Draw grid
            ctx2D.strokeStyle = '#222';
            ctx2D.lineWidth = 0.5;
            for (let i = -maxCoord; i <= maxCoord; i += Math.max(1, Math.floor(maxCoord / 10))) {
                ctx2D.beginPath();
                ctx2D.moveTo(cx + i * scale, 0);
                ctx2D.lineTo(cx + i * scale, height);
                ctx2D.stroke();
                ctx2D.beginPath();
                ctx2D.moveTo(0, cy + i * scale);
                ctx2D.lineTo(width, cy + i * scale);
                ctx2D.stroke();
            }

            // Draw path
            if (path2D.length > 1) {
                ctx2D.strokeStyle = 'rgba(52, 152, 219, 0.6)';
                ctx2D.lineWidth = 1.5;
                ctx2D.beginPath();
                ctx2D.moveTo(cx + path2D[0].x * scale, cy + path2D[0].y * scale);
                for (let i = 1; i < path2D.length; i++) {
                    ctx2D.lineTo(cx + path2D[i].x * scale, cy + path2D[i].y * scale);
                }
                ctx2D.stroke();
            }

            // Draw origin
            ctx2D.fillStyle = '#2ecc71';
            ctx2D.beginPath();
            ctx2D.arc(cx, cy, 6, 0, Math.PI * 2);
            ctx2D.fill();

            // Draw current position
            ctx2D.fillStyle = '#3498db';
            ctx2D.beginPath();
            ctx2D.arc(cx + pos2D.x * scale, cy + pos2D.y * scale, 8, 0, Math.PI * 2);
            ctx2D.fill();
        }

        function draw3D() {
            const width = canvas3D.width;
            const height = canvas3D.height;
            const cx = width / 2;
            const cy = height / 2;

            ctx3D.fillStyle = '#111';
            ctx3D.fillRect(0, 0, width, height);

            // Auto-scale
            let maxCoord = Math.max(
                Math.abs(pos3D.x),
                Math.abs(pos3D.y),
                Math.abs(pos3D.z),
                10
            );
            const scale = Math.min(width, height) / (maxCoord * 4);

            // Isometric projection helper
            const project = (x, y, z) => ({
                px: cx + (x - z) * scale * 0.866,
                py: cy + (x + z) * scale * 0.5 - y * scale
            });

            // Draw axes
            ctx3D.strokeStyle = '#333';
            ctx3D.lineWidth = 1;
            const axisLen = 30;
            const o = project(0, 0, 0);

            // X axis (red)
            const xEnd = project(axisLen, 0, 0);
            ctx3D.strokeStyle = 'rgba(231, 76, 60, 0.5)';
            ctx3D.beginPath();
            ctx3D.moveTo(o.px, o.py);
            ctx3D.lineTo(xEnd.px, xEnd.py);
            ctx3D.stroke();

            // Y axis (green)
            const yEnd = project(0, axisLen, 0);
            ctx3D.strokeStyle = 'rgba(46, 204, 113, 0.5)';
            ctx3D.beginPath();
            ctx3D.moveTo(o.px, o.py);
            ctx3D.lineTo(yEnd.px, yEnd.py);
            ctx3D.stroke();

            // Z axis (blue)
            const zEnd = project(0, 0, axisLen);
            ctx3D.strokeStyle = 'rgba(52, 152, 219, 0.5)';
            ctx3D.beginPath();
            ctx3D.moveTo(o.px, o.py);
            ctx3D.lineTo(zEnd.px, zEnd.py);
            ctx3D.stroke();

            // Draw path
            if (path3D.length > 1) {
                ctx3D.strokeStyle = 'rgba(155, 89, 182, 0.6)';
                ctx3D.lineWidth = 1.5;
                ctx3D.beginPath();
                const start = project(path3D[0].x, path3D[0].y, path3D[0].z);
                ctx3D.moveTo(start.px, start.py);
                for (let i = 1; i < path3D.length; i++) {
                    const p = project(path3D[i].x, path3D[i].y, path3D[i].z);
                    ctx3D.lineTo(p.px, p.py);
                }
                ctx3D.stroke();
            }

            // Draw origin
            ctx3D.fillStyle = '#2ecc71';
            ctx3D.beginPath();
            ctx3D.arc(o.px, o.py, 6, 0, Math.PI * 2);
            ctx3D.fill();

            // Draw current position
            const curr = project(pos3D.x, pos3D.y, pos3D.z);
            ctx3D.fillStyle = '#9b59b6';
            ctx3D.beginPath();
            ctx3D.arc(curr.px, curr.py, 8, 0, Math.PI * 2);
            ctx3D.fill();
        }

        function updateStats() {
            document.getElementById('steps2D').textContent = steps2D.toLocaleString();
            document.getElementById('returns2D').textContent = returns2D.toLocaleString();
            document.getElementById('maxDist2D').textContent = maxDist2D.toFixed(1);

            document.getElementById('steps3D').textContent = steps3D.toLocaleString();
            document.getElementById('returns3D').textContent = returns3D.toLocaleString();
            document.getElementById('maxDist3D').textContent = maxDist3D.toFixed(1);
        }

        function animate() {
            if (!running) return;

            const stepsPerFrame = Math.max(1, Math.floor(speed / 10));

            for (let i = 0; i < stepsPerFrame; i++) {
                step2D();
                step3D();
            }

            draw2D();
            draw3D();
            updateStats();

            animationId = requestAnimationFrame(animate);
        }

        function reset() {
            pos2D = { x: 0, y: 0 };
            path2D = [{ x: 0, y: 0 }];
            steps2D = 0;
            returns2D = 0;
            maxDist2D = 0;

            pos3D = { x: 0, y: 0, z: 0 };
            path3D = [{ x: 0, y: 0, z: 0 }];
            steps3D = 0;
            returns3D = 0;
            maxDist3D = 0;

            draw2D();
            draw3D();
            updateStats();
        }

        function runTrials() {
            const numTrials = 1000;
            const maxSteps = 10000;

            let returned2D = 0;
            let returned3D = 0;

            for (let trial = 0; trial < numTrials; trial++) {
                // 2D trial
                let x = 0, y = 0;
                let foundReturn2D = false;
                for (let s = 0; s < maxSteps && !foundReturn2D; s++) {
                    const dir = dirs2D[Math.floor(Math.random() * 4)];
                    x += dir.x;
                    y += dir.y;
                    if (x === 0 && y === 0) {
                        foundReturn2D = true;
                        returned2D++;
                    }
                }

                // 3D trial
                x = 0; y = 0; let z = 0;
                let foundReturn3D = false;
                for (let s = 0; s < maxSteps && !foundReturn3D; s++) {
                    const dir = dirs3D[Math.floor(Math.random() * 6)];
                    x += dir.x;
                    y += dir.y;
                    z += dir.z;
                    if (x === 0 && y === 0 && z === 0) {
                        foundReturn3D = true;
                        returned3D++;
                    }
                }
            }

            const rate2D = (returned2D / numTrials * 100).toFixed(1) + '%';
            const rate3D = (returned3D / numTrials * 100).toFixed(1) + '%';

            document.getElementById('rate2D').textContent = rate2D;
            document.getElementById('rate3D').textContent = rate3D;
        }

        // Event listeners
        document.getElementById('startBtn').addEventListener('click', () => {
            if (!running) {
                running = true;
                document.getElementById('startBtn').textContent = 'Running...';
                animate();
            }
        });

        document.getElementById('pauseBtn').addEventListener('click', () => {
            running = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            document.getElementById('startBtn').textContent = 'Start Walks';
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            running = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            document.getElementById('startBtn').textContent = 'Start Walks';
            reset();
        });

        document.getElementById('runTrialsBtn').addEventListener('click', () => {
            document.getElementById('rate2D').textContent = '...';
            document.getElementById('rate3D').textContent = '...';
            setTimeout(runTrials, 50);
        });

        document.getElementById('speedSlider').addEventListener('input', (e) => {
            speed = parseInt(e.target.value);
            document.getElementById('speedValue').textContent = speed + '/s';
        });

        // Initialize
        reset();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
