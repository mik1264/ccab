<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Benford's Law - Why "1" is the Most Common First Digit</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #e0e0e0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #00d2ff, #3a7bd5, #00d2ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #888;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
            margin-top: 20px;
        }

        .chart-container {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(0, 210, 255, 0.2);
        }

        canvas {
            display: block;
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        .controls {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(0, 210, 255, 0.2);
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            color: #00d2ff;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .dataset-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        button {
            padding: 12px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            text-align: left;
        }

        .dataset-btn {
            background: linear-gradient(135deg, #1a2a3a, #2a3a4a);
            color: #e0e0e0;
            border: 1px solid rgba(0, 210, 255, 0.3);
        }

        .dataset-btn:hover {
            background: linear-gradient(135deg, #2a3a4a, #3a4a5a);
            border-color: #00d2ff;
        }

        .dataset-btn.active {
            background: linear-gradient(135deg, #00d2ff, #3a7bd5);
            color: #000;
        }

        .stats {
            background: rgba(0, 210, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid rgba(0, 210, 255, 0.1);
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #888;
        }

        .stat-value {
            color: #00d2ff;
            font-family: monospace;
        }

        .fit-indicator {
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            margin-top: 15px;
            font-weight: 600;
        }

        .fit-good {
            background: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
            border: 1px solid rgba(46, 204, 113, 0.3);
        }

        .fit-moderate {
            background: rgba(241, 196, 15, 0.2);
            color: #f1c40f;
            border: 1px solid rgba(241, 196, 15, 0.3);
        }

        .fit-poor {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        .formula-box {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            border-left: 3px solid #3a7bd5;
        }

        .formula-title {
            color: #3a7bd5;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .formula {
            font-family: 'Times New Roman', serif;
            font-size: 1.2rem;
            color: #fff;
            text-align: center;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
        }

        .explanation {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .exp-card {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(0, 210, 255, 0.2);
        }

        .exp-card h3 {
            color: #00d2ff;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .exp-card p {
            line-height: 1.7;
            color: #bbb;
        }

        .highlight {
            color: #00d2ff;
            font-weight: 500;
        }

        .back-link {
            display: inline-block;
            color: #00d2ff;
            text-decoration: none;
            margin-bottom: 20px;
            transition: transform 0.3s;
        }

        .back-link:hover {
            transform: translateX(-5px);
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .legend-color {
            width: 20px;
            height: 10px;
            border-radius: 2px;
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê Back to Paradoxes</a>

        <header>
            <h1>Benford's Law</h1>
            <p class="subtitle">Why "1" appears as the first digit ~30% of the time in natural data</p>
        </header>

        <div class="main-content">
            <div class="chart-container">
                <canvas id="benfordCanvas" width="800" height="500"></canvas>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #3a7bd5;"></div>
                        <span>Expected (Benford)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #00d2ff;"></div>
                        <span>Observed Data</span>
                    </div>
                </div>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label>Test Dataset</label>
                    <div class="dataset-buttons">
                        <button class="dataset-btn active" data-dataset="fibonacci">Fibonacci Numbers (1-1000th)</button>
                        <button class="dataset-btn" data-dataset="powers2">Powers of 2 (2^1 to 2^1000)</button>
                        <button class="dataset-btn" data-dataset="factorials">Factorials (1! to 100!)</button>
                        <button class="dataset-btn" data-dataset="populations">World Country Populations</button>
                        <button class="dataset-btn" data-dataset="primes">Prime Numbers (first 10,000)</button>
                        <button class="dataset-btn" data-dataset="random">Random (uniform 1-1M)</button>
                        <button class="dataset-btn" data-dataset="physical">Physical Constants</button>
                    </div>
                </div>

                <div class="stats">
                    <div class="stat-row">
                        <span class="stat-label">Sample Size</span>
                        <span class="stat-value" id="sampleSize">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Chi-Squared (œá¬≤)</span>
                        <span class="stat-value" id="chiSquared">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">P-value</span>
                        <span class="stat-value" id="pValue">-</span>
                    </div>
                </div>

                <div class="fit-indicator fit-good" id="fitIndicator">
                    Excellent fit to Benford's Law!
                </div>

                <div class="formula-box">
                    <div class="formula-title">The Formula</div>
                    <div class="formula">P(d) = log‚ÇÅ‚ÇÄ(1 + 1/d)</div>
                    <p style="font-size: 0.85rem; color: #888; margin-top: 10px; text-align: center;">
                        d = first digit (1-9)
                    </p>
                </div>
            </div>
        </div>

        <div class="explanation">
            <div class="exp-card">
                <h3>üìä The Surprise</h3>
                <p>
                    You'd expect each digit 1-9 to appear equally often (~11.1%) as the leading digit.
                    <span class="highlight">Wrong!</span> In most natural datasets, "1" appears first
                    about <span class="highlight">30%</span> of the time, while "9" appears only
                    ~4.6%. This counterintuitive pattern was noticed by Simon Newcomb in 1881 and
                    rediscovered by Frank Benford in 1938.
                </p>
            </div>

            <div class="exp-card">
                <h3>üîç Fraud Detection</h3>
                <p>
                    Humans fabricating numbers tend to use uniform distributions‚Äîpicking "random"
                    digits. But real financial data follows Benford's Law! Auditors now use
                    <span class="highlight">Benford analysis</span> to flag suspicious tax returns,
                    accounting fraud, and election irregularities. It helped detect Bernie Madoff's
                    Ponzi scheme and irregularities in Greek EU application data.
                </p>
            </div>

            <div class="exp-card">
                <h3>üåø Why It Works</h3>
                <p>
                    The key insight: data spanning multiple <span class="highlight">orders of magnitude</span>
                    naturally follows this pattern. Numbers "spend more time" with leading digit 1
                    because they must pass through 10-19, 100-199, 1000-1999, etc. The logarithmic
                    formula captures this: smaller digits cover more "logarithmic space" on the
                    number line.
                </p>
            </div>

            <div class="exp-card">
                <h3>üö´ When It Fails</h3>
                <p>
                    Benford's Law doesn't apply to: assigned numbers (phone numbers, SSNs),
                    numbers with <span class="highlight">restricted ranges</span> (human heights),
                    or truly uniform random data. Try the "Random" dataset‚Äîit shows what non-Benford
                    data looks like. Uniform distributions fail the chi-squared test dramatically!
                </p>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('benfordCanvas');
        const ctx = canvas.getContext('2d');

        // High DPI support
        const dpr = window.devicePixelRatio || 1;
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width * dpr;
        canvas.height = rect.height * dpr;
        ctx.scale(dpr, dpr);
        const W = rect.width;
        const H = rect.height;

        // Benford's Law expected probabilities
        const BENFORD = [
            0, // placeholder for index 0
            Math.log10(1 + 1/1), // 0.301
            Math.log10(1 + 1/2), // 0.176
            Math.log10(1 + 1/3), // 0.125
            Math.log10(1 + 1/4), // 0.097
            Math.log10(1 + 1/5), // 0.079
            Math.log10(1 + 1/6), // 0.067
            Math.log10(1 + 1/7), // 0.058
            Math.log10(1 + 1/8), // 0.051
            Math.log10(1 + 1/9)  // 0.046
        ];

        // Get first digit of a number
        function firstDigit(n) {
            if (n <= 0) return 0;
            while (n >= 10) n = Math.floor(n / 10);
            return Math.floor(n);
        }

        // Get first digit for very large numbers (string-based)
        function firstDigitBig(str) {
            for (let i = 0; i < str.length; i++) {
                const c = str[i];
                if (c >= '1' && c <= '9') return parseInt(c);
            }
            return 0;
        }

        // Generate datasets
        function generateDataset(name) {
            const numbers = [];

            switch (name) {
                case 'fibonacci':
                    // Fibonacci numbers (use BigInt for large values)
                    let a = 1n, b = 1n;
                    for (let i = 0; i < 1000; i++) {
                        numbers.push(firstDigitBig(a.toString()));
                        [a, b] = [b, a + b];
                    }
                    break;

                case 'powers2':
                    // Powers of 2
                    let pow = 1n;
                    for (let i = 0; i < 1000; i++) {
                        numbers.push(firstDigitBig(pow.toString()));
                        pow *= 2n;
                    }
                    break;

                case 'factorials':
                    // Factorials
                    let fact = 1n;
                    for (let i = 1; i <= 100; i++) {
                        fact *= BigInt(i);
                        numbers.push(firstDigitBig(fact.toString()));
                    }
                    break;

                case 'populations':
                    // Approximate world country populations (192 countries)
                    const pops = [
                        1425178782, 1417173173, 339996563, 277534122, 240485658,
                        223804632, 218689757, 172954319, 164032220, 147449015,
                        129773024, 111088028, 102334404, 97470542, 93053000,
                        86908565, 85816199, 84614362, 83794000, 70956004,
                        67390000, 66548000, 64756584, 60614000, 59566785,
                        51269185, 47078228, 46295000, 45910000, 44657432,
                        44385155, 42239854, 42239854, 38386000, 37893000,
                        35951531, 35980000, 34400000, 33469203, 32971854,
                        32827376, 32365999, 31825295, 30552805, 28838499,
                        28439000, 27691018, 25882000, 25716544, 24790000,
                        23816775, 21893579, 20569737, 19492197, 19196468,
                        18278568, 17753000, 17594932, 17127338, 16944826,
                        15940891, 15893222, 14898470, 14531088, 14094683,
                        13712828, 12643799, 11780590, 11694719, 11453000,
                        11148278, 10882000, 10827529, 10535535, 10423054
                    ];
                    pops.forEach(p => numbers.push(firstDigit(p)));
                    break;

                case 'primes':
                    // First 10,000 primes (sieve)
                    const sieve = new Array(105000).fill(true);
                    sieve[0] = sieve[1] = false;
                    for (let i = 2; i < 324; i++) {
                        if (sieve[i]) {
                            for (let j = i * i; j < 105000; j += i) {
                                sieve[j] = false;
                            }
                        }
                    }
                    let count = 0;
                    for (let i = 2; i < 105000 && count < 10000; i++) {
                        if (sieve[i]) {
                            numbers.push(firstDigit(i));
                            count++;
                        }
                    }
                    break;

                case 'random':
                    // Uniform random numbers (should NOT follow Benford!)
                    for (let i = 0; i < 10000; i++) {
                        numbers.push(firstDigit(Math.floor(Math.random() * 1000000) + 1));
                    }
                    break;

                case 'physical':
                    // Physical constants (various units)
                    const constants = [
                        299792458, // speed of light m/s
                        6.67430e-11, // gravitational constant
                        6.62607e-34, // Planck constant
                        1.60218e-19, // elementary charge
                        9.10938e-31, // electron mass
                        1.67262e-27, // proton mass
                        6.02214e23, // Avogadro
                        1.38065e-23, // Boltzmann
                        8.31446, // gas constant
                        8.85419e-12, // vacuum permittivity
                        1.25664e-6, // vacuum permeability
                        9.80665, // standard gravity
                        273.15, // 0¬∞C in Kelvin
                        101325, // standard atmosphere Pa
                        3.14159265358979, // pi
                        2.71828182845904, // e
                        1.41421356237, // sqrt(2)
                        1.61803398874989, // golden ratio
                        2.30258509299, // ln(10)
                        0.693147180559, // ln(2)
                        96485.33212, // Faraday constant
                        376.730313668, // vacuum impedance
                        5.67037e-8, // Stefan-Boltzmann
                        2.17645e-8, // Planck mass
                        1.61626e-35, // Planck length
                        5.39124e-44, // Planck time
                        483597.8484, // Josephson constant
                        25812.80745, // von Klitzing constant
                        7.29735e-3, // fine structure constant
                        1836.15267343 // proton/electron mass ratio
                    ];
                    constants.forEach(c => {
                        const str = c.toExponential();
                        numbers.push(firstDigitBig(str));
                    });
                    break;
            }

            return numbers.filter(d => d >= 1 && d <= 9);
        }

        // Count digit frequencies
        function countDigits(data) {
            const counts = new Array(10).fill(0);
            data.forEach(d => counts[d]++);
            return counts;
        }

        // Calculate chi-squared statistic
        function chiSquared(observed, expected, n) {
            let chi2 = 0;
            for (let d = 1; d <= 9; d++) {
                const O = observed[d];
                const E = expected[d] * n;
                chi2 += (O - E) * (O - E) / E;
            }
            return chi2;
        }

        // Approximate p-value from chi-squared (df=8)
        function pValueFromChiSq(chi2, df = 8) {
            // Simplified approximation
            if (chi2 < 2.733) return 0.95;
            if (chi2 < 4.594) return 0.80;
            if (chi2 < 7.344) return 0.50;
            if (chi2 < 13.362) return 0.10;
            if (chi2 < 15.507) return 0.05;
            if (chi2 < 20.090) return 0.01;
            return 0.001;
        }

        // Draw chart
        function drawChart(data) {
            const counts = countDigits(data);
            const n = data.length;

            ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
            ctx.fillRect(0, 0, W, H);

            const margin = { top: 40, right: 30, bottom: 60, left: 60 };
            const chartW = W - margin.left - margin.right;
            const chartH = H - margin.top - margin.bottom;
            const barWidth = chartW / 9 * 0.35;
            const groupWidth = chartW / 9;

            // Draw grid
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const y = margin.top + (chartH * (1 - i / 5));
                ctx.beginPath();
                ctx.moveTo(margin.left, y);
                ctx.lineTo(W - margin.right, y);
                ctx.stroke();

                ctx.fillStyle = '#888';
                ctx.font = '12px sans-serif';
                ctx.textAlign = 'right';
                ctx.fillText((i * 10) + '%', margin.left - 10, y + 4);
            }

            // Draw bars
            for (let d = 1; d <= 9; d++) {
                const x = margin.left + (d - 0.5) * groupWidth;

                // Expected (Benford)
                const expectedHeight = BENFORD[d] * chartH * 2;
                ctx.fillStyle = '#3a7bd5';
                ctx.fillRect(
                    x - barWidth - 2,
                    margin.top + chartH - expectedHeight,
                    barWidth,
                    expectedHeight
                );

                // Observed
                const observedPct = counts[d] / n;
                const observedHeight = observedPct * chartH * 2;
                ctx.fillStyle = '#00d2ff';
                ctx.fillRect(
                    x + 2,
                    margin.top + chartH - observedHeight,
                    barWidth,
                    observedHeight
                );

                // Labels
                ctx.fillStyle = '#fff';
                ctx.font = '14px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(d.toString(), x, margin.top + chartH + 25);

                // Percentages
                ctx.font = '10px sans-serif';
                ctx.fillStyle = '#3a7bd5';
                ctx.fillText((BENFORD[d] * 100).toFixed(1) + '%',
                    x - barWidth/2 - 2, margin.top + chartH - expectedHeight - 5);
                ctx.fillStyle = '#00d2ff';
                ctx.fillText((observedPct * 100).toFixed(1) + '%',
                    x + barWidth/2 + 2, margin.top + chartH - observedHeight - 5);
            }

            // Axis labels
            ctx.fillStyle = '#fff';
            ctx.font = '14px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('First Digit', W / 2, H - 15);

            ctx.save();
            ctx.translate(20, H / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('Frequency', 0, 0);
            ctx.restore();

            // Update stats
            document.getElementById('sampleSize').textContent = n.toLocaleString();

            const chi2 = chiSquared(counts, BENFORD, n);
            document.getElementById('chiSquared').textContent = chi2.toFixed(2);

            const pVal = pValueFromChiSq(chi2);
            document.getElementById('pValue').textContent =
                pVal < 0.01 ? '< 0.01' : pVal.toFixed(2);

            // Update fit indicator
            const indicator = document.getElementById('fitIndicator');
            indicator.classList.remove('fit-good', 'fit-moderate', 'fit-poor');
            if (pVal >= 0.05) {
                indicator.classList.add('fit-good');
                indicator.textContent = '‚úì Excellent fit to Benford\'s Law!';
            } else if (pVal >= 0.01) {
                indicator.classList.add('fit-moderate');
                indicator.textContent = '‚ö† Moderate deviation from Benford\'s Law';
            } else {
                indicator.classList.add('fit-poor');
                indicator.textContent = '‚úó Significant deviation - does not follow Benford\'s Law';
            }
        }

        // Event listeners
        document.querySelectorAll('.dataset-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.dataset-btn').forEach(b =>
                    b.classList.remove('active'));
                btn.classList.add('active');
                const data = generateDataset(btn.dataset.dataset);
                drawChart(data);
            });
        });

        // Initial render
        drawChart(generateDataset('fibonacci'));
    </script>
</body>
</html>
