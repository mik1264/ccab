<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Koch Snowflake - Infinite Perimeter, Finite Area</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0f2e2e 0%, #1a4e4e 50%, #0a2222 100%);
            min-height: 100vh;
            color: #e0e0e0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #66eaea, #4ba2a2, #93fbfb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #8adcdc;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
            margin-top: 20px;
        }

        .canvas-container {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(102, 234, 234, 0.2);
        }

        canvas {
            display: block;
            width: 100%;
            background: #0a1a1a;
            border-radius: 10px;
        }

        .controls {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(102, 234, 234, 0.2);
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            color: #66eaea;
            margin-bottom: 8px;
            font-weight: 500;
        }

        input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }

        .range-value {
            text-align: center;
            color: #93fbfb;
            font-family: monospace;
            font-size: 1.1rem;
        }

        .button-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        button {
            padding: 12px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .control-btn {
            background: linear-gradient(135deg, #66eaea, #4ba2a2);
            color: #000;
            font-size: 1rem;
        }

        .control-btn:hover {
            background: linear-gradient(135deg, #4ba2a2, #66eaea);
            transform: scale(1.02);
        }

        .stats {
            background: rgba(102, 234, 234, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid rgba(102, 234, 234, 0.1);
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #8adcdc;
        }

        .stat-value {
            color: #66eaea;
            font-family: monospace;
            font-weight: 500;
        }

        .highlight-stat {
            background: rgba(102, 234, 234, 0.2);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            margin-top: 15px;
        }

        .highlight-label {
            color: #8adcdc;
            font-size: 0.9rem;
        }

        .highlight-value {
            font-size: 1.5rem;
            color: #93fbfb;
            font-family: monospace;
            font-weight: bold;
        }

        .formula-box {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            border-left: 3px solid #4ba2a2;
        }

        .formula-title {
            color: #4ba2a2;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .formula {
            font-family: monospace;
            font-size: 0.95rem;
            color: #ddd;
            text-align: center;
            padding: 6px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            margin: 5px 0;
        }

        .paradox-box {
            background: linear-gradient(135deg, rgba(102, 234, 234, 0.15), rgba(75, 162, 162, 0.15));
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid rgba(102, 234, 234, 0.3);
            text-align: center;
        }

        .paradox-title {
            color: #93fbfb;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .paradox-text {
            color: #ccc;
            line-height: 1.5;
        }

        .explanation {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .exp-card {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(102, 234, 234, 0.2);
        }

        .exp-card h3 {
            color: #66eaea;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .exp-card p {
            line-height: 1.7;
            color: #bbb;
        }

        .highlight {
            color: #93fbfb;
            font-weight: 500;
        }

        .back-link {
            display: inline-block;
            color: #66eaea;
            text-decoration: none;
            margin-bottom: 20px;
            transition: transform 0.3s;
        }

        .back-link:hover {
            transform: translateX(-5px);
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê Back to Paradoxes</a>

        <header>
            <h1>The Koch Snowflake</h1>
            <p class="subtitle">Infinite perimeter enclosing finite area ‚Äî Helge von Koch's 1904 fractal</p>
        </header>

        <div class="main-content">
            <div class="canvas-container">
                <canvas id="kochCanvas" width="800" height="600"></canvas>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label>Iterations: <span id="iterValue">4</span></label>
                    <input type="range" id="iterSlider" min="0" max="7" value="4">
                </div>

                <div class="control-group">
                    <div class="button-row">
                        <button class="control-btn" id="animateBtn">‚ñ∂ Animate</button>
                        <button class="control-btn" id="resetBtn">‚Ü∫ Reset</button>
                    </div>
                </div>

                <div class="stats">
                    <div class="stat-row">
                        <span class="stat-label">Iteration</span>
                        <span class="stat-value" id="currentIter">4</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Edges</span>
                        <span class="stat-value" id="edgeCount">768</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Perimeter</span>
                        <span class="stat-value" id="perimeter">(4/3)‚Å¥ √ó P‚ÇÄ</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Area</span>
                        <span class="stat-value" id="area">~1.6 √ó A‚ÇÄ</span>
                    </div>
                </div>

                <div class="highlight-stat">
                    <div class="highlight-label">Perimeter Growth Factor</div>
                    <div class="highlight-value" id="perimFactor">3.16√ó</div>
                </div>

                <div class="formula-box">
                    <div class="formula-title">The Construction Rule</div>
                    <div class="formula">Replace middle 1/3 of each</div>
                    <div class="formula">edge with outward "bump"</div>
                    <div class="formula">4 segments replace 1</div>
                </div>

                <div class="formula-box">
                    <div class="formula-title">Key Formulas</div>
                    <div class="formula">Edges: 3 √ó 4‚Åø</div>
                    <div class="formula">Perimeter: P‚ÇÄ √ó (4/3)‚Åø ‚Üí ‚àû</div>
                    <div class="formula">Area ‚Üí (8/5) √ó A‚ÇÄ</div>
                    <div class="formula">Dimension: log(4)/log(3) ‚âà 1.26</div>
                </div>

                <div class="paradox-box">
                    <div class="paradox-title">‚ùÑÔ∏è The Paradox</div>
                    <div class="paradox-text">
                        As iterations ‚Üí ‚àû:<br>
                        <strong>Perimeter ‚Üí INFINITY</strong><br>
                        <strong>Area ‚Üí 8/5 of original</strong><br>
                        A finite region bounded by infinite curve!
                    </div>
                </div>
            </div>
        </div>

        <div class="explanation">
            <div class="exp-card">
                <h3>‚ùÑÔ∏è The Construction</h3>
                <p>
                    Start with an equilateral triangle. For each edge, divide it into thirds,
                    then replace the middle third with two sides of a smaller equilateral triangle
                    pointing outward. Repeat <span class="highlight">infinitely</span>. Each iteration
                    multiplies the number of edges by 4, while edge length becomes 1/3.
                </p>
            </div>

            <div class="exp-card">
                <h3>‚àû Infinite Perimeter</h3>
                <p>
                    Each iteration multiplies the perimeter by <span class="highlight">4/3</span>.
                    Since 4/3 &gt; 1, the perimeter grows without bound: P‚ÇÄ √ó (4/3)‚Åø ‚Üí ‚àû as n‚Üí‚àû.
                    Yet this infinite boundary somehow contains a finite area‚Äîit wraps and wraps
                    upon itself, getting ever more intricate.
                </p>
            </div>

            <div class="exp-card">
                <h3>üìê Finite Area</h3>
                <p>
                    The area converges to <span class="highlight">(8/5) √ó A‚ÇÄ</span> where A‚ÇÄ is
                    the original triangle's area. Each iteration adds smaller and smaller triangles.
                    This forms a geometric series: A‚ÇÄ √ó (1 + 1/3 + 1/9 + ...) which sums to a
                    finite value. More boundary, same bounded region!
                </p>
            </div>

            <div class="exp-card">
                <h3>üî¨ Historical Note</h3>
                <p>
                    Helge von Koch introduced this curve in 1904 to give an example of a continuous
                    curve with <span class="highlight">no tangent at any point</span>. Like the
                    Weierstrass function, it challenged mathematicians' intuitions. It's also
                    self-similar: zoom in 3√ó and you see the same pattern.
                </p>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('kochCanvas');
        const ctx = canvas.getContext('2d');

        // High DPI support
        const dpr = window.devicePixelRatio || 1;
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width * dpr;
        canvas.height = rect.height * dpr;
        ctx.scale(dpr, dpr);
        const W = rect.width;
        const H = rect.height;

        let currentIter = 4;
        let isAnimating = false;
        let animationId = null;

        // Generate Koch curve points between two endpoints
        function kochCurve(p1, p2, depth) {
            if (depth === 0) {
                return [p1, p2];
            }

            const dx = p2.x - p1.x;
            const dy = p2.y - p1.y;

            // Divide into thirds
            const a = { x: p1.x + dx / 3, y: p1.y + dy / 3 };
            const b = { x: p1.x + 2 * dx / 3, y: p1.y + 2 * dy / 3 };

            // Peak point (equilateral triangle pointing outward)
            const peak = {
                x: a.x + (b.x - a.x) / 2 - (b.y - a.y) * Math.sqrt(3) / 2,
                y: a.y + (b.y - a.y) / 2 + (b.x - a.x) * Math.sqrt(3) / 2
            };

            // Recursive calls
            const seg1 = kochCurve(p1, a, depth - 1);
            const seg2 = kochCurve(a, peak, depth - 1);
            const seg3 = kochCurve(peak, b, depth - 1);
            const seg4 = kochCurve(b, p2, depth - 1);

            // Combine (remove duplicate endpoints)
            return [
                ...seg1.slice(0, -1),
                ...seg2.slice(0, -1),
                ...seg3.slice(0, -1),
                ...seg4
            ];
        }

        // Generate complete Koch snowflake
        function kochSnowflake(iter) {
            const size = Math.min(W, H) * 0.75;
            const cx = W / 2;
            const cy = H / 2 + 20;

            // Start with equilateral triangle (pointing up)
            const r = size / Math.sqrt(3);
            const p1 = { x: cx, y: cy - r };
            const p2 = { x: cx - size / 2, y: cy + r / 2 };
            const p3 = { x: cx + size / 2, y: cy + r / 2 };

            // Generate Koch curves for each side
            const side1 = kochCurve(p1, p2, iter);
            const side2 = kochCurve(p2, p3, iter);
            const side3 = kochCurve(p3, p1, iter);

            // Combine
            return [
                ...side1.slice(0, -1),
                ...side2.slice(0, -1),
                ...side3.slice(0, -1)
            ];
        }

        // Draw the snowflake
        function draw(iter = currentIter) {
            ctx.fillStyle = '#0a1a1a';
            ctx.fillRect(0, 0, W, H);

            const points = kochSnowflake(iter);

            // Fill
            ctx.fillStyle = 'rgba(102, 234, 234, 0.15)';
            ctx.beginPath();
            ctx.moveTo(points[0].x, points[0].y);
            for (let i = 1; i < points.length; i++) {
                ctx.lineTo(points[i].x, points[i].y);
            }
            ctx.closePath();
            ctx.fill();

            // Stroke
            const gradient = ctx.createLinearGradient(0, 0, W, H);
            gradient.addColorStop(0, '#66eaea');
            gradient.addColorStop(0.5, '#4ba2a2');
            gradient.addColorStop(1, '#93fbfb');

            ctx.strokeStyle = gradient;
            ctx.lineWidth = iter < 5 ? 2 : 1;
            ctx.beginPath();
            ctx.moveTo(points[0].x, points[0].y);
            for (let i = 1; i < points.length; i++) {
                ctx.lineTo(points[i].x, points[i].y);
            }
            ctx.closePath();
            ctx.stroke();

            // Glow effect
            ctx.shadowColor = '#93fbfb';
            ctx.shadowBlur = 5;
            ctx.stroke();
            ctx.shadowBlur = 0;

            // Title
            ctx.fillStyle = '#66eaea';
            ctx.font = '16px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText(`Koch Snowflake ‚Äî Iteration ${iter}`, 20, 30);

            updateStats(iter);
        }

        // Update statistics
        function updateStats(n) {
            document.getElementById('currentIter').textContent = n;
            document.getElementById('iterValue').textContent = n;

            // Edges: 3 √ó 4^n
            const edges = 3 * Math.pow(4, n);
            document.getElementById('edgeCount').textContent = edges.toLocaleString();

            // Perimeter factor
            const perimFactor = Math.pow(4/3, n);
            document.getElementById('perimeter').textContent = `(4/3)^${n} √ó P‚ÇÄ`;
            document.getElementById('perimFactor').textContent = perimFactor.toFixed(2) + '√ó';

            // Area approaches 8/5 = 1.6
            const areaFactor = 1 + (1/3) * (1 - Math.pow(4/9, n)) / (1 - 4/9);
            document.getElementById('area').textContent = `~${areaFactor.toFixed(3)} √ó A‚ÇÄ`;
        }

        // Animation
        function animate() {
            if (!isAnimating) return;

            currentIter++;
            if (currentIter > 7) {
                currentIter = 0;
            }

            document.getElementById('iterSlider').value = currentIter;
            draw(currentIter);

            animationId = setTimeout(() => requestAnimationFrame(animate), 1200);
        }

        // Event listeners
        document.getElementById('iterSlider').addEventListener('input', (e) => {
            currentIter = parseInt(e.target.value);
            draw(currentIter);
        });

        document.getElementById('animateBtn').addEventListener('click', () => {
            isAnimating = !isAnimating;
            document.getElementById('animateBtn').textContent = isAnimating ? '‚è∏ Pause' : '‚ñ∂ Animate';

            if (isAnimating) {
                currentIter = -1;
                animate();
            } else if (animationId) {
                clearTimeout(animationId);
            }
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            isAnimating = false;
            document.getElementById('animateBtn').textContent = '‚ñ∂ Animate';
            if (animationId) clearTimeout(animationId);

            currentIter = 0;
            document.getElementById('iterSlider').value = 0;
            draw(0);
        });

        // Initial draw
        draw();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
