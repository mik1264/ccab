<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>702 - Braess's Paradox | Surprising Paradoxes | CCAB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #e8e8e8;
            padding: 20px;
        }
        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #64b5f6;
            text-decoration: none;
            font-size: 14px;
            opacity: 0.8;
            z-index: 100;
        }
        .back-link:hover { opacity: 1; }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding-top: 40px;
        }
        h1 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #e74c3c, #f39c12);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .subtitle {
            text-align: center;
            color: #aaa;
            font-size: 1.1rem;
            margin-bottom: 30px;
        }
        .paradox-statement {
            background: rgba(231, 76, 60, 0.15);
            border: 1px solid rgba(231, 76, 60, 0.3);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            text-align: center;
        }
        .paradox-statement h2 {
            color: #e74c3c;
            font-size: 1.5rem;
            margin-bottom: 15px;
        }
        .paradox-statement p {
            font-size: 1.2rem;
            line-height: 1.6;
        }
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 30px;
            margin-bottom: 30px;
        }
        @media (max-width: 900px) {
            .main-grid { grid-template-columns: 1fr; }
        }
        .simulation-panel {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 20px;
        }
        .sim-title {
            font-size: 1.2rem;
            color: #f39c12;
            margin-bottom: 15px;
            text-align: center;
        }
        #sim-canvas {
            width: 100%;
            height: 400px;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }
        .btn {
            padding: 12px 24px;
            font-size: 0.95rem;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-primary {
            background: linear-gradient(135deg, #e74c3c, #f39c12);
            color: white;
        }
        .btn-primary:hover { transform: scale(1.05); }
        .btn-secondary {
            background: rgba(100, 181, 246, 0.2);
            border: 2px solid #64b5f6;
            color: #64b5f6;
        }
        .btn-secondary:hover { background: rgba(100, 181, 246, 0.3); }
        .btn-danger {
            background: rgba(231, 76, 60, 0.2);
            border: 2px solid #e74c3c;
            color: #e74c3c;
        }
        .btn-success {
            background: rgba(46, 204, 113, 0.2);
            border: 2px solid #2ecc71;
            color: #2ecc71;
        }
        .toggle-container {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(0,0,0,0.3);
            padding: 10px 20px;
            border-radius: 25px;
        }
        .toggle-label { font-size: 0.9rem; }
        .toggle {
            width: 50px;
            height: 26px;
            background: #e74c3c;
            border-radius: 13px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        .toggle.active { background: #2ecc71; }
        .toggle::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: left 0.3s ease;
        }
        .toggle.active::after { left: 26px; }
        .stats-panel {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 20px;
        }
        .stat-section {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .stat-section h3 {
            color: #64b5f6;
            font-size: 1rem;
            margin-bottom: 12px;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .stat-row:last-child { border-bottom: none; }
        .stat-value {
            font-weight: bold;
        }
        .stat-value.good { color: #2ecc71; }
        .stat-value.bad { color: #e74c3c; }
        .stat-value.neutral { color: #f39c12; }
        .comparison-box {
            background: rgba(231, 76, 60, 0.15);
            border: 1px solid rgba(231, 76, 60, 0.3);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            margin-top: 15px;
        }
        .comparison-box.better {
            background: rgba(46, 204, 113, 0.15);
            border-color: rgba(46, 204, 113, 0.3);
        }
        .comparison-title {
            font-size: 0.9rem;
            color: #aaa;
            margin-bottom: 8px;
        }
        .comparison-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #e74c3c;
        }
        .comparison-box.better .comparison-value { color: #2ecc71; }
        .explanation-section {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
        }
        .explanation-section h3 {
            color: #f39c12;
            margin-bottom: 15px;
        }
        .explanation-section p {
            line-height: 1.7;
            margin-bottom: 12px;
        }
        .route-diagram {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 25px 0;
            flex-wrap: wrap;
        }
        .route-box {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            min-width: 200px;
        }
        .route-box h4 {
            color: #64b5f6;
            margin-bottom: 10px;
        }
        .route-time {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 10px 0;
        }
        .math-box {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            overflow-x: auto;
            line-height: 1.8;
        }
        .real-world {
            background: rgba(46, 204, 113, 0.1);
            border: 1px solid rgba(46, 204, 113, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }
        .real-world h4 {
            color: #2ecc71;
            margin-bottom: 12px;
        }
        .real-world ul {
            margin-left: 20px;
            line-height: 1.8;
        }
        .history {
            background: rgba(155, 89, 182, 0.1);
            border-left: 4px solid #9b59b6;
            padding: 20px;
            margin-top: 30px;
            border-radius: 0 12px 12px 0;
        }
        .history h4 {
            color: #9b59b6;
            margin-bottom: 10px;
        }
        .legend {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 15px;
            flex-wrap: wrap;
            font-size: 0.85rem;
            color: #aaa;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .legend-line {
            width: 30px;
            height: 4px;
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Paradoxes</a>

    <div class="container">
        <h1>Braess's Paradox</h1>
        <p class="subtitle">Dietrich Braess (1968) • Game Theory & Traffic Flow</p>

        <div class="paradox-statement">
            <h2>The Paradox</h2>
            <p>Adding a new road to a traffic network can make <strong>everyone's</strong> commute <strong>slower</strong>!<br>
            Selfish optimization leads to collectively worse outcomes.</p>
        </div>

        <div class="main-grid">
            <div class="simulation-panel">
                <h3 class="sim-title">Traffic Network Simulation</h3>
                <canvas id="sim-canvas"></canvas>
                <div class="controls">
                    <div class="toggle-container">
                        <span class="toggle-label">Shortcut Road:</span>
                        <div class="toggle" id="shortcut-toggle" onclick="toggleShortcut()"></div>
                    </div>
                    <button class="btn btn-primary" onclick="resetSimulation()">Reset</button>
                </div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-line" style="background: #3498db;"></div>
                        <span>Fixed-time road</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line" style="background: #e74c3c;"></div>
                        <span>Traffic-dependent road</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line" style="background: #2ecc71;"></div>
                        <span>Shortcut (when enabled)</span>
                    </div>
                </div>
            </div>

            <div class="stats-panel">
                <div class="stat-section">
                    <h3>Current State</h3>
                    <div class="stat-row">
                        <span>Shortcut Road</span>
                        <span class="stat-value" id="shortcut-status">OFF</span>
                    </div>
                    <div class="stat-row">
                        <span>Total Drivers</span>
                        <span class="stat-value neutral" id="total-drivers">4000</span>
                    </div>
                </div>

                <div class="stat-section">
                    <h3>Route Distribution</h3>
                    <div class="stat-row">
                        <span>Top Route (A→B→D)</span>
                        <span class="stat-value" id="route-top">0</span>
                    </div>
                    <div class="stat-row">
                        <span>Bottom Route (A→C→D)</span>
                        <span class="stat-value" id="route-bottom">0</span>
                    </div>
                    <div class="stat-row">
                        <span>Shortcut (A→B→C→D)</span>
                        <span class="stat-value" id="route-shortcut">-</span>
                    </div>
                </div>

                <div class="stat-section">
                    <h3>Travel Times</h3>
                    <div class="stat-row">
                        <span>Top Route Time</span>
                        <span class="stat-value" id="time-top">0 min</span>
                    </div>
                    <div class="stat-row">
                        <span>Bottom Route Time</span>
                        <span class="stat-value" id="time-bottom">0 min</span>
                    </div>
                    <div class="stat-row">
                        <span>Shortcut Time</span>
                        <span class="stat-value" id="time-shortcut">-</span>
                    </div>
                </div>

                <div class="comparison-box" id="comparison-box">
                    <div class="comparison-title">Average Travel Time</div>
                    <div class="comparison-value" id="avg-time">0 min</div>
                </div>
            </div>
        </div>

        <div class="explanation-section">
            <h3>How Does This Work?</h3>
            <p>Consider 4,000 drivers traveling from <strong>A</strong> to <strong>D</strong>. There are two routes:</p>

            <div class="route-diagram">
                <div class="route-box">
                    <h4>Top Route: A → B → D</h4>
                    <p>A→B: <span style="color:#e74c3c;">T/100 min</span> (traffic-dependent)</p>
                    <p>B→D: <span style="color:#3498db;">45 min</span> (fixed)</p>
                </div>
                <div class="route-box">
                    <h4>Bottom Route: A → C → D</h4>
                    <p>A→C: <span style="color:#3498db;">45 min</span> (fixed)</p>
                    <p>C→D: <span style="color:#e74c3c;">T/100 min</span> (traffic-dependent)</p>
                </div>
            </div>

            <div class="math-box">
<strong>Without Shortcut (Nash Equilibrium):</strong>
• Traffic splits evenly: 2000 top, 2000 bottom
• Top time: 2000/100 + 45 = 65 min
• Bottom time: 45 + 2000/100 = 65 min
• <span style="color:#2ecc71;">Everyone takes 65 minutes!</span>

<strong>With Shortcut B→C (0 min):</strong>
• Everyone takes A→B→C→D (shortest for each individual!)
• Time: 4000/100 + 0 + 4000/100 = 80 min
• <span style="color:#e74c3c;">Everyone takes 80 minutes! (+23% worse)</span>
            </div>

            <p><strong>The Key Insight:</strong> The shortcut is individually rational — if everyone else avoids it, you save time by taking it. But when everyone reasons this way, the traffic-dependent roads get overloaded, and <em>everyone</em> suffers.</p>

            <p>This is the <strong>Nash Equilibrium</strong> — no individual can improve their time by switching routes, yet the collective outcome is worse than if the shortcut didn't exist!</p>

            <div class="real-world">
                <h4>Real-World Examples</h4>
                <ul>
                    <li><strong>Stuttgart, Germany (1969)</strong> — A new road increased congestion; the paradox was confirmed</li>
                    <li><strong>New York City (1990)</strong> — Closing 42nd Street improved traffic flow</li>
                    <li><strong>Seoul, Korea (2003)</strong> — Demolishing a highway reduced congestion</li>
                    <li><strong>Boston</strong> — Research found 6 of 246 links could be closed to improve traffic</li>
                    <li><strong>Beyond traffic:</strong> The paradox appears in electrical grids, internet routing, blockchain networks, and even sports teams!</li>
                </ul>
            </div>
        </div>

        <div class="history">
            <h4>Historical Note</h4>
            <p>German mathematician Dietrich Braess discovered this paradox in 1968 while working on traffic modeling at Ruhr University. Arthur Pigou had described a simpler version in 1920. The paradox is now a cornerstone of game theory and network science, demonstrating that Nash equilibria can be Pareto inefficient — individual rationality doesn't guarantee collective rationality.</p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('sim-canvas');
        const ctx = canvas.getContext('2d');

        let shortcutEnabled = false;
        const totalDrivers = 4000;

        // Node positions (will be set based on canvas size)
        let nodes = {};
        let cars = [];
        let animationId;

        function resizeCanvas() {
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * window.devicePixelRatio;
            canvas.height = rect.height * window.devicePixelRatio;
            ctx.scale(window.devicePixelRatio, window.devicePixelRatio);

            const w = rect.width;
            const h = rect.height;
            const margin = 60;

            nodes = {
                A: { x: margin, y: h / 2, label: 'A (Start)' },
                B: { x: w / 2, y: margin + 30, label: 'B' },
                C: { x: w / 2, y: h - margin - 30, label: 'C' },
                D: { x: w - margin, y: h / 2, label: 'D (End)' }
            };
        }

        function calculateEquilibrium() {
            if (!shortcutEnabled) {
                // Without shortcut: traffic splits evenly
                return {
                    top: totalDrivers / 2,
                    bottom: totalDrivers / 2,
                    shortcut: 0,
                    topTime: totalDrivers / 2 / 100 + 45,
                    bottomTime: 45 + totalDrivers / 2 / 100,
                    shortcutTime: null
                };
            } else {
                // With shortcut: everyone takes A→B→C→D at Nash equilibrium
                const shortcutFlow = totalDrivers;
                return {
                    top: 0,
                    bottom: 0,
                    shortcut: shortcutFlow,
                    topTime: 45 + 45, // If someone tried it (empty roads)
                    bottomTime: 45 + 45,
                    shortcutTime: shortcutFlow / 100 + 0 + shortcutFlow / 100
                };
            }
        }

        function updateStats() {
            const eq = calculateEquilibrium();

            document.getElementById('shortcut-status').textContent = shortcutEnabled ? 'ON' : 'OFF';
            document.getElementById('shortcut-status').className = 'stat-value ' + (shortcutEnabled ? 'bad' : 'good');

            document.getElementById('route-top').textContent = eq.top.toLocaleString();
            document.getElementById('route-bottom').textContent = eq.bottom.toLocaleString();
            document.getElementById('route-shortcut').textContent = shortcutEnabled ? eq.shortcut.toLocaleString() : '-';

            document.getElementById('time-top').textContent = eq.topTime.toFixed(0) + ' min';
            document.getElementById('time-bottom').textContent = eq.bottomTime.toFixed(0) + ' min';
            document.getElementById('time-shortcut').textContent = shortcutEnabled ? eq.shortcutTime.toFixed(0) + ' min' : '-';

            const avgTime = shortcutEnabled ? eq.shortcutTime : eq.topTime;
            document.getElementById('avg-time').textContent = avgTime.toFixed(0) + ' min';

            const compBox = document.getElementById('comparison-box');
            if (shortcutEnabled) {
                compBox.className = 'comparison-box';
            } else {
                compBox.className = 'comparison-box better';
            }
        }

        function toggleShortcut() {
            shortcutEnabled = !shortcutEnabled;
            document.getElementById('shortcut-toggle').className = shortcutEnabled ? 'toggle active' : 'toggle';
            updateStats();
            resetCars();
        }

        function resetSimulation() {
            resetCars();
        }

        function resetCars() {
            cars = [];
            const eq = calculateEquilibrium();

            // Create cars based on equilibrium distribution
            const numCars = 40; // Visual representation

            if (!shortcutEnabled) {
                // Half go top, half go bottom
                for (let i = 0; i < numCars / 2; i++) {
                    cars.push(createCar('top', i * 0.05));
                    cars.push(createCar('bottom', i * 0.05));
                }
            } else {
                // All go through shortcut
                for (let i = 0; i < numCars; i++) {
                    cars.push(createCar('shortcut', i * 0.025));
                }
            }
        }

        function createCar(route, delay) {
            return {
                route: route,
                progress: -delay,
                color: route === 'top' ? '#3498db' : route === 'bottom' ? '#e67e22' : '#2ecc71'
            };
        }

        function getCarPosition(car) {
            const p = Math.max(0, Math.min(1, car.progress));

            if (car.route === 'top') {
                if (p < 0.5) {
                    // A to B
                    const t = p * 2;
                    return {
                        x: nodes.A.x + (nodes.B.x - nodes.A.x) * t,
                        y: nodes.A.y + (nodes.B.y - nodes.A.y) * t
                    };
                } else {
                    // B to D
                    const t = (p - 0.5) * 2;
                    return {
                        x: nodes.B.x + (nodes.D.x - nodes.B.x) * t,
                        y: nodes.B.y + (nodes.D.y - nodes.B.y) * t
                    };
                }
            } else if (car.route === 'bottom') {
                if (p < 0.5) {
                    // A to C
                    const t = p * 2;
                    return {
                        x: nodes.A.x + (nodes.C.x - nodes.A.x) * t,
                        y: nodes.A.y + (nodes.C.y - nodes.A.y) * t
                    };
                } else {
                    // C to D
                    const t = (p - 0.5) * 2;
                    return {
                        x: nodes.C.x + (nodes.D.x - nodes.C.x) * t,
                        y: nodes.C.y + (nodes.D.y - nodes.C.y) * t
                    };
                }
            } else {
                // Shortcut: A → B → C → D
                if (p < 0.33) {
                    const t = p * 3;
                    return {
                        x: nodes.A.x + (nodes.B.x - nodes.A.x) * t,
                        y: nodes.A.y + (nodes.B.y - nodes.A.y) * t
                    };
                } else if (p < 0.66) {
                    const t = (p - 0.33) * 3;
                    return {
                        x: nodes.B.x + (nodes.C.x - nodes.B.x) * t,
                        y: nodes.B.y + (nodes.C.y - nodes.B.y) * t
                    };
                } else {
                    const t = (p - 0.66) * 3;
                    return {
                        x: nodes.C.x + (nodes.D.x - nodes.C.x) * t,
                        y: nodes.C.y + (nodes.D.y - nodes.C.y) * t
                    };
                }
            }
        }

        function draw() {
            const rect = canvas.getBoundingClientRect();
            ctx.clearRect(0, 0, rect.width, rect.height);

            // Draw edges
            // A → B (traffic-dependent)
            drawEdge(nodes.A, nodes.B, '#e74c3c', 'T/100');
            // B → D (fixed 45)
            drawEdge(nodes.B, nodes.D, '#3498db', '45');
            // A → C (fixed 45)
            drawEdge(nodes.A, nodes.C, '#3498db', '45');
            // C → D (traffic-dependent)
            drawEdge(nodes.C, nodes.D, '#e74c3c', 'T/100');

            // Shortcut B → C
            if (shortcutEnabled) {
                drawEdge(nodes.B, nodes.C, '#2ecc71', '0', true);
            } else {
                // Draw dashed line to show potential shortcut
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(nodes.B.x, nodes.B.y);
                ctx.lineTo(nodes.C.x, nodes.C.y);
                ctx.strokeStyle = 'rgba(46, 204, 113, 0.3)';
                ctx.lineWidth = 2;
                ctx.stroke();
                ctx.setLineDash([]);
            }

            // Draw nodes
            Object.entries(nodes).forEach(([key, node]) => {
                ctx.beginPath();
                ctx.arc(node.x, node.y, 25, 0, Math.PI * 2);
                ctx.fillStyle = key === 'A' ? '#2ecc71' : key === 'D' ? '#e74c3c' : '#f39c12';
                ctx.fill();
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 3;
                ctx.stroke();

                ctx.fillStyle = 'white';
                ctx.font = 'bold 16px sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(key, node.x, node.y);
            });

            // Draw cars
            cars.forEach(car => {
                if (car.progress >= 0 && car.progress <= 1) {
                    const pos = getCarPosition(car);
                    ctx.beginPath();
                    ctx.arc(pos.x, pos.y, 6, 0, Math.PI * 2);
                    ctx.fillStyle = car.color;
                    ctx.fill();
                    ctx.strokeStyle = 'white';
                    ctx.lineWidth = 1.5;
                    ctx.stroke();
                }
            });
        }

        function drawEdge(from, to, color, label, isShortcut = false) {
            ctx.beginPath();
            ctx.moveTo(from.x, from.y);
            ctx.lineTo(to.x, to.y);
            ctx.strokeStyle = color;
            ctx.lineWidth = isShortcut ? 5 : 4;
            ctx.stroke();

            // Label
            const midX = (from.x + to.x) / 2;
            const midY = (from.y + to.y) / 2;
            const angle = Math.atan2(to.y - from.y, to.x - from.x);
            const offsetX = Math.sin(angle) * 15;
            const offsetY = -Math.cos(angle) * 15;

            ctx.fillStyle = 'white';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(label, midX + offsetX, midY + offsetY);
        }

        function animate() {
            // Update car positions
            const speed = shortcutEnabled ? 0.004 : 0.006; // Slower with shortcut (more traffic)
            cars.forEach(car => {
                car.progress += speed;
                if (car.progress > 1.2) {
                    car.progress = -Math.random() * 0.5;
                }
            });

            draw();
            animationId = requestAnimationFrame(animate);
        }

        window.addEventListener('resize', () => {
            resizeCanvas();
            draw();
        });

        // Initialize
        resizeCanvas();
        updateStats();
        resetCars();
        animate();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
