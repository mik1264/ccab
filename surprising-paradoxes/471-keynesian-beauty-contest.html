<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Keynesian Beauty Contest - Guess 2/3 of the Average</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 30px; }
        .back-link {
            color: #ff6b6b;
            text-decoration: none;
            margin-bottom: 20px;
            display: inline-block;
        }
        h1 {
            font-size: 2.3rem;
            background: linear-gradient(135deg, #9b59b6, #3498db, #2ecc71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        .subtitle {
            font-size: 1rem;
            color: #a0c4ff;
            max-width: 850px;
            margin: 0 auto;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 340px;
            gap: 25px;
            margin-bottom: 30px;
        }
        @media (max-width: 900px) {
            .main-grid { grid-template-columns: 1fr; }
        }

        .panel {
            background: rgba(20, 30, 50, 0.85);
            border-radius: 15px;
            padding: 25px;
        }
        .panel h2 {
            color: #feca57;
            margin-bottom: 15px;
            font-size: 1.2rem;
            text-align: center;
        }

        /* Game input */
        .game-input {
            text-align: center;
            margin-bottom: 25px;
        }
        .input-label {
            color: #a0c4ff;
            margin-bottom: 15px;
            font-size: 1rem;
        }
        .number-input {
            font-size: 3rem;
            width: 150px;
            text-align: center;
            padding: 15px;
            border: 3px solid #3498db;
            border-radius: 15px;
            background: rgba(0,0,0,0.4);
            color: #feca57;
            font-family: Georgia, serif;
        }
        .number-input:focus {
            outline: none;
            border-color: #9b59b6;
        }
        .range-hint {
            color: #666;
            font-size: 0.85rem;
            margin-top: 10px;
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            background: linear-gradient(135deg, #9b59b6, #3498db);
            color: white;
            font-weight: bold;
            margin-top: 20px;
            transition: all 0.3s;
        }
        .submit-btn:hover {
            transform: translateY(-2px);
        }
        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Results display */
        .results-area {
            display: none;
        }
        .result-stat {
            text-align: center;
            padding: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            margin-bottom: 15px;
        }
        .result-label {
            color: #888;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        .result-value {
            font-size: 2.5rem;
            font-weight: bold;
        }
        .result-value.target { color: #2ecc71; }
        .result-value.yours { color: #3498db; }
        .result-value.winner { color: #f39c12; }

        /* Number line visualization */
        #numberLine {
            width: 100%;
            height: 150px;
            margin: 20px 0;
        }

        /* Crowd guesses */
        .crowd-section {
            margin: 20px 0;
        }
        .crowd-guesses {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            max-height: 120px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
        }
        .guess-chip {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            background: rgba(100,100,100,0.3);
            color: #888;
        }
        .guess-chip.yours {
            background: #3498db;
            color: white;
        }
        .guess-chip.winner {
            background: #f39c12;
            color: white;
        }

        /* Levels of reasoning */
        .levels-section {
            margin-top: 20px;
        }
        .level-row {
            display: flex;
            align-items: center;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            margin-bottom: 8px;
        }
        .level-label {
            width: 60px;
            font-weight: bold;
            color: #9b59b6;
        }
        .level-reasoning {
            flex: 1;
            font-size: 0.85rem;
            color: #a0a0a0;
        }
        .level-guess {
            width: 50px;
            text-align: right;
            font-weight: bold;
            color: #feca57;
        }

        /* Side panel */
        .stat-box {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
            text-align: center;
        }
        .stat-label {
            color: #888;
            font-size: 0.8rem;
            margin-bottom: 5px;
        }
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #feca57;
        }

        /* Nash equilibrium highlight */
        .nash-box {
            padding: 15px;
            background: rgba(46, 204, 113, 0.15);
            border: 2px solid #2ecc71;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
        }
        .nash-title {
            color: #2ecc71;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .nash-value {
            font-size: 3rem;
            font-weight: bold;
            color: #2ecc71;
        }
        .nash-note {
            color: #888;
            font-size: 0.85rem;
            margin-top: 10px;
        }

        /* Quote */
        .quote-box {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            border-left: 3px solid #f39c12;
        }
        .quote-text {
            font-style: italic;
            color: #c0c0c0;
            font-size: 0.85rem;
            margin-bottom: 8px;
        }
        .quote-author {
            color: #888;
            font-size: 0.8rem;
        }

        /* Research section */
        .research-section {
            background: rgba(20, 30, 50, 0.85);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
        }
        .research-section h2 {
            color: #48dbfb;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        .research-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .research-card {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 20px;
            border-left: 3px solid #48dbfb;
        }
        .research-card h3 {
            color: #feca57;
            margin-bottom: 10px;
            font-size: 1rem;
        }
        .research-card p {
            color: #a0a0a0;
            font-size: 0.9rem;
        }

        /* Play again button */
        .play-again-btn {
            padding: 12px 30px;
            font-size: 1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background: #3498db;
            color: white;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-link">‚Üê Back to Gallery</a>
            <h1>The Keynesian Beauty Contest</h1>
            <p class="subtitle">
                Keynes (1936): Don't pick what YOU think is best‚Äîpick what you think OTHERS think is best.
                In this game, choose a number from 0-100. The winner is closest to <strong>2/3 of the average</strong>.
                Logical conclusion: everyone should pick 0. Reality: they don't. Why?
            </p>
        </header>

        <div class="main-grid">
            <div class="panel">
                <h2>üéØ The Guessing Game</h2>

                <div id="inputPhase">
                    <div class="game-input">
                        <div class="input-label">Pick a number from 0 to 100:</div>
                        <input type="number" class="number-input" id="userGuess" min="0" max="100" value="33">
                        <div class="range-hint">The winner is closest to 2/3 of the average of all guesses</div>
                    </div>

                    <div class="levels-section">
                        <h3 style="color: #9b59b6; margin-bottom: 15px; text-align: center;">Levels of Strategic Reasoning</h3>

                        <div class="level-row">
                            <div class="level-label">L0</div>
                            <div class="level-reasoning">"I'll just pick randomly..." ‚Üí Average = 50</div>
                            <div class="level-guess">50</div>
                        </div>

                        <div class="level-row">
                            <div class="level-label">L1</div>
                            <div class="level-reasoning">"Others will pick ~50, so I'll pick 2/3 of that"</div>
                            <div class="level-guess">33</div>
                        </div>

                        <div class="level-row">
                            <div class="level-label">L2</div>
                            <div class="level-reasoning">"They'll think like L1 and pick 33, so I'll pick..."</div>
                            <div class="level-guess">22</div>
                        </div>

                        <div class="level-row">
                            <div class="level-label">L3</div>
                            <div class="level-reasoning">"They'll be L2 thinkers, so I'll go one level deeper"</div>
                            <div class="level-guess">15</div>
                        </div>

                        <div class="level-row">
                            <div class="level-label">L‚àû</div>
                            <div class="level-reasoning">"Following this logic to infinity..." ‚Üí Nash Equilibrium</div>
                            <div class="level-guess" style="color: #2ecc71;">0</div>
                        </div>
                    </div>

                    <button class="submit-btn" onclick="submitGuess()">
                        Submit My Guess
                    </button>
                </div>

                <div class="results-area" id="resultsPhase">
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                        <div class="result-stat">
                            <div class="result-label">Your Guess</div>
                            <div class="result-value yours" id="yourGuessDisplay">33</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-label">2/3 of Average</div>
                            <div class="result-value target" id="targetDisplay">22</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-label">Winning Guess</div>
                            <div class="result-value winner" id="winnerDisplay">24</div>
                        </div>
                    </div>

                    <canvas id="numberLine"></canvas>

                    <div class="crowd-section">
                        <div style="color: #888; margin-bottom: 10px; font-size: 0.9rem;">
                            All 50 Guesses (your guess highlighted):
                        </div>
                        <div class="crowd-guesses" id="crowdGuesses"></div>
                    </div>

                    <div style="text-align: center; margin-top: 20px; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 10px;">
                        <div id="resultMessage" style="color: #a0a0a0; font-size: 0.95rem;"></div>
                    </div>

                    <button class="play-again-btn" onclick="playAgain()">Play Again</button>
                </div>
            </div>

            <div class="panel">
                <h2>üìä Game Statistics</h2>

                <div class="stat-box">
                    <div class="stat-label">Total Players</div>
                    <div class="stat-value">50</div>
                </div>

                <div class="stat-box">
                    <div class="stat-label">Average Guess</div>
                    <div class="stat-value" id="avgGuess">‚Äî</div>
                </div>

                <div class="stat-box">
                    <div class="stat-label">Target (2/3 √ó Avg)</div>
                    <div class="stat-value" id="targetStat" style="color: #2ecc71;">‚Äî</div>
                </div>

                <div class="stat-box">
                    <div class="stat-label">Your Distance from Target</div>
                    <div class="stat-value" id="yourDistance">‚Äî</div>
                </div>

                <div class="nash-box">
                    <div class="nash-title">Nash Equilibrium</div>
                    <div class="nash-value">0</div>
                    <div class="nash-note">
                        The only "rational" answer‚Äîbut real players average 22-33!
                    </div>
                </div>

                <div class="quote-box">
                    <div class="quote-text">
                        "It is not a case of choosing those which are really the prettiest...
                        We have reached the third degree where we devote our intelligences to
                        anticipating what average opinion expects the average opinion to be."
                    </div>
                    <div class="quote-author">‚Äî John Maynard Keynes, 1936</div>
                </div>
            </div>
        </div>

        <div class="research-section">
            <h2>Why Don't People Pick Zero?</h2>

            <div class="research-grid">
                <div class="research-card">
                    <h3>üì∞ Keynes's Original Analogy</h3>
                    <p>
                        Keynes described a newspaper contest where readers voted for the six most
                        attractive faces from 100 photographs. The prize went to those who picked
                        the most POPULAR faces. Smart contestants don't pick what THEY find attractive‚Äî
                        they pick what they think OTHERS will find attractive. And smarter ones think
                        about what others think others think...
                    </p>
                </div>

                <div class="research-card">
                    <h3>üìâ Stock Market Implications</h3>
                    <p>
                        Keynes argued stock prices aren't determined by "fundamental value" but by
                        what investors think OTHER investors think the price should be. This creates
                        bubbles: everyone buys because they expect others to buy, regardless of
                        underlying value. The beauty contest explains speculation and market psychology.
                    </p>
                </div>

                <div class="research-card">
                    <h3>üß† Bounded Rationality</h3>
                    <p>
                        Real humans don't iterate to infinity. Studies show most people think
                        1-3 levels deep: "Others are random (L0), so I'll guess 33 (L1)" or
                        "Others will think like that, so I'll guess 22 (L2)." Very few reach L4+.
                        This is <strong>cognitive hierarchy theory</strong>‚Äîbounded strategic reasoning.
                    </p>
                </div>

                <div class="research-card">
                    <h3>üé≤ Experimental Results</h3>
                    <p>
                        In published experiments, winning guesses cluster around 13-22.
                        Financial Times readers: winning guess was 13.
                        Caltech students: average 26.
                        With repetition, guesses converge toward 0‚Äîbut never reach it.
                        Perfect rationality requires assuming everyone else is also perfectly rational.
                    </p>
                </div>

                <div class="research-card">
                    <h3>‚ôüÔ∏è Game Theory Insight</h3>
                    <p>
                        Zero is the only <strong>Nash Equilibrium</strong>‚Äîa state where no player
                        benefits by changing their strategy. But reaching it requires
                        <strong>common knowledge of rationality</strong>: I'm rational, I know you're
                        rational, I know you know I'm rational... ad infinitum. Humans don't have this.
                    </p>
                </div>

                <div class="research-card">
                    <h3>üåç Real-World Applications</h3>
                    <p>
                        <strong>Speculative bubbles:</strong> Buy because others will buy.
                        <strong>Voting:</strong> Vote for who you think will win, not who you prefer.
                        <strong>Fashion:</strong> Wear what you think others will think is stylish.
                        <strong>Technology adoption:</strong> Use what you expect others to use.
                        The beauty contest is everywhere coordination matters.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('numberLine');
        const ctx = canvas.getContext('2d');
        let width, height;

        let userGuess = 33;
        let crowdGuesses = [];
        let target = 0;
        let winner = 0;

        function resizeCanvas() {
            const rect = canvas.getBoundingClientRect();
            width = canvas.width = rect.width * 2;
            height = canvas.height = rect.height * 2;
            ctx.scale(2, 2);
        }

        // Generate realistic crowd guesses based on cognitive hierarchy theory
        function generateCrowdGuesses() {
            crowdGuesses = [];

            // Distribution based on research:
            // L0 (random): ~15% of players
            // L1 (pick 33): ~35% of players
            // L2 (pick 22): ~30% of players
            // L3 (pick 15): ~15% of players
            // L4+ (pick <10): ~5% of players

            for (let i = 0; i < 49; i++) {
                const r = Math.random();
                let guess;

                if (r < 0.15) {
                    // L0: Random (centered around 50)
                    guess = 40 + Math.random() * 20;
                } else if (r < 0.50) {
                    // L1: Around 33
                    guess = 28 + Math.random() * 12;
                } else if (r < 0.80) {
                    // L2: Around 22
                    guess = 18 + Math.random() * 10;
                } else if (r < 0.95) {
                    // L3: Around 15
                    guess = 12 + Math.random() * 8;
                } else {
                    // L4+: Very low
                    guess = Math.random() * 10;
                }

                crowdGuesses.push(Math.round(guess));
            }

            // Add user's guess
            crowdGuesses.push(userGuess);

            // Shuffle
            crowdGuesses.sort(() => Math.random() - 0.5);
        }

        function submitGuess() {
            userGuess = parseInt(document.getElementById('userGuess').value) || 33;
            userGuess = Math.max(0, Math.min(100, userGuess));

            generateCrowdGuesses();

            // Calculate average and target
            const avg = crowdGuesses.reduce((a, b) => a + b, 0) / crowdGuesses.length;
            target = Math.round((avg * 2 / 3) * 10) / 10;

            // Find winner (closest to target)
            let minDist = Infinity;
            winner = crowdGuesses[0];
            crowdGuesses.forEach(g => {
                const dist = Math.abs(g - target);
                if (dist < minDist) {
                    minDist = dist;
                    winner = g;
                }
            });

            // Update display
            document.getElementById('inputPhase').style.display = 'none';
            document.getElementById('resultsPhase').style.display = 'block';

            document.getElementById('yourGuessDisplay').textContent = userGuess;
            document.getElementById('targetDisplay').textContent = target.toFixed(1);
            document.getElementById('winnerDisplay').textContent = winner;

            document.getElementById('avgGuess').textContent = avg.toFixed(1);
            document.getElementById('targetStat').textContent = target.toFixed(1);
            document.getElementById('yourDistance').textContent = Math.abs(userGuess - target).toFixed(1);

            // Display crowd guesses
            const container = document.getElementById('crowdGuesses');
            container.innerHTML = '';
            [...crowdGuesses].sort((a, b) => a - b).forEach(g => {
                const chip = document.createElement('span');
                chip.className = 'guess-chip';
                if (g === userGuess) chip.classList.add('yours');
                if (g === winner) chip.classList.add('winner');
                chip.textContent = g;
                container.appendChild(chip);
            });

            // Result message
            const yourDist = Math.abs(userGuess - target);
            const winDist = Math.abs(winner - target);
            let message;

            if (userGuess === winner) {
                message = `<strong style="color: #f39c12;">üèÜ YOU WON!</strong> Your guess of ${userGuess} was closest to the target of ${target.toFixed(1)}.`;
            } else if (yourDist <= 3) {
                message = `<strong style="color: #2ecc71;">Very close!</strong> You were only ${yourDist.toFixed(1)} away from the target. The winner guessed ${winner}.`;
            } else if (yourDist <= 10) {
                message = `Decent guess! The target was ${target.toFixed(1)}. You were ${yourDist.toFixed(1)} away. In real experiments, averages tend to be 22-33.`;
            } else {
                message = `The average was ${avg.toFixed(1)}, making the target ${target.toFixed(1)}. Most people think 1-2 levels deep, landing around 22-33.`;
            }

            if (userGuess === 0) {
                message += `<br><br><em>You played the Nash equilibrium‚Äîperfectly rational, but only works if everyone else is also perfectly rational!</em>`;
            }

            document.getElementById('resultMessage').innerHTML = message;

            drawNumberLine();
        }

        function drawNumberLine() {
            resizeCanvas();
            const w = width / 2;
            const h = height / 2;

            ctx.fillStyle = 'rgba(0,0,0,0.3)';
            ctx.fillRect(0, 0, w, h);

            const padding = 40;
            const lineY = h / 2;
            const lineStart = padding;
            const lineEnd = w - padding;
            const lineLength = lineEnd - lineStart;

            // Draw number line
            ctx.strokeStyle = '#444';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(lineStart, lineY);
            ctx.lineTo(lineEnd, lineY);
            ctx.stroke();

            // Draw tick marks and labels
            ctx.fillStyle = '#666';
            ctx.font = '10px Georgia';
            ctx.textAlign = 'center';
            for (let i = 0; i <= 100; i += 10) {
                const x = lineStart + (i / 100) * lineLength;
                ctx.beginPath();
                ctx.moveTo(x, lineY - 5);
                ctx.lineTo(x, lineY + 5);
                ctx.stroke();
                ctx.fillText(i.toString(), x, lineY + 18);
            }

            // Draw crowd guesses as small dots
            crowdGuesses.forEach(g => {
                if (g !== userGuess && g !== winner) {
                    const x = lineStart + (g / 100) * lineLength;
                    ctx.fillStyle = 'rgba(150, 150, 150, 0.5)';
                    ctx.beginPath();
                    ctx.arc(x, lineY - 20, 4, 0, Math.PI * 2);
                    ctx.fill();
                }
            });

            // Draw target line
            const targetX = lineStart + (target / 100) * lineLength;
            ctx.strokeStyle = '#2ecc71';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(targetX, lineY - 40);
            ctx.lineTo(targetX, lineY + 30);
            ctx.stroke();
            ctx.setLineDash([]);

            ctx.fillStyle = '#2ecc71';
            ctx.font = 'bold 11px Georgia';
            ctx.fillText('TARGET: ' + target.toFixed(1), targetX, lineY - 45);

            // Draw user's guess
            const userX = lineStart + (userGuess / 100) * lineLength;
            ctx.fillStyle = '#3498db';
            ctx.beginPath();
            ctx.arc(userX, lineY - 20, 8, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = 'white';
            ctx.font = 'bold 10px Georgia';
            ctx.fillText('YOU', userX, lineY - 18);

            // Draw winner
            if (winner !== userGuess) {
                const winX = lineStart + (winner / 100) * lineLength;
                ctx.fillStyle = '#f39c12';
                ctx.beginPath();
                ctx.arc(winX, lineY - 20, 8, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = 'white';
                ctx.font = 'bold 10px Georgia';
                ctx.fillText('WIN', winX, lineY - 18);
            }

            // Nash equilibrium indicator
            ctx.fillStyle = 'rgba(46, 204, 113, 0.3)';
            ctx.beginPath();
            ctx.arc(lineStart, lineY, 15, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#2ecc71';
            ctx.font = '8px Georgia';
            ctx.fillText('Nash', lineStart, lineY + 30);
            ctx.fillText('(0)', lineStart, lineY + 40);

            // Average indicator
            const avgX = lineStart + (crowdGuesses.reduce((a, b) => a + b) / crowdGuesses.length / 100) * lineLength;
            ctx.fillStyle = '#9b59b6';
            ctx.beginPath();
            ctx.moveTo(avgX, lineY + 25);
            ctx.lineTo(avgX - 6, lineY + 35);
            ctx.lineTo(avgX + 6, lineY + 35);
            ctx.closePath();
            ctx.fill();
            ctx.font = '9px Georgia';
            ctx.fillText('AVG', avgX, lineY + 48);
        }

        function playAgain() {
            document.getElementById('inputPhase').style.display = 'block';
            document.getElementById('resultsPhase').style.display = 'none';

            document.getElementById('avgGuess').textContent = '‚Äî';
            document.getElementById('targetStat').textContent = '‚Äî';
            document.getElementById('yourDistance').textContent = '‚Äî';
        }

        // Initialize
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
