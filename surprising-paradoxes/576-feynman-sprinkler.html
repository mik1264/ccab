<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feynman's Reverse Sprinkler: 140-Year Mystery Solved | Surprising Paradoxes</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #051520 0%, #0a2535 50%, #051825 100%);
            color: #e0e0e0;
            min-height: 100vh;
            overflow-x: hidden;
        }
        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #44aadd;
            text-decoration: none;
            font-size: 1rem;
            z-index: 100;
            padding: 8px 16px;
            background: rgba(0,0,0,0.5);
            border-radius: 20px;
            transition: all 0.3s ease;
        }
        .back-link:hover {
            background: rgba(50, 150, 200, 0.3);
            transform: translateX(-3px);
        }
        header {
            text-align: center;
            padding: 80px 20px 30px;
        }
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #44aadd, #66ccff, #88eeff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .subtitle {
            color: #6699aa;
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        .demo-section {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 30px;
            margin-bottom: 40px;
        }
        @media (max-width: 900px) {
            .demo-section {
                grid-template-columns: 1fr;
            }
        }
        .canvas-container {
            background: linear-gradient(145deg, #051520, #0a2838);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0,80,150,0.2);
        }
        canvas {
            display: block;
            width: 100%;
            border-radius: 10px;
        }
        .controls {
            background: linear-gradient(145deg, #081820, #0c2535);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,80,150,0.2);
        }
        .mode-display {
            text-align: center;
            padding: 15px;
            background: rgba(50, 150, 200, 0.15);
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .mode-display .mode {
            font-size: 1.5rem;
            font-weight: bold;
        }
        .mode-display .forward { color: #44dd88; }
        .mode-display .reverse { color: #ff8866; }
        .mode-display .label {
            font-size: 0.85rem;
            color: #6699aa;
            margin-top: 5px;
        }
        .info-panel {
            background: rgba(0, 100, 150, 0.15);
            border: 1px solid rgba(50, 150, 200, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .info-panel h3 {
            color: #44aadd;
            font-size: 0.95rem;
            margin-bottom: 12px;
            border-bottom: 1px solid rgba(50, 150, 200, 0.2);
            padding-bottom: 8px;
        }
        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.85rem;
        }
        .info-label { color: #6699aa; }
        .info-value {
            color: #fff;
            font-family: 'Consolas', monospace;
        }
        .control-group {
            margin-bottom: 20px;
        }
        .control-group label {
            display: block;
            margin-bottom: 8px;
            color: #44aadd;
            font-size: 0.9rem;
        }
        .control-group input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #0a2535;
            outline: none;
            -webkit-appearance: none;
        }
        .control-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, #44aadd, #2288bb);
            cursor: pointer;
        }
        .value-display {
            text-align: right;
            font-size: 0.85rem;
            color: #aaa;
            margin-top: 5px;
        }
        .mode-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .mode-buttons button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .mode-buttons button.forward-btn {
            background: linear-gradient(135deg, #228855, #116644);
            color: white;
        }
        .mode-buttons button.forward-btn:hover {
            background: linear-gradient(135deg, #33aa66, #228855);
        }
        .mode-buttons button.forward-btn.active {
            background: linear-gradient(135deg, #44dd88, #33bb66);
            box-shadow: 0 0 15px rgba(50, 200, 100, 0.4);
        }
        .mode-buttons button.reverse-btn {
            background: linear-gradient(135deg, #884422, #663311);
            color: white;
        }
        .mode-buttons button.reverse-btn:hover {
            background: linear-gradient(135deg, #aa5533, #884422);
        }
        .mode-buttons button.reverse-btn.active {
            background: linear-gradient(135deg, #ff8866, #dd6644);
            box-shadow: 0 0 15px rgba(255, 100, 50, 0.4);
        }
        button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, #2288bb, #115588);
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }
        button:hover {
            background: linear-gradient(135deg, #33aadd, #2288bb);
            transform: translateY(-2px);
        }
        .essay {
            background: linear-gradient(145deg, #051520, #0a2838);
            border-radius: 15px;
            padding: 40px;
            line-height: 1.8;
            box-shadow: 0 10px 40px rgba(0,80,150,0.2);
        }
        .essay h2 {
            color: #44aadd;
            margin: 30px 0 15px;
            font-size: 1.5rem;
        }
        .essay h2:first-child { margin-top: 0; }
        .essay p {
            margin-bottom: 15px;
            color: #b8c8d0;
        }
        .essay strong { color: #88ddff; }
        .essay em { color: #ffcc88; font-style: italic; }
        .highlight-box {
            background: rgba(50, 150, 200, 0.15);
            border-left: 4px solid #44aadd;
            padding: 20px;
            margin: 25px 0;
            border-radius: 0 10px 10px 0;
        }
        .highlight-box.solved {
            background: rgba(50, 200, 100, 0.15);
            border-left-color: #44dd88;
        }
        .formula {
            text-align: center;
            padding: 20px;
            background: rgba(0, 30, 50, 0.5);
            border-radius: 10px;
            margin: 20px 0;
            font-family: 'Times New Roman', serif;
            font-size: 1.2rem;
            color: #88ddff;
        }
        .sources {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #1a3545;
        }
        .sources h3 {
            color: #6699aa;
            margin-bottom: 15px;
        }
        .sources ul {
            list-style: none;
        }
        .sources li {
            margin-bottom: 10px;
        }
        .sources a {
            color: #4488aa;
            text-decoration: none;
        }
        .sources a:hover {
            color: #66ccff;
            text-decoration: underline;
        }
        .solved-badge {
            display: inline-block;
            background: linear-gradient(135deg, #44dd88, #22aa55);
            color: #000;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Paradoxes</a>

    <header>
        <h1>Feynman's Reverse Sprinkler <span class="solved-badge">SOLVED 2024</span></h1>
        <p class="subtitle">A 140-year physics puzzle: if a sprinkler spins when water shoots out, what happens when it sucks water in?</p>
    </header>

    <div class="container">
        <div class="demo-section">
            <div class="canvas-container">
                <canvas id="canvas"></canvas>
            </div>
            <div class="controls">
                <div class="mode-display">
                    <div class="mode" id="modeLabel">Forward Mode</div>
                    <div class="label" id="modeDesc">Water ejects ‚Üí Sprinkler spins counter-clockwise</div>
                </div>

                <div class="mode-buttons">
                    <button class="forward-btn active" id="forwardBtn">üí¶ Forward</button>
                    <button class="reverse-btn" id="reverseBtn">üåÄ Reverse</button>
                </div>

                <div class="info-panel">
                    <h3>Physics State</h3>
                    <div class="info-row">
                        <span class="info-label">Angular Velocity</span>
                        <span class="info-value" id="angularVel">12.5 rad/s</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Flow Direction</span>
                        <span class="info-value" id="flowDir">Outward</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Torque Source</span>
                        <span class="info-value" id="torqueSource">Reaction force</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Speed Ratio</span>
                        <span class="info-value" id="speedRatio">~50√ó faster</span>
                    </div>
                </div>

                <div class="control-group">
                    <label>Flow Rate</label>
                    <input type="range" id="flowRate" min="0.3" max="2" value="1" step="0.1">
                    <div class="value-display" id="flowDisplay">1.0√ó</div>
                </div>

                <div class="control-group">
                    <label>Time Scale</label>
                    <input type="range" id="timeScale" min="0.2" max="2" value="1" step="0.1">
                    <div class="value-display" id="timeDisplay">1.0√ó</div>
                </div>

                <button id="toggleBtn">‚è∏ Pause</button>
            </div>
        </div>

        <div class="essay">
            <h2>The 140-Year Mystery</h2>
            <p>
                A lawn sprinkler works by reaction: water shoots out the curved arms, and by
                Newton's third law, the sprinkler spins in the opposite direction. Simple enough.
                But what happens if you <strong>reverse the flow</strong>‚Äîsucking water <em>into</em>
                the sprinkler instead of ejecting it? Does it spin the same way? The opposite way?
                Not at all?
            </p>

            <div class="highlight-box">
                <strong>The Question:</strong> Ernst Mach first posed this puzzle in the 1880s.
                Richard Feynman famously worked on it at Princeton in the 1940s (and allegedly
                exploded a container while experimenting). Despite over a century of attempts,
                the answer remained disputed until January 2024.
            </div>

            <h2>Why It's Hard</h2>
            <p>
                At first glance, you might think symmetry demands the sprinkler spin backward when
                sucking‚Äîafter all, the flow is reversed. But the physics isn't symmetric. When water
                <em>exits</em>, it carries momentum away from the nozzles, creating clear reaction torque.
                When water <em>enters</em>, the momentum change happens more subtly, as the incoming
                flow must turn and accelerate through the curved arms.
            </p>
            <p>
                Feynman himself wrote: "The problem is subtle. When the sprinkler is submerged and
                water flows in, there is no clear argument that it should or shouldn't turn." Textbooks
                disagreed. Experiments gave conflicting results. Some said no rotation; others saw
                forward rotation; still others saw reverse rotation.
            </p>

            <h2>The 2024 Solution</h2>
            <p>
                In January 2024, Leif Ristroph's team at NYU's Courant Institute finally settled the
                question with careful experiments and analysis, published in <em>Physical Review Letters</em>.
            </p>

            <div class="highlight-box solved">
                <strong>The Answer:</strong> The reverse sprinkler <em>does</em> rotate‚Äîin the
                <strong>opposite direction</strong> from forward mode‚Äîbut much more <em>slowly</em>,
                roughly 50 times slower than the forward sprinkler at the same flow rate.
            </div>

            <h2>The Mechanism: Centrifugal Jets</h2>
            <p>
                The key insight is that the incoming water jets <strong>don't collide head-on</strong>
                inside the sprinkler's central chamber. Instead, they slam together at a slight angle,
                creating an asymmetric flow pattern that generates torque.
            </p>
            <p>
                More specifically, when water flows through the curved arms during suction, centrifugal
                effects cause the flow to "hug" the outer walls of the curved conduits. This creates an
                asymmetric angular momentum flux that, surprisingly, produces a weak net torque in the
                reverse direction.
            </p>

            <div class="formula">
                Forward: œÑ = œÅQ¬≤r/A (strong reaction force)<br>
                Reverse: œÑ ‚âà centrifugal asymmetry effects (much weaker)
            </div>

            <h2>Why Forward Is Faster</h2>
            <p>
                In forward mode, there's a clear <strong>rocket-like mechanism</strong>: water exits
                at high velocity, and the sprinkler feels the reaction force directly. The torque
                scales with the square of the flow rate and the arm length.
            </p>
            <p>
                In reverse mode, the torque comes from subtle internal flow effects‚Äînot a direct
                reaction to exiting momentum. The water must change direction multiple times, and
                the asymmetries that produce rotation are second-order effects. This explains the
                50√ó speed difference.
            </p>

            <h2>Feynman's Experiment</h2>
            <p>
                Richard Feynman's attempt at Princeton is legendary‚Äîand possibly apocryphal in its
                dramatic details. He placed a sprinkler in a large carboy (glass bottle) and
                pressurized it to force water in. At some point, the container exploded, showering
                the lab with glass and water.
            </p>
            <p>
                Whether the explosion happened as dramatically as the stories suggest, Feynman's
                conclusion was that the sprinkler barely moved when sucking in water. He was right
                about the effect being weak‚Äîthe 2024 work confirms the motion is real but slow.
            </p>

            <h2>Why It Took 140 Years</h2>
            <p>
                The reverse sprinkler problem is a cautionary tale about how <strong>seemingly simple
                physics can hide deep complexity</strong>. The effects involved‚Äîcurved flow paths,
                centrifugal forces, momentum flux in confined geometries‚Äîdon't yield to simple
                intuition or back-of-envelope calculations.
            </p>
            <p>
                Modern high-speed cameras, precise torque measurements, and computational fluid
                dynamics finally provided the tools to resolve what pen-and-paper physics could not.
            </p>

            <div class="sources">
                <h3>Sources & Further Reading</h3>
                <ul>
                    <li><a href="https://en.wikipedia.org/wiki/Feynman_sprinkler">Wikipedia: Feynman Sprinkler</a></li>
                    <li><a href="https://physics.aps.org/articles/v17/15">Physics APS: Feynman's Reversed Sprinkler Puzzle Solved</a></li>
                    <li><a href="https://www.nyu.edu/about/news-publications/news/2024/january/how-does-a--reverse-sprinkler--work--researchers-solve-decades-o.html">NYU News: Reverse Sprinkler Solution</a></li>
                    <li><a href="https://link.aps.org/doi/10.1103/PhysRevLett.132.044003">Phys. Rev. Lett. 132, 044003 (2024)</a></li>
                    <li><a href="https://www.nature.com/articles/d41586-024-00246-x">Nature: The Mystery of Feynman's Sprinkler Solved at Last</a></li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // High DPI setup
        const dpr = window.devicePixelRatio || 1;
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width * dpr;
        canvas.height = rect.width * 0.8 * dpr;
        canvas.style.height = rect.width * 0.8 + 'px';
        ctx.scale(dpr, dpr);

        const width = rect.width;
        const height = rect.width * 0.8;
        const centerX = width / 2;
        const centerY = height / 2;

        // State
        let time = 0;
        let running = true;
        let mode = 'forward'; // 'forward' or 'reverse'
        let flowRate = 1.0;
        let timeScale = 1.0;
        let sprinklerAngle = 0;
        let particles = [];

        // Controls
        const forwardBtn = document.getElementById('forwardBtn');
        const reverseBtn = document.getElementById('reverseBtn');
        const flowSlider = document.getElementById('flowRate');
        const timeSlider = document.getElementById('timeScale');
        const toggleBtn = document.getElementById('toggleBtn');

        forwardBtn.addEventListener('click', () => {
            mode = 'forward';
            forwardBtn.classList.add('active');
            reverseBtn.classList.remove('active');
            updateDisplay();
        });

        reverseBtn.addEventListener('click', () => {
            mode = 'reverse';
            reverseBtn.classList.add('active');
            forwardBtn.classList.remove('active');
            updateDisplay();
        });

        flowSlider.addEventListener('input', e => {
            flowRate = parseFloat(e.target.value);
            document.getElementById('flowDisplay').textContent = flowRate.toFixed(1) + '√ó';
        });

        timeSlider.addEventListener('input', e => {
            timeScale = parseFloat(e.target.value);
            document.getElementById('timeDisplay').textContent = timeScale.toFixed(1) + '√ó';
        });

        toggleBtn.addEventListener('click', () => {
            running = !running;
            toggleBtn.textContent = running ? '‚è∏ Pause' : '‚ñ∂ Play';
        });

        function updateDisplay() {
            const modeLabel = document.getElementById('modeLabel');
            const modeDesc = document.getElementById('modeDesc');

            if (mode === 'forward') {
                modeLabel.textContent = 'Forward Mode';
                modeLabel.className = 'mode forward';
                modeDesc.textContent = 'Water ejects ‚Üí Fast counter-clockwise spin';
                document.getElementById('flowDir').textContent = 'Outward';
                document.getElementById('torqueSource').textContent = 'Reaction force';
                document.getElementById('speedRatio').textContent = '~50√ó faster';
            } else {
                modeLabel.textContent = 'Reverse Mode';
                modeLabel.className = 'mode reverse';
                modeDesc.textContent = 'Water enters ‚Üí Slow clockwise spin';
                document.getElementById('flowDir').textContent = 'Inward';
                document.getElementById('torqueSource').textContent = 'Centrifugal asymmetry';
                document.getElementById('speedRatio').textContent = '~50√ó slower';
            }
        }

        class WaterParticle {
            constructor(nozzle, outward) {
                this.nozzle = nozzle;
                this.outward = outward;
                this.reset();
            }

            reset() {
                this.life = 1;
                if (this.outward) {
                    this.progress = 0;
                } else {
                    this.progress = 1;
                }
            }

            update(armAngle) {
                const speed = 0.02 * flowRate * timeScale;
                if (this.outward) {
                    this.progress += speed;
                    if (this.progress > 1.5) this.reset();
                } else {
                    this.progress -= speed;
                    if (this.progress < -0.3) {
                        this.progress = 1;
                    }
                }
            }

            getPosition(armAngle, armLength) {
                const nozzleAngle = armAngle + this.nozzle * Math.PI;
                const t = Math.max(0, Math.min(1, this.progress));

                // Path along curved arm
                const r = 20 + t * (armLength - 20);
                const curvature = 0.3 * t; // Arm curves outward
                const angle = nozzleAngle + curvature;

                return {
                    x: centerX + Math.cos(angle) * r,
                    y: centerY + Math.sin(angle) * r,
                    alpha: t < 1 ? 1 : Math.max(0, 1 - (this.progress - 1) * 2)
                };
            }
        }

        // Initialize particles
        function initParticles() {
            particles = [];
            for (let nozzle = 0; nozzle < 2; nozzle++) {
                for (let i = 0; i < 20; i++) {
                    const p = new WaterParticle(nozzle, mode === 'forward');
                    p.progress = i / 20 * (mode === 'forward' ? 1.5 : 1);
                    particles.push(p);
                }
            }
        }

        function drawWater() {
            const armLength = 100;

            // Draw water tank/container
            ctx.fillStyle = 'rgba(30, 80, 120, 0.3)';
            ctx.beginPath();
            ctx.arc(centerX, centerY, 180, 0, Math.PI * 2);
            ctx.fill();

            ctx.strokeStyle = 'rgba(100, 180, 220, 0.5)';
            ctx.lineWidth = 3;
            ctx.stroke();

            // Draw submerged label
            ctx.fillStyle = 'rgba(100, 180, 220, 0.5)';
            ctx.font = '12px Segoe UI';
            ctx.textAlign = 'center';
            ctx.fillText('Submerged in water', centerX, centerY + 160);
        }

        function drawSprinkler() {
            const armLength = 100;
            const hubRadius = 25;

            ctx.save();
            ctx.translate(centerX, centerY);
            ctx.rotate(sprinklerAngle);

            // Draw arms with S-curve
            for (let arm = 0; arm < 2; arm++) {
                const armAngle = arm * Math.PI;

                ctx.save();
                ctx.rotate(armAngle);

                // Arm pipe
                ctx.strokeStyle = '#556677';
                ctx.lineWidth = 12;
                ctx.lineCap = 'round';

                ctx.beginPath();
                ctx.moveTo(hubRadius, 0);

                // Curved arm
                ctx.quadraticCurveTo(
                    armLength * 0.6, -armLength * 0.2,
                    armLength, -armLength * 0.3
                );
                ctx.stroke();

                // Nozzle
                ctx.fillStyle = '#445566';
                ctx.beginPath();
                ctx.arc(armLength, -armLength * 0.3, 8, 0, Math.PI * 2);
                ctx.fill();

                ctx.restore();
            }

            // Central hub
            const hubGrad = ctx.createRadialGradient(0, 0, 0, 0, 0, hubRadius);
            hubGrad.addColorStop(0, '#778899');
            hubGrad.addColorStop(0.7, '#556677');
            hubGrad.addColorStop(1, '#445566');
            ctx.fillStyle = hubGrad;
            ctx.beginPath();
            ctx.arc(0, 0, hubRadius, 0, Math.PI * 2);
            ctx.fill();

            // Hub center hole
            ctx.fillStyle = '#334455';
            ctx.beginPath();
            ctx.arc(0, 0, 8, 0, Math.PI * 2);
            ctx.fill();

            ctx.restore();
        }

        function drawWaterFlow() {
            const armLength = 100;

            particles.forEach(p => {
                p.outward = (mode === 'forward');
                p.update(sprinklerAngle);

                const nozzleAngle = sprinklerAngle + p.nozzle * Math.PI;
                const t = Math.max(0, Math.min(1, p.progress));

                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(nozzleAngle);

                // Position along curved arm
                const x = 25 + t * (armLength - 25);
                const y = -t * t * armLength * 0.3;

                let alpha = 0.8;
                if (p.progress > 1) {
                    // Water stream beyond nozzle
                    const extra = p.progress - 1;
                    const streamX = armLength + extra * 80;
                    const streamY = -armLength * 0.3 - extra * 40;

                    alpha = Math.max(0, 1 - extra * 2);

                    ctx.fillStyle = `rgba(100, 200, 255, ${alpha * 0.7})`;
                    ctx.beginPath();
                    ctx.arc(streamX, streamY, 4, 0, Math.PI * 2);
                    ctx.fill();
                } else if (p.progress >= 0) {
                    // Water inside arm
                    ctx.fillStyle = `rgba(100, 200, 255, ${alpha})`;
                    ctx.beginPath();
                    ctx.arc(x, y, 3, 0, Math.PI * 2);
                    ctx.fill();
                }

                ctx.restore();
            });

            // Draw flow arrows at nozzles
            for (let arm = 0; arm < 2; arm++) {
                const nozzleAngle = sprinklerAngle + arm * Math.PI;
                const nozzleX = centerX + Math.cos(nozzleAngle) * 100 +
                               Math.cos(nozzleAngle - Math.PI/2) * (-30);
                const nozzleY = centerY + Math.sin(nozzleAngle) * 100 +
                               Math.sin(nozzleAngle - Math.PI/2) * (-30);

                // Direction indicator
                const arrowAngle = nozzleAngle + (mode === 'forward' ? 0.5 : -2.5);
                const arrowLen = mode === 'forward' ? 30 : 20;

                ctx.strokeStyle = mode === 'forward' ? '#44dd88' : '#ff8866';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(nozzleX, nozzleY);
                ctx.lineTo(
                    nozzleX + Math.cos(arrowAngle) * arrowLen,
                    nozzleY + Math.sin(arrowAngle) * arrowLen
                );
                ctx.stroke();

                // Arrowhead
                const tipX = nozzleX + Math.cos(arrowAngle) * arrowLen;
                const tipY = nozzleY + Math.sin(arrowAngle) * arrowLen;
                ctx.fillStyle = mode === 'forward' ? '#44dd88' : '#ff8866';
                ctx.beginPath();
                ctx.moveTo(tipX, tipY);
                ctx.lineTo(
                    tipX - Math.cos(arrowAngle - 0.5) * 10,
                    tipY - Math.sin(arrowAngle - 0.5) * 10
                );
                ctx.lineTo(
                    tipX - Math.cos(arrowAngle + 0.5) * 10,
                    tipY - Math.sin(arrowAngle + 0.5) * 10
                );
                ctx.closePath();
                ctx.fill();
            }
        }

        function drawRotationIndicator() {
            // Draw rotation direction arc
            const arcRadius = 60;
            const direction = mode === 'forward' ? -1 : 1;
            const color = mode === 'forward' ? '#44dd88' : '#ff8866';

            ctx.strokeStyle = color;
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(centerX, centerY, arcRadius, -Math.PI/4, Math.PI/4, direction > 0);
            ctx.stroke();

            // Arrowhead on arc
            const arrowAngle = direction > 0 ? Math.PI/4 : -Math.PI/4;
            const tipX = centerX + Math.cos(arrowAngle) * arcRadius;
            const tipY = centerY + Math.sin(arrowAngle) * arcRadius;

            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.save();
            ctx.translate(tipX, tipY);
            ctx.rotate(arrowAngle + direction * Math.PI/2);
            ctx.moveTo(0, 0);
            ctx.lineTo(-8, -5);
            ctx.lineTo(-8, 5);
            ctx.closePath();
            ctx.restore();
            ctx.fill();

            // Speed label
            ctx.fillStyle = color;
            ctx.font = 'bold 14px Segoe UI';
            ctx.textAlign = 'center';
            const speedLabel = mode === 'forward' ? 'FAST' : 'SLOW (~50√ó slower)';
            ctx.fillText(speedLabel, centerX, centerY + arcRadius + 25);
        }

        function drawLabels() {
            ctx.fillStyle = '#6699aa';
            ctx.font = '14px Segoe UI';
            ctx.textAlign = 'left';
            ctx.fillText(mode === 'forward' ? 'Water EXITS nozzles' : 'Water ENTERS nozzles', 20, 30);

            ctx.textAlign = 'right';
            const rotDir = mode === 'forward' ? 'Counter-clockwise' : 'Clockwise (reverse!)';
            ctx.fillText('Rotation: ' + rotDir, width - 20, 30);
        }

        function animate() {
            // Clear
            ctx.fillStyle = '#051520';
            ctx.fillRect(0, 0, width, height);

            // Draw components
            drawWater();
            drawWaterFlow();
            drawSprinkler();
            drawRotationIndicator();
            drawLabels();

            // Update physics
            if (running) {
                const baseSpeed = 0.02 * flowRate * timeScale;
                const direction = mode === 'forward' ? -1 : 1;
                const speedMultiplier = mode === 'forward' ? 1 : 0.02; // 50√ó slower in reverse

                sprinklerAngle += baseSpeed * direction * speedMultiplier;

                // Update angular velocity display
                const angVel = Math.abs(baseSpeed * speedMultiplier * 60).toFixed(2);
                document.getElementById('angularVel').textContent = angVel + ' rad/s';

                time += 16 * timeScale;
            }

            requestAnimationFrame(animate);
        }

        // Handle resize
        window.addEventListener('resize', () => {
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.width * 0.8 * dpr;
            canvas.style.height = rect.width * 0.8 + 'px';
            ctx.scale(dpr, dpr);
        });

        initParticles();
        updateDisplay();
        animate();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
