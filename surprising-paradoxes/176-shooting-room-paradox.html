<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Shooting Room Paradox - A 90% Death Rate from Fair Dice</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1a0a0a 0%, #2d1515 50%, #1a1a2e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.4em;
            background: linear-gradient(135deg, #ff4444, #ff8844, #ffcc44);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.3em;
            color: #aaa;
            font-style: italic;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #ff6b6b;
            text-decoration: none;
            font-size: 1.1em;
            z-index: 100;
            transition: color 0.3s;
        }

        .back-link:hover {
            color: #ffd700;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        @media (max-width: 1000px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: rgba(40, 20, 20, 0.85);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 100, 100, 0.3);
        }

        .panel h2 {
            color: #ff6b6b;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .panel h3 {
            color: #ffaa66;
            margin: 15px 0 10px 0;
            font-size: 1.1em;
        }

        .room-container {
            position: relative;
            background: linear-gradient(180deg, #1a1a2e 0%, #0d0d1a 100%);
            border-radius: 10px;
            height: 300px;
            overflow: hidden;
            border: 2px solid #333;
        }

        .room-label {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            color: #666;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        #roomCanvas {
            width: 100%;
            height: 100%;
        }

        .dice-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }

        .die {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #fff 0%, #ddd 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            font-weight: bold;
            color: #333;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: transform 0.1s;
        }

        .die.rolling {
            animation: shake 0.1s infinite;
        }

        @keyframes shake {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }

        .die.death {
            background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
            color: white;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .stat-box {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-box .value {
            font-size: 2em;
            font-weight: bold;
            color: #ffd700;
        }

        .stat-box .label {
            font-size: 0.85em;
            color: #888;
            margin-top: 5px;
        }

        .stat-box.survivors .value {
            color: #44ff44;
        }

        .stat-box.deaths .value {
            color: #ff4444;
        }

        .progress-bar {
            height: 30px;
            background: #222;
            border-radius: 15px;
            overflow: hidden;
            margin: 15px 0;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .progress-fill.deaths {
            background: linear-gradient(90deg, #ff4444, #cc0000);
        }

        .progress-label {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.85em;
            color: #aaa;
        }

        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        button {
            padding: 12px 25px;
            font-size: 1em;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ff6b6b, #ff4444);
            color: white;
        }

        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(255, 100, 100, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #666, #444);
            color: white;
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #888, #666);
        }

        .argument-panel {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 20px;
            margin: 10px 0;
            border-left: 4px solid;
        }

        .argument-panel.optimistic {
            border-color: #44ff44;
        }

        .argument-panel.pessimistic {
            border-color: #ff4444;
        }

        .argument-panel h4 {
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .argument-panel.optimistic h4 {
            color: #44ff44;
        }

        .argument-panel.pessimistic h4 {
            color: #ff4444;
        }

        .math {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            color: #ffd700;
        }

        .explanation {
            line-height: 1.8;
            color: #ccc;
        }

        .explanation p {
            margin-bottom: 15px;
        }

        .highlight {
            background: rgba(255, 215, 0, 0.2);
            padding: 2px 6px;
            border-radius: 4px;
            color: #ffd700;
        }

        .monte-carlo-panel {
            background: rgba(30, 30, 50, 0.9);
            border: 1px solid rgba(100, 100, 255, 0.3);
        }

        .monte-carlo-panel h2 {
            color: #6b8bff;
        }

        #monteCarloCanvas {
            width: 100%;
            height: 200px;
            border-radius: 10px;
            background: #111;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .batch-info {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .batch-info span {
            color: #aaa;
        }

        .batch-info .current {
            color: #ffd700;
            font-weight: bold;
        }

        .insight-box {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 150, 0, 0.1));
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .insight-box h3 {
            color: #ffd700;
            margin-bottom: 10px;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .comparison-table th, .comparison-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #444;
        }

        .comparison-table th {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
        }

        .comparison-table tr:nth-child(even) {
            background: rgba(0,0,0,0.2);
        }

        .source-link {
            color: #6b8bff;
            text-decoration: none;
        }

        .source-link:hover {
            text-decoration: underline;
        }

        .connection-box {
            background: rgba(100, 50, 150, 0.2);
            border: 1px solid rgba(150, 100, 200, 0.4);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .connection-box h3 {
            color: #bb88ff;
        }

        .person {
            position: absolute;
            width: 8px;
            height: 16px;
            border-radius: 4px 4px 2px 2px;
            transition: all 0.3s;
        }

        .person.alive {
            background: #44ff44;
        }

        .person.dead {
            background: #ff4444;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Paradoxes</a>

    <div class="container">
        <header>
            <h1>The Shooting Room Paradox</h1>
            <p class="subtitle">Fair dice, unfair odds: How 97% survival becomes 90% death</p>
        </header>

        <div class="main-grid">
            <!-- Simulation Panel -->
            <div class="panel">
                <h2>The Experiment</h2>

                <div class="batch-info">
                    <span>Round: <span class="current" id="roundNum">1</span></span>
                    <span>Batch Size: <span class="current" id="batchSize">10</span></span>
                    <span>Status: <span class="current" id="status">Waiting...</span></span>
                </div>

                <div class="room-container">
                    <div class="room-label">The Room</div>
                    <canvas id="roomCanvas"></canvas>
                </div>

                <div class="dice-container">
                    <div class="die" id="die1">?</div>
                    <div class="die" id="die2">?</div>
                </div>

                <div class="controls">
                    <button class="btn-primary" id="stepBtn">Roll Dice</button>
                    <button class="btn-secondary" id="autoBtn">Auto Run</button>
                    <button class="btn-secondary" id="resetBtn">Reset</button>
                </div>

                <div class="stats-grid">
                    <div class="stat-box survivors">
                        <div class="value" id="survivorCount">0</div>
                        <div class="label">Survivors</div>
                    </div>
                    <div class="stat-box deaths">
                        <div class="value" id="deathCount">0</div>
                        <div class="label">Shot</div>
                    </div>
                </div>

                <div class="progress-bar">
                    <span class="progress-label">Death Rate</span>
                    <div class="progress-fill deaths" id="deathBar" style="width: 0%"></div>
                </div>
            </div>

            <!-- Two Arguments Panel -->
            <div class="panel">
                <h2>The Paradox: Two Valid Arguments</h2>

                <div class="argument-panel optimistic">
                    <h4>Argument 1: The Dice Are Fair!</h4>
                    <p>You're in the room. The dice are about to be rolled. Double-six kills everyone.</p>
                    <p><span class="math">P(double-six) = 1/36 ≈ 2.8%</span></p>
                    <p>Therefore: <span class="highlight">P(survival) = 35/36 ≈ 97.2%</span></p>
                    <p style="color: #44ff44; margin-top: 10px;">Relax! You'll almost certainly survive.</p>
                </div>

                <div class="argument-panel pessimistic">
                    <h4>Argument 2: Count the Bodies!</h4>
                    <p>When the experiment ends (double-six), who was shot?</p>
                    <p>The <em>final batch</em> is always 10× larger than all previous batches combined!</p>
                    <p><span class="math">10<sup>n</sup> > 10<sup>0</sup> + 10<sup>1</sup> + ... + 10<sup>n-1</sup></span></p>
                    <p>Over 90% of all participants are in the death batch.</p>
                    <p>Therefore: <span class="highlight">P(death) ≈ 90%</span></p>
                    <p style="color: #ff4444; margin-top: 10px;">You're almost certainly doomed!</p>
                </div>

                <div class="insight-box">
                    <h3>Which Argument Is Correct?</h3>
                    <p>Both arguments are mathematically valid! The paradox arises from <strong>observer selection effects</strong>.</p>
                    <p style="margin-top: 10px;">If you reason "<em>I'm a random person in the room</em>," then you're ~90% likely to be in the final batch.</p>
                    <p style="margin-top: 10px;">The dice are fair, but <em>you</em> are not a random sample of dice rolls—you're a random sample of <em>people</em>.</p>
                </div>
            </div>

            <!-- Monte Carlo Panel -->
            <div class="panel monte-carlo-panel full-width">
                <h2>Monte Carlo: Running 1000 Experiments</h2>
                <canvas id="monteCarloCanvas"></canvas>
                <div class="stats-grid" style="margin-top: 15px;">
                    <div class="stat-box">
                        <div class="value" id="mcRuns">0</div>
                        <div class="label">Experiments Run</div>
                    </div>
                    <div class="stat-box">
                        <div class="value" id="mcDeathRate">0%</div>
                        <div class="label">Observed Death Rate</div>
                    </div>
                    <div class="stat-box">
                        <div class="value" id="mcAvgBatch">0</div>
                        <div class="label">Avg Final Batch Size</div>
                    </div>
                    <div class="stat-box">
                        <div class="value" id="mcAvgSurvivors">0</div>
                        <div class="label">Avg Survivors</div>
                    </div>
                </div>
                <div class="controls">
                    <button class="btn-primary" id="mcRunBtn">Run 100 Experiments</button>
                    <button class="btn-secondary" id="mcResetBtn">Reset Stats</button>
                </div>
            </div>

            <!-- Explanation Panel -->
            <div class="panel full-width">
                <h2>Understanding the Paradox</h2>

                <div class="explanation">
                    <h3>The Setup (John Leslie, 1996)</h3>
                    <p>Imagine a room of infinite capacity. People enter in batches: first 10, then 100, then 1,000... Each time, two fair dice are rolled:</p>
                    <ul style="margin-left: 20px; margin-bottom: 15px;">
                        <li><strong>Not double-six</strong> (35/36 chance): Everyone leaves safely. The next batch (10× larger) enters.</li>
                        <li><strong>Double-six</strong> (1/36 chance): Everyone currently in the room is shot. The experiment ends.</li>
                    </ul>

                    <h3>Why 90% Die Despite Fair Odds</h3>
                    <table class="comparison-table">
                        <tr>
                            <th>Round</th>
                            <th>Batch Size</th>
                            <th>Cumulative Survivors</th>
                            <th>If Killed Here</th>
                        </tr>
                        <tr>
                            <td>1</td>
                            <td>10</td>
                            <td>0</td>
                            <td>100% death rate</td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>100</td>
                            <td>10</td>
                            <td>90.9% death rate</td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>1,000</td>
                            <td>110</td>
                            <td>90.1% death rate</td>
                        </tr>
                        <tr>
                            <td>4</td>
                            <td>10,000</td>
                            <td>1,110</td>
                            <td>90.0% death rate</td>
                        </tr>
                        <tr>
                            <td>n</td>
                            <td>10<sup>n</sup></td>
                            <td>~10<sup>n</sup>/9</td>
                            <td>→ 90%</td>
                        </tr>
                    </table>

                    <p>The key insight: the current batch is always about <strong>9 times larger</strong> than all previous batches combined. So no matter when the experiment ends, roughly 90% of all participants were in the final (death) batch.</p>

                    <div class="connection-box">
                        <h3>Connection to the Doomsday Argument</h3>
                        <p>This paradox was developed by philosopher <strong>John Leslie</strong> to illustrate the <a href="77-doomsday-argument.html" class="source-link">Doomsday Argument</a>.</p>
                        <p style="margin-top: 10px;">If you're a "random" human, you're probably not among the first humans ever born. You're more likely near the middle of all humans who will ever exist. This anthropic reasoning suggests humanity's total population might be smaller than we hope.</p>
                        <p style="margin-top: 10px;">The Shooting Room makes this abstract reasoning viscerally concrete: being "randomly selected" from a growing population puts you overwhelmingly in the final generation.</p>
                    </div>

                    <h3>The Resolution</h3>
                    <p>Both probability calculations are correct—they just answer <em>different questions</em>:</p>
                    <ul style="margin-left: 20px;">
                        <li><strong>35/36</strong> answers: "Given I'm in round N, what's the probability this specific roll kills me?"</li>
                        <li><strong>~90%</strong> answers: "Given I'm a random participant in the experiment, what's the probability I'm in the death batch?"</li>
                    </ul>
                    <p style="margin-top: 15px;">The paradox reveals that <em>observer selection</em> can dramatically alter probabilities. You're not sampling dice rolls—you're sampling your own existence.</p>
                </div>
            </div>
        </div>

        <p style="text-align: center; color: #666; margin-top: 30px; font-size: 0.9em;">
            Based on the thought experiment by <a href="https://philpapers.org/rec/BARTSP-2" class="source-link" target="_blank">John Leslie (1996)</a>.
            Further analysis: <a href="https://dreeves.github.io/snakeeyes/bartha-shooting-room-paradox.pdf" class="source-link" target="_blank">Bartha & Hitchcock</a>.
        </p>
    </div>

    <script>
        // State
        let round = 0;
        let batchSize = 0;
        let survivors = 0;
        let deaths = 0;
        let isRunning = false;
        let autoRunning = false;
        let experimentEnded = false;

        // Monte Carlo state
        let mcRuns = 0;
        let mcTotalDeaths = 0;
        let mcTotalSurvivors = 0;
        let mcTotalFinalBatch = 0;
        let mcHistory = [];

        // Canvas setup
        const roomCanvas = document.getElementById('roomCanvas');
        const roomCtx = roomCanvas.getContext('2d');
        const mcCanvas = document.getElementById('monteCarloCanvas');
        const mcCtx = mcCanvas.getContext('2d');

        function resizeCanvases() {
            const dpr = window.devicePixelRatio || 1;

            roomCanvas.width = roomCanvas.offsetWidth * dpr;
            roomCanvas.height = roomCanvas.offsetHeight * dpr;
            roomCtx.scale(dpr, dpr);

            mcCanvas.width = mcCanvas.offsetWidth * dpr;
            mcCanvas.height = mcCanvas.offsetHeight * dpr;
            mcCtx.scale(dpr, dpr);

            drawRoom();
            drawMonteCarlo();
        }

        // Dice elements
        const die1 = document.getElementById('die1');
        const die2 = document.getElementById('die2');

        // Roll dice with animation
        function rollDice() {
            return new Promise(resolve => {
                die1.classList.add('rolling');
                die2.classList.add('rolling');
                die1.classList.remove('death');
                die2.classList.remove('death');

                let rolls = 0;
                const interval = setInterval(() => {
                    die1.textContent = Math.floor(Math.random() * 6) + 1;
                    die2.textContent = Math.floor(Math.random() * 6) + 1;
                    rolls++;

                    if (rolls >= 15) {
                        clearInterval(interval);
                        const d1 = Math.floor(Math.random() * 6) + 1;
                        const d2 = Math.floor(Math.random() * 6) + 1;
                        die1.textContent = d1;
                        die2.textContent = d2;
                        die1.classList.remove('rolling');
                        die2.classList.remove('rolling');

                        const isDoubleSix = d1 === 6 && d2 === 6;
                        if (isDoubleSix) {
                            die1.classList.add('death');
                            die2.classList.add('death');
                        }
                        resolve(isDoubleSix);
                    }
                }, 80);
            });
        }

        // Draw people in room
        function drawRoom() {
            const width = roomCanvas.offsetWidth;
            const height = roomCanvas.offsetHeight;

            roomCtx.fillStyle = '#0d0d1a';
            roomCtx.fillRect(0, 0, width, height);

            if (batchSize === 0) return;

            // Draw people as dots
            const displayCount = Math.min(batchSize, 500);
            const cols = Math.ceil(Math.sqrt(displayCount * 1.5));
            const rows = Math.ceil(displayCount / cols);
            const dotSize = Math.min(12, Math.max(3, width / cols - 2));
            const spacing = Math.min(width / cols, (height - 60) / rows);

            const startX = (width - cols * spacing) / 2 + spacing / 2;
            const startY = 40;

            for (let i = 0; i < displayCount; i++) {
                const col = i % cols;
                const row = Math.floor(i / cols);
                const x = startX + col * spacing;
                const y = startY + row * spacing;

                roomCtx.beginPath();
                // Head
                roomCtx.arc(x, y, dotSize / 3, 0, Math.PI * 2);
                // Body
                roomCtx.moveTo(x, y + dotSize / 3);
                roomCtx.lineTo(x, y + dotSize);
                // Arms
                roomCtx.moveTo(x - dotSize / 2, y + dotSize / 2);
                roomCtx.lineTo(x + dotSize / 2, y + dotSize / 2);
                // Legs
                roomCtx.moveTo(x, y + dotSize);
                roomCtx.lineTo(x - dotSize / 3, y + dotSize * 1.3);
                roomCtx.moveTo(x, y + dotSize);
                roomCtx.lineTo(x + dotSize / 3, y + dotSize * 1.3);

                if (experimentEnded && deaths > 0) {
                    roomCtx.strokeStyle = '#ff4444';
                } else {
                    roomCtx.strokeStyle = '#44ff88';
                }
                roomCtx.lineWidth = Math.max(1, dotSize / 4);
                roomCtx.stroke();
            }

            // Show count if more than displayed
            if (batchSize > displayCount) {
                roomCtx.fillStyle = '#ffd700';
                roomCtx.font = '14px Georgia';
                roomCtx.textAlign = 'center';
                roomCtx.fillText(`Showing ${displayCount} of ${batchSize.toLocaleString()} people`, width / 2, height - 10);
            }
        }

        // Draw Monte Carlo chart
        function drawMonteCarlo() {
            const width = mcCanvas.offsetWidth;
            const height = mcCanvas.offsetHeight;

            mcCtx.fillStyle = '#111';
            mcCtx.fillRect(0, 0, width, height);

            if (mcHistory.length === 0) {
                mcCtx.fillStyle = '#444';
                mcCtx.font = '14px Georgia';
                mcCtx.textAlign = 'center';
                mcCtx.fillText('Run experiments to see death rate converge to ~90%', width / 2, height / 2);
                return;
            }

            // Draw target line at 90%
            const targetY = height - (0.9 * (height - 40)) - 20;
            mcCtx.strokeStyle = 'rgba(255, 68, 68, 0.5)';
            mcCtx.setLineDash([5, 5]);
            mcCtx.beginPath();
            mcCtx.moveTo(40, targetY);
            mcCtx.lineTo(width - 10, targetY);
            mcCtx.stroke();
            mcCtx.setLineDash([]);

            mcCtx.fillStyle = '#ff6b6b';
            mcCtx.font = '11px Georgia';
            mcCtx.textAlign = 'left';
            mcCtx.fillText('90%', 5, targetY + 4);

            // Draw axes
            mcCtx.strokeStyle = '#444';
            mcCtx.beginPath();
            mcCtx.moveTo(40, 20);
            mcCtx.lineTo(40, height - 20);
            mcCtx.lineTo(width - 10, height - 20);
            mcCtx.stroke();

            // Draw death rate over experiments
            if (mcHistory.length > 1) {
                mcCtx.strokeStyle = '#ff6b6b';
                mcCtx.lineWidth = 2;
                mcCtx.beginPath();

                const step = (width - 50) / Math.max(mcHistory.length - 1, 1);

                mcHistory.forEach((rate, i) => {
                    const x = 40 + i * step;
                    const y = height - 20 - rate * (height - 40);
                    if (i === 0) {
                        mcCtx.moveTo(x, y);
                    } else {
                        mcCtx.lineTo(x, y);
                    }
                });
                mcCtx.stroke();
            }

            // Y-axis labels
            mcCtx.fillStyle = '#888';
            mcCtx.font = '10px Georgia';
            mcCtx.textAlign = 'right';
            for (let i = 0; i <= 100; i += 25) {
                const y = height - 20 - (i / 100) * (height - 40);
                mcCtx.fillText(i + '%', 35, y + 4);
            }

            // X-axis label
            mcCtx.textAlign = 'center';
            mcCtx.fillText('Experiments', width / 2, height - 5);
        }

        // Update display
        function updateDisplay() {
            document.getElementById('roundNum').textContent = round;
            document.getElementById('batchSize').textContent = batchSize.toLocaleString();
            document.getElementById('survivorCount').textContent = survivors.toLocaleString();
            document.getElementById('deathCount').textContent = deaths.toLocaleString();

            const total = survivors + deaths;
            const deathRate = total > 0 ? (deaths / total * 100).toFixed(1) : 0;
            document.getElementById('deathBar').style.width = deathRate + '%';

            drawRoom();
        }

        // Step through experiment
        async function step() {
            if (isRunning || experimentEnded) return;
            isRunning = true;

            round++;
            batchSize = Math.pow(10, round);
            document.getElementById('status').textContent = 'Rolling...';
            updateDisplay();

            const doubleSix = await rollDice();

            if (doubleSix) {
                deaths = batchSize;
                experimentEnded = true;
                document.getElementById('status').textContent = 'DOUBLE SIX! All shot.';
                document.getElementById('stepBtn').disabled = true;
                document.getElementById('autoBtn').disabled = true;
            } else {
                survivors += batchSize;
                document.getElementById('status').textContent = 'Safe! Next batch...';
            }

            updateDisplay();
            isRunning = false;
        }

        // Auto run
        async function autoRun() {
            if (autoRunning) {
                autoRunning = false;
                document.getElementById('autoBtn').textContent = 'Auto Run';
                return;
            }

            autoRunning = true;
            document.getElementById('autoBtn').textContent = 'Stop';

            while (autoRunning && !experimentEnded) {
                await step();
                await new Promise(r => setTimeout(r, 800));
            }

            autoRunning = false;
            document.getElementById('autoBtn').textContent = 'Auto Run';
        }

        // Reset
        function reset() {
            round = 0;
            batchSize = 0;
            survivors = 0;
            deaths = 0;
            experimentEnded = false;
            autoRunning = false;
            isRunning = false;

            die1.textContent = '?';
            die2.textContent = '?';
            die1.classList.remove('death', 'rolling');
            die2.classList.remove('death', 'rolling');

            document.getElementById('status').textContent = 'Waiting...';
            document.getElementById('stepBtn').disabled = false;
            document.getElementById('autoBtn').disabled = false;
            document.getElementById('autoBtn').textContent = 'Auto Run';

            updateDisplay();
        }

        // Run single Monte Carlo experiment (fast, no animation)
        function runMCExperiment() {
            let mcRound = 0;
            let mcSurvivors = 0;

            while (true) {
                mcRound++;
                const batch = Math.pow(10, mcRound);

                // Roll two dice
                const d1 = Math.floor(Math.random() * 6) + 1;
                const d2 = Math.floor(Math.random() * 6) + 1;

                if (d1 === 6 && d2 === 6) {
                    // Double six - everyone dies
                    return { deaths: batch, survivors: mcSurvivors, finalBatch: batch };
                } else {
                    mcSurvivors += batch;
                }

                // Safety limit
                if (mcRound > 100) break;
            }

            return { deaths: 0, survivors: mcSurvivors, finalBatch: 0 };
        }

        // Run multiple MC experiments
        function runMonteCarlo(count) {
            for (let i = 0; i < count; i++) {
                const result = runMCExperiment();
                mcRuns++;
                mcTotalDeaths += result.deaths;
                mcTotalSurvivors += result.survivors;
                mcTotalFinalBatch += result.finalBatch;

                const total = mcTotalDeaths + mcTotalSurvivors;
                const rate = total > 0 ? mcTotalDeaths / total : 0;
                mcHistory.push(rate);
            }

            // Update display
            const total = mcTotalDeaths + mcTotalSurvivors;
            const deathRate = total > 0 ? (mcTotalDeaths / total * 100).toFixed(2) : 0;

            document.getElementById('mcRuns').textContent = mcRuns.toLocaleString();
            document.getElementById('mcDeathRate').textContent = deathRate + '%';
            document.getElementById('mcAvgBatch').textContent = Math.round(mcTotalFinalBatch / mcRuns).toLocaleString();
            document.getElementById('mcAvgSurvivors').textContent = Math.round(mcTotalSurvivors / mcRuns).toLocaleString();

            drawMonteCarlo();
        }

        // Reset Monte Carlo
        function resetMonteCarlo() {
            mcRuns = 0;
            mcTotalDeaths = 0;
            mcTotalSurvivors = 0;
            mcTotalFinalBatch = 0;
            mcHistory = [];

            document.getElementById('mcRuns').textContent = '0';
            document.getElementById('mcDeathRate').textContent = '0%';
            document.getElementById('mcAvgBatch').textContent = '0';
            document.getElementById('mcAvgSurvivors').textContent = '0';

            drawMonteCarlo();
        }

        // Event listeners
        document.getElementById('stepBtn').addEventListener('click', step);
        document.getElementById('autoBtn').addEventListener('click', autoRun);
        document.getElementById('resetBtn').addEventListener('click', reset);
        document.getElementById('mcRunBtn').addEventListener('click', () => runMonteCarlo(100));
        document.getElementById('mcResetBtn').addEventListener('click', resetMonteCarlo);

        // Initialize
        window.addEventListener('resize', resizeCanvases);
        window.addEventListener('load', () => {
            resizeCanvases();
            // Run initial Monte Carlo experiments
            runMonteCarlo(50);
        });
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
