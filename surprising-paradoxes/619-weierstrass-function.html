<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weierstrass Function - Continuous But Nowhere Differentiable</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a0a2e 0%, #2d1b4e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        .back-link {
            display: inline-flex;
            align-items: center;
            color: #a855f7;
            text-decoration: none;
            margin-bottom: 15px;
            font-size: 0.95em;
        }
        .back-link:hover {
            color: #c084fc;
            text-decoration: underline;
        }
        h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
            color: #fff;
            text-shadow: 0 0 30px rgba(168, 85, 247, 0.5);
        }
        .subtitle {
            color: #9ca3af;
            margin-bottom: 20px;
            font-size: 1.05em;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .main-content {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 20px;
        }
        .canvas-container {
            background: rgba(0,0,0,0.4);
            border-radius: 12px;
            padding: 15px;
        }
        canvas {
            display: block;
            width: 100%;
            border-radius: 8px;
            background: #0a0a1a;
        }
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .panel {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .panel h3 {
            font-size: 0.9em;
            color: #a855f7;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 500;
            transition: all 0.2s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #a855f7, #7c3aed);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(168, 85, 247, 0.4);
        }
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #e0e0e0;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .btn-secondary:hover {
            background: rgba(255,255,255,0.2);
        }
        .btn-secondary.active {
            background: rgba(168, 85, 247, 0.3);
            border-color: #a855f7;
        }
        .param-group {
            margin-bottom: 15px;
        }
        .param-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .param-name {
            color: #b0b0b0;
            font-size: 0.85em;
        }
        .param-value {
            color: #fcd34d;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.9em;
        }
        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255,255,255,0.1);
            -webkit-appearance: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #a855f7;
            cursor: pointer;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .stat-label {
            color: #9ca3af;
            font-size: 0.85em;
        }
        .stat-value {
            color: #fcd34d;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.9em;
        }
        .formula {
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 6px;
            font-family: 'Monaco', 'Consolas', monospace;
            margin: 8px 0;
            text-align: center;
            color: #fcd34d;
            font-size: 0.9em;
        }
        .exp-section {
            margin-top: 20px;
        }
        .exp-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }
        .exp-card {
            background: linear-gradient(135deg, rgba(168,85,247,0.1), rgba(124,58,237,0.05));
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(168,85,247,0.2);
        }
        .exp-card h4 {
            color: #a855f7;
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        .exp-card p {
            font-size: 0.85em;
            line-height: 1.6;
            color: #9ca3af;
        }
        .zoom-info {
            font-size: 0.8em;
            color: #9ca3af;
            margin-top: 8px;
        }
        .term-display {
            background: rgba(0,0,0,0.3);
            border-radius: 6px;
            padding: 8px;
            margin-top: 10px;
            max-height: 100px;
            overflow-y: auto;
            font-size: 0.75em;
            font-family: monospace;
        }
        .term-display div {
            padding: 2px 0;
            color: #9ca3af;
        }
        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">← Back to Paradoxes</a>
        <h1>The Weierstrass Function</h1>
        <p class="subtitle">Continuous Everywhere, Differentiable Nowhere</p>

        <div class="main-content">
            <div class="canvas-container">
                <canvas id="mainCanvas"></canvas>
                <p class="zoom-info">Click and drag to pan. Scroll to zoom. Double-click to reset.</p>
            </div>

            <div class="sidebar">
                <div class="panel">
                    <h3>Controls</h3>
                    <div class="controls">
                        <button class="btn btn-primary" id="resetBtn">Reset View</button>
                        <button class="btn btn-secondary" id="animateBtn">Build Up</button>
                    </div>
                </div>

                <div class="panel">
                    <h3>Parameters</h3>
                    <div class="param-group">
                        <div class="param-label">
                            <span class="param-name">a (amplitude decay)</span>
                            <span class="param-value" id="aValue">0.5</span>
                        </div>
                        <input type="range" id="aSlider" min="0.1" max="0.9" step="0.05" value="0.5">
                    </div>
                    <div class="param-group">
                        <div class="param-label">
                            <span class="param-name">b (frequency growth)</span>
                            <span class="param-value" id="bValue">7</span>
                        </div>
                        <input type="range" id="bSlider" min="3" max="15" step="2" value="7">
                    </div>
                    <div class="param-group">
                        <div class="param-label">
                            <span class="param-name">Terms (n)</span>
                            <span class="param-value" id="nValue">20</span>
                        </div>
                        <input type="range" id="nSlider" min="1" max="50" value="20">
                    </div>
                </div>

                <div class="panel">
                    <h3>The Formula</h3>
                    <div class="formula">
                        W(x) = Σ aⁿ cos(bⁿ π x)
                    </div>
                    <p style="font-size: 0.8em; color: #9ca3af; margin-top: 8px;">
                        Sum from n=0 to ∞. Continuous because sum converges. Not differentiable because b > 1+3π/2.
                    </p>
                </div>

                <div class="panel">
                    <h3>Properties</h3>
                    <div class="stat-row">
                        <span class="stat-label">Continuous?</span>
                        <span class="stat-value" style="color: #4ade80;">YES (everywhere)</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Differentiable?</span>
                        <span class="stat-value" style="color: #f87171;">NO (nowhere!)</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Box dimension</span>
                        <span id="boxDim" class="stat-value">~1.43</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Self-similar?</span>
                        <span class="stat-value">YES (fractal)</span>
                    </div>
                </div>

                <div class="panel">
                    <h3>First Terms</h3>
                    <div class="term-display" id="termDisplay">
                        Loading...
                    </div>
                </div>
            </div>
        </div>

        <div class="exp-section">
            <div class="exp-cards">
                <div class="exp-card">
                    <h4>A "Deplorable Evil" (1872)</h4>
                    <p>Karl Weierstrass published this function to challenge the intuition that continuous curves must be smooth "almost everywhere." Mathematicians called it "pathological" and a "monster." It overturned proofs relying on geometric intuition!</p>
                </div>
                <div class="exp-card">
                    <h4>Why No Derivative?</h4>
                    <p>Each term adds higher-frequency oscillations. No matter how much you zoom in, new wiggles appear. The slope at any point? It doesn't exist—the limit defining the derivative fails to converge. Forever jagged at every scale!</p>
                </div>
                <div class="exp-card">
                    <h4>Fractal Before Fractals</h4>
                    <p>This was a fractal 100 years before Mandelbrot coined the term! Its graph has fractal dimension ~2−log(a)/log(b), between 1 (a curve) and 2 (a plane). Zoom in forever and find the same structure.</p>
                </div>
                <div class="exp-card">
                    <h4>The Typical Function</h4>
                    <p>Paradoxically, "smooth" functions are the exception! In the space of all continuous functions, the set of nowhere-differentiable functions is "typical" (comeager). Smoothness is infinitely rare. This monster is the norm!</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');

        // High DPI setup
        function setupCanvas() {
            const rect = canvas.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            canvas.style.width = rect.width + 'px';
            canvas.style.height = rect.height + 'px';
            return { width: rect.width, height: rect.height };
        }

        // Parameters
        let a = 0.5;
        let b = 7;
        let numTerms = 20;

        // View
        let view = {
            xMin: -2,
            xMax: 2,
            yMin: -2,
            yMax: 2
        };

        const defaultView = { ...view };

        // Animation state
        let animating = false;
        let animTerms = 0;

        // Weierstrass function
        function weierstrass(x, terms = numTerms) {
            let sum = 0;
            for (let n = 0; n < terms; n++) {
                sum += Math.pow(a, n) * Math.cos(Math.pow(b, n) * Math.PI * x);
            }
            return sum;
        }

        // Box dimension estimate
        function estimateBoxDim() {
            // D = 2 - log(a)/log(b) (approximate)
            return 2 - Math.log(a) / Math.log(b);
        }

        // Update term display
        function updateTermDisplay(terms = numTerms) {
            const display = document.getElementById('termDisplay');
            let html = '';
            for (let n = 0; n < Math.min(terms, 8); n++) {
                const amp = Math.pow(a, n).toFixed(4);
                const freq = Math.pow(b, n);
                html += `<div>n=${n}: ${amp} × cos(${freq}πx)</div>`;
            }
            if (terms > 8) {
                html += `<div>... (${terms - 8} more terms)</div>`;
            }
            display.innerHTML = html;
        }

        function draw(terms = numTerms) {
            const { width, height } = setupCanvas();

            // Clear
            ctx.fillStyle = '#0a0a1a';
            ctx.fillRect(0, 0, width, height);

            // Draw grid
            ctx.strokeStyle = 'rgba(255,255,255,0.1)';
            ctx.lineWidth = 1;

            // Vertical lines
            const xStep = Math.pow(10, Math.floor(Math.log10((view.xMax - view.xMin) / 5)));
            for (let x = Math.ceil(view.xMin / xStep) * xStep; x <= view.xMax; x += xStep) {
                const px = (x - view.xMin) / (view.xMax - view.xMin) * width;
                ctx.beginPath();
                ctx.moveTo(px, 0);
                ctx.lineTo(px, height);
                ctx.stroke();
            }

            // Horizontal lines
            const yStep = Math.pow(10, Math.floor(Math.log10((view.yMax - view.yMin) / 5)));
            for (let y = Math.ceil(view.yMin / yStep) * yStep; y <= view.yMax; y += yStep) {
                const py = (1 - (y - view.yMin) / (view.yMax - view.yMin)) * height;
                ctx.beginPath();
                ctx.moveTo(0, py);
                ctx.lineTo(width, py);
                ctx.stroke();
            }

            // Draw axes
            ctx.strokeStyle = 'rgba(255,255,255,0.3)';
            ctx.lineWidth = 1;

            // X axis
            if (view.yMin < 0 && view.yMax > 0) {
                const py = (1 - (0 - view.yMin) / (view.yMax - view.yMin)) * height;
                ctx.beginPath();
                ctx.moveTo(0, py);
                ctx.lineTo(width, py);
                ctx.stroke();
            }

            // Y axis
            if (view.xMin < 0 && view.xMax > 0) {
                const px = (0 - view.xMin) / (view.xMax - view.xMin) * width;
                ctx.beginPath();
                ctx.moveTo(px, 0);
                ctx.lineTo(px, height);
                ctx.stroke();
            }

            // Draw function
            ctx.strokeStyle = '#a855f7';
            ctx.lineWidth = 1.5;
            ctx.beginPath();

            const samples = width * 2;
            for (let i = 0; i <= samples; i++) {
                const t = i / samples;
                const x = view.xMin + t * (view.xMax - view.xMin);
                const y = weierstrass(x, terms);

                const px = t * width;
                const py = (1 - (y - view.yMin) / (view.yMax - view.yMin)) * height;

                if (i === 0) {
                    ctx.moveTo(px, py);
                } else {
                    ctx.lineTo(px, py);
                }
            }
            ctx.stroke();

            // If animating, draw individual terms faded
            if (animating && terms < numTerms) {
                for (let n = 0; n < terms; n++) {
                    ctx.strokeStyle = `hsla(${280 + n * 20}, 70%, 60%, 0.3)`;
                    ctx.lineWidth = 1;
                    ctx.beginPath();

                    for (let i = 0; i <= samples; i++) {
                        const t = i / samples;
                        const x = view.xMin + t * (view.xMax - view.xMin);
                        const y = Math.pow(a, n) * Math.cos(Math.pow(b, n) * Math.PI * x);

                        const px = t * width;
                        const py = (1 - (y - view.yMin) / (view.yMax - view.yMin)) * height;

                        if (i === 0) {
                            ctx.moveTo(px, py);
                        } else {
                            ctx.lineTo(px, py);
                        }
                    }
                    ctx.stroke();
                }
            }

            // Update stats
            document.getElementById('boxDim').textContent = '~' + estimateBoxDim().toFixed(2);
            updateTermDisplay(terms);
        }

        // Animation
        function animate() {
            if (!animating) return;

            animTerms++;
            if (animTerms > numTerms) {
                animating = false;
                document.getElementById('animateBtn').textContent = 'Build Up';
                animTerms = numTerms;
            }

            draw(animTerms);

            if (animating) {
                setTimeout(() => requestAnimationFrame(animate), 300);
            }
        }

        // Mouse interaction
        let isDragging = false;
        let lastMouse = { x: 0, y: 0 };

        canvas.addEventListener('mousedown', (e) => {
            isDragging = true;
            lastMouse = { x: e.clientX, y: e.clientY };
        });

        canvas.addEventListener('mousemove', (e) => {
            if (!isDragging) return;

            const rect = canvas.getBoundingClientRect();
            const dx = (e.clientX - lastMouse.x) / rect.width * (view.xMax - view.xMin);
            const dy = (e.clientY - lastMouse.y) / rect.height * (view.yMax - view.yMin);

            view.xMin -= dx;
            view.xMax -= dx;
            view.yMin += dy;
            view.yMax += dy;

            lastMouse = { x: e.clientX, y: e.clientY };
            if (!animating) draw();
        });

        canvas.addEventListener('mouseup', () => isDragging = false);
        canvas.addEventListener('mouseleave', () => isDragging = false);

        canvas.addEventListener('wheel', (e) => {
            e.preventDefault();

            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;

            const x = view.xMin + (mouseX / rect.width) * (view.xMax - view.xMin);
            const y = view.yMin + (1 - mouseY / rect.height) * (view.yMax - view.yMin);

            const factor = e.deltaY > 0 ? 1.2 : 0.8;

            view.xMin = x + (view.xMin - x) * factor;
            view.xMax = x + (view.xMax - x) * factor;
            view.yMin = y + (view.yMin - y) * factor;
            view.yMax = y + (view.yMax - y) * factor;

            if (!animating) draw();
        });

        canvas.addEventListener('dblclick', () => {
            view = { ...defaultView };
            draw();
        });

        // Controls
        document.getElementById('aSlider').addEventListener('input', (e) => {
            a = parseFloat(e.target.value);
            document.getElementById('aValue').textContent = a.toFixed(2);
            if (!animating) draw();
        });

        document.getElementById('bSlider').addEventListener('input', (e) => {
            b = parseInt(e.target.value);
            document.getElementById('bValue').textContent = b;
            if (!animating) draw();
        });

        document.getElementById('nSlider').addEventListener('input', (e) => {
            numTerms = parseInt(e.target.value);
            document.getElementById('nValue').textContent = numTerms;
            if (!animating) draw();
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            view = { ...defaultView };
            draw();
        });

        document.getElementById('animateBtn').addEventListener('click', () => {
            animating = !animating;
            document.getElementById('animateBtn').textContent = animating ? 'Stop' : 'Build Up';

            if (animating) {
                animTerms = 0;
                animate();
            }
        });

        // Resize handler
        window.addEventListener('resize', () => {
            if (!animating) draw();
        });

        // Initial draw
        draw();
    </script>
</body>
</html>
