<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barnsley Fern - Nature from Four Equations</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0a1a0a 0%, #1a2a1a 50%, #0a2a1a 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        .back-link {
            display: inline-flex;
            align-items: center;
            color: #4ade80;
            text-decoration: none;
            margin-bottom: 15px;
            font-size: 0.95em;
        }
        .back-link:hover {
            color: #86efac;
            text-decoration: underline;
        }
        h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
            color: #fff;
            text-shadow: 0 0 30px rgba(74, 222, 128, 0.5);
        }
        .subtitle {
            color: #86efac;
            margin-bottom: 20px;
            font-size: 1.05em;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .main-content {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 20px;
        }
        .canvas-container {
            background: rgba(0,0,0,0.4);
            border-radius: 12px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        canvas {
            border-radius: 8px;
            background: #020a02;
        }
        .info-text {
            margin-top: 10px;
            font-size: 0.8em;
            color: #4ade80;
        }
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .panel {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .panel h3 {
            font-size: 0.9em;
            color: #4ade80;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 500;
            transition: all 0.2s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #4ade80, #22c55e);
            color: #0a1a0a;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(74, 222, 128, 0.4);
        }
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #e0e0e0;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .btn-secondary:hover {
            background: rgba(255,255,255,0.2);
        }
        .param-group {
            margin-bottom: 12px;
        }
        .param-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .param-name {
            color: #86efac;
            font-size: 0.85em;
        }
        .param-value {
            color: #bbf7d0;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.9em;
        }
        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255,255,255,0.1);
            -webkit-appearance: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #4ade80;
            cursor: pointer;
        }
        .transform-table {
            width: 100%;
            font-size: 0.7em;
            border-collapse: collapse;
            margin-top: 8px;
        }
        .transform-table th, .transform-table td {
            padding: 4px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .transform-table th {
            background: rgba(74, 222, 128, 0.2);
            color: #4ade80;
        }
        .transform-table td {
            color: #bbf7d0;
            font-family: monospace;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .stat-label {
            color: #86efac;
            font-size: 0.8em;
        }
        .stat-value {
            color: #bbf7d0;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.8em;
        }
        .exp-section {
            margin-top: 20px;
        }
        .exp-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }
        .exp-card {
            background: linear-gradient(135deg, rgba(74,222,128,0.1), rgba(34,197,94,0.05));
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(74,222,128,0.2);
        }
        .exp-card h4 {
            color: #4ade80;
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        .exp-card p {
            font-size: 0.85em;
            line-height: 1.6;
            color: #86efac;
        }
        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">← Back to Paradoxes</a>
        <h1>The Barnsley Fern</h1>
        <p class="subtitle">A Realistic Fern from Just FOUR Simple Equations</p>

        <div class="main-content">
            <div class="canvas-container">
                <canvas id="mainCanvas" width="550" height="650"></canvas>
                <p class="info-text" id="infoText">Drawing... 0 points</p>
            </div>

            <div class="sidebar">
                <div class="panel">
                    <h3>Controls</h3>
                    <div class="controls">
                        <button class="btn btn-primary" id="drawBtn">Draw</button>
                        <button class="btn btn-secondary" id="clearBtn">Clear</button>
                        <button class="btn btn-secondary" id="animateBtn">Animate</button>
                    </div>
                </div>

                <div class="panel">
                    <h3>Points</h3>
                    <div class="param-group">
                        <div class="param-label">
                            <span class="param-name">Number of points</span>
                            <span class="param-value" id="pointsValue">100,000</span>
                        </div>
                        <input type="range" id="pointsSlider" min="10000" max="500000" step="10000" value="100000">
                    </div>
                </div>

                <div class="panel">
                    <h3>The Four Transformations</h3>
                    <table class="transform-table">
                        <tr>
                            <th>f</th>
                            <th>a</th>
                            <th>b</th>
                            <th>c</th>
                            <th>d</th>
                            <th>e</th>
                            <th>f</th>
                            <th>p</th>
                        </tr>
                        <tr>
                            <td>1</td>
                            <td>0</td>
                            <td>0</td>
                            <td>0</td>
                            <td>0.16</td>
                            <td>0</td>
                            <td>0</td>
                            <td>1%</td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>0.85</td>
                            <td>0.04</td>
                            <td>-0.04</td>
                            <td>0.85</td>
                            <td>0</td>
                            <td>1.6</td>
                            <td>85%</td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>0.2</td>
                            <td>-0.26</td>
                            <td>0.23</td>
                            <td>0.22</td>
                            <td>0</td>
                            <td>1.6</td>
                            <td>7%</td>
                        </tr>
                        <tr>
                            <td>4</td>
                            <td>-0.15</td>
                            <td>0.28</td>
                            <td>0.26</td>
                            <td>0.24</td>
                            <td>0</td>
                            <td>0.44</td>
                            <td>7%</td>
                        </tr>
                    </table>
                    <p style="font-size: 0.7em; color: #64748b; margin-top: 8px;">
                        x' = ax + by + e, y' = cx + dy + f
                    </p>
                </div>

                <div class="panel">
                    <h3>Statistics</h3>
                    <div class="stat-row">
                        <span class="stat-label">Points drawn</span>
                        <span id="drawnCount" class="stat-value">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Stem (f1) used</span>
                        <span id="f1Count" class="stat-value">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Main (f2) used</span>
                        <span id="f2Count" class="stat-value">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Left (f3) used</span>
                        <span id="f3Count" class="stat-value">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Right (f4) used</span>
                        <span id="f4Count" class="stat-value">0</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="exp-section">
            <div class="exp-cards">
                <div class="exp-card">
                    <h4>Michael Barnsley (1988)</h4>
                    <p>British mathematician Michael Barnsley introduced this fractal in "Fractals Everywhere" (1988). He modeled the black spleenwort fern (Asplenium adiantum-nigrum) using Iterated Function Systems (IFS)—proving that complex natural forms can emerge from minimal mathematical rules!</p>
                </div>
                <div class="exp-card">
                    <h4>The Chaos Game</h4>
                    <p>Start at any point. Randomly pick one of four transformations (weighted by probability). Apply it. Plot the new point. Repeat millions of times! This "chaos game" converges to the same fern shape regardless of starting point—the attractor of the IFS.</p>
                </div>
                <div class="exp-card">
                    <h4>Four Equations = One Fern</h4>
                    <p>f1 (1%): Creates the stem—just scales y. f2 (85%): The main workhorse—slight rotation + scaling creates the leaflets. f3 & f4 (7% each): Left and right branches—larger rotations create the side fronds. That's ALL the information needed!</p>
                </div>
                <div class="exp-card">
                    <h4>Nature's Compression</h4>
                    <p>The entire fern—infinite detail at any zoom—encoded in just 24 numbers! This inspired fractal image compression: store transformations, not pixels. A plant's DNA does something similar—recursive growth rules, not explicit cell positions!</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');

        let numPoints = 100000;
        let animating = false;
        let animationId = null;
        let currentPoint = 0;
        let x = 0, y = 0;
        let counts = [0, 0, 0, 0];

        // Barnsley fern transformations
        // f(x,y) = (ax + by + e, cx + dy + f)
        const transforms = [
            { a: 0, b: 0, c: 0, d: 0.16, e: 0, f: 0, p: 0.01 },           // Stem
            { a: 0.85, b: 0.04, c: -0.04, d: 0.85, e: 0, f: 1.6, p: 0.85 }, // Successively smaller leaflets
            { a: 0.2, b: -0.26, c: 0.23, d: 0.22, e: 0, f: 1.6, p: 0.07 },  // Left leaflet
            { a: -0.15, b: 0.28, c: 0.26, d: 0.24, e: 0, f: 0.44, p: 0.07 } // Right leaflet
        ];

        function selectTransform() {
            const r = Math.random();
            let cumulative = 0;
            for (let i = 0; i < transforms.length; i++) {
                cumulative += transforms[i].p;
                if (r <= cumulative) return i;
            }
            return 3;
        }

        function applyTransform(idx) {
            const t = transforms[idx];
            const newX = t.a * x + t.b * y + t.e;
            const newY = t.c * x + t.d * y + t.f;
            x = newX;
            y = newY;
            counts[idx]++;
        }

        function toCanvas(x, y) {
            // Fern spans roughly x: [-2.2, 2.7], y: [0, 10]
            const scale = canvas.height / 11;
            const px = canvas.width / 2 + x * scale;
            const py = canvas.height - y * scale - 20;
            return { px, py };
        }

        function drawPoint() {
            const { px, py } = toCanvas(x, y);

            // Skip first few iterations (burn-in)
            if (currentPoint > 20) {
                ctx.fillStyle = `rgba(74, 222, 128, 0.5)`;
                ctx.fillRect(px, py, 1, 1);
            }
        }

        function drawFern() {
            ctx.fillStyle = '#020a02';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            x = 0;
            y = 0;
            counts = [0, 0, 0, 0];

            for (let i = 0; i < numPoints; i++) {
                const idx = selectTransform();
                applyTransform(idx);
                drawPoint();
            }

            updateStats(numPoints);
        }

        function animateFern() {
            if (!animating) return;

            // Draw batch of points per frame
            const batchSize = 1000;
            for (let i = 0; i < batchSize && currentPoint < numPoints; i++) {
                const idx = selectTransform();
                applyTransform(idx);
                drawPoint();
                currentPoint++;
            }

            updateStats(currentPoint);

            if (currentPoint < numPoints) {
                animationId = requestAnimationFrame(animateFern);
            } else {
                animating = false;
                document.getElementById('animateBtn').textContent = 'Animate';
            }
        }

        function updateStats(n) {
            document.getElementById('drawnCount').textContent = n.toLocaleString();
            document.getElementById('f1Count').textContent = counts[0].toLocaleString();
            document.getElementById('f2Count').textContent = counts[1].toLocaleString();
            document.getElementById('f3Count').textContent = counts[2].toLocaleString();
            document.getElementById('f4Count').textContent = counts[3].toLocaleString();
            document.getElementById('infoText').textContent = `${n.toLocaleString()} points drawn`;
        }

        function reset() {
            x = 0;
            y = 0;
            currentPoint = 0;
            counts = [0, 0, 0, 0];
            animating = false;
            if (animationId) cancelAnimationFrame(animationId);
            document.getElementById('animateBtn').textContent = 'Animate';
            ctx.fillStyle = '#020a02';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            updateStats(0);
        }

        // Event handlers
        document.getElementById('pointsSlider').addEventListener('input', (e) => {
            numPoints = parseInt(e.target.value);
            document.getElementById('pointsValue').textContent = numPoints.toLocaleString();
        });

        document.getElementById('drawBtn').addEventListener('click', () => {
            reset();
            drawFern();
        });

        document.getElementById('clearBtn').addEventListener('click', reset);

        document.getElementById('animateBtn').addEventListener('click', () => {
            if (animating) {
                animating = false;
                cancelAnimationFrame(animationId);
                document.getElementById('animateBtn').textContent = 'Animate';
            } else {
                reset();
                animating = true;
                document.getElementById('animateBtn').textContent = 'Stop';
                animateFern();
            }
        });

        // Initial draw
        drawFern();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
