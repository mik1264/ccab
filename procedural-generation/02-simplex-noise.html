<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simplex Noise - Procedural Generation</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #0a0a0f;
            color: #fff;
            font-family: 'Segoe UI', system-ui, sans-serif;
            overflow: hidden;
        }
        #canvas { display: block; width: 100vw; height: 100vh; }
        .controls {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 12px;
            z-index: 100;
            min-width: 280px;
        }
        h1 { font-size: 1.3em; margin-bottom: 5px; color: #7e57c2; }
        .subtitle { font-size: 0.85em; color: #888; margin-bottom: 15px; }
        .slider-group { margin-bottom: 12px; }
        .slider-group label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            font-size: 0.85em;
            color: #aaa;
        }
        .slider-group input[type="range"] {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            background: #333;
            border-radius: 3px;
        }
        .slider-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #7e57c2;
            border-radius: 50%;
            cursor: pointer;
        }
        .comparison {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }
        .comp-btn {
            flex: 1;
            padding: 8px;
            background: #222;
            border: 1px solid #444;
            border-radius: 6px;
            color: #aaa;
            font-size: 0.8em;
            cursor: pointer;
            text-align: center;
        }
        .comp-btn:hover, .comp-btn.active {
            background: #333;
            border-color: #7e57c2;
            color: #fff;
        }
        .button-row { display: flex; gap: 10px; margin-top: 15px; }
        button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 6px;
            background: #7e57c2;
            color: #fff;
            cursor: pointer;
            font-weight: 600;
        }
        button:hover { background: #673ab7; }
        .stats {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #333;
            font-size: 0.85em;
            color: #888;
        }
        .back-link {
            position: fixed;
            top: 20px;
            right: 20px;
            color: #7e57c2;
            text-decoration: none;
            z-index: 100;
        }
        .info {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 8px;
            max-width: 350px;
            font-size: 0.85em;
            color: #aaa;
            line-height: 1.5;
        }
        .info h3 { color: #7e57c2; margin-bottom: 8px; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>

    <div class="controls">
        <h1>Simplex Noise</h1>
        <p class="subtitle">Improved Gradient Noise</p>

        <div class="slider-group">
            <label>Scale <span id="scaleVal">80</span></label>
            <input type="range" id="scale" min="20" max="200" step="5" value="80">
        </div>

        <div class="slider-group">
            <label>Octaves <span id="octavesVal">5</span></label>
            <input type="range" id="octaves" min="1" max="8" step="1" value="5">
        </div>

        <div class="slider-group">
            <label>Persistence <span id="persistVal">0.5</span></label>
            <input type="range" id="persistence" min="0.1" max="0.9" step="0.05" value="0.5">
        </div>

        <div class="slider-group">
            <label>Speed <span id="speedVal">1.0</span></label>
            <input type="range" id="speed" min="0" max="3" step="0.1" value="1.0">
        </div>

        <div class="comparison">
            <span class="comp-btn active" data-mode="simplex">Simplex</span>
            <span class="comp-btn" data-mode="perlin">Perlin</span>
            <span class="comp-btn" data-mode="compare">Compare</span>
        </div>

        <div class="button-row">
            <button id="regenerateBtn">New Seed</button>
        </div>

        <div class="stats">
            <div>Algorithm: <span id="algoName">Simplex 2D</span></div>
            <div>FPS: <span id="fps">0</span></div>
        </div>
    </div>

    <a href="index.html" class="back-link">‚Üê Back to Gallery</a>

    <div class="info">
        <h3>Simplex Noise</h3>
        <p>Created by Ken Perlin in 2001 as an improvement over Perlin noise.
        Simplex noise has less visual artifacts, works in any dimension, and
        is computationally simpler. It uses a simplex grid (triangles in 2D,
        tetrahedra in 3D) instead of a square/cubic grid.</p>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let width, height;
        let scale = 80;
        let octaves = 5;
        let persistence = 0.5;
        let speed = 1.0;
        let mode = 'simplex';
        let seed = Math.random() * 10000;
        let time = 0;

        // Simplex noise implementation
        const F2 = 0.5 * (Math.sqrt(3) - 1);
        const G2 = (3 - Math.sqrt(3)) / 6;

        const grad3 = [
            [1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],
            [1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],
            [0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]
        ];

        let perm = new Uint8Array(512);
        let permMod12 = new Uint8Array(512);

        function initPerm(s) {
            const p = new Uint8Array(256);
            for (let i = 0; i < 256; i++) p[i] = i;

            for (let i = 255; i > 0; i--) {
                s = (s * 16807) % 2147483647;
                const j = s % (i + 1);
                [p[i], p[j]] = [p[j], p[i]];
            }

            for (let i = 0; i < 512; i++) {
                perm[i] = p[i & 255];
                permMod12[i] = perm[i] % 12;
            }
        }

        function dot2(g, x, y) {
            return g[0] * x + g[1] * y;
        }

        function simplex2D(xin, yin) {
            let n0, n1, n2;

            const s = (xin + yin) * F2;
            const i = Math.floor(xin + s);
            const j = Math.floor(yin + s);

            const t = (i + j) * G2;
            const X0 = i - t;
            const Y0 = j - t;
            const x0 = xin - X0;
            const y0 = yin - Y0;

            let i1, j1;
            if (x0 > y0) { i1 = 1; j1 = 0; }
            else { i1 = 0; j1 = 1; }

            const x1 = x0 - i1 + G2;
            const y1 = y0 - j1 + G2;
            const x2 = x0 - 1.0 + 2.0 * G2;
            const y2 = y0 - 1.0 + 2.0 * G2;

            const ii = i & 255;
            const jj = j & 255;
            const gi0 = permMod12[ii + perm[jj]];
            const gi1 = permMod12[ii + i1 + perm[jj + j1]];
            const gi2 = permMod12[ii + 1 + perm[jj + 1]];

            let t0 = 0.5 - x0 * x0 - y0 * y0;
            if (t0 < 0) n0 = 0.0;
            else {
                t0 *= t0;
                n0 = t0 * t0 * dot2(grad3[gi0], x0, y0);
            }

            let t1 = 0.5 - x1 * x1 - y1 * y1;
            if (t1 < 0) n1 = 0.0;
            else {
                t1 *= t1;
                n1 = t1 * t1 * dot2(grad3[gi1], x1, y1);
            }

            let t2 = 0.5 - x2 * x2 - y2 * y2;
            if (t2 < 0) n2 = 0.0;
            else {
                t2 *= t2;
                n2 = t2 * t2 * dot2(grad3[gi2], x2, y2);
            }

            return 70.0 * (n0 + n1 + n2);
        }

        // Perlin noise for comparison
        function fade(t) { return t * t * t * (t * (t * 6 - 15) + 10); }
        function lerp(a, b, t) { return a + t * (b - a); }

        function perlin2D(x, y) {
            const X = Math.floor(x) & 255;
            const Y = Math.floor(y) & 255;

            x -= Math.floor(x);
            y -= Math.floor(y);

            const u = fade(x);
            const v = fade(y);

            const A = perm[X] + Y;
            const B = perm[X + 1] + Y;

            function grad(hash, x, y) {
                const h = hash & 3;
                const u = h < 2 ? x : y;
                const v = h < 2 ? y : x;
                return ((h & 1) === 0 ? u : -u) + ((h & 2) === 0 ? v : -v);
            }

            return lerp(
                lerp(grad(perm[A], x, y), grad(perm[B], x - 1, y), u),
                lerp(grad(perm[A + 1], x, y - 1), grad(perm[B + 1], x - 1, y - 1), u),
                v
            );
        }

        function fbm(x, y, noiseFunc, oct, persist) {
            let total = 0;
            let amplitude = 1;
            let frequency = 1;
            let maxValue = 0;

            for (let i = 0; i < oct; i++) {
                total += noiseFunc(x * frequency, y * frequency) * amplitude;
                maxValue += amplitude;
                amplitude *= persist;
                frequency *= 2;
            }

            return total / maxValue;
        }

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            width = canvas.width;
            height = canvas.height;
        }

        function draw() {
            const imageData = ctx.createImageData(width, height);
            const data = imageData.data;

            const halfWidth = width / 2;

            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    const nx = x / scale + time * 0.1;
                    const ny = y / scale + time * 0.05;

                    let value;

                    if (mode === 'compare') {
                        if (x < halfWidth) {
                            value = fbm(nx, ny, simplex2D, octaves, persistence);
                        } else {
                            value = fbm(nx, ny, perlin2D, octaves, persistence);
                        }
                    } else if (mode === 'simplex') {
                        value = fbm(nx, ny, simplex2D, octaves, persistence);
                    } else {
                        value = fbm(nx, ny, perlin2D, octaves, persistence);
                    }

                    const normalized = (value + 1) / 2;

                    // Purple-cyan gradient
                    const r = Math.floor(126 * normalized + 50 * (1 - normalized));
                    const g = Math.floor(87 * (1 - normalized) + 180 * normalized);
                    const b = Math.floor(194 * (1 - normalized * 0.5) + 100 * normalized);

                    const idx = (y * width + x) * 4;
                    data[idx] = r;
                    data[idx + 1] = g;
                    data[idx + 2] = b;
                    data[idx + 3] = 255;
                }
            }

            ctx.putImageData(imageData, 0, 0);

            // Draw comparison line
            if (mode === 'compare') {
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(halfWidth, 0);
                ctx.lineTo(halfWidth, height);
                ctx.stroke();

                ctx.fillStyle = '#fff';
                ctx.font = '16px sans-serif';
                ctx.fillText('Simplex', halfWidth - 80, 30);
                ctx.fillText('Perlin', halfWidth + 20, 30);
            }
        }

        // UI
        document.getElementById('scale').addEventListener('input', (e) => {
            scale = parseInt(e.target.value);
            document.getElementById('scaleVal').textContent = scale;
        });

        document.getElementById('octaves').addEventListener('input', (e) => {
            octaves = parseInt(e.target.value);
            document.getElementById('octavesVal').textContent = octaves;
        });

        document.getElementById('persistence').addEventListener('input', (e) => {
            persistence = parseFloat(e.target.value);
            document.getElementById('persistVal').textContent = persistence.toFixed(2);
        });

        document.getElementById('speed').addEventListener('input', (e) => {
            speed = parseFloat(e.target.value);
            document.getElementById('speedVal').textContent = speed.toFixed(1);
        });

        document.querySelectorAll('.comp-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.comp-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                mode = btn.dataset.mode;
                document.getElementById('algoName').textContent =
                    mode === 'compare' ? 'Comparison' :
                    mode === 'simplex' ? 'Simplex 2D' : 'Perlin 2D';
            });
        });

        document.getElementById('regenerateBtn').addEventListener('click', () => {
            seed = Math.random() * 10000;
            initPerm(seed);
        });

        window.addEventListener('resize', resize);

        let lastTime = performance.now();
        let frameCount = 0;
        let fpsTime = 0;

        function animate() {
            const now = performance.now();
            const dt = (now - lastTime) / 1000;
            lastTime = now;

            frameCount++;
            fpsTime += dt;
            if (fpsTime >= 1) {
                document.getElementById('fps').textContent = Math.round(frameCount / fpsTime);
                frameCount = 0;
                fpsTime = 0;
            }

            time += dt * speed;
            draw();

            requestAnimationFrame(animate);
        }

        window.reset = function() { seed = Math.random() * 10000; initPerm(seed); time = 0; };
        initPerm(seed);
        resize();
        animate();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
