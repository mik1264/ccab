<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game of Life - Emoji Edition</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: Arial, sans-serif;
            color: #fff;
        }
        canvas {
            border: 3px solid #fff;
            margin: 20px 0;
            background: #fff;
            border-radius: 10px;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background: #fff;
            color: #667eea;
            border: none;
            border-radius: 25px;
            font-weight: bold;
        }
        button:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <a href="../index.html" class="back-link" style="position:fixed;top:20px;left:20px;color:#fff;text-decoration:none;background:rgba(0,0,0,0.5);padding:8px 16px;border-radius:20px;font-size:14px;z-index:1000;">‚Üê Back to Gallery</a>
    <h1>üòä Game of Life - Emoji Edition üéâ</h1>
    <p>Living cells are random emojis! Watch them evolve!</p>
    <div class="controls">
        <button onclick="togglePause()">‚èØÔ∏è Pause/Play</button>
        <button onclick="randomize()">üé≤ Randomize</button>
        <button onclick="clear()">üóëÔ∏è Clear</button>
    </div>
    <canvas id="canvas"></canvas>

    <script src="../../assets/js/demo-utils.js"></script>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        const CELL_SIZE = 24;
        const COLS = 40;
        const ROWS = 30;
        canvas.width = COLS * CELL_SIZE;
        canvas.height = ROWS * CELL_SIZE;

        const fps = new FPSCounter({ position: 'top-right' });
        const errorMgr = new ErrorManager();
        setupGlobalErrorHandler((msg, details) => errorMgr.show(msg, details));
        fps.start();

        const EMOJIS = [
            'üòÄ', 'üòÉ', 'üòÑ', 'üòÅ', 'üòä', 'ü•∞', 'üòé', 'ü§©',
            'ü¶Ñ', 'üåà', '‚≠ê', '‚ú®', 'üí´', 'üåü', 'üíñ', 'üíù',
            'üé®', 'üé≠', 'üé™', 'üéØ', 'üé≤', 'üéÆ', 'üéπ', 'üé∏',
            'üå∫', 'üå∏', 'üåº', 'üåª', 'üå∑', 'üåπ', 'üçÄ', 'üçÑ',
            'ü¶ã', 'üêù', 'üêû', 'ü¶ú', 'üê†', 'üêô', 'ü¶Ä', 'ü¶ê',
            'üçé', 'üçä', 'üçã', 'üçì', 'üçá', 'üçâ', 'üçå', 'ü•ë',
            'üéà', 'üéÅ', 'üéÄ', 'üéä', 'üéâ', 'üß∏', 'üé™', 'üé°'
        ];

        let grid = createGrid();
        let emojiGrid = createEmojiGrid();
        let paused = false;

        function createGrid() {
            return Array(ROWS).fill(null).map(() => Array(COLS).fill(0));
        }

        function createEmojiGrid() {
            return Array(ROWS).fill(null).map(() =>
                Array(COLS).fill(null).map(() =>
                    EMOJIS[Math.floor(Math.random() * EMOJIS.length)]
                )
            );
        }

        function randomize() {
            for (let i = 0; i < ROWS; i++) {
                for (let j = 0; j < COLS; j++) {
                    grid[i][j] = Math.random() > 0.7 ? 1 : 0;
                }
            }
        }

        function clear() {
            grid = createGrid();
        }

        function togglePause() {
            paused = !paused;
        }

        function countNeighbors(row, col) {
            let count = 0;
            for (let i = -1; i <= 1; i++) {
                for (let j = -1; j <= 1; j++) {
                    if (i === 0 && j === 0) continue;
                    const newRow = (row + i + ROWS) % ROWS;
                    const newCol = (col + j + COLS) % COLS;
                    count += grid[newRow][newCol];
                }
            }
            return count;
        }

        function update() {
            const newGrid = createGrid();

            for (let i = 0; i < ROWS; i++) {
                for (let j = 0; j < COLS; j++) {
                    const neighbors = countNeighbors(i, j);
                    const cell = grid[i][j];

                    if (cell === 1 && (neighbors === 2 || neighbors === 3)) {
                        newGrid[i][j] = 1;
                    } else if (cell === 0 && neighbors === 3) {
                        newGrid[i][j] = 1;
                        // Assign new random emoji when cell is born
                        emojiGrid[i][j] = EMOJIS[Math.floor(Math.random() * EMOJIS.length)];
                    }
                }
            }

            grid = newGrid;
        }

        function draw() {
            // Background
            ctx.fillStyle = '#f0f0f0';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw grid lines
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 1;
            for (let i = 0; i <= COLS; i++) {
                ctx.beginPath();
                ctx.moveTo(i * CELL_SIZE, 0);
                ctx.lineTo(i * CELL_SIZE, canvas.height);
                ctx.stroke();
            }
            for (let i = 0; i <= ROWS; i++) {
                ctx.beginPath();
                ctx.moveTo(0, i * CELL_SIZE);
                ctx.lineTo(canvas.width, i * CELL_SIZE);
                ctx.stroke();
            }

            // Draw emojis
            ctx.font = `${CELL_SIZE - 6}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            for (let i = 0; i < ROWS; i++) {
                for (let j = 0; j < COLS; j++) {
                    if (grid[i][j] === 1) {
                        const x = j * CELL_SIZE + CELL_SIZE / 2;
                        const y = i * CELL_SIZE + CELL_SIZE / 2;

                        // Background highlight
                        ctx.fillStyle = 'rgba(255, 255, 200, 0.5)';
                        ctx.fillRect(
                            j * CELL_SIZE + 2,
                            i * CELL_SIZE + 2,
                            CELL_SIZE - 4,
                            CELL_SIZE - 4
                        );

                        // Draw emoji
                        ctx.fillText(emojiGrid[i][j], x, y);
                    }
                }
            }
        }

        let frameCount = 0;

        function gameLoop() {
            fps.update();
            if (!paused && frameCount % 10 === 0) {
                update();
            }

            draw();
            frameCount++;
            requestAnimationFrame(gameLoop);
        }

        randomize();
        gameLoop();

        // Click to toggle cells
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = Math.floor((e.clientX - rect.left) / CELL_SIZE);
            const y = Math.floor((e.clientY - rect.top) / CELL_SIZE);
            grid[y][x] = 1 - grid[y][x];
            if (grid[y][x] === 1) {
                emojiGrid[y][x] = EMOJIS[Math.floor(Math.random() * EMOJIS.length)];
            }
        });
    </script>
</body>
</html>
