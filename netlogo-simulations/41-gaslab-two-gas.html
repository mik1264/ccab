<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GasLab Two Gas - CCAB</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            font-family: 'Segoe UI', Arial, sans-serif;
            color: white;
        }
        .container { display: flex; height: 100vh; }
        .canvas-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            gap: 10px;
        }
        canvas { border: 2px solid rgba(255, 255, 255, 0.2); border-radius: 8px; }
        .controls {
            width: 320px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.6);
            overflow-y: auto;
        }
        h2 { margin: 0 0 15px 0; color: #55efc4; }
        h3 { margin: 15px 0 8px 0; color: #81ecec; font-size: 14px; }
        .slider-group { margin: 12px 0; }
        .slider-group label { display: block; margin-bottom: 5px; font-size: 13px; }
        input[type="range"] { width: 100%; }
        .stats {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .stat-row { display: flex; justify-content: space-between; margin: 5px 0; font-size: 13px; }
        .description {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            border-radius: 8px;
            font-size: 12px;
            line-height: 1.5;
            margin-top: 15px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            background: #55efc4;
            color: #1a1a2e;
            font-weight: bold;
        }
        button:hover { background: #00b894; }
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            font-size: 12px;
        }
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .legend-color { width: 15px; height: 15px; border-radius: 50%; }

        .explain-btn {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            margin-top: 10px;
        }
        .explain-btn:hover {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        }
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .modal-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 1;
        }
        .modal {
            background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%);
            border-radius: 16px;
            padding: 30px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
        }
        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: #888;
            font-size: 28px;
            cursor: pointer;
            width: auto;
            padding: 0;
            margin: 0;
        }
        .modal-close:hover {
            color: #fff;
            background: none;
        }
        .modal h2 {
            color: #fbbf24;
            margin-bottom: 20px;
            font-size: 1.5rem;
            padding-right: 30px;
        }
        .modal-body {
            color: #ccc;
            line-height: 1.8;
            font-size: 0.95rem;
        }
        .modal-body h3 {
            color: #a5b4fc;
            margin: 20px 0 10px 0;
            font-size: 1.1rem;
        }
        .modal-body p {
            margin-bottom: 15px;
        }
        .modal-body ul {
            margin: 10px 0 15px 20px;
        }
        .modal-body li {
            margin-bottom: 8px;
        }
        .modal-body strong {
            color: #fbbf24;
        }
        .modal-body em {
            color: #a5b4fc;
            font-style: normal;
        }
    </style>
</head>
<body>
    <a href="index.html" class="organic-back-link" style="position: fixed; top: 20px; right: 20px; z-index: 1000; display: flex; align-items: center; gap: 8px; padding: 10px 16px; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); border-radius: 30px; text-decoration: none; color: #606C38; font-family: 'Nunito', sans-serif; font-weight: 600;">
        <span>‚Üê Gallery</span>
    </a>
    <div class="container">
        <div class="canvas-area">
            <canvas id="gasCanvas"></canvas>
            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background: #74b9ff;"></div> Gas A (Light)</div>
                <div class="legend-item"><div class="legend-color" style="background: #fd79a8;"></div> Gas B (Heavy)</div>
            </div>
            <canvas id="histCanvas"></canvas>
        </div>
        <div class="controls">
            <h2>‚öõÔ∏è Two Gas Mixture</h2>
            <p style="font-size: 12px; opacity: 0.8;">Diffusion and effusion rates</p>

            <h3>Gas A Particles</h3>
            <div class="slider-group">
                <label>N‚ÇÅ: <span id="n1Val">50</span></label>
                <input type="range" id="n1" min="10" max="100" step="10" value="50">
            </div>

            <h3>Gas B Particles</h3>
            <div class="slider-group">
                <label>N‚ÇÇ: <span id="n2Val">50</span></label>
                <input type="range" id="n2" min="10" max="100" step="10" value="50">
            </div>

            <h3>Mass Ratio (B/A)</h3>
            <div class="slider-group">
                <label>Ratio: <span id="massVal">4</span></label>
                <input type="range" id="mass" min="1" max="10" step="1" value="4">
            </div>

            <h3>Temperature</h3>
            <div class="slider-group">
                <label>T: <span id="tempVal">300</span>K</label>
                <input type="range" id="temp" min="100" max="600" step="50" value="300">
            </div>

            <h3>Barrier Open</h3>
            <div class="slider-group">
                <label>Opening: <span id="barrierVal">100</span>%</label>
                <input type="range" id="barrier" min="0" max="100" step="10" value="100">
            </div>

            <button onclick="reset()">Reset</button>
            <button id="explainBtn" class="explain-btn">üìö Explain</button>
            <button onclick="togglePause()" id="pauseBtn">Pause</button>
            <button onclick="separate()">Separate Gases</button>

            <div class="stats">
                <div class="stat-row"><span>Time:</span><span id="time">0</span></div>
                <div class="stat-row"><span>Gas A (left/right):</span><span id="aCount">0/0</span></div>
                <div class="stat-row"><span>Gas B (left/right):</span><span id="bCount">0/0</span></div>
                <div class="stat-row"><span>Avg Speed A:</span><span id="speedA">0</span></div>
                <div class="stat-row"><span>Avg Speed B:</span><span id="speedB">0</span></div>
                <div class="stat-row"><span>Speed Ratio (A/B):</span><span id="speedRatio">0</span></div>
                <div class="stat-row"><span>Theoretical:</span><span id="theoretical">0</span></div>
            </div>

            <div class="description">
                <strong>Graham's Law:</strong><br>
                Rate‚ÇÅ/Rate‚ÇÇ = ‚àö(M‚ÇÇ/M‚ÇÅ)<br>
                Lighter gases diffuse faster.<br><br>
                <strong>Maxwell-Boltzmann:</strong><br>
                Both gases at same T have same avg KE.<br>
                ¬Ωm‚ÇÅv‚ÇÅ¬≤ = ¬Ωm‚ÇÇv‚ÇÇ¬≤<br><br>
                <strong>Partial Pressures:</strong><br>
                P_total = P_A + P_B (Dalton's Law)
            </div>
        </div>
    </div>

    <div id="explainModal" class="modal-overlay">
        <div class="modal">
            <button class="modal-close">&times;</button>
            <h2>üìö GasLab Two Gas</h2>
            <div class="modal-body">
                <p>This simulation demonstrates key concepts in complex systems and agent-based modeling.</p>

                <h3>How It Works</h3>
                <p>Agents follow simple local rules that lead to emergent global behavior.</p>

                <h3>Key Concepts</h3>
                <ul>
                    <li><strong>Emergence:</strong> Complex patterns arise from simple rules</li>
                    <li><strong>Self-organization:</strong> Order without central control</li>
                    <li><strong>Feedback loops:</strong> Actions influence future states</li>
                </ul>

                <h3>Try This</h3>
                <ul>
                    <li>Adjust parameters to see different behaviors</li>
                    <li>Watch for patterns that emerge over time</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        const gasCanvas = document.getElementById('gasCanvas');
        const gasCtx = gasCanvas.getContext('2d');
        const histCanvas = document.getElementById('histCanvas');
        const histCtx = histCanvas.getContext('2d');

        gasCanvas.width = 600;
        gasCanvas.height = 400;
        histCanvas.width = 600;
        histCanvas.height = 120;

        let particles = [];
        let n1 = 50, n2 = 50;
        let massRatio = 4;
        let temperature = 300;
        let barrierOpen = 100;
        let time = 0;
        let paused = false;
        let animationId = null;

        const BARRIER_X = gasCanvas.width / 2;

        function createParticles() {
            particles = [];
            const baseSpeed = Math.sqrt(temperature / 300) * 4;

            // Gas A (light) - start on left
            for (let i = 0; i < n1; i++) {
                const angle = Math.random() * Math.PI * 2;
                const speed = baseSpeed * (0.5 + Math.random());
                particles.push({
                    x: Math.random() * (BARRIER_X - 20) + 10,
                    y: Math.random() * (gasCanvas.height - 20) + 10,
                    vx: Math.cos(angle) * speed,
                    vy: Math.sin(angle) * speed,
                    mass: 1,
                    type: 'A',
                    radius: 4
                });
            }

            // Gas B (heavy) - start on right
            const speedB = baseSpeed / Math.sqrt(massRatio);
            for (let i = 0; i < n2; i++) {
                const angle = Math.random() * Math.PI * 2;
                const speed = speedB * (0.5 + Math.random());
                particles.push({
                    x: BARRIER_X + 10 + Math.random() * (BARRIER_X - 20),
                    y: Math.random() * (gasCanvas.height - 20) + 10,
                    vx: Math.cos(angle) * speed,
                    vy: Math.sin(angle) * speed,
                    mass: massRatio,
                    type: 'B',
                    radius: 4 + Math.log(massRatio)
                });
            }
        }

        function reset() {
            if (animationId) cancelAnimationFrame(animationId);
            n1 = parseInt(document.getElementById('n1').value);
            n2 = parseInt(document.getElementById('n2').value);
            massRatio = parseInt(document.getElementById('mass').value);
            temperature = parseInt(document.getElementById('temp').value);
            barrierOpen = parseInt(document.getElementById('barrier').value);

            time = 0;
            paused = false;
            document.getElementById('pauseBtn').textContent = 'Pause';

            createParticles();
            animate();
        }

        function separate() {
            // Move all A to left, all B to right
            for (const p of particles) {
                if (p.type === 'A') {
                    p.x = Math.random() * (BARRIER_X - 20) + 10;
                } else {
                    p.x = BARRIER_X + 10 + Math.random() * (BARRIER_X - 20);
                }
            }
        }

        function canPassBarrier(y) {
            if (barrierOpen >= 100) return true;
            if (barrierOpen <= 0) return false;

            const openHeight = gasCanvas.height * (barrierOpen / 100);
            const openStart = (gasCanvas.height - openHeight) / 2;
            const openEnd = openStart + openHeight;

            return y > openStart && y < openEnd;
        }

        function step() {
            // Thermostat
            const targetSpeedA = Math.sqrt(temperature / 300) * 4;
            const targetSpeedB = targetSpeedA / Math.sqrt(massRatio);

            for (const p of particles) {
                // Move
                p.x += p.vx;
                p.y += p.vy;

                // Wall collisions
                if (p.x < p.radius) {
                    p.x = p.radius;
                    p.vx = Math.abs(p.vx);
                }
                if (p.x > gasCanvas.width - p.radius) {
                    p.x = gasCanvas.width - p.radius;
                    p.vx = -Math.abs(p.vx);
                }
                if (p.y < p.radius) {
                    p.y = p.radius;
                    p.vy = Math.abs(p.vy);
                }
                if (p.y > gasCanvas.height - p.radius) {
                    p.y = gasCanvas.height - p.radius;
                    p.vy = -Math.abs(p.vy);
                }

                // Barrier collision
                if (barrierOpen < 100) {
                    const wasLeft = p.x - p.vx < BARRIER_X;
                    const isLeft = p.x < BARRIER_X;

                    if (wasLeft !== isLeft) {
                        // Crossing barrier
                        if (!canPassBarrier(p.y)) {
                            p.x = wasLeft ? BARRIER_X - p.radius - 1 : BARRIER_X + p.radius + 1;
                            p.vx *= -1;
                        }
                    }
                }

                // Gentle thermostat
                const speed = Math.sqrt(p.vx * p.vx + p.vy * p.vy);
                const targetSpeed = p.type === 'A' ? targetSpeedA : targetSpeedB;
                if (speed > 0) {
                    const scale = 0.99 + 0.01 * (targetSpeed / speed);
                    p.vx *= scale;
                    p.vy *= scale;
                }
            }

            time++;
        }

        function updateStats() {
            const aParticles = particles.filter(p => p.type === 'A');
            const bParticles = particles.filter(p => p.type === 'B');

            const aLeft = aParticles.filter(p => p.x < BARRIER_X).length;
            const aRight = aParticles.length - aLeft;
            const bLeft = bParticles.filter(p => p.x < BARRIER_X).length;
            const bRight = bParticles.length - bLeft;

            const avgSpeedA = aParticles.reduce((s, p) => s + Math.sqrt(p.vx*p.vx + p.vy*p.vy), 0) / aParticles.length;
            const avgSpeedB = bParticles.reduce((s, p) => s + Math.sqrt(p.vx*p.vx + p.vy*p.vy), 0) / bParticles.length;

            const speedRatio = avgSpeedB > 0 ? avgSpeedA / avgSpeedB : 0;
            const theoretical = Math.sqrt(massRatio);

            document.getElementById('time').textContent = time;
            document.getElementById('aCount').textContent = `${aLeft}/${aRight}`;
            document.getElementById('bCount').textContent = `${bLeft}/${bRight}`;
            document.getElementById('speedA').textContent = avgSpeedA.toFixed(2);
            document.getElementById('speedB').textContent = avgSpeedB.toFixed(2);
            document.getElementById('speedRatio').textContent = speedRatio.toFixed(2);
            document.getElementById('theoretical').textContent = theoretical.toFixed(2);
        }

        function draw() {
            // Gas chamber
            gasCtx.fillStyle = '#1a1a2e';
            gasCtx.fillRect(0, 0, gasCanvas.width, gasCanvas.height);

            // Barrier
            if (barrierOpen < 100) {
                gasCtx.fillStyle = '#636e72';
                const openHeight = gasCanvas.height * (barrierOpen / 100);
                const openStart = (gasCanvas.height - openHeight) / 2;

                // Top part
                gasCtx.fillRect(BARRIER_X - 3, 0, 6, openStart);
                // Bottom part
                gasCtx.fillRect(BARRIER_X - 3, openStart + openHeight, 6, gasCanvas.height - openStart - openHeight);
            } else {
                // Dotted line when fully open
                gasCtx.strokeStyle = 'rgba(99, 110, 114, 0.3)';
                gasCtx.setLineDash([5, 5]);
                gasCtx.beginPath();
                gasCtx.moveTo(BARRIER_X, 0);
                gasCtx.lineTo(BARRIER_X, gasCanvas.height);
                gasCtx.stroke();
                gasCtx.setLineDash([]);
            }

            // Draw particles
            for (const p of particles) {
                const speed = Math.sqrt(p.vx * p.vx + p.vy * p.vy);

                if (p.type === 'A') {
                    gasCtx.fillStyle = '#74b9ff';
                } else {
                    gasCtx.fillStyle = '#fd79a8';
                }

                gasCtx.beginPath();
                gasCtx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                gasCtx.fill();
            }

            // Labels
            gasCtx.fillStyle = 'white';
            gasCtx.font = '12px Arial';
            gasCtx.fillText('Left Chamber', 10, 20);
            gasCtx.fillText('Right Chamber', BARRIER_X + 10, 20);

            // Speed distribution histogram
            histCtx.fillStyle = '#1a1a2e';
            histCtx.fillRect(0, 0, histCanvas.width, histCanvas.height);

            const maxSpeed = 10;
            const numBins = 20;
            const binsA = new Array(numBins).fill(0);
            const binsB = new Array(numBins).fill(0);

            for (const p of particles) {
                const speed = Math.sqrt(p.vx * p.vx + p.vy * p.vy);
                const bin = Math.min(numBins - 1, Math.floor(speed / maxSpeed * numBins));
                if (p.type === 'A') binsA[bin]++;
                else binsB[bin]++;
            }

            const maxCount = Math.max(1, ...binsA, ...binsB);
            const barWidth = histCanvas.width / numBins;

            for (let i = 0; i < numBins; i++) {
                // Gas A
                const heightA = (binsA[i] / maxCount) * (histCanvas.height - 25);
                histCtx.fillStyle = 'rgba(116, 185, 255, 0.7)';
                histCtx.fillRect(i * barWidth, histCanvas.height - 15 - heightA, barWidth / 2 - 1, heightA);

                // Gas B
                const heightB = (binsB[i] / maxCount) * (histCanvas.height - 25);
                histCtx.fillStyle = 'rgba(253, 121, 168, 0.7)';
                histCtx.fillRect(i * barWidth + barWidth / 2, histCanvas.height - 15 - heightB, barWidth / 2 - 1, heightB);
            }

            histCtx.fillStyle = 'white';
            histCtx.font = '10px Arial';
            histCtx.fillText('Speed distribution (Blue: A, Pink: B)', 5, 12);
            histCtx.fillText('0', 5, histCanvas.height - 3);
            histCtx.fillText('Speed ‚Üí', histCanvas.width - 50, histCanvas.height - 3);
        }

        function animate() {
            if (!paused) {
                step();
                updateStats();
            }
            draw();
            animationId = requestAnimationFrame(animate);
        }

        function togglePause() {
            paused = !paused;
            document.getElementById('pauseBtn').textContent = paused ? 'Resume' : 'Pause';
        }

        // Event listeners
        document.getElementById('n1').oninput = function() {
            document.getElementById('n1Val').textContent = this.value;
        };
        document.getElementById('n2').oninput = function() {
            document.getElementById('n2Val').textContent = this.value;
        };
        document.getElementById('mass').oninput = function() {
            document.getElementById('massVal').textContent = this.value;
        };
        document.getElementById('temp').oninput = function() {
            temperature = parseInt(this.value);
            document.getElementById('tempVal').textContent = this.value;
        };
        document.getElementById('barrier').oninput = function() {
            barrierOpen = parseInt(this.value);
            document.getElementById('barrierVal').textContent = this.value;
        };

        reset();
    

        // Modal functionality
        const modal = document.getElementById('explainModal');
        document.getElementById('explainBtn').addEventListener('click', () => {
            modal.classList.add('active');
        });
        modal.querySelector('.modal-close').addEventListener('click', () => {
            modal.classList.remove('active');
        });
        modal.addEventListener('click', (e) => {
            if (e.target === modal) modal.classList.remove('active');
        });</script>
</body>
</html>
