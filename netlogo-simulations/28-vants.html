<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vants - Virtual Ants with Custom Rules</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', system-ui, sans-serif;
            color: #e0e0e0;
        }
        .back-link {
            position: fixed;
            top: 15px;
            left: 15px;
            color: #e67e22;
            text-decoration: none;
            z-index: 100;
        }
        header { text-align: center; padding: 15px; }
        h1 { color: #e67e22; font-size: 1.6rem; }
        .container {
            display: grid;
            grid-template-columns: 1fr 280px;
            gap: 15px;
            padding: 0 15px 15px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .main-area { display: flex; flex-direction: column; gap: 15px; }
        .canvas-wrapper {
            background: rgba(0,0,0,0.4);
            border-radius: 10px;
            padding: 15px;
        }
        .canvas-wrapper h3 {
            color: #e67e22;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        #antCanvas {
            width: 100%;
            height: 500px;
            background: #0a0a15;
            border-radius: 8px;
        }
        .sidebar {
            background: rgba(0,0,0,0.4);
            border-radius: 10px;
            padding: 15px;
        }
        .control-group { margin-bottom: 15px; }
        .control-group label {
            display: block;
            color: #e67e22;
            margin-bottom: 6px;
            font-size: 0.85rem;
        }
        input[type="range"] {
            width: 100%;
            -webkit-appearance: none;
            height: 5px;
            background: #333;
            border-radius: 3px;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            background: #e67e22;
            border-radius: 50%;
            cursor: pointer;
        }
        .value-display {
            text-align: right;
            font-size: 0.8rem;
            color: #888;
            margin-top: 4px;
        }
        select {
            width: 100%;
            padding: 8px;
            background: #1a1a2e;
            border: 1px solid #e67e22;
            border-radius: 5px;
            color: #e0e0e0;
            font-size: 0.9rem;
        }
        button {
            width: 100%;
            padding: 10px;
            margin: 4px 0;
            background: #e67e22;
            border: none;
            border-radius: 5px;
            color: #fff;
            font-weight: 600;
            cursor: pointer;
        }
        button:hover { background: #d35400; }
        button.secondary { background: #333; }
        button.running { background: #27ae60; }
        .ant-list {
            max-height: 150px;
            overflow-y: auto;
            margin-top: 10px;
        }
        .ant-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 8px;
            background: rgba(230, 126, 34, 0.1);
            border-radius: 4px;
            margin-bottom: 4px;
            font-size: 0.8rem;
        }
        .ant-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .ant-info {
            display: flex;
            align-items: center;
            flex: 1;
        }
        .remove-ant {
            background: #e74c3c;
            color: white;
            border: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.7rem;
        }
        .stats {
            background: rgba(230, 126, 34, 0.1);
            border: 1px solid rgba(230, 126, 34, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 6px 0;
            font-size: 0.8rem;
        }
        .stat-label { color: #888; }
        .stat-value { color: #e67e22; font-family: monospace; }
        .info {
            margin-top: 12px;
            padding: 10px;
            background: rgba(230, 126, 34, 0.1);
            border-radius: 6px;
            font-size: 0.75rem;
            line-height: 1.4;
        }
        .info h4 { color: #e67e22; margin-bottom: 6px; }
        @media (max-width: 768px) {
            .container { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">&larr; Back</a>

    <header>
        <h1>Vants</h1>
        <p style="color: #888; font-size: 0.9rem;">Multiple Virtual Ants with Custom Rules</p>
    </header>

    <div class="container">
        <div class="main-area">
            <div class="canvas-wrapper">
                <h3>Ant Trails</h3>
                <canvas id="antCanvas"></canvas>
            </div>
        </div>

        <div class="sidebar">
            <div class="control-group">
                <label>Grid Size</label>
                <input type="range" id="gridSize" min="100" max="400" value="200">
                <div class="value-display"><span id="gridSizeVal">200</span> × 200</div>
            </div>

            <div class="control-group">
                <label>Steps per Frame</label>
                <input type="range" id="stepsPerFrame" min="1" max="100" value="20">
                <div class="value-display"><span id="stepsPerFrameVal">20</span></div>
            </div>

            <div class="control-group">
                <label>Add Ant with Rule</label>
                <select id="ruleSelect">
                    <option value="RL">RL (Classic Langton)</option>
                    <option value="RLR">RLR (Triangle builder)</option>
                    <option value="LLRR">LLRR (Symmetric)</option>
                    <option value="LRRRRRLLR">LRRRRRLLR (Square builder)</option>
                    <option value="RRLLLRLLLRRR">RRLLLRLLLRRR (Complex)</option>
                    <option value="RRLL">RRLL (Periodic)</option>
                </select>
            </div>

            <button id="addAntBtn" class="secondary">Add Ant</button>
            <button id="startBtn">Start Simulation</button>
            <button id="resetBtn" class="secondary">Reset Grid</button>

            <div class="ant-list" id="antList"></div>

            <div class="stats">
                <div class="stat-row">
                    <span class="stat-label">Total Steps:</span>
                    <span class="stat-value" id="stepsStat">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Active Ants:</span>
                    <span class="stat-value" id="antsStat">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Cells Changed:</span>
                    <span class="stat-value" id="cellsStat">0</span>
                </div>
            </div>

            <div class="info">
                <h4>Langton's Ant Rules</h4>
                <p>Each letter in the rule defines behavior on that color:</p>
                <p><strong>R</strong> = Turn right, <strong>L</strong> = Turn left</p>
                <p style="margin-top:6px">After turning, the ant flips the cell color and moves forward. Multiple ants can interact and create complex emergent patterns.</p>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('antCanvas');
        const ctx = canvas.getContext('2d');

        let gridSize = 200;
        let stepsPerFrame = 20;
        let grid = [];
        let ants = [];
        let running = false;
        let totalSteps = 0;
        let animFrame;

        // Directions: 0=up, 1=right, 2=down, 3=left
        const dx = [0, 1, 0, -1];
        const dy = [-1, 0, 1, 0];

        // Color palette for multi-state cells
        const cellColors = [
            '#0a0a15', // State 0 (empty)
            '#e74c3c', // State 1
            '#3498db', // State 2
            '#2ecc71', // State 3
            '#f39c12', // State 4
            '#9b59b6', // State 5
            '#1abc9c', // State 6
            '#e91e63', // State 7
            '#00bcd4', // State 8
            '#8bc34a', // State 9
            '#ff5722', // State 10
            '#673ab7'  // State 11
        ];

        const antColors = [
            '#ffffff',
            '#ffff00',
            '#00ffff',
            '#ff00ff',
            '#ff8800',
            '#88ff00'
        ];

        function resize() {
            canvas.width = canvas.parentElement.clientWidth - 30;
            canvas.height = 500;
            render();
        }

        function initGrid() {
            grid = [];
            for (let y = 0; y < gridSize; y++) {
                const row = [];
                for (let x = 0; x < gridSize; x++) {
                    row.push(0);
                }
                grid.push(row);
            }
            totalSteps = 0;
            updateStats();
            render();
        }

        function addAnt(rule) {
            const cx = Math.floor(gridSize / 2) + Math.floor((Math.random() - 0.5) * 20);
            const cy = Math.floor(gridSize / 2) + Math.floor((Math.random() - 0.5) * 20);

            const ant = {
                x: cx,
                y: cy,
                dir: Math.floor(Math.random() * 4),
                rule: rule,
                color: antColors[ants.length % antColors.length],
                steps: 0,
                id: Date.now()
            };

            ants.push(ant);
            updateAntList();
            updateStats();
        }

        function removeAnt(id) {
            ants = ants.filter(a => a.id !== id);
            updateAntList();
            updateStats();
        }

        function updateAntList() {
            const list = document.getElementById('antList');
            list.innerHTML = '';

            for (const ant of ants) {
                const item = document.createElement('div');
                item.className = 'ant-item';
                item.innerHTML = `
                    <div class="ant-info">
                        <div class="ant-color" style="background: ${ant.color};"></div>
                        <span>${ant.rule}</span>
                    </div>
                    <button class="remove-ant" onclick="removeAnt(${ant.id})">×</button>
                `;
                list.appendChild(item);
            }
        }

        function step() {
            for (const ant of ants) {
                // Get current cell state
                const state = grid[ant.y][ant.x];
                const numStates = ant.rule.length;

                // Get turn direction from rule
                const turnDir = ant.rule[state % numStates];

                // Turn
                if (turnDir === 'R') {
                    ant.dir = (ant.dir + 1) % 4;
                } else if (turnDir === 'L') {
                    ant.dir = (ant.dir + 3) % 4;
                }

                // Flip cell to next state
                grid[ant.y][ant.x] = (state + 1) % numStates;

                // Move forward
                ant.x = (ant.x + dx[ant.dir] + gridSize) % gridSize;
                ant.y = (ant.y + dy[ant.dir] + gridSize) % gridSize;

                ant.steps++;
            }

            totalSteps++;
        }

        function countChangedCells() {
            let count = 0;
            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    if (grid[y][x] !== 0) count++;
                }
            }
            return count;
        }

        function updateStats() {
            document.getElementById('stepsStat').textContent = totalSteps.toLocaleString();
            document.getElementById('antsStat').textContent = ants.length;
            document.getElementById('cellsStat').textContent = countChangedCells().toLocaleString();
        }

        function render() {
            const cellSize = Math.min(canvas.width, canvas.height) / gridSize;
            const offsetX = (canvas.width - gridSize * cellSize) / 2;
            const offsetY = (canvas.height - gridSize * cellSize) / 2;

            // Create image data for faster rendering
            const imageData = ctx.createImageData(canvas.width, canvas.height);

            // Fill background
            for (let i = 0; i < imageData.data.length; i += 4) {
                imageData.data[i] = 10;
                imageData.data[i + 1] = 10;
                imageData.data[i + 2] = 21;
                imageData.data[i + 3] = 255;
            }

            // Draw cells
            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    const state = grid[y][x];
                    if (state === 0) continue;

                    const color = cellColors[state % cellColors.length];
                    const r = parseInt(color.slice(1, 3), 16);
                    const g = parseInt(color.slice(3, 5), 16);
                    const b = parseInt(color.slice(5, 7), 16);

                    const px = Math.floor(offsetX + x * cellSize);
                    const py = Math.floor(offsetY + y * cellSize);
                    const size = Math.max(1, Math.floor(cellSize));

                    for (let dy = 0; dy < size; dy++) {
                        for (let dx = 0; dx < size; dx++) {
                            const idx = ((py + dy) * canvas.width + (px + dx)) * 4;
                            if (idx >= 0 && idx < imageData.data.length - 3) {
                                imageData.data[idx] = r;
                                imageData.data[idx + 1] = g;
                                imageData.data[idx + 2] = b;
                            }
                        }
                    }
                }
            }

            ctx.putImageData(imageData, 0, 0);

            // Draw ants on top
            for (const ant of ants) {
                const px = offsetX + ant.x * cellSize + cellSize / 2;
                const py = offsetY + ant.y * cellSize + cellSize / 2;

                ctx.fillStyle = ant.color;
                ctx.beginPath();
                ctx.arc(px, py, Math.max(2, cellSize), 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function animate() {
            if (!running) return;

            for (let i = 0; i < stepsPerFrame; i++) {
                step();
            }

            updateStats();
            render();
            animFrame = requestAnimationFrame(animate);
        }

        // Make removeAnt available globally
        window.removeAnt = removeAnt;

        // Event listeners
        document.getElementById('gridSize').addEventListener('input', (e) => {
            gridSize = parseInt(e.target.value);
            document.getElementById('gridSizeVal').textContent = gridSize;
        });

        document.getElementById('stepsPerFrame').addEventListener('input', (e) => {
            stepsPerFrame = parseInt(e.target.value);
            document.getElementById('stepsPerFrameVal').textContent = stepsPerFrame;
        });

        document.getElementById('addAntBtn').addEventListener('click', () => {
            const rule = document.getElementById('ruleSelect').value;
            addAnt(rule);
            render();
        });

        document.getElementById('startBtn').addEventListener('click', (e) => {
            running = !running;
            if (running) {
                e.target.textContent = 'Pause';
                e.target.classList.add('running');
                animate();
            } else {
                e.target.textContent = 'Resume';
                e.target.classList.remove('running');
                cancelAnimationFrame(animFrame);
            }
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            running = false;
            document.getElementById('startBtn').textContent = 'Start Simulation';
            document.getElementById('startBtn').classList.remove('running');
            cancelAnimationFrame(animFrame);
            ants = [];
            updateAntList();
            initGrid();
        });

        window.addEventListener('resize', resize);
        resize();
        initGrid();

        // Add default ant
        addAnt('RL');
    </script>
</body>
</html>
