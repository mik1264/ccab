<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ant Colony Foraging - CCAB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a2e;
            color: #e8e6e1;
            overflow: hidden;
        }
        #container {
            display: flex;
            height: 100vh;
        }
        #canvas-container {
            flex: 1;
            position: relative;
        }
        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
        #controls {
            width: 280px;
            background: rgba(0,0,0,0.8);
            padding: 20px;
            overflow-y: auto;
        }
        h1 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #fbbf24;
        }
        .control-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            font-size: 0.8rem;
            margin-bottom: 5px;
            color: #aaa;
        }
        input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }
        .value-display {
            font-size: 0.75rem;
            color: #fbbf24;
        }
        button {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            background: #fbbf24;
            color: #1a1a2e;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background: #f59e0b;
        }
        .stats {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 5px;
            font-size: 0.8rem;
        }
        .stats div {
            margin-bottom: 5px;
        }
        .back-link {
            position: fixed;
            top: 10px;
            left: 10px;
            padding: 8px 16px;
            background: rgba(0,0,0,0.7);
            color: #fbbf24;
            text-decoration: none;
            border-radius: 6px;
            font-size: 14px;
            z-index: 999;
        }
        .back-link:hover {
            background: rgba(251,191,36,0.2);
        }
        .legend {
            margin-top: 15px;
            font-size: 0.75rem;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        .legend-color {
            width: 15px;
            height: 15px;
            margin-right: 8px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Gallery</a>

    <div id="container">
        <div id="canvas-container">
            <canvas id="canvas"></canvas>
        </div>
        <div id="controls">
            <h1>Ant Colony Foraging</h1>

            <div class="control-group">
                <label>Number of Ants: <span id="antCountValue">100</span></label>
                <input type="range" id="antCount" min="20" max="300" value="100">
            </div>

            <div class="control-group">
                <label>Evaporation Rate: <span id="evapRateValue">0.99</span></label>
                <input type="range" id="evapRate" min="0.9" max="0.999" step="0.001" value="0.99">
            </div>

            <div class="control-group">
                <label>Diffusion Rate: <span id="diffRateValue">0.5</span></label>
                <input type="range" id="diffRate" min="0" max="1" step="0.1" value="0.5">
            </div>

            <div class="control-group">
                <label>Pheromone Deposit: <span id="pheromoneValue">60</span></label>
                <input type="range" id="pheromone" min="10" max="200" value="60">
            </div>

            <div class="control-group">
                <label>Sniff Distance: <span id="sniffValue">3</span></label>
                <input type="range" id="sniff" min="1" max="5" value="3">
            </div>

            <button id="reset">Reset Simulation</button>
            <button id="addFood">Add Food Source</button>

            <div class="stats">
                <div>Food Collected: <span id="foodCollected">0</span></div>
                <div>Ants Carrying Food: <span id="antsCarrying">0</span></div>
                <div>Average Trail Strength: <span id="avgTrail">0</span></div>
            </div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #8b4513;"></div>
                    <span>Nest</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #22c55e;"></div>
                    <span>Food Sources</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #ff6b6b;"></div>
                    <span>Ants (searching)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #4ade80;"></div>
                    <span>Ants (carrying food)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: rgba(100,200,255,0.5);"></div>
                    <span>Pheromone Trail</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // Grid settings
        let gridWidth, gridHeight;
        const cellSize = 4;
        let pheromones = [];
        let tempPheromones = [];

        // Simulation parameters
        let params = {
            antCount: 100,
            evapRate: 0.99,
            diffRate: 0.5,
            pheromoneDeposit: 60,
            sniffDistance: 3
        };

        // State
        let ants = [];
        let nest = { x: 0, y: 0, radius: 15 };
        let foodSources = [];
        let foodCollected = 0;

        function resize() {
            const container = document.getElementById('canvas-container');
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;

            gridWidth = Math.floor(canvas.width / cellSize);
            gridHeight = Math.floor(canvas.height / cellSize);

            initPheromones();
        }

        function initPheromones() {
            pheromones = new Float32Array(gridWidth * gridHeight);
            tempPheromones = new Float32Array(gridWidth * gridHeight);
        }

        function init() {
            resize();

            // Place nest in center
            nest.x = Math.floor(gridWidth / 2);
            nest.y = Math.floor(gridHeight / 2);

            // Create initial food sources
            foodSources = [];
            addFoodSource(gridWidth * 0.2, gridHeight * 0.3, 500);
            addFoodSource(gridWidth * 0.8, gridHeight * 0.7, 500);
            addFoodSource(gridWidth * 0.75, gridHeight * 0.25, 500);

            // Create ants
            createAnts();

            foodCollected = 0;
        }

        function addFoodSource(x, y, amount) {
            foodSources.push({
                x: Math.floor(x),
                y: Math.floor(y),
                amount: amount,
                initialAmount: amount,
                radius: 12
            });
        }

        function createAnts() {
            ants = [];
            for (let i = 0; i < params.antCount; i++) {
                ants.push({
                    x: nest.x + (Math.random() - 0.5) * 10,
                    y: nest.y + (Math.random() - 0.5) * 10,
                    angle: Math.random() * Math.PI * 2,
                    hasFood: false,
                    speed: 1
                });
            }
        }

        function getPheromone(x, y) {
            if (x < 0 || x >= gridWidth || y < 0 || y >= gridHeight) return 0;
            return pheromones[y * gridWidth + x];
        }

        function setPheromone(x, y, value) {
            if (x < 0 || x >= gridWidth || y < 0 || y >= gridHeight) return;
            pheromones[y * gridWidth + x] = Math.min(255, value);
        }

        function addPheromone(x, y, amount) {
            if (x < 0 || x >= gridWidth || y < 0 || y >= gridHeight) return;
            const idx = y * gridWidth + x;
            pheromones[idx] = Math.min(255, pheromones[idx] + amount);
        }

        function sniff(ant, offsetAngle) {
            const distance = params.sniffDistance;
            const angle = ant.angle + offsetAngle;
            const x = Math.floor(ant.x + Math.cos(angle) * distance);
            const y = Math.floor(ant.y + Math.sin(angle) * distance);
            return getPheromone(x, y);
        }

        function updateAnt(ant) {
            const gx = Math.floor(ant.x);
            const gy = Math.floor(ant.y);

            if (ant.hasFood) {
                // Returning to nest - deposit pheromone
                addPheromone(gx, gy, params.pheromoneDeposit);

                // Check if at nest
                const dx = ant.x - nest.x;
                const dy = ant.y - nest.y;
                if (dx * dx + dy * dy < nest.radius * nest.radius) {
                    ant.hasFood = false;
                    foodCollected++;
                    ant.angle += Math.PI; // Turn around
                }

                // Navigate toward nest
                const angleToNest = Math.atan2(nest.y - ant.y, nest.x - ant.x);
                ant.angle = ant.angle + (angleToNest - ant.angle) * 0.1;
                ant.angle += (Math.random() - 0.5) * 0.3;
            } else {
                // Searching for food - follow pheromones
                const ahead = sniff(ant, 0);
                const left = sniff(ant, -0.5);
                const right = sniff(ant, 0.5);

                if (left > ahead && left > right) {
                    ant.angle -= 0.4;
                } else if (right > ahead && right > left) {
                    ant.angle += 0.4;
                }

                // Add some randomness
                ant.angle += (Math.random() - 0.5) * 0.5;

                // Check for food
                for (let food of foodSources) {
                    if (food.amount > 0) {
                        const dx = ant.x - food.x;
                        const dy = ant.y - food.y;
                        if (dx * dx + dy * dy < food.radius * food.radius) {
                            ant.hasFood = true;
                            food.amount--;
                            ant.angle += Math.PI;
                            break;
                        }
                    }
                }
            }

            // Move ant
            ant.x += Math.cos(ant.angle) * ant.speed;
            ant.y += Math.sin(ant.angle) * ant.speed;

            // Bounce off walls
            if (ant.x < 1) { ant.x = 1; ant.angle = Math.PI - ant.angle; }
            if (ant.x > gridWidth - 2) { ant.x = gridWidth - 2; ant.angle = Math.PI - ant.angle; }
            if (ant.y < 1) { ant.y = 1; ant.angle = -ant.angle; }
            if (ant.y > gridHeight - 2) { ant.y = gridHeight - 2; ant.angle = -ant.angle; }
        }

        function evaporateAndDiffuse() {
            // Simple evaporation and diffusion
            for (let y = 0; y < gridHeight; y++) {
                for (let x = 0; x < gridWidth; x++) {
                    const idx = y * gridWidth + x;
                    let value = pheromones[idx] * params.evapRate;

                    // Diffusion
                    if (params.diffRate > 0) {
                        let sum = value * (1 - params.diffRate);
                        let count = 0;

                        for (let dy = -1; dy <= 1; dy++) {
                            for (let dx = -1; dx <= 1; dx++) {
                                if (dx === 0 && dy === 0) continue;
                                const nx = x + dx;
                                const ny = y + dy;
                                if (nx >= 0 && nx < gridWidth && ny >= 0 && ny < gridHeight) {
                                    sum += pheromones[ny * gridWidth + nx] * params.diffRate / 8;
                                    count++;
                                }
                            }
                        }
                        value = sum;
                    }

                    tempPheromones[idx] = value;
                }
            }

            // Swap buffers
            [pheromones, tempPheromones] = [tempPheromones, pheromones];
        }

        function draw() {
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw pheromones
            const imageData = ctx.createImageData(canvas.width, canvas.height);
            for (let y = 0; y < gridHeight; y++) {
                for (let x = 0; x < gridWidth; x++) {
                    const p = pheromones[y * gridWidth + x];
                    if (p > 0.1) {
                        const intensity = Math.min(255, p * 2);
                        for (let cy = 0; cy < cellSize; cy++) {
                            for (let cx = 0; cx < cellSize; cx++) {
                                const px = x * cellSize + cx;
                                const py = y * cellSize + cy;
                                if (px < canvas.width && py < canvas.height) {
                                    const idx = (py * canvas.width + px) * 4;
                                    imageData.data[idx] = 100;
                                    imageData.data[idx + 1] = 180;
                                    imageData.data[idx + 2] = 255;
                                    imageData.data[idx + 3] = intensity * 0.7;
                                }
                            }
                        }
                    }
                }
            }
            ctx.putImageData(imageData, 0, 0);

            // Draw nest
            ctx.beginPath();
            ctx.arc(nest.x * cellSize, nest.y * cellSize, nest.radius * cellSize, 0, Math.PI * 2);
            ctx.fillStyle = '#8b4513';
            ctx.fill();
            ctx.strokeStyle = '#654321';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Draw food sources
            for (let food of foodSources) {
                if (food.amount > 0) {
                    const size = (food.amount / food.initialAmount) * food.radius * cellSize;
                    ctx.beginPath();
                    ctx.arc(food.x * cellSize, food.y * cellSize, Math.max(5, size), 0, Math.PI * 2);
                    ctx.fillStyle = '#22c55e';
                    ctx.fill();
                    ctx.strokeStyle = '#16a34a';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
            }

            // Draw ants
            let carryingCount = 0;
            for (let ant of ants) {
                ctx.beginPath();
                const ax = ant.x * cellSize;
                const ay = ant.y * cellSize;

                if (ant.hasFood) {
                    ctx.fillStyle = '#4ade80';
                    carryingCount++;
                } else {
                    ctx.fillStyle = '#ff6b6b';
                }

                // Draw ant body
                ctx.beginPath();
                ctx.arc(ax, ay, 3, 0, Math.PI * 2);
                ctx.fill();

                // Draw direction
                ctx.beginPath();
                ctx.moveTo(ax, ay);
                ctx.lineTo(ax + Math.cos(ant.angle) * 5, ay + Math.sin(ant.angle) * 5);
                ctx.strokeStyle = ant.hasFood ? '#22c55e' : '#dc2626';
                ctx.lineWidth = 1;
                ctx.stroke();
            }

            // Update stats
            let avgTrail = 0;
            for (let i = 0; i < pheromones.length; i++) {
                avgTrail += pheromones[i];
            }
            avgTrail /= pheromones.length;

            document.getElementById('foodCollected').textContent = foodCollected;
            document.getElementById('antsCarrying').textContent = carryingCount;
            document.getElementById('avgTrail').textContent = avgTrail.toFixed(2);
        }

        function update() {
            for (let ant of ants) {
                updateAnt(ant);
            }
            evaporateAndDiffuse();
        }

        function animate() {
            update();
            draw();
            requestAnimationFrame(animate);
        }

        // Event listeners
        document.getElementById('antCount').addEventListener('input', (e) => {
            params.antCount = parseInt(e.target.value);
            document.getElementById('antCountValue').textContent = params.antCount;
        });

        document.getElementById('evapRate').addEventListener('input', (e) => {
            params.evapRate = parseFloat(e.target.value);
            document.getElementById('evapRateValue').textContent = params.evapRate.toFixed(3);
        });

        document.getElementById('diffRate').addEventListener('input', (e) => {
            params.diffRate = parseFloat(e.target.value);
            document.getElementById('diffRateValue').textContent = params.diffRate.toFixed(1);
        });

        document.getElementById('pheromone').addEventListener('input', (e) => {
            params.pheromoneDeposit = parseInt(e.target.value);
            document.getElementById('pheromoneValue').textContent = params.pheromoneDeposit;
        });

        document.getElementById('sniff').addEventListener('input', (e) => {
            params.sniffDistance = parseInt(e.target.value);
            document.getElementById('sniffValue').textContent = params.sniffDistance;
        });

        document.getElementById('reset').addEventListener('click', () => {
            init();
        });

        document.getElementById('addFood').addEventListener('click', () => {
            const x = Math.random() * gridWidth * 0.8 + gridWidth * 0.1;
            const y = Math.random() * gridHeight * 0.8 + gridHeight * 0.1;
            addFoodSource(x, y, 500);
        });

        window.addEventListener('resize', resize);

        // Start
        init();
        animate();
    </script>
</body>
</html>
