<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unverified Virus - Information Spread</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e8e8e8;
            min-height: 100vh;
            display: flex;
        }
        .sidebar {
            width: 300px;
            background: rgba(0,0,0,0.3);
            padding: 20px;
            overflow-y: auto;
            border-right: 1px solid rgba(255,255,255,0.1);
        }
        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        h1 { font-size: 1.4em; margin-bottom: 5px; color: #ff6b9d; }
        .subtitle { font-size: 0.85em; color: #888; margin-bottom: 20px; }
        .control-group { margin-bottom: 15px; }
        .control-group label {
            display: block;
            font-size: 0.85em;
            color: #aaa;
            margin-bottom: 5px;
        }
        .control-group input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }
        .control-group .value {
            font-size: 0.8em;
            color: #ff6b9d;
        }
        .buttons { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        button {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s;
        }
        .btn-primary { background: #ff6b9d; color: #000; }
        .btn-secondary { background: #444; color: #fff; }
        .btn-danger { background: #e74c3c; color: #fff; }
        button:hover { transform: scale(1.05); }
        .stats {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .stats h3 { font-size: 0.9em; color: #ff6b9d; margin-bottom: 10px; }
        .stat-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.85em;
            margin-bottom: 5px;
        }
        .stat-value { color: #ff6b9d; }
        .canvas-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        canvas {
            background: #0a0a1a;
            border-radius: 10px;
        }
        #chartCanvas {
            margin-top: 15px;
            width: 100%;
            max-width: 580px;
        }
        .legend {
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .legend h4 { font-size: 0.85em; color: #888; margin-bottom: 8px; }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.75em;
            margin-bottom: 4px;
        }
        .legend-color {
            width: 14px;
            height: 14px;
            border-radius: 50%;
        }
        .back-link {
            display: inline-block;
            color: #ff6b9d;
            text-decoration: none;
            margin-bottom: 20px;
            font-size: 0.9em;
        }
        .back-link:hover { text-decoration: underline; }
        .info {
            font-size: 0.75em;
            color: #666;
            line-height: 1.5;
            margin-top: 10px;
        }

        .explain-btn {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            margin-top: 10px;
        }
        .explain-btn:hover {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        }
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .modal-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 1;
        }
        .modal {
            background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%);
            border-radius: 16px;
            padding: 30px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
        }
        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: #888;
            font-size: 28px;
            cursor: pointer;
            width: auto;
            padding: 0;
            margin: 0;
        }
        .modal-close:hover {
            color: #fff;
            background: none;
        }
        .modal h2 {
            color: #fbbf24;
            margin-bottom: 20px;
            font-size: 1.5rem;
            padding-right: 30px;
        }
        .modal-body {
            color: #ccc;
            line-height: 1.8;
            font-size: 0.95rem;
        }
        .modal-body h3 {
            color: #a5b4fc;
            margin: 20px 0 10px 0;
            font-size: 1.1rem;
        }
        .modal-body p {
            margin-bottom: 15px;
        }
        .modal-body ul {
            margin: 10px 0 15px 20px;
        }
        .modal-body li {
            margin-bottom: 8px;
        }
        .modal-body strong {
            color: #fbbf24;
        }
        .modal-body em {
            color: #a5b4fc;
            font-style: normal;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <a href="index.html" class="back-link">‚Üê Back to Gallery</a>
        <h1>Unverified Virus</h1>
        <p class="subtitle">Misinformation Spread Model</p>

        <div class="buttons">
            <button class="btn-primary" id="startBtn">Start</button>
            <button class="btn-secondary" id="stepBtn">Step</button>
            <button class="btn-danger" id="resetBtn">Reset</button>
            <button id="explainBtn" class="explain-btn">üìö Explain</button>
        </div>

        <div class="control-group">
            <label>Population: <span class="value" id="popVal">200</span></label>
            <input type="range" id="population" min="50" max="400" value="200">
        </div>

        <div class="control-group">
            <label>Initial Spreaders: <span class="value" id="initVal">5</span></label>
            <input type="range" id="initial" min="1" max="20" value="5">
        </div>

        <div class="control-group">
            <label>Spread Probability: <span class="value" id="spreadVal">20%</span></label>
            <input type="range" id="spreadProb" min="5" max="50" value="20">
        </div>

        <div class="control-group">
            <label>Skepticism: <span class="value" id="skeptVal">30%</span></label>
            <input type="range" id="skepticism" min="0" max="80" value="30">
        </div>

        <div class="control-group">
            <label>Fact-Check Delay: <span class="value" id="factVal">50</span> ticks</label>
            <input type="range" id="factCheck" min="10" max="200" value="50">
        </div>

        <div class="control-group">
            <label>Recovery Rate: <span class="value" id="recoverVal">5%</span></label>
            <input type="range" id="recovery" min="1" max="20" value="5">
        </div>

        <div class="stats">
            <h3>Spread Statistics</h3>
            <div class="stat-row">
                <span>Naive:</span>
                <span class="stat-value" id="naive">0</span>
            </div>
            <div class="stat-row">
                <span>Spreaders:</span>
                <span class="stat-value" id="spreaders">0</span>
            </div>
            <div class="stat-row">
                <span>Skeptical:</span>
                <span class="stat-value" id="skeptical">0</span>
            </div>
            <div class="stat-row">
                <span>Fact-Checked:</span>
                <span class="stat-value" id="factChecked">0</span>
            </div>
            <div class="stat-row">
                <span>Time Steps:</span>
                <span class="stat-value" id="time">0</span>
            </div>
            <div class="stat-row">
                <span>Peak Spreaders:</span>
                <span class="stat-value" id="peak">0</span>
            </div>
        </div>

        <div class="legend">
            <h4>Agent States</h4>
            <div class="legend-item">
                <div class="legend-color" style="background: #4ecdc4;"></div>
                <span>Naive - Haven't heard rumor</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ff6b6b;"></div>
                <span>Spreader - Actively sharing</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ffd93d;"></div>
                <span>Skeptical - Won't spread</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #95e1a3;"></div>
                <span>Fact-Checked - Knows truth</span>
            </div>
        </div>

        <p class="info">
            This model simulates how unverified information spreads.
            Skeptical individuals resist spreading rumors.
            Fact-checking eventually converts spreaders.
            Similar to disease models but with cognitive factors.
        </p>
    </div>

    <div class="main">
        <div class="canvas-container">
            <canvas id="canvas"></canvas>
            <canvas id="chartCanvas" height="120"></canvas>
        </div>
    </div>

    <div id="explainModal" class="modal-overlay">
        <div class="modal">
            <button class="modal-close">&times;</button>
            <h2>üìö Unverified Virus - Information Spread</h2>
            <div class="modal-body">
                <p>This simulation demonstrates key concepts in complex systems and agent-based modeling.</p>

                <h3>How It Works</h3>
                <p>Agents follow simple local rules that lead to emergent global behavior.</p>

                <h3>Key Concepts</h3>
                <ul>
                    <li><strong>Emergence:</strong> Complex patterns arise from simple rules</li>
                    <li><strong>Self-organization:</strong> Order without central control</li>
                    <li><strong>Feedback loops:</strong> Actions influence future states</li>
                </ul>

                <h3>Try This</h3>
                <ul>
                    <li>Adjust parameters to see different behaviors</li>
                    <li>Watch for patterns that emerge over time</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const chartCanvas = document.getElementById('chartCanvas');
        const chartCtx = chartCanvas.getContext('2d');

        // State
        let running = false;
        let agents = [];
        let population = 200;
        let initialSpreaders = 5;
        let spreadProb = 0.2;
        let skepticism = 0.3;
        let factCheckDelay = 50;
        let recoveryRate = 0.05;
        let time = 0;
        let peakSpreaders = 0;
        let history = { naive: [], spreaders: [], skeptical: [], factChecked: [] };

        const STATES = {
            NAIVE: 'naive',
            SPREADER: 'spreader',
            SKEPTICAL: 'skeptical',
            FACT_CHECKED: 'factChecked'
        };

        const COLORS = {
            naive: '#4ecdc4',
            spreader: '#ff6b6b',
            skeptical: '#ffd93d',
            factChecked: '#95e1a3'
        };

        function resizeCanvas() {
            const container = canvas.parentElement;
            const size = Math.min(container.clientWidth - 40, 500);
            canvas.width = size;
            canvas.height = size;
            chartCanvas.width = Math.min(container.clientWidth - 40, 580);
        }

        function createAgent() {
            return {
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                vx: (Math.random() - 0.5) * 2,
                vy: (Math.random() - 0.5) * 2,
                state: STATES.NAIVE,
                infectedTime: 0,
                isSkeptical: Math.random() < skepticism
            };
        }

        function initAgents() {
            agents = [];
            for (let i = 0; i < population; i++) {
                agents.push(createAgent());
            }

            // Create initial spreaders
            for (let i = 0; i < initialSpreaders && i < agents.length; i++) {
                agents[i].state = STATES.SPREADER;
                agents[i].infectedTime = 0;
            }
        }

        function update() {
            time++;

            // Move agents
            for (const agent of agents) {
                agent.vx += (Math.random() - 0.5) * 0.3;
                agent.vy += (Math.random() - 0.5) * 0.3;

                // Speed limit
                const speed = Math.sqrt(agent.vx ** 2 + agent.vy ** 2);
                if (speed > 2) {
                    agent.vx *= 2 / speed;
                    agent.vy *= 2 / speed;
                }

                agent.x += agent.vx;
                agent.y += agent.vy;

                // Bounce
                if (agent.x < 0 || agent.x > canvas.width) agent.vx *= -1;
                if (agent.y < 0 || agent.y > canvas.height) agent.vy *= -1;
                agent.x = Math.max(0, Math.min(canvas.width, agent.x));
                agent.y = Math.max(0, Math.min(canvas.height, agent.y));
            }

            // Spread and fact-check
            for (const agent of agents) {
                if (agent.state === STATES.SPREADER) {
                    agent.infectedTime++;

                    // Try to spread to nearby naive agents
                    for (const other of agents) {
                        if (other.state !== STATES.NAIVE) continue;

                        const dx = other.x - agent.x;
                        const dy = other.y - agent.y;
                        const dist = Math.sqrt(dx * dx + dy * dy);

                        if (dist < 30 && Math.random() < spreadProb) {
                            if (other.isSkeptical) {
                                other.state = STATES.SKEPTICAL;
                            } else {
                                other.state = STATES.SPREADER;
                                other.infectedTime = 0;
                            }
                        }
                    }

                    // Fact-check recovery
                    if (agent.infectedTime > factCheckDelay && Math.random() < recoveryRate) {
                        agent.state = STATES.FACT_CHECKED;
                    }
                }
            }

            // Count states
            const counts = {
                naive: 0,
                spreader: 0,
                skeptical: 0,
                factChecked: 0
            };

            for (const agent of agents) {
                counts[agent.state]++;
            }

            peakSpreaders = Math.max(peakSpreaders, counts.spreader);

            // Record history
            history.naive.push(counts.naive);
            history.spreaders.push(counts.spreader);
            history.skeptical.push(counts.skeptical);
            history.factChecked.push(counts.factChecked);

            const maxHistory = 300;
            if (history.naive.length > maxHistory) {
                history.naive.shift();
                history.spreaders.shift();
                history.skeptical.shift();
                history.factChecked.shift();
            }
        }

        function draw() {
            ctx.fillStyle = '#0a0a1a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw agents
            for (const agent of agents) {
                ctx.beginPath();
                ctx.arc(agent.x, agent.y, 5, 0, Math.PI * 2);
                ctx.fillStyle = COLORS[agent.state];
                ctx.fill();

                // Spreaders have a glow
                if (agent.state === STATES.SPREADER) {
                    ctx.beginPath();
                    ctx.arc(agent.x, agent.y, 15, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(255, 107, 107, 0.2)';
                    ctx.fill();
                }
            }
        }

        function drawChart() {
            chartCtx.fillStyle = '#0a0a1a';
            chartCtx.fillRect(0, 0, chartCanvas.width, chartCanvas.height);

            if (history.naive.length < 2) return;

            const w = chartCanvas.width;
            const h = chartCanvas.height - 20;
            const len = history.naive.length;

            // Draw stacked area chart
            const datasets = [
                { data: history.factChecked, color: COLORS.factChecked },
                { data: history.skeptical, color: COLORS.skeptical },
                { data: history.spreaders, color: COLORS.spreader },
                { data: history.naive, color: COLORS.naive }
            ];

            // Stacked from bottom
            for (let d = 0; d < datasets.length; d++) {
                chartCtx.fillStyle = datasets[d].color + '88';
                chartCtx.beginPath();
                chartCtx.moveTo(0, h);

                for (let i = 0; i < len; i++) {
                    const x = (i / (len - 1)) * w;
                    let y = 0;
                    for (let j = d; j < datasets.length; j++) {
                        y += datasets[j].data[i] / population;
                    }
                    chartCtx.lineTo(x, h - y * h);
                }

                chartCtx.lineTo(w, h);
                chartCtx.closePath();
                chartCtx.fill();
            }

            // Labels
            chartCtx.fillStyle = '#888';
            chartCtx.font = '10px sans-serif';
            chartCtx.fillText('Time ‚Üí', w - 40, h + 15);
            chartCtx.fillText('Population %', 5, 12);
        }

        function updateStats() {
            const counts = { naive: 0, spreader: 0, skeptical: 0, factChecked: 0 };
            for (const agent of agents) counts[agent.state]++;

            document.getElementById('naive').textContent = counts.naive;
            document.getElementById('spreaders').textContent = counts.spreader;
            document.getElementById('skeptical').textContent = counts.skeptical;
            document.getElementById('factChecked').textContent = counts.factChecked;
            document.getElementById('time').textContent = time;
            document.getElementById('peak').textContent = peakSpreaders;
        }

        function animate() {
            if (running) {
                update();
            }
            draw();
            drawChart();
            updateStats();
            requestAnimationFrame(animate);
        }

        function reset() {
            running = false;
            document.getElementById('startBtn').textContent = 'Start';
            time = 0;
            peakSpreaders = 0;
            history = { naive: [], spreaders: [], skeptical: [], factChecked: [] };

            population = parseInt(document.getElementById('population').value);
            initialSpreaders = parseInt(document.getElementById('initial').value);
            spreadProb = parseInt(document.getElementById('spreadProb').value) / 100;
            skepticism = parseInt(document.getElementById('skepticism').value) / 100;
            factCheckDelay = parseInt(document.getElementById('factCheck').value);
            recoveryRate = parseInt(document.getElementById('recovery').value) / 100;

            initAgents();
        }

        // Setup controls
        document.getElementById('startBtn').addEventListener('click', () => {
            running = !running;
            document.getElementById('startBtn').textContent = running ? 'Pause' : 'Start';
        });

        document.getElementById('stepBtn').addEventListener('click', () => {
            if (!running) update();
        });

        document.getElementById('resetBtn').addEventListener('click', reset);

        document.getElementById('population').addEventListener('input', (e) => {
            document.getElementById('popVal').textContent = e.target.value;
        });

        document.getElementById('initial').addEventListener('input', (e) => {
            document.getElementById('initVal').textContent = e.target.value;
        });

        document.getElementById('spreadProb').addEventListener('input', (e) => {
            document.getElementById('spreadVal').textContent = e.target.value + '%';
        });

        document.getElementById('skepticism').addEventListener('input', (e) => {
            document.getElementById('skeptVal').textContent = e.target.value + '%';
        });

        document.getElementById('factCheck').addEventListener('input', (e) => {
            document.getElementById('factVal').textContent = e.target.value;
        });

        document.getElementById('recovery').addEventListener('input', (e) => {
            document.getElementById('recoverVal').textContent = e.target.value + '%';
        });

        // Initialize
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        reset();

        // Modal functionality
        const modal = document.getElementById('explainModal');
        document.getElementById('explainBtn').addEventListener('click', () => {
            modal.classList.add('active');
        });
        modal.querySelector('.modal-close').addEventListener('click', () => {
            modal.classList.remove('active');
        });
        modal.addEventListener('click', (e) => {
            if (e.target === modal) modal.classList.remove('active');
        });
        animate();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
