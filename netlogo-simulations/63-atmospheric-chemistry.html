<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atmospheric Chemistry - Ozone Layer Dynamics - CCAB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a1628;
            color: #e8e6e1;
            overflow: hidden;
        }
        #container { display: flex; height: 100vh; }
        canvas { display: block; flex: 1; }
        #controls { width: 300px; background: rgba(0,0,0,0.8); padding: 20px; overflow-y: auto; }
        h1 { font-size: 1.2rem; margin-bottom: 15px; color: #38bdf8; }
        .control-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.8rem; margin-bottom: 5px; color: #aaa; }
        input[type="range"] { width: 100%; margin-bottom: 5px; }
        button { width: 100%; padding: 10px; margin-bottom: 10px; background: #38bdf8; color: #0a1628; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        button:hover { background: #0ea5e9; }
        .stats { background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px; font-size: 0.8rem; margin-bottom: 15px; }
        .stats div { margin-bottom: 5px; }
        .back-link { position: fixed; top: 10px; left: 10px; padding: 8px 16px; background: rgba(0,0,0,0.7); color: #38bdf8; text-decoration: none; border-radius: 6px; font-size: 14px; z-index: 999; }
        .description { font-size: 0.75rem; color: #888; margin-bottom: 15px; line-height: 1.5; }
        .legend { font-size: 0.75rem; margin-bottom: 15px; }
        .legend-item { display: flex; align-items: center; margin-bottom: 5px; }
        .legend-color { width: 12px; height: 12px; border-radius: 50%; margin-right: 8px; }
        .reactions { font-size: 0.7rem; color: #666; margin-top: 15px; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 5px; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Gallery</a>
    <div id="container">
        <canvas id="canvas"></canvas>
        <div id="controls">
            <h1>Atmospheric Chemistry</h1>
            <p class="description">Simulates ozone layer chemistry including UV photolysis, ozone formation, and CFC destruction. Watch the Chapman cycle and chlorine catalytic destruction in action.</p>

            <div class="legend">
                <div class="legend-item"><span class="legend-color" style="background: #3b82f6;"></span> O₂ (Oxygen)</div>
                <div class="legend-item"><span class="legend-color" style="background: #ef4444;"></span> O (Atomic Oxygen)</div>
                <div class="legend-item"><span class="legend-color" style="background: #8b5cf6;"></span> O₃ (Ozone)</div>
                <div class="legend-item"><span class="legend-color" style="background: #22c55e;"></span> Cl (Chlorine radical)</div>
                <div class="legend-item"><span class="legend-color" style="background: #f59e0b;"></span> ClO (Chlorine monoxide)</div>
                <div class="legend-item"><span class="legend-color" style="background: #ffff00;"></span> UV Photon</div>
            </div>

            <div class="control-group">
                <label>UV Intensity: <span id="uvValue">1.0</span></label>
                <input type="range" id="uv" min="0.2" max="2.0" step="0.1" value="1.0">
            </div>
            <div class="control-group">
                <label>CFC Emission Rate: <span id="cfcValue">0.0</span></label>
                <input type="range" id="cfc" min="0" max="1.0" step="0.1" value="0">
            </div>
            <div class="control-group">
                <label>Temperature (K): <span id="tempValue">220</span></label>
                <input type="range" id="temp" min="180" max="280" value="220">
            </div>
            <button id="reset">Reset Atmosphere</button>
            <button id="cfcBurst">CFC Burst</button>

            <div class="stats">
                <div>O₂ Molecules: <span id="o2Count">0</span></div>
                <div>O Atoms: <span id="oCount">0</span></div>
                <div>O₃ Molecules: <span id="o3Count">0</span></div>
                <div>Cl Radicals: <span id="clCount">0</span></div>
                <div>ClO Molecules: <span id="cloCount">0</span></div>
                <div>Ozone Layer: <span id="ozoneLayer">0</span>%</div>
                <div>UV Blocked: <span id="uvBlocked">0</span>%</div>
            </div>

            <div class="reactions">
                <strong>Key Reactions:</strong><br>
                O₂ + UV → 2O (photolysis)<br>
                O + O₂ → O₃ (ozone formation)<br>
                O₃ + UV → O₂ + O (ozone photolysis)<br>
                Cl + O₃ → ClO + O₂ (catalytic destruction)<br>
                ClO + O → Cl + O₂ (catalyst regeneration)
            </div>
        </div>
    </div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let width, height;

        let molecules = [];
        let photons = [];
        const maxMolecules = 500;

        let params = {
            uv: 1.0,
            cfc: 0,
            temp: 220
        };

        const types = {
            O2: { color: '#3b82f6', radius: 6, name: 'O₂' },
            O: { color: '#ef4444', radius: 4, name: 'O' },
            O3: { color: '#8b5cf6', radius: 8, name: 'O₃' },
            Cl: { color: '#22c55e', radius: 5, name: 'Cl' },
            ClO: { color: '#f59e0b', radius: 6, name: 'ClO' }
        };

        function resize() {
            canvas.width = canvas.clientWidth;
            canvas.height = canvas.clientHeight;
            width = canvas.width;
            height = canvas.height;
        }

        function createMolecule(type, x, y) {
            const speed = (params.temp / 220) * 1.5;
            return {
                type,
                x: x !== undefined ? x : Math.random() * width,
                y: y !== undefined ? y : Math.random() * height,
                vx: (Math.random() - 0.5) * speed,
                vy: (Math.random() - 0.5) * speed
            };
        }

        function createPhoton() {
            return {
                x: Math.random() * width,
                y: 0,
                vy: 3 + Math.random() * 2
            };
        }

        function init() {
            molecules = [];
            photons = [];

            // Initial atmosphere: mostly O2
            for (let i = 0; i < 150; i++) {
                molecules.push(createMolecule('O2'));
            }
            // Some initial O3
            for (let i = 0; i < 30; i++) {
                molecules.push(createMolecule('O3'));
            }
        }

        function countMolecules(type) {
            return molecules.filter(m => m.type === type).length;
        }

        function update() {
            // Generate UV photons
            if (Math.random() < 0.3 * params.uv) {
                photons.push(createPhoton());
            }

            // Generate CFCs (which release Cl)
            if (Math.random() < 0.02 * params.cfc && countMolecules('Cl') + countMolecules('ClO') < 50) {
                molecules.push(createMolecule('Cl', Math.random() * width, height * 0.8));
            }

            // Update photons
            for (let i = photons.length - 1; i >= 0; i--) {
                const p = photons[i];
                p.y += p.vy;

                // Check for absorption by O3 (blocks UV)
                let absorbed = false;
                for (let m of molecules) {
                    if (m.type === 'O3') {
                        const dx = p.x - m.x;
                        const dy = p.y - m.y;
                        if (dx * dx + dy * dy < 400) {
                            // O3 + UV -> O2 + O
                            if (Math.random() < 0.1) {
                                m.type = 'O2';
                                if (molecules.length < maxMolecules) {
                                    molecules.push(createMolecule('O', m.x, m.y));
                                }
                            }
                            absorbed = true;
                            break;
                        }
                    }
                }

                if (absorbed || p.y > height) {
                    photons.splice(i, 1);
                    continue;
                }

                // O2 + UV -> 2O (in upper atmosphere)
                if (p.y < height * 0.4) {
                    for (let m of molecules) {
                        if (m.type === 'O2') {
                            const dx = p.x - m.x;
                            const dy = p.y - m.y;
                            if (dx * dx + dy * dy < 300 && Math.random() < 0.05) {
                                m.type = 'O';
                                if (molecules.length < maxMolecules) {
                                    molecules.push(createMolecule('O', m.x + 10, m.y));
                                }
                                photons.splice(i, 1);
                                break;
                            }
                        }
                    }
                }
            }

            // Update molecules
            const speed = (params.temp / 220) * 1.5;

            for (let m of molecules) {
                // Brownian motion
                m.vx += (Math.random() - 0.5) * 0.3 * speed;
                m.vy += (Math.random() - 0.5) * 0.3 * speed;

                // Speed limit
                const s = Math.sqrt(m.vx * m.vx + m.vy * m.vy);
                if (s > speed * 3) {
                    m.vx = (m.vx / s) * speed * 3;
                    m.vy = (m.vy / s) * speed * 3;
                }

                m.x += m.vx;
                m.y += m.vy;

                // Boundaries
                if (m.x < 0 || m.x > width) m.vx *= -1;
                if (m.y < 0 || m.y > height) m.vy *= -1;
                m.x = Math.max(0, Math.min(width, m.x));
                m.y = Math.max(0, Math.min(height, m.y));
            }

            // Chemical reactions
            for (let i = 0; i < molecules.length; i++) {
                const a = molecules[i];

                for (let j = i + 1; j < molecules.length; j++) {
                    const b = molecules[j];
                    const dx = b.x - a.x;
                    const dy = b.y - a.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);

                    if (dist > 20) continue;

                    // O + O2 -> O3 (ozone formation)
                    if ((a.type === 'O' && b.type === 'O2') || (a.type === 'O2' && b.type === 'O')) {
                        if (Math.random() < 0.1) {
                            const oAtom = a.type === 'O' ? a : b;
                            const o2Mol = a.type === 'O2' ? a : b;
                            o2Mol.type = 'O3';
                            molecules.splice(molecules.indexOf(oAtom), 1);
                            j--;
                        }
                    }

                    // Cl + O3 -> ClO + O2 (catalytic destruction)
                    if ((a.type === 'Cl' && b.type === 'O3') || (a.type === 'O3' && b.type === 'Cl')) {
                        if (Math.random() < 0.3) {
                            const cl = a.type === 'Cl' ? a : b;
                            const o3 = a.type === 'O3' ? a : b;
                            cl.type = 'ClO';
                            o3.type = 'O2';
                        }
                    }

                    // ClO + O -> Cl + O2 (catalyst regeneration)
                    if ((a.type === 'ClO' && b.type === 'O') || (a.type === 'O' && b.type === 'ClO')) {
                        if (Math.random() < 0.3) {
                            const clo = a.type === 'ClO' ? a : b;
                            const o = a.type === 'O' ? a : b;
                            clo.type = 'Cl';
                            o.type = 'O2';
                        }
                    }

                    // O + O -> O2 (recombination)
                    if (a.type === 'O' && b.type === 'O') {
                        if (Math.random() < 0.05) {
                            a.type = 'O2';
                            molecules.splice(j, 1);
                            j--;
                        }
                    }
                }
            }
        }

        function draw() {
            // Sky gradient
            const gradient = ctx.createLinearGradient(0, 0, 0, height);
            gradient.addColorStop(0, '#000814');
            gradient.addColorStop(0.3, '#001d3d');
            gradient.addColorStop(0.6, '#003566');
            gradient.addColorStop(1, '#0077b6');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, width, height);

            // Altitude markers
            ctx.font = '10px sans-serif';
            ctx.fillStyle = 'rgba(255,255,255,0.3)';
            ctx.textAlign = 'right';
            ctx.fillText('50 km (Stratopause)', width - 10, height * 0.1);
            ctx.fillText('30 km (Ozone Layer)', width - 10, height * 0.35);
            ctx.fillText('10 km (Tropopause)', width - 10, height * 0.7);
            ctx.fillText('Ground', width - 10, height - 10);

            // Draw ozone layer indicator
            const o3Count = countMolecules('O3');
            const ozoneOpacity = Math.min(0.3, o3Count / 100);
            ctx.fillStyle = `rgba(139, 92, 246, ${ozoneOpacity})`;
            ctx.fillRect(0, height * 0.2, width, height * 0.3);

            // Draw UV photons
            for (let p of photons) {
                ctx.fillStyle = '#ffff00';
                ctx.globalAlpha = 0.8;
                ctx.beginPath();
                ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
                ctx.fill();

                // UV trail
                ctx.strokeStyle = '#ffff00';
                ctx.lineWidth = 1;
                ctx.globalAlpha = 0.3;
                ctx.beginPath();
                ctx.moveTo(p.x, p.y);
                ctx.lineTo(p.x, p.y - 20);
                ctx.stroke();
                ctx.globalAlpha = 1;
            }

            // Draw molecules
            for (let m of molecules) {
                const t = types[m.type];

                // Glow
                ctx.fillStyle = t.color;
                ctx.globalAlpha = 0.2;
                ctx.beginPath();
                ctx.arc(m.x, m.y, t.radius * 2, 0, Math.PI * 2);
                ctx.fill();
                ctx.globalAlpha = 1;

                // Body
                ctx.fillStyle = t.color;
                ctx.beginPath();
                ctx.arc(m.x, m.y, t.radius, 0, Math.PI * 2);
                ctx.fill();

                // Highlight
                ctx.fillStyle = 'rgba(255,255,255,0.3)';
                ctx.beginPath();
                ctx.arc(m.x - t.radius * 0.3, m.y - t.radius * 0.3, t.radius * 0.4, 0, Math.PI * 2);
                ctx.fill();
            }

            // Update stats
            const o2Count = countMolecules('O2');
            const oCount = countMolecules('O');
            const clCount = countMolecules('Cl');
            const cloCount = countMolecules('ClO');

            document.getElementById('o2Count').textContent = o2Count;
            document.getElementById('oCount').textContent = oCount;
            document.getElementById('o3Count').textContent = o3Count;
            document.getElementById('clCount').textContent = clCount;
            document.getElementById('cloCount').textContent = cloCount;

            const ozonePercent = Math.min(100, (o3Count / 50) * 100);
            document.getElementById('ozoneLayer').textContent = ozonePercent.toFixed(0);
            document.getElementById('uvBlocked').textContent = Math.min(100, ozonePercent * 0.9).toFixed(0);
        }

        function animate() {
            update();
            draw();
            requestAnimationFrame(animate);
        }

        // Event listeners
        document.getElementById('uv').addEventListener('input', e => {
            params.uv = parseFloat(e.target.value);
            document.getElementById('uvValue').textContent = params.uv.toFixed(1);
        });
        document.getElementById('cfc').addEventListener('input', e => {
            params.cfc = parseFloat(e.target.value);
            document.getElementById('cfcValue').textContent = params.cfc.toFixed(1);
        });
        document.getElementById('temp').addEventListener('input', e => {
            params.temp = parseInt(e.target.value);
            document.getElementById('tempValue').textContent = params.temp;
        });

        document.getElementById('reset').addEventListener('click', init);
        document.getElementById('cfcBurst').addEventListener('click', () => {
            for (let i = 0; i < 15; i++) {
                molecules.push(createMolecule('Cl',
                    width * 0.3 + Math.random() * width * 0.4,
                    height * 0.7 + Math.random() * height * 0.2));
            }
        });

        window.addEventListener('resize', resize);
        resize();
        init();
        animate();
    </script>
</body>
</html>
