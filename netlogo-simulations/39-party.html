<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Party Simulation - CCAB</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            font-family: 'Segoe UI', Arial, sans-serif;
            color: white;
        }
        .container { display: flex; height: 100vh; }
        .canvas-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            gap: 10px;
        }
        canvas { border: 2px solid rgba(255, 255, 255, 0.2); border-radius: 8px; }
        .controls {
            width: 320px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.6);
            overflow-y: auto;
        }
        h2 { margin: 0 0 15px 0; color: #ffeaa7; }
        h3 { margin: 15px 0 8px 0; color: #fdcb6e; font-size: 14px; }
        .slider-group { margin: 12px 0; }
        .slider-group label { display: block; margin-bottom: 5px; font-size: 13px; }
        input[type="range"] { width: 100%; }
        .stats {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .stat-row { display: flex; justify-content: space-between; margin: 5px 0; font-size: 13px; }
        .description {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            border-radius: 8px;
            font-size: 12px;
            line-height: 1.5;
            margin-top: 15px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            background: #ffeaa7;
            color: #1a1a2e;
            font-weight: bold;
        }
        button:hover { background: #fdcb6e; }
    </style>
</head>
<body>
    <a href="index.html" class="organic-back-link" style="position: fixed; top: 20px; right: 20px; z-index: 1000; display: flex; align-items: center; gap: 8px; padding: 10px 16px; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); border-radius: 30px; text-decoration: none; color: #606C38; font-family: 'Nunito', sans-serif; font-weight: 600;">
        <span>‚Üê Gallery</span>
    </a>
    <div class="container">
        <div class="canvas-area">
            <canvas id="partyCanvas"></canvas>
            <canvas id="graphCanvas"></canvas>
        </div>
        <div class="controls">
            <h2>üéâ Party Simulation</h2>
            <p style="font-size: 12px; opacity: 0.8;">Social clustering by similarity</p>

            <h3>Number of Guests</h3>
            <div class="slider-group">
                <label>Guests: <span id="guestsVal">50</span></label>
                <input type="range" id="guests" min="10" max="100" step="5" value="50">
            </div>

            <h3>Similarity Threshold</h3>
            <div class="slider-group">
                <label>Threshold: <span id="thresholdVal">0.5</span></label>
                <input type="range" id="threshold" min="0.1" max="0.9" step="0.1" value="0.5">
            </div>

            <h3>Number of Traits</h3>
            <div class="slider-group">
                <label>Traits: <span id="traitsVal">3</span></label>
                <input type="range" id="traits" min="1" max="5" step="1" value="3">
            </div>

            <h3>Social Anxiety</h3>
            <div class="slider-group">
                <label>Anxiety: <span id="anxietyVal">0.3</span></label>
                <input type="range" id="anxiety" min="0" max="1" step="0.1" value="0.3">
            </div>

            <h3>Speed</h3>
            <div class="slider-group">
                <label>Delay: <span id="speedVal">30</span>ms</label>
                <input type="range" id="speed" min="10" max="100" step="10" value="30">
            </div>

            <button onclick="reset()">Reset</button>
            <button onclick="togglePause()" id="pauseBtn">Pause</button>
            <button onclick="addGuest()">Add Guest</button>

            <div class="stats">
                <div class="stat-row"><span>Time:</span><span id="time">0</span></div>
                <div class="stat-row"><span>Conversations:</span><span id="conversations">0</span></div>
                <div class="stat-row"><span>Clusters:</span><span id="clusters">0</span></div>
                <div class="stat-row"><span>Lonely Guests:</span><span id="lonely">0</span></div>
                <div class="stat-row"><span>Avg Group Size:</span><span id="avgGroup">0</span></div>
                <div class="stat-row"><span>Happiness:</span><span id="happiness">0%</span></div>
            </div>

            <div class="description">
                <strong>Homophily:</strong><br>
                "Birds of a feather flock together" - people cluster with similar others.<br><br>
                <strong>Traits:</strong><br>
                Each guest has random trait values. They seek others with matching traits.<br><br>
                <strong>Dynamics:</strong><br>
                ‚Ä¢ Move toward similar guests<br>
                ‚Ä¢ Move away if too different<br>
                ‚Ä¢ Form conversational clusters<br>
                ‚Ä¢ High anxiety = more wandering
            </div>
        </div>
    </div>

    <script>
        const partyCanvas = document.getElementById('partyCanvas');
        const partyCtx = partyCanvas.getContext('2d');
        const graphCanvas = document.getElementById('graphCanvas');
        const graphCtx = graphCanvas.getContext('2d');

        partyCanvas.width = 600;
        partyCanvas.height = 450;
        graphCanvas.width = 600;
        graphCanvas.height = 100;

        let guests = [];
        let numGuests = 50;
        let similarityThreshold = 0.5;
        let numTraits = 3;
        let anxiety = 0.3;
        let speed = 30;
        let time = 0;
        let paused = false;
        let animationId = null;
        let history = { clusters: [], lonely: [], happiness: [] };

        function similarity(a, b) {
            let same = 0;
            for (let i = 0; i < numTraits; i++) {
                same += 1 - Math.abs(a.traits[i] - b.traits[i]);
            }
            return same / numTraits;
        }

        function getColor(traits) {
            const r = Math.floor(traits[0] * 255);
            const g = Math.floor((traits[1] || traits[0]) * 255);
            const b = Math.floor((traits[2] || traits[0]) * 255);
            return `rgb(${r}, ${g}, ${b})`;
        }

        function createGuests() {
            guests = [];
            for (let i = 0; i < numGuests; i++) {
                const traits = [];
                for (let t = 0; t < numTraits; t++) {
                    traits.push(Math.random());
                }
                guests.push({
                    x: 50 + Math.random() * (partyCanvas.width - 100),
                    y: 50 + Math.random() * (partyCanvas.height - 100),
                    vx: 0,
                    vy: 0,
                    traits,
                    talking: false,
                    partner: null,
                    happiness: 0.5
                });
            }
        }

        function reset() {
            if (animationId) clearTimeout(animationId);
            numGuests = parseInt(document.getElementById('guests').value);
            similarityThreshold = parseFloat(document.getElementById('threshold').value);
            numTraits = parseInt(document.getElementById('traits').value);
            anxiety = parseFloat(document.getElementById('anxiety').value);
            speed = parseInt(document.getElementById('speed').value);

            time = 0;
            history = { clusters: [], lonely: [], happiness: [] };
            paused = false;
            document.getElementById('pauseBtn').textContent = 'Pause';

            createGuests();
            updateStats();
            draw();
            animate();
        }

        function addGuest() {
            const traits = [];
            for (let t = 0; t < numTraits; t++) {
                traits.push(Math.random());
            }
            guests.push({
                x: Math.random() * partyCanvas.width,
                y: Math.random() * partyCanvas.height,
                vx: 0,
                vy: 0,
                traits,
                talking: false,
                partner: null,
                happiness: 0.5
            });
        }

        function step() {
            // Reset talking state
            for (const g of guests) {
                g.talking = false;
                g.partner = null;
            }

            // Calculate forces and interactions
            for (let i = 0; i < guests.length; i++) {
                const g = guests[i];
                let fx = 0, fy = 0;
                let closestSimilar = null;
                let closestDist = Infinity;

                for (let j = 0; j < guests.length; j++) {
                    if (i === j) continue;
                    const other = guests[j];
                    const dx = other.x - g.x;
                    const dy = other.y - g.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);

                    if (dist < 1) continue;

                    const sim = similarity(g, other);

                    if (sim >= similarityThreshold) {
                        // Attract to similar
                        const force = 0.5 * sim / dist;
                        fx += dx * force;
                        fy += dy * force;

                        if (dist < closestDist && dist < 50) {
                            closestDist = dist;
                            closestSimilar = other;
                        }
                    } else {
                        // Repel from different (but not too strongly)
                        const force = 0.1 * (1 - sim) / (dist * dist);
                        fx -= dx * force;
                        fy -= dy * force;
                    }

                    // General collision avoidance
                    if (dist < 20) {
                        fx -= dx * 0.5;
                        fy -= dy * 0.5;
                    }
                }

                // Mark as talking if close to similar guest
                if (closestSimilar && closestDist < 30) {
                    g.talking = true;
                    g.partner = closestSimilar;
                    g.happiness = Math.min(1, g.happiness + 0.01);
                } else {
                    g.happiness = Math.max(0, g.happiness - 0.005);
                }

                // Add randomness (anxiety makes you wander more)
                fx += (Math.random() - 0.5) * anxiety * 2;
                fy += (Math.random() - 0.5) * anxiety * 2;

                // Update velocity
                g.vx = g.vx * 0.9 + fx * 0.1;
                g.vy = g.vy * 0.9 + fy * 0.1;

                // Limit speed
                const speed = Math.sqrt(g.vx * g.vx + g.vy * g.vy);
                if (speed > 2) {
                    g.vx = g.vx / speed * 2;
                    g.vy = g.vy / speed * 2;
                }
            }

            // Move guests
            for (const g of guests) {
                g.x += g.vx;
                g.y += g.vy;

                // Keep in bounds
                g.x = Math.max(20, Math.min(partyCanvas.width - 20, g.x));
                g.y = Math.max(20, Math.min(partyCanvas.height - 20, g.y));
            }

            time++;

            // Record history
            const stats = calculateStats();
            history.clusters.push(stats.clusters);
            history.lonely.push(stats.lonely);
            history.happiness.push(stats.happiness);

            if (history.clusters.length > 200) {
                history.clusters.shift();
                history.lonely.shift();
                history.happiness.shift();
            }
        }

        function calculateStats() {
            // Count clusters using simple distance-based grouping
            const visited = new Set();
            let clusters = 0;
            let lonely = 0;
            let totalHappiness = 0;
            let conversations = 0;

            for (let i = 0; i < guests.length; i++) {
                totalHappiness += guests[i].happiness;
                if (guests[i].talking) conversations++;

                if (visited.has(i)) continue;

                // BFS to find cluster
                const queue = [i];
                const cluster = [];
                visited.add(i);

                while (queue.length > 0) {
                    const idx = queue.shift();
                    cluster.push(idx);

                    for (let j = 0; j < guests.length; j++) {
                        if (visited.has(j)) continue;
                        const dist = Math.hypot(guests[idx].x - guests[j].x, guests[idx].y - guests[j].y);
                        const sim = similarity(guests[idx], guests[j]);
                        if (dist < 40 && sim >= similarityThreshold) {
                            visited.add(j);
                            queue.push(j);
                        }
                    }
                }

                if (cluster.length === 1) {
                    lonely++;
                } else {
                    clusters++;
                }
            }

            return {
                clusters,
                lonely,
                conversations: Math.floor(conversations / 2),
                avgGroup: clusters > 0 ? ((guests.length - lonely) / clusters).toFixed(1) : 0,
                happiness: totalHappiness / guests.length
            };
        }

        function updateStats() {
            const stats = calculateStats();
            document.getElementById('time').textContent = time;
            document.getElementById('conversations').textContent = stats.conversations;
            document.getElementById('clusters').textContent = stats.clusters;
            document.getElementById('lonely').textContent = stats.lonely;
            document.getElementById('avgGroup').textContent = stats.avgGroup;
            document.getElementById('happiness').textContent = (stats.happiness * 100).toFixed(0) + '%';
        }

        function draw() {
            // Party room
            partyCtx.fillStyle = '#2d2d44';
            partyCtx.fillRect(0, 0, partyCanvas.width, partyCanvas.height);

            // Draw conversation lines
            partyCtx.strokeStyle = 'rgba(255, 234, 167, 0.3)';
            partyCtx.lineWidth = 2;
            for (const g of guests) {
                if (g.talking && g.partner) {
                    partyCtx.beginPath();
                    partyCtx.moveTo(g.x, g.y);
                    partyCtx.lineTo(g.partner.x, g.partner.y);
                    partyCtx.stroke();
                }
            }

            // Draw guests
            for (const g of guests) {
                // Outer ring based on happiness
                partyCtx.strokeStyle = `rgba(255, 255, 255, ${g.happiness * 0.5})`;
                partyCtx.lineWidth = 3;
                partyCtx.beginPath();
                partyCtx.arc(g.x, g.y, 12, 0, Math.PI * 2);
                partyCtx.stroke();

                // Guest body
                partyCtx.fillStyle = getColor(g.traits);
                partyCtx.beginPath();
                partyCtx.arc(g.x, g.y, 10, 0, Math.PI * 2);
                partyCtx.fill();

                // Talking indicator
                if (g.talking) {
                    partyCtx.fillStyle = '#ffeaa7';
                    partyCtx.beginPath();
                    partyCtx.arc(g.x, g.y - 15, 3, 0, Math.PI * 2);
                    partyCtx.fill();
                }
            }

            // Graph
            graphCtx.fillStyle = '#1a1a2e';
            graphCtx.fillRect(0, 0, graphCanvas.width, graphCanvas.height);

            if (history.happiness.length > 1) {
                // Happiness
                graphCtx.strokeStyle = '#ffeaa7';
                graphCtx.lineWidth = 2;
                graphCtx.beginPath();
                for (let i = 0; i < history.happiness.length; i++) {
                    const x = (i / (history.happiness.length - 1)) * graphCanvas.width;
                    const y = graphCanvas.height - 10 - history.happiness[i] * (graphCanvas.height - 20);
                    if (i === 0) graphCtx.moveTo(x, y);
                    else graphCtx.lineTo(x, y);
                }
                graphCtx.stroke();

                // Lonely (normalized)
                graphCtx.strokeStyle = '#e17055';
                graphCtx.beginPath();
                for (let i = 0; i < history.lonely.length; i++) {
                    const x = (i / (history.lonely.length - 1)) * graphCanvas.width;
                    const y = graphCanvas.height - 10 - (history.lonely[i] / numGuests) * (graphCanvas.height - 20);
                    if (i === 0) graphCtx.moveTo(x, y);
                    else graphCtx.lineTo(x, y);
                }
                graphCtx.stroke();
            }

            graphCtx.fillStyle = '#ffeaa7';
            graphCtx.font = '10px Arial';
            graphCtx.fillText('Happiness', 5, 12);
            graphCtx.fillStyle = '#e17055';
            graphCtx.fillText('Lonely %', 70, 12);
        }

        function animate() {
            if (!paused) {
                step();
                updateStats();
            }
            draw();
            animationId = setTimeout(animate, speed);
        }

        function togglePause() {
            paused = !paused;
            document.getElementById('pauseBtn').textContent = paused ? 'Resume' : 'Pause';
        }

        // Event listeners
        document.getElementById('guests').oninput = function() {
            document.getElementById('guestsVal').textContent = this.value;
        };
        document.getElementById('threshold').oninput = function() {
            similarityThreshold = parseFloat(this.value);
            document.getElementById('thresholdVal').textContent = similarityThreshold.toFixed(1);
        };
        document.getElementById('traits').oninput = function() {
            document.getElementById('traitsVal').textContent = this.value;
        };
        document.getElementById('anxiety').oninput = function() {
            anxiety = parseFloat(this.value);
            document.getElementById('anxietyVal').textContent = anxiety.toFixed(1);
        };
        document.getElementById('speed').oninput = function() {
            speed = parseInt(this.value);
            document.getElementById('speedVal').textContent = speed;
        };

        reset();
    </script>
</body>
</html>
