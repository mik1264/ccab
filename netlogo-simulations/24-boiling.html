<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boiling - Phase Transition - CCAB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0a1628; color: #e8e6e1; overflow: hidden; }
        #container { display: flex; height: 100vh; }
        #canvas-container { flex: 1; position: relative; }
        canvas { display: block; width: 100%; height: 100%; }
        #controls { width: 280px; background: rgba(0,0,0,0.9); padding: 20px; overflow-y: auto; }
        h1 { font-size: 1.1rem; margin-bottom: 15px; color: #ef4444; }
        .control-group { margin-bottom: 12px; }
        label { display: block; font-size: 0.75rem; margin-bottom: 3px; color: #aaa; }
        input[type="range"] { width: 100%; }
        button { width: 100%; padding: 8px; margin-bottom: 8px; background: #dc2626; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 0.85rem; }
        button:hover { background: #b91c1c; }
        .stats { background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px; font-size: 0.75rem; margin-bottom: 15px; }
        .stats div { margin-bottom: 3px; }
        .back-link { position: fixed; top: 10px; left: 10px; padding: 8px 16px; background: rgba(0,0,0,0.7); color: #ef4444; text-decoration: none; border-radius: 6px; font-size: 14px; z-index: 999; }
        .description { font-size: 0.7rem; color: #888; margin-bottom: 12px; line-height: 1.4; }
        .temp-bar { height: 20px; background: linear-gradient(to right, #3b82f6, #22c55e, #eab308, #ef4444); border-radius: 4px; position: relative; margin: 10px 0; }
        .temp-marker { position: absolute; top: -5px; width: 4px; height: 30px; background: white; border-radius: 2px; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back</a>
    <div id="container">
        <div id="canvas-container">
            <canvas id="canvas"></canvas>
        </div>
        <div id="controls">
            <h1>Boiling Simulation</h1>
            <p class="description">Watch water molecules undergo phase transition from liquid to gas. Heat rises from the bottom, causing bubble nucleation and evaporation.</p>
            
            <div class="control-group">
                <label>Particles: <span id="particlesVal">300</span></label>
                <input type="range" id="particles" min="100" max="500" value="300">
            </div>
            <div class="control-group">
                <label>Heat Intensity: <span id="heatVal">50</span>%</label>
                <input type="range" id="heat" min="0" max="100" value="50">
            </div>
            <div class="control-group">
                <label>Boiling Point: <span id="boilVal">100</span>°C</label>
                <input type="range" id="boil" min="80" max="120" value="100">
            </div>
            <div class="control-group">
                <label>Latent Heat Factor: <span id="latentVal">1.0</span></label>
                <input type="range" id="latent" min="0.5" max="2" step="0.1" value="1">
            </div>
            
            <div class="temp-bar">
                <div id="tempMarker" class="temp-marker" style="left: 25%;"></div>
            </div>
            
            <button id="reset">Reset</button>
            <button id="pause">Pause</button>
            <button id="maxHeat">Maximum Heat</button>
            <button id="coolDown">Cool Down</button>
            
            <div class="stats">
                <div>Average Temp: <span id="avgTemp">25</span>°C</div>
                <div>Liquid Particles: <span id="liquidCount">300</span></div>
                <div>Gas Particles: <span id="gasCount">0</span></div>
                <div>Bubbles Active: <span id="bubbleCount">0</span></div>
                <div>Evaporated: <span id="evaporated">0</span></div>
            </div>
            
            <p class="description"><strong>Physics:</strong> Particles gain kinetic energy from heat. At boiling point, bubbles nucleate and particles transition to gas phase, absorbing latent heat.</p>
        </div>
    </div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        let W, H, particles = [], bubbles = [], paused = false;
        let evaporatedCount = 0;
        
        let params = {
            particleCount: 300,
            heatIntensity: 50,
            boilingPoint: 100,
            latentHeat: 1.0
        };
        
        function resize() {
            const c = document.getElementById('canvas-container');
            canvas.width = c.clientWidth;
            canvas.height = c.clientHeight;
            W = canvas.width;
            H = canvas.height;
        }
        
        class Particle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 2;
                this.vy = (Math.random() - 0.5) * 2;
                this.temp = 25; // Starting room temperature
                this.isGas = false;
                this.radius = 4;
            }
            
            update() {
                // Heat transfer from bottom
                const heatSource = 1 - (this.y / H);
                const heatGain = (params.heatIntensity / 100) * heatSource * 0.5;
                
                // Cooling from top (convection)
                const cooling = (this.y / H) * 0.1;
                
                this.temp += heatGain - cooling;
                this.temp = Math.max(20, Math.min(150, this.temp));
                
                // Phase transition
                if (!this.isGas && this.temp >= params.boilingPoint) {
                    // Probability of phase change based on latent heat
                    if (Math.random() < 0.02 / params.latentHeat) {
                        this.isGas = true;
                        this.radius = 3;
                        // Absorb latent heat
                        this.temp -= 10 * params.latentHeat;
                    }
                }
                
                // Movement based on phase
                if (this.isGas) {
                    // Gas rises quickly
                    this.vy -= 0.15;
                    this.vx += (Math.random() - 0.5) * 0.5;
                    
                    // Check if escaped
                    if (this.y < 0) {
                        evaporatedCount++;
                        this.respawn();
                    }
                } else {
                    // Liquid: thermal motion
                    const thermalVelocity = Math.sqrt(this.temp / 50);
                    this.vx += (Math.random() - 0.5) * thermalVelocity * 0.3;
                    this.vy += (Math.random() - 0.5) * thermalVelocity * 0.3;
                    
                    // Buoyancy (hot particles rise slightly)
                    this.vy -= (this.temp - 50) * 0.001;
                    
                    // Gravity for liquid
                    this.vy += 0.05;
                }
                
                // Damping
                this.vx *= 0.98;
                this.vy *= 0.98;
                
                // Update position
                this.x += this.vx;
                this.y += this.vy;
                
                // Boundaries
                if (this.x < this.radius) { this.x = this.radius; this.vx *= -0.5; }
                if (this.x > W - this.radius) { this.x = W - this.radius; this.vx *= -0.5; }
                if (this.y > H - this.radius) { this.y = H - this.radius; this.vy *= -0.5; }
                if (!this.isGas && this.y < 50) { this.y = 50; this.vy *= -0.5; }
            }
            
            respawn() {
                // Respawn as liquid at bottom (condensation cycle)
                this.x = Math.random() * W;
                this.y = H - 20 - Math.random() * 50;
                this.vx = (Math.random() - 0.5) * 2;
                this.vy = (Math.random() - 0.5) * 2;
                this.temp = 25;
                this.isGas = false;
                this.radius = 4;
            }
            
            draw() {
                // Color based on temperature
                const t = (this.temp - 20) / 130; // Normalize 20-150
                let r, g, b;
                
                if (t < 0.5) {
                    // Blue to cyan
                    r = 50;
                    g = 100 + t * 200;
                    b = 255;
                } else {
                    // Cyan to red
                    r = (t - 0.5) * 2 * 255;
                    g = 200 - (t - 0.5) * 2 * 150;
                    b = 255 - (t - 0.5) * 2 * 200;
                }
                
                const alpha = this.isGas ? 0.5 : 0.8;
                ctx.fillStyle = `rgba(${r|0}, ${g|0}, ${b|0}, ${alpha})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();
            }
        }
        
        class Bubble {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.radius = 5 + Math.random() * 10;
                this.vy = -1 - Math.random() * 2;
                this.wobble = Math.random() * Math.PI * 2;
            }
            
            update() {
                this.y += this.vy;
                this.wobble += 0.1;
                this.x += Math.sin(this.wobble) * 0.5;
                this.radius += 0.05; // Bubbles grow as they rise
                
                return this.y > 50; // Return false if bubble reached surface
            }
            
            draw() {
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.4)';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.stroke();
                
                // Highlight
                ctx.fillStyle = 'rgba(255, 255, 255, 0.2)';
                ctx.beginPath();
                ctx.arc(this.x - this.radius * 0.3, this.y - this.radius * 0.3, this.radius * 0.3, 0, Math.PI * 2);
                ctx.fill();
            }
        }
        
        function init() {
            resize();
            evaporatedCount = 0;
            
            particles = [];
            bubbles = [];
            
            // Create particles distributed in liquid area
            for (let i = 0; i < params.particleCount; i++) {
                particles.push(new Particle(
                    50 + Math.random() * (W - 100),
                    H * 0.3 + Math.random() * (H * 0.65)
                ));
            }
            
            updateStats();
        }
        
        function step() {
            // Update particles
            for (const p of particles) {
                p.update();
            }
            
            // Nucleate bubbles at bottom when hot enough
            const avgBottomTemp = particles
                .filter(p => p.y > H - 100 && !p.isGas)
                .reduce((sum, p, _, arr) => sum + p.temp / arr.length, 0);
            
            if (avgBottomTemp > params.boilingPoint - 10 && Math.random() < 0.05 * (params.heatIntensity / 50)) {
                bubbles.push(new Bubble(
                    50 + Math.random() * (W - 100),
                    H - 20 - Math.random() * 30
                ));
            }
            
            // Update bubbles
            bubbles = bubbles.filter(b => b.update());
            
            // Particle-particle interactions (simplified)
            for (let i = 0; i < particles.length; i++) {
                for (let j = i + 1; j < particles.length; j++) {
                    const p1 = particles[i], p2 = particles[j];
                    if (p1.isGas || p2.isGas) continue;
                    
                    const dx = p2.x - p1.x;
                    const dy = p2.y - p1.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    
                    if (dist < 10 && dist > 0) {
                        // Repulsion
                        const force = (10 - dist) * 0.05;
                        const fx = (dx / dist) * force;
                        const fy = (dy / dist) * force;
                        
                        p1.vx -= fx;
                        p1.vy -= fy;
                        p2.vx += fx;
                        p2.vy += fy;
                        
                        // Heat transfer
                        const tempDiff = (p2.temp - p1.temp) * 0.1;
                        p1.temp += tempDiff;
                        p2.temp -= tempDiff;
                    }
                }
            }
            
            updateStats();
        }
        
        function updateStats() {
            const liquid = particles.filter(p => !p.isGas);
            const gas = particles.filter(p => p.isGas);
            const avgTemp = particles.reduce((sum, p) => sum + p.temp, 0) / particles.length;
            
            document.getElementById('avgTemp').textContent = avgTemp.toFixed(1);
            document.getElementById('liquidCount').textContent = liquid.length;
            document.getElementById('gasCount').textContent = gas.length;
            document.getElementById('bubbleCount').textContent = bubbles.length;
            document.getElementById('evaporated').textContent = evaporatedCount;
            
            // Update temperature marker
            const markerPos = (avgTemp - 20) / 130 * 100;
            document.getElementById('tempMarker').style.left = Math.max(0, Math.min(96, markerPos)) + '%';
        }
        
        function draw() {
            // Background gradient (dark at top, warm at bottom)
            const gradient = ctx.createLinearGradient(0, 0, 0, H);
            gradient.addColorStop(0, '#0a1628');
            gradient.addColorStop(1, '#1a0a0a');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, W, H);
            
            // Heat source at bottom
            const heatGradient = ctx.createLinearGradient(0, H - 50, 0, H);
            heatGradient.addColorStop(0, 'rgba(255, 100, 50, 0)');
            heatGradient.addColorStop(1, `rgba(255, 100, 50, ${params.heatIntensity / 100})`);
            ctx.fillStyle = heatGradient;
            ctx.fillRect(0, H - 50, W, 50);
            
            // Container walls
            ctx.strokeStyle = '#4a5568';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(30, 50);
            ctx.lineTo(30, H - 10);
            ctx.lineTo(W - 30, H - 10);
            ctx.lineTo(W - 30, 50);
            ctx.stroke();
            
            // Draw bubbles
            for (const b of bubbles) {
                b.draw();
            }
            
            // Draw particles
            for (const p of particles) {
                p.draw();
            }
            
            // Steam at top
            if (particles.some(p => p.isGas && p.y < 100)) {
                ctx.fillStyle = 'rgba(200, 200, 255, 0.1)';
                for (let i = 0; i < 5; i++) {
                    ctx.beginPath();
                    ctx.arc(
                        W/2 + Math.sin(Date.now()/1000 + i) * 100,
                        30 + Math.cos(Date.now()/800 + i*2) * 15,
                        20 + Math.sin(Date.now()/500 + i) * 10,
                        0, Math.PI * 2
                    );
                    ctx.fill();
                }
            }
            
            requestAnimationFrame(draw);
        }
        
        let intervalId = null;
        function startSim() {
            if (intervalId) clearInterval(intervalId);
            intervalId = setInterval(() => {
                if (!paused) {
                    for (let i = 0; i < 2; i++) step();
                }
            }, 16);
        }
        
        // Event listeners
        document.getElementById('particles').addEventListener('input', e => {
            params.particleCount = +e.target.value;
            document.getElementById('particlesVal').textContent = params.particleCount;
        });
        document.getElementById('heat').addEventListener('input', e => {
            params.heatIntensity = +e.target.value;
            document.getElementById('heatVal').textContent = params.heatIntensity;
        });
        document.getElementById('boil').addEventListener('input', e => {
            params.boilingPoint = +e.target.value;
            document.getElementById('boilVal').textContent = params.boilingPoint;
        });
        document.getElementById('latent').addEventListener('input', e => {
            params.latentHeat = +e.target.value;
            document.getElementById('latentVal').textContent = params.latentHeat.toFixed(1);
        });
        document.getElementById('reset').addEventListener('click', () => { init(); startSim(); });
        document.getElementById('pause').addEventListener('click', () => {
            paused = !paused;
            document.getElementById('pause').textContent = paused ? 'Resume' : 'Pause';
        });
        document.getElementById('maxHeat').addEventListener('click', () => {
            params.heatIntensity = 100;
            document.getElementById('heat').value = 100;
            document.getElementById('heatVal').textContent = 100;
        });
        document.getElementById('coolDown').addEventListener('click', () => {
            params.heatIntensity = 0;
            document.getElementById('heat').value = 0;
            document.getElementById('heatVal').textContent = 0;
        });
        
        window.addEventListener('resize', resize);
        init();
        draw();
        startSim();
    </script>
</body>
</html>
