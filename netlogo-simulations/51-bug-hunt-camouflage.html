<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bug Hunt Camouflage - NetLogo Simulations</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: #e0e0e0;
        }
        h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .description { text-align: center; max-width: 700px; margin-bottom: 20px; color: #aaa; line-height: 1.5; }
        .container { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; }
        canvas { border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.4); cursor: crosshair; }
        .controls {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            min-width: 240px;
        }
        .control-group { display: flex; flex-direction: column; gap: 5px; }
        label { font-size: 0.85rem; color: #888; }
        input[type="range"] { width: 100%; cursor: pointer; }
        .value { font-size: 0.8rem; color: #2ecc71; }
        button { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: 600; }
        .primary { background: #2ecc71; color: #1a1a2e; }
        .secondary { background: rgba(255,255,255,0.1); color: #e0e0e0; }
        .stats { margin-top: 15px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 5px; font-size: 0.85rem; }
        .stats div { margin: 3px 0; }
        .stat-value { color: #2ecc71; }
        .instruction { font-size: 0.8rem; color: #f39c12; padding: 10px; background: rgba(243,156,18,0.1); border-radius: 5px; }
        a.back-link { position: fixed; top: 20px; left: 20px; color: #2ecc71; text-decoration: none; font-size: 0.9rem; opacity: 0.8; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Gallery</a>
    <h1>Bug Hunt: Camouflage Evolution</h1>
    <p class="description">Click on bugs to "eat" them. Bugs that blend with the background survive and reproduce. Watch camouflage evolve through natural selection!</p>
    <div class="container">
        <canvas id="canvas" width="550" height="500"></canvas>
        <div class="controls">
            <div class="control-group">
                <label>Bug Population: <span id="popVal" class="value">30</span></label>
                <input type="range" id="population" min="10" max="60" value="30">
            </div>
            <div class="control-group">
                <label>Mutation Rate: <span id="mutationVal" class="value">10</span>%</label>
                <input type="range" id="mutation" min="0" max="30" value="10">
            </div>
            <div class="control-group">
                <label>Background Color:</label>
                <input type="range" id="bgHue" min="0" max="360" value="120">
                <input type="range" id="bgSat" min="20" max="80" value="50">
                <input type="range" id="bgLight" min="30" max="70" value="50">
            </div>
            <button class="primary" id="resetBtn">New Generation</button>
            <button class="secondary" id="changeBgBtn">Random Background</button>
            <div class="instruction">Click bugs to eat them. Survivors reproduce!</div>
            <div class="stats">
                <div>Generation: <span id="generation" class="stat-value">0</span></div>
                <div>Bugs Remaining: <span id="remaining" class="stat-value">0</span></div>
                <div>Bugs Eaten: <span id="eaten" class="stat-value">0</span></div>
                <div>Avg Camouflage: <span id="avgCamo" class="stat-value">0</span>%</div>
            </div>
        </div>
    </div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const W = canvas.width, H = canvas.height;

        let bugs = [];
        let generation = 0;
        let eaten = 0;
        let bgColor = { h: 120, s: 50, l: 50 };

        class Bug {
            constructor(h, s, l) {
                this.x = Math.random() * (W - 40) + 20;
                this.y = Math.random() * (H - 40) + 20;
                this.h = h !== undefined ? h : Math.random() * 360;
                this.s = s !== undefined ? s : 30 + Math.random() * 40;
                this.l = l !== undefined ? l : 30 + Math.random() * 40;
                this.size = 12 + Math.random() * 6;
                this.alive = true;
                this.vx = (Math.random() - 0.5) * 0.5;
                this.vy = (Math.random() - 0.5) * 0.5;
            }

            get color() {
                return `hsl(${this.h}, ${this.s}%, ${this.l}%)`;
            }

            camouflageScore() {
                const dh = Math.min(Math.abs(this.h - bgColor.h), 360 - Math.abs(this.h - bgColor.h)) / 180;
                const ds = Math.abs(this.s - bgColor.s) / 50;
                const dl = Math.abs(this.l - bgColor.l) / 50;
                const distance = Math.sqrt(dh * dh + ds * ds + dl * dl);
                return Math.max(0, 100 * (1 - distance / 1.73));
            }

            move() {
                this.vx += (Math.random() - 0.5) * 0.2;
                this.vy += (Math.random() - 0.5) * 0.2;
                this.vx *= 0.95;
                this.vy *= 0.95;
                this.x += this.vx;
                this.y += this.vy;
                if (this.x < 20) { this.x = 20; this.vx *= -1; }
                if (this.x > W - 20) { this.x = W - 20; this.vx *= -1; }
                if (this.y < 20) { this.y = 20; this.vy *= -1; }
                if (this.y > H - 20) { this.y = H - 20; this.vy *= -1; }
            }

            draw() {
                if (!this.alive) return;
                ctx.beginPath();
                ctx.ellipse(this.x, this.y, this.size, this.size * 0.7, 0, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
                ctx.strokeStyle = 'rgba(0,0,0,0.3)';
                ctx.lineWidth = 1;
                ctx.stroke();
                // Antennae
                ctx.beginPath();
                ctx.moveTo(this.x - 3, this.y - this.size * 0.5);
                ctx.lineTo(this.x - 6, this.y - this.size);
                ctx.moveTo(this.x + 3, this.y - this.size * 0.5);
                ctx.lineTo(this.x + 6, this.y - this.size);
                ctx.strokeStyle = this.color;
                ctx.lineWidth = 2;
                ctx.stroke();
            }

            reproduce(mutationRate) {
                let h = this.h, s = this.s, l = this.l;
                if (Math.random() < mutationRate) h = (h + (Math.random() - 0.5) * 60 + 360) % 360;
                if (Math.random() < mutationRate) s = Math.max(20, Math.min(80, s + (Math.random() - 0.5) * 20));
                if (Math.random() < mutationRate) l = Math.max(20, Math.min(80, l + (Math.random() - 0.5) * 20));
                return new Bug(h, s, l);
            }
        }

        function init() {
            const pop = parseInt(document.getElementById('population').value);
            bugs = [];
            for (let i = 0; i < pop; i++) bugs.push(new Bug());
            generation = 0;
            eaten = 0;
            updateBgColor();
            updateStats();
        }

        function updateBgColor() {
            bgColor.h = parseInt(document.getElementById('bgHue').value);
            bgColor.s = parseInt(document.getElementById('bgSat').value);
            bgColor.l = parseInt(document.getElementById('bgLight').value);
        }

        function randomBackground() {
            bgColor.h = Math.random() * 360;
            bgColor.s = 30 + Math.random() * 40;
            bgColor.l = 35 + Math.random() * 30;
            document.getElementById('bgHue').value = bgColor.h;
            document.getElementById('bgSat').value = bgColor.s;
            document.getElementById('bgLight').value = bgColor.l;
        }

        function nextGeneration() {
            const survivors = bugs.filter(b => b.alive);
            if (survivors.length === 0) {
                init();
                return;
            }

            const pop = parseInt(document.getElementById('population').value);
            const mutationRate = parseInt(document.getElementById('mutation').value) / 100;
            
            bugs = [];
            while (bugs.length < pop) {
                const parent = survivors[Math.floor(Math.random() * survivors.length)];
                bugs.push(parent.reproduce(mutationRate));
            }
            generation++;
            eaten = 0;
            updateStats();
        }

        function draw() {
            // Background with noise
            ctx.fillStyle = `hsl(${bgColor.h}, ${bgColor.s}%, ${bgColor.l}%)`;
            ctx.fillRect(0, 0, W, H);
            
            // Add texture
            for (let i = 0; i < 500; i++) {
                const x = Math.random() * W;
                const y = Math.random() * H;
                const shade = bgColor.l + (Math.random() - 0.5) * 15;
                ctx.fillStyle = `hsla(${bgColor.h}, ${bgColor.s}%, ${shade}%, 0.3)`;
                ctx.beginPath();
                ctx.arc(x, y, 2 + Math.random() * 3, 0, Math.PI * 2);
                ctx.fill();
            }

            bugs.forEach(bug => {
                bug.move();
                bug.draw();
            });
        }

        function updateStats() {
            const alive = bugs.filter(b => b.alive);
            const avgCamo = alive.length > 0 
                ? alive.reduce((sum, b) => sum + b.camouflageScore(), 0) / alive.length 
                : 0;

            document.getElementById('generation').textContent = generation;
            document.getElementById('remaining').textContent = alive.length;
            document.getElementById('eaten').textContent = eaten;
            document.getElementById('avgCamo').textContent = avgCamo.toFixed(1);
            document.getElementById('popVal').textContent = document.getElementById('population').value;
            document.getElementById('mutationVal').textContent = document.getElementById('mutation').value;
        }

        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            for (const bug of bugs) {
                if (!bug.alive) continue;
                const dx = x - bug.x;
                const dy = y - bug.y;
                if (dx * dx + dy * dy < bug.size * bug.size * 1.5) {
                    bug.alive = false;
                    eaten++;
                    updateStats();

                    // Check if generation is over
                    const alive = bugs.filter(b => b.alive);
                    if (alive.length <= bugs.length * 0.3) {
                        setTimeout(() => nextGeneration(), 500);
                    }
                    break;
                }
            }
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            nextGeneration();
        });

        document.getElementById('changeBgBtn').addEventListener('click', () => {
            randomBackground();
        });

        ['bgHue', 'bgSat', 'bgLight'].forEach(id => {
            document.getElementById(id).addEventListener('input', updateBgColor);
        });

        function animate() {
            draw();
            updateStats();
            requestAnimationFrame(animate);
        }

        init();
        animate();
    </script>
</body>
</html>
