<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ant Lines - Trail Formation - CCAB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #1a1a0e; color: #e8e6e1; overflow: hidden; }
        #container { display: flex; height: 100vh; }
        #canvas-container { flex: 1; position: relative; }
        canvas { display: block; width: 100%; height: 100%; }
        #controls { width: 280px; background: rgba(0,0,0,0.9); padding: 20px; overflow-y: auto; }
        h1 { font-size: 1.2rem; margin-bottom: 15px; color: #facc15; }
        .control-group { margin-bottom: 12px; }
        label { display: block; font-size: 0.75rem; margin-bottom: 3px; color: #aaa; }
        input[type="range"] { width: 100%; }
        button { width: 100%; padding: 8px; margin-bottom: 8px; background: #ca8a04; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        button:hover { background: #a16207; }
        .stats { background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px; font-size: 0.75rem; margin-bottom: 15px; }
        .back-link { position: fixed; top: 10px; left: 10px; padding: 8px 16px; background: rgba(0,0,0,0.7); color: #facc15; text-decoration: none; border-radius: 6px; font-size: 14px; z-index: 999; }
        .description { font-size: 0.7rem; color: #888; margin-bottom: 12px; line-height: 1.4; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back</a>
    <div id="container">
        <div id="canvas-container">
            <canvas id="canvas"></canvas>
        </div>
        <div id="controls">
            <h1>Ant Trail Formation</h1>
            <p class="description">Ants form persistent paths between nest and food. Trails are reinforced by successful foragers and decay over time. Watch highways emerge!</p>
            
            <div class="control-group">
                <label>Ants: <span id="antsVal">100</span></label>
                <input type="range" id="ants" min="20" max="300" value="100">
            </div>
            <div class="control-group">
                <label>Pheromone Strength: <span id="pheroVal">50</span></label>
                <input type="range" id="phero" min="10" max="100" value="50">
            </div>
            <div class="control-group">
                <label>Evaporation Rate: <span id="evapVal">1</span>%</label>
                <input type="range" id="evap" min="0.5" max="5" step="0.5" value="1">
            </div>
            <div class="control-group">
                <label>Diffusion: <span id="diffVal">0.1</span></label>
                <input type="range" id="diff" min="0" max="0.3" step="0.05" value="0.1">
            </div>
            
            <button id="reset">Reset</button>
            <button id="pause">Pause</button>
            <button id="addFood">Add Food Source</button>
            
            <div class="stats">
                <div>Ants Foraging: <span id="foraging">0</span></div>
                <div>Ants Returning: <span id="returning">0</span></div>
                <div>Food Collected: <span id="collected">0</span></div>
            </div>
            
            <p class="description"><strong>Trail reinforcement:</strong> Ants returning with food deposit more pheromone. Successful paths get stronger while unused paths fade.</p>
        </div>
    </div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        let W, H, COLS, ROWS, CELL = 4;
        let pheromone, ants = [], nest, foods = [], paused = false, collected = 0;
        
        let params = {
            antCount: 100,
            pheroStrength: 50,
            evapRate: 0.01,
            diffusion: 0.1
        };
        
        function resize() {
            const c = document.getElementById('canvas-container');
            canvas.width = c.clientWidth;
            canvas.height = c.clientHeight;
            W = canvas.width;
            H = canvas.height;
            COLS = Math.floor(W / CELL);
            ROWS = Math.floor(H / CELL);
        }
        
        function init() {
            resize();
            collected = 0;
            
            // Initialize pheromone grid
            pheromone = [];
            for (let y = 0; y < ROWS; y++) {
                pheromone[y] = new Float32Array(COLS);
            }
            
            // Nest at left center
            nest = { x: 50, y: H / 2, radius: 30 };
            
            // Food sources
            foods = [
                { x: W - 100, y: H / 2, radius: 25, amount: 500 }
            ];
            
            // Create ants
            ants = [];
            for (let i = 0; i < params.antCount; i++) {
                ants.push({
                    x: nest.x + (Math.random() - 0.5) * 20,
                    y: nest.y + (Math.random() - 0.5) * 20,
                    angle: Math.random() * Math.PI * 2,
                    hasFood: false,
                    speed: 1.5 + Math.random() * 0.5
                });
            }
            
            updateStats();
        }
        
        function step() {
            // Evaporate and diffuse pheromone
            const newPhero = [];
            for (let y = 0; y < ROWS; y++) {
                newPhero[y] = new Float32Array(COLS);
                for (let x = 0; x < COLS; x++) {
                    // Evaporation
                    let val = pheromone[y][x] * (1 - params.evapRate);
                    
                    // Diffusion from neighbors
                    if (params.diffusion > 0) {
                        let sum = 0, count = 0;
                        for (let dy = -1; dy <= 1; dy++) {
                            for (let dx = -1; dx <= 1; dx++) {
                                const ny = y + dy, nx = x + dx;
                                if (ny >= 0 && ny < ROWS && nx >= 0 && nx < COLS) {
                                    sum += pheromone[ny][nx];
                                    count++;
                                }
                            }
                        }
                        val = val * (1 - params.diffusion) + (sum / count) * params.diffusion;
                    }
                    
                    newPhero[y][x] = val;
                }
            }
            pheromone = newPhero;
            
            // Update ants
            for (const ant of ants) {
                if (ant.hasFood) {
                    // Return to nest, deposit pheromone
                    const dx = nest.x - ant.x;
                    const dy = nest.y - ant.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    
                    // Head toward nest with some randomness
                    const targetAngle = Math.atan2(dy, dx);
                    ant.angle = ant.angle * 0.8 + targetAngle * 0.2 + (Math.random() - 0.5) * 0.3;
                    
                    // Deposit pheromone
                    const gx = Math.floor(ant.x / CELL);
                    const gy = Math.floor(ant.y / CELL);
                    if (gy >= 0 && gy < ROWS && gx >= 0 && gx < COLS) {
                        pheromone[gy][gx] = Math.min(255, pheromone[gy][gx] + params.pheroStrength * 0.5);
                    }
                    
                    // Check if reached nest
                    if (dist < nest.radius) {
                        ant.hasFood = false;
                        collected++;
                        ant.angle += Math.PI; // Turn around
                    }
                } else {
                    // Search for food, follow pheromone
                    let bestAngle = ant.angle;
                    let bestPhero = 0;
                    
                    // Sniff in three directions
                    for (const offset of [-0.5, 0, 0.5]) {
                        const sniffAngle = ant.angle + offset;
                        const sniffX = ant.x + Math.cos(sniffAngle) * 15;
                        const sniffY = ant.y + Math.sin(sniffAngle) * 15;
                        const gx = Math.floor(sniffX / CELL);
                        const gy = Math.floor(sniffY / CELL);
                        
                        if (gy >= 0 && gy < ROWS && gx >= 0 && gx < COLS) {
                            if (pheromone[gy][gx] > bestPhero) {
                                bestPhero = pheromone[gy][gx];
                                bestAngle = sniffAngle;
                            }
                        }
                    }
                    
                    // Follow pheromone or wander
                    if (bestPhero > 1) {
                        ant.angle = ant.angle * 0.7 + bestAngle * 0.3;
                    } else {
                        ant.angle += (Math.random() - 0.5) * 0.8;
                    }
                    
                    // Check for food
                    for (const food of foods) {
                        const dist = Math.sqrt(Math.pow(ant.x - food.x, 2) + Math.pow(ant.y - food.y, 2));
                        if (dist < food.radius && food.amount > 0) {
                            ant.hasFood = true;
                            food.amount--;
                            ant.angle += Math.PI; // Turn around
                            break;
                        }
                    }
                }
                
                // Move
                ant.x += Math.cos(ant.angle) * ant.speed;
                ant.y += Math.sin(ant.angle) * ant.speed;
                
                // Bounce off walls
                if (ant.x < 10) { ant.x = 10; ant.angle = Math.PI - ant.angle; }
                if (ant.x > W - 10) { ant.x = W - 10; ant.angle = Math.PI - ant.angle; }
                if (ant.y < 10) { ant.y = 10; ant.angle = -ant.angle; }
                if (ant.y > H - 10) { ant.y = H - 10; ant.angle = -ant.angle; }
            }
            
            updateStats();
        }
        
        function updateStats() {
            const returning = ants.filter(a => a.hasFood).length;
            document.getElementById('foraging').textContent = ants.length - returning;
            document.getElementById('returning').textContent = returning;
            document.getElementById('collected').textContent = collected;
        }
        
        function draw() {
            ctx.fillStyle = '#1a1a0e';
            ctx.fillRect(0, 0, W, H);
            
            // Draw pheromone
            for (let y = 0; y < ROWS; y++) {
                for (let x = 0; x < COLS; x++) {
                    const val = pheromone[y][x];
                    if (val > 0.5) {
                        const intensity = Math.min(255, val * 2);
                        ctx.fillStyle = `rgba(250, 204, 21, ${intensity / 255 * 0.7})`;
                        ctx.fillRect(x * CELL, y * CELL, CELL, CELL);
                    }
                }
            }
            
            // Draw nest
            ctx.fillStyle = '#854d0e';
            ctx.beginPath();
            ctx.arc(nest.x, nest.y, nest.radius, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#fef3c7';
            ctx.font = '12px sans-serif';
            ctx.fillText('NEST', nest.x - 18, nest.y + 4);
            
            // Draw food sources
            for (const food of foods) {
                const alpha = Math.min(1, food.amount / 100);
                ctx.fillStyle = `rgba(34, 197, 94, ${alpha})`;
                ctx.beginPath();
                ctx.arc(food.x, food.y, food.radius, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#fff';
                ctx.fillText(food.amount.toString(), food.x - 10, food.y + 4);
            }
            
            // Draw ants
            for (const ant of ants) {
                ctx.fillStyle = ant.hasFood ? '#22c55e' : '#000';
                ctx.save();
                ctx.translate(ant.x, ant.y);
                ctx.rotate(ant.angle);
                ctx.beginPath();
                ctx.ellipse(0, 0, 4, 2, 0, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
            
            requestAnimationFrame(draw);
        }
        
        let intervalId = null;
        function startSim() {
            if (intervalId) clearInterval(intervalId);
            intervalId = setInterval(() => { if (!paused) step(); }, 30);
        }
        
        // Event listeners
        document.getElementById('ants').addEventListener('input', e => {
            params.antCount = +e.target.value;
            document.getElementById('antsVal').textContent = params.antCount;
        });
        document.getElementById('phero').addEventListener('input', e => {
            params.pheroStrength = +e.target.value;
            document.getElementById('pheroVal').textContent = params.pheroStrength;
        });
        document.getElementById('evap').addEventListener('input', e => {
            params.evapRate = +e.target.value / 100;
            document.getElementById('evapVal').textContent = e.target.value;
        });
        document.getElementById('diff').addEventListener('input', e => {
            params.diffusion = +e.target.value;
            document.getElementById('diffVal').textContent = params.diffusion;
        });
        document.getElementById('reset').addEventListener('click', () => { init(); startSim(); });
        document.getElementById('pause').addEventListener('click', () => {
            paused = !paused;
            document.getElementById('pause').textContent = paused ? 'Resume' : 'Pause';
        });
        document.getElementById('addFood').addEventListener('click', () => {
            foods.push({
                x: 100 + Math.random() * (W - 200),
                y: 100 + Math.random() * (H - 200),
                radius: 20,
                amount: 200
            });
        });
        
        window.addEventListener('resize', resize);
        init();
        draw();
        startSim();
    </script>
</body>
</html>
