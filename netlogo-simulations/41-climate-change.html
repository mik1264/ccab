<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Climate Change - Simplified Climate Model</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e8e8e8;
            min-height: 100vh;
            display: flex;
        }
        .sidebar {
            width: 320px;
            padding: 20px;
            background: rgba(0,0,0,0.3);
            overflow-y: auto;
        }
        .main-content { flex: 1; display: flex; flex-direction: column; padding: 20px; }
        h1 { font-size: 1.4rem; margin-bottom: 10px; color: #22c55e; }
        .description { font-size: 0.85rem; color: #aaa; margin-bottom: 20px; line-height: 1.5; }
        .control-group { margin-bottom: 15px; }
        .control-group label { display: block; font-size: 0.8rem; color: #888; margin-bottom: 5px; }
        .control-group input[type="range"] { width: 100%; }
        .control-group .value { font-size: 0.75rem; color: #22c55e; }
        .buttons { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        button { padding: 8px 16px; border: none; border-radius: 5px; cursor: pointer; font-size: 0.85rem; }
        .btn-primary { background: #22c55e; color: #1a1a2e; }
        .btn-secondary { background: #374151; color: #e8e8e8; }
        .btn-danger { background: #ef4444; color: #fff; }
        button:hover { opacity: 0.8; }
        .stats { background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .stat-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.85rem; }
        .stat-label { color: #888; }
        .stat-value { font-weight: bold; font-family: monospace; }
        .canvas-container { flex: 1; display: flex; gap: 20px; min-height: 0; }
        canvas { border-radius: 8px; background: #0a0a0a; }
        #simCanvas { flex: 1.5; }
        .charts { flex: 1; display: flex; flex-direction: column; gap: 10px; }
        .chart-container { flex: 1; background: rgba(0,0,0,0.2); border-radius: 8px; padding: 10px; }
        .chart-title { font-size: 0.75rem; color: #888; margin-bottom: 5px; }
        .back-link { display: inline-block; color: #22c55e; text-decoration: none; margin-bottom: 15px; font-size: 0.85rem; }
        .back-link:hover { text-decoration: underline; }
        .temp-display {
            background: linear-gradient(to right, #3b82f6, #22c55e, #f97316, #ef4444);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 15px;
        }
        .temp-value { font-size: 2rem; font-weight: bold; }
        .temp-label { font-size: 0.8rem; color: rgba(255,255,255,0.8); }
        .legend { display: flex; gap: 10px; flex-wrap: wrap; font-size: 0.7rem; margin-top: 5px; }
        .legend-item { display: flex; align-items: center; gap: 4px; }
        .legend-color { width: 10px; height: 10px; border-radius: 2px; }
    </style>
</head>
<body>
    <div class="sidebar">
        <a href="index.html" class="back-link">← Back to Gallery</a>
        <h1>Climate Change Model</h1>
        <p class="description">
            Simplified energy balance model showing greenhouse effect.
            Sunlight enters, some reflects (albedo), rest is absorbed.
            CO₂ traps outgoing infrared radiation, warming the planet.
        </p>

        <div class="temp-display">
            <div class="temp-value" id="globalTemp">15°C</div>
            <div class="temp-label">Global Temperature</div>
        </div>

        <div class="buttons">
            <button class="btn-primary" id="startBtn">Start</button>
            <button class="btn-secondary" id="resetBtn">Reset</button>
        </div>

        <div class="buttons">
            <button class="btn-secondary" id="preIndustrial">Pre-Industrial</button>
            <button class="btn-danger" id="doubledCO2">2× CO₂</button>
        </div>

        <div class="control-group">
            <label>CO₂ Concentration: <span class="value" id="co2Value">400 ppm</span></label>
            <input type="range" id="co2" min="280" max="1000" value="400">
        </div>

        <div class="control-group">
            <label>Solar Intensity: <span class="value" id="solarValue">100%</span></label>
            <input type="range" id="solar" min="90" max="110" value="100">
        </div>

        <div class="control-group">
            <label>Ice Cover (Albedo): <span class="value" id="albedoValue">0.30</span></label>
            <input type="range" id="albedo" min="0.1" max="0.5" step="0.01" value="0.30">
        </div>

        <div class="control-group">
            <label>Cloud Cover: <span class="value" id="cloudValue">50%</span></label>
            <input type="range" id="cloud" min="20" max="80" value="50">
        </div>

        <div class="stats">
            <div class="stat-row">
                <span class="stat-label">Year:</span>
                <span class="stat-value" id="year">2024</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Incoming Solar:</span>
                <span class="stat-value" id="incomingSolar">341 W/m²</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Reflected:</span>
                <span class="stat-value" id="reflected">102 W/m²</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Absorbed:</span>
                <span class="stat-value" id="absorbed">239 W/m²</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">IR Trapped:</span>
                <span class="stat-value" id="trapped" style="color: #f97316;">0 W/m²</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Sea Level Rise:</span>
                <span class="stat-value" id="seaLevel" style="color: #3b82f6;">0 cm</span>
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="canvas-container">
            <canvas id="simCanvas"></canvas>
            <div class="charts">
                <div class="chart-container">
                    <div class="chart-title">Temperature Over Time</div>
                    <canvas id="tempChart"></canvas>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #f97316;"></div>
                            <span>Temperature</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #22c55e; opacity: 0.5;"></div>
                            <span>Pre-industrial</span>
                        </div>
                    </div>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Energy Budget</div>
                    <canvas id="energyChart"></canvas>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #fbbf24;"></div>
                            <span>In</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #3b82f6;"></div>
                            <span>Out</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const simCanvas = document.getElementById('simCanvas');
        const simCtx = simCanvas.getContext('2d');
        const tempCanvas = document.getElementById('tempChart');
        const tempCtx = tempCanvas.getContext('2d');
        const energyCanvas = document.getElementById('energyChart');
        const energyCtx = energyCanvas.getContext('2d');

        let running = false;
        let year = 2024;
        let temperature = 15; // °C
        const PRE_INDUSTRIAL_TEMP = 14;
        const SOLAR_CONSTANT = 1361; // W/m² at top of atmosphere

        let params = {
            co2: 400,
            solar: 100,
            albedo: 0.30,
            cloud: 50
        };

        let history = { temp: [], energyIn: [], energyOut: [] };
        const MAX_HISTORY = 200;

        // Photons for visualization
        let photons = [];

        function init() {
            resizeCanvases();
            setupControls();
            reset();
            animate();
        }

        function resizeCanvases() {
            const container = simCanvas.parentElement;
            simCanvas.width = container.clientWidth * 0.55;
            simCanvas.height = container.clientHeight - 40;

            document.querySelectorAll('.chart-container').forEach((c, i) => {
                const canvas = i === 0 ? tempCanvas : energyCanvas;
                canvas.width = c.clientWidth - 20;
                canvas.height = c.clientHeight - 50;
            });
        }

        function setupControls() {
            document.getElementById('startBtn').onclick = () => {
                running = !running;
                document.getElementById('startBtn').textContent = running ? 'Pause' : 'Start';
            };
            document.getElementById('resetBtn').onclick = reset;

            document.getElementById('preIndustrial').onclick = () => {
                params.co2 = 280;
                document.getElementById('co2').value = 280;
                document.getElementById('co2Value').textContent = '280 ppm';
            };

            document.getElementById('doubledCO2').onclick = () => {
                params.co2 = 560;
                document.getElementById('co2').value = 560;
                document.getElementById('co2Value').textContent = '560 ppm';
            };

            document.getElementById('co2').oninput = (e) => {
                params.co2 = parseInt(e.target.value);
                document.getElementById('co2Value').textContent = params.co2 + ' ppm';
            };

            document.getElementById('solar').oninput = (e) => {
                params.solar = parseInt(e.target.value);
                document.getElementById('solarValue').textContent = params.solar + '%';
            };

            document.getElementById('albedo').oninput = (e) => {
                params.albedo = parseFloat(e.target.value);
                document.getElementById('albedoValue').textContent = params.albedo.toFixed(2);
            };

            document.getElementById('cloud').oninput = (e) => {
                params.cloud = parseInt(e.target.value);
                document.getElementById('cloudValue').textContent = params.cloud + '%';
            };

            window.addEventListener('resize', resizeCanvases);
        }

        function reset() {
            running = false;
            year = 2024;
            temperature = 15;
            document.getElementById('startBtn').textContent = 'Start';
            history = { temp: [], energyIn: [], energyOut: [] };
            photons = [];
            updateStats();
            draw();
        }

        function update() {
            year++;

            // Calculate energy budget
            const solarIn = SOLAR_CONSTANT / 4 * (params.solar / 100); // Average over sphere
            const cloudReflected = solarIn * (params.cloud / 100) * 0.2;
            const surfaceReflected = (solarIn - cloudReflected) * params.albedo;
            const absorbed = solarIn - cloudReflected - surfaceReflected;

            // Greenhouse effect (logarithmic with CO2)
            // Each doubling of CO2 adds ~3.7 W/m² forcing
            const co2Forcing = 5.35 * Math.log(params.co2 / 280);

            // Stefan-Boltzmann for outgoing radiation
            const sigma = 5.67e-8;
            const tempK = temperature + 273.15;
            const irOut = sigma * Math.pow(tempK, 4);

            // Effective emissivity reduced by greenhouse gases
            const emissivity = 0.6 - 0.1 * Math.log(params.co2 / 280);
            const actualOut = irOut * emissivity;
            const trapped = irOut - actualOut;

            // Energy imbalance drives temperature change
            const imbalance = absorbed + co2Forcing - actualOut;
            const heatCapacity = 50; // Effective heat capacity (delays response)
            temperature += imbalance / heatCapacity;

            // Update albedo feedback (ice melts)
            if (temperature > 16) {
                params.albedo = Math.max(0.15, params.albedo - 0.0002);
                document.getElementById('albedo').value = params.albedo;
                document.getElementById('albedoValue').textContent = params.albedo.toFixed(2);
            }

            // Spawn photons for visualization
            if (Math.random() < 0.3) {
                photons.push({
                    x: Math.random() * simCanvas.width,
                    y: 0,
                    type: 'solar',
                    vy: 2 + Math.random()
                });
            }

            // Update photons
            photons = photons.filter(p => {
                p.y += p.vy;
                p.x += (Math.random() - 0.5) * 0.5;

                if (p.type === 'solar' && p.y > simCanvas.height * 0.7) {
                    if (Math.random() < params.albedo) {
                        p.type = 'reflected';
                        p.vy = -p.vy;
                    } else {
                        p.type = 'ir';
                        p.vy = -1.5;
                    }
                }

                if (p.type === 'ir' && p.y < simCanvas.height * 0.3) {
                    if (Math.random() < params.co2 / 1000) {
                        p.type = 'trapped';
                        p.vy = 1;
                    }
                }

                return p.y > 0 && p.y < simCanvas.height;
            });

            // Record history
            history.temp.push(temperature);
            history.energyIn.push(absorbed + co2Forcing);
            history.energyOut.push(actualOut);
            if (history.temp.length > MAX_HISTORY) {
                history.temp.shift();
                history.energyIn.shift();
                history.energyOut.shift();
            }

            updateStats();
        }

        function updateStats() {
            const solarIn = SOLAR_CONSTANT / 4 * (params.solar / 100);
            const cloudReflected = solarIn * (params.cloud / 100) * 0.2;
            const surfaceReflected = (solarIn - cloudReflected) * params.albedo;
            const absorbed = solarIn - cloudReflected - surfaceReflected;

            const sigma = 5.67e-8;
            const tempK = temperature + 273.15;
            const irOut = sigma * Math.pow(tempK, 4);
            const emissivity = 0.6 - 0.1 * Math.log(params.co2 / 280);
            const trapped = irOut * (1 - emissivity);

            const seaLevel = Math.max(0, (temperature - PRE_INDUSTRIAL_TEMP) * 20);

            document.getElementById('year').textContent = year;
            document.getElementById('globalTemp').textContent = temperature.toFixed(1) + '°C';
            document.getElementById('incomingSolar').textContent = Math.round(solarIn) + ' W/m²';
            document.getElementById('reflected').textContent = Math.round(cloudReflected + surfaceReflected) + ' W/m²';
            document.getElementById('absorbed').textContent = Math.round(absorbed) + ' W/m²';
            document.getElementById('trapped').textContent = Math.round(trapped) + ' W/m²';
            document.getElementById('seaLevel').textContent = seaLevel.toFixed(0) + ' cm';

            // Color the temp display
            const tempDisplay = document.querySelector('.temp-display');
            if (temperature > 18) tempDisplay.style.background = 'linear-gradient(135deg, #ef4444, #f97316)';
            else if (temperature > 16) tempDisplay.style.background = 'linear-gradient(135deg, #f97316, #fbbf24)';
            else if (temperature > 14) tempDisplay.style.background = 'linear-gradient(135deg, #22c55e, #3b82f6)';
            else tempDisplay.style.background = 'linear-gradient(135deg, #3b82f6, #1d4ed8)';
        }

        function draw() {
            drawSimulation();
            drawTempChart();
            drawEnergyChart();
        }

        function drawSimulation() {
            const w = simCanvas.width, h = simCanvas.height;

            // Sky gradient
            const skyGrad = simCtx.createLinearGradient(0, 0, 0, h * 0.7);
            skyGrad.addColorStop(0, '#0f172a');
            skyGrad.addColorStop(1, '#1e3a5f');
            simCtx.fillStyle = skyGrad;
            simCtx.fillRect(0, 0, w, h * 0.7);

            // Atmosphere layer
            simCtx.fillStyle = `rgba(150, 200, 255, ${0.1 + params.cloud / 500})`;
            simCtx.fillRect(0, h * 0.2, w, h * 0.2);

            // CO2 layer visualization
            const co2Opacity = (params.co2 - 280) / 720 * 0.3;
            simCtx.fillStyle = `rgba(255, 150, 50, ${co2Opacity})`;
            simCtx.fillRect(0, h * 0.25, w, h * 0.15);

            // Ground
            const groundHue = Math.max(30, 120 - (temperature - 14) * 10);
            simCtx.fillStyle = `hsl(${groundHue}, 40%, 30%)`;
            simCtx.fillRect(0, h * 0.7, w, h * 0.3);

            // Ice caps (shrink with temperature)
            const iceWidth = Math.max(0, (18 - temperature) / 4 * w * 0.3);
            simCtx.fillStyle = '#e0f2fe';
            simCtx.fillRect(0, h * 0.7, iceWidth, h * 0.1);
            simCtx.fillRect(w - iceWidth, h * 0.7, iceWidth, h * 0.1);

            // Sun
            simCtx.fillStyle = '#fbbf24';
            simCtx.beginPath();
            simCtx.arc(w - 50, 50, 30, 0, Math.PI * 2);
            simCtx.fill();

            // Clouds
            simCtx.fillStyle = 'rgba(255,255,255,0.6)';
            for (let i = 0; i < params.cloud / 10; i++) {
                const cx = (i * 100 + 50) % w;
                const cy = h * 0.15 + Math.sin(i) * 20;
                drawCloud(cx, cy, 40 + Math.random() * 20);
            }

            // Photons
            photons.forEach(p => {
                switch (p.type) {
                    case 'solar':
                        simCtx.fillStyle = '#fbbf24';
                        break;
                    case 'reflected':
                        simCtx.fillStyle = '#fef08a';
                        break;
                    case 'ir':
                        simCtx.fillStyle = '#ef4444';
                        break;
                    case 'trapped':
                        simCtx.fillStyle = '#f97316';
                        break;
                }
                simCtx.beginPath();
                simCtx.arc(p.x, p.y, 3, 0, Math.PI * 2);
                simCtx.fill();
            });

            // Labels
            simCtx.fillStyle = '#fff';
            simCtx.font = '12px sans-serif';
            simCtx.fillText('Space', 10, 20);
            simCtx.fillText('Atmosphere', 10, h * 0.35);
            simCtx.fillText('Surface', 10, h * 0.75);

            // CO2 indicator
            simCtx.fillStyle = '#f97316';
            simCtx.fillText(`CO₂: ${params.co2} ppm`, w - 100, h * 0.3);
        }

        function drawCloud(x, y, size) {
            simCtx.beginPath();
            simCtx.arc(x, y, size * 0.5, 0, Math.PI * 2);
            simCtx.arc(x + size * 0.4, y - size * 0.1, size * 0.4, 0, Math.PI * 2);
            simCtx.arc(x + size * 0.8, y, size * 0.35, 0, Math.PI * 2);
            simCtx.fill();
        }

        function drawTempChart() {
            const w = tempCanvas.width, h = tempCanvas.height;
            tempCtx.fillStyle = 'rgba(0,0,0,0.3)';
            tempCtx.fillRect(0, 0, w, h);

            // Temperature range
            const minT = 10, maxT = 25;

            // Pre-industrial line
            const preY = h - ((PRE_INDUSTRIAL_TEMP - minT) / (maxT - minT)) * h;
            tempCtx.strokeStyle = 'rgba(34, 197, 94, 0.5)';
            tempCtx.setLineDash([5, 5]);
            tempCtx.beginPath();
            tempCtx.moveTo(0, preY);
            tempCtx.lineTo(w, preY);
            tempCtx.stroke();
            tempCtx.setLineDash([]);

            // +2°C threshold
            const threshY = h - ((PRE_INDUSTRIAL_TEMP + 2 - minT) / (maxT - minT)) * h;
            tempCtx.strokeStyle = 'rgba(239, 68, 68, 0.3)';
            tempCtx.beginPath();
            tempCtx.moveTo(0, threshY);
            tempCtx.lineTo(w, threshY);
            tempCtx.stroke();

            // Temperature line
            if (history.temp.length > 1) {
                tempCtx.strokeStyle = '#f97316';
                tempCtx.lineWidth = 2;
                tempCtx.beginPath();
                history.temp.forEach((t, i) => {
                    const x = (i / MAX_HISTORY) * w;
                    const y = h - ((t - minT) / (maxT - minT)) * h;
                    if (i === 0) tempCtx.moveTo(x, y);
                    else tempCtx.lineTo(x, y);
                });
                tempCtx.stroke();
            }

            // Labels
            tempCtx.fillStyle = '#666';
            tempCtx.font = '9px sans-serif';
            tempCtx.fillText(maxT + '°C', 2, 10);
            tempCtx.fillText(minT + '°C', 2, h - 2);
            tempCtx.fillText('+2°C limit', w - 50, threshY - 3);
        }

        function drawEnergyChart() {
            const w = energyCanvas.width, h = energyCanvas.height;
            energyCtx.fillStyle = 'rgba(0,0,0,0.3)';
            energyCtx.fillRect(0, 0, w, h);

            if (history.energyIn.length < 2) return;

            const maxE = 300;

            // Energy in
            energyCtx.strokeStyle = '#fbbf24';
            energyCtx.lineWidth = 2;
            energyCtx.beginPath();
            history.energyIn.forEach((e, i) => {
                const x = (i / MAX_HISTORY) * w;
                const y = h - (e / maxE) * h;
                if (i === 0) energyCtx.moveTo(x, y);
                else energyCtx.lineTo(x, y);
            });
            energyCtx.stroke();

            // Energy out
            energyCtx.strokeStyle = '#3b82f6';
            energyCtx.beginPath();
            history.energyOut.forEach((e, i) => {
                const x = (i / MAX_HISTORY) * w;
                const y = h - (e / maxE) * h;
                if (i === 0) energyCtx.moveTo(x, y);
                else energyCtx.lineTo(x, y);
            });
            energyCtx.stroke();

            // Equilibrium line
            energyCtx.strokeStyle = 'rgba(255,255,255,0.2)';
            energyCtx.setLineDash([5, 5]);
            const eqY = h - (239 / maxE) * h;
            energyCtx.beginPath();
            energyCtx.moveTo(0, eqY);
            energyCtx.lineTo(w, eqY);
            energyCtx.stroke();
            energyCtx.setLineDash([]);

            // Labels
            energyCtx.fillStyle = '#666';
            energyCtx.font = '9px sans-serif';
            energyCtx.fillText('W/m²', 2, 10);
        }

        function animate() {
            if (running) update();
            draw();
            requestAnimationFrame(animate);
        }

        init();
    </script>
</body>
</html>
