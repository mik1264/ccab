<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atmospheric Chemistry - Gas Phase Reactions</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e8e8e8;
            min-height: 100vh;
            display: flex;
        }
        .sidebar {
            width: 300px;
            background: rgba(0,0,0,0.3);
            padding: 20px;
            overflow-y: auto;
            border-right: 1px solid rgba(255,255,255,0.1);
        }
        .main { flex: 1; display: flex; flex-direction: column; }
        h1 { font-size: 1.4em; margin-bottom: 5px; color: #74b9ff; }
        .subtitle { font-size: 0.85em; color: #888; margin-bottom: 20px; }
        .control-group { margin-bottom: 15px; }
        .control-group label { display: block; font-size: 0.85em; color: #aaa; margin-bottom: 5px; }
        .control-group input[type="range"] { width: 100%; }
        .control-group .value { font-size: 0.8em; color: #74b9ff; }
        .buttons { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        button { padding: 8px 16px; border: none; border-radius: 5px; cursor: pointer; font-size: 0.9em; }
        .btn-primary { background: #74b9ff; color: #000; }
        .btn-secondary { background: #444; color: #fff; }
        .btn-danger { background: #e74c3c; color: #fff; }
        .stats { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .stats h3 { font-size: 0.9em; color: #74b9ff; margin-bottom: 10px; }
        .stat-row { display: flex; justify-content: space-between; font-size: 0.85em; margin-bottom: 5px; }
        .stat-value { color: #74b9ff; }
        .canvas-container { flex: 1; display: flex; justify-content: center; align-items: center; padding: 20px; }
        canvas { background: #0a0a1a; border-radius: 10px; }
        .legend { padding: 15px; background: rgba(0,0,0,0.3); border-radius: 8px; margin-bottom: 10px; }
        .legend h4 { font-size: 0.85em; color: #888; margin-bottom: 8px; }
        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.75em; margin-bottom: 4px; }
        .legend-color { width: 14px; height: 14px; border-radius: 50%; }
        .back-link { display: inline-block; color: #74b9ff; text-decoration: none; margin-bottom: 20px; font-size: 0.9em; }
        .info { font-size: 0.75em; color: #666; line-height: 1.5; margin-top: 10px; }

        .explain-btn {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            margin-top: 10px;
        }
        .explain-btn:hover {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        }
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .modal-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 1;
        }
        .modal {
            background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%);
            border-radius: 16px;
            padding: 30px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
        }
        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: #888;
            font-size: 28px;
            cursor: pointer;
            width: auto;
            padding: 0;
            margin: 0;
        }
        .modal-close:hover {
            color: #fff;
            background: none;
        }
        .modal h2 {
            color: #fbbf24;
            margin-bottom: 20px;
            font-size: 1.5rem;
            padding-right: 30px;
        }
        .modal-body {
            color: #ccc;
            line-height: 1.8;
            font-size: 0.95rem;
        }
        .modal-body h3 {
            color: #a5b4fc;
            margin: 20px 0 10px 0;
            font-size: 1.1rem;
        }
        .modal-body p {
            margin-bottom: 15px;
        }
        .modal-body ul {
            margin: 10px 0 15px 20px;
        }
        .modal-body li {
            margin-bottom: 8px;
        }
        .modal-body strong {
            color: #fbbf24;
        }
        .modal-body em {
            color: #a5b4fc;
            font-style: normal;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <a href="index.html" class="back-link">‚Üê Back to Gallery</a>
        <h1>Atmospheric Chemistry</h1>
        <p class="subtitle">Gas-Phase Reactions Simulation</p>

        <div class="buttons">
            <button class="btn-primary" id="startBtn">Start</button>
            <button class="btn-secondary" id="stepBtn">Step</button>
            <button class="btn-danger" id="resetBtn">Reset</button>
            <button id="explainBtn" class="explain-btn">üìö Explain</button>
        </div>

        <div class="control-group">
            <label>O2 Molecules: <span class="value" id="o2Val">50</span></label>
            <input type="range" id="o2Count" min="10" max="100" value="50">
        </div>
        <div class="control-group">
            <label>N2 Molecules: <span class="value" id="n2Val">100</span></label>
            <input type="range" id="n2Count" min="20" max="200" value="100">
        </div>
        <div class="control-group">
            <label>UV Intensity: <span class="value" id="uvVal">50%</span></label>
            <input type="range" id="uvIntensity" min="0" max="100" value="50">
        </div>
        <div class="control-group">
            <label>Temperature: <span class="value" id="tempVal">300</span>K</label>
            <input type="range" id="temperature" min="200" max="500" value="300">
        </div>

        <div class="stats">
            <h3>Atmospheric Composition</h3>
            <div class="stat-row"><span>O2:</span><span class="stat-value" id="statO2">0</span></div>
            <div class="stat-row"><span>N2:</span><span class="stat-value" id="statN2">0</span></div>
            <div class="stat-row"><span>O3 (Ozone):</span><span class="stat-value" id="statO3">0</span></div>
            <div class="stat-row"><span>O (Atomic):</span><span class="stat-value" id="statO">0</span></div>
            <div class="stat-row"><span>NO:</span><span class="stat-value" id="statNO">0</span></div>
            <div class="stat-row"><span>NO2:</span><span class="stat-value" id="statNO2">0</span></div>
            <div class="stat-row"><span>Time:</span><span class="stat-value" id="time">0</span></div>
        </div>

        <div class="legend">
            <h4>Molecules</h4>
            <div class="legend-item"><div class="legend-color" style="background: #ff6b6b;"></div><span>O2 - Oxygen</span></div>
            <div class="legend-item"><div class="legend-color" style="background: #74b9ff;"></div><span>N2 - Nitrogen</span></div>
            <div class="legend-item"><div class="legend-color" style="background: #a29bfe;"></div><span>O3 - Ozone</span></div>
            <div class="legend-item"><div class="legend-color" style="background: #ffeaa7;"></div><span>O - Atomic Oxygen</span></div>
            <div class="legend-item"><div class="legend-color" style="background: #55efc4;"></div><span>NO - Nitric Oxide</span></div>
            <div class="legend-item"><div class="legend-color" style="background: #fd79a8;"></div><span>NO2 - Nitrogen Dioxide</span></div>
        </div>
        <p class="info">Simulates key atmospheric chemistry reactions including ozone formation/destruction and nitrogen oxide cycles.</p>
    </div>

    <div class="main">
        <div class="canvas-container">
            <canvas id="canvas"></canvas>
        </div>
    </div>

    <div id="explainModal" class="modal-overlay">
        <div class="modal">
            <button class="modal-close">&times;</button>
            <h2>üìö Atmospheric Chemistry - Gas Phase Reactions</h2>
            <div class="modal-body">
                <p>This simulation demonstrates key concepts in complex systems and agent-based modeling.</p>

                <h3>How It Works</h3>
                <p>Agents follow simple local rules that lead to emergent global behavior.</p>

                <h3>Key Concepts</h3>
                <ul>
                    <li><strong>Emergence:</strong> Complex patterns arise from simple rules</li>
                    <li><strong>Self-organization:</strong> Order without central control</li>
                    <li><strong>Feedback loops:</strong> Actions influence future states</li>
                </ul>

                <h3>Try This</h3>
                <ul>
                    <li>Adjust parameters to see different behaviors</li>
                    <li>Watch for patterns that emerge over time</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let running = false, molecules = [], time = 0;
        let uvIntensity = 0.5, temperature = 300;
        const TYPES = { O2: 'O2', N2: 'N2', O3: 'O3', O: 'O', NO: 'NO', NO2: 'NO2' };
        const COLORS = { O2: '#ff6b6b', N2: '#74b9ff', O3: '#a29bfe', O: '#ffeaa7', NO: '#55efc4', NO2: '#fd79a8' };
        const RADII = { O2: 8, N2: 8, O3: 10, O: 5, NO: 7, NO2: 9 };

        function resizeCanvas() {
            const container = canvas.parentElement;
            const size = Math.min(container.clientWidth - 40, container.clientHeight - 40, 500);
            canvas.width = size; canvas.height = size;
        }

        function createMolecule(type) {
            const speed = Math.sqrt(temperature / 300);
            const angle = Math.random() * Math.PI * 2;
            return {
                type, x: 20 + Math.random() * (canvas.width - 40), y: 20 + Math.random() * (canvas.height - 40),
                vx: Math.cos(angle) * speed * 2, vy: Math.sin(angle) * speed * 2
            };
        }

        function init() {
            molecules = [];
            const o2Count = parseInt(document.getElementById('o2Count').value);
            const n2Count = parseInt(document.getElementById('n2Count').value);
            for (let i = 0; i < o2Count; i++) molecules.push(createMolecule(TYPES.O2));
            for (let i = 0; i < n2Count; i++) molecules.push(createMolecule(TYPES.N2));
            time = 0;
        }

        function update() {
            time++;
            const speedFactor = Math.sqrt(temperature / 300);

            // Move molecules
            for (const m of molecules) {
                m.vx += (Math.random() - 0.5) * 0.1 * speedFactor;
                m.vy += (Math.random() - 0.5) * 0.1 * speedFactor;
                m.vx *= 0.99; m.vy *= 0.99;
                m.x += m.vx; m.y += m.vy;
                if (m.x < 10 || m.x > canvas.width - 10) m.vx *= -1;
                if (m.y < 10 || m.y > canvas.height - 10) m.vy *= -1;
                m.x = Math.max(10, Math.min(canvas.width - 10, m.x));
                m.y = Math.max(10, Math.min(canvas.height - 10, m.y));
            }

            // UV photodissociation: O2 + UV -> 2O
            for (let i = molecules.length - 1; i >= 0; i--) {
                if (molecules[i].type === TYPES.O2 && Math.random() < 0.001 * uvIntensity) {
                    const m = molecules[i];
                    molecules.splice(i, 1);
                    molecules.push({ ...createMolecule(TYPES.O), x: m.x, y: m.y });
                    molecules.push({ ...createMolecule(TYPES.O), x: m.x + 5, y: m.y });
                }
            }

            // O3 + UV -> O2 + O
            for (let i = molecules.length - 1; i >= 0; i--) {
                if (molecules[i].type === TYPES.O3 && Math.random() < 0.002 * uvIntensity) {
                    const m = molecules[i];
                    molecules.splice(i, 1);
                    molecules.push({ ...createMolecule(TYPES.O2), x: m.x, y: m.y });
                    molecules.push({ ...createMolecule(TYPES.O), x: m.x + 5, y: m.y });
                }
            }

            // Check collisions for reactions
            for (let i = 0; i < molecules.length; i++) {
                for (let j = i + 1; j < molecules.length; j++) {
                    const m1 = molecules[i], m2 = molecules[j];
                    const dx = m2.x - m1.x, dy = m2.y - m1.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    const minDist = RADII[m1.type] + RADII[m2.type];

                    if (dist < minDist) {
                        // O + O2 -> O3
                        if ((m1.type === TYPES.O && m2.type === TYPES.O2) || (m1.type === TYPES.O2 && m2.type === TYPES.O)) {
                            if (Math.random() < 0.1) {
                                const pos = m1.type === TYPES.O ? m1 : m2;
                                molecules.splice(Math.max(i, j), 1);
                                molecules.splice(Math.min(i, j), 1);
                                molecules.push({ ...createMolecule(TYPES.O3), x: pos.x, y: pos.y });
                                break;
                            }
                        }
                        // N2 + O -> NO + N (simplified)
                        if ((m1.type === TYPES.N2 && m2.type === TYPES.O) || (m1.type === TYPES.O && m2.type === TYPES.N2)) {
                            if (Math.random() < 0.01 * (temperature / 300)) {
                                const pos = m1.type === TYPES.O ? m1 : m2;
                                molecules.splice(Math.max(i, j), 1);
                                molecules.splice(Math.min(i, j), 1);
                                molecules.push({ ...createMolecule(TYPES.NO), x: pos.x, y: pos.y });
                                molecules.push({ ...createMolecule(TYPES.O), x: pos.x + 5, y: pos.y });
                                break;
                            }
                        }
                        // NO + O -> NO2
                        if ((m1.type === TYPES.NO && m2.type === TYPES.O) || (m1.type === TYPES.O && m2.type === TYPES.NO)) {
                            if (Math.random() < 0.15) {
                                const pos = m1.type === TYPES.NO ? m1 : m2;
                                molecules.splice(Math.max(i, j), 1);
                                molecules.splice(Math.min(i, j), 1);
                                molecules.push({ ...createMolecule(TYPES.NO2), x: pos.x, y: pos.y });
                                break;
                            }
                        }
                    }
                }
            }
        }

        function draw() {
            ctx.fillStyle = '#0a0a1a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // UV glow at top
            const gradient = ctx.createLinearGradient(0, 0, 0, 50);
            gradient.addColorStop(0, `rgba(138, 43, 226, ${uvIntensity * 0.3})`);
            gradient.addColorStop(1, 'transparent');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, 50);

            for (const m of molecules) {
                ctx.beginPath();
                ctx.arc(m.x, m.y, RADII[m.type], 0, Math.PI * 2);
                ctx.fillStyle = COLORS[m.type];
                ctx.fill();
                ctx.fillStyle = '#000';
                ctx.font = '8px sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(m.type, m.x, m.y);
            }
        }

        function updateStats() {
            const counts = {};
            for (const type of Object.values(TYPES)) counts[type] = 0;
            for (const m of molecules) counts[m.type]++;
            document.getElementById('statO2').textContent = counts.O2;
            document.getElementById('statN2').textContent = counts.N2;
            document.getElementById('statO3').textContent = counts.O3;
            document.getElementById('statO').textContent = counts.O;
            document.getElementById('statNO').textContent = counts.NO;
            document.getElementById('statNO2').textContent = counts.NO2;
            document.getElementById('time').textContent = time;
        }

        function animate() {
            if (running) update();
            draw();
            updateStats();
            requestAnimationFrame(animate);
        }

        function reset() {
            running = false;
            document.getElementById('startBtn').textContent = 'Start';
            uvIntensity = parseInt(document.getElementById('uvIntensity').value) / 100;
            temperature = parseInt(document.getElementById('temperature').value);
            init();
        }

        document.getElementById('startBtn').addEventListener('click', () => {
            running = !running;
            document.getElementById('startBtn').textContent = running ? 'Pause' : 'Start';
        });
        document.getElementById('stepBtn').addEventListener('click', () => { if (!running) update(); });
        document.getElementById('resetBtn').addEventListener('click', reset);
        document.getElementById('o2Count').addEventListener('input', (e) => document.getElementById('o2Val').textContent = e.target.value);
        document.getElementById('n2Count').addEventListener('input', (e) => document.getElementById('n2Val').textContent = e.target.value);
        document.getElementById('uvIntensity').addEventListener('input', (e) => {
            uvIntensity = parseInt(e.target.value) / 100;
            document.getElementById('uvVal').textContent = e.target.value + '%';
        });
        document.getElementById('temperature').addEventListener('input', (e) => {
            temperature = parseInt(e.target.value);
            document.getElementById('tempVal').textContent = e.target.value;
        });

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        reset();

        // Modal functionality
        const modal = document.getElementById('explainModal');
        document.getElementById('explainBtn').addEventListener('click', () => {
            modal.classList.add('active');
        });
        modal.querySelector('.modal-close').addEventListener('click', () => {
            modal.classList.remove('active');
        });
        modal.addEventListener('click', (e) => {
            if (e.target === modal) modal.classList.remove('active');
        });
        animate();
    </script>
</body>
</html>
