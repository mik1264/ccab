<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deep Sea Vents - CCAB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: #0a0a1a; color: #e8e6e1; overflow: hidden; }
        #container { display: flex; height: 100vh; }
        #canvas-container { flex: 1; position: relative; }
        canvas { display: block; width: 100%; height: 100%; }
        #controls { width: 300px; background: rgba(0,0,0,0.9); padding: 20px; overflow-y: auto; }
        h1 { font-size: 1.2rem; margin-bottom: 15px; color: #f97316; }
        .control-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.8rem; margin-bottom: 5px; color: #aaa; }
        input[type="range"] { width: 100%; }
        button { width: 100%; padding: 10px; margin-bottom: 10px; background: #f97316; color: #fff; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        button:hover { background: #ea580c; }
        .stats { background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px; font-size: 0.8rem; margin-bottom: 15px; }
        .back-link { position: fixed; top: 10px; left: 10px; padding: 8px 16px; background: rgba(0,0,0,0.7); color: #f97316; text-decoration: none; border-radius: 6px; font-size: 14px; z-index: 999; }
        .explain-btn { background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); margin-top: 10px; }
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 1000; }
        .modal-overlay.active { display: flex; align-items: center; justify-content: center; }
        .modal { background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%); border-radius: 16px; padding: 30px; max-width: 600px; max-height: 80vh; overflow-y: auto; border: 1px solid rgba(255,255,255,0.1); position: relative; }
        .modal-close { position: absolute; top: 15px; right: 20px; background: none; border: none; color: #888; font-size: 28px; cursor: pointer; width: auto; }
        .modal h2 { color: #f97316; margin-bottom: 20px; }
        .modal-body { color: #ccc; line-height: 1.8; }
        .modal-body h3 { color: #fdba74; margin: 20px 0 10px; }
        .modal-body strong { color: #f97316; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Gallery</a>
    <div id="container">
        <div id="canvas-container"><canvas id="canvas"></canvas></div>
        <div id="controls">
            <h1>Deep Sea Vents</h1>
            <div class="control-group">
                <label>Vent Activity: <span id="activityValue">0.5</span></label>
                <input type="range" id="activity" min="0.1" max="1.0" step="0.05" value="0.5">
            </div>
            <div class="control-group">
                <label>Chemical Gradient: <span id="gradientValue">0.6</span></label>
                <input type="range" id="gradient" min="0.2" max="1.0" step="0.05" value="0.6">
            </div>
            <div class="control-group">
                <label>Organism Density: <span id="densityValue">100</span></label>
                <input type="range" id="density" min="20" max="300" value="100">
            </div>
            <button id="reset">Reset Ecosystem</button>
            <button id="eruption">Volcanic Eruption</button>
            <button id="explainBtn" class="explain-btn">üìö Explain</button>
            <div class="stats">
                <div>Bacteria: <span id="bacteriaCount">0</span></div>
                <div>Tube Worms: <span id="tubeWormCount">0</span></div>
                <div>Crabs/Shrimp: <span id="crabCount">0</span></div>
                <div>Chemical Energy: <span id="chemEnergy">0</span></div>
                <div>Temperature: <span id="temperature">0</span>¬∞C</div>
            </div>
        </div>
    </div>
    <div id="explainModal" class="modal-overlay">
        <div class="modal">
            <button class="modal-close">&times;</button>
            <h2>üåã Deep Sea Hydrothermal Vents</h2>
            <div class="modal-body">
                <p><strong>Hydrothermal vents</strong> are underwater hot springs where mineral-rich superheated water emerges from the seafloor.</p>
                <h3>Chemosynthesis</h3>
                <ul>
                    <li>Unlike photosynthesis, uses chemical energy</li>
                    <li>Bacteria oxidize hydrogen sulfide (H‚ÇÇS)</li>
                    <li>Forms base of food web in total darkness</li>
                    <li>Primary productivity rivals tropical forests</li>
                </ul>
                <h3>Vent Communities</h3>
                <ul>
                    <li><strong>Bacteria:</strong> Chemosynthetic producers, free-living and symbiotic</li>
                    <li><strong>Tube worms:</strong> Host symbiotic bacteria, can grow rapidly</li>
                    <li><strong>Crabs/shrimp:</strong> Graze on bacteria, scavenge</li>
                    <li><strong>Fish/octopods:</strong> Top predators</li>
                </ul>
                <h3>Ephemeral Habitats</h3>
                <p>Vents are temporary (decades to centuries). Species must colonize new vents as old ones die‚Äîisland biogeography in the deep.</p>
            </div>
        </div>
    </div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let params = { activity: 0.5, gradient: 0.6, density: 100 };
        let vents = [], organisms = [], particles = [];
        
        function resize() { canvas.width = document.getElementById('canvas-container').clientWidth; canvas.height = document.getElementById('canvas-container').clientHeight; }
        function init() {
            resize();
            vents = [];
            organisms = [];
            particles = [];
            // Create vents
            const numVents = 2 + Math.floor(Math.random() * 3);
            for (let i = 0; i < numVents; i++) {
                vents.push({
                    x: 100 + Math.random() * (canvas.width - 200),
                    y: canvas.height - 50,
                    activity: 0.5 + Math.random() * 0.5,
                    size: 30 + Math.random() * 40
                });
            }
            // Create organisms
            for (let i = 0; i < params.density; i++) {
                const type = Math.random();
                let org;
                if (type < 0.5) {
                    // Bacteria (small, numerous)
                    org = { type: 'bacteria', x: Math.random() * canvas.width, y: canvas.height - 100 - Math.random() * 200, size: 2, energy: 50 };
                } else if (type < 0.8) {
                    // Tube worms (near vents)
                    const vent = vents[Math.floor(Math.random() * vents.length)];
                    org = { type: 'tubeworm', x: vent.x + (Math.random() - 0.5) * 100, y: canvas.height - 60 - Math.random() * 50, size: 15 + Math.random() * 20, energy: 80 };
                } else {
                    // Crabs/shrimp
                    org = { type: 'crab', x: Math.random() * canvas.width, y: canvas.height - 80 - Math.random() * 150, size: 8, energy: 60, vx: 0, vy: 0 };
                }
                organisms.push(org);
            }
        }
        function eruption() {
            // Kill organisms near vents
            organisms = organisms.filter(o => {
                for (let v of vents) {
                    const dx = o.x - v.x, dy = o.y - v.y;
                    if (Math.sqrt(dx*dx + dy*dy) < 150) return Math.random() > 0.7;
                }
                return true;
            });
            // Increase vent activity temporarily
            for (let v of vents) v.activity = 1.0;
        }
        function update() {
            // Vent particles
            for (let v of vents) {
                if (Math.random() < v.activity * params.activity * 0.5) {
                    particles.push({
                        x: v.x + (Math.random() - 0.5) * v.size,
                        y: v.y,
                        vx: (Math.random() - 0.5) * 2,
                        vy: -2 - Math.random() * 3,
                        life: 100 + Math.random() * 100,
                        temp: 300 + Math.random() * 100
                    });
                }
            }
            // Update particles
            particles = particles.filter(p => {
                p.x += p.vx;
                p.y += p.vy;
                p.vy *= 0.98;
                p.temp *= 0.995;
                p.life--;
                return p.life > 0 && p.y > 0;
            });
            // Update organisms
            for (let o of organisms) {
                // Calculate chemical energy from nearby vents
                let chemEnergy = 0;
                for (let v of vents) {
                    const dx = o.x - v.x, dy = o.y - v.y;
                    const dist = Math.sqrt(dx*dx + dy*dy);
                    chemEnergy += v.activity * params.gradient * 100 / (1 + dist * 0.02);
                }
                if (o.type === 'bacteria') {
                    // Bacteria gain energy from chemicals
                    o.energy += chemEnergy * 0.01;
                    // Random movement
                    o.x += (Math.random() - 0.5) * 2;
                    o.y += (Math.random() - 0.5) * 2;
                    // Reproduce
                    if (o.energy > 100 && organisms.length < params.density * 2) {
                        organisms.push({ type: 'bacteria', x: o.x + (Math.random()-0.5)*10, y: o.y + (Math.random()-0.5)*10, size: 2, energy: 50 });
                        o.energy = 50;
                    }
                } else if (o.type === 'tubeworm') {
                    // Tube worms have symbiotic bacteria
                    o.energy += chemEnergy * 0.005;
                    // Grow slowly
                    if (o.energy > 120) {
                        o.size = Math.min(40, o.size + 0.1);
                        o.energy = 100;
                    }
                } else if (o.type === 'crab') {
                    // Crabs move and graze
                    o.vx += (Math.random() - 0.5) * 0.5;
                    o.vy += (Math.random() - 0.5) * 0.3;
                    o.vx *= 0.95; o.vy *= 0.95;
                    o.x += o.vx; o.y += o.vy;
                    // Eat bacteria
                    for (let i = organisms.length - 1; i >= 0; i--) {
                        if (organisms[i].type === 'bacteria') {
                            const dx = o.x - organisms[i].x, dy = o.y - organisms[i].y;
                            if (dx*dx + dy*dy < 100) {
                                o.energy += 20;
                                organisms.splice(i, 1);
                                break;
                            }
                        }
                    }
                }
                // Energy decay and death
                o.energy -= 0.1;
                // Boundaries
                o.x = Math.max(20, Math.min(canvas.width - 20, o.x));
                o.y = Math.max(100, Math.min(canvas.height - 30, o.y));
            }
            organisms = organisms.filter(o => o.energy > 0);
            // Decay vent activity back to base
            for (let v of vents) v.activity = Math.max(0.5, v.activity * 0.999);
        }
        function draw() {
            // Dark ocean gradient
            const grad = ctx.createLinearGradient(0, 0, 0, canvas.height);
            grad.addColorStop(0, '#000005');
            grad.addColorStop(1, '#0a0a1a');
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            // Seafloor
            ctx.fillStyle = '#1f1f1f';
            ctx.fillRect(0, canvas.height - 40, canvas.width, 40);
            // Draw vents (chimneys)
            for (let v of vents) {
                ctx.fillStyle = '#333';
                ctx.beginPath();
                ctx.moveTo(v.x - v.size/2, canvas.height - 40);
                ctx.lineTo(v.x - v.size/3, canvas.height - 40 - v.size);
                ctx.lineTo(v.x + v.size/3, canvas.height - 40 - v.size);
                ctx.lineTo(v.x + v.size/2, canvas.height - 40);
                ctx.fill();
                // Glow
                const glow = ctx.createRadialGradient(v.x, v.y - v.size, 0, v.x, v.y - v.size, v.size * 2);
                glow.addColorStop(0, `rgba(255, 100, 0, ${v.activity * 0.3})`);
                glow.addColorStop(1, 'rgba(255, 100, 0, 0)');
                ctx.fillStyle = glow;
                ctx.fillRect(v.x - v.size*2, v.y - v.size*3, v.size*4, v.size*3);
            }
            // Draw particles (black smoker plume)
            for (let p of particles) {
                const alpha = p.life / 200;
                const colorVal = Math.floor(p.temp / 4);
                ctx.beginPath();
                ctx.arc(p.x, p.y, 3 + (200 - p.life) * 0.02, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(${Math.min(255, colorVal)}, ${Math.floor(colorVal/4)}, 0, ${alpha})`;
                ctx.fill();
            }
            // Draw organisms
            let bacteriaCount = 0, tubeWormCount = 0, crabCount = 0;
            for (let o of organisms) {
                if (o.type === 'bacteria') {
                    bacteriaCount++;
                    ctx.beginPath();
                    ctx.arc(o.x, o.y, o.size, 0, Math.PI * 2);
                    ctx.fillStyle = '#22d3ee';
                    ctx.fill();
                } else if (o.type === 'tubeworm') {
                    tubeWormCount++;
                    // Tube
                    ctx.fillStyle = '#666';
                    ctx.fillRect(o.x - 3, o.y, 6, canvas.height - 40 - o.y);
                    // Plume
                    ctx.beginPath();
                    ctx.arc(o.x, o.y - 5, 8, 0, Math.PI, true);
                    ctx.fillStyle = '#ef4444';
                    ctx.fill();
                } else if (o.type === 'crab') {
                    crabCount++;
                    ctx.beginPath();
                    ctx.ellipse(o.x, o.y, o.size, o.size * 0.6, 0, 0, Math.PI * 2);
                    ctx.fillStyle = '#fbbf24';
                    ctx.fill();
                    // Legs
                    ctx.strokeStyle = '#fbbf24';
                    ctx.lineWidth = 1;
                    for (let i = 0; i < 4; i++) {
                        ctx.beginPath();
                        ctx.moveTo(o.x - o.size * 0.8, o.y);
                        ctx.lineTo(o.x - o.size * 1.5, o.y + (i - 1.5) * 3);
                        ctx.moveTo(o.x + o.size * 0.8, o.y);
                        ctx.lineTo(o.x + o.size * 1.5, o.y + (i - 1.5) * 3);
                        ctx.stroke();
                    }
                }
            }
            // Stats
            let totalChem = 0;
            for (let v of vents) totalChem += v.activity * 100;
            document.getElementById('bacteriaCount').textContent = bacteriaCount;
            document.getElementById('tubeWormCount').textContent = tubeWormCount;
            document.getElementById('crabCount').textContent = crabCount;
            document.getElementById('chemEnergy').textContent = totalChem.toFixed(0);
            document.getElementById('temperature').textContent = (vents[0]?.activity * 350 || 0).toFixed(0);
        }
        function animate() { update(); draw(); requestAnimationFrame(animate); }
        document.getElementById('activity').addEventListener('input', e => { params.activity = parseFloat(e.target.value); document.getElementById('activityValue').textContent = params.activity.toFixed(2); });
        document.getElementById('gradient').addEventListener('input', e => { params.gradient = parseFloat(e.target.value); document.getElementById('gradientValue').textContent = params.gradient.toFixed(2); });
        document.getElementById('density').addEventListener('input', e => { params.density = parseInt(e.target.value); document.getElementById('densityValue').textContent = params.density; });
        document.getElementById('reset').addEventListener('click', init);
        document.getElementById('eruption').addEventListener('click', eruption);
        window.addEventListener('resize', () => { resize(); init(); });
        const modal = document.getElementById('explainModal');
        document.getElementById('explainBtn').addEventListener('click', () => modal.classList.add('active'));
        modal.querySelector('.modal-close').addEventListener('click', () => modal.classList.remove('active'));
        modal.addEventListener('click', e => { if (e.target === modal) modal.classList.remove('active'); });
        init(); animate();
    </script>
    <script src="../../assets/js/enhance.js" defer></script>
</body>
</html>
