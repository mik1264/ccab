<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Learning - CCAB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a2e;
            color: #e8e6e1;
            overflow: hidden;
        }
        #container { display: flex; height: 100vh; }
        #canvas-container { flex: 1; position: relative; }
        canvas { display: block; width: 100%; height: 100%; }
        #controls {
            width: 300px;
            background: rgba(0,0,0,0.8);
            padding: 20px;
            overflow-y: auto;
        }
        h1 { font-size: 1.2rem; margin-bottom: 15px; color: #a78bfa; }
        .control-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.8rem; margin-bottom: 5px; color: #aaa; }
        input[type="range"] { width: 100%; margin-bottom: 5px; }
        button {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            background: #a78bfa;
            color: #1a1a2e;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover { background: #8b5cf6; }
        .stats {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            margin-bottom: 15px;
        }
        .stats div { margin-bottom: 5px; }
        .back-link {
            position: fixed;
            top: 10px;
            left: 10px;
            padding: 8px 16px;
            background: rgba(0,0,0,0.7);
            color: #a78bfa;
            text-decoration: none;
            border-radius: 6px;
            font-size: 14px;
            z-index: 999;
        }
        .back-link:hover { background: rgba(167,139,250,0.2); }
        .legend { margin-top: 15px; font-size: 0.75rem; }
        .legend-item { display: flex; align-items: center; margin-bottom: 5px; }
        .legend-color { width: 15px; height: 15px; margin-right: 8px; border-radius: 3px; }
        .chart-container {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 10px;
            margin-top: 15px;
        }
        .chart-title { font-size: 0.8rem; color: #888; margin-bottom: 8px; }
        .bar-chart { display: flex; gap: 3px; height: 80px; align-items: flex-end; }
        .bar-group { flex: 1; display: flex; flex-direction: column; align-items: center; }
        .bar { width: 100%; transition: height 0.3s; }
        .bar-label { font-size: 0.6rem; color: #666; margin-top: 4px; text-align: center; }
        .explain-btn {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            margin-top: 10px;
        }
        .explain-btn:hover {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        }
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
        }
        .modal-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal {
            background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%);
            border-radius: 16px;
            padding: 30px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: #888;
            font-size: 28px;
            cursor: pointer;
            width: auto;
            padding: 0;
        }
        .modal-close:hover { color: #fff; }
        .modal h2 { color: #a78bfa; margin-bottom: 20px; font-size: 1.5rem; }
        .modal-body { color: #ccc; line-height: 1.8; font-size: 0.95rem; }
        .modal-body h3 { color: #c4b5fd; margin: 20px 0 10px 0; font-size: 1.1rem; }
        .modal-body p { margin-bottom: 15px; }
        .modal-body ul { margin: 10px 0 15px 20px; }
        .modal-body li { margin-bottom: 8px; }
        .modal-body strong { color: #a78bfa; }
        .modal-body em { color: #c4b5fd; font-style: normal; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Gallery</a>

    <div id="container">
        <div id="canvas-container">
            <canvas id="canvas"></canvas>
        </div>
        <div id="controls">
            <h1>Social Learning</h1>

            <div class="control-group">
                <label>Population Size: <span id="popSizeValue">80</span></label>
                <input type="range" id="popSize" min="20" max="200" value="80">
            </div>

            <div class="control-group">
                <label>Social Learning Rate: <span id="socialLearnValue">0.6</span></label>
                <input type="range" id="socialLearn" min="0" max="1.0" step="0.05" value="0.6">
            </div>

            <div class="control-group">
                <label>Conformist Bias: <span id="conformistValue">0.5</span></label>
                <input type="range" id="conformist" min="0" max="1.0" step="0.05" value="0.5">
            </div>

            <div class="control-group">
                <label>Prestige Bias: <span id="prestigeValue">0.3</span></label>
                <input type="range" id="prestige" min="0" max="1.0" step="0.05" value="0.3">
            </div>

            <div class="control-group">
                <label>Environment Change: <span id="envChangeValue">0.1</span></label>
                <input type="range" id="envChange" min="0" max="0.5" step="0.02" value="0.1">
            </div>

            <button id="reset">Reset Simulation</button>
            <button id="changeEnv">Change Environment</button>
            <button id="explainBtn" class="explain-btn">üìö Explain</button>

            <div class="stats">
                <div>Generation: <span id="generation">0</span></div>
                <div>Avg Fitness: <span id="avgFitness">0</span></div>
                <div>Cultural Diversity: <span id="diversity">0</span></div>
                <div>Dominant Trait: <span id="dominant">-</span></div>
                <div>Innovation Events: <span id="innovations">0</span></div>
            </div>

            <div class="chart-container">
                <div class="chart-title">Cultural Trait Distribution</div>
                <div class="bar-chart" id="traitChart"></div>
            </div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #ef4444;"></div>
                    <span>Trait A (red)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #22c55e;"></div>
                    <span>Trait B (green)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #3b82f6;"></div>
                    <span>Trait C (blue)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f59e0b;"></div>
                    <span>Trait D (orange)</span>
                </div>
            </div>
        </div>
    </div>

    <div id="explainModal" class="modal-overlay">
        <div class="modal">
            <button class="modal-close">&times;</button>
            <h2>üß† Social Learning & Cultural Transmission</h2>
            <div class="modal-body">
                <p>This simulation models how <strong>cultural traits</strong> spread through populations via social learning. Unlike genetic inheritance, cultural traits can spread horizontally between unrelated individuals.</p>

                <h3>Learning Strategies</h3>
                <ul>
                    <li><strong>Individual Learning:</strong> Trial and error ‚Äî costly but accurate</li>
                    <li><strong>Social Learning:</strong> Copy others ‚Äî cheap but may copy mistakes</li>
                    <li><strong>Conformist Bias:</strong> Copy the most common behavior</li>
                    <li><strong>Prestige Bias:</strong> Copy successful/high-status individuals</li>
                </ul>

                <h3>Why Social Learning Evolves</h3>
                <p>Social learning allows individuals to acquire adaptive knowledge "cheaply" without personal trial-and-error costs. However, it can spread maladaptive behaviors too:</p>
                <ul>
                    <li>In stable environments: Social learning is highly advantageous</li>
                    <li>In changing environments: Individual learning becomes valuable</li>
                    <li>Mixed strategies often evolve: "Learn socially, but verify"</li>
                </ul>

                <h3>Conformist vs. Prestige Bias</h3>
                <p><strong>Conformist bias</strong> (copy the majority) tends to:</p>
                <ul>
                    <li>Homogenize within groups, differentiate between groups</li>
                    <li>Stabilize cultural traits against random variation</li>
                    <li>Resist invasion by rare variants (even good ones)</li>
                </ul>
                <p><strong>Prestige bias</strong> (copy the successful) tends to:</p>
                <ul>
                    <li>Spread adaptive innovations faster</li>
                    <li>Create "rich get richer" dynamics</li>
                    <li>Allow rare successful traits to spread</li>
                </ul>

                <h3>Try This</h3>
                <ul>
                    <li>High <em>Conformist Bias</em>: Watch culture homogenize</li>
                    <li>High <em>Prestige Bias</em>: Watch successful traits spread</li>
                    <li>Click <em>Change Environment</em> to see adaptation dynamics</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        const TRAITS = ['A', 'B', 'C', 'D'];
        const TRAIT_COLORS = {
            'A': '#ef4444',
            'B': '#22c55e',
            'C': '#3b82f6',
            'D': '#f59e0b'
        };

        let params = {
            popSize: 80,
            socialLearn: 0.6,
            conformist: 0.5,
            prestige: 0.3,
            envChange: 0.1
        };

        let agents = [];
        let optimalTrait = 'A';
        let generation = 0;
        let innovations = 0;

        function resize() {
            const container = document.getElementById('canvas-container');
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
        }

        function createAgent(x, y) {
            return {
                x: x || Math.random() * canvas.width,
                y: y || Math.random() * canvas.height,
                vx: (Math.random() - 0.5) * 2,
                vy: (Math.random() - 0.5) * 2,
                trait: TRAITS[Math.floor(Math.random() * TRAITS.length)],
                fitness: 0,
                prestige: Math.random(),
                learningHistory: []
            };
        }

        function init() {
            resize();
            agents = [];
            generation = 0;
            innovations = 0;
            optimalTrait = TRAITS[Math.floor(Math.random() * TRAITS.length)];

            for (let i = 0; i < params.popSize; i++) {
                agents.push(createAgent());
            }

            updateChart();
        }

        function calculateFitness(agent) {
            // Fitness based on having optimal trait
            const basefit = agent.trait === optimalTrait ? 1 : 0.3;
            return basefit;
        }

        function getTraitFrequencies() {
            const freq = {};
            for (let t of TRAITS) freq[t] = 0;
            for (let agent of agents) {
                freq[agent.trait]++;
            }
            return freq;
        }

        function socialLearn(agent) {
            // Find nearby agents to learn from
            const neighbors = [];
            for (let other of agents) {
                if (other !== agent) {
                    const dx = other.x - agent.x;
                    const dy = other.y - agent.y;
                    if (dx * dx + dy * dy < 100 * 100) {
                        neighbors.push(other);
                    }
                }
            }

            if (neighbors.length === 0) return;

            // Decide learning strategy
            const r = Math.random();

            if (r < params.conformist) {
                // Conformist bias: copy most common trait among neighbors
                const traitCounts = {};
                for (let t of TRAITS) traitCounts[t] = 0;
                for (let n of neighbors) {
                    traitCounts[n.trait]++;
                }
                let maxTrait = agent.trait;
                let maxCount = 0;
                for (let t of TRAITS) {
                    if (traitCounts[t] > maxCount) {
                        maxCount = traitCounts[t];
                        maxTrait = t;
                    }
                }
                if (maxTrait !== agent.trait) {
                    agent.trait = maxTrait;
                }
            } else if (r < params.conformist + params.prestige) {
                // Prestige bias: copy most successful neighbor
                let bestNeighbor = null;
                let bestFitness = -1;
                for (let n of neighbors) {
                    if (n.fitness > bestFitness) {
                        bestFitness = n.fitness;
                        bestNeighbor = n;
                    }
                }
                if (bestNeighbor && bestNeighbor.fitness > agent.fitness) {
                    agent.trait = bestNeighbor.trait;
                }
            } else {
                // Random social learning
                const model = neighbors[Math.floor(Math.random() * neighbors.length)];
                agent.trait = model.trait;
            }
        }

        function individualLearn(agent) {
            // Innovation: randomly discover new trait
            if (Math.random() < 0.01) {
                const newTrait = TRAITS[Math.floor(Math.random() * TRAITS.length)];
                if (newTrait !== agent.trait) {
                    agent.trait = newTrait;
                    innovations++;
                }
            }
        }

        function updateAgent(agent) {
            // Calculate fitness
            agent.fitness = calculateFitness(agent);
            agent.prestige = agent.prestige * 0.9 + agent.fitness * 0.1;

            // Learning
            if (Math.random() < params.socialLearn) {
                socialLearn(agent);
            } else {
                individualLearn(agent);
            }

            // Movement
            agent.vx += (Math.random() - 0.5) * 0.3;
            agent.vy += (Math.random() - 0.5) * 0.3;
            agent.vx *= 0.95;
            agent.vy *= 0.95;
            agent.x += agent.vx;
            agent.y += agent.vy;

            // Boundaries
            if (agent.x < 0 || agent.x > canvas.width) agent.vx *= -1;
            if (agent.y < 0 || agent.y > canvas.height) agent.vy *= -1;
            agent.x = Math.max(0, Math.min(canvas.width, agent.x));
            agent.y = Math.max(0, Math.min(canvas.height, agent.y));
        }

        function changeEnvironment() {
            // Change optimal trait
            const oldOptimal = optimalTrait;
            while (optimalTrait === oldOptimal) {
                optimalTrait = TRAITS[Math.floor(Math.random() * TRAITS.length)];
            }
        }

        function updateChart() {
            const freq = getTraitFrequencies();
            const total = agents.length || 1;
            const chartDiv = document.getElementById('traitChart');
            chartDiv.innerHTML = '';

            for (let t of TRAITS) {
                const height = (freq[t] / total) * 100;
                const isOptimal = t === optimalTrait;
                const div = document.createElement('div');
                div.className = 'bar-group';
                div.innerHTML = `
                    <div class="bar" style="background: ${TRAIT_COLORS[t]}; height: ${height}%; opacity: ${isOptimal ? 1 : 0.5}"></div>
                    <div class="bar-label">${t}${isOptimal ? '*' : ''}</div>
                `;
                chartDiv.appendChild(div);
            }
        }

        function draw() {
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw optimal trait indicator
            ctx.fillStyle = TRAIT_COLORS[optimalTrait];
            ctx.globalAlpha = 0.1;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.globalAlpha = 1;

            ctx.font = '16px sans-serif';
            ctx.fillStyle = '#888';
            ctx.fillText(`Optimal: Trait ${optimalTrait}`, 10, 30);

            // Update and draw agents
            for (let agent of agents) {
                updateAgent(agent);

                const size = 5 + agent.prestige * 8;
                ctx.beginPath();
                ctx.arc(agent.x, agent.y, size, 0, Math.PI * 2);
                ctx.fillStyle = TRAIT_COLORS[agent.trait];
                ctx.fill();

                // Fitness ring
                if (agent.fitness > 0.5) {
                    ctx.beginPath();
                    ctx.arc(agent.x, agent.y, size + 3, 0, Math.PI * 2);
                    ctx.strokeStyle = `rgba(255,255,255,${agent.fitness * 0.5})`;
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
            }

            // Environmental change
            if (Math.random() < params.envChange * 0.01) {
                changeEnvironment();
            }

            generation++;

            // Update stats
            const freq = getTraitFrequencies();
            const avgFitness = agents.reduce((s, a) => s + a.fitness, 0) / agents.length;
            
            // Shannon diversity
            let diversity = 0;
            for (let t of TRAITS) {
                const p = freq[t] / agents.length;
                if (p > 0) diversity -= p * Math.log(p);
            }
            diversity = diversity / Math.log(TRAITS.length); // Normalize to 0-1

            // Find dominant trait
            let dominant = 'A';
            let maxCount = 0;
            for (let t of TRAITS) {
                if (freq[t] > maxCount) {
                    maxCount = freq[t];
                    dominant = t;
                }
            }

            document.getElementById('generation').textContent = generation;
            document.getElementById('avgFitness').textContent = avgFitness.toFixed(2);
            document.getElementById('diversity').textContent = diversity.toFixed(2);
            document.getElementById('dominant').textContent = `${dominant} (${((freq[dominant]/agents.length)*100).toFixed(0)}%)`;
            document.getElementById('innovations').textContent = innovations;

            if (generation % 30 === 0) updateChart();
        }

        function animate() {
            draw();
            requestAnimationFrame(animate);
        }

        // Event listeners
        document.getElementById('popSize').addEventListener('input', (e) => {
            params.popSize = parseInt(e.target.value);
            document.getElementById('popSizeValue').textContent = params.popSize;
        });

        document.getElementById('socialLearn').addEventListener('input', (e) => {
            params.socialLearn = parseFloat(e.target.value);
            document.getElementById('socialLearnValue').textContent = params.socialLearn.toFixed(2);
        });

        document.getElementById('conformist').addEventListener('input', (e) => {
            params.conformist = parseFloat(e.target.value);
            document.getElementById('conformistValue').textContent = params.conformist.toFixed(2);
        });

        document.getElementById('prestige').addEventListener('input', (e) => {
            params.prestige = parseFloat(e.target.value);
            document.getElementById('prestigeValue').textContent = params.prestige.toFixed(2);
        });

        document.getElementById('envChange').addEventListener('input', (e) => {
            params.envChange = parseFloat(e.target.value);
            document.getElementById('envChangeValue').textContent = params.envChange.toFixed(2);
        });

        document.getElementById('reset').addEventListener('click', init);
        document.getElementById('changeEnv').addEventListener('click', changeEnvironment);

        window.addEventListener('resize', () => { resize(); init(); });

        const modal = document.getElementById('explainModal');
        document.getElementById('explainBtn').addEventListener('click', () => modal.classList.add('active'));
        modal.querySelector('.modal-close').addEventListener('click', () => modal.classList.remove('active'));
        modal.addEventListener('click', (e) => { if (e.target === modal) modal.classList.remove('active'); });

        init();
        animate();
    </script>
</body>
</html>
