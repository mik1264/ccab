<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vaccination Strategies - CCAB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: #1a1a2e; color: #e8e6e1; overflow: hidden; }
        #container { display: flex; height: 100vh; }
        #canvas-container { flex: 1; position: relative; }
        canvas { display: block; width: 100%; height: 100%; }
        #controls { width: 300px; background: rgba(0,0,0,0.8); padding: 20px; overflow-y: auto; }
        h1 { font-size: 1.2rem; margin-bottom: 15px; color: #22c55e; }
        .control-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.8rem; margin-bottom: 5px; color: #aaa; }
        input[type="range"] { width: 100%; }
        select { width: 100%; padding: 8px; border-radius: 5px; background: #374151; color: #fff; border: none; }
        button { width: 100%; padding: 10px; margin-bottom: 10px; background: #22c55e; color: #1a1a2e; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        button:hover { background: #16a34a; }
        .stats { background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px; font-size: 0.8rem; margin-bottom: 15px; }
        .back-link { position: fixed; top: 10px; left: 10px; padding: 8px 16px; background: rgba(0,0,0,0.7); color: #22c55e; text-decoration: none; border-radius: 6px; font-size: 14px; z-index: 999; }
        .explain-btn { background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); margin-top: 10px; }
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 1000; }
        .modal-overlay.active { display: flex; align-items: center; justify-content: center; }
        .modal { background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%); border-radius: 16px; padding: 30px; max-width: 600px; max-height: 80vh; overflow-y: auto; border: 1px solid rgba(255,255,255,0.1); position: relative; }
        .modal-close { position: absolute; top: 15px; right: 20px; background: none; border: none; color: #888; font-size: 28px; cursor: pointer; width: auto; }
        .modal h2 { color: #22c55e; margin-bottom: 20px; }
        .modal-body { color: #ccc; line-height: 1.8; }
        .modal-body h3 { color: #4ade80; margin: 20px 0 10px; }
        .modal-body strong { color: #22c55e; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Gallery</a>
    <div id="container">
        <div id="canvas-container"><canvas id="canvas"></canvas></div>
        <div id="controls">
            <h1>Vaccination Strategies</h1>
            <div class="control-group">
                <label>Strategy:</label>
                <select id="strategy">
                    <option value="random">Random Vaccination</option>
                    <option value="ring">Ring Vaccination</option>
                    <option value="hub">Target Hubs (High-Degree)</option>
                    <option value="elderly">Priority by Age</option>
                </select>
            </div>
            <div class="control-group">
                <label>Vaccine Supply: <span id="supplyValue">30%</span></label>
                <input type="range" id="supply" min="0.1" max="0.8" step="0.05" value="0.3">
            </div>
            <div class="control-group">
                <label>Vaccine Efficacy: <span id="efficacyValue">90%</span></label>
                <input type="range" id="efficacy" min="0.5" max="1.0" step="0.05" value="0.9">
            </div>
            <button id="reset">Reset</button>
            <button id="vaccinate">Vaccinate Now</button>
            <button id="explainBtn" class="explain-btn">üìö Explain</button>
            <div class="stats">
                <div>Vaccinated: <span id="vaccinated">0</span></div>
                <div>Susceptible: <span id="susceptible">0</span></div>
                <div>Infected: <span id="infected">0</span></div>
                <div>Recovered: <span id="recovered">0</span></div>
                <div>Total Cases: <span id="cases">0</span></div>
                <div>Herd Immunity: <span id="herd">0%</span></div>
            </div>
        </div>
    </div>
    <div id="explainModal" class="modal-overlay">
        <div class="modal">
            <button class="modal-close">&times;</button>
            <h2>üíâ Vaccination Strategies</h2>
            <div class="modal-body">
                <p>Different <strong>vaccination strategies</strong> have different effectiveness depending on disease characteristics and network structure.</p>
                <h3>Strategies</h3>
                <ul>
                    <li><strong>Random:</strong> Simple but not optimal for most diseases</li>
                    <li><strong>Ring:</strong> Vaccinate contacts of cases (good for slow-spreading diseases)</li>
                    <li><strong>Hub targeting:</strong> Prioritize highly connected individuals (very effective)</li>
                    <li><strong>Age-based:</strong> Protect vulnerable populations first</li>
                </ul>
                <h3>Herd Immunity Threshold</h3>
                <p>HIT = 1 - 1/R‚ÇÄ. For measles (R‚ÇÄ‚âà15): 93%. For COVID-19 (R‚ÇÄ‚âà3): 67%.</p>
                <h3>Key Insight</h3>
                <p>Targeting hubs can achieve herd immunity with fewer doses because it breaks the most transmission chains.</p>
            </div>
        </div>
    </div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let params = { strategy: 'random', supply: 0.3, efficacy: 0.9 };
        let nodes = [], edges = [], totalCases = 0;
        const S = 0, V = 1, I = 2, R = 3;
        const COLORS = ['#3b82f6', '#22c55e', '#ef4444', '#6b7280'];
        
        function resize() { canvas.width = document.getElementById('canvas-container').clientWidth; canvas.height = document.getElementById('canvas-container').clientHeight; }
        function init() {
            resize();
            totalCases = 0;
            nodes = [];
            edges = [];
            // Create scale-free network (preferential attachment)
            const n = 100;
            for (let i = 0; i < n; i++) {
                nodes.push({
                    id: i,
                    x: 50 + Math.random() * (canvas.width - 100),
                    y: 50 + Math.random() * (canvas.height - 100),
                    state: S,
                    degree: 0,
                    age: 20 + Math.random() * 60
                });
            }
            // Preferential attachment
            for (let i = 2; i < n; i++) {
                const m = 2; // edges per new node
                const totalDegree = nodes.slice(0, i).reduce((a, n) => a + n.degree + 1, 0);
                for (let j = 0; j < m; j++) {
                    let r = Math.random() * totalDegree;
                    for (let k = 0; k < i; k++) {
                        r -= nodes[k].degree + 1;
                        if (r <= 0) {
                            edges.push({ from: i, to: k });
                            nodes[i].degree++;
                            nodes[k].degree++;
                            break;
                        }
                    }
                }
            }
            // Seed infection
            const highDegree = [...nodes].sort((a, b) => b.degree - a.degree);
            highDegree[5].state = I;
            totalCases = 1;
        }
        function vaccinate() {
            const susceptible = nodes.filter(n => n.state === S);
            const toVaccinate = Math.floor(nodes.length * params.supply);
            let targets = [];
            switch (params.strategy) {
                case 'random':
                    targets = susceptible.sort(() => Math.random() - 0.5).slice(0, toVaccinate);
                    break;
                case 'hub':
                    targets = susceptible.sort((a, b) => b.degree - a.degree).slice(0, toVaccinate);
                    break;
                case 'elderly':
                    targets = susceptible.sort((a, b) => b.age - a.age).slice(0, toVaccinate);
                    break;
                case 'ring':
                    // Vaccinate contacts of infected
                    const contactSet = new Set();
                    for (let edge of edges) {
                        if (nodes[edge.from].state === I) contactSet.add(edge.to);
                        if (nodes[edge.to].state === I) contactSet.add(edge.from);
                    }
                    targets = [...contactSet].map(id => nodes[id]).filter(n => n.state === S).slice(0, toVaccinate);
                    // Fill remainder randomly
                    if (targets.length < toVaccinate) {
                        const remaining = susceptible.filter(n => !targets.includes(n));
                        targets = [...targets, ...remaining.slice(0, toVaccinate - targets.length)];
                    }
                    break;
            }
            for (let t of targets) {
                if (Math.random() < params.efficacy) {
                    t.state = V;
                }
            }
        }
        function update() {
            // Transmission
            for (let edge of edges) {
                const a = nodes[edge.from], b = nodes[edge.to];
                if (a.state === I && b.state === S && Math.random() < 0.03) {
                    b.state = I;
                    totalCases++;
                }
                if (b.state === I && a.state === S && Math.random() < 0.03) {
                    a.state = I;
                    totalCases++;
                }
            }
            // Recovery
            for (let n of nodes) {
                if (n.state === I && Math.random() < 0.05) {
                    n.state = R;
                }
            }
        }
        function draw() {
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            // Draw edges
            for (let edge of edges) {
                const a = nodes[edge.from], b = nodes[edge.to];
                ctx.beginPath();
                ctx.moveTo(a.x, a.y);
                ctx.lineTo(b.x, b.y);
                ctx.strokeStyle = 'rgba(255,255,255,0.1)';
                ctx.stroke();
            }
            // Draw nodes
            for (let n of nodes) {
                const size = 5 + n.degree * 0.5;
                ctx.beginPath();
                ctx.arc(n.x, n.y, size, 0, Math.PI * 2);
                ctx.fillStyle = COLORS[n.state];
                ctx.fill();
            }
            const counts = [0, 0, 0, 0];
            for (let n of nodes) counts[n.state]++;
            const immune = counts[V] + counts[R];
            const herd = (immune / nodes.length * 100).toFixed(0);
            document.getElementById('vaccinated').textContent = counts[V];
            document.getElementById('susceptible').textContent = counts[S];
            document.getElementById('infected').textContent = counts[I];
            document.getElementById('recovered').textContent = counts[R];
            document.getElementById('cases').textContent = totalCases;
            document.getElementById('herd').textContent = herd + '%';
        }
        function animate() { update(); draw(); requestAnimationFrame(animate); }
        document.getElementById('strategy').addEventListener('change', e => { params.strategy = e.target.value; });
        document.getElementById('supply').addEventListener('input', e => { params.supply = parseFloat(e.target.value); document.getElementById('supplyValue').textContent = (params.supply*100).toFixed(0) + '%'; });
        document.getElementById('efficacy').addEventListener('input', e => { params.efficacy = parseFloat(e.target.value); document.getElementById('efficacyValue').textContent = (params.efficacy*100).toFixed(0) + '%'; });
        document.getElementById('reset').addEventListener('click', init);
        document.getElementById('vaccinate').addEventListener('click', vaccinate);
        window.addEventListener('resize', () => { resize(); init(); });
        const modal = document.getElementById('explainModal');
        document.getElementById('explainBtn').addEventListener('click', () => modal.classList.add('active'));
        modal.querySelector('.modal-close').addEventListener('click', () => modal.classList.remove('active'));
        modal.addEventListener('click', e => { if (e.target === modal) modal.classList.remove('active'); });
        init(); animate();
    </script>
    <script src="../../assets/js/enhance.js" defer></script>
</body>
</html>
