<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connected Chemistry - Molecular Bonding</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e8e8e8;
            min-height: 100vh;
            display: flex;
        }
        .sidebar {
            width: 300px;
            background: rgba(0,0,0,0.3);
            padding: 20px;
            overflow-y: auto;
            border-right: 1px solid rgba(255,255,255,0.1);
        }
        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        h1 { font-size: 1.4em; margin-bottom: 5px; color: #ffd93d; }
        .subtitle { font-size: 0.85em; color: #888; margin-bottom: 20px; }
        .control-group { margin-bottom: 15px; }
        .control-group label {
            display: block;
            font-size: 0.85em;
            color: #aaa;
            margin-bottom: 5px;
        }
        .control-group input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }
        .control-group .value {
            font-size: 0.8em;
            color: #ffd93d;
        }
        .buttons { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        button {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s;
        }
        .btn-primary { background: #ffd93d; color: #000; }
        .btn-secondary { background: #444; color: #fff; }
        .btn-danger { background: #e74c3c; color: #fff; }
        button:hover { transform: scale(1.05); }
        .stats {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .stats h3 { font-size: 0.9em; color: #ffd93d; margin-bottom: 10px; }
        .stat-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.85em;
            margin-bottom: 5px;
        }
        .stat-value { color: #ffd93d; }
        .canvas-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        canvas {
            background: #0a0a1a;
            border-radius: 10px;
        }
        .legend {
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .legend h4 { font-size: 0.85em; color: #888; margin-bottom: 8px; }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.75em;
            margin-bottom: 4px;
        }
        .legend-color {
            width: 14px;
            height: 14px;
            border-radius: 50%;
        }
        .back-link {
            display: inline-block;
            color: #ffd93d;
            text-decoration: none;
            margin-bottom: 20px;
            font-size: 0.9em;
        }
        .back-link:hover { text-decoration: underline; }
        .info {
            font-size: 0.75em;
            color: #666;
            line-height: 1.5;
            margin-top: 10px;
        }
        .molecule-counts {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 5px;
            margin-top: 10px;
        }
        .molecule-count {
            background: rgba(0,0,0,0.2);
            padding: 5px 8px;
            border-radius: 3px;
            font-size: 0.8em;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <a href="index.html" class="back-link">‚Üê Back to Gallery</a>
        <h1>Connected Chemistry</h1>
        <p class="subtitle">Molecular Bonding Simulation</p>

        <div class="buttons">
            <button class="btn-primary" id="startBtn">Start</button>
            <button class="btn-secondary" id="stepBtn">Step</button>
            <button class="btn-danger" id="resetBtn">Reset</button>
        </div>

        <div class="control-group">
            <label>Hydrogen (H): <span class="value" id="hVal">30</span></label>
            <input type="range" id="hydrogen" min="0" max="60" value="30">
        </div>

        <div class="control-group">
            <label>Oxygen (O): <span class="value" id="oVal">10</span></label>
            <input type="range" id="oxygen" min="0" max="30" value="10">
        </div>

        <div class="control-group">
            <label>Carbon (C): <span class="value" id="cVal">5</span></label>
            <input type="range" id="carbon" min="0" max="20" value="5">
        </div>

        <div class="control-group">
            <label>Nitrogen (N): <span class="value" id="nVal">5</span></label>
            <input type="range" id="nitrogen" min="0" max="20" value="5">
        </div>

        <div class="control-group">
            <label>Temperature: <span class="value" id="tempVal">300</span> K</label>
            <input type="range" id="temperature" min="100" max="1000" value="300">
        </div>

        <div class="control-group">
            <label>Bond Energy Threshold: <span class="value" id="bondVal">0.5</span></label>
            <input type="range" id="bondThreshold" min="10" max="100" value="50">
        </div>

        <div class="stats">
            <h3>Reaction Statistics</h3>
            <div class="stat-row">
                <span>Total Atoms:</span>
                <span class="stat-value" id="totalAtoms">0</span>
            </div>
            <div class="stat-row">
                <span>Total Bonds:</span>
                <span class="stat-value" id="totalBonds">0</span>
            </div>
            <div class="stat-row">
                <span>Molecules:</span>
                <span class="stat-value" id="moleculeCount">0</span>
            </div>
            <div class="stat-row">
                <span>Avg Kinetic Energy:</span>
                <span class="stat-value" id="avgKE">0</span>
            </div>
            <div class="stat-row">
                <span>Reactions:</span>
                <span class="stat-value" id="reactions">0</span>
            </div>
        </div>

        <div class="stats">
            <h3>Molecule Types</h3>
            <div class="molecule-counts" id="moleculeCounts"></div>
        </div>

        <div class="legend">
            <h4>Atom Types</h4>
            <div class="legend-item">
                <div class="legend-color" style="background: #ffffff;"></div>
                <span>H - Hydrogen (1 bond)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ff4444;"></div>
                <span>O - Oxygen (2 bonds)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #444444;"></div>
                <span>C - Carbon (4 bonds)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #4444ff;"></div>
                <span>N - Nitrogen (3 bonds)</span>
            </div>
        </div>

        <p class="info">
            Atoms move and collide based on temperature.
            When atoms with unfilled bonds collide, they may form
            molecular bonds. Higher temperature breaks bonds,
            lower temperature favors bond formation.
        </p>
    </div>

    <div class="main">
        <div class="canvas-container">
            <canvas id="canvas"></canvas>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // State
        let running = false;
        let atoms = [];
        let bonds = [];
        let temperature = 300;
        let bondThreshold = 0.5;
        let reactions = 0;
        let numH = 30, numO = 10, numC = 5, numN = 5;

        const atomTypes = {
            H: { color: '#ffffff', radius: 8, maxBonds: 1, mass: 1 },
            O: { color: '#ff4444', radius: 12, maxBonds: 2, mass: 16 },
            C: { color: '#444444', radius: 14, maxBonds: 4, mass: 12 },
            N: { color: '#4444ff', radius: 13, maxBonds: 3, mass: 14 }
        };

        function resizeCanvas() {
            const container = canvas.parentElement;
            const size = Math.min(container.clientWidth - 40, container.clientHeight - 40, 600);
            canvas.width = size;
            canvas.height = size;
        }

        function createAtom(type) {
            const info = atomTypes[type];
            const speed = Math.sqrt(temperature / 100);
            const angle = Math.random() * Math.PI * 2;

            return {
                type,
                x: info.radius + Math.random() * (canvas.width - info.radius * 2),
                y: info.radius + Math.random() * (canvas.height - info.radius * 2),
                vx: Math.cos(angle) * speed,
                vy: Math.sin(angle) * speed,
                bonds: [],
                id: Math.random().toString(36).substr(2, 9)
            };
        }

        function initAtoms() {
            atoms = [];
            bonds = [];
            reactions = 0;

            for (let i = 0; i < numH; i++) atoms.push(createAtom('H'));
            for (let i = 0; i < numO; i++) atoms.push(createAtom('O'));
            for (let i = 0; i < numC; i++) atoms.push(createAtom('C'));
            for (let i = 0; i < numN; i++) atoms.push(createAtom('N'));
        }

        function getBondCount(atom) {
            return atom.bonds.length;
        }

        function canBond(atom) {
            return getBondCount(atom) < atomTypes[atom.type].maxBonds;
        }

        function areBonded(a1, a2) {
            return bonds.some(b =>
                (b.a1 === a1 && b.a2 === a2) || (b.a1 === a2 && b.a2 === a1)
            );
        }

        function addBond(a1, a2) {
            if (areBonded(a1, a2)) return;
            const bond = { a1, a2 };
            bonds.push(bond);
            a1.bonds.push(bond);
            a2.bonds.push(bond);
            reactions++;
        }

        function removeBond(bond) {
            const idx = bonds.indexOf(bond);
            if (idx >= 0) bonds.splice(idx, 1);

            let idx1 = bond.a1.bonds.indexOf(bond);
            if (idx1 >= 0) bond.a1.bonds.splice(idx1, 1);

            let idx2 = bond.a2.bonds.indexOf(bond);
            if (idx2 >= 0) bond.a2.bonds.splice(idx2, 1);
        }

        function update() {
            const speedFactor = Math.sqrt(temperature / 300);

            // Move atoms
            for (const atom of atoms) {
                const info = atomTypes[atom.type];

                // Add random thermal motion
                atom.vx += (Math.random() - 0.5) * 0.1 * speedFactor;
                atom.vy += (Math.random() - 0.5) * 0.1 * speedFactor;

                // Damping
                atom.vx *= 0.99;
                atom.vy *= 0.99;

                atom.x += atom.vx * speedFactor;
                atom.y += atom.vy * speedFactor;

                // Wall collisions
                if (atom.x < info.radius) { atom.x = info.radius; atom.vx *= -0.8; }
                if (atom.x > canvas.width - info.radius) { atom.x = canvas.width - info.radius; atom.vx *= -0.8; }
                if (atom.y < info.radius) { atom.y = info.radius; atom.vy *= -0.8; }
                if (atom.y > canvas.height - info.radius) { atom.y = canvas.height - info.radius; atom.vy *= -0.8; }
            }

            // Bond constraints - keep bonded atoms together
            for (const bond of bonds) {
                const a1 = bond.a1;
                const a2 = bond.a2;
                const r1 = atomTypes[a1.type].radius;
                const r2 = atomTypes[a2.type].radius;
                const targetDist = r1 + r2;

                const dx = a2.x - a1.x;
                const dy = a2.y - a1.y;
                const dist = Math.sqrt(dx * dx + dy * dy);

                if (dist > 0) {
                    const diff = (dist - targetDist) / dist;
                    const moveX = dx * diff * 0.5;
                    const moveY = dy * diff * 0.5;

                    a1.x += moveX;
                    a1.y += moveY;
                    a2.x -= moveX;
                    a2.y -= moveY;

                    // Share velocities
                    const avgVx = (a1.vx + a2.vx) / 2;
                    const avgVy = (a1.vy + a2.vy) / 2;
                    a1.vx = a1.vx * 0.9 + avgVx * 0.1;
                    a1.vy = a1.vy * 0.9 + avgVy * 0.1;
                    a2.vx = a2.vx * 0.9 + avgVx * 0.1;
                    a2.vy = a2.vy * 0.9 + avgVy * 0.1;
                }
            }

            // Check for collisions and potential bonding
            for (let i = 0; i < atoms.length; i++) {
                for (let j = i + 1; j < atoms.length; j++) {
                    const a1 = atoms[i];
                    const a2 = atoms[j];
                    const r1 = atomTypes[a1.type].radius;
                    const r2 = atomTypes[a2.type].radius;

                    const dx = a2.x - a1.x;
                    const dy = a2.y - a1.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    const minDist = r1 + r2;

                    if (dist < minDist) {
                        // Collision - repel
                        if (dist > 0) {
                            const overlap = minDist - dist;
                            const nx = dx / dist;
                            const ny = dy / dist;

                            a1.x -= nx * overlap * 0.5;
                            a1.y -= ny * overlap * 0.5;
                            a2.x += nx * overlap * 0.5;
                            a2.y += ny * overlap * 0.5;

                            // Elastic collision
                            const m1 = atomTypes[a1.type].mass;
                            const m2 = atomTypes[a2.type].mass;
                            const dvx = a1.vx - a2.vx;
                            const dvy = a1.vy - a2.vy;
                            const dvn = dvx * nx + dvy * ny;

                            a1.vx -= (2 * m2 / (m1 + m2)) * dvn * nx;
                            a1.vy -= (2 * m2 / (m1 + m2)) * dvn * ny;
                            a2.vx += (2 * m1 / (m1 + m2)) * dvn * nx;
                            a2.vy += (2 * m1 / (m1 + m2)) * dvn * ny;
                        }

                        // Try to form bond
                        if (!areBonded(a1, a2) && canBond(a1) && canBond(a2)) {
                            const collisionEnergy = Math.sqrt(
                                (a1.vx - a2.vx) ** 2 + (a1.vy - a2.vy) ** 2
                            );
                            if (collisionEnergy < bondThreshold * 2) {
                                addBond(a1, a2);
                            }
                        }
                    }
                }
            }

            // Break bonds at high temperature
            const breakProb = (temperature - 400) / 2000;
            if (breakProb > 0) {
                for (let i = bonds.length - 1; i >= 0; i--) {
                    if (Math.random() < breakProb) {
                        removeBond(bonds[i]);
                    }
                }
            }
        }

        function findMolecules() {
            const visited = new Set();
            const molecules = [];

            for (const atom of atoms) {
                if (visited.has(atom.id)) continue;

                const molecule = [];
                const stack = [atom];

                while (stack.length > 0) {
                    const current = stack.pop();
                    if (visited.has(current.id)) continue;
                    visited.add(current.id);
                    molecule.push(current);

                    for (const bond of current.bonds) {
                        const neighbor = bond.a1 === current ? bond.a2 : bond.a1;
                        if (!visited.has(neighbor.id)) {
                            stack.push(neighbor);
                        }
                    }
                }

                molecules.push(molecule);
            }

            return molecules;
        }

        function getMoleculeFormula(molecule) {
            const counts = { H: 0, C: 0, N: 0, O: 0 };
            for (const atom of molecule) {
                counts[atom.type]++;
            }

            let formula = '';
            if (counts.C > 0) formula += 'C' + (counts.C > 1 ? counts.C : '');
            if (counts.H > 0) formula += 'H' + (counts.H > 1 ? counts.H : '');
            if (counts.N > 0) formula += 'N' + (counts.N > 1 ? counts.N : '');
            if (counts.O > 0) formula += 'O' + (counts.O > 1 ? counts.O : '');

            return formula || '?';
        }

        function draw() {
            ctx.fillStyle = '#0a0a1a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw bonds
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 3;
            for (const bond of bonds) {
                ctx.beginPath();
                ctx.moveTo(bond.a1.x, bond.a1.y);
                ctx.lineTo(bond.a2.x, bond.a2.y);
                ctx.stroke();
            }

            // Draw atoms
            for (const atom of atoms) {
                const info = atomTypes[atom.type];

                // Glow for unbonded
                if (canBond(atom)) {
                    ctx.beginPath();
                    ctx.arc(atom.x, atom.y, info.radius + 4, 0, Math.PI * 2);
                    ctx.fillStyle = info.color + '33';
                    ctx.fill();
                }

                ctx.beginPath();
                ctx.arc(atom.x, atom.y, info.radius, 0, Math.PI * 2);
                ctx.fillStyle = info.color;
                ctx.fill();

                // Label
                ctx.fillStyle = atom.type === 'H' ? '#000' : '#fff';
                ctx.font = 'bold 10px sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(atom.type, atom.x, atom.y);
            }

            // Temperature indicator
            ctx.fillStyle = 'rgba(0,0,0,0.6)';
            ctx.fillRect(5, 5, 100, 20);
            ctx.fillStyle = temperature > 500 ? '#ff6b6b' : '#4ecdc4';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText(`${temperature}K`, 10, 18);
        }

        function updateStats() {
            const molecules = findMolecules();
            const formulaCounts = {};

            for (const mol of molecules) {
                const formula = getMoleculeFormula(mol);
                formulaCounts[formula] = (formulaCounts[formula] || 0) + 1;
            }

            // Calculate average kinetic energy
            let totalKE = 0;
            for (const atom of atoms) {
                const m = atomTypes[atom.type].mass;
                const v2 = atom.vx ** 2 + atom.vy ** 2;
                totalKE += 0.5 * m * v2;
            }
            const avgKE = atoms.length > 0 ? totalKE / atoms.length : 0;

            document.getElementById('totalAtoms').textContent = atoms.length;
            document.getElementById('totalBonds').textContent = bonds.length;
            document.getElementById('moleculeCount').textContent = molecules.length;
            document.getElementById('avgKE').textContent = avgKE.toFixed(2);
            document.getElementById('reactions').textContent = reactions;

            // Update molecule counts
            const countsDiv = document.getElementById('moleculeCounts');
            countsDiv.innerHTML = Object.entries(formulaCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 8)
                .map(([formula, count]) =>
                    `<div class="molecule-count">${formula}: ${count}</div>`
                ).join('');
        }

        function animate() {
            if (running) {
                update();
            }
            draw();
            updateStats();
            requestAnimationFrame(animate);
        }

        function reset() {
            running = false;
            document.getElementById('startBtn').textContent = 'Start';

            numH = parseInt(document.getElementById('hydrogen').value);
            numO = parseInt(document.getElementById('oxygen').value);
            numC = parseInt(document.getElementById('carbon').value);
            numN = parseInt(document.getElementById('nitrogen').value);
            temperature = parseInt(document.getElementById('temperature').value);
            bondThreshold = parseInt(document.getElementById('bondThreshold').value) / 100;

            initAtoms();
        }

        // Setup controls
        document.getElementById('startBtn').addEventListener('click', () => {
            running = !running;
            document.getElementById('startBtn').textContent = running ? 'Pause' : 'Start';
        });

        document.getElementById('stepBtn').addEventListener('click', () => {
            if (!running) update();
        });

        document.getElementById('resetBtn').addEventListener('click', reset);

        document.getElementById('hydrogen').addEventListener('input', (e) => {
            document.getElementById('hVal').textContent = e.target.value;
        });

        document.getElementById('oxygen').addEventListener('input', (e) => {
            document.getElementById('oVal').textContent = e.target.value;
        });

        document.getElementById('carbon').addEventListener('input', (e) => {
            document.getElementById('cVal').textContent = e.target.value;
        });

        document.getElementById('nitrogen').addEventListener('input', (e) => {
            document.getElementById('nVal').textContent = e.target.value;
        });

        document.getElementById('temperature').addEventListener('input', (e) => {
            temperature = parseInt(e.target.value);
            document.getElementById('tempVal').textContent = temperature;
        });

        document.getElementById('bondThreshold').addEventListener('input', (e) => {
            bondThreshold = parseInt(e.target.value) / 100;
            document.getElementById('bondVal').textContent = bondThreshold.toFixed(2);
        });

        // Initialize
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        reset();
        animate();
    </script>
</body>
</html>
