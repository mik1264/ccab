<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GasLab Two Gas Mixture - CCAB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0a0e1a; color: #e8e6e1; overflow: hidden; }
        #container { display: flex; height: 100vh; }
        #canvas-container { flex: 1; position: relative; display: flex; flex-direction: column; }
        #sim-canvas { flex: 1; }
        #hist-canvas { height: 180px; border-top: 1px solid #333; }
        canvas { display: block; width: 100%; height: 100%; }
        #controls { width: 300px; background: rgba(0,0,0,0.9); padding: 20px; overflow-y: auto; }
        h1 { font-size: 1.2rem; margin-bottom: 15px; color: #60a5fa; }
        .control-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.8rem; margin-bottom: 5px; color: #aaa; }
        input[type="range"] { width: 100%; }
        button { width: 100%; padding: 10px; margin-bottom: 10px; background: #60a5fa; color: #0a0e1a; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        button:hover { background: #3b82f6; }
        .stats { background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px; font-size: 0.75rem; margin-bottom: 15px; }
        .stats div { margin-bottom: 4px; }
        .gas-a { color: #f97316; }
        .gas-b { color: #22d3ee; }
        .back-link { position: fixed; top: 10px; left: 10px; padding: 8px 16px; background: rgba(0,0,0,0.7); color: #60a5fa; text-decoration: none; border-radius: 6px; font-size: 14px; z-index: 999; }
        .description { font-size: 0.75rem; color: #888; margin-bottom: 15px; line-height: 1.5; }
        .gas-legend { display: flex; gap: 20px; margin-bottom: 15px; }
        .legend-item { display: flex; align-items: center; gap: 5px; font-size: 0.8rem; }
        .legend-dot { width: 12px; height: 12px; border-radius: 50%; }
        .section-title { font-size: 0.9rem; color: #60a5fa; margin: 15px 0 10px; border-bottom: 1px solid #333; padding-bottom: 5px; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Gallery</a>
    <div id="container">
        <div id="canvas-container">
            <canvas id="sim-canvas"></canvas>
            <canvas id="hist-canvas"></canvas>
        </div>
        <div id="controls">
            <h1>GasLab: Two Gas Mixture</h1>
            <p class="description">Two gas species with different masses diffuse and mix. Watch how the lighter gas (cyan) moves faster than the heavier gas (orange) at the same temperature, demonstrating Graham's Law of Effusion.</p>

            <div class="gas-legend">
                <div class="legend-item"><div class="legend-dot" style="background: #f97316;"></div>Heavy Gas A</div>
                <div class="legend-item"><div class="legend-dot" style="background: #22d3ee;"></div>Light Gas B</div>
            </div>

            <div class="section-title">Gas A (Heavy)</div>
            <div class="control-group">
                <label>Count: <span id="countAVal">50</span></label>
                <input type="range" id="countA" min="10" max="100" value="50">
            </div>
            <div class="control-group">
                <label>Mass: <span id="massAVal">4</span></label>
                <input type="range" id="massA" min="1" max="8" step="0.5" value="4">
            </div>

            <div class="section-title">Gas B (Light)</div>
            <div class="control-group">
                <label>Count: <span id="countBVal">50</span></label>
                <input type="range" id="countB" min="10" max="100" value="50">
            </div>
            <div class="control-group">
                <label>Mass: <span id="massBVal">1</span></label>
                <input type="range" id="massB" min="0.5" max="4" step="0.5" value="1">
            </div>

            <div class="section-title">Simulation</div>
            <div class="control-group">
                <label>Temperature: <span id="tempVal">5</span></label>
                <input type="range" id="temp" min="1" max="15" value="5">
            </div>

            <button id="reset">Reset Simulation</button>
            <button id="separate">Separate Gases</button>
            <button id="pause">Pause</button>

            <div class="stats">
                <div class="gas-a">Gas A - Avg Speed: <span id="avgSpeedA">0</span></div>
                <div class="gas-a">Gas A - Left/Right: <span id="ratioA">0</span></div>
                <div class="gas-b">Gas B - Avg Speed: <span id="avgSpeedB">0</span></div>
                <div class="gas-b">Gas B - Left/Right: <span id="ratioB">0</span></div>
                <div>Total KE: <span id="totalKE">0</span></div>
                <div>Mixing Index: <span id="mixing">0</span>%</div>
                <div>Speed Ratio (B/A): <span id="speedRatio">0</span></div>
                <div>Theory (√mA/mB): <span id="theoryRatio">0</span></div>
            </div>

            <p class="description">Graham's Law: At equal temperature, the ratio of molecular speeds is inversely proportional to the square root of their masses: v₁/v₂ = √(m₂/m₁)</p>
        </div>
    </div>
    <script>
        const simCanvas = document.getElementById('sim-canvas');
        const simCtx = simCanvas.getContext('2d');
        const histCanvas = document.getElementById('hist-canvas');
        const histCtx = histCanvas.getContext('2d');

        let W, H, particles = [], paused = false;
        let params = { countA: 50, countB: 50, massA: 4, massB: 1, temp: 5 };

        function resize() {
            const c = document.getElementById('canvas-container');
            simCanvas.width = c.clientWidth;
            simCanvas.height = c.clientHeight - 180;
            histCanvas.width = c.clientWidth;
            histCanvas.height = 180;
            W = simCanvas.width;
            H = simCanvas.height;
        }

        function createParticle(type, x, y) {
            const mass = type === 'A' ? params.massA : params.massB;
            // At same temperature, KE = 0.5 * m * v^2 is constant
            // So v = sqrt(2 * KE / m), meaning lighter particles move faster
            const baseKE = params.temp * params.temp;
            const speed = Math.sqrt(2 * baseKE / mass) * (0.7 + Math.random() * 0.6);
            const angle = Math.random() * Math.PI * 2;
            return {
                x: x,
                y: y,
                vx: Math.cos(angle) * speed,
                vy: Math.sin(angle) * speed,
                r: type === 'A' ? 5 : 3,
                m: mass,
                type: type
            };
        }

        function init() {
            resize();
            particles = [];
            // Start with gases separated (A on left, B on right)
            for (let i = 0; i < params.countA; i++) {
                particles.push(createParticle('A',
                    30 + Math.random() * (W/2 - 60),
                    30 + Math.random() * (H - 60)
                ));
            }
            for (let i = 0; i < params.countB; i++) {
                particles.push(createParticle('B',
                    W/2 + 30 + Math.random() * (W/2 - 60),
                    30 + Math.random() * (H - 60)
                ));
            }
        }

        function separateGases() {
            // Move all A particles to left, B to right
            const gasA = particles.filter(p => p.type === 'A');
            const gasB = particles.filter(p => p.type === 'B');

            gasA.forEach(p => {
                p.x = 30 + Math.random() * (W/2 - 60);
                p.y = 30 + Math.random() * (H - 60);
            });

            gasB.forEach(p => {
                p.x = W/2 + 30 + Math.random() * (W/2 - 60);
                p.y = 30 + Math.random() * (H - 60);
            });
        }

        function update() {
            if (paused) return;

            for (const p of particles) {
                p.x += p.vx;
                p.y += p.vy;

                // Wall collisions
                if (p.x < p.r) { p.x = p.r; p.vx = -p.vx; }
                if (p.x > W - p.r) { p.x = W - p.r; p.vx = -p.vx; }
                if (p.y < p.r) { p.y = p.r; p.vy = -p.vy; }
                if (p.y > H - p.r) { p.y = H - p.r; p.vy = -p.vy; }
            }

            // Particle collisions with elastic collision physics
            for (let i = 0; i < particles.length; i++) {
                for (let j = i + 1; j < particles.length; j++) {
                    const p1 = particles[i], p2 = particles[j];
                    const dx = p2.x - p1.x, dy = p2.y - p1.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    const minDist = p1.r + p2.r;

                    if (dist < minDist && dist > 0) {
                        const nx = dx / dist, ny = dy / dist;
                        const dvx = p1.vx - p2.vx, dvy = p1.vy - p2.vy;
                        const dvn = dvx * nx + dvy * ny;

                        if (dvn > 0) {
                            const m1 = p1.m, m2 = p2.m;
                            const factor = 2 * dvn / (m1 + m2);
                            p1.vx -= factor * m2 * nx;
                            p1.vy -= factor * m2 * ny;
                            p2.vx += factor * m1 * nx;
                            p2.vy += factor * m1 * ny;
                        }

                        // Separate particles
                        const overlap = minDist - dist;
                        p1.x -= overlap * nx * 0.5;
                        p1.y -= overlap * ny * 0.5;
                        p2.x += overlap * nx * 0.5;
                        p2.y += overlap * ny * 0.5;
                    }
                }
            }
        }

        function draw() {
            simCtx.fillStyle = '#0a0e1a';
            simCtx.fillRect(0, 0, W, H);

            // Draw box
            simCtx.strokeStyle = '#60a5fa';
            simCtx.lineWidth = 3;
            simCtx.strokeRect(2, 2, W - 4, H - 4);

            // Draw center line (dashed)
            simCtx.strokeStyle = 'rgba(96, 165, 250, 0.3)';
            simCtx.setLineDash([10, 10]);
            simCtx.beginPath();
            simCtx.moveTo(W/2, 0);
            simCtx.lineTo(W/2, H);
            simCtx.stroke();
            simCtx.setLineDash([]);

            // Calculate stats
            let speedsA = [], speedsB = [];
            let leftA = 0, rightA = 0, leftB = 0, rightB = 0;
            let totalKE = 0;

            // Draw particles and collect stats
            for (const p of particles) {
                const speed = Math.sqrt(p.vx * p.vx + p.vy * p.vy);
                totalKE += 0.5 * p.m * speed * speed;

                if (p.type === 'A') {
                    speedsA.push(speed);
                    if (p.x < W/2) leftA++; else rightA++;
                    simCtx.fillStyle = '#f97316';
                } else {
                    speedsB.push(speed);
                    if (p.x < W/2) leftB++; else rightB++;
                    simCtx.fillStyle = '#22d3ee';
                }

                simCtx.beginPath();
                simCtx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
                simCtx.fill();
            }

            // Update stats
            const avgSpeedA = speedsA.reduce((a, b) => a + b, 0) / speedsA.length || 0;
            const avgSpeedB = speedsB.reduce((a, b) => a + b, 0) / speedsB.length || 0;
            const speedRatio = avgSpeedA > 0 ? avgSpeedB / avgSpeedA : 0;
            const theoryRatio = Math.sqrt(params.massA / params.massB);

            // Mixing index: how evenly distributed are the gases
            const totalA = leftA + rightA;
            const totalB = leftB + rightB;
            const mixingA = totalA > 0 ? Math.min(leftA, rightA) / (totalA / 2) : 0;
            const mixingB = totalB > 0 ? Math.min(leftB, rightB) / (totalB / 2) : 0;
            const mixingIndex = ((mixingA + mixingB) / 2) * 100;

            document.getElementById('avgSpeedA').textContent = avgSpeedA.toFixed(2);
            document.getElementById('avgSpeedB').textContent = avgSpeedB.toFixed(2);
            document.getElementById('ratioA').textContent = `${leftA}/${rightA}`;
            document.getElementById('ratioB').textContent = `${leftB}/${rightB}`;
            document.getElementById('totalKE').textContent = totalKE.toFixed(1);
            document.getElementById('mixing').textContent = mixingIndex.toFixed(1);
            document.getElementById('speedRatio').textContent = speedRatio.toFixed(3);
            document.getElementById('theoryRatio').textContent = theoryRatio.toFixed(3);

            // Draw histograms
            drawHistograms(speedsA, speedsB);
        }

        function drawHistograms(speedsA, speedsB) {
            histCtx.fillStyle = '#0a0e1a';
            histCtx.fillRect(0, 0, histCanvas.width, histCanvas.height);

            const bins = 25;
            const maxSpeed = 20;
            const countsA = new Array(bins).fill(0);
            const countsB = new Array(bins).fill(0);

            for (const s of speedsA) {
                const bin = Math.min(Math.floor(s / maxSpeed * bins), bins - 1);
                countsA[bin]++;
            }
            for (const s of speedsB) {
                const bin = Math.min(Math.floor(s / maxSpeed * bins), bins - 1);
                countsB[bin]++;
            }

            const maxCount = Math.max(...countsA, ...countsB, 1);
            const barW = histCanvas.width / bins;

            // Draw Gas B bars (behind)
            histCtx.fillStyle = 'rgba(34, 211, 238, 0.7)';
            for (let i = 0; i < bins; i++) {
                const h = (countsB[i] / maxCount) * (histCanvas.height - 40);
                histCtx.fillRect(i * barW + 1, histCanvas.height - h - 25, barW/2 - 1, h);
            }

            // Draw Gas A bars (front)
            histCtx.fillStyle = 'rgba(249, 115, 22, 0.7)';
            for (let i = 0; i < bins; i++) {
                const h = (countsA[i] / maxCount) * (histCanvas.height - 40);
                histCtx.fillRect(i * barW + barW/2, histCanvas.height - h - 25, barW/2 - 1, h);
            }

            // Labels
            histCtx.fillStyle = '#888';
            histCtx.font = '11px sans-serif';
            histCtx.fillText('Speed Distribution - Orange: Heavy Gas A | Cyan: Light Gas B', 10, 12);
            histCtx.fillText('0', 5, histCanvas.height - 8);
            histCtx.fillText(maxSpeed.toString(), histCanvas.width - 20, histCanvas.height - 8);
            histCtx.fillText('Speed →', histCanvas.width / 2 - 25, histCanvas.height - 8);
        }

        function animate() {
            update();
            draw();
            requestAnimationFrame(animate);
        }

        // Controls
        document.getElementById('countA').addEventListener('input', e => {
            params.countA = +e.target.value;
            document.getElementById('countAVal').textContent = params.countA;
        });
        document.getElementById('countB').addEventListener('input', e => {
            params.countB = +e.target.value;
            document.getElementById('countBVal').textContent = params.countB;
        });
        document.getElementById('massA').addEventListener('input', e => {
            params.massA = +e.target.value;
            document.getElementById('massAVal').textContent = params.massA;
        });
        document.getElementById('massB').addEventListener('input', e => {
            params.massB = +e.target.value;
            document.getElementById('massBVal').textContent = params.massB;
        });
        document.getElementById('temp').addEventListener('input', e => {
            params.temp = +e.target.value;
            document.getElementById('tempVal').textContent = params.temp;
        });
        document.getElementById('reset').addEventListener('click', init);
        document.getElementById('separate').addEventListener('click', separateGases);
        document.getElementById('pause').addEventListener('click', () => {
            paused = !paused;
            document.getElementById('pause').textContent = paused ? 'Resume' : 'Pause';
        });

        window.addEventListener('resize', resize);
        init();
        animate();
    </script>
</body>
</html>
