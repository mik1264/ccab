<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radioactive Decay Simulation - CCAB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0a1628; color: #e8e6e1; overflow: hidden; }
        #container { display: flex; height: 100vh; }
        #canvas-container { flex: 1; position: relative; display: flex; flex-direction: column; }
        #main-canvas { flex: 1; }
        #graph-canvas { height: 180px; border-top: 1px solid #333; }
        canvas { display: block; width: 100%; height: 100%; }
        #controls { width: 280px; background: rgba(0,0,0,0.9); padding: 20px; overflow-y: auto; }
        h1 { font-size: 1.2rem; margin-bottom: 15px; color: #4ade80; }
        .control-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.8rem; margin-bottom: 5px; color: #aaa; }
        input[type="range"] { width: 100%; }
        button { width: 100%; padding: 10px; margin-bottom: 10px; background: #4ade80; color: #0a1628; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        button:hover { background: #22c55e; }
        .stats { background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px; font-size: 0.8rem; margin-bottom: 15px; }
        .stats div { margin-bottom: 5px; }
        .back-link { position: fixed; top: 10px; left: 10px; padding: 8px 16px; background: rgba(0,0,0,0.7); color: #4ade80; text-decoration: none; border-radius: 6px; font-size: 14px; z-index: 999; }
        .description { font-size: 0.75rem; color: #888; margin-bottom: 15px; line-height: 1.5; }
        .legend { display: flex; gap: 15px; margin-bottom: 15px; font-size: 0.75rem; }
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .legend-color { width: 12px; height: 12px; border-radius: 50%; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Gallery</a>
    <div id="container">
        <div id="canvas-container">
            <canvas id="main-canvas"></canvas>
            <canvas id="graph-canvas"></canvas>
        </div>
        <div id="controls">
            <h1>Radioactive Decay</h1>
            <p class="description">Simulates nuclear decay with exponential statistics. Each unstable atom has a probability of decaying each time step. Watch the characteristic exponential decay curve emerge.</p>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #4ade80;"></div>
                    <span>Unstable (Parent)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #60a5fa;"></div>
                    <span>Stable (Daughter)</span>
                </div>
            </div>
            
            <div class="control-group">
                <label>Initial Atoms: <span id="atomCountVal">500</span></label>
                <input type="range" id="atomCount" min="100" max="1000" value="500">
            </div>
            <div class="control-group">
                <label>Decay Probability: <span id="decayProbVal">2</span>%/step</label>
                <input type="range" id="decayProb" min="0.5" max="10" step="0.5" value="2">
            </div>
            <div class="control-group">
                <label>Speed: <span id="speedVal">100</span>ms</label>
                <input type="range" id="speed" min="20" max="500" value="100">
            </div>
            
            <button id="reset">Reset Simulation</button>
            <button id="pause">Pause</button>
            <button id="step">Step Once</button>
            
            <div class="stats">
                <div>Time Step: <span id="timeStep">0</span></div>
                <div>Unstable (Parent): <span id="unstable" style="color: #4ade80;">0</span></div>
                <div>Stable (Daughter): <span id="stable" style="color: #60a5fa;">0</span></div>
                <div>Decayed This Step: <span id="decayedThisStep">0</span></div>
                <div>Half-Life: <span id="halfLife">~35</span> steps</div>
                <div>Theoretical λ: <span id="lambda">0.02</span></div>
            </div>
            
            <p class="description"><strong>Half-Life:</strong> The time for half the atoms to decay. With 2% decay probability, half-life ≈ ln(2)/0.02 ≈ 35 steps.</p>
            
            <p class="description"><strong>Exponential Law:</strong> N(t) = N₀ × e^(-λt), where λ is the decay constant.</p>
        </div>
    </div>
    <script>
        const mainCanvas = document.getElementById('main-canvas');
        const mainCtx = mainCanvas.getContext('2d');
        const graphCanvas = document.getElementById('graph-canvas');
        const graphCtx = graphCanvas.getContext('2d');
        
        let W, H, atoms = [], paused = false, timeStep = 0;
        let history = [];
        let intervalId = null;
        
        let params = {
            atomCount: 500,
            decayProb: 0.02,  // 2% per step
            speed: 100
        };
        
        function resize() {
            const c = document.getElementById('canvas-container');
            mainCanvas.width = c.clientWidth;
            mainCanvas.height = c.clientHeight - 180;
            graphCanvas.width = c.clientWidth;
            graphCanvas.height = 180;
            W = mainCanvas.width;
            H = mainCanvas.height;
        }
        
        function init() {
            resize();
            atoms = [];
            history = [];
            timeStep = 0;
            
            // Create atoms in a grid pattern
            const cols = Math.ceil(Math.sqrt(params.atomCount * W / H));
            const rows = Math.ceil(params.atomCount / cols);
            const spacingX = (W - 40) / cols;
            const spacingY = (H - 40) / rows;
            
            for (let i = 0; i < params.atomCount; i++) {
                const col = i % cols;
                const row = Math.floor(i / cols);
                atoms.push({
                    x: 20 + col * spacingX + spacingX / 2 + (Math.random() - 0.5) * spacingX * 0.3,
                    y: 20 + row * spacingY + spacingY / 2 + (Math.random() - 0.5) * spacingY * 0.3,
                    unstable: true,
                    decayTime: -1,  // When it decayed
                    flashIntensity: 0  // For decay flash animation
                });
            }
            
            // Calculate theoretical half-life
            const halfLife = Math.log(2) / params.decayProb;
            document.getElementById('halfLife').textContent = '~' + halfLife.toFixed(0) + ' steps';
            document.getElementById('lambda').textContent = params.decayProb.toFixed(4);
            
            updateStats(0);
        }
        
        function step() {
            timeStep++;
            let decayedThisStep = 0;
            
            // Each unstable atom has a chance to decay
            for (const atom of atoms) {
                if (atom.unstable) {
                    if (Math.random() < params.decayProb) {
                        atom.unstable = false;
                        atom.decayTime = timeStep;
                        atom.flashIntensity = 1;  // Flash on decay
                        decayedThisStep++;
                    }
                }
            }
            
            // Record history
            const unstableCount = atoms.filter(a => a.unstable).length;
            history.push({
                time: timeStep,
                unstable: unstableCount,
                decayed: decayedThisStep
            });
            
            // Keep history manageable
            if (history.length > 300) history.shift();
            
            updateStats(decayedThisStep);
        }
        
        function updateStats(decayedThisStep) {
            const unstable = atoms.filter(a => a.unstable).length;
            const stable = atoms.length - unstable;
            
            document.getElementById('timeStep').textContent = timeStep;
            document.getElementById('unstable').textContent = unstable;
            document.getElementById('stable').textContent = stable;
            document.getElementById('decayedThisStep').textContent = decayedThisStep;
        }
        
        function draw() {
            // Main visualization
            mainCtx.fillStyle = '#0a1628';
            mainCtx.fillRect(0, 0, W, H);
            
            // Draw atoms
            for (const atom of atoms) {
                // Fade flash intensity
                if (atom.flashIntensity > 0) {
                    atom.flashIntensity *= 0.95;
                }
                
                if (atom.unstable) {
                    // Unstable - green with glow
                    mainCtx.fillStyle = '#4ade80';
                    mainCtx.shadowColor = '#4ade80';
                    mainCtx.shadowBlur = 5;
                } else {
                    // Stable - blue, with flash when recently decayed
                    if (atom.flashIntensity > 0.1) {
                        mainCtx.fillStyle = `rgba(255, 255, 100, ${atom.flashIntensity})`;
                        mainCtx.shadowColor = '#ffff00';
                        mainCtx.shadowBlur = 10 * atom.flashIntensity;
                    } else {
                        mainCtx.fillStyle = '#60a5fa';
                        mainCtx.shadowBlur = 0;
                    }
                }
                
                mainCtx.beginPath();
                mainCtx.arc(atom.x, atom.y, 5, 0, Math.PI * 2);
                mainCtx.fill();
            }
            
            mainCtx.shadowBlur = 0;
            
            // Draw decay count
            mainCtx.fillStyle = '#888';
            mainCtx.font = '14px sans-serif';
            const unstable = atoms.filter(a => a.unstable).length;
            const stable = atoms.length - unstable;
            mainCtx.fillText(`Unstable: ${unstable}  |  Stable: ${stable}  |  Step: ${timeStep}`, 10, 20);
            
            // Draw graph
            graphCtx.fillStyle = '#050a14';
            graphCtx.fillRect(0, 0, graphCanvas.width, graphCanvas.height);
            
            if (history.length > 1) {
                const maxTime = Math.max(100, history[history.length - 1].time);
                const initialCount = params.atomCount;
                
                // Draw theoretical curve
                graphCtx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                graphCtx.lineWidth = 1;
                graphCtx.setLineDash([3, 3]);
                graphCtx.beginPath();
                for (let t = 0; t <= maxTime; t++) {
                    const x = (t / maxTime) * graphCanvas.width;
                    const theoretical = initialCount * Math.exp(-params.decayProb * t);
                    const y = graphCanvas.height - 20 - (theoretical / initialCount) * (graphCanvas.height - 40);
                    if (t === 0) graphCtx.moveTo(x, y);
                    else graphCtx.lineTo(x, y);
                }
                graphCtx.stroke();
                graphCtx.setLineDash([]);
                
                // Draw actual data
                graphCtx.strokeStyle = '#4ade80';
                graphCtx.lineWidth = 2;
                graphCtx.beginPath();
                for (let i = 0; i < history.length; i++) {
                    const x = (history[i].time / maxTime) * graphCanvas.width;
                    const y = graphCanvas.height - 20 - (history[i].unstable / initialCount) * (graphCanvas.height - 40);
                    if (i === 0) graphCtx.moveTo(x, y);
                    else graphCtx.lineTo(x, y);
                }
                graphCtx.stroke();
                
                // Draw half-life marker
                const halfLife = Math.log(2) / params.decayProb;
                if (halfLife < maxTime) {
                    const halfLifeX = (halfLife / maxTime) * graphCanvas.width;
                    graphCtx.strokeStyle = '#f59e0b';
                    graphCtx.setLineDash([5, 5]);
                    graphCtx.beginPath();
                    graphCtx.moveTo(halfLifeX, 20);
                    graphCtx.lineTo(halfLifeX, graphCanvas.height - 20);
                    graphCtx.stroke();
                    graphCtx.setLineDash([]);
                    graphCtx.fillStyle = '#f59e0b';
                    graphCtx.fillText('t½', halfLifeX + 5, 30);
                }
                
                // 50% line
                const halfY = graphCanvas.height - 20 - 0.5 * (graphCanvas.height - 40);
                graphCtx.strokeStyle = 'rgba(245, 158, 11, 0.5)';
                graphCtx.setLineDash([3, 3]);
                graphCtx.beginPath();
                graphCtx.moveTo(0, halfY);
                graphCtx.lineTo(graphCanvas.width, halfY);
                graphCtx.stroke();
                graphCtx.setLineDash([]);
            }
            
            // Labels
            graphCtx.fillStyle = '#888';
            graphCtx.font = '10px sans-serif';
            graphCtx.fillText('Decay Curve: Green = Actual, Gray dashed = Theoretical (N₀e^(-λt))', 10, 12);
            graphCtx.fillText('N₀', 5, 35);
            graphCtx.fillText('0', 5, graphCanvas.height - 10);
            graphCtx.fillText('50%', graphCanvas.width - 30, graphCanvas.height / 2);
            
            requestAnimationFrame(draw);
        }
        
        function startSimulation() {
            if (intervalId) clearInterval(intervalId);
            intervalId = setInterval(() => {
                if (!paused && atoms.some(a => a.unstable)) {
                    step();
                }
            }, params.speed);
        }
        
        // Event listeners
        document.getElementById('atomCount').addEventListener('input', e => {
            params.atomCount = +e.target.value;
            document.getElementById('atomCountVal').textContent = params.atomCount;
        });
        
        document.getElementById('decayProb').addEventListener('input', e => {
            params.decayProb = +e.target.value / 100;
            document.getElementById('decayProbVal').textContent = e.target.value;
            const halfLife = Math.log(2) / params.decayProb;
            document.getElementById('halfLife').textContent = '~' + halfLife.toFixed(0) + ' steps';
            document.getElementById('lambda').textContent = params.decayProb.toFixed(4);
        });
        
        document.getElementById('speed').addEventListener('input', e => {
            params.speed = +e.target.value;
            document.getElementById('speedVal').textContent = params.speed;
            startSimulation();
        });
        
        document.getElementById('reset').addEventListener('click', () => {
            init();
            startSimulation();
        });
        
        document.getElementById('pause').addEventListener('click', () => {
            paused = !paused;
            document.getElementById('pause').textContent = paused ? 'Resume' : 'Pause';
        });
        
        document.getElementById('step').addEventListener('click', step);
        
        window.addEventListener('resize', resize);
        
        init();
        draw();
        startSimulation();
    </script>
</body>
</html>
