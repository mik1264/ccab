<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monte Carlo Pi Estimation - CCAB</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            font-family: 'Segoe UI', Arial, sans-serif;
            color: white;
        }
        .container {
            display: flex;
            height: 100vh;
        }
        .canvas-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            gap: 15px;
        }
        canvas {
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
        }
        .controls {
            width: 320px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.6);
            overflow-y: auto;
        }
        h2 { margin: 0 0 15px 0; color: #e17055; }
        h3 { margin: 15px 0 8px 0; color: #fab1a0; font-size: 14px; }
        .slider-group { margin: 12px 0; }
        .slider-group label { display: block; margin-bottom: 5px; font-size: 13px; }
        input[type="range"] { width: 100%; }
        .stats {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .stat-row { display: flex; justify-content: space-between; margin: 5px 0; font-size: 13px; }
        .stat-highlight {
            font-size: 2rem;
            color: #e17055;
            text-align: center;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
        }
        .description {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            border-radius: 8px;
            font-size: 12px;
            line-height: 1.5;
            margin-top: 15px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            background: #e17055;
            color: white;
            font-weight: bold;
        }
        button:hover { background: #d35400; }
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            font-size: 12px;
        }
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .legend-color { width: 12px; height: 12px; border-radius: 50%; }
        .error-display {
            background: rgba(231, 76, 60, 0.2);
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <a href="index.html" class="organic-back-link" style="position: fixed; top: 20px; right: 20px; z-index: 1000; display: flex; align-items: center; gap: 8px; padding: 10px 16px; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); border-radius: 30px; text-decoration: none; color: #606C38; font-family: 'Nunito', sans-serif; font-weight: 600; box-shadow: 0 2px 10px rgba(0,0,0,0.1); transition: all 0.3s ease;">
        <span class="back-arrow">‚Üê</span>
        <span class="back-text">Gallery</span>
    </a>
    <div class="container">
        <div class="canvas-area">
            <canvas id="mainCanvas"></canvas>
            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background: #00b894;"></div> Inside Circle</div>
                <div class="legend-item"><div class="legend-color" style="background: #e17055;"></div> Outside Circle</div>
            </div>
            <canvas id="graphCanvas"></canvas>
        </div>
        <div class="controls">
            <h2>üéØ Monte Carlo œÄ</h2>
            <p style="font-size: 12px; opacity: 0.8;">Estimate œÄ by throwing random darts</p>

            <div class="stat-highlight" id="piEstimate">œÄ ‚âà 0.0000</div>

            <h3>Speed</h3>
            <div class="slider-group">
                <label>Darts per frame: <span id="speedVal">100</span></label>
                <input type="range" id="speed" min="1" max="1000" step="10" value="100">
            </div>

            <button onclick="reset()">Reset</button>
            <button onclick="togglePause()" id="pauseBtn">Pause</button>
            <button onclick="addBurst()">Add 10,000</button>

            <div class="stats">
                <div class="stat-row"><span>Total Darts:</span><span id="totalDarts">0</span></div>
                <div class="stat-row"><span>Inside Circle:</span><span id="insideCount">0</span></div>
                <div class="stat-row"><span>Outside Circle:</span><span id="outsideCount">0</span></div>
                <div class="stat-row"><span>Ratio (in/total):</span><span id="ratio">0</span></div>
            </div>

            <div class="error-display">
                Error: <span id="error">0%</span>
            </div>

            <div class="description">
                <strong>How it works:</strong><br>
                Random points are thrown at a square containing a quarter circle. The ratio of points inside the circle to total points approximates œÄ/4.<br><br>
                <strong>Formula:</strong> œÄ ‚âà 4 √ó (inside / total)<br><br>
                <strong>Why?</strong> Area of quarter circle = œÄr¬≤/4<br>
                Area of square = r¬≤<br>
                Ratio = œÄ/4<br><br>
                More darts ‚Üí better estimate!
            </div>
        </div>
    </div>

    <script>
        const mainCanvas = document.getElementById('mainCanvas');
        const mainCtx = mainCanvas.getContext('2d');
        const graphCanvas = document.getElementById('graphCanvas');
        const graphCtx = graphCanvas.getContext('2d');

        mainCanvas.width = 500;
        mainCanvas.height = 500;
        graphCanvas.width = 500;
        graphCanvas.height = 120;

        let inside = 0;
        let outside = 0;
        let paused = false;
        let speed = 100;
        let history = [];
        const maxHistory = 200;
        const PI = Math.PI;

        // Pre-render the static background
        let backgroundImage = null;

        function createBackground() {
            const offscreen = document.createElement('canvas');
            offscreen.width = mainCanvas.width;
            offscreen.height = mainCanvas.height;
            const ctx = offscreen.getContext('2d');

            // Background
            ctx.fillStyle = '#2d2d44';
            ctx.fillRect(0, 0, mainCanvas.width, mainCanvas.height);

            // Quarter circle outline
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(0, mainCanvas.height, mainCanvas.width, -PI/2, 0);
            ctx.stroke();

            // Grid lines
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 10; i++) {
                const pos = (i / 10) * mainCanvas.width;
                ctx.beginPath();
                ctx.moveTo(pos, 0);
                ctx.lineTo(pos, mainCanvas.height);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(0, pos);
                ctx.lineTo(mainCanvas.width, pos);
                ctx.stroke();
            }

            backgroundImage = offscreen;
        }

        function reset() {
            inside = 0;
            outside = 0;
            history = [];
            createBackground();
            draw();
        }

        function throwDart() {
            const x = Math.random();
            const y = Math.random();
            const dist = x * x + y * y;
            const isInside = dist <= 1;

            if (isInside) {
                inside++;
                mainCtx.fillStyle = 'rgba(0, 184, 148, 0.6)';
            } else {
                outside++;
                mainCtx.fillStyle = 'rgba(225, 112, 85, 0.6)';
            }

            // Draw the dart
            const px = x * mainCanvas.width;
            const py = mainCanvas.height - y * mainCanvas.height;
            mainCtx.beginPath();
            mainCtx.arc(px, py, 2, 0, PI * 2);
            mainCtx.fill();
        }

        function throwMultiple(count) {
            for (let i = 0; i < count; i++) {
                throwDart();
            }
        }

        function addBurst() {
            throwMultiple(10000);
            updateStats();
        }

        function updateStats() {
            const total = inside + outside;
            const piEstimate = total > 0 ? (4 * inside / total) : 0;
            const error = total > 0 ? Math.abs((piEstimate - PI) / PI * 100) : 100;

            document.getElementById('piEstimate').textContent = `œÄ ‚âà ${piEstimate.toFixed(6)}`;
            document.getElementById('totalDarts').textContent = total.toLocaleString();
            document.getElementById('insideCount').textContent = inside.toLocaleString();
            document.getElementById('outsideCount').textContent = outside.toLocaleString();
            document.getElementById('ratio').textContent = total > 0 ? (inside / total).toFixed(6) : '0';
            document.getElementById('error').textContent = error.toFixed(4) + '%';

            // Update history for graph
            if (total > 0) {
                history.push(piEstimate);
                if (history.length > maxHistory) history.shift();
            }
        }

        function drawGraph() {
            graphCtx.fillStyle = '#1a1a2e';
            graphCtx.fillRect(0, 0, graphCanvas.width, graphCanvas.height);

            // Draw œÄ reference line
            const piY = graphCanvas.height / 2;
            graphCtx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
            graphCtx.setLineDash([5, 5]);
            graphCtx.beginPath();
            graphCtx.moveTo(0, piY);
            graphCtx.lineTo(graphCanvas.width, piY);
            graphCtx.stroke();
            graphCtx.setLineDash([]);

            // Label
            graphCtx.fillStyle = 'rgba(255, 255, 255, 0.5)';
            graphCtx.font = '11px Arial';
            graphCtx.fillText('œÄ = 3.14159...', 5, piY - 5);

            // Draw estimate history
            if (history.length > 1) {
                graphCtx.strokeStyle = '#e17055';
                graphCtx.lineWidth = 2;
                graphCtx.beginPath();

                const minVal = 2.5;
                const maxVal = 4.0;
                const range = maxVal - minVal;

                for (let i = 0; i < history.length; i++) {
                    const x = (i / maxHistory) * graphCanvas.width;
                    const normalized = (history[i] - minVal) / range;
                    const y = graphCanvas.height - normalized * graphCanvas.height;

                    if (i === 0) graphCtx.moveTo(x, y);
                    else graphCtx.lineTo(x, y);
                }
                graphCtx.stroke();
            }

            // Draw current value
            if (history.length > 0) {
                const current = history[history.length - 1];
                graphCtx.fillStyle = '#e17055';
                graphCtx.font = 'bold 12px Arial';
                graphCtx.fillText(`Current: ${current.toFixed(5)}`, graphCanvas.width - 120, 15);
            }
        }

        function draw() {
            // Redraw background (clears old darts)
            if (backgroundImage) {
                mainCtx.drawImage(backgroundImage, 0, 0);
            }
        }

        function animate() {
            if (!paused) {
                throwMultiple(speed);
                updateStats();
            }
            drawGraph();
            requestAnimationFrame(animate);
        }

        function togglePause() {
            paused = !paused;
            document.getElementById('pauseBtn').textContent = paused ? 'Resume' : 'Pause';
        }

        // Event listeners
        document.getElementById('speed').oninput = function() {
            speed = parseInt(this.value);
            document.getElementById('speedVal').textContent = speed;
        };

        createBackground();
        draw();
        animate();
    </script>
</body>
</html>
