<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Climate Change Model - CCAB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0c1222; color: #e8e6e1; overflow: hidden; }
        #container { display: flex; height: 100vh; }
        #canvas-container { flex: 1; position: relative; display: flex; flex-direction: column; }
        #simCanvas { flex: 1.5; }
        #graphCanvas { flex: 1; border-top: 1px solid #333; }
        #controls { width: 300px; background: rgba(0,0,0,0.9); padding: 20px; overflow-y: auto; }
        h1 { font-size: 1.1rem; margin-bottom: 15px; color: #10b981; }
        .control-group { margin-bottom: 12px; }
        label { display: block; font-size: 0.75rem; margin-bottom: 3px; color: #aaa; }
        input[type="range"] { width: 100%; }
        button { width: 100%; padding: 8px; margin-bottom: 8px; background: #059669; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 0.85rem; }
        button:hover { background: #047857; }
        .stats { background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px; font-size: 0.75rem; margin-bottom: 15px; }
        .stats div { margin-bottom: 3px; }
        .back-link { position: fixed; top: 10px; left: 10px; padding: 8px 16px; background: rgba(0,0,0,0.7); color: #10b981; text-decoration: none; border-radius: 6px; font-size: 14px; z-index: 999; }
        .description { font-size: 0.7rem; color: #888; margin-bottom: 12px; line-height: 1.4; }
        .temp-display { font-size: 1.5rem; font-weight: bold; margin: 10px 0; text-align: center; }
        .scenario-btns { display: flex; gap: 5px; margin-bottom: 10px; }
        .scenario-btns button { flex: 1; font-size: 0.7rem; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back</a>
    <div id="container">
        <div id="canvas-container">
            <canvas id="simCanvas"></canvas>
            <canvas id="graphCanvas"></canvas>
        </div>
        <div id="controls">
            <h1>Climate Change Model</h1>
            <p class="description">Simplified energy balance model with CO2 greenhouse effect, ice-albedo feedback, and temperature trajectories.</p>
            
            <div class="temp-display" id="tempDisplay">+0.0°C</div>
            
            <div class="control-group">
                <label>CO2 Emissions (Gt/year): <span id="emissionsVal">10</span></label>
                <input type="range" id="emissions" min="0" max="40" value="10">
            </div>
            <div class="control-group">
                <label>Deforestation Rate: <span id="deforestVal">0.5</span>%/year</label>
                <input type="range" id="deforest" min="0" max="3" step="0.1" value="0.5">
            </div>
            <div class="control-group">
                <label>Solar Intensity: <span id="solarVal">100</span>%</label>
                <input type="range" id="solar" min="95" max="105" step="0.5" value="100">
            </div>
            <div class="control-group">
                <label>Volcanic Activity: <span id="volcanoVal">0</span></label>
                <input type="range" id="volcano" min="0" max="5" value="0">
            </div>
            
            <p class="description" style="font-size: 0.65rem;"><strong>Scenarios:</strong></p>
            <div class="scenario-btns">
                <button onclick="setScenario('bau')">Business As Usual</button>
                <button onclick="setScenario('netzero')">Net Zero 2050</button>
            </div>
            <div class="scenario-btns">
                <button onclick="setScenario('rapid')">Rapid Cuts</button>
                <button onclick="setScenario('worst')">Fossil Expand</button>
            </div>
            
            <button id="reset">Reset to Preindustrial</button>
            <button id="pause">Pause</button>
            
            <div class="stats">
                <div>Year: <span id="year">1850</span></div>
                <div>CO2: <span id="co2">280</span> ppm</div>
                <div>Ice Cover: <span id="ice">100</span>%</div>
                <div>Forest Cover: <span id="forest">100</span>%</div>
                <div>Sea Level: <span id="seaLevel">+0</span> cm</div>
                <div>Radiative Forcing: <span id="forcing">0</span> W/m²</div>
            </div>
            
            <p class="description"><strong>Feedbacks:</strong> Ice melts → darker surface → more absorption → more warming. CO2 traps outgoing IR radiation.</p>
        </div>
    </div>
    <script>
        const simCanvas = document.getElementById('simCanvas');
        const graphCanvas = document.getElementById('graphCanvas');
        const sctx = simCanvas.getContext('2d');
        const gctx = graphCanvas.getContext('2d');
        
        let W, H, GW, GH, paused = false;
        
        // Climate state
        let state = {
            year: 1850,
            co2: 280,           // ppm
            temp: 0,            // anomaly from preindustrial (°C)
            ice: 100,           // % of preindustrial
            forest: 100,        // % of preindustrial
            seaLevel: 0,        // cm rise
            oceanHeat: 0        // accumulated heat
        };
        
        let history = [];
        
        let params = {
            emissions: 10,      // Gt CO2/year
            deforestation: 0.5, // %/year
            solarIntensity: 100,
            volcanicAerosols: 0
        };
        
        const preindustrialCO2 = 280;
        const climateSensitivity = 3;  // °C per doubling of CO2
        const oceanInertia = 0.03;      // Slow response
        
        function resize() {
            const c = document.getElementById('canvas-container');
            simCanvas.width = c.clientWidth;
            simCanvas.height = c.clientHeight * 0.55;
            graphCanvas.width = c.clientWidth;
            graphCanvas.height = c.clientHeight * 0.45;
            W = simCanvas.width;
            H = simCanvas.height;
            GW = graphCanvas.width;
            GH = graphCanvas.height;
        }
        
        function init() {
            resize();
            state = {
                year: 1850,
                co2: 280,
                temp: 0,
                ice: 100,
                forest: 100,
                seaLevel: 0,
                oceanHeat: 0
            };
            history = [];
            updateStats();
        }
        
        function step() {
            // Time step = 1 year
            state.year++;
            
            // CO2 accumulation
            const naturalSink = 0.02 * (state.co2 - preindustrialCO2); // Ocean/land uptake
            const forestSink = state.forest * 0.02;
            const co2Addition = params.emissions * 0.5 - naturalSink - forestSink * 0.05;
            state.co2 += co2Addition;
            state.co2 = Math.max(preindustrialCO2, state.co2);
            
            // Radiative forcing from CO2 (logarithmic)
            const co2Forcing = 5.35 * Math.log(state.co2 / preindustrialCO2);
            
            // Albedo feedback from ice
            const albedoForcing = (100 - state.ice) * 0.03;
            
            // Solar variation
            const solarForcing = (params.solarIntensity - 100) * 0.1;
            
            // Volcanic cooling
            const volcanoForcing = -params.volcanicAerosols * 0.5;
            
            const totalForcing = co2Forcing + albedoForcing + solarForcing + volcanoForcing;
            
            // Equilibrium temperature
            const eqTemp = totalForcing * climateSensitivity / 3.7;
            
            // Actual temperature (ocean inertia causes lag)
            state.temp += (eqTemp - state.temp) * oceanInertia;
            
            // Ice feedback
            if (state.temp > 0.5) {
                state.ice -= (state.temp - 0.5) * 0.3;
                state.ice = Math.max(0, state.ice);
            }
            
            // Forest decline
            state.forest -= params.deforestation;
            state.forest = Math.max(10, state.forest);
            
            // Sea level rise (thermal expansion + ice melt)
            const thermalExpansion = state.temp * 0.3;
            const iceMelt = (100 - state.ice) * 0.7;
            state.seaLevel = thermalExpansion + iceMelt;
            
            // Record history
            history.push({
                year: state.year,
                temp: state.temp,
                co2: state.co2,
                forcing: totalForcing
            });
            if (history.length > 300) history.shift();
            
            updateStats();
        }
        
        function updateStats() {
            const sign = state.temp >= 0 ? '+' : '';
            document.getElementById('tempDisplay').textContent = `${sign}${state.temp.toFixed(1)}°C`;
            document.getElementById('tempDisplay').style.color = 
                state.temp > 2 ? '#ef4444' : state.temp > 1 ? '#f59e0b' : '#10b981';
            
            document.getElementById('year').textContent = state.year;
            document.getElementById('co2').textContent = Math.round(state.co2);
            document.getElementById('ice').textContent = state.ice.toFixed(1);
            document.getElementById('forest').textContent = state.forest.toFixed(1);
            document.getElementById('seaLevel').textContent = `+${state.seaLevel.toFixed(0)}`;
            
            const forcing = history.length > 0 ? history[history.length - 1].forcing : 0;
            document.getElementById('forcing').textContent = forcing.toFixed(2);
        }
        
        function drawSim() {
            // Sky gradient based on temperature
            const tempColor = Math.max(0, Math.min(1, state.temp / 4));
            const skyTop = `rgb(${30 + tempColor * 50}, ${80 - tempColor * 30}, ${180 - tempColor * 80})`;
            const skyBottom = `rgb(${100 + tempColor * 100}, ${180 - tempColor * 50}, ${220 - tempColor * 100})`;
            
            const skyGradient = sctx.createLinearGradient(0, 0, 0, H * 0.6);
            skyGradient.addColorStop(0, skyTop);
            skyGradient.addColorStop(1, skyBottom);
            sctx.fillStyle = skyGradient;
            sctx.fillRect(0, 0, W, H * 0.6);
            
            // Sun
            const sunY = 50 + Math.sin(state.year * 0.1) * 10;
            sctx.fillStyle = `rgba(255, 220, 100, ${0.8 + (params.solarIntensity - 100) * 0.05})`;
            sctx.beginPath();
            sctx.arc(W - 80, sunY, 35, 0, Math.PI * 2);
            sctx.fill();
            
            // CO2 haze
            const hazeOpacity = Math.min(0.5, (state.co2 - 280) / 400 * 0.5);
            sctx.fillStyle = `rgba(150, 120, 100, ${hazeOpacity})`;
            sctx.fillRect(0, 0, W, H * 0.6);
            
            // Volcanic aerosols
            if (params.volcanicAerosols > 0) {
                sctx.fillStyle = `rgba(100, 100, 100, ${params.volcanicAerosols * 0.1})`;
                sctx.fillRect(0, 0, W, H * 0.3);
            }
            
            // Land
            const landGradient = sctx.createLinearGradient(0, H * 0.6, 0, H);
            landGradient.addColorStop(0, '#3a5a40');
            landGradient.addColorStop(0.3, '#2d4a35');
            landGradient.addColorStop(1, '#1a2e20');
            sctx.fillStyle = landGradient;
            sctx.fillRect(0, H * 0.6, W, H * 0.4);
            
            // Forest (based on forest cover)
            const treeCount = Math.floor(state.forest / 5);
            sctx.fillStyle = '#2d5a3a';
            for (let i = 0; i < treeCount; i++) {
                const x = 50 + (i % 20) * (W - 100) / 20;
                const y = H * 0.65 + Math.floor(i / 20) * 30;
                sctx.beginPath();
                sctx.moveTo(x, y - 25);
                sctx.lineTo(x - 15, y + 10);
                sctx.lineTo(x + 15, y + 10);
                sctx.fill();
            }
            
            // Ocean
            const oceanLevel = H * 0.75 + state.seaLevel * 0.1;
            const oceanGradient = sctx.createLinearGradient(0, oceanLevel, 0, H);
            oceanGradient.addColorStop(0, `rgba(30, 100, 180, ${0.8 + state.temp * 0.02})`);
            oceanGradient.addColorStop(1, '#0a3055');
            sctx.fillStyle = oceanGradient;
            sctx.fillRect(0, oceanLevel, W * 0.4, H - oceanLevel);
            
            // Ice caps
            const iceWidth = W * 0.15 * (state.ice / 100);
            sctx.fillStyle = '#e8f4f8';
            sctx.fillRect(0, H * 0.55, iceWidth, H * 0.12);
            sctx.fillRect(W - iceWidth, H * 0.55, iceWidth, H * 0.12);
            
            // Factories (emissions source)
            if (params.emissions > 0) {
                const factoryX = W * 0.7;
                const factoryY = H * 0.58;
                
                // Building
                sctx.fillStyle = '#4a4a4a';
                sctx.fillRect(factoryX, factoryY, 40, 30);
                
                // Smokestack
                sctx.fillRect(factoryX + 15, factoryY - 40, 10, 45);
                
                // Smoke (based on emissions)
                for (let i = 0; i < params.emissions / 2; i++) {
                    const smokeY = factoryY - 50 - i * 15 - (state.year % 20);
                    const smokeSize = 8 + i * 3;
                    sctx.fillStyle = `rgba(100, 100, 100, ${0.5 - i * 0.03})`;
                    sctx.beginPath();
                    sctx.arc(factoryX + 20 + Math.sin(state.year * 0.2 + i) * 10, smokeY, smokeSize, 0, Math.PI * 2);
                    sctx.fill();
                }
            }
            
            // Info labels
            sctx.fillStyle = '#fff';
            sctx.font = 'bold 14px sans-serif';
            sctx.fillText(`Year: ${state.year}`, 20, 30);
            sctx.font = '12px sans-serif';
            sctx.fillText(`CO₂: ${Math.round(state.co2)} ppm`, 20, 50);
            
            // Temperature indicator
            const tempX = W - 100;
            const tempHeight = 100;
            const tempFill = Math.min(1, Math.max(0, state.temp / 4));
            
            sctx.fillStyle = '#333';
            sctx.fillRect(tempX, 30, 20, tempHeight);
            
            const tempGradient = sctx.createLinearGradient(0, 30 + tempHeight, 0, 30);
            tempGradient.addColorStop(0, '#3b82f6');
            tempGradient.addColorStop(0.5, '#f59e0b');
            tempGradient.addColorStop(1, '#ef4444');
            sctx.fillStyle = tempGradient;
            sctx.fillRect(tempX, 30 + tempHeight * (1 - tempFill), 20, tempHeight * tempFill);
            
            sctx.strokeStyle = '#fff';
            sctx.strokeRect(tempX, 30, 20, tempHeight);
            
            sctx.fillStyle = '#aaa';
            sctx.font = '10px sans-serif';
            sctx.fillText('+4°C', tempX + 25, 38);
            sctx.fillText('0°C', tempX + 25, 30 + tempHeight);
        }
        
        function drawGraph() {
            gctx.fillStyle = '#0a0f1a';
            gctx.fillRect(0, 0, GW, GH);
            
            if (history.length < 2) return;
            
            const margin = { left: 60, right: 20, top: 30, bottom: 40 };
            const graphW = GW - margin.left - margin.right;
            const graphH = GH - margin.top - margin.bottom;
            
            // Axes
            gctx.strokeStyle = '#333';
            gctx.lineWidth = 1;
            gctx.beginPath();
            gctx.moveTo(margin.left, margin.top);
            gctx.lineTo(margin.left, GH - margin.bottom);
            gctx.lineTo(GW - margin.right, GH - margin.bottom);
            gctx.stroke();
            
            // Labels
            gctx.fillStyle = '#666';
            gctx.font = '11px sans-serif';
            gctx.fillText('Temperature Anomaly (°C)', margin.left, margin.top - 10);
            gctx.fillText('Year', GW - margin.right - 20, GH - margin.bottom + 30);
            
            // Y-axis labels
            const yLabels = [-1, 0, 1, 2, 3, 4];
            for (const label of yLabels) {
                const y = GH - margin.bottom - ((label + 1) / 5) * graphH;
                gctx.fillStyle = '#444';
                gctx.fillText(`${label}`, margin.left - 25, y + 4);
                gctx.strokeStyle = '#222';
                gctx.beginPath();
                gctx.moveTo(margin.left, y);
                gctx.lineTo(GW - margin.right, y);
                gctx.stroke();
            }
            
            // 1.5°C and 2°C targets
            gctx.strokeStyle = 'rgba(239, 68, 68, 0.5)';
            gctx.setLineDash([5, 5]);
            for (const target of [1.5, 2]) {
                const y = GH - margin.bottom - ((target + 1) / 5) * graphH;
                gctx.beginPath();
                gctx.moveTo(margin.left, y);
                gctx.lineTo(GW - margin.right, y);
                gctx.stroke();
                gctx.fillStyle = '#ef4444';
                gctx.fillText(`${target}°C`, GW - margin.right - 35, y - 3);
            }
            gctx.setLineDash([]);
            
            // Temperature line
            const minYear = history[0].year;
            const maxYear = history[history.length - 1].year;
            
            gctx.strokeStyle = '#10b981';
            gctx.lineWidth = 2;
            gctx.beginPath();
            for (let i = 0; i < history.length; i++) {
                const x = margin.left + ((history[i].year - minYear) / (maxYear - minYear)) * graphW;
                const y = GH - margin.bottom - ((history[i].temp + 1) / 5) * graphH;
                if (i === 0) gctx.moveTo(x, y);
                else gctx.lineTo(x, y);
            }
            gctx.stroke();
            
            // Current point
            const last = history[history.length - 1];
            const cx = GW - margin.right;
            const cy = GH - margin.bottom - ((last.temp + 1) / 5) * graphH;
            gctx.fillStyle = last.temp > 2 ? '#ef4444' : last.temp > 1.5 ? '#f59e0b' : '#10b981';
            gctx.beginPath();
            gctx.arc(cx, cy, 5, 0, Math.PI * 2);
            gctx.fill();
        }
        
        function draw() {
            drawSim();
            drawGraph();
            requestAnimationFrame(draw);
        }
        
        window.setScenario = function(scenario) {
            switch (scenario) {
                case 'bau':
                    params.emissions = 15;
                    params.deforestation = 0.8;
                    break;
                case 'netzero':
                    params.emissions = 5;
                    params.deforestation = 0.1;
                    break;
                case 'rapid':
                    params.emissions = 0;
                    params.deforestation = -0.5; // Reforestation
                    break;
                case 'worst':
                    params.emissions = 30;
                    params.deforestation = 2;
                    break;
            }
            document.getElementById('emissions').value = params.emissions;
            document.getElementById('emissionsVal').textContent = params.emissions;
            document.getElementById('deforest').value = Math.max(0, params.deforestation);
            document.getElementById('deforestVal').textContent = Math.max(0, params.deforestation).toFixed(1);
        };
        
        let intervalId = null;
        function startSim() {
            if (intervalId) clearInterval(intervalId);
            intervalId = setInterval(() => {
                if (!paused) {
                    step();
                }
            }, 100);
        }
        
        // Event listeners
        document.getElementById('emissions').addEventListener('input', e => {
            params.emissions = +e.target.value;
            document.getElementById('emissionsVal').textContent = params.emissions;
        });
        document.getElementById('deforest').addEventListener('input', e => {
            params.deforestation = +e.target.value;
            document.getElementById('deforestVal').textContent = params.deforestation.toFixed(1);
        });
        document.getElementById('solar').addEventListener('input', e => {
            params.solarIntensity = +e.target.value;
            document.getElementById('solarVal').textContent = params.solarIntensity;
        });
        document.getElementById('volcano').addEventListener('input', e => {
            params.volcanicAerosols = +e.target.value;
            document.getElementById('volcanoVal').textContent = params.volcanicAerosols;
        });
        
        document.getElementById('reset').addEventListener('click', () => { init(); startSim(); });
        document.getElementById('pause').addEventListener('click', () => {
            paused = !paused;
            document.getElementById('pause').textContent = paused ? 'Resume' : 'Pause';
        });
        
        window.addEventListener('resize', resize);
        init();
        draw();
        startSim();
    </script>
</body>
</html>
