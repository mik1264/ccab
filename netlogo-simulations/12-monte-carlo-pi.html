<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monte Carlo Pi Estimation</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', system-ui, sans-serif;
            color: #e0e0e0;
        }
        .back-link {
            position: fixed;
            top: 15px;
            left: 15px;
            color: #f39c12;
            text-decoration: none;
            z-index: 100;
        }
        header { text-align: center; padding: 15px; }
        h1 { color: #f39c12; font-size: 1.6rem; }
        .container {
            display: grid;
            grid-template-columns: 1fr 280px;
            gap: 15px;
            padding: 0 15px 15px;
            max-width: 1100px;
            margin: 0 auto;
        }
        .main-area { display: flex; flex-direction: column; gap: 15px; }
        .canvas-wrapper {
            background: rgba(0,0,0,0.4);
            border-radius: 10px;
            padding: 15px;
        }
        .canvas-wrapper h3 {
            color: #f39c12;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        #dartCanvas {
            width: 100%;
            aspect-ratio: 1;
            max-height: 450px;
            background: #0a0a15;
            border-radius: 8px;
        }
        .pi-display {
            text-align: center;
            padding: 20px;
            background: rgba(243, 156, 18, 0.1);
            border: 2px solid rgba(243, 156, 18, 0.3);
            border-radius: 10px;
            margin-top: 15px;
        }
        .pi-value {
            font-size: 2.5rem;
            font-family: 'Courier New', monospace;
            color: #f39c12;
            font-weight: bold;
        }
        .pi-label { color: #888; margin-top: 5px; }
        .sidebar {
            background: rgba(0,0,0,0.4);
            border-radius: 10px;
            padding: 15px;
        }
        .control-group { margin-bottom: 15px; }
        .control-group label {
            display: block;
            color: #f39c12;
            margin-bottom: 6px;
            font-size: 0.85rem;
        }
        input[type="range"] {
            width: 100%;
            -webkit-appearance: none;
            height: 5px;
            background: #333;
            border-radius: 3px;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            background: #f39c12;
            border-radius: 50%;
            cursor: pointer;
        }
        .value-display {
            text-align: right;
            font-size: 0.8rem;
            color: #888;
            margin-top: 4px;
        }
        button {
            width: 100%;
            padding: 10px;
            margin: 4px 0;
            background: #f39c12;
            border: none;
            border-radius: 5px;
            color: #000;
            font-weight: 600;
            cursor: pointer;
        }
        button:hover { background: #e67e22; }
        button.secondary { background: #333; color: #fff; }
        .stats {
            background: rgba(243, 156, 18, 0.1);
            border: 1px solid rgba(243, 156, 18, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 6px 0;
            font-size: 0.8rem;
        }
        .stat-label { color: #888; }
        .stat-value { color: #f39c12; font-family: monospace; }
        .info {
            margin-top: 12px;
            padding: 10px;
            background: rgba(243, 156, 18, 0.1);
            border-radius: 6px;
            font-size: 0.75rem;
            line-height: 1.4;
        }
        .info h4 { color: #f39c12; margin-bottom: 6px; }
        .formula {
            font-family: 'Times New Roman', serif;
            text-align: center;
            padding: 8px;
            background: rgba(0,0,0,0.3);
            border-radius: 4px;
            margin-top: 8px;
        }
        .error-display {
            margin-top: 10px;
            padding: 10px;
            background: rgba(231, 76, 60, 0.1);
            border: 1px solid rgba(231, 76, 60, 0.3);
            border-radius: 6px;
            text-align: center;
        }
        .error-value {
            font-size: 1.2rem;
            color: #e74c3c;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back</a>

    <header>
        <h1>Monte Carlo Pi Estimation</h1>
    </header>

    <div class="container">
        <div class="main-area">
            <div class="canvas-wrapper">
                <h3>Dart Board (Quarter Circle)</h3>
                <canvas id="dartCanvas"></canvas>
            </div>
            <div class="pi-display">
                <div class="pi-value" id="piEstimate">π ≈ 0.0000</div>
                <div class="pi-label">Actual π = 3.14159265...</div>
            </div>
        </div>

        <div class="sidebar">
            <div class="control-group">
                <label>Throwing Speed</label>
                <input type="range" id="speed" min="1" max="100" value="20">
                <div class="value-display"><span id="speedVal">20</span> darts/frame</div>
            </div>

            <button id="startBtn">Start Throwing</button>
            <button id="resetBtn" class="secondary">Reset</button>
            <button id="add1000Btn" class="secondary">Add 1000 Darts</button>
            <button id="add10000Btn" class="secondary">Add 10000 Darts</button>

            <div class="stats">
                <div class="stat-row">
                    <span class="stat-label">Total Darts:</span>
                    <span class="stat-value" id="totalStat">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Inside Circle:</span>
                    <span class="stat-value" id="insideStat">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Outside Circle:</span>
                    <span class="stat-value" id="outsideStat">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Ratio (in/total):</span>
                    <span class="stat-value" id="ratioStat">0.0000</span>
                </div>
            </div>

            <div class="error-display">
                <div>Error from true π</div>
                <div class="error-value" id="errorValue">0.0000</div>
            </div>

            <div class="info">
                <h4>How It Works</h4>
                <p>Throw random darts at a unit square with an inscribed quarter circle.</p>
                <div class="formula">
                    π/4 = (circle area) / (square area)
                </div>
                <p style="margin-top:8px">So: π ≈ 4 × (darts inside) / (total darts)</p>
                <p style="margin-top:8px">Error decreases as 1/√n (law of large numbers).</p>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('dartCanvas');
        const ctx = canvas.getContext('2d');

        function resize() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            render();
        }
        resize();
        window.addEventListener('resize', resize);

        // State
        let dartsInside = 0;
        let dartsOutside = 0;
        let dartPositions = [];
        let running = false;
        let speed = 20;

        const TRUE_PI = Math.PI;
        const MAX_VISIBLE_DARTS = 5000;

        function throwDart() {
            const x = Math.random();
            const y = Math.random();
            const inside = (x * x + y * y) <= 1;

            if (inside) {
                dartsInside++;
            } else {
                dartsOutside++;
            }

            // Store position for rendering (limit to prevent memory issues)
            if (dartPositions.length < MAX_VISIBLE_DARTS) {
                dartPositions.push({ x, y, inside });
            }

            updateStats();
        }

        function throwMultiple(count) {
            for (let i = 0; i < count; i++) {
                const x = Math.random();
                const y = Math.random();
                const inside = (x * x + y * y) <= 1;

                if (inside) {
                    dartsInside++;
                } else {
                    dartsOutside++;
                }

                if (dartPositions.length < MAX_VISIBLE_DARTS) {
                    dartPositions.push({ x, y, inside });
                }
            }
            updateStats();
        }

        function updateStats() {
            const total = dartsInside + dartsOutside;
            const ratio = total > 0 ? dartsInside / total : 0;
            const piEstimate = ratio * 4;
            const error = Math.abs(piEstimate - TRUE_PI);

            document.getElementById('totalStat').textContent = total.toLocaleString();
            document.getElementById('insideStat').textContent = dartsInside.toLocaleString();
            document.getElementById('outsideStat').textContent = dartsOutside.toLocaleString();
            document.getElementById('ratioStat').textContent = ratio.toFixed(6);
            document.getElementById('piEstimate').textContent = `π ≈ ${piEstimate.toFixed(6)}`;
            document.getElementById('errorValue').textContent = error.toFixed(6);
        }

        function render() {
            const w = canvas.width;
            const h = canvas.height;
            const size = Math.min(w, h);
            const offsetX = (w - size) / 2;
            const offsetY = (h - size) / 2;

            ctx.fillStyle = '#0a0a15';
            ctx.fillRect(0, 0, w, h);

            // Draw square
            ctx.strokeStyle = '#f39c12';
            ctx.lineWidth = 2;
            ctx.strokeRect(offsetX, offsetY, size, size);

            // Draw quarter circle
            ctx.beginPath();
            ctx.strokeStyle = '#3498db';
            ctx.lineWidth = 3;
            ctx.arc(offsetX, offsetY + size, size, -Math.PI / 2, 0);
            ctx.stroke();

            // Fill quarter circle area (subtle)
            ctx.beginPath();
            ctx.fillStyle = 'rgba(52, 152, 219, 0.1)';
            ctx.moveTo(offsetX, offsetY + size);
            ctx.arc(offsetX, offsetY + size, size, -Math.PI / 2, 0);
            ctx.lineTo(offsetX, offsetY + size);
            ctx.fill();

            // Draw darts
            dartPositions.forEach(dart => {
                const px = offsetX + dart.x * size;
                const py = offsetY + (1 - dart.y) * size;

                ctx.fillStyle = dart.inside ? '#2ecc71' : '#e74c3c';
                ctx.beginPath();
                ctx.arc(px, py, 2, 0, Math.PI * 2);
                ctx.fill();
            });

            // Labels
            ctx.fillStyle = '#888';
            ctx.font = '12px sans-serif';
            ctx.fillText('(0,0)', offsetX + 5, offsetY + size - 5);
            ctx.fillText('(1,0)', offsetX + size - 25, offsetY + size - 5);
            ctx.fillText('(0,1)', offsetX + 5, offsetY + 15);
        }

        function animate() {
            if (running) {
                for (let i = 0; i < speed; i++) {
                    throwDart();
                }
            }
            render();
            requestAnimationFrame(animate);
        }

        // Event handlers
        document.getElementById('speed').addEventListener('input', (e) => {
            speed = parseInt(e.target.value);
            document.getElementById('speedVal').textContent = speed;
        });

        document.getElementById('startBtn').addEventListener('click', () => {
            running = !running;
            document.getElementById('startBtn').textContent = running ? 'Pause' : 'Start Throwing';
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            running = false;
            document.getElementById('startBtn').textContent = 'Start Throwing';
            dartsInside = 0;
            dartsOutside = 0;
            dartPositions = [];
            updateStats();
        });

        document.getElementById('add1000Btn').addEventListener('click', () => {
            throwMultiple(1000);
        });

        document.getElementById('add10000Btn').addEventListener('click', () => {
            throwMultiple(10000);
        });

        updateStats();
        animate();
    </script>
</body>
</html>
