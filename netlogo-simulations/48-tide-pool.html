<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tide Pool Ecosystem - CCAB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a2e;
            color: #e8e6e1;
            overflow: hidden;
        }
        #container { display: flex; height: 100vh; }
        canvas { display: block; width: 100%; height: 100%; }
        #controls { width: 280px; background: rgba(0,0,0,0.8); padding: 20px; overflow-y: auto; }
        h1 { font-size: 1.2rem; margin-bottom: 15px; color: #0ea5e9; }
        .control-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.8rem; margin-bottom: 5px; color: #aaa; }
        input[type="range"] { width: 100%; margin-bottom: 5px; }
        button { width: 100%; padding: 10px; margin-bottom: 10px; background: #0ea5e9; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        button:hover { background: #0284c7; }
        .stats { background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px; font-size: 0.8rem; }
        .stats div { margin-bottom: 5px; }
        .back-link { position: fixed; top: 10px; left: 10px; padding: 8px 16px; background: rgba(0,0,0,0.7); color: #0ea5e9; text-decoration: none; border-radius: 6px; font-size: 14px; z-index: 999; }
        .description { font-size: 0.75rem; color: #888; margin-bottom: 15px; line-height: 1.5; }
        .tide-indicator { text-align: center; padding: 10px; background: rgba(0,100,200,0.3); border-radius: 5px; margin-bottom: 15px; }
        .tide-indicator .level { font-size: 1.5rem; font-weight: bold; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Gallery</a>
    <div id="container">
        <canvas id="canvas"></canvas>
        <div id="controls">
            <h1>Tide Pool Ecosystem</h1>
            <p class="description">A tidal ecosystem with zonation patterns. Species adapt to different exposure levels as tides rise and fall in a 12-hour cycle.</p>
            <div class="tide-indicator">
                <div>Tide Level</div>
                <div class="level" id="tideLevel">50%</div>
                <div id="tidePhase">Rising</div>
            </div>
            <div class="control-group">
                <label>Tide Speed: <span id="tideSpeedValue">1</span>x</label>
                <input type="range" id="tideSpeed" min="1" max="10" value="1">
            </div>
            <div class="control-group">
                <label>Wave Intensity: <span id="waveValue">0.5</span></label>
                <input type="range" id="wave" min="0" max="1" step="0.1" value="0.5">
            </div>
            <div class="control-group">
                <label>Temperature: <span id="tempValue">18</span>°C</label>
                <input type="range" id="temp" min="10" max="30" value="18">
            </div>
            <button id="reset">Reset Ecosystem</button>
            <button id="lowTide">Force Low Tide</button>
            <button id="highTide">Force High Tide</button>
            <button id="storm">Storm Event</button>
            <div class="stats">
                <div>Hour: <span id="hour">0</span>:00</div>
                <div>Barnacles: <span id="barnacles">0</span></div>
                <div>Mussels: <span id="mussels">0</span></div>
                <div>Anemones: <span id="anemones">0</span></div>
                <div>Starfish: <span id="starfish">0</span></div>
                <div>Crabs: <span id="crabs">0</span></div>
                <div>Algae Coverage: <span id="algae">0</span>%</div>
            </div>
        </div>
    </div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let width, height;

        let time = 0, tideLevel = 0.5;
        let organisms = [], rocks = [], algae = [];
        let params = { tideSpeed: 1, wave: 0.5, temp: 18 };

        const ZONES = {
            SPLASH: { min: 0.85, max: 1.0, color: '#8B7355' },
            HIGH_INTERTIDAL: { min: 0.65, max: 0.85, color: '#6B8E6B' },
            MID_INTERTIDAL: { min: 0.4, max: 0.65, color: '#4A766E' },
            LOW_INTERTIDAL: { min: 0.15, max: 0.4, color: '#2E5A5A' },
            SUBTIDAL: { min: 0, max: 0.15, color: '#1E3D59' }
        };

        function resize() {
            canvas.width = canvas.clientWidth;
            canvas.height = canvas.clientHeight;
            width = canvas.width;
            height = canvas.height;
        }

        function getZone(y) {
            const normalizedY = y / height;
            for (let [name, zone] of Object.entries(ZONES)) {
                if (normalizedY >= zone.min && normalizedY < zone.max) return name;
            }
            return 'SUBTIDAL';
        }

        function init() {
            resize();
            organisms = [];
            rocks = [];
            algae = [];
            time = 0;

            // Create rocky terrain
            for (let i = 0; i < 50; i++) {
                rocks.push({
                    x: Math.random() * width,
                    y: Math.random() * height,
                    size: 20 + Math.random() * 40,
                    color: `hsl(30, ${10 + Math.random() * 20}%, ${30 + Math.random() * 20}%)`
                });
            }

            // Spawn organisms based on zonation
            // Barnacles - high intertidal
            for (let i = 0; i < 100; i++) {
                organisms.push({
                    type: 'barnacle',
                    x: Math.random() * width,
                    y: height * (0.65 + Math.random() * 0.25),
                    size: 3 + Math.random() * 3,
                    health: 100,
                    exposed: 0
                });
            }

            // Mussels - mid intertidal
            for (let i = 0; i < 80; i++) {
                organisms.push({
                    type: 'mussel',
                    x: Math.random() * width,
                    y: height * (0.4 + Math.random() * 0.3),
                    size: 5 + Math.random() * 5,
                    health: 100,
                    angle: Math.random() * Math.PI
                });
            }

            // Anemones - low intertidal
            for (let i = 0; i < 40; i++) {
                organisms.push({
                    type: 'anemone',
                    x: Math.random() * width,
                    y: height * (0.15 + Math.random() * 0.35),
                    size: 10 + Math.random() * 15,
                    health: 100,
                    open: true,
                    tentacles: 12 + Math.floor(Math.random() * 8),
                    color: ['#FF6B6B', '#4ECDC4', '#9B59B6', '#F39C12'][Math.floor(Math.random() * 4)]
                });
            }

            // Starfish - mobile predators
            for (let i = 0; i < 15; i++) {
                organisms.push({
                    type: 'starfish',
                    x: Math.random() * width,
                    y: height * (0.2 + Math.random() * 0.5),
                    size: 15 + Math.random() * 10,
                    health: 100,
                    angle: Math.random() * Math.PI * 2,
                    vx: 0, vy: 0,
                    color: ['#FF4500', '#8B008B', '#FFD700'][Math.floor(Math.random() * 3)]
                });
            }

            // Crabs - mobile scavengers
            for (let i = 0; i < 20; i++) {
                organisms.push({
                    type: 'crab',
                    x: Math.random() * width,
                    y: height * (0.3 + Math.random() * 0.5),
                    size: 8 + Math.random() * 8,
                    health: 100,
                    vx: 0, vy: 0,
                    direction: Math.random() > 0.5 ? 1 : -1
                });
            }

            // Algae patches
            for (let i = 0; i < 200; i++) {
                algae.push({
                    x: Math.random() * width,
                    y: height * (0.2 + Math.random() * 0.6),
                    size: 5 + Math.random() * 15,
                    health: 100
                });
            }
        }

        function update() {
            time += 0.01 * params.tideSpeed;

            // Sinusoidal tide (12-hour cycle represented)
            tideLevel = 0.5 + 0.4 * Math.sin(time * 0.5);
            const waterLine = height * (1 - tideLevel);

            // Update organisms
            for (let org of organisms) {
                const isSubmerged = org.y > waterLine;

                switch (org.type) {
                    case 'barnacle':
                        // Barnacles can survive exposure but need water to feed
                        if (!isSubmerged) {
                            org.exposed++;
                            if (org.exposed > 500) org.health -= 0.1;
                        } else {
                            org.exposed = 0;
                            if (org.health < 100) org.health += 0.05;
                        }
                        break;

                    case 'mussel':
                        // Mussels filter feed when submerged
                        if (isSubmerged) {
                            if (org.health < 100) org.health += 0.1;
                        } else {
                            org.health -= 0.05;
                        }
                        break;

                    case 'anemone':
                        // Anemones close when exposed
                        org.open = isSubmerged;
                        if (!isSubmerged) {
                            org.health -= 0.2;
                        } else {
                            if (org.health < 100) org.health += 0.1;
                        }
                        break;

                    case 'starfish':
                        // Starfish move slowly, hunt mussels
                        if (isSubmerged) {
                            org.vx += (Math.random() - 0.5) * 0.1;
                            org.vy += (Math.random() - 0.5) * 0.1;
                            org.vx *= 0.95;
                            org.vy *= 0.95;
                            org.x += org.vx;
                            org.y += org.vy;
                            org.angle += 0.01;

                            // Hunt mussels
                            for (let prey of organisms) {
                                if (prey.type === 'mussel' && prey.health > 0) {
                                    const dx = prey.x - org.x;
                                    const dy = prey.y - org.y;
                                    const dist = Math.sqrt(dx * dx + dy * dy);
                                    if (dist < org.size) {
                                        prey.health -= 0.5;
                                        if (org.health < 100) org.health += 0.1;
                                    }
                                }
                            }
                        }
                        // Keep in bounds
                        org.x = Math.max(0, Math.min(width, org.x));
                        org.y = Math.max(waterLine, Math.min(height, org.y));
                        break;

                    case 'crab':
                        // Crabs scuttle sideways
                        if (Math.random() < 0.02) org.direction *= -1;
                        org.vx = org.direction * (0.5 + Math.random());
                        org.vy = (Math.random() - 0.5) * 0.5;
                        org.x += org.vx;
                        org.y += org.vy;

                        // Keep in water or near waterline
                        if (org.y < waterLine - 20) org.y = waterLine - 20;
                        if (org.y > height - 10) org.y = height - 10;
                        if (org.x < 0) { org.x = 0; org.direction = 1; }
                        if (org.x > width) { org.x = width; org.direction = -1; }
                        break;
                }

                // Temperature stress
                if (params.temp > 25 && !isSubmerged) {
                    org.health -= 0.1 * (params.temp - 25) / 5;
                }

                // Remove dead organisms
                org.health = Math.max(0, Math.min(100, org.health));
            }

            // Update algae
            for (let a of algae) {
                const isSubmerged = a.y > waterLine;
                if (isSubmerged) {
                    if (a.health < 100) a.health += 0.05;
                } else {
                    a.health -= 0.1;
                }
            }
        }

        function draw() {
            // Sky
            ctx.fillStyle = '#87CEEB';
            ctx.fillRect(0, 0, width, height);

            const waterLine = height * (1 - tideLevel);

            // Draw zones
            for (let [name, zone] of Object.entries(ZONES)) {
                ctx.fillStyle = zone.color;
                ctx.fillRect(0, height * zone.min, width, height * (zone.max - zone.min));
            }

            // Draw rocks
            for (let rock of rocks) {
                ctx.fillStyle = rock.color;
                ctx.beginPath();
                ctx.ellipse(rock.x, rock.y, rock.size, rock.size * 0.6, 0, 0, Math.PI * 2);
                ctx.fill();
            }

            // Draw algae
            for (let a of algae) {
                if (a.health > 0) {
                    ctx.fillStyle = `rgba(34, 139, 34, ${a.health / 100 * 0.7})`;
                    ctx.beginPath();
                    ctx.arc(a.x, a.y, a.size * (a.health / 100), 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            // Draw organisms
            for (let org of organisms) {
                if (org.health <= 0) continue;
                const alpha = org.health / 100;

                switch (org.type) {
                    case 'barnacle':
                        ctx.fillStyle = `rgba(220, 220, 200, ${alpha})`;
                        ctx.beginPath();
                        ctx.arc(org.x, org.y, org.size, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.strokeStyle = '#888';
                        ctx.stroke();
                        break;

                    case 'mussel':
                        ctx.save();
                        ctx.translate(org.x, org.y);
                        ctx.rotate(org.angle);
                        ctx.fillStyle = `rgba(25, 25, 112, ${alpha})`;
                        ctx.beginPath();
                        ctx.ellipse(0, 0, org.size, org.size * 0.5, 0, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.restore();
                        break;

                    case 'anemone':
                        ctx.fillStyle = org.color;
                        ctx.globalAlpha = alpha;
                        // Base
                        ctx.beginPath();
                        ctx.arc(org.x, org.y, org.size * 0.5, 0, Math.PI * 2);
                        ctx.fill();
                        // Tentacles
                        if (org.open) {
                            for (let i = 0; i < org.tentacles; i++) {
                                const angle = (i / org.tentacles) * Math.PI * 2;
                                const wave = Math.sin(time * 2 + i) * 3;
                                ctx.beginPath();
                                ctx.moveTo(org.x, org.y);
                                ctx.quadraticCurveTo(
                                    org.x + Math.cos(angle) * org.size * 0.7 + wave,
                                    org.y + Math.sin(angle) * org.size * 0.7,
                                    org.x + Math.cos(angle) * org.size,
                                    org.y + Math.sin(angle) * org.size
                                );
                                ctx.strokeStyle = org.color;
                                ctx.lineWidth = 2;
                                ctx.stroke();
                            }
                        }
                        ctx.globalAlpha = 1;
                        break;

                    case 'starfish':
                        ctx.save();
                        ctx.translate(org.x, org.y);
                        ctx.rotate(org.angle);
                        ctx.fillStyle = org.color;
                        ctx.globalAlpha = alpha;
                        // Draw 5 arms
                        for (let i = 0; i < 5; i++) {
                            ctx.save();
                            ctx.rotate(i * Math.PI * 2 / 5);
                            ctx.beginPath();
                            ctx.moveTo(0, 0);
                            ctx.lineTo(-org.size * 0.3, -org.size);
                            ctx.lineTo(org.size * 0.3, -org.size);
                            ctx.closePath();
                            ctx.fill();
                            ctx.restore();
                        }
                        ctx.globalAlpha = 1;
                        ctx.restore();
                        break;

                    case 'crab':
                        ctx.fillStyle = `rgba(178, 34, 34, ${alpha})`;
                        // Body
                        ctx.beginPath();
                        ctx.ellipse(org.x, org.y, org.size, org.size * 0.7, 0, 0, Math.PI * 2);
                        ctx.fill();
                        // Claws
                        ctx.beginPath();
                        ctx.arc(org.x - org.size * 1.2, org.y, org.size * 0.4, 0, Math.PI * 2);
                        ctx.arc(org.x + org.size * 1.2, org.y, org.size * 0.4, 0, Math.PI * 2);
                        ctx.fill();
                        // Eyes
                        ctx.fillStyle = 'black';
                        ctx.beginPath();
                        ctx.arc(org.x - org.size * 0.3, org.y - org.size * 0.5, 2, 0, Math.PI * 2);
                        ctx.arc(org.x + org.size * 0.3, org.y - org.size * 0.5, 2, 0, Math.PI * 2);
                        ctx.fill();
                        break;
                }
            }

            // Draw water surface with waves
            ctx.fillStyle = 'rgba(30, 144, 255, 0.4)';
            ctx.beginPath();
            ctx.moveTo(0, waterLine);
            for (let x = 0; x <= width; x += 10) {
                const waveY = waterLine + Math.sin(x * 0.02 + time * 3) * 5 * params.wave;
                ctx.lineTo(x, waveY);
            }
            ctx.lineTo(width, height);
            ctx.lineTo(0, height);
            ctx.closePath();
            ctx.fill();

            // Update UI
            const hour = Math.floor((time * 2) % 24);
            document.getElementById('hour').textContent = hour;
            document.getElementById('tideLevel').textContent = Math.round(tideLevel * 100) + '%';
            document.getElementById('tidePhase').textContent = Math.cos(time * 0.5) > 0 ? 'Rising' : 'Falling';

            // Count organisms
            const counts = { barnacle: 0, mussel: 0, anemone: 0, starfish: 0, crab: 0 };
            for (let org of organisms) {
                if (org.health > 0) counts[org.type]++;
            }
            document.getElementById('barnacles').textContent = counts.barnacle;
            document.getElementById('mussels').textContent = counts.mussel;
            document.getElementById('anemones').textContent = counts.anemone;
            document.getElementById('starfish').textContent = counts.starfish;
            document.getElementById('crabs').textContent = counts.crab;

            const healthyAlgae = algae.filter(a => a.health > 50).length;
            document.getElementById('algae').textContent = Math.round(healthyAlgae / algae.length * 100);
        }

        function animate() {
            update();
            draw();
            requestAnimationFrame(animate);
        }

        // Event listeners
        document.getElementById('tideSpeed').addEventListener('input', e => {
            params.tideSpeed = parseInt(e.target.value);
            document.getElementById('tideSpeedValue').textContent = params.tideSpeed;
        });
        document.getElementById('wave').addEventListener('input', e => {
            params.wave = parseFloat(e.target.value);
            document.getElementById('waveValue').textContent = params.wave.toFixed(1);
        });
        document.getElementById('temp').addEventListener('input', e => {
            params.temp = parseInt(e.target.value);
            document.getElementById('tempValue').textContent = params.temp;
        });

        document.getElementById('reset').addEventListener('click', init);
        document.getElementById('lowTide').addEventListener('click', () => { time = Math.PI; });
        document.getElementById('highTide').addEventListener('click', () => { time = 0; });
        document.getElementById('storm').addEventListener('click', () => {
            params.wave = 1.0;
            document.getElementById('wave').value = 1.0;
            document.getElementById('waveValue').textContent = '1.0';
            // Storm damages exposed organisms
            for (let org of organisms) {
                if (org.y < height * (1 - tideLevel)) {
                    org.health -= 20;
                }
            }
        });

        window.addEventListener('resize', () => { resize(); init(); });
        init();
        animate();
    </script>
</body>
</html>
