<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tragedy of the Commons - CCAB</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            font-family: 'Segoe UI', Arial, sans-serif;
            color: white;
        }
        .container { display: flex; height: 100vh; }
        .canvas-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            gap: 10px;
        }
        canvas { border: 2px solid rgba(255, 255, 255, 0.2); border-radius: 8px; }
        .controls {
            width: 320px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.6);
            overflow-y: auto;
        }
        h2 { margin: 0 0 15px 0; color: #55efc4; }
        h3 { margin: 15px 0 8px 0; color: #81ecec; font-size: 14px; }
        .slider-group { margin: 12px 0; }
        .slider-group label { display: block; margin-bottom: 5px; font-size: 13px; }
        input[type="range"] { width: 100%; }
        .stats {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .stat-row { display: flex; justify-content: space-between; margin: 5px 0; font-size: 13px; }
        .description {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            border-radius: 8px;
            font-size: 12px;
            line-height: 1.5;
            margin-top: 15px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            background: #55efc4;
            color: #1a1a2e;
            font-weight: bold;
        }
        button:hover { background: #00b894; }
        .resource-bar {
            height: 20px;
            background: #2d3436;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .resource-fill {
            height: 100%;
            background: linear-gradient(90deg, #e17055, #ffeaa7, #55efc4);
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <a href="index.html" class="organic-back-link" style="position: fixed; top: 20px; right: 20px; z-index: 1000; display: flex; align-items: center; gap: 8px; padding: 10px 16px; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); border-radius: 30px; text-decoration: none; color: #606C38; font-family: 'Nunito', sans-serif; font-weight: 600;">
        <span>‚Üê Gallery</span>
    </a>
    <div class="container">
        <div class="canvas-area">
            <canvas id="commonsCanvas"></canvas>
            <canvas id="graphCanvas"></canvas>
        </div>
        <div class="controls">
            <h2>üåø Tragedy of the Commons</h2>
            <p style="font-size: 12px; opacity: 0.8;">Shared resource depletion</p>

            <div class="resource-bar">
                <div class="resource-fill" id="resourceBar" style="width: 100%;"></div>
            </div>

            <h3>Number of Harvesters</h3>
            <div class="slider-group">
                <label>Harvesters: <span id="harvestersVal">10</span></label>
                <input type="range" id="harvesters" min="2" max="30" step="1" value="10">
            </div>

            <h3>Greed Level</h3>
            <div class="slider-group">
                <label>Greed: <span id="greedVal">0.5</span></label>
                <input type="range" id="greed" min="0.1" max="1.0" step="0.1" value="0.5">
            </div>

            <h3>Resource Regrowth Rate</h3>
            <div class="slider-group">
                <label>Regrowth: <span id="regrowthVal">0.02</span></label>
                <input type="range" id="regrowth" min="0.005" max="0.1" step="0.005" value="0.02">
            </div>

            <h3>Cooperation Chance</h3>
            <div class="slider-group">
                <label>Cooperate: <span id="cooperateVal">0.0</span></label>
                <input type="range" id="cooperate" min="0" max="1" step="0.1" value="0">
            </div>

            <h3>Speed</h3>
            <div class="slider-group">
                <label>Delay: <span id="speedVal">50</span>ms</label>
                <input type="range" id="speed" min="10" max="200" step="10" value="50">
            </div>

            <button onclick="reset()">Reset</button>
            <button onclick="togglePause()" id="pauseBtn">Pause</button>

            <div class="stats">
                <div class="stat-row"><span>Time:</span><span id="time">0</span></div>
                <div class="stat-row"><span>Resource Level:</span><span id="resource">100%</span></div>
                <div class="stat-row"><span>Total Harvested:</span><span id="harvested">0</span></div>
                <div class="stat-row"><span>Avg per Harvester:</span><span id="avgHarvest">0</span></div>
                <div class="stat-row"><span>Cooperators:</span><span id="cooperators">0</span></div>
                <div class="stat-row"><span>Defectors:</span><span id="defectors">0</span></div>
                <div class="stat-row"><span>Collapse?:</span><span id="collapsed">No</span></div>
            </div>

            <div class="description">
                <strong>Tragedy of the Commons:</strong><br>
                Shared resources face overexploitation when individuals act in self-interest.<br><br>
                <strong>Key Parameters:</strong><br>
                ‚Ä¢ Greed: How much each harvester takes<br>
                ‚Ä¢ Regrowth: How fast resource recovers<br>
                ‚Ä¢ Cooperation: Chance to harvest sustainably<br><br>
                <strong>Outcomes:</strong><br>
                ‚Ä¢ Low greed + high regrowth = sustainable<br>
                ‚Ä¢ High greed = resource collapse<br>
                ‚Ä¢ Cooperation prevents tragedy
            </div>
        </div>
    </div>

    <script>
        const commonsCanvas = document.getElementById('commonsCanvas');
        const commonsCtx = commonsCanvas.getContext('2d');
        const graphCanvas = document.getElementById('graphCanvas');
        const graphCtx = graphCanvas.getContext('2d');

        commonsCanvas.width = 600;
        commonsCanvas.height = 400;
        graphCanvas.width = 600;
        graphCanvas.height = 120;

        let harvesters = [];
        let numHarvesters = 10;
        let greed = 0.5;
        let regrowth = 0.02;
        let cooperateChance = 0;
        let speed = 50;
        let resource = 100;
        let maxResource = 100;
        let time = 0;
        let paused = false;
        let animationId = null;
        let totalHarvested = 0;
        let collapsed = false;
        let history = { resource: [], harvested: [] };

        function createHarvesters() {
            harvesters = [];
            for (let i = 0; i < numHarvesters; i++) {
                harvesters.push({
                    x: Math.random() * commonsCanvas.width,
                    y: Math.random() * commonsCanvas.height,
                    vx: (Math.random() - 0.5) * 2,
                    vy: (Math.random() - 0.5) * 2,
                    harvested: 0,
                    cooperator: Math.random() < cooperateChance,
                    size: 8
                });
            }
        }

        function reset() {
            if (animationId) clearTimeout(animationId);
            numHarvesters = parseInt(document.getElementById('harvesters').value);
            greed = parseFloat(document.getElementById('greed').value);
            regrowth = parseFloat(document.getElementById('regrowth').value);
            cooperateChance = parseFloat(document.getElementById('cooperate').value);
            speed = parseInt(document.getElementById('speed').value);

            resource = maxResource;
            time = 0;
            totalHarvested = 0;
            collapsed = false;
            history = { resource: [], harvested: [] };
            paused = false;
            document.getElementById('pauseBtn').textContent = 'Pause';

            createHarvesters();
            updateStats();
            draw();
            animate();
        }

        function step() {
            // Resource regrowth (logistic growth)
            const growthFactor = regrowth * resource * (1 - resource / maxResource);
            resource = Math.min(maxResource, resource + growthFactor);

            let frameHarvested = 0;

            // Harvester actions
            for (const h of harvesters) {
                // Movement
                h.x += h.vx;
                h.y += h.vy;

                // Bounce off walls
                if (h.x < h.size || h.x > commonsCanvas.width - h.size) h.vx *= -1;
                if (h.y < h.size || h.y > commonsCanvas.height - h.size) h.vy *= -1;
                h.x = Math.max(h.size, Math.min(commonsCanvas.width - h.size, h.x));
                h.y = Math.max(h.size, Math.min(commonsCanvas.height - h.size, h.y));

                // Harvesting
                if (resource > 0 && !collapsed) {
                    let harvestAmount;
                    if (h.cooperator) {
                        // Sustainable harvest: take only regrowth rate
                        harvestAmount = Math.min(resource * regrowth / numHarvesters, resource / numHarvesters);
                    } else {
                        // Greedy harvest
                        harvestAmount = greed * resource / numHarvesters * 0.5;
                    }

                    harvestAmount = Math.max(0, Math.min(harvestAmount, resource));
                    resource -= harvestAmount;
                    h.harvested += harvestAmount;
                    frameHarvested += harvestAmount;
                    totalHarvested += harvestAmount;
                }

                // Random direction changes
                if (Math.random() < 0.02) {
                    h.vx = (Math.random() - 0.5) * 2;
                    h.vy = (Math.random() - 0.5) * 2;
                }
            }

            // Check for collapse
            if (resource < 1 && !collapsed) {
                collapsed = true;
            }

            time++;

            // Record history
            history.resource.push(resource);
            history.harvested.push(frameHarvested);
            if (history.resource.length > 300) {
                history.resource.shift();
                history.harvested.shift();
            }
        }

        function updateStats() {
            const cooperators = harvesters.filter(h => h.cooperator).length;
            const defectors = numHarvesters - cooperators;
            const avgHarvest = numHarvesters > 0 ? totalHarvested / numHarvesters : 0;

            document.getElementById('time').textContent = time;
            document.getElementById('resource').textContent = (resource / maxResource * 100).toFixed(1) + '%';
            document.getElementById('harvested').textContent = totalHarvested.toFixed(0);
            document.getElementById('avgHarvest').textContent = avgHarvest.toFixed(1);
            document.getElementById('cooperators').textContent = cooperators;
            document.getElementById('defectors').textContent = defectors;
            document.getElementById('collapsed').textContent = collapsed ? 'YES!' : 'No';
            document.getElementById('collapsed').style.color = collapsed ? '#e17055' : '#55efc4';

            // Update resource bar
            const percent = Math.max(0, Math.min(100, resource / maxResource * 100));
            document.getElementById('resourceBar').style.width = percent + '%';
        }

        function draw() {
            // Draw commons (field)
            const brightness = Math.max(0.2, resource / maxResource);
            commonsCtx.fillStyle = `rgba(46, 213, 115, ${brightness})`;
            commonsCtx.fillRect(0, 0, commonsCanvas.width, commonsCanvas.height);

            // Draw grass patches based on resource level
            const numPatches = Math.floor(resource / maxResource * 50);
            commonsCtx.fillStyle = 'rgba(39, 174, 96, 0.6)';
            for (let i = 0; i < numPatches; i++) {
                const x = (i * 137) % commonsCanvas.width;
                const y = (i * 73) % commonsCanvas.height;
                const size = 5 + (resource / maxResource) * 10;
                commonsCtx.beginPath();
                commonsCtx.arc(x, y, size, 0, Math.PI * 2);
                commonsCtx.fill();
            }

            // Draw harvesters
            for (const h of harvesters) {
                // Color based on cooperator status and harvest amount
                if (h.cooperator) {
                    commonsCtx.fillStyle = '#74b9ff'; // Blue for cooperators
                } else {
                    commonsCtx.fillStyle = '#e17055'; // Red for defectors
                }

                commonsCtx.beginPath();
                commonsCtx.arc(h.x, h.y, h.size, 0, Math.PI * 2);
                commonsCtx.fill();

                // Size indicator based on harvest
                const harvestIndicator = Math.min(5, h.harvested / 100);
                if (harvestIndicator > 0) {
                    commonsCtx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
                    commonsCtx.lineWidth = 2;
                    commonsCtx.beginPath();
                    commonsCtx.arc(h.x, h.y, h.size + harvestIndicator, 0, Math.PI * 2);
                    commonsCtx.stroke();
                }
            }

            // Warning if near collapse
            if (resource < maxResource * 0.2) {
                commonsCtx.fillStyle = `rgba(225, 112, 85, ${0.5 - resource / maxResource * 2})`;
                commonsCtx.fillRect(0, 0, commonsCanvas.width, commonsCanvas.height);

                if (collapsed) {
                    commonsCtx.fillStyle = 'white';
                    commonsCtx.font = 'bold 30px Arial';
                    commonsCtx.textAlign = 'center';
                    commonsCtx.fillText('RESOURCE COLLAPSED!', commonsCanvas.width / 2, commonsCanvas.height / 2);
                }
            }

            // Draw graph
            graphCtx.fillStyle = '#1a1a2e';
            graphCtx.fillRect(0, 0, graphCanvas.width, graphCanvas.height);

            if (history.resource.length > 1) {
                // Resource level
                graphCtx.strokeStyle = '#55efc4';
                graphCtx.lineWidth = 2;
                graphCtx.beginPath();
                for (let i = 0; i < history.resource.length; i++) {
                    const x = (i / (history.resource.length - 1)) * graphCanvas.width;
                    const y = graphCanvas.height - 10 - (history.resource[i] / maxResource) * (graphCanvas.height - 20);
                    if (i === 0) graphCtx.moveTo(x, y);
                    else graphCtx.lineTo(x, y);
                }
                graphCtx.stroke();

                // Sustainable threshold line
                graphCtx.strokeStyle = 'rgba(255, 234, 167, 0.5)';
                graphCtx.setLineDash([5, 5]);
                graphCtx.beginPath();
                const sustainableLevel = maxResource * 0.5;
                const y = graphCanvas.height - 10 - (sustainableLevel / maxResource) * (graphCanvas.height - 20);
                graphCtx.moveTo(0, y);
                graphCtx.lineTo(graphCanvas.width, y);
                graphCtx.stroke();
                graphCtx.setLineDash([]);
            }

            graphCtx.fillStyle = 'white';
            graphCtx.font = '11px Arial';
            graphCtx.fillText('Resource level over time', 5, 12);
            graphCtx.fillStyle = 'rgba(255, 234, 167, 0.8)';
            graphCtx.fillText('Sustainable level', graphCanvas.width - 100, 12);
        }

        function animate() {
            if (!paused) {
                step();
                updateStats();
            }
            draw();
            animationId = setTimeout(animate, speed);
        }

        function togglePause() {
            paused = !paused;
            document.getElementById('pauseBtn').textContent = paused ? 'Resume' : 'Pause';
        }

        // Event listeners
        document.getElementById('harvesters').oninput = function() {
            document.getElementById('harvestersVal').textContent = this.value;
        };
        document.getElementById('greed').oninput = function() {
            greed = parseFloat(this.value);
            document.getElementById('greedVal').textContent = greed.toFixed(1);
        };
        document.getElementById('regrowth').oninput = function() {
            regrowth = parseFloat(this.value);
            document.getElementById('regrowthVal').textContent = regrowth.toFixed(3);
        };
        document.getElementById('cooperate').oninput = function() {
            cooperateChance = parseFloat(this.value);
            document.getElementById('cooperateVal').textContent = cooperateChance.toFixed(1);
        };
        document.getElementById('speed').oninput = function() {
            speed = parseInt(this.value);
            document.getElementById('speedVal').textContent = speed;
        };

        reset();
    </script>
</body>
</html>
