<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rabbits Grass Weeds - CCAB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #1a2f1a; color: #e8e6e1; overflow: hidden; }
        #container { display: flex; height: 100vh; }
        #canvas-container { flex: 1; position: relative; display: flex; flex-direction: column; }
        #sim-canvas { flex: 1; }
        #graph-canvas { height: 150px; border-top: 1px solid #333; }
        canvas { display: block; width: 100%; height: 100%; }
        #controls { width: 280px; background: rgba(0,0,0,0.9); padding: 20px; overflow-y: auto; }
        h1 { font-size: 1.2rem; margin-bottom: 15px; color: #86efac; }
        .control-group { margin-bottom: 12px; }
        label { display: block; font-size: 0.75rem; margin-bottom: 3px; color: #aaa; }
        input[type="range"] { width: 100%; }
        button { width: 100%; padding: 8px; margin-bottom: 8px; background: #22c55e; color: #1a2f1a; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 0.85rem; }
        button:hover { background: #16a34a; }
        .stats { background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px; font-size: 0.75rem; margin-bottom: 15px; }
        .stats div { margin-bottom: 3px; }
        .back-link { position: fixed; top: 10px; left: 10px; padding: 8px 16px; background: rgba(0,0,0,0.7); color: #86efac; text-decoration: none; border-radius: 6px; font-size: 14px; z-index: 999; }
        .description { font-size: 0.7rem; color: #888; margin-bottom: 12px; line-height: 1.4; }
        .legend { display: flex; gap: 10px; margin-bottom: 10px; font-size: 0.7rem; flex-wrap: wrap; }
        .legend-item { display: flex; align-items: center; gap: 4px; }
        .legend-color { width: 10px; height: 10px; border-radius: 2px; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back</a>
    <div id="container">
        <div id="canvas-container">
            <canvas id="sim-canvas"></canvas>
            <canvas id="graph-canvas"></canvas>
        </div>
        <div id="controls">
            <h1>Rabbits, Grass & Weeds</h1>
            <p class="description">Three-species ecosystem with rabbits eating grass and weeds. Grass and weeds compete for space. Rabbits need energy to survive and reproduce.</p>
            
            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background: #22c55e;"></div>Grass</div>
                <div class="legend-item"><div class="legend-color" style="background: #eab308;"></div>Weeds</div>
                <div class="legend-item"><div class="legend-color" style="background: #f97316;"></div>Rabbits</div>
            </div>
            
            <div class="control-group">
                <label>Initial Rabbits: <span id="rabbitsVal">20</span></label>
                <input type="range" id="rabbits" min="5" max="100" value="20">
            </div>
            <div class="control-group">
                <label>Grass Growth Rate: <span id="grassGrowthVal">3</span>%</label>
                <input type="range" id="grassGrowth" min="1" max="10" value="3">
            </div>
            <div class="control-group">
                <label>Weed Growth Rate: <span id="weedGrowthVal">2</span>%</label>
                <input type="range" id="weedGrowth" min="1" max="10" value="2">
            </div>
            <div class="control-group">
                <label>Rabbit Metabolism: <span id="metabolismVal">1</span></label>
                <input type="range" id="metabolism" min="0.5" max="3" step="0.1" value="1">
            </div>
            <div class="control-group">
                <label>Grass Energy: <span id="grassEnergyVal">5</span></label>
                <input type="range" id="grassEnergy" min="1" max="15" value="5">
            </div>
            <div class="control-group">
                <label>Weed Energy: <span id="weedEnergyVal">2</span></label>
                <input type="range" id="weedEnergy" min="1" max="10" value="2">
            </div>
            <div class="control-group">
                <label>Reproduce Threshold: <span id="reproduceVal">50</span></label>
                <input type="range" id="reproduce" min="20" max="100" value="50">
            </div>
            
            <button id="reset">Reset Simulation</button>
            <button id="pause">Pause</button>
            
            <div class="stats">
                <div>Tick: <span id="tick">0</span></div>
                <div style="color:#f97316">Rabbits: <span id="rabbitCount">0</span></div>
                <div style="color:#22c55e">Grass: <span id="grassCount">0</span>%</div>
                <div style="color:#eab308">Weeds: <span id="weedCount">0</span>%</div>
                <div>Bare Ground: <span id="bareCount">0</span>%</div>
            </div>
            
            <p class="description"><strong>Dynamics:</strong> Grass provides more energy than weeds. Weeds can outcompete grass in some conditions. Watch for boom-bust cycles!</p>
        </div>
    </div>
    <script>
        const simCanvas = document.getElementById('sim-canvas');
        const simCtx = simCanvas.getContext('2d');
        const graphCanvas = document.getElementById('graph-canvas');
        const graphCtx = graphCanvas.getContext('2d');
        
        let W, H, COLS, ROWS, CELL_SIZE = 8;
        let grid = [], rabbits = [], tick = 0, paused = false;
        let history = { rabbits: [], grass: [], weeds: [] };
        
        const EMPTY = 0, GRASS = 1, WEED = 2;
        
        let params = {
            initialRabbits: 20,
            grassGrowth: 0.03,
            weedGrowth: 0.02,
            metabolism: 1,
            grassEnergy: 5,
            weedEnergy: 2,
            reproduceThreshold: 50
        };
        
        function resize() {
            const c = document.getElementById('canvas-container');
            simCanvas.width = c.clientWidth;
            simCanvas.height = c.clientHeight - 150;
            graphCanvas.width = c.clientWidth;
            graphCanvas.height = 150;
            W = simCanvas.width;
            H = simCanvas.height;
            COLS = Math.floor(W / CELL_SIZE);
            ROWS = Math.floor(H / CELL_SIZE);
        }
        
        function init() {
            resize();
            tick = 0;
            history = { rabbits: [], grass: [], weeds: [] };
            
            // Initialize grid with grass and weeds
            grid = [];
            for (let y = 0; y < ROWS; y++) {
                grid[y] = [];
                for (let x = 0; x < COLS; x++) {
                    const r = Math.random();
                    if (r < 0.4) grid[y][x] = GRASS;
                    else if (r < 0.6) grid[y][x] = WEED;
                    else grid[y][x] = EMPTY;
                }
            }
            
            // Initialize rabbits
            rabbits = [];
            for (let i = 0; i < params.initialRabbits; i++) {
                rabbits.push({
                    x: Math.random() * COLS,
                    y: Math.random() * ROWS,
                    energy: 30 + Math.random() * 20,
                    dir: Math.random() * Math.PI * 2
                });
            }
            
            updateStats();
        }
        
        function step() {
            tick++;
            
            // Grow plants
            for (let y = 0; y < ROWS; y++) {
                for (let x = 0; x < COLS; x++) {
                    if (grid[y][x] === EMPTY) {
                        // Check neighbors for spreading
                        let grassNeighbors = 0, weedNeighbors = 0;
                        for (let dy = -1; dy <= 1; dy++) {
                            for (let dx = -1; dx <= 1; dx++) {
                                const ny = (y + dy + ROWS) % ROWS;
                                const nx = (x + dx + COLS) % COLS;
                                if (grid[ny][nx] === GRASS) grassNeighbors++;
                                else if (grid[ny][nx] === WEED) weedNeighbors++;
                            }
                        }
                        
                        if (grassNeighbors > 0 && Math.random() < params.grassGrowth * grassNeighbors / 8) {
                            grid[y][x] = GRASS;
                        } else if (weedNeighbors > 0 && Math.random() < params.weedGrowth * weedNeighbors / 8) {
                            grid[y][x] = WEED;
                        }
                    }
                }
            }
            
            // Update rabbits
            const newRabbits = [];
            for (const rabbit of rabbits) {
                // Move randomly
                rabbit.dir += (Math.random() - 0.5) * 0.5;
                rabbit.x += Math.cos(rabbit.dir) * 0.5;
                rabbit.y += Math.sin(rabbit.dir) * 0.5;
                rabbit.x = (rabbit.x + COLS) % COLS;
                rabbit.y = (rabbit.y + ROWS) % ROWS;
                
                // Eat
                const gx = Math.floor(rabbit.x);
                const gy = Math.floor(rabbit.y);
                if (grid[gy] && grid[gy][gx] === GRASS) {
                    rabbit.energy += params.grassEnergy;
                    grid[gy][gx] = EMPTY;
                } else if (grid[gy] && grid[gy][gx] === WEED) {
                    rabbit.energy += params.weedEnergy;
                    grid[gy][gx] = EMPTY;
                }
                
                // Metabolism
                rabbit.energy -= params.metabolism;
                
                // Death
                if (rabbit.energy <= 0) continue;
                
                // Reproduction
                if (rabbit.energy > params.reproduceThreshold) {
                    rabbit.energy /= 2;
                    newRabbits.push({
                        x: rabbit.x + (Math.random() - 0.5) * 2,
                        y: rabbit.y + (Math.random() - 0.5) * 2,
                        energy: rabbit.energy,
                        dir: Math.random() * Math.PI * 2
                    });
                }
                
                newRabbits.push(rabbit);
            }
            rabbits = newRabbits;
            
            updateStats();
        }
        
        function updateStats() {
            let grassCount = 0, weedCount = 0;
            for (let y = 0; y < ROWS; y++) {
                for (let x = 0; x < COLS; x++) {
                    if (grid[y][x] === GRASS) grassCount++;
                    else if (grid[y][x] === WEED) weedCount++;
                }
            }
            const total = ROWS * COLS;
            const grassPct = (grassCount / total * 100).toFixed(1);
            const weedPct = (weedCount / total * 100).toFixed(1);
            const barePct = (100 - parseFloat(grassPct) - parseFloat(weedPct)).toFixed(1);
            
            document.getElementById('tick').textContent = tick;
            document.getElementById('rabbitCount').textContent = rabbits.length;
            document.getElementById('grassCount').textContent = grassPct;
            document.getElementById('weedCount').textContent = weedPct;
            document.getElementById('bareCount').textContent = barePct;
            
            // Record history
            history.rabbits.push(rabbits.length);
            history.grass.push(parseFloat(grassPct));
            history.weeds.push(parseFloat(weedPct));
            if (history.rabbits.length > 200) {
                history.rabbits.shift();
                history.grass.shift();
                history.weeds.shift();
            }
        }
        
        function draw() {
            // Draw grid
            simCtx.fillStyle = '#2d1f0f';
            simCtx.fillRect(0, 0, W, H);
            
            for (let y = 0; y < ROWS; y++) {
                for (let x = 0; x < COLS; x++) {
                    if (grid[y][x] === GRASS) {
                        simCtx.fillStyle = '#22c55e';
                    } else if (grid[y][x] === WEED) {
                        simCtx.fillStyle = '#eab308';
                    } else {
                        continue;
                    }
                    simCtx.fillRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE - 1, CELL_SIZE - 1);
                }
            }
            
            // Draw rabbits
            simCtx.fillStyle = '#f97316';
            for (const rabbit of rabbits) {
                simCtx.beginPath();
                simCtx.arc(rabbit.x * CELL_SIZE, rabbit.y * CELL_SIZE, 4, 0, Math.PI * 2);
                simCtx.fill();
            }
            
            // Draw graph
            graphCtx.fillStyle = '#0a0a0a';
            graphCtx.fillRect(0, 0, graphCanvas.width, graphCanvas.height);
            
            const drawLine = (data, color, scale) => {
                if (data.length < 2) return;
                graphCtx.strokeStyle = color;
                graphCtx.lineWidth = 1.5;
                graphCtx.beginPath();
                for (let i = 0; i < data.length; i++) {
                    const x = (i / 200) * graphCanvas.width;
                    const y = graphCanvas.height - 10 - (data[i] / scale) * (graphCanvas.height - 20);
                    if (i === 0) graphCtx.moveTo(x, y);
                    else graphCtx.lineTo(x, y);
                }
                graphCtx.stroke();
            };
            
            const maxRabbits = Math.max(...history.rabbits, 50);
            drawLine(history.rabbits, '#f97316', maxRabbits);
            drawLine(history.grass, '#22c55e', 100);
            drawLine(history.weeds, '#eab308', 100);
            
            graphCtx.fillStyle = '#666';
            graphCtx.font = '10px sans-serif';
            graphCtx.fillText('Population History', 5, 12);
            
            requestAnimationFrame(draw);
        }
        
        let intervalId = null;
        function startSim() {
            if (intervalId) clearInterval(intervalId);
            intervalId = setInterval(() => { if (!paused) step(); }, 50);
        }
        
        // Event listeners
        document.getElementById('rabbits').addEventListener('input', e => {
            params.initialRabbits = +e.target.value;
            document.getElementById('rabbitsVal').textContent = params.initialRabbits;
        });
        document.getElementById('grassGrowth').addEventListener('input', e => {
            params.grassGrowth = +e.target.value / 100;
            document.getElementById('grassGrowthVal').textContent = e.target.value;
        });
        document.getElementById('weedGrowth').addEventListener('input', e => {
            params.weedGrowth = +e.target.value / 100;
            document.getElementById('weedGrowthVal').textContent = e.target.value;
        });
        document.getElementById('metabolism').addEventListener('input', e => {
            params.metabolism = +e.target.value;
            document.getElementById('metabolismVal').textContent = params.metabolism;
        });
        document.getElementById('grassEnergy').addEventListener('input', e => {
            params.grassEnergy = +e.target.value;
            document.getElementById('grassEnergyVal').textContent = params.grassEnergy;
        });
        document.getElementById('weedEnergy').addEventListener('input', e => {
            params.weedEnergy = +e.target.value;
            document.getElementById('weedEnergyVal').textContent = params.weedEnergy;
        });
        document.getElementById('reproduce').addEventListener('input', e => {
            params.reproduceThreshold = +e.target.value;
            document.getElementById('reproduceVal').textContent = params.reproduceThreshold;
        });
        document.getElementById('reset').addEventListener('click', () => { init(); startSim(); });
        document.getElementById('pause').addEventListener('click', () => {
            paused = !paused;
            document.getElementById('pause').textContent = paused ? 'Resume' : 'Pause';
        });
        
        window.addEventListener('resize', resize);
        init();
        draw();
        startSim();
    </script>
</body>
</html>
