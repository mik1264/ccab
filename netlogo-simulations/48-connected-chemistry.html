<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connected Chemistry - Polymer Formation</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #0f0f1a 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            color: #e0e0e0;
        }
        h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
            background: linear-gradient(135deg, #00d4ff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .description {
            text-align: center;
            max-width: 700px;
            margin-bottom: 10px;
            font-size: 0.85rem;
            color: #888;
        }
        #container { display: flex; gap: 15px; flex-wrap: wrap; justify-content: center; }
        #canvas { border: 1px solid #333; border-radius: 8px; }
        .panel {
            background: rgba(0,0,0,0.6);
            padding: 15px;
            border-radius: 8px;
            width: 200px;
        }
        .panel h3 { font-size: 0.9rem; margin-bottom: 10px; color: #00d4ff; }
        .control-group { margin-bottom: 10px; }
        label { display: block; font-size: 0.75rem; color: #aaa; margin-bottom: 3px; }
        input[type="range"] { width: 100%; }
        button {
            width: 100%;
            padding: 8px;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #00d4ff, #00ff88);
            border: none;
            border-radius: 5px;
            color: #000;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover { opacity: 0.9; }
        .stats { font-size: 0.75rem; color: #888; }
        .stats div { margin-bottom: 3px; }
        .chart-container { margin-top: 10px; }
        #histCanvas { width: 100%; height: 80px; border: 1px solid #333; border-radius: 4px; }
        .back-link {
            position: fixed;
            top: 10px;
            left: 10px;
            padding: 8px 16px;
            background: rgba(0,0,0,0.8);
            color: #00d4ff;
            text-decoration: none;
            border-radius: 6px;
            font-size: 14px;
            z-index: 100;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back</a>
    <h1>Connected Chemistry</h1>
    <p class="description">Molecules bond on collision to form polymers. Watch molecular weight distribution evolve as chains grow through random bonding events.</p>

    <div id="container">
        <canvas id="canvas" width="600" height="500"></canvas>
        <div class="panel">
            <h3>Controls</h3>
            <div class="control-group">
                <label>Temperature: <span id="tempVal">1.0</span></label>
                <input type="range" id="temperature" min="0.2" max="3" step="0.1" value="1">
            </div>
            <div class="control-group">
                <label>Bond Probability: <span id="bondVal">0.5</span></label>
                <input type="range" id="bondProb" min="0.1" max="1" step="0.1" value="0.5">
            </div>
            <div class="control-group">
                <label>Break Probability: <span id="breakVal">0.01</span></label>
                <input type="range" id="breakProb" min="0" max="0.1" step="0.01" value="0.01">
            </div>
            <button id="resetBtn">Reset Simulation</button>
            <button id="addBtn">Add Monomers</button>

            <h3>Statistics</h3>
            <div class="stats">
                <div>Monomers: <span id="monomerCount">0</span></div>
                <div>Bonds: <span id="bondCount">0</span></div>
                <div>Avg Chain Length: <span id="avgLength">0</span></div>
                <div>Max Chain: <span id="maxChain">0</span></div>
                <div>Polymers: <span id="polymerCount">0</span></div>
            </div>

            <div class="chart-container">
                <label>Molecular Weight Distribution</label>
                <canvas id="histCanvas"></canvas>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const histCanvas = document.getElementById('histCanvas');
        const histCtx = histCanvas.getContext('2d');
        histCanvas.width = 180;
        histCanvas.height = 80;

        let monomers = [];
        let bonds = [];
        let temperature = 1;
        let bondProb = 0.5;
        let breakProb = 0.01;

        class Monomer {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 4;
                this.vy = (Math.random() - 0.5) * 4;
                this.radius = 8;
                this.bondSites = 2; // Can bond with 2 other monomers
                this.bonds = [];
                this.id = Math.random();
                this.hue = 180 + Math.random() * 40;
            }

            update() {
                // Brownian motion scaled by temperature
                this.vx += (Math.random() - 0.5) * temperature * 0.5;
                this.vy += (Math.random() - 0.5) * temperature * 0.5;

                // Damping
                this.vx *= 0.98;
                this.vy *= 0.98;

                // Speed limit
                const speed = Math.sqrt(this.vx * this.vx + this.vy * this.vy);
                const maxSpeed = 5 * temperature;
                if (speed > maxSpeed) {
                    this.vx = (this.vx / speed) * maxSpeed;
                    this.vy = (this.vy / speed) * maxSpeed;
                }

                this.x += this.vx;
                this.y += this.vy;

                // Bounce off walls
                if (this.x < this.radius) { this.x = this.radius; this.vx *= -0.8; }
                if (this.x > canvas.width - this.radius) { this.x = canvas.width - this.radius; this.vx *= -0.8; }
                if (this.y < this.radius) { this.y = this.radius; this.vy *= -0.8; }
                if (this.y > canvas.height - this.radius) { this.y = canvas.height - this.radius; this.vy *= -0.8; }

                // Apply bond forces
                for (const bond of this.bonds) {
                    const other = bond.m1 === this ? bond.m2 : bond.m1;
                    const dx = other.x - this.x;
                    const dy = other.y - this.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    const targetDist = this.radius * 2.5;

                    if (dist > 0) {
                        const force = (dist - targetDist) * 0.05;
                        this.vx += (dx / dist) * force;
                        this.vy += (dy / dist) * force;
                    }
                }
            }

            draw() {
                // Draw monomer
                const gradient = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.radius);
                gradient.addColorStop(0, `hsl(${this.hue}, 80%, 70%)`);
                gradient.addColorStop(1, `hsl(${this.hue}, 60%, 40%)`);

                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = gradient;
                ctx.fill();
                ctx.strokeStyle = `hsl(${this.hue}, 90%, 80%)`;
                ctx.lineWidth = 1;
                ctx.stroke();

                // Show bond sites
                if (this.bonds.length < this.bondSites) {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius + 3, 0, Math.PI * 2);
                    ctx.strokeStyle = 'rgba(0, 255, 136, 0.3)';
                    ctx.setLineDash([2, 2]);
                    ctx.stroke();
                    ctx.setLineDash([]);
                }
            }

            canBond() {
                return this.bonds.length < this.bondSites;
            }
        }

        class Bond {
            constructor(m1, m2) {
                this.m1 = m1;
                this.m2 = m2;
                this.age = 0;
            }

            draw() {
                ctx.beginPath();
                ctx.moveTo(this.m1.x, this.m1.y);
                ctx.lineTo(this.m2.x, this.m2.y);
                ctx.strokeStyle = `rgba(0, 255, 200, ${Math.min(1, this.age / 50)})`;
                ctx.lineWidth = 3;
                ctx.stroke();
            }
        }

        function init() {
            monomers = [];
            bonds = [];
            for (let i = 0; i < 80; i++) {
                monomers.push(new Monomer(
                    Math.random() * (canvas.width - 40) + 20,
                    Math.random() * (canvas.height - 40) + 20
                ));
            }
        }

        function addMonomers() {
            for (let i = 0; i < 20; i++) {
                monomers.push(new Monomer(
                    Math.random() * (canvas.width - 40) + 20,
                    Math.random() * (canvas.height - 40) + 20
                ));
            }
        }

        function tryBond(m1, m2) {
            if (!m1.canBond() || !m2.canBond()) return false;
            if (m1.bonds.some(b => b.m1 === m2 || b.m2 === m2)) return false;

            const dx = m2.x - m1.x;
            const dy = m2.y - m1.y;
            const dist = Math.sqrt(dx * dx + dy * dy);

            if (dist < m1.radius + m2.radius + 5) {
                if (Math.random() < bondProb) {
                    const bond = new Bond(m1, m2);
                    bonds.push(bond);
                    m1.bonds.push(bond);
                    m2.bonds.push(bond);
                    return true;
                }
            }
            return false;
        }

        function tryBreak(bond) {
            if (Math.random() < breakProb * temperature) {
                bond.m1.bonds = bond.m1.bonds.filter(b => b !== bond);
                bond.m2.bonds = bond.m2.bonds.filter(b => b !== bond);
                bonds = bonds.filter(b => b !== bond);
                return true;
            }
            return false;
        }

        function getChains() {
            const visited = new Set();
            const chains = [];

            for (const m of monomers) {
                if (visited.has(m.id)) continue;

                const chain = [];
                const stack = [m];

                while (stack.length > 0) {
                    const current = stack.pop();
                    if (visited.has(current.id)) continue;
                    visited.add(current.id);
                    chain.push(current);

                    for (const bond of current.bonds) {
                        const other = bond.m1 === current ? bond.m2 : bond.m1;
                        if (!visited.has(other.id)) {
                            stack.push(other);
                        }
                    }
                }

                chains.push(chain);
            }

            return chains;
        }

        function drawHistogram(chains) {
            histCtx.fillStyle = '#111';
            histCtx.fillRect(0, 0, histCanvas.width, histCanvas.height);

            const lengths = chains.map(c => c.length);
            const maxLen = Math.max(...lengths, 1);
            const bins = new Array(Math.min(10, maxLen)).fill(0);

            for (const len of lengths) {
                const binIndex = Math.min(Math.floor((len - 1) / Math.ceil(maxLen / bins.length)), bins.length - 1);
                bins[binIndex]++;
            }

            const maxCount = Math.max(...bins, 1);
            const barWidth = histCanvas.width / bins.length;

            bins.forEach((count, i) => {
                const height = (count / maxCount) * (histCanvas.height - 15);
                const gradient = histCtx.createLinearGradient(0, histCanvas.height - height, 0, histCanvas.height);
                gradient.addColorStop(0, '#00ff88');
                gradient.addColorStop(1, '#00d4ff');

                histCtx.fillStyle = gradient;
                histCtx.fillRect(i * barWidth + 2, histCanvas.height - height - 10, barWidth - 4, height);

                // Label
                histCtx.fillStyle = '#666';
                histCtx.font = '8px sans-serif';
                histCtx.textAlign = 'center';
                const binLabel = i === bins.length - 1 ? `${i * Math.ceil(maxLen / bins.length) + 1}+` : `${i * Math.ceil(maxLen / bins.length) + 1}`;
                histCtx.fillText(binLabel, i * barWidth + barWidth / 2, histCanvas.height - 2);
            });
        }

        function updateStats(chains) {
            const lengths = chains.map(c => c.length);
            const avgLen = lengths.reduce((a, b) => a + b, 0) / lengths.length;
            const maxLen = Math.max(...lengths);
            const polymers = chains.filter(c => c.length > 1).length;

            document.getElementById('monomerCount').textContent = monomers.length;
            document.getElementById('bondCount').textContent = bonds.length;
            document.getElementById('avgLength').textContent = avgLen.toFixed(2);
            document.getElementById('maxChain').textContent = maxLen;
            document.getElementById('polymerCount').textContent = polymers;
        }

        // Controls
        document.getElementById('temperature').addEventListener('input', function() {
            temperature = parseFloat(this.value);
            document.getElementById('tempVal').textContent = temperature.toFixed(1);
        });

        document.getElementById('bondProb').addEventListener('input', function() {
            bondProb = parseFloat(this.value);
            document.getElementById('bondVal').textContent = bondProb.toFixed(1);
        });

        document.getElementById('breakProb').addEventListener('input', function() {
            breakProb = parseFloat(this.value);
            document.getElementById('breakVal').textContent = breakProb.toFixed(2);
        });

        document.getElementById('resetBtn').addEventListener('click', init);
        document.getElementById('addBtn').addEventListener('click', addMonomers);

        function animate() {
            ctx.fillStyle = 'rgba(15, 15, 26, 0.3)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Update monomers
            monomers.forEach(m => m.update());

            // Try bonding between nearby monomers
            for (let i = 0; i < monomers.length; i++) {
                for (let j = i + 1; j < monomers.length; j++) {
                    tryBond(monomers[i], monomers[j]);
                }
            }

            // Try breaking bonds
            bonds.forEach(b => {
                b.age++;
                tryBreak(b);
            });

            // Draw bonds
            bonds.forEach(b => b.draw());

            // Draw monomers
            monomers.forEach(m => m.draw());

            // Update stats and histogram
            const chains = getChains();
            updateStats(chains);
            drawHistogram(chains);

            requestAnimationFrame(animate);
        }

        init();
        animate();
    </script>
</body>
</html>
