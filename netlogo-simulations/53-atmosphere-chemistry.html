<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atmospheric Chemistry - NetLogo Simulations</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: #e0e0e0;
        }
        h1 { font-size: 1.8rem; margin-bottom: 10px; background: linear-gradient(135deg, #3498db, #1abc9c); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .description { text-align: center; max-width: 700px; margin-bottom: 20px; color: #aaa; line-height: 1.5; }
        .container { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; }
        canvas { border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.4); }
        .controls { background: rgba(255,255,255,0.05); padding: 20px; border-radius: 10px; display: flex; flex-direction: column; gap: 15px; min-width: 240px; }
        .control-group { display: flex; flex-direction: column; gap: 5px; }
        label { font-size: 0.85rem; color: #888; }
        input[type="range"] { width: 100%; }
        .value { font-size: 0.8rem; color: #3498db; }
        button { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: 600; }
        .primary { background: #3498db; color: white; }
        .secondary { background: rgba(255,255,255,0.1); color: #e0e0e0; }
        .stats { margin-top: 15px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 5px; font-size: 0.85rem; }
        .stats div { margin: 3px 0; }
        .stat-value { color: #3498db; }
        .molecule-legend { display: flex; flex-wrap: wrap; gap: 8px; font-size: 0.75rem; margin-top: 10px; }
        .legend-item { display: flex; align-items: center; gap: 4px; }
        .legend-dot { width: 10px; height: 10px; border-radius: 50%; }
        a.back-link { position: fixed; top: 20px; left: 20px; color: #3498db; text-decoration: none; font-size: 0.9rem; opacity: 0.8; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Gallery</a>
    <h1>Atmospheric Chemistry</h1>
    <p class="description">Ozone layer chemistry simulation with UV photodissociation, Chapman cycle reactions, and catalytic destruction by CFCs.</p>
    <div class="container">
        <canvas id="canvas" width="600" height="450"></canvas>
        <div class="controls">
            <div class="control-group">
                <label>UV Intensity: <span id="uvVal" class="value">50</span>%</label>
                <input type="range" id="uvIntensity" min="10" max="100" value="50">
            </div>
            <div class="control-group">
                <label>CFC Concentration: <span id="cfcVal" class="value">10</span> ppm</label>
                <input type="range" id="cfcLevel" min="0" max="50" value="10">
            </div>
            <div class="control-group">
                <label>Temperature: <span id="tempVal" class="value">220</span> K</label>
                <input type="range" id="temperature" min="180" max="260" value="220">
            </div>
            <button class="primary" id="startBtn">Start</button>
            <button class="secondary" id="resetBtn">Reset</button>
            <div class="stats">
                <div>O₂ Molecules: <span id="o2Count" class="stat-value">0</span></div>
                <div>O₃ (Ozone): <span id="o3Count" class="stat-value">0</span></div>
                <div>O (Atomic): <span id="oCount" class="stat-value">0</span></div>
                <div>Cl Radicals: <span id="clCount" class="stat-value">0</span></div>
                <div>UV Absorbed: <span id="uvAbsorbed" class="stat-value">0</span>%</div>
            </div>
            <div class="molecule-legend">
                <div class="legend-item"><div class="legend-dot" style="background:#3498db"></div>O₂</div>
                <div class="legend-item"><div class="legend-dot" style="background:#9b59b6"></div>O₃</div>
                <div class="legend-item"><div class="legend-dot" style="background:#e74c3c"></div>O</div>
                <div class="legend-item"><div class="legend-dot" style="background:#2ecc71"></div>Cl</div>
                <div class="legend-item"><div class="legend-dot" style="background:#f39c12"></div>UV</div>
            </div>
        </div>
    </div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const W = canvas.width, H = canvas.height;

        let molecules = [];
        let uvPhotons = [];
        let running = false;
        let uvAbsorbed = 0;

        const TYPES = { O2: 'O2', O3: 'O3', O: 'O', Cl: 'Cl' };
        const COLORS = { O2: '#3498db', O3: '#9b59b6', O: '#e74c3c', Cl: '#2ecc71' };
        const SIZES = { O2: 6, O3: 8, O: 4, Cl: 5 };

        class Molecule {
            constructor(type, x, y) {
                this.type = type;
                this.x = x || Math.random() * W;
                this.y = y || 50 + Math.random() * (H - 100);
                this.vx = (Math.random() - 0.5) * 2;
                this.vy = (Math.random() - 0.5) * 2;
            }
            move(temp) {
                const speed = temp / 220;
                this.vx += (Math.random() - 0.5) * 0.3 * speed;
                this.vy += (Math.random() - 0.5) * 0.3 * speed;
                this.vx *= 0.98; this.vy *= 0.98;
                this.x += this.vx; this.y += this.vy;
                if (this.x < 0 || this.x > W) this.vx *= -1;
                if (this.y < 30 || this.y > H - 30) this.vy *= -1;
                this.x = Math.max(0, Math.min(W, this.x));
                this.y = Math.max(30, Math.min(H - 30, this.y));
            }
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, SIZES[this.type], 0, Math.PI * 2);
                ctx.fillStyle = COLORS[this.type];
                ctx.fill();
            }
        }

        class UVPhoton {
            constructor() {
                this.x = Math.random() * W;
                this.y = 0;
                this.vy = 3 + Math.random() * 2;
                this.alive = true;
            }
            move() { this.y += this.vy; if (this.y > H) this.alive = false; }
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
                ctx.fillStyle = '#f39c12';
                ctx.fill();
            }
        }

        function init() {
            molecules = [];
            uvPhotons = [];
            uvAbsorbed = 0;
            for (let i = 0; i < 80; i++) molecules.push(new Molecule(TYPES.O2));
            for (let i = 0; i < 30; i++) molecules.push(new Molecule(TYPES.O3));
            updateStats();
        }

        function distance(a, b) { return Math.sqrt((a.x - b.x) ** 2 + (a.y - b.y) ** 2); }

        function update() {
            const uv = parseInt(document.getElementById('uvIntensity').value) / 100;
            const cfc = parseInt(document.getElementById('cfcLevel').value);
            const temp = parseInt(document.getElementById('temperature').value);

            // Add UV photons
            if (Math.random() < uv * 0.3) uvPhotons.push(new UVPhoton());

            // Add Cl radicals based on CFC
            if (cfc > 0 && Math.random() < cfc / 500) {
                molecules.push(new Molecule(TYPES.Cl, Math.random() * W, 50));
            }

            // Move molecules
            molecules.forEach(m => m.move(temp));
            uvPhotons.forEach(p => p.move());

            // UV photodissociation
            uvPhotons = uvPhotons.filter(photon => {
                if (!photon.alive) return false;
                for (let i = 0; i < molecules.length; i++) {
                    const m = molecules[i];
                    if (distance(photon, m) < 15) {
                        if (m.type === TYPES.O2 && Math.random() < 0.3) {
                            // O2 + UV -> O + O
                            molecules.splice(i, 1);
                            molecules.push(new Molecule(TYPES.O, m.x - 5, m.y));
                            molecules.push(new Molecule(TYPES.O, m.x + 5, m.y));
                            uvAbsorbed++;
                            return false;
                        } else if (m.type === TYPES.O3 && Math.random() < 0.5) {
                            // O3 + UV -> O2 + O
                            molecules.splice(i, 1);
                            molecules.push(new Molecule(TYPES.O2, m.x, m.y));
                            molecules.push(new Molecule(TYPES.O, m.x, m.y));
                            uvAbsorbed++;
                            return false;
                        }
                    }
                }
                return true;
            });

            // Chemical reactions
            for (let i = 0; i < molecules.length; i++) {
                for (let j = i + 1; j < molecules.length; j++) {
                    if (distance(molecules[i], molecules[j]) < 12) {
                        const types = [molecules[i].type, molecules[j].type].sort().join('+');
                        
                        if (types === 'O+O2' && Math.random() < 0.2) {
                            // O + O2 -> O3
                            const x = (molecules[i].x + molecules[j].x) / 2;
                            const y = (molecules[i].y + molecules[j].y) / 2;
                            molecules.splice(j, 1);
                            molecules.splice(i, 1);
                            molecules.push(new Molecule(TYPES.O3, x, y));
                            break;
                        } else if (types === 'Cl+O3' && Math.random() < 0.3) {
                            // Cl + O3 -> ClO + O2 (Cl catalytic destruction)
                            molecules[j].type = TYPES.O2;
                            // Cl remains as radical
                            break;
                        } else if (types === 'O+O' && Math.random() < 0.1) {
                            // O + O -> O2
                            const x = (molecules[i].x + molecules[j].x) / 2;
                            const y = (molecules[i].y + molecules[j].y) / 2;
                            molecules.splice(j, 1);
                            molecules.splice(i, 1);
                            molecules.push(new Molecule(TYPES.O2, x, y));
                            break;
                        }
                    }
                }
            }

            // Remove stray photons
            uvPhotons = uvPhotons.filter(p => p.alive);
        }

        function draw() {
            // Sky gradient
            const grad = ctx.createLinearGradient(0, 0, 0, H);
            grad.addColorStop(0, '#000428');
            grad.addColorStop(0.3, '#004e92');
            grad.addColorStop(1, '#87CEEB');
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, W, H);

            // Atmosphere layers
            ctx.fillStyle = 'rgba(155, 89, 182, 0.1)';
            ctx.fillRect(0, 80, W, 150); // Ozone layer

            ctx.fillStyle = '#fff';
            ctx.font = '10px sans-serif';
            ctx.fillText('Stratosphere (Ozone Layer)', 10, 95);
            ctx.fillText('Troposphere', 10, H - 50);

            uvPhotons.forEach(p => p.draw());
            molecules.forEach(m => m.draw());
        }

        function updateStats() {
            const counts = { O2: 0, O3: 0, O: 0, Cl: 0 };
            molecules.forEach(m => counts[m.type]++);
            document.getElementById('o2Count').textContent = counts.O2;
            document.getElementById('o3Count').textContent = counts.O3;
            document.getElementById('oCount').textContent = counts.O;
            document.getElementById('clCount').textContent = counts.Cl;
            document.getElementById('uvAbsorbed').textContent = Math.min(100, Math.round(uvAbsorbed / 10));
            document.getElementById('uvVal').textContent = document.getElementById('uvIntensity').value;
            document.getElementById('cfcVal').textContent = document.getElementById('cfcLevel').value;
            document.getElementById('tempVal').textContent = document.getElementById('temperature').value;
        }

        function animate() {
            if (running) update();
            draw();
            updateStats();
            requestAnimationFrame(animate);
        }

        document.getElementById('startBtn').addEventListener('click', function() {
            running = !running;
            this.textContent = running ? 'Pause' : 'Start';
        });
        document.getElementById('resetBtn').addEventListener('click', () => {
            running = false;
            document.getElementById('startBtn').textContent = 'Start';
            init();
        });

        init();
        animate();
    </script>
</body>
</html>
