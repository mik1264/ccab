<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lennard-Jones Molecular Dynamics - CCAB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0c1222; color: #e8e6e1; overflow: hidden; }
        #container { display: flex; height: 100vh; }
        #canvas-container { flex: 1; position: relative; }
        canvas { display: block; width: 100%; height: 100%; }
        #controls { width: 280px; background: rgba(0,0,0,0.9); padding: 20px; overflow-y: auto; }
        h1 { font-size: 1.1rem; margin-bottom: 15px; color: #38bdf8; }
        .control-group { margin-bottom: 12px; }
        label { display: block; font-size: 0.75rem; margin-bottom: 3px; color: #aaa; }
        input[type="range"] { width: 100%; }
        button { width: 100%; padding: 8px; margin-bottom: 8px; background: #0ea5e9; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 0.85rem; }
        button:hover { background: #0284c7; }
        .stats { background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px; font-size: 0.75rem; margin-bottom: 15px; }
        .stats div { margin-bottom: 3px; }
        .back-link { position: fixed; top: 10px; left: 10px; padding: 8px 16px; background: rgba(0,0,0,0.7); color: #38bdf8; text-decoration: none; border-radius: 6px; font-size: 14px; z-index: 999; }
        .description { font-size: 0.7rem; color: #888; margin-bottom: 12px; line-height: 1.4; }
        .phase { padding: 5px 10px; border-radius: 4px; display: inline-block; font-weight: bold; }
        .solid { background: #3b82f6; }
        .liquid { background: #22c55e; }
        .gas { background: #ef4444; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back</a>
    <div id="container">
        <div id="canvas-container">
            <canvas id="canvas"></canvas>
        </div>
        <div id="controls">
            <h1>Lennard-Jones Potential</h1>
            <p class="description">Molecular dynamics simulation using the Lennard-Jones potential V(r) = 4ε[(σ/r)¹² - (σ/r)⁶]. Atoms attract at long range and repel at short range.</p>
            
            <div class="control-group">
                <label>Atoms: <span id="atomsVal">100</span></label>
                <input type="range" id="atoms" min="20" max="200" value="100">
            </div>
            <div class="control-group">
                <label>Temperature: <span id="tempVal">1.0</span></label>
                <input type="range" id="temp" min="0.1" max="3.0" step="0.1" value="1.0">
            </div>
            <div class="control-group">
                <label>Sigma (σ): <span id="sigmaVal">15</span></label>
                <input type="range" id="sigma" min="10" max="25" value="15">
            </div>
            <div class="control-group">
                <label>Time Step: <span id="dtVal">0.01</span></label>
                <input type="range" id="dt" min="0.005" max="0.02" step="0.001" value="0.01">
            </div>
            
            <button id="reset">Reset</button>
            <button id="pause">Pause</button>
            <button id="heat">Heat (+0.3)</button>
            <button id="cool">Cool (-0.3)</button>
            
            <div class="stats">
                <div>Phase: <span id="phase" class="phase liquid">Liquid</span></div>
                <div>Temperature: <span id="currentTemp">1.0</span></div>
                <div>Kinetic Energy: <span id="ke">0</span></div>
                <div>Potential Energy: <span id="pe">0</span></div>
                <div>Total Energy: <span id="total">0</span></div>
            </div>
            
            <p class="description"><strong>Phases:</strong> Low T → solid (ordered lattice). Medium T → liquid (clusters). High T → gas (dispersed).</p>
            
            <p class="description"><strong>LJ Potential:</strong> Minimum at r = 2^(1/6)σ ≈ 1.12σ. Attractive well depth = ε.</p>
        </div>
    </div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        let W, H, atoms = [], paused = false;
        
        let params = {
            atomCount: 100,
            temp: 1.0,
            sigma: 15,
            epsilon: 1.0,
            dt: 0.01
        };
        
        function resize() {
            const c = document.getElementById('canvas-container');
            canvas.width = c.clientWidth;
            canvas.height = c.clientHeight;
            W = canvas.width;
            H = canvas.height;
        }
        
        function init() {
            resize();
            atoms = [];
            
            // Create atoms in a grid
            const cols = Math.ceil(Math.sqrt(params.atomCount * W / H));
            const rows = Math.ceil(params.atomCount / cols);
            const spacingX = (W - 100) / cols;
            const spacingY = (H - 100) / rows;
            
            for (let i = 0; i < params.atomCount; i++) {
                const col = i % cols;
                const row = Math.floor(i / cols);
                
                // Random velocity based on temperature
                const speed = Math.sqrt(params.temp) * 5;
                const angle = Math.random() * Math.PI * 2;
                
                atoms.push({
                    x: 50 + col * spacingX + spacingX / 2,
                    y: 50 + row * spacingY + spacingY / 2,
                    vx: Math.cos(angle) * speed,
                    vy: Math.sin(angle) * speed,
                    ax: 0,
                    ay: 0
                });
            }
            
            updateStats();
        }
        
        function ljForce(r) {
            // Lennard-Jones force: F = 24ε/r * [2(σ/r)^12 - (σ/r)^6]
            const sigma = params.sigma;
            const epsilon = params.epsilon;
            
            if (r < 0.5 * sigma) r = 0.5 * sigma; // Prevent singularity
            
            const sr6 = Math.pow(sigma / r, 6);
            const sr12 = sr6 * sr6;
            
            return 24 * epsilon / r * (2 * sr12 - sr6);
        }
        
        function ljPotential(r) {
            const sigma = params.sigma;
            const epsilon = params.epsilon;
            
            if (r < 0.5 * sigma) r = 0.5 * sigma;
            
            const sr6 = Math.pow(sigma / r, 6);
            const sr12 = sr6 * sr6;
            
            return 4 * epsilon * (sr12 - sr6);
        }
        
        function step() {
            const dt = params.dt;
            const cutoff = params.sigma * 2.5;
            
            // Reset accelerations
            for (const atom of atoms) {
                atom.ax = 0;
                atom.ay = 0;
            }
            
            // Calculate forces
            for (let i = 0; i < atoms.length; i++) {
                for (let j = i + 1; j < atoms.length; j++) {
                    const a1 = atoms[i];
                    const a2 = atoms[j];
                    
                    const dx = a2.x - a1.x;
                    const dy = a2.y - a1.y;
                    const r = Math.sqrt(dx * dx + dy * dy);
                    
                    if (r < cutoff && r > 0) {
                        const f = ljForce(r);
                        const fx = f * dx / r;
                        const fy = f * dy / r;
                        
                        a1.ax += fx;
                        a1.ay += fy;
                        a2.ax -= fx;
                        a2.ay -= fy;
                    }
                }
            }
            
            // Velocity Verlet integration
            for (const atom of atoms) {
                // Update velocity (half step)
                atom.vx += atom.ax * dt * 0.5;
                atom.vy += atom.ay * dt * 0.5;
                
                // Update position
                atom.x += atom.vx * dt;
                atom.y += atom.vy * dt;
                
                // Reflective boundaries
                if (atom.x < 10) { atom.x = 10; atom.vx *= -0.9; }
                if (atom.x > W - 10) { atom.x = W - 10; atom.vx *= -0.9; }
                if (atom.y < 10) { atom.y = 10; atom.vy *= -0.9; }
                if (atom.y > H - 10) { atom.y = H - 10; atom.vy *= -0.9; }
                
                // Update velocity (second half step)
                atom.vx += atom.ax * dt * 0.5;
                atom.vy += atom.ay * dt * 0.5;
            }
            
            // Thermostat - rescale velocities to maintain temperature
            const currentKE = atoms.reduce((sum, a) => sum + 0.5 * (a.vx * a.vx + a.vy * a.vy), 0);
            const currentTemp = currentKE / atoms.length;
            const scale = Math.sqrt(params.temp / (currentTemp + 0.001));
            
            // Gentle rescaling
            const factor = 0.99 + 0.01 * scale;
            for (const atom of atoms) {
                atom.vx *= factor;
                atom.vy *= factor;
            }
            
            updateStats();
        }
        
        function updateStats() {
            // Calculate energies
            const ke = atoms.reduce((sum, a) => sum + 0.5 * (a.vx * a.vx + a.vy * a.vy), 0);
            
            let pe = 0;
            const cutoff = params.sigma * 2.5;
            for (let i = 0; i < atoms.length; i++) {
                for (let j = i + 1; j < atoms.length; j++) {
                    const dx = atoms[j].x - atoms[i].x;
                    const dy = atoms[j].y - atoms[i].y;
                    const r = Math.sqrt(dx * dx + dy * dy);
                    if (r < cutoff) pe += ljPotential(r);
                }
            }
            
            const temp = ke / atoms.length;
            
            document.getElementById('currentTemp').textContent = temp.toFixed(2);
            document.getElementById('ke').textContent = ke.toFixed(1);
            document.getElementById('pe').textContent = pe.toFixed(1);
            document.getElementById('total').textContent = (ke + pe).toFixed(1);
            
            // Determine phase
            const phaseEl = document.getElementById('phase');
            if (params.temp < 0.5) {
                phaseEl.textContent = 'Solid';
                phaseEl.className = 'phase solid';
            } else if (params.temp < 1.5) {
                phaseEl.textContent = 'Liquid';
                phaseEl.className = 'phase liquid';
            } else {
                phaseEl.textContent = 'Gas';
                phaseEl.className = 'phase gas';
            }
        }
        
        function draw() {
            ctx.fillStyle = '#0c1222';
            ctx.fillRect(0, 0, W, H);
            
            // Box
            ctx.strokeStyle = '#1e3a5f';
            ctx.lineWidth = 2;
            ctx.strokeRect(5, 5, W - 10, H - 10);
            
            // Draw atoms
            for (const atom of atoms) {
                // Color based on speed
                const speed = Math.sqrt(atom.vx * atom.vx + atom.vy * atom.vy);
                const hue = 200 - Math.min(speed * 10, 150);
                
                ctx.fillStyle = `hsl(${hue}, 80%, 60%)`;
                ctx.beginPath();
                ctx.arc(atom.x, atom.y, params.sigma / 3, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // Temperature indicator
            ctx.fillStyle = '#666';
            ctx.font = '12px sans-serif';
            ctx.fillText(`T = ${params.temp.toFixed(1)}`, 10, 25);
            
            requestAnimationFrame(draw);
        }
        
        let intervalId = null;
        function startSim() {
            if (intervalId) clearInterval(intervalId);
            intervalId = setInterval(() => {
                if (!paused) {
                    for (let i = 0; i < 5; i++) step(); // Multiple steps per frame
                }
            }, 16);
        }
        
        // Event listeners
        document.getElementById('atoms').addEventListener('input', e => {
            params.atomCount = +e.target.value;
            document.getElementById('atomsVal').textContent = params.atomCount;
        });
        document.getElementById('temp').addEventListener('input', e => {
            params.temp = +e.target.value;
            document.getElementById('tempVal').textContent = params.temp.toFixed(1);
        });
        document.getElementById('sigma').addEventListener('input', e => {
            params.sigma = +e.target.value;
            document.getElementById('sigmaVal').textContent = params.sigma;
        });
        document.getElementById('dt').addEventListener('input', e => {
            params.dt = +e.target.value;
            document.getElementById('dtVal').textContent = params.dt.toFixed(3);
        });
        document.getElementById('reset').addEventListener('click', () => { init(); startSim(); });
        document.getElementById('pause').addEventListener('click', () => {
            paused = !paused;
            document.getElementById('pause').textContent = paused ? 'Resume' : 'Pause';
        });
        document.getElementById('heat').addEventListener('click', () => {
            params.temp = Math.min(3.0, params.temp + 0.3);
            document.getElementById('temp').value = params.temp;
            document.getElementById('tempVal').textContent = params.temp.toFixed(1);
        });
        document.getElementById('cool').addEventListener('click', () => {
            params.temp = Math.max(0.1, params.temp - 0.3);
            document.getElementById('temp').value = params.temp;
            document.getElementById('tempVal').textContent = params.temp.toFixed(1);
        });
        
        window.addEventListener('resize', resize);
        init();
        draw();
        startSim();
    </script>
</body>
</html>
