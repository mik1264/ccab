<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tide Pool Ecosystem - CCAB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0c1222; color: #e8e6e1; overflow: hidden; }
        #container { display: flex; height: 100vh; }
        #canvas-container { flex: 1; position: relative; }
        #simCanvas { width: 100%; height: 100%; }
        #controls { width: 280px; background: rgba(0,0,0,0.9); padding: 20px; overflow-y: auto; }
        h1 { font-size: 1.1rem; margin-bottom: 15px; color: #0ea5e9; }
        .control-group { margin-bottom: 12px; }
        label { display: block; font-size: 0.75rem; margin-bottom: 3px; color: #aaa; }
        input[type="range"] { width: 100%; }
        button { width: 100%; padding: 8px; margin-bottom: 8px; background: #0284c7; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 0.85rem; }
        button:hover { background: #0369a1; }
        .stats { background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px; font-size: 0.75rem; margin-bottom: 15px; }
        .stats div { margin-bottom: 3px; }
        .back-link { position: fixed; top: 10px; left: 10px; padding: 8px 16px; background: rgba(0,0,0,0.7); color: #0ea5e9; text-decoration: none; border-radius: 6px; font-size: 14px; z-index: 999; }
        .description { font-size: 0.7rem; color: #888; margin-bottom: 12px; line-height: 1.4; }
        .tide-indicator { font-size: 1.2rem; text-align: center; padding: 10px; background: rgba(14, 165, 233, 0.2); border-radius: 5px; margin-bottom: 10px; }
        .species-legend { font-size: 0.65rem; margin-top: 10px; }
        .species-item { display: flex; align-items: center; margin: 3px 0; }
        .species-color { width: 15px; height: 15px; margin-right: 8px; border-radius: 3px; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back</a>
    <div id="container">
        <div id="canvas-container">
            <canvas id="simCanvas"></canvas>
        </div>
        <div id="controls">
            <h1>Tide Pool Ecosystem</h1>
            <p class="description">Intertidal zone with zonation patterns. Species face tradeoffs between exposure tolerance and competition.</p>
            
            <div class="tide-indicator" id="tideIndicator">
                üåä High Tide
            </div>
            
            <div class="control-group">
                <label>Tide Cycle Speed: <span id="cycleVal">1.0</span>x</label>
                <input type="range" id="cycle" min="0.5" max="3" step="0.1" value="1">
            </div>
            <div class="control-group">
                <label>Wave Intensity: <span id="waveVal">0.5</span></label>
                <input type="range" id="wave" min="0" max="1" step="0.1" value="0.5">
            </div>
            <div class="control-group">
                <label>Desiccation Rate: <span id="desiccationVal">0.5</span></label>
                <input type="range" id="desiccation" min="0.1" max="1" step="0.1" value="0.5">
            </div>
            <div class="control-group">
                <label>Predation Pressure: <span id="predationVal">0.3</span></label>
                <input type="range" id="predation" min="0" max="1" step="0.1" value="0.3">
            </div>
            
            <button id="reset">Reset Ecosystem</button>
            <button id="pause">Pause</button>
            <button id="storm">Storm Event</button>
            
            <div class="stats">
                <div>Time: <span id="time">0</span> hours</div>
                <div>Tide Level: <span id="tideLevel">100</span>%</div>
                <div>Total Organisms: <span id="organisms">0</span></div>
                <div>Species Richness: <span id="richness">0</span></div>
            </div>
            
            <p class="description"><strong>Zonation:</strong> High shore (yellow) = exposure tolerant. Low shore (blue) = competition tolerant. Mid shore = generalists.</p>
            
            <div class="species-legend">
                <strong>Species:</strong>
                <div class="species-item"><div class="species-color" style="background:#4ade80"></div>Algae (producer)</div>
                <div class="species-item"><div class="species-color" style="background:#60a5fa"></div>Mussels (filter feeder)</div>
                <div class="species-item"><div class="species-color" style="background:#f97316"></div>Starfish (predator)</div>
                <div class="species-item"><div class="species-color" style="background:#e879f9"></div>Anemones</div>
                <div class="species-item"><div class="species-color" style="background:#a78bfa"></div>Hermit Crabs</div>
                <div class="species-item"><div class="species-color" style="background:#fbbf24"></div>Limpets</div>
            </div>
        </div>
    </div>
    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        
        let W, H, organisms = [], paused = false;
        let time = 0;
        let tideLevel = 100; // 0-100, 100 = high tide
        
        const SPECIES = {
            ALGAE: { name: 'Algae', color: '#4ade80', zoneMin: 20, zoneMax: 100, exposureTol: 0.7, size: 8, type: 'producer' },
            MUSSEL: { name: 'Mussel', color: '#60a5fa', zoneMin: 30, zoneMax: 90, exposureTol: 0.5, size: 10, type: 'filter' },
            STARFISH: { name: 'Starfish', color: '#f97316', zoneMin: 10, zoneMax: 70, exposureTol: 0.3, size: 15, type: 'predator' },
            ANEMONE: { name: 'Anemone', color: '#e879f9', zoneMin: 20, zoneMax: 80, exposureTol: 0.4, size: 12, type: 'filter' },
            CRAB: { name: 'Crab', color: '#a78bfa', zoneMin: 30, zoneMax: 100, exposureTol: 0.8, size: 10, type: 'scavenger' },
            LIMPET: { name: 'Limpet', color: '#fbbf24', zoneMin: 50, zoneMax: 100, exposureTol: 0.9, size: 6, type: 'grazer' }
        };
        
        let params = {
            cycleSpeed: 1.0,
            waveIntensity: 0.5,
            desiccation: 0.5,
            predation: 0.3
        };
        
        function resize() {
            const c = document.getElementById('canvas-container');
            canvas.width = c.clientWidth;
            canvas.height = c.clientHeight;
            W = canvas.width;
            H = canvas.height;
        }
        
        function getZone(y) {
            // 0 = top (high shore), 100 = bottom (low shore/always submerged)
            return (y / H) * 100;
        }
        
        function init() {
            resize();
            organisms = [];
            time = 0;
            
            // Seed each species in appropriate zones
            for (const [key, species] of Object.entries(SPECIES)) {
                const count = key === 'STARFISH' ? 8 : 25;
                for (let i = 0; i < count; i++) {
                    // Place in preferred zone
                    const zoneY = (species.zoneMin + Math.random() * (species.zoneMax - species.zoneMin)) / 100 * H;
                    organisms.push({
                        x: Math.random() * W,
                        y: zoneY,
                        species: species,
                        health: 100,
                        exposed: false
                    });
                }
            }
            
            updateStats();
        }
        
        function step() {
            time++;
            
            // Tide cycle (12 hour cycle, 6 hours up, 6 hours down)
            const cyclePos = (time * params.cycleSpeed) % 720;
            tideLevel = 50 + 50 * Math.sin(cyclePos * Math.PI / 360);
            
            // Update tide indicator
            const indicator = document.getElementById('tideIndicator');
            if (tideLevel > 80) {
                indicator.innerHTML = 'üåä High Tide';
            } else if (tideLevel > 50) {
                indicator.innerHTML = 'üåä Mid Tide (falling)';
            } else if (tideLevel > 20) {
                indicator.innerHTML = 'üèñÔ∏è Low Tide';
            } else {
                indicator.innerHTML = 'üèñÔ∏è Very Low Tide';
            }
            
            // Water line position
            const waterLine = H * (1 - tideLevel / 100);
            
            // Update organisms
            for (let i = organisms.length - 1; i >= 0; i--) {
                const org = organisms[i];
                
                // Check if exposed (above water line)
                org.exposed = org.y < waterLine;
                
                // Exposure stress
                if (org.exposed) {
                    const exposureStress = params.desiccation * (1 - org.species.exposureTol) * 0.5;
                    org.health -= exposureStress;
                } else {
                    // Submerged - recover slowly
                    org.health = Math.min(100, org.health + 0.2);
                }
                
                // Movement (mobile species)
                if (org.species.type === 'predator' || org.species.type === 'scavenger') {
                    // Move toward food/preferred zone
                    org.x += (Math.random() - 0.5) * 3;
                    org.y += (Math.random() - 0.5) * 2;
                    
                    // Stay in bounds and preferred zone
                    org.x = Math.max(0, Math.min(W, org.x));
                    const minY = org.species.zoneMin / 100 * H;
                    const maxY = org.species.zoneMax / 100 * H;
                    org.y = Math.max(minY, Math.min(maxY, org.y));
                }
                
                // Wave disturbance
                if (!org.exposed && Math.random() < params.waveIntensity * 0.01) {
                    org.x += (Math.random() - 0.5) * 20;
                    org.x = Math.max(0, Math.min(W, org.x));
                }
                
                // Predation (starfish eat mussels)
                if (org.species.type === 'predator') {
                    for (let j = organisms.length - 1; j >= 0; j--) {
                        if (i === j) continue;
                        const prey = organisms[j];
                        if (prey.species.type === 'filter') {
                            const dx = prey.x - org.x;
                            const dy = prey.y - org.y;
                            const dist = Math.sqrt(dx * dx + dy * dy);
                            if (dist < 20 && Math.random() < params.predation * 0.01) {
                                // Eat prey
                                organisms.splice(j, 1);
                                if (j < i) i--;
                                org.health = Math.min(100, org.health + 20);
                                break;
                            }
                        }
                    }
                }
                
                // Death
                if (org.health <= 0) {
                    organisms.splice(i, 1);
                    continue;
                }
                
                // Reproduction
                if (org.health > 80 && Math.random() < 0.002) {
                    const minY = org.species.zoneMin / 100 * H;
                    const maxY = org.species.zoneMax / 100 * H;
                    organisms.push({
                        x: org.x + (Math.random() - 0.5) * 50,
                        y: Math.max(minY, Math.min(maxY, org.y + (Math.random() - 0.5) * 30)),
                        species: org.species,
                        health: 80,
                        exposed: false
                    });
                }
            }
            
            updateStats();
        }
        
        function stormEvent() {
            // Waves dislodge organisms
            for (let i = organisms.length - 1; i >= 0; i--) {
                if (Math.random() < 0.3) {
                    organisms[i].health -= 30;
                    organisms[i].x += (Math.random() - 0.5) * 100;
                    organisms[i].y += (Math.random() - 0.5) * 50;
                }
            }
        }
        
        function updateStats() {
            const speciesCounts = {};
            for (const org of organisms) {
                speciesCounts[org.species.name] = (speciesCounts[org.species.name] || 0) + 1;
            }
            
            document.getElementById('time').textContent = Math.floor(time);
            document.getElementById('tideLevel').textContent = tideLevel.toFixed(0);
            document.getElementById('organisms').textContent = organisms.length;
            document.getElementById('richness').textContent = Object.keys(speciesCounts).length;
        }
        
        function draw() {
            const waterLine = H * (1 - tideLevel / 100);
            
            // Sky
            ctx.fillStyle = '#87ceeb';
            ctx.fillRect(0, 0, W, Math.max(0, waterLine - 50));
            
            // Rocky shore gradient
            const shoreGradient = ctx.createLinearGradient(0, 0, 0, H);
            shoreGradient.addColorStop(0, '#c9b896'); // High shore - dry/light
            shoreGradient.addColorStop(0.3, '#a89070');
            shoreGradient.addColorStop(0.5, '#8b7355'); // Mid shore
            shoreGradient.addColorStop(0.7, '#6b5b47');
            shoreGradient.addColorStop(1, '#4a3f35'); // Low shore - always wet/dark
            ctx.fillStyle = shoreGradient;
            ctx.fillRect(0, 0, W, H);
            
            // Rock texture
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            for (let i = 0; i < 200; i++) {
                const rx = (Math.sin(i * 123.456) * 0.5 + 0.5) * W;
                const ry = (Math.cos(i * 789.012) * 0.5 + 0.5) * H;
                ctx.beginPath();
                ctx.arc(rx, ry, 3 + Math.random() * 8, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // Draw organisms
            for (const org of organisms) {
                const alpha = org.health / 100;
                ctx.globalAlpha = 0.5 + alpha * 0.5;
                
                ctx.fillStyle = org.species.color;
                ctx.beginPath();
                
                if (org.species.type === 'predator') {
                    // Star shape for starfish
                    const size = org.species.size;
                    ctx.beginPath();
                    for (let i = 0; i < 5; i++) {
                        const angle = (i * 72 - 90) * Math.PI / 180;
                        const x = org.x + Math.cos(angle) * size;
                        const y = org.y + Math.sin(angle) * size;
                        if (i === 0) ctx.moveTo(x, y);
                        else ctx.lineTo(x, y);
                        
                        const innerAngle = ((i * 72) + 36 - 90) * Math.PI / 180;
                        const ix = org.x + Math.cos(innerAngle) * size * 0.4;
                        const iy = org.y + Math.sin(innerAngle) * size * 0.4;
                        ctx.lineTo(ix, iy);
                    }
                    ctx.closePath();
                    ctx.fill();
                } else if (org.species.type === 'filter' && org.species.name === 'Mussel') {
                    // Oval for mussels
                    ctx.ellipse(org.x, org.y, org.species.size * 0.6, org.species.size, 0, 0, Math.PI * 2);
                    ctx.fill();
                } else {
                    // Circle for others
                    ctx.arc(org.x, org.y, org.species.size / 2, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // Stress indicator
                if (org.exposed && org.health < 70) {
                    ctx.strokeStyle = '#ef4444';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
            }
            
            ctx.globalAlpha = 1;
            
            // Water overlay
            const waterGradient = ctx.createLinearGradient(0, waterLine - 20, 0, H);
            waterGradient.addColorStop(0, 'rgba(14, 165, 233, 0)');
            waterGradient.addColorStop(0.1, 'rgba(14, 165, 233, 0.4)');
            waterGradient.addColorStop(0.3, 'rgba(14, 165, 233, 0.6)');
            waterGradient.addColorStop(1, 'rgba(14, 165, 233, 0.8)');
            ctx.fillStyle = waterGradient;
            ctx.fillRect(0, waterLine, W, H - waterLine);
            
            // Wave effect
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            for (let x = 0; x < W; x += 5) {
                const waveY = waterLine + Math.sin(x * 0.02 + time * 0.1 * params.cycleSpeed) * 5 * params.waveIntensity;
                if (x === 0) ctx.moveTo(x, waveY);
                else ctx.lineTo(x, waveY);
            }
            ctx.stroke();
            
            // Zone labels
            ctx.fillStyle = '#fff';
            ctx.font = '12px sans-serif';
            ctx.fillText('High Shore', 10, 30);
            ctx.fillText('(Splash Zone)', 10, 45);
            ctx.fillText('Mid Shore', 10, H * 0.45);
            ctx.fillText('Low Shore', 10, H * 0.8);
            ctx.fillText('(Subtidal)', 10, H * 0.8 + 15);
            
            // Water line indicator
            ctx.fillStyle = '#0ea5e9';
            ctx.fillText(`Water Line ‚Üí`, W - 100, waterLine + 5);
            
            requestAnimationFrame(draw);
        }
        
        let intervalId = null;
        function startSim() {
            if (intervalId) clearInterval(intervalId);
            intervalId = setInterval(() => {
                if (!paused) {
                    step();
                }
            }, 50);
        }
        
        // Event listeners
        document.getElementById('cycle').addEventListener('input', e => {
            params.cycleSpeed = +e.target.value;
            document.getElementById('cycleVal').textContent = params.cycleSpeed.toFixed(1);
        });
        document.getElementById('wave').addEventListener('input', e => {
            params.waveIntensity = +e.target.value;
            document.getElementById('waveVal').textContent = params.waveIntensity.toFixed(1);
        });
        document.getElementById('desiccation').addEventListener('input', e => {
            params.desiccation = +e.target.value;
            document.getElementById('desiccationVal').textContent = params.desiccation.toFixed(1);
        });
        document.getElementById('predation').addEventListener('input', e => {
            params.predation = +e.target.value;
            document.getElementById('predationVal').textContent = params.predation.toFixed(1);
        });
        
        document.getElementById('reset').addEventListener('click', () => { init(); startSim(); });
        document.getElementById('pause').addEventListener('click', () => {
            paused = !paused;
            document.getElementById('pause').textContent = paused ? 'Resume' : 'Pause';
        });
        document.getElementById('storm').addEventListener('click', stormEvent);
        
        window.addEventListener('resize', resize);
        init();
        draw();
        startSim();
    </script>
</body>
</html>
