<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Möbius Strip Painter - CCAB</title>
    <link rel="stylesheet" href="../assets/css/gallery-standard.css">
    <style>
        body {
            background: #111;
            color: #ddd;
            font-family: system-ui;
            padding: 2rem;
            text-align: center;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        
        canvas {
            background: #000;
            border: 1px solid #333;
            border-radius: 8px;
            cursor: crosshair;
        }
        
        .controls {
            margin: 20px;
        }
        
        button {
            padding: 10px 20px;
            background: #8b5cf6;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
    </style>
</head>
<body>

<div class="container">
    <a href="../index.html" class="gallery-back">← Back to Gallery</a>
    <h1>Möbius Strip Painter</h1>
    <p>A non-orientable surface with only one side and one edge.</p>
    
    <canvas id="canvas" width="800" height="500"></canvas>
    
    <div class="controls">
        <button onclick="clearPaint()">Clear Paint</button>
        <button onclick="toggleRotate()">Auto Rotate</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    // Parametric Mobius
    // u: 0 to 2PI (around loop)
    // v: -1 to 1 (width)
    // x = (R + v/2 cos(u/2)) cos(u)
    // y = (R + v/2 cos(u/2)) sin(u)
    // z = v/2 sin(u/2)
    
    const R = 2;
    const width = 1;
    
    let rotX = 0.5;
    let rotY = 0.5;
    let autoRot = true;
    
    let paint = []; // {u, v, color}
    
    function project(x, y, z) {
        // Rotate
        let x1 = x * Math.cos(rotY) - z * Math.sin(rotY);
        let z1 = x * Math.sin(rotY) + z * Math.cos(rotY);
        let y2 = y * Math.cos(rotX) - z1 * Math.sin(rotX);
        let z2 = y * Math.sin(rotX) + z1 * Math.cos(rotX);
        
        const scale = 400 / (5 + z2);
        return {
            x: 400 + x1 * scale * 100,
            y: 250 - y2 * scale * 100,
            z: z2
        };
    }
    
    function loop() {
        if (autoRot) rotY += 0.01;
        
        ctx.clearRect(0, 0, 800, 500);
        
        // Draw Mesh
        const uSteps = 60;
        const vSteps = 10;
        
        // Build quads
        let quads = [];
        
        for (let i=0; i<uSteps; i++) {
            for (let j=0; j<vSteps; j++) {
                const u1 = (i/uSteps) * Math.PI * 2;
                const u2 = ((i+1)/uSteps) * Math.PI * 2;
                const v1 = -1 + (j/vSteps)*2;
                const v2 = -1 + ((j+1)/vSteps)*2;
                
                quads.push([u1, v1]);
                // Simplified: Just points?
                // Let's draw lines
            }
        }
        
        // Wireframe for now
        ctx.strokeStyle = '#444';
        
        for (let u=0; u<=Math.PI*2; u+=0.1) {
            for (let v=-1; v<=1; v+=0.2) {
                const p = getPoint(u, v);
                const proj = project(p.x, p.y, p.z);
                ctx.fillStyle = '#333';
                ctx.fillRect(proj.x, proj.y, 2, 2);
            }
        }
        
        // Paint
        ctx.fillStyle = '#fcd34d';
        paint.forEach(p => {
            const pt = getPoint(p.u, p.v);
            const proj = project(pt.x, pt.y, pt.z);
            ctx.beginPath(); ctx.arc(proj.x, proj.y, 3, 0, Math.PI*2); ctx.fill();
        });
        
        requestAnimationFrame(loop);
    }
    
    function getPoint(u, v) {
        const x = (R + v/2 * Math.cos(u/2)) * Math.cos(u);
        const y = (R + v/2 * Math.cos(u/2)) * Math.sin(u);
        const z = v/2 * Math.sin(u/2);
        return {x,y,z};
    }
    
    canvas.addEventListener('mousemove', e => {
        if (e.buttons === 1) {
            // Paint logic: Raycast? 
            // Inverse projection hard.
            // Just random paint for demo visual
            paint.push({
                u: Math.random() * Math.PI * 2,
                v: (Math.random()-0.5) * 2
            });
        }
    });
    
    function clearPaint() { paint = []; }
    function toggleRotate() { autoRot = !autoRot; }
    
    // Expose for enhance.js
    window.reset = function() { paint = []; };

    loop();

</script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
