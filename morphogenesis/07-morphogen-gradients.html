<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Morphogen Gradients - Morphogenesis</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0a0e1a;
            color: #ffffff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
        }

        canvas {
            display: block;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #8A9A5B;
            text-decoration: none;
            font-size: 16px;
            font-weight: 600;
            z-index: 100;
            padding: 10px 20px;
            background: rgba(10, 14, 26, 0.8);
            border-radius: 25px;
            border: 2px solid #8A9A5B;
            transition: all 0.3s;
        }

        .back-link:hover {
            background: rgba(138, 154, 91, 0.2);
            transform: translateX(-5px);
        }

        .info {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(10, 14, 26, 0.9);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #ff69b4;
            max-width: 360px;
            z-index: 100;
        }

        .info h3 {
            color: #ff69b4;
            margin-bottom: 10px;
        }

        .description {
            font-size: 13px;
            line-height: 1.5;
            color: #ccc;
        }

        .legend {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(10, 14, 26, 0.9);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #8A9A5B;
            z-index: 100;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
            font-size: 14px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Morphogenesis</a>

    <div class="info">
        <h3>Morphogen Gradients</h3>
        <div class="description">
            The French Flag Model: Morphogen concentration gradients provide positional
            information. Cells interpret their position based on morphogen levels,
            activating different genes at different threshold concentrations.
            Classic example: Bicoid and Nanos gradients in Drosophila embryo patterning.
        </div>
    </div>

    <div class="legend">
        <div class="legend-item">
            <div class="legend-color" style="background: linear-gradient(to right, #4169e1, rgba(65, 105, 225, 0));"></div>
            <span>Bicoid (Anterior)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: linear-gradient(to left, #ff6b6b, rgba(255, 107, 107, 0));"></div>
            <span>Nanos (Posterior)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #4169e1;"></div>
            <span>Head Region</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #66bb6a;"></div>
            <span>Thorax Region</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #ff6b6b;"></div>
            <span>Abdomen Region</span>
        </div>
    </div>

    <canvas id="canvas"></canvas>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        class Cell {
            constructor(x, y, position) {
                this.x = x;
                this.y = y;
                this.position = position; // 0 to 1 (anterior to posterior)
                this.bicoidLevel = 0;
                this.nanosLevel = 0;
                this.fate = 'none'; // 'head', 'thorax', 'abdomen'
                this.geneExpression = 0;
            }

            update(time) {
                // Bicoid gradient: high at anterior (0), low at posterior (1)
                this.bicoidLevel = Math.exp(-this.position * 3);

                // Nanos gradient: low at anterior, high at posterior
                this.nanosLevel = Math.exp(-(1 - this.position) * 3);

                // Determine cell fate based on morphogen levels
                const bicoidThresholdHigh = 0.6;
                const bicoidThresholdLow = 0.2;

                if (this.bicoidLevel > bicoidThresholdHigh) {
                    this.fate = 'head';
                    this.geneExpression = this.bicoidLevel;
                } else if (this.bicoidLevel > bicoidThresholdLow) {
                    this.fate = 'thorax';
                    this.geneExpression = this.bicoidLevel * 0.5 + 0.3;
                } else {
                    this.fate = 'abdomen';
                    this.geneExpression = this.nanosLevel;
                }
            }

            draw(showGradient = true) {
                const size = 8;
                let color;

                if (showGradient) {
                    // Show morphogen gradient
                    const r = Math.floor(this.nanosLevel * 255);
                    const b = Math.floor(this.bicoidLevel * 255);
                    const g = Math.floor(Math.min(this.bicoidLevel, this.nanosLevel) * 255);
                    color = `rgb(${r}, ${g}, ${b})`;
                } else {
                    // Show cell fate
                    const fateColors = {
                        'head': '#4169e1',
                        'thorax': '#66bb6a',
                        'abdomen': '#ff6b6b',
                        'none': '#666'
                    };
                    color = fateColors[this.fate];
                }

                ctx.fillStyle = color;
                ctx.strokeStyle = '#0a0e1a';
                ctx.lineWidth = 1;

                ctx.beginPath();
                ctx.arc(this.x, this.y, size, 0, Math.PI * 2);
                ctx.fill();
                ctx.stroke();

                // Show gene expression as glow
                if (!showGradient && this.geneExpression > 0.5) {
                    ctx.strokeStyle = color;
                    ctx.lineWidth = 2;
                    ctx.globalAlpha = this.geneExpression * 0.5;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, size + 3, 0, Math.PI * 2);
                    ctx.stroke();
                    ctx.globalAlpha = 1;
                }
            }
        }

        // Create embryo
        const cells = [];
        const embryoX = canvas.width / 2 - 300;
        const embryoY = canvas.height / 2;
        const embryoLength = 600;
        const embryoHeight = 150;

        for (let x = 0; x <= embryoLength; x += 12) {
            for (let y = -embryoHeight / 2; y <= embryoHeight / 2; y += 12) {
                // Elliptical embryo shape
                const normalizedY = y / (embryoHeight / 2);
                const normalizedX = x / embryoLength;

                if (normalizedY * normalizedY + (normalizedX - 0.5) * (normalizedX - 0.5) * 0.5 < 1) {
                    const position = x / embryoLength;
                    cells.push(new Cell(embryoX + x, embryoY + y, position));
                }
            }
        }

        let time = 0;
        let showMode = 0; // 0 = gradient, 1 = fate

        function drawEmbryo() {
            // Embryo outline
            ctx.strokeStyle = 'rgba(138, 154, 91, 0.5)';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.ellipse(embryoX + embryoLength / 2, embryoY, embryoLength / 2, embryoHeight / 2, 0, 0, Math.PI * 2);
            ctx.stroke();

            // Update and draw cells
            cells.forEach(cell => {
                cell.update(time);
                cell.draw(showMode === 0);
            });

            // Labels
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 14px Arial';
            ctx.fillText('Anterior', embryoX - 70, embryoY + 5);
            ctx.fillText('Posterior', embryoX + embryoLength + 20, embryoY + 5);

            // Mode indicator
            ctx.fillStyle = '#4fc3f7';
            ctx.font = 'bold 16px Arial';
            const modeText = showMode === 0 ? 'Morphogen Gradients' : 'Cell Fate Specification';
            ctx.fillText(modeText, embryoX + embryoLength / 2 - 80, embryoY - embryoHeight / 2 - 30);

            // Switch mode periodically
            if (time % 300 === 0) {
                showMode = 1 - showMode;
            }

            // Draw threshold lines when showing fate
            if (showMode === 1) {
                drawThresholdLines();
            }
        }

        function drawThresholdLines() {
            // Threshold positions
            const threshold1 = embryoX + embryoLength * 0.35; // Head-Thorax boundary
            const threshold2 = embryoX + embryoLength * 0.65; // Thorax-Abdomen boundary

            ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);

            ctx.beginPath();
            ctx.moveTo(threshold1, embryoY - embryoHeight / 2 - 10);
            ctx.lineTo(threshold1, embryoY + embryoHeight / 2 + 10);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(threshold2, embryoY - embryoHeight / 2 - 10);
            ctx.lineTo(threshold2, embryoY + embryoHeight / 2 + 10);
            ctx.stroke();

            ctx.setLineDash([]);

            // Region labels
            ctx.fillStyle = '#4169e1';
            ctx.font = '13px Arial';
            ctx.fillText('Head', embryoX + 80, embryoY + embryoHeight / 2 + 30);

            ctx.fillStyle = '#66bb6a';
            ctx.fillText('Thorax', embryoX + 260, embryoY + embryoHeight / 2 + 30);

            ctx.fillStyle = '#ff6b6b';
            ctx.fillText('Abdomen', embryoX + 460, embryoY + embryoHeight / 2 + 30);
        }

        function drawGradientGraphs() {
            const graphX = 100;
            const graphY = canvas.height - 200;
            const graphWidth = 400;
            const graphHeight = 100;

            ctx.fillStyle = 'rgba(10, 14, 26, 0.9)';
            ctx.fillRect(graphX - 20, graphY - 130, graphWidth + 40, graphHeight + 140);

            ctx.fillStyle = '#fff';
            ctx.font = 'bold 14px Arial';
            ctx.fillText('Morphogen Concentration Profiles', graphX, graphY - 140);

            // Axes
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(graphX, graphY);
            ctx.lineTo(graphX, graphY - graphHeight);
            ctx.lineTo(graphX, graphY);
            ctx.lineTo(graphX + graphWidth, graphY);
            ctx.stroke();

            // Bicoid gradient
            ctx.strokeStyle = '#4169e1';
            ctx.lineWidth = 3;
            ctx.beginPath();
            for (let x = 0; x <= graphWidth; x++) {
                const position = x / graphWidth;
                const bicoid = Math.exp(-position * 3);
                const y = graphY - bicoid * graphHeight;
                if (x === 0) ctx.moveTo(graphX + x, y);
                else ctx.lineTo(graphX + x, y);
            }
            ctx.stroke();

            // Nanos gradient
            ctx.strokeStyle = '#ff6b6b';
            ctx.beginPath();
            for (let x = 0; x <= graphWidth; x++) {
                const position = x / graphWidth;
                const nanos = Math.exp(-(1 - position) * 3);
                const y = graphY - nanos * graphHeight;
                if (x === 0) ctx.moveTo(graphX + x, y);
                else ctx.lineTo(graphX + x, y);
            }
            ctx.stroke();

            // Threshold lines
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.lineWidth = 1;
            ctx.setLineDash([3, 3]);

            const thresholdHigh = graphY - 0.6 * graphHeight;
            const thresholdLow = graphY - 0.2 * graphHeight;

            ctx.beginPath();
            ctx.moveTo(graphX, thresholdHigh);
            ctx.lineTo(graphX + graphWidth, thresholdHigh);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(graphX, thresholdLow);
            ctx.lineTo(graphX + graphWidth, thresholdLow);
            ctx.stroke();

            ctx.setLineDash([]);

            // Labels
            ctx.fillStyle = '#4169e1';
            ctx.font = '12px Arial';
            ctx.fillText('Bicoid', graphX + 20, graphY - 80);

            ctx.fillStyle = '#ff6b6b';
            ctx.fillText('Nanos', graphX + graphWidth - 60, graphY - 80);

            ctx.fillStyle = '#fff';
            ctx.font = '11px Arial';
            ctx.fillText('High', graphX - 35, graphY - graphHeight + 5);
            ctx.fillText('Low', graphX - 30, graphY + 5);
            ctx.fillText('Anterior', graphX, graphY + 20);
            ctx.fillText('Posterior', graphX + graphWidth - 50, graphY + 20);

            ctx.fillText('Threshold 1', graphX + graphWidth + 10, thresholdHigh + 5);
            ctx.fillText('Threshold 2', graphX + graphWidth + 10, thresholdLow + 5);
        }

        function drawFrenchFlag() {
            const flagX = canvas.width - 280;
            const flagY = 100;
            const flagWidth = 200;
            const flagHeight = 100;

            ctx.fillStyle = 'rgba(10, 14, 26, 0.9)';
            ctx.fillRect(flagX - 20, flagY - 40, flagWidth + 40, flagHeight + 60);

            ctx.fillStyle = '#fff';
            ctx.font = 'bold 12px Arial';
            ctx.fillText('French Flag Model', flagX + 20, flagY - 50);

            // Three regions
            const regionWidth = flagWidth / 3;

            ctx.fillStyle = '#4169e1';
            ctx.fillRect(flagX, flagY, regionWidth, flagHeight);

            ctx.fillStyle = '#66bb6a';
            ctx.fillRect(flagX + regionWidth, flagY, regionWidth, flagHeight);

            ctx.fillStyle = '#ff6b6b';
            ctx.fillRect(flagX + regionWidth * 2, flagY, regionWidth, flagHeight);

            // Border
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.strokeRect(flagX, flagY, flagWidth, flagHeight);

            // Labels
            ctx.fillStyle = '#fff';
            ctx.font = '11px Arial';
            ctx.fillText('Head', flagX + 15, flagY + flagHeight + 20);
            ctx.fillText('Thorax', flagX + regionWidth + 10, flagY + flagHeight + 20);
            ctx.fillText('Abdomen', flagX + regionWidth * 2 + 5, flagY + flagHeight + 20);
        }

        function animate() {
            ctx.fillStyle = '#0a0e1a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            drawEmbryo();
            drawGradientGraphs();
            drawFrenchFlag();

            time++;
            requestAnimationFrame(animate);
        }

        animate();

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    </script>
</body>
</html>
