<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cell Division (Mitosis) - Morphogenesis</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0a0e1a;
            color: #ffffff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
        }

        canvas {
            display: block;
            cursor: crosshair;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #8A9A5B;
            text-decoration: none;
            font-size: 16px;
            font-weight: 600;
            z-index: 100;
            padding: 10px 20px;
            background: rgba(10, 14, 26, 0.8);
            border-radius: 25px;
            border: 2px solid #8A9A5B;
            transition: all 0.3s;
        }

        .back-link:hover {
            background: rgba(138, 154, 91, 0.2);
            transform: translateX(-5px);
        }

        .info {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(10, 14, 26, 0.85);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #ff69b4;
            max-width: 300px;
            z-index: 100;
        }

        .info h3 {
            color: #ff69b4;
            margin-bottom: 10px;
        }

        .phase {
            color: #4fc3f7;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .description {
            font-size: 14px;
            line-height: 1.4;
            color: #ccc;
        }

        .legend {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(10, 14, 26, 0.9);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #8A9A5B;
            z-index: 100;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Morphogenesis</a>

    <div class="info">
        <h3>Mitosis</h3>
        <div class="phase" id="phase">Interphase</div>
        <div class="description" id="description">Chromatin in relaxed state, nucleus visible. Cell preparing for division.</div>
    </div>

    <div class="legend">
        <div class="legend-item">
            <div class="legend-color" style="background: #ff69b4;"></div>
            <span>Chromosomes</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #4fc3f7;"></div>
            <span>Spindle Fibers</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #66bb6a;"></div>
            <span>Centrosomes</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: rgba(138, 154, 91, 0.3);"></div>
            <span>Nuclear Envelope</span>
        </div>
    </div>

    <canvas id="canvas"></canvas>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const phaseEl = document.getElementById('phase');
        const descEl = document.getElementById('description');

        // Mitosis phases
        const PHASES = [
            {
                name: 'Interphase',
                duration: 180,
                desc: 'Chromatin in relaxed state, nucleus visible. Cell preparing for division.'
            },
            {
                name: 'Prophase',
                duration: 120,
                desc: 'Chromatin condenses into chromosomes. Centrosomes move to opposite poles. Nuclear envelope begins to break down.'
            },
            {
                name: 'Metaphase',
                duration: 100,
                desc: 'Chromosomes align at the cell equator (metaphase plate). Spindle fibers attach to kinetochores.'
            },
            {
                name: 'Anaphase',
                duration: 80,
                desc: 'Sister chromatids separate and move to opposite poles. Cell begins to elongate.'
            },
            {
                name: 'Telophase',
                duration: 100,
                desc: 'Chromosomes decondense. Nuclear envelopes reform around each set of chromosomes.'
            },
            {
                name: 'Cytokinesis',
                duration: 80,
                desc: 'Cell membrane pinches in (cleavage furrow), dividing the cell into two daughter cells.'
            }
        ];

        let time = 0;
        let currentPhaseIndex = 0;
        let phaseTime = 0;

        class Chromosome {
            constructor(x, y, angle) {
                this.x = x;
                this.y = y;
                this.targetX = x;
                this.targetY = y;
                this.angle = angle;
                this.condensation = 0; // 0 = relaxed chromatin, 1 = condensed chromosome
                this.separation = 0; // 0 = together, 1 = separated
                this.pairOffset = 20;
            }

            update(phase, progress) {
                // Condensation
                if (phase === 0) { // Interphase
                    this.condensation = Math.max(0, this.condensation - 0.01);
                } else if (phase === 1) { // Prophase
                    this.condensation = Math.min(1, this.condensation + 0.015);
                } else if (phase >= 4) { // Telophase onwards
                    this.condensation = Math.max(0, this.condensation - 0.015);
                }

                // Movement and separation
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;

                if (phase === 2) { // Metaphase - align at center
                    this.targetX = centerX;
                    this.targetY = centerY;
                } else if (phase === 3) { // Anaphase - separate
                    this.separation = Math.min(1, progress);
                    const offset = this.separation * 150;
                    this.targetX = this.angle < Math.PI ? centerX - offset : centerX + offset;
                    this.targetY = centerY;
                } else if (phase === 4 || phase === 5) { // Telophase/Cytokinesis
                    const offset = 150;
                    this.targetX = this.angle < Math.PI ? centerX - offset : centerX + offset;
                    this.targetY = centerY;
                }

                // Smooth movement
                this.x += (this.targetX - this.x) * 0.05;
                this.y += (this.targetY - this.y) * 0.05;
            }

            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);

                if (this.condensation < 0.3) {
                    // Draw as relaxed chromatin
                    ctx.strokeStyle = `rgba(255, 105, 180, ${0.3 + this.condensation * 0.3})`;
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    for (let i = 0; i < 50; i++) {
                        const a = (i / 50) * Math.PI * 2;
                        const r = 30 + Math.sin(i * 0.5 + time * 0.01) * 10;
                        const x = Math.cos(a) * r;
                        const y = Math.sin(a) * r;
                        if (i === 0) ctx.moveTo(x, y);
                        else ctx.lineTo(x, y);
                    }
                    ctx.closePath();
                    ctx.stroke();
                } else {
                    // Draw as condensed chromosome (X shape)
                    const alpha = 0.5 + this.condensation * 0.5;
                    ctx.fillStyle = `rgba(255, 105, 180, ${alpha})`;
                    ctx.strokeStyle = `rgba(255, 182, 193, ${alpha})`;
                    ctx.lineWidth = 3;

                    // Sister chromatids
                    const offset = this.pairOffset * (1 - this.separation);

                    for (let s = -1; s <= 1; s += 2) {
                        ctx.save();
                        ctx.translate(s * offset, 0);

                        // Draw X-shaped chromosome
                        ctx.beginPath();
                        ctx.moveTo(-5, -25);
                        ctx.lineTo(-8, 0);
                        ctx.lineTo(-5, 25);
                        ctx.lineTo(-2, 25);
                        ctx.lineTo(-5, 0);
                        ctx.lineTo(-2, -25);
                        ctx.closePath();
                        ctx.fill();
                        ctx.stroke();

                        ctx.beginPath();
                        ctx.moveTo(5, -25);
                        ctx.lineTo(2, 0);
                        ctx.lineTo(5, 25);
                        ctx.lineTo(8, 25);
                        ctx.lineTo(5, 0);
                        ctx.lineTo(8, -25);
                        ctx.closePath();
                        ctx.fill();
                        ctx.stroke();

                        // Centromere
                        if (this.separation < 0.1) {
                            ctx.fillStyle = `rgba(255, 215, 0, ${alpha})`;
                            ctx.beginPath();
                            ctx.arc(0, 0, 6, 0, Math.PI * 2);
                            ctx.fill();
                        }

                        ctx.restore();
                    }
                }

                ctx.restore();
            }
        }

        class Centrosome {
            constructor(side) {
                this.side = side; // -1 or 1
                this.x = canvas.width / 2;
                this.y = canvas.height / 2;
            }

            update(phase, progress) {
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;

                if (phase >= 1 && phase <= 3) { // Prophase to Anaphase
                    const offset = 100 + progress * 50;
                    this.x = centerX + this.side * offset;
                    this.y = centerY;
                } else if (phase >= 4) { // Telophase onwards
                    const offset = 150;
                    this.x = centerX + this.side * offset;
                    this.y = centerY;
                } else {
                    this.x = centerX + this.side * 30;
                    this.y = centerY;
                }
            }

            draw() {
                ctx.fillStyle = '#66bb6a';
                ctx.beginPath();
                ctx.arc(this.x, this.y, 8, 0, Math.PI * 2);
                ctx.fill();

                // Centrioles
                ctx.strokeStyle = '#81c784';
                ctx.lineWidth = 2;
                for (let i = 0; i < 9; i++) {
                    const a = (i / 9) * Math.PI * 2;
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.y);
                    ctx.lineTo(this.x + Math.cos(a) * 15, this.y + Math.sin(a) * 15);
                    ctx.stroke();
                }
            }
        }

        // Initialize
        const chromosomes = [];
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;

        for (let i = 0; i < 8; i++) {
            const angle = (i / 8) * Math.PI * 2;
            const radius = 40;
            const x = centerX + Math.cos(angle) * radius;
            const y = centerY + Math.sin(angle) * radius;
            chromosomes.push(new Chromosome(x, y, angle));
        }

        const centrosomes = [
            new Centrosome(-1),
            new Centrosome(1)
        ];

        function drawCell(phase, progress) {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            let cellRadius = 200;

            // Cell membrane
            ctx.strokeStyle = 'rgba(138, 154, 91, 0.5)';
            ctx.lineWidth = 3;
            ctx.beginPath();

            if (phase === 5) { // Cytokinesis
                const furrowDepth = progress * 80;
                const leftRadius = cellRadius - furrowDepth;
                const rightRadius = cellRadius - furrowDepth;

                // Left cell
                ctx.beginPath();
                ctx.arc(centerX - 75 * progress, centerY, leftRadius, 0, Math.PI * 2);
                ctx.stroke();

                // Right cell
                ctx.beginPath();
                ctx.arc(centerX + 75 * progress, centerY, rightRadius, 0, Math.PI * 2);
                ctx.stroke();
            } else if (phase === 3) { // Anaphase - elongate
                const elongation = progress * 50;
                ctx.ellipse(centerX, centerY, cellRadius + elongation, cellRadius - elongation * 0.3, 0, 0, Math.PI * 2);
                ctx.stroke();
            } else {
                ctx.arc(centerX, centerY, cellRadius, 0, Math.PI * 2);
                ctx.stroke();
            }

            // Nuclear envelope
            if (phase === 0 || phase >= 4) {
                const envelopeAlpha = phase === 0 ? 0.6 : progress * 0.6;
                ctx.strokeStyle = `rgba(138, 154, 91, ${envelopeAlpha})`;
                ctx.fillStyle = `rgba(138, 154, 91, ${envelopeAlpha * 0.1})`;
                ctx.lineWidth = 2;

                if (phase >= 4) {
                    // Two nuclei forming
                    ctx.beginPath();
                    ctx.arc(centerX - 150, centerY, 60 * progress, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.arc(centerX + 150, centerY, 60 * progress, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.stroke();
                } else {
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, 80, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.stroke();
                }
            }
        }

        function drawSpindleFibers(phase, progress) {
            if (phase < 1 || phase > 4) return;

            ctx.strokeStyle = 'rgba(79, 195, 247, 0.3)';
            ctx.lineWidth = 1;

            chromosomes.forEach(chr => {
                centrosomes.forEach(centro => {
                    if (phase === 2 || phase === 3) { // Metaphase and Anaphase
                        ctx.beginPath();
                        ctx.moveTo(centro.x, centro.y);
                        ctx.lineTo(chr.x, chr.y);
                        ctx.stroke();
                    }
                });
            });

            // Polar fibers
            if (phase >= 2) {
                ctx.strokeStyle = 'rgba(79, 195, 247, 0.2)';
                ctx.beginPath();
                ctx.moveTo(centrosomes[0].x, centrosomes[0].y);
                ctx.lineTo(centrosomes[1].x, centrosomes[1].y);
                ctx.stroke();
            }
        }

        function animate() {
            ctx.fillStyle = '#0a0e1a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Update phase
            const currentPhase = PHASES[currentPhaseIndex];
            phaseTime++;
            const progress = phaseTime / currentPhase.duration;

            if (phaseTime >= currentPhase.duration) {
                currentPhaseIndex = (currentPhaseIndex + 1) % PHASES.length;
                phaseTime = 0;

                // Update UI
                phaseEl.textContent = PHASES[currentPhaseIndex].name;
                descEl.textContent = PHASES[currentPhaseIndex].desc;
            }

            // Draw
            drawCell(currentPhaseIndex, progress);

            centrosomes.forEach(c => {
                c.update(currentPhaseIndex, progress);
            });

            drawSpindleFibers(currentPhaseIndex, progress);

            chromosomes.forEach(chr => {
                chr.update(currentPhaseIndex, progress);
                chr.draw();
            });

            centrosomes.forEach(c => c.draw());

            time++;
            requestAnimationFrame(animate);
        }

        // Expose for enhance.js
        window.reset = function() { time = 0; };

        animate();

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
