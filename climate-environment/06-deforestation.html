<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deforestation - Climate/Environment Simulations</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); min-height: 100vh; color: #e2e8f0; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        header { text-align: center; margin-bottom: 30px; }
        .back-link { display: inline-flex; align-items: center; gap: 8px; color: #22c55e; text-decoration: none; font-size: 0.9rem; margin-bottom: 20px; }
        h1 { font-size: 2.5rem; font-weight: 700; color: #22c55e; margin-bottom: 10px; }
        .subtitle { color: #94a3b8; font-size: 1.1rem; }
        .simulation-container { display: grid; grid-template-columns: 1fr 320px; gap: 20px; margin-bottom: 30px; }
        .canvas-wrapper { background: rgba(0, 0, 0, 0.3); border-radius: 16px; padding: 20px; border: 1px solid rgba(34, 197, 94, 0.2); }
        canvas { display: block; width: 100%; height: 500px; border-radius: 8px; background: #0a1628; cursor: pointer; }
        .controls-panel { background: rgba(0, 0, 0, 0.3); border-radius: 16px; padding: 20px; border: 1px solid rgba(34, 197, 94, 0.2); }
        .control-section { margin-bottom: 20px; }
        .control-section h3 { color: #22c55e; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px; }
        .control-group { margin-bottom: 15px; }
        .control-group label { display: block; color: #94a3b8; font-size: 0.85rem; margin-bottom: 6px; }
        .control-group input[type="range"] { width: 100%; height: 6px; border-radius: 3px; background: #1e293b; outline: none; -webkit-appearance: none; }
        .control-group input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 16px; height: 16px; border-radius: 50%; background: #22c55e; cursor: pointer; }
        .control-value { text-align: right; color: #22c55e; font-size: 0.85rem; font-weight: 600; }
        .mode-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .mode-btn { padding: 10px; border: 1px solid rgba(34, 197, 94, 0.3); background: transparent; color: #e2e8f0; border-radius: 8px; cursor: pointer; font-size: 0.8rem; }
        .mode-btn.active { background: #22c55e; color: #1a1a2e; font-weight: 600; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .stat-item { background: rgba(34, 197, 94, 0.1); padding: 12px; border-radius: 8px; text-align: center; }
        .stat-value { font-size: 1.4rem; font-weight: 700; color: #22c55e; }
        .stat-label { font-size: 0.75rem; color: #94a3b8; margin-top: 4px; }
        .btn-row { display: flex; gap: 10px; margin-top: 15px; }
        .btn { flex: 1; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; }
        .btn-primary { background: #22c55e; color: #1a1a2e; }
        .btn-secondary { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .btn-danger { background: #ef4444; color: #fff; }
        .info-box { background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 12px; padding: 20px; }
        .info-box h3 { color: #22c55e; margin-bottom: 10px; }
        .info-box p { color: #94a3b8; font-size: 0.9rem; line-height: 1.6; }
        @media (max-width: 900px) { .simulation-container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-link"><span>‚Üê</span><span>Back to Climate/Environment</span></a>
            <h1>Deforestation</h1>
            <p class="subtitle">Forest loss and ecosystem impacts</p>
        </header>

        <div class="simulation-container">
            <div class="canvas-wrapper">
                <canvas id="simCanvas"></canvas>
            </div>

            <div class="controls-panel">
                <div class="control-section">
                    <h3>Action Mode</h3>
                    <div class="mode-buttons">
                        <button class="mode-btn" data-mode="clear">Clear Cut</button>
                        <button class="mode-btn" data-mode="selective">Selective</button>
                        <button class="mode-btn active" data-mode="plant">Plant Tree</button>
                        <button class="mode-btn" data-mode="fire">Fire</button>
                    </div>
                </div>

                <div class="control-section">
                    <h3>Parameters</h3>
                    <div class="control-group">
                        <label>Natural Regrowth Rate</label>
                        <input type="range" id="regrowth" min="0" max="10" value="3">
                        <div class="control-value"><span id="regrowthVal">3</span>%/yr</div>
                    </div>
                    <div class="control-group">
                        <label>Demand Pressure</label>
                        <input type="range" id="demand" min="0" max="10" value="5">
                        <div class="control-value"><span id="demandVal">5</span></div>
                    </div>
                    <div class="control-group">
                        <label>Climate Impact</label>
                        <input type="range" id="climate" min="0" max="5" value="1">
                        <div class="control-value"><span id="climateVal">1</span></div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>Forest Statistics</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="coverage">100</div>
                            <div class="stat-label">Coverage %</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="carbon">500</div>
                            <div class="stat-label">Carbon (Mt)</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="biodiversity">100</div>
                            <div class="stat-label">Biodiversity</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="rainfall">100</div>
                            <div class="stat-label">Rainfall %</div>
                        </div>
                    </div>
                </div>

                <div class="btn-row">
                    <button class="btn btn-primary" id="resetBtn">Regrow All</button>
                    <button class="btn btn-secondary" id="pauseBtn">Pause</button>
                </div>
            </div>
        </div>

        <div class="info-box">
            <h3>Deforestation Impacts</h3>
            <p>
                Forests store ~45% of terrestrial carbon and drive regional rainfall through
                evapotranspiration. Deforestation releases stored carbon, reduces rainfall,
                and destroys biodiversity. Click to clear or plant trees and observe how
                forest fragmentation affects ecosystem health.
            </p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * window.devicePixelRatio;
            canvas.height = rect.height * window.devicePixelRatio;
            ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        let paused = false;
        let mode = 'plant';
        let trees = [];
        let fires = [];
        let raindrops = [];

        const params = {
            regrowth: 3,
            demand: 5,
            climate: 1
        };

        const gridSize = 15;
        let grid = [];

        function initForest() {
            const width = canvas.width / window.devicePixelRatio;
            const height = canvas.height / window.devicePixelRatio;
            const cols = Math.floor(width / gridSize);
            const rows = Math.floor(height / gridSize);

            grid = [];
            trees = [];

            for (let i = 0; i < cols; i++) {
                grid[i] = [];
                for (let j = 0; j < rows; j++) {
                    const hasTree = Math.random() < 0.7;
                    grid[i][j] = {
                        tree: hasTree,
                        age: hasTree ? Math.random() * 50 + 10 : 0,
                        burning: false,
                        burnTime: 0
                    };
                    if (hasTree) {
                        trees.push({ x: i, y: j });
                    }
                }
            }
        }

        function clearArea(cx, cy, radius) {
            const cols = grid.length;
            const rows = grid[0].length;

            for (let i = Math.max(0, cx - radius); i < Math.min(cols, cx + radius); i++) {
                for (let j = Math.max(0, cy - radius); j < Math.min(rows, cy + radius); j++) {
                    const dist = Math.sqrt((i - cx) ** 2 + (j - cy) ** 2);
                    if (dist < radius && grid[i][j].tree) {
                        if (mode === 'clear' || (mode === 'selective' && Math.random() < 0.3)) {
                            grid[i][j].tree = false;
                            grid[i][j].age = 0;
                        }
                    }
                }
            }
        }

        function plantTree(cx, cy) {
            if (cx >= 0 && cx < grid.length && cy >= 0 && cy < grid[0].length) {
                if (!grid[cx][cy].tree) {
                    grid[cx][cy].tree = true;
                    grid[cx][cy].age = 1;
                }
            }
        }

        function startFire(cx, cy) {
            if (cx >= 0 && cx < grid.length && cy >= 0 && cy < grid[0].length) {
                if (grid[cx][cy].tree && !grid[cx][cy].burning) {
                    grid[cx][cy].burning = true;
                    grid[cx][cy].burnTime = 100;
                }
            }
        }

        function updateForest() {
            const cols = grid.length;
            const rows = grid[0].length;

            // Fire spread
            for (let i = 0; i < cols; i++) {
                for (let j = 0; j < rows; j++) {
                    if (grid[i][j].burning) {
                        grid[i][j].burnTime--;
                        if (grid[i][j].burnTime <= 0) {
                            grid[i][j].tree = false;
                            grid[i][j].burning = false;
                            grid[i][j].age = 0;
                        } else {
                            // Spread fire
                            const neighbors = [
                                [i-1, j], [i+1, j], [i, j-1], [i, j+1]
                            ];
                            for (const [ni, nj] of neighbors) {
                                if (ni >= 0 && ni < cols && nj >= 0 && nj < rows) {
                                    if (grid[ni][nj].tree && !grid[ni][nj].burning && Math.random() < 0.03) {
                                        grid[ni][nj].burning = true;
                                        grid[ni][nj].burnTime = 100;
                                    }
                                }
                            }
                        }
                    }
                }
            }

            // Natural regrowth
            if (Math.random() < params.regrowth / 1000) {
                const coverage = calculateCoverage();
                if (coverage > 0.2) { // Need seed source
                    const x = Math.floor(Math.random() * cols);
                    const y = Math.floor(Math.random() * rows);
                    if (!grid[x][y].tree) {
                        // Check for nearby trees (seed dispersal)
                        let nearbyTrees = 0;
                        for (let dx = -3; dx <= 3; dx++) {
                            for (let dy = -3; dy <= 3; dy++) {
                                const nx = x + dx, ny = y + dy;
                                if (nx >= 0 && nx < cols && ny >= 0 && ny < rows && grid[nx][ny].tree) {
                                    nearbyTrees++;
                                }
                            }
                        }
                        if (nearbyTrees > 2) {
                            grid[x][y].tree = true;
                            grid[x][y].age = 1;
                        }
                    }
                }
            }

            // Tree growth
            for (let i = 0; i < cols; i++) {
                for (let j = 0; j < rows; j++) {
                    if (grid[i][j].tree && !grid[i][j].burning) {
                        grid[i][j].age = Math.min(100, grid[i][j].age + 0.01);
                    }
                }
            }

            // Demand pressure (random clearing)
            if (Math.random() < params.demand / 5000) {
                const x = Math.floor(Math.random() * cols);
                const y = Math.floor(Math.random() * rows);
                clearArea(x, y, 3);
            }
        }

        function calculateCoverage() {
            let treeCount = 0;
            let total = 0;
            for (let i = 0; i < grid.length; i++) {
                for (let j = 0; j < grid[0].length; j++) {
                    total++;
                    if (grid[i][j].tree) treeCount++;
                }
            }
            return treeCount / total;
        }

        function drawForest() {
            const width = canvas.width / window.devicePixelRatio;
            const height = canvas.height / window.devicePixelRatio;

            // Sky gradient based on forest coverage
            const coverage = calculateCoverage();
            const skyBlue = Math.floor(150 + coverage * 50);
            ctx.fillStyle = `rgb(${100 - coverage * 50}, ${skyBlue}, ${200 + coverage * 55})`;
            ctx.fillRect(0, 0, width, height * 0.3);

            // Ground
            ctx.fillStyle = coverage > 0.5 ? '#3d2817' : '#8B7355';
            ctx.fillRect(0, height * 0.3, width, height * 0.7);

            // Draw trees
            for (let i = 0; i < grid.length; i++) {
                for (let j = 0; j < grid[0].length; j++) {
                    const x = i * gridSize + gridSize / 2;
                    const y = height * 0.3 + j * gridSize;

                    if (grid[i][j].tree) {
                        const age = grid[i][j].age;
                        const size = 5 + age / 10;

                        if (grid[i][j].burning) {
                            // Fire
                            ctx.fillStyle = '#ef4444';
                            ctx.beginPath();
                            ctx.arc(x, y, size + 3, 0, Math.PI * 2);
                            ctx.fill();
                            ctx.fillStyle = '#facc15';
                            ctx.beginPath();
                            ctx.arc(x, y - 3, size, 0, Math.PI * 2);
                            ctx.fill();
                        } else {
                            // Tree
                            ctx.fillStyle = `rgb(${34 + age / 2}, ${130 + age / 2}, ${34})`;
                            ctx.beginPath();
                            ctx.moveTo(x, y - size * 2);
                            ctx.lineTo(x + size, y);
                            ctx.lineTo(x - size, y);
                            ctx.closePath();
                            ctx.fill();

                            // Trunk
                            ctx.fillStyle = '#78350f';
                            ctx.fillRect(x - 2, y, 4, size / 2);
                        }
                    }
                }
            }

            // Rain (affected by forest coverage)
            if (Math.random() < coverage * 0.3) {
                raindrops.push({
                    x: Math.random() * width,
                    y: 0,
                    speed: 5 + Math.random() * 3
                });
            }

            ctx.strokeStyle = 'rgba(155, 200, 255, 0.5)';
            ctx.lineWidth = 1;
            raindrops = raindrops.filter(drop => {
                drop.y += drop.speed;
                if (drop.y < height) {
                    ctx.beginPath();
                    ctx.moveTo(drop.x, drop.y);
                    ctx.lineTo(drop.x, drop.y + 10);
                    ctx.stroke();
                    return true;
                }
                return false;
            });

            // Clouds
            ctx.fillStyle = `rgba(255, 255, 255, ${0.3 + coverage * 0.4})`;
            for (let i = 0; i < 5; i++) {
                const cx = (i * 150 + Date.now() / 50) % (width + 100) - 50;
                ctx.beginPath();
                ctx.arc(cx, 40, 30 * coverage, 0, Math.PI * 2);
                ctx.arc(cx + 25, 45, 25 * coverage, 0, Math.PI * 2);
                ctx.arc(cx - 20, 45, 20 * coverage, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function updateStats() {
            const coverage = calculateCoverage();
            const carbon = Math.round(coverage * 500);
            const biodiversity = Math.round(coverage * 100 * (1 - params.climate / 10));
            const rainfall = Math.round(50 + coverage * 50);

            document.getElementById('coverage').textContent = Math.round(coverage * 100);
            document.getElementById('carbon').textContent = carbon;
            document.getElementById('biodiversity').textContent = biodiversity;
            document.getElementById('rainfall').textContent = rainfall;
        }

        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = Math.floor((e.clientX - rect.left) / gridSize);
            const y = Math.floor((e.clientY - rect.top - canvas.height / window.devicePixelRatio * 0.3) / gridSize);

            switch (mode) {
                case 'clear':
                    clearArea(x, y, 5);
                    break;
                case 'selective':
                    clearArea(x, y, 3);
                    break;
                case 'plant':
                    plantTree(x, y);
                    break;
                case 'fire':
                    startFire(x, y);
                    break;
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            if (e.buttons === 1) {
                const rect = canvas.getBoundingClientRect();
                const x = Math.floor((e.clientX - rect.left) / gridSize);
                const y = Math.floor((e.clientY - rect.top - canvas.height / window.devicePixelRatio * 0.3) / gridSize);

                if (mode === 'plant') plantTree(x, y);
                else if (mode === 'clear') clearArea(x, y, 2);
            }
        });

        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                mode = btn.dataset.mode;
            });
        });

        document.getElementById('regrowth').addEventListener('input', (e) => {
            params.regrowth = parseInt(e.target.value);
            document.getElementById('regrowthVal').textContent = params.regrowth;
        });

        document.getElementById('demand').addEventListener('input', (e) => {
            params.demand = parseInt(e.target.value);
            document.getElementById('demandVal').textContent = params.demand;
        });

        document.getElementById('climate').addEventListener('input', (e) => {
            params.climate = parseInt(e.target.value);
            document.getElementById('climateVal').textContent = params.climate;
        });

        document.getElementById('resetBtn').addEventListener('click', initForest);
        document.getElementById('pauseBtn').addEventListener('click', () => {
            paused = !paused;
            document.getElementById('pauseBtn').textContent = paused ? 'Resume' : 'Pause';
        });

        function animate() {
            if (!paused) {
                updateForest();
                drawForest();
                updateStats();
            }
            requestAnimationFrame(animate);
        }

        initForest();
        animate();
    </script>
</body>
</html>
