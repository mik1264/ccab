<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ecosystem Collapse - Climate/Environment Simulations</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); min-height: 100vh; color: #e2e8f0; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        header { text-align: center; margin-bottom: 30px; }
        .back-link { display: inline-flex; align-items: center; gap: 8px; color: #22c55e; text-decoration: none; font-size: 0.9rem; margin-bottom: 20px; }
        h1 { font-size: 2.5rem; font-weight: 700; color: #22c55e; margin-bottom: 10px; }
        .subtitle { color: #94a3b8; font-size: 1.1rem; }
        .simulation-container { display: grid; grid-template-columns: 1fr 320px; gap: 20px; margin-bottom: 30px; }
        .canvas-wrapper { background: rgba(0, 0, 0, 0.3); border-radius: 16px; padding: 20px; border: 1px solid rgba(34, 197, 94, 0.2); }
        canvas { display: block; width: 100%; height: 500px; border-radius: 8px; background: #0a1628; }
        .controls-panel { background: rgba(0, 0, 0, 0.3); border-radius: 16px; padding: 20px; border: 1px solid rgba(34, 197, 94, 0.2); }
        .control-section { margin-bottom: 20px; }
        .control-section h3 { color: #22c55e; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px; }
        .control-group { margin-bottom: 15px; }
        .control-group label { display: block; color: #94a3b8; font-size: 0.85rem; margin-bottom: 6px; }
        .control-group input[type="range"] { width: 100%; height: 6px; border-radius: 3px; background: #1e293b; outline: none; -webkit-appearance: none; }
        .control-group input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 16px; height: 16px; border-radius: 50%; background: #22c55e; cursor: pointer; }
        .control-value { text-align: right; color: #22c55e; font-size: 0.85rem; font-weight: 600; }
        .health-display { text-align: center; padding: 15px; border-radius: 12px; margin-bottom: 15px; }
        .health-value { font-size: 2.5rem; font-weight: 700; }
        .species-list { display: flex; flex-direction: column; gap: 8px; }
        .species-item { display: flex; justify-content: space-between; align-items: center; padding: 8px; background: rgba(0, 0, 0, 0.2); border-radius: 6px; }
        .species-bar { flex: 1; height: 8px; background: #1e293b; border-radius: 4px; margin: 0 10px; overflow: hidden; }
        .species-fill { height: 100%; transition: width 0.3s ease; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .stat-item { background: rgba(34, 197, 94, 0.1); padding: 12px; border-radius: 8px; text-align: center; }
        .stat-value { font-size: 1.4rem; font-weight: 700; color: #22c55e; }
        .stat-label { font-size: 0.75rem; color: #94a3b8; margin-top: 4px; }
        .btn-row { display: flex; gap: 10px; margin-top: 15px; }
        .btn { flex: 1; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; }
        .btn-primary { background: #22c55e; color: #1a1a2e; }
        .btn-secondary { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .info-box { background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 12px; padding: 20px; }
        .info-box h3 { color: #22c55e; margin-bottom: 10px; }
        .info-box p { color: #94a3b8; font-size: 0.9rem; line-height: 1.6; }
        .warning { animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        @media (max-width: 900px) { .simulation-container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-link"><span>←</span><span>Back to Climate/Environment</span></a>
            <h1>Ecosystem Collapse</h1>
            <p class="subtitle">Tipping points and biodiversity cascades</p>
        </header>

        <div class="simulation-container">
            <div class="canvas-wrapper">
                <canvas id="simCanvas"></canvas>
            </div>

            <div class="controls-panel">
                <div class="health-display" id="healthBox" style="background: rgba(34, 197, 94, 0.2);">
                    <div class="health-value" id="health" style="color: #22c55e;">100%</div>
                    <div style="color: #94a3b8; font-size: 0.9rem;">Ecosystem Health</div>
                </div>

                <div class="control-section">
                    <h3>Stressors</h3>
                    <div class="control-group">
                        <label>Temperature Anomaly</label>
                        <input type="range" id="temperature" min="0" max="6" value="1" step="0.5">
                        <div class="control-value">+<span id="temperatureVal">1.0</span>°C</div>
                    </div>
                    <div class="control-group">
                        <label>Habitat Loss</label>
                        <input type="range" id="habitat" min="0" max="100" value="20">
                        <div class="control-value"><span id="habitatVal">20</span>%</div>
                    </div>
                    <div class="control-group">
                        <label>Pollution Level</label>
                        <input type="range" id="pollution" min="0" max="100" value="15">
                        <div class="control-value"><span id="pollutionVal">15</span>%</div>
                    </div>
                    <div class="control-group">
                        <label>Invasive Species</label>
                        <input type="range" id="invasive" min="0" max="100" value="10">
                        <div class="control-value"><span id="invasiveVal">10</span>%</div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>Species Populations</h3>
                    <div class="species-list">
                        <div class="species-item">
                            <span style="color: #22c55e;">Plants</span>
                            <div class="species-bar"><div class="species-fill" id="plantsBar" style="background: #22c55e; width: 100%;"></div></div>
                            <span id="plants">100%</span>
                        </div>
                        <div class="species-item">
                            <span style="color: #facc15;">Insects</span>
                            <div class="species-bar"><div class="species-fill" id="insectsBar" style="background: #facc15; width: 100%;"></div></div>
                            <span id="insects">100%</span>
                        </div>
                        <div class="species-item">
                            <span style="color: #f97316;">Birds</span>
                            <div class="species-bar"><div class="species-fill" id="birdsBar" style="background: #f97316; width: 100%;"></div></div>
                            <span id="birds">100%</span>
                        </div>
                        <div class="species-item">
                            <span style="color: #ef4444;">Predators</span>
                            <div class="species-bar"><div class="species-fill" id="predatorsBar" style="background: #ef4444; width: 100%;"></div></div>
                            <span id="predators">100%</span>
                        </div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>Tipping Points</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="extinctions">0</div>
                            <div class="stat-label">Extinctions</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="tippingWarning">-</div>
                            <div class="stat-label">Warning Level</div>
                        </div>
                    </div>
                </div>

                <div class="btn-row">
                    <button class="btn btn-primary" id="resetBtn">Restore</button>
                    <button class="btn btn-secondary" id="pauseBtn">Pause</button>
                </div>
            </div>
        </div>

        <div class="info-box">
            <h3>Ecological Tipping Points</h3>
            <p>
                Ecosystems can absorb stress up to a point, then collapse rapidly. Species dependencies
                create cascade effects - when pollinators decline, plants suffer; when plants decline,
                herbivores starve; when prey declines, predators collapse. Once past a tipping point,
                recovery becomes extremely difficult or impossible.
            </p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * window.devicePixelRatio;
            canvas.height = rect.height * window.devicePixelRatio;
            ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        let paused = false;
        let extinctions = 0;

        const params = {
            temperature: 1,
            habitat: 20,
            pollution: 15,
            invasive: 10
        };

        // Species populations (0-100)
        const species = {
            plants: 100,
            insects: 100,
            birds: 100,
            predators: 100
        };

        // Visual creatures
        let creatures = [];

        function initCreatures() {
            creatures = [];
            const width = canvas.width / window.devicePixelRatio;
            const height = canvas.height / window.devicePixelRatio;

            // Plants
            for (let i = 0; i < 50; i++) {
                creatures.push({
                    type: 'plant',
                    x: Math.random() * width,
                    y: height - 50 - Math.random() * 150,
                    size: 10 + Math.random() * 20,
                    health: 100
                });
            }

            // Insects
            for (let i = 0; i < 30; i++) {
                creatures.push({
                    type: 'insect',
                    x: Math.random() * width,
                    y: height - 100 - Math.random() * 200,
                    vx: (Math.random() - 0.5) * 2,
                    vy: (Math.random() - 0.5) * 2,
                    health: 100
                });
            }

            // Birds
            for (let i = 0; i < 15; i++) {
                creatures.push({
                    type: 'bird',
                    x: Math.random() * width,
                    y: 50 + Math.random() * 200,
                    vx: (Math.random() - 0.5) * 3,
                    vy: (Math.random() - 0.5),
                    health: 100
                });
            }

            // Predators
            for (let i = 0; i < 5; i++) {
                creatures.push({
                    type: 'predator',
                    x: Math.random() * width,
                    y: height - 80 - Math.random() * 100,
                    vx: (Math.random() - 0.5) * 1.5,
                    vy: 0,
                    health: 100
                });
            }
        }

        function calculateStress() {
            // Total environmental stress
            return (params.temperature / 6 * 30 +
                    params.habitat / 100 * 30 +
                    params.pollution / 100 * 20 +
                    params.invasive / 100 * 20);
        }

        function updateSpecies() {
            const stress = calculateStress();

            // Temperature affects all species directly
            const tempEffect = Math.pow(params.temperature / 3, 2) * 10;

            // Plants: affected by temperature, habitat, pollution
            const plantStress = tempEffect + params.habitat * 0.5 + params.pollution * 0.3;
            species.plants = Math.max(0, species.plants - plantStress * 0.01 + (100 - species.plants) * 0.005);

            // Insects: depend on plants, affected by pollution
            const insectFood = species.plants / 100;
            const insectStress = tempEffect + params.pollution * 0.5 + params.invasive * 0.3;
            species.insects = Math.max(0, Math.min(100,
                species.insects * insectFood - insectStress * 0.01 + (100 - species.insects) * 0.003));

            // Birds: depend on insects, affected by habitat
            const birdFood = species.insects / 100;
            const birdStress = params.habitat * 0.4 + tempEffect * 0.5;
            species.birds = Math.max(0, Math.min(100,
                species.birds * birdFood - birdStress * 0.01 + (100 - species.birds) * 0.002));

            // Predators: depend on birds and other prey
            const predatorFood = (species.birds + species.insects) / 200;
            const predatorStress = params.habitat * 0.5;
            species.predators = Math.max(0, Math.min(100,
                species.predators * predatorFood - predatorStress * 0.01 + (100 - species.predators) * 0.001));

            // Check for extinctions (below 5%)
            ['plants', 'insects', 'birds', 'predators'].forEach(sp => {
                if (species[sp] < 5 && species[sp] > 0) {
                    species[sp] = 0;
                    extinctions++;
                }
            });
        }

        function updateCreatures() {
            const width = canvas.width / window.devicePixelRatio;
            const height = canvas.height / window.devicePixelRatio;

            creatures.forEach(c => {
                // Remove creatures based on population
                const pop = species[c.type === 'plant' ? 'plants' :
                                    c.type === 'insect' ? 'insects' :
                                    c.type === 'bird' ? 'birds' : 'predators'];

                if (Math.random() > pop / 100) {
                    c.health -= 1;
                } else if (c.health < 100) {
                    c.health += 0.1;
                }

                // Movement for animals
                if (c.type !== 'plant') {
                    c.x += c.vx;
                    c.y += c.vy;

                    // Bounds
                    if (c.x < 0 || c.x > width) c.vx *= -1;
                    if (c.y < 30 || c.y > height - 50) c.vy *= -1;

                    // Random direction changes
                    if (Math.random() < 0.02) {
                        c.vx += (Math.random() - 0.5) * 0.5;
                        c.vy += (Math.random() - 0.5) * 0.5;
                    }
                }
            });

            // Remove dead creatures
            creatures = creatures.filter(c => c.health > 0);

            // Respawn to maintain visual population
            const types = ['plant', 'insect', 'bird', 'predator'];
            types.forEach(type => {
                const pop = species[type === 'plant' ? 'plants' :
                                   type === 'insect' ? 'insects' :
                                   type === 'bird' ? 'birds' : 'predators'];
                const count = creatures.filter(c => c.type === type).length;
                const target = Math.floor(pop * (type === 'plant' ? 0.5 : type === 'predator' ? 0.05 : 0.2));

                if (count < target && Math.random() < 0.1) {
                    const newC = {
                        type: type,
                        x: Math.random() * width,
                        y: type === 'bird' ? 50 + Math.random() * 200 : height - 80 - Math.random() * 150,
                        health: 100
                    };
                    if (type !== 'plant') {
                        newC.vx = (Math.random() - 0.5) * 2;
                        newC.vy = (Math.random() - 0.5);
                    } else {
                        newC.size = 10 + Math.random() * 20;
                    }
                    creatures.push(newC);
                }
            });
        }

        function drawScene() {
            const width = canvas.width / window.devicePixelRatio;
            const height = canvas.height / window.devicePixelRatio;

            // Sky color based on ecosystem health
            const health = (species.plants + species.insects + species.birds + species.predators) / 4;
            const skyR = Math.floor(135 - health * 0.5 + params.pollution * 0.5);
            const skyG = Math.floor(206 - params.pollution * 0.8);
            const skyB = Math.floor(235 - params.temperature * 10);
            ctx.fillStyle = `rgb(${skyR}, ${skyG}, ${skyB})`;
            ctx.fillRect(0, 0, width, height);

            // Ground
            const groundGreen = Math.floor(139 * species.plants / 100);
            ctx.fillStyle = `rgb(${100 - groundGreen / 2}, ${groundGreen}, ${34})`;
            ctx.fillRect(0, height - 50, width, 50);

            // Draw creatures
            creatures.forEach(c => {
                const alpha = c.health / 100;

                if (c.type === 'plant') {
                    ctx.fillStyle = `rgba(34, 197, 94, ${alpha})`;
                    // Simple tree shape
                    ctx.beginPath();
                    ctx.moveTo(c.x, c.y);
                    ctx.lineTo(c.x + c.size / 2, c.y + c.size);
                    ctx.lineTo(c.x - c.size / 2, c.y + c.size);
                    ctx.closePath();
                    ctx.fill();
                    ctx.fillStyle = `rgba(120, 53, 15, ${alpha})`;
                    ctx.fillRect(c.x - 2, c.y + c.size, 4, c.size / 2);
                }

                if (c.type === 'insect') {
                    ctx.fillStyle = `rgba(250, 204, 21, ${alpha})`;
                    ctx.beginPath();
                    ctx.arc(c.x, c.y, 3, 0, Math.PI * 2);
                    ctx.fill();
                }

                if (c.type === 'bird') {
                    ctx.fillStyle = `rgba(249, 115, 22, ${alpha})`;
                    ctx.beginPath();
                    ctx.moveTo(c.x, c.y);
                    ctx.lineTo(c.x - 8, c.y + 3);
                    ctx.lineTo(c.x - 5, c.y);
                    ctx.lineTo(c.x - 8, c.y - 3);
                    ctx.closePath();
                    ctx.fill();
                }

                if (c.type === 'predator') {
                    ctx.fillStyle = `rgba(239, 68, 68, ${alpha})`;
                    ctx.beginPath();
                    ctx.ellipse(c.x, c.y, 12, 8, 0, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(c.x + 10, c.y - 2, 5, 0, Math.PI * 2);
                    ctx.fill();
                }
            });

            // Pollution overlay
            if (params.pollution > 30) {
                ctx.fillStyle = `rgba(100, 100, 80, ${params.pollution / 300})`;
                ctx.fillRect(0, 0, width, height);
            }

            // Warning text
            const stress = calculateStress();
            if (stress > 50) {
                ctx.fillStyle = '#ef4444';
                ctx.font = 'bold 20px system-ui';
                ctx.textAlign = 'center';
                ctx.fillText('⚠ ECOSYSTEM STRESSED', width / 2, 30);
            }
            if (stress > 70) {
                ctx.fillText('⚠ TIPPING POINT APPROACHING', width / 2, 55);
            }
        }

        function updateUI() {
            const health = Math.round((species.plants + species.insects + species.birds + species.predators) / 4);

            document.getElementById('health').textContent = health + '%';
            document.getElementById('health').style.color =
                health > 70 ? '#22c55e' : health > 40 ? '#facc15' : '#ef4444';
            document.getElementById('healthBox').style.background =
                health > 70 ? 'rgba(34, 197, 94, 0.2)' :
                health > 40 ? 'rgba(250, 204, 21, 0.2)' : 'rgba(239, 68, 68, 0.2)';

            document.getElementById('plants').textContent = Math.round(species.plants) + '%';
            document.getElementById('plantsBar').style.width = species.plants + '%';
            document.getElementById('insects').textContent = Math.round(species.insects) + '%';
            document.getElementById('insectsBar').style.width = species.insects + '%';
            document.getElementById('birds').textContent = Math.round(species.birds) + '%';
            document.getElementById('birdsBar').style.width = species.birds + '%';
            document.getElementById('predators').textContent = Math.round(species.predators) + '%';
            document.getElementById('predatorsBar').style.width = species.predators + '%';

            document.getElementById('extinctions').textContent = extinctions;

            const stress = calculateStress();
            const warning = stress > 70 ? 'CRITICAL' : stress > 50 ? 'HIGH' : stress > 30 ? 'MODERATE' : 'LOW';
            document.getElementById('tippingWarning').textContent = warning;
            document.getElementById('tippingWarning').className =
                stress > 70 ? 'stat-value warning' : 'stat-value';
            document.getElementById('tippingWarning').style.color =
                stress > 70 ? '#ef4444' : stress > 50 ? '#f97316' : stress > 30 ? '#facc15' : '#22c55e';
        }

        function animate() {
            if (!paused) {
                updateSpecies();
                updateCreatures();
                drawScene();
                updateUI();
            }
            requestAnimationFrame(animate);
        }

        // Event listeners
        document.getElementById('temperature').addEventListener('input', (e) => {
            params.temperature = parseFloat(e.target.value);
            document.getElementById('temperatureVal').textContent = params.temperature.toFixed(1);
        });

        document.getElementById('habitat').addEventListener('input', (e) => {
            params.habitat = parseInt(e.target.value);
            document.getElementById('habitatVal').textContent = params.habitat;
        });

        document.getElementById('pollution').addEventListener('input', (e) => {
            params.pollution = parseInt(e.target.value);
            document.getElementById('pollutionVal').textContent = params.pollution;
        });

        document.getElementById('invasive').addEventListener('input', (e) => {
            params.invasive = parseInt(e.target.value);
            document.getElementById('invasiveVal').textContent = params.invasive;
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            species.plants = 100;
            species.insects = 100;
            species.birds = 100;
            species.predators = 100;
            extinctions = 0;
            params.temperature = 1;
            params.habitat = 20;
            params.pollution = 15;
            params.invasive = 10;
            document.getElementById('temperature').value = 1;
            document.getElementById('habitat').value = 20;
            document.getElementById('pollution').value = 15;
            document.getElementById('invasive').value = 10;
            document.getElementById('temperatureVal').textContent = '1.0';
            document.getElementById('habitatVal').textContent = '20';
            document.getElementById('pollutionVal').textContent = '15';
            document.getElementById('invasiveVal').textContent = '10';
            initCreatures();
        });

        document.getElementById('pauseBtn').addEventListener('click', () => {
            paused = !paused;
            document.getElementById('pauseBtn').textContent = paused ? 'Resume' : 'Pause';
        });

        initCreatures();
        animate();
    </script>
</body>
</html>
