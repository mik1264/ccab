<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ice-Albedo Effect - Climate/Environment Simulations</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); min-height: 100vh; color: #e2e8f0; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        header { text-align: center; margin-bottom: 30px; }
        .back-link { display: inline-flex; align-items: center; gap: 8px; color: #22c55e; text-decoration: none; font-size: 0.9rem; margin-bottom: 20px; }
        h1 { font-size: 2.5rem; font-weight: 700; color: #22c55e; margin-bottom: 10px; }
        .subtitle { color: #94a3b8; font-size: 1.1rem; }
        .simulation-container { display: grid; grid-template-columns: 1fr 320px; gap: 20px; margin-bottom: 30px; }
        .canvas-wrapper { background: rgba(0, 0, 0, 0.3); border-radius: 16px; padding: 20px; border: 1px solid rgba(34, 197, 94, 0.2); }
        canvas { display: block; width: 100%; height: 500px; border-radius: 8px; background: #0a1628; }
        .controls-panel { background: rgba(0, 0, 0, 0.3); border-radius: 16px; padding: 20px; border: 1px solid rgba(34, 197, 94, 0.2); }
        .control-section { margin-bottom: 20px; }
        .control-section h3 { color: #22c55e; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px; }
        .control-group { margin-bottom: 15px; }
        .control-group label { display: block; color: #94a3b8; font-size: 0.85rem; margin-bottom: 6px; }
        .control-group input[type="range"] { width: 100%; height: 6px; border-radius: 3px; background: #1e293b; outline: none; -webkit-appearance: none; }
        .control-group input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 16px; height: 16px; border-radius: 50%; background: #22c55e; cursor: pointer; }
        .control-value { text-align: right; color: #22c55e; font-size: 0.85rem; font-weight: 600; }
        .albedo-display { text-align: center; padding: 15px; background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(59, 130, 246, 0.1)); border-radius: 12px; margin-bottom: 15px; }
        .albedo-value { font-size: 2.5rem; font-weight: 700; color: #fff; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .stat-item { background: rgba(34, 197, 94, 0.1); padding: 12px; border-radius: 8px; text-align: center; }
        .stat-value { font-size: 1.4rem; font-weight: 700; color: #22c55e; }
        .stat-label { font-size: 0.75rem; color: #94a3b8; margin-top: 4px; }
        .btn-row { display: flex; gap: 10px; margin-top: 15px; }
        .btn { flex: 1; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; }
        .btn-primary { background: #22c55e; color: #1a1a2e; }
        .btn-secondary { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .info-box { background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 12px; padding: 20px; }
        .info-box h3 { color: #22c55e; margin-bottom: 10px; }
        .info-box p { color: #94a3b8; font-size: 0.9rem; line-height: 1.6; }
        @media (max-width: 900px) { .simulation-container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-link"><span>←</span><span>Back to Climate/Environment</span></a>
            <h1>Ice-Albedo Effect</h1>
            <p class="subtitle">Polar ice reflectivity and warming feedback</p>
        </header>

        <div class="simulation-container">
            <div class="canvas-wrapper">
                <canvas id="simCanvas"></canvas>
            </div>

            <div class="controls-panel">
                <div class="albedo-display">
                    <div class="albedo-value" id="albedo">0.30</div>
                    <div style="color: #94a3b8; font-size: 0.9rem;">Global Albedo</div>
                </div>

                <div class="control-section">
                    <h3>Climate Controls</h3>
                    <div class="control-group">
                        <label>Global Temperature</label>
                        <input type="range" id="temperature" min="-5" max="5" value="0" step="0.5">
                        <div class="control-value"><span id="temperatureVal">0</span>°C anomaly</div>
                    </div>
                    <div class="control-group">
                        <label>Solar Intensity</label>
                        <input type="range" id="solar" min="80" max="120" value="100">
                        <div class="control-value"><span id="solarVal">100</span>%</div>
                    </div>
                    <div class="control-group">
                        <label>Time Speed</label>
                        <input type="range" id="timeSpeed" min="1" max="10" value="3">
                        <div class="control-value"><span id="timeSpeedVal">3</span>x</div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>Ice Coverage</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="arcticIce">100</div>
                            <div class="stat-label">Arctic %</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="antarcticIce">100</div>
                            <div class="stat-label">Antarctic %</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="reflected">30</div>
                            <div class="stat-label">Reflected %</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="absorbed">70</div>
                            <div class="stat-label">Absorbed %</div>
                        </div>
                    </div>
                </div>

                <div class="btn-row">
                    <button class="btn btn-primary" id="resetBtn">Reset</button>
                    <button class="btn btn-secondary" id="pauseBtn">Pause</button>
                </div>
            </div>
        </div>

        <div class="info-box">
            <h3>Ice-Albedo Feedback</h3>
            <p>
                Ice and snow reflect 80-90% of incoming sunlight (high albedo), while dark ocean
                absorbs 90%+ (low albedo). As temperatures rise and ice melts, less sunlight is
                reflected, warming accelerates, causing more melting - a positive feedback loop.
                This is one of the strongest climate feedbacks in polar regions.
            </p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * window.devicePixelRatio;
            canvas.height = rect.height * window.devicePixelRatio;
            ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        let paused = false;
        let arcticIce = 100;
        let antarcticIce = 100;
        let solarRays = [];

        const params = {
            temperature: 0,
            solar: 100,
            timeSpeed: 3
        };

        class SolarRay {
            constructor(x, targetY, isReflected) {
                this.x = x;
                this.y = 0;
                this.targetY = targetY;
                this.isReflected = isReflected;
                this.phase = 'incoming'; // incoming, reflecting, absorbed
                this.reflectAngle = (Math.random() - 0.5) * Math.PI / 2;
            }

            update() {
                if (this.phase === 'incoming') {
                    this.y += 4;
                    if (this.y >= this.targetY) {
                        if (this.isReflected) {
                            this.phase = 'reflecting';
                        } else {
                            this.phase = 'absorbed';
                        }
                    }
                } else if (this.phase === 'reflecting') {
                    this.y -= 3;
                    this.x += Math.sin(this.reflectAngle) * 2;
                }
                return this.y > 0 && this.y < canvas.height / window.devicePixelRatio && this.phase !== 'absorbed';
            }

            draw(ctx) {
                ctx.strokeStyle = '#facc15';
                ctx.lineWidth = 2;
                ctx.beginPath();

                if (this.phase === 'incoming') {
                    ctx.moveTo(this.x, this.y - 15);
                    ctx.lineTo(this.x, this.y);
                } else if (this.phase === 'reflecting') {
                    ctx.moveTo(this.x, this.y);
                    ctx.lineTo(this.x - Math.sin(this.reflectAngle) * 15, this.y + 15);
                }
                ctx.stroke();

                // Glow
                ctx.fillStyle = 'rgba(250, 204, 21, 0.5)';
                ctx.beginPath();
                ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function updateIce() {
            const meltRate = params.temperature * 0.5 * params.timeSpeed / 100;

            // Arctic melts faster (less stable)
            arcticIce = Math.max(0, Math.min(100, arcticIce - meltRate * 1.5));

            // Antarctic more stable but still affected
            antarcticIce = Math.max(0, Math.min(100, antarcticIce - meltRate * 0.8));

            // Recovery if cold
            if (params.temperature < -1) {
                arcticIce = Math.min(100, arcticIce - meltRate);
                antarcticIce = Math.min(100, antarcticIce - meltRate);
            }
        }

        function spawnSolarRays() {
            const width = canvas.width / window.devicePixelRatio;
            const height = canvas.height / window.devicePixelRatio;

            if (Math.random() < params.solar / 500) {
                const x = Math.random() * width;
                const latitude = x / width; // 0 = south, 1 = north

                // Determine if landing on ice or water
                let isIce = false;
                let targetY;

                if (latitude < 0.15) {
                    // Antarctic region
                    isIce = Math.random() * 100 < antarcticIce;
                    targetY = height * 0.9;
                } else if (latitude > 0.85) {
                    // Arctic region
                    isIce = Math.random() * 100 < arcticIce;
                    targetY = height * 0.1 + 50;
                } else {
                    // Tropical/temperate - mostly water
                    isIce = false;
                    targetY = height * 0.5;
                }

                // Ice reflects ~85%, water reflects ~6%
                const isReflected = isIce ? Math.random() < 0.85 : Math.random() < 0.06;
                solarRays.push(new SolarRay(x, targetY, isReflected));
            }
        }

        function drawEarth(width, height) {
            // Space background
            ctx.fillStyle = '#0a1628';
            ctx.fillRect(0, 0, width, height);

            // Stars
            ctx.fillStyle = '#fff';
            for (let i = 0; i < 50; i++) {
                const x = (i * 137 + 50) % width;
                const y = (i * 89 + 30) % (height * 0.3);
                ctx.beginPath();
                ctx.arc(x, y, 1, 0, Math.PI * 2);
                ctx.fill();
            }

            // Sun
            ctx.fillStyle = '#facc15';
            ctx.beginPath();
            ctx.arc(width * 0.9, 30, 25, 0, Math.PI * 2);
            ctx.fill();

            // Earth cross-section
            const earthTop = height * 0.08;
            const earthBottom = height * 0.92;
            const earthHeight = earthBottom - earthTop;

            // Arctic ice cap
            const arcticHeight = earthHeight * 0.12 * arcticIce / 100;
            ctx.fillStyle = `rgba(255, 255, 255, ${0.5 + arcticIce / 200})`;
            ctx.fillRect(0, earthTop, width, arcticHeight);

            // Arctic ocean (under melted ice)
            ctx.fillStyle = '#1e3a5f';
            ctx.fillRect(0, earthTop + arcticHeight, width, earthHeight * 0.12 - arcticHeight);

            // Northern temperate
            ctx.fillStyle = '#22c55e';
            ctx.fillRect(0, earthTop + earthHeight * 0.12, width, earthHeight * 0.18);

            // Tropics
            ctx.fillStyle = '#15803d';
            ctx.fillRect(0, earthTop + earthHeight * 0.3, width, earthHeight * 0.15);

            // Ocean
            ctx.fillStyle = '#1e40af';
            ctx.fillRect(0, earthTop + earthHeight * 0.45, width, earthHeight * 0.25);

            // Southern temperate
            ctx.fillStyle = '#22c55e';
            ctx.fillRect(0, earthTop + earthHeight * 0.7, width, earthHeight * 0.15);

            // Antarctic ice cap
            const antarcticHeight = earthHeight * 0.15 * antarcticIce / 100;
            ctx.fillStyle = '#1e3a5f';
            ctx.fillRect(0, earthBottom - earthHeight * 0.15, width, earthHeight * 0.15 - antarcticHeight);
            ctx.fillStyle = `rgba(255, 255, 255, ${0.5 + antarcticIce / 200})`;
            ctx.fillRect(0, earthBottom - antarcticHeight, width, antarcticHeight);

            // Labels
            ctx.fillStyle = '#94a3b8';
            ctx.font = '11px system-ui';
            ctx.textAlign = 'left';
            ctx.fillText('Arctic', 5, earthTop + 20);
            ctx.fillText('Equator', 5, earthTop + earthHeight * 0.45);
            ctx.fillText('Antarctic', 5, earthBottom - 10);

            // Albedo bar
            const globalAlbedo = calculateAlbedo();
            ctx.fillStyle = '#1e293b';
            ctx.fillRect(width - 50, earthTop, 30, earthHeight);
            ctx.fillStyle = '#fff';
            ctx.fillRect(width - 50, earthBottom - earthHeight * globalAlbedo, 30, earthHeight * globalAlbedo);
            ctx.fillStyle = '#94a3b8';
            ctx.font = '10px system-ui';
            ctx.textAlign = 'center';
            ctx.fillText('Albedo', width - 35, earthBottom + 15);
        }

        function calculateAlbedo() {
            // Weighted average: ~10% Arctic, ~70% temperate/tropical, ~20% Antarctic
            const arcticAlbedo = 0.1 * (0.9 * arcticIce / 100 + 0.06 * (100 - arcticIce) / 100);
            const middleAlbedo = 0.7 * 0.15; // Mix of land/ocean
            const antarcticAlbedo = 0.2 * (0.9 * antarcticIce / 100 + 0.06 * (100 - antarcticIce) / 100);

            return arcticAlbedo + middleAlbedo + antarcticAlbedo;
        }

        function updateStats() {
            const albedo = calculateAlbedo();
            document.getElementById('albedo').textContent = albedo.toFixed(2);
            document.getElementById('arcticIce').textContent = Math.round(arcticIce);
            document.getElementById('antarcticIce').textContent = Math.round(antarcticIce);
            document.getElementById('reflected').textContent = Math.round(albedo * 100);
            document.getElementById('absorbed').textContent = Math.round((1 - albedo) * 100);
        }

        function animate() {
            if (!paused) {
                const width = canvas.width / window.devicePixelRatio;
                const height = canvas.height / window.devicePixelRatio;

                drawEarth(width, height);

                updateIce();
                spawnSolarRays();

                solarRays = solarRays.filter(ray => {
                    const active = ray.update();
                    if (active) ray.draw(ctx);
                    return active;
                });

                if (solarRays.length > 100) solarRays = solarRays.slice(-80);

                updateStats();
            }
            requestAnimationFrame(animate);
        }

        // Event listeners
        document.getElementById('temperature').addEventListener('input', (e) => {
            params.temperature = parseFloat(e.target.value);
            document.getElementById('temperatureVal').textContent = params.temperature > 0 ? '+' + params.temperature : params.temperature;
        });

        document.getElementById('solar').addEventListener('input', (e) => {
            params.solar = parseInt(e.target.value);
            document.getElementById('solarVal').textContent = params.solar;
        });

        document.getElementById('timeSpeed').addEventListener('input', (e) => {
            params.timeSpeed = parseInt(e.target.value);
            document.getElementById('timeSpeedVal').textContent = params.timeSpeed;
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            arcticIce = 100;
            antarcticIce = 100;
            params.temperature = 0;
            document.getElementById('temperature').value = 0;
            document.getElementById('temperatureVal').textContent = 0;
        });

        document.getElementById('pauseBtn').addEventListener('click', () => {
            paused = !paused;
            document.getElementById('pauseBtn').textContent = paused ? 'Resume' : 'Pause';
        });

        animate();
    </script>
</body>
</html>
