<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Perspective - Jensen Linkage - CCAB</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: linear-gradient(180deg, #2c3e50 0%, #1a252f 100%);
        }
        #canvas { display: block; }
        .back-link {
            position: fixed;
            top: 10px;
            left: 10px;
            padding: 8px 16px;
            background: rgba(0, 0, 0, 0.7);
            color: #fbbf24;
            text-decoration: none;
            border-radius: 6px;
            font-size: 14px;
            z-index: 999;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Gallery</a>
    <canvas id="canvas"></canvas>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resize();
        window.addEventListener('resize', resize);

        const linkage = {
            crankLength: 45,
            upperLeg: 125,
            lowerLeg: 125,
            connectingRod: 100,
            crankPivotX: 32,
            crankPivotY: -20
        };

        let angle = 0;
        let viewAngle = 0;

        function solveJensen(angle) {
            const l = linkage;
            const crankX = l.crankPivotX + Math.cos(angle) * l.crankLength;
            const crankY = l.crankPivotY + Math.sin(angle) * l.crankLength;
            const d = Math.sqrt(crankX * crankX + crankY * crankY);

            if (d > l.upperLeg + l.connectingRod) return null;

            const cosa = (l.upperLeg * l.upperLeg + d * d - l.connectingRod * l.connectingRod) / (2 * l.upperLeg * d);
            const kneeAngle = Math.atan2(crankY, crankX) - Math.acos(Math.max(-1, Math.min(1, cosa)));
            const kneeX = Math.cos(kneeAngle) * l.upperLeg;
            const kneeY = Math.sin(kneeAngle) * l.upperLeg;
            const legAngle = Math.atan2(kneeY, kneeX);
            const footX = kneeX + Math.cos(legAngle + 0.25) * l.lowerLeg;
            const footY = kneeY + Math.sin(legAngle + 0.25) * l.lowerLeg;

            return {
                crankPivot: { x: l.crankPivotX, y: l.crankPivotY, z: 0 },
                crank: { x: crankX, y: crankY, z: 0 },
                knee: { x: kneeX, y: kneeY, z: 0 },
                foot: { x: footX, y: footY, z: 0 },
                hip: { x: 0, y: 0, z: 0 }
            };
        }

        function project(point, depth) {
            const scale = 1 / (1 + depth * 0.002);
            const cos = Math.cos(viewAngle);
            const sin = Math.sin(viewAngle);

            const x3d = point.x * cos - (point.z || 0) * sin;
            const z3d = point.x * sin + (point.z || 0) * cos;

            return {
                x: x3d * scale,
                y: point.y * scale,
                z: z3d,
                scale: scale
            };
        }

        function draw3DLink(p1, p2, width, color, depth) {
            const proj1 = project(p1, depth);
            const proj2 = project(p2, depth);

            // Shadow
            ctx.strokeStyle = 'rgba(0, 0, 0, 0.3)';
            ctx.lineWidth = width * 1.2;
            ctx.lineCap = 'round';
            ctx.beginPath();
            ctx.moveTo(proj1.x + 5, proj1.y + 5);
            ctx.lineTo(proj2.x + 5, proj2.y + 5);
            ctx.stroke();

            // Main link
            ctx.strokeStyle = color;
            ctx.lineWidth = width;
            ctx.beginPath();
            ctx.moveTo(proj1.x, proj1.y);
            ctx.lineTo(proj2.x, proj2.y);
            ctx.stroke();

            // Highlight
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.lineWidth = width / 3;
            ctx.beginPath();
            ctx.moveTo(proj1.x - 1, proj1.y - 1);
            ctx.lineTo(proj2.x - 1, proj2.y - 1);
            ctx.stroke();
        }

        function draw3DJoint(point, radius, color, depth) {
            const proj = project(point, depth);

            // Shadow
            ctx.beginPath();
            ctx.arc(proj.x + 4, proj.y + 4, radius * proj.scale, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(0, 0, 0, 0.4)';
            ctx.fill();

            // Main
            const gradient = ctx.createRadialGradient(
                proj.x - radius / 3, proj.y - radius / 3, 0,
                proj.x, proj.y, radius * proj.scale
            );
            gradient.addColorStop(0, '#fff');
            gradient.addColorStop(0.3, color);
            gradient.addColorStop(1, '#333');

            ctx.beginPath();
            ctx.arc(proj.x, proj.y, radius * proj.scale, 0, Math.PI * 2);
            ctx.fillStyle = gradient;
            ctx.fill();
        }

        function animate() {
            ctx.fillStyle = 'rgba(44, 62, 80, 0.3)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;

            const p = solveJensen(angle);
            if (p) {
                ctx.save();
                ctx.translate(centerX, centerY);

                // Draw floor grid
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.lineWidth = 1;
                const groundY = 200;
                for (let x = -300; x <= 300; x += 50) {
                    ctx.beginPath();
                    ctx.moveTo(x * Math.cos(viewAngle), groundY);
                    ctx.lineTo(x * Math.cos(viewAngle), groundY + 100);
                    ctx.stroke();
                }

                // Draw linkage with depth
                const depth = 0;

                // Frame
                draw3DLink(p.hip, p.crankPivot, 6, '#5d6d7e', depth);

                // Crank
                draw3DLink(p.crankPivot, p.crank, 8, '#7f8c8d', depth);

                // Connecting rod
                draw3DLink(p.crank, p.knee, 6, '#95a5a6', depth);

                // Upper leg
                draw3DLink(p.hip, p.knee, 10, '#3498db', depth);

                // Lower leg
                draw3DLink(p.knee, p.foot, 10, '#2980b9', depth);

                // Joints
                draw3DJoint(p.hip, 12, '#2c3e50', depth);
                draw3DJoint(p.crankPivot, 10, '#34495e', depth);
                draw3DJoint(p.crank, 8, '#7f8c8d', depth);
                draw3DJoint(p.knee, 11, '#3498db', depth);
                draw3DJoint(p.foot, 12, '#e74c3c', depth);

                ctx.restore();
            }

            angle += 0.025;
            viewAngle = Math.sin(angle * 0.3) * 0.4;
            requestAnimationFrame(animate);
        }

        animate();
    </script>
</body>
</html>
