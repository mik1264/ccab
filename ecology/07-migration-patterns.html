<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Migration Patterns | Ecology</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a2e1a 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            overflow: hidden;
        }
        #canvas { display: block; }
        .controls {
            position: fixed;
            top: 20px; right: 20px;
            background: rgba(0,0,0,0.85);
            padding: 20px; border-radius: 15px;
            min-width: 280px;
            border: 1px solid rgba(100, 200, 100, 0.3);
        }
        h1 { color: #64c896; font-size: 1.3em; margin-bottom: 15px; }
        .control-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; color: #aaa; font-size: 0.9em; }
        input[type="range"], select { width: 100%; }
        select { padding: 8px; border-radius: 5px; background: #333; color: #fff; border: none; }
        .value { float: right; color: #64c896; }
        button {
            width: 100%; padding: 10px; margin: 5px 0;
            border: none; border-radius: 8px;
            background: #64c896; color: #1a2e1a;
            font-weight: bold; cursor: pointer;
        }
        button:hover { background: #88d8b0; }
        .stats { margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); }
        .stat-row { display: flex; justify-content: space-between; padding: 5px 0; font-size: 0.9em; }
        .stat-label { color: #888; }
        .stat-value { color: #64c896; font-weight: bold; }
        .info { font-size: 0.8em; color: #666; margin-top: 15px; line-height: 1.5; }
        a.back-link {
            position: fixed; top: 20px; left: 20px;
            color: #64c896; text-decoration: none;
            background: rgba(0,0,0,0.8); padding: 10px 20px;
            border-radius: 25px; font-size: 0.9em;
        }
        .season-indicator {
            background: #222; padding: 10px; border-radius: 8px;
            margin: 10px 0; text-align: center; font-size: 1.2em;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <a href="index.html" class="back-link">‚Üê Back to Ecology</a>

    <div class="controls">
        <h1>Migration Patterns</h1>
        <p style="font-size:0.85em; color:#888; margin-bottom:15px;">Seasonal animal migration</p>

        <div class="season-indicator" id="seasonDisplay">
            üå∏ Spring
        </div>

        <div class="control-group">
            <label>Flock Size: <span class="value" id="flockValue">100</span></label>
            <input type="range" id="flockSize" min="20" max="300" step="10" value="100">
        </div>

        <div class="control-group">
            <label>Speed: <span class="value" id="speedValue">1.0</span></label>
            <input type="range" id="speed" min="0.5" max="3" step="0.1" value="1.0">
        </div>

        <div class="control-group">
            <label>Cohesion: <span class="value" id="cohesionValue">0.5</span></label>
            <input type="range" id="cohesion" min="0" max="1" step="0.1" value="0.5">
        </div>

        <div class="control-group">
            <label>Migration Trigger:</label>
            <select id="trigger">
                <option value="temperature">Temperature</option>
                <option value="daylight">Day Length</option>
                <option value="both">Both</option>
            </select>
        </div>

        <button id="resetBtn">Reset Migration</button>
        <button id="pauseBtn" style="background:#444;color:#fff">Pause</button>

        <div class="stats">
            <div class="stat-row">
                <span class="stat-label">Day of Year</span>
                <span class="stat-value" id="dayOfYear">1</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Temperature</span>
                <span class="stat-value" id="temperature">20¬∞C</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Migration Status</span>
                <span class="stat-value" id="status">Idle</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Distance Traveled</span>
                <span class="stat-value" id="distance">0 km</span>
            </div>
        </div>

        <div class="info">
            <strong>Birds migrate</strong> seasonally in response to temperature and day length changes.<br>
            Watch V-formation flocking behavior during migration.
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resize();
        window.onresize = resize;

        let flockSize = 100;
        let speedMult = 1.0;
        let cohesionFactor = 0.5;
        let trigger = 'temperature';

        let birds = [];
        let dayOfYear = 80; // Start in spring
        let running = true;
        let totalDistance = 0;

        // Regions
        const regions = {
            summer: { y: 100, label: 'Summer Habitat (North)' },
            winter: { y: 0, label: 'Winter Habitat (South)' }
        };

        function initBirds() {
            birds = [];
            const startY = canvas.height - 200;

            for (let i = 0; i < flockSize; i++) {
                birds.push({
                    x: canvas.width / 2 - 200 + Math.random() * 400,
                    y: startY + Math.random() * 100,
                    vx: 0,
                    vy: 0,
                    phase: Math.random() * Math.PI * 2
                });
            }

            totalDistance = 0;
        }

        function getTemperature() {
            // Sinusoidal temperature variation
            // Peak (summer) around day 182, trough (winter) around day 1
            const amplitude = 20;
            const baseline = 10;
            return baseline + amplitude * Math.sin((dayOfYear - 80) * Math.PI / 182);
        }

        function getDayLength() {
            // Hours of daylight
            const amplitude = 6;
            const baseline = 12;
            return baseline + amplitude * Math.sin((dayOfYear - 80) * Math.PI / 182);
        }

        function getSeason() {
            if (dayOfYear >= 60 && dayOfYear < 152) return 'Spring';
            if (dayOfYear >= 152 && dayOfYear < 244) return 'Summer';
            if (dayOfYear >= 244 && dayOfYear < 335) return 'Fall';
            return 'Winter';
        }

        function getSeasonEmoji() {
            const season = getSeason();
            switch (season) {
                case 'Spring': return 'üå∏';
                case 'Summer': return '‚òÄÔ∏è';
                case 'Fall': return 'üçÇ';
                case 'Winter': return '‚ùÑÔ∏è';
            }
        }

        function shouldMigrateNorth() {
            const temp = getTemperature();
            const dayLen = getDayLength();

            switch (trigger) {
                case 'temperature': return temp > 10;
                case 'daylight': return dayLen > 13;
                case 'both': return temp > 10 && dayLen > 13;
            }
        }

        function getMigrationTarget() {
            if (shouldMigrateNorth()) {
                return { x: canvas.width / 2, y: 200 };
            } else {
                return { x: canvas.width / 2, y: canvas.height - 200 };
            }
        }

        function updateBirds() {
            if (!running) return;

            const target = getMigrationTarget();
            const centerX = birds.reduce((s, b) => s + b.x, 0) / birds.length;
            const centerY = birds.reduce((s, b) => s + b.y, 0) / birds.length;

            // Calculate leader position (average front bird)
            let leaderY = shouldMigrateNorth() ? Infinity : -Infinity;
            let leaderIdx = 0;
            birds.forEach((b, i) => {
                if (shouldMigrateNorth() ? b.y < leaderY : b.y > leaderY) {
                    leaderY = b.y;
                    leaderIdx = i;
                }
            });
            const leader = birds[leaderIdx];

            for (let i = 0; i < birds.length; i++) {
                const bird = birds[i];
                bird.phase += 0.1;

                // Migration force toward target
                const dx = target.x - bird.x;
                const dy = target.y - bird.y;
                const distToTarget = Math.sqrt(dx * dx + dy * dy);

                let migrationForceX = dx / (distToTarget + 1) * 0.1;
                let migrationForceY = dy / (distToTarget + 1) * 0.1;

                // V-formation: follow leader but stay offset
                if (i !== leaderIdx) {
                    const toLeaderX = leader.x - bird.x;
                    const toLeaderY = leader.y - bird.y;
                    const distToLeader = Math.sqrt(toLeaderX * toLeaderX + toLeaderY * toLeaderY);

                    // Optimal following distance
                    const optimalDist = 30 + (i % 10) * 5;

                    if (distToLeader < optimalDist) {
                        // Too close, spread out
                        bird.vx -= toLeaderX / distToLeader * 0.05;
                        bird.vy -= toLeaderY / distToLeader * 0.05;
                    } else if (distToLeader > optimalDist * 2) {
                        // Too far, catch up
                        bird.vx += toLeaderX / distToLeader * 0.1;
                        bird.vy += toLeaderY / distToLeader * 0.1;
                    }

                    // V-shape offset
                    const side = (i % 2 === 0) ? -1 : 1;
                    const lateralOffset = side * (20 + (i % 5) * 10);
                    bird.vx += (leader.x + lateralOffset - bird.x) * 0.01;
                }

                // Cohesion with flock
                bird.vx += (centerX - bird.x) * 0.001 * cohesionFactor;
                bird.vy += (centerY - bird.y) * 0.001 * cohesionFactor;

                // Migration direction
                bird.vx += migrationForceX * speedMult;
                bird.vy += migrationForceY * speedMult;

                // Separation from nearby birds
                for (let j = 0; j < birds.length; j++) {
                    if (i === j) continue;
                    const other = birds[j];
                    const sepX = bird.x - other.x;
                    const sepY = bird.y - other.y;
                    const sepDist = Math.sqrt(sepX * sepX + sepY * sepY);

                    if (sepDist < 25 && sepDist > 0) {
                        bird.vx += sepX / sepDist * 0.2;
                        bird.vy += sepY / sepDist * 0.2;
                    }
                }

                // Speed limit
                const speed = Math.sqrt(bird.vx * bird.vx + bird.vy * bird.vy);
                const maxSpeed = 4 * speedMult;
                if (speed > maxSpeed) {
                    bird.vx *= maxSpeed / speed;
                    bird.vy *= maxSpeed / speed;
                }

                // Update position
                const prevX = bird.x, prevY = bird.y;
                bird.x += bird.vx;
                bird.y += bird.vy;

                // Track distance
                totalDistance += Math.sqrt((bird.x - prevX) ** 2 + (bird.y - prevY) ** 2) / flockSize;

                // Bounds
                bird.x = Math.max(50, Math.min(canvas.width - 350, bird.x));
                bird.y = Math.max(50, Math.min(canvas.height - 50, bird.y));
            }

            // Advance time
            dayOfYear += 0.1 * speedMult;
            if (dayOfYear >= 365) dayOfYear = 0;
        }

        function updateStats() {
            const temp = getTemperature();
            const dayLen = getDayLength();
            const season = getSeason();

            document.getElementById('seasonDisplay').innerHTML =
                `${getSeasonEmoji()} ${season}`;

            document.getElementById('dayOfYear').textContent = Math.floor(dayOfYear);
            document.getElementById('temperature').textContent = temp.toFixed(1) + '¬∞C';
            document.getElementById('distance').textContent = (totalDistance / 100).toFixed(0) + ' km';

            const status = shouldMigrateNorth() ? 'Migrating North' : 'Migrating South';
            document.getElementById('status').textContent = status;
        }

        function drawBackground() {
            // Sky gradient based on season
            const temp = getTemperature();
            const warmth = (temp + 10) / 40;

            const skyTop = `hsl(${200 + warmth * 20}, 60%, ${20 + warmth * 20}%)`;
            const skyBot = `hsl(${180 + warmth * 40}, 50%, ${30 + warmth * 20}%)`;

            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, skyTop);
            gradient.addColorStop(1, skyBot);
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Ground/water
            ctx.fillStyle = '#1a3a2a';
            ctx.fillRect(0, canvas.height - 100, canvas.width - 320, 100);

            // Northern habitat indicator
            ctx.fillStyle = 'rgba(100, 200, 100, 0.2)';
            ctx.fillRect(0, 0, canvas.width - 320, 300);
            ctx.fillStyle = '#fff';
            ctx.font = '14px sans-serif';
            ctx.fillText('Summer Breeding Grounds (North)', 50, 30);

            // Southern habitat indicator
            ctx.fillStyle = 'rgba(255, 180, 100, 0.2)';
            ctx.fillRect(0, canvas.height - 300, canvas.width - 320, 200);
            ctx.fillText('Winter Habitat (South)', 50, canvas.height - 120);
        }

        function drawBird(x, y, vx, vy, phase) {
            ctx.save();
            ctx.translate(x, y);

            // Rotate based on direction
            const angle = Math.atan2(vy, vx);
            ctx.rotate(angle);

            // Wing flapping
            const flapAngle = Math.sin(phase * 3) * 0.4;

            // Body
            ctx.beginPath();
            ctx.moveTo(10, 0);
            ctx.lineTo(-8, 3);
            ctx.lineTo(-8, -3);
            ctx.closePath();
            ctx.fillStyle = '#333';
            ctx.fill();

            // Wings
            ctx.save();
            ctx.rotate(flapAngle);
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.lineTo(-5, -12);
            ctx.lineTo(-8, 0);
            ctx.closePath();
            ctx.fillStyle = '#444';
            ctx.fill();
            ctx.restore();

            ctx.save();
            ctx.rotate(-flapAngle);
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.lineTo(-5, 12);
            ctx.lineTo(-8, 0);
            ctx.closePath();
            ctx.fill();
            ctx.restore();

            ctx.restore();
        }

        function drawTemperatureGauge() {
            const gaugeX = canvas.width - 650;
            const gaugeY = 100;
            const gaugeH = 200;

            ctx.fillStyle = 'rgba(0,0,0,0.5)';
            ctx.fillRect(gaugeX - 10, gaugeY - 30, 80, gaugeH + 60);

            ctx.fillStyle = '#fff';
            ctx.font = '12px sans-serif';
            ctx.fillText('Temp', gaugeX + 10, gaugeY - 10);

            // Gauge background
            const gradient = ctx.createLinearGradient(0, gaugeY, 0, gaugeY + gaugeH);
            gradient.addColorStop(0, '#ff6464');
            gradient.addColorStop(0.5, '#ffd700');
            gradient.addColorStop(1, '#64c8ff');
            ctx.fillStyle = gradient;
            ctx.fillRect(gaugeX, gaugeY, 30, gaugeH);

            // Current temperature indicator
            const temp = getTemperature();
            const tempY = gaugeY + gaugeH - ((temp + 10) / 40) * gaugeH;
            ctx.fillStyle = '#fff';
            ctx.fillRect(gaugeX - 5, tempY - 2, 40, 4);
            ctx.fillText(temp.toFixed(1) + '¬∞C', gaugeX + 35, tempY + 4);

            // Migration threshold
            ctx.strokeStyle = 'rgba(255,255,255,0.5)';
            ctx.setLineDash([5, 5]);
            const threshY = gaugeY + gaugeH - ((10 + 10) / 40) * gaugeH;
            ctx.beginPath();
            ctx.moveTo(gaugeX, threshY);
            ctx.lineTo(gaugeX + 30, threshY);
            ctx.stroke();
            ctx.setLineDash([]);
        }

        function drawDaylightGauge() {
            const gaugeX = canvas.width - 560;
            const gaugeY = 100;
            const gaugeH = 200;

            ctx.fillStyle = 'rgba(0,0,0,0.5)';
            ctx.fillRect(gaugeX - 10, gaugeY - 30, 80, gaugeH + 60);

            ctx.fillStyle = '#fff';
            ctx.font = '12px sans-serif';
            ctx.fillText('Daylight', gaugeX, gaugeY - 10);

            // Gauge background
            const gradient = ctx.createLinearGradient(0, gaugeY, 0, gaugeY + gaugeH);
            gradient.addColorStop(0, '#ffd700');
            gradient.addColorStop(1, '#1a1a4e');
            ctx.fillStyle = gradient;
            ctx.fillRect(gaugeX, gaugeY, 30, gaugeH);

            // Current daylight indicator
            const dayLen = getDayLength();
            const dayY = gaugeY + gaugeH - ((dayLen - 6) / 12) * gaugeH;
            ctx.fillStyle = '#fff';
            ctx.fillRect(gaugeX - 5, dayY - 2, 40, 4);
            ctx.fillText(dayLen.toFixed(1) + 'h', gaugeX + 35, dayY + 4);
        }

        function draw() {
            drawBackground();
            updateBirds();
            updateStats();

            // Draw birds
            for (const bird of birds) {
                drawBird(bird.x, bird.y, bird.vx, bird.vy, bird.phase);
            }

            // Draw flock center indicator
            const centerX = birds.reduce((s, b) => s + b.x, 0) / birds.length;
            const centerY = birds.reduce((s, b) => s + b.y, 0) / birds.length;
            ctx.beginPath();
            ctx.arc(centerX, centerY, 5, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(255, 215, 0, 0.5)';
            ctx.fill();

            drawTemperatureGauge();
            drawDaylightGauge();

            requestAnimationFrame(draw);
        }

        // Event listeners
        document.getElementById('flockSize').oninput = (e) => {
            flockSize = parseInt(e.target.value);
            document.getElementById('flockValue').textContent = flockSize;
            initBirds();
        };

        document.getElementById('speed').oninput = (e) => {
            speedMult = parseFloat(e.target.value);
            document.getElementById('speedValue').textContent = speedMult.toFixed(1);
        };

        document.getElementById('cohesion').oninput = (e) => {
            cohesionFactor = parseFloat(e.target.value);
            document.getElementById('cohesionValue').textContent = cohesionFactor.toFixed(1);
        };

        document.getElementById('trigger').onchange = (e) => {
            trigger = e.target.value;
        };

        document.getElementById('resetBtn').onclick = () => {
            dayOfYear = 80;
            initBirds();
        };

        document.getElementById('pauseBtn').onclick = () => {
            running = !running;
            document.getElementById('pauseBtn').textContent = running ? 'Pause' : 'Resume';
        };

        // Initialize
        initBirds();
        draw();
    </script>
</body>
</html>
