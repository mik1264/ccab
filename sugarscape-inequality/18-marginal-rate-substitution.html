<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marginal Rate of Substitution</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #A8EDEA 0%, #FED6E3 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            color: #2C3E50;
        }
        h1 {
            margin: 0 0 10px 0;
            font-size: 28px;
            text-align: center;
        }
        .subtitle {
            text-align: center;
            margin-bottom: 20px;
        }
        canvas {
            border: 2px solid #2C3E50;
            border-radius: 10px;
            background: white;
        }
        .info {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            max-width: 600px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .formula {
            font-family: 'Courier New', monospace;
            background: #ECF0F1;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-size: 16px;
            text-align: center;
            color: #2C3E50;
        }
        .controls {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .slider-group {
            margin: 15px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input[type="range"] {
            width: 100%;
        }
    </style>
</head>
<body>
    <h1>Marginal Rate of Substitution</h1>
    <p class="subtitle">MRS = (m₁/m₂) × (spice/sugar) - The trade-off ratio between resources</p>

    <div class="controls">
        <div class="slider-group">
            <label>
                Sugar Holdings: <span id="sugarVal">15</span>
            </label>
            <input type="range" id="sugarSlider" min="1" max="50" value="15">
        </div>

        <div class="slider-group">
            <label>
                Spice Holdings: <span id="spiceVal">15</span>
            </label>
            <input type="range" id="spiceSlider" min="1" max="50" value="15">
        </div>

        <div class="slider-group">
            <label>
                Sugar Metabolism (m₁): <span id="m1Val">2</span>
            </label>
            <input type="range" id="m1Slider" min="1" max="5" value="2" step="0.5">
        </div>

        <div class="slider-group">
            <label>
                Spice Metabolism (m₂): <span id="m2Val">2</span>
            </label>
            <input type="range" id="m2Slider" min="1" max="5" value="2" step="0.5">
        </div>
    </div>

    <canvas id="canvas"></canvas>

    <div class="info">
        <h3>Current MRS Value</h3>
        <div class="formula">
            MRS = (<span id="m1Display">2</span>/<span id="m2Display">2</span>) × (<span id="spiceDisplay">15</span>/<span id="sugarDisplay">15</span>) = <span id="mrsValue" style="font-size: 24px; font-weight: bold;">1.00</span>
        </div>

        <p style="font-size: 14px;">
            <strong>Interpretation:</strong> An agent with MRS = <span id="mrsInterp">1.00</span> is willing to trade <span id="tradeInterp">1 spice for 1 sugar</span>. Trade occurs when two agents have different MRS values - one values sugar more (high MRS), the other values spice more (low MRS).
        </p>

        <p style="font-size: 12px; margin-top: 15px;">
            <strong>Price determination:</strong> When agents with MRS₁ and MRS₂ trade, the price is P = √(MRS₁ × MRS₂) (geometric mean), ensuring Pareto-improving exchanges.
        </p>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 600;
        canvas.height = 500;

        let sugar = 15;
        let spice = 15;
        let m1 = 2;
        let m2 = 2;

        function calculateMRS() {
            if (sugar === 0) return Infinity;
            return (m1 / m2) * (spice / sugar);
        }

        function drawIndifferenceCurves() {
            ctx.fillStyle = '#f8f9fa';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const margin = 60;
            const width = canvas.width - 2 * margin;
            const height = canvas.height - 2 * margin;

            // Draw axes
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(margin, margin);
            ctx.lineTo(margin, margin + height);
            ctx.lineTo(margin + width, margin + height);
            ctx.stroke();

            // Current welfare level
            const currentWelfare = Math.pow(sugar, m1 / (m1 + m2)) * Math.pow(spice, m2 / (m1 + m2));

            // Draw multiple indifference curves
            const welfares = [currentWelfare * 0.5, currentWelfare * 0.75, currentWelfare, currentWelfare * 1.5, currentWelfare * 2];

            welfares.forEach((welfare, idx) => {
                ctx.strokeStyle = idx === 2 ? '#E74C3C' : '#BDC3C7';
                ctx.lineWidth = idx === 2 ? 3 : 1;
                ctx.beginPath();

                let started = false;
                for (let s = 1; s <= 50; s += 0.5) {
                    // Calculate spice needed for this welfare level at sugar = s
                    const sp = Math.pow(welfare / Math.pow(s, m1 / (m1 + m2)), (m1 + m2) / m2);

                    if (sp > 0 && sp <= 50) {
                        const x = margin + (s / 50) * width;
                        const y = margin + height - (sp / 50) * height;

                        if (!started) {
                            ctx.moveTo(x, y);
                            started = true;
                        } else {
                            ctx.lineTo(x, y);
                        }
                    }
                }

                ctx.stroke();
            });

            // Draw current bundle point
            const x = margin + (sugar / 50) * width;
            const y = margin + height - (spice / 50) * height;

            ctx.fillStyle = '#E74C3C';
            ctx.beginPath();
            ctx.arc(x, y, 8, 0, Math.PI * 2);
            ctx.fill();

            ctx.strokeStyle = '#C0392B';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(x, y, 8, 0, Math.PI * 2);
            ctx.stroke();

            // Draw MRS tangent line
            const mrs = calculateMRS();
            if (isFinite(mrs)) {
                ctx.strokeStyle = '#3498DB';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);

                // Tangent line: slope = -MRS
                const dx = 10;
                const dy = -mrs * dx;

                const x1 = x - dx * 10;
                const y1 = y - dy * 10;
                const x2 = x + dx * 10;
                const y2 = y + dy * 10;

                ctx.beginPath();
                ctx.moveTo(Math.max(margin, x1), y1);
                ctx.lineTo(Math.min(margin + width, x2), y2);
                ctx.stroke();
                ctx.setLineDash([]);
            }

            // Labels
            ctx.fillStyle = '#000';
            ctx.font = '14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Sugar Holdings', margin + width / 2, margin + height + 45);

            ctx.save();
            ctx.translate(20, margin + height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('Spice Holdings', 0, 0);
            ctx.restore();

            // Title
            ctx.font = 'bold 16px Arial';
            ctx.fillText('Indifference Curves & MRS', margin + width / 2, 30);

            // Legend
            ctx.font = '12px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('Current bundle', margin + 20, 60);
            ctx.fillStyle = '#E74C3C';
            ctx.beginPath();
            ctx.arc(margin + 120, 56, 5, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = '#000';
            ctx.fillText('MRS tangent', margin + 20, 80);
            ctx.strokeStyle = '#3498DB';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(margin + 100, 76);
            ctx.lineTo(margin + 140, 76);
            ctx.stroke();
            ctx.setLineDash([]);
        }

        function updateDisplay() {
            const mrs = calculateMRS();

            document.getElementById('sugarVal').textContent = sugar;
            document.getElementById('spiceVal').textContent = spice;
            document.getElementById('m1Val').textContent = m1;
            document.getElementById('m2Val').textContent = m2;

            document.getElementById('sugarDisplay').textContent = sugar;
            document.getElementById('spiceDisplay').textContent = spice;
            document.getElementById('m1Display').textContent = m1;
            document.getElementById('m2Display').textContent = m2;

            document.getElementById('mrsValue').textContent = isFinite(mrs) ? mrs.toFixed(2) : '∞';
            document.getElementById('mrsInterp').textContent = isFinite(mrs) ? mrs.toFixed(2) : '∞';

            if (isFinite(mrs)) {
                document.getElementById('tradeInterp').textContent =
                    `${mrs.toFixed(2)} spice for 1 sugar (or 1 spice for ${(1/mrs).toFixed(2)} sugar)`;
            } else {
                document.getElementById('tradeInterp').textContent = 'infinite spice for sugar';
            }

            drawIndifferenceCurves();
        }

        document.getElementById('sugarSlider').addEventListener('input', (e) => {
            sugar = parseInt(e.target.value);
            updateDisplay();
        });

        document.getElementById('spiceSlider').addEventListener('input', (e) => {
            spice = parseInt(e.target.value);
            updateDisplay();
        });

        document.getElementById('m1Slider').addEventListener('input', (e) => {
            m1 = parseFloat(e.target.value);
            updateDisplay();
        });

        document.getElementById('m2Slider').addEventListener('input', (e) => {
            m2 = parseFloat(e.target.value);
            updateDisplay();
        });

        updateDisplay();
    </script>
</body>
</html>
