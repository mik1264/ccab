<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chaotic Double Pendulum</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            overflow: hidden;
            background: #0f0f1e;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        canvas {
            display: block;
        }
        .info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border-radius: 10px;
            color: white;
            max-width: 300px;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }
        button:hover {
            background: #764ba2;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div class="info">
        <h2>Double Pendulum</h2>
        <p>A classic example of chaos - tiny changes in starting position lead to vastly different outcomes.</p>
        <button id="reset">Reset</button>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const g = 9.81;
        let m1 = 10, m2 = 10;
        let l1 = 150, l2 = 150;

        let a1 = Math.PI / 2;
        let a2 = Math.PI / 2;
        let a1_v = 0;
        let a2_v = 0;

        let trail = [];
        const trailLength = 500;

        document.getElementById('reset').addEventListener('click', () => {
            a1 = Math.PI / 2 + (Math.random() - 0.5) * 0.1;
            a2 = Math.PI / 2 + (Math.random() - 0.5) * 0.1;
            a1_v = 0;
            a2_v = 0;
            trail = [];
        });

        function draw() {
            ctx.fillStyle = 'rgba(15, 15, 30, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const cx = canvas.width / 2;
            const cy = canvas.height / 3;

            // Calculate accelerations (from Lagrangian mechanics)
            const num1 = -g * (2 * m1 + m2) * Math.sin(a1);
            const num2 = -m2 * g * Math.sin(a1 - 2 * a2);
            const num3 = -2 * Math.sin(a1 - a2) * m2;
            const num4 = a2_v * a2_v * l2 + a1_v * a1_v * l1 * Math.cos(a1 - a2);
            const den = l1 * (2 * m1 + m2 - m2 * Math.cos(2 * a1 - 2 * a2));
            const a1_a = (num1 + num2 + num3 * num4) / den;

            const num5 = 2 * Math.sin(a1 - a2);
            const num6 = a1_v * a1_v * l1 * (m1 + m2);
            const num7 = g * (m1 + m2) * Math.cos(a1);
            const num8 = a2_v * a2_v * l2 * m2 * Math.cos(a1 - a2);
            const den2 = l2 * (2 * m1 + m2 - m2 * Math.cos(2 * a1 - 2 * a2));
            const a2_a = (num5 * (num6 + num7 + num8)) / den2;

            // Update positions
            const x1 = cx + l1 * Math.sin(a1);
            const y1 = cy + l1 * Math.cos(a1);
            const x2 = x1 + l2 * Math.sin(a2);
            const y2 = y1 + l2 * Math.cos(a2);

            // Add to trail
            trail.push({ x: x2, y: y2 });
            if (trail.length > trailLength) {
                trail.shift();
            }

            // Draw trail
            for (let i = 1; i < trail.length; i++) {
                const alpha = i / trail.length;
                const hue = (i / trail.length) * 360;
                ctx.beginPath();
                ctx.strokeStyle = `hsla(${hue}, 70%, 60%, ${alpha})`;
                ctx.lineWidth = 2;
                ctx.moveTo(trail[i-1].x, trail[i-1].y);
                ctx.lineTo(trail[i].x, trail[i].y);
                ctx.stroke();
            }

            // Draw pendulum arms
            ctx.strokeStyle = 'rgba(102, 126, 234, 0.8)';
            ctx.lineWidth = 4;

            ctx.beginPath();
            ctx.moveTo(cx, cy);
            ctx.lineTo(x1, y1);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.stroke();

            // Draw masses
            ctx.fillStyle = '#667eea';
            ctx.beginPath();
            ctx.arc(x1, y1, 15, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = '#764ba2';
            ctx.beginPath();
            ctx.arc(x2, y2, 15, 0, Math.PI * 2);
            ctx.fill();

            // Draw pivot
            ctx.fillStyle = '#fff';
            ctx.beginPath();
            ctx.arc(cx, cy, 5, 0, Math.PI * 2);
            ctx.fill();

            // Update velocities and angles
            a1_v += a1_a * 0.01;
            a2_v += a2_a * 0.01;
            a1 += a1_v * 0.01;
            a2 += a2_v * 0.01;

            // Damping
            a1_v *= 0.999;
            a2_v *= 0.999;
        }

        function animate() {
            draw();
            requestAnimationFrame(animate);
        }

        // Expose for enhance.js keyboard shortcuts
        window.reset = function() { trail = []; };
        window.init = window.reset;

        animate();

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            trail = [];
        });
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>