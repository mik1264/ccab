<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tradition Formation - NetLogo Simulation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
            color: #e0e0e0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: #ff5722;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 20px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
        }

        .simulation-area {
            background: #1e1e2e;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .canvas-container {
            position: relative;
            width: 100%;
            aspect-ratio: 4/3;
            background: #0a0a15;
            border-radius: 10px;
            overflow: hidden;
        }

        canvas {
            width: 100%;
            height: 100%;
        }

        .controls {
            background: #1e1e2e;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .control-section {
            margin-bottom: 20px;
        }

        .control-section h3 {
            color: #ff5722;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 2px solid #ff5722;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            color: #aaa;
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        .control-group input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }

        .control-group .value {
            text-align: right;
            color: #ff5722;
            font-weight: bold;
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        button:hover {
            transform: translateY(-2px);
        }

        #startBtn {
            background: linear-gradient(135deg, #ff5722, #e64a19);
            color: white;
        }

        #resetBtn {
            background: linear-gradient(135deg, #444, #555);
            color: white;
        }

        .stats {
            background: #252535;
            border-radius: 10px;
            padding: 15px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #333;
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #888;
        }

        .stat-value {
            color: #ff5722;
            font-weight: bold;
        }

        .theory-box {
            background: linear-gradient(135deg, #252535, #2a2a3a);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            border-left: 4px solid #ff5722;
        }

        .theory-box h4 {
            color: #ff5722;
            margin-bottom: 10px;
        }

        .theory-box p {
            color: #aaa;
            font-size: 0.85em;
            line-height: 1.6;
        }

        .tradition-list {
            margin-top: 10px;
            max-height: 100px;
            overflow-y: auto;
        }

        .tradition-item {
            padding: 5px 10px;
            margin: 3px 0;
            border-radius: 5px;
            font-size: 0.8em;
            display: flex;
            justify-content: space-between;
        }
    
        .explain-btn {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
        }
        .explain-btn:hover {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            transform: translateY(-2px);
        }
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.85);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .modal-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 1;
        }
        .modal {
            background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%);
            border-radius: 16px;
            padding: 30px;
            max-width: 700px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
        }
        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: #888;
            font-size: 28px;
            cursor: pointer;
            width: auto;
            padding: 0;
            margin: 0;
        }
        .modal-close:hover {
            color: #fff;
            background: none;
        }
        .modal h2 {
            color: #00d9ff;
            margin-bottom: 20px;
            font-size: 1.5rem;
            padding-right: 40px;
        }
        .modal-body {
            color: #ccc;
            line-height: 1.8;
            font-size: 0.95rem;
        }
        .modal-body h3 {
            color: #00ff88;
            margin: 20px 0 10px 0;
            font-size: 1.1rem;
        }
        .modal-body p {
            margin-bottom: 15px;
        }
        .modal-body ul {
            margin: 10px 0 15px 20px;
        }
        .modal-body li {
            margin-bottom: 8px;
        }
        .modal-body strong {
            color: #00d9ff;
        }
        .modal-body em {
            color: #a5b4fc;
            font-style: normal;
        }
        .modal-body code {
            background: rgba(0,0,0,0.3);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            color: #fbbf24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìú Tradition Formation</h1>
        <p class="subtitle">Cultural Inheritance and Behavioral Variation</p>

        <div class="main-content">
            <div class="simulation-area">
                <div class="canvas-container">
                    <canvas id="simCanvas"></canvas>
                </div>
            </div>

            <div class="controls">
                <div class="control-section">
                    <h3>‚öôÔ∏è Parameters</h3>
                    <div class="control-group">
                        <label>Group Size</label>
                        <input type="range" id="groupSize" min="10" max="30" step="5" value="20">
                        <div class="value"><span id="groupSizeVal">20</span></div>
                    </div>
                    <div class="control-group">
                        <label>Conformity Bias</label>
                        <input type="range" id="conformity" min="0.1" max="0.9" step="0.1" value="0.5">
                        <div class="value"><span id="conformityVal">0.5</span></div>
                    </div>
                    <div class="control-group">
                        <label>Innovation Rate</label>
                        <input type="range" id="innovationRate" min="0.001" max="0.02" step="0.001" value="0.005">
                        <div class="value"><span id="innovationRateVal">0.005</span></div>
                    </div>
                    <div class="control-group">
                        <label>Generation Length</label>
                        <input type="range" id="genLength" min="100" max="500" step="50" value="200">
                        <div class="value"><span id="genLengthVal">200</span></div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>üéÆ Controls</h3>
                    <div class="button-group">
                        <button id="startBtn">Start</button>
                        <button id="resetBtn">Reset</button>
            <button id="explainBtn" class="explain-btn">üìö Explain</button>
                    </div>
                </div>

                <div class="control-section">
                    <h3>üìä Statistics</h3>
                    <div class="stats">
                        <div class="stat-row">
                            <span class="stat-label">Generation:</span>
                            <span class="stat-value" id="generation">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Cultural Gen:</span>
                            <span class="stat-value" id="culturalGen">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Distinct Traditions:</span>
                            <span class="stat-value" id="distinctTraditions">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Dominant Tradition:</span>
                            <span class="stat-value" id="dominantTradition">None</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Cultural Diversity:</span>
                            <span class="stat-value" id="diversity">0.00</span>
                        </div>
                    </div>
                    <div class="tradition-list" id="traditionList"></div>
                </div>

                <div class="theory-box">
                    <h4>üìö Cultural Traditions</h4>
                    <p>
                        Traditions emerge when behaviors are socially learned
                        across generations. Conformity bias leads to cultural
                        homogeneity, while innovation introduces variation.
                        Founder effects and drift can establish arbitrary
                        traditions that persist despite no functional advantage.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Simulation state
        let running = false;
        let generation = 0;
        let culturalGeneration = 0;
        let generationTimer = 0;

        // Behavioral domains (traditions can form in each)
        const behaviorDomains = [
            { name: 'Foraging', variants: ['dig', 'probe', 'flip', 'pry'] },
            { name: 'Greeting', variants: ['bow', 'touch', 'vocalize', 'display'] },
            { name: 'Resting', variants: ['ground', 'tree', 'cave', 'water'] },
            { name: 'Movement', variants: ['walk', 'hop', 'climb', 'swim'] }
        ];

        // Population
        let agents = [];
        let traditionHistory = [];

        // Parameters
        function getParams() {
            return {
                groupSize: parseInt(document.getElementById('groupSize').value),
                conformity: parseFloat(document.getElementById('conformity').value),
                innovationRate: parseFloat(document.getElementById('innovationRate').value),
                genLength: parseInt(document.getElementById('genLength').value)
            };
        }

        // Update parameter displays
        document.querySelectorAll('input[type="range"]').forEach(input => {
            input.addEventListener('input', (e) => {
                const valSpan = document.getElementById(e.target.id + 'Val');
                if (valSpan) {
                    valSpan.textContent = e.target.value;
                }
            });
        });

        function initPopulation() {
            agents = [];
            const params = getParams();

            for (let i = 0; i < params.groupSize; i++) {
                const behaviors = {};
                // Random initial behaviors
                for (let domain of behaviorDomains) {
                    behaviors[domain.name] = domain.variants[
                        Math.floor(Math.random() * domain.variants.length)
                    ];
                }

                agents.push({
                    id: i,
                    x: 0.2 + Math.random() * 0.6,
                    y: 0.2 + Math.random() * 0.6,
                    vx: 0,
                    vy: 0,
                    age: Math.floor(Math.random() * params.genLength * 0.8),
                    behaviors: behaviors,
                    generation: 0
                });
            }

            traditionHistory = [];
            culturalGeneration = 0;
            generationTimer = 0;
        }

        function countBehaviors() {
            const counts = {};
            for (let domain of behaviorDomains) {
                counts[domain.name] = {};
                for (let variant of domain.variants) {
                    counts[domain.name][variant] = 0;
                }
            }

            for (let agent of agents) {
                for (let domain in agent.behaviors) {
                    counts[domain][agent.behaviors[domain]]++;
                }
            }

            return counts;
        }

        function getMostCommon(counts, domain) {
            let maxCount = 0;
            let mostCommon = null;

            for (let variant in counts[domain]) {
                if (counts[domain][variant] > maxCount) {
                    maxCount = counts[domain][variant];
                    mostCommon = variant;
                }
            }

            return { variant: mostCommon, count: maxCount };
        }

        function update() {
            if (!running) return;

            generation++;
            generationTimer++;
            const params = getParams();

            // Move agents randomly
            for (let agent of agents) {
                agent.vx += (Math.random() - 0.5) * 0.01;
                agent.vy += (Math.random() - 0.5) * 0.01;

                // Center attraction
                agent.vx += (0.5 - agent.x) * 0.001;
                agent.vy += (0.5 - agent.y) * 0.001;

                const speed = Math.sqrt(agent.vx * agent.vx + agent.vy * agent.vy);
                if (speed > 0.02) {
                    agent.vx = (agent.vx / speed) * 0.02;
                    agent.vy = (agent.vy / speed) * 0.02;
                }

                agent.x += agent.vx;
                agent.y += agent.vy;
                agent.vx *= 0.95;
                agent.vy *= 0.95;

                agent.x = Math.max(0.1, Math.min(0.9, agent.x));
                agent.y = Math.max(0.1, Math.min(0.9, agent.y));

                agent.age++;

                // Innovation
                if (Math.random() < params.innovationRate) {
                    const domain = behaviorDomains[Math.floor(Math.random() * behaviorDomains.length)];
                    const newVariant = domain.variants[Math.floor(Math.random() * domain.variants.length)];
                    if (newVariant !== agent.behaviors[domain.name]) {
                        agent.behaviors[domain.name] = newVariant;
                    }
                }
            }

            // Social learning
            for (let agent of agents) {
                // Find nearby agents to learn from
                const neighbors = agents.filter(other => {
                    if (other === agent) return false;
                    const dx = other.x - agent.x;
                    const dy = other.y - agent.y;
                    return Math.sqrt(dx * dx + dy * dy) < 0.2;
                });

                if (neighbors.length > 0 && Math.random() < 0.01) {
                    const counts = {};

                    // Count behaviors in neighborhood
                    for (let domain of behaviorDomains) {
                        counts[domain.name] = {};
                        for (let neighbor of neighbors) {
                            const behavior = neighbor.behaviors[domain.name];
                            counts[domain.name][behavior] = (counts[domain.name][behavior] || 0) + 1;
                        }
                    }

                    // Conformity-biased learning
                    for (let domain of behaviorDomains) {
                        const mostCommon = getMostCommon(counts, domain.name);
                        if (mostCommon.variant && Math.random() < params.conformity) {
                            agent.behaviors[domain.name] = mostCommon.variant;
                        }
                    }
                }
            }

            // Generation turnover
            if (generationTimer >= params.genLength) {
                generationTimer = 0;
                culturalGeneration++;

                // Record tradition state
                const counts = countBehaviors();
                const snapshot = {};
                for (let domain of behaviorDomains) {
                    snapshot[domain.name] = getMostCommon(counts, domain.name).variant;
                }
                traditionHistory.push(snapshot);
                if (traditionHistory.length > 10) traditionHistory.shift();

                // Age-based replacement
                for (let i = agents.length - 1; i >= 0; i--) {
                    if (agents[i].age > params.genLength) {
                        // Replace with offspring who learns from group
                        const counts = countBehaviors();
                        const newBehaviors = {};

                        for (let domain of behaviorDomains) {
                            // Inherit most common behavior with conformity bias
                            if (Math.random() < params.conformity) {
                                newBehaviors[domain.name] = getMostCommon(counts, domain.name).variant;
                            } else {
                                // Random variant
                                newBehaviors[domain.name] = domain.variants[
                                    Math.floor(Math.random() * domain.variants.length)
                                ];
                            }
                        }

                        agents[i] = {
                            id: agents[i].id,
                            x: 0.3 + Math.random() * 0.4,
                            y: 0.3 + Math.random() * 0.4,
                            vx: 0,
                            vy: 0,
                            age: 0,
                            behaviors: newBehaviors,
                            generation: culturalGeneration
                        };
                    }
                }
            }

            updateStats();
            draw();
            requestAnimationFrame(update);
        }

        function getVariantColor(domain, variant) {
            const domainColors = {
                Foraging: { dig: '#e74c3c', probe: '#3498db', flip: '#2ecc71', pry: '#f39c12' },
                Greeting: { bow: '#9b59b6', touch: '#1abc9c', vocalize: '#e91e63', display: '#00bcd4' },
                Resting: { ground: '#8b4513', tree: '#27ae60', cave: '#7f8c8d', water: '#3498db' },
                Movement: { walk: '#f39c12', hop: '#e74c3c', climb: '#27ae60', swim: '#3498db' }
            };

            return domainColors[domain]?.[variant] || '#666';
        }

        function draw() {
            const w = canvas.width;
            const h = canvas.height;

            ctx.fillStyle = '#0a0a15';
            ctx.fillRect(0, 0, w, h);

            // Draw agents
            for (let agent of agents) {
                const x = w * agent.x;
                const y = h * agent.y;

                // Age indicator (ring)
                const params = getParams();
                const ageRatio = agent.age / params.genLength;
                ctx.strokeStyle = `rgba(255, 87, 34, ${0.3 + ageRatio * 0.5})`;
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(x, y, 18, 0, Math.PI * 2 * ageRatio);
                ctx.stroke();

                // Behavior sectors (pie chart style)
                const numDomains = behaviorDomains.length;
                const sectorAngle = (Math.PI * 2) / numDomains;

                for (let i = 0; i < numDomains; i++) {
                    const domain = behaviorDomains[i];
                    const variant = agent.behaviors[domain.name];
                    const color = getVariantColor(domain.name, variant);

                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.moveTo(x, y);
                    ctx.arc(x, y, 15, i * sectorAngle, (i + 1) * sectorAngle);
                    ctx.closePath();
                    ctx.fill();
                }

                // Border
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.arc(x, y, 15, 0, Math.PI * 2);
                ctx.stroke();
            }

            // Tradition legend
            ctx.fillStyle = 'rgba(30, 30, 50, 0.95)';
            ctx.beginPath();
            ctx.roundRect(w - 180, 10, 170, 180, 10);
            ctx.fill();

            ctx.fillStyle = '#ff5722';
            ctx.font = 'bold 11px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('Current Traditions', w - 170, 28);

            const counts = countBehaviors();
            let yPos = 45;

            for (let domain of behaviorDomains) {
                ctx.fillStyle = '#aaa';
                ctx.font = '10px Arial';
                ctx.fillText(domain.name + ':', w - 170, yPos);

                const mc = getMostCommon(counts, domain.name);
                const color = getVariantColor(domain.name, mc.variant);

                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(w - 80, yPos - 3, 5, 0, Math.PI * 2);
                ctx.fill();

                ctx.fillStyle = '#fff';
                ctx.font = '10px Arial';
                ctx.fillText(`${mc.variant} (${Math.round(mc.count / agents.length * 100)}%)`, w - 70, yPos);

                yPos += 20;
            }

            // Tradition history
            ctx.fillStyle = '#ff5722';
            ctx.font = 'bold 10px Arial';
            ctx.fillText('History:', w - 170, yPos + 10);

            if (traditionHistory.length > 0) {
                const histW = 150;
                const histH = 40;
                const histX = w - 170;
                const histY = yPos + 20;

                for (let i = 0; i < traditionHistory.length; i++) {
                    const snap = traditionHistory[i];
                    const blockW = histW / 10;
                    const x = histX + i * blockW;

                    let j = 0;
                    for (let domain of behaviorDomains) {
                        const color = getVariantColor(domain.name, snap[domain.name]);
                        ctx.fillStyle = color;
                        ctx.fillRect(x, histY + j * (histH / 4), blockW - 1, histH / 4 - 1);
                        j++;
                    }
                }
            }

            // Info panel
            ctx.fillStyle = 'rgba(30, 30, 50, 0.9)';
            ctx.beginPath();
            ctx.roundRect(10, h - 60, 200, 50, 10);
            ctx.fill();

            ctx.fillStyle = '#ff5722';
            ctx.font = 'bold 12px Arial';
            ctx.fillText('Tradition Formation', 20, h - 42);

            ctx.fillStyle = '#aaa';
            ctx.font = '11px Arial';
            const params = getParams();
            ctx.fillText(`Gen ${culturalGeneration} | Progress: ${Math.round(generationTimer / params.genLength * 100)}%`, 20, h - 22);
        }

        function updateStats() {
            const counts = countBehaviors();

            // Count distinct traditions (behaviors with > 30% adoption)
            let distinctCount = 0;
            for (let domain of behaviorDomains) {
                const variants = Object.keys(counts[domain.name]).filter(
                    v => counts[domain.name][v] > agents.length * 0.3
                );
                distinctCount += variants.length;
            }

            // Calculate diversity (Shannon entropy)
            let diversity = 0;
            for (let domain of behaviorDomains) {
                for (let variant in counts[domain.name]) {
                    const p = counts[domain.name][variant] / agents.length;
                    if (p > 0) {
                        diversity -= p * Math.log2(p);
                    }
                }
            }
            diversity /= behaviorDomains.length;

            // Find dominant tradition
            let dominant = '';
            for (let domain of behaviorDomains) {
                const mc = getMostCommon(counts, domain.name);
                if (mc.count > agents.length * 0.7) {
                    dominant += domain.name[0] + ':' + mc.variant.slice(0, 3) + ' ';
                }
            }

            document.getElementById('generation').textContent = generation;
            document.getElementById('culturalGen').textContent = culturalGeneration;
            document.getElementById('distinctTraditions').textContent = distinctCount;
            document.getElementById('dominantTradition').textContent = dominant || 'Mixed';
            document.getElementById('diversity').textContent = diversity.toFixed(2);

            // Update tradition list
            const listEl = document.getElementById('traditionList');
            listEl.innerHTML = behaviorDomains.map(domain => {
                const mc = getMostCommon(counts, domain.name);
                const color = getVariantColor(domain.name, mc.variant);
                return `<div class="tradition-item" style="background: ${color}33; border-left: 3px solid ${color}">
                    <span>${domain.name}</span>
                    <span>${mc.variant} (${Math.round(mc.count / agents.length * 100)}%)</span>
                </div>`;
            }).join('');
        }

        function reset() {
            running = false;
            generation = 0;
            initPopulation();
            updateStats();
            draw();
            document.getElementById('startBtn').textContent = 'Start';
        }

        document.getElementById('startBtn').addEventListener('click', () => {
            running = !running;
            document.getElementById('startBtn').textContent = running ? 'Pause' : 'Start';
            if (running) update();
        });

        document.getElementById('resetBtn').addEventListener('click', reset);

        // Initialize
        initPopulation();
        draw();
    

    // Modal functionality
    const modal = document.getElementById('explainModal');
    if (modal) {
        document.getElementById('explainBtn').addEventListener('click', () => {
            modal.classList.add('active');
        });
        modal.querySelector('.modal-close').addEventListener('click', () => {
            modal.classList.remove('active');
        });
        modal.addEventListener('click', (e) => {
            if (e.target === modal) modal.classList.remove('active');
        });
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modal.classList.contains('active')) {
                modal.classList.remove('active');
            }
        });
    }

    </script>

    <div id="explainModal" class="modal-overlay">
        <div class="modal">
            <button class="modal-close">&times;</button>
            <h2>üìä Tradition Formation</h2>
            <div class="modal-body">
                <p>This agent-based simulation explores concepts from <strong>neural systems and behavioral patterns</strong>.</p>

                <h3>What This Simulation Models</h3>
                <p>Build a behavioral tradition model with intergenerational transmission and cultural evolution.</p>

                <h3>Key Concepts</h3>
                <ul>
                    <li><strong>Agent-Based Modeling:</strong> Individual agents follow simple rules, producing complex emergent behaviors</li>
                    <li><strong>Emergent Properties:</strong> System-level patterns arise from local interactions</li>
                    <li><strong>Parameter Exploration:</strong> Adjust controls to explore different scenarios and outcomes</li>
                </ul>

                <h3>How to Explore</h3>
                <ul>
                    <li>Use the sliders to modify simulation parameters</li>
                    <li>Observe how changes affect the overall system behavior</li>
                    <li>Look for phase transitions and tipping points</li>
                    <li>Consider what real-world phenomena this model might represent</li>
                </ul>

                <h3>Category: Neuroscience & Behavior</h3>
                <p>This simulation is part of the <em>Neuroscience & Behavior</em> collection, which explores various aspects of neural systems and behavioral patterns.</p>
            </div>
        </div>
    </div>

</body>
</html>
