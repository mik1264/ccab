<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supramolecular Assembly</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: #1a1a2e; color: #e8e6e1; overflow: hidden; }
        #container { display: flex; height: 100vh; }
        #canvas-container { flex: 1; position: relative; }
        canvas { display: block; width: 100%; height: 100%; }
        #controls { width: 320px; background: rgba(0,0,0,0.8); padding: 20px; overflow-y: auto; }
        h1 { font-size: 1.2rem; margin-bottom: 10px; color: #9c27b0; }
        .description { font-size: 0.75rem; color: #888; margin-bottom: 15px; line-height: 1.4; }
        .control-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.8rem; margin-bottom: 5px; color: #aaa; }
        input[type="range"] { width: 100%; }
        button { width: 100%; padding: 10px; margin-bottom: 8px; background: #9c27b0; color: #fff; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .stats { background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px; font-size: 0.75rem; margin-top: 10px; }
        .back-link { position: fixed; top: 10px; left: 10px; padding: 8px 16px; background: rgba(0,0,0,0.7); color: #9c27b0; text-decoration: none; border-radius: 6px; font-size: 14px; z-index: 999; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Gallery</a>
    <div id="container">
        <div id="canvas-container"><canvas id="canvas"></canvas></div>
        <div id="controls">
            <h1>Supramolecular Assembly</h1>
            <p class="description">Supramolecular chemistry uses non-covalent interactions (H-bonds, π-π stacking, hydrophobic effects) for self-assembly. Host-guest complexes form through molecular recognition.</p>

            <div class="control-group">
                <label>Host Concentration: <span id="hostVal">5</span></label>
                <input type="range" id="host" min="2" max="15" value="5">
            </div>

            <div class="control-group">
                <label>Guest Concentration: <span id="guestVal">20</span></label>
                <input type="range" id="guest" min="5" max="50" value="20">
            </div>

            <div class="control-group">
                <label>Binding Affinity (Ka): <span id="kaVal">100</span></label>
                <input type="range" id="ka" min="10" max="1000" step="10" value="100">
            </div>

            <div class="control-group">
                <label>Temperature: <span id="tempVal">298</span> K</label>
                <input type="range" id="temperature" min="273" max="373" value="298">
            </div>

            <button id="reset">Reset</button>
            <button id="toggleRun">Run/Pause</button>

            <div class="stats">
                <div>Free Hosts: <span id="freeHosts">0</span></div>
                <div>Free Guests: <span id="freeGuests">0</span></div>
                <div>Complexes: <span id="complexes">0</span></div>
                <div>Occupancy: <span id="occupancy">0</span>%</div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let width, height;
        let running = false;
        let time = 0;

        let hostCount = 5;
        let guestCount = 20;
        let Ka = 100;  // Binding constant
        let temperature = 298;

        let hosts = [];
        let guests = [];

        function resize() {
            const container = document.getElementById('canvas-container');
            width = container.clientWidth;
            height = container.clientHeight;
            canvas.width = width;
            canvas.height = height;
        }

        function init() {
            resize();
            time = 0;

            hosts = [];
            guests = [];

            // Create host molecules (cyclodextrin-like cavities)
            for (let i = 0; i < hostCount; i++) {
                hosts.push({
                    x: 150 + Math.random() * (width - 550),
                    y: 150 + Math.random() * (height - 300),
                    vx: (Math.random() - 0.5) * 0.5,
                    vy: (Math.random() - 0.5) * 0.5,
                    rotation: Math.random() * Math.PI * 2,
                    guest: null // Bound guest
                });
            }

            // Create guest molecules
            for (let i = 0; i < guestCount; i++) {
                guests.push({
                    x: 150 + Math.random() * (width - 550),
                    y: 150 + Math.random() * (height - 300),
                    vx: (Math.random() - 0.5) * 2,
                    vy: (Math.random() - 0.5) * 2,
                    bound: false,
                    hostRef: null
                });
            }

            updateStats();
        }

        function step() {
            time += 0.02;
            const R = 8.314;
            const kT = R * temperature / 1000;

            // Move hosts (slowly)
            for (const h of hosts) {
                h.vx += (Math.random() - 0.5) * 0.02;
                h.vy += (Math.random() - 0.5) * 0.02;
                h.vx *= 0.99;
                h.vy *= 0.99;
                h.x += h.vx;
                h.y += h.vy;
                h.rotation += 0.005;

                if (h.x < 100) { h.x = 100; h.vx *= -1; }
                if (h.x > width - 400) { h.x = width - 400; h.vx *= -1; }
                if (h.y < 100) { h.y = 100; h.vy *= -1; }
                if (h.y > height - 100) { h.y = height - 100; h.vy *= -1; }
            }

            // Move free guests (faster)
            for (const g of guests) {
                if (g.bound) continue;

                g.vx += (Math.random() - 0.5) * 0.3 * Math.sqrt(temperature / 298);
                g.vy += (Math.random() - 0.5) * 0.3 * Math.sqrt(temperature / 298);
                g.vx *= 0.97;
                g.vy *= 0.97;
                g.x += g.vx;
                g.y += g.vy;

                if (g.x < 100) { g.x = 100; g.vx *= -1; }
                if (g.x > width - 400) { g.x = width - 400; g.vx *= -1; }
                if (g.y < 100) { g.y = 100; g.vy *= -1; }
                if (g.y > height - 100) { g.y = height - 100; g.vy *= -1; }
            }

            // Host-guest binding equilibrium
            // H + G ⟷ HG, Ka = [HG]/([H][G])

            // Association: free guest enters empty host
            for (const h of hosts) {
                if (h.guest) continue; // Already occupied

                for (const g of guests) {
                    if (g.bound) continue;

                    const dx = h.x - g.x;
                    const dy = h.y - g.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);

                    if (dist < 40) {
                        // Binding probability based on Ka
                        const bindProb = Ka * 0.001 / (1 + Ka * 0.001);
                        if (Math.random() < bindProb) {
                            h.guest = g;
                            g.bound = true;
                            g.hostRef = h;
                        }
                    }
                }
            }

            // Dissociation: guest leaves host
            for (const h of hosts) {
                if (!h.guest) continue;

                // Dissociation rate inversely proportional to Ka
                const kd = 0.01 / Math.sqrt(Ka) * Math.sqrt(temperature / 298);
                if (Math.random() < kd) {
                    h.guest.bound = false;
                    h.guest.hostRef = null;
                    h.guest.x = h.x + (Math.random() - 0.5) * 50;
                    h.guest.y = h.y + (Math.random() - 0.5) * 50;
                    h.guest.vx = (Math.random() - 0.5) * 3;
                    h.guest.vy = (Math.random() - 0.5) * 3;
                    h.guest = null;
                }
            }

            // Update bound guest positions
            for (const g of guests) {
                if (g.bound && g.hostRef) {
                    g.x = g.hostRef.x;
                    g.y = g.hostRef.y;
                }
            }

            updateStats();
        }

        function draw() {
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, width, height);

            // Draw solution
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 2;
            ctx.strokeRect(90, 90, width - 430, height - 180);

            ctx.fillStyle = 'rgba(50, 50, 70, 0.3)';
            ctx.fillRect(90, 90, width - 430, height - 180);

            // Draw hosts (cyclodextrin-like ring structures)
            for (const h of hosts) {
                ctx.save();
                ctx.translate(h.x, h.y);
                ctx.rotate(h.rotation);

                // Draw cavity
                const hostRadius = 30;
                const cavityRadius = 15;

                // Outer ring (sugar units)
                ctx.strokeStyle = h.guest ? '#9c27b0' : '#666';
                ctx.lineWidth = 8;
                ctx.beginPath();
                ctx.arc(0, 0, hostRadius, 0, Math.PI * 2);
                ctx.stroke();

                // Inner cavity
                ctx.fillStyle = h.guest ? 'rgba(156, 39, 176, 0.3)' : 'rgba(100, 100, 100, 0.2)';
                ctx.beginPath();
                ctx.arc(0, 0, cavityRadius, 0, Math.PI * 2);
                ctx.fill();

                // Sugar unit markers
                ctx.fillStyle = '#888';
                for (let a = 0; a < Math.PI * 2; a += Math.PI / 4) {
                    ctx.beginPath();
                    ctx.arc(
                        Math.cos(a) * hostRadius,
                        Math.sin(a) * hostRadius,
                        5, 0, Math.PI * 2
                    );
                    ctx.fill();
                }

                ctx.restore();

                // Bound guest visualization
                if (h.guest) {
                    ctx.fillStyle = '#e91e63';
                    ctx.beginPath();
                    ctx.arc(h.x, h.y, 10, 0, Math.PI * 2);
                    ctx.fill();

                    // Binding interaction lines
                    ctx.strokeStyle = 'rgba(233, 30, 99, 0.5)';
                    ctx.lineWidth = 1;
                    ctx.setLineDash([3, 3]);
                    for (let a = 0; a < Math.PI * 2; a += Math.PI / 3) {
                        ctx.beginPath();
                        ctx.moveTo(h.x + Math.cos(a) * 12, h.y + Math.sin(a) * 12);
                        ctx.lineTo(h.x + Math.cos(a) * 25, h.y + Math.sin(a) * 25);
                        ctx.stroke();
                    }
                    ctx.setLineDash([]);
                }
            }

            // Draw free guests
            for (const g of guests) {
                if (g.bound) continue;

                ctx.fillStyle = '#e91e63';
                ctx.beginPath();
                ctx.arc(g.x, g.y, 7, 0, Math.PI * 2);
                ctx.fill();

                // Motion trail
                ctx.strokeStyle = 'rgba(233, 30, 99, 0.3)';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(g.x, g.y);
                ctx.lineTo(g.x - g.vx * 5, g.y - g.vy * 5);
                ctx.stroke();
            }

            // Labels
            ctx.fillStyle = '#9c27b0';
            ctx.font = '14px sans-serif';
            ctx.fillText('Host-Guest Supramolecular Chemistry', 100, 70);

            // Legend
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 6;
            ctx.beginPath();
            ctx.arc(100, height - 50, 20, 0, Math.PI * 2);
            ctx.stroke();
            ctx.fillStyle = '#fff';
            ctx.font = '11px sans-serif';
            ctx.fillText('Host (cyclodextrin)', 130, height - 45);

            ctx.fillStyle = '#e91e63';
            ctx.beginPath();
            ctx.arc(280, height - 50, 7, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#fff';
            ctx.fillText('Guest molecule', 295, height - 45);

            // Equilibrium equation
            ctx.fillStyle = '#aaa';
            ctx.font = '12px sans-serif';
            ctx.fillText('H + G ⟷ H•G', 100, height - 20);
            ctx.fillText('Ka = [H•G] / ([H][G]) = ' + Ka, 220, height - 20);

            // Binding isotherm
            drawBindingIsotherm();
        }

        function drawBindingIsotherm() {
            const plotX = width - 280;
            const plotY = 100;
            const plotW = 200;
            const plotH = 150;

            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(plotX - 10, plotY - 20, plotW + 20, plotH + 50);

            ctx.fillStyle = '#fff';
            ctx.font = '11px sans-serif';
            ctx.fillText('Binding Isotherm', plotX, plotY - 5);

            // Draw theoretical curve
            ctx.strokeStyle = '#9c27b0';
            ctx.lineWidth = 2;
            ctx.beginPath();

            for (let i = 0; i <= 100; i++) {
                const guestConc = i / 10; // 0 to 10
                const occupancy = (Ka * guestConc) / (1 + Ka * guestConc);
                const x = plotX + (guestConc / 10) * plotW;
                const y = plotY + plotH - occupancy * plotH;

                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();

            // Current point
            const currentOccupancy = hosts.filter(h => h.guest).length / hosts.length;
            const currentGuestFrac = guests.filter(g => !g.bound).length / guestCount;

            ctx.fillStyle = '#e91e63';
            ctx.beginPath();
            ctx.arc(
                plotX + currentGuestFrac * plotW,
                plotY + plotH - currentOccupancy * plotH,
                5, 0, Math.PI * 2
            );
            ctx.fill();

            // Axes
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(plotX, plotY);
            ctx.lineTo(plotX, plotY + plotH);
            ctx.lineTo(plotX + plotW, plotY + plotH);
            ctx.stroke();

            ctx.fillStyle = '#888';
            ctx.font = '10px sans-serif';
            ctx.fillText('[Guest]', plotX + plotW / 2, plotY + plotH + 20);
            ctx.save();
            ctx.translate(plotX - 15, plotY + plotH / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('θ (occupancy)', 0, 0);
            ctx.restore();
        }

        function updateStats() {
            const freeHosts = hosts.filter(h => !h.guest).length;
            const freeGuests = guests.filter(g => !g.bound).length;
            const complexes = hosts.filter(h => h.guest).length;
            const occupancy = (complexes / hosts.length * 100).toFixed(1);

            document.getElementById('freeHosts').textContent = freeHosts;
            document.getElementById('freeGuests').textContent = freeGuests;
            document.getElementById('complexes').textContent = complexes;
            document.getElementById('occupancy').textContent = occupancy;
        }

        function animate() {
            if (running) {
                step();
            }
            draw();
            requestAnimationFrame(animate);
        }

        document.getElementById('host').addEventListener('input', e => {
            hostCount = parseInt(e.target.value);
            document.getElementById('hostVal').textContent = hostCount;
        });

        document.getElementById('guest').addEventListener('input', e => {
            guestCount = parseInt(e.target.value);
            document.getElementById('guestVal').textContent = guestCount;
        });

        document.getElementById('ka').addEventListener('input', e => {
            Ka = parseInt(e.target.value);
            document.getElementById('kaVal').textContent = Ka;
        });

        document.getElementById('temperature').addEventListener('input', e => {
            temperature = parseInt(e.target.value);
            document.getElementById('tempVal').textContent = temperature;
        });

        document.getElementById('reset').addEventListener('click', init);
        document.getElementById('toggleRun').addEventListener('click', () => {
            running = !running;
            document.getElementById('toggleRun').textContent = running ? 'Pause' : 'Run';
        });

        window.addEventListener('resize', init);

        init();
        animate();
    </script>
</body>
</html>
