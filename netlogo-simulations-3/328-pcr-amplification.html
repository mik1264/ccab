<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PCR Amplification</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: #1a1a2e; color: #e8e6e1; overflow: hidden; }
        #container { display: flex; height: 100vh; }
        #canvas-container { flex: 1; position: relative; }
        canvas { display: block; width: 100%; height: 100%; }
        #controls { width: 320px; background: rgba(0,0,0,0.8); padding: 20px; overflow-y: auto; }
        h1 { font-size: 1.2rem; margin-bottom: 10px; color: #e91e63; }
        .description { font-size: 0.75rem; color: #888; margin-bottom: 15px; line-height: 1.4; }
        .control-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.8rem; margin-bottom: 5px; color: #aaa; }
        input[type="range"] { width: 100%; }
        button { width: 100%; padding: 10px; margin-bottom: 8px; background: #e91e63; color: #fff; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .stats { background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px; font-size: 0.75rem; margin-top: 10px; }
        .back-link { position: fixed; top: 10px; left: 10px; padding: 8px 16px; background: rgba(0,0,0,0.7); color: #e91e63; text-decoration: none; border-radius: 6px; font-size: 14px; z-index: 999; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Gallery</a>
    <div id="container">
        <div id="canvas-container"><canvas id="canvas"></canvas></div>
        <div id="controls">
            <h1>PCR Amplification</h1>
            <p class="description">Polymerase Chain Reaction amplifies DNA exponentially through thermal cycling: Denaturation (95°C), Annealing (55°C), Extension (72°C). Each cycle doubles the target DNA.</p>

            <div class="control-group">
                <label>Target Cycles: <span id="cyclesVal">30</span></label>
                <input type="range" id="cycles" min="10" max="40" value="30">
            </div>

            <div class="control-group">
                <label>Annealing Temp: <span id="annealVal">55</span> °C</label>
                <input type="range" id="anneal" min="45" max="65" value="55">
            </div>

            <div class="control-group">
                <label>Extension Time: <span id="extVal">60</span> s</label>
                <input type="range" id="extension" min="30" max="120" value="60">
            </div>

            <div class="control-group">
                <label>Primer Efficiency: <span id="effVal">0.9</span></label>
                <input type="range" id="efficiency" min="0.5" max="1.0" step="0.05" value="0.9">
            </div>

            <button id="reset">Reset</button>
            <button id="startPCR">Start PCR</button>

            <div class="stats">
                <div>Cycle: <span id="currentCycle">0</span>/<span id="totalCycles">30</span></div>
                <div>Phase: <span id="phase">Ready</span></div>
                <div>Temperature: <span id="temp">25</span> °C</div>
                <div>DNA Copies: <span id="copies">1</span></div>
                <div>Amplification: <span id="amplification">1</span>x</div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let width, height;
        let running = false;
        let time = 0;

        let targetCycles = 30;
        let annealTemp = 55;
        let extensionTime = 60;
        let efficiency = 0.9;

        let currentCycle = 0;
        let phase = 'ready'; // ready, denature, anneal, extend
        let phaseTime = 0;
        let temperature = 25;
        let dnaCopies = 1;

        let dnaStrands = [];
        let primers = [];
        let polymerases = [];

        function resize() {
            const container = document.getElementById('canvas-container');
            width = container.clientWidth;
            height = container.clientHeight;
            canvas.width = width;
            canvas.height = height;
        }

        function init() {
            resize();
            time = 0;
            currentCycle = 0;
            phase = 'ready';
            phaseTime = 0;
            temperature = 25;
            dnaCopies = 1;
            running = false;

            // Initial DNA template
            dnaStrands = [{
                x: (width - 320) / 2,
                y: height / 2,
                doubleStranded: true,
                length: 100,
                angle: 0
            }];

            // Create primer pool
            primers = [];
            for (let i = 0; i < 30; i++) {
                primers.push({
                    x: 100 + Math.random() * (width - 500),
                    y: 100 + Math.random() * (height - 200),
                    vx: (Math.random() - 0.5) * 2,
                    vy: (Math.random() - 0.5) * 2,
                    bound: false
                });
            }

            // Create polymerase pool
            polymerases = [];
            for (let i = 0; i < 10; i++) {
                polymerases.push({
                    x: 100 + Math.random() * (width - 500),
                    y: 100 + Math.random() * (height - 200),
                    vx: (Math.random() - 0.5) * 1.5,
                    vy: (Math.random() - 0.5) * 1.5,
                    active: false
                });
            }

            updateStats();
        }

        function startPCR() {
            running = true;
            phase = 'denature';
            phaseTime = 0;
            document.getElementById('startPCR').textContent = 'Running...';
        }

        function step() {
            if (!running) return;

            time += 0.02;
            phaseTime += 0.02;

            // Temperature ramping
            let targetTemp;
            if (phase === 'denature') {
                targetTemp = 95;
            } else if (phase === 'anneal') {
                targetTemp = annealTemp;
            } else if (phase === 'extend') {
                targetTemp = 72;
            } else {
                targetTemp = 25;
            }

            temperature += (targetTemp - temperature) * 0.1;

            // Phase transitions
            const denatureDuration = 0.5; // 30s in sim time
            const annealDuration = 0.5;
            const extendDuration = extensionTime / 60;

            if (phase === 'denature' && phaseTime > denatureDuration) {
                // Denature: separate strands
                for (const dna of dnaStrands) {
                    if (dna.doubleStranded) {
                        dna.doubleStranded = false;
                        // Create complementary strand
                        dnaStrands.push({
                            x: dna.x + (Math.random() - 0.5) * 50,
                            y: dna.y + (Math.random() - 0.5) * 50,
                            doubleStranded: false,
                            length: dna.length,
                            angle: Math.random() * Math.PI * 2
                        });
                    }
                }
                phase = 'anneal';
                phaseTime = 0;
            } else if (phase === 'anneal' && phaseTime > annealDuration) {
                // Anneal: primers bind
                for (const primer of primers) {
                    if (!primer.bound) {
                        for (const dna of dnaStrands) {
                            if (!dna.doubleStranded && !dna.primerBound) {
                                const dx = primer.x - dna.x;
                                const dy = primer.y - dna.y;
                                if (Math.sqrt(dx * dx + dy * dy) < 50) {
                                    if (Math.random() < efficiency) {
                                        primer.bound = true;
                                        dna.primerBound = true;
                                        break;
                                    }
                                }
                            }
                        }
                    }
                }
                phase = 'extend';
                phaseTime = 0;
            } else if (phase === 'extend' && phaseTime > extendDuration) {
                // Extension: polymerase synthesizes
                for (const dna of dnaStrands) {
                    if (dna.primerBound) {
                        dna.doubleStranded = true;
                        dna.primerBound = false;
                    }
                }

                dnaCopies = dnaStrands.filter(d => d.doubleStranded).length;
                currentCycle++;

                if (currentCycle >= targetCycles) {
                    phase = 'complete';
                    running = false;
                    document.getElementById('startPCR').textContent = 'Complete!';
                } else {
                    phase = 'denature';
                    phaseTime = 0;
                }

                // Replenish primers
                for (const primer of primers) {
                    if (primer.bound) {
                        primer.bound = false;
                        primer.x = 100 + Math.random() * (width - 500);
                        primer.y = 100 + Math.random() * (height - 200);
                    }
                }
            }

            // Move particles based on temperature
            const thermalMotion = Math.sqrt(temperature / 25);

            for (const strand of dnaStrands) {
                strand.x += (Math.random() - 0.5) * thermalMotion;
                strand.y += (Math.random() - 0.5) * thermalMotion;
                strand.angle += (Math.random() - 0.5) * 0.05;

                // Keep in bounds
                strand.x = Math.max(120, Math.min(width - 400, strand.x));
                strand.y = Math.max(120, Math.min(height - 120, strand.y));
            }

            for (const primer of primers) {
                if (!primer.bound) {
                    primer.vx += (Math.random() - 0.5) * 0.2 * thermalMotion;
                    primer.vy += (Math.random() - 0.5) * 0.2 * thermalMotion;
                    primer.vx *= 0.98;
                    primer.vy *= 0.98;
                    primer.x += primer.vx;
                    primer.y += primer.vy;

                    if (primer.x < 100) { primer.x = 100; primer.vx *= -1; }
                    if (primer.x > width - 380) { primer.x = width - 380; primer.vx *= -1; }
                    if (primer.y < 100) { primer.y = 100; primer.vy *= -1; }
                    if (primer.y > height - 100) { primer.y = height - 100; primer.vy *= -1; }
                }
            }

            updateStats();
        }

        function draw() {
            // Background color based on temperature
            const tempHue = 240 - (temperature - 25) * 2.5; // Blue to red
            ctx.fillStyle = `hsl(${Math.max(0, tempHue)}, 30%, 12%)`;
            ctx.fillRect(0, 0, width, height);

            // Draw thermocycler visualization
            drawThermocycler();

            // Draw DNA strands
            for (const strand of dnaStrands) {
                drawDNA(strand);
            }

            // Draw primers
            for (const primer of primers) {
                if (!primer.bound) {
                    ctx.fillStyle = '#4caf50';
                    ctx.beginPath();
                    ctx.arc(primer.x, primer.y, 4, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            // Draw polymerases
            for (const pol of polymerases) {
                ctx.fillStyle = '#ff9800';
                ctx.beginPath();
                ctx.arc(pol.x, pol.y, 6, 0, Math.PI * 2);
                ctx.fill();
            }

            // Phase indicator
            ctx.fillStyle = '#e91e63';
            ctx.font = '16px sans-serif';
            ctx.fillText('PCR Cycle ' + currentCycle + '/' + targetCycles, 100, 50);

            // Current phase
            let phaseText, phaseColor;
            switch (phase) {
                case 'denature':
                    phaseText = 'DENATURATION (95°C)';
                    phaseColor = '#f44336';
                    break;
                case 'anneal':
                    phaseText = 'ANNEALING (' + annealTemp + '°C)';
                    phaseColor = '#2196f3';
                    break;
                case 'extend':
                    phaseText = 'EXTENSION (72°C)';
                    phaseColor = '#4caf50';
                    break;
                case 'complete':
                    phaseText = 'COMPLETE';
                    phaseColor = '#9c27b0';
                    break;
                default:
                    phaseText = 'READY';
                    phaseColor = '#888';
            }

            ctx.fillStyle = phaseColor;
            ctx.font = 'bold 14px sans-serif';
            ctx.fillText(phaseText, 100, 75);

            // Legend
            ctx.fillStyle = '#03a9f4';
            ctx.fillRect(100, height - 55, 20, 8);
            ctx.fillStyle = '#fff';
            ctx.font = '10px sans-serif';
            ctx.fillText('DNA', 125, height - 48);

            ctx.fillStyle = '#4caf50';
            ctx.beginPath();
            ctx.arc(180, height - 51, 4, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillText('Primer', 190, height - 48);

            ctx.fillStyle = '#ff9800';
            ctx.beginPath();
            ctx.arc(250, height - 51, 5, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillText('Polymerase', 260, height - 48);

            // Amplification curve
            drawAmplificationCurve();
        }

        function drawDNA(strand) {
            ctx.save();
            ctx.translate(strand.x, strand.y);
            ctx.rotate(strand.angle);

            const len = 40;

            if (strand.doubleStranded) {
                // Double helix representation
                ctx.strokeStyle = '#03a9f4';
                ctx.lineWidth = 4;
                ctx.beginPath();
                ctx.moveTo(-len, -3);
                ctx.lineTo(len, -3);
                ctx.stroke();

                ctx.strokeStyle = '#e91e63';
                ctx.beginPath();
                ctx.moveTo(-len, 3);
                ctx.lineTo(len, 3);
                ctx.stroke();

                // Base pair rungs
                ctx.strokeStyle = '#666';
                ctx.lineWidth = 1;
                for (let x = -len + 5; x < len; x += 10) {
                    ctx.beginPath();
                    ctx.moveTo(x, -3);
                    ctx.lineTo(x, 3);
                    ctx.stroke();
                }
            } else {
                // Single strand
                ctx.strokeStyle = strand.primerBound ? '#4caf50' : '#03a9f4';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(-len, 0);
                ctx.lineTo(len, 0);
                ctx.stroke();

                // Primer if bound
                if (strand.primerBound) {
                    ctx.fillStyle = '#4caf50';
                    ctx.fillRect(-len - 5, -4, 15, 8);
                }
            }

            ctx.restore();
        }

        function drawThermocycler() {
            // Temperature bar
            const barX = width - 300;
            const barY = 400;
            const barH = 200;

            ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
            ctx.fillRect(barX - 10, barY - 20, 80, barH + 40);

            // Temperature scale
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(barX + 30, barY);
            ctx.lineTo(barX + 30, barY + barH);
            ctx.stroke();

            // Temperature marker
            const tempY = barY + barH - ((temperature - 20) / 80) * barH;

            // Gradient fill
            const gradient = ctx.createLinearGradient(barX, barY, barX, barY + barH);
            gradient.addColorStop(0, '#f44336');
            gradient.addColorStop(0.5, '#ff9800');
            gradient.addColorStop(1, '#2196f3');

            ctx.fillStyle = gradient;
            ctx.fillRect(barX + 25, tempY, 10, barY + barH - tempY);

            // Temperature labels
            ctx.fillStyle = '#fff';
            ctx.font = '10px sans-serif';
            ctx.fillText('95°C', barX, barY + 5);
            ctx.fillText('72°C', barX, barY + barH * 0.3);
            ctx.fillText(annealTemp + '°C', barX, barY + barH * 0.55);
            ctx.fillText('25°C', barX, barY + barH);

            // Current temp
            ctx.fillStyle = '#ffeb3b';
            ctx.font = 'bold 12px sans-serif';
            ctx.fillText(Math.round(temperature) + '°C', barX + 45, tempY + 5);
        }

        function drawAmplificationCurve() {
            const plotX = width - 280;
            const plotY = 100;
            const plotW = 200;
            const plotH = 120;

            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(plotX - 10, plotY - 20, plotW + 20, plotH + 50);

            ctx.fillStyle = '#fff';
            ctx.font = '11px sans-serif';
            ctx.fillText('Amplification (log scale)', plotX, plotY - 5);

            // Exponential curve
            ctx.strokeStyle = '#e91e63';
            ctx.lineWidth = 2;
            ctx.beginPath();

            for (let c = 0; c <= targetCycles; c++) {
                const copies = Math.pow(2, c);
                const x = plotX + (c / targetCycles) * plotW;
                const logCopies = Math.log10(copies);
                const maxLog = Math.log10(Math.pow(2, targetCycles));
                const y = plotY + plotH - (logCopies / maxLog) * plotH;

                if (c === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();

            // Current position
            if (currentCycle > 0) {
                const x = plotX + (currentCycle / targetCycles) * plotW;
                const logCopies = Math.log10(dnaCopies);
                const maxLog = Math.log10(Math.pow(2, targetCycles));
                const y = plotY + plotH - (logCopies / maxLog) * plotH;

                ctx.fillStyle = '#ffeb3b';
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, Math.PI * 2);
                ctx.fill();
            }

            // Axes
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(plotX, plotY);
            ctx.lineTo(plotX, plotY + plotH);
            ctx.lineTo(plotX + plotW, plotY + plotH);
            ctx.stroke();

            ctx.fillStyle = '#888';
            ctx.font = '10px sans-serif';
            ctx.fillText('Cycles', plotX + plotW / 2, plotY + plotH + 20);
        }

        function updateStats() {
            document.getElementById('currentCycle').textContent = currentCycle;
            document.getElementById('totalCycles').textContent = targetCycles;
            document.getElementById('phase').textContent = phase.charAt(0).toUpperCase() + phase.slice(1);
            document.getElementById('temp').textContent = Math.round(temperature);
            document.getElementById('copies').textContent = dnaCopies.toLocaleString();
            document.getElementById('amplification').textContent = dnaCopies.toLocaleString();
        }

        function animate() {
            step();
            draw();
            requestAnimationFrame(animate);
        }

        document.getElementById('cycles').addEventListener('input', e => {
            targetCycles = parseInt(e.target.value);
            document.getElementById('cyclesVal').textContent = targetCycles;
        });

        document.getElementById('anneal').addEventListener('input', e => {
            annealTemp = parseInt(e.target.value);
            document.getElementById('annealVal').textContent = annealTemp;
        });

        document.getElementById('extension').addEventListener('input', e => {
            extensionTime = parseInt(e.target.value);
            document.getElementById('extVal').textContent = extensionTime;
        });

        document.getElementById('efficiency').addEventListener('input', e => {
            efficiency = parseFloat(e.target.value);
            document.getElementById('effVal').textContent = efficiency;
        });

        document.getElementById('reset').addEventListener('click', init);
        document.getElementById('startPCR').addEventListener('click', startPCR);

        window.addEventListener('resize', init);

        init();
        animate();
    </script>
</body>
</html>
