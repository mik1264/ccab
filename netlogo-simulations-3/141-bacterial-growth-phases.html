<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bacterial Growth Phases</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e4e4e4;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            font-size: 2rem;
            margin-bottom: 10px;
            color: #00e676;
        }
        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 20px;
        }
        .simulation-area {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }
        .canvas-container {
            background: #0d1117;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        canvas {
            display: block;
            width: 100%;
            border-radius: 8px;
        }
        .controls {
            background: #0d1117;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        .control-group {
            margin-bottom: 18px;
        }
        .control-group label {
            display: block;
            margin-bottom: 8px;
            color: #00e676;
            font-weight: 500;
        }
        .control-group input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #333;
            outline: none;
            -webkit-appearance: none;
        }
        .control-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #00e676;
            cursor: pointer;
        }
        .value-display {
            text-align: right;
            font-size: 0.85rem;
            color: #aaa;
            margin-top: 4px;
        }
        .btn {
            width: 100%;
            padding: 12px;
            margin: 5px 0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-start {
            background: #00e676;
            color: #000;
        }
        .btn-start:hover {
            background: #00c853;
        }
        .btn-reset {
            background: #333;
            color: #e4e4e4;
        }
        .btn-reset:hover {
            background: #444;
        }
        .stats {
            background: #1a1a2e;
            border-radius: 8px;
            padding: 12px;
            margin-top: 15px;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #333;
        }
        .stat-row:last-child {
            border-bottom: none;
        }
        .stat-label {
            color: #888;
        }
        .stat-value {
            color: #00e676;
            font-weight: 600;
        }
        .phase-indicator {
            font-size: 1.2rem;
            text-align: center;
            padding: 10px;
            margin-top: 10px;
            background: #333;
            border-radius: 8px;
        }
        .phase-lag { color: #ffc107; }
        .phase-exponential { color: #00e676; }
        .phase-stationary { color: #2196f3; }
        .phase-death { color: #f44336; }
        .theory-box {
            background: linear-gradient(135deg, #1a2f23 0%, #0d1f17 100%);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #00e67644;
        }
        .theory-box h3 {
            color: #00e676;
            margin-bottom: 10px;
        }
        .theory-box p {
            color: #bbb;
            line-height: 1.6;
            font-size: 0.9rem;
        }
        .growth-chart {
            background: #0d1117;
            border-radius: 8px;
            padding: 10px;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Bacterial Growth Phases</h1>
        <p class="subtitle">Lag, Exponential, Stationary, and Death Phases with Nutrient Limitation</p>

        <div class="simulation-area">
            <div class="canvas-container">
                <canvas id="simCanvas"></canvas>
                <div class="growth-chart">
                    <canvas id="chartCanvas" height="150"></canvas>
                </div>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label>Initial Population: <span id="popVal">100</span></label>
                    <input type="range" id="initialPop" min="10" max="500" value="100">
                </div>

                <div class="control-group">
                    <label>Growth Rate: <span id="growthVal">0.15</span></label>
                    <input type="range" id="growthRate" min="5" max="30" value="15">
                </div>

                <div class="control-group">
                    <label>Nutrient Level: <span id="nutrientVal">100</span>%</label>
                    <input type="range" id="nutrientLevel" min="50" max="150" value="100">
                </div>

                <div class="control-group">
                    <label>Carrying Capacity: <span id="capacityVal">2000</span></label>
                    <input type="range" id="carryingCapacity" min="500" max="5000" value="2000">
                </div>

                <button class="btn btn-start" id="startBtn">Start Simulation</button>
                <button class="btn btn-reset" id="resetBtn">Reset</button>

                <div class="phase-indicator">
                    Phase: <span id="currentPhase" class="phase-lag">LAG</span>
                </div>

                <div class="stats">
                    <div class="stat-row">
                        <span class="stat-label">Generation:</span>
                        <span class="stat-value" id="generation">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Population:</span>
                        <span class="stat-value" id="population">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Nutrients:</span>
                        <span class="stat-value" id="nutrients">100%</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Growth Rate:</span>
                        <span class="stat-value" id="actualGrowth">0.00</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Dead Cells:</span>
                        <span class="stat-value" id="deadCells">0</span>
                    </div>
                </div>

                <div class="theory-box">
                    <h3>Bacterial Growth Curve</h3>
                    <p>
                        <strong>Lag Phase:</strong> Cells adapt to new environment, synthesize enzymes.<br>
                        <strong>Exponential:</strong> Rapid binary fission with constant doubling time.<br>
                        <strong>Stationary:</strong> Growth = death due to nutrient depletion.<br>
                        <strong>Death Phase:</strong> Cell death exceeds division, population declines.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        const chartCanvas = document.getElementById('chartCanvas');
        const chartCtx = chartCanvas.getContext('2d');

        canvas.width = 900;
        canvas.height = 500;
        chartCanvas.width = chartCanvas.parentElement.clientWidth - 20;

        let running = false;
        let generation = 0;
        let bacteria = [];
        let nutrients = 100;
        let deadCells = 0;
        let currentPhase = 'lag';
        let lagTime = 0;
        let populationHistory = [];

        // Parameters
        let initialPop = 100;
        let growthRate = 0.15;
        let nutrientLevel = 100;
        let carryingCapacity = 2000;

        class Bacterium {
            constructor(x, y) {
                this.x = x || Math.random() * canvas.width;
                this.y = y || Math.random() * canvas.height;
                this.vx = (Math.random() - 0.5) * 2;
                this.vy = (Math.random() - 0.5) * 2;
                this.radius = 4;
                this.age = 0;
                this.divisionTimer = 50 + Math.random() * 50;
                this.active = true;
                this.adaptationLevel = 0;
                this.color = `hsl(${120 + Math.random() * 20}, 70%, ${50 + Math.random() * 20}%)`;
            }

            update(effectiveGrowthRate) {
                if (!this.active) return;

                this.age++;

                // Movement - run and tumble
                if (Math.random() < 0.05) {
                    this.vx = (Math.random() - 0.5) * 3;
                    this.vy = (Math.random() - 0.5) * 3;
                }

                this.x += this.vx;
                this.y += this.vy;

                // Boundaries
                if (this.x < 0 || this.x > canvas.width) this.vx *= -1;
                if (this.y < 0 || this.y > canvas.height) this.vy *= -1;
                this.x = Math.max(0, Math.min(canvas.width, this.x));
                this.y = Math.max(0, Math.min(canvas.height, this.y));

                // Adaptation during lag phase
                if (currentPhase === 'lag') {
                    this.adaptationLevel = Math.min(1, this.adaptationLevel + 0.02);
                }

                // Division check
                this.divisionTimer -= effectiveGrowthRate * this.adaptationLevel;
            }

            canDivide() {
                return this.divisionTimer <= 0 && this.active && this.adaptationLevel >= 0.8;
            }

            divide() {
                this.divisionTimer = 50 + Math.random() * 50;
                const offset = this.radius * 2;
                return new Bacterium(
                    this.x + (Math.random() - 0.5) * offset,
                    this.y + (Math.random() - 0.5) * offset
                );
            }

            die() {
                this.active = false;
            }

            draw() {
                if (!this.active) return;

                ctx.beginPath();
                // Draw as rod-shaped (capsule)
                const angle = Math.atan2(this.vy, this.vx);
                const length = this.radius * 2;

                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(angle);

                ctx.beginPath();
                ctx.roundRect(-length/2, -this.radius/2, length, this.radius, this.radius/2);
                ctx.fillStyle = this.color;
                ctx.fill();

                // Highlight during adaptation
                if (this.adaptationLevel < 1 && currentPhase === 'lag') {
                    ctx.globalAlpha = 0.3;
                    ctx.fillStyle = '#ffc107';
                    ctx.fill();
                }
                ctx.restore();
            }
        }

        function init() {
            bacteria = [];
            generation = 0;
            nutrients = nutrientLevel;
            deadCells = 0;
            currentPhase = 'lag';
            lagTime = 0;
            populationHistory = [];

            for (let i = 0; i < initialPop; i++) {
                bacteria.push(new Bacterium());
            }

            updateStats();
            draw();
        }

        function determinePhase() {
            const pop = bacteria.filter(b => b.active).length;
            const avgAdaptation = bacteria.reduce((sum, b) => sum + b.adaptationLevel, 0) / bacteria.length;

            if (avgAdaptation < 0.9 && lagTime < 100) {
                lagTime++;
                return 'lag';
            } else if (nutrients > 30 && pop < carryingCapacity * 0.9) {
                return 'exponential';
            } else if (nutrients > 10 && pop >= carryingCapacity * 0.7) {
                return 'stationary';
            } else {
                return 'death';
            }
        }

        function update() {
            if (!running) return;

            generation++;
            currentPhase = determinePhase();

            // Calculate effective growth rate based on phase and nutrients
            let effectiveRate = growthRate * (nutrients / 100);

            if (currentPhase === 'lag') {
                effectiveRate *= 0.1;
            } else if (currentPhase === 'stationary') {
                effectiveRate *= 0.2;
            } else if (currentPhase === 'death') {
                effectiveRate *= 0;
            }

            const activeBacteria = bacteria.filter(b => b.active);

            // Update all bacteria
            activeBacteria.forEach(b => b.update(effectiveRate));

            // Handle division
            const newBacteria = [];
            activeBacteria.forEach(b => {
                if (b.canDivide() && activeBacteria.length + newBacteria.length < carryingCapacity * 1.2) {
                    newBacteria.push(b.divide());
                    nutrients -= 0.1; // Nutrient consumption
                }
            });
            bacteria.push(...newBacteria);

            // Death phase - increased death rate
            if (currentPhase === 'death' || currentPhase === 'stationary') {
                const deathRate = currentPhase === 'death' ? 0.02 : 0.005;
                activeBacteria.forEach(b => {
                    if (Math.random() < deathRate) {
                        b.die();
                        deadCells++;
                    }
                });
            }

            // Natural death (age-related)
            activeBacteria.forEach(b => {
                if (b.age > 500 && Math.random() < 0.01) {
                    b.die();
                    deadCells++;
                }
            });

            // Nutrient decay
            nutrients = Math.max(0, nutrients - 0.02 * (activeBacteria.length / 100));

            // Record history for chart
            if (generation % 5 === 0) {
                populationHistory.push(activeBacteria.length);
                if (populationHistory.length > 150) populationHistory.shift();
            }

            updateStats();
            draw();
            drawChart();

            requestAnimationFrame(update);
        }

        function draw() {
            // Background with nutrient visualization
            const nutrientGradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            const nutrientAlpha = Math.max(0.1, nutrients / 200);
            nutrientGradient.addColorStop(0, `rgba(0, 50, 0, ${nutrientAlpha})`);
            nutrientGradient.addColorStop(1, `rgba(0, 30, 0, ${nutrientAlpha})`);
            ctx.fillStyle = nutrientGradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw nutrient particles
            ctx.fillStyle = 'rgba(100, 200, 100, 0.1)';
            for (let i = 0; i < nutrients * 2; i++) {
                const x = (Math.sin(i * 0.5 + generation * 0.01) + 1) * canvas.width / 2;
                const y = (Math.cos(i * 0.7 + generation * 0.01) + 1) * canvas.height / 2;
                ctx.beginPath();
                ctx.arc(x, y, 2, 0, Math.PI * 2);
                ctx.fill();
            }

            // Draw bacteria
            bacteria.forEach(b => b.draw());

            // Phase indicator overlay
            ctx.fillStyle = 'rgba(0,0,0,0.7)';
            ctx.fillRect(10, 10, 120, 30);
            ctx.font = '14px Arial';
            ctx.fillStyle = getPhaseColor(currentPhase);
            ctx.fillText(`Phase: ${currentPhase.toUpperCase()}`, 20, 30);
        }

        function drawChart() {
            chartCtx.fillStyle = '#0d1117';
            chartCtx.fillRect(0, 0, chartCanvas.width, chartCanvas.height);

            if (populationHistory.length < 2) return;

            const maxPop = Math.max(...populationHistory, carryingCapacity);
            const xScale = chartCanvas.width / populationHistory.length;
            const yScale = (chartCanvas.height - 30) / maxPop;

            // Draw carrying capacity line
            chartCtx.strokeStyle = '#444';
            chartCtx.setLineDash([5, 5]);
            chartCtx.beginPath();
            const capY = chartCanvas.height - 15 - carryingCapacity * yScale;
            chartCtx.moveTo(0, capY);
            chartCtx.lineTo(chartCanvas.width, capY);
            chartCtx.stroke();
            chartCtx.setLineDash([]);

            // Draw population curve
            chartCtx.beginPath();
            chartCtx.strokeStyle = '#00e676';
            chartCtx.lineWidth = 2;
            populationHistory.forEach((pop, i) => {
                const x = i * xScale;
                const y = chartCanvas.height - 15 - pop * yScale;
                if (i === 0) chartCtx.moveTo(x, y);
                else chartCtx.lineTo(x, y);
            });
            chartCtx.stroke();

            // Labels
            chartCtx.fillStyle = '#888';
            chartCtx.font = '10px Arial';
            chartCtx.fillText('Population over time', 10, 12);
            chartCtx.fillText(`K=${carryingCapacity}`, chartCanvas.width - 60, capY - 5);
        }

        function getPhaseColor(phase) {
            switch(phase) {
                case 'lag': return '#ffc107';
                case 'exponential': return '#00e676';
                case 'stationary': return '#2196f3';
                case 'death': return '#f44336';
                default: return '#888';
            }
        }

        function updateStats() {
            const activePop = bacteria.filter(b => b.active).length;
            const avgAdaptation = bacteria.length > 0
                ? bacteria.reduce((sum, b) => sum + b.adaptationLevel, 0) / bacteria.length
                : 0;

            document.getElementById('generation').textContent = generation;
            document.getElementById('population').textContent = activePop;
            document.getElementById('nutrients').textContent = nutrients.toFixed(1) + '%';
            document.getElementById('actualGrowth').textContent = (growthRate * (nutrients / 100) * avgAdaptation).toFixed(3);
            document.getElementById('deadCells').textContent = deadCells;

            const phaseEl = document.getElementById('currentPhase');
            phaseEl.textContent = currentPhase.toUpperCase();
            phaseEl.className = `phase-${currentPhase}`;
        }

        // Event listeners
        document.getElementById('startBtn').addEventListener('click', function() {
            running = !running;
            this.textContent = running ? 'Pause' : 'Start Simulation';
            if (running) update();
        });

        document.getElementById('resetBtn').addEventListener('click', function() {
            running = false;
            document.getElementById('startBtn').textContent = 'Start Simulation';
            init();
        });

        document.getElementById('initialPop').addEventListener('input', function() {
            initialPop = parseInt(this.value);
            document.getElementById('popVal').textContent = initialPop;
        });

        document.getElementById('growthRate').addEventListener('input', function() {
            growthRate = parseInt(this.value) / 100;
            document.getElementById('growthVal').textContent = growthRate.toFixed(2);
        });

        document.getElementById('nutrientLevel').addEventListener('input', function() {
            nutrientLevel = parseInt(this.value);
            document.getElementById('nutrientVal').textContent = nutrientLevel;
        });

        document.getElementById('carryingCapacity').addEventListener('input', function() {
            carryingCapacity = parseInt(this.value);
            document.getElementById('capacityVal').textContent = carryingCapacity;
        });

        init();
    </script>
</body>
</html>
