<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNA Replication Fork - NetLogo Simulations III</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3a 100%);
            min-height: 100vh;
            color: #e0e0e0;
            display: flex;
        }

        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        header {
            padding: 15px 25px;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid rgba(100,200,255,0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .back-link {
            color: #64b5f6;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: color 0.3s;
        }

        .back-link:hover { color: #90caf9; }

        h1 {
            font-size: 1.5rem;
            background: linear-gradient(90deg, #64b5f6, #4fc3f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .main-content {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .canvas-container {
            flex: 1;
            position: relative;
            background: #050510;
        }

        canvas {
            width: 100%;
            height: 100%;
        }

        .control-panel {
            width: 320px;
            background: rgba(0,0,0,0.4);
            padding: 20px;
            overflow-y: auto;
            border-left: 1px solid rgba(100,200,255,0.2);
        }

        .panel-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .panel-section h3 {
            color: #4fc3f7;
            margin-bottom: 12px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .control-group {
            margin-bottom: 12px;
        }

        .control-group label {
            display: block;
            font-size: 0.85rem;
            color: #aaa;
            margin-bottom: 5px;
        }

        .control-group input[type="range"] {
            width: 100%;
            margin-bottom: 3px;
        }

        .control-value {
            font-size: 0.8rem;
            color: #64b5f6;
            text-align: right;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
            margin-right: 8px;
            margin-bottom: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #1976d2, #1565c0);
            color: white;
        }

        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(25,118,210,0.4); }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #e0e0e0;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .btn-secondary:hover { background: rgba(255,255,255,0.2); }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .stat-item {
            background: rgba(0,0,0,0.3);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #4fc3f7;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #888;
            margin-top: 3px;
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.75rem;
        }

        .legend-color {
            width: 14px;
            height: 14px;
            border-radius: 3px;
        }

        .modal.active { display: flex; }

        .modal-content {
            background: #1a1a2e;
            padding: 30px;
            border-radius: 12px;
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid rgba(100,200,255,0.3);
        }

        .modal-content h2 {
            color: #4fc3f7;
            margin-bottom: 15px;
        }

        .modal-content p {
            line-height: 1.7;
            margin-bottom: 12px;
            color: #ccc;
        }

        .modal-content ul {
            margin-left: 20px;
            margin-bottom: 12px;
        }

        .modal-content li {
            margin-bottom: 6px;
            color: #bbb;
        }

        .close-btn {
            float: right;
            background: none;
            border: none;
            color: #888;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .close-btn:hover { color: #fff; }
    
        .explain-btn {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            font-weight: 600;
        }
        .explain-btn:hover {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.9);
            z-index: 10000;
            padding: 20px;
            overflow-y: auto;
        }
        .modal-overlay.active {
            display: flex;
            align-items: flex-start;
            justify-content: center;
        }
        .modal {
            background: linear-gradient(135deg, #1a1a2e 0%, #252542 100%);
            border-radius: 20px;
            padding: 35px;
            max-width: 750px;
            width: 100%;
            margin: 40px auto;
            position: relative;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
        }
        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: rgba(255,255,255,0.1);
            border: none;
            color: #888;
            font-size: 24px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        .modal-close:hover {
            color: #fff;
            background: rgba(255,255,255,0.2);
        }
        .modal h2 {
            color: #00d9ff;
            margin-bottom: 25px;
            font-size: 1.6rem;
            padding-right: 50px;
            line-height: 1.3;
        }
        .modal-body {
            color: #d1d5db;
            line-height: 1.9;
            font-size: 1rem;
        }
        .modal-body h3 {
            color: #00ff88;
            margin: 28px 0 14px 0;
            font-size: 1.15rem;
            font-weight: 600;
        }
        .modal-body p {
            margin-bottom: 16px;
        }
        .modal-body ul {
            margin: 12px 0 18px 24px;
        }
        .modal-body li {
            margin-bottom: 10px;
        }
        .modal-body strong {
            color: #00d9ff;
        }
        .modal-body em {
            color: #a5b4fc;
            font-style: italic;
        }
        .modal-body code {
            background: rgba(0,0,0,0.3);
            padding: 2px 8px;
            border-radius: 4px;
            font-family: 'Fira Code', monospace;
            color: #fbbf24;
            font-size: 0.9em;
        }
        .modal-category {
            margin-top: 24px;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-link">‚Üê Back to Simulations</a>
            <h1>DNA Replication Fork</h1>
            <button class="btn btn-secondary" onclick="showModal()">Explain</button>
        </header>

        <div class="main-content">
            <div class="canvas-container">
                <canvas id="canvas"></canvas>
            </div>

            <div class="control-panel">
                <div class="panel-section">
                    <h3>Simulation Controls</h3>
                    <button class="btn btn-primary" id="startBtn" onclick="toggleSimulation()">Start</button>
                    <button class="btn btn-secondary" onclick="resetSimulation()">Reset</button>
                <button id="explainBtn" class="explain-btn">üìö Explain This Simulation</button>
                </div>

                <div class="panel-section">
                    <h3>Parameters</h3>

                    <div class="control-group">
                        <label>Helicase Speed</label>
                        <input type="range" id="helicaseSpeed" min="0.5" max="3" step="0.1" value="1.5">
                        <div class="control-value"><span id="helicaseSpeedVal">1.5</span> bp/frame</div>
                    </div>

                    <div class="control-group">
                        <label>Polymerase Speed</label>
                        <input type="range" id="polSpeed" min="0.5" max="4" step="0.1" value="2">
                        <div class="control-value"><span id="polSpeedVal">2.0</span> bp/frame</div>
                    </div>

                    <div class="control-group">
                        <label>Primer Frequency</label>
                        <input type="range" id="primerFreq" min="20" max="100" step="5" value="50">
                        <div class="control-value">Every <span id="primerFreqVal">50</span> bp</div>
                    </div>

                    <div class="control-group">
                        <label>Ligase Efficiency</label>
                        <input type="range" id="ligaseEff" min="0.5" max="1" step="0.05" value="0.9">
                        <div class="control-value"><span id="ligaseEffVal">90</span>%</div>
                    </div>
                </div>

                <div class="panel-section">
                    <h3>Statistics</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="leadingBp">0</div>
                            <div class="stat-label">Leading Strand (bp)</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="laggingBp">0</div>
                            <div class="stat-label">Lagging Strand (bp)</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="okazakiCount">0</div>
                            <div class="stat-label">Okazaki Fragments</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="ligatedCount">0</div>
                            <div class="stat-label">Ligated Fragments</div>
                        </div>
                    </div>
                </div>

                <div class="panel-section">
                    <h3>Legend</h3>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #4fc3f7;"></div>
                            <span>Template DNA</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #81c784;"></div>
                            <span>New DNA</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #ffb74d;"></div>
                            <span>Helicase</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #e57373;"></div>
                            <span>RNA Primer</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #ba68c8;"></div>
                            <span>Primase</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #4db6ac;"></div>
                            <span>DNA Polymerase</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #f06292;"></div>
                            <span>DNA Ligase</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="hideModal()">&times;</button>
            <h2>DNA Replication Fork</h2>
            <p>
                DNA replication is the process by which a cell duplicates its genetic material before cell division.
                The replication fork is the Y-shaped structure where the double helix is unwound and new strands are synthesized.
            </p>
            <h3>Key Components</h3>
            <ul>
                <li><strong>DNA Helicase:</strong> Unwinds the double helix by breaking hydrogen bonds between base pairs, creating the replication fork.</li>
                <li><strong>Single-Strand Binding Proteins (SSB):</strong> Stabilize the separated strands to prevent reannealing.</li>
                <li><strong>Primase:</strong> Synthesizes short RNA primers (~10 nucleotides) to provide 3'-OH for polymerase.</li>
                <li><strong>DNA Polymerase III:</strong> The main replicative polymerase, synthesizes DNA in 5'‚Üí3' direction only.</li>
                <li><strong>DNA Ligase:</strong> Joins Okazaki fragments by forming phosphodiester bonds.</li>
            </ul>
            <h3>Leading vs Lagging Strand</h3>
            <p>
                Because DNA polymerase only works in the 5'‚Üí3' direction:
            </p>
            <ul>
                <li><strong>Leading strand:</strong> Synthesized continuously toward the replication fork.</li>
                <li><strong>Lagging strand:</strong> Synthesized discontinuously as short Okazaki fragments (100-200 bp in eukaryotes, 1000-2000 bp in prokaryotes) away from the fork.</li>
            </ul>
            <h3>Okazaki Fragment Processing</h3>
            <p>
                After synthesis, RNA primers are removed by RNase H and DNA Polymerase I (in prokaryotes) or FEN1 (in eukaryotes).
                The gaps are filled with DNA, and DNA ligase seals the nicks to create a continuous strand.
            </p>
            <h3>The Replisome</h3>
            <p>
                The replisome is a large molecular machine containing helicase, primase, and polymerase. In eukaryotes,
                the CMG complex (Cdc45-MCM-GINS) serves as the replicative helicase, while Pol Œ±-primase initiates
                Okazaki fragments and Pol Œ¥/Œµ extend them.
            </p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let running = false;
        let animationId = null;

        // Simulation state
        let state = {
            forkPosition: 0,
            leadingStrandLength: 0,
            laggingFragments: [],
            ligatedFragments: 0,
            currentPrimerPos: 0,
            primaseActive: false,
            primasePos: 0,
            primers: [],
            ligasePositions: []
        };

        // Parameters
        const params = {
            helicaseSpeed: 1.5,
            polSpeed: 2.0,
            primerFreq: 50,
            ligaseEff: 0.9
        };

        // DNA base pairs for visual
        const basePairs = [];
        const BASE_PAIR_WIDTH = 4;
        const STRAND_GAP = 80;

        function resize() {
            canvas.width = canvas.parentElement.clientWidth;
            canvas.height = canvas.parentElement.clientHeight;
            initBasePairs();
        }

        function initBasePairs() {
            basePairs.length = 0;
            const numPairs = Math.ceil(canvas.width / BASE_PAIR_WIDTH) + 50;
            for (let i = 0; i < numPairs; i++) {
                basePairs.push({
                    x: i * BASE_PAIR_WIDTH,
                    topBase: Math.random() < 0.5 ? 'A' : (Math.random() < 0.5 ? 'T' : (Math.random() < 0.5 ? 'G' : 'C')),
                    replicated: false,
                    newTopSynthesized: false,
                    newBottomSynthesized: false
                });
            }
        }

        function resetSimulation() {
            running = false;
            document.getElementById('startBtn').textContent = 'Start';

            state = {
                forkPosition: 0,
                leadingStrandLength: 0,
                laggingFragments: [],
                ligatedFragments: 0,
                currentPrimerPos: 0,
                primaseActive: false,
                primasePos: 0,
                primers: [],
                ligasePositions: []
            };

            initBasePairs();
            updateStats();
            draw();
        }

        function toggleSimulation() {
            running = !running;
            document.getElementById('startBtn').textContent = running ? 'Pause' : 'Start';
            if (running) animate();
        }

        function updateParams() {
            params.helicaseSpeed = parseFloat(document.getElementById('helicaseSpeed').value);
            params.polSpeed = parseFloat(document.getElementById('polSpeed').value);
            params.primerFreq = parseFloat(document.getElementById('primerFreq').value);
            params.ligaseEff = parseFloat(document.getElementById('ligaseEff').value);

            document.getElementById('helicaseSpeedVal').textContent = params.helicaseSpeed.toFixed(1);
            document.getElementById('polSpeedVal').textContent = params.polSpeed.toFixed(1);
            document.getElementById('primerFreqVal').textContent = params.primerFreq;
            document.getElementById('ligaseEffVal').textContent = Math.round(params.ligaseEff * 100);
        }

        // Bind parameter controls
        document.querySelectorAll('input[type="range"]').forEach(input => {
            input.addEventListener('input', updateParams);
        });

        function update() {
            // Move helicase / advance fork
            state.forkPosition += params.helicaseSpeed;

            // Mark base pairs as replicated (unwound)
            const forkIndex = Math.floor(state.forkPosition / BASE_PAIR_WIDTH);
            for (let i = 0; i < basePairs.length && i <= forkIndex; i++) {
                basePairs[i].replicated = true;
            }

            // Leading strand synthesis (continuous)
            if (state.leadingStrandLength < state.forkPosition) {
                state.leadingStrandLength = Math.min(
                    state.leadingStrandLength + params.polSpeed,
                    state.forkPosition
                );
            }

            // Mark leading strand synthesis
            const leadingIndex = Math.floor(state.leadingStrandLength / BASE_PAIR_WIDTH);
            for (let i = 0; i < basePairs.length && i <= leadingIndex; i++) {
                basePairs[i].newBottomSynthesized = true;
            }

            // Primase activity on lagging strand
            if (state.forkPosition - state.currentPrimerPos >= params.primerFreq) {
                // Start a new primer
                state.primers.push({
                    start: state.currentPrimerPos,
                    length: 10,
                    synthesizing: true,
                    fragmentStart: state.currentPrimerPos,
                    fragmentEnd: state.currentPrimerPos + 10
                });
                state.currentPrimerPos = state.forkPosition;
            }

            // Extend Okazaki fragments from primers
            state.primers.forEach((primer, idx) => {
                if (primer.synthesizing) {
                    // DNA polymerase extends from primer toward previous fragment
                    const prevEnd = idx > 0 ? state.primers[idx - 1].fragmentStart : 0;

                    if (primer.fragmentStart > prevEnd + 2) {
                        primer.fragmentStart -= params.polSpeed;
                        if (primer.fragmentStart <= prevEnd + 2) {
                            primer.fragmentStart = prevEnd + 2;
                            primer.synthesizing = false;

                            // Check for ligation
                            if (idx > 0 && Math.random() < params.ligaseEff) {
                                state.ligasePositions.push({
                                    pos: prevEnd + 2,
                                    timer: 30
                                });
                                state.ligatedFragments++;
                            }
                        }
                    }

                    // Mark lagging strand synthesis
                    const startIdx = Math.floor(primer.fragmentStart / BASE_PAIR_WIDTH);
                    const endIdx = Math.floor(primer.fragmentEnd / BASE_PAIR_WIDTH);
                    for (let i = startIdx; i <= endIdx && i < basePairs.length; i++) {
                        if (i >= 0) basePairs[i].newTopSynthesized = true;
                    }
                }
            });

            // Update ligase animation
            state.ligasePositions = state.ligasePositions.filter(l => {
                l.timer--;
                return l.timer > 0;
            });

            updateStats();
        }

        function updateStats() {
            document.getElementById('leadingBp').textContent = Math.floor(state.leadingStrandLength);

            let laggingTotal = 0;
            state.primers.forEach(p => {
                laggingTotal += (p.fragmentEnd - p.fragmentStart);
            });
            document.getElementById('laggingBp').textContent = Math.floor(laggingTotal);
            document.getElementById('okazakiCount').textContent = state.primers.length;
            document.getElementById('ligatedCount').textContent = state.ligatedFragments;
        }

        function draw() {
            ctx.fillStyle = '#050510';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const centerY = canvas.height / 2;
            const viewOffset = Math.max(0, state.forkPosition - canvas.width * 0.6);

            // Draw DNA backbone and base pairs
            basePairs.forEach((bp, i) => {
                const x = bp.x - viewOffset;
                if (x < -10 || x > canvas.width + 10) return;

                if (bp.replicated) {
                    // Draw separated strands (replication fork)
                    const separation = Math.min(40, (state.forkPosition - bp.x) * 0.5);

                    // Template top strand (moving up)
                    ctx.fillStyle = '#4fc3f7';
                    ctx.fillRect(x, centerY - STRAND_GAP / 2 - separation - 3, BASE_PAIR_WIDTH - 1, 6);

                    // Template bottom strand (moving down)
                    ctx.fillStyle = '#4fc3f7';
                    ctx.fillRect(x, centerY + STRAND_GAP / 2 + separation - 3, BASE_PAIR_WIDTH - 1, 6);

                    // New synthesized DNA on bottom template (leading strand)
                    if (bp.newBottomSynthesized) {
                        ctx.fillStyle = '#81c784';
                        ctx.fillRect(x, centerY + STRAND_GAP / 2 + separation + 5, BASE_PAIR_WIDTH - 1, 6);
                    }

                    // New synthesized DNA on top template (lagging strand)
                    if (bp.newTopSynthesized) {
                        ctx.fillStyle = '#81c784';
                        ctx.fillRect(x, centerY - STRAND_GAP / 2 - separation - 11, BASE_PAIR_WIDTH - 1, 6);
                    }
                } else {
                    // Draw intact double helix
                    // Top strand
                    ctx.fillStyle = '#4fc3f7';
                    ctx.fillRect(x, centerY - 6, BASE_PAIR_WIDTH - 1, 5);

                    // Bottom strand
                    ctx.fillRect(x, centerY + 1, BASE_PAIR_WIDTH - 1, 5);

                    // Base pair connection
                    if (i % 3 === 0) {
                        ctx.fillStyle = 'rgba(100, 181, 246, 0.3)';
                        ctx.fillRect(x + 1, centerY - 1, BASE_PAIR_WIDTH - 2, 2);
                    }
                }
            });

            // Draw RNA primers on lagging strand
            state.primers.forEach(primer => {
                const primerX = primer.fragmentEnd - viewOffset;
                if (primerX > -50 && primerX < canvas.width + 50) {
                    const separation = Math.min(40, (state.forkPosition - primer.fragmentEnd) * 0.5);
                    ctx.fillStyle = '#e57373';
                    ctx.fillRect(primerX - 10, centerY - STRAND_GAP / 2 - separation - 11, 10, 6);
                }
            });

            // Draw helicase at fork
            const helicaseX = state.forkPosition - viewOffset;
            ctx.save();
            ctx.translate(helicaseX, centerY);

            // Helicase body
            ctx.fillStyle = '#ffb74d';
            ctx.beginPath();
            ctx.arc(0, 0, 18, 0, Math.PI * 2);
            ctx.fill();

            // Helicase detail
            ctx.strokeStyle = '#f57c00';
            ctx.lineWidth = 3;
            for (let i = 0; i < 6; i++) {
                const angle = (Date.now() / 100 + i * Math.PI / 3) % (Math.PI * 2);
                ctx.beginPath();
                ctx.moveTo(Math.cos(angle) * 8, Math.sin(angle) * 8);
                ctx.lineTo(Math.cos(angle) * 16, Math.sin(angle) * 16);
                ctx.stroke();
            }

            ctx.restore();

            // Draw leading strand polymerase
            const leadPolX = state.leadingStrandLength - viewOffset;
            const leadSep = Math.min(40, (state.forkPosition - state.leadingStrandLength) * 0.5);
            ctx.fillStyle = '#4db6ac';
            ctx.beginPath();
            ctx.arc(leadPolX, centerY + STRAND_GAP / 2 + leadSep + 8, 12, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#00897b';
            ctx.font = 'bold 10px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Pol', leadPolX, centerY + STRAND_GAP / 2 + leadSep + 12);

            // Draw lagging strand polymerases
            state.primers.forEach((primer, idx) => {
                if (primer.synthesizing) {
                    const polX = primer.fragmentStart - viewOffset;
                    const sep = Math.min(40, (state.forkPosition - primer.fragmentStart) * 0.5);

                    ctx.fillStyle = '#4db6ac';
                    ctx.beginPath();
                    ctx.arc(polX, centerY - STRAND_GAP / 2 - sep - 8, 10, 0, Math.PI * 2);
                    ctx.fill();
                }
            });

            // Draw primase (if actively priming)
            if (state.forkPosition - state.currentPrimerPos < 15) {
                const primaseX = state.currentPrimerPos - viewOffset;
                const sep = Math.min(40, (state.forkPosition - state.currentPrimerPos) * 0.5);

                ctx.fillStyle = '#ba68c8';
                ctx.beginPath();
                ctx.arc(primaseX + 5, centerY - STRAND_GAP / 2 - sep - 8, 10, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#7b1fa2';
                ctx.font = 'bold 8px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('Pri', primaseX + 5, centerY - STRAND_GAP / 2 - sep - 5);
            }

            // Draw DNA ligase
            state.ligasePositions.forEach(lig => {
                const ligX = lig.pos - viewOffset;
                const sep = Math.min(40, (state.forkPosition - lig.pos) * 0.5);

                ctx.fillStyle = '#f06292';
                ctx.beginPath();
                ctx.arc(ligX, centerY - STRAND_GAP / 2 - sep - 8, 8, 0, Math.PI * 2);
                ctx.fill();

                // Glow effect
                ctx.strokeStyle = `rgba(240, 98, 146, ${lig.timer / 30})`;
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(ligX, centerY - STRAND_GAP / 2 - sep - 8, 12, 0, Math.PI * 2);
                ctx.stroke();
            });

            // Labels
            ctx.fillStyle = '#aaa';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'left';

            // Leading strand label
            ctx.fillText("3'", 10, centerY + STRAND_GAP / 2 + 50);
            ctx.fillText("Leading Strand (continuous)", 30, centerY + STRAND_GAP / 2 + 50);

            // Lagging strand label
            ctx.fillText("5'", 10, centerY - STRAND_GAP / 2 - 50);
            ctx.fillText("Lagging Strand (Okazaki fragments)", 30, centerY - STRAND_GAP / 2 - 50);

            // Fork direction arrow
            ctx.fillStyle = '#ffb74d';
            ctx.beginPath();
            ctx.moveTo(canvas.width - 80, centerY - 80);
            ctx.lineTo(canvas.width - 40, centerY - 80);
            ctx.lineTo(canvas.width - 40, centerY - 90);
            ctx.lineTo(canvas.width - 20, centerY - 75);
            ctx.lineTo(canvas.width - 40, centerY - 60);
            ctx.lineTo(canvas.width - 40, centerY - 70);
            ctx.lineTo(canvas.width - 80, centerY - 70);
            ctx.closePath();
            ctx.fill();
            ctx.fillStyle = '#fff';
            ctx.font = '11px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Fork Direction', canvas.width - 50, centerY - 95);
        }

        function animate() {
            if (!running) return;

            update();
            draw();
            animationId = requestAnimationFrame(animate);
        }

        function showModal() {
            document.getElementById('modal').classList.add('active');
        }

        function hideModal() {
            document.getElementById('modal').classList.remove('active');
        }

        // Close modal on outside click
        document.getElementById('modal').addEventListener('click', (e) => {
            if (e.target.id === 'modal') hideModal();
        });

        window.addEventListener('resize', resize);
        resize();
        updateParams();
        draw();
    </script>


    <div id="explainModal" class="modal-overlay">
        <div class="modal">
            <button class="modal-close">&times;</button>
            <h2>üìä DNA Replication</h2>
            <div class="modal-body">
                <p>Life operates through precise molecular machinery. This simulation models biochemical reactions and molecular interactions at the cellular level.</p>

                <h3>About This Simulation</h3>
                <p>Implement a replication fork model with leading and lagging strand synthesis.</p>

                <h3>Key Concepts</h3>
                <ul>
                    <li><strong>Enzyme Kinetics:</strong> Enzymes catalyze reactions following Michaelis-Menten kinetics, with rates determined by substrate concentration and enzyme affinity (Km).</li>
                    <li><strong>Lock and Key vs Induced Fit:</strong> Enzymes recognize substrates either through rigid complementarity (lock-key) or conformational changes upon binding (induced fit).</li>
                    <li><strong>Allosteric Regulation:</strong> Enzyme activity modulated by molecules binding at sites other than the active site, enabling sophisticated metabolic control.</li>
                    <li><strong>Signal Transduction:</strong> Cascades of molecular interactions that amplify and transmit signals from cell surface to nucleus.</li>
                </ul>

                <h3>Why It Matters</h3>
                <p>Molecular understanding enables drug design, metabolic engineering, and synthetic biology.</p>

                <h3>How to Explore</h3>
                <ul>
                    <li>Adjust the sliders to modify simulation parameters and observe how the system responds</li>
                    <li>Look for emergent patterns that arise from agent interactions</li>
                    <li>Try extreme parameter values to find phase transitions and tipping points</li>
                    <li>Compare the simulation behavior to real-world phenomena</li>
                </ul>

                <p class="modal-category"><em>Category: Biochemistry & Molecular Biology ‚Äî Exploring molecular mechanisms and biochemical pathways</em></p>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const modal = document.getElementById('explainModal');
        const explainBtn = document.getElementById('explainBtn');
        if (modal && explainBtn) {
            explainBtn.addEventListener('click', function() {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            });
            modal.querySelector('.modal-close').addEventListener('click', function() {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            });
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && modal.classList.contains('active')) {
                    modal.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });
        }
    });
    </script>

    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
