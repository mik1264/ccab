<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SIR Model with Vaccination</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
canvas { display: block; }
#ui { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.85); padding: 18px 28px; border-radius: 14px; color: #e0e0e0; z-index: 10; display: flex; gap: 28px; align-items: center; border: 1px solid rgba(251,191,36,0.3); }
#ui label { font-size: 13px; display: flex; flex-direction: column; gap: 4px; align-items: center; }
#ui input[type=range] { width: 130px; accent-color: #fbbf24; }
#ui span.val { color: #fbbf24; font-weight: 700; font-size: 14px; }
#ui button { padding: 8px 18px; background: #fbbf24; color: #0a0e1a; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; font-size: 13px; }
#ui button:hover { background: #f59e0b; }
#title-overlay { position: fixed; top: 18px; left: 50%; transform: translateX(-50%); color: #fbbf24; font-size: 22px; font-weight: 700; text-shadow: 0 2px 10px rgba(0,0,0,0.7); z-index: 10; pointer-events: none; letter-spacing: 0.5px; }
#legend { position: fixed; top: 60px; right: 20px; background: rgba(0,0,0,0.8); padding: 14px 18px; border-radius: 10px; color: #e0e0e0; font-size: 13px; z-index: 10; border: 1px solid rgba(251,191,36,0.2); }
.legend-item { display: flex; align-items: center; gap: 8px; margin: 5px 0; }
.legend-dot { width: 12px; height: 12px; border-radius: 50%; }
#stats { position: fixed; top: 60px; left: 20px; background: rgba(0,0,0,0.8); padding: 14px 18px; border-radius: 10px; color: #e0e0e0; font-size: 13px; z-index: 10; border: 1px solid rgba(251,191,36,0.2); min-width: 150px; }
#stats div { margin: 4px 0; }
</style>
</head>
<body>
<a href="../index.html" style="position:fixed;top:10px;left:10px;padding:8px 16px;background:rgba(0,0,0,0.7);color:#fbbf24;text-decoration:none;border-radius:6px;font-size:14px;z-index:999;font-family:sans-serif;">&#8592; Back to Gallery</a>
<div id="title-overlay">SIR Model with Vaccination</div>
<div id="legend">
    <div class="legend-item"><div class="legend-dot" style="background:#4a9eff;"></div> Susceptible</div>
    <div class="legend-item"><div class="legend-dot" style="background:#ff4a4a;"></div> Infected</div>
    <div class="legend-item"><div class="legend-dot" style="background:#4aff88;"></div> Recovered</div>
    <div class="legend-item"><div class="legend-dot" style="background:#fbbf24;"></div> Vaccinated</div>
</div>
<div id="stats">
    <div>S: <span id="sCount" style="color:#4a9eff;">0</span></div>
    <div>I: <span id="iCount" style="color:#ff4a4a;">0</span></div>
    <div>R: <span id="rCount" style="color:#4aff88;">0</span></div>
    <div>V: <span id="vCount" style="color:#fbbf24;">0</span></div>
    <div style="margin-top:8px;">Day: <span id="dayCount" style="color:#fff;">0</span></div>
</div>
<div id="ui">
    <label>Vaccination Rate <input type="range" id="vacRate" min="0" max="0.5" step="0.01" value="0.1"><span class="val" id="vacVal">10%</span></label>
    <label>Transmission Rate <input type="range" id="transRate" min="0.01" max="0.5" step="0.01" value="0.15"><span class="val" id="transVal">15%</span></label>
    <button id="resetBtn">Reset</button>
</div>
<canvas id="canvas"></canvas>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const vacSlider = document.getElementById('vacRate');
const transSlider = document.getElementById('transRate');
const vacVal = document.getElementById('vacVal');
const transVal = document.getElementById('transVal');
const resetBtn = document.getElementById('resetBtn');

let W, H, simW, simH, graphX, graphY, graphW, graphH;
const N = 400;
const RADIUS = 4;
const SPEED = 1.2;
const INFECTION_DIST = 18;
const RECOVERY_TIME = 300;
const S = 0, I = 1, R = 2, V = 3;
const COLORS = ['#4a9eff', '#ff4a4a', '#4aff88', '#fbbf24'];

let agents = [];
let history = [];
let frame = 0;

function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
    simW = W * 0.65;
    simH = H - 100;
    graphX = simW + 40;
    graphY = 80;
    graphW = W - graphX - 30;
    graphH = H - 200;
}

function createAgents() {
    agents = [];
    history = [];
    frame = 0;
    const vacRate = parseFloat(vacSlider.value);
    for (let i = 0; i < N; i++) {
        let state = S;
        if (i < 3) state = I;
        else if (Math.random() < vacRate) state = V;
        agents.push({
            x: 40 + Math.random() * (simW - 80),
            y: 80 + Math.random() * (simH - 40),
            vx: (Math.random() - 0.5) * SPEED * 2,
            vy: (Math.random() - 0.5) * SPEED * 2,
            state: state,
            infectedTime: state === I ? 0 : -1
        });
    }
}

function update() {
    const trans = parseFloat(transSlider.value);
    const vacRate = parseFloat(vacSlider.value);
    for (let a of agents) {
        a.x += a.vx;
        a.y += a.vy;
        if (a.x < 20 || a.x > simW - 20) a.vx *= -1;
        if (a.y < 60 || a.y > simH + 40) a.vy *= -1;
        a.x = Math.max(20, Math.min(simW - 20, a.x));
        a.y = Math.max(60, Math.min(simH + 40, a.y));

        if (a.state === I) {
            a.infectedTime++;
            if (a.infectedTime > RECOVERY_TIME) {
                a.state = R;
            }
        }

        if (a.state === S && Math.random() < vacRate * 0.002) {
            a.state = V;
        }
    }

    for (let i = 0; i < agents.length; i++) {
        if (agents[i].state !== I) continue;
        for (let j = 0; j < agents.length; j++) {
            if (agents[j].state !== S) continue;
            const dx = agents[i].x - agents[j].x;
            const dy = agents[i].y - agents[j].y;
            if (dx * dx + dy * dy < INFECTION_DIST * INFECTION_DIST) {
                if (Math.random() < trans) {
                    agents[j].state = I;
                    agents[j].infectedTime = 0;
                }
            }
        }
    }

    if (frame % 3 === 0) {
        let counts = [0, 0, 0, 0];
        for (let a of agents) counts[a.state]++;
        history.push(counts);
        if (history.length > graphW) history.shift();
    }
    frame++;
}

function draw() {
    ctx.fillStyle = '#0a0e1a';
    ctx.fillRect(0, 0, W, H);

    // Sim area border
    ctx.strokeStyle = 'rgba(251,191,36,0.15)';
    ctx.lineWidth = 1;
    ctx.strokeRect(10, 55, simW - 10, simH);

    // Draw agents
    for (let a of agents) {
        ctx.beginPath();
        ctx.arc(a.x, a.y, RADIUS, 0, Math.PI * 2);
        ctx.fillStyle = COLORS[a.state];
        if (a.state === I) {
            ctx.shadowBlur = 12;
            ctx.shadowColor = '#ff4a4a';
        } else {
            ctx.shadowBlur = 0;
        }
        ctx.fill();
        ctx.shadowBlur = 0;

        // Infection radius indicator
        if (a.state === I) {
            ctx.beginPath();
            ctx.arc(a.x, a.y, INFECTION_DIST, 0, Math.PI * 2);
            ctx.strokeStyle = 'rgba(255,74,74,0.15)';
            ctx.lineWidth = 0.5;
            ctx.stroke();
        }
    }

    // Graph
    if (history.length > 1) {
        ctx.fillStyle = 'rgba(0,0,0,0.5)';
        ctx.fillRect(graphX - 10, graphY - 10, graphW + 20, graphH + 40);
        ctx.strokeStyle = 'rgba(251,191,36,0.3)';
        ctx.lineWidth = 1;
        ctx.strokeRect(graphX - 10, graphY - 10, graphW + 20, graphH + 40);

        ctx.fillStyle = '#aaa';
        ctx.font = '12px sans-serif';
        ctx.fillText('SIR Curves Over Time', graphX + graphW / 2 - 55, graphY - 18);

        // Stacked area chart
        const len = history.length;
        for (let s = 3; s >= 0; s--) {
            ctx.beginPath();
            ctx.moveTo(graphX, graphY + graphH);
            for (let i = 0; i < len; i++) {
                let stackVal = 0;
                for (let k = 0; k <= s; k++) stackVal += history[i][k];
                const x = graphX + (i / Math.max(len - 1, 1)) * graphW;
                const y = graphY + graphH - (stackVal / N) * graphH;
                ctx.lineTo(x, y);
            }
            ctx.lineTo(graphX + ((len - 1) / Math.max(len - 1, 1)) * graphW, graphY + graphH);
            ctx.closePath();
            ctx.fillStyle = COLORS[s] + '66';
            ctx.fill();
            ctx.strokeStyle = COLORS[s];
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            for (let i = 0; i < len; i++) {
                let stackVal = 0;
                for (let k = 0; k <= s; k++) stackVal += history[i][k];
                const x = graphX + (i / Math.max(len - 1, 1)) * graphW;
                const y = graphY + graphH - (stackVal / N) * graphH;
                if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
            }
            ctx.stroke();
        }

        // Axis labels
        ctx.fillStyle = '#888';
        ctx.font = '11px sans-serif';
        ctx.fillText('0', graphX - 10, graphY + graphH + 4);
        ctx.fillText(N + '', graphX - 28, graphY + 6);
    }

    // Update stats
    let counts = [0, 0, 0, 0];
    for (let a of agents) counts[a.state]++;
    document.getElementById('sCount').textContent = counts[0];
    document.getElementById('iCount').textContent = counts[1];
    document.getElementById('rCount').textContent = counts[2];
    document.getElementById('vCount').textContent = counts[3];
    document.getElementById('dayCount').textContent = Math.floor(frame / 60);
}

function animate() {
    update();
    draw();
    requestAnimationFrame(animate);
}

vacSlider.oninput = () => vacVal.textContent = Math.round(vacSlider.value * 100) + '%';
transSlider.oninput = () => transVal.textContent = Math.round(transSlider.value * 100) + '%';
resetBtn.onclick = createAgents;

window.addEventListener('resize', () => { resize(); createAgents(); });
resize();
createAgents();
animate();
</script>
</body>
</html>
