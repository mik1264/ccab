<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Signatures - Authentication & Non-Repudiation</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            color: #00ff88;
            min-height: 100vh;
            padding: 20px;
        }
        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #00ff88;
            text-decoration: none;
            padding: 10px 20px;
            background: rgba(0,255,136,0.1);
            border: 1px solid #00ff88;
            border-radius: 5px;
            z-index: 100;
        }
        .back-link:hover { background: rgba(0,255,136,0.2); }
        .container {
            max-width: 1100px;
            margin: 60px auto 0;
        }
        h1 { font-size: 2rem; margin-bottom: 10px; text-align: center; }
        .subtitle { color: #888; margin-bottom: 30px; text-align: center; }
        .flow-container {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        .party-box {
            background: rgba(0,0,0,0.5);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid;
        }
        .party-box.alice { border-color: #ff66aa; }
        .party-box.bob { border-color: #66aaff; }
        .party-box h3 { margin-bottom: 20px; }
        .party-box.alice h3 { color: #ff66aa; }
        .party-box.bob h3 { color: #66aaff; }
        .step-box {
            background: rgba(0,255,136,0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }
        .step-box h4 { color: #00ccff; margin-bottom: 10px; font-size: 0.9rem; }
        .step-value {
            font-size: 0.8rem;
            word-break: break-all;
            color: #888;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 5px;
        }
        .arrow-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .arrow {
            padding: 20px;
            background: rgba(0,255,136,0.1);
            border: 1px solid #00ff88;
            border-radius: 10px;
            text-align: center;
            margin: 10px 0;
        }
        .arrow-icon { font-size: 2rem; }
        button {
            padding: 12px 25px;
            font-size: 1rem;
            font-family: inherit;
            background: rgba(0,255,136,0.1);
            border: 1px solid #00ff88;
            color: #00ff88;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
            width: 100%;
        }
        button:hover { background: rgba(0,255,136,0.3); }
        textarea {
            width: 100%;
            height: 80px;
            padding: 10px;
            font-size: 0.9rem;
            font-family: inherit;
            background: rgba(0,255,136,0.1);
            border: 1px solid #00ff88;
            color: #00ff88;
            border-radius: 5px;
            resize: none;
            margin-bottom: 10px;
        }
        .verification-result {
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-top: 20px;
            font-size: 1.2rem;
        }
        .verification-result.valid {
            background: rgba(0,255,136,0.2);
            border: 2px solid #00ff88;
        }
        .verification-result.invalid {
            background: rgba(255,68,68,0.2);
            border: 2px solid #ff4444;
            color: #ff4444;
        }
        .hidden { display: none; }
        .info {
            margin-top: 30px;
            padding: 20px;
            background: rgba(0,255,136,0.05);
            border-radius: 10px;
            text-align: left;
        }
        .info h3 { color: #00ccff; margin-bottom: 10px; }
        .info p { color: #aaa; line-height: 1.6; }
        .controls { text-align: center; margin-bottom: 20px; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back</a>
    <div class="container">
        <h1>Digital Signatures</h1>
        <p class="subtitle">Proving authenticity and integrity with asymmetric cryptography</p>

        <div class="controls">
            <button onclick="generateKeys()" style="width:auto;">Generate New Key Pair</button>
            <button onclick="runDemo()" style="width:auto;">Run Full Demo</button>
        </div>

        <div class="flow-container">
            <div class="party-box alice">
                <h3>üë© Alice (Signer)</h3>

                <div class="step-box">
                    <h4>üîê Private Key (Secret)</h4>
                    <div class="step-value" id="alicePrivate">Click "Generate New Key Pair"</div>
                </div>

                <div class="step-box">
                    <h4>üìù Message</h4>
                    <textarea id="message" placeholder="Enter message to sign...">I authorize payment of $1000 to Bob</textarea>
                </div>

                <button onclick="signMessage()">Sign Message</button>

                <div class="step-box hidden" id="signatureBox">
                    <h4>‚úçÔ∏è Digital Signature</h4>
                    <div class="step-value" id="signature">-</div>
                </div>
            </div>

            <div class="arrow-container">
                <div class="arrow hidden" id="publicKeyArrow">
                    <div class="arrow-icon">üîì‚Üí</div>
                    <div>Public Key<br>(shared)</div>
                </div>
                <div class="arrow hidden" id="messageArrow">
                    <div class="arrow-icon">üì®‚Üí</div>
                    <div>Message +<br>Signature</div>
                </div>
            </div>

            <div class="party-box bob">
                <h3>üë® Bob (Verifier)</h3>

                <div class="step-box">
                    <h4>üîì Public Key (Received)</h4>
                    <div class="step-value" id="bobPublic">Waiting for Alice's public key...</div>
                </div>

                <div class="step-box hidden" id="receivedBox">
                    <h4>üì¨ Received Message</h4>
                    <div class="step-value" id="receivedMessage">-</div>
                </div>

                <button onclick="verifySignature()" id="verifyBtn" disabled>Verify Signature</button>

                <div class="verification-result hidden" id="verificationResult"></div>
            </div>
        </div>

        <div class="info">
            <h3>How Digital Signatures Work</h3>
            <p>Digital signatures provide three security guarantees:</p>
            <p><strong>1. Authentication:</strong> Proves the message came from the claimed sender (only they have the private key)</p>
            <p><strong>2. Integrity:</strong> Any modification to the message invalidates the signature</p>
            <p><strong>3. Non-repudiation:</strong> The signer cannot deny having signed the message</p>
            <p style="margin-top:15px;">The process: Alice hashes the message and encrypts the hash with her private key (creating the signature).
            Bob decrypts the signature with Alice's public key to get the hash, then compares it to his own hash of the message.
            If they match, the signature is valid.</p>
        </div>
    </div>

    <script>
        let keyPair = null;
        let currentSignature = null;

        async function generateKeys() {
            // Generate RSA key pair
            keyPair = await crypto.subtle.generateKey(
                {
                    name: "RSASSA-PKCS1-v1_5",
                    modulusLength: 2048,
                    publicExponent: new Uint8Array([1, 0, 1]),
                    hash: "SHA-256",
                },
                true,
                ["sign", "verify"]
            );

            // Export keys for display
            const privateKey = await crypto.subtle.exportKey("jwk", keyPair.privateKey);
            const publicKey = await crypto.subtle.exportKey("jwk", keyPair.publicKey);

            document.getElementById('alicePrivate').textContent =
                `RSA-2048 Private Key (d): ${privateKey.d.substr(0, 40)}...`;
            document.getElementById('bobPublic').textContent =
                `RSA-2048 Public Key (n): ${publicKey.n.substr(0, 40)}...`;

            document.getElementById('publicKeyArrow').classList.remove('hidden');
            document.getElementById('signatureBox').classList.add('hidden');
            document.getElementById('receivedBox').classList.add('hidden');
            document.getElementById('messageArrow').classList.add('hidden');
            document.getElementById('verificationResult').classList.add('hidden');
            document.getElementById('verifyBtn').disabled = true;
        }

        async function signMessage() {
            if (!keyPair) {
                alert('Please generate keys first!');
                return;
            }

            const message = document.getElementById('message').value;
            const encoder = new TextEncoder();
            const data = encoder.encode(message);

            // Sign the message
            currentSignature = await crypto.subtle.sign(
                "RSASSA-PKCS1-v1_5",
                keyPair.privateKey,
                data
            );

            // Display signature as hex
            const sigArray = Array.from(new Uint8Array(currentSignature));
            const sigHex = sigArray.map(b => b.toString(16).padStart(2, '0')).join('');

            document.getElementById('signature').textContent = sigHex.substr(0, 80) + '...';
            document.getElementById('signatureBox').classList.remove('hidden');

            document.getElementById('receivedMessage').textContent = message;
            document.getElementById('receivedBox').classList.remove('hidden');
            document.getElementById('messageArrow').classList.remove('hidden');

            document.getElementById('verifyBtn').disabled = false;
            document.getElementById('verificationResult').classList.add('hidden');
        }

        async function verifySignature() {
            if (!keyPair || !currentSignature) {
                alert('Please sign a message first!');
                return;
            }

            const message = document.getElementById('receivedMessage').textContent;
            const encoder = new TextEncoder();
            const data = encoder.encode(message);

            try {
                const isValid = await crypto.subtle.verify(
                    "RSASSA-PKCS1-v1_5",
                    keyPair.publicKey,
                    currentSignature,
                    data
                );

                const resultDiv = document.getElementById('verificationResult');
                resultDiv.classList.remove('hidden');

                if (isValid) {
                    resultDiv.className = 'verification-result valid';
                    resultDiv.innerHTML = '‚úÖ Signature VALID<br><small>Message is authentic and unmodified</small>';
                } else {
                    resultDiv.className = 'verification-result invalid';
                    resultDiv.innerHTML = '‚ùå Signature INVALID<br><small>Message may be forged or modified</small>';
                }
            } catch (e) {
                const resultDiv = document.getElementById('verificationResult');
                resultDiv.classList.remove('hidden');
                resultDiv.className = 'verification-result invalid';
                resultDiv.innerHTML = '‚ùå Verification Error';
            }
        }

        async function runDemo() {
            await generateKeys();
            await new Promise(r => setTimeout(r, 500));
            await signMessage();
            await new Promise(r => setTimeout(r, 500));
            await verifySignature();
        }

        // Tamper demonstration
        document.getElementById('receivedMessage')?.addEventListener('click', function() {
            this.contentEditable = true;
            this.focus();
            this.style.border = '2px solid #ff4444';
        });

        document.getElementById('receivedMessage')?.addEventListener('blur', function() {
            this.contentEditable = false;
            this.style.border = 'none';
        });
    </script>
</body>
</html>
