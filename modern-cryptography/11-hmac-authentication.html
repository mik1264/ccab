<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HMAC Authentication - Message Authentication Codes</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            color: #00ff88;
            min-height: 100vh;
            padding: 20px;
        }
        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #00ff88;
            text-decoration: none;
            padding: 10px 20px;
            background: rgba(0,255,136,0.1);
            border: 1px solid #00ff88;
            border-radius: 5px;
            z-index: 100;
        }
        .back-link:hover { background: rgba(0,255,136,0.2); }
        .container {
            max-width: 900px;
            margin: 60px auto 0;
        }
        h1 { font-size: 2rem; margin-bottom: 10px; text-align: center; }
        .subtitle { color: #888; margin-bottom: 30px; text-align: center; }
        .input-section {
            background: rgba(0,0,0,0.5);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid #00ff88;
            margin-bottom: 20px;
        }
        .input-group { margin-bottom: 20px; }
        label { display: block; color: #00ccff; margin-bottom: 8px; }
        input, textarea {
            width: 100%;
            padding: 12px;
            font-size: 1rem;
            font-family: inherit;
            background: rgba(0,255,136,0.1);
            border: 1px solid #00ff88;
            color: #00ff88;
            border-radius: 5px;
        }
        textarea { height: 80px; resize: vertical; }
        .formula {
            background: rgba(0,255,136,0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        .formula code {
            font-size: 1.1rem;
            color: #00ccff;
        }
        .result-section {
            background: rgba(0,0,0,0.5);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid #00ff88;
            margin-bottom: 20px;
        }
        .result-section h3 { color: #00ccff; margin-bottom: 15px; }
        .hmac-value {
            padding: 15px;
            background: rgba(0,255,136,0.1);
            border-radius: 5px;
            word-break: break-all;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }
        .verification {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 15px;
            align-items: end;
        }
        button {
            padding: 12px 25px;
            font-size: 1rem;
            font-family: inherit;
            background: rgba(0,255,136,0.1);
            border: 1px solid #00ff88;
            color: #00ff88;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        button:hover { background: rgba(0,255,136,0.3); }
        .verification-result {
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-top: 15px;
        }
        .verification-result.valid { background: rgba(0,255,136,0.2); border: 1px solid #00ff88; }
        .verification-result.invalid { background: rgba(255,68,68,0.2); border: 1px solid #ff4444; color: #ff4444; }
        .process-diagram {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        .process-step {
            background: rgba(0,255,136,0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        .process-step .icon { font-size: 2rem; margin-bottom: 10px; }
        .process-step h4 { color: #00ccff; margin-bottom: 5px; font-size: 0.9rem; }
        .process-step p { color: #888; font-size: 0.8rem; }
        .info {
            padding: 20px;
            background: rgba(0,255,136,0.05);
            border-radius: 10px;
        }
        .info h3 { color: #00ccff; margin-bottom: 10px; }
        .info p { color: #aaa; line-height: 1.6; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back</a>
    <div class="container">
        <h1>HMAC Authentication</h1>
        <p class="subtitle">Hash-based Message Authentication Code</p>

        <div class="formula">
            <code>HMAC(K, m) = H((K' ‚äï opad) || H((K' ‚äï ipad) || m))</code>
        </div>

        <div class="process-diagram">
            <div class="process-step">
                <div class="icon">üîë</div>
                <h4>Secret Key</h4>
                <p>Shared between sender and receiver</p>
            </div>
            <div class="process-step">
                <div class="icon">üìù</div>
                <h4>Message</h4>
                <p>Data to authenticate</p>
            </div>
            <div class="process-step">
                <div class="icon">üîê</div>
                <h4>HMAC Tag</h4>
                <p>Proves authenticity & integrity</p>
            </div>
        </div>

        <div class="input-section">
            <div class="input-group">
                <label>Secret Key (shared between parties)</label>
                <input type="text" id="secretKey" value="my-secret-key-123" placeholder="Enter secret key">
            </div>
            <div class="input-group">
                <label>Message</label>
                <textarea id="message" placeholder="Enter message to authenticate">Transfer $1000 to account 12345</textarea>
            </div>
        </div>

        <div class="result-section">
            <h3>Generated HMAC-SHA256</h3>
            <div class="hmac-value" id="hmacValue">Click "Generate HMAC" to compute</div>
            <button onclick="generateHMAC()">Generate HMAC</button>
        </div>

        <div class="result-section">
            <h3>Verify Message Authenticity</h3>
            <p style="color:#888;margin-bottom:15px;">Paste an HMAC to verify the message hasn't been tampered with:</p>
            <div class="verification">
                <input type="text" id="verifyHmac" placeholder="Paste HMAC to verify">
                <button onclick="verifyHMAC()">Verify</button>
            </div>
            <div class="verification-result" id="verificationResult" style="display:none;"></div>
        </div>

        <div class="result-section">
            <h3>Tampering Demonstration</h3>
            <p style="color:#888;margin-bottom:15px;">Try changing the message slightly and see how the HMAC completely changes:</p>
            <div class="input-group">
                <label>Tampered Message</label>
                <textarea id="tamperedMessage" placeholder="Try modifying the message">Transfer $1000 to account 12345</textarea>
            </div>
            <button onclick="compareTampered()">Compare HMACs</button>
            <div id="tamperResult" style="margin-top:15px;"></div>
        </div>

        <div class="info">
            <h3>Why HMAC Matters</h3>
            <p>HMAC provides both <strong>integrity</strong> (message hasn't been modified) and <strong>authentication</strong>
            (message came from someone with the secret key). Unlike digital signatures, HMAC uses symmetric keys,
            making it faster and suitable for high-throughput applications.</p>
            <p style="margin-top:10px;">HMAC is used in JWT tokens, API authentication, cookie signing, and secure protocols like TLS.</p>
        </div>
    </div>

    <script>
        async function computeHMAC(key, message) {
            const encoder = new TextEncoder();
            const keyData = encoder.encode(key);
            const messageData = encoder.encode(message);

            const cryptoKey = await crypto.subtle.importKey(
                'raw',
                keyData,
                { name: 'HMAC', hash: 'SHA-256' },
                false,
                ['sign']
            );

            const signature = await crypto.subtle.sign('HMAC', cryptoKey, messageData);
            const hashArray = Array.from(new Uint8Array(signature));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        async function generateHMAC() {
            const key = document.getElementById('secretKey').value;
            const message = document.getElementById('message').value;

            if (!key || !message) {
                document.getElementById('hmacValue').textContent = 'Please enter both key and message';
                return;
            }

            const hmac = await computeHMAC(key, message);
            document.getElementById('hmacValue').textContent = hmac;

            // Also update tampered message to match original
            document.getElementById('tamperedMessage').value = message;
        }

        async function verifyHMAC() {
            const key = document.getElementById('secretKey').value;
            const message = document.getElementById('message').value;
            const providedHmac = document.getElementById('verifyHmac').value.toLowerCase().trim();

            const computedHmac = await computeHMAC(key, message);
            const resultDiv = document.getElementById('verificationResult');
            resultDiv.style.display = 'block';

            if (computedHmac === providedHmac) {
                resultDiv.className = 'verification-result valid';
                resultDiv.innerHTML = '‚úÖ VALID - Message is authentic and unmodified';
            } else {
                resultDiv.className = 'verification-result invalid';
                resultDiv.innerHTML = '‚ùå INVALID - Message may have been tampered with or wrong key used';
            }
        }

        async function compareTampered() {
            const key = document.getElementById('secretKey').value;
            const originalMessage = document.getElementById('message').value;
            const tamperedMessage = document.getElementById('tamperedMessage').value;

            const originalHmac = await computeHMAC(key, originalMessage);
            const tamperedHmac = await computeHMAC(key, tamperedMessage);

            const resultDiv = document.getElementById('tamperResult');

            if (originalMessage === tamperedMessage) {
                resultDiv.innerHTML = `
                    <div style="color:#888;">Messages are identical - HMACs match</div>
                    <div style="color:#00ff88;margin-top:10px;word-break:break-all;">
                        HMAC: ${originalHmac}
                    </div>
                `;
            } else {
                // Count different characters
                let diffCount = 0;
                for (let i = 0; i < Math.max(originalHmac.length, tamperedHmac.length); i++) {
                    if (originalHmac[i] !== tamperedHmac[i]) diffCount++;
                }

                resultDiv.innerHTML = `
                    <div style="color:#ff4444;margin-bottom:15px;">
                        ‚ö†Ô∏è Message changed - HMAC completely different!
                    </div>
                    <div style="margin-bottom:10px;">
                        <div style="color:#00ccff;">Original HMAC:</div>
                        <div style="color:#00ff88;word-break:break-all;font-size:0.85rem;">${originalHmac}</div>
                    </div>
                    <div>
                        <div style="color:#00ccff;">Tampered HMAC:</div>
                        <div style="color:#ff4444;word-break:break-all;font-size:0.85rem;">${tamperedHmac}</div>
                    </div>
                    <div style="color:#888;margin-top:15px;font-size:0.9rem;">
                        ${diffCount}/64 hex characters are different (${Math.round(diffCount/64*100)}% change)
                    </div>
                `;
            }
        }

        // Initialize
        document.getElementById('tamperedMessage').value = document.getElementById('message').value;
    </script>
</body>
</html>
