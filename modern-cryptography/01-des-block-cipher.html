<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DES Block Cipher - Feistel Network Visualization</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            color: #00ff88;
            min-height: 100vh;
            padding: 20px;
        }
        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #00ff88;
            text-decoration: none;
            padding: 10px 20px;
            background: rgba(0,255,136,0.1);
            border: 1px solid #00ff88;
            border-radius: 5px;
            z-index: 100;
        }
        .back-link:hover { background: rgba(0,255,136,0.2); }
        .container {
            max-width: 1200px;
            margin: 60px auto 0;
            text-align: center;
        }
        h1 { font-size: 2rem; margin-bottom: 10px; }
        .subtitle { color: #888; margin-bottom: 30px; }
        .controls {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        input, button {
            padding: 12px 20px;
            font-size: 1rem;
            font-family: inherit;
            background: rgba(0,255,136,0.1);
            border: 1px solid #00ff88;
            color: #00ff88;
            border-radius: 5px;
        }
        input { width: 200px; }
        button { cursor: pointer; transition: all 0.3s; }
        button:hover { background: rgba(0,255,136,0.3); }
        #canvas {
            background: rgba(0,0,0,0.5);
            border: 1px solid #00ff88;
            border-radius: 10px;
            max-width: 100%;
        }
        .info {
            margin-top: 30px;
            padding: 20px;
            background: rgba(0,255,136,0.05);
            border-radius: 10px;
            text-align: left;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        .info h3 { margin-bottom: 10px; color: #00ccff; }
        .info p { color: #aaa; line-height: 1.6; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back</a>
    <div class="container">
        <h1>DES Block Cipher</h1>
        <p class="subtitle">Feistel Network Structure - 16 Rounds of Encryption</p>

        <div class="controls">
            <input type="text" id="plaintext" placeholder="8-char plaintext" maxlength="8" value="SECURITY">
            <input type="text" id="key" placeholder="8-char key" maxlength="8" value="CRYPTKEY">
            <button onclick="runDES()">Encrypt</button>
            <button onclick="stepThrough()">Step Through</button>
        </div>

        <canvas id="canvas" width="1000" height="700"></canvas>

        <div class="info">
            <h3>About DES (Data Encryption Standard)</h3>
            <p>DES was adopted as a federal standard in 1977 and uses a 56-bit key to encrypt 64-bit blocks.
            The Feistel structure splits data into left and right halves, applying 16 rounds of substitution and permutation.
            Each round uses a different subkey derived from the main key. While DES is now considered insecure due to its short key length,
            its Feistel design influenced many modern ciphers including 3DES and Blowfish.</p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let currentRound = 0;
        let isAnimating = false;
        let leftHalf = '';
        let rightHalf = '';
        let animationId = null;

        // Simplified S-box (for visualization)
        const SBOX = [
            [14,4,13,1,2,15,11,8,3,10,6,12,5,9,0,7],
            [0,15,7,4,14,2,13,1,10,6,12,11,9,5,3,8]
        ];

        function textToBinary(text) {
            return text.split('').map(c => c.charCodeAt(0).toString(2).padStart(8,'0')).join('');
        }

        function binaryToHex(bin) {
            let hex = '';
            for (let i = 0; i < bin.length; i += 4) {
                hex += parseInt(bin.substr(i, 4), 2).toString(16).toUpperCase();
            }
            return hex;
        }

        // Simplified Feistel function
        function feistelFunction(right, subkey) {
            let result = '';
            for (let i = 0; i < right.length; i++) {
                result += (parseInt(right[i], 2) ^ parseInt(subkey[i % subkey.length], 2)).toString();
            }
            return result;
        }

        function xor(a, b) {
            let result = '';
            for (let i = 0; i < a.length; i++) {
                result += (parseInt(a[i]) ^ parseInt(b[i % b.length])).toString();
            }
            return result;
        }

        function drawFeistelStructure() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const centerX = canvas.width / 2;
            const startY = 50;
            const boxWidth = 150;
            const boxHeight = 40;
            const roundHeight = 35;

            // Draw title
            ctx.fillStyle = '#00ff88';
            ctx.font = 'bold 18px Courier New';
            ctx.textAlign = 'center';
            ctx.fillText('DES Feistel Network', centerX, 30);

            // Initial split
            ctx.fillStyle = '#00ccff';
            ctx.font = '14px Courier New';
            ctx.fillText('64-bit Plaintext', centerX, startY);

            // Draw L0 and R0
            const leftX = centerX - 100;
            const rightX = centerX + 100;

            ctx.strokeStyle = '#00ff88';
            ctx.lineWidth = 2;

            // Initial permutation box
            ctx.strokeRect(centerX - 80, startY + 10, 160, 30);
            ctx.fillStyle = '#00ff88';
            ctx.fillText('Initial Permutation', centerX, startY + 30);

            // Draw rounds
            for (let round = 0; round <= Math.min(currentRound, 16); round++) {
                const y = startY + 60 + round * roundHeight;

                const isActive = round === currentRound && isAnimating;
                ctx.strokeStyle = isActive ? '#ffff00' : (round < currentRound ? '#00ff88' : '#444');
                ctx.fillStyle = isActive ? '#ffff00' : (round < currentRound ? '#00ff88' : '#666');

                // Left half box
                ctx.strokeRect(leftX - 40, y, 80, 25);
                ctx.fillText(`L${round}`, leftX, y + 17);

                // Right half box
                ctx.strokeRect(rightX - 40, y, 80, 25);
                ctx.fillText(`R${round}`, rightX, y + 17);

                if (round < 16) {
                    // F function
                    ctx.beginPath();
                    ctx.arc(rightX + 80, y + 12, 15, 0, Math.PI * 2);
                    ctx.stroke();
                    ctx.fillText('F', rightX + 80, y + 17);

                    // XOR symbol
                    ctx.beginPath();
                    ctx.arc(leftX, y + roundHeight + 5, 8, 0, Math.PI * 2);
                    ctx.stroke();
                    ctx.fillText('⊕', leftX, y + roundHeight + 8);

                    // Subkey
                    ctx.fillStyle = '#ff8800';
                    ctx.fillText(`K${round + 1}`, rightX + 120, y + 17);

                    // Lines
                    ctx.strokeStyle = isActive ? '#ffff00' : '#333';
                    ctx.beginPath();
                    ctx.moveTo(rightX, y + 25);
                    ctx.lineTo(rightX, y + roundHeight);
                    ctx.lineTo(leftX, y + roundHeight);
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.moveTo(leftX, y + 25);
                    ctx.lineTo(leftX, y + roundHeight + 20);
                    ctx.stroke();
                }
            }

            // Final permutation
            if (currentRound >= 16) {
                const finalY = startY + 60 + 17 * roundHeight;
                ctx.strokeStyle = '#00ff88';
                ctx.fillStyle = '#00ff88';
                ctx.strokeRect(centerX - 80, finalY, 160, 30);
                ctx.fillText('Final Permutation', centerX, finalY + 20);

                ctx.fillStyle = '#00ccff';
                ctx.fillText('64-bit Ciphertext', centerX, finalY + 50);
            }

            // Display current values
            ctx.fillStyle = '#00ff88';
            ctx.textAlign = 'left';
            ctx.fillText(`Round: ${currentRound}/16`, 20, 650);
            ctx.fillText(`Left: ${binaryToHex(leftHalf.substr(0, 32))}`, 20, 670);
            ctx.fillText(`Right: ${binaryToHex(rightHalf.substr(0, 32))}`, 20, 690);
        }

        function runDES() {
            const plaintext = document.getElementById('plaintext').value.padEnd(8, ' ').substr(0, 8);
            const key = document.getElementById('key').value.padEnd(8, ' ').substr(0, 8);

            const binary = textToBinary(plaintext);
            leftHalf = binary.substr(0, 32);
            rightHalf = binary.substr(32, 32);

            currentRound = 0;
            isAnimating = true;

            animateRounds(key);
        }

        function animateRounds(key) {
            if (currentRound > 16) {
                isAnimating = false;
                return;
            }

            drawFeistelStructure();

            if (currentRound < 16) {
                // Generate subkey (simplified)
                const subkey = textToBinary(key).substr(currentRound * 3, 32).padEnd(32, '0');

                // Feistel round
                const fOutput = feistelFunction(rightHalf, subkey);
                const newRight = xor(leftHalf, fOutput);
                leftHalf = rightHalf;
                rightHalf = newRight;
            }

            currentRound++;
            animationId = setTimeout(() => animateRounds(key), 300);
        }

        function stepThrough() {
            if (currentRound === 0) {
                const plaintext = document.getElementById('plaintext').value.padEnd(8, ' ').substr(0, 8);
                const binary = textToBinary(plaintext);
                leftHalf = binary.substr(0, 32);
                rightHalf = binary.substr(32, 32);
            }

            if (currentRound <= 16) {
                const key = document.getElementById('key').value.padEnd(8, ' ').substr(0, 8);

                if (currentRound < 16) {
                    const subkey = textToBinary(key).substr(currentRound * 3, 32).padEnd(32, '0');
                    const fOutput = feistelFunction(rightHalf, subkey);
                    const newRight = xor(leftHalf, fOutput);
                    leftHalf = rightHalf;
                    rightHalf = newRight;
                }

                currentRound++;
                drawFeistelStructure();
            }
        }

        // Initial draw
        leftHalf = '0'.repeat(32);
        rightHalf = '0'.repeat(32);
        drawFeistelStructure();
    </script>
</body>
</html>
