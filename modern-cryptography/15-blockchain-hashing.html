<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blockchain Hashing - Proof of Work Mining</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            color: #00ff88;
            min-height: 100vh;
            padding: 20px;
        }
        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #00ff88;
            text-decoration: none;
            padding: 10px 20px;
            background: rgba(0,255,136,0.1);
            border: 1px solid #00ff88;
            border-radius: 5px;
            z-index: 100;
        }
        .back-link:hover { background: rgba(0,255,136,0.2); }
        .container {
            max-width: 1000px;
            margin: 60px auto 0;
        }
        h1 { font-size: 2rem; margin-bottom: 10px; text-align: center; }
        .subtitle { color: #888; margin-bottom: 30px; text-align: center; }
        .blockchain {
            display: flex;
            gap: 20px;
            overflow-x: auto;
            padding: 20px 0;
            margin-bottom: 30px;
        }
        .block {
            min-width: 280px;
            background: rgba(0,0,0,0.5);
            border: 2px solid #00ff88;
            border-radius: 15px;
            padding: 20px;
            position: relative;
        }
        .block.genesis { border-color: #ffaa00; }
        .block.mining { border-color: #ffff00; animation: pulse 0.5s infinite; }
        .block.invalid { border-color: #ff4444; }
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 10px rgba(255,255,0,0.3); }
            50% { box-shadow: 0 0 20px rgba(255,255,0,0.6); }
        }
        .block-header {
            color: #00ccff;
            margin-bottom: 15px;
            font-weight: bold;
        }
        .block-field {
            margin: 8px 0;
            font-size: 0.85rem;
        }
        .block-field label {
            color: #888;
            display: block;
            font-size: 0.75rem;
        }
        .block-field .value {
            word-break: break-all;
            padding: 5px;
            background: rgba(0,255,136,0.1);
            border-radius: 3px;
            margin-top: 3px;
        }
        .block-field input {
            width: 100%;
            padding: 8px;
            font-size: 0.85rem;
            font-family: inherit;
            background: rgba(0,255,136,0.1);
            border: 1px solid #00ff88;
            color: #00ff88;
            border-radius: 3px;
        }
        .hash-display {
            font-size: 0.7rem;
            color: #00ff88;
        }
        .hash-display.invalid { color: #ff4444; }
        .chain-link {
            position: absolute;
            right: -20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5rem;
            color: #00ff88;
        }
        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        button {
            padding: 12px 25px;
            font-size: 1rem;
            font-family: inherit;
            background: rgba(0,255,136,0.1);
            border: 1px solid #00ff88;
            color: #00ff88;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover { background: rgba(0,255,136,0.3); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .mining-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        .stat-box {
            background: rgba(0,0,0,0.5);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-value {
            font-size: 1.5rem;
            color: #00ccff;
        }
        .stat-label {
            color: #888;
            font-size: 0.8rem;
        }
        .difficulty-slider {
            background: rgba(0,255,136,0.05);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        .difficulty-slider label { color: #00ccff; }
        .difficulty-slider input[type="range"] {
            width: 100%;
            margin: 10px 0;
        }
        .target-display {
            font-size: 0.8rem;
            color: #888;
            word-break: break-all;
        }
        .info {
            padding: 20px;
            background: rgba(0,255,136,0.05);
            border-radius: 10px;
        }
        .info h3 { color: #00ccff; margin-bottom: 10px; }
        .info p { color: #aaa; line-height: 1.6; margin-bottom: 10px; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back</a>
    <div class="container">
        <h1>Blockchain Hashing</h1>
        <p class="subtitle">Understanding Proof of Work Mining</p>

        <div class="difficulty-slider">
            <label>Difficulty (leading zeros required): <span id="difficultyValue">4</span></label>
            <input type="range" id="difficulty" min="1" max="6" value="4" onchange="updateDifficulty()">
            <div class="target-display">
                Target: Hash must start with <span id="targetZeros">0000</span>...
            </div>
        </div>

        <div class="mining-stats">
            <div class="stat-box">
                <div class="stat-value" id="hashRate">0</div>
                <div class="stat-label">Hashes/sec</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="totalHashes">0</div>
                <div class="stat-label">Total Hashes</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="currentNonce">0</div>
                <div class="stat-label">Current Nonce</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="blockCount">1</div>
                <div class="stat-label">Blocks</div>
            </div>
        </div>

        <div class="controls">
            <button onclick="addBlock()">Add Block</button>
            <button onclick="startMining()" id="mineBtn">Mine Block</button>
            <button onclick="stopMining()" id="stopBtn" disabled>Stop Mining</button>
            <button onclick="tamperBlock()">Tamper (Demo)</button>
        </div>

        <div class="blockchain" id="blockchain"></div>

        <div class="info">
            <h3>How Proof of Work Mining Works</h3>
            <p><strong>The Challenge:</strong> Find a nonce (number) that, when combined with block data and hashed,
            produces a hash starting with a specific number of zeros.</p>
            <p><strong>Why It's Hard:</strong> SHA-256 is unpredictable - you can only guess and check.
            More leading zeros = exponentially more guesses needed.</p>
            <p><strong>Chain Integrity:</strong> Each block contains the previous block's hash.
            Changing any block invalidates all subsequent blocks, requiring re-mining of the entire chain.</p>
        </div>
    </div>

    <script>
        let blockchain = [];
        let difficulty = 4;
        let isMining = false;
        let miningInterval = null;
        let totalHashes = 0;
        let hashesThisSecond = 0;

        async function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        function updateDifficulty() {
            difficulty = parseInt(document.getElementById('difficulty').value);
            document.getElementById('difficultyValue').textContent = difficulty;
            document.getElementById('targetZeros').textContent = '0'.repeat(difficulty);
        }

        async function calculateBlockHash(block) {
            const data = block.index + block.previousHash + block.timestamp + block.data + block.nonce;
            return await sha256(data);
        }

        async function isValidHash(hash) {
            return hash.startsWith('0'.repeat(difficulty));
        }

        function createGenesisBlock() {
            return {
                index: 0,
                previousHash: '0'.repeat(64),
                timestamp: Date.now(),
                data: 'Genesis Block',
                nonce: 0,
                hash: ''
            };
        }

        async function initBlockchain() {
            const genesis = createGenesisBlock();
            // Pre-mine genesis with difficulty 1
            let tempDifficulty = difficulty;
            difficulty = 1;
            for (let nonce = 0; nonce < 1000000; nonce++) {
                genesis.nonce = nonce;
                genesis.hash = await calculateBlockHash(genesis);
                if (await isValidHash(genesis.hash)) break;
            }
            difficulty = tempDifficulty;

            blockchain = [genesis];
            renderBlockchain();
        }

        function renderBlockchain() {
            const container = document.getElementById('blockchain');
            container.innerHTML = '';

            blockchain.forEach((block, index) => {
                const blockEl = document.createElement('div');
                blockEl.className = 'block' + (index === 0 ? ' genesis' : '');
                blockEl.id = `block-${index}`;

                const isValid = block.hash.startsWith('0'.repeat(difficulty)) &&
                    (index === 0 || block.previousHash === blockchain[index-1].hash);

                if (!isValid && index > 0) blockEl.classList.add('invalid');

                blockEl.innerHTML = `
                    <div class="block-header">Block #${block.index}</div>
                    <div class="block-field">
                        <label>Data:</label>
                        <input type="text" value="${block.data}" onchange="updateBlockData(${index}, this.value)">
                    </div>
                    <div class="block-field">
                        <label>Nonce:</label>
                        <div class="value">${block.nonce}</div>
                    </div>
                    <div class="block-field">
                        <label>Previous Hash:</label>
                        <div class="value hash-display">${block.previousHash.substring(0, 20)}...</div>
                    </div>
                    <div class="block-field">
                        <label>Hash:</label>
                        <div class="value hash-display ${isValid ? '' : 'invalid'}">${block.hash.substring(0, 20)}...</div>
                    </div>
                    ${index < blockchain.length - 1 ? '<div class="chain-link">üîó</div>' : ''}
                `;

                container.appendChild(blockEl);
            });

            document.getElementById('blockCount').textContent = blockchain.length;
        }

        async function updateBlockData(index, newData) {
            blockchain[index].data = newData;
            blockchain[index].hash = await calculateBlockHash(blockchain[index]);
            renderBlockchain();
        }

        function addBlock() {
            const lastBlock = blockchain[blockchain.length - 1];
            const newBlock = {
                index: blockchain.length,
                previousHash: lastBlock.hash,
                timestamp: Date.now(),
                data: `Block ${blockchain.length} Data`,
                nonce: 0,
                hash: ''
            };
            blockchain.push(newBlock);
            renderBlockchain();
        }

        async function startMining() {
            const lastIndex = blockchain.length - 1;
            const block = blockchain[lastIndex];

            if (await isValidHash(block.hash)) {
                alert('Block already mined!');
                return;
            }

            isMining = true;
            document.getElementById('mineBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            document.getElementById(`block-${lastIndex}`).classList.add('mining');

            let nonce = 0;
            const startTime = performance.now();
            let lastUpdate = startTime;

            const mine = async () => {
                if (!isMining) return;

                const batchSize = 100;
                for (let i = 0; i < batchSize && isMining; i++) {
                    block.nonce = nonce;
                    block.hash = await calculateBlockHash(block);
                    totalHashes++;
                    hashesThisSecond++;
                    nonce++;

                    if (await isValidHash(block.hash)) {
                        isMining = false;
                        document.getElementById('mineBtn').disabled = false;
                        document.getElementById('stopBtn').disabled = true;
                        document.getElementById(`block-${lastIndex}`).classList.remove('mining');
                        renderBlockchain();
                        alert(`Block mined! Nonce: ${block.nonce}\nHash: ${block.hash}`);
                        return;
                    }
                }

                const now = performance.now();
                if (now - lastUpdate > 100) {
                    document.getElementById('currentNonce').textContent = nonce.toLocaleString();
                    document.getElementById('totalHashes').textContent = totalHashes.toLocaleString();
                    lastUpdate = now;
                }

                requestAnimationFrame(mine);
            };

            // Update hash rate every second
            setInterval(() => {
                document.getElementById('hashRate').textContent = hashesThisSecond.toLocaleString();
                hashesThisSecond = 0;
            }, 1000);

            mine();
        }

        function stopMining() {
            isMining = false;
            document.getElementById('mineBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            const lastIndex = blockchain.length - 1;
            document.getElementById(`block-${lastIndex}`).classList.remove('mining');
        }

        function tamperBlock() {
            if (blockchain.length > 1) {
                blockchain[1].data = 'TAMPERED DATA';
                renderBlockchain();
                setTimeout(() => {
                    alert('Notice how tampering invalidates the block hash and breaks the chain!');
                }, 100);
            }
        }

        // Initialize
        initBlockchain();
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
