<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Padding Oracle Attack - CBC Mode Vulnerability</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            color: #00ff88;
            min-height: 100vh;
            padding: 20px;
        }
        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #00ff88;
            text-decoration: none;
            padding: 10px 20px;
            background: rgba(0,255,136,0.1);
            border: 1px solid #00ff88;
            border-radius: 5px;
            z-index: 100;
        }
        .back-link:hover { background: rgba(0,255,136,0.2); }
        .container {
            max-width: 1000px;
            margin: 60px auto 0;
        }
        h1 { font-size: 2rem; margin-bottom: 10px; text-align: center; }
        .subtitle { color: #888; margin-bottom: 30px; text-align: center; }
        .warning {
            background: rgba(255,68,68,0.1);
            border: 1px solid #ff4444;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        .warning h3 { color: #ff4444; margin-bottom: 10px; }
        .warning p { color: #aaa; }
        .demo-container {
            background: rgba(0,0,0,0.5);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid #00ff88;
            margin-bottom: 30px;
        }
        .demo-container h3 { color: #00ccff; margin-bottom: 20px; text-align: center; }
        .ciphertext-display {
            display: grid;
            grid-template-columns: repeat(16, 1fr);
            gap: 5px;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
        }
        .byte {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0,255,136,0.1);
            border-radius: 5px;
            font-size: 0.7rem;
            transition: all 0.3s;
        }
        .byte.testing { background: rgba(255,255,0,0.3); border: 1px solid #ffff00; }
        .byte.found { background: rgba(0,255,136,0.3); border: 1px solid #00ff88; }
        .byte.current { background: rgba(255,102,170,0.3); border: 2px solid #ff66aa; }
        .oracle-display {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
        }
        .oracle-response {
            padding: 20px 40px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.2rem;
        }
        .oracle-response.valid { background: rgba(0,255,136,0.2); border: 2px solid #00ff88; }
        .oracle-response.invalid { background: rgba(255,68,68,0.2); border: 2px solid #ff4444; color: #ff4444; }
        .progress {
            margin: 20px 0;
        }
        .progress-bar {
            height: 10px;
            background: rgba(0,255,136,0.2);
            border-radius: 5px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: #00ff88;
            transition: width 0.1s;
        }
        .recovered-text {
            padding: 20px;
            background: rgba(0,255,136,0.1);
            border-radius: 10px;
            text-align: center;
            font-size: 1.5rem;
            margin: 20px 0;
            letter-spacing: 3px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        .stat {
            text-align: center;
            padding: 15px;
            background: rgba(0,255,136,0.05);
            border-radius: 10px;
        }
        .stat-value { font-size: 1.5rem; color: #00ccff; }
        .stat-label { color: #888; font-size: 0.85rem; }
        button {
            display: block;
            margin: 20px auto;
            padding: 15px 40px;
            font-size: 1rem;
            font-family: inherit;
            background: rgba(0,255,136,0.1);
            border: 1px solid #00ff88;
            color: #00ff88;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover { background: rgba(0,255,136,0.3); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .explanation {
            background: rgba(0,255,136,0.05);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .explanation h4 { color: #00ccff; margin-bottom: 10px; }
        .explanation p { color: #aaa; line-height: 1.6; margin-bottom: 10px; }
        .info {
            padding: 20px;
            background: rgba(0,255,136,0.05);
            border-radius: 10px;
        }
        .info h3 { color: #00ccff; margin-bottom: 10px; }
        .info p { color: #aaa; line-height: 1.6; margin-bottom: 10px; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back</a>
    <div class="container">
        <h1>Padding Oracle Attack</h1>
        <p class="subtitle">Exploiting error messages to decrypt CBC ciphertext</p>

        <div class="warning">
            <h3>‚ö†Ô∏è Educational Demonstration</h3>
            <p>This attack was discovered in 2002 and has been used against SSL, ASP.NET, and many other systems.
            Never implement your own crypto without authenticated encryption (like AES-GCM)!</p>
        </div>

        <div class="explanation">
            <h4>How It Works</h4>
            <p>In CBC mode, PKCS#7 padding is added to make plaintext a multiple of block size. Valid padding ends with:</p>
            <p style="font-family:monospace;background:rgba(0,0,0,0.3);padding:10px;border-radius:5px;margin:10px 0;">
                ...01 | ...02 02 | ...03 03 03 | ...04 04 04 04 | etc.
            </p>
            <p>A "padding oracle" is any system that tells you whether decrypted padding is valid. By manipulating ciphertext bytes and observing responses, we can decrypt <strong>one byte at a time</strong> without knowing the key!</p>
        </div>

        <div class="demo-container">
            <h3>Live Attack Simulation</h3>

            <div style="text-align:center;color:#888;margin-bottom:10px;">
                Ciphertext Block (16 bytes)
            </div>
            <div class="ciphertext-display" id="ciphertext"></div>

            <div class="oracle-display">
                <div class="oracle-response" id="oracleResponse">
                    Waiting...
                </div>
            </div>

            <div class="progress">
                <div style="display:flex;justify-content:space-between;margin-bottom:5px;">
                    <span style="color:#888;">Attack Progress</span>
                    <span id="progressPercent">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width:0%"></div>
                </div>
            </div>

            <div style="text-align:center;color:#888;">Recovered Plaintext:</div>
            <div class="recovered-text" id="recoveredText">????????????????</div>

            <div class="stats">
                <div class="stat">
                    <div class="stat-value" id="bytesRecovered">0</div>
                    <div class="stat-label">Bytes Recovered</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="oracleQueries">0</div>
                    <div class="stat-label">Oracle Queries</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="avgQueries">-</div>
                    <div class="stat-label">Avg Queries/Byte</div>
                </div>
            </div>

            <button onclick="startAttack()" id="startBtn">Start Padding Oracle Attack</button>
            <button onclick="resetAttack()" id="resetBtn" style="display:none;">Reset</button>
        </div>

        <div class="info">
            <h3>Defense: Authenticated Encryption</h3>
            <p>Modern systems should use <strong>AEAD</strong> (Authenticated Encryption with Associated Data) modes like:</p>
            <p>‚Ä¢ <strong>AES-GCM:</strong> Combines encryption with authentication tag</p>
            <p>‚Ä¢ <strong>ChaCha20-Poly1305:</strong> Stream cipher with MAC</p>
            <p>These modes detect tampering before decryption, eliminating padding oracles entirely.</p>
        </div>
    </div>

    <script>
        // Simulated secret plaintext
        const SECRET = "ATTACKATSUNRISE";
        const BLOCK_SIZE = 16;

        let isAttacking = false;
        let recoveredBytes = [];
        let oracleQueries = 0;
        let currentByteIndex = 15;

        // Simulated encryption (just for demo visualization)
        function generateCiphertext() {
            const ciphertext = [];
            for (let i = 0; i < BLOCK_SIZE; i++) {
                ciphertext.push(Math.floor(Math.random() * 256));
            }
            return ciphertext;
        }

        // Simulated padding oracle
        function paddingOracle(modifiedCiphertext, targetPadding) {
            oracleQueries++;
            document.getElementById('oracleQueries').textContent = oracleQueries;

            // Simulate: valid padding if we guessed the right intermediate byte
            // In real attack, this would be a network request to the server
            return Math.random() < 0.004; // ~1/256 chance of "valid" padding
        }

        function renderCiphertext(ciphertext, currentByte = -1, testingByte = -1) {
            const container = document.getElementById('ciphertext');
            container.innerHTML = '';

            for (let i = 0; i < BLOCK_SIZE; i++) {
                const cell = document.createElement('div');
                cell.className = 'byte';

                if (i === currentByte) cell.classList.add('current');
                if (i === testingByte) cell.classList.add('testing');
                if (recoveredBytes[BLOCK_SIZE - 1 - i] !== undefined) cell.classList.add('found');

                cell.textContent = ciphertext[i].toString(16).padStart(2, '0').toUpperCase();
                container.appendChild(cell);
            }
        }

        function updateRecoveredText() {
            const text = recoveredBytes.map(b =>
                b !== undefined ? String.fromCharCode(b) : '?'
            ).reverse().join('');

            document.getElementById('recoveredText').textContent =
                text.split('').reverse().join('');
        }

        function updateOracle(isValid) {
            const oracle = document.getElementById('oracleResponse');
            if (isValid) {
                oracle.className = 'oracle-response valid';
                oracle.textContent = '‚úì Valid Padding';
            } else {
                oracle.className = 'oracle-response invalid';
                oracle.textContent = '‚úó Invalid Padding';
            }
        }

        async function startAttack() {
            if (isAttacking) return;
            isAttacking = true;

            document.getElementById('startBtn').disabled = true;
            document.getElementById('resetBtn').style.display = 'block';

            const ciphertext = generateCiphertext();
            recoveredBytes = [];
            oracleQueries = 0;
            currentByteIndex = BLOCK_SIZE - 1;

            renderCiphertext(ciphertext);

            // Recover each byte from last to first
            for (let bytePos = BLOCK_SIZE - 1; bytePos >= 0 && isAttacking; bytePos--) {
                const targetPadding = BLOCK_SIZE - bytePos;

                document.getElementById('progressPercent').textContent =
                    Math.round((BLOCK_SIZE - bytePos) / BLOCK_SIZE * 100) + '%';
                document.getElementById('progressFill').style.width =
                    ((BLOCK_SIZE - bytePos) / BLOCK_SIZE * 100) + '%';

                // Try all possible byte values
                for (let guess = 0; guess < 256 && isAttacking; guess++) {
                    const modifiedCipher = [...ciphertext];
                    modifiedCipher[bytePos] ^= guess;

                    renderCiphertext(modifiedCipher, bytePos, bytePos);

                    // Simulate oracle query
                    const isValid = paddingOracle(modifiedCipher, targetPadding);
                    updateOracle(isValid);

                    await new Promise(r => setTimeout(r, 5));

                    if (isValid || guess === 255) {
                        // Found the intermediate byte!
                        const intermediateValue = guess ^ targetPadding;
                        // In real attack, we'd XOR with original ciphertext to get plaintext

                        // For demo, reveal the actual secret character
                        recoveredBytes[BLOCK_SIZE - 1 - bytePos] = SECRET.charCodeAt(bytePos);
                        updateRecoveredText();

                        document.getElementById('bytesRecovered').textContent = BLOCK_SIZE - bytePos;
                        document.getElementById('avgQueries').textContent =
                            Math.round(oracleQueries / (BLOCK_SIZE - bytePos));

                        break;
                    }
                }
            }

            if (isAttacking) {
                document.getElementById('oracleResponse').className = 'oracle-response valid';
                document.getElementById('oracleResponse').innerHTML =
                    'üéâ Attack Complete!<br>All bytes recovered';
            }

            isAttacking = false;
            document.getElementById('startBtn').disabled = false;
        }

        function resetAttack() {
            isAttacking = false;
            recoveredBytes = [];
            oracleQueries = 0;

            document.getElementById('progressPercent').textContent = '0%';
            document.getElementById('progressFill').style.width = '0%';
            document.getElementById('recoveredText').textContent = '????????????????';
            document.getElementById('bytesRecovered').textContent = '0';
            document.getElementById('oracleQueries').textContent = '0';
            document.getElementById('avgQueries').textContent = '-';
            document.getElementById('oracleResponse').className = 'oracle-response';
            document.getElementById('oracleResponse').textContent = 'Waiting...';
            document.getElementById('ciphertext').innerHTML = '';
            document.getElementById('startBtn').disabled = false;
            document.getElementById('resetBtn').style.display = 'none';
        }

        // Initial render
        renderCiphertext(generateCiphertext());
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
