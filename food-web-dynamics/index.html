<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Food Web Network Dynamics</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: sans-serif; }
canvas { display: block; cursor: pointer; }
#title {
    position: fixed; top: 50px; left: 50%; transform: translateX(-50%);
    color: #fbbf24; font-size: 22px; font-weight: bold; text-align: center;
    text-shadow: 0 0 20px rgba(251,191,36,0.3); z-index: 10; pointer-events: none;
}
#info {
    position: fixed; top: 85px; left: 50%; transform: translateX(-50%);
    color: #999; font-size: 12px; text-align: center; z-index: 10; pointer-events: none;
}
#controls {
    position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
    display: flex; gap: 20px; z-index: 10; background: rgba(0,0,0,0.7);
    padding: 12px 20px; border-radius: 10px; align-items: center;
}
button {
    background: rgba(251,191,36,0.2); color: #fbbf24; border: 1px solid #fbbf24;
    padding: 6px 14px; border-radius: 6px; cursor: pointer; font-size: 12px;
}
button:hover { background: rgba(251,191,36,0.4); }
#legend {
    position: fixed; top: 50px; right: 20px; color: #ccc; font-size: 12px;
    background: rgba(0,0,0,0.7); padding: 12px 16px; border-radius: 8px; z-index: 10;
    line-height: 2;
}
.leg-item { display: flex; align-items: center; gap: 8px; }
.leg-dot { width: 12px; height: 12px; border-radius: 50%; display: inline-block; }
#tooltip {
    position: fixed; display: none; background: rgba(0,0,0,0.9); color: #fbbf24;
    padding: 8px 12px; border-radius: 6px; font-size: 12px; z-index: 20;
    pointer-events: none; border: 1px solid rgba(251,191,36,0.3);
}
</style>
</head>
<body>
<a href="../index.html" style="position:fixed;top:10px;left:10px;padding:8px 16px;background:rgba(0,0,0,0.7);color:#fbbf24;text-decoration:none;border-radius:6px;font-size:14px;z-index:999;font-family:sans-serif;">‚Üê Back to Gallery</a>
<div id="title">Food Web Network Dynamics</div>
<div id="info">Click on a species node to remove it and see cascading effects</div>
<div id="legend">
    <div class="leg-item"><span class="leg-dot" style="background:#4ade80;"></span> Producers</div>
    <div class="leg-item"><span class="leg-dot" style="background:#fbbf24;"></span> Primary Consumers</div>
    <div class="leg-item"><span class="leg-dot" style="background:#f97316;"></span> Secondary Consumers</div>
    <div class="leg-item"><span class="leg-dot" style="background:#ef4444;"></span> Apex Predators</div>
</div>
<div id="tooltip"></div>
<div id="controls">
    <button id="resetBtn">Reset Ecosystem</button>
    <button id="removeRandom">Remove Random Species</button>
</div>
<canvas id="canvas"></canvas>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const tooltip = document.getElementById('tooltip');

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    if (species.length > 0) layoutSpecies();
}

function layoutSpecies() {
    let w = canvas.width;
    let h = canvas.height;
    let tiers = [
        species.filter(s => s.tier === 0),
        species.filter(s => s.tier === 1),
        species.filter(s => s.tier === 2),
        species.filter(s => s.tier === 3)
    ];
    let tierY = [h * 0.78, h * 0.56, h * 0.36, h * 0.18];
    for (let t = 0; t < 4; t++) {
        let count = tiers[t].length;
        for (let i = 0; i < count; i++) {
            let sp = tiers[t][i];
            sp.tx = w * 0.15 + (w * 0.7) * (i + 0.5) / count;
            sp.ty = tierY[t];
        }
    }
}

resize();
window.addEventListener('resize', resize);

const TIER_COLORS = [
    [74, 222, 128],   // producers
    [251, 191, 36],   // primary consumers
    [249, 115, 22],   // secondary consumers
    [239, 68, 68]     // apex predators
];

const SPECIES_DATA = [
    // Tier 0: Producers
    { name: 'Grass', tier: 0 },
    { name: 'Algae', tier: 0 },
    { name: 'Oak Tree', tier: 0 },
    { name: 'Wildflowers', tier: 0 },
    { name: 'Phytoplankton', tier: 0 },
    // Tier 1: Primary consumers
    { name: 'Rabbit', tier: 1 },
    { name: 'Deer', tier: 1 },
    { name: 'Caterpillar', tier: 1 },
    { name: 'Mouse', tier: 1 },
    { name: 'Zooplankton', tier: 1 },
    // Tier 2: Secondary consumers
    { name: 'Snake', tier: 2 },
    { name: 'Fox', tier: 2 },
    { name: 'Owl', tier: 2 },
    { name: 'Small Fish', tier: 2 },
    // Tier 3: Apex predators
    { name: 'Eagle', tier: 3 },
    { name: 'Wolf', tier: 3 },
    { name: 'Shark', tier: 3 }
];

const FOOD_LINKS = [
    [0, 5], [0, 6], [0, 8],    // grass -> rabbit, deer, mouse
    [1, 9], [1, 7],             // algae -> zooplankton, caterpillar
    [2, 5], [2, 7], [2, 8],    // oak -> rabbit, caterpillar, mouse
    [3, 5], [3, 7],             // wildflowers -> rabbit, caterpillar
    [4, 9],                      // phytoplankton -> zooplankton
    [5, 10], [5, 11],           // rabbit -> snake, fox
    [6, 15],                     // deer -> wolf
    [7, 12], [7, 13],           // caterpillar -> owl, small fish
    [8, 10], [8, 12],           // mouse -> snake, owl
    [9, 13],                     // zooplankton -> small fish
    [10, 14], [10, 12],         // snake -> eagle, owl
    [11, 14], [11, 15],         // fox -> eagle, wolf
    [13, 16],                    // small fish -> shark
    [12, 14],                    // owl -> eagle
];

let species = [];
let links = [];
let removedSpecies = new Set();

class Species {
    constructor(data, index) {
        this.name = data.name;
        this.tier = data.tier;
        this.index = index;
        this.x = 0; this.y = 0;
        this.tx = 0; this.ty = 0;
        this.population = 80 + Math.random() * 40;
        this.targetPop = this.population;
        this.alive = true;
        this.pulse = Math.random() * Math.PI * 2;
        this.dying = false;
        this.dyingTimer = 0;
        this.shakeX = 0;
        this.shakeY = 0;
    }

    update() {
        this.pulse += 0.03;
        this.x += (this.tx - this.x) * 0.05;
        this.y += (this.ty - this.y) * 0.05;

        if (this.dying) {
            this.dyingTimer++;
            this.population *= 0.97;
            this.shakeX = (Math.random() - 0.5) * 4;
            this.shakeY = (Math.random() - 0.5) * 4;
            if (this.population < 1) {
                this.alive = false;
                this.population = 0;
                removedSpecies.add(this.index);
                cascadeRemoval(this.index);
            }
        } else {
            this.shakeX *= 0.9;
            this.shakeY *= 0.9;
            this.population += (this.targetPop - this.population) * 0.02;
            this.population = Math.max(0, Math.min(120, this.population));
        }
    }

    draw(ctx) {
        if (!this.alive) return;
        let c = TIER_COLORS[this.tier];
        let radius = 12 + (this.population / 120) * 20 + Math.sin(this.pulse) * 2;
        let dx = this.x + this.shakeX;
        let dy = this.y + this.shakeY;

        // Glow
        let glow = ctx.createRadialGradient(dx, dy, 0, dx, dy, radius * 2);
        glow.addColorStop(0, `rgba(${c[0]}, ${c[1]}, ${c[2]}, 0.15)`);
        glow.addColorStop(1, `rgba(${c[0]}, ${c[1]}, ${c[2]}, 0)`);
        ctx.beginPath();
        ctx.arc(dx, dy, radius * 2, 0, Math.PI * 2);
        ctx.fillStyle = glow;
        ctx.fill();

        // Node
        ctx.beginPath();
        ctx.arc(dx, dy, radius, 0, Math.PI * 2);
        let alpha = this.dying ? 0.3 + Math.sin(this.dyingTimer * 0.3) * 0.3 : 0.8;
        ctx.fillStyle = `rgba(${c[0]}, ${c[1]}, ${c[2]}, ${alpha})`;
        ctx.strokeStyle = `rgba(${c[0]}, ${c[1]}, ${c[2]}, ${alpha + 0.2})`;
        ctx.lineWidth = 2;
        ctx.fill();
        ctx.stroke();

        // Name
        ctx.fillStyle = `rgba(255,255,255, ${alpha})`;
        ctx.font = '10px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText(this.name, dx, dy + radius + 14);

        // Population bar
        let barW = radius * 1.5;
        let barH = 3;
        ctx.fillStyle = 'rgba(0,0,0,0.5)';
        ctx.fillRect(dx - barW / 2, dy + radius + 18, barW, barH);
        ctx.fillStyle = `rgba(${c[0]}, ${c[1]}, ${c[2]}, 0.8)`;
        ctx.fillRect(dx - barW / 2, dy + radius + 18, barW * (this.population / 120), barH);
    }
}

function cascadeRemoval(removedIdx) {
    for (let sp of species) {
        if (!sp.alive || sp.dying) continue;
        // Check if this species has lost a food source
        let foodSources = links.filter(l => l[1] === sp.index && !removedSpecies.has(l[0]));
        let originalSources = FOOD_LINKS.filter(l => l[1] === sp.index);
        if (sp.tier > 0 && originalSources.length > 0) {
            let remaining = foodSources.length;
            if (remaining === 0) {
                sp.dying = true;
            } else {
                let ratio = remaining / originalSources.length;
                sp.targetPop = sp.targetPop * ratio;
                if (sp.targetPop < 10) sp.dying = true;
            }
        }
        // If a predator is removed, prey populations increase
        let predators = links.filter(l => l[0] === sp.index && !removedSpecies.has(l[1]));
        let originalPredators = FOOD_LINKS.filter(l => l[0] === sp.index);
        if (originalPredators.length > 0) {
            let removedPredCount = originalPredators.length - predators.length;
            if (removedPredCount > 0) {
                sp.targetPop = Math.min(120, sp.targetPop * (1 + removedPredCount * 0.2));
            }
        }
    }
}

function init() {
    species = [];
    links = [...FOOD_LINKS];
    removedSpecies.clear();
    for (let i = 0; i < SPECIES_DATA.length; i++) {
        species.push(new Species(SPECIES_DATA[i], i));
    }
    layoutSpecies();
    for (let sp of species) {
        sp.x = sp.tx;
        sp.y = sp.ty;
    }
}

document.getElementById('resetBtn').onclick = init;
document.getElementById('removeRandom').onclick = function() {
    let alive = species.filter(s => s.alive && !s.dying);
    if (alive.length > 0) {
        let target = alive[Math.floor(Math.random() * alive.length)];
        target.dying = true;
    }
};

init();

canvas.addEventListener('click', function(e) {
    let mx = e.clientX, my = e.clientY;
    for (let sp of species) {
        if (!sp.alive || sp.dying) continue;
        let dx = mx - sp.x, dy = my - sp.y;
        let radius = 12 + (sp.population / 120) * 20;
        if (dx * dx + dy * dy < radius * radius * 1.5) {
            sp.dying = true;
            break;
        }
    }
});

canvas.addEventListener('mousemove', function(e) {
    let mx = e.clientX, my = e.clientY;
    let found = false;
    for (let sp of species) {
        if (!sp.alive) continue;
        let dx = mx - sp.x, dy = my - sp.y;
        let radius = 12 + (sp.population / 120) * 20;
        if (dx * dx + dy * dy < radius * radius * 1.5) {
            tooltip.style.display = 'block';
            tooltip.style.left = (mx + 15) + 'px';
            tooltip.style.top = (my - 10) + 'px';
            let status = sp.dying ? ' (declining)' : '';
            tooltip.innerHTML = `<strong>${sp.name}</strong>${status}<br>Pop: ${Math.round(sp.population)}<br>Tier: ${['Producer','Primary Consumer','Secondary Consumer','Apex Predator'][sp.tier]}`;
            found = true;
            break;
        }
    }
    if (!found) tooltip.style.display = 'none';
});

function drawLinks(ctx) {
    for (let link of links) {
        let from = species[link[0]];
        let to = species[link[1]];
        if (!from.alive || !to.alive) continue;

        let alpha = 0.15;
        if (from.dying || to.dying) alpha = 0.05;

        let c1 = TIER_COLORS[from.tier];
        let c2 = TIER_COLORS[to.tier];

        ctx.beginPath();
        let midY = (from.y + to.y) / 2;
        ctx.moveTo(from.x, from.y);
        ctx.quadraticCurveTo((from.x + to.x) / 2, midY - 20, to.x, to.y);

        let grad = ctx.createLinearGradient(from.x, from.y, to.x, to.y);
        grad.addColorStop(0, `rgba(${c1[0]}, ${c1[1]}, ${c1[2]}, ${alpha})`);
        grad.addColorStop(1, `rgba(${c2[0]}, ${c2[1]}, ${c2[2]}, ${alpha})`);
        ctx.strokeStyle = grad;
        ctx.lineWidth = 1.5;
        ctx.stroke();

        // Energy flow particles
        if (!from.dying && !to.dying && Math.random() < 0.02) {
            let t = (Date.now() * 0.001 + link[0] * 0.5) % 1;
            let px = from.x + (to.x - from.x) * t;
            let py = from.y + (to.y - from.y) * t - Math.sin(t * Math.PI) * 20;
            ctx.beginPath();
            ctx.arc(px, py, 2, 0, Math.PI * 2);
            ctx.fillStyle = `rgba(${c2[0]}, ${c2[1]}, ${c2[2]}, 0.6)`;
            ctx.fill();
        }
    }
}

function draw() {
    ctx.fillStyle = '#0a0e1a';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Background gradient
    let grad = ctx.createRadialGradient(
        canvas.width / 2, canvas.height / 2, 0,
        canvas.width / 2, canvas.height / 2, canvas.width * 0.5
    );
    grad.addColorStop(0, 'rgba(20,15,35,0.5)');
    grad.addColorStop(1, 'rgba(10,14,26,0)');
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Tier labels
    let tierLabels = ['Producers', 'Primary Consumers', 'Secondary Consumers', 'Apex Predators'];
    let tierY = [canvas.height * 0.78, canvas.height * 0.56, canvas.height * 0.36, canvas.height * 0.18];
    ctx.font = '11px sans-serif';
    ctx.textAlign = 'left';
    for (let t = 0; t < 4; t++) {
        ctx.fillStyle = `rgba(${TIER_COLORS[t][0]}, ${TIER_COLORS[t][1]}, ${TIER_COLORS[t][2]}, 0.4)`;
        ctx.fillText(tierLabels[t], 20, tierY[t] - 35);
        ctx.strokeStyle = `rgba(${TIER_COLORS[t][0]}, ${TIER_COLORS[t][1]}, ${TIER_COLORS[t][2]}, 0.08)`;
        ctx.setLineDash([4, 8]);
        ctx.beginPath();
        ctx.moveTo(20, tierY[t] - 30);
        ctx.lineTo(canvas.width - 20, tierY[t] - 30);
        ctx.stroke();
        ctx.setLineDash([]);
    }

    drawLinks(ctx);

    for (let sp of species) {
        sp.update();
        sp.draw(ctx);
    }
}

function animate() {
    draw();
    requestAnimationFrame(animate);
}
animate();
</script>
</body>
</html>
