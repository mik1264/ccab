<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simpson's Paradox | Surprising Mathematical Phenomena</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600;700&family=Nunito:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --sage: #8A9A5B;
            --moss: #606C38;
            --earth: #DDA15E;
            --cream: #FEFAE0;
            --terracotta: #BC6C25;
            --dark-moss: #3d4423;
            --blue: #4A90A4;
            --pink: #C77A8B;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, var(--cream) 0%, #F4F1DE 50%, #EDE8D5 100%);
            min-height: 100vh;
            color: var(--dark-moss);
            overflow-x: hidden;
        }

        .organic-shape {
            position: fixed;
            border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
            opacity: 0.1;
            z-index: 0;
            animation: morph 30s ease-in-out infinite;
        }

        .shape-1 {
            width: 600px;
            height: 600px;
            background: var(--sage);
            top: -200px;
            right: -200px;
        }

        .shape-2 {
            width: 400px;
            height: 400px;
            background: var(--earth);
            bottom: -100px;
            left: -100px;
            animation-delay: -10s;
        }

        @keyframes morph {
            0%, 100% { border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%; }
            25% { border-radius: 58% 42% 75% 25% / 76% 46% 54% 24%; }
            50% { border-radius: 50% 50% 33% 67% / 55% 27% 73% 45%; }
            75% { border-radius: 33% 67% 58% 42% / 63% 68% 32% 37%; }
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: rgba(255,255,255,0.7);
            backdrop-filter: blur(10px);
            border-radius: 50px;
            text-decoration: none;
            color: var(--moss);
            font-weight: 600;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .back-link:hover {
            background: var(--moss);
            color: white;
            transform: translateX(-5px);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 80px 20px 40px;
            position: relative;
            z-index: 1;
        }

        h1 {
            font-family: 'Lora', serif;
            font-size: clamp(2rem, 5vw, 3rem);
            color: var(--moss);
            text-align: center;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            font-size: 1.1rem;
            color: var(--dark-moss);
            opacity: 0.8;
            margin-bottom: 30px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        .content-section {
            background: rgba(255,255,255,0.7);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(138, 154, 91, 0.2);
        }

        .content-section h2 {
            font-family: 'Lora', serif;
            color: var(--moss);
            margin-bottom: 20px;
        }

        .scenario-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 50px;
            background: rgba(138, 154, 91, 0.2);
            color: var(--dark-moss);
            cursor: pointer;
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: var(--moss);
            color: white;
        }

        .tab-btn:hover:not(.active) {
            background: rgba(138, 154, 91, 0.4);
        }

        .visualization-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        @media (max-width: 900px) {
            .visualization-area {
                grid-template-columns: 1fr;
            }
        }

        .chart-container {
            background: rgba(254, 250, 224, 0.5);
            border-radius: 15px;
            padding: 20px;
            position: relative;
        }

        .chart-title {
            font-family: 'Lora', serif;
            color: var(--moss);
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.2rem;
        }

        canvas {
            width: 100%;
            height: 300px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table th, .data-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid rgba(138, 154, 91, 0.2);
        }

        .data-table th {
            background: var(--moss);
            color: white;
            font-weight: 600;
        }

        .data-table tr:nth-child(even) {
            background: rgba(138, 154, 91, 0.1);
        }

        .data-table .group-a {
            color: var(--blue);
            font-weight: 600;
        }

        .data-table .group-b {
            color: var(--pink);
            font-weight: 600;
        }

        .data-table .total-row {
            background: rgba(221, 161, 94, 0.3);
            font-weight: bold;
        }

        .data-table .winner {
            background: #4CAF50;
            color: white;
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        .paradox-highlight {
            background: linear-gradient(135deg, rgba(221, 161, 94, 0.2), rgba(188, 108, 37, 0.2));
            border-left: 4px solid var(--terracotta);
            padding: 20px;
            border-radius: 0 15px 15px 0;
            margin: 20px 0;
        }

        .paradox-highlight h3 {
            color: var(--terracotta);
            margin-bottom: 10px;
            font-family: 'Lora', serif;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 5px;
        }

        .toggle-view {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .toggle-btn {
            padding: 10px 25px;
            border: 2px solid var(--moss);
            border-radius: 50px;
            background: transparent;
            color: var(--moss);
            cursor: pointer;
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
            transition: all 0.3s;
        }

        .toggle-btn.active {
            background: var(--moss);
            color: white;
        }

        .explanation-box {
            background: rgba(254, 250, 224, 0.8);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
        }

        .explanation-box p {
            line-height: 1.7;
            margin-bottom: 10px;
        }

        .highlight {
            background: linear-gradient(90deg, var(--earth), var(--terracotta));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
        }

        .interactive-controls {
            display: flex;
            gap: 20px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .slider-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .slider-label {
            font-size: 0.9rem;
            color: var(--dark-moss);
        }

        input[type="range"] {
            width: 150px;
            accent-color: var(--moss);
        }

        .bar-chart {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 200px;
            padding: 20px;
            background: rgba(254, 250, 224, 0.3);
            border-radius: 10px;
        }

        .bar-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .bar-pair {
            display: flex;
            gap: 5px;
            align-items: flex-end;
            height: 150px;
        }

        .bar {
            width: 40px;
            border-radius: 5px 5px 0 0;
            transition: height 0.5s ease;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding-top: 5px;
            color: white;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .bar.group-a-bar {
            background: var(--blue);
        }

        .bar.group-b-bar {
            background: var(--pink);
        }

        .bar-label {
            font-size: 0.9rem;
            color: var(--dark-moss);
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="organic-shape shape-1"></div>
    <div class="organic-shape shape-2"></div>

    <a href="index.html" class="back-link">
        <span>&larr;</span>
        <span>Back to Surprising</span>
    </a>

    <div class="container">
        <h1>Simpson's Paradox</h1>
        <p class="subtitle">A trend that appears in different groups of data can disappear or reverse when the groups are combined. How is this possible?</p>

        <div class="content-section">
            <h2>Choose a Scenario</h2>
            <div class="scenario-tabs">
                <button class="tab-btn active" data-scenario="berkeley">UC Berkeley Admissions</button>
                <button class="tab-btn" data-scenario="treatment">Medical Treatment</button>
                <button class="tab-btn" data-scenario="batting">Baseball Batting</button>
            </div>

            <div id="berkeleyScenario" class="scenario-content">
                <div class="paradox-highlight">
                    <h3>The 1973 UC Berkeley Admissions Paradox</h3>
                    <p>UC Berkeley was sued for gender bias because overall, men were admitted at a higher rate than women. But when examining individual departments, women were admitted at <strong>equal or higher</strong> rates in most departments!</p>
                </div>

                <div class="toggle-view">
                    <button class="toggle-btn active" data-view="combined">Combined View</button>
                    <button class="toggle-btn" data-view="department">By Department</button>
                </div>

                <div class="bar-chart" id="berkeleyChart">
                    <!-- Dynamic bars will be inserted here -->
                </div>

                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--blue);"></div>
                        <span>Men</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--pink);"></div>
                        <span>Women</span>
                    </div>
                </div>

                <table class="data-table" id="berkeleyTable">
                    <thead>
                        <tr>
                            <th>Department</th>
                            <th>Men Applied</th>
                            <th>Men Admitted</th>
                            <th>Women Applied</th>
                            <th>Women Admitted</th>
                            <th>Higher Rate?</th>
                        </tr>
                    </thead>
                    <tbody id="berkeleyTableBody">
                    </tbody>
                </table>

                <div class="explanation-box">
                    <h3 style="color: var(--moss); margin-bottom: 15px; font-family: 'Lora', serif;">Why Does This Happen?</h3>
                    <p>Women applied disproportionately to <span class="highlight">competitive departments</span> (like English and History) that had low acceptance rates for everyone.</p>
                    <p>Men applied more often to <span class="highlight">less competitive departments</span> (like Engineering and Chemistry) with high acceptance rates for everyone.</p>
                    <p>The "confounding variable" here is <strong>department choice</strong>. Within each department, there was no bias - but the aggregate data created a misleading picture because it ignored which departments each gender applied to.</p>
                </div>
            </div>

            <div id="treatmentScenario" class="scenario-content" style="display: none;">
                <div class="paradox-highlight">
                    <h3>The Kidney Stone Treatment Paradox</h3>
                    <p>Treatment A appears better overall, but Treatment B is actually better for both small AND large kidney stones! How?</p>
                </div>

                <div class="toggle-view">
                    <button class="toggle-btn active" data-view="combined" data-scenario="treatment">Combined View</button>
                    <button class="toggle-btn" data-view="size" data-scenario="treatment">By Stone Size</button>
                </div>

                <div class="bar-chart" id="treatmentChart">
                </div>

                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--blue);"></div>
                        <span>Treatment A</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--pink);"></div>
                        <span>Treatment B</span>
                    </div>
                </div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Stone Size</th>
                            <th>Treatment A Success</th>
                            <th>Treatment B Success</th>
                            <th>Better Treatment</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Small Stones</td>
                            <td class="group-a">93% (81/87)</td>
                            <td class="group-b">87% (234/270)</td>
                            <td><span class="winner">A</span></td>
                        </tr>
                        <tr>
                            <td>Large Stones</td>
                            <td class="group-a">73% (192/263)</td>
                            <td class="group-b">69% (55/80)</td>
                            <td><span class="winner">A</span></td>
                        </tr>
                        <tr class="total-row">
                            <td><strong>Overall</strong></td>
                            <td class="group-a">78% (273/350)</td>
                            <td class="group-b">83% (289/350)</td>
                            <td><span class="winner">B</span></td>
                        </tr>
                    </tbody>
                </table>

                <div class="explanation-box">
                    <h3 style="color: var(--moss); margin-bottom: 15px; font-family: 'Lora', serif;">The Hidden Variable: Severity</h3>
                    <p>Treatment A was given more often to <span class="highlight">severe cases</span> (large stones), which are harder to treat.</p>
                    <p>Treatment B was given more often to <span class="highlight">mild cases</span> (small stones), which are easier to treat.</p>
                    <p>When you control for stone size, Treatment A is actually better in both categories! The overall numbers are misleading because they don't account for the unequal distribution of severe vs mild cases between treatments.</p>
                </div>
            </div>

            <div id="battingScenario" class="scenario-content" style="display: none;">
                <div class="paradox-highlight">
                    <h3>The 1995-1996 Baseball Batting Paradox</h3>
                    <p>David Justice had a higher batting average than Derek Jeter in both 1995 AND 1996, yet Jeter had a higher average over the combined two years!</p>
                </div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Year</th>
                            <th>Derek Jeter</th>
                            <th>David Justice</th>
                            <th>Higher Average</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1995</td>
                            <td class="group-a">.250 (12/48)</td>
                            <td class="group-b">.253 (104/411)</td>
                            <td><span class="winner">Justice</span></td>
                        </tr>
                        <tr>
                            <td>1996</td>
                            <td class="group-a">.314 (183/582)</td>
                            <td class="group-b">.321 (45/140)</td>
                            <td><span class="winner">Justice</span></td>
                        </tr>
                        <tr class="total-row">
                            <td><strong>Combined</strong></td>
                            <td class="group-a"><strong>.310</strong> (195/630)</td>
                            <td class="group-b">.270 (149/551)</td>
                            <td><span class="winner">Jeter</span></td>
                        </tr>
                    </tbody>
                </table>

                <div class="explanation-box">
                    <h3 style="color: var(--moss); margin-bottom: 15px; font-family: 'Lora', serif;">The Sample Size Effect</h3>
                    <p>In 1995, Jeter only had <span class="highlight">48 at-bats</span> (he was a rookie) while Justice had 411.</p>
                    <p>In 1996, Jeter had <span class="highlight">582 at-bats</span> while Justice only had 140 (due to injury).</p>
                    <p>Jeter's overall average is dominated by his 1996 performance (where he did well), while Justice's overall average is dominated by his 1995 performance (where he also did well, but not as many at-bats in 1996 to balance things out).</p>
                    <p>The <strong>weighting</strong> of each year is completely different for each player, making the combined average misleading.</p>
                </div>
            </div>
        </div>

        <div class="content-section">
            <h2>The General Principle</h2>
            <p style="line-height: 1.8; margin-bottom: 20px;">Simpson's Paradox occurs when a <strong>confounding variable</strong> (lurking variable) affects both the groupings and the outcome, creating a misleading relationship in the aggregated data.</p>

            <p style="line-height: 1.8;">This paradox teaches us that:</p>
            <ul style="margin: 15px 0 15px 30px; line-height: 2;">
                <li>Aggregated data can hide important subgroup patterns</li>
                <li>Correlation does not imply causation</li>
                <li>Always look for confounding variables</li>
                <li>Context matters - the same data can tell different stories</li>
            </ul>
        </div>
    </div>

    <script>
        const berkeleyData = {
            combined: {
                menAdmitted: 44,
                womenAdmitted: 35
            },
            departments: [
                { name: 'Dept A', menApplied: 825, menAdmitted: 62, womenApplied: 108, womenAdmitted: 82 },
                { name: 'Dept B', menApplied: 560, menAdmitted: 63, womenApplied: 25, womenAdmitted: 68 },
                { name: 'Dept C', menApplied: 325, menAdmitted: 37, womenApplied: 593, womenAdmitted: 34 },
                { name: 'Dept D', menApplied: 417, menAdmitted: 33, womenApplied: 375, womenAdmitted: 35 },
                { name: 'Dept E', menApplied: 191, menAdmitted: 28, womenApplied: 393, womenAdmitted: 24 },
                { name: 'Dept F', menApplied: 373, menAdmitted: 6, womenApplied: 341, womenAdmitted: 7 },
            ]
        };

        const treatmentData = {
            combined: {
                treatmentA: 78,
                treatmentB: 83
            },
            bySize: [
                { name: 'Small', treatmentA: 93, treatmentB: 87 },
                { name: 'Large', treatmentA: 73, treatmentB: 69 }
            ]
        };

        let currentScenario = 'berkeley';
        let currentView = 'combined';

        function updateBerkeleyChart() {
            const chart = document.getElementById('berkeleyChart');
            chart.innerHTML = '';

            if (currentView === 'combined') {
                chart.innerHTML = `
                    <div class="bar-group">
                        <div class="bar-pair">
                            <div class="bar group-a-bar" style="height: ${berkeleyData.combined.menAdmitted * 2}px">${berkeleyData.combined.menAdmitted}%</div>
                            <div class="bar group-b-bar" style="height: ${berkeleyData.combined.womenAdmitted * 2}px">${berkeleyData.combined.womenAdmitted}%</div>
                        </div>
                        <div class="bar-label">Overall</div>
                    </div>
                `;
            } else {
                berkeleyData.departments.forEach(dept => {
                    chart.innerHTML += `
                        <div class="bar-group">
                            <div class="bar-pair">
                                <div class="bar group-a-bar" style="height: ${dept.menAdmitted * 1.5}px">${dept.menAdmitted}%</div>
                                <div class="bar group-b-bar" style="height: ${dept.womenAdmitted * 1.5}px">${dept.womenAdmitted}%</div>
                            </div>
                            <div class="bar-label">${dept.name}</div>
                        </div>
                    `;
                });
            }
        }

        function updateBerkeleyTable() {
            const tbody = document.getElementById('berkeleyTableBody');
            tbody.innerHTML = '';

            if (currentView === 'combined') {
                tbody.innerHTML = `
                    <tr class="total-row">
                        <td><strong>All Departments</strong></td>
                        <td class="group-a">8442</td>
                        <td class="group-a">44%</td>
                        <td class="group-b">4321</td>
                        <td class="group-b">35%</td>
                        <td><span class="winner">Men</span></td>
                    </tr>
                `;
            } else {
                berkeleyData.departments.forEach(dept => {
                    const winner = dept.womenAdmitted >= dept.menAdmitted ? 'Women' : 'Men';
                    const winnerClass = dept.womenAdmitted >= dept.menAdmitted ? 'group-b' : 'group-a';
                    tbody.innerHTML += `
                        <tr>
                            <td>${dept.name}</td>
                            <td class="group-a">${dept.menApplied}</td>
                            <td class="group-a">${dept.menAdmitted}%</td>
                            <td class="group-b">${dept.womenApplied}</td>
                            <td class="group-b">${dept.womenAdmitted}%</td>
                            <td><span class="winner">${winner}</span></td>
                        </tr>
                    `;
                });
            }
        }

        function updateTreatmentChart() {
            const chart = document.getElementById('treatmentChart');
            if (!chart) return;
            chart.innerHTML = '';

            if (currentView === 'combined') {
                chart.innerHTML = `
                    <div class="bar-group">
                        <div class="bar-pair">
                            <div class="bar group-a-bar" style="height: ${treatmentData.combined.treatmentA * 1.5}px">${treatmentData.combined.treatmentA}%</div>
                            <div class="bar group-b-bar" style="height: ${treatmentData.combined.treatmentB * 1.5}px">${treatmentData.combined.treatmentB}%</div>
                        </div>
                        <div class="bar-label">Overall</div>
                    </div>
                `;
            } else {
                treatmentData.bySize.forEach(size => {
                    chart.innerHTML += `
                        <div class="bar-group">
                            <div class="bar-pair">
                                <div class="bar group-a-bar" style="height: ${size.treatmentA * 1.5}px">${size.treatmentA}%</div>
                                <div class="bar group-b-bar" style="height: ${size.treatmentB * 1.5}px">${size.treatmentB}%</div>
                            </div>
                            <div class="bar-label">${size.name} Stones</div>
                        </div>
                    `;
                });
            }
        }

        // Tab switching
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                currentScenario = this.dataset.scenario;
                document.querySelectorAll('.scenario-content').forEach(s => s.style.display = 'none');
                document.getElementById(currentScenario + 'Scenario').style.display = 'block';

                currentView = 'combined';
                document.querySelectorAll('.toggle-btn').forEach(b => {
                    b.classList.toggle('active', b.dataset.view === 'combined');
                });

                updateCharts();
            });
        });

        // View toggle
        document.querySelectorAll('.toggle-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const parent = this.parentElement;
                parent.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentView = this.dataset.view;
                updateCharts();
            });
        });

        function updateCharts() {
            if (currentScenario === 'berkeley') {
                updateBerkeleyChart();
                updateBerkeleyTable();
            } else if (currentScenario === 'treatment') {
                updateTreatmentChart();
            }
        }

        // Initialize
        updateCharts();
    </script>
</body>
</html>
