<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mollusk Shell Growth - Logarithmic Spiral</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0a0e1a; overflow: hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        canvas { display: block; }
        .back-link {
            position: fixed; top: 18px; left: 18px; z-index: 100;
            color: #8A9A5B; text-decoration: none; font-size: 14px; font-weight: 600;
            background: rgba(10,14,26,0.8); padding: 10px 20px; border-radius: 25px;
            border: 2px solid #8A9A5B; transition: all 0.3s ease;
        }
        .back-link:hover { background: #8A9A5B; color: #0a0e1a; }
        .controls {
            position: fixed; top: 20px; right: 20px; z-index: 100;
            background: rgba(10,14,26,0.85); backdrop-filter: blur(10px);
            border-radius: 10px; padding: 20px; color: #c8d0e0;
            max-width: 300px; border: 1px solid rgba(138,154,91,0.3);
        }
        .controls h2 { color: #DDA15E; font-size: 16px; margin-bottom: 4px; }
        .controls p.desc { font-size: 11px; color: #8899aa; margin-bottom: 12px; line-height: 1.4; }
        .control-row { margin-bottom: 10px; }
        .control-row label { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 3px; color: #a0b0c0; }
        .control-row label span { color: #DDA15E; font-family: monospace; }
        input[type="range"] {
            width: 100%; height: 4px; -webkit-appearance: none; appearance: none;
            background: #1a2035; border-radius: 2px; outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; width: 14px; height: 14px; border-radius: 50%;
            background: #8A9A5B; cursor: pointer;
        }
        .btn {
            background: rgba(138,154,91,0.2); color: #8A9A5B; border: 1px solid rgba(138,154,91,0.4);
            padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;
            transition: all 0.2s;
        }
        .btn:hover { background: rgba(138,154,91,0.4); }
        .btn.active { background: rgba(221,161,94,0.3); color: #DDA15E; border-color: rgba(221,161,94,0.5); }
        .btn-row { display: flex; gap: 6px; margin-top: 10px; flex-wrap: wrap; }
        .presets-label { font-size: 11px; color: #667; margin-top: 12px; margin-bottom: 6px; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">&larr; Nature's Hidden Math</a>
    <div class="controls">
        <h2>Shell Coiling</h2>
        <p class="desc">Mollusk shells grow by adding material at the aperture, tracing a logarithmic spiral. Three parameters create the vast diversity of shell shapes found in nature.</p>
        <div class="control-row">
            <label>W - Whorl Expansion <span id="wVal">3.0</span></label>
            <input type="range" id="paramW" min="1.2" max="10" step="0.1" value="3.0">
        </div>
        <div class="control-row">
            <label>D - Distance from Axis <span id="dVal">0.00</span></label>
            <input type="range" id="paramD" min="0" max="0.5" step="0.01" value="0.0">
        </div>
        <div class="control-row">
            <label>T - Translation Rate <span id="tVal">0.0</span></label>
            <input type="range" id="paramT" min="0" max="6" step="0.1" value="0.0">
        </div>
        <div class="control-row">
            <label>Rotation <span id="rotVal">0</span>&deg;</label>
            <input type="range" id="rotation" min="0" max="360" step="1" value="0">
        </div>
        <div class="presets-label">Species Presets</div>
        <div class="btn-row">
            <button class="btn active" id="pre-nautilus" onclick="setPreset('nautilus')">Nautilus</button>
            <button class="btn" id="pre-snail" onclick="setPreset('snail')">Snail</button>
            <button class="btn" id="pre-ammonite" onclick="setPreset('ammonite')">Ammonite</button>
            <button class="btn" id="pre-whelk" onclick="setPreset('whelk')">Whelk</button>
            <button class="btn" id="pre-limpet" onclick="setPreset('limpet')">Limpet</button>
        </div>
        <div class="btn-row">
            <button class="btn" onclick="window.reset()">Reset Animation</button>
        </div>
    </div>
    <canvas id="canvas"></canvas>

    <script>
    (function() {
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let W, H;

        // Shell parameters
        let paramW = 3.0;  // Whorl expansion rate
        let paramD = 0.0;  // Distance from coiling axis
        let paramT = 0.0;  // Translation rate along axis
        let viewRotation = 0;
        let animProgress = 0;
        const animSpeed = 0.008;
        const maxTheta = Math.PI * 10; // 5 full whorls
        let paused = false;
        let currentPreset = 'nautilus';

        const presets = {
            nautilus:  { W: 3.0, D: 0.0,  T: 0.0, label: 'Nautilus (planispiral)' },
            snail:    { W: 3.0, D: 0.3,  T: 2.0, label: 'Garden Snail (conical)' },
            ammonite: { W: 2.0, D: 0.0,  T: 0.0, label: 'Ammonite (tight spiral)' },
            whelk:    { W: 2.0, D: 0.1,  T: 3.0, label: 'Whelk (elongated)' },
            limpet:   { W: 10.0, D: 0.0, T: 5.0, label: 'Limpet (flat cone)' }
        };

        function resize() {
            W = canvas.width = window.innerWidth;
            H = canvas.height = window.innerHeight;
        }

        window.setPreset = function(name) {
            const p = presets[name];
            if (!p) return;
            currentPreset = name;
            paramW = p.W;
            paramD = p.D;
            paramT = p.T;
            animProgress = 0;

            document.getElementById('paramW').value = paramW;
            document.getElementById('paramD').value = paramD;
            document.getElementById('paramT').value = paramT;
            document.getElementById('wVal').textContent = paramW.toFixed(1);
            document.getElementById('dVal').textContent = paramD.toFixed(2);
            document.getElementById('tVal').textContent = paramT.toFixed(1);

            // Update button styles
            document.querySelectorAll('.btn-row .btn[id^="pre-"]').forEach(function(b) {
                b.classList.remove('active');
            });
            var el = document.getElementById('pre-' + name);
            if (el) el.classList.add('active');
        };

        // Generate shell cross-section points
        function generateShell(theta) {
            // Logarithmic spiral: r = a * W^(theta/(2*pi))
            // The generating curve (aperture) is a circle that grows with the spiral
            const a = 8; // base size
            const logW = Math.log(paramW);

            // The spiral radius at angle theta
            const r = a * Math.exp(logW * theta / (2 * Math.PI));
            // Aperture radius
            const apertureR = r * (paramW - 1) / (paramW + 1) * 1.2;

            // Center of the aperture on the spiral
            // Add translation along the vertical axis for conical shells
            const translateY = paramT * theta / (2 * Math.PI) * a;

            // Distance from coiling axis
            const distOffset = paramD * r;

            // 2D projection with rotation
            const cosR = Math.cos(viewRotation * Math.PI / 180);
            const sinR = Math.sin(viewRotation * Math.PI / 180);

            const cx = (r + distOffset) * Math.cos(theta);
            const cy = (r + distOffset) * Math.sin(theta);

            // Apply a simple pseudo-3D: translate is along the "out of screen" axis
            // projected to vertical
            const px = cx * cosR - translateY * sinR;
            const py = cy;
            const pz = cx * sinR + translateY * cosR; // depth for shading

            return {
                x: px, y: py, z: pz,
                radius: apertureR,
                theta: theta
            };
        }

        function shellColor(theta, totalTheta, z, isEdge) {
            // Warm natural shell colors
            const t = theta / totalTheta;
            const depth = Math.max(0, Math.min(1, (z + 200) / 400));

            // Base color: cream to warm brown
            const r = Math.floor(220 - 60 * t + 30 * depth);
            const g = Math.floor(195 - 70 * t + 10 * depth);
            const b = Math.floor(160 - 80 * t - 10 * depth);

            // Shading: lighter on top, darker underneath
            const shade = 0.5 + 0.5 * depth;
            const sr = Math.floor(r * shade);
            const sg = Math.floor(g * shade);
            const sb = Math.floor(b * shade);

            if (isEdge) {
                return 'rgba(' + Math.floor(sr * 0.7) + ',' + Math.floor(sg * 0.7) + ',' + Math.floor(sb * 0.7) + ',0.9)';
            }
            return 'rgba(' + sr + ',' + sg + ',' + sb + ',0.85)';
        }

        function render() {
            ctx.fillStyle = '#0a0e1a';
            ctx.fillRect(0, 0, W, H);

            // Draw subtle radial gradient background
            const bgGrd = ctx.createRadialGradient(W / 2, H / 2, 0, W / 2, H / 2, Math.max(W, H) * 0.5);
            bgGrd.addColorStop(0, 'rgba(30, 35, 50, 0.4)');
            bgGrd.addColorStop(1, 'rgba(10, 14, 26, 0)');
            ctx.fillStyle = bgGrd;
            ctx.fillRect(0, 0, W, H);

            const centerX = W / 2;
            const centerY = H / 2;
            const drawScale = Math.min(W, H) / 500;

            // Generate shell rings up to current animation progress
            const currentTheta = animProgress * maxTheta;
            const step = 0.08;
            const rings = [];

            for (let theta = 0; theta < currentTheta; theta += step) {
                rings.push(generateShell(theta));
            }

            if (rings.length < 2) return;

            // Sort by depth (z) for painter's algorithm
            const sortedRings = rings.map(function(r, i) { return { ring: r, idx: i }; });
            sortedRings.sort(function(a, b) { return a.ring.z - b.ring.z; });

            // Draw rings from back to front
            for (let si = 0; si < sortedRings.length; si++) {
                const s = sortedRings[si];
                const ring = s.ring;
                const r = Math.max(ring.radius * drawScale, 1);

                const sx = centerX + ring.x * drawScale;
                const sy = centerY - ring.y * drawScale;

                // Shell body
                ctx.beginPath();
                ctx.arc(sx, sy, r, 0, Math.PI * 2);

                const fillColor = shellColor(ring.theta, maxTheta, ring.z, false);
                ctx.fillStyle = fillColor;
                ctx.fill();

                // Growth lines (subtle)
                if (s.idx % 8 === 0 && r > 3) {
                    ctx.strokeStyle = shellColor(ring.theta, maxTheta, ring.z, true);
                    ctx.lineWidth = 0.5;
                    ctx.stroke();
                }
            }

            // Highlight the aperture (newest ring) with a bright edge
            if (rings.length > 1) {
                const newest = rings[rings.length - 1];
                const nr = Math.max(newest.radius * drawScale, 2);
                const nx = centerX + newest.x * drawScale;
                const ny = centerY - newest.y * drawScale;

                ctx.beginPath();
                ctx.arc(nx, ny, nr, 0, Math.PI * 2);
                ctx.strokeStyle = 'rgba(255, 230, 180, 0.8)';
                ctx.lineWidth = 2;
                ctx.stroke();
            }

            // Label
            if (presets[currentPreset]) {
                ctx.fillStyle = 'rgba(200, 210, 230, 0.4)';
                ctx.font = '14px "Segoe UI", sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(presets[currentPreset].label, W / 2, H - 30);
            }
        }

        function animate() {
            if (!paused) {
                if (animProgress < 1) {
                    animProgress = Math.min(animProgress + animSpeed, 1);
                }
                render();
            }
            requestAnimationFrame(animate);
        }

        window.reset = function() {
            animProgress = 0;
        };

        // Controls
        document.getElementById('paramW').addEventListener('input', function() {
            paramW = parseFloat(this.value);
            document.getElementById('wVal').textContent = paramW.toFixed(1);
            animProgress = 0;
            document.querySelectorAll('.btn-row .btn[id^="pre-"]').forEach(function(b) { b.classList.remove('active'); });
        });
        document.getElementById('paramD').addEventListener('input', function() {
            paramD = parseFloat(this.value);
            document.getElementById('dVal').textContent = paramD.toFixed(2);
            animProgress = 0;
            document.querySelectorAll('.btn-row .btn[id^="pre-"]').forEach(function(b) { b.classList.remove('active'); });
        });
        document.getElementById('paramT').addEventListener('input', function() {
            paramT = parseFloat(this.value);
            document.getElementById('tVal').textContent = paramT.toFixed(1);
            animProgress = 0;
            document.querySelectorAll('.btn-row .btn[id^="pre-"]').forEach(function(b) { b.classList.remove('active'); });
        });
        document.getElementById('rotation').addEventListener('input', function() {
            viewRotation = parseInt(this.value);
            document.getElementById('rotVal').textContent = viewRotation;
        });

        window.addEventListener('resize', resize);

        resize();
        animate();
    })();
    </script>
    <script src="../assets/js/enhance.js"></script>
</body>
</html>
