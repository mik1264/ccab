<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sunflower Phyllotaxis - Nature's Hidden Math</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0a0e1a; overflow: hidden; font-family: 'Segoe UI', system-ui, sans-serif; }
        canvas { display: block; }

        .back-link {
            position: fixed; top: 20px; left: 20px; z-index: 100;
            color: #8A9A5B; text-decoration: none; font-weight: 600;
            background: rgba(10,14,26,0.8); border: 2px solid #8A9A5B;
            padding: 10px 20px; border-radius: 25px; font-size: 14px;
            transition: all 0.3s ease;
        }
        .back-link:hover { background: #8A9A5B; color: #0a0e1a; }

        .controls {
            position: fixed; top: 20px; right: 20px; z-index: 100;
            background: rgba(10,14,26,0.85); backdrop-filter: blur(10px);
            border-radius: 10px; padding: 20px; min-width: 280px;
            border: 1px solid rgba(138,154,91,0.3); color: #c8d0b8;
        }
        .controls h2 { color: #8A9A5B; font-size: 18px; margin-bottom: 4px; }
        .controls .desc { font-size: 12px; color: #7a8a6a; margin-bottom: 14px; line-height: 1.4; }
        .control-group { margin-bottom: 12px; }
        .control-group label {
            display: flex; justify-content: space-between; align-items: center;
            font-size: 13px; margin-bottom: 4px; color: #a0b090;
        }
        .control-group label span { color: #DDA15E; font-weight: 600; font-family: monospace; }
        input[type="range"] {
            width: 100%; height: 6px; -webkit-appearance: none; appearance: none;
            background: rgba(138,154,91,0.3); border-radius: 3px; outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; width: 16px; height: 16px;
            background: #8A9A5B; border-radius: 50%; cursor: pointer;
        }
        .info-row {
            display: flex; justify-content: space-between; font-size: 12px;
            padding: 6px 0; border-top: 1px solid rgba(138,154,91,0.2);
            color: #7a8a6a;
        }
        .info-row .val { color: #DDA15E; font-weight: 600; }
        button {
            width: 100%; padding: 8px; margin-top: 8px;
            background: rgba(138,154,91,0.3); color: #8A9A5B;
            border: 1px solid rgba(138,154,91,0.5); border-radius: 6px;
            cursor: pointer; font-size: 13px; font-weight: 600;
            transition: all 0.3s ease;
        }
        button:hover { background: #8A9A5B; color: #0a0e1a; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">&larr; Nature's Hidden Math</a>

    <div class="controls">
        <h2>Sunflower Phyllotaxis</h2>
        <p class="desc">Seeds arranged by divergence angle. At the golden angle (137.508&deg;), Fibonacci spirals emerge naturally.</p>

        <div class="control-group">
            <label>Divergence Angle <span id="angleVal">137.508</span>&deg;</label>
            <input type="range" id="angle" min="120" max="160" step="0.001" value="137.508">
        </div>
        <div class="control-group">
            <label>Seed Count <span id="countVal">1500</span></label>
            <input type="range" id="count" min="100" max="2500" step="10" value="1500">
        </div>
        <div class="control-group">
            <label>Seed Size <span id="sizeVal">3.0</span></label>
            <input type="range" id="size" min="1" max="8" step="0.5" value="3">
        </div>
        <div class="control-group">
            <label>Speed <span id="speedVal">8</span></label>
            <input type="range" id="speed" min="1" max="30" step="1" value="8">
        </div>

        <div class="info-row">
            <span>Seeds Placed</span>
            <span class="val" id="placedVal">0</span>
        </div>
        <div class="info-row">
            <span>Golden Ratio</span>
            <span class="val">&phi; = 1.6180339...</span>
        </div>

        <button id="resetBtn">Reset Animation</button>
    </div>

    <canvas id="canvas"></canvas>

    <script>
    (function() {
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        const angleSlider = document.getElementById('angle');
        const countSlider = document.getElementById('count');
        const sizeSlider = document.getElementById('size');
        const speedSlider = document.getElementById('speed');
        const angleVal = document.getElementById('angleVal');
        const countVal = document.getElementById('countVal');
        const sizeVal = document.getElementById('sizeVal');
        const speedVal = document.getElementById('speedVal');
        const placedVal = document.getElementById('placedVal');

        let currentSeed = 0;
        let animId;

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resize();
        window.addEventListener('resize', resize);

        angleSlider.addEventListener('input', function() { angleVal.textContent = parseFloat(this.value).toFixed(3); currentSeed = 0; });
        countSlider.addEventListener('input', function() { countVal.textContent = this.value; currentSeed = 0; });
        sizeSlider.addEventListener('input', function() { sizeVal.textContent = parseFloat(this.value).toFixed(1); });
        speedSlider.addEventListener('input', function() { speedVal.textContent = this.value; });

        function seedColor(n, total) {
            var t = n / total;
            var r, g, b;
            if (t < 0.25) {
                r = 180 + 75 * (t / 0.25);
                g = 60 + 80 * (t / 0.25);
                b = 20;
            } else if (t < 0.5) {
                var u = (t - 0.25) / 0.25;
                r = 255 - 40 * u;
                g = 140 + 60 * u;
                b = 20 + 30 * u;
            } else if (t < 0.75) {
                var u = (t - 0.5) / 0.25;
                r = 215 - 80 * u;
                g = 200 - 40 * u;
                b = 50 + 50 * u;
            } else {
                var u = (t - 0.75) / 0.25;
                r = 135 - 30 * u;
                g = 160 + 30 * u;
                b = 100 + 40 * u;
            }
            return 'rgb(' + Math.round(r) + ',' + Math.round(g) + ',' + Math.round(b) + ')';
        }

        function drawBackground() {
            var cx = canvas.width / 2;
            var cy = canvas.height / 2;
            var maxR = Math.max(canvas.width, canvas.height) * 0.6;
            var grad = ctx.createRadialGradient(cx, cy, 0, cx, cy, maxR);
            grad.addColorStop(0, '#111828');
            grad.addColorStop(0.5, '#0c1020');
            grad.addColorStop(1, '#0a0e1a');
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        function draw() {
            var divergenceAngle = parseFloat(angleSlider.value) * Math.PI / 180;
            var maxSeeds = parseInt(countSlider.value);
            var seedSize = parseFloat(sizeSlider.value);
            var speed = parseInt(speedSlider.value);
            var cx = canvas.width / 2;
            var cy = canvas.height / 2;
            var scale = Math.min(canvas.width, canvas.height) * 0.42;
            var c = scale / Math.sqrt(maxSeeds);

            currentSeed = Math.min(currentSeed + speed, maxSeeds);

            drawBackground();

            for (var n = 0; n < currentSeed; n++) {
                var r = c * Math.sqrt(n);
                var theta = n * divergenceAngle;
                var x = cx + r * Math.cos(theta);
                var y = cy + r * Math.sin(theta);

                var sz = seedSize * (0.5 + 0.5 * (n / maxSeeds));

                ctx.beginPath();
                ctx.arc(x, y, sz, 0, Math.PI * 2);
                ctx.fillStyle = seedColor(n, maxSeeds);
                ctx.fill();

                if (sz > 2) {
                    ctx.beginPath();
                    ctx.arc(x - sz * 0.25, y - sz * 0.25, sz * 0.35, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(255,255,255,0.15)';
                    ctx.fill();
                }
            }

            placedVal.textContent = Math.floor(currentSeed);
            animId = requestAnimationFrame(draw);
        }

        function reset() {
            currentSeed = 0;
        }

        window.reset = reset;
        document.getElementById('resetBtn').addEventListener('click', reset);

        draw();
    })();
    </script>
    <script src="../assets/js/enhance.js"></script>
</body>
</html>