<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Recall Simulation | Cognitive Science</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e2e8f0;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        .back-link {
            display: inline-block;
            color: #a78bfa;
            text-decoration: none;
            margin-bottom: 20px;
            padding: 8px 16px;
            border: 1px solid rgba(167, 139, 250, 0.3);
            border-radius: 20px;
            transition: all 0.3s;
        }

        .back-link:hover {
            background: rgba(167, 139, 250, 0.1);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #a78bfa, #818cf8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: #94a3b8;
            font-size: 1.1rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
        }

        .simulation-area {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(167, 139, 250, 0.2);
        }

        .task-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 400px;
        }

        .stimulus-area {
            width: 100%;
            min-height: 300px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 15px;
            padding: 20px;
        }

        .memory-item {
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            background: linear-gradient(135deg, #a78bfa, #818cf8);
            border-radius: 15px;
            color: white;
            transition: all 0.3s;
            opacity: 0;
            transform: scale(0.5);
        }

        .memory-item.visible {
            opacity: 1;
            transform: scale(1);
        }

        .memory-item.highlight {
            box-shadow: 0 0 20px rgba(167, 139, 250, 0.6);
        }

        .instruction {
            font-size: 1.3rem;
            color: #94a3b8;
            margin: 20px 0;
            text-align: center;
        }

        .input-area {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .recall-input {
            padding: 15px 25px;
            font-size: 1.2rem;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(167, 139, 250, 0.3);
            border-radius: 10px;
            color: white;
            text-align: center;
            width: 200px;
        }

        .recall-input:focus {
            outline: none;
            border-color: #a78bfa;
        }

        .btn {
            padding: 15px 30px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #a78bfa, #818cf8);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(167, 139, 250, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .controls {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(167, 139, 250, 0.2);
        }

        .control-group {
            margin-bottom: 25px;
        }

        .control-group label {
            display: block;
            margin-bottom: 10px;
            color: #a78bfa;
            font-weight: 600;
        }

        .control-group input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: rgba(167, 139, 250, 0.2);
            outline: none;
            -webkit-appearance: none;
        }

        .control-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #a78bfa;
            cursor: pointer;
        }

        .control-value {
            text-align: center;
            margin-top: 8px;
            font-size: 0.9rem;
            color: #94a3b8;
        }

        .task-select {
            width: 100%;
            padding: 12px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(167, 139, 250, 0.3);
            border-radius: 8px;
            color: white;
        }

        .task-select option {
            background: #1a1a2e;
        }

        .stats-panel {
            background: rgba(167, 139, 250, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .stats-panel h3 {
            color: #a78bfa;
            margin-bottom: 15px;
            font-size: 1rem;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(167, 139, 250, 0.1);
        }

        .stat-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .stat-label {
            color: #94a3b8;
        }

        .stat-value {
            color: #a78bfa;
            font-weight: 600;
        }

        .chart-container {
            margin-top: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            padding: 15px;
        }

        .chart-title {
            color: #a78bfa;
            font-size: 0.9rem;
            margin-bottom: 10px;
            text-align: center;
        }

        canvas {
            width: 100%;
            height: 150px;
        }

        .feedback {
            text-align: center;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            font-weight: 600;
        }

        .feedback.correct {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55a;
        }

        .feedback.incorrect {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-link">‚Üê Back to Cognitive Science</a>
            <h1>Memory Recall Simulation</h1>
            <p class="subtitle">Explore working memory capacity, serial position effects, and decay</p>
        </header>

        <div class="main-content">
            <div class="simulation-area">
                <div class="task-display">
                    <div class="instruction" id="instruction">Click "Start Trial" to begin</div>
                    <div class="stimulus-area" id="stimulusArea"></div>
                    <div class="input-area" id="inputArea" style="display: none;">
                        <input type="text" id="recallInput" class="recall-input" placeholder="Type recalled items">
                        <button class="btn btn-primary" id="submitBtn">Submit</button>
                    </div>
                    <div class="feedback" id="feedback" style="display: none;"></div>
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-primary" id="startBtn">Start Trial</button>
                </div>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label>Task Type</label>
                    <select class="task-select" id="taskType">
                        <option value="digit">Digit Span</option>
                        <option value="letter">Letter Span</option>
                        <option value="word">Word Span</option>
                        <option value="spatial">Spatial Sequence</option>
                    </select>
                </div>

                <div class="control-group">
                    <label>List Length: <span id="lengthValue">5</span></label>
                    <input type="range" id="listLength" min="3" max="12" value="5">
                </div>

                <div class="control-group">
                    <label>Presentation Rate: <span id="rateValue">1000</span>ms</label>
                    <input type="range" id="presentationRate" min="500" max="2000" step="100" value="1000">
                </div>

                <div class="control-group">
                    <label>Delay Before Recall: <span id="delayValue">1</span>s</label>
                    <input type="range" id="recallDelay" min="0" max="10" value="1">
                </div>

                <div class="stats-panel">
                    <h3>Performance Statistics</h3>
                    <div class="stat-row">
                        <span class="stat-label">Trials Completed</span>
                        <span class="stat-value" id="trialsCount">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Average Accuracy</span>
                        <span class="stat-value" id="avgAccuracy">0%</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Estimated Capacity</span>
                        <span class="stat-value" id="capacity">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Primacy Effect</span>
                        <span class="stat-value" id="primacy">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Recency Effect</span>
                        <span class="stat-value" id="recency">-</span>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">Serial Position Curve</div>
                    <canvas id="positionChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        const words = ['apple', 'river', 'chair', 'green', 'music', 'cloud', 'bread', 'stone', 'light', 'dream', 'ocean', 'grass', 'metal', 'flower', 'window'];

        let currentSequence = [];
        let isTrialRunning = false;
        let stats = {
            trials: 0,
            correctItems: 0,
            totalItems: 0,
            positionHits: new Array(12).fill(0),
            positionTrials: new Array(12).fill(0)
        };

        const instruction = document.getElementById('instruction');
        const stimulusArea = document.getElementById('stimulusArea');
        const inputArea = document.getElementById('inputArea');
        const recallInput = document.getElementById('recallInput');
        const submitBtn = document.getElementById('submitBtn');
        const startBtn = document.getElementById('startBtn');
        const feedback = document.getElementById('feedback');

        const taskType = document.getElementById('taskType');
        const listLength = document.getElementById('listLength');
        const presentationRate = document.getElementById('presentationRate');
        const recallDelay = document.getElementById('recallDelay');

        const lengthValue = document.getElementById('lengthValue');
        const rateValue = document.getElementById('rateValue');
        const delayValue = document.getElementById('delayValue');

        listLength.addEventListener('input', () => lengthValue.textContent = listLength.value);
        presentationRate.addEventListener('input', () => rateValue.textContent = presentationRate.value);
        recallDelay.addEventListener('input', () => delayValue.textContent = recallDelay.value);

        function generateSequence(type, length) {
            const sequence = [];
            const used = new Set();

            for (let i = 0; i < length; i++) {
                let item;
                do {
                    switch (type) {
                        case 'digit':
                            item = Math.floor(Math.random() * 10).toString();
                            break;
                        case 'letter':
                            item = String.fromCharCode(65 + Math.floor(Math.random() * 26));
                            break;
                        case 'word':
                            item = words[Math.floor(Math.random() * words.length)];
                            break;
                        case 'spatial':
                            item = (i + 1).toString();
                            break;
                    }
                } while (type !== 'digit' && used.has(item));
                used.add(item);
                sequence.push(item);
            }
            return sequence;
        }

        async function presentSequence(sequence, type) {
            stimulusArea.innerHTML = '';
            const rate = parseInt(presentationRate.value);

            if (type === 'spatial') {
                // Create grid for spatial task
                const grid = document.createElement('div');
                grid.style.cssText = 'display: grid; grid-template-columns: repeat(3, 80px); gap: 10px;';
                for (let i = 0; i < 9; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'memory-item';
                    cell.style.opacity = '0.3';
                    cell.style.transform = 'scale(1)';
                    cell.dataset.index = i;
                    grid.appendChild(cell);
                }
                stimulusArea.appendChild(grid);

                // Highlight sequence
                for (let i = 0; i < sequence.length; i++) {
                    await new Promise(r => setTimeout(r, rate));
                    const idx = parseInt(sequence[i]) - 1;
                    const cells = grid.children;
                    cells[idx % 9].classList.add('highlight');
                    cells[idx % 9].style.opacity = '1';
                    cells[idx % 9].textContent = i + 1;
                    await new Promise(r => setTimeout(r, rate * 0.8));
                    cells[idx % 9].classList.remove('highlight');
                    cells[idx % 9].style.opacity = '0.3';
                    cells[idx % 9].textContent = '';
                }
            } else {
                // Sequential presentation for other tasks
                for (let i = 0; i < sequence.length; i++) {
                    stimulusArea.innerHTML = '';
                    const item = document.createElement('div');
                    item.className = 'memory-item';
                    item.textContent = type === 'word' ? sequence[i].charAt(0).toUpperCase() : sequence[i];
                    item.style.width = type === 'word' ? '150px' : '80px';
                    item.style.fontSize = type === 'word' ? '1.2rem' : '2rem';
                    stimulusArea.appendChild(item);

                    await new Promise(r => setTimeout(r, 50));
                    item.classList.add('visible');

                    await new Promise(r => setTimeout(r, rate - 100));
                    item.classList.remove('visible');
                    await new Promise(r => setTimeout(r, 100));
                }
                stimulusArea.innerHTML = '';
            }
        }

        async function runTrial() {
            if (isTrialRunning) return;
            isTrialRunning = true;
            startBtn.disabled = true;
            feedback.style.display = 'none';
            inputArea.style.display = 'none';

            const type = taskType.value;
            const length = parseInt(listLength.value);
            currentSequence = generateSequence(type, length);

            instruction.textContent = 'Watch carefully...';
            await new Promise(r => setTimeout(r, 1000));

            await presentSequence(currentSequence, type);

            const delay = parseInt(recallDelay.value) * 1000;
            if (delay > 0) {
                instruction.textContent = `Wait ${recallDelay.value} seconds...`;
                await new Promise(r => setTimeout(r, delay));
            }

            instruction.textContent = type === 'spatial'
                ? 'Enter the sequence of positions (e.g., 1 2 3)'
                : `Type the ${type}s you remember (space-separated)`;
            inputArea.style.display = 'flex';
            recallInput.value = '';
            recallInput.focus();

            isTrialRunning = false;
            startBtn.disabled = false;
        }

        function evaluateRecall() {
            const response = recallInput.value.trim().toLowerCase().split(/\s+/);
            const target = currentSequence.map(s => s.toLowerCase());

            let correct = 0;
            const length = target.length;

            // Check position accuracy
            for (let i = 0; i < Math.min(response.length, target.length); i++) {
                if (response[i] === target[i]) {
                    correct++;
                    stats.positionHits[i]++;
                }
                stats.positionTrials[i]++;
            }

            // Also count any items recalled regardless of position
            const targetSet = new Set(target);
            const itemsRecalled = response.filter(r => targetSet.has(r)).length;

            stats.trials++;
            stats.correctItems += correct;
            stats.totalItems += length;

            const accuracy = Math.round((correct / length) * 100);

            feedback.style.display = 'block';
            feedback.className = 'feedback ' + (accuracy >= 70 ? 'correct' : 'incorrect');
            feedback.innerHTML = `
                Position Accuracy: ${correct}/${length} (${accuracy}%)<br>
                Items Recalled: ${itemsRecalled}/${length}<br>
                Correct sequence: ${target.join(' ')}
            `;

            inputArea.style.display = 'none';
            instruction.textContent = 'Click "Start Trial" for next trial';
            updateStats();
            drawPositionChart();
        }

        function updateStats() {
            document.getElementById('trialsCount').textContent = stats.trials;
            document.getElementById('avgAccuracy').textContent =
                stats.totalItems > 0 ? Math.round((stats.correctItems / stats.totalItems) * 100) + '%' : '0%';

            // Estimate capacity (items where accuracy > 50%)
            let capacity = 0;
            for (let i = 0; i < 12; i++) {
                if (stats.positionTrials[i] > 0 && (stats.positionHits[i] / stats.positionTrials[i]) > 0.5) {
                    capacity = i + 1;
                }
            }
            document.getElementById('capacity').textContent = capacity > 0 ? `~${capacity} items` : '-';

            // Calculate primacy/recency effects
            if (stats.trials >= 3) {
                const length = parseInt(listLength.value);
                const primacyAccuracy = stats.positionTrials[0] > 0 ?
                    Math.round((stats.positionHits[0] / stats.positionTrials[0]) * 100) : 0;
                const recencyAccuracy = stats.positionTrials[length-1] > 0 ?
                    Math.round((stats.positionHits[length-1] / stats.positionTrials[length-1]) * 100) : 0;
                const middleAccuracy = stats.positionTrials[Math.floor(length/2)] > 0 ?
                    Math.round((stats.positionHits[Math.floor(length/2)] / stats.positionTrials[Math.floor(length/2)]) * 100) : 0;

                document.getElementById('primacy').textContent =
                    primacyAccuracy > middleAccuracy ? `+${primacyAccuracy - middleAccuracy}%` : 'Not observed';
                document.getElementById('recency').textContent =
                    recencyAccuracy > middleAccuracy ? `+${recencyAccuracy - middleAccuracy}%` : 'Not observed';
            }
        }

        function drawPositionChart() {
            const canvas = document.getElementById('positionChart');
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.offsetWidth * 2;
            canvas.height = 150 * 2;
            ctx.scale(2, 2);

            const width = canvas.offsetWidth;
            const height = 150;
            ctx.clearRect(0, 0, width, height);

            const length = parseInt(listLength.value);
            const barWidth = (width - 40) / length;
            const maxHeight = height - 40;

            ctx.fillStyle = '#94a3b8';
            ctx.font = '10px sans-serif';
            ctx.fillText('100%', 5, 20);
            ctx.fillText('0%', 5, height - 15);

            for (let i = 0; i < length; i++) {
                const accuracy = stats.positionTrials[i] > 0
                    ? stats.positionHits[i] / stats.positionTrials[i]
                    : 0;
                const barHeight = accuracy * maxHeight;

                const gradient = ctx.createLinearGradient(0, height - 20 - barHeight, 0, height - 20);
                gradient.addColorStop(0, '#a78bfa');
                gradient.addColorStop(1, '#818cf8');
                ctx.fillStyle = gradient;

                ctx.fillRect(
                    30 + i * barWidth + 5,
                    height - 20 - barHeight,
                    barWidth - 10,
                    barHeight
                );

                ctx.fillStyle = '#94a3b8';
                ctx.fillText(i + 1, 30 + i * barWidth + barWidth/2 - 5, height - 5);
            }

            ctx.strokeStyle = 'rgba(167, 139, 250, 0.3)';
            ctx.beginPath();
            ctx.moveTo(30, 20);
            ctx.lineTo(30, height - 20);
            ctx.lineTo(width - 10, height - 20);
            ctx.stroke();
        }

        startBtn.addEventListener('click', runTrial);
        submitBtn.addEventListener('click', evaluateRecall);
        recallInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') evaluateRecall();
        });

        drawPositionChart();
    </script>
</body>
</html>
