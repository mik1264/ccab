<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inattentional Blindness - Cognitive Science</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: #0a0e1a;
            color: #e0e0e0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        #canvas {
            display: block;
            background: #0a0e1a;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #8A9A5B;
            text-decoration: none;
            font-size: 16px;
            font-weight: 600;
            padding: 10px 20px;
            background: rgba(138, 154, 91, 0.2);
            border-radius: 8px;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .back-link:hover {
            background: rgba(138, 154, 91, 0.4);
            transform: translateX(-5px);
        }

        #fps {
            position: fixed;
            top: 20px;
            right: 20px;
            color: #8A9A5B;
            font-size: 14px;
            font-weight: bold;
            background: rgba(10, 14, 26, 0.8);
            padding: 8px 12px;
            border-radius: 6px;
            z-index: 100;
        }

        #instructions {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(10, 14, 26, 0.95);
            padding: 30px 40px;
            border-radius: 12px;
            max-width: 600px;
            text-align: center;
            z-index: 200;
            border: 2px solid rgba(138, 154, 91, 0.3);
        }

        #instructions h2 {
            color: #8A9A5B;
            margin-bottom: 15px;
            font-size: 24px;
        }

        #instructions p {
            color: #b0b0b0;
            line-height: 1.8;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .highlight {
            color: #DDA15E;
            font-weight: bold;
        }

        #startBtn {
            background: #8A9A5B;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        #startBtn:hover {
            background: #606C38;
            transform: scale(1.05);
        }

        #counter {
            position: fixed;
            top: 80px;
            right: 20px;
            background: rgba(10, 14, 26, 0.9);
            padding: 15px 25px;
            border-radius: 8px;
            z-index: 100;
            display: none;
        }

        #counter div {
            margin: 5px 0;
            font-size: 18px;
        }

        .count-label {
            color: #8A9A5B;
        }

        .count-value {
            color: #DDA15E;
            font-weight: bold;
        }

        #result {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(10, 14, 26, 0.95);
            padding: 30px 40px;
            border-radius: 12px;
            max-width: 600px;
            text-align: center;
            z-index: 200;
            border: 2px solid rgba(138, 154, 91, 0.3);
            display: none;
        }

        #result h2 {
            color: #8A9A5B;
            margin-bottom: 15px;
        }

        #result p {
            color: #b0b0b0;
            margin: 10px 0;
            line-height: 1.6;
        }

        .correct {
            color: #8A9A5B;
            font-weight: bold;
        }

        .incorrect {
            color: #BC6C25;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Gallery</a>
    <div id="fps">FPS: 60</div>
    <canvas id="canvas"></canvas>

    <div id="instructions">
        <h2>Inattentional Blindness Test</h2>
        <p>You will see players in <span class="highlight">white</span> and <span class="highlight">black</span> shirts passing balls.</p>
        <p><strong>Your task:</strong> Count how many passes the <span class="highlight">WHITE</span> team makes.</p>
        <p>Focus carefully and ignore the black team!</p>
        <button id="startBtn">Start Experiment</button>
    </div>

    <div id="counter">
        <div><span class="count-label">White Passes:</span> <span class="count-value" id="whiteCount">0</span></div>
        <div><span class="count-label">Your Count:</span> <span class="count-value" id="userCount">0</span></div>
    </div>

    <div id="result">
        <h2>Results</h2>
        <p id="resultText"></p>
        <p id="passCount"></p>
        <p id="gorillaQuestion" style="margin-top: 20px; font-size: 18px; color: #DDA15E;"></p>
        <button id="startBtn2" style="margin-top: 20px; background: #8A9A5B; color: white; border: none; padding: 12px 30px; font-size: 16px; font-weight: bold; border-radius: 8px; cursor: pointer;">Try Again</button>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const fpsDisplay = document.getElementById('fps');
        const instructions = document.getElementById('instructions');
        const startBtn = document.getElementById('startBtn');
        const startBtn2 = document.getElementById('startBtn2');
        const counter = document.getElementById('counter');
        const result = document.getElementById('result');
        const whiteCountDisplay = document.getElementById('whiteCount');
        const userCountDisplay = document.getElementById('userCount');

        // Set canvas size
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // FPS Counter
        let lastTime = performance.now();
        let frameCount = 0;
        let fps = 60;

        function updateFPS() {
            frameCount++;
            const currentTime = performance.now();
            if (currentTime >= lastTime + 1000) {
                fps = Math.round((frameCount * 1000) / (currentTime - lastTime));
                fpsDisplay.textContent = `FPS: ${fps}`;
                frameCount = 0;
                lastTime = currentTime;
            }
        }

        // Player class
        class Player {
            constructor(x, y, color, team) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.team = team;
                this.radius = 20;
                this.vx = (Math.random() - 0.5) * 2;
                this.vy = (Math.random() - 0.5) * 2;
                this.hasBall = false;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;

                // Bounce off walls
                if (this.x < this.radius || this.x > canvas.width - this.radius) {
                    this.vx *= -1;
                    this.x = Math.max(this.radius, Math.min(canvas.width - this.radius, this.x));
                }
                if (this.y < this.radius || this.y > canvas.height - this.radius) {
                    this.vy *= -1;
                    this.y = Math.max(this.radius, Math.min(canvas.height - this.radius, this.y));
                }
            }

            draw() {
                // Draw player body
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();

                // Draw ball if player has it
                if (this.hasBall) {
                    ctx.fillStyle = '#FF6B6B';
                    ctx.beginPath();
                    ctx.arc(this.x, this.y - this.radius - 10, 8, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
        }

        // Gorilla class
        class Gorilla {
            constructor() {
                this.x = -50;
                this.y = canvas.height / 2;
                this.width = 60;
                this.height = 80;
                this.speed = 2;
                this.visible = false;
                this.crossTime = 0;
            }

            update(elapsedTime) {
                if (elapsedTime > 8000 && elapsedTime < 13000) {
                    this.visible = true;
                    this.x += this.speed;
                } else {
                    this.visible = false;
                }
            }

            draw() {
                if (!this.visible) return;

                // Draw simple gorilla shape
                ctx.fillStyle = '#333';
                // Body
                ctx.fillRect(this.x, this.y - 40, this.width, this.height);
                // Head
                ctx.beginPath();
                ctx.arc(this.x + this.width / 2, this.y - 50, 25, 0, Math.PI * 2);
                ctx.fill();
                // Arms
                ctx.fillRect(this.x - 15, this.y - 30, 15, 40);
                ctx.fillRect(this.x + this.width, this.y - 30, 15, 40);
            }
        }

        // Game state
        let players = [];
        let gorilla = null;
        let gameRunning = false;
        let startTime = 0;
        let whitePasses = 0;
        let userCount = 0;
        let ballHolder = null;
        let passTimer = 0;
        let sawGorilla = false;

        function initGame() {
            players = [];
            // Create white team
            for (let i = 0; i < 3; i++) {
                players.push(new Player(
                    Math.random() * (canvas.width - 100) + 50,
                    Math.random() * (canvas.height - 100) + 50,
                    '#ffffff',
                    'white'
                ));
            }
            // Create black team
            for (let i = 0; i < 3; i++) {
                players.push(new Player(
                    Math.random() * (canvas.width - 100) + 50,
                    Math.random() * (canvas.height - 100) + 50,
                    '#333333',
                    'black'
                ));
            }

            gorilla = new Gorilla();
            ballHolder = players[0];
            ballHolder.hasBall = true;
            whitePasses = 0;
            userCount = 0;
            sawGorilla = false;
            whiteCountDisplay.textContent = '0';
            userCountDisplay.textContent = '0';
        }

        function passBall() {
            if (!ballHolder) return;

            // Find nearby teammates
            const teammates = players.filter(p =>
                p !== ballHolder &&
                p.team === ballHolder.team &&
                Math.hypot(p.x - ballHolder.x, p.y - ballHolder.y) < 200
            );

            if (teammates.length > 0) {
                ballHolder.hasBall = false;
                const newHolder = teammates[Math.floor(Math.random() * teammates.length)];
                newHolder.hasBall = true;
                ballHolder = newHolder;

                if (ballHolder.team === 'white') {
                    whitePasses++;
                    whiteCountDisplay.textContent = whitePasses;
                }
            }
        }

        // User counting
        document.addEventListener('keydown', (e) => {
            if (gameRunning && e.code === 'Space') {
                userCount++;
                userCountDisplay.textContent = userCount;
            }
        });

        canvas.addEventListener('click', () => {
            if (gameRunning) {
                userCount++;
                userCountDisplay.textContent = userCount;
            }
        });

        // Start game
        startBtn.addEventListener('click', () => {
            instructions.style.display = 'none';
            counter.style.display = 'block';
            gameRunning = true;
            startTime = performance.now();
            initGame();
        });

        startBtn2.addEventListener('click', () => {
            result.style.display = 'none';
            instructions.style.display = 'block';
        });

        // Animation loop
        function animate(currentTime) {
            updateFPS();

            ctx.fillStyle = '#0a0e1a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            if (gameRunning) {
                const elapsed = currentTime - startTime;

                // Update players
                players.forEach(player => {
                    player.update();
                    player.draw();
                });

                // Update gorilla
                gorilla.update(elapsed);
                gorilla.draw();

                // Pass ball periodically
                passTimer++;
                if (passTimer > 90) {
                    passBall();
                    passTimer = 0;
                }

                // End game after 15 seconds
                if (elapsed > 15000) {
                    gameRunning = false;
                    counter.style.display = 'none';
                    showResults();
                }
            }

            requestAnimationFrame(animate);
        }

        function showResults() {
            const accuracy = whitePasses > 0 ? Math.abs(userCount - whitePasses) : 0;
            let resultText = '';

            if (accuracy === 0) {
                resultText = `<span class="correct">Perfect! You counted exactly ${whitePasses} passes.</span>`;
            } else if (accuracy <= 2) {
                resultText = `<span class="correct">Close! You counted ${userCount}, actual was ${whitePasses}.</span>`;
            } else {
                resultText = `<span class="incorrect">You counted ${userCount}, but there were ${whitePasses} passes.</span>`;
            }

            document.getElementById('resultText').innerHTML = resultText;
            document.getElementById('passCount').innerHTML = `<strong>Actual white team passes: ${whitePasses}</strong>`;

            setTimeout(() => {
                document.getElementById('gorillaQuestion').innerHTML =
                    '<strong>But did you notice the GORILLA walking across the screen?</strong>';
            }, 2000);

            result.style.display = 'block';
        }

        // Start animation
        animate(performance.now());
    </script>
</body>
</html>
