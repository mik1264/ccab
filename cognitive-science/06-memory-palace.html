<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Palace - Cognitive Science</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: #0a0e1a;
            color: #e0e0e0;
            overflow: hidden;
        }

        #canvas {
            display: block;
            background: #0a0e1a;
            cursor: pointer;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #8A9A5B;
            text-decoration: none;
            font-size: 16px;
            font-weight: 600;
            padding: 10px 20px;
            background: rgba(138, 154, 91, 0.2);
            border-radius: 8px;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .back-link:hover {
            background: rgba(138, 154, 91, 0.4);
            transform: translateX(-5px);
        }

        #fps {
            position: fixed;
            top: 20px;
            right: 20px;
            color: #8A9A5B;
            font-size: 14px;
            font-weight: bold;
            background: rgba(10, 14, 26, 0.8);
            padding: 8px 12px;
            border-radius: 6px;
            z-index: 100;
        }

        #itemPalette {
            position: fixed;
            top: 80px;
            left: 20px;
            background: rgba(10, 14, 26, 0.9);
            padding: 20px;
            border-radius: 8px;
            max-width: 300px;
            z-index: 100;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
        }

        #itemPalette h3 {
            color: #8A9A5B;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .item-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .palette-item {
            background: #1a2332;
            border: 2px solid #444;
            border-radius: 8px;
            padding: 10px;
            cursor: pointer;
            text-align: center;
            font-size: 24px;
            transition: all 0.3s ease;
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .palette-item:hover {
            background: #2a3342;
            border-color: #8A9A5B;
            transform: scale(1.1);
        }

        .palette-item.selected {
            background: #8A9A5B;
            border-color: #DDA15E;
        }

        .control-btn {
            background: #BC6C25;
            color: white;
            border: none;
            padding: 10px;
            margin: 5px 0;
            width: 100%;
            font-size: 14px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: #A85D20;
        }

        #instructions {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(10, 14, 26, 0.95);
            padding: 20px 30px;
            border-radius: 12px;
            max-width: 700px;
            text-align: center;
            z-index: 100;
            border: 2px solid rgba(138, 154, 91, 0.3);
        }

        #instructions h2 {
            color: #8A9A5B;
            margin-bottom: 10px;
            font-size: 20px;
        }

        #instructions p {
            color: #b0b0b0;
            line-height: 1.6;
            font-size: 14px;
        }

        .highlight {
            color: #DDA15E;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Gallery</a>
    <div id="fps">FPS: 60</div>
    <canvas id="canvas"></canvas>

    <div id="itemPalette">
        <h3>Memory Items</h3>
        <div class="item-grid" id="itemGrid"></div>
        <button class="control-btn" onclick="clearPalace()">Clear Palace</button>
        <button class="control-btn" onclick="testMemory()">Test Memory</button>
        <button class="control-btn" onclick="revealAll()">Reveal All</button>
    </div>

    <div id="instructions">
        <h2>Memory Palace Technique</h2>
        <p><span class="highlight">Click an item</span> from the palette, then <span class="highlight">click in the palace</span> to place it.</p>
        <p>Associate items with specific locations in your mental space to remember them better!</p>
        <p><strong>Try:</strong> Create a story connecting the items as you place them.</p>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const fpsDisplay = document.getElementById('fps');

        // Set canvas size
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // FPS Counter
        let lastTime = performance.now();
        let frameCount = 0;
        let fps = 60;

        function updateFPS() {
            frameCount++;
            const currentTime = performance.now();
            if (currentTime >= lastTime + 1000) {
                fps = Math.round((frameCount * 1000) / (currentTime - lastTime));
                fpsDisplay.textContent = `FPS: ${fps}`;
                frameCount = 0;
                lastTime = currentTime;
            }
        }

        // Available items
        const items = [
            'üçé', 'üìö', 'üîë', 'üå∫', '‚≠ê', 'üéµ',
            'üè†', 'üöó', '‚òï', 'üé®', 'üí°', 'üéÅ',
            'üåô', 'üîî', 'üëë', 'üå≤', 'üéØ', 'ü¶ã',
            'üé≠', 'üèÜ', 'üåà', 'üíé', 'üé™', 'üçï'
        ];

        // Create palette
        const itemGrid = document.getElementById('itemGrid');
        items.forEach(item => {
            const div = document.createElement('div');
            div.className = 'palette-item';
            div.textContent = item;
            div.onclick = () => selectItem(item, div);
            itemGrid.appendChild(div);
        });

        let selectedItem = null;
        let selectedElement = null;

        function selectItem(item, element) {
            selectedItem = item;

            // Update visual selection
            document.querySelectorAll('.palette-item').forEach(el => {
                el.classList.remove('selected');
            });
            element.classList.add('selected');
        }

        // Palace rooms and placed items
        class Room {
            constructor(x, y, width, height, name) {
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
                this.name = name;
            }

            draw() {
                // Room outline
                ctx.strokeStyle = '#4ECDC4';
                ctx.lineWidth = 3;
                ctx.strokeRect(this.x, this.y, this.width, this.height);

                // Room name
                ctx.fillStyle = '#8A9A5B';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(this.name, this.x + this.width / 2, this.y - 10);
            }

            contains(x, y) {
                return x >= this.x && x <= this.x + this.width &&
                       y >= this.y && y <= this.y + this.height;
            }
        }

        class PlacedItem {
            constructor(x, y, emoji, visible = true) {
                this.x = x;
                this.y = y;
                this.emoji = emoji;
                this.visible = visible;
                this.size = 40;
            }

            draw() {
                if (!this.visible) {
                    // Draw placeholder
                    ctx.fillStyle = '#444';
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, 25, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.fillStyle = '#666';
                    ctx.font = '20px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText('?', this.x, this.y);
                } else {
                    // Draw item with glow
                    ctx.shadowBlur = 15;
                    ctx.shadowColor = '#DDA15E';
                    ctx.font = `${this.size}px Arial`;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(this.emoji, this.x, this.y);
                    ctx.shadowBlur = 0;
                }
            }

            contains(x, y) {
                return Math.hypot(x - this.x, y - this.y) < this.size;
            }
        }

        // Create palace layout
        const rooms = [];
        const placedItems = [];

        function initializePalace() {
            rooms.length = 0;
            const margin = 100;
            const roomWidth = (canvas.width - margin * 3) / 2;
            const roomHeight = (canvas.height - margin * 4 - 100) / 2;

            // Create 2x2 grid of rooms
            rooms.push(new Room(margin, margin, roomWidth, roomHeight, 'Entry Hall'));
            rooms.push(new Room(margin * 2 + roomWidth, margin, roomWidth, roomHeight, 'Study'));
            rooms.push(new Room(margin, margin * 2 + roomHeight, roomWidth, roomHeight, 'Kitchen'));
            rooms.push(new Room(margin * 2 + roomWidth, margin * 2 + roomHeight, roomWidth, roomHeight, 'Garden'));

            // Draw doors
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 5;
        }

        // Place item on canvas
        canvas.addEventListener('click', (e) => {
            if (!selectedItem) return;

            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            // Check if click is in a room
            const room = rooms.find(r => r.contains(x, y));
            if (room) {
                // Check if too close to existing items
                const tooClose = placedItems.some(item =>
                    Math.hypot(item.x - x, item.y - y) < 60
                );

                if (!tooClose) {
                    placedItems.push(new PlacedItem(x, y, selectedItem));
                }
            }
        });

        // Control functions
        window.clearPalace = function() {
            placedItems.length = 0;
        };

        window.testMemory = function() {
            placedItems.forEach(item => item.visible = false);
            setTimeout(() => {
                alert('Click on the hidden items to reveal them and test your memory!');
            }, 100);
        };

        window.revealAll = function() {
            placedItems.forEach(item => item.visible = true);
        };

        // Click to reveal hidden items
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            placedItems.forEach(item => {
                if (!item.visible && item.contains(x, y)) {
                    item.visible = true;
                }
            });
        });

        // Drawing
        function draw() {
            ctx.fillStyle = '#0a0e1a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw palace structure
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;

            // Draw floor
            ctx.fillStyle = '#1a2332';
            ctx.fillRect(50, 50, canvas.width - 100, canvas.height - 150);

            // Draw rooms
            rooms.forEach(room => room.draw());

            // Draw corridors
            ctx.strokeStyle = '#555';
            ctx.lineWidth = 2;
            ctx.setLineDash([10, 5]);

            // Horizontal corridor
            ctx.beginPath();
            ctx.moveTo(rooms[0].x + rooms[0].width, rooms[0].y + rooms[0].height / 2);
            ctx.lineTo(rooms[1].x, rooms[1].y + rooms[1].height / 2);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(rooms[2].x + rooms[2].width, rooms[2].y + rooms[2].height / 2);
            ctx.lineTo(rooms[3].x, rooms[3].y + rooms[3].height / 2);
            ctx.stroke();

            // Vertical corridor
            ctx.beginPath();
            ctx.moveTo(rooms[0].x + rooms[0].width / 2, rooms[0].y + rooms[0].height);
            ctx.lineTo(rooms[2].x + rooms[2].width / 2, rooms[2].y);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(rooms[1].x + rooms[1].width / 2, rooms[1].y + rooms[1].height);
            ctx.lineTo(rooms[3].x + rooms[3].width / 2, rooms[3].y);
            ctx.stroke();

            ctx.setLineDash([]);

            // Draw placed items
            placedItems.forEach(item => item.draw());

            // Draw furniture/landmarks
            drawLandmarks();
        }

        function drawLandmarks() {
            // Entry Hall - chandelier
            ctx.fillStyle = '#FFD700';
            ctx.font = '30px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('üí°', rooms[0].x + rooms[0].width / 2, rooms[0].y + 50);

            // Study - bookshelf
            ctx.fillText('üìö', rooms[1].x + 40, rooms[1].y + rooms[1].height / 2);

            // Kitchen - stove
            ctx.fillText('üç≥', rooms[2].x + rooms[2].width - 40, rooms[2].y + rooms[2].height / 2);

            // Garden - tree
            ctx.fillText('üå≥', rooms[3].x + rooms[3].width / 2, rooms[3].y + rooms[3].height - 40);
        }

        // Animation loop
        function animate() {
            updateFPS();
            draw();
            requestAnimationFrame(animate);
        }

        initializePalace();
        animate();

    // Expose for enhance.js keyboard shortcuts
    window.reset = function() { initializePalace(); };
    window.init = window.reset;
    </script>
    <script src="../assets/js/enhance.js" defer></script>
</body>
</html>
