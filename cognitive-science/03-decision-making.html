<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decision Making Simulation | Cognitive Science</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e2e8f0;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        .back-link {
            display: inline-block;
            color: #34d399;
            text-decoration: none;
            margin-bottom: 20px;
            padding: 8px 16px;
            border: 1px solid rgba(52, 211, 153, 0.3);
            border-radius: 20px;
            transition: all 0.3s;
        }

        .back-link:hover {
            background: rgba(52, 211, 153, 0.1);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #34d399, #10b981);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: #94a3b8;
            font-size: 1.1rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
        }

        .simulation-area {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(52, 211, 153, 0.2);
        }

        #canvas {
            width: 100%;
            height: 400px;
            background: #0a0a14;
            border-radius: 15px;
        }

        .decision-panel {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 30px;
        }

        .option-btn {
            padding: 20px 50px;
            font-size: 1.5rem;
            font-weight: bold;
            border: 3px solid;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(0, 0, 0, 0.3);
        }

        .option-btn.left {
            border-color: #ef4444;
            color: #ef4444;
        }

        .option-btn.right {
            border-color: #3b82f6;
            color: #3b82f6;
        }

        .option-btn:hover {
            transform: scale(1.05);
        }

        .option-btn.left:hover {
            background: rgba(239, 68, 68, 0.2);
        }

        .option-btn.right:hover {
            background: rgba(59, 130, 246, 0.2);
        }

        .option-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .feedback-msg {
            text-align: center;
            margin-top: 15px;
            font-size: 1.2rem;
            min-height: 30px;
        }

        .controls {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(52, 211, 153, 0.2);
        }

        .control-group {
            margin-bottom: 25px;
        }

        .control-group label {
            display: block;
            margin-bottom: 10px;
            color: #34d399;
            font-weight: 600;
        }

        .control-group input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: rgba(52, 211, 153, 0.2);
            outline: none;
            -webkit-appearance: none;
        }

        .control-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #34d399;
            cursor: pointer;
        }

        .control-value {
            text-align: center;
            margin-top: 8px;
            font-size: 0.9rem;
            color: #94a3b8;
        }

        .btn {
            width: 100%;
            padding: 15px 30px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #34d399, #10b981);
            color: #1a1a2e;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(52, 211, 153, 0.4);
        }

        .model-info {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 0.85rem;
            line-height: 1.6;
            color: #94a3b8;
        }

        .model-info strong {
            color: #34d399;
        }

        .stats-panel {
            background: rgba(52, 211, 153, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .stats-panel h3 {
            color: #34d399;
            margin-bottom: 15px;
            font-size: 1rem;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(52, 211, 153, 0.1);
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #94a3b8;
        }

        .stat-value {
            color: #34d399;
            font-weight: 600;
        }

        .rt-histogram {
            margin-top: 15px;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-link">← Back to Cognitive Science</a>
            <h1>Decision Making</h1>
            <p class="subtitle">Drift-Diffusion Model of perceptual decision processes</p>
        </header>

        <div class="main-content">
            <div class="simulation-area">
                <canvas id="canvas"></canvas>
                <div class="decision-panel">
                    <button class="option-btn left" id="leftBtn">← LEFT</button>
                    <button class="option-btn right" id="rightBtn">RIGHT →</button>
                </div>
                <div class="feedback-msg" id="feedback"></div>
            </div>

            <div class="controls">
                <div class="model-info">
                    <strong>Drift-Diffusion Model (DDM):</strong><br>
                    Evidence accumulates over time until reaching a decision threshold. The drift rate reflects signal strength, while noise causes variability. Watch the evidence trace reach the boundary!
                </div>

                <div class="control-group">
                    <label>Evidence Strength: <span id="driftValue">0.03</span></label>
                    <input type="range" id="driftRate" min="0.01" max="0.08" step="0.005" value="0.03">
                    <div class="control-value">Higher = easier decision</div>
                </div>

                <div class="control-group">
                    <label>Noise Level: <span id="noiseValue">0.1</span></label>
                    <input type="range" id="noise" min="0.05" max="0.3" step="0.01" value="0.1">
                    <div class="control-value">Higher = more variability</div>
                </div>

                <div class="control-group">
                    <label>Decision Threshold: <span id="thresholdValue">1.0</span></label>
                    <input type="range" id="threshold" min="0.5" max="2.0" step="0.1" value="1.0">
                    <div class="control-value">Higher = more careful</div>
                </div>

                <div class="control-group">
                    <label>Bias (Starting Point): <span id="biasValue">0</span></label>
                    <input type="range" id="bias" min="-0.3" max="0.3" step="0.05" value="0">
                    <div class="control-value">Negative = LEFT bias</div>
                </div>

                <button class="btn btn-primary" id="startBtn">Start Trial</button>
                <button class="btn btn-primary" id="autoBtn">Auto-Run 20 Trials</button>

                <div class="stats-panel">
                    <h3>Performance Statistics</h3>
                    <div class="stat-row">
                        <span class="stat-label">Trials</span>
                        <span class="stat-value" id="trialCount">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Accuracy</span>
                        <span class="stat-value" id="accuracy">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Mean RT (Correct)</span>
                        <span class="stat-value" id="meanRTCorrect">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Mean RT (Error)</span>
                        <span class="stat-value" id="meanRTError">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Speed-Accuracy</span>
                        <span class="stat-value" id="speedAccuracy">-</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let width, height;
        let evidence = 0;
        let evidenceHistory = [];
        let trialRunning = false;
        let correctAnswer = 'right';
        let decisionMade = false;
        let animationId;
        let trialStartTime;

        // Stats
        let stats = {
            trials: 0,
            correct: 0,
            rtCorrect: [],
            rtError: []
        };

        const driftRate = document.getElementById('driftRate');
        const noise = document.getElementById('noise');
        const threshold = document.getElementById('threshold');
        const bias = document.getElementById('bias');
        const startBtn = document.getElementById('startBtn');
        const autoBtn = document.getElementById('autoBtn');
        const leftBtn = document.getElementById('leftBtn');
        const rightBtn = document.getElementById('rightBtn');
        const feedback = document.getElementById('feedback');

        driftRate.addEventListener('input', () => document.getElementById('driftValue').textContent = driftRate.value);
        noise.addEventListener('input', () => document.getElementById('noiseValue').textContent = noise.value);
        threshold.addEventListener('input', () => document.getElementById('thresholdValue').textContent = threshold.value);
        bias.addEventListener('input', () => document.getElementById('biasValue').textContent = bias.value);

        function resize() {
            const rect = canvas.getBoundingClientRect();
            width = rect.width;
            height = rect.height;
            canvas.width = width * 2;
            canvas.height = height * 2;
            ctx.scale(2, 2);
        }

        function gaussianRandom() {
            let u = 0, v = 0;
            while (u === 0) u = Math.random();
            while (v === 0) v = Math.random();
            return Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
        }

        function startTrial() {
            if (trialRunning) return;

            trialRunning = true;
            decisionMade = false;
            feedback.textContent = '';
            feedback.style.color = '#94a3b8';

            // Randomly choose correct answer
            correctAnswer = Math.random() > 0.5 ? 'right' : 'left';

            // Initialize evidence with bias
            evidence = parseFloat(bias.value);
            evidenceHistory = [evidence];
            trialStartTime = Date.now();

            leftBtn.disabled = false;
            rightBtn.disabled = false;
            startBtn.disabled = true;

            runDDM();
        }

        function runDDM() {
            if (!trialRunning || decisionMade) return;

            const drift = parseFloat(driftRate.value) * (correctAnswer === 'right' ? 1 : -1);
            const noiseLevel = parseFloat(noise.value);
            const thresh = parseFloat(threshold.value);

            // Update evidence
            evidence += drift + gaussianRandom() * noiseLevel;
            evidenceHistory.push(evidence);

            draw();

            // Check if threshold reached (automatic decision)
            if (Math.abs(evidence) >= thresh) {
                const choice = evidence > 0 ? 'right' : 'left';
                makeDecision(choice, true);
                return;
            }

            animationId = requestAnimationFrame(runDDM);
        }

        function makeDecision(choice, automatic = false) {
            if (decisionMade) return;

            decisionMade = true;
            trialRunning = false;
            cancelAnimationFrame(animationId);

            const rt = Date.now() - trialStartTime;
            const correct = choice === correctAnswer;

            stats.trials++;
            if (correct) {
                stats.correct++;
                stats.rtCorrect.push(rt);
                feedback.textContent = `✓ Correct! RT: ${rt}ms` + (automatic ? ' (auto)' : '');
                feedback.style.color = '#34d399';
            } else {
                stats.rtError.push(rt);
                feedback.textContent = `✗ Error. RT: ${rt}ms` + (automatic ? ' (auto)' : '');
                feedback.style.color = '#ef4444';
            }

            leftBtn.disabled = true;
            rightBtn.disabled = true;
            startBtn.disabled = false;

            updateStats();
            draw();
        }

        function draw() {
            ctx.fillStyle = '#0a0a14';
            ctx.fillRect(0, 0, width, height);

            const thresh = parseFloat(threshold.value);
            const margin = 50;
            const plotWidth = width - 2 * margin;
            const plotHeight = height - 2 * margin;
            const centerY = height / 2;

            // Scale factor for threshold to fit in plot
            const yScale = (plotHeight / 2 - 20) / thresh;

            // Draw threshold boundaries
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 2;
            ctx.setLineDash([10, 5]);
            ctx.beginPath();
            ctx.moveTo(margin, centerY - thresh * yScale);
            ctx.lineTo(width - margin, centerY - thresh * yScale);
            ctx.stroke();

            ctx.strokeStyle = '#ef4444';
            ctx.beginPath();
            ctx.moveTo(margin, centerY + thresh * yScale);
            ctx.lineTo(width - margin, centerY + thresh * yScale);
            ctx.stroke();
            ctx.setLineDash([]);

            // Labels
            ctx.fillStyle = '#3b82f6';
            ctx.font = '14px Arial';
            ctx.fillText('RIGHT', width - margin + 5, centerY - thresh * yScale + 5);
            ctx.fillStyle = '#ef4444';
            ctx.fillText('LEFT', width - margin + 5, centerY + thresh * yScale + 5);

            // Draw center line
            ctx.strokeStyle = 'rgba(148, 163, 184, 0.3)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(margin, centerY);
            ctx.lineTo(width - margin, centerY);
            ctx.stroke();

            // Draw evidence trace
            if (evidenceHistory.length > 1) {
                const xStep = Math.min(2, plotWidth / evidenceHistory.length);

                ctx.strokeStyle = '#34d399';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(margin, centerY - evidenceHistory[0] * yScale);

                for (let i = 1; i < evidenceHistory.length; i++) {
                    const x = margin + i * xStep;
                    const y = centerY - evidenceHistory[i] * yScale;
                    ctx.lineTo(x, Math.max(margin, Math.min(height - margin, y)));
                }
                ctx.stroke();

                // Current position indicator
                const lastX = margin + (evidenceHistory.length - 1) * xStep;
                const lastY = centerY - evidence * yScale;

                ctx.fillStyle = '#34d399';
                ctx.beginPath();
                ctx.arc(lastX, Math.max(margin, Math.min(height - margin, lastY)), 6, 0, Math.PI * 2);
                ctx.fill();
            }

            // Draw correct answer indicator
            ctx.fillStyle = correctAnswer === 'right' ? '#3b82f6' : '#ef4444';
            ctx.font = 'bold 14px Arial';
            ctx.fillText(`Correct: ${correctAnswer.toUpperCase()}`, margin, 30);

            // Time display
            if (trialRunning) {
                const elapsed = Date.now() - trialStartTime;
                ctx.fillStyle = '#94a3b8';
                ctx.fillText(`Time: ${elapsed}ms`, width - margin - 80, 30);
            }
        }

        function updateStats() {
            document.getElementById('trialCount').textContent = stats.trials;
            document.getElementById('accuracy').textContent =
                stats.trials > 0 ? Math.round((stats.correct / stats.trials) * 100) + '%' : '-';
            document.getElementById('meanRTCorrect').textContent =
                stats.rtCorrect.length > 0 ? Math.round(stats.rtCorrect.reduce((a, b) => a + b, 0) / stats.rtCorrect.length) + 'ms' : '-';
            document.getElementById('meanRTError').textContent =
                stats.rtError.length > 0 ? Math.round(stats.rtError.reduce((a, b) => a + b, 0) / stats.rtError.length) + 'ms' : '-';

            // Speed-accuracy tradeoff
            if (stats.trials >= 5) {
                const acc = stats.correct / stats.trials;
                const avgRT = [...stats.rtCorrect, ...stats.rtError].reduce((a, b) => a + b, 0) / stats.trials;
                const saRatio = (acc * 1000) / avgRT;
                document.getElementById('speedAccuracy').textContent = saRatio.toFixed(2);
            }
        }

        async function autoRun() {
            autoBtn.disabled = true;
            for (let i = 0; i < 20; i++) {
                startTrial();
                await new Promise(r => setTimeout(r, 100));
                while (trialRunning) {
                    await new Promise(r => setTimeout(r, 10));
                }
                await new Promise(r => setTimeout(r, 200));
            }
            autoBtn.disabled = false;
        }

        leftBtn.addEventListener('click', () => makeDecision('left'));
        rightBtn.addEventListener('click', () => makeDecision('right'));
        startBtn.addEventListener('click', startTrial);
        autoBtn.addEventListener('click', autoRun);

        document.addEventListener('keydown', (e) => {
            if (!trialRunning || decisionMade) return;
            if (e.key === 'ArrowLeft') makeDecision('left');
            if (e.key === 'ArrowRight') makeDecision('right');
        });

        window.addEventListener('resize', resize);
        resize();
        draw();

        leftBtn.disabled = true;
        rightBtn.disabled = true;
    </script>
</body>
</html>
