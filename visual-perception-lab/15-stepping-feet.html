<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stepping Feet Illusion</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #1a1a2e; overflow: hidden; font-family: 'Segoe UI', Tahoma, sans-serif; }
canvas { display: block; }
a { position: fixed; top: 20px; left: 20px; color: #8af; text-decoration: none; z-index: 100; font-size: 1.2em; }
#controls {
  position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
  background: rgba(20,20,40,0.85); backdrop-filter: blur(10px);
  padding: 18px 24px; border-radius: 14px; color: #ccd; z-index: 100;
  display: flex; flex-wrap: wrap; gap: 14px; align-items: center; max-width: 800px;
  border: 1px solid rgba(255,255,255,0.08);
}
#controls label { font-size: 0.85em; display: flex; align-items: center; gap: 6px; }
#controls input[type=range] { width: 90px; accent-color: #8af; }
button {
  background: rgba(100,140,255,0.2); color: #8af; border: 1px solid rgba(100,140,255,0.3);
  padding: 6px 14px; border-radius: 8px; cursor: pointer; font-size: 0.85em;
}
button:hover { background: rgba(100,140,255,0.35); }
button.active { background: rgba(100,255,140,0.2); color: #8fa; border-color: rgba(100,255,140,0.3); }
#info {
  position: fixed; top: 20px; right: 20px; background: rgba(20,20,40,0.85);
  backdrop-filter: blur(10px); padding: 16px 20px; border-radius: 12px;
  color: #aab; font-size: 0.82em; max-width: 320px; z-index: 100; line-height: 1.5;
  border: 1px solid rgba(255,255,255,0.08);
}
#info strong { color: #dde; }
</style>
</head>
<body>
<a href="index.html">&#8592; Back</a>
<canvas id="c"></canvas>

<div id="info">
  <strong>Stepping Feet Illusion</strong><br><br>
  When a bar's contrast with the background changes (high contrast to low contrast), its perceived speed decreases.<br><br>
  Both bars move at <em>exactly the same constant speed</em>. Remove the stripes to confirm! The "stepping" effect is caused by contrast-dependent speed perception.
</div>

<div id="controls">
  <label>Speed <input type="range" id="speed" min="1" max="10" value="3"></label>
  <label>Stripe width <input type="range" id="stripeW" min="20" max="120" value="50"></label>
  <label>Contrast <input type="range" id="contrast" min="10" max="100" value="90"></label>
  <label>Light bar <input type="range" id="lightBar" min="150" max="255" value="210"></label>
  <label>Dark bar <input type="range" id="darkBar" min="0" max="100" value="40"></label>
  <button id="btnStripes" class="active">Stripes On</button>
  <button id="btnMarkers">Show Markers</button>
  <button id="btnReveal">Reveal (No Stripes)</button>
</div>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let W, H;

let speed = 3;
let stripeWidth = 50;
let contrast = 90;
let lightBarColor = 210;
let darkBarColor = 40;
let showStripes = true;
let showMarkers = false;
let revealMode = false;
let barX = 0;

const BAR_HEIGHT = 30;
const BAR_WIDTH_RATIO = 0.12;

function resize() {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
}

function draw(time) {
  const dt = speed * 1.2;
  barX += dt;

  const barWidth = W * BAR_WIDTH_RATIO;
  if (barX > W + barWidth) barX = -barWidth;

  ctx.fillStyle = '#1a1a2e';
  ctx.fillRect(0, 0, W, H);

  const zoneTop = H * 0.2;
  const zoneHeight = H * 0.55;
  const zoneMid = zoneTop + zoneHeight / 2;

  // Background zone
  ctx.fillStyle = '#888888';
  ctx.fillRect(0, zoneTop, W, zoneHeight);

  // Draw stripes
  if (showStripes && !revealMode) {
    const dark = Math.round(128 - (contrast / 100) * 128);
    const light = Math.round(128 + (contrast / 100) * 127);

    for (let x = 0; x < W; x += stripeWidth * 2) {
      ctx.fillStyle = `rgb(${dark},${dark},${dark})`;
      ctx.fillRect(x, zoneTop, stripeWidth, zoneHeight);
      ctx.fillStyle = `rgb(${light},${light},${light})`;
      ctx.fillRect(x + stripeWidth, zoneTop, stripeWidth, zoneHeight);
    }
  }

  // Light bar (top)
  const barY1 = zoneMid - BAR_HEIGHT - 15;
  const barY2 = zoneMid + 15;

  ctx.fillStyle = `rgb(${lightBarColor},${lightBarColor},${lightBarColor})`;
  ctx.fillRect(barX, barY1, barWidth, BAR_HEIGHT);

  // Dark bar (bottom)
  ctx.fillStyle = `rgb(${darkBarColor},${darkBarColor},${darkBarColor})`;
  ctx.fillRect(barX, barY2, barWidth, BAR_HEIGHT);

  // Tracking markers
  if (showMarkers) {
    ctx.fillStyle = '#ff4444';
    ctx.beginPath();
    ctx.arc(barX + barWidth / 2, barY1 - 8, 4, 0, Math.PI * 2);
    ctx.fill();
    ctx.beginPath();
    ctx.arc(barX + barWidth / 2, barY2 + BAR_HEIGHT + 8, 4, 0, Math.PI * 2);
    ctx.fill();

    // Vertical alignment line
    ctx.strokeStyle = 'rgba(255,68,68,0.4)';
    ctx.lineWidth = 1;
    ctx.setLineDash([3, 3]);
    ctx.beginPath();
    ctx.moveTo(barX + barWidth / 2, barY1 - 12);
    ctx.lineTo(barX + barWidth / 2, barY2 + BAR_HEIGHT + 12);
    ctx.stroke();
    ctx.setLineDash([]);
  }

  // Labels
  ctx.fillStyle = 'rgba(200,200,220,0.5)';
  ctx.font = '13px sans-serif';
  ctx.textAlign = 'left';
  ctx.fillText('Light bar', 20, barY1 + BAR_HEIGHT / 2 + 4);
  ctx.fillText('Dark bar', 20, barY2 + BAR_HEIGHT / 2 + 4);

  // Speed indicator
  ctx.fillStyle = 'rgba(200,200,220,0.3)';
  ctx.font = '12px sans-serif';
  ctx.textAlign = 'center';
  ctx.fillText('Both bars: SAME constant speed', W / 2, zoneTop + zoneHeight + 30);

  if (revealMode) {
    ctx.fillStyle = 'rgba(100,255,140,0.5)';
    ctx.font = '16px sans-serif';
    ctx.fillText('No stripes - see? They move together!', W / 2, zoneTop - 15);
  }

  requestAnimationFrame(draw);
}

document.getElementById('speed').addEventListener('input', e => {
  speed = parseInt(e.target.value);
});

document.getElementById('stripeW').addEventListener('input', e => {
  stripeWidth = parseInt(e.target.value);
});

document.getElementById('contrast').addEventListener('input', e => {
  contrast = parseInt(e.target.value);
});

document.getElementById('lightBar').addEventListener('input', e => {
  lightBarColor = parseInt(e.target.value);
});

document.getElementById('darkBar').addEventListener('input', e => {
  darkBarColor = parseInt(e.target.value);
});

document.getElementById('btnStripes').addEventListener('click', () => {
  showStripes = !showStripes;
  revealMode = false;
  const btn = document.getElementById('btnStripes');
  btn.textContent = showStripes ? 'Stripes On' : 'Stripes Off';
  btn.classList.toggle('active', showStripes);
  document.getElementById('btnReveal').classList.remove('active');
});

document.getElementById('btnMarkers').addEventListener('click', () => {
  showMarkers = !showMarkers;
  const btn = document.getElementById('btnMarkers');
  btn.textContent = showMarkers ? 'Hide Markers' : 'Show Markers';
  btn.classList.toggle('active', showMarkers);
});

document.getElementById('btnReveal').addEventListener('click', () => {
  revealMode = !revealMode;
  const btn = document.getElementById('btnReveal');
  btn.classList.toggle('active', revealMode);
  if (revealMode) {
    showStripes = false;
    document.getElementById('btnStripes').textContent = 'Stripes Off';
    document.getElementById('btnStripes').classList.remove('active');
  }
});

window.reset = function() {
  speed = 3;
  stripeWidth = 50;
  contrast = 90;
  lightBarColor = 210;
  darkBarColor = 40;
  showStripes = true;
  showMarkers = false;
  revealMode = false;
  barX = 0;
  document.getElementById('speed').value = 3;
  document.getElementById('stripeW').value = 50;
  document.getElementById('contrast').value = 90;
  document.getElementById('lightBar').value = 210;
  document.getElementById('darkBar').value = 40;
  document.getElementById('btnStripes').textContent = 'Stripes On';
  document.getElementById('btnStripes').classList.add('active');
  document.getElementById('btnMarkers').textContent = 'Show Markers';
  document.getElementById('btnMarkers').classList.remove('active');
  document.getElementById('btnReveal').classList.remove('active');
};

let resizeTimer;
window.addEventListener('resize', () => {
  clearTimeout(resizeTimer);
  resizeTimer = setTimeout(resize, 150);
});

resize();
requestAnimationFrame(draw);
</script>
<script src="../assets/js/enhance.js"></script>
</body>
</html>