<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Troxler's Fading</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #888; overflow: hidden; font-family: 'Segoe UI', Tahoma, sans-serif; }
canvas { display: block; }
a { position: fixed; top: 20px; left: 20px; color: #8af; text-decoration: none; z-index: 100; font-size: 1.2em; }
#controls {
  position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
  background: rgba(20,20,40,0.85); backdrop-filter: blur(10px);
  padding: 18px 24px; border-radius: 14px; color: #ccd; z-index: 100;
  display: flex; flex-wrap: wrap; gap: 14px; align-items: center; max-width: 750px;
  border: 1px solid rgba(255,255,255,0.08);
}
#controls label { font-size: 0.82em; display: flex; align-items: center; gap: 6px; }
#controls input[type=range] { width: 90px; accent-color: #8af; }
button {
  background: rgba(100,140,255,0.2); color: #8af; border: 1px solid rgba(100,140,255,0.3);
  padding: 6px 14px; border-radius: 8px; cursor: pointer; font-size: 0.85em;
}
button:hover { background: rgba(100,140,255,0.35); }
#info {
  position: fixed; top: 20px; right: 20px; background: rgba(20,20,40,0.85);
  backdrop-filter: blur(10px); padding: 16px 20px; border-radius: 12px;
  color: #aab; font-size: 0.82em; max-width: 320px; z-index: 100; line-height: 1.5;
  border: 1px solid rgba(255,255,255,0.08);
}
#info strong { color: #dde; }
#timer {
  position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
  pointer-events: none; z-index: 50; text-align: center;
}
#timer .elapsed {
  color: rgba(255,255,255,0.5); font-size: 1.1em; margin-top: 60px; display: block;
}
#timer .hint {
  color: rgba(180,220,255,0.7); font-size: 0.95em; margin-top: 8px; display: none;
}
select {
  background: rgba(100,140,255,0.15); color: #8af; border: 1px solid rgba(100,140,255,0.3);
  padding: 4px 8px; border-radius: 6px; font-size: 0.82em;
}
</style>
</head>
<body>
<a href="index.html">&#8592; Back</a>
<canvas id="c"></canvas>

<div id="timer">
  <span class="elapsed" id="elapsedText"></span>
  <span class="hint" id="hintText">Are the shapes gone? Move your eyes to bring them back!</span>
</div>

<div id="info">
  <strong>Troxler's Fading</strong><br><br>
  Stare at the <em>central dot</em> without moving your eyes. After 10-20 seconds, the colored shapes in your peripheral vision will begin to <strong>fade and vanish</strong>.<br><br>
  The shapes are still physically there -- your brain simply stops processing unchanging peripheral stimuli.<br><br>
  <strong>Troxler's effect</strong> occurs because neurons stop responding to unchanging stimuli. Without eye movements to refresh the retinal image, peripheral objects fade from consciousness.
</div>

<div id="controls">
  <label>Shapes <input type="range" id="numShapes" min="3" max="12" value="8"> <span id="numShapesVal">8</span></label>
  <label>Saturation <input type="range" id="saturation" min="20" max="100" value="60"> <span id="saturationVal">60</span>%</label>
  <label>Blur <input type="range" id="blurAmt" min="10" max="60" value="35"> <span id="blurAmtVal">35</span>px</label>
  <label>Distance <input type="range" id="distance" min="80" max="300" value="160"> <span id="distanceVal">160</span>px</label>
  <label>BG
    <select id="bgColor">
      <option value="#888888">Gray</option>
      <option value="#6a6a7a">Blue-gray</option>
      <option value="#7a7a6a">Green-gray</option>
      <option value="#aaaaaa">Light gray</option>
      <option value="#555555">Dark gray</option>
    </select>
  </label>
  <button id="interruptBtn">Interrupt (jiggle)</button>
  <button id="resetBtn">Reset</button>
</div>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');

let W, H;
let shapes = [];
let numShapes = 8;
let saturation = 60;
let blurAmt = 35;
let dist = 160;
let bgColor = '#888888';
let startTime = Date.now();
let jiggleOffset = [];
let jiggling = false;
let jiggleStart = 0;
let animId;

function resize() {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
  generateShapes();
}

function generateShapes() {
  shapes = [];
  jiggleOffset = [];
  const cx = W / 2;
  const cy = H / 2;
  for (let i = 0; i < numShapes; i++) {
    const angle = (i / numShapes) * Math.PI * 2 - Math.PI / 2;
    const hue = (i / numShapes) * 360;
    shapes.push({
      x: cx + Math.cos(angle) * dist,
      y: cy + Math.sin(angle) * dist,
      radius: 25 + Math.random() * 15,
      hue: hue,
      angle: angle
    });
    jiggleOffset.push({ x: 0, y: 0 });
  }
  startTime = Date.now();
  document.getElementById('hintText').style.display = 'none';
}

function drawGaussianCircle(x, y, radius, hue, sat, blur) {
  const steps = 12;
  for (let i = steps; i >= 0; i--) {
    const t = i / steps;
    const r = radius + blur * t;
    const alpha = Math.exp(-t * t * 3) * 0.7;
    ctx.beginPath();
    ctx.arc(x, y, r, 0, Math.PI * 2);
    ctx.fillStyle = `hsla(${hue}, ${sat}%, 55%, ${alpha})`;
    ctx.fill();
  }
}

function draw() {
  // Background
  ctx.fillStyle = bgColor;
  ctx.fillRect(0, 0, W, H);

  const cx = W / 2;
  const cy = H / 2;

  // Handle jiggle animation
  if (jiggling) {
    const elapsed = Date.now() - jiggleStart;
    if (elapsed > 600) {
      jiggling = false;
      for (let i = 0; i < jiggleOffset.length; i++) {
        jiggleOffset[i].x = 0;
        jiggleOffset[i].y = 0;
      }
      startTime = Date.now();
      document.getElementById('hintText').style.display = 'none';
    } else {
      const progress = elapsed / 600;
      const amp = 15 * (1 - progress);
      for (let i = 0; i < jiggleOffset.length; i++) {
        jiggleOffset[i].x = Math.sin(elapsed * 0.02 + i * 1.5) * amp;
        jiggleOffset[i].y = Math.cos(elapsed * 0.025 + i * 1.2) * amp;
      }
    }
  }

  // Draw shapes with gaussian blur edges
  for (let i = 0; i < shapes.length; i++) {
    const s = shapes[i];
    const newAngle = (i / numShapes) * Math.PI * 2 - Math.PI / 2;
    const sx = cx + Math.cos(newAngle) * dist + (jiggleOffset[i] ? jiggleOffset[i].x : 0);
    const sy = cy + Math.sin(newAngle) * dist + (jiggleOffset[i] ? jiggleOffset[i].y : 0);
    drawGaussianCircle(sx, sy, s.radius, s.hue, saturation, blurAmt);
  }

  // Central fixation dot
  ctx.beginPath();
  ctx.arc(cx, cy, 5, 0, Math.PI * 2);
  ctx.fillStyle = '#000';
  ctx.fill();
  ctx.beginPath();
  ctx.arc(cx, cy, 2.5, 0, Math.PI * 2);
  ctx.fillStyle = '#fff';
  ctx.fill();

  // Update timer
  const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
  const elapsedText = document.getElementById('elapsedText');
  elapsedText.textContent = `Keep staring... ${elapsed}s`;
  elapsedText.style.marginTop = (Math.min(dist, 160) + 50) + 'px';

  if (parseFloat(elapsed) >= 15 && !jiggling) {
    document.getElementById('hintText').style.display = 'block';
  }

  animId = requestAnimationFrame(draw);
}

// Controls
function bindSlider(id, valId, callback) {
  const el = document.getElementById(id);
  const valEl = document.getElementById(valId);
  el.addEventListener('input', () => {
    valEl.textContent = el.value;
    callback(parseInt(el.value));
  });
}

bindSlider('numShapes', 'numShapesVal', v => { numShapes = v; generateShapes(); });
bindSlider('saturation', 'saturationVal', v => { saturation = v; });
bindSlider('blurAmt', 'blurAmtVal', v => { blurAmt = v; });
bindSlider('distance', 'distanceVal', v => { dist = v; });

document.getElementById('bgColor').addEventListener('change', e => {
  bgColor = e.target.value;
  document.body.style.background = bgColor;
});

document.getElementById('interruptBtn').addEventListener('click', () => {
  jiggling = true;
  jiggleStart = Date.now();
});

document.getElementById('resetBtn').addEventListener('click', () => {
  window.reset();
});

window.reset = function() {
  numShapes = 8; saturation = 60; blurAmt = 35; dist = 160;
  bgColor = '#888888';
  document.getElementById('numShapes').value = 8;
  document.getElementById('numShapesVal').textContent = '8';
  document.getElementById('saturation').value = 60;
  document.getElementById('saturationVal').textContent = '60';
  document.getElementById('blurAmt').value = 35;
  document.getElementById('blurAmtVal').textContent = '35';
  document.getElementById('distance').value = 160;
  document.getElementById('distanceVal').textContent = '160';
  document.getElementById('bgColor').value = '#888888';
  document.body.style.background = '#888888';
  generateShapes();
};

let resizeTimer;
window.addEventListener('resize', () => {
  clearTimeout(resizeTimer);
  resizeTimer = setTimeout(resize, 150);
});

resize();
draw();
</script>
<script src="../assets/js/enhance.js"></script>
</body>
</html>