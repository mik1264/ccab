<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Phi Phenomenon & Beta Motion</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #1a1a2e; overflow: hidden; font-family: 'Segoe UI', Tahoma, sans-serif; }
canvas { display: block; }
a { position: fixed; top: 20px; left: 20px; color: #8af; text-decoration: none; z-index: 100; font-size: 1.2em; }
#controls {
  position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
  background: rgba(20,20,40,0.85); backdrop-filter: blur(10px);
  padding: 18px 24px; border-radius: 14px; color: #ccd; z-index: 100;
  display: flex; flex-wrap: wrap; gap: 14px; align-items: center; max-width: 850px;
  border: 1px solid rgba(255,255,255,0.08);
}
#controls label { font-size: 0.85em; display: flex; align-items: center; gap: 6px; }
#controls input[type=range] { width: 100px; accent-color: #8af; }
#controls select { background: rgba(60,60,100,0.6); color: #ccd; border: 1px solid rgba(255,255,255,0.15); padding: 4px 8px; border-radius: 6px; font-size: 0.82em; }
button {
  background: rgba(100,140,255,0.2); color: #8af; border: 1px solid rgba(100,140,255,0.3);
  padding: 6px 14px; border-radius: 8px; cursor: pointer; font-size: 0.85em;
}
button:hover { background: rgba(100,140,255,0.35); }
button.active { background: rgba(100,255,140,0.2); color: #8fa; border-color: rgba(100,255,140,0.3); }
#info {
  position: fixed; top: 20px; right: 20px; background: rgba(20,20,40,0.85);
  backdrop-filter: blur(10px); padding: 16px 20px; border-radius: 12px;
  color: #aab; font-size: 0.82em; max-width: 320px; z-index: 100; line-height: 1.5;
  border: 1px solid rgba(255,255,255,0.08);
}
#info strong { color: #dde; }
#graph {
  position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
  background: rgba(20,20,40,0.85); backdrop-filter: blur(10px);
  padding: 10px; border-radius: 12px; z-index: 100;
  border: 1px solid rgba(255,255,255,0.08);
}
</style>
</head>
<body>
<a href="index.html">&#8592; Back</a>
<canvas id="c"></canvas>
<canvas id="graph" width="300" height="100"></canvas>

<div id="info">
  <strong>Phi Phenomenon & Beta Motion</strong><br><br>
  Your brain creates motion from nothing. At the right timing, alternating static images produce a genuine motion percept.<br><br>
  This is why <strong>24 frames per second</strong> looks like continuous motion in cinema. The "color phi" demo shows your brain even fills in color transitions <em>mid-flight</em>!
</div>

<div id="controls">
  <label>ISI <input type="range" id="isi" min="0" max="500" value="80" step="5"> <span id="isiVal">80ms</span></label>
  <label>Dot size <input type="range" id="dotSize" min="10" max="80" value="30"></label>
  <label>Distance <input type="range" id="distance" min="50" max="400" value="200"></label>
  <label>Mode <select id="mode">
    <option value="two">Two Dots</option>
    <option value="marquee">Marquee (8 dots)</option>
    <option value="colorphi">Color Phi</option>
    <option value="ternus">Ternus Display</option>
  </select></label>
  <button id="btnPause">Pause</button>
</div>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
const graphCanvas = document.getElementById('graph');
const gctx = graphCanvas.getContext('2d');
let W, H;

let isi = 80;
let dotRadius = 30;
let dist = 200;
let mode = 'two';
let paused = false;

// Timing state
let lastSwitch = 0;
let stimOn = true;
let currentPos = 0; // which position is active (for two-dot: 0 or 1)
let stimDuration = 150; // how long the dot is shown

function resize() {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
}

function drawGraph() {
  const gw = 300, gh = 100;
  gctx.fillStyle = 'rgba(20,20,40,0.9)';
  gctx.fillRect(0, 0, gw, gh);

  // Axes
  gctx.strokeStyle = 'rgba(200,200,220,0.3)';
  gctx.lineWidth = 1;
  gctx.beginPath();
  gctx.moveTo(40, 10);
  gctx.lineTo(40, 80);
  gctx.lineTo(280, 80);
  gctx.stroke();

  // Labels
  gctx.fillStyle = 'rgba(200,200,220,0.5)';
  gctx.font = '10px sans-serif';
  gctx.textAlign = 'center';
  gctx.fillText('ISI (ms)', 160, 95);
  gctx.save();
  gctx.translate(12, 50);
  gctx.rotate(-Math.PI / 2);
  gctx.fillText('Motion', 0, 0);
  gctx.restore();

  // ISI labels
  gctx.fillText('0', 40, 92);
  gctx.fillText('100', 100, 92);
  gctx.fillText('200', 160, 92);
  gctx.fillText('300', 220, 92);
  gctx.fillText('500', 280, 92);

  // Motion perception curve (bell-shaped, peak around 50-100ms)
  gctx.beginPath();
  gctx.strokeStyle = '#8af';
  gctx.lineWidth = 2;
  for (let x = 40; x <= 280; x++) {
    const isiX = ((x - 40) / 240) * 500;
    // Gaussian centered around 80ms
    const motion = Math.exp(-((isiX - 80) ** 2) / (2 * 50 ** 2));
    const y = 75 - motion * 60;
    if (x === 40) gctx.moveTo(x, y);
    else gctx.lineTo(x, y);
  }
  gctx.stroke();

  // Optimal range highlight
  gctx.fillStyle = 'rgba(100,140,255,0.1)';
  const x1 = 40 + (40/500) * 240;
  const x2 = 40 + (150/500) * 240;
  gctx.fillRect(x1, 10, x2 - x1, 70);

  gctx.fillStyle = 'rgba(100,255,140,0.6)';
  gctx.font = '9px sans-serif';
  gctx.fillText('optimal', (x1 + x2) / 2, 20);

  // Current ISI marker
  const markerX = 40 + (isi / 500) * 240;
  gctx.beginPath();
  gctx.moveTo(markerX, 10);
  gctx.lineTo(markerX, 80);
  gctx.strokeStyle = '#ff6644';
  gctx.lineWidth = 2;
  gctx.stroke();

  gctx.fillStyle = '#ff6644';
  gctx.fillText(isi + 'ms', markerX, 8);
}

function drawTwoDots(now) {
  const cx = W / 2, cy = H / 2;
  const halfDist = dist / 2;
  const cycle = stimDuration + isi;
  const t = now % (cycle * 2);

  ctx.fillStyle = '#1a1a2e';
  ctx.fillRect(0, 0, W, H);

  // Position labels
  ctx.fillStyle = 'rgba(200,200,220,0.15)';
  ctx.font = '14px sans-serif';
  ctx.textAlign = 'center';
  ctx.fillText('A', cx - halfDist, cy + dotRadius + 25);
  ctx.fillText('B', cx + halfDist, cy + dotRadius + 25);

  if (t < stimDuration) {
    // Dot at position A
    ctx.beginPath();
    ctx.arc(cx - halfDist, cy, dotRadius, 0, Math.PI * 2);
    ctx.fillStyle = '#ffffff';
    ctx.fill();
  } else if (t < stimDuration + isi) {
    // blank ISI
  } else if (t < stimDuration * 2 + isi) {
    // Dot at position B
    ctx.beginPath();
    ctx.arc(cx + halfDist, cy, dotRadius, 0, Math.PI * 2);
    ctx.fillStyle = '#ffffff';
    ctx.fill();
  }
  // else second ISI (blank)
}

function drawMarquee(now) {
  const cx = W / 2, cy = H / 2;
  const numDots = 8;
  const totalSpan = dist * 2;
  const spacing = totalSpan / (numDots - 1);
  const cycle = stimDuration + isi;
  const activeIdx = Math.floor((now % (cycle * numDots)) / cycle) % numDots;
  const inStim = (now % cycle) < stimDuration;

  ctx.fillStyle = '#1a1a2e';
  ctx.fillRect(0, 0, W, H);

  for (let i = 0; i < numDots; i++) {
    const x = cx - totalSpan / 2 + i * spacing;
    ctx.beginPath();
    ctx.arc(x, cy, dotRadius * 0.5, 0, Math.PI * 2);
    ctx.strokeStyle = 'rgba(200,200,220,0.15)';
    ctx.lineWidth = 1;
    ctx.stroke();

    if (i === activeIdx && inStim) {
      ctx.beginPath();
      ctx.arc(x, cy, dotRadius * 0.5, 0, Math.PI * 2);
      ctx.fillStyle = '#ffcc44';
      ctx.fill();
    }
  }
}

function drawColorPhi(now) {
  const cx = W / 2, cy = H / 2;
  const halfDist = dist / 2;
  const cycle = stimDuration + isi;
  const t = now % (cycle * 2);

  ctx.fillStyle = '#1a1a2e';
  ctx.fillRect(0, 0, W, H);

  ctx.fillStyle = 'rgba(200,200,220,0.2)';
  ctx.font = '14px sans-serif';
  ctx.textAlign = 'center';
  ctx.fillText('Watch the dot appear to change color mid-flight!', cx, cy - dotRadius - 40);

  if (t < stimDuration) {
    ctx.beginPath();
    ctx.arc(cx - halfDist, cy, dotRadius, 0, Math.PI * 2);
    ctx.fillStyle = '#ff3333';
    ctx.fill();
  } else if (t < stimDuration + isi) {
    // blank
  } else if (t < stimDuration * 2 + isi) {
    ctx.beginPath();
    ctx.arc(cx + halfDist, cy, dotRadius, 0, Math.PI * 2);
    ctx.fillStyle = '#33ff33';
    ctx.fill();
  }
}

function drawTernus(now) {
  const cx = W / 2, cy = H / 2;
  const spacing = dist * 0.5;
  const cycle = stimDuration + isi;
  const t = now % (cycle * 2);
  const dotR = dotRadius * 0.6;

  ctx.fillStyle = '#1a1a2e';
  ctx.fillRect(0, 0, W, H);

  ctx.fillStyle = 'rgba(200,200,220,0.2)';
  ctx.font = '13px sans-serif';
  ctx.textAlign = 'center';

  if (isi < 50) {
    ctx.fillText('Short ISI: "Element motion" - one dot jumps over', cx, cy - 80);
  } else {
    ctx.fillText('Long ISI: "Group motion" - whole group shifts', cx, cy - 80);
  }

  if (t < stimDuration) {
    // Frame 1: dots at positions 1, 2, 3
    for (let i = 0; i < 3; i++) {
      ctx.beginPath();
      ctx.arc(cx + (i - 1.5) * spacing, cy, dotR, 0, Math.PI * 2);
      ctx.fillStyle = '#ffffff';
      ctx.fill();
    }
  } else if (t < stimDuration + isi) {
    // blank
  } else if (t < stimDuration * 2 + isi) {
    // Frame 2: dots at positions 2, 3, 4
    for (let i = 0; i < 3; i++) {
      ctx.beginPath();
      ctx.arc(cx + (i - 0.5) * spacing, cy, dotR, 0, Math.PI * 2);
      ctx.fillStyle = '#ffffff';
      ctx.fill();
    }
  }
}

let startTime = performance.now();

function animate() {
  if (!paused) {
    const now = performance.now() - startTime;

    switch (mode) {
      case 'two': drawTwoDots(now); break;
      case 'marquee': drawMarquee(now); break;
      case 'colorphi': drawColorPhi(now); break;
      case 'ternus': drawTernus(now); break;
    }
  }

  requestAnimationFrame(animate);
}

document.getElementById('isi').addEventListener('input', e => {
  isi = parseInt(e.target.value);
  document.getElementById('isiVal').textContent = isi + 'ms';
  drawGraph();
});

document.getElementById('dotSize').addEventListener('input', e => {
  dotRadius = parseInt(e.target.value);
});

document.getElementById('distance').addEventListener('input', e => {
  dist = parseInt(e.target.value);
});

document.getElementById('mode').addEventListener('change', e => {
  mode = e.target.value;
  startTime = performance.now();
});

document.getElementById('btnPause').addEventListener('click', () => {
  paused = !paused;
  document.getElementById('btnPause').textContent = paused ? 'Resume' : 'Pause';
  document.getElementById('btnPause').classList.toggle('active', paused);
});

window.reset = function() {
  isi = 80;
  dotRadius = 30;
  dist = 200;
  mode = 'two';
  paused = false;
  startTime = performance.now();
  document.getElementById('isi').value = 80;
  document.getElementById('isiVal').textContent = '80ms';
  document.getElementById('dotSize').value = 30;
  document.getElementById('distance').value = 200;
  document.getElementById('mode').value = 'two';
  document.getElementById('btnPause').textContent = 'Pause';
  document.getElementById('btnPause').classList.remove('active');
  drawGraph();
};

let resizeTimer;
window.addEventListener('resize', () => {
  clearTimeout(resizeTimer);
  resizeTimer = setTimeout(resize, 150);
});

resize();
drawGraph();
animate();
</script>
<script src="../assets/js/enhance.js"></script>
</body>
</html>