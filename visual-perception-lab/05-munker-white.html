<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Munker-White Illusion</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #1a1a2e; overflow: hidden; font-family: 'Segoe UI', Tahoma, sans-serif; }
canvas { display: block; }
a { position: fixed; top: 20px; left: 20px; color: #8af; text-decoration: none; z-index: 100; font-size: 1.2em; }
#controls {
  position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
  background: rgba(20,20,40,0.85); backdrop-filter: blur(10px);
  padding: 18px 24px; border-radius: 14px; color: #ccd; z-index: 100;
  display: flex; flex-wrap: wrap; gap: 12px; align-items: center; max-width: 800px;
  border: 1px solid rgba(255,255,255,0.08);
}
#controls label { font-size: 0.82em; display: flex; align-items: center; gap: 5px; white-space: nowrap; }
#controls input[type=range] { width: 80px; accent-color: #8af; }
#controls input[type=color] { width: 30px; height: 24px; border: none; background: none; cursor: pointer; }
button {
  background: rgba(100,140,255,0.2); color: #8af; border: 1px solid rgba(100,140,255,0.3);
  padding: 6px 12px; border-radius: 8px; cursor: pointer; font-size: 0.82em;
}
button:hover { background: rgba(100,140,255,0.35); }
button.active { background: rgba(100,255,140,0.2); color: #8fa; border-color: rgba(100,255,140,0.3); }
#info {
  position: fixed; top: 20px; right: 20px; background: rgba(20,20,40,0.85);
  backdrop-filter: blur(10px); padding: 16px 20px; border-radius: 12px;
  color: #aab; font-size: 0.82em; max-width: 300px; z-index: 100; line-height: 1.5;
  border: 1px solid rgba(255,255,255,0.08);
}
#info strong { color: #dde; }
#color-proof {
  position: fixed; top: 50%; right: 20px; transform: translateY(-50%);
  background: rgba(20,20,40,0.85); backdrop-filter: blur(10px);
  padding: 14px 18px; border-radius: 12px; color: #ccd; font-size: 0.85em;
  z-index: 100; text-align: center; border: 1px solid rgba(255,255,255,0.08);
}
.swatch { display: inline-block; width: 40px; height: 40px; border-radius: 6px; border: 2px solid #555; margin: 4px; }
</style>
</head>
<body>
<a href="index.html">&#8592; Back</a>
<canvas id="c"></canvas>

<div id="info">
  <strong>Munker-White Illusion</strong><br><br>
  One of the <em>strongest color illusions</em> known. Identical colored bars appear completely different when overlaid with black vs. white stripes.<br><br>
  The visual system <strong>assimilates</strong> colors within the same apparent surface, shifting perception toward the overlapping stripe color.
</div>

<div id="color-proof">
  <div style="margin-bottom:8px">Both regions are:</div>
  <div class="swatch" id="swatchProof"></div>
  <div id="hexProof" style="margin-top:4px;font-family:monospace"></div>
  <div style="margin-top:8px;font-size:0.8em;color:#8fa">Identical color!</div>
</div>

<div id="controls">
  <label>Color <input type="color" id="targetColor" value="#e07020"></label>
  <label>Stripe width <input type="range" id="stripeW" min="4" max="40" value="16"></label>
  <label>Stripe opacity <input type="range" id="stripeOp" min="30" max="100" value="100"></label>
  <button id="btnReveal">Remove Stripes</button>
  <button id="btnBar">Connect Bar</button>
  <button id="btnDir">Vertical</button>
  <button id="btnGray">Grayscale</button>
  <button id="btnReset">Reset</button>
</div>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let W, H;

let targetColor = '#e07020';
let stripeWidth = 16;
let stripeOpacity = 1;
let showStripes = true;
let showBar = false;
let vertical = false;
let grayscale = false;
let stripeFade = 1;
let animatingFade = false;

function resize() {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
}

function hexToRgb(hex) {
  return [
    parseInt(hex.slice(1, 3), 16),
    parseInt(hex.slice(3, 5), 16),
    parseInt(hex.slice(5, 7), 16)
  ];
}

function rgbToGray(r, g, b) {
  const v = Math.round(0.299 * r + 0.587 * g + 0.114 * b);
  return [v, v, v];
}

function draw() {
  ctx.clearRect(0, 0, W, H);
  ctx.fillStyle = '#888';
  ctx.fillRect(0, 0, W, H);

  const rgb = hexToRgb(targetColor);
  const displayRgb = grayscale ? rgbToGray(...rgb) : rgb;
  const colorStr = `rgb(${displayRgb[0]},${displayRgb[1]},${displayRgb[2]})`;

  // Layout
  const margin = 60;
  const regionH = H - margin * 2 - 120;
  const regionW = (W - margin * 3) / 2;
  const leftX = margin;
  const rightX = margin * 2 + regionW;
  const topY = margin + 40;

  // Background regions
  ctx.fillStyle = '#666';
  ctx.fillRect(leftX, topY, regionW, regionH);
  ctx.fillRect(rightX, topY, regionW, regionH);

  const sw = stripeWidth;
  const fade = stripeFade;

  if (vertical) {
    // Horizontal colored bars across both regions
    const barH = sw * 2;
    for (let y = topY; y < topY + regionH; y += barH * 2) {
      ctx.fillStyle = colorStr;
      ctx.fillRect(leftX, y, regionW, barH);
      ctx.fillRect(rightX, y, regionW, barH);
    }

    // Vertical black stripes (left) and white stripes (right)
    if (fade > 0.01) {
      for (let x = leftX; x < leftX + regionW; x += sw * 2) {
        ctx.fillStyle = `rgba(0,0,0,${stripeOpacity * fade})`;
        ctx.fillRect(x, topY, sw, regionH);
      }
      for (let x = rightX; x < rightX + regionW; x += sw * 2) {
        ctx.fillStyle = `rgba(255,255,255,${stripeOpacity * fade})`;
        ctx.fillRect(x, topY, sw, regionH);
      }
    }
  } else {
    // Vertical colored bars across both regions
    const barW = sw * 2;
    for (let x = leftX; x < leftX + regionW; x += barW * 2) {
      ctx.fillStyle = colorStr;
      ctx.fillRect(x, topY, barW, regionH);
    }
    for (let x = rightX; x < rightX + regionW; x += barW * 2) {
      ctx.fillStyle = colorStr;
      ctx.fillRect(x, topY, barW, regionH);
    }

    // Horizontal black stripes (left) and white stripes (right)
    if (fade > 0.01) {
      for (let y = topY; y < topY + regionH; y += sw * 2) {
        ctx.fillStyle = `rgba(0,0,0,${stripeOpacity * fade})`;
        ctx.fillRect(leftX, y, regionW, sw);
        ctx.fillStyle = `rgba(255,255,255,${stripeOpacity * fade})`;
        ctx.fillRect(rightX, y, regionW, sw);
      }
    }
  }

  // Labels
  ctx.fillStyle = '#fff';
  ctx.font = 'bold 16px sans-serif';
  ctx.textAlign = 'center';
  ctx.fillText('Black stripes', leftX + regionW / 2, topY - 12);
  ctx.fillText('White stripes', rightX + regionW / 2, topY - 12);

  ctx.fillStyle = '#aaa';
  ctx.font = '13px sans-serif';
  ctx.fillText('(appears lighter/warmer)', leftX + regionW / 2, topY + regionH + 25);
  ctx.fillText('(appears darker/cooler)', rightX + regionW / 2, topY + regionH + 25);

  // Connecting bar
  if (showBar) {
    const barY = topY + regionH / 2;
    ctx.fillStyle = colorStr;
    ctx.strokeStyle = colorStr;
    ctx.lineWidth = 30;
    ctx.beginPath();
    ctx.moveTo(leftX + regionW, barY);
    ctx.lineTo(rightX, barY);
    ctx.stroke();

    ctx.fillStyle = '#fff';
    ctx.font = 'bold 14px monospace';
    ctx.textAlign = 'center';
    ctx.fillText('SAME COLOR', (leftX + regionW + rightX) / 2, barY - 22);
    ctx.fillText(targetColor.toUpperCase(), (leftX + regionW + rightX) / 2, barY + 5);
  }

  // Proof swatch
  document.getElementById('swatchProof').style.background = targetColor;
  document.getElementById('hexProof').textContent = targetColor.toUpperCase();
}

function animate() {
  if (animatingFade) {
    if (!showStripes && stripeFade > 0) {
      stripeFade = Math.max(0, stripeFade - 0.04);
      if (stripeFade <= 0) animatingFade = false;
    } else if (showStripes && stripeFade < 1) {
      stripeFade = Math.min(1, stripeFade + 0.04);
      if (stripeFade >= 1) animatingFade = false;
    }
  }
  draw();
  requestAnimationFrame(animate);
}

document.getElementById('targetColor').addEventListener('input', e => { targetColor = e.target.value; });
document.getElementById('stripeW').addEventListener('input', e => { stripeWidth = +e.target.value; });
document.getElementById('stripeOp').addEventListener('input', e => { stripeOpacity = e.target.value / 100; });

document.getElementById('btnReveal').addEventListener('click', function() {
  showStripes = !showStripes;
  animatingFade = true;
  this.textContent = showStripes ? 'Remove Stripes' : 'Restore Stripes';
  this.classList.toggle('active', !showStripes);
});

document.getElementById('btnBar').addEventListener('click', function() {
  showBar = !showBar;
  this.textContent = showBar ? 'Hide Bar' : 'Connect Bar';
  this.classList.toggle('active', showBar);
});

document.getElementById('btnDir').addEventListener('click', function() {
  vertical = !vertical;
  this.textContent = vertical ? 'Horizontal' : 'Vertical';
  this.classList.toggle('active', vertical);
});

document.getElementById('btnGray').addEventListener('click', function() {
  grayscale = !grayscale;
  this.textContent = grayscale ? 'Color' : 'Grayscale';
  this.classList.toggle('active', grayscale);
});

document.getElementById('btnReset').addEventListener('click', reset);

function reset() {
  targetColor = '#e07020'; stripeWidth = 16; stripeOpacity = 1;
  showStripes = true; showBar = false; vertical = false; grayscale = false;
  stripeFade = 1; animatingFade = false;
  document.getElementById('targetColor').value = '#e07020';
  document.getElementById('stripeW').value = 16;
  document.getElementById('stripeOp').value = 100;
  document.getElementById('btnReveal').textContent = 'Remove Stripes';
  document.getElementById('btnReveal').classList.remove('active');
  document.getElementById('btnBar').textContent = 'Connect Bar';
  document.getElementById('btnBar').classList.remove('active');
  document.getElementById('btnDir').textContent = 'Vertical';
  document.getElementById('btnDir').classList.remove('active');
  document.getElementById('btnGray').textContent = 'Grayscale';
  document.getElementById('btnGray').classList.remove('active');
}
window.reset = reset;

window.addEventListener('resize', resize);
resize();
animate();
</script>
<script src="../assets/js/enhance.js"></script>
</body>
</html>
