<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ebbinghaus Illusion</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #f0f0f0; overflow: hidden; font-family: 'Segoe UI', Tahoma, sans-serif; }
canvas { display: block; }
a { position: fixed; top: 20px; left: 20px; color: #8af; text-decoration: none; z-index: 100; font-size: 1.2em; }
#controls {
  position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
  background: rgba(30,30,40,0.85); backdrop-filter: blur(10px);
  padding: 16px 24px; border-radius: 14px; color: #ddd; z-index: 100;
  min-width: 380px; max-width: 520px;
}
#controls h3 { text-align: center; margin-bottom: 8px; color: #8af; font-size: 0.95em; }
.row { display: flex; align-items: center; justify-content: space-between; margin: 4px 0; font-size: 0.82em; }
.row label { flex: 0 0 140px; }
.row input[type=range] { flex: 1; margin: 0 8px; }
.row span { flex: 0 0 42px; text-align: right; }
button {
  background: #335; border: 1px solid #557; color: #aaf; padding: 6px 14px;
  border-radius: 6px; cursor: pointer; font-size: 0.82em; margin: 2px;
}
button:hover { background: #446; }
button.active { background: #448; border-color: #88f; }
#info {
  position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
  background: rgba(30,30,40,0.85); backdrop-filter: blur(10px);
  padding: 10px 20px; border-radius: 10px; color: #ccc; z-index: 100;
  font-size: 0.78em; max-width: 620px; text-align: center; line-height: 1.4;
}
#error-display {
  position: fixed; top: 80px; right: 20px; background: rgba(30,30,40,0.85);
  backdrop-filter: blur(10px); padding: 12px 18px; border-radius: 10px;
  color: #ddd; z-index: 100; font-size: 0.82em; min-width: 170px;
}
#error-display h4 { color: #8af; margin-bottom: 6px; }
</style>
</head>
<body>
<a href="index.html">&#8592; Back</a>
<canvas id="c"></canvas>
<div id="info">Both orange circles are IDENTICAL in size. Drag the right circle to resize it to match the left. The Ebbinghaus illusion shows we judge size relative to nearby objects.</div>
<div id="error-display">
  <h4>Size Matching</h4>
  <div id="trueR">True radius: --</div>
  <div id="yourR">Your radius: --</div>
  <div id="errPct">Error: --</div>
</div>
<div id="controls">
  <h3>Ebbinghaus Illusion (Titchener Circles)</h3>
  <div class="row"><label>Surround Size (left)</label><input type="range" id="bigR" min="40" max="120" value="75"><span id="bigRV">75</span></div>
  <div class="row"><label>Surround Size (right)</label><input type="range" id="smallR" min="8" max="35" value="16"><span id="smallRV">16</span></div>
  <div class="row"><label>Number of Surrounds</label><input type="range" id="numSurr" min="3" max="12" value="6"><span id="numSurrV">6</span></div>
  <div class="row"><label>Surround Distance</label><input type="range" id="surrDist" min="60" max="180" value="110"><span id="surrDistV">110</span></div>
  <div class="row"><label>Shape</label>
    <button id="btnCircle" class="active">Circle</button>
    <button id="btnSquare">Square</button>
    <button id="btnTriangle">Triangle</button>
  </div>
  <div style="display:flex;justify-content:center;gap:6px;margin-top:8px;flex-wrap:wrap">
    <button id="btnReveal">Reveal</button>
    <button id="btnAnimate">Animate</button>
    <button id="btnReset">Reset</button>
  </div>
</div>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let W, H;

const centerR = 32;
let userR = 32;
let revealed = false;
let animating = false;
let animPhase = 0;
let dragging = false;
let shape = 'circle';

function resize() {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

function val(id) { return +document.getElementById(id).value; }

['bigR','smallR','numSurr','surrDist'].forEach(id => {
  document.getElementById(id).addEventListener('input', () => {
    document.getElementById(id + 'V').textContent = val(id);
  });
});

function drawShape(cx, cy, r, color, shapeType) {
  ctx.fillStyle = color;
  ctx.beginPath();
  if (shapeType === 'circle') {
    ctx.arc(cx, cy, r, 0, Math.PI * 2);
  } else if (shapeType === 'square') {
    ctx.rect(cx - r, cy - r, r * 2, r * 2);
  } else if (shapeType === 'triangle') {
    ctx.moveTo(cx, cy - r);
    ctx.lineTo(cx + r * 0.866, cy + r * 0.5);
    ctx.lineTo(cx - r * 0.866, cy + r * 0.5);
    ctx.closePath();
  }
  ctx.fill();
}

function drawSurrounds(cx, cy, num, surrR, dist, color) {
  for (let i = 0; i < num; i++) {
    const angle = (i / num) * Math.PI * 2 - Math.PI / 2;
    const sx = cx + Math.cos(angle) * dist;
    const sy = cy + Math.sin(angle) * dist;
    drawShape(sx, sy, surrR, color, shape);
  }
}

function draw() {
  ctx.fillStyle = '#f0f0f0';
  ctx.fillRect(0, 0, W, H);

  const num = val('numSurr');
  let bigSurrR = val('bigR');
  let smallSurrR = val('smallR');
  const dist = val('surrDist');

  if (animating) {
    animPhase += 0.015;
    const t = (Math.sin(animPhase) + 1) / 2;
    bigSurrR = 20 + t * 100;
    smallSurrR = 120 - t * 100;
    document.getElementById('bigR').value = Math.round(bigSurrR);
    document.getElementById('bigRV').textContent = Math.round(bigSurrR);
    document.getElementById('smallR').value = Math.round(smallSurrR);
    document.getElementById('smallRV').textContent = Math.round(smallSurrR);
  }

  const leftX = W * 0.32;
  const rightX = W * 0.68;
  const cy = H * 0.45;

  if (!revealed) {
    // Surrounding circles
    drawSurrounds(leftX, cy, num, bigSurrR, dist, '#5577aa');
    drawSurrounds(rightX, cy, num, smallSurrR, dist, '#5577aa');
  }

  // Central circles (always same size on left, user-adjustable on right)
  drawShape(leftX, cy, centerR, '#e88030', shape);
  drawShape(rightX, cy, userR, '#e88030', shape);

  // Labels
  ctx.fillStyle = '#666';
  ctx.font = '13px sans-serif';
  ctx.textAlign = 'center';
  ctx.fillText('Surrounded by LARGE ' + shape + 's', leftX, cy + (revealed ? centerR + 30 : val('bigR') + dist + 30));
  ctx.fillText('Surrounded by SMALL ' + shape + 's', rightX, cy + (revealed ? centerR + 30 : val('smallR') + dist + 30));

  if (revealed) {
    // Show measurement lines
    ctx.strokeStyle = '#e44';
    ctx.lineWidth = 1;
    ctx.setLineDash([4, 4]);
    // Left
    ctx.beginPath();
    ctx.moveTo(leftX - centerR, cy - centerR - 10);
    ctx.lineTo(leftX + centerR, cy - centerR - 10);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(leftX - centerR, cy - centerR - 15);
    ctx.lineTo(leftX - centerR, cy - centerR - 5);
    ctx.moveTo(leftX + centerR, cy - centerR - 15);
    ctx.lineTo(leftX + centerR, cy - centerR - 5);
    ctx.stroke();
    // Right
    ctx.beginPath();
    ctx.moveTo(rightX - userR, cy - userR - 10);
    ctx.lineTo(rightX + userR, cy - userR - 10);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(rightX - userR, cy - userR - 15);
    ctx.lineTo(rightX - userR, cy - userR - 5);
    ctx.moveTo(rightX + userR, cy - userR - 15);
    ctx.lineTo(rightX + userR, cy - userR - 5);
    ctx.stroke();
    ctx.setLineDash([]);
    ctx.fillStyle = '#e44';
    ctx.font = '12px monospace';
    ctx.fillText('r=' + centerR, leftX, cy - centerR - 20);
    ctx.fillText('r=' + Math.round(userR), rightX, cy - userR - 20);
  }

  // Drag handle ring on right circle
  if (!revealed) {
    ctx.strokeStyle = 'rgba(100,200,255,0.5)';
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.arc(rightX, cy, userR, 0, Math.PI * 2);
    ctx.stroke();
  }

  updateError();
  requestAnimationFrame(draw);
}

function updateError() {
  document.getElementById('trueR').textContent = 'True radius: ' + centerR;
  document.getElementById('yourR').textContent = 'Your radius: ' + Math.round(userR);
  const err = ((userR - centerR) / centerR * 100).toFixed(1);
  document.getElementById('errPct').textContent = 'Error: ' + err + '%';
}

canvas.addEventListener('mousedown', function(e) {
  const rightX = W * 0.68;
  const cy = H * 0.45;
  const d = Math.hypot(e.clientX - rightX, e.clientY - cy);
  if (d < userR + 20 && !revealed) dragging = true;
});
canvas.addEventListener('mousemove', function(e) {
  if (!dragging) return;
  const rightX = W * 0.68;
  const cy = H * 0.45;
  userR = Math.max(10, Math.min(80, Math.hypot(e.clientX - rightX, e.clientY - cy)));
});
canvas.addEventListener('mouseup', function() { dragging = false; });

canvas.addEventListener('touchstart', function(e) {
  const t = e.touches[0];
  const rightX = W * 0.68;
  const cy = H * 0.45;
  const d = Math.hypot(t.clientX - rightX, t.clientY - cy);
  if (d < userR + 30 && !revealed) { dragging = true; e.preventDefault(); }
}, { passive: false });
canvas.addEventListener('touchmove', function(e) {
  if (!dragging) return;
  e.preventDefault();
  const t = e.touches[0];
  const rightX = W * 0.68;
  const cy = H * 0.45;
  userR = Math.max(10, Math.min(80, Math.hypot(t.clientX - rightX, t.clientY - cy)));
}, { passive: false });
canvas.addEventListener('touchend', function() { dragging = false; });

document.getElementById('btnReveal').addEventListener('click', function() {
  revealed = !revealed;
  this.classList.toggle('active', revealed);
});
document.getElementById('btnAnimate').addEventListener('click', function() {
  animating = !animating;
  animPhase = 0;
  this.classList.toggle('active', animating);
});
document.getElementById('btnReset').addEventListener('click', function() { window.reset(); });

['btnCircle','btnSquare','btnTriangle'].forEach(id => {
  document.getElementById(id).addEventListener('click', function() {
    shape = id.replace('btn','').toLowerCase();
    document.querySelectorAll('#controls .row button').forEach(b => b.classList.remove('active'));
    this.classList.add('active');
  });
});

window.reset = function() {
  userR = 32;
  revealed = false;
  animating = false;
  animPhase = 0;
  document.getElementById('btnReveal').classList.remove('active');
  document.getElementById('btnAnimate').classList.remove('active');
  document.getElementById('bigR').value = 75;
  document.getElementById('smallR').value = 16;
  document.getElementById('numSurr').value = 6;
  document.getElementById('surrDist').value = 110;
  ['bigRV','smallRV','numSurrV','surrDistV'].forEach(id => {
    document.getElementById(id).textContent = document.getElementById(id.replace('V','')).value;
  });
};

draw();
</script>
<script src="../assets/js/enhance.js"></script>
</body>
</html>
