<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lilac Chaser (Pac-Man Illusion)</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #888; overflow: hidden; font-family: 'Segoe UI', Tahoma, sans-serif; }
canvas { display: block; }
a { position: fixed; top: 20px; left: 20px; color: #8af; text-decoration: none; z-index: 100; font-size: 1.2em; }
#controls {
  position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
  background: rgba(20,20,40,0.85); backdrop-filter: blur(10px);
  padding: 18px 24px; border-radius: 14px; color: #ccd; z-index: 100;
  display: flex; flex-wrap: wrap; gap: 14px; align-items: center; max-width: 780px;
  border: 1px solid rgba(255,255,255,0.08);
}
#controls label { font-size: 0.82em; display: flex; align-items: center; gap: 6px; }
#controls input[type=range] { width: 85px; accent-color: #8af; }
button {
  background: rgba(100,140,255,0.2); color: #8af; border: 1px solid rgba(100,140,255,0.3);
  padding: 6px 14px; border-radius: 8px; cursor: pointer; font-size: 0.85em;
}
button:hover { background: rgba(100,140,255,0.35); }
button.active { background: rgba(100,255,140,0.2); color: #8fa; border-color: rgba(100,255,140,0.3); }
#info {
  position: fixed; top: 20px; right: 20px; background: rgba(20,20,40,0.85);
  backdrop-filter: blur(10px); padding: 16px 20px; border-radius: 12px;
  color: #aab; font-size: 0.82em; max-width: 320px; z-index: 100; line-height: 1.5;
  border: 1px solid rgba(255,255,255,0.08);
}
#info strong { color: #dde; }
#explanation {
  position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
  pointer-events: none; z-index: 50; text-align: center; display: none;
}
#explanation .text {
  color: rgba(255,255,255,0.7); font-size: 0.95em; line-height: 1.6;
  background: rgba(20,20,40,0.7); padding: 16px 24px; border-radius: 12px;
  margin-top: 200px; display: inline-block; max-width: 400px;
  backdrop-filter: blur(8px);
}
select {
  background: rgba(100,140,255,0.15); color: #8af; border: 1px solid rgba(100,140,255,0.3);
  padding: 4px 8px; border-radius: 6px; font-size: 0.82em;
}
</style>
</head>
<body>
<a href="index.html">&#8592; Back</a>
<canvas id="c"></canvas>

<div id="explanation">
  <div class="text" id="explainText">
    The <strong>green dot is not real</strong> -- it is an afterimage.<br>
    The dots are <strong>not actually disappearing</strong> -- that is Troxler's fading.<br>
    The apparent motion is the <strong>phi phenomenon</strong>.
  </div>
</div>

<div id="info">
  <strong>Lilac Chaser</strong> (Pac-Man Illusion)<br><br>
  Stare at the fixation cross. You will see:<br>
  1. A <em>green dot</em> chasing the gap (afterimage)<br>
  2. Lilac dots <em>fading away</em> (Troxler's effect)<br>
  3. Apparent <em>motion</em> of the green phantom (phi phenomenon)<br><br>
  Three separate visual phenomena combine into one beautiful display: chromatic adaptation, neural adaptation, and apparent motion.
</div>

<div id="controls">
  <label>Color
    <select id="dotColor">
      <option value="lilac">Lilac (green afterimage)</option>
      <option value="red">Red (cyan afterimage)</option>
      <option value="blue">Blue (yellow afterimage)</option>
      <option value="yellow">Yellow (blue afterimage)</option>
      <option value="cyan">Cyan (red afterimage)</option>
    </select>
  </label>
  <label>Dots <input type="range" id="numDots" min="8" max="16" value="12"> <span id="numDotsVal">12</span></label>
  <label>Speed <input type="range" id="speed" min="50" max="300" value="120"> <span id="speedVal">120</span>ms</label>
  <label>Ring <input type="range" id="ringSize" min="80" max="280" value="160"> <span id="ringSizeVal">160</span>px</label>
  <label>Dot Size <input type="range" id="dotSize" min="10" max="50" value="28"> <span id="dotSizeVal">28</span>px</label>
  <button id="revealBtn">Show Reality</button>
  <button id="resetBtn">Reset</button>
</div>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let W, H;

let numDots = 12;
let speed = 120; // ms per step
let ringRadius = 160;
let dotRadius = 28;
let dotColorName = 'lilac';
let showReality = false;
let gapIndex = 0;
let lastStep = 0;
let startTime = Date.now();
let explainShown = false;
let animId;

const colorMap = {
  lilac:  { r: 200, g: 100, b: 200 },
  red:    { r: 220, g: 60,  b: 60  },
  blue:   { r: 60,  g: 80,  b: 220 },
  yellow: { r: 220, g: 210, b: 60  },
  cyan:   { r: 60,  g: 210, b: 220 }
};

const afterimageMap = {
  lilac:  'green',
  red:    'cyan',
  blue:   'yellow',
  yellow: 'blue',
  cyan:   'red'
};

function resize() {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
}

function draw(timestamp) {
  const cx = W / 2;
  const cy = H / 2;

  // Gray background
  ctx.fillStyle = '#888888';
  ctx.fillRect(0, 0, W, H);

  // Step the gap
  if (timestamp - lastStep >= speed) {
    gapIndex = (gapIndex + 1) % numDots;
    lastStep = timestamp;
  }

  const col = colorMap[dotColorName];

  // Draw dots
  for (let i = 0; i < numDots; i++) {
    const angle = (i / numDots) * Math.PI * 2 - Math.PI / 2;
    const dx = cx + Math.cos(angle) * ringRadius;
    const dy = cy + Math.sin(angle) * ringRadius;

    const isGap = i === gapIndex;

    if (!isGap) {
      // Draw soft-edged colored dot (gaussian-like)
      const steps = 8;
      for (let s = steps; s >= 0; s--) {
        const t = s / steps;
        const r = dotRadius * (0.5 + t * 0.6);
        const alpha = Math.exp(-t * t * 2.5) * 0.75;
        ctx.beginPath();
        ctx.arc(dx, dy, r, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(${col.r},${col.g},${col.b},${alpha})`;
        ctx.fill();
      }
    }

    // Show reality mode: outline all dot positions
    if (showReality) {
      ctx.beginPath();
      ctx.arc(dx, dy, dotRadius * 0.55, 0, Math.PI * 2);
      ctx.strokeStyle = isGap ? 'rgba(255,255,0,0.8)' : 'rgba(255,255,255,0.4)';
      ctx.lineWidth = isGap ? 2.5 : 1;
      ctx.setLineDash(isGap ? [4, 3] : []);
      ctx.stroke();
      ctx.setLineDash([]);

      if (isGap) {
        ctx.font = '10px sans-serif';
        ctx.fillStyle = 'rgba(255,255,0,0.8)';
        ctx.textAlign = 'center';
        ctx.fillText('GAP', dx, dy + dotRadius + 14);
      }
    }
  }

  // Fixation cross
  ctx.strokeStyle = '#000';
  ctx.lineWidth = 2.5;
  ctx.beginPath();
  ctx.moveTo(cx - 10, cy);
  ctx.lineTo(cx + 10, cy);
  ctx.moveTo(cx, cy - 10);
  ctx.lineTo(cx, cy + 10);
  ctx.stroke();

  // Small white center
  ctx.beginPath();
  ctx.arc(cx, cy, 2, 0, Math.PI * 2);
  ctx.fillStyle = '#fff';
  ctx.fill();

  // Show explanation after 15 seconds
  if (!explainShown && Date.now() - startTime > 15000) {
    explainShown = true;
    document.getElementById('explanation').style.display = 'block';
    const afterCol = afterimageMap[dotColorName];
    document.getElementById('explainText').innerHTML =
      `The <strong>${afterCol} dot is not real</strong> -- it is a chromatic afterimage.<br>` +
      `The dots are <strong>not actually disappearing</strong> -- that is Troxler's fading.<br>` +
      `The apparent motion is the <strong>phi phenomenon</strong>.`;
  }

  // Show reality label
  if (showReality) {
    ctx.font = '13px sans-serif';
    ctx.fillStyle = 'rgba(255,255,0,0.7)';
    ctx.textAlign = 'center';
    ctx.fillText('Yellow dashed circle = current gap (where you see the afterimage)', cx, cy + ringRadius + dotRadius + 35);
    ctx.fillText('All other dots are always visible at full opacity', cx, cy + ringRadius + dotRadius + 55);
  }

  animId = requestAnimationFrame(draw);
}

// Controls
function bindSlider(id, valId, cb) {
  const el = document.getElementById(id);
  const v = document.getElementById(valId);
  el.addEventListener('input', () => { v.textContent = el.value; cb(parseInt(el.value)); });
}

bindSlider('numDots', 'numDotsVal', v => { numDots = v; gapIndex = gapIndex % v; });
bindSlider('speed', 'speedVal', v => { speed = v; });
bindSlider('ringSize', 'ringSizeVal', v => { ringRadius = v; });
bindSlider('dotSize', 'dotSizeVal', v => { dotRadius = v; });

document.getElementById('dotColor').addEventListener('change', function() {
  dotColorName = this.value;
  explainShown = false;
  startTime = Date.now();
  document.getElementById('explanation').style.display = 'none';
});

document.getElementById('revealBtn').addEventListener('click', function() {
  showReality = !showReality;
  this.classList.toggle('active');
  this.textContent = showReality ? 'Hide Reality' : 'Show Reality';
});

document.getElementById('resetBtn').addEventListener('click', () => window.reset());

window.reset = function() {
  numDots = 12; speed = 120; ringRadius = 160; dotRadius = 28;
  dotColorName = 'lilac'; showReality = false; gapIndex = 0;
  explainShown = false;
  startTime = Date.now();
  document.getElementById('explanation').style.display = 'none';
  document.getElementById('numDots').value = 12;
  document.getElementById('numDotsVal').textContent = '12';
  document.getElementById('speed').value = 120;
  document.getElementById('speedVal').textContent = '120';
  document.getElementById('ringSize').value = 160;
  document.getElementById('ringSizeVal').textContent = '160';
  document.getElementById('dotSize').value = 28;
  document.getElementById('dotSizeVal').textContent = '28';
  document.getElementById('dotColor').value = 'lilac';
  document.getElementById('revealBtn').classList.remove('active');
  document.getElementById('revealBtn').textContent = 'Show Reality';
};

let resizeTimer;
window.addEventListener('resize', () => {
  clearTimeout(resizeTimer);
  resizeTimer = setTimeout(resize, 150);
});

resize();
requestAnimationFrame(draw);
</script>
<script src="../assets/js/enhance.js"></script>
</body>
</html>