<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simultaneous Contrast</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #1a1a2e; overflow: hidden; font-family: 'Segoe UI', Tahoma, sans-serif; }
canvas { display: block; }
a { position: fixed; top: 20px; left: 20px; color: #8af; text-decoration: none; z-index: 100; font-size: 1.2em; }
#controls {
  position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
  background: rgba(20,20,40,0.85); backdrop-filter: blur(10px);
  padding: 18px 24px; border-radius: 14px; color: #ccd; z-index: 100;
  display: flex; flex-wrap: wrap; gap: 14px; align-items: center; max-width: 780px;
  border: 1px solid rgba(255,255,255,0.08);
}
#controls label { font-size: 0.82em; display: flex; align-items: center; gap: 5px; white-space: nowrap; }
#controls input[type=range] { width: 90px; accent-color: #8af; }
button {
  background: rgba(100,140,255,0.2); color: #8af; border: 1px solid rgba(100,140,255,0.3);
  padding: 6px 12px; border-radius: 8px; cursor: pointer; font-size: 0.82em;
}
button:hover { background: rgba(100,140,255,0.35); }
button.active { background: rgba(100,255,140,0.2); color: #8fa; border-color: rgba(100,255,140,0.3); }
#info {
  position: fixed; top: 20px; right: 20px; background: rgba(20,20,40,0.85);
  backdrop-filter: blur(10px); padding: 16px 20px; border-radius: 12px;
  color: #aab; font-size: 0.82em; max-width: 300px; z-index: 100; line-height: 1.5;
  border: 1px solid rgba(255,255,255,0.08);
}
#info strong { color: #dde; }
</style>
</head>
<body>
<a href="index.html">&#8592; Back</a>
<canvas id="c"></canvas>

<div id="info">
  <strong>Simultaneous Contrast</strong><br><br>
  Two identical gray squares appear different depending on their background.
  On dark: appears lighter. On light: appears darker.<br><br>
  <strong>Lateral inhibition</strong> in retinal neurons enhances edges, making identical shades look different in different contexts.
</div>

<div id="controls">
  <label>Left BG <input type="range" id="bgLeft" min="0" max="80" value="20"></label>
  <label>Right BG <input type="range" id="bgRight" min="170" max="255" value="230"></label>
  <label>Square gray <input type="range" id="sqGray" min="30" max="220" value="128"></label>
  <label>Merge <input type="range" id="merge" min="0" max="100" value="0"></label>
  <button id="btnBar">Show Bar</button>
  <button id="btnColor">Color Mode</button>
  <button id="btnGrid">Gradient Grid</button>
  <button id="btnReset">Reset</button>
</div>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let W, H;

let bgLeftVal = 20;
let bgRightVal = 230;
let sqGray = 128;
let mergeAmount = 0;
let showBar = false;
let colorMode = false;
let gridMode = false;

// Color mode hues
const leftHue = 0;   // red
const rightHue = 220; // blue

function resize() {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
}

function lerp(a, b, t) { return a + (b - a) * t; }

function hslToRgb(h, s, l) {
  h /= 360; s /= 100; l /= 100;
  let r, g, b;
  if (s === 0) { r = g = b = l; }
  else {
    const hue2rgb = (p, q, t) => { if (t < 0) t += 1; if (t > 1) t -= 1; if (t < 1/6) return p + (q - p) * 6 * t; if (t < 1/2) return q; if (t < 2/3) return p + (q - p) * (2/3 - t) * 6; return p; };
    const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
    const p = 2 * l - q;
    r = hue2rgb(p, q, h + 1/3);
    g = hue2rgb(p, q, h);
    b = hue2rgb(p, q, h - 1/3);
  }
  return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];
}

function draw() {
  ctx.clearRect(0, 0, W, H);

  if (gridMode) {
    drawGradientGrid();
    return;
  }

  const m = mergeAmount / 100;
  const gap = lerp(W * 0.05, 0, m);
  const midX = W / 2;

  // Backgrounds merge toward each other
  const leftBG = lerp(bgLeftVal, (bgLeftVal + bgRightVal) / 2, m);
  const rightBG = lerp(bgRightVal, (bgLeftVal + bgRightVal) / 2, m);

  if (colorMode) {
    const leftRgb = hslToRgb(leftHue, 70, lerp(bgLeftVal / 255 * 50, 50, m));
    const rightRgb = hslToRgb(rightHue, 70, lerp(bgRightVal / 255 * 50, 50, m));
    ctx.fillStyle = `rgb(${leftRgb.join(',')})`;
    ctx.fillRect(0, 0, midX - gap / 2, H);
    ctx.fillStyle = `rgb(${rightRgb.join(',')})`;
    ctx.fillRect(midX + gap / 2, 0, W - midX - gap / 2, H);
  } else {
    ctx.fillStyle = `rgb(${Math.round(leftBG)},${Math.round(leftBG)},${Math.round(leftBG)})`;
    ctx.fillRect(0, 0, midX - gap / 2, H);
    ctx.fillStyle = `rgb(${Math.round(rightBG)},${Math.round(rightBG)},${Math.round(rightBG)})`;
    ctx.fillRect(midX + gap / 2, 0, W - midX - gap / 2, H);
  }

  // Gap background
  if (gap > 1) {
    ctx.fillStyle = '#1a1a2e';
    ctx.fillRect(midX - gap / 2, 0, gap, H);
  }

  // Squares
  const sqSize = Math.min(W, H) * 0.15;
  const sqY = H / 2 - sqSize / 2;
  const leftSqX = midX / 2 - sqSize / 2;
  const rightSqX = midX + midX / 2 - sqSize / 2;

  if (colorMode) {
    const sqRgb = hslToRgb(60, 60, sqGray / 255 * 60 + 20);
    ctx.fillStyle = `rgb(${sqRgb.join(',')})`;
  } else {
    ctx.fillStyle = `rgb(${sqGray},${sqGray},${sqGray})`;
  }
  ctx.fillRect(leftSqX, sqY, sqSize, sqSize);
  ctx.fillRect(rightSqX, sqY, sqSize, sqSize);

  // Labels
  ctx.fillStyle = sqGray > 160 ? '#333' : '#fff';
  ctx.font = 'bold 18px sans-serif';
  ctx.textAlign = 'center';
  ctx.fillText('A', leftSqX + sqSize / 2, sqY + sqSize / 2 + 6);
  ctx.fillText('B', rightSqX + sqSize / 2, sqY + sqSize / 2 + 6);

  // RGB label below squares
  const labelColor = colorMode
    ? `hsl(60, 60%, ${(sqGray / 255 * 60 + 20).toFixed(0)}%)`
    : `rgb(${sqGray},${sqGray},${sqGray})`;
  ctx.fillStyle = '#8af';
  ctx.font = '13px monospace';
  ctx.fillText(colorMode ? labelColor : `rgb(${sqGray},${sqGray},${sqGray})`, leftSqX + sqSize / 2, sqY + sqSize + 25);
  ctx.fillText('Same color!', rightSqX + sqSize / 2, sqY + sqSize + 25);

  // Connecting bar
  if (showBar) {
    if (colorMode) {
      const sqRgb = hslToRgb(60, 60, sqGray / 255 * 60 + 20);
      ctx.fillStyle = `rgb(${sqRgb.join(',')})`;
      ctx.strokeStyle = `rgb(${sqRgb.join(',')})`;
    } else {
      ctx.fillStyle = `rgb(${sqGray},${sqGray},${sqGray})`;
      ctx.strokeStyle = `rgb(${sqGray},${sqGray},${sqGray})`;
    }
    ctx.lineWidth = sqSize * 0.3;
    ctx.beginPath();
    ctx.moveTo(leftSqX + sqSize, sqY + sqSize / 2);
    ctx.lineTo(rightSqX, sqY + sqSize / 2);
    ctx.stroke();
  }
}

function drawGradientGrid() {
  const cols = 12;
  const rows = 1;
  const sqSize = Math.min(W / (cols + 2), H * 0.18);
  const totalW = cols * sqSize;
  const startX = (W - totalW) / 2;
  const startY = H / 2 - sqSize / 2;

  // Gradient background
  const grad = ctx.createLinearGradient(startX - sqSize, 0, startX + totalW + sqSize, 0);
  grad.addColorStop(0, `rgb(${bgLeftVal},${bgLeftVal},${bgLeftVal})`);
  grad.addColorStop(1, `rgb(${bgRightVal},${bgRightVal},${bgRightVal})`);
  ctx.fillStyle = grad;
  ctx.fillRect(0, 0, W, H);

  // All squares same color
  for (let i = 0; i < cols; i++) {
    const x = startX + i * sqSize;
    if (colorMode) {
      const sqRgb = hslToRgb(60, 60, sqGray / 255 * 60 + 20);
      ctx.fillStyle = `rgb(${sqRgb.join(',')})`;
    } else {
      ctx.fillStyle = `rgb(${sqGray},${sqGray},${sqGray})`;
    }
    ctx.fillRect(x + 4, startY + 4, sqSize - 8, sqSize - 8);
  }

  // Title
  ctx.fillStyle = '#8af';
  ctx.font = 'bold 16px sans-serif';
  ctx.textAlign = 'center';
  ctx.fillText('All squares are exactly the same color!', W / 2, startY - 20);
  ctx.font = '13px monospace';
  ctx.fillText(`rgb(${sqGray},${sqGray},${sqGray})`, W / 2, startY + sqSize + 30);
}

function animate() {
  draw();
  requestAnimationFrame(animate);
}

document.getElementById('bgLeft').addEventListener('input', e => { bgLeftVal = +e.target.value; });
document.getElementById('bgRight').addEventListener('input', e => { bgRightVal = +e.target.value; });
document.getElementById('sqGray').addEventListener('input', e => { sqGray = +e.target.value; });
document.getElementById('merge').addEventListener('input', e => { mergeAmount = +e.target.value; });

document.getElementById('btnBar').addEventListener('click', function() {
  showBar = !showBar;
  this.textContent = showBar ? 'Hide Bar' : 'Show Bar';
  this.classList.toggle('active', showBar);
});

document.getElementById('btnColor').addEventListener('click', function() {
  colorMode = !colorMode;
  this.textContent = colorMode ? 'Gray Mode' : 'Color Mode';
  this.classList.toggle('active', colorMode);
});

document.getElementById('btnGrid').addEventListener('click', function() {
  gridMode = !gridMode;
  this.textContent = gridMode ? 'Two Squares' : 'Gradient Grid';
  this.classList.toggle('active', gridMode);
});

document.getElementById('btnReset').addEventListener('click', reset);

function reset() {
  bgLeftVal = 20; bgRightVal = 230; sqGray = 128; mergeAmount = 0;
  showBar = false; colorMode = false; gridMode = false;
  document.getElementById('bgLeft').value = 20;
  document.getElementById('bgRight').value = 230;
  document.getElementById('sqGray').value = 128;
  document.getElementById('merge').value = 0;
  document.getElementById('btnBar').textContent = 'Show Bar';
  document.getElementById('btnBar').classList.remove('active');
  document.getElementById('btnColor').textContent = 'Color Mode';
  document.getElementById('btnColor').classList.remove('active');
  document.getElementById('btnGrid').textContent = 'Gradient Grid';
  document.getElementById('btnGrid').classList.remove('active');
}
window.reset = reset;

window.addEventListener('resize', resize);
resize();
animate();
</script>
<script src="../assets/js/enhance.js"></script>
</body>
</html>
