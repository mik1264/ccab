<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kanizsa Triangle</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #f0f0f0; overflow: hidden; font-family: 'Segoe UI', Tahoma, sans-serif; }
canvas { display: block; }
a { position: fixed; top: 20px; left: 20px; color: #8af; text-decoration: none; z-index: 100; font-size: 1.2em; }
#controls {
  position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
  background: rgba(30,30,40,0.85); backdrop-filter: blur(10px);
  padding: 16px 24px; border-radius: 14px; color: #ddd; z-index: 100;
  min-width: 380px; max-width: 520px;
}
#controls h3 { text-align: center; margin-bottom: 8px; color: #8af; font-size: 0.95em; }
.row { display: flex; align-items: center; justify-content: space-between; margin: 4px 0; font-size: 0.82em; }
.row label { flex: 0 0 130px; }
.row input[type=range] { flex: 1; margin: 0 8px; }
.row span { flex: 0 0 48px; text-align: right; }
button {
  background: #335; border: 1px solid #557; color: #aaf; padding: 6px 14px;
  border-radius: 6px; cursor: pointer; font-size: 0.82em; margin: 2px;
}
button:hover { background: #446; }
button.active { background: #448; border-color: #88f; }
#info {
  position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
  background: rgba(30,30,40,0.85); backdrop-filter: blur(10px);
  padding: 10px 20px; border-radius: 10px; color: #ccc; z-index: 100;
  font-size: 0.78em; max-width: 640px; text-align: center; line-height: 1.4;
}
</style>
</head>
<body>
<a href="index.html">&#8592; Back</a>
<canvas id="c"></canvas>
<div id="info">Your visual cortex "sees" a bright white triangle with sharp edges, even though no triangle edges exist! The illusory shape appears BRIGHTER than the identical white background.</div>
<div id="controls">
  <h3>Kanizsa Triangle &mdash; Illusory Contours</h3>
  <div class="row"><label>Mouth Angle</label><input type="range" id="mouthAngle" min="10" max="160" value="70"><span id="mouthAngleV">70&deg;</span></div>
  <div class="row"><label>Pac-Man Radius</label><input type="range" id="pacR" min="20" max="100" value="55"><span id="pacRV">55</span></div>
  <div class="row"><label>Spread</label><input type="range" id="spread" min="80" max="300" value="170"><span id="spreadV">170</span></div>
  <div class="row"><label>Rotation</label><input type="range" id="rotation" min="0" max="360" value="0"><span id="rotationV">0&deg;</span></div>
  <div style="display:flex;justify-content:center;gap:5px;margin-top:6px;flex-wrap:wrap">
    <button id="btnTriangle" class="active">Triangle</button>
    <button id="btnSquare">Square</button>
    <button id="btnCircle">Circle</button>
    <button id="btnNested">Nested</button>
  </div>
  <div style="display:flex;justify-content:center;gap:5px;margin-top:5px;flex-wrap:wrap">
    <button id="btnReveal">Reveal (Color)</button>
    <button id="btnAnimate">Animate</button>
    <button id="btnLines">Add Lines</button>
    <button id="btnReset">Reset</button>
  </div>
</div>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let W, H;
let shapeMode = 'triangle';
let revealed = false;
let animating = false;
let animPhase = 0;
let showLines = false;

function resize() {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

function val(id) { return +document.getElementById(id).value; }

['mouthAngle','pacR','spread','rotation'].forEach(id => {
  document.getElementById(id).addEventListener('input', () => {
    const v = val(id);
    document.getElementById(id + 'V').textContent = (id === 'mouthAngle' || id === 'rotation') ? v + '\u00B0' : v;
  });
});

function drawPacMan(cx, cy, r, mouthAngle, facingAngle, color) {
  const halfMouth = (mouthAngle / 2) * Math.PI / 180;
  ctx.fillStyle = color;
  ctx.beginPath();
  ctx.moveTo(cx, cy);
  ctx.arc(cx, cy, r, facingAngle + halfMouth, facingAngle + Math.PI * 2 - halfMouth);
  ctx.closePath();
  ctx.fill();
}

function getShapeVertices(mode, cx, cy, spread, rot) {
  const rotRad = rot * Math.PI / 180;
  const verts = [];
  let n;
  if (mode === 'triangle') n = 3;
  else if (mode === 'square') n = 4;
  else if (mode === 'circle') n = 8;
  else if (mode === 'nested') n = 3;
  else n = 3;

  for (let i = 0; i < n; i++) {
    const angle = (i / n) * Math.PI * 2 - Math.PI / 2 + rotRad;
    verts.push({
      x: cx + Math.cos(angle) * spread,
      y: cy + Math.sin(angle) * spread,
      facing: angle + Math.PI // face toward center
    });
  }
  return verts;
}

function drawIllusoryShape(verts, cx, cy) {
  if (showLines && verts.length >= 3) {
    ctx.strokeStyle = '#bbb';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(verts[0].x, verts[0].y);
    for (let i = 1; i < verts.length; i++) {
      ctx.lineTo(verts[i].x, verts[i].y);
    }
    ctx.closePath();
    ctx.stroke();
  }
}

function draw() {
  ctx.fillStyle = '#f0f0f0';
  ctx.fillRect(0, 0, W, H);

  const cx = W / 2;
  const cy = H * 0.44;
  let mouthAngle = val('mouthAngle');
  const pacR = val('pacR');
  const spread = val('spread');
  const rotation = val('rotation');

  if (animating) {
    animPhase += 0.02;
    mouthAngle = 10 + (Math.sin(animPhase) + 1) / 2 * 140;
    document.getElementById('mouthAngle').value = Math.round(mouthAngle);
    document.getElementById('mouthAngleV').textContent = Math.round(mouthAngle) + '\u00B0';
  }

  const color = revealed ? '#dd6644' : '#333';

  if (shapeMode === 'nested') {
    // Outer triangle
    const outerVerts = getShapeVertices('triangle', cx, cy, spread, rotation);
    drawIllusoryShape(outerVerts, cx, cy);
    outerVerts.forEach(v => drawPacMan(v.x, v.y, pacR, mouthAngle, v.facing, color));

    // Inner inverted triangle
    const innerVerts = getShapeVertices('triangle', cx, cy, spread * 0.5, rotation + 180);
    drawIllusoryShape(innerVerts, cx, cy);
    innerVerts.forEach(v => drawPacMan(v.x, v.y, pacR * 0.6, mouthAngle, v.facing, revealed ? '#4488bb' : '#555'));

    // Extra outline triangles for enhanced effect
    if (!revealed) {
      ctx.strokeStyle = '#ddd';
      ctx.lineWidth = 2;
      // Outer triangle outline segments between pac-men
      for (let i = 0; i < outerVerts.length; i++) {
        const a = outerVerts[i];
        const b = outerVerts[(i + 1) % outerVerts.length];
        const dx = b.x - a.x;
        const dy = b.y - a.y;
        const len = Math.hypot(dx, dy);
        const nx = dx / len;
        const ny = dy / len;
        ctx.beginPath();
        ctx.moveTo(a.x + nx * pacR, a.y + ny * pacR);
        ctx.lineTo(b.x - nx * pacR, b.y - ny * pacR);
        ctx.stroke();
      }
    }
  } else {
    const verts = getShapeVertices(shapeMode, cx, cy, spread, rotation);

    // Draw line segments between pac-men for enhanced effect (subtle)
    if (showLines) {
      drawIllusoryShape(verts, cx, cy);
    }

    // Draw pac-men
    verts.forEach(v => {
      drawPacMan(v.x, v.y, pacR, mouthAngle, v.facing, color);
    });

    // When not revealed, draw subtle outline triangles for the outline triangle illusion variant
    if (!revealed && shapeMode !== 'circle') {
      ctx.strokeStyle = '#ccc';
      ctx.lineWidth = 1.5;
      for (let i = 0; i < verts.length; i++) {
        const a = verts[i];
        const b = verts[(i + 1) % verts.length];
        const dx = b.x - a.x;
        const dy = b.y - a.y;
        const len = Math.hypot(dx, dy);
        const nx = dx / len;
        const ny = dy / len;
        // Only draw segment portions outside the pac-men
        // (This creates a subtle outline that enhances the illusory contour)
      }
    }
  }

  // Info about current perceived shape
  ctx.fillStyle = '#888';
  ctx.font = '13px sans-serif';
  ctx.textAlign = 'center';
  const shapeName = shapeMode === 'triangle' ? 'triangle' :
                    shapeMode === 'square' ? 'square' :
                    shapeMode === 'circle' ? 'circle' : 'nested triangles';
  if (!revealed) {
    ctx.fillText('Do you see a bright white ' + shapeName + ' floating above the pac-men?', cx, cy + spread + pacR + 40);
    ctx.fillStyle = '#aaa';
    ctx.font = '12px sans-serif';
    ctx.fillText('There are NO edges and NO brightness difference \u2014 your brain creates them!', cx, cy + spread + pacR + 60);
  } else {
    ctx.fillText('Colored pac-men reveal: there is no ' + shapeName + ' \u2014 just pac-man shapes!', cx, cy + spread + pacR + 40);
  }

  requestAnimationFrame(draw);
}

['btnTriangle','btnSquare','btnCircle','btnNested'].forEach(id => {
  document.getElementById(id).addEventListener('click', function() {
    shapeMode = id.replace('btn','').toLowerCase();
    document.querySelectorAll('#controls button').forEach(b => b.classList.remove('active'));
    this.classList.add('active');
    if (revealed) document.getElementById('btnReveal').classList.add('active');
    if (animating) document.getElementById('btnAnimate').classList.add('active');
    if (showLines) document.getElementById('btnLines').classList.add('active');
    // Adjust pac-man count display
    const info = document.getElementById('info');
    if (shapeMode === 'triangle') info.textContent = 'Your visual cortex "sees" a bright white triangle with sharp edges, even though no triangle edges exist!';
    else if (shapeMode === 'square') info.textContent = 'Four pac-men create an illusory square. Your brain fills in the contours between them.';
    else if (shapeMode === 'circle') info.textContent = 'Eight pac-men suggest a circle. Contour completion neurons fire even with no physical edge.';
    else info.textContent = 'Nested Kanizsa: two interlocking triangles create overlapping phantom shapes!';
  });
});

document.getElementById('btnReveal').addEventListener('click', function() {
  revealed = !revealed;
  this.classList.toggle('active', revealed);
});
document.getElementById('btnAnimate').addEventListener('click', function() {
  animating = !animating;
  animPhase = 0;
  this.classList.toggle('active', animating);
});
document.getElementById('btnLines').addEventListener('click', function() {
  showLines = !showLines;
  this.classList.toggle('active', showLines);
});
document.getElementById('btnReset').addEventListener('click', function() { window.reset(); });

window.reset = function() {
  shapeMode = 'triangle';
  revealed = false;
  animating = false;
  animPhase = 0;
  showLines = false;
  document.getElementById('mouthAngle').value = 70;
  document.getElementById('pacR').value = 55;
  document.getElementById('spread').value = 170;
  document.getElementById('rotation').value = 0;
  document.getElementById('mouthAngleV').textContent = '70\u00B0';
  document.getElementById('pacRV').textContent = '55';
  document.getElementById('spreadV').textContent = '170';
  document.getElementById('rotationV').textContent = '0\u00B0';
  document.querySelectorAll('#controls button').forEach(b => b.classList.remove('active'));
  document.getElementById('btnTriangle').classList.add('active');
  document.getElementById('info').textContent = 'Your visual cortex "sees" a bright white triangle with sharp edges, even though no triangle edges exist! The illusory shape appears BRIGHTER than the identical white background.';
};

draw();
</script>
<script src="../assets/js/enhance.js"></script>
</body>
</html>
