<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rotating Snakes Illusion</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #1a1a2e; overflow: hidden; font-family: 'Segoe UI', Tahoma, sans-serif; }
canvas { display: block; }
a { position: fixed; top: 20px; left: 20px; color: #8af; text-decoration: none; z-index: 100; font-size: 1.2em; }
#controls {
  position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
  background: rgba(20,20,40,0.85); backdrop-filter: blur(10px);
  padding: 18px 24px; border-radius: 14px; color: #ccd; z-index: 100;
  display: flex; flex-wrap: wrap; gap: 14px; align-items: center; max-width: 750px;
  border: 1px solid rgba(255,255,255,0.08);
}
#controls label { font-size: 0.85em; display: flex; align-items: center; gap: 6px; }
#controls input[type=range] { width: 90px; accent-color: #8af; }
#controls select { background: rgba(60,60,100,0.6); color: #ccd; border: 1px solid rgba(255,255,255,0.15); padding: 4px 8px; border-radius: 6px; font-size: 0.82em; }
button {
  background: rgba(100,140,255,0.2); color: #8af; border: 1px solid rgba(100,140,255,0.3);
  padding: 6px 14px; border-radius: 8px; cursor: pointer; font-size: 0.85em;
}
button:hover { background: rgba(100,140,255,0.35); }
button.active { background: rgba(100,255,140,0.2); color: #8fa; border-color: rgba(100,255,140,0.3); }
#info {
  position: fixed; top: 20px; right: 20px; background: rgba(20,20,40,0.85);
  backdrop-filter: blur(10px); padding: 16px 20px; border-radius: 12px;
  color: #aab; font-size: 0.82em; max-width: 320px; z-index: 100; line-height: 1.5;
  border: 1px solid rgba(255,255,255,0.08);
}
#info strong { color: #dde; }
#fixation {
  position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
  color: #ff4444; font-size: 28px; font-weight: bold; z-index: 50;
  text-shadow: 0 0 8px rgba(0,0,0,0.8); pointer-events: none;
}
#fixation-label {
  position: fixed; top: calc(50% + 30px); left: 50%; transform: translateX(-50%);
  color: rgba(255,100,100,0.7); font-size: 0.75em; z-index: 50;
  pointer-events: none; white-space: nowrap;
}
</style>
</head>
<body>
<a href="index.html">&#8592; Back</a>
<canvas id="c"></canvas>

<div id="fixation">+</div>
<div id="fixation-label">Look here - notice rotation in periphery</div>

<div id="info">
  <strong>Rotating Snakes (Kitaoka)</strong><br><br>
  This is <em>entirely static</em>! The "motion" is generated by your visual system's response to specific luminance gradients. Small involuntary eye movements (microsaccades) trigger motion detectors.<br><br>
  <strong>Tip:</strong> The illusion is strongest in your <em>peripheral</em> vision. Stare at the red cross.
</div>

<div id="controls">
  <label>Scheme <select id="scheme">
    <option value="classic">Classic Green/Blue</option>
    <option value="warm">Red/Yellow</option>
    <option value="gray">Grayscale</option>
    <option value="purple">Purple/Cyan</option>
  </select></label>
  <label>Density <input type="range" id="density" min="2" max="8" value="4"></label>
  <label>Segments <input type="range" id="segments" min="8" max="40" value="20"></label>
  <label>Size <input type="range" id="ringSize" min="30" max="120" value="60"></label>
  <button id="btnFixation">Toggle Cross</button>
  <button id="btnRedraw">Redraw</button>
</div>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let W, H;

const colorSchemes = {
  classic: ['#000000', '#0066aa', '#ffffff', '#88cc44'],
  warm:    ['#000000', '#cc2200', '#ffffff', '#ffcc00'],
  gray:    ['#000000', '#555555', '#ffffff', '#aaaaaa'],
  purple:  ['#000000', '#6633cc', '#ffffff', '#00cccc']
};

let scheme = 'classic';
let density = 4;
let numSegments = 20;
let ringRadius = 60;
let showFixation = true;

function resize() {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
  draw();
}

function drawRosette(cx, cy, baseAngle) {
  const colors = colorSchemes[scheme];
  const numRings = 4;
  const ringWidth = ringRadius / numRings;

  for (let ring = numRings - 1; ring >= 0; ring--) {
    const r = (ring + 0.5) * ringWidth + ringWidth * 0.3;
    const segAngle = (Math.PI * 2) / numSegments;

    for (let s = 0; s < numSegments; s++) {
      const shift = ring * 1;
      const colorIdx = (s + shift) % 4;
      const a1 = baseAngle + s * segAngle;
      const a2 = a1 + segAngle;

      ctx.beginPath();
      ctx.arc(cx, cy, r + ringWidth * 0.5, a1, a2);
      ctx.arc(cx, cy, r - ringWidth * 0.5, a2, a1, true);
      ctx.closePath();
      ctx.fillStyle = colors[colorIdx];
      ctx.fill();
    }
  }

  // Center dot
  ctx.beginPath();
  ctx.arc(cx, cy, ringWidth * 0.4, 0, Math.PI * 2);
  ctx.fillStyle = colorSchemes[scheme][0];
  ctx.fill();
}

function draw() {
  ctx.fillStyle = '#888888';
  ctx.fillRect(0, 0, W, H);

  const spacing = ringRadius * 2.3;
  const cols = Math.ceil(W / spacing) + 2;
  const rows = Math.ceil(H / spacing) + 2;
  const offsetX = (W - (cols - 1) * spacing) / 2;
  const offsetY = (H - (rows - 1) * spacing) / 2;

  for (let row = 0; row < rows; row++) {
    for (let col = 0; col < cols; col++) {
      const cx = offsetX + col * spacing + (row % 2 ? spacing * 0.5 : 0);
      const cy = offsetY + row * spacing;
      const baseAngle = ((row * 3 + col * 7) % 12) * (Math.PI / 6);
      drawRosette(cx, cy, baseAngle);
    }
  }
}

function updateFixation() {
  document.getElementById('fixation').style.display = showFixation ? 'block' : 'none';
  document.getElementById('fixation-label').style.display = showFixation ? 'block' : 'none';
}

document.getElementById('scheme').addEventListener('change', e => {
  scheme = e.target.value;
  draw();
});

document.getElementById('density').addEventListener('input', e => {
  density = parseInt(e.target.value);
  ringRadius = [0, 0, 100, 80, 60, 50, 42, 36, 30][density];
  draw();
});

document.getElementById('segments').addEventListener('input', e => {
  numSegments = parseInt(e.target.value);
  draw();
});

document.getElementById('ringSize').addEventListener('input', e => {
  ringRadius = parseInt(e.target.value);
  draw();
});

document.getElementById('btnFixation').addEventListener('click', () => {
  showFixation = !showFixation;
  updateFixation();
});

document.getElementById('btnRedraw').addEventListener('click', draw);
requestAnimationFrame(draw);

window.reset = function() {
  scheme = 'classic';
  density = 4;
  numSegments = 20;
  ringRadius = 60;
  showFixation = true;
  document.getElementById('scheme').value = 'classic';
  document.getElementById('density').value = 4;
  document.getElementById('segments').value = 20;
  document.getElementById('ringSize').value = 60;
  updateFixation();
  draw();
};

let resizeTimer;
window.addEventListener('resize', () => {
  clearTimeout(resizeTimer);
  resizeTimer = setTimeout(resize, 150);
});

resize();
</script>
<script src="../assets/js/enhance.js"></script>
</body>
</html>