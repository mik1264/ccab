<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Electrical Grid Load Balancing</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
canvas { display: block; }
#title {
    position: fixed; top: 50px; left: 50%; transform: translateX(-50%);
    color: #fbbf24; font-size: 22px; font-weight: 600;
    text-shadow: 0 0 20px rgba(251,191,36,0.5); z-index: 10;
    pointer-events: none; text-align: center;
}
#controls {
    position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%);
    background: rgba(0,0,0,0.85); border: 1px solid rgba(251,191,36,0.3);
    border-radius: 12px; padding: 12px 20px; display: flex; gap: 12px;
    align-items: center; z-index: 10; flex-wrap: wrap; justify-content: center;
}
.gen-btn {
    padding: 8px 14px; border-radius: 6px; cursor: pointer; font-size: 12px;
    font-weight: bold; border: 2px solid; transition: all 0.2s; min-width: 90px;
    text-align: center;
}
.gen-btn.on { opacity: 1; }
.gen-btn.off { opacity: 0.4; }
.speed-ctrl { display: flex; align-items: center; gap: 6px; color: #fbbf24; font-size: 12px; }
.speed-ctrl input { width: 80px; accent-color: #fbbf24; }
</style>
</head>
<body>
<a href="../index.html" style="position:fixed;top:10px;left:10px;padding:8px 16px;background:rgba(0,0,0,0.7);color:#fbbf24;text-decoration:none;border-radius:6px;font-size:14px;z-index:999;font-family:sans-serif;">&#8592; Back to Gallery</a>
<div id="title">Electrical Grid Load Balancing</div>
<canvas id="canvas"></canvas>
<div id="controls">
    <div class="gen-btn on" id="btn-solar" style="background:rgba(255,200,0,0.3);border-color:#ffc800;color:#ffc800;" onclick="toggleGen('solar')">&#9728; Solar: ON</div>
    <div class="gen-btn on" id="btn-wind" style="background:rgba(100,200,255,0.3);border-color:#64c8ff;color:#64c8ff;" onclick="toggleGen('wind')">&#127744; Wind: ON</div>
    <div class="gen-btn on" id="btn-gas" style="background:rgba(255,120,50,0.3);border-color:#ff7832;color:#ff7832;" onclick="toggleGen('gas')">&#128293; Gas: ON</div>
    <div class="gen-btn on" id="btn-nuclear" style="background:rgba(0,255,100,0.3);border-color:#00ff64;color:#00ff64;" onclick="toggleGen('nuclear')">&#9762; Nuclear: ON</div>
    <div class="gen-btn on" id="btn-hydro" style="background:rgba(0,150,255,0.3);border-color:#0096ff;color:#0096ff;" onclick="toggleGen('hydro')">&#128167; Hydro: ON</div>
    <div class="speed-ctrl">
        <label>Speed:</label>
        <input type="range" id="speedSlider" min="1" max="30" value="8">
    </div>
</div>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let W, H;
function resize() { W = canvas.width = window.innerWidth; H = canvas.height = window.innerHeight; }
resize();
window.addEventListener('resize', resize);

const generators = {
    solar:   { on: true, color: '#ffc800', name: 'Solar', icon: '\u2600', maxMW: 400 },
    wind:    { on: true, color: '#64c8ff', name: 'Wind', icon: '\ud83c\udf00', maxMW: 300 },
    gas:     { on: true, color: '#ff7832', name: 'Gas', icon: '\ud83d\udd25', maxMW: 500 },
    nuclear: { on: true, color: '#00ff64', name: 'Nuclear', icon: '\u2622', maxMW: 800 },
    hydro:   { on: true, color: '#0096ff', name: 'Hydro', icon: '\ud83d\udca7', maxMW: 250 }
};

let timeOfDay = 0;
let speedMult = 8;
let supplyHistory = [];
let demandHistory = [];
let freqHistory = [];
let frequency = 50;
let particles = [];

document.getElementById('speedSlider').addEventListener('input', e => speedMult = +e.target.value);

function toggleGen(name) {
    generators[name].on = !generators[name].on;
    const btn = document.getElementById('btn-' + name);
    btn.classList.toggle('on', generators[name].on);
    btn.classList.toggle('off', !generators[name].on);
    btn.textContent = btn.textContent.replace(/ON|OFF/, generators[name].on ? 'ON' : 'OFF');
}
window.toggleGen = toggleGen;

function getDemand(t) {
    const h = t % 24;
    let base = 800;
    base += 300 * Math.sin((h - 6) * Math.PI / 12) * (h > 6 && h < 22 ? 1 : 0);
    base += 200 * (h > 17 && h < 21 ? Math.sin((h - 17) * Math.PI / 4) : 0);
    base += Math.sin(t * 2.1) * 50 + Math.sin(t * 5.3) * 30;
    return Math.max(400, base);
}

function getSupply(t) {
    const h = t % 24;
    let total = 0;
    if (generators.solar.on) {
        const solarFactor = Math.max(0, Math.sin((h - 6) * Math.PI / 12)) * (h > 6 && h < 18 ? 1 : 0);
        total += generators.solar.maxMW * solarFactor * (0.8 + Math.sin(t * 3.7) * 0.2);
    }
    if (generators.wind.on) {
        total += generators.wind.maxMW * (0.4 + 0.3 * Math.sin(t * 0.7) + 0.2 * Math.sin(t * 1.9));
    }
    if (generators.gas.on) total += generators.gas.maxMW * 0.85;
    if (generators.nuclear.on) total += generators.nuclear.maxMW * 0.95;
    if (generators.hydro.on) total += generators.hydro.maxMW * 0.7;
    return total;
}

function drawGenerator(x, y, gen, output) {
    const r = 35;
    ctx.beginPath();
    ctx.arc(x, y, r, 0, Math.PI * 2);
    ctx.fillStyle = gen.on ? `${gen.color}22` : 'rgba(50,50,50,0.5)';
    ctx.fill();
    ctx.strokeStyle = gen.on ? gen.color : '#444';
    ctx.lineWidth = 2;
    ctx.stroke();
    if (gen.on) {
        ctx.beginPath();
        ctx.arc(x, y, r + 4, 0, Math.PI * 2);
        ctx.strokeStyle = `${gen.color}44`;
        ctx.lineWidth = 1;
        ctx.stroke();
    }
    ctx.fillStyle = gen.on ? gen.color : '#666';
    ctx.font = '22px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText(gen.icon, x, y + 2);
    ctx.font = 'bold 10px sans-serif';
    ctx.fillStyle = gen.on ? '#fff' : '#666';
    ctx.fillText(gen.name, x, y + r + 14);
    ctx.font = '9px sans-serif';
    ctx.fillStyle = gen.on ? gen.color : '#555';
    ctx.fillText(output.toFixed(0) + ' MW', x, y + r + 26);
    return { x, y: y + r + 5 };
}

function drawPowerLine(fromX, fromY, toX, toY, power, color) {
    ctx.beginPath();
    ctx.moveTo(fromX, fromY);
    ctx.lineTo(toX, toY);
    ctx.strokeStyle = `${color}44`;
    ctx.lineWidth = Math.max(1, power / 200);
    ctx.stroke();
    if (power > 10) {
        const t = (Date.now() / 800) % 1;
        for (let i = 0; i < 3; i++) {
            const p = (t + i / 3) % 1;
            const px = fromX + (toX - fromX) * p;
            const py = fromY + (toY - fromY) * p;
            ctx.beginPath();
            ctx.arc(px, py, 2.5, 0, Math.PI * 2);
            ctx.fillStyle = color;
            ctx.fill();
        }
    }
}

function drawGraph(data1, data2, x, y, w, h, label, colors, labels) {
    ctx.fillStyle = 'rgba(0,0,0,0.6)';
    ctx.strokeStyle = 'rgba(251,191,36,0.2)';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.roundRect(x, y, w, h, 8);
    ctx.fill();
    ctx.stroke();
    ctx.fillStyle = '#fbbf24';
    ctx.font = 'bold 11px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText(label, x + w / 2, y + 14);
    const gx = x + 8, gy = y + 22, gw = w - 16, gh = h - 32;
    const allData = data1.concat(data2);
    let maxV = 2000;
    if (allData.length > 0) maxV = Math.max(maxV, ...allData.map(d => d.v));
    function drawLine(data, color) {
        if (data.length < 2) return;
        ctx.beginPath();
        ctx.strokeStyle = color;
        ctx.lineWidth = 1.5;
        const startIdx = Math.max(0, data.length - Math.floor(gw));
        for (let i = startIdx; i < data.length; i++) {
            const px = gx + gw - (data.length - 1 - i);
            const py = gy + gh - (data[i].v / maxV) * gh;
            if (i === startIdx) ctx.moveTo(px, py);
            else ctx.lineTo(px, py);
        }
        ctx.stroke();
    }
    drawLine(data1, colors[0]);
    drawLine(data2, colors[1]);
    for (let i = 0; i < labels.length; i++) {
        ctx.fillStyle = colors[i];
        ctx.fillRect(gx + i * 70, gy + gh + 4, 8, 6);
        ctx.fillStyle = '#aaa';
        ctx.font = '8px sans-serif';
        ctx.textAlign = 'left';
        ctx.fillText(labels[i], gx + i * 70 + 11, gy + gh + 10);
    }
}

function drawFrequencyMeter(x, y) {
    const w = 160, h = 80;
    ctx.fillStyle = 'rgba(0,0,0,0.7)';
    ctx.strokeStyle = 'rgba(251,191,36,0.2)';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.roundRect(x, y, w, h, 8);
    ctx.fill();
    ctx.stroke();
    ctx.fillStyle = '#fbbf24';
    ctx.font = 'bold 11px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('Grid Frequency', x + w / 2, y + 16);
    const dev = Math.abs(frequency - 50);
    const color = dev < 0.2 ? '#4f8' : dev < 0.5 ? '#fbbf24' : '#f55';
    ctx.fillStyle = color;
    ctx.font = 'bold 26px monospace';
    ctx.fillText(frequency.toFixed(2) + ' Hz', x + w / 2, y + 50);
    ctx.font = '9px sans-serif';
    ctx.fillStyle = dev < 0.2 ? '#4f8' : dev < 0.5 ? '#fbbf24' : '#f55';
    const status = dev < 0.2 ? 'STABLE' : dev < 0.5 ? 'WARNING' : 'CRITICAL';
    ctx.fillText(status, x + w / 2, y + 68);
}

function drawConsumers(x, y) {
    const icons = ['\ud83c\udfe0', '\ud83c\udfed', '\ud83c\udfe2', '\ud83c\udfea', '\ud83c\udfe5'];
    const names = ['Homes', 'Industry', 'Office', 'Retail', 'Hospital'];
    icons.forEach((ic, i) => {
        const cx = x + i * 55;
        ctx.font = '22px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText(ic, cx, y);
        ctx.font = '8px sans-serif';
        ctx.fillStyle = '#aaa';
        ctx.fillText(names[i], cx, y + 14);
    });
}

let lastTime = performance.now();
function animate(now) {
    const dt = (now - lastTime) / 1000;
    lastTime = now;
    timeOfDay += dt * speedMult * 0.02;

    const demand = getDemand(timeOfDay);
    const supply = getSupply(timeOfDay);
    const imbalance = (supply - demand) / demand;
    frequency += (50 + imbalance * 2 - frequency) * dt * 3;
    frequency = Math.max(48, Math.min(52, frequency));

    if (supplyHistory.length === 0 || now - supplyHistory[supplyHistory.length - 1].t > 50) {
        supplyHistory.push({ t: now, v: supply });
        demandHistory.push({ t: now, v: demand });
        freqHistory.push({ t: now, v: (frequency - 48) / 4 * 2000 });
        if (supplyHistory.length > 500) { supplyHistory.shift(); demandHistory.shift(); freqHistory.shift(); }
    }

    ctx.clearRect(0, 0, W, H);
    const bg = ctx.createLinearGradient(0, 0, 0, H);
    bg.addColorStop(0, '#0a0e1a');
    bg.addColorStop(1, '#0d1225');
    ctx.fillStyle = bg;
    ctx.fillRect(0, 0, W, H);

    const gridCX = W * 0.45, gridCY = H * 0.42;
    ctx.beginPath();
    ctx.arc(gridCX, gridCY, 30, 0, Math.PI * 2);
    const devAbs = Math.abs(frequency - 50);
    const gColor = devAbs < 0.2 ? '#4f8' : devAbs < 0.5 ? '#fbbf24' : '#f55';
    ctx.fillStyle = gColor + '22';
    ctx.fill();
    ctx.strokeStyle = gColor;
    ctx.lineWidth = 2;
    ctx.stroke();
    ctx.fillStyle = gColor;
    ctx.font = 'bold 10px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('GRID', gridCX, gridCY + 4);

    const genKeys = ['solar', 'wind', 'gas', 'nuclear', 'hydro'];
    const genPositions = [];
    genKeys.forEach((key, i) => {
        const angle = -Math.PI / 2 + (i - 2) * 0.5;
        const gx = gridCX + Math.cos(angle) * 180 - 100;
        const gy = gridCY + Math.sin(angle) * 140 - 40;
        const gen = generators[key];
        let output = 0;
        const h = timeOfDay % 24;
        if (gen.on) {
            if (key === 'solar') output = gen.maxMW * Math.max(0, Math.sin((h - 6) * Math.PI / 12)) * (h > 6 && h < 18 ? 1 : 0);
            else if (key === 'wind') output = gen.maxMW * (0.4 + 0.3 * Math.sin(timeOfDay * 0.7));
            else if (key === 'gas') output = gen.maxMW * 0.85;
            else if (key === 'nuclear') output = gen.maxMW * 0.95;
            else if (key === 'hydro') output = gen.maxMW * 0.7;
        }
        const pos = drawGenerator(gx, gy, gen, output);
        if (gen.on && output > 5) drawPowerLine(gx, gy + 35, gridCX, gridCY, output, gen.color);
    });

    const consumerY = gridCY + 100;
    drawConsumers(gridCX - 110, consumerY + 40);
    drawPowerLine(gridCX, gridCY + 30, gridCX, consumerY + 10, demand, '#fff');
    ctx.fillStyle = '#fff';
    ctx.font = '10px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('Demand: ' + demand.toFixed(0) + ' MW', gridCX, consumerY + 62);

    const graphW = Math.min(320, W * 0.32);
    const graphH = 120;
    drawGraph(supplyHistory, demandHistory, W - graphW - 20, 80, graphW, graphH,
        'Supply vs Demand (MW)', ['#4f8', '#f84'], ['Supply', 'Demand']);
    drawFrequencyMeter(W - graphW - 20, 80 + graphH + 20);

    const h = timeOfDay % 24;
    ctx.fillStyle = 'rgba(0,0,0,0.6)';
    ctx.beginPath();
    ctx.roundRect(20, H - 100, 140, 35, 6);
    ctx.fill();
    ctx.fillStyle = '#fbbf24';
    ctx.font = 'bold 12px sans-serif';
    ctx.textAlign = 'left';
    const hh = Math.floor(h).toString().padStart(2, '0');
    const mm = Math.floor((h % 1) * 60).toString().padStart(2, '0');
    ctx.fillText('Time: ' + hh + ':' + mm, 32, H - 78);

    const balanceText = supply > demand * 1.05 ? 'OVERSUPPLY' : supply < demand * 0.95 ? 'UNDERSUPPLY' : 'BALANCED';
    const balanceColor = supply > demand * 1.05 ? '#fbbf24' : supply < demand * 0.95 ? '#f55' : '#4f8';
    ctx.fillStyle = balanceColor;
    ctx.font = 'bold 14px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText(balanceText, gridCX, gridCY - 50);
    ctx.font = '11px sans-serif';
    ctx.fillText('Supply: ' + supply.toFixed(0) + ' MW | Demand: ' + demand.toFixed(0) + ' MW', gridCX, gridCY - 36);

    requestAnimationFrame(animate);
}
requestAnimationFrame(animate);
</script>
</body>
</html>
