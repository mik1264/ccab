<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Atmospheric Convection Cells</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0e1a; overflow: hidden; font-family: 'Nunito', sans-serif; }
canvas { display: block; }
.title-overlay {
    position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
    color: #fff; font-size: 1.4rem; font-weight: 600;
    text-shadow: 0 2px 10px rgba(0,0,0,0.7);
    pointer-events: none; z-index: 10; text-align: center;
}
.title-overlay .subtitle {
    font-size: 0.8rem; opacity: 0.7; margin-top: 4px; font-weight: 300;
}
.organic-back-link {
    position: fixed; top: 20px; left: 20px; z-index: 100;
    display: flex; align-items: center; gap: 8px;
    padding: 8px 16px; border-radius: 20px;
    background: rgba(255,255,255,0.1); backdrop-filter: blur(10px);
    color: #fff; text-decoration: none; font-size: 0.9rem;
    transition: background 0.3s;
}
.organic-back-link:hover { background: rgba(255,255,255,0.2); }
.controls {
    position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
    display: flex; gap: 20px; align-items: center; z-index: 10;
    background: rgba(0,0,0,0.6); backdrop-filter: blur(10px);
    padding: 12px 24px; border-radius: 20px; color: #fff; font-size: 0.85rem;
}
.controls label { display: flex; align-items: center; gap: 8px; }
.controls input[type="range"] { width: 120px; }
.info-panel {
    position: fixed; top: 80px; right: 20px; z-index: 10;
    background: rgba(0,0,0,0.5); backdrop-filter: blur(10px);
    padding: 12px 16px; border-radius: 12px; color: #fff; font-size: 0.75rem;
    line-height: 1.6;
}
</style>
</head>
<body>
<a href="../index.html" class="organic-back-link">
    <span class="back-arrow">&larr;</span>
    <span class="back-text">Gallery</span>
</a>
<div class="title-overlay">
    Atmospheric Convection Cells
    <div class="subtitle">Rayleigh-B&eacute;nard Convection &mdash; Heat rises, cool air sinks</div>
</div>
<div class="info-panel">
    <div>Particles: <span id="pCount">0</span></div>
    <div>Avg Temp: <span id="avgTemp">0</span>&deg;C</div>
</div>
<div class="controls">
    <label>Heat Intensity: <input type="range" id="heatSlider" min="0.5" max="5" step="0.1" value="2"> <span id="heatVal">2.0</span></label>
    <label>Viscosity: <input type="range" id="viscSlider" min="0.9" max="0.999" step="0.001" value="0.98"> <span id="viscVal">0.98</span></label>
</div>
<canvas id="canvas"></canvas>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const heatSlider = document.getElementById('heatSlider');
const viscSlider = document.getElementById('viscSlider');
const heatVal = document.getElementById('heatVal');
const viscVal = document.getElementById('viscVal');
const pCountEl = document.getElementById('pCount');
const avgTempEl = document.getElementById('avgTemp');

let W, H;
function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
}
resize();
window.addEventListener('resize', resize);

const NUM_PARTICLES = 3000;
const particles = [];

function tempToColor(t) {
    // t in [0,1]: 0=cold(blue), 1=hot(red)
    t = Math.max(0, Math.min(1, t));
    let r, g, b;
    if (t < 0.25) {
        r = 0; g = Math.floor(t * 4 * 200); b = 200;
    } else if (t < 0.5) {
        r = 0; g = 200; b = Math.floor((1 - (t - 0.25) * 4) * 200);
    } else if (t < 0.75) {
        r = Math.floor((t - 0.5) * 4 * 255); g = 200 - Math.floor((t - 0.5) * 4 * 100); b = 0;
    } else {
        r = 255; g = Math.floor((1 - (t - 0.75) * 4) * 100); b = 0;
    }
    return `rgb(${r},${g},${b})`;
}

class Particle {
    constructor() {
        this.x = Math.random() * W;
        this.y = Math.random() * H;
        this.vx = 0;
        this.vy = 0;
        this.temp = 0.3 + Math.random() * 0.4;
        this.size = 1.5 + Math.random() * 1.5;
    }
    update(heat, visc) {
        const numCells = 4;
        const cellWidth = W / numCells;
        const cx = this.x / cellWidth;
        const cellIndex = Math.floor(cx);
        const localX = (cx - cellIndex - 0.5) * Math.PI * 2;
        const localY = (this.y / H - 0.5) * Math.PI;
        const direction = cellIndex % 2 === 0 ? 1 : -1;

        const convVx = direction * Math.sin(localX) * Math.cos(localY) * heat * 0.8;
        const convVy = -direction * Math.cos(localX) * Math.sin(localY) * heat * 0.8;

        const buoyancy = -(this.temp - 0.5) * heat * 1.5;

        this.vx += convVx * 0.02;
        this.vy += (convVy + buoyancy) * 0.02;
        this.vx *= visc;
        this.vy *= visc;

        this.x += this.vx;
        this.y += this.vy;

        const bottomDist = 1 - this.y / H;
        if (bottomDist < 0.1) {
            this.temp += (1 - this.temp) * 0.03 * heat * 0.5;
        }
        const topDist = this.y / H;
        if (topDist < 0.1) {
            this.temp += (0 - this.temp) * 0.03;
        }
        this.temp += (0.5 - this.temp) * 0.001;

        if (this.x < 0) this.x += W;
        if (this.x > W) this.x -= W;
        if (this.y < 5) { this.y = 5; this.vy = Math.abs(this.vy) * 0.3; }
        if (this.y > H - 5) { this.y = H - 5; this.vy = -Math.abs(this.vy) * 0.3; }
    }
    draw() {
        ctx.fillStyle = tempToColor(this.temp);
        ctx.globalAlpha = 0.6 + this.temp * 0.4;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();
    }
}

for (let i = 0; i < NUM_PARTICLES; i++) {
    particles.push(new Particle());
}

function drawBackground() {
    const grad = ctx.createLinearGradient(0, 0, 0, H);
    grad.addColorStop(0, '#0a1030');
    grad.addColorStop(1, '#1a0a0a');
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, W, H);

    ctx.fillStyle = 'rgba(255, 60, 20, 0.05)';
    ctx.fillRect(0, H - 30, W, 30);
    ctx.fillStyle = 'rgba(30, 60, 255, 0.04)';
    ctx.fillRect(0, 0, W, 30);

    const numCells = 4;
    const cellWidth = W / numCells;
    ctx.strokeStyle = 'rgba(255,255,255,0.05)';
    ctx.setLineDash([5, 10]);
    for (let i = 1; i < numCells; i++) {
        ctx.beginPath();
        ctx.moveTo(i * cellWidth, 0);
        ctx.lineTo(i * cellWidth, H);
        ctx.stroke();
    }
    ctx.setLineDash([]);

    ctx.fillStyle = 'rgba(255,100,50,0.15)';
    ctx.font = '12px sans-serif';
    ctx.fillText('HOT (Ground heating)', 10, H - 10);
    ctx.fillStyle = 'rgba(100,150,255,0.15)';
    ctx.fillText('COLD (Upper atmosphere)', 10, 20);
}

function animate() {
    const heat = parseFloat(heatSlider.value);
    const visc = parseFloat(viscSlider.value);
    heatVal.textContent = heat.toFixed(1);
    viscVal.textContent = visc.toFixed(3);

    drawBackground();

    ctx.globalAlpha = 1;
    let totalTemp = 0;
    for (const p of particles) {
        p.update(heat, visc);
        p.draw();
        totalTemp += p.temp;
    }
    ctx.globalAlpha = 1;

    pCountEl.textContent = NUM_PARTICLES;
    avgTempEl.textContent = ((totalTemp / NUM_PARTICLES) * 100).toFixed(1);

    requestAnimationFrame(animate);
}
animate();
</script>
</body>
</html>
